/ MPO DEBUG

 7	. 

/ we fill in actual start date	, en save	,

	public void handleSave() throws Exception {
->		getSession().setAttribute(RateCalculationVO.ACTIVE_ORDER, RateCalculationVO.ACTIVE_ORDER_IS_SERVICEORDER);
		super.handleSave();


select this_.SYSTEM_ID as SYSTEM1_117_2_, this_.IS_DELETED as IS2_117_2_, this_.PARTY_ID as PARTY3_117_2_, this_.NAME as NAME117_2_, this_.NAME2 as NAME5_117_2_, this_.ADDRESS as ADDRESS117_2_, this_.ADDRESS2 as ADDRESS7_117_2_, this_.CITY as CITY117_2_, this_.ZIPCODE as ZIPCODE117_2_, this_.COUNTRY_SYSTEMID as COUNTRY10_117_2_, this_.CONTACT_NAME as CONTACT11_117_2_, this_.EMAILADDRESS as EMAILAD12_117_2_, this_.FAXNUMBER as FAXNUMBER117_2_, this_.PHONENUMBER as PHONENU14_117_2_, this_.REGION_STATE as REGION15_117_2_, this_.TNT_ZONE as TNT16_117_2_, this_.REFERENCE1 as REFERENCE17_117_2_, this_.REFERENCE2 as REFERENCE18_117_2_, this_.REFERENCE3 as REFERENCE19_117_2_, this_.REFERENCE4 as REFERENCE20_117_2_, this_.REFERENCE5 as REFERENCE21_117_2_, this_.SERVICE_ORDER_URL_EXPRESSION as SERVICE22_117_2_, this_.MANIFEST_REPORT as MANIFEST23_117_2_, this_.LONGITUDE as LONGITUDE117_2_, this_.LATITUDE as LATITUDE117_2_, this_.PRENOTIFY_CARCON as PRENOTIFY26_117_2_, this_.SERVICE_REMARKS as SERVICE27_117_2_, this_.ORGANIZATION_SYSTEMID as ORGANIZ28_117_2_, this_.PARTY_TYPE_SYSTEMID as PARTY29_117_2_, organizati2_.SYSTEM_ID as SYSTEM1_116_0_, organizati2_.IS_DELETED as IS2_116_0_, organizati2_.ORGANIZATION_ID as ORGANIZA3_116_0_, organizati2_.DESCRIPTION as DESCRIPT4_116_0_, organizati2_.ORGANIZATION_GROUP as ORGANIZA5_116_0_, organizati2_.AUTOM_RATE_CALC as AUTOM6_116_0_, organizati3_.SYSTEM_ID as SYSTEM1_116_1_, organizati3_.IS_DELETED as IS2_116_1_, organizati3_.ORGANIZATION_ID as ORGANIZA3_116_1_, organizati3_.DESCRIPTION as DESCRIPT4_116_1_, organizati3_.ORGANIZATION_GROUP as ORGANIZA5_116_1_, organizati3_.AUTOM_RATE_CALC as AUTOM6_116_1_ 
from PARTY this_ 
left outer join ORGANIZATION organizati2_ on this_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID 
left outer join ORGANIZATION organizati3_ on organizati2_.ORGANIZATION_GROUP=organizati3_.SYSTEM_ID 
where this_.PARTY_ID=? and this_.IS_DELETED=?
2014-10-20 13:08:12,786 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [1] as [VARCHAR] - OEGEMA
2014-10-20 13:08:12,786 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [2] as [BIT] - false
2014-10-20 13:08:12,787 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [4000] as column [SYSTEM1_116_0_]
2014-10-20 13:08:12,787 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [null] as column [SYSTEM1_116_1_]
2014-10-20 13:08:12,787 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [26631670] as column [SYSTEM1_117_2_]
2014-10-20 13:08:12,787 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [false] as column [IS2_116_0_]
2014-10-20 13:08:12,787 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [HAAL-ZW] as column [ORGANIZA3_116_0_]
2014-10-20 13:08:12,787 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [HAAL-ZW] as column [ORGANIZA3_116_0_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [HAAL] as column [DESCRIPT4_116_0_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [null] as column [ORGANIZA5_116_0_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [false] as column [AUTOM6_116_0_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [false] as column [IS2_117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [OEGEMA] as column [PARTY3_117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [Oegema Transport Dedemsvaart B.V.] as column [NAME117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [] as column [NAME5_117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [Pascalstraat 32] as column [ADDRESS117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [] as column [ADDRESS7_117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [Dedemsvaart] as column [CITY117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [7701 SE] as column [ZIPCODE117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [4153] as column [COUNTRY10_117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [] as column [CONTACT11_117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [info@oegematransport.nl] as column [EMAILAD12_117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [+31 523 612028] as column [FAXNUMBER117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [+31 523 612039] as column [PHONENU14_117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [] as column [REGION15_117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [] as column [TNT16_117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [] as column [REFERENCE17_117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [] as column [REFERENCE18_117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [] as column [REFERENCE19_117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [] as column [REFERENCE20_117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [] as column [REFERENCE21_117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [] as column [SERVICE22_117_2_]
2014-10-20 13:08:12,788 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [] as column [MANIFEST23_117_2_]
2014-10-20 13:08:12,789 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [null] as column [LONGITUDE117_2_]
2014-10-20 13:08:12,789 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [null] as column [LATITUDE117_2_]
2014-10-20 13:08:12,789 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [false] as column [PRENOTIFY26_117_2_]
2014-10-20 13:08:12,789 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [Aaaaa] as column [SERVICE27_117_2_]
2014-10-20 13:08:12,789 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [4000] as column [ORGANIZ28_117_2_]
2014-10-20 13:08:12,789 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [26631667] as column [PARTY29_117_2_]
2014-10-20 13:08:12,789 DEBUG [org.hibernate.SQL] 

select properties0_.ORGANIZATION_SYSTEM_ID as ORGANIZA4_116_3_, properties0_.SYSTEM_ID as SYSTEM1_3_, properties0_.SYSTEM_ID as SYSTEM1_67_2_, properties0_.USER_SYSTEM_ID as USER2_67_2_, properties0_.PROPERTIES_SYSTEM_ID as PROPERTIES3_67_2_, properties0_.ORGANIZATION_SYSTEM_ID as ORGANIZA4_67_2_, properties0_.PROPERTY_VALUE as PROPERTY5_67_2_, resource1_.SYSTEM_ID as SYSTEM1_73_0_, resource1_.USER_ID as USER2_73_0_, resource1_.USER_NAME as USER3_73_0_, resource1_.USER_PASSWORD as USER4_73_0_, resource1_.USER_EMAIL_ADDRESS as USER5_73_0_, resource1_.IS_ENABLED as IS6_73_0_, resource1_.IS_INTERFACE_ACCOUNT as IS7_73_0_, resource1_.IS_DELETED as IS8_73_0_, resource1_.LAST_LOGIN as LAST9_73_0_, resource1_.LAST_PASSWORD_UPDATE as LAST10_73_0_, resource1_.USER_REFERENCE1 as USER11_73_0_, resource1_.USER_REFERENCE2 as USER12_73_0_, resource1_.LOGIN_ATTEMPT as LOGIN13_73_0_, resource1_.GRACE_LOGIN as GRACE14_73_0_, resource1_.IS_FIRST_LOGIN as IS15_73_0_, resource1_.CHARGEABLE as CHARGEABLE73_0_, resource1_.CREATED_BY as CREATED17_73_0_, resource1_.CREATED_ON as CREATED18_73_0_, resource2_.SYSTEM_ID as SYSTEM1_73_1_, resource2_.USER_ID as USER2_73_1_, resource2_.USER_NAME as USER3_73_1_, resource2_.USER_PASSWORD as USER4_73_1_, resource2_.USER_EMAIL_ADDRESS as USER5_73_1_, resource2_.IS_ENABLED as IS6_73_1_, resource2_.IS_INTERFACE_ACCOUNT as IS7_73_1_, resource2_.IS_DELETED as IS8_73_1_, resource2_.LAST_LOGIN as LAST9_73_1_, resource2_.LAST_PASSWORD_UPDATE as LAST10_73_1_, resource2_.USER_REFERENCE1 as USER11_73_1_, resource2_.USER_REFERENCE2 as USER12_73_1_, resource2_.LOGIN_ATTEMPT as LOGIN13_73_1_, resource2_.GRACE_LOGIN as GRACE14_73_1_, resource2_.IS_FIRST_LOGIN as IS15_73_1_, resource2_.CHARGEABLE as CHARGEABLE73_1_, resource2_.CREATED_BY as CREATED17_73_1_, resource2_.CREATED_ON as CREATED18_73_1_ 
from PROPERTIES_VALUE properties0_ 
left outer join TMS_USER resource1_ on properties0_.USER_SYSTEM_ID=resource1_.SYSTEM_ID 
left outer join TMS_USER resource2_ on resource1_.CREATED_BY=resource2_.SYSTEM_ID where properties0_.ORGANIZATION_SYSTEM_ID=?
2014-10-20 13:08:12,789 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [1] as [INTEGER] - 4000
2014-10-20 13:08:12,791 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [null] as column [SYSTEM1_73_0_]
2014-10-20 13:08:12,791 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [null] as column [SYSTEM1_73_1_]
2014-10-20 13:08:12,791 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [26632060] as column [SYSTEM1_67_2_]
2014-10-20 13:08:12,791 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [null] as column [USER2_67_2_]
2014-10-20 13:08:12,791 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [554202] as column [PROPERTIES3_67_2_]
2014-10-20 13:08:12,791 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [4000] as column [ORGANIZA4_67_2_]
2014-10-20 13:08:12,791 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [STANDARD] as column [PROPERTY5_67_2_]
2014-10-20 13:08:12,791 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [4000] as column [ORGANIZA4_116_3_]
2014-10-20 13:08:12,791 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [26632060] as column [SYSTEM1_3_]
2014-10-20 13:08:12,792 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [null] as column [SYSTEM1_73_0_]
2014-10-20 13:08:12,792 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [null] as column [SYSTEM1_73_1_]
2014-10-20 13:08:12,792 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [26632061] as column [SYSTEM1_67_2_]
2014-10-20 13:08:12,792 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [null] as column [USER2_67_2_]
2014-10-20 13:08:12,792 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [554285] as column [PROPERTIES3_67_2_]
2014-10-20 13:08:12,792 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [4000] as column [ORGANIZA4_67_2_]
2014-10-20 13:08:12,792 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [STANDARD] as column [PROPERTY5_67_2_]
2014-10-20 13:08:12,792 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [4000] as column [ORGANIZA4_116_3_]
2014-10-20 13:08:12,792 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [26632061] as column [SYSTEM1_3_]
2014-10-20 13:08:12,792 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [null] as column [SYSTEM1_73_0_]
2014-10-20 13:08:12,792 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [null] as column [SYSTEM1_73_1_]
2014-10-20 13:08:12,792 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [26632347] as column [SYSTEM1_67_2_]
2014-10-20 13:08:12,792 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [null] as column [USER2_67_2_]
2014-10-20 13:08:12,792 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [26632346] as column [PROPERTIES3_67_2_]
2014-10-20 13:08:12,792 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [4000] as column [ORGANIZA4_67_2_]
2014-10-20 13:08:12,792 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [EUR] as column [PROPERTY5_67_2_]
2014-10-20 13:08:12,792 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [4000] as column [ORGANIZA4_116_3_]
2014-10-20 13:08:12,792 DEBUG [org.hibernate.type.descriptor.sql.BasicExtractor] (http-0.0.0.0-8080-7:) found [26632347] as column [SYSTEM1_3_]

/ PartyGrouo.standard.hbm.xml
	<class name="com.mpobjects.oms.model.partygroup.vo.PartyGroupVO" lazy="false" discriminator-value="PARTY_GROUP" table="PARTY_GROUP">
/ TODO

/ Party.standard.hbm.xml
		<many-to-one name="organizationVO" column="ORGANIZATION_SYSTEMID" class="com.mpobjects.oms.model.entity.organization.Organization" />
/ Deze is unidir	,

/ Properties
<class name="com.mpobjects.oms.model.propertiesvalue.vo.PropertiesValueVO" table="PROPERTIES_VALUE">
		<many-to-one name="organization" class="com.mpobjects.oms.model.entity.organization.Organization">
			<column name="ORGANIZATION_SYSTEM_ID" not-null="false" />
		</many-to-one>


/ Organization.standard.hbm.xml
		<set name="propertiesValues" inverse="true" fetch="select" lazy="false">
/ TODO

			<!-- cache usage="read-write"/-->
/ TODO
			<key column="ORGANIZATION_SYSTEM_ID" />
			<one-to-many class="com.mpobjects.oms.model.propertiesvalue.vo.PropertiesValueVO" />
			<!-- loader query-ref="orgProperties" /-->
			<filter name="userFilter" condition="USER_SYSTEM_ID is null" />
		</set>
		<filter name="filterOrganization" condition="system_id in (select uo.organization_systemid from user_organization uo where uo.user_systemid = :current_user_system_id)" />
	</class>











/ Einde MPO DEBUG


/ MPO TICKETS ISB-244

/ ISB-224

nloms=# select*from party;
 system_id | is_deleted |   party_id    | party_type_systemid | organization_systemid |            name            |     name2      |          address 
         | address2 |          city          | zipcode  | country_systemid | contact_name | emailaddress | faxnumber | phonenumber | region_state | tnt
_zone | reference1 | reference2 | reference3 | reference4 | reference5 | service_order_url_expression | manifest_report | time_zone | longitude | latit
ude | schedule_systemid | prenotify_carcon | service_remarks 
-----------+------------+---------------+---------------------+-----------------------+----------------------------+----------------+------------------
---------+----------+------------------------+----------+------------------+--------------+--------------+-----------+-------------+--------------+----
------+------------+------------+------------+------------+------------+------------------------------+-----------------+-----------+-----------+------
----+-------------------+------------------+-----------------
 26678218 |          0 | Noordoost     |            26673686 |                  1000 | PostNL Noordoost           |                | .               
          |          |                        |          |             4153 |              |              |           |             |              |  
        |            |            |            |            |            |                              |                 |           |           |   
       |                   |                0 | 
  26673688 |          0 | Noordwest     |            26673686 |                  1000 | PostNL Noordwest           |                | .               
          |          |                        |          |             4153 |              |              |           |             |              |  
        |            |            |            |            |            |                              |                 |           |           |   
       |                   |                0 | 
  26678221 |          0 | Zuidwest      |            26673686 |                  1000 | PostNL Zuidwest            |                | .               
          |          |                        |          |             4153 |              |              |           |             |              |  
        |            |            |            |            |            |                              |                 |           |           |   
       |                   |                0 | 


pnloms=# select*from party_type_group;
 system_id | party_type_group |   description   | is_deleted | show_on_sho | show_on_so | is_system | show_on_co | show_on_col 
-----------+------------------+-----------------+------------+-------------+------------+-----------+------------+-------------
  26673487 | PREFERRED_PARTY  | PREFERRED_PARTY |          0 |           0 |          0 |         0 |          0 |           0
  26673687 | BILL_TO          | BILL TO         |          0 |           0 |          0 |         0 |          0 |           0
  26678850 | VIA              | VIA             |          0 |           1 |          0 |         0 |          0 |           0
  26674086 | DELIVERY         |                 |          0 |           0 |          0 |         0 |          0 |           0
  26674141 | COLLECTION       |                 |          0 |           0 |          0 |         0 |          0 |           0
  26680439 | Customer         |                 |          0 |           1 |          0 |         0 |          0 |           0
(6 rows)

pnloms=# select*from party_type_in_group;
 party_type_systemid | party_type_group_systemid 
---------------------+---------------------------
            26673686 |                  26673687
            26673722 |                  26674141
            26673712 |                  26674141
            26673357 |                  26674086
            26673357 |                  26674141

nloms=# select*from party_type;
 system_id | is_deleted |     party_type      |     description     
-----------+------------+---------------------+---------------------
  26673356 |          0 | SERVICE_PROVIDER    | SERVICE_PROVIDER
  26673357 |          0 | CUSTOMER            | CUSTOMER
  26673686 |          0 | PRINCIPAL           | PRINCIPAL
  26673712 |          0 | SCB                 | SCB
  26673713 |          0 | IMU                 | IMU
  26673714 |          0 | BUBA                | BUBA
  26673715 |          0 | DEPOT_PAKKET        | DEPOT_PAKKET
  26673716 |          0 | DEPOT_POST          | DEPOT_POST
  26673717 |          0 | VBL-VBG             | VBL-VBG
  26673718 |          0 | EXP_LOCATIE         | EXP_LOCATIE
  26673719 |          0 | BUS_LOCATIE         | BUS_LOCATIE
  26673720 |          0 | NVSP                | NVSP
  26673721 |          0 | DEPOT_POSTBEZORGERS | DEPOT_POSTBEZORGERS
  26673722 |          0 | RETAIL              | RETAIL
  26673723 |          0 | EMBALLAGE_CENTRUM   | EMBALLAGE_CENTRUM
  26678849 |          0 | VIA                 | VIA
(16 rows)

/ Kies een shipment order	, ship to tab	,
/ Wat zijn 
From :
To;
/ TODO
/ tabs  (click search icon en kijk naar de query op het nieuwe window)	,
Ship from  = COLLECTION
Ship to = DELIVERY
Bill to=BILL_TO
VIA=VIA
Customer=Customer

party						party_type_group
     ----------- party_type_in_group -------

/ in party.party_type_group 

/ click onder tab Bill to op search icon	, we zien een nieuw window met list	, dat is deze list	,

pnloms=# 
select p.*,t.party_type 
from party p 
join party_type_in_group i on p.party_type_systemid=i.party_type_systemid 
join party_type_group g on i.prty_type_group_systemid=g.system_id 
join party_type t on p.party_type_systemid=t.system_id 
where g.party_type_group='BILL_TO';
-----------+------------+-----------+---------------------+-----------------------+------------------+-------+---------+----------+------+---------+--
----------------+--------------+--------------+-----------+-------------+--------------+----------+------------+------------+------------+------------
+------------+------------------------------+-----------------+-----------+-----------+----------+-------------------+------------------+-------------
----+------------
  26678218 |          0 | Noordoost |            26673686 |                  1000 | PostNL Noordoost |       | .       |          |      |         |  
           4153 |              |              |           |             |              |          |            |            |            |            
|            |                              |                 |           |           |          |                   |                0 |             
    | PRINCIPAL
  26673688 |          0 | Noordwest |            26673686 |                  1000 | PostNL Noordwest |       | .       |          |      |         |  
           4153 |              |              |           |             |              |          |            |            |            |            
|            |                              |                 |           |           |          |                   |                0 |             
    | PRINCIPAL
  26678221 |          0 | Zuidwest  |            26673686 |                  1000 | PostNL Zuidwest  |       | .       |          |      |         |  
           4153 |              |              |           |             |              |          |            |            |            |            
|            |                              |                 |           |           |          |                   |                0 |             
    | PRINCIPAL
  26678223 |          0 | Zuidoost  |            26673686 |                  1000 | PostNL Zuidoost  |       | .       |          |      |         |  
           4153 |              |              |           |             |              |          |            |            |            |            
|            |                              |                 |           |           |          |                   |                0 |             
...

/ we zien dat de party_type PRINCIPAL is	, en de party_type_group BILL_TO	,


/ we hebben joined op party_type_id	, en op party_type_group_systemid, en we konden geven party_type_group: 'BILL_TO'	,
/ de party_types hebben ook een naam	, dan moeten we in de party_type tbl kijken	, 

/ 7	.

/ Kies configuration, finance, financial party,
/ we zien er 2	,
/ deze staan in	,

pnloms=# select*from invoice_financial_party;

 system_id | organization_systemid | is_deleted | financial_party_id |    name     | name2 | address | address2 | zipcode | city | region_state | coun
try_systemid | contact_name | emailaddress | phonenumber | faxnumber |   vat_number   | payment_block | payment_std_currency_systemid | payment_term |
 reference1 | reference2 | reference3 | reference4 | reference5 | remark | bill_to_name | bill_to_name2 | bill_to_adress | bill_to_adress2 | bill_to_z
ipcode | bill_to_city | bill_to_region_state | bill_to_country_code_systemid | bill_to_contact_name | bill_to_email_adress | bill_to_phonenumber | bil
l_to_faxnumber | payment_term_end_of_month | match_level | treshold_down_percentage | treshold_down_absolut | treshold_up_percentage | treshold_up_abs
olut | match_invoice_identifier | creditor_code | match_all_cost_types | use_edi | disponability_term | disponability_percentage | self_bill | billing
_cycle | invoice_group_mode | self_bill_invoice_systemid | cost_allocation_method 
-----------+-----------------------+------------+--------------------+-------------+-------+---------+----------+---------+------+--------------+-----
-------------+--------------+--------------+-------------+-----------+----------------+---------------+-------------------------------+--------------+
------------+------------+------------+------------+------------+--------+--------------+---------------+----------------+-----------------+----------
-------+--------------+----------------------+-------------------------------+----------------------+----------------------+---------------------+----
---------------+---------------------------+-------------+--------------------------+-----------------------+------------------------+----------------
-----+--------------------------+---------------+----------------------+---------+--------------------+--------------------------+-----------+--------
-------+--------------------+----------------------------+------------------------
  26680336 |                  1000 |          0 | AUTOBEDRIJF        | AUTOBEDRIJF |       |         |          |         |      |              |     
        4153 |              |              |             |           | NL820577029B01 |             0 |                          7001 |           30 |
            |            |            |            |            |        |              |               |                |                 |          
       |              |                      |                               |                      |                      |                     |    
               |                         0 | LEVEL B     |                 30.00000 |              10.00000 |                2.00000 |             2.0
0000 | SERVICE_ORDER_ID         | 12345         |                    1 |       0 |                  0 |                  0.00000 |         0 |        
       |                    |                            | ON_HEADER_APPROVAL
  26680337 |                  1000 |          0 | GVV                | GVV         |       |         |          |         |      |              |     
        4153 |              |              |             |           | NL820577029B01 |             0 |                          7001 |           30 |
            |            |            |            |            |        |              |               |                |                 |          
       |              |                      |                               |                      |                      |                     |    
               |                         0 | LEVEL B     |                 30.00000 |              10.00000 |                2.00000 |             2.0
0000 | SERVICE_ORDER_ID         | 12346         |                    1 |       0 |                  0 |                  0.00000 |         0 |        
       |                    |                            | ON_HEADER_APPROVAL
(2 rows)

/ we hover over menu	, 
Configuration, Finance, Financial party	,
/ we zien onderin	,
invoice/financial-party_list
$ vi invoice-sitemap.xml
		<map:match pattern="financial-party_list">
				<map:act type="financialPartyList"/>						/ act fct,  nadat deze heeft exec	,
				<map:call resource="dynatablePage" >						/ zien we deze page	, 
					<map:parameter name="xsp" value="xsp/financial-party_list.xml" />
				</map:call>
			</map:match>

/ we click het menu item	,
	Configuration, Finance, Financial party	,
/ FinancialPartyListAction extends ListAction	, en daar is de act fct waar we in fall	,
FinancialPartyListAction(ListAction).act() line: 58	
	public Map act() throws Exception {
->		String myIdentifier = this.getClass().getPackage().getName() + "." + this.getClass().getName() + "_" + getRequest().getRequestURI();
/ als we continue geven	, zie we de page (vanuit xml in dit geval)	, 

/ we hover over de 1ste groen button	,
/we zien onderin	, of met F12	,
tms/invoice/financial-party_edit	,
$ vi invoice-sitemap.xml
		<map:match type="regexp" pattern="^financial-party_(edit|create)$">
				<map:act type="financialPartyForm"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/financial-party_edit.jsp"/>
		</map:match>

/ we click de 1ste , 
/ we vallen in FinancialPartyFormAction.act	,
FinancialPartyFormAction.act() line: 31	
/ Als we continue geven	, zie we de jsp	, we zien de Financial Party Edit scherm	,

/ als we onderin hover over 'Create new Financial party bank account'	, dan zien we	onderin , of met F12	,
financial-party-bank-account_create	,

$ vi invoice-sitemap.xml,

			<map:match type="regexp" pattern="^financial-party-bank-account_(edit|create)$">
				<map:act type="financialPartyBankAccountForm"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/financial-party-bank-account_edit.jsp"/>
			</map:match>

/ we set b in	,
$ vi nvoice/control/financialpartybankaccount/action/FinancialPartyBankAccountFormAction.java 
	public Map act() throws java.lang.Exception {
...
		getRequest().setAttribute("formVO", myVO);

/ we zien formVO in de jsp	,
file:///home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/module/invoice/war/invoice/jsp/financial-party-bank-account_edit.jsp 

			<mpo:setFormVO valueObject="${formVO}">

/ we click op de link	, dan komt code eerst in de act fct van we zien dus het result van de jsp	,
/ we zien nu niets onderin, we kunnen alleen  in chrome met F12 kijken naar de submit button	,
<input type="button" name="saveBtn" id="saveBtn" value="Save" onclick=" theEditFormFormManager.submit('../invoice/financial-party-bank-account_save', false, 0);">

/ we zien in invoice-sitemap.xml	,

			<map:match pattern="financial-party-bank-account_save">
				<map:act type="financialPartyBankAccountSave"/>
			</map:match>

/ dus geen jsp ,
/ TODO (wat betekent dat?)

$ vi module/invoice/src/java/com/mpobjects/invoice/control/financialpartybankaccount/action/FinancialPartyBankAccountSaveAction.java 

	public void handleSave() throws Exception {

		FinancialPartyBankAccountVO myVO = (FinancialPartyBankAccountVO) getValueObject();
		Util.getDAO().merge(myVO);

	}

/ dus er zijn 
FinancialPartyBankAccountFormAction.java 
FinancialPartyBankAccountSaveAction.java 

/ er is 	,
invoice/model/financialpartybankaccount/vo/FinancialPartyBankAccountVO.java 

/ Deze moet een H mapping naar 

nloms=# \d+ invoice_f_p_bank_account 

                                 Table "public.invoice_f_p_bank_account"
           Column            |          Type          | Modifiers | Storage  | Stats target | Description 
-----------------------------+------------------------+-----------+----------+--------------+-------------
 system_id                   | integer                | not null  | plain    |              | 
 invoice_f_p_systemid        | integer                |           | plain    |              | 
 account_number              | character varying(50)  |           | extended |              | 
 bank_name                   | character varying(50)  |           | extended |              | 
 bank_city                   | character varying(50)  |           | extended |              | 
 bank_state                  | character varying(100) |           | extended |              | 
 country_systemid            | integer                |           | plain    |              | 
 iban_code                   | character varying(50)  |           | extended |              | 
 swift_code                  | character varying(50)  |           | extended |              | 
 currency_systemid           | integer                |           | plain    |              | 
 is_deleted                  | smallint               | default 0 | plain    |              | 
 invoice_payment_account_sid | integer                |           | plain    |              | 
Indexes:
    "pk_invoice_f_p_bank_account" PRIMARY KEY, btree (system_id)
Foreign-key constraints:
    "fk_invoice_f_p_country" FOREIGN KEY (country_systemid) REFERENCES country(system_id)
    "fk_invoice_f_p_currency" FOREIGN KEY (currency_systemid) REFERENCES currency(system_id)
    "fk_invoice_f_p_systemid" FOREIGN KEY (invoice_f_p_systemid) REFERENCES invoice_financial_party(system_id)
    "fk_invoice_payment_account_sid" FOREIGN KEY (invoice_payment_account_sid) REFERENCES invoice_payment_account(system_id)
Has OIDs: no

/ 7	.

pnloms=# \d+ shipment_item

/ Deze columns zijn ongebruikt in shipment_item	tbl, we zien ze niet in de H mapping	,

 description                   | character varying(255)      |                    | extended |              | 
 item_value_alt                | double precision            |                    | plain    |              | 
 product_series                | character varying(80)       |                    | extended |              | 
 product_model                 | character varying(80)       |                    | extended |              | 
 customs_number                | character varying(80)       |                    | extended |              | 
 part_number                   | character varying(80)       |                    | extended |              | 
 shipping_unit_translation_key | character varying(40)       |                    | extended |              | 
 gcd_sequence_number           | character varying(50)       |                    | extended |              | 
 gcd_no_of_packages            | character varying(50)       |                    | extended |              | 
 gcd_tracking_reference1       | text                        |                    | extended |              | 
 gcd_tracking_reference2       | text                        |                    | extended |              | 
 gcd_tracking_reference3       | text                        |                    | extended |              | 

[eric@localhost LOGS]$ awk '{print $1}' /tmp/systemitem.txt 

system_id				getHibernateSystemId()=getSystemId	, systemId	
shipment_order_systemid			shipmentOrder	
shipping_unit_systemid			shippingUnit	
shipment_item_id			shipmentItemId
description 							NIET	
quantity				quantity
value_currency_systemid			getValueCurrencyVO()=theValueCurrencyVO	,
item_value_alt							NIET
value_alt_currency_systemid		getAltValueCurrencyVO()=theAltValueCurrencyVO	,
product_series							NIET	
product_model							NIET
customs_number							NIET
container_number			containerNumber
airwaybill_number			airwaybillNumber
case_number				caseNumber
handling_instructions			handlingInstructions
part_number							NIET	
label_info				labelInfo
goods_status_systemid			goodsStatus
reference1
reference2
reference3
reference4
reference5
reference6
reference7
reference8
reference9
reference10
parent_systemid
shipping_unit_translation_key
gcd_sequence_number
gcd_no_of_packages
stackable
gcd_tracking_reference1
gcd_tracking_reference2
gcd_tracking_reference3
base_weight_kg
comp_item_weight_kg
tot_volume_m3
volume_m3
weight_kg
tot_weight_kg
total_ldm
item_value
length_m
width_m
height_m
export_date
release_date

/ 7	.

/ debug	,

FinancialPartyBankAccountFormAction.act() line: 33	
 myFinancialPartySystemId = getFinancialPartySystemIdFromRequest();
myFinancialPartySystemId	26680336	

		if (mySystemId == 0) {
			myVO = new FinancialPartyBankAccountVO();
			FinancialPartyVO myFinancialParty = MpoBeanFactory.getBean(FinancialPartyDAOInterface.class).getBySystemId(myFinancialPartySystemId);

/ 7	.

$ vi FinancialPartyVO.java

	protected Set<Binary> attachments;
/ OK

	protected Collection<FinancialPartyCostTypeVO> costTypeList;
/ NOT

	private String address = "";
/ OK
	private String address2 = "";
/ OK
	private BillingCycle billingCycle;
/ OK

	private String billToAddress = "";
/ OK

	private String billToAddress2 = "";
/ OK

	private String billToCity = "";
/ OK

	private String billToContactName = "";
/ OK

	private Country billToCountryVO = null;
/ OK

	private String billToEmailAddress = "";
/ OK

	private String billToFaxNumber = "";
/ OK

	private String billToName = "";
/ OK

	private String billToName2 = "";
/ OK

	private String billToPhoneNumber = "";
/ OK

	private String billToRegionState = "";
/ OK

	private String billToZipCode = "";
/ OK

	private String city = "";
/ OK
	private String contactName = "";
/ OK

	private CostAllocationMethod costAllocationMethod = CostAllocationMethod.ON_HEADER_APPROVAL;
/ OK

	private Country countryVO = null;
/ OK

	private String creditorCode;
/ OK

	private BigDecimal disponabilityPercentage;
/ OK

	private int disponabilityTerm;
/ OK

	private String emailAddress = "";
/ OK
	private String faxNumber = "";
/ OK

	private InvoiceGroupMode invoiceGroupMode;
/ OK

	/**
	 * The date of the last invoice run
	 */
	private Date lastInvoiceRun;
/ NOT

	private boolean matchAllCostTypes = false;
/ OK

	// Used for invoice line processing
	private MatchInvoiceIdentifier matchInvoiceIdentifier;
/ OK

	private String matchLevel = "";
/ OK

	private String name = "";
/ OK
	private String name2 = "";
/ OK

	private int paymentBlock = 0;
/ NOT
	private CurrencyVO paymentDefaultCurrencyVO = null;
/ OK

	private int paymentTerm;
/ OK

	private int paymentTermStartEndOfMonth;
/ OK

	private String phoneNumber = "";
/ OK

	private String postalCode = "";
/ OK
	private String reference1 = "";

	private String reference2 = "";

	private String reference3 = "";

	private String reference4 = "";

	private String reference5 = "";

	private String regionState = "";
/ OK

	private String remark = "";
/ OK

	private boolean selfBill;
/ OK

	private ReportVO selfBillInvoice;
/ OK

	private BigDecimal tresholdDownAbsolut;
/ OK

	private BigDecimal tresholdDownPercentage;
/ OK

	private BigDecimal tresholdUpAbsolut;
/ OK

	private BigDecimal tresholdUpPercentage;
/ OK

	private boolean useEDI;
/ OK

	private String vatNumber = "";
/ OK


public abstract class EnumeratedResourceProtectedValueObject extends EnumeratedValueObject implements OrganizationValueObjectInterface {
	private Organization organizationVO;
/ OK

public abstract class EnumeratedValueObject extends SoftDeletableValueObject implements EnumeratedValueObjectInterface {
	private String code = "";
/ OK
	private String description = "";
/ NOT

public class SoftDeletableValueObject extends ValueObject implements SoftDeletable {
	private boolean deleted;
/ OK

public abstract class ValueObject implements java.io.Serializable, SelectionListHelper.SelectionListItem, EntityInterface {
	protected int systemId = VOLATILE_SYSTEM_ID;
/ OK


$ vi FinancialParty.standard.hbm.xml

<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
                                   "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping>
	<class lazy="false" name="com.mpobjects.invoice.model.financialparty.vo.FinancialPartyVO" table="INVOICE_FINANCIAL_PARTY">

		<id name="systemId" type="int">
			<column name="SYSTEM_ID" />
			<generator class="com.mpobjects.core.model.HibernateIdGenerator" />
		</id>
		<property name="deleted" column="IS_DELETED" />
		<property column="FINANCIAL_PARTY_ID" length="50" name="code" not-null="true" />

		<property column="NAME" name="name" />
		<property column="NAME2" name="name2" />
		<property column="ADDRESS" name="address" />
		<property column="ADDRESS2" name="address2" />
		<property column="CITY" name="city" />
		<property column="ZIPCODE" name="postalCode" />
		<property column="CONTACT_NAME" name="contactName" />
		<property column="EMAILADDRESS" name="emailAddress" />
		<property column="VAT_NUMBER" name="vatNumber" />
		<property column="USE_EDI" name="useEDI" />
		<property column="CREDITOR_CODE" name="creditorCode" />
		<property column="MATCH_LEVEL" name="matchLevel" />

		<property name="regionState" column="REGION_STATE" />

		<property name="paymentTermStartEndOfMonth" column="PAYMENT_TERM_END_OF_MONTH" not-null="true"/>
		<property name="phoneNumber" column="PHONENUMBER" />
		<property name="faxNumber" column="FAXNUMBER" />
		<property name="remark" column="REMARK"/>

		<property name="tresholdUpAbsolut" column="TRESHOLD_UP_ABSOLUT" />
		<property name="tresholdUpPercentage" column="TRESHOLD_UP_PERCENTAGE" />
		<property name="tresholdDownAbsolut" column="TRESHOLD_DOWN_ABSOLUT" />
		<property name="tresholdDownPercentage" column="TRESHOLD_DOWN_PERCENTAGE" />


		<property column="BILL_TO_NAME" name="billToName" />
		<property column="BILL_TO_NAME2" name="billToName2" />
		<property column="BILL_TO_ADRESS" name="billToAddress" />
		<property column="BILL_TO_ADRESS2" name="billToAddress2" />
		<property column="BILL_TO_CITY" name="billToCity" />
		<property column="BILL_TO_ZIPCODE" name="billToZipCode" />
		<property column="BILL_TO_CONTACT_NAME" name="billToContactName" />
		<property column="BILL_TO_EMAIL_ADRESS" name="billToEmailAddress" />
		<property column="BILL_TO_PHONENUMBER" name="billToPhoneNumber" />
		<property column="BILL_TO_FAXNUMBER" name="billToFaxNumber" />

		<property name="billToRegionState" column="BILL_TO_REGION_STATE" />

		<many-to-one name="billToCountryVO" class="com.mpobjects.oms.model.entity.country.Country" fetch="select" lazy="false">
			<column name="BILL_TO_COUNTRY_CODE_SYSTEMID" />
		</many-to-one>

		<many-to-one name="paymentDefaultCurrencyVO" column="PAYMENT_STD_CURRENCY_SYSTEMID" class="com.mpobjects.oms.model.currency.vo.CurrencyVO" />
		<many-to-one name="countryVO" class="com.mpobjects.oms.model.entity.country.Country" fetch="select" lazy="false">
			<column name="COUNTRY_SYSTEMID" />
		</many-to-one>

		<property name="paymentTerm" column="PAYMENT_TERM" not-null="true" />
		<many-to-one name="organizationVO" class="com.mpobjects.oms.model.entity.organization.Organization" fetch="select">
			<column name="ORGANIZATION_SYSTEMID" not-null="true" />
		</many-to-one>

		<property name="matchInvoiceIdentifier" column="MATCH_INVOICE_IDENTIFIER" not-null="false">
			<type name="org.hibernate.type.EnumType">
				<param name="type">12</param>
				<param name="enumClass">com.mpobjects.invoice.model.financialparty.vo.MatchInvoiceIdentifier</param>
			</type>
		</property>

		<property column="MATCH_ALL_COST_TYPES " name="matchAllCostTypes" not-null="true" />

		<property name="disponabilityPercentage" column="DISPONABILITY_PERCENTAGE" />
		<property name="disponabilityTerm" column="DISPONABILITY_TERM" not-null="true" />

		<property name="costAllocationMethod" column="COST_ALLOCATION_METHOD" not-null="true">
			<type name="org.hibernate.type.EnumType">
				<param name="type">12</param>
				<param name="enumClass">com.mpobjects.invoice.model.financialparty.vo.CostAllocationMethod</param>
			</type>
		</property>

		<property column="SELF_BILL " name="selfBill" not-null="true" />

		<property name="billingCycle" column="BILLING_CYCLE" not-null="false">
			<type name="org.hibernate.type.EnumType">
				<param name="type">12</param>
				<param name="enumClass">com.mpobjects.invoice.model.financialparty.vo.BillingCycle</param>
			</type>
		</property>
		
		<property name="invoiceGroupMode" column="INVOICE_GROUP_MODE" not-null="false">
			<type name="org.hibernate.type.EnumType">
				<param name="type">12</param>
				<param name="enumClass">com.mpobjects.invoice.model.financialparty.vo.InvoiceGroupMode</param>
			</type>
		</property>
		
		<set name="attachments" table="FINANCIAL_PARTY_BINARY">
			<key column="FINANCIAL_PARTY_SYSTEMID" />
			<many-to-many class="com.mpobjects.oms.model.binary.Binary" column="BINARY_SYSTEMID" />
		</set>
		
		<many-to-one name="selfBillInvoice" class="com.mpobjects.oms.model.report.vo.ReportVO" fetch="select">
			<column name="SELF_BILL_INVOICE_SYSTEMID" not-null="false" />
		</many-to-one>
		
		<!-- <set name="costTypeList" cascade="all,delete-orphan" lazy="false"> <key column="FINANCIAL_PARTY_SYSTEMID" not-null="true" /> <one-to-many class="com.mpobjects.invoice.model.financialPartyCostType.FinancialPartyCostTypeVO" 
			/> </set> -->

		<!-- <set name="ranges" table="INV_F_PARTY_SEQ_GEN" inverse="true" lazy="true" fetch="select"> <key> <column name="FP_SYSTEMID" /> </key> <one-to-many class="com.mpobjects.invoice.model.financialparty.InvoiceFinancialPartyRange" 
			/> </set> -->

		<filter name="filterOrganization" condition="organization_Systemid in (select uo.organization_systemid from user_organization uo where uo.user_systemid = :current_user_system_id)" />
	</class>
	<filter-def name="filterOrganization">
		<filter-param name="current_user_system_id" type="integer" />
	</filter-def>
</hibernate-mapping>



pnloms=# \d+ invoice_financial_party
                                       Table "public.invoice_financial_party"

            Column             |          Type          |     Modifiers      | Storage  | Stats target | Description 
-------------------------------+------------------------+--------------------+----------+--------------+-------------
...
 payment_block                 | smallint               | default 0          | plain    |              | 
/ NOT 
 reference1                    | character varying(80)  |                    | extended |              | 
/ NOT 
 reference2                    | character varying(80)  |                    | extended |              | 
/ NOT 
 reference3                    | character varying(80)  |                    | extended |              | 
/ NOT 
 reference4                    | character varying(80)  |                    | extended |              | 
/ NOT 
 reference5                    | character varying(80)  |                    | extended |              | 
/ NOT 


/ 7	.

$ vi FinancialPartyBankAccountVO.java
...
pnloms=# \d+ invoice_f_p_bank_account
                                 Table "public.invoice_f_p_bank_account"
           Column            |          Type          | Modifiers | Storage  | Stats target | Description 
-----------------------------+------------------------+-----------+----------+--------------+-------------
 system_id                   | integer                | not null  | plain    |              | 
 invoice_f_p_systemid        | integer                |           | plain    |              | 
 account_number              | character varying(50)  |           | extended |              | 
 bank_name                   | character varying(50)  |           | extended |              | 
 bank_city                   | character varying(50)  |           | extended |              | 
 bank_state                  | character varying(100) |           | extended |              | 
 country_systemid            | integer                |           | plain    |              | 
 iban_code                   | character varying(50)  |           | extended |              | 
 swift_code                  | character varying(50)  |           | extended |              | 
 currency_systemid           | integer                |           | plain    |              | 
 is_deleted                  | smallint               | default 0 | plain    |              | 
 invoice_payment_account_sid | integer                |           | plain    |              | 
Indexes:
    "pk_invoice_f_p_bank_account" PRIMARY KEY, btree (system_id)
Foreign-key constraints:
    "fk_invoice_f_p_country" FOREIGN KEY (country_systemid) REFERENCES country(system_id)
    "fk_invoice_f_p_currency" FOREIGN KEY (currency_systemid) REFERENCES currency(system_id)
    "fk_invoice_f_p_systemid" FOREIGN KEY (invoice_f_p_systemid) REFERENCES invoice_financial_party(system_id)
    "fk_invoice_payment_account_sid" FOREIGN KEY (invoice_payment_account_sid) REFERENCES invoice_payment_account(system_id)
Has OIDs: no

$ vi FinancialPartyBankAccountVO.java

public class FinancialPartyBankAccountVO extends EnumeratedValueObject {
/ code
/ TODO 
/ // description
/ deleted
/ OK
/systemId
/ OK

	private String theBankCity = "";
/ OK

	private String theBankName = "";
/ OK

	private String theBankState = "";
/ OK

	private Country theCountryVO = null;
/ OK

	private CurrencyVO theCurrencyVO = null;
/ OK

	private FinancialPartyVO theFinancialPartyVO = null;
/ OK

	private String theIbanCode = "";
/ OK

	private String theSwiftCode = "";
/ OK

/ 7	.

/ JIRA

/ click START, RESOLVE, fill in Comment onderaan	,
Revision number: <rev.no>	 
/ die vind je in eclipse console met uiterst rechts pijltje naar beneden	, 6 SVN console 

/ dan 	,
People: Delivery
Responsible team: Delivery

/ Einde JIRA

/ 7	. 

/ SAMENVATTING

/ we hebben aangepast	,

   Adding         /home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/module/invoice/src/java/com/mpobjects/invoice/model/financialpartybankaccount/dao/FinancialPartyBankAccountVO.standard.hbm.xml
    Sending        /home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/module/invoice/src/java/com/mpobjects/invoice/model/financialpartybankaccount/vo/FinancialPartyBankAccountVO.java
    Sending        /home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/module/invoice/src/java/com/mpobjects/invoice/model/paymentaccount/vo/PaymentAccountVO.java
    Sending        /home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/module/invoice/war/WEB-INF/tags/invoice/financialparty-bankaccount.tag
    Sending        /home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/module/invoice/war/invoice/jsp/financial-party-bank-account_edit.jsp

/ 13	.

/ In het scherm Financial Party Bank Account Edit	, financial-party-bank-account_edit.jsp	, is onderaan een field payment account, 	deze rm 	, 

/ 13	.

/ In het scherm Financial Party Edit	, dat is financial-party_edit.jsp	, het scherm voor het scherm Financial Party Bank Account Edit,  is onderaan een list van bank accounts, 	van deze moet het laatste field rm 	, dat is in financialparty-bankaccount.tag, we hebben het laatste field rm	, 
/ Dit is voor als we in het scherm Financial Party Bank Account Edit "save & close" click	,

/ 13	. 

/ PaymentAccountVO hebben we @Deprecated 	,

/ 13	.

/ In FinancialPartyBankAccountVO	,

	private FinancialPartyVO theFinancialPartyVO = null;

	/**
	 * Only used for financial-party-bank-account_edit.jsp
	 */
	public int getFinancialPartySystemId() {
		return getFinancialPartyVO().getSystemId();
	}

	/**
	 * Only used for financial-party-bank-account_edit.jsp
	 */ 
	public void setFinancialPartySystemId(int aFinancialPartySystemId) {
	}

/ Maar het wordt ook used in,

public class FinancialPartyBankAccountSaveAction extends BoundSaveAction {

	public void validate() throws Exception {
		super.validate();

		Collection myFields = new ArrayList(2);
		myFields.add("financialPartySystemId");
		myFields.add("currency");
...

public class FinancialPartyBankAccountCurrencyFieldValidator implements UniqueFieldListValidator {

	public boolean isUnique(HashMap arg0) {
		String aFinancialPartySystemId = (String) arg0.get("financialPartySystemId");
		int myFinancialPartySystemId = new Integer(aFinancialPartySystemId);
...

/ en in	,

$ vi file:///home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/module/invoice/war/invoice/jsp/financial-party-bank-account_edit.jsp 
						<mpo:numberField type="int" name="financialPartySystemId" hidden="true"/>

/ 13	,

$ vi file:///home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/module/invoice/war/invoice/jsp/financial-party-bank-account_edit.jsp 
						<mpo:numberField type="int" name="financialPartySystemId" hidden="true"/>

/ In chrome zien we een hidden value 28366...	, waar haalt hij deze vandaan	?

$ vi invoice-sitemap.xml
			<map:match type="regexp" pattern="^financial-party-bank-account_(edit|create)$">
				<map:act type="financialPartyBankAccountForm"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/financial-party-bank-account_edit.jsp"/>
			</map:match>

/ eerst komt de flow in , daarna in de jsp	,
public class FinancialPartyBankAccountFormAction extends AbstractAction {

	@Override
	public Map act() throws java.lang.Exception {

		int mySystemId = getSystemIdFromRequest();
		FinancialPartyBankAccountVO myVO;
		int myFinancialPartySystemId = getFinancialPartySystemIdFromRequest();

		if (mySystemId == 0) {
/ JA
			myVO = new FinancialPartyBankAccountVO();
			FinancialPartyVO myFinancialParty = MpoBeanFactory.getBean(FinancialPartyDAOInterface.class).getBySystemId(myFinancialPartySystemId);
			myVO.setFinancialPartyVO(myFinancialParty);

		} else {

			myVO = FinancialPartyBankAccountUtil.getDAO().getBySystemId(getSystemIdFromRequest());
		}
		getRequest().setAttribute("formVO", myVO);

/ In	,
file:///home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/module/invoice/war/invoice/jsp/financial-party-bank-account_edit.jsp 

			<mpo:setFormVO valueObject="${formVO}">
							<mpo:numberField type="int" name="financialPartySystemId" hidden="true"/>

/ en in  FinancialPartyBankAccountVO is de financialPartySystemId prop	,

/ Maar hoe werkt het precies	?

$ vi file:///home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/base-framework/core/src/java/com/mpobjects/view/taglib/form/SetFormVOTag.java 

/ TODO

/ 13	.


/ de appl is in jboss	,
[eric@localhost server]$ ls
all  default  dsvfms  minimal  mpo  mposcs  pnloms
[eric@localhost server]$ ls pnloms/
conf  data  deploy  lib  log  tmp  work
[eric@localhost server]$ ls pnloms/deploy/
bsh-deployer.xml                jboss-ha-local-jdbc.rar  jmx-invoker-service.xml      postgres-ds.xml
cache-invalidation-service.xml  jboss-ha-xa-jdbc.rar     jsr88-service.xml            postgres-ds.xml.bak
client-deployer-service.xml     jbossjca-service.xml     mail-ra.rar                  properties-service.xml
ear-deployer.xml                jboss-local-jdbc.rar     mail-service.xml             sqlexception-service.xml
ejb-deployer.xml                jbossweb-tomcat55.sar    management                   tms.jar
hsqldb-ds.xml                   jbossws14.sar            monitoring-service.xml       tms.war
http-invoker.sar                jboss-xa-jdbc.rar        mpo-management.sar           uuid-key-generator.sar
jboss-aop.deployer              jms                      mpo-schedule-service.xml
jboss-bean.deployer             jmx-console.war          pnloms-schedule-service.xml


/ de src code is in de eclipse workspacce	,
/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk

./module/invoice/src/java/com/mpobjects/invoice/model/financialpartybankaccount/dao/FinancialPartyBankAccountVO.standard.hbm.xml
./module/invoice/src/java/com/mpobjects/invoice/model/financialpartybankaccount/dao/FinancialPartyBankAccountDAO.java
./module/invoice/src/java/com/mpobjects/invoice/model/financialpartybankaccount/dao/FinancialPartyBankAccountDAOImpl.java
./module/invoice/src/java/com/mpobjects/invoice/model/financialpartybankaccount/util/FinancialPartyBankAccountUtil.java

./module/invoice/src/java/com/mpobjects/invoice/control/financialpartybankaccount/action/FinancialPartyBankAccountSaveAction.java
./module/invoice/src/java/com/mpobjects/invoice/control/financialpartybankaccount/action/FinancialPartyBankAccountDeleteAction.java
./module/invoice/src/java/com/mpobjects/invoice/control/financialpartybankaccount/action/FinancialPartyBankAccountFormAction.java
./module/invoice/src/java/com/mpobjects/invoice/control/financialpartybankaccount/action/FinancialPartyBankAccountCurrencyFieldValidator.java

./module/invoice/war/invoice/jsp/financial-party-bank-account_edit.jsp

./module/invoice/war/WEB-INF/tags/invoice/financialparty-
financialparty-associatedparties.tag  financialparty-bankaccount.tag        financialparty-costtype.tag

./base-framework/core/src/java/com/mpobjects/view/taglib/form/FormTag.java
./base-framework/core/src/java/core-service.sb.xml

/ 13	.

/ tags	,

/ Lees	,
http://www.tutorialspoint.com/jsp/jsp_custom_tags.htm

$ vi file:///home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/module/invoice/war/invoice/jsp/financial-party-bank-account_edit.jsp 

<%@taglib uri="http://www.mp-objects.com/taglibs/mpo" prefix="mpo"%>
<%@taglib tagdir="/WEB-INF/tags/core/" prefix="ctf"%>

<ctf:page title="bankAccountEdit" type="form">
	<ctf:pageHeader>
	        <link href="../lookandfeel/styles/style.css" rel="stylesheet" />
	        <script type="text/javascript" src="../m_script/oms/country-selector.js"></script>
	</ctf:pageHeader>
	<ctf:pageBody>
		<mpo:form>
			<mpo:setFormVO valueObject="${formVO}">
				<div id="financialPartyBankAccountFirst">
					<fieldset><legend><mpo:label name="bank" /></legend>
						<table>
							<mpo:numberField type="int" name="financialPartySystemId" hidden="true"/>

[eric@localhost trunk]$ find $(find -name WEB-INF) -name core
./base-framework/core/war/WEB-INF/tags/core
[eric@localhost trunk]$ ls $(find $(find -name WEB-INF) -name core)
pageBody.tag  pageHeader.tag  page.tag  userLoginBody.tag

[eric@localhost trunk]$ ls $(dirname $(find -name SetFormVOTag.java))
BooleanFieldTag.java        FieldTag.java                 LinkTag.java                  SetFormVOTag.java
ButtonTag.java              FileFieldTag.java             ListChildTag.java             SupplierListFieldTag.java
DataFetchable.java          fileupload.properties         ListFieldTag.java             TextFieldTag.java
DateFieldTag.java           FormTagBase.java              ManyToManyRelationTag.java    TimeFieldTag.java
DayOfMonthFieldTag.java     FormTag.java                  MonthFieldTag.java            TimeZoneFieldTag.java
DayOfWeekFieldTag.java      IndexedDropDownFieldTag.java  NumberFieldTag.java           UserFieldTag.java
DropDownFieldTag.java       IndexedFieldTag.java          RowCheckBoxTag.java           util
DropDownOptionListTag.java  IndexedListFieldTag.java      RowMarkerTag.java             VolumeFieldTag.java
DropDownOptionTag.java      IndexedNumberFieldTag.java    ScheduleBooleanFieldTag.java
DurationFieldTag.java       IndexedTextFieldTag.java      ScheduleTextFieldTag.java

$ vi ./base-framework/core/war/WEB-INF/tld/mpo.tld

<taglib>
...
        <tag>
                <name>setFormVO</name>
                <tagclass>com.mpobjects.view.taglib.form.SetFormVOTag</tagclass>
...



/ 13	.

/ we hebben create	,
$ vi FinancialPartyBankAccountVO.standard.hbm.xml  
...

		<property name="code" column="account_number" not-null="true"/>
/ not-null OK	, ook als in column die constraint er niet is: H guards if insert value is not null	,
		
		<many-to-one name="countryVO" column="country_systemid"/>
/ countryVO is entity	, dat zie je omdat er een Country,standard.hbm.xml is	,

/ Einde SAMENVATTING


/ Einde MPO TICKETS ISB-244

/ MPO STRUCTURE

/ Bij ISB-244 waren we in module/invoice	,
/ Bij SCS-4513  waren we in module/oms	,

[eric@localhost trunk]$ ls module/invoice/src/java/com/mpobjects/invoice
control  dao  model  service  util  view

[eric@localhost trunk]$ ls module/oms/src/java/com/mpobjects/oms/
applicationresponse  control  entity     model     service       shipmentitem   util  xml
carrierrequest       dao      exception  resource  serviceorder  shipmentorder  view



/ Einde MPO STRUCTURE

[eric@localhost trunk]$ ls module/oms/src//java/com/mpobjects/oms
applicationresponse  control  entity     model     service       shipmentitem   util  xml
carrierrequest       dao      exception  resource  serviceorder  shipmentorder  view

/ MPO TICKETS SCS-4513

/ configuration, master data, inco terms
/ we zien incoterm.IncoTermPage	,

$ vi ./module/oms/src/java/com/mpobjects/oms/view/wicket/incoterm/IncoTermPage.java
public class IncoTermPage extends EvoEditPage<IncoTermVO> {

/ er is geen IncoTermPage.html	,

$ vi ./module/oms/src/java/com/mpobjects/oms/view/wicket/enumeratedvo/EvoEditPage.java
...
$ vi ./module/oms/src/java/com/mpobjects/oms/view/wicket/enumeratedvo/EvoEditPage.html
...

/ Net zo	,
$ vi ./module/oms/src/java/com/mpobjects/oms/view/wicket/messagereport/MessagePage.java
public class MessagePage extends VOEditPage<Message> {

/ 7	.

/ we zien de hierarchy	,

MessagePage
VOEditPage
VOSelectPage
VOListPage
BaseContextPage
BasePage
WebPage				/ wicket
Page				/ wicket
MarkupContainer			/ wicket
Component			/ wicket
Object				/ Java

MessageEditFormPage
VOEditFormPage
BaseContextPage
BasePage
WebPage				/ wicket
Page				/ wicket
MarkupContainer			/ wicket
Component			/ wicket
Object				/ Java


trunk/module/oms/src/java/com/mpobjects/oms/model/entity/alertmessaging/Message.java 

trunk/module/oms/src/java/com/mpobjects/oms/view/wicket/messagereport/MessagePage.java 
trunk/module/oms/src/java/com/mpobjects/oms/view/wicket/vocode/VOEditPage.java 
trunk/module/oms/src/java/com/mpobjects/oms/view/wicket/vocode/VOEditPage.html 

trunk/module/oms/src/java/com/mpobjects/oms/dao/alertmessaging/Message.standard.hbm.xml 

trunk/module/oms/src/java/com/mpobjects/oms/view/wicket/messagereport/MessageEditFormPage.java 
trunk/module/oms/src/java/com/mpobjects/oms/view/wicket/messagereport/MessageEditFormPage.html

trunk/module/oms/src/java/com/mpobjects/oms/view/wicket/alertmessaging/MessageTabEditPanel.java 
trunk/module/oms/src/java/com/mpobjects/oms/view/wicket/alertmessaging/MessageTabEditPanel.html 

trunk/module/oms/src/java/com/mpobjects/oms/view/wicket/alertmessaging/MessageReportTabPanel.java 

trunk/module/oms/src/java/com/mpobjects/oms/view/wicket/vocode/VOEditFormPage.html 
trunk/module/oms/src/java/com/mpobjects/oms/view/wicket/vocode/VOEditFormPage.java 
trunk/module/oms/src/java/com/mpobjects/oms/view/wicket/vocode/VOEditPanel.java 
trunk/module/oms/src/java/com/mpobjects/oms/view/wicket/vocode/VOEditPanel.html

/ 7	.

Daemon Thread [http-0.0.0.0-8080-3] (Suspended (breakpoint at line 39 in MessagePage))	
	MessagePage.createPage() line: 39	
	MessagePage(VOListPage<T>).<init>() line: 52	
	MessagePage(VOSelectPage<T>).<init>() line: 21	
	MessagePage(VOEditPage<T>).<init>() line: 78	
	MessagePage.<init>() line: 22	
	NativeConstructorAccessorImpl.newInstance0(Constructor, Object[]) line: not available [native method]	
	NativeConstructorAccessorImpl.newInstance(Object[]) line: 57	
	DelegatingConstructorAccessorImpl.newInstance(Object[]) line: 45	
	Constructor<T>.newInstance(Object...) line: 526	
	DefaultPageFactory.createPage(Constructor<Page>, PageParameters) line: 192	
	DefaultPageFactory.newPage(Class<C>, PageParameters) line: 97	
	BaseHomePage.doRedirect() line: 63	
	BaseHomePage.<init>() line: 27	
...

/ So createPage is called here	,
	public VOListPage() {
		super();
		daoWrapper = getBeanWrapper();
		setDataProperties();
		createPage();


/ 7	.

$ vi trunk/module/oms/src/java/com/mpobjects/oms/view/wicket/messagereport/MessagePage.java 

	@Override
	protected void createPage() {
...
		editPage = new MessageEditFormPage(this, daoWrapper, dataProperties);
	}

	@Override
	protected void setDataProperties() {
...
		dataProperties.setDescriptionMaxLength(225); 		// !

$ vi trunk/module/oms/src/java/com/mpobjects/oms/view/wicket/messagereport/MessageEditFormPage.java 

	public void setEditRecord(Message aEntity) {
...
		myMessageReportTabPanel = new MessageReportTabPanel("messageReporTab", model, dataProperties, callback);


$ vi trunk/module/oms/src/java/com/mpobjects/oms/view/wicket/alertmessaging/MessageReportTabPanel.java 



VOSelectPage

1234567890123456789012345678901234567890
1234567890123456789012345678901234567890
1234567890123456789012345678901234567890
1234567890123456789012345678901234567890
1234567890123456789012345678901234567890



/ Einde MPO TICKETS SCS-4513

/ ISB-770

/ Als we switch van instance, moeten we in de src's application.properties	,
#base.product = pnloms
base.product = isbscs
/ Dit moeten we dus steeds doen	, 

/ In een instance hebben we postgres-ds.xml	, deze hoeven  maar 1 keer te edit	,
[eric@localhost server]$ vi isbscs/deploy/postgres-ds.xml

[eric@localhost server]$ cp -a pnloms/ isbscs

/ in eclipse in trunk	
$ vi application.properties
base.product = isbscs

/ server config	,
/ cp en fill in Server name, Server configuration(= jboss server instance)	, beide isbscs	,

[eric@localhost Spring]$ pg_dump -U eric -Fc -h mposerv8 isbscs -f  isbscs.dump
Password: <domain password>
[eric@localhost Spring]$ psql -U mpopostgres pnloms
Password for user mpopostgres: mpopostgres@mpo
psql (9.3.5)
Type "help" for help.

pnloms=# create database isbscs;
CREATE DATABASE
pnloms=# \q

[eric@localhost Backup]$ pg_restore -U mpopostgres -d isbscs isbscs.dump

/ we log in als all-admin	, en maken user eric, rtdMpo45	,
/ in configuration, administration, user config	,
/ edit all-admin, copy, en fill in 	,
/ nu kunnen we login met eric	,

/ In isbscs kan hij de sources niet vinden	, 
/ click op add...
/ Kies Java project, trunk
/ OK

/ 7	.

			<map:match pattern="shipment-order_list">
				<map:act type="shipmentOrderList"/>			
				<map:call resource="dynatablePage">
					<map:parameter name="xsp" value="xsp/shipment-order_list.xml"/>
				</map:call>
			</map:match>

			<map:match pattern="shipment-order_edit">
				<map:act type="shipmentOrderEdit">
					<map:select type="session-attribute">
						<map:parameter name="attribute-name" value="builder"/>
						<map:when test="jsp">
							<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order_edit.jsp"/>
						</map:when>
						<map:otherwise>
							<map:redirect-to uri="../wicket?module=oms&amp;wicketpage=shipmentorder.edit.ShipmentOrderEditSelectionPage"/>
						</map:otherwise>			
					</map:select>
				</map:act>
			</map:match>

/ 13	. 

/ Lees	,
http://wicket.apache.org/guide/guide/keepControl.html#keepControl_9

<wicket:enclosure> 
    <label>Total amount: </label><span wicket:id="totalAmount"></span>
</wicket:enclosure>
 
Now if component totalAmount is not visible, its description (Total amount:) will be automatically hidden.
/ component is een wicket comp	,

/ 13	.

/ Het form staat in	,
file:///home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/module/oms/src/java/com/mpobjects/oms/view/wicket/shipmentorder/edit/standard/ShipmentOrderEditPanel.java 
file:///home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/module/oms/src/java/com/mpobjects/oms/view/wicket/shipmentorder/edit/standard/ShipmentOrderEditPanel.html	,

/ 13	. 

	ShipmentOrderEditSelectionPage.<init>() line: 21	
	ShipmentOrderEditSelectionPage(AbstractMainPage).<init>() line: 32	
	ShipmentOrderEditSelectionPage(AbstractPage).<init>() line: 38	
		initializePage();

	ShipmentOrderEditSelectionPage(AbstractMainPage).initializePage() line: 54	
	ShipmentOrderEditSelectionPage(AbstractPage).initializePage() line: 78	
	ShipmentOrderEditSelectionPage.createPageComponents() line: 33	
			AbstractShipmentOrderPanel myPanel = myBuilder.build(null, myShipmentOrder, "editPanel");

	StandardShipmentOrderPanelBuilder.build(BasePage, ShipmentOrderVO, String) line: 20	
		IModel<ShipmentOrderVO> myModel = new EntityDetachableModel<ShipmentOrderVO>(aShipmentOrder, ShipmentOrderDao.class);
		return new ShipmentOrderMainPanel(aPage, anId, myModel);

	ShipmentOrderMainPanel.<init>(BasePage, String, IModel<ShipmentOrderVO>) line: 102	

invoicelist=Invoice list

/ In 
ShipmentOrderMainPanel$1(GenericFormPanel<T>).createPanel(GenericCompountPropertyModel<T>) line: 138	

		AbstractActionsPanel<T> actionPanel = getActionsPanel("actionPanel", model);
actionPanel	BaseActionBuilder$EntityActionPanel  (id=16307)	

/ dan	,
public class BaseActionBuilder<T extends EntityInterface> implements Serializable {
	protected class EntityActionPanel extends AbstractActionsPanel<T> {
		public EntityActionPanel(String aId, BaseWebComponent aParent, WebComponentEventSwitchBoard aWebComponentEventSwitchBoard, IModel<T> aModel) {
...
			RepeatingView view = new RepeatingView("actions");
			add(view);
			createActions(view, aModel);


/ en	,
$ vi EntityActionPanel.html

wicket:panel>
	<span wicket:id="actions"></span>
	<wicket:child />
</wicket:panel>

	protected void createActions(RepeatingView view, IModel<T> aModel) {
		for (EntityAction<T> action : actions) {

/ we zien dat actions	,
this	EntityFormActionBuilder<T>  (id=17106)	
	actions	ArrayList<E>  (id=17111)	
		elementData	Object[10]  (id=17113)	
			[0]	ShipmentOrderMainPanel$2  (id=17114)	
			[1]	ShipmentOrderMainPanel$3  (id=17115)	
			[2]	ShipmentOrderMainPanel$4  (id=17116)	
			[3]	ShipmentOrderMainPanel$5  (id=17117)	
			[4]	ShipmentOrderMainPanel$6  (id=17118)	
			[5]	EntityActionDropDown<T>  (id=17119)	
		modCount	6	
		size	6	
view	RepeatingView  (id=17109)	
aModel	GenericCompountPropertyModel<T>  (id=17110)	

$ vi ShipmentOrderMainPanel.java

/ we komen in	,
Daemon Thread [http-0.0.0.0-8080-6] (Suspended (breakpoint at line 116 in ShipmentOrderMainPanel))	
	ShipmentOrderMainPanel.getActions() line: 116	
	ShipmentOrderMainPanel.<init>(BasePage, String, IModel<ShipmentOrderVO>) line: 101	
->		EntityFormActionBuilder<ShipmentOrderVO> myActionBuilder = new EntityFormActionBuilder<ShipmentOrderVO>(getActions());
		editPanel = new ShipmentOrderEditPanel("editPanel", switchBoard, myActionBuilder, daoWrapper) {

	StandardShipmentOrderPanelBuilder.build(BasePage, ShipmentOrderVO, String) line: 20	
	ShipmentOrderEditSelectionPage.createPageComponents() line: 33	
	ShipmentOrderEditSelectionPage(AbstractPage).initializePage() line: 78	
	ShipmentOrderEditSelectionPage(AbstractMainPage).initializePage() line: 54	
	ShipmentOrderEditSelectionPage(AbstractPage).<init>() line: 38	
	ShipmentOrderEditSelectionPage(AbstractMainPage).<init>() line: 32	
	ShipmentOrderEditSelectionPage.<init>() line: 21	
...

[eric@localhost trunk]$ vi ./base-framework/core/src/java/com/mpobjects/view/wicket/util/actions/AbstractEntityActionButton\$EntityABPanel.html

<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:wicket="http://wicket.apache.org/dtds.data/wicket-xhtml1.4-strict.dtd">
<body>
        <wicket:panel>
                <button wicket:id="button"><span wicket:id="label"></span></button>
        </wicket:panel>
</body>
</html>


[eric@localhost trunk]$ vi ./base-framework/core/conf/language_en.properties
...
saveandclose = Save and close
save = Save
cancel = Cancel
add = Add

/ 7	.

public abstract class AbstractEntityActionButton<T> implements Serializable {
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new Button(aId) {
...
			@Override
			public void onSubmit() {
				AbstractEntityActionButton.this.onSubmit(this, aModel);
			}
		};
	}

/ Hier zien we dus dat de normale Wicket's Butto.onSubmit()  wordt def	, en calls AbstractEntityActionButton.this.onSubmit(this, aModel);	, dus EntityActionButton, AbstractEntityActionButton is geen Wicket Button	,

/ 7	. 

/ new ResourceModel("unplan") is een IModel<String>	,

/ 7	.

/ ShipmentOrcerMainPanel.java	,

	protected Collection<EntityAction<ShipmentOrderVO>> getActions() {
		List<EntityAction<ShipmentOrderVO>> myActionList = new ArrayList<EntityAction<ShipmentOrderVO>>();
...

//////////////////////////////////
/ removed:
		EntityActionDropDown<ShipmentOrderVO> myActionDropDown = new EntityActionDropDown<ShipmentOrderVO>();
		myActionDropDown.addOption(new DropDownOption<ShipmentOrderVO>(new ResourceModel("attachedFiles")) {
			@Override
			public void action(IModel<ShipmentOrderVO> aModel) {
				ShipmentOrderVO myOrder = aModel.getObject();
				getRequestCycle().setRequestTarget(
						new RedirectRequestTarget("../document/file-object_list_shipment-order_" + myOrder.getSystemId() + "?refresh=true"));
			}
		});

		myActionDropDown.addOption(new DropDownOption<ShipmentOrderVO>(new ResourceModel("unplan")) {
			@Override
			public void action(IModel<ShipmentOrderVO> aModel) {
				ShipmentOrderVO myOrder = aModel.getObject();
				getRequestCycle().setRequestTarget(
						new RedirectRequestTarget("../oms/shipment-order-unplan-actions?base_sessionLevelOffset=1&shipmentorder_systemid="
								+ myOrder.getSystemId()));
				getSession().info(new StringResourceModel("unplanMessage", ShipmentOrderMainPanel.this, aModel, "${code} unplanned").getString());
			}
		});

		myActionDropDown.addOption(new DropDownOption<ShipmentOrderVO>(new ResourceModel("recalculate")) {
			@Override
			public void action(IModel<ShipmentOrderVO> aModel) {
				ShipmentOrderVO myOrder = aModel.getObject();
				getRequestCycle()
						.setRequestTarget(
								new RedirectRequestTarget(
										"../ratecalc/rate_agreement_selection_execute?agreement-type=shipment_order&ratecalcDoRecalculation=true&base_sessionLevelOffset=1&refresh=true&systemId="
												+ myOrder.getSystemId()));
			}
		});

		myActionList.add(myActionDropDown);

	<input type="button" data-dropdown="#customerinvoiceaction-1" value="invoice..." />
	<div id="customerinvoiceaction-1" class="dropdown dropdown-tip">
		<ul class="dropdown-menu">
				<li>
				<a href="#" wicket:id="createLink">Create</a>
				</li>
			<li>
			<a href="#" wicket:id="listLink">List</a>
			</li>
		</ul>
	</div>

/ removed,	
//////////////////////////////////

/ De icons zijn in module mpolookandfeel	,

[eric@localhost trunk]$ ls module/mpolookandfeel/war/mpolookandfeel/styles/icons/small/
add.png                clear.png              edit.png               gear_recalculate.png   ok.png                 send.png
arrow_down_blue.png    column_add_after.png   error.png              help.png               pdfdoc.png             settings.png
arrow_left_green.png   column_add_before.png  excel.png              info.png               print.png              time.png
arrow_right_green.png  column_delete.png      export1.png            lookup_match.png       refresh.png            warning.png
arrow_up_green.png     contract.png           filter_clear.png       lookup.png             row_add_after.png      window.png
bullet_ball_green.png  copy.png               filter.png             money.png              row_add_before.png     windows.png
calendar.png           delete.png             folder_closed.png      new.png                row_delete.png         worddoc.png
cancel.png             documents.png          folder.png             office-building.png    search.png             

/ de src files zijn in module oms	,

[eric@localhost trunk]$ ls module/oms/src/java/com/mpobjects/oms/view/wicket/shipmentorder/edit/standard/
ShipmentOrderEditPanel.html  ShipmentOrderMainPanel.html  ShipmentOrderTabPanel.html
ShipmentOrderEditPanel.java  ShipmentOrderMainPanel.java  StandardShipmentOrderPanelBuilder.java

[eric@localhost trunk]$ cp ~/Downloads/unplan.png base-framework/core/war/core/styles/icons/small/ 
[eric@localhost trunk]$ cp ~/Downloads/listInvoice.png base-framework/core/war/core/styles/icons/small/


$ vi cores.css

.icon_invoicelist {
	background-image: url(icons/small/invoicelist.png);
}
.icon_invoicelist {
	background-image: url(icons/small/unplan.png);
}

/ DEBUG

/ stack 	, verkeerd om dus	,

	EntityFormActionBuilder<T>(BaseActionBuilder<T>).createActions(RepeatingView, IModel<T>) line: 75	
		for (EntityAction<T> action : actions) {
/**			Component component = action.createComponent(view.newChildId(), aModel);

	BaseActionBuilder$EntityActionPanel.<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, IModel<T>) line: 34	
	EntityFormActionBuilder<T>.build(String, GenericCompountPropertyModel<T>, WebComponentEventSwitchBoard, GenericFormPanel<T>) line: 37	
	ShipmentOrderMainPanel$1(GenericFormPanel<T>).getActionsPanel(String, GenericCompountPropertyModel<T>) line: 153	
	ShipmentOrderMainPanel$1(GenericFormPanel<T>).createPanel(GenericCompountPropertyModel<T>) line: 136	
	ShipmentOrderMainPanel$1(GenericFormPanel<T>).<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, T, FormActionsPanelBuilder<T>, BeanWrapper<BaseDAOInterface<T>>) line: 68	
...
		createPanel(new GenericCompountPropertyModel<T>(myObject));

	ShipmentOrderMainPanel$1(ShipmentOrderEditPanel).<init>(String, WebComponentEventSwitchBoard, EntityFormActionBuilder<ShipmentOrderVO>, BeanWrapper<BaseDAOInterface<ShipmentOrderVO>>) line: 67	
	ShipmentOrderMainPanel$1.<init>(ShipmentOrderMainPanel, String, WebComponentEventSwitchBoard, EntityFormActionBuilder, BeanWrapper) line: 102	
/*		EntityFormActionBuilder<ShipmentOrderVO> myActionBuilder = new EntityFormActionBuilder<ShipmentOrderVO>(getActions());
/ D
		editPanel = new ShipmentOrderEditPanel("editPanel", switchBoard, myActionBuilder, daoWrapper) {
			@Override
			public List<Decorator<ShipmentOrderVO>> getDecorators() {
				return ShipmentOrderMainPanel.this.getDecorators();
			}
		};

	protected Collection<EntityAction<ShipmentOrderVO>> getActions() {
		List<EntityAction<ShipmentOrderVO>> myActionList = new ArrayList<EntityAction<ShipmentOrderVO>>();
		EntityActionButton<ShipmentOrderVO> saveBtn = new EntityActionButton<ShipmentOrderVO>("ok", new ResourceModel("save")) {
...
	ShipmentOrderMainPanel.<init>(BasePage, String, IModel<ShipmentOrderVO>) line: 102	
	StandardShipmentOrderPanelBuilder.build(BasePage, ShipmentOrderVO, String) line: 20	
	ShipmentOrderEditSelectionPage.createPageComponents() line: 33	
	ShipmentOrderEditSelectionPage(AbstractPage).initializePage() line: 78	
	ShipmentOrderEditSelectionPage(AbstractMainPage).initializePage() line: 54	
	ShipmentOrderEditSelectionPage(AbstractPage).<init>() line: 38	
	ShipmentOrderEditSelectionPage(AbstractMainPage).<init>() line: 32	
	ShipmentOrderEditSelectionPage.<init>() line: 21	

/ we zijn bij **	,
/ Bij * wordt  create	,
this	EntityFormActionBuilder<T>  (id=14122)	
	actions	ArrayList<E>  (id=14123)	
		elementData	Object[10]  (id=14124)	
			[0]	ShipmentOrderMainPanel$2  (id=251)	
				behavior	AbstractEntityActionButton$ButtonBehavior$3  (id=294)	
				button	null	
				buttonType	"ok" (id=262)	
				defaultFormProcessing	true	
				label	ResourceModel  (id=250)	
				smallButton	false	
				this$0	ShipmentOrderMainPanel  (id=231)	
			[1]	ShipmentOrderMainPanel$3  (id=313)	
				behavior	AbstractEntityActionButton$ButtonBehavior$3  (id=294)	
				button	null	
				buttonType	"ok" (id=262)	
				defaultFormProcessing	true	
				label	ResourceModel  (id=14129)	
				smallButton	false	
				this$0	ShipmentOrderMainPanel  (id=231)	
			[2]	ShipmentOrderMainPanel$4  (id=314)	
			[3]	ShipmentOrderMainPanel$5  (id=315)	
			[4]	ShipmentOrderMainPanel$6  (id=316)	
			[5]	EntityActionDropDown<T>  (id=317)	
		modCount	6	
		size	6	
/ we zien nog geen Wicket componenten	,

/ nu bij **	,
			Component component = action.createComponent(view.newChildId(), aModel);
/s
ShipmentOrderMainPanel$2(EntityActionButton<T>).createComponent(String, IModel<T>) line: 49	
	public Component createComponent(String aComponentId, IModel<T> aModel) {
aComponentId	"1" (id=14246)	
aModel	GenericCompountPropertyModel<T>  (id=14148)	
	id	0	
	target	ShipmentOrderVO  (id=14642)	
/ See boek(93)	, voor de children	,	 die ... uit de ShipmentOrderVO halen	,

		return new EntityABPanel(aComponentId, createButton(aModel, "button"));
/s
ShipmentOrderMainPanel$2(AbstractEntityActionButton<T>).createButton(IModel<T>, String) line: 207	
		button = createButtonInstance(aModel, aId);
/ wicket button	,
		if (label != null) {
			button.add(new AttributeModifier("title", true, label));
/ label =ResourceModel	,

/t
ShipmentOrderMainPanel$2(EntityActionButton<T>).createComponent(String, IModel<T>) line: 49	
		return new EntityABPanel(aComponentId, createButton(aModel, "button"));
/s
AbstractEntityActionButton$EntityABPanel.<init>(String, Button) line: 58	
	public static class EntityABPanel extends Panel {
		public EntityABPanel(String aId, Button aButton) {
			super(aId);
			add(aButton);
[MarkupContainer [Component id = button]]

/t
	protected void createActions(RepeatingView view, IModel<T> aModel) {
		for (EntityAction<T> action : actions) {
			Component component = action.createComponent(view.newChildId(), aModel);
/d
aModel	GenericCompountPropertyModel<T>  (id=14148)	
			if (component != null) {
				view.add(component);

/ volgende for loop	,

/ t
/ de laatste is geen button	,
EntityActionDropDown<T>.createComponent(String, IModel<T>) line: 68	
		return new EntityADDPanel(aComponentId, aModel, options);
/s
EntityActionDropDown$EntityADDPanel.<init>(String, IModel, List<DropDownOption>) line: 30	
	super(aId)	/ wicket comp	, Panel	,




/ Einde DEBUG






 



/ Einde ISB-770

/ ISB-279

/ als we een nieuwe line add to existing booking N0000637	, dan lazy init exc	,
/ maar 3 tegelijk bijv aan een nieuwe booking id gaat wel	,

$ vi InvoiceMultiLineSaveAction.java

	public void handleSave() throws Exception {
			Collection myInvoiceHeaderDetailList = new ArrayList();
			myInvoiceHeaderDetailList = InvoiceHeaderUtil.getInvoiceHeaderService().getInvoiceHeaderDetailList(myVO.getSystemId());

				for (Iterator iter = myInvoiceHeaderDetailList.iterator(); iter.hasNext();) {


	public void validate() throws Exception {
		super.validate();

		int myInvoiceHeaderSystemId = Integer.parseInt(getRequestParameter("invoiceHeaderSystemId"));

		InvoiceHeaderVO myInvoiceHeaderVO = InvoiceHeaderUtil.getDAO().getInvoiceHeader(myInvoiceHeaderSystemId);

$ vi InvoiceHeaderUtil.java 

	public static InvoiceHeaderDAO getDAO() {
		return MpoBeanFactory.getBean(InvoiceHeaderDAO.class);
	}
	public static SupplierInvoiceService getInvoiceHeaderService() {
		return MpoBeanFactory.getBean(SupplierInvoiceService.class);
	}

$ vi invoice-dao.sb.xml

	<bean id="com.mpobjects.invoice.model.invoiceheader.dao.InvoiceHeaderDAO" class="com.mpobjects.invoice.model.invoiceheader.dao.InvoiceHeaderDAOImpl" parent="HibernateDAOTemplate" />

$ vi invoice-service.sb.xml

	<bean id="com.mpobjects.invoice.service.supplierinvoice.SupplierInvoiceService" parent="transactionRequiredTemplate">
		<property name="target">
			<bean class="com.mpobjects.invoice.service.supplierinvoice.SupplierInvoiceServiceImpl">
				<property name="eventHandlerService" ref="com.mpobjects.oms.service.event.EventHandlerService" />				
				<property name="fileMetaDAO" ref="com.mpobjects.document.dao.filemeta.FileMetaDAO" />
				<property name="financialPartyDAO" ref="com.mpobjects.invoice.model.financialparty.dao.FinancialPartyDAOInterface" />
				<property name="financialPartyPartyBindingDAO" ref="com.mpobjects.invoice.dao.FinancialPartyPartyBindingDAO" />
				<property name="invoiceDetailDAO" ref="com.mpobjects.invoice.model.invoicedetail.dao.InvoiceDetailDAO" />
				<property name="invoiceHeaderDAO" ref="com.mpobjects.invoice.model.invoiceheader.dao.InvoiceHeaderDAO" />
				<property name="invoiceLineDAO" ref="com.mpobjects.invoice.model.invoiceline.dao.InvoiceLineDAO" />
				<property name="serviceOrderCostDAO" ref="com.mpobjects.oms.model.serviceordercost.dao.ServiceOrderCostDAO" />
				<property name="serviceOrderCostService" ref="com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostService" />
				<property name="serviceOrderDAO" ref="com.mpobjects.oms.dao.ServiceOrderDao" />
				<property name="vatPolicyDAO" ref="com.mpobjects.invoice.dao.vatpolicy.VatPolicyDAO" />
			</bean>
		</property>

$ vi  SupplierInvoiceServiceImpl.java
	@Override
	public Collection<InvoiceDetailVO> getInvoiceHeaderDetailList(int anInvoiceHeaderSystemId) {
		return invoiceDetailDAO.getInvoiceDetailList(anInvoiceHeaderSystemId);
	}

$ vi core-datasource.sb.xml

	<bean id="dataSource" class="org.springframework.jdbc.datasource.IsolationLevelDataSourceAdapter">
/ TODO


$ vi core-base.sb.xml
...



$ vi core-hibernate.sb.xml

	<bean abstract="true" id="transactioningAndRetryTemplate" parent="transactionRequiredTemplate">
...


$ vi core-base.sb.xml

	<bean abstract="true" id="transactionRequiredTemplate" class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
...

/ Dit is een Spring bean	,

$ vi InvoiceHeaderDAOImpl.java

public class InvoiceHeaderDAOImpl extends GenericHibernateDAO<InvoiceHeaderVO> implements InvoiceHeaderDAO {
	public List<InvoiceHeaderVO> getInvoiceHeaderList(Date aMinimalCreationDate, int aLimit) {
...

/ 7	. 

/ Neem bijv INV-34	,
/ click onder invoice-line op vergrootglas icon	,
/ we zien een lege table	, click op filter icon	,
/ we zien 1 order line verschijnen	, click op groene bolletje icon	, waarmee we de line openen, en de details zien	,
/ we zien de invoice line & de 3 details	,




/ DEBUG	,

/ INV-34	,


/ 7	,

/ als we finance, carrier invoice , search, 
InvoiceHeaderListAction(ListAction).act() line: 58	

/ welke entries we krijgen hangt af van het filter	,
/ als  we in het filter iets invullen , en geven enter, of click icon links, dan komen we weer in	,
InvoiceHeaderListAction(ListAction).act() line: 58	

/ 7	. 

/ we click op OK icon van inv-34	,

/ we komen in	,
InvoiceHeaderFormAction.act() line: 81	

		} else {
			myVO = InvoiceHeaderUtil.getDAO().getBySystemId(mySystemId);
/s
InvoiceHeaderDAOImpl(GenericHibernateDAO<Type>).getBySystemId(int) line: 282	
				return type.cast(getHibernateTemplate().load(type, aSystemId));

/ Intermezzo

/ In een andere situatie 	,

/t
...
PerformanceMeasurementAspect.measurePerformance(ProceedingJoinPoint) line: 70	
			myReturnValue = aProceedingJoinPoint.proceed();
myReturnValue	Resource  (id=16360)	
	description	"Eric J. Van der Velden" (id=16379)	
	systemId	27074281	
/t
RunAsLogoutFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 44	
			Authentication auth = SecurityContextHolder.getContext().getAuthentication();
/d

/ Einde Intermezzo

/t
InvoiceHeaderFormAction.act() line: 72	
			myVO = InvoiceHeaderUtil.getDAO().getBySystemId(mySystemId);
myVO	InvoiceHeaderVO  (id=16458)	

			List<CostTypeInvoiceMatchVO> myCostTypeInvoiceMatchList = MpoBeanFactory.getBean(CostTypeInvoiceMatchDAO.class).getCostTypesForInvoice( myVO.getSystemId());
[]
/ want	,
/s
CostTypeInvoiceMatchDAOImpl.getCostTypesForInvoice(int) line: 41	
		DetachedCriteria myCriteria = DetachedCriteria.forClass(CostTypeInvoiceMatchVO.class).add(Restrictions.eq("invoiceHeaderSystemId", aInvoiceId));
/ TODO
		return getHibernateTemplate().findByCriteria(myCriteria);

/ t
InvoiceHeaderFormAction.act() line: 81	
			InvoiceHeaderUtil.getInvoiceHeaderService().checkTotals(myVO);
/s
SupplierInvoiceServiceImpl.checkTotals(InvoiceHeaderVO) line: 283	
			Collection<InvoiceDetailVO> myInvoiceHeaderDetailList = getInvoiceHeaderDetailList(myVO.getSystemId());
/s
SupplierInvoiceServiceImpl.getInvoiceHeaderDetailList(int) line: 832	
		return invoiceDetailDAO.getInvoiceDetailList(anInvoiceHeaderSystemId);
...
/s
InvoiceDetailDAOImpl(BaseHibernateDAO<T>).executeSqlSelect(String, String, Collection<QueryParameter>, int, int) line: 211	
SELECT ID.* FROM INVOICE_DETAIL ID, INVOICE_LINE IL  WHERE ID.INVOICE_LINE_SYSTEMID= IL.SYSTEM_ID AND IL.INVOICE_HEADER_SYSTEMID = :invoiceHeaderSystemId AND ID.IS_DELETED  =0 AND IL.IS_DELETED =0

/t
SupplierInvoiceServiceImpl.checkTotals(InvoiceHeaderVO) line: 291	
			Collection<InvoiceDetailVO> myInvoiceHeaderDetailList = getInvoiceHeaderDetailList(myVO.getSystemId());
/d

/ 7	. 

/ we click 'Create mode: click new page'	,
InvoiceMultiLineFormAction.act() line: 47	

/ 7	.

/ we komen op add detail form	,
/ fill in one row	,
/ click Save
InvoiceMultiLineSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	
...
				Map myMap = act();
/s
InvoiceMultiLineSaveAction(AbstractSaveAction).act() line: 64	
		validate();
			handleSave();




/ 7	.

 we click  "Edit mode"	,
/s
InvoiceMultiLineFormAction.act() line: 59	

		if (getSession().getAttribute(HEADER_ID_ATT_NAME) != null) {
			theInvoiceHeaderSystemId = (Integer) getSession().getAttribute(HEADER_ID_ATT_NAME);
27073143
/ Klopt	,
isbscs=# select*from invoice_header where system_id=27073143;
...
		InvoiceLineVO lastInvoiceLine = InvoiceLineUtil.getDAO().getLastInvoiceLine(theInvoiceHeaderSystemId);
/s
InvoiceLineDAOImpl.getLastInvoiceLine(int) line: 265	

		List myList = getHibernateTemplate().findByCriteria(
				DetachedCriteria.forClass(InvoiceLineVO.class).add(Property.forName("invoiceHeaderVO.systemId").eq(anInvoiceHeaderSystemId)) .add(Property.forName("deleted").eq(false)).addOrder(Order.desc("invoiceLineNumber")), 0, 1);

/ Intermezzo

/ In eclipse zoek je op Hibernate*Template	,
/ In UNIX grep 	,
[eric@localhost trunk]$    find -name "*.sb.xml" | xargs grep  'Hibernate.*Template'

$ vi invoice-dao.sb.xml

	<bean id="com.mpobjects.invoice.model.invoiceheader.dao.InvoiceHeaderDAO" class="com.mpobjects.invoice.model.invoiceheader.dao.InvoiceHeaderDAOImpl" parent="HibernateDAOTemplate" />

$ vi core-base.xml

	<bean id="HibernateDAOTemplate" abstract="true">
		<property name="sessionFactory" ref="sessionFactory" />

/ Einde Intermezzo

/t
InvoiceMultiLineFormAction.act() line: 60	
		InvoiceLineVO lastInvoiceLine = InvoiceLineUtil.getDAO().getLastInvoiceLine(theInvoiceHeaderSystemId);
/d
...
				totalItem = MpoBeanFactory.getBean(InvoiceDetailDAO.class).getInvoiceDetailCount(theInvoiceHeaderSystemId);
/s
InvoiceDetailDAOImpl.getInvoiceDetailCount(int) line: 74	
		return getInvoiceDetailList(aInvoiceSystemId).size();
/s
InvoiceDetailDAOImpl.getInvoiceDetailList(int) line: 114	
...
		return executeSqlSelect(mySQL.toString(), "ID", params);
/t
InvoiceMultiLineFormAction.act() line: 81	
			Collection myDetailList = MpoBeanFactory.getBean(InvoiceDetailDAO.class).getInvoiceDetailSubset(theInvoiceHeaderSystemId, startLimit, InvoiceMultiLineVO.NB_ITEMPAGE);
3

/t
InvoiceMultiLineFormAction.act() line: 120	
...
		getRequest().setAttribute("vatPolicy", myVO.getInvoiceHeaderVO().getVatPolicy().toCSV());
/s
InvoiceMultiLineVO.getInvoiceHeaderVO() line: 205	
			theInvoiceHeaderVO = InvoiceHeaderUtil.getDAO().getInvoiceHeader(theInvoiceHeaderSystemId);
/s
InvoiceMultiLineVO.getInvoiceHeaderVO() line: 206	
		return getBySystemId(aSystemId);
/s
InvoiceHeaderDAOImpl(GenericHibernateDAO<Type>).getBySystemId(int) line: 282	
				return type.cast(getHibernateTemplate().load(type, aSystemId));
/t
InvoiceMultiLineFormAction.act() line: 149	
		getRequest().setAttribute("vatPolicy", myVO.getInvoiceHeaderVO().getVatPolicy().toCSV());
/s
	public VatPolicy getVatPolicy() {
			theVatPolicyVO = MpoBeanFactory.getBean(VatPolicyDAO.class)
					.getBySystemId(theVatPolicySystemId);
/ LATER	,

/ 7	.

/click 'Create mode: add a new page	,
/s
InvoiceMultiLineFormAction.act() line: 47	
...

/ 7	.

/ we click op Save in het form	,

<input type="button" name="saveBtn" id="saveBtn" value="Save" onclick=" theEditFormFormManager.submit('../invoice/invoice-multiline_save', false, 0);">

/ we vallen in	,
InvoiceMultiLineSaveAction(AbstractSaveAction).act() line: 64	
				Map myMap = act();
/s
InvoiceMultiLineSaveAction.validate() line: 340	
...
		InvoiceHeaderVO myInvoiceHeaderVO = InvoiceHeaderUtil.getDAO().getInvoiceHeader(myInvoiceHeaderSystemId);
/ OK
/t
InvoiceMultiLineSaveAction(AbstractSaveAction).act() line: 69	
		validate();
/d
			handleSave();
/s
InvoiceMultiLineSaveAction.handleSave() line: 203	

/ Intermezzo

/ Te veel log lines	,

[eric@localhost Test]$ psql -U mpopostgres isbscs </home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/./module/oms/src/sql/patch/patch-465-order-validation-rule\$postgres.sql
Password for user mpopostgres: mpopostgres@mpo
CREATE TABLE
ALTER TABLE
ALTER TABLE
ALTER TABLE


[eric@localhost trunk]$ jstack 31560 |less

isbscs=# update cronjoblines set enabled=0 where task_class like '%EmptyServiceOrderCreationTask%';
UPDATE 1
isbscs=# update cronjoblines set enabled=0 where task_class like '%ScheduledCapacityBucketGeneratorTask%';
UPDATE 1
/ of	,
isbscs=# update cronjoblines set enabled=0;
# commit; 

localhost conf]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/isbscs/conf
[eric@localhost conf]$ vi log4j.xml

  <!-- This will show the hibernate queries -->
   <category name="org.hibernate.SQL" additivity="false">
            <priority value="INFO"/> <!-- DEBUG -->


  <category name="org.hibernate.cache" additivity="true"> <!-- false -->
    <priority value="INFO"/> <!-- DEBUG -->

   <category name="com.mpobjects.oms.model.logisticsorder.xml.LogisticsOrderBodyProcessor" additivity="false">
            <priority value="INFO"/> <!-- DEBUG -->

 <category name="com.mpobjects.util.concurrent">
        <priority value="INFO" /> <!-- DEBUG -->

  <category name="com.mpobjects.optimize">
      <priority value="INFO"/> <!-- DEBUG -->

 <category name="org.hibernate.type" additivity="true"> <!-- false -->
            <priority value="INFO"/> <!-- TRACE -->

# Interval (in ms) between updates, WAS 120000
module.preload.update.service.interval=12000000



/ Einde Intermezzo

/ Intermezzo

$ vi ./module/preload/preload.properties

# Delay (in ms) before the first batch update is performed (after application start)
module.preload.update.service.delay=15000
# Interval (in ms) between updates, WAS 120000
module.preload.update.service.interval=12000000



/ Einde Intermezzo


/ 7	. 

/ Hoe bug	?

/ 13	. 

/ we click 'Create mode: add a new page'	,

InvoiceMultiLineFormAction.act() line: 59	
/s
InvoiceMultiLineSaveAction.handleSave() line: 203	

/ Dus in InvoiceMultiLineSaveAction.handleSave	,


59		InvoiceLineVO lastInvoiceLine = InvoiceLineUtil.getDAO().getLastInvoiceLine(theInvoiceHeaderSystemId);
lastInvoiceLine	InvoiceLineVO  (id=14757)	
	invoiceDetails	PersistentSet  (id=14758)	

105 		lastInvoiceDetail = MpoBeanFactory.getBean(InvoiceDetailDAO.class).getLastInvoiceDetail(lastInvoiceLine.getSystemId());
/s
		DetachedCriteria myDetachedCriteria = DetachedCriteria.forClass(InvoiceDetailVO.class).add(
				Property.forName("invoiceLineVO.systemId").eq(aInvoiceLineSystemId));
27073144


111		myVO = new InvoiceMultiLineVO(lastInvoiceLine, lastInvoiceDetail);
/s
InvoiceMultiLineVO.<init>(InvoiceLineVO, InvoiceDetailVO) line: 116	
			setLastLineDB(theLastInvoiceLine);
/s
InvoiceMultiLineVO.setLastLineDB(InvoiceLineVO) line: 473	
		LAST_DB = aLine.getInvoiceLineNumber();
		theLastLineDB = aLine;
/t
			setLastDetailDB(theLastInvoiceDetail);

isbscs=# select*from invoice_line where system_id=27073144;
 system_id |      create_date       | user_systemid | invoice_header_systemid | logistics_order_reference | match_status_systemid | service_order_syst emid | shipment_order_systemid | is_deleted | remark | matching_error_code | invoice_pod_status | invoice_recharge_status | carrier_reference | line_n umber | recharge_mark_number | recharge_date | pod_remark | volume | weight | pay_weight | loading_meters | volume_uom | weight_uom | pay_weight_uom | loading_meters_uom | container_count | order_process_systemid 
  27073144 | 2014-11-04 11:58:09.25 |      27063471 |                27073143 | N0001568                  |                     1 |               2707
3090 |                         |          0 |        |                     | UNKNOWN            | INITIAL                 |                   |       
   10 |                      |               |            |        |        |            |                |            |            |                |
 
/ Dus invoice line N0001568	,
/ TODO

/ 13	.

/ Wanneer in een service bean	?

/ 1313

/ we zijn op Invoice Header scherm, we hadden in filter inv-34 	, we click groene icon	,

			SupplierInvoiceServiceImpl.checkTotals(InvoiceHeaderVO) line: 283	

			NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
			NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
			DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
			Method.invoke(Object, Object...) line: 606	
			AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
			ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
			ReflectiveMethodInvocation.proceed() line: 150	
			TransactionInterceptor$1.proceedWithInvocation() line: 96	
			TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
			TransactionInterceptor.invoke(MethodInvocation) line: 94	
			ReflectiveMethodInvocation.proceed() line: 172	
			JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
			$Proxy339.checkTotals(InvoiceHeaderVO) line: not available	

			InvoiceHeaderFormAction.act() line: 81	


/ we zien inderdaad dat er een transactie is create op deze service method	,

/ in de code	,
InvoiceHeaderFormAction.act() line: 81	
			InvoiceHeaderUtil.getInvoiceHeaderService().checkTotals(myVO);

$ vi InvoiceHeaderUtil.java
	public static InvoiceHeaderDAO getDAO() {
		return MpoBeanFactory.getBean(InvoiceHeaderDAO.class);
	}
	public static SupplierInvoiceService getInvoiceHeaderService() {
		return MpoBeanFactory.getBean(SupplierInvoiceService.class);
	}

/s
SupplierInvoiceServiceImpl.checkTotals(InvoiceHeaderVO) line: 425	
				save(myVO);
/s
SupplierInvoiceServiceImpl.save(InvoiceHeaderVO) line: 1018	
		InvoiceHeaderVO myOldInvoiceHeader = getOld(anInvoiceHeader);
/s
SupplierInvoiceServiceImpl.getOld(InvoiceHeaderVO) line: 1554	



/ Intermezzo

/ Finance, Carrier invoice, search
InvoiceHeaderListAction(ListAction).act() line: 58	

/ filter inv-34
InvoiceHeaderListAction(ListAction).act() line: 58	

/ edit deze inv	,
InvoiceHeaderFormAction.act() line: 44	
/s
SupplierInvoiceServiceImpl.checkTotals(InvoiceHeaderVO) line: 283	/ tx'd service
...
/ en meerdere calls op SupplierInvoiceServiceImpl methods	, allen in dezelfde tx	,

/ click 'Create mode: add a new page'	, 
InvoiceMultiLineFormAction.act() line: 47	

/ save multiline form	,
InvoiceMultiLineSaveAction(AbstractSaveAction).act() line: 64	


SupplierInvoiceServiceImpl
SupplierInvoiceService
InvoiceMultiLineSaveAction
InvoiceHeaderFormAction

/ HIER HIER



	



/ Einde Intermezzo











/ Intermezzo

/ Transactions on dao's	,

$ vi core-base.sb.xml
	<!-- Enable processing of @Transactional annotations application wide -->
	<tx:annotation-driven transaction-manager="transactionManager" />


$ vi BaseHibernateDAO.java 

@Transactional
public abstract class BaseHibernateDAO<T> extends HibernateDaoSupport {

/ Daarom zien we een tx op de dao call in een cocoon act fct hierboven	, InvoiceLineUtil.getDAO().getLastInvoiceLine


/ Einde Intermezzo

/ Intermezzo

/ we fill in form inv-34 in en click filter icon	,

/ er wordt maar 1 query gedaan	,

/ we komen in,	
InvoiceHeaderView.executeDynaQuery(DynaQuery) line: 28	
/s
			return InvoiceHeaderUtil.getDAO().executeDynaQuery(aQuery);
...
/s
InvoiceHeaderDAOImpl(BaseHibernateDAO<T>).executeSqlSelect(String, String, Collection<QueryParameter>, int, int) line: 211	
...



/ Dit is Cocoon XSP	, 
$ vi invoice-header_list.xml

		<dynatable:populate>
			<xsp:logic>
				InvoiceHeaderView myView = new InvoiceHeaderView();
...





/ Einde Intermezzo

/ Intermezzo

/ Transactions on services	,

/ 13	. 

$ vi core-base.sb.xml

	<bean id="sessionFactory" class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean" lazy-init="true">
...
		<property name="mappingResources">
			<ref bean="hibernateMappingFiles" />
		</property>
		<property name="annotatedClasses">
			<ref bean="hibernateAnnotatedClasses" />
		</property>

/ De andere manier met <tx:advice/> wordt door ons niet used	, 

	<tx:advice id="defaultTransactionAdvice" transaction-manager="transactionManager">
		<tx:attributes>
			<!-- common read actions -->
			<tx:method name="load*" propagation="SUPPORTS" isolation="REPEATABLE_READ" rollback-for="Exception" />

/ 13	.

$ vi invoice-dao.sb.xml

	<bean id="com.mpobjects.invoice.model.invoiceheader.dao.InvoiceHeaderDAO" class="com.mpobjects.invoice.model.invoiceheader.dao.InvoiceHeaderDAOImpl" parent="HibernateDAOTemplate" />

$ vi  core-base.sb.xml

	<bean id="sessionFactory" class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean" lazy-init="true">
		<property name="dataSource" ref="dataSource" />
...
	<bean id="HibernateDAOTemplate" abstract="true">
		<property name="sessionFactory" ref="sessionFactory" />
...

$ vi core-datasource.sb.xml

	<bean id="dataSource" class="org.springframework.jdbc.datasource.IsolationLevelDataSourceAdapter">
		<property name="targetDataSource">
			<bean class="org.springframework.jndi.JndiObjectFactoryBean">
				<property name="jndiName" value="${datasource.name}" />

$ vi isbscs.properties
datasource.name=java:/tmsdevDS

/ in jboss	, 
$ vi server/isbscs/deploy/postgres-ds.xml
<datasources>
        <xa-datasource>
                <jndi-name>tmsdevDS</jndi-name>
... 

$ vi build-app.xml

	<hibernateMappingFiles basedir="${basedir}/.."
	                       includes="**/*.hbm.xml"
	                       outputFile="${build.war.dir}/WEB-INF/classes/generate-mappings.xml"
	                       HibernateMappingXsl="${basedir}/buildscripts/xsl/hibernate/hibernate-mappings.xsl">
		<mapper refid="module-hbm-mapper" />
	</hibernateMappingFiles>

	<hibernateAnnotatedClasses basedir="${basedir}/.."
	                           outputFile="${build.war.dir}/WEB-INF/classes/generated-annotated-classes.xml"
	                           HibernateAnnotatedClassesXsl="${basedir}/buildscripts/xsl/hibernate/hibernate-annotated-classes.xsl">
		<mapper refid="module-annotated-class-mapper" />
	</hibernateAnnotatedClasses>

$ applications.properties
build.war.dir = /home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/${base.product}/deploy/tms.war/
/ Daar zien we	,
generate-mappings.xml
generated-annotated-classes.xml

[eric@localhost jboss-4.0.5.GA]$ vi server/isbscs/deploy/tms.war/WEB-INF/classes/generate-mappings.xml 
<beans>
<bean id="hibernateMappingFiles" class="com.mpobjects.util.dao.HibernateMappingFiles">
<constructor-arg>
<list>
...
<value>com/mpobjects/oms/dao/Consignment.standard.hbm.xml</value>
<value>com/mpobjects/oms/dao/customerorder/CustomerOrder.standard.hbm.xml</value>

$ vi Consignment.standard.hbm.xml

<hibernate-mapping>
	<class name="com.mpobjects.oms.model.consignment.vo.ConsignmentVO"
		table="CONSIGNMENT" lazy="true">
...

[eric@localhost jboss-4.0.5.GA]$ vi server/isbscs/deploy/tms.war/WEB-INF/classes/generated-annotated-classes.xml 

<beans>
<bean id="hibernateAnnotatedClasses" class="com.mpobjects.util.dao.HibernateAnnotatedClasses">
<constructor-arg>
<list>
<value>com.mpobjects.oms.model.entity.CustomerOrder</value>
...
/ TODO

package com.mpobjects.oms.model.service;
public class ServiceOrderServiceImpl implements ServiceOrderService {

package com.mpobjects.oms.dao.shipmentorder;
public class ShipmentOrderDaoImpl extends AbstractMonitoringDashboardEntityDAO<ShipmentOrderVO> implements ShipmentOrderDao {
com.mpobjects.oms.dao.shipmentorder.ShipmentOrderDaoImpl



/ Einde Intermezzo

/ Intermezzo

/ Lees	,
http://www.baeldung.com/hibernate-4-spring
http://www.beingjavaguys.com/2014/05/spring4-hibernate4-integration.html

/ de AnnotationSessionFactoryImpl zit nu in spring-orm.jar	,

/ Einde Intermezzo

/ Intermezzo

/ Lees	,
http://stackoverflow.com/questions/1079114/spring-transactional-annotation-best-practice


/ 
/ Einde Intermezzo

/ we waren in	,
		List myList = getHibernateTemplate().findByCriteria(
				DetachedCriteria.forClass(InvoiceLineVO.class).add(Property.forName("invoiceHeaderVO.systemId").eq(anInvoiceHeaderSystemId))
						.add(Property.forName("deleted").eq(false)).addOrder(Order.desc("invoiceLineNumber")), 0, 1);

isbscs=# select*from invoice_line where invoice_header_systemid =27073143;

 system_id |      create_date       | user_systemid | invoice_header_systemid | logistics_order_reference | match_status_systemid | service_order_systemid | shipment_order_systemid | is_deleted | remark | matching_error_code | invoice_pod_status | invoice_recharge_status | carrier_reference | line_number | recharge_mark_number | recharge_date | pod_remark | volume | weight | pay_weight | loading_meters | volume_uom | weight_uom | pay_weight_uom | loading_meters_uom | container_count | order_process_systemid 
...
  27073144 | 2014-11-04 11:58:09.25 |      27063471 |                27073143 | N0001568                  |                     1 |               2707
3090 |                         |          0 |        |                     | UNKNOWN            | INITIAL                 |                   |       
   10 |                      |               |            |        |        |            |                |            |            |                |
                    |                 |                       
(1 row)

/t
InvoiceMultiLineFormAction.act() line: 60	
		InvoiceLineVO lastInvoiceLine = InvoiceLineUtil.getDAO().getLastInvoiceLine(theInvoiceHeaderSystemId);
/d
		String editType = (String) getRequest().getAttribute("edit-type");
...
			if (getSession().getAttribute("totalItem") == null) {
				totalItem = MpoBeanFactory.getBean(InvoiceDetailDAO.class).getInvoiceDetailCount(theInvoiceHeaderSystemId);
3
/ want	,
/s
InvoiceDetailDAOImpl.getInvoiceDetailCount(int) line: 74	
		return getInvoiceDetailList(aInvoiceSystemId).size();
/s
SQLQueryImpl(SELECT ID.* FROM INVOICE_DETAIL ID, INVOICE_LINE IL  WHERE ID.INVOICE_LINE_SYSTEMID= IL.SYSTEM_ID AND IL.INVOICE_HEADER_SYSTEMID = :invoiceHeaderSystemId AND ID.IS_DELETED  =0 AND IL.IS_DELETED =0)
/ TODO

/t
			Collection myDetailList = MpoBeanFactory.getBean(InvoiceDetailDAO.class).getInvoiceDetailSubset(theInvoiceHeaderSystemId, startLimit, InvoiceMultiLineVO.NB_ITEMPAGE);
/s
InvoiceDetailDAOImpl.getInvoiceDetailSubset(int, int, int) line: 132	
...
/t
myDetailList	ArrayList<E>  (id=14998)	
...

		getRequest().setAttribute("vatPolicy", myVO.getInvoiceHeaderVO().getVatPolicy().toCSV());
...
/s
InvoiceMultiLineVO.getInvoiceHeaderVO() line: 206	
	public InvoiceHeaderVO getInvoiceHeaderVO() {
		if (theInvoiceHeaderSystemId != VOLATILE_SYSTEM_ID && theInvoiceHeaderVO == null) {
			theInvoiceHeaderVO = InvoiceHeaderUtil.getDAO().getInvoiceHeader(theInvoiceHeaderSystemId);
/s
public abstract class InvoiceHeaderUtil {

	public static InvoiceHeaderDAO getDAO() {
		return MpoBeanFactory.getBean(InvoiceHeaderDAO.class);
	}

/t
...
/s
InvoiceMultiLineVO.getInvoiceHeaderVO() line: 206	
			theInvoiceHeaderVO = InvoiceHeaderUtil.getDAO().getInvoiceHeader(theInvoiceHeaderSystemId);
/s
InvoiceHeaderDAOImpl.getInvoiceHeader(int) line: 69	
		return getBySystemId(aSystemId);
/s
InvoiceHeaderDAOImpl(GenericHibernateDAO<Type>).getBySystemId(int) line: 286	
				return type.cast(getHibernateTemplate().load(type, aSystemId));
type	Class<T> (com.mpobjects.invoice.model.invoiceheader.vo.InvoiceHeaderVO) (id=10520)	
aSystemId	27073143	
/t
/s
InvoiceHeaderVO.getVatPolicy() line: 544	
this	InvoiceHeaderVO  (id=15049)	
		return theVatPolicyVO;
/t

/ 7	.

Internal Server Error

Message: failed to lazily initialize a collection of role: com.mpobjects.oms.model.user.Resource.userOrganizations, no session or session was closed

Description: org.apache.cocoon.ProcessingException: Sitemap: error when calling sub-sitemap at <map:mount> - file:/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/isbscs/./deploy/tms.war/sitemap.xmap:28:119

Sender: org.apache.cocoon.servlet.CocoonServlet

Source: Cocoon Servlet

cause

org.hibernate.LazyInitializationException: failed to lazily initialize a collection of role: com.mpobjects.oms.model.user.Resource.userOrganizations, no session or session was closed
full exception chain stacktrace

org.apache.cocoon.ProcessingException: Sitemap: error when calling sub-sitemap
	at <map:mount> - file:/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/isbscs/./deploy/tms.war/sitemap.xmap:28:119
	at org.apache.cocoon.ProcessingException.throwLocated(ProcessingException.java:113)
	at org.apache.cocoon.components.treeprocessor.sitemap.MountNode.invoke(MountNode.java:122)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177)
	at org.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:253)
	at org.apache.cocoon.Cocoon.process(Cocoon.java:699)
	at org.apache.cocoon.servlet.CocoonServlet.service(CocoonServlet.java:1154)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:810)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at com.mpobjects.control.filter.FirstLoginFilter.doFilter(FirstLoginFilter.java:76)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:330)
	at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:118)
	at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:84)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:113)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:103)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:113)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:154)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:45)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:199)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:110)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at com.mpobjects.auth.springsec.RunAsLogoutFilter.doFilter(RunAsLogoutFilter.java:41)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.context.SecurityContextPersistenceFilter.doFilter(SecurityContextPersistenceFilter.java:87)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:192)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:160)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:343)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:260)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at filters.SetCharacterEncodingFilter.doFilter(SetCharacterEncodingFilter.java:111)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:230)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at org.jboss.web.tomcat.filters.ReplyHeaderFilter.doFilter(ReplyHeaderFilter.java:96)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)
	at org.jboss.web.tomcat.security.SecurityAssociationValve.invoke(SecurityAssociationValve.java:175)
	at org.jboss.web.tomcat.security.JaccContextValve.invoke(JaccContextValve.java:74)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)
	at org.jboss.web.tomcat.tc5.jca.CachedConnectionValve.invoke(CachedConnectionValve.java:156)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)
	at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)
	at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)
	at org.apache.tomcat.util.net.MasterSlaveWorkerThread.run(MasterSlaveWorkerThread.java:112)
	at java.lang.Thread.run(Thread.java:745)
Caused by: org.hibernate.LazyInitializationException: failed to lazily initialize a collection of role: com.mpobjects.oms.model.user.Resource.userOrganizations, no session or session was closed
	at org.hibernate.collection.AbstractPersistentCollection.throwLazyInitializationException(AbstractPersistentCollection.java:383)
	at org.hibernate.collection.AbstractPersistentCollection.throwLazyInitializationExceptionIfNotConnected(AbstractPersistentCollection.java:375)
	at org.hibernate.collection.AbstractPersistentCollection.initialize(AbstractPersistentCollection.java:368)
	at org.hibernate.collection.AbstractPersistentCollection.read(AbstractPersistentCollection.java:111)
	at org.hibernate.collection.PersistentSet.iterator(PersistentSet.java:186)
	at com.mpobjects.oms.model.user.Resource.loadOrganizations(Resource.java:882)
	at com.mpobjects.oms.model.user.Resource.getActiveOrganization(Resource.java:249)
	at com.mpobjects.oms.model.user.Resource.loadMappedProperties(Resource.java:935)
	at com.mpobjects.oms.model.user.Resource.getUserProperty(Resource.java:572)
	at com.mpobjects.oms.model.user.Resource.getProperty(Resource.java:501)
	at com.mpobjects.oms.model.user.Resource.getProperty(Resource.java:490)
	at com.mpobjects.core.ApplicationPropertyManager.getProperty(ApplicationPropertyManager.java:523)
	at com.mpobjects.core.ApplicationPropertyManager.getModuleProperty(ApplicationPropertyManager.java:367)
	at com.mpobjects.control.action.AbstractAction.act(AbstractAction.java:227)
	at org.apache.cocoon.components.treeprocessor.sitemap.ActTypeNode.invoke(ActTypeNode.java:125)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.HandleErrorsNode.invoke(HandleErrorsNode.java:89)
	at org.apache.cocoon.components.treeprocessor.sitemap.ErrorHandlerHelper.prepareErrorHandler(ErrorHandlerHelper.java:182)
	at org.apache.cocoon.components.treeprocessor.sitemap.ErrorHandlerHelper.prepareErrorHandler(ErrorHandlerHelper.java:135)
	at org.apache.cocoon.components.treeprocessor.sitemap.ErrorHandlerHelper.invokeErrorHandler(ErrorHandlerHelper.java:108)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:100)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177)
	at org.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:253)
	at org.apache.cocoon.components.treeprocessor.sitemap.MountNode.invoke(MountNode.java:118)
	... 67 more
Request URI

/ 7	.

/ we kunnen met J! icon onder Breakpoints een b set op LazyInitializationException	,
/ we vallen dan in	,
PersistentSet(AbstractPersistentCollection).throwLazyInitializationException(String) line: 383	


/ SAMENVATTING ISB-279

/ 7	.

InvoiceMultiLineFormAction.act() line: 60	
		InvoiceLineVO lastInvoiceLine = InvoiceLineUtil.getDAO().getLastInvoiceLine(theInvoiceHeaderSystemId);

lastInvoiceLine	InvoiceLineVO  (id=14147)	
	invoiceDetails	PersistentSet  (id=14148)	
/ Lege set	,

		} else {
				lastInvoiceDetail = MpoBeanFactory.getBean(InvoiceDetailDAO.class).getLastInvoiceDetail(lastInvoiceLine.getSystemId());
			}
			myVO = new InvoiceMultiLineVO(lastInvoiceLine, lastInvoiceDetail);
/ s
			setLastLineDB(theLastInvoiceLine);
			setLastDetailDB(theLastInvoiceDetail);





/ Het WAS zo	, dat dan later	,

InvoiceMultiLineSaveAction.handleSave()
							invoiceLine = myVO.getLastLineDB();
						invoiceLine.addInvoiceDetail(myDetail);
/ Lazy init exc	,

/ we hebben deze code uit InvoiceMultiLineSaveAction.handleSave gehaald, en set in SupplierInvoiceServiceImpl.saveMultiLine	, 


/ 7	.

public class InvoiceMultiLineSaveAction extends BoundSaveAction implements NonScreenAction {
	public void handleSave() throws Exception {
...

public class SupplierInvoiceServiceImpl extends InvoiceServiceImpl implements SupplierInvoiceService {
	public void saveMultiLine(int myInvoiceHeaderSystemId, String myRepairInvoice, InvoiceMultiLineVO myVO) throws Exception {
		...
		invoiceLine = getInvoiceLineDAO().getBySystemId(myVO.getLastLineDB().getSystemId());

public class InvoiceLineDAOImpl extends GenericHibernateDAO<InvoiceLineVO> implements InvoiceLineDAO {
	public InvoiceLineVO getLastInvoiceLine(int anInvoiceHeaderSystemId) {
		List myList = getHibernateTemplate().findByCriteria(
			DetachedCriteria.forClass(InvoiceLineVO.class)
				.add(Property.forName("invoiceHeaderVO.systemId").eq(anInvoiceHeaderSystemId)) 
				.add(Property.forName("deleted").eq(false))
				.addOrder(Order.desc("invoiceLineNumber")), 0, 1);

public class GenericHibernateDAO<Type extends EntityInterface> extends BaseHibernateDAO<Type> implements HibernateDAOInterface<Type> {

	@Override
	public Type getBySystemId(int aSystemId) {
		...
		return type.cast(getHibernateTemplate().load(type, aSystemId));

/ 7	.
		List myList = getHibernateTemplate().findByCriteria(
			DetachedCriteria.forClass(InvoiceLineVO.class)
				.add(Property.forName("invoiceHeaderVO.systemId").eq(anInvoiceHeaderSystemId)) 
				.add(Property.forName("deleted").eq(false))
				.addOrder(Order.desc("invoiceLineNumber")), 0, 1);

/ geeft	,

select ... 
from INVOICE_LINE this_ 
left outer join TMS_USER resource2_ on this_.USER_SYSTEMID=resource2_.SYSTEM_ID 
left outer join TMS_USER resource3_ on resource2_.CREATED_BY=resource3_.SYSTEM_ID 
left outer join INVOICE_MATCH_STATUS invoicemat4_ on this_.MATCH_STATUS_SYSTEMID=invoicemat4_.SYSTEM_ID 
left outer join INVOICE_HEADER invoicehea5_ on this_.INVOICE_HEADER_SYSTEMID=invoicehea5_.SYSTEM_ID 
left outer join INVOICE_FINANCIAL_PARTY financialp6_ on invoicehea5_.FINANCIAL_PARTY_SYSTEMID=financialp6_.SYSTEM_ID 
left outer join INVOICE_FINANCIAL_PARTY financialp7_ on invoicehea5_.RECEIVER_SYSTEMID=financialp7_.SYSTEM_ID 
left outer join INVOICE_PAYMENT_BATCH paymentbat8_ on invoicehea5_.INVOICE_PAYMENT_BATCH_SYSTEMID=paymentbat8_.SYSTEM_ID 
left outer join ORGANIZATION organizati9_ on paymentbat8_.ORGANIZATION_SYSTEMID=organizati9_.SYSTEM_ID 
left outer join ORGANIZATION organizati10_ on organizati9_.ORGANIZATION_GROUP=organizati10_.SYSTEM_ID 
left outer join TMS_USER resource11_ on paymentbat8_.PAID_BY_USER_SYSTEMID=resource11_.SYSTEM_ID 
left outer join TMS_USER resource12_ on paymentbat8_.CREATED_BY_USER_SYSTEMID=resource12_.SYSTEM_ID 
left outer join TMS_USER resource13_ on paymentbat8_.VALIDATED_BY_USER_SYSTEMID=resource13_.SYSTEM_ID 
left outer join INVOICE_VAT_POLICY vatpolicy14_ on invoicehea5_.VAT_POLICY_SYSTEMID=vatpolicy14_.SYSTEM_ID 
left outer join ORGANIZATION organizati15_ on invoicehea5_.INVOICE_ORGANIZATION_ID=organizati15_.SYSTEM_ID 
left outer join ORGANIZATION organizati16_ on invoicehea5_.ORGANIZATION_SYSTEMID=organizati16_.SYSTEM_ID 
where this_.INVOICE_HEADER_SYSTEMID=?  and 
this_.IS_DELETED=? 
order by this_.LINE_NUMBER desc limit ? 

/ Hier staat een join	,
			DetachedCriteria.forClass(InvoiceLineVO.class)
				.add(Property.forName("invoiceHeaderVO.systemId").eq(anInvoiceHeaderSystemId)) 

$ vi InvoiceHeader.standard.hbm.xml

<hibernate-mapping>
	<class name="com.mpobjects.invoice.model.invoiceheader.vo.InvoiceHeaderVO" table="INVOICE_HEADER" lazy="false">


/ Dit is hem NIET	,

2014-12-05 13:05:21,687 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-3:) SELECT ID.* FROM INVOICE_DETAIL ID, INVOICE_LINE IL  WHERE ID.INVOICE_LINE_SYSTEMID= IL.SYSTEM_ID AND IL.INVOICE_HEADER_SYSTEMID = ? AND ID.IS_DELETED  =0 AND IL.IS_DELETED =0

/ 7	.

/ Wat zijn
    806 2014-12-05 13:06:47,450 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-2:) select this_.SYSTEM_ID as SYSTEM1_186_15_, this_.IS_DELETED as I...
   1024 2014-12-05 13:16:17,770 DEBUG [org.hibernate.SQL] (interfaceTriggerEventTimerFactory:) select this_.SYSTEM_ID as SYSTEM1_168_0_, this_.IN        TERFACE_ID as INTERFACE2_168_0_, this_.STATUS as STATUS168_0_, this_.EVENT_DATE as EVENT4_168_0_, this_.OBJECT_REFERENCE1 as OBJECT5_168_        0_, this_.OBJECT_REFERENCE2 as OBJECT6_168_0_, this_.OBJECT_REFERENCE3 as OBJECT7_168_0_, this_.OBJECT_REFERENCE4 as OBJECT8_168_0_, this        _.OBJECT_REFERENCE5 as OBJECT9_168_0_, this_.START_DTM as START10_168_0_, this_.END_DTM as END11_168_0_, this_.ERROR_STRING as ERROR12_16        8_0_ from INTERFACE_TRIGGER_EVENT this_ where this_.INTERFACE_ID=? and this_.STATUS=? and this_.EVENT_DATE between ? and ? order by this_        .EVENT_DATE asc limit ?
   1025 2014-12-05 13:16:25,368 DEBUG [org.hibernate.SQL] (Timer-2:) select userorgani0_.USER_SYSTEMID as USER1_86_1_, userorgani0_.USER_SYSTEMID         as USER1_1_, userorgani0_.ORGANIZATION_SYSTEMID as ORGANIZA2_1_, userorgani0_.USER_SYSTEMID as USER1_164_0_, userorgani0_.ORGANIZATION_S        YSTEMID as ORGANIZA2_164_0_, userorgani0_.IS_ACTIVE as IS3_164_0_, userorgani0_.IS_ACTIVE_ALLOWED as IS4_164_0_ from USER_ORGANIZATION us        erorgani0_ where userorgani0_.USER_SYSTEMID=?

$ vi interfacing-service.sb.xml

	<bean id="interfaceTriggerEventTimerFactory" class="org.springframework.scheduling.timer.TimerFactoryBean">
		<property name="scheduledTimerTasks">
			<list>
				<ref bean="interfaceTriggerEventManagerTask" />
			</list>
		</property>
	</bean>

/ 7	.

				lastInvoiceDetail = MpoBeanFactory.getBean(InvoiceDetailDAO.class).getLastInvoiceDetail(lastInvoiceLine.getSystemId());
/s
$ vi InvoiceDetailDAOImpl.java
...
	public InvoiceDetailVO getLastInvoiceDetail(int aInvoiceLineSystemId) {
		DetachedCriteria myDetachedCriteria = DetachedCriteria.forClass(InvoiceDetailVO.class).add(
				Property.forName("invoiceLineVO.systemId").eq(aInvoiceLineSystemId));
		myDetachedCriteria.addOrder(Order.desc("systemId"));
		List<InvoiceDetailVO> invoiceDetail = getHibernateTemplate().findByCriteria(myDetachedCriteria);

<hibernate-mapping>
	<class name="com.mpobjects.invoice.model.invoicedetail.vo.InvoiceDetailVO" lazy="false" table="INVOICE_DETAIL">
...

select ...
from INVOICE_DETAIL this_ 
left outer join INVOICE_MATCH_STATUS invoicemat2_ on this_.MATCH_STATUS_SYSTEMID=invoicemat2_.SYSTEM_ID 
left outer join RATE_COMPONENT_TYPE ratecompon3_ on this_.COST_TYPE_SYSTEMID=ratecompon3_.SYSTEM_ID 
where this_.INVOICE_LINE_SYSTEMID=? 
order by this_.SYSTEM_ID desc

/ 7	.

////////////////////////////////////////////
/ SERVICE TX COMMITS 

SupplierInvoiceServiceImpl.saveMultiLine(int, String, InvoiceMultiLineVO) line: 229	
						invoiceLine = getInvoiceLineDAO().getBySystemId(myVO.getLastLineDB().getSystemId());
/ HIER HIER
/ proxy, no query	,
						invoiceLine.addInvoiceDetail(myDetail);
/ queries coll	,

select ... 
from INVOICE_DETAIL invoicedet0_ 
left outer join INVOICE_MATCH_STATUS invoicemat1_ on invoicedet0_.MATCH_STATUS_SYSTEMID=invoicemat1_.SYSTEM_ID 
left outer join RATE_COMPONENT_TYPE ratecompon2_ on invoicedet0_.COST_TYPE_SYSTEMID=ratecompon2_.SYSTEM_ID 
where invoicedet0_.INVOICE_LINE_SYSTEMID=?

/ Intermezzo

public class InvoiceLineDAOImpl extends GenericHibernateDAO<InvoiceLineVO> implements InvoiceLineDAO {
	public InvoiceLineVO getLastInvoiceLine(int anInvoiceHeaderSystemId) {
		List myList = getHibernateTemplate().findByCriteria(
			DetachedCriteria.forClass(InvoiceLineVO.class)
				.add(Property.forName("invoiceHeaderVO.systemId").eq(anInvoiceHeaderSystemId)) 
				.add(Property.forName("deleted").eq(false))
				.addOrder(Order.desc("invoiceLineNumber")), 0, 1);

			myRet = (InvoiceLineVO) myList.get(0);


/ Einde Intermezzo

/ Bij afsluiten tx wordt ...
/ Terug naar 	,
InvoiceMultiLineSaveAction.handleSave() line: 59	
		InvoiceHeaderUtil.getInvoiceHeaderService().saveMultiLine(myInvoiceHeaderSystemId, myRepairInvoice, myVO);
/ Hier zitten we nu in 	, en als over, dan is tx closed	,  einde service tx	,

/ we zien in de log	,
insert into INVOICE_DETAIL (USER_SYSTEMID, CREATE_DATE, IS_DELETED, MATCH_STATUS_SYSTEMID, AMOUNT, AMOUNT_VAT, VAT_TARIF_TYPE, COST_TYPE_SYSTEMID, REMARK, MATCHING_ERROR_CODE, SURCHARGE_B        ASED, SURCHARGE_SYSTEMID, INVOICE_LINE_SYSTEMID, SYSTEM_ID) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
update INVOICE_DETAIL set INVOICE_LINE_SYSTEMID=? where SYSTEM_ID=?

////////////////////////////////////////////
/ SERVICE TX COMMITS 
/ 7	. 

/ we moeten de timezone aanpassen	,
$ sudo vi /var/lib/pgsql/data/postgresql.conf
...
localhost Book]$ sudo -i -u postgres pg_ctl reload

sbscs=# show timezone;
  TimeZone  
------------
 US/Eastern
(1 row)

isbscs=# select pg_timezone_names();
...

isbscs=# select current_time;
       timetz       
--------------------
 09:32:58.253799-05
(1 row)

/ 7	.

isbscs=# select*from invoice_detail where create_date>=(now());
 system_id |       create_date       | user_systemid | amount  | amount_vat | vat_tarif_type | invoice_line_systemid | cost_type_systemid | match_stat
us_systemid | remark | is_deleted | matching_error_code | surcharge_based | surcharge_systemid 
-----------+-------------------------+---------------+---------+------------+----------------+-----------------------+--------------------+-----------
------------+--------+------------+---------------------+-----------------+--------------------
  27074653 | 2014-12-05 14:16:02.197 |      27074281 | 8.00000 |    0.00000 | FREE           |              27073144 |           26600544 |           
          1 |        |          0 |                     |               0 |                   
  27074654 | 2014-12-05 14:22:35.508 |      27074281 | 3.00000 |    0.00000 | FREE           |              27073144 |           26600544 |           
          1 |        |          0 |                     |               0 |                   
  27074655 | 2014-12-05 14:27:14.562 |      27074281 | 2.00000 |    0.00000 | FREE           |              27073144 |           26600544 |           
          1 |        |          0 |                     |               0 |                   
  27074657 | 2014-12-05 14:45:08.77  |      27074281 | 6.00000 |    0.00000 | FREE           |              27073144 |           26600544 |           
          1 |        |          0 |                     |               0 |                   
(4 rows)

isbscs=# select*from invoice_line where system_id=27073144;
 system_id |      create_date       | user_systemid | invoice_header_systemid | logistics_order_reference | match_status_systemid | service_order_syst
emid | shipment_order_systemid | is_deleted | remark | matching_error_code | invoice_pod_status | invoice_recharge_status | carrier_reference | line_n
umber | recharge_mark_number | recharge_date | pod_remark | volume | weight | pay_weight | loading_meters | volume_uom | weight_uom | pay_weight_uom |
 loading_meters_uom | container_count | order_process_systemid 
-----------+------------------------+---------------+-------------------------+---------------------------+-----------------------+-------------------
-----+-------------------------+------------+--------+---------------------+--------------------+-------------------------+-------------------+-------
------+----------------------+---------------+------------+--------+--------+------------+----------------+------------+------------+----------------+
--------------------+-----------------+------------------------
  27073144 | 2014-11-04 11:58:09.25 |      27063471 |                27073143 | N0001568                  |                     1 |               2707
3090 |                         |          0 |        |                     | UNKNOWN            | INITIAL                 |                   |       
   10 |                      |               |            |        |        |            |                |            |            |                |
                    |                 |                       
(1 row)

isbscs=# select*from invoice_header where system_id=27073143;
 system_id |       create_date       | organization_systemid | currency_systemid | financial_party_systemid |    invoice_date     |  invoice_due_date 
  | invoice_number | invoice_organization_id | mark_number | receipt_date_copy | receipt_date_original | remark | total_invoice_amount_exc_vat | total
_invoice_amount_free_vat | total_invoice_amount_high_vat | total_invoice_amount_low_vat | total_invoice_amount_rev_vat | total_vat_amount_high | total
_vat_amount_low | user_systemid | vat_policy_systemid |                     warning_check_total                     | matching_error_code | invoice_pa
yment_batch_systemid | vat_number_sender | vat_number_receiver | country_sender_systemid | country_receiver_systemid | recharge_mark_number | recharge
_date | invoice_recharge_status | approvement_remarks | invoice_type | invoice_pod_status | carrier_total_amount_exc_vat | carrier_total_amount_inc_va
t | approvement_employee | match_run_number | register_employee | deblock_employee | invoice_header_status | document_systemid | receiver_systemid | i
nvoice_template_systemid 
-----------+-------------------------+-----------------------+-------------------+--------------------------+---------------------+-------------------
--+----------------+-------------------------+-------------+-------------------+-----------------------+--------+------------------------------+------
-------------------------+-------------------------------+------------------------------+------------------------------+-----------------------+------
----------------+---------------+---------------------+-------------------------------------------------------------+---------------------+-----------
---------------------+-------------------+---------------------+-------------------------+---------------------------+----------------------+---------
------+-------------------------+---------------------+--------------+--------------------+------------------------------+----------------------------
--+----------------------+------------------+-------------------+------------------+-----------------------+-------------------+-------------------+--
-------------------------
  27073143 | 2014-11-04 11:58:09.186 |                   500 |              7001 |                 26605102 | 2014-11-04 11:58:00 | 2014-11-04 00:00:0
0 | INV-34         |                     500 | INV-34      |                   |                       |        |                    100.00000 |      
               100.00000 |                       0.00000 |                      0.00000 |                      0.00000 |               0.00000 |      
        0.00000 |      27063471 |            26607045 | Total cost free not correct! Calculated:113.0              +|                     |           
                     | NL182882962B01    | 123456789           |                    4153 |                      4153 |                      |         
      | NOT_RECHARGED           |                     | SELF_BILL    | UNKNOWN            |                      0.00000 |                      0.0000
0 |                      |                  |                   |                  | INITIAL               |                   |          26628012 |  
...

isbscs=# select*from invoice_detail where invoice_line_systemid=27073144;
 system_id |       create_date       | user_systemid |  amount  | amount_vat | vat_tarif_type | invoice_line_systemid | cost_type_systemid | match_sta
tus_systemid | remark | is_deleted | matching_error_code | surcharge_based | surcharge_systemid 
-----------+-------------------------+---------------+----------+------------+----------------+-----------------------+--------------------+----------
-------------+--------+------------+---------------------+-----------------+--------------------
  27073146 | 2014-11-04 11:58:09.284 |      27063471 | 20.00000 |    0.00000 | FREE           |              27073144 |           26600544 |          
             |        |          0 |                     |               0 |                   
  27073521 | 2014-11-07 16:29:32.373 |         10100 | 50.00000 |    0.00000 | FREE           |              27073144 |           26604768 |          
           1 |        |          0 |                     |               0 |                   
  27073522 | 2014-11-07 16:31:39.401 |         10100 | 30.00000 |    0.00000 | FREE           |              27073144 |           27058861 |          
           1 |        |          0 |                     |               0 |                   
  27074653 | 2014-12-05 14:16:02.197 |      27074281 |  8.00000 |    0.00000 | FREE           |              27073144 |           26600544 |          
           1 |        |          0 |                     |               0 |                   
  27074654 | 2014-12-05 14:22:35.508 |      27074281 |  3.00000 |    0.00000 | FREE           |              27073144 |           26600544 |          
           1 |        |          0 |                     |               0 |                   
  27074655 | 2014-12-05 14:27:14.562 |      27074281 |  2.00000 |    0.00000 | FREE           |              27073144 |           26600544 |          
           1 |        |          0 |                     |               0 |                   
  27074657 | 2014-12-05 14:45:08.77  |      27074281 |  6.00000 |    0.00000 | FREE           |              27073144 |           26600544 |          
           1 |        |          0 |                     |               0 |                   
(7 rows)
/ Alle details op deze line	,


/ 7	.

/ we hadden errors in eclipse	,
/ we moesten naar module/ gaan	, en gaan naar	,
customerportal
	src
		java
/ right click , build path, use as source folder

/ Kijk nu bij 
Project
	properties
		Java Build Path
		

/ dan zien we customerportal erbij staan	,










/ Einde SAMENVATTING ISB-279

/ Einde ISB-279

/ ISB-279

/ 7	.

[eric@localhost forticlientsslvpn]$ forticlientsslvpn.bash 
...
[eric@localhost mpo]$ interstream-acceptance.bash 
h^Zgcyr&Q
[vanderveldene@interstream-acc ~]$ cd /local/apps/jboss-4.0.5.GA/server/isbscs/
[vanderveldene@interstream-acc isbscs]$ vi deploy/postgres-ds.xml 
                <xa-datasource-property name="DatabaseName">isbscs</xa-datasource-property>
                <xa-datasource-property name="User">mpopostgres</xa-datasource-property>
                <xa-datasource-property name="Password">mpopostgres@mpo</xa-datasource-property>

/ we hoeven alleen dit te read	, 
/ conn maken met de db server (dat is OOK interstream-acceptance)	, doen we vanaf laptop	,
[eric@localhost mpo]$ PGPASSWORD=mpopostgres@mpo psql -U mpopostgres -h  interstream-a.intermax.mp-objects.com isbscs
isbscs=# 







/ Einde ISB-279

/ SEO ISBSCS FROM-PARTY

/ 7	. 

/ we start local isbscs	, with isbscs2 db=application-acceptance db,

/ open seo N0000317	, 
/ OK
/ click Finance	,
/ ERR, want From-party ROT_3EP is unknown	,
3e Petroleumhaven

/ We gaan debug	, 

/ eerst open seo N0000317	, 
/ we search op 317	,
/ we zien service-order_edit	, als we over edit button hover	,

$ vi oms-sitemap.xmap
                        <map:match pattern="service-order_edit">
                                <map:act type="serviceOrderEdit"/>
                                <map:read mime-type="text/html" type="jsp" src="jsp/service-order_edit.jsp"/>
				...
                        </map:match>
/ en verderop	, 
                        <map:action logger="serviceorder" name="serviceOrderEdit" src="com.mpobjects.oms.control.serviceorder.action.ServiceOrderEditAction"/>

/ we komen in	,
ServiceOrderEditAction.act() line: 52	
				ServiceOrderVO myVO = getServiceOrderBAO().getServiceOrder(getSystemIdFromRequest());
/s
ServiceOrderServiceImpl.getServiceOrder(int) line: 765	
			ServiceOrderVO myRet = serviceOrderDAO.getBySystemId(aSystemId);
/s
RcaServiceOrderDAOImpl(GenericHibernateDAO).getBySystemId(int) line: 286	
				return type.cast(getHibernateTemplate().load(type, aSystemId));
/t
			ServiceOrderVO myRet = serviceOrderDAO.getBySystemId(aSystemId);
/d
/ uninitialized proxy	,
/t
				ServiceOrderVO myVO = getServiceOrderBAO().getServiceOrder(getSystemIdFromRequest());
/d
				Party myFrom = myVO.getFromPartyVO();
...


PartyTabPanel$1.getPanel(String) line: 86	
				return new PartyEditPanel(aPanel, aPartyModel, myValidCode, list);
/s
PartyEditPanel.<init>(String, IModel<Party>, String, List<Pair<String,IModel<Party>>>) line: 59	
		init(aPartyTypeGroup);
/s
PartyEditPanel$1.<init>(PartyEditPanel, String, IModel, String) line: 71	
		FullPartyFormField myPartyPanelField = new FullPartyFormField("party", new PropertyModel<Party>(this, "party"), aPartyTypeGroup) {
/s
PartyEditPanel$1(FullPartyFormField).<init>(String, IModel<Party>, String) line: 82	
		init();
/s
PartyEditPanel$1(FullPartyFormField).init() line: 185	
		if (myParty != null) {
			// Look up the code
			// TODO? make it configurable
			PartyVO myLookedUpParty = partyDao.getBean().findByCode(myParty.getCode());
/s
PartyDAOImpl.findByCode(String) line: 93	
		return getByCriteria(DetachedCriteria.forClass(PartyVO.class).add(Property.forName("partyId").eq(aPartyId)));
/s
	public Type getByCriteria(DetachedCriteria aDetachedCriteria) {




 

/ Einde SEO ISBSCS FROM-PARTY



/ ISB-778

Unexpected RuntimeException

WicketMessage: Error attaching this container for rendering: [MarkupContainer [Component id = shipmentOrderPricePartView]]

Root cause:

org.hibernate.ObjectNotFoundException: No row with the given identifier exists: [com.mpobjects.oms.model.shipmentorderpricepart.vo.ShipmentOrderPricePartVO#27075256]
     at org.hibernate.impl.SessionFactoryImpl$2.handleEntityNotFound(SessionFactoryImpl.java:435)
     at org.hibernate.event.def.DefaultLoadEventListener.load(DefaultLoadEventListener.java:233)
     at org.hibernate.event.def.DefaultLoadEventListener.proxyOrLoad(DefaultLoadEventListener.java:285)
     at org.hibernate.event.def.DefaultLoadEventListener.onLoad(DefaultLoadEventListener.java:152)
     at org.hibernate.impl.SessionImpl.fireLoad(SessionImpl.java:1090)
     at org.hibernate.impl.SessionImpl.internalLoad(SessionImpl.java:1038)
     at org.hibernate.type.EntityType.resolveIdentifier(EntityType.java:630)
     at org.hibernate.type.ManyToOneType.assemble(ManyToOneType.java:236)
     at org.hibernate.collection.PersistentSet.initializeFromCache(PersistentSet.java:147)
     at org.hibernate.cache.entry.CollectionCacheEntry.assemble(CollectionCacheEntry.java:58)
     at org.hibernate.event.def.DefaultInitializeCollectionEventListener.initializeCollectionFromCache(DefaultInitializeCollectionEventListener.java:159)
     at org.hibernate.event.def.DefaultInitializeCollectionEventListener.onInitializeCollection(DefaultInitializeCollectionEventListener.java:71)
     at org.hibernate.impl.SessionImpl.initializeCollection(SessionImpl.java:1863)
     at org.hibernate.collection.AbstractPersistentCollection.initialize(AbstractPersistentCollection.java:369)
     at org.hibernate.collection.AbstractPersistentCollection.read(AbstractPersistentCollection.java:111)
     at org.hibernate.collection.PersistentSet.iterator(PersistentSet.java:186)
     at com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO.getShipmentOrderPricePartByStatus(ShipmentOrderVO.java:1762)
     at java.lang.reflect.Method.invoke(Method.java:606)
     at org.hibernate.proxy.pojo.javassist.JavassistLazyInitializer.invoke(JavassistLazyInitializer.java:197)
     at com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO_$$_javassist_135.getShipmentOrderPricePartByStatus(ShipmentOrderVO_$$_javassist_135.java)
     at com.mpobjects.oms.view.wicket.shipmentorder.shipmentorderfinancialdetails.ShipmentOrderPriceListPanel$2.getObject(ShipmentOrderPriceListPanel.java:123)
     at com.mpobjects.oms.view.wicket.shipmentorder.shipmentorderfinancialdetails.ShipmentOrderPriceListPanel$2.getObject(ShipmentOrderPriceListPanel.java:1)
     at com.mpobjects.view.wicket.util.PropertyModelDataProvider.size(PropertyModelDataProvider.java:110)
     at org.apache.wicket.markup.repeater.data.DataViewBase.internalGetItemCount(DataViewBase.java:141)
     at org.apache.wicket.markup.repeater.AbstractPageableView.getItemCount(AbstractPageableView.java:258)
     at org.apache.wicket.markup.repeater.AbstractPageableView.getRowCount(AbstractPageableView.java:240)
     at org.apache.wicket.markup.repeater.AbstractPageableView.getViewSize(AbstractPageableView.java:352)
     at org.apache.wicket.markup.repeater.AbstractPageableView.getItemModels(AbstractPageableView.java:105)
     at org.apache.wicket.markup.repeater.RefreshingView.onPopulate(RefreshingView.java:94)
     at org.apache.wicket.markup.repeater.AbstractRepeater.onBeforeRender(AbstractRepeater.java:131)
     at org.apache.wicket.markup.repeater.AbstractPageableView.onBeforeRender(AbstractPageableView.java:121)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.extensions.markup.html.tabs.TabbedPanel.onBeforeRender(TabbedPanel.java:244)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.markup.html.form.Form.onBeforeRender(Form.java:2104)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Page.onBeforeRender(Page.java:1555)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.Component.prepareForRender(Component.java:2297)
     at org.apache.wicket.Page.prepareForRender(Page.java:1545)
     at org.apache.wicket.Component.prepareForRender(Component.java:2329)
     at org.apache.wicket.Page.renderPage(Page.java:912)
     at org.apache.wicket.protocol.http.WebRequestCycle.redirectTo(WebRequestCycle.java:201)
     at org.apache.wicket.request.target.component.PageRequestTarget.respond(PageRequestTarget.java:58)
     at org.apache.wicket.request.AbstractRequestCycleProcessor.respond(AbstractRequestCycleProcessor.java:105)
     at org.apache.wicket.RequestCycle.processEventsAndRespond(RequestCycle.java:1287)
     at org.apache.wicket.RequestCycle.step(RequestCycle.java:1358)
     at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1465)
     at org.apache.wicket.RequestCycle.request(RequestCycle.java:545)
     at org.apache.wicket.protocol.http.WicketFilter.doGet(WicketFilter.java:486)
     at org.apache.wicket.protocol.http.WicketServlet.doGet(WicketServlet.java:138)
     at javax.servlet.http.HttpServlet.service(HttpServlet.java:697)
     at javax.servlet.http.HttpServlet.service(HttpServlet.java:810)
     at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)
     at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
     at com.mpobjects.control.filter.FirstLoginFilter.doFilter(FirstLoginFilter.java:76)
     at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
     at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:330)
     at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:118)
     at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:84)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:113)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:103)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:113)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:154)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:45)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:199)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:110)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at com.mpobjects.auth.springsec.RunAsLogoutFilter.doFilter(RunAsLogoutFilter.java:41)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.context.SecurityContextPersistenceFilter.doFilter(SecurityContextPersistenceFilter.java:87)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:192)
     at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:160)
     at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:343)
     at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:260)
     at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
     at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
     at filters.SetCharacterEncodingFilter.doFilter(SetCharacterEncodingFilter.java:111)
     at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
     at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
     at org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:230)
     at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
     at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
     at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
     at org.jboss.web.tomcat.filters.ReplyHeaderFilter.doFilter(ReplyHeaderFilter.java:96)
     at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
     at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
     at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)
     at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:178)
     at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java)
     at org.jboss.web.tomcat.security.SecurityAssociationValve.invoke(SecurityAssociationValve.java:175)
     at org.jboss.web.tomcat.security.JaccContextValve.invoke(JaccContextValve.java:74)
     at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)
     at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)
     at org.jboss.web.tomcat.tc5.jca.CachedConnectionValve.invoke(CachedConnectionValve.java:156)
     at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)
     at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)
     at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)
     at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)
     at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)
     at org.apache.tomcat.util.net.MasterSlaveWorkerThread.run(MasterSlaveWorkerThread.java:112)
     at java.lang.Thread.run(Thread.java:745)

Complete stack:

org.apache.wicket.WicketRuntimeException: Error attaching this container for rendering: [MarkupContainer [Component id = shipmentOrderPricePartView]]
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1789)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.extensions.markup.html.tabs.TabbedPanel.onBeforeRender(TabbedPanel.java:244)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.markup.html.form.Form.onBeforeRender(Form.java:2104)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Page.onBeforeRender(Page.java:1555)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.Component.prepareForRender(Component.java:2297)
     at org.apache.wicket.Page.prepareForRender(Page.java:1545)
     at org.apache.wicket.Component.prepareForRender(Component.java:2329)
     at org.apache.wicket.Page.renderPage(Page.java:912)
     at org.apache.wicket.protocol.http.WebRequestCycle.redirectTo(WebRequestCycle.java:201)
     at org.apache.wicket.request.target.component.PageRequestTarget.respond(PageRequestTarget.java:58)
     at org.apache.wicket.request.AbstractRequestCycleProcessor.respond(AbstractRequestCycleProcessor.java:105)
     at org.apache.wicket.RequestCycle.processEventsAndRespond(RequestCycle.java:1287)
     at org.apache.wicket.RequestCycle.step(RequestCycle.java:1358)
     at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1465)
     at org.apache.wicket.RequestCycle.request(RequestCycle.java:545)
     at org.apache.wicket.protocol.http.WicketFilter.doGet(WicketFilter.java:486)

display page view

/ Of in test	,

Internal Error
2015-01-08T16:47:33.125+01:00
The application could not complete your action. Please try again. If you need support, please contact the support service responsible.
Error attaching this container for rendering: [MarkupContainer [Component id = shipmentOrderPricePartView]]
Show/hide error details
Error Details
Page class: com.mpobjects.oms.view.wicket.shipmentorder.shipmentorderfinancialdetails.ShipmentOrderFinancialPage
WicketMessage: Error attaching this container for rendering: [MarkupContainer [Component id = shipmentOrderPricePartView]]
Root cause:
org.hibernate.ObjectNotFoundException: No row with the given identifier exists: [com.mpobjects.oms.model.shipmentorderpricepart.vo.ShipmentOrderPricePartVO#27081020]
     at org.hibernate.impl.SessionFactoryImpl$2.handleEntityNotFound(SessionFactoryImpl.java:435)
     at org.hibernate.event.def.DefaultLoadEventListener.load(DefaultLoadEventListener.java:233)
     at org.hibernate.event.def.DefaultLoadEventListener.proxyOrLoad(DefaultLoadEventListener.java:285)
     at org.hibernate.event.def.DefaultLoadEventListener.onLoad(DefaultLoadEventListener.java:152)
     at org.hibernate.impl.SessionImpl.fireLoad(SessionImpl.java:1090)
     at org.hibernate.impl.SessionImpl.internalLoad(SessionImpl.java:1038)
     at org.hibernate.type.EntityType.resolveIdentifier(EntityType.java:630)
     at org.hibernate.type.ManyToOneType.assemble(ManyToOneType.java:236)
     at org.hibernate.collection.PersistentSet.initializeFromCache(PersistentSet.java:147)
     at org.hibernate.cache.entry.CollectionCacheEntry.assemble(CollectionCacheEntry.java:58)
     at org.hibernate.event.def.DefaultInitializeCollectionEventListener.initializeCollectionFromCache(DefaultInitializeCollectionEventListener.java:159)
     at org.hibernate.event.def.DefaultInitializeCollectionEventListener.onInitializeCollection(DefaultInitializeCollectionEventListener.java:71)
     at org.hibernate.impl.SessionImpl.initializeCollection(SessionImpl.java:1863)
     at org.hibernate.collection.AbstractPersistentCollection.initialize(AbstractPersistentCollection.java:369)
     at org.hibernate.collection.AbstractPersistentCollection.read(AbstractPersistentCollection.java:111)
     at org.hibernate.collection.PersistentSet.iterator(PersistentSet.java:186)
     at com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO.getShipmentOrderPricePartByStatus(ShipmentOrderVO.java:1762)
     at java.lang.reflect.Method.invoke(Method.java:622)
     at org.hibernate.proxy.pojo.javassist.JavassistLazyInitializer.invoke(JavassistLazyInitializer.java:197)
     at com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO_$$_javassist_137.getShipmentOrderPricePartByStatus(ShipmentOrderVO_$$_javassist_137.java)
     at com.mpobjects.oms.view.wicket.shipmentorder.shipmentorderfinancialdetails.ShipmentOrderPriceListPanel$2.getObject(ShipmentOrderPriceListPanel.java:122)
     at com.mpobjects.oms.view.wicket.shipmentorder.shipmentorderfinancialdetails.ShipmentOrderPriceListPanel$2.getObject(ShipmentOrderPriceListPanel.java:118)
     at com.mpobjects.view.wicket.util.PropertyModelDataProvider.size(PropertyModelDataProvider.java:110)
     at org.apache.wicket.markup.repeater.data.DataViewBase.internalGetItemCount(DataViewBase.java:141)
     at org.apache.wicket.markup.repeater.AbstractPageableView.getItemCount(AbstractPageableView.java:258)
     at org.apache.wicket.markup.repeater.AbstractPageableView.getRowCount(AbstractPageableView.java:240)
     at org.apache.wicket.markup.repeater.AbstractPageableView.getViewSize(AbstractPageableView.java:352)
     at org.apache.wicket.markup.repeater.AbstractPageableView.getItemModels(AbstractPageableView.java:105)
     at org.apache.wicket.markup.repeater.RefreshingView.onPopulate(RefreshingView.java:94)
     at org.apache.wicket.markup.repeater.AbstractRepeater.onBeforeRender(AbstractRepeater.java:131)
     at org.apache.wicket.markup.repeater.AbstractPageableView.onBeforeRender(AbstractPageableView.java:121)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.extensions.markup.html.tabs.TabbedPanel.onBeforeRender(TabbedPanel.java:244)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.markup.html.form.Form.onBeforeRender(Form.java:2104)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Page.onBeforeRender(Page.java:1555)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.Component.prepareForRender(Component.java:2297)
     at org.apache.wicket.Page.prepareForRender(Page.java:1545)
     at org.apache.wicket.Component.prepareForRender(Component.java:2329)
     at org.apache.wicket.Page.renderPage(Page.java:912)
     at org.apache.wicket.protocol.http.WebRequestCycle.redirectTo(WebRequestCycle.java:201)
     at org.apache.wicket.request.target.component.PageRequestTarget.respond(PageRequestTarget.java:58)
     at org.apache.wicket.request.AbstractRequestCycleProcessor.respond(AbstractRequestCycleProcessor.java:105)
     at org.apache.wicket.RequestCycle.processEventsAndRespond(RequestCycle.java:1287)
     at org.apache.wicket.RequestCycle.step(RequestCycle.java:1358)
     at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1465)
     at org.apache.wicket.RequestCycle.request(RequestCycle.java:545)
     at org.apache.wicket.protocol.http.WicketFilter.doGet(WicketFilter.java:486)
     at org.apache.wicket.protocol.http.WicketServlet.doGet(WicketServlet.java:138)
     at javax.servlet.http.HttpServlet.service(HttpServlet.java:697)
     at javax.servlet.http.HttpServlet.service(HttpServlet.java:810)
     at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)
     at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
     at com.mpobjects.control.filter.FirstLoginFilter.doFilter(FirstLoginFilter.java:76)
     at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
     at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:330)
     at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:118)
     at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:84)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:113)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:103)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:113)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:154)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:45)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:199)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:110)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at com.mpobjects.auth.springsec.RunAsLogoutFilter.doFilter(RunAsLogoutFilter.java:41)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.context.SecurityContextPersistenceFilter.doFilter(SecurityContextPersistenceFilter.java:87)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:192)
     at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:160)
     at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:343)
     at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:260)
     at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
     at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
     at filters.SetCharacterEncodingFilter.doFilter(SetCharacterEncodingFilter.java:111)
     at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
     at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
     at org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:230)
     at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
     at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
     at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
     at org.jboss.web.tomcat.filters.ReplyHeaderFilter.doFilter(ReplyHeaderFilter.java:96)
     at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
     at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
     at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)
     at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)
     at org.jboss.web.tomcat.security.SecurityAssociationValve.invoke(SecurityAssociationValve.java:175)
     at org.jboss.web.tomcat.security.JaccContextValve.invoke(JaccContextValve.java:74)
     at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)
     at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)
     at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)
     at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)
     at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:199)
     at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:282)
     at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:767)
     at org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:697)
     at org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:889)
     at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)
     at java.lang.Thread.run(Thread.java:701)
Complete stack:
org.apache.wicket.WicketRuntimeException: Error attaching this container for rendering: [MarkupContainer [Component id = shipmentOrderPricePartView]]
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1789)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.extensions.markup.html.tabs.TabbedPanel.onBeforeRender(TabbedPanel.java:244)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.markup.html.form.Form.onBeforeRender(Form.java:2104)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Page.onBeforeRender(Page.java:1555)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.Component.prepareForRender(Component.java:2297)
     at org.apache.wicket.Page.prepareForRender(Page.java:1545)
     at org.apache.wicket.Component.prepareForRender(Component.java:2329)
     at org.apache.wicket.Page.renderPage(Page.java:912)
     at org.apache.wicket.protocol.http.WebRequestCycle.redirectTo(WebRequestCycle.java:201)
     at org.apache.wicket.request.target.component.PageRequestTarget.respond(PageRequestTarget.java:58)
     at org.apache.wicket.request.AbstractRequestCycleProcessor.respond(AbstractRequestCycleProcessor.java:105)
     at org.apache.wicket.RequestCycle.processEventsAndRespond(RequestCycle.java:1287)
     at org.apache.wicket.RequestCycle.step(RequestCycle.java:1358)
     at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1465)
     at org.apache.wicket.RequestCycle.request(RequestCycle.java:545)
     at org.apache.wicket.protocol.http.WicketFilter.doGet(WicketFilter.java:486)
Return to the home page
ISB Barging Management System
version: isbscs - 2014.04.01 - test
all-admin (ADMINISTRATOR)
ISB
Events:
347/432
Configuration
Planning
Execution
Report
Finance
Support
Logout



/ Einde ISB-778

/ ISB-778

/ ISB-279 was een supplier invoice 	, een rekening naar de supplier, supplier = supplier van transport, = de vervoerder = eigenaar schip	,
/ Nu de rekening naar de klant	, 

/ ISB stuurt een rekening naar de transporteur, e900	, en naar de klant e1000. De e100 zijn voor ISB	, 

1.Go to Planning-->Shipment Order-->Create 
2.Add the Price Parts 
3.Create the invoice 
4.Go to Customer Invoice search screen 
5.Delete the Invoice 
6.Go to Shipment Order Search screen and search for the order created in step1 

Planning, shipment order, search	,
/ kies SH000000402	,
/ click edit,
/ click Finance button, post-calculation tab	, 
/ de rek staat in concept, INV-102367. e55	,
/ ga naar Finance, customer invoice, search	,
/ onder invoice number, fill in INV-102367	, click filter,	 
/ we zien 1 row	, click edit,	
/ we komen op Customer invoice	,
/ we zien onder Invoice Lines	,
SH000000402	55
/ Als we deze delete , krijgen we ERR	,



/ 7	.

/ 404	,

/ Finance	, Post calculated	, 
/ we zien onder Price Invoice Status NOT_INVOICED
/ click Back	, click button 'Create Invoice'	,
/ we zien onder Price Invoice Status CONCEPT, en we zien onder Invoice Reference INV-102371	,

/ click onder Price , create	,
/ we fill in 	, Save and close	,
/ we zien onder Price een nieuwe 	, maar deze is NOT_INVOICED en 
 
/ Finance, customer invoice, generate invoices	,
/ Hiermee kun je een invoice maken met meerdere sho's	,

isbscs=# select*from shipment_order_price_part ;

 system_id | shipment_order_systemid | correction_type | price_type_systemid | sequence_nr |                   reason     
              | entry_type |    amount    | cost_component_spec_systemid | invoice_status |             invoice_reference 
             | currency_systemid |                  source_ref                   |    status     
..
 27057434 |                27057351 | ADD             |            26595323 |          10 |                              
              | MANUAL     |     10.00000 |                              | NOT_INVOICED   |                               
             |              7001 |                                               | ESTIMATED

isbscs=# select*from shipment_order where system_id=27057351;
...
 27057351 |           0 | SH000000200       |               26594670 |                   26604862 |                   28 
| ...

/ Inderdaad	,

/ 7	.

/ Planning, shipment order, search	,
/ we zien in oms/menu shipment-order_list

		<map:match pattern="shipment-order_list">
				<map:act type="shipmentOrderList"/>			
				<map:call resource="dynatablePage">
					<map:parameter name="xsp" value="xsp/shipment-order_list.xml"/>
/ Dit is voor JSP en Wicket	, creates a page	,

/ we komen in	,
$ vi ShipmentOrderListAction.java
	public Map act() throws Exception {
...

/ Als we een shipment order hebben 	, we click edit button	, het groene bolletje	,

			<map:match pattern="shipment-order_edit">
				<map:act type="shipmentOrderEdit">
					<map:select type="session-attribute">
						<map:parameter name="attribute-name" value="builder"/>
						<map:when test="jsp">
							<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order_edit.jsp"/>
						</map:when>
						<map:otherwise>
							<map:redirect-to uri="../wicket?module=oms&amp;wicketpage=shipmentorder.edit.ShipmentOrderEditSelectionPage"/>

/ Hier wordt gekozen of het een JSP of een Wicket wordt	,

/ we komen op een Wicket scherm "Shipment Order Edit"	,
/ we zien een button Finance	, waar gaat hij heen?
/ we zien een button 'create invoice'	, waar gaat hij heen	?


/ We komen eerst in	,
public class ShipmentOrderEditAction extends AbstractAction {
	@Override
	public Map act() throws Exception {
... 

/dan in 
$ vi ShipmentOrderEditSelectionPage.java
...
	ShipmentOrderPanelBuilder myBuilder = (ShipmentOrderPanelBuilder) Class.forName(myClass).newInstance();
	AbstractShipmentOrderPanel myPanel = myBuilder.build(null, myShipmentOrder, "editPanel");
/s
public class StandardShipmentOrderPanelBuilder implements ShipmentOrderPanelBuilder {
	public AbstractShipmentOrderPanel build(BasePage aPage, ShipmentOrderVO aShipmentOrder, String anId) {
		IModel<ShipmentOrderVO> myModel = new EntityDetachableModel<ShipmentOrderVO>(aShipmentOrder, ShipmentOrderDao.class);
		return new ShipmentOrderMainPanel(aPage, anId, myModel);
/s

	public ShipmentOrderMainPanel(BasePage aCallingPage, String anId, IModel<ShipmentOrderVO> aShipmentOrder) {
...
	}
	protected Collection<EntityAction<ShipmentOrderVO>> getActions() {

		EntityActionButton<ShipmentOrderVO> myFinanceAct = new EntityActionButton<ShipmentOrderVO>("finance", new ResourceModel("finance")) {
			@Override
			protected void onSubmit(Button aButton, IModel<ShipmentOrderVO> aSelection) {
				ShipmentOrderVO myOrder = aSelection.getObject();
				getRequestCycle().setRequestTarget( new RedirectRequestTarget( "../wicket/?module=oms&wicketpage=shipmentorder.shipmentorderfinancialdetails.ShipmentOrderFinancialPage&shipmentorder_systemid=" + myOrder.getSystemId()));
			}

		createInvoiceBtn = new EntityActionButton<ShipmentOrderVO>("createinvoice", new ResourceModel("createinvoice")) {
			@Override
			protected void onSubmit(Button aButton, IModel<ShipmentOrderVO> aSelection) {
				getRequestCycle().setRequestTarget( new RedirectRequestTarget("../wicket/?module=customerinvoice&wicketpage=CreateInvoice&shipmentorder=" + currentShipmentOrder.getSystemId()));
			}



/ See Configuration, Administration, Properties values
/ we zien ISB en ISB-VEGOIL	, 
/ WH als een van deze, dan Wicket scherm	, anders JSP	,
/ deze bepaalt of een een Wicket scherm (Shipment Order Edit) of een JSP (Shipment Order) zien	,

isbscs=# select*from  properties_value where property_value like '%Shipment%';
 system_id | properties_system_id |                                       property_value                                  | user_system_id | organization_system_id 
  27055818 |             27055816 | com.mpobjects.oms.view.wicket.shipmentorder.edit.standard.StandardShipmentOrderPanelBuilder |                |                    500
  27059856 |             27055816 | com.mpobjects.oms.view.wicket.shipmentorder.edit.standard.StandardShipmentOrderPanelBuilder |                |                    530

/ Hier zien we de StandardShipmentOrderPanelBuilder, die een ShipmentOrderMainPanel  create	,

/ SAMENVATTING PRICE PARTS PANEL

ShipmentOrderMainPanel				/ Shipment Order, contains Finance button, Create invoice button
  Finance button->ShipmentOrderFinancialPage
    ShipmentOrderFinancialPanel			/  Shipment Order Finance, contains Pre/Post calculated tab, ... 
      3 ShipmentOrderPriceCostTab extends Panel	/ bijv de Post-calculated tab, contains  Cost, Price, Margin panels
       ShipmentOrderCostListPanel 		/ Cost 
       ShipmentOrderPriceListPanel 		/ Price 
       ShipmentOrderMarginListPanel 		/ Margin
      1 ShipmentOrderPriceComparePanel
		
/ Einde SAMENVATTING PRICE PARTS PANEL

/ 13	. 
/ Finance button	,

/ we zijn op ShipmentOrderMainPanel.getActions	, hier worden de actions def, ook als we click op Finance button, of Create invoice button	, 
/ als we op de finance button click, komen we op ShipmentOrderFinancialPage	, en we zien ShipmentOrderMainPanel.getActions  niet op de stack trace	, logisch	,
/ via de Finance button komen we dus op	,
ShipmentOrderFinancialPage.<init>() line: 36	
ShipmentOrderFinancialPanel.<init>(String, IModel<ShipmentOrderVO>, WebComponentEventSwitchBoard, FeedbackPanel, BaseContextPage) line: 42	, = Shipment Order Finance	,
/post calculated tab	, public ShipmentOrderPriceCostTab ctor	, = het panel onder de postcalculated tab	, daar is de create 

/ Meer detail	,

	public ShipmentOrderFinancialPage() {
...
		Form form = new GenericForm<ShipmentOrderVO>("form", new Model<ShipmentOrderVO>(aShipmentOrder));

		ShipmentOrderFinancialPanel orderFinancialPanel = new ShipmentOrderFinancialPanel("financialPanel", new Model<ShipmentOrderVO>(aShipmentOrder), new WebComponentEventSwitchBoard(), feedbackPanel, this);
/s
public class ShipmentOrderFinancialPanel extends Panel {
	public ShipmentOrderFinancialPanel(String id, IModel<ShipmentOrderVO> aModel, final WebComponentEventSwitchBoard aWebComponentEventSwitchBoard, FeedbackPanel aFeedbackPanel, final BaseContextPage basePage) {

/ de post calculated tab	,

		tabs.add(new PanelCachingTab(new AbstractTab(new StringResourceModel("postCalculated", model)) {
			@Override
			public Panel getPanel(String panelId) {
				Panel priceCostPanel = new ShipmentOrderPriceCostTab(panelId, model, basePage, RatePartStatus.ESTIMATED, RatePartStatus.ESTIMATED, feedbackPanel);
				priceCostPanel.add(new AttributeAppender("style", new Model<String>("border: 1px solid;border-color:gray;"), ""));
				return priceCostPanel;
/s
public class ShipmentOrderPriceCostTab extends Panel {

/ heeft alle panels: Cost, Price, Margin	, ...

	protected void createComponent() {
		ShipmentOrderPriceListPanel shoPricePanel = new ShipmentOrderPriceListPanel("pricePanel", theModel, basePage, thePriceStatus, this, feedbackPanel);
/s
public class ShipmentOrderPriceListPanel extends Panel {

	protected void createComponent() {
		SortablePropertyModelDataProvider<ShipmentOrderPricePartVO> myDataProvider = new SortablePropertyModelDataProvider<ShipmentOrderPricePartVO>( theModel, "shipmentOrderPricePartList") {
			@Override
			public Collection<ShipmentOrderPricePartVO> getObject() {
				MpoBeanFactory.getBean(ShipmentOrderDao.class).getCurrentSession().refresh(theModel.getObject());
				return theModel.getObject().getShipmentOrderPricePartByStatus(theStatus);
/ theStatus=ESTIMATED

/ Hier wordt used theModel=model om de ShipmentOrderVO heen	, en daar maken we een nieuw model mee, door te query de hipmentOrderPricePartVO's in deze ShipmentOrderVO	,

		myData = new DataView<ShipmentOrderPricePartVO>("data", myDataProvider) {
			@Override
			protected void populateItem(final Item<ShipmentOrderPricePartVO> aItem) {
...
->				ShipmentOrderPricePartVO myShipmentOrderPricePartVO = aItem.getModel().getObject();

/ we hebben b set op ->	, we vallen hier in als we de tab post-calculate click,
/ TODO
theSystemId: 27074717, Amount :8.00000

/ Inderdaad	,
isbscs=# select* from shipment_order_price_part where system_id=27074717;
 system_id | shipment_order_systemid | correction_type | price_type_systemid | sequence_nr | reason | entry_type | amount 
 | cost_component_spec_systemid | invoice_status | invoice_reference | currency_systemid | source_ref |  status   
-----------+-------------------------+-----------------+---------------------+-------------+--------+------------+--------
-+------------------------------+----------------+-------------------+-------------------+------------+-----------
  27074717 |                27057351 | ADD             |            27058858 |           5 |        | MANUAL     | 8.00000
 |                              | CONCEPT        | INV-102366        |              7001 |            | ESTIMATED
(1 row)

/ myShipmentOrderPricePartVO heeft PersistentSet	,
/ Om lazy init exc te vermijden	,
		myShipmentOrderPricePartVO = MpoBeanFactory.getBean(ShipmentOrderPricePartDAO.class).getBySystemId(myShipmentOrderPricePartVO.getSystemId());
/ TODO (Opnieuw ophalen, merge)



/ 13	. 

/ create invoice button	,

public class ShipmentOrderMainPanel extends AbstractShipmentOrderPanel {

	protected Collection<EntityAction<ShipmentOrderVO>> getActions() {

		createInvoiceBtn = new EntityActionButton<ShipmentOrderVO>("createinvoice", new ResourceModel("createinvoice")) {
			@Override
			protected void onSubmit(Button aButton, IModel<ShipmentOrderVO> aSelection) {
				getRequestCycle().setRequestTarget( new RedirectRequestTarget("../wicket/?module=customerinvoice&wicketpage=CreateInvoice&shipmentorder=" + currentShipmentOrder.getSystemId()));

/ 7	.

/ CONFIGURATION 

/ we click	,
configuration, Finance, invoice templates	,
/ er zijn er 2	,
CustomerInvoice 				/ = Standard Freignt
SupplierInvoice

Customer invoice
Organization ISB
Sender: Party type group Leeg, dat betekent default=ISB
Receiver: Bill To (see shipment order)	,
/ Dan ook Ship To zijn (rembourt)

Supplier invoice
Organization ISB
Sender: Party type group Leeg, dat betekent default=
/ TODO
Receiver : Party type group Leeg, dat betekent default=ISB

/ we click	,
configuration, Finance, invoice templates mappings	,
/ bijv	,
Organization: ISB
Invoice Template: Customer invoice 
Priority: ...
RateComponent Type: Cleaning Costs,  Price
Invoice type: INVOICE

/ we click Finance button op de sho	,
/ Post-calculated, under Price click "Create"
/ we kunnen een price part add van het type die we zojuist hebben mapped, hier :Cleaning costs, price
/ Hij zal eerst de Invoice status NOT_INVOICED hebben, maar als we op de sho "Create invoice" click, dan wordt de status CONCEPT en staat deze price part in een invoice, we zien INV-102373 bijv	,
/ Als we van het type geen mapping hebben, blijft NOT_INVOICES	, we kunnen hem niet op een invoice set	,

/ Ga naar Finance, customer invoice, search invoice, 
/ Geef INV-102373	, we zien de invoice line en detail 	,


/ Einde CONFIGURATION 


/ 7	. 

configuration, Finance, invoice templates	,

/ we zien InvoiceTemplate's	,
/ table is sin_invoice_template	,

/ InvoiceTemplatePage	,
	public InvoiceTemplatePage() {
...
		daoWrapper = new BeanWrapper(InvoiceTemplateDAO.class);

	protected void createNewButton() {
		createButton = new AjaxFallbackButton("createButton", createForm) {
			protected void onSubmit(AjaxRequestTarget aTarget, Form<?> aForm) {
...
				page.setEditRecord(daoWrapper.getBean().createNewObject());

$ vi InvoiceTemplate.standard.hbm.xml
<hibernate-mapping>
	<class name="com.mpobjects.invoice.model.invoicetemplate.InvoiceTemplate" table="SIN_INVOICE_TEMPLATE">

/ 7	. 

configuration, Finance, invoice templates mappings	,

/ we zien InvoiceTemplateMapping's	,
/ de table is sin_invoice_template_mapping	,

/ InvoiceTemplateMappingsPage	,

	public InvoiceTemplateMappingsPage() {
...
		daoWrapper = new BeanWrapper(InvoiceTemplateMappingDAO.class);


	protected void createNewButton() {
				InvoiceTemplateMappingsEditPage page = getEditPage();
				page.setEditRecord(daoWrapper.getBean().createNewObject());

$ vi InvoiceTemplateMapping.standard.hbm.xml
<hibernate-mapping>
	<class name="com.mpobjects.invoice.model.invoicetemplate.InvoiceTemplate" table="SIN_INVOICE_TEMPLATE_MAPPING">


$ vi InvoiceTemplateMappingsEditPage.java
	public void createPage() {
		editPanel = new InvoiceTemplateMappingsEditPanel("editPanel", webComponentEventSwitchBoard, panelBuilder, daoWrapper) {


/ 13	. 

/ we zijn op 'Invoice Template Mappings'	, InvoiceTemplateMappingsPage.java 
/ click op de edit button op een row in 'Invoice Template Mappings' 	, 
/ we komen op een edit page , InvoiceTemplateMappingsEditPage.java,  die ook weer 'Invoice Template Mappings' heet	,
/  InvoiceTemplateMappingsEditPage heeft een  InvoiceTemplateMappingsEditPanel	, en 3 buttons eronder	, 

/ welke query wordt gedaan als we click op een search button op een edit page "Invoice template mappings	?

/  elke search button krijgt juiste dao	,

$ vi InvoiceTemplateMappingsEditPanel.java

	@Override
	protected void setForm(final GenericForm<InvoiceTemplateMapping> aForm) {
		OrganizationField aOrganizationField = new OrganizationField("organization");


public class OrganizationField extends EvoField<Organization> {

	public OrganizationField(String aId) {
		super(aId, new BeanWrapper<OrganizationDAO>(OrganizationDAO.class));

/ en	,
public class OrganizationField extends EvoField<Organization> {
	public OrganizationField(String aId) {
		super(aId, new BeanWrapper<OrganizationDAO>(OrganizationDAO.class));
/s
public class EvoField<T extends DescribedUniqueFieldValueObject> extends FormComponentPanel<T> {
	public EvoField(String aId, BeanWrapper<? extends EnumeratedValueObjectDAOInterface<T>> aDaoWrapper) {
...
		daoWrapper = aDaoWrapper;

	protected void createLookupButton() {
		EvoLookupButton<T> btn = new EvoLookupButton<T>("evoLookupButton", daoWrapper, dataProperties) {

/ Heeft dao naar Organization's	,

/ De anderen net zo	,

/ 7	. 

/ we gaan weer terug naar de sho, click Finance, Post-calculated	, Price panel	,

/ we zijn op een ShipmentOrderPriceListPanel	, "Price"	,

/ we click create 
<button name="financialPanel:logisticsOrderfinancialTabs:panel:pricePanel:createForm:createButton" id="createButtone5" title="Create"><span>Create</span></button>

public class ShipmentOrderPriceListPanel extends Panel {
	protected void createActions() {
		Button createButton = new Button("createButton") {
			public void onSubmit() {
				ShipmentOrderPricePartVO pricePartVO = (ShipmentOrderPricePartVO) VOFactory.getValueObject(ShipmentOrderPricePartVO.class);
/ een nieuwe	,
				ShipmentOrderPricePartEditPage page = getEditPage();

				page.setEditRecord(pricePartVO);
/ set object in form op het panel , in ShipmentOrderPricePartEditPanel	, 


$ vi ShipmentOrderPricePartEditPage.java
	protected void createEditPanel() {
		EntityFormActionBuilder<ShipmentOrderPricePartVO> panelBuilder = new EntityFormActionBuilder<ShipmentOrderPricePartVO>(getFormActions());
		editPanel = new ShipmentOrderPricePartEditPanel("editPanel", webComponentEventSwitchBoard, panelBuilder, daoWrapper);

/ we zien dat het form een ShipmentOrderPricePartVO creates	,

/ heeft dao	, dao in wicket page, is dat OK	?
/ TODO

$ vi ShipmentOrderPricePartEditPanel.java

	protected void setForm(GenericForm<ShipmentOrderPricePartVO> aForm) {

		TextField<String> sequenceNr = new TextField<String>("sequenceNr");
/ Klopt, is de eerste	,

		priceTypeField = new RateComponentTypePanelField("priceType", webComponentEventSwitchBoard, this);
/ 2de	,

$ vi ShipmentOrderPricePartEditPanel.html
		<tr> 
			<td class="label"><wicket:message key="sequenceNr">Sequence nr</wicket:message></td>
			<td><input wicket:id="sequenceNr" size="15" /></td>				 

		<tr>
			<td class="label" nowrap="nowrap"><wicket:message key="priceType">PriceType</wicket:message></td>
			<td nowrap="nowrap"><span wicket:id="priceType"></span></td>

/ 13	. 

/ Hoe werkt search button op PriceType , op "Edit Shipment Order Price"?

/ we zien geen EvoField	, 
/ TODO
$ vi RateComponentTypePanelField.java 
	Link searchLink = new Link("costTypeSearch") {
			public void onClick() {
				final RateComponentTypeSearchPage myCostTypeSearchPage = new RateComponentTypeSearchPage(...)

$ vi RateComponentTypeSearchPage.java 
	public RateComponentTypeSearchPage(...){
		BeanWrapper<RateComponentTypeDAO> daoWrapper = new BeanWrapper(RateComponentTypeDAO.class);

/ Dus hij doet search op 

$ vi RateComponentType.standard.hbm.xml 

<hibernate-mapping>
	<class name="com.mpobjects.oms.model.ratecomponenttype.RateComponentType" table="RATE_COMPONENT_TYPE" lazy="false" >

isbscs=# select*from rate_component_type where rct_group='PRICE';
 system_id |         code         |            description             | is_deleted | reason_mandatory | sequence_nr | rct
_group 
-----------+----------------------+------------------------------------+------------+------------------+-------------+---- -------
  26598673 | Free Demurrage Time  | Entity Details Free Demurrage Time |          1 |                0 |          50 | PRICE
  26596442 | Bunker Surcharge     | Bunker Surcharge                   |          0 |                0 |          30 | PRICE
  26671354 | Port time            | Port time                          |          0 |                0 |          50 | PRICE
  27058853 | Ice Surcharge        | Ice Surcharge Price                |          0 |                0 |         200 | PRICE
  27058855 | Low Water Surcharge  | Low Water Surcharge Price          |          0 |                0 |         300 | PRICE
  27058856 | Cleaning Costs       | Cleaning Costs for Customer        |          0 |                0 |         400 | PRICE
  27058858 | Heating Costs        | Heating Costs for customer         |          0 |                0 |         500 | PRICE
  27058859 | Freight Commission   | Freight Commission for Broker      |          0 |                0 |         600 | PRICE
  27058860 | Demurrage Commission | Demurrage Commission for Broker    |          0 |                0 |         700 | PRICE
  26700417 | Other Price          | Other Price                        |          0 |                0 |         100 | PRICE
  26686113 | Dead Freight         | Dead Freight (Cancellation fee)    |          0 |                0 |          60 | PRICE
  26595000 | Freight              | Freight Price                      |          0 |                0 |          10 | PRICE
  26595323 | Demurrage            | Demurrage Price                    |          0 |                0 |          20 | PRICE
(13 rows)



/ 7	.

/ we click op 'Create invoice'	,

/ Intermezzo

/ we maken 2 price parts en we click 'create invoice'	,
/ we zien een table	,

<form id="form20a" method="post" action="?wicket:interface=:13:invoices:form::IFormSubmitListener::">
	<div style="width:0px;height:0px;position:absolute;left:-100px;top:-100px;overflow:hidden">
		<input type="hidden" name="form20a_hf_0" id="form20a_hf_0"></div>
			
				<fieldset>
					<legend>
						Created invoices
					</legend>
					<table class="grid">
						<tbody><tr class="headers">
							<th></th>
							<th>Invoice number</th>
							<th>Receiver</th>
							<th>Sender</th>
							<th>Currency</th>
							<th>Total exc. VAT</th>
							<th>Total high VAT</th>
							<th>Total low VAT</th>
							<th>Total free VAT</th>
							<th>Total reversed VAT</th>
						</tr>
						<tr class="even">
							<td>
								<button type="submit" class="small icon icon_edit" name="invoices:1:invoiceEditButton" id="invoiceEditButton20b" title="Edit invoice">
									<span class="hidden">Edit invoice</span>
								</button>
							</td>
							<td><span>INV-102380</span></td>
							<td><span>MORGAN</span></td>
							<td><span>ISB</span></td>
							<td><span>EUR</span></td>
							<td class="right"><span></span></td>
							<td class="right"><span></span></td>
							<td class="right"><span></span></td>
							<td class="right"><span></span></td>
							<td class="right"><span></span></td>
						</tr>
					</tbody></table>
				</fieldset>
			
		</form>


/ Einde Intermezzo

/ we zien op de ShipmentOrderMainPanel	,

		createInvoiceBtn = new EntityActionButton<ShipmentOrderVO>("createinvoice", new ResourceModel("createinvoice")) {
			@Override
			protected void onSubmit(Button aButton, IModel<ShipmentOrderVO> aSelection) {
				getRequestCycle().setRequestTarget( new RedirectRequestTarget("../wicket/?module=customerinvoice&wicketpage=CreateInvoice&shipmentorder="+currentShipmentOrder.getSystemId()));


public class CreateInvoice extends BaseContextPage {

	protected void createPage() {
		selectionList = new ArrayList<CustomerInvoiceHeader>();
		invoicesList = new InvoicesListPanel("invoices", new ListDataProvider<CustomerInvoiceHeader>(selectionList));
/s
	public InvoicesListPanel(String aId, IDataProvider<CustomerInvoiceHeader> aDataProvider) {
		super(aId);
		createComponent(aDataProvider);
/s
	protected void createComponent(IDataProvider<CustomerInvoiceHeader> aDataProvider) {
...
		invoicesList = new DataView<CustomerInvoiceHeader>("invoices", aDataProvider) {
			@Override
			protected void populateItem(final Item<CustomerInvoiceHeader> aItem) {
...
/ Dit is de table die we hierboven zagen	,

$ vi CreditInvoice.html/.java
$ vi InvoicesListPanel.html/.java


/t
/ Dan 	,
CreateInvoice.onBeforeRender() line: 106	
/s
CreateInvoice.createInvoiceEx(int) line: 56	
			CustomerInvoiceService service = MpoBeanFactory.getBean(CustomerInvoiceService.class);
			Set<CustomerInvoiceHeader> result = service.createInvoices(shipmentOrder, null, new WicketProgressMonitor(this));
/s
CustomerInvoiceServiceImpl.createInvoices(ShipmentOrderVO, Date, ProgressMonitor) line: 221	
/s
	tx	/ services zijn transacted	,
/s
	public Set<CustomerInvoiceHeader> createInvoices(ShipmentOrderVO aShipmentOrder, Date aInvoiceDate, ProgressMonitor aProgressMonitor) {
...
/s
CustomerInvoiceServiceImpl.createInvoices(Collection<ShipmentOrderVO>, Date, ProgressMonitor, InvoiceTemplate) line: 168	
			if (aInvoiceTemplate != null) {
/ NEE
			} else {
				result = gen.generateInvoice(myToProcess);
/s
CustomerInvoiceGenerator.generateInvoice(Collection<ShipmentOrderVO>, InvoiceTemplate) line: 247	

myShipmentOrderVO is een proxy	,
myShipmentOrderVO.handler.id=27057351

/ (*)
			for (ShipmentOrderPricePartVO part : myShipmentOrderVO.getShipmentOrderPricePartList()) {

/Intermezzo

isbscs=# select*from shipment_order_price_part where shipment_order_systemid=27057351 and invoice_status like 'NOT_INVOICED';
 system_id | shipment_order_systemid | correction_type | price_type_systemid | sequence_nr | reason | entry_type | amount  | cost_component_spec_systemid | invoice_status | invoice_re
ference | currency_systemid | source_ref |  status   
-----------+-------------------------+-----------------+---------------------+-------------+--------+------------+---------+------------------------------+----------------+-----------
--------+-------------------+------------+-----------
  27074885 |                27057351 | ADD             |            27058858 |          30 |        | MANUAL     | 3.33000 |                              | NOT_INVOICED   |           
        |              7001 |            | ESTIMATED
  27074883 |                27057351 | ADD             |            27058858 |          20 |        | MANUAL     | 9.99000 |                              | NOT_INVOICED   |           
        |              7001 |            | ESTIMATED
  27074940 |                27057351 | ADD             |            27058858 |          10 |        | MANUAL     | 0.00000 |                              | NOT_INVOICED   |           
        |              7001 |            | ESTIMATED
(3 rows)

/ we komen met 3 price parts aan	, hij gaat in de itm's=invoice template mapping's op zoek naar die itm die als price type heeft die van de price part	, zo wordt de it=invoice template gevonden	,
/ voorbeeld van een price type is 'heating costs'	,
/ dus een price part van type 'heating costs' komt een heating costs-invoice	, en alle price parts van dat type komen op deze invoice	, 
/ een price part van een ander type komt op een andere invoice	,
 

/ Dus de mapping is van price part type -> invoice template 

/ We zien dus in iedere price part, de type	, hier (Heating Costs, PRICE)	,  
  27058858 | Heating Costs        | Heating Costs for customer         |          0 |                0 |         500 | PRICE

/ alle types	,

isbscs=# select*from rate_component_type ;
 system_id |         code         |            description             | is_deleted | reason_mandatory | sequence_nr | rct_group 
-----------+----------------------+------------------------------------+------------+------------------+-------------+-----------
  26598673 | Free Demurrage Time  | Entity Details Free Demurrage Time |          1 |                0 |          50 | PRICE
  26596442 | Bunker Surcharge     | Bunker Surcharge                   |          0 |                0 |          30 | PRICE
  26671354 | Port time            | Port time                          |          0 |                0 |          50 | PRICE
  26604769 | Cleaning Costs       | Cleaning costs                     |          0 |                0 |          40 | COST
  26595322 | Demurrage            | Demurrage time                     |          0 |                0 |          20 | COST
  27055870 | Other                | Other                              |          0 |                0 |          50 | COST
  26604768 | Bunker               | Bunker surcharge                   |          0 |                0 |          30 | COST
  26600544 | Freight              | Freight Cost                       |          0 |                0 |          10 | COST
  27058852 | Ice Surcharge        | Ice Surcharge Cost                 |          0 |                0 |         200 | COST
  27058853 | Ice Surcharge        | Ice Surcharge Price                |          0 |                0 |         200 | PRICE
  27058854 | Low Water Surcharge  | Low Water Surcharge                |          0 |                0 |         300 | COST
  27058855 | Low Water Surcharge  | Low Water Surcharge Price          |          0 |                0 |         300 | PRICE
  27058856 | Cleaning Costs       | Cleaning Costs for Customer        |          0 |                0 |         400 | PRICE
  27058857 | Heating Costs        | Heating costs                      |          0 |                0 |         500 | COST
  27058858 | Heating Costs        | Heating Costs for customer         |          0 |                0 |         500 | PRICE
  27058859 | Freight Commission   | Freight Commission for Broker      |          0 |                0 |         600 | PRICE
  27058861 | Demurrage commission | Demurrage Commission for ISB       |          0 |                0 |          65 | COST
  26671397 | Freight Commission   | Freight Commission for ISB         |          0 |                0 |          60 | COST
  27058860 | Demurrage Commission | Demurrage Commission for Broker    |          0 |                0 |         700 | PRICE
  26700417 | Other Price          | Other Price                        |          0 |                0 |         100 | PRICE
  26686113 | Dead Freight         | Dead Freight (Cancellation fee)    |          0 |                0 |          60 | PRICE
  26595000 | Freight              | Freight Price                      |          0 |                0 |          10 | PRICE
  26595323 | Demurrage            | Demurrage Price                    |          0 |                0 |          20 | PRICE
(23 rows)


/ invoice_status 		status
NOT_INVOICED			ESTIMATED
INVOICED		 	ACTUAL	
/ TODO (later)	,

/ we MOETEN kiezen in configuration	,
Correction type : add/subtract
Status : estimated
/ Als we status = precalculated, of	, 
/ Als we correction type=free, 
/ Dan wordt voor de price part geen nieuwe invoice create	, of bij bestaande invoice gedaan, TODO 

 we maken 2 nieuwe price parts	,
/ we click create invoice	, 
/ als deze price parts 2 verschillende invoice templates hebben, worden er 2 invoices create, ze komen dus op verschillende invoices

/ Maar 	,


/ Einde Intermezzo

/ we waren in	, 
		for (ShipmentOrderPricePartVO part : myShipmentOrderVO.getShipmentOrderPricePartList()) {

			if (InvoiceStatus.NOT_INVOICED != part.getInvoiceStatus()) {
/ NEE, 
NOT_INVOICED
					continue;
			if (RatePartStatus.PRECALCULATED.equals(part.getStatus()) || RatePartStatus.ACTUAL.equals(part.getStatus())) {
/ NEE, 
ESTIMATED
					continue;
			if (CorrectionType.ADD.equals(part.getCorrectionType()) || CorrectionType.SUBTRACT.equals(part.getCorrectionType())) {
					if (aInvoiceTemplate != null) {
// NEE	 
/ In call is arg null	,
					} else {
						generateInvoice(myShipmentOrderVO, part);
part	ShipmentOrderPricePartVO  (id=16443)	
	systemId	27074940	
/s
	protected CustomerInvoiceHeader generateInvoice(ShipmentOrderVO aShipmentOrder, ShipmentOrderPricePartVO aPart) {
		return generateInvoice(aShipmentOrder, aPart, InvoiceType.INVOICE);
/s
CustomerInvoiceGenerator.generateInvoice(ShipmentOrderVO, ShipmentOrderPricePartVO, InvoiceType) line: 431	
		return generateInvoice(aShipmentOrder, aPart, aInvoiceType, null);
/s
	protected CustomerInvoiceHeader generateInvoice(ShipmentOrderVO aShipmentOrder, ShipmentOrderPricePartVO aPart, InvoiceType aInvoiceType,
		InvoiceTemplate myInvoiceTemplate = invoiceTemplateService.resolveTemplate(aPart, aInvoiceType);
/s
	public InvoiceTemplate resolveTemplate(ShipmentOrderPricePartVO aPart, InvoiceType aInvoiceType) {

/ aInvoiceType=INVOICE

/ aPart heeft een rate component type	,  bijv. (Heating costs, PRICE)	, vind de beste invoice template	,

/ een invoice template mapping heeft ook een rate component type 	, als jouw price part een rate component type heeft die die van een template mapping is, vind je het template	, dat is  invoice_template_systemid in de sin_invoice_template_mapping tbl	, in appl is dat een InvoiceTemplate proxy	, met deze id	,
/ 

/ de aPart's component type is in de tbl price_type_systemid	,

isbscs=# select*from shipment_order_price_part where system_id=27074940;
 system_id | shipment_order_systemid | correction_type | price_type_systemid | sequence_nr | reason | entry_type | amount  | cost_component_spec_systemid | invoice_status | invoice_reference | currency_systemid | source_ref |  status   
--------+-------------------+------------+-----------
  27074940 |                27057351 | ADD             |            27058858 |          10 |        | MANUAL     | 0.00000 |                              | NOT_INVOICED   |           |              7001 |            | ESTIMATED
(1 row)

isbscs=# select*from rate_component_type where system_id=27058858;
 system_id |     code      |        description         | is_deleted | reason_mandatory | sequence_nr | rct_group 
-----------+---------------+----------------------------+------------+------------------+-------------+-----------
  27058858 | Heating Costs | Heating Costs for customer |          0 |                0 |         500 | PRICE
(1 row)

isbscs=# select*from sin_invoice_template_mapping;
 system_id | organization_systemid | invoice_template_systemid | priority | receiver_group_systemid | rate_component_type_systemid | inco_term_systemid | invoice_type 
-----------+-----------------------+---------------------------+----------+-------------------------+------------------------------+--------------------+--------------
  27071826 |                   500 |                  27067160 |       50 |                         |                              |                    | CREDIT_NOTE
  27071492 |                   500 |                  27071491 |       10 |                26604578 |                              |                    | SELF_BILL
  27067881 |                   500 |                  27074797 |       10 |                         |                     27058856 |                    | INVOICE
  27067161 |                   500 |                  27074797 |       10 |                         |                     26595000 |                    | INVOICE
  27074749 |                   500 |                  27074797 |       90 |                         |                     26596442 |                    | INVOICE
  27074784 |                   500 |                  27074797 |       90 |                         |                     27058858 |                    | INVOICE
  27074740 |                   500 |                  27074797 |       10 |                         |                     26595323 |                    | INVOICE
							^^^								^^^					^^^
							result=invoice template	,					input=rate component type	,	invoice type
(7 rows)

/ De template mapping heeft ook een rate_component_type, in de table is rate_component_type_systemid	, 

/ aPart=theSystemId: 27074883, Amount :9.99000, Heating costs, Price, ...
/ aInvoiceType=INVOICE
/ Deze willen we add aan een invoice	,

		for (InvoiceTemplateMapping myMapping : invoiceTemplateMappingDAO.getByPriority()) {

/ hij gaat alle itm's af	,

			if (myMapping.getInvoiceType() != null && !myMapping.getInvoiceType().equals(aInvoiceType)) {
/ aInvoiceType==INVOICE
				continue;
			}
			RateComponentType myType = aPart.getComponentType();
/ tpl 1 uit db	,
/ myType==26595000, ..., Freight, ...
/ tpl 2 uit db	,
/ myType==theSystemId: 27058858Code :Heating Costs

			if (myMapping.getRateComponentType() != null && !myMapping.getRateComponentType().equals(myType)) {
/ JA	, tpl 1	
				continue; 
/ NEE , tpl2

			// TODO: Add receiver logic
			myBestMatch = myMapping;

		return myBestMatch.getInvoiceTemplate();

myBestMatch	InvoiceTemplateMapping  (id=17309)	
	invoiceTemplate	InvoiceTemplate_$$_javassist_116  (id=17315)	

/t
CustomerInvoiceGenerator.generateInvoice(ShipmentOrderVO, ShipmentOrderPricePartVO, InvoiceType, InvoiceTemplate) line: 449	

		InvoiceTemplate myInvoiceTemplate = invoiceTemplateService.resolveTemplate(aPart, aInvoiceType);
/d
myInvoiceTemplate	InvoiceTemplate_$$_javassist_116  (id=17315)	
/ Is verkregen in tx, is nu WH detached	,  want in JEE een tx starts/stops een session	, in SE in het andersom	,
/ Maar we zitten nog in een tx	,  want we zijn in 	,
			Set<CustomerInvoiceHeader> result = service.createInvoices(shipmentOrder, null, new WicketProgressMonitor(this));
/ Maar zit obj in huidige session's pc	?
/ WH niet	,
/ TODO

/ In het tpl staan de receiver en sender	,

		FinancialPartyVO receiver = getInvoiceReceiver(aShipmentOrder, myInvoiceTemplate);

/ myInvoiceTenplate is unitialized H. proxy	,

/s
CustomerInvoiceGenerator.getInvoiceReceiver(ShipmentOrderVO, InvoiceTemplate) line: 688	
	protected FinancialPartyVO getInvoiceReceiver(ShipmentOrderVO aShipmentOrder, InvoiceTemplate aTemplate) {
		if (aTemplate != null && !StringUtils.isBlank(aTemplate.getReceiverCode())) {

/ myInvoiceTenplate is unitialized H. proxy	,
/ maar de call aTemplate.getReceiverCode() inits the H tpl	,
/ we komen in tpl.handler.target.getReceiverCode	, als we in .getReceiverCode zijn, zien we in de InvoiceTemplate inst, niet in de proxy	,
/////////////////////////////////
/ LIE

			partyType = aTemplate.getReceiverCode();
/ BILL_TO 


/ aTemplate is de proxy's target.handler 	,
/ Hoe weten we dat hij resolved is?
/ TODO

		return getFinancialParty(aShipmentOrder, partyType);
/ sho & BILL_TO	, klopt	, maar op de sho staat de party, onderdeel bedrijf, moet nog gezocht worden naar de financial party, deze wordt return	,
/s
CustomerInvoiceGenerator.getFinancialParty(ShipmentOrderVO, String) line: 581	
		if (DefaultPartyTypeGroups.BILL_TO.name().equals(aPartyType)) {
			party = aShipmentOrder.getBillToPartyVO();
/s
	public Party getBillToPartyVO() {
		return theBillToParty;

/t
CustomerInvoiceGenerator.getFinancialParty(ShipmentOrderVO, String) line: 581	

/ aShipmentOrder is een proxy	,
party	VirtualParty  (id=19912)	
PARTY id:SHELL(systemId:0)

		final String partyId = party.getCode();
"SHELL"

		// look up the real party master data
		party = PartyDAOFactory.getInstance().getDAO().getPartyByPartyId(partyId);
/s
/ tx
/s
	public PartyVO getPartyByPartyId(String aPartyId, boolean aDeleted) {
		DetachedCriteria myCriteria = DetachedCriteria.forClass(PartyVO.class);
		myCriteria.add(Property.forName("partyId").eq(aPartyId));
		myCriteria.add(Property.forName("deleted").eq(aDeleted));
		List<PartyVO> myList = findByCriteria(myCriteria);

/ Intermezzo

/ LIE
public class PartyDAOImpl extends GenericHibernateDAO<PartyVO> implements PartyDAO {

	public PartyVO getPartyByPartyId(String aPartyId, boolean aDeleted) {
		DetachedCriteria myCriteria = DetachedCriteria.forClass(PartyVO.class);
		myCriteria.add(Property.forName("partyId").eq(aPartyId));
		myCriteria.add(Property.forName("deleted").eq(aDeleted));
		List<PartyVO> myList = findByCriteria(myCriteria);

/ we zien in Party.standard.hbm.xml

<hibernate-mapping package="com.mpobjects.oms.model.party.vo">
	<class name="PartyVO" table="PARTY">
		<many-to-many column="PARTY_GROUP_SYSTEMID"	class="com.mpobjects.oms.model.partygroup.vo.PartyGroupVO" />
		<many-to-one name="organizationVO" column="ORGANIZATION_SYSTEMID" class="com.mpobjects.oms.model.entity.organization.Organization" />
		<filter name="filterOrganization" condition="organization_Systemid in (select uo.organization_systemid from user_organization uo where uo.user_systemid = :current_user_system_id)" />

/ In Organization.standard.hbm.xml  

<hibernate-mapping package="com.mpobjects.oms.model.entity.organization">
	<class name="Organization" lazy="false" table="ORGANIZATION">
...

/ In PartyGroup.standard.hbm.xml

<hibernate-mapping package="com.mpobjects.oms.model.partygroup.vo">
	<class name="com.mpobjects.oms.model.partygroup.vo.PartyGroupVO" lazy="false" discriminator-value="PARTY_GROUP" table="PARTY_GROUP">
...

/ 13	. 

/ Waar komt current_system_user_id vandaan? , = 27074281

$ vi HibernateFilterAspect.java

@Aspect
public class HibernateFilterAspect {
	@Before("execution(* com.mpobjects..*dao..*(..)) && !execution(* com.mpobjects..*dao..*.system*(..)) && target(target)")
	public void before(Object target) {
...


$ vi core-base.sb.xml

	<!-- AOP Aspect to enable organization filters on DAOs -->
	<bean id="HibernateFilterAspect" class="com.mpobjects.util.dao.HibernateFilterAspect">
	</bean>

/ 13	. 

isbscs=# select *                       
        from user_organization uo
        where uo.user_systemid = 27074281;
 user_systemid | organization_systemid | is_active | is_active_allowed 
---------------+-----------------------+-----------+-------------------
      27074281 |                   500 |         1 |                 1
      27074281 |                   540 |         0 |                 1
      27074281 |                   520 |         0 |                 1
      27074281 |                   510 |         0 |                 1
      27074281 |                   530 |         0 |                 1
      27074281 |                  3150 |         0 |                 1

/ koppeltabel	,

isbscs=# select*from tms_user;
 system_id |  user_id   |             user_name             |              user_email_address               | is_enabled | is_deleted |       last_login        | login_attempt | is_first_login |  last_password_update   | chargeable | grace_login | created_by | user_password | is_interface_account | user_reference1 | user_reference2 |       created_on        | local_account 
-----------+------------+-----------------------------------+-----------------------------------------------+------------+------------+-------------------------+---------------+------
  27074281 | eric       | Eric J. Van der Velden            |                                               |          1 |          0 | 2014-12-15 13:56:28.92  |             0 |      
        0 | 2014-11-18 16:13:53.292 |          0 |           0 |      10100 | rtdMpo45      |                    0 |                 |                 | 2014-11-18 16:13:53.292 |     
        1

isbscs=#  select*from organization;
 system_id | organization_id |              description              | autom_rate_calc | is_deleted | organization_group | sequence 
-----------+-----------------+---------------------------------------+-----------------+------------+--------------------+----------
         1 | SYSTEM          | SYSTEM                                |               0 |          0 |                    |        0
       500 | ISB             | Interstream Barging                   |               0 |          0 |                    |        0
       530 | ISB-VEGOIL      | Interstream Barging BU Vegetable Oils |               0 |          0 |                500 |        0
       540 | ISB-ARGOS       | Interstream Barging BU Argos          |               0 |          0 |                500 |        0
      3150 | MPO-CUST        | MP Objects                            |               0 |          0 |                    |        0
       520 | ISB-C&S         | Interstream Barging BU Chemicalien    |               0 |          0 |                500 |        0
       510 | ISB-CPP         | Interstream Barging BU Mineralen      |               0 |          0 |                500 |        0
        34 | Grish           | dghgfnhf                              |               0 |          1 |                540 |       21



/ we zien in log/hibernate.log	,

select 
	this_.SYSTEM_ID as SYSTEM1_137_2_, this_.IS_DELETED as IS2_137_2_, this_.PARTY_ID as PARTY3_137_2_, this_.NAME as NAME137_2_, this_.NAME2 as NAME5_137_2_, this_.ADDRESS as ADDRESS137_2_, this_.ADDRESS2 as ADDRESS7_137_2_, this_.CITY as CITY137_2_, this_.ZIPCODE as ZIPCODE137_2_, this_.COUNTRY_SYSTEMID as COUNTRY10_137_2_, this_.CONTACT_NAME as CONTACT11_137_2_, this_.EMAILADDRESS as EMAILAD12_137_2_, this_.FAXNUMBER as FAXNUMBER137_2_, this_.PHONENUMBER as PHONENU14_137_2_, this_.REGION_STATE as REGION15_137_2_, this_.TNT_ZONE as TNT16_137_2_, this_.REFERENCE1 as REFERENCE17_137_2_, this_.REFERENCE2 as REFERENCE18_137_2_, this_.REFERENCE3 as REFERENCE19_137_2_, this_.REFERENCE4 as REFERENCE20_137_2_, this_.REFERENCE5 as REFERENCE21_137_2_, this_.SERVICE_ORDER_URL_EXPRESSION as SERVICE22_137_2_, this_.MANIFEST_REPORT as MANIFEST23_137_2_, this_.LONGITUDE as LONGITUDE137_2_, this_.LATITUDE as LATITUDE137_2_, this_.PRENOTIFY_CARCON as PRENOTIFY26_137_2_, this_.SERVICE_REMARKS as SERVICE27_137_2_, this_.ORGANIZATION_SYSTEMID as ORGANIZ28_137_2_, this_.PARTY_TYPE_SYSTEMID as PARTY29_137_2_, 
	organizati2_.SYSTEM_ID as SYSTEM1_136_0_, organizati2_.IS_DELETED as IS2_136_0_, organizati2_.SEQUENCE as SEQUENCE136_0_, organizati2_.ORGANIZATION_ID as ORGANIZA4_136_0_, organizati2_.DESCRIPTION as DESCRIPT5_136_0_, organizati2_.ORGANIZATION_GROUP as ORGANIZA6_136_0_, organizati2_.AUTOM_RATE_CALC as AUTOM7_136_0_, 
	organizati3_.SYSTEM_ID as SYSTEM1_136_1_, organizati3_.IS_DELETED as IS2_136_1_, organizati3_.SEQUENCE as SEQUENCE136_1_, organizati3_.ORGANIZATION_ID as ORGANIZA4_136_1_, organizati3_.DESCRIPTION as DESCRIPT5_136_1_, organizati3_.ORGANIZATION_GROUP as ORGANIZA6_136_1_, organizati3_.AUTOM_RATE_CALC as AUTOM7_136_1_ 
from PARTY this_ 
left outer join ORGANIZATION organizati2_ on this_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID 			
left outer join ORGANIZATION organizati3_ on organizati2_.ORGANIZATION_GROUP=organizati3_.SYSTEM_ID 			
where this_.organization_Systemid in (
	select uo.organization_systemid 
	from user_organization uo 
`	where uo.user_systemid = ?) 
and this_.PARTY_ID=? 
and this_.IS_DELETED=?

/ Beide outer joins zijn nutteloos	,

/ Wat doen  
left outer join ORGANIZATION organizati2_ on this_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID 			
/ -> organization.system_id=500, bepaalt organization	,
left outer join ORGANIZATION organizati3_ on organizati2_.ORGANIZATION_GROUP=organizati3_.SYSTEM_ID 			
/ is er niet , want de entry met system_id=500 heeft organization_group= 
       500 | ISB             | Interstream Barging                   |               0 |          0 |                    |        0

isbscs=# select organization_group is null  from organization where system_id=500;
 ?column? 
----------
 t
(1 row)
/ organization_group is een integer	,


/ Intermezzo

foo=> drop table x;create table x(i int,s varchar(32));
foo=> insert into x values (1,'foo'),(2,''),(3,null);

foo=> select s is not null from x where i=1;
 ?column? 
----------
 t
(1 row)

foo=> select s='' from x where i=2;
 ?column? 
----------
 t
(1 row)



/ Einde Intermezzo



/ er wordt gedaan 	,
...
	where uo.user_systemid = 27074281) 
and this_.PARTY_ID='SHELL'
and this_.IS_DELETED=false

 system1_137_2_ | is2_137_2_ | party3_137_2_ | name137_2_ | name5_137_2_ | address137_2_ | address7_137_2_ | city137_2_ | zipcode137_2_ | country10_137_2_ | contact11_137_2_ | emailad12_137_2_ | faxnumber137_2_ | phonenu14_137_2_ | region15_137_2_ | tnt16_137_2_ | reference17_137_2_ | reference18_137_2_ | reference19_137_2_ | reference20_137_2_ | reference21_137_2 _ | service22_137_2_ | manifest23_137_2_ | longitude137_2_ | latitude137_2_ | prenotify26_137_2_ | service27_137_2_ | organiz28_137_2_ | party29_137_2_ | system1_136_0_ | is2_136_0_ | sequence136_0_ | organiza4_136_0_ |  descript5_136_0_   | organiza6_136_0_ | autom7_136_0_ | system1_136_1_ | is2_136_1_ | sequence136_1_ | organiza4_136_1_ | descript5_136_1_ | organiza6_136_1_ | autom7_136_1_ 
----------------+------------------+---------------------+------------------+---------------+----------------+------------+----------------+------------------+------------------+-----
-------------+---------------
       26617748 |          0 | SHELL         | shell      |              | .             |                 |            |               |             4153 |                  |        
          |                 |                  |                 |              |                    |                    |                    |                    |                  
  |                  |                   |                 |                |                  0 |                  |              500 |       26594712 |            500 |          0 |
              0 | ISB              | Interstream Barging |                  |             0 |                |            |                |                  |                  |     
             |              
(1 row)




$ vi  Organization.standard.hbm.xml

<hibernate-mapping package="com.mpobjects.oms.model.entity.organization">
	<class name="Organization" lazy="false" table="ORGANIZATION">
...

$ vi PartyGroup.standard.hbm.xml 

<hibernate-mapping package="com.mpobjects.oms.model.partygroup.vo">
	<class name="com.mpobjects.oms.model.partygroup.vo.PartyGroupVO" lazy="false" discriminator-value="PARTY_GROUP" table="PARTY_GROUP">

/ stack trace,

	PartyDAOImpl.getPartyByPartyId(String, boolean) line: 203	
	PartyDAOImpl.getPartyByPartyId(String) line: 193	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	MethodBeforeAdviceInterceptor.invoke(MethodInvocation) line: 51	
	ReflectiveMethodInvocation.proceed() line: 161	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	ExposeInvocationInterceptor.invoke(MethodInvocation) line: 91	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy130.getPartyByPartyId(String) line: not available	
	CustomerInvoiceGenerator.getFinancialParty(ShipmentOrderVO, String) line: 604	
	CustomerInvoiceGenerator.getInvoiceReceiver(ShipmentOrderVO, InvoiceTemplate) line: 698	
	CustomerInvoiceGenerator.generateInvoice(ShipmentOrderVO, ShipmentOrderPricePartVO, InvoiceType, InvoiceTemplate) line: 456	
	CustomerInvoiceGenerator.generateInvoice(ShipmentOrderVO, ShipmentOrderPricePartVO, InvoiceType) line: 431	
	CustomerInvoiceGenerator.generateInvoice(ShipmentOrderVO, ShipmentOrderPricePartVO) line: 416	
	CustomerInvoiceGenerator.generateInvoice(Collection<ShipmentOrderVO>, InvoiceTemplate) line: 260	
	CustomerInvoiceGenerator.generateInvoice(Collection<ShipmentOrderVO>) line: 226	
	CustomerInvoiceServiceImpl.createInvoices(Collection<ShipmentOrderVO>, Date, ProgressMonitor, InvoiceTemplate) line: 207	
	CustomerInvoiceServiceImpl.createInvoices(Collection<ShipmentOrderVO>, Date, ProgressMonitor) line: 162	
	CustomerInvoiceServiceImpl.createInvoices(ShipmentOrderVO, Date, ProgressMonitor) line: 223	

/ Einde Intermezzo

/ Intermezzo

/ we deden	,

	protected FinancialPartyVO getFinancialParty(ShipmentOrderVO aShipmentOrder, String aPartyType) {
		if (DefaultPartyTypeGroups.BILL_TO.name().equals(aPartyType)) {
			party = aShipmentOrder.getBillToPartyVO();
...
		party = PartyDAOFactory.getInstance().getDAO().getPartyByPartyId(partyId);

/ WH is dit reattach in H.	
/ TODO

/ we zien een systemId	, PersistentSet ipv HashMap	, 
/ en zijn nu ook de proxy's initialized	, zoals countryVO?
/ TODO

/ Dit is de 1ste	,

party	VirtualParty  (id=16970)	
	address	"." (id=16971)	
	address2	"" (id=16972)	
	city	"" (id=16973)	
	contactName	"" (id=16974)	
	countryVO	Country_$$_javassist_57  (id=16975)	
	currencyDAO	null	
	dao	null	
	description	null	
	emailAddress	"" (id=16976)	
	entityDetails	HashMap<K,V>  (id=16977)	
	faxNumber	"" (id=16978)	
	latitude	null	
	longitude	null	
	manifestReport	"" (id=16952)	
	name	"shell" (id=16979)	
	name2	"" (id=16980)	
	organization	null	
	partyGroups	HashSet<E>  (id=16981)	
	partyId	"SHELL" (id=16982)	
	partyType	null	
	performanceMonitorService	null	
	phoneNumber	"" (id=16983)	
	postalCode	"" (id=16984)	
	prenotifyCarcon	false	
	qualifier	"" (id=16952)	
	reference1	"" (id=16985)	
	reference2	"" (id=16986)	
	reference3	"" (id=16987)	
	reference4	"" (id=16988)	
	reference5	"" (id=16989)	
	regionState	"" (id=16990)	
	scheduleVo	null	
	serviceOrderUrlExpression	"" (id=16952)	
	serviceRemarks	"" (id=16952)	
	systemId	0	
	theFormattedEntity	null	
	TimeZone	null	

/Dit is de 2de	,

party	PartyVO  (id=17018)	
	address	"." (id=17019)	
	address2	"" (id=17020)	
	attachments	PersistentSet  (id=17021)	
	city	"" (id=17022)	
	contactName	"" (id=17023)	
	countryVO	Country_$$_javassist_57  (id=16975)	
	currencyDAO	null	
	dao	null	
	deleted	false	
	description	null	
	emailAddress	"" (id=17030)	
	entityDetails	PersistentMap  (id=17031)	
	faxNumber	"" (id=17032)	
	latitude	null	
	longitude	null	
	manifestReport	"" (id=17033)	
	manifestReport	"" (id=16952)	
	name	"shell" (id=17034)	
	name2	"" (id=17035)	
	organization	Organization  (id=16940)	
	partyGroups	PersistentSet  (id=17036)	
	partyGroupsAsString	null	
	partyId	"SHELL" (id=17037)	
	partyPrenotificationRuleList	PersistentBag  (id=17038)	
	partyType	PartyType_$$_javassist_171  (id=17039)	
	performanceMonitorService	null	
	phoneNumber	"" (id=17040)	
	postalCode	"" (id=17041)	
	prenotifyCarcon	false	
	prenotifyCarcon	false	
	qualifier	"" (id=16952)	
	qualifier	"" (id=16952)	
	reference1	"" (id=17042)	
	reference2	"" (id=17043)	
	reference3	"" (id=17044)	
	reference4	"" (id=17045)	
	reference5	"" (id=17046)	
	regionState	"" (id=17047)	
	scheduleVo	null	
	scheduleVo	null	
	serviceOrderUrlExpression	"" (id=17048)	
	serviceOrderUrlExpression	"" (id=16952)	
	serviceRemarks	"" (id=17049)	
	serviceRemarks	"" (id=16952)	
	systemId	26617748	
	theFormattedEntity	null	
	timeZone	null	
	TimeZone	null	
	tntZone	"" (id=17050)	

/ Einde Intermezzo

/t
CustomerInvoiceGenerator.getInvoiceReceiver(ShipmentOrderVO, InvoiceTemplate) line: 698	
/s
CustomerInvoiceGenerator.getFinancialParty(ShipmentOrderVO, String) line: 604	
		party = PartyDAOFactory.getInstance().getDAO().getPartyByPartyId(partyId);
partyId="SHELL"
		// first look for binding
		FinancialPartyPartyBinding binding = serviceImpl.getFinancialPartyPartyBindingDAO().getBinding(party);
/s
FinancialPartyPartyBindingDAOImpl.getBinding(Party) line: 45	
		Map<String, Object> args = new HashMap<String, Object>();
		args.put("party", aParty);
		Collection<FinancialPartyPartyBinding> result = findEqualsWithQueryMap(args);

/ Intermezzo

/ een bedrijf bestaat uit onderdelen. Dit zijn de party's	,
/ alle rekeningen gaan naar 1 rekening	, dit is de financial party van het bedrijf	,

/ Einde Intermezzo

$ vi FinancialPartyPartyBinding.standard.hbm.xml
...
	<class name="FinancialPartyPartyBinding" table="INVOICE_FINANCIAL_PARTY_BINDING">	
...
		<many-to-one name="financialParty" class="com.mpobjects.invoice.model.financialparty.vo.FinancialPartyVO">
			<column name="FINANCIAL_PARTY_SYSTEMID" />
		</many-to-one>

		<many-to-one name="party" class="com.mpobjects.oms.model.party.vo.PartyVO">
			<!-- party can only be bound to a single FP, thus is value is unique -->
			<column name="PARTY_SYSTEMID" unique="true" />
		</many-to-one>

isbscs=# select*from invoice_financial_party_binding order by financial_party_systemid;
 system_id | financial_party_systemid | party_systemid 
-----------+--------------------------+----------------
  26595183 |                 26595181 |       26595155
  26597459 |                 26597455 |       26597456
  27074663 |                 26597455 |          30551
  27069752 |                 26597455 |       27059802
  26602887 |                 26602885 |       26602882
  26604599 |                 26602885 |       26604597
  26603046 |                 26603038 |       26603036
  26617755 |                 26617752 |       26617748		/ party_id='SHELL'	,
  26617757 |                 26617753 |       26617750
  27064499 |                 26628012 |          25013
  26628014 |                 26628012 |       26598679
  27072459 |                 26628012 |          22027
  27057457 |                 27057455 |       26594755
  27063217 |                 27063215 |       27058884
(14 rows)

/ we zien inderdaad dat bij 1 financial_party_systemid meerdere party_systemid kunnen zijn	,

isbscs=# select*from party where party_id='SHELL';
 system_id | is_deleted | party_id | party_type_systemid | organization_systemid | name  | name2 | address | address2 | city | zipcode | country_systemid | contact_name | emailaddress | faxnumber | phonenumber | region_state | tnt_zone | reference1 | reference2 | reference3 | reference4 | reference5 | service_order_url_expression | manifest_report | time_zone | longitude | latitude | schedule_systemid | prenotify_carcon | service_remarks 
--------+----------+-------------------+------------------+-----------------
  26617748 |          0 | SHELL    |            26594712 |                   500 | shell |       | .       |          |      |         |             4153 |              |             
...
(1 row)


/ onze partyId=26617748 zien we ook	,

/ we zien	,

/s
FinancialPartyPartyBindingDAOImpl.getBinding(Party) line: 45 (out of synch)	

		DetachedCriteria myDetachedCriteria = DetachedCriteria.forClass(type);
type	Class<T> (com.mpobjects.invoice.model.financialparty.vo.FinancialPartyPartyBinding) (id=9611)	

		for (String myAttribute : aCriteriaQueryMap.keySet()) {
			myDetachedCriteria.add(Property.forName(myAttribute).eq(aCriteriaQueryMap.get(myAttribute)));
		}

select this_.SYSTEM_ID as SYSTEM1_177_1_, this_.FINANCIAL_PARTY_SYSTEMID as FINANCIAL2_177_1_, this_.PARTY_SYSTEMID as PARTY3_177_1_, 
	financialp2_.SYSTEM_ID as SYSTEM1_180_0_, financialp2_.IS_DELETED as IS2_180_0_, financialp2_.FINANCIAL_PARTY_ID as FINANCIAL3_180_0_, financialp2_.NAME as NAME180_0_, financialp2_.NAME2 as NAME5_180_0_, financialp2_.ADDRESS as ADDRESS180_0_, financialp2_.ADDRESS2 as ADDRESS7_180_0_, financialp2_.CITY as CITY180_0_, financialp2_.ZIPCODE as ZIPCODE180_0_, financialp2_.CONTACT_NAME as CONTACT10_180_0_, financialp2_.EMAILADDRESS as EMAILAD11_180_0_, financialp2_.VAT_NUMBER as VAT12_180_0_, financialp2_.USE_EDI as USE13_180_0_, financialp2_.CREDITOR_CODE as CREDITOR14_180_0_, financialp2_.MATCH_LEVEL as MATCH15_180_0_, financialp2_.REGION_STATE as REGION16_180_0_, financialp2_.PAYMENT_TERM_END_OF_MONTH as PAYMENT17_180_0_, financialp2_.PHONENUMBER as PHONENU18_180_0_, financialp2_.FAXNUMBER as FAXNUMBER180_0_, financialp2_.REMARK as REMARK180_0_, financialp2_.TRESHOLD_UP_ABSOLUT as TRESHOLD21_180_0_, financialp2_.TRESHOLD_UP_PERCENTAGE as TRESHOLD22_180_0_, financialp2_.TRESHOLD_DOWN_ABSOLUT as TRESHOLD23_180_0_, financialp2_.TRESHOLD_DOWN_PERCENTAGE as TRESHOLD24_180_0_, financialp2_.BILL_TO_NAME as BILL25_180_0_, financialp2_.BILL_TO_NAME2 as BILL26_180_0_, financialp2_.BILL_TO_ADRESS as BILL27_180_0_, financialp2_.BILL_TO_ADRESS2 as BILL28_180_0_, financialp2_.BILL_TO_CITY as BILL29_180_0_, financialp2_.BILL_TO_ZIPCODE as BILL30_180_0_, financialp2_.BILL_TO_CONTACT_NAME as BILL31_180_0_, financialp2_.BILL_TO_EMAIL_ADRESS as BILL32_180_0_, financialp2_.BILL_TO_PHONENUMBER as BILL33_180_0_, financialp2_.BILL_TO_FAXNUMBER as BILL34_180_0_, financialp2_.BILL_TO_REGION_STATE as BILL35_180_0_, financialp2_.BILL_TO_COUNTRY_CODE_SYSTEMID as BILL36_180_0_, financialp2_.PAYMENT_STD_CURRENCY_SYSTEMID as PAYMENT37_180_0_, financialp2_.COUNTRY_SYSTEMID as COUNTRY38_180_0_, financialp2_.PAYMENT_TERM as PAYMENT39_180_0_, financialp2_.ORGANIZATION_SYSTEMID as ORGANIZ40_180_0_, financialp2_.MATCH_INVOICE_IDENTIFIER as MATCH41_180_0_, financialp2_.MATCH_ALL_COST_TYPES  as MATCH42_180_0_, financialp2_.DISPONABILITY_PERCENTAGE as DISPONA43_180_0_, financialp2_.DISPONABILITY_TERM as DISPONA44_180_0_, financialp2_.COST_ALLOCATION_METHOD as COST45_180_0_, financialp2_.SELF_BILL  as SELF46_180_0_, financialp2_.BILLING_CYCLE as BILLING47_180_0_, financialp2_.INVOICE_GROUP_MODE as INVOICE48_180_0_, financialp2_.SELF_BILL_INVOICE_SYSTEMID as SELF49_180_0_ 
from INVOICE_FINANCIAL_PARTY_BINDING this_ 
left outer join INVOICE_FINANCIAL_PARTY financialp2_ on this_.FINANCIAL_PARTY_SYSTEMID=financialp2_.SYSTEM_ID 
where this_.PARTY_SYSTEMID=?

/t
CustomerInvoiceGenerator.getFinancialParty(ShipmentOrderVO, String) line: 612 (out of synch)	
		FinancialPartyPartyBinding binding = serviceImpl.getFinancialPartyPartyBindingDAO().getBinding(party);
/d
binding	FinancialPartyPartyBinding  (id=17119)	
	financialParty	FinancialPartyVO  (id=17120)	
	party	PartyVO  (id=17018)	
	systemId	26617755	

/ Intermezzo

/ LIE

$ vi FinancialPartyPartyBinding.standard.hbm.xml

		<many-to-one name="financialParty" class="com.mpobjects.invoice.model.financialparty.vo.FinancialPartyVO">
			<column name="FINANCIAL_PARTY_SYSTEMID" />
		</many-to-one>

		<many-to-one name="party" class="com.mpobjects.oms.model.party.vo.PartyVO">
			<!-- party can only be bound to a single FP, thus is value is unique -->
			<column name="PARTY_SYSTEMID" unique="true" />
		</many-to-one>

$ vi FinancialParty.standard.hbm.xml

	<class lazy="false" name="com.mpobjects.invoice.model.financialparty.vo.FinancialPartyVO" table="INVOICE_FINANCIAL_PARTY">
...

$ vi Party.standard.hbm.xml

	<class name="PartyVO" table="PARTY">
...

/ Waarom is party geen proxy	?
/ party was al opgehaald	,
		party = PartyDAOFactory.getInstance().getDAO().getPartyByPartyId(partyId);

/ In FinancialParty.standard.hbm.xml
/ lazy="false" 
/ TODO

/ Waarom een list?
		Collection<FinancialPartyPartyBinding> result = findEqualsWithQueryMap(args);
/ TODO


/ Einde Intermezzo

/ we zijn nog in	,
FinancialPartyPartyBindingDAOImpl.getBinding(Party) line: 45 (out of synch)	
			return binding.getFinancialParty();

/t
CustomerInvoiceGenerator.generateInvoice(ShipmentOrderVO, ShipmentOrderPricePartVO, InvoiceType, InvoiceTemplate) line: 468 (out of synch)	
		FinancialPartyVO sender = getInvoiceSender(aShipmentOrder, myInvoiceTemplate);
/s
	protected FinancialPartyVO getInvoiceSender(ShipmentOrderVO aShipmentOrder, InvoiceTemplate aTemplate) {
		if (aTemplate != null && !StringUtils.isBlank(aTemplate.getSenderCode())) {
/ NEE
			partyType = aTemplate.getSenderCode();
		}
		if (partyType == null) {
/ JA
			// use creator
			return getCreatorFinancialParty();

/ Dat doen we inderdaad	, we hebben leeg veld	,
/s
CustomerInvoiceGenerator.getCreatorFinancialParty() line: 564 (out of synch)	
		if (creatorFinancialParty == null && creator != null) {
/ creatorFinancialParty==null
/ creator=Resource:eric(systemId:27074281)
			Organization organization = creator.getActiveOrganization();
SystemId:500	Id:ISB	Description:Interstream Barging
/ eric werkt bij ISB	,
			creatorFinancialParty = serviceImpl.getFinancialPartyDAO().getByCode(organization.getCode());
/ organization.getCode()=='ISB'	,
/s
/ tx
/s
FinancialPartyHibernateDAO(EnumeratedValueObjectHibernateDAO<T>).getByCode(String) line: 58 (out of synch)	
	public T getByCode(String aCode, boolean aShowDeleted) {

/ Inderdaad	, FinancialPartyHibernateDAO is de class type, niet een ...DAOImpl	, en .getByCode is in EnumeratedValueObjectHibernateDAO	,

		Map<String, Object> map = new HashMap<String, Object>(1);
		map.put(CODE_FIELD, aCode);
		if (!aShowDeleted && isDeletable()) {
/ JA
			map.put(DELETED, false);
		}

		Collection<T> result = findEqualsWithQueryMap(map);

/ Altijd een coll	?
/ TODO
/s
FinancialPartyHibernateDAO(GenericHibernateDAO<Type>).findEqualsWithQueryMap(Map<String,Object>) line: 223 (out of synch)	

		DetachedCriteria myDetachedCriteria = DetachedCriteria.forClass(type);
type	Class<T> (com.mpobjects.invoice.model.financialparty.vo.FinancialPartyVO) (id=9611)	

		for (String myAttribute : aCriteriaQueryMap.keySet()) {
			myDetachedCriteria.add(Property.forName(myAttribute).eq(aCriteriaQueryMap.get(myAttribute)));
deleted="false"
code="ISB"
...
		return myTemplate.findByCriteria(myDetachedCriteria);

/ we zien	,

select*
from INVOICE_FINANCIAL_PARTY this_         
where this_.organization_Systemid in (
	select uo.organization_systemid from user_organization uo where uo.user_systemid         = ?) 
and this_.IS_DELETED=? 
and this_.FINANCIAL_PARTY_ID=?
2014-12-16 16:14:57,396 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-5:) binding parameter         [1] as [INTEGER] - 27074281	/ tms_user eric
2014-12-16 16:14:57,397 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-5:) binding parameter         [2] as [BIT] - false
2014-12-16 16:14:57,398 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-5:) binding parameter         [3] as [VARCHAR] - ISB

isbscs=# select*
from INVOICE_FINANCIAL_PARTY this_
where this_.organization_Systemid in (
        select uo.organization_systemid from user_organization uo where uo.user_systemid         = 27074281)
and this_.IS_DELETED=false   
and this_.FINANCIAL_PARTY_ID='ISB';

 system_id | organization_systemid | is_deleted | financial_party_id |          name          | name2 |    address     | address2 | zipcode |      city       | region_state | country_systemid |   contact_name    |          emailaddress           | phonenumber | faxnumber  |   vat_number   | payment_block | payment_std_currency_systemid | payment_term | reference1 | reference2 | reference3 | reference4 | reference5 |               remark                |             bill_to_name              |   bill_to_name2    | bill_to_adress | bill_to_adress2 | bill_to_zipcode |  bill_to_city   | bill_to_region_state | bill_to_country_code_systemid | bill_to_contact_name |      bill_to_email_adress       | bill_to_phonenumber | bill_to_faxnumber | payment_term_end_of_month | match_level | treshold_down_percentage | treshold_down_absolut | treshold_up_percentage | treshold_up_absolut | match_invoice_identifier | creditor_code | match_all_cost_types | use_edi | disponability_term | disponability_percentage | self_bill | billing_cycle | invoice_group_mode | self_bill_invoice_systemid | cost_allocation_method 
-----------
  26605102 |                   500 |          0 | ISB                | Interstream Barging NL |       | Centraleweg 40 |          | 3021 DE | Geertruidenberg | Zuid Holland |         
    4153 | Hans van der Veen | invoicing@interstreambarging.nl | +316587464  | +316587464 | NL182882962B01 |             0 |                          7001 |            0 |            
|            |            |            |            | Company register Rotterdam 24333331 | Interstream Barging Netherlands B.V.  | Invoice department | Centraleweg 40 |              
   | 3021 DE         | Geertruidenberg | Zuid Holland         |                          4153 | Hans van der Veen    | invoicing@interstreambarging.nl | +316587464          |         
          |                         0 | LEVEL B     |                  0.00000 |               0.00000 |                0.00000 |             0.00000 | SERVICE_ORDER_ID         | 1234
567890    |                    0 |       0 |                  0 |                  0.00000 |         0 |               |                    |                            | ON_HEADER_AP
PROVAL
(1 row)


		return result.iterator().next();

/t
CustomerInvoiceGenerator.getCreatorFinancialParty() line: 566 (out of synch)	
			creatorFinancialParty = serviceImpl.getFinancialPartyDAO().getByCode(organization.getCode());
SystemId:26605102	FinancialParty:ISB	
		return creatorFinancialParty;
/t
CustomerInvoiceGenerator.generateInvoice(ShipmentOrderVO, ShipmentOrderPricePartVO, InvoiceType, InvoiceTemplate) line: 469 (out of synch)	
		FinancialPartyVO sender = getInvoiceSender(aShipmentOrder, myInvoiceTemplate);
/d
SystemId:26605102	FinancialParty:ISB	

		CurrencyVO currency = aPart.getCurrencyVO();
/ proxy , EUR

		InvoiceHeaderKey key = new InvoiceHeaderKey(myInvoiceTemplate, sender, receiver, currency);
		CustomerInvoiceHeader header = invoices.get(key);
null
/ want	,
{}
			header = createNewInvoice(aShipmentOrder, key);
/s
CustomerInvoiceGenerator.createNewInvoice(ShipmentOrderVO, InvoiceHeaderKey) line: 385 (out of synch)	
	protected CustomerInvoiceHeader createNewInvoice(ShipmentOrderVO aShipmentOrder, InvoiceHeaderKey aKey) {
		CustomerInvoiceHeader header = new CustomerInvoiceHeader();
		header.setCreateDate(new Date());
		header.setCreatedBy(creator);
Resource:eric(systemId:27074281)
		header.setOrganization(aKey.getSender().getOrganizationVO());
/ sender is een FinancialPartyVO SystemId:26605102	FinancialParty:ISB		
, daarin organizationVO=Organization , SystemId:500	Id:ISB	Description:Interstream Barging
		header.setCurrency(aKey.getCurrency());
		header.setInvoiceReceiver(aKey.getReceiver());
/ a FinancialPartyVO, SystemId:26617752	FinancialParty:SHELL	
		header.setInvoiceSender(aKey.getSender());
		header.setInvoiceDate(invoiceDate);
		header.setInvoiceTemplate(aKey.getInvoiceTemplate());
	invoiceTemplate	InvoiceTemplate_$$_javassist_116  (id=16522)	
		handler	JavassistLazyInitializer  (id=16525)	
			id	Integer  (id=17335)	
27074797
			initialized	true	
			target	InvoiceTemplate  (id=17349)	
				code	"CustomerInvoice" (id=17353)	
				description	"Create Customer Invoice" (id=17355)	
				invoiceLayout	ReportVO_$$_javassist_81  (id=17357)	
				organization	Organization  (id=16940)	
				performanceMonitorService	null	
				receiverBuiltin	DefaultPartyTypeGroups  (id=17361)	
				receiverType	null	
				senderBuiltin	null	
				senderType	null	
				systemId	27074797	

/ we hebben dus 2 financial parties	, de receiver en de sender	,
/ de sender komt via de bill_to uit de sho, want dat is een onderdeel van het bedrijf; alle onderdelen hebben 1 financial onderdeel gemeenschappelijk, en dat is de financial party, de sender	,
/ / de sender heeft financial_party_id='SHELL'	, de receiver 'ISB'	, 

/ receiver	,
isbscs=# select*from invoice_financial_party where financial_party_id='SHELL';
 system_id | organization_systemid | is_deleted | financial_party_id | name  | name2 |   address    | address2 | zipcode |  city   | region_state | country_systemid | contact_name | emailaddress | phonenumber | faxnumber |   vat_number   | payment_block | payment_std_currency_systemid | payment_term | reference1 | reference2 | reference3 | reference4 | reference5 | remark | bill_to_name | bill_to_name2 | bill_to_adress | bill_to_adress2 | bill_to_zipcode | bill_to_city | bill_to_region_state | bill_to_country_code_systemid | bill_to_contact_name | bill_to_email_adress | bill_to_phonenumber | bill_to_faxnumber | payment_term_end_of_month | match_level | treshold_down_percentage | treshold_down_absolut | treshold_up_percentage | treshold_up_absolut | match_invoice_identifier | creditor_code | match_all_cost_types | use_edi | disponability_term | disponability_percentage | self_bill | billing_cycle | invoice_group_mode | self_bill_invoice_systemid | cost_allocation_method 
---------------+----------------------------+------------------------
  26617752 |                   500 |          0 | SHELL              | Shell |       | Postbus 5270 |          | 6130 PG | SITTARD |              |             4153 |              |  
            |             |           | NL005887240B01 |             0 |                          7001 |           60 |            |            |            |            |            
|        |              |               |                |                 |                 |              |                      |                               |                   
   |                      |                     |                   |                         0 | LEVEL B     |                  0.00000 |               0.00000 |                0.000
00 |             0.00000 | SERVICE_ORDER_ID         | 5039          |                    0 |       0 |                  0 |                  0.00000 |         0 |               |     
               |                            | ON_HEADER_APPROVAL
(1 row)

/ sender	, 
isbscs=# select*from invoice_financial_party where financial_party_id='ISB';
 system_id | organization_systemid | is_deleted | financial_party_id |          name          | name2 |    address     | address2 | zipcode |      city       | region_state | country_ystemid |   contact_name    |          emailaddress           | phonenumber | faxnumber  |   vat_number   | payment_block | payment_std_currency_systemid | payment_term | reference1  reference2 | reference3 | reference4 | reference5 |               remark                |             bill_to_name              |   bill_to_name2    | bill_to_adress | bill_to_adress2 | bill_to_zipcode |  bill_to_city   | bill_to_region_state | bill_to_country_code_systemid | bill_to_contact_name |      bill_to_email_adress       | bill_to_phonenumber | bill_to_faxnumber | payment_term_end_of_month | match_level | treshold_down_percentage | treshold_down_absolut | treshold_up_percentage | treshold_up_absolut | match_invoice_identifier | creditor_code | match_all_cost_types | use_edi | disponability_term | disponability_percentage | self_bill | billing_cycle | invoice_group_mode | self_bill_invoice_systemid | cost_allocation_method 
-----------
  26605102 |                   500 |          0 | ISB                | Interstream Barging NL |       | Centraleweg 40 |          | 3021 DE | Geertruidenberg | Zuid Holland |         
    4153 | Hans van der Veen | invoicing@interstreambarging.nl | +316587464  | +316587464 | NL182882962B01 |             0 |                          7001 |            0 |            
|            |            |            |            | Company register Rotterdam 24333331 | Interstream Barging Netherlands B.V.  | Invoice department | Centraleweg 40 |              
   | 3021 DE         | Geertruidenberg | Zuid Holland         |                          4153 | Hans van der Veen    | invoicing@interstreambarging.nl | +316587464          |         
          |                         0 | LEVEL B     |                  0.00000 |               0.00000 |                0.00000 |             0.00000 | SERVICE_ORDER_ID         | 1234
567890    |                    0 |       0 |                  0 |                  0.00000 |         0 |               |                    |                            | ON_HEADER_AP
PROVAL
(1 row)


		Collection<VatPolicy> vatPolicies = serviceImpl.getVatPolicyDAO().getVatPolicyByCountryCodeSystemIdRefDate(
				aKey.getSender().getCountryVO().getSystemId(), invoiceDate);
...
/ countryVO is een proxy	,
/s
Country(ValueObject).getSystemId() line: 155 (out of synch)	
		return systemId;
4153

isbscs=# select*from country where system_id=4153;
 system_id | is_deleted | country_code |   country_name   | codealpha3 | codenumeric | postal_code_pattern 
-----------+------------+--------------+------------------+------------+-------------+---------------------
      4153 |          0 | NL           | NETHERLANDS (EU) |            |             | 
(1 row)

/t
/s
VatPolicyDAOImpl.getVatPolicyByCountryCodeSystemIdRefDate(int, Date) line: 40 (out of synch)	

		if (aCountryCodeSystemId > 0) {
/ JA	,
4153
			List<VatPolicy> myResults = getHibernateTemplate().findByCriteria(
					DetachedCriteria.forClass(VatPolicy.class).add(Restrictions.eq("country.systemId", aCountryCodeSystemId))
							.add(Property.forName("validFromDate").le(aDate)).add(Property.forName("validToDate").gt(aDate)));
			return myResults;

select this_.SYSTEM_ID as SYSTEM1_176_0_, this _.CODE as CODE176_0_, this_.DESCRIPTION as DESCRIPT3_176_0_, this_.IS_DELETED as IS4_176_0_, this_.TARIF_FREE as TARIF5_176_0_, this_.TARIF_HIGH as TARIF6_176_0_, this_.TARIF_LOW as TARIF7_176_0_, this_.TARIF_REV as TARIF8_176_0_, this_.VALID_FROM_DATE as VALID9_176_0_, this_.VALID_TO_DATE as VALID10_176_0_, this_.COUNTRY_SYSTEMID as COUNTRY11_176_0_ 
from         INVOICE_VAT_POLICY this_ 
where this_.COUNTRY_SYSTEMID=? 
and this_.VALID_FROM_DATE<=? 
and this_.VALID_TO_DATE>?
 339331 2014-12-16 17:11:47,924 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-5:) binding parameter         [1] as [INTEGER] - 4153
 339334 2014-12-16 17:11:47,925 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-5:) binding parameter         [2] as [TIMESTAMP] - Tue Dec 16 11:26:59 CET 2014
 339335 2014-12-16 17:11:47,926 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-5:) binding parameter         [3] as [TIMESTAMP] - Tue Dec 16 11:26:59 CET 2014

select this_.SYSTEM_ID as SYSTEM1_176_0_, this _.CODE as CODE176_0_, this_.DESCRIPTION as DESCRIPT3_176_0_, this_.IS_DELETED as IS4_176_0_, this_.TARIF_FREE as TARIF5_176_0_, this_.TARIF_HIGH as TARIF6_176_0_, this_.TARIF_LOW as TARIF7_176_0_, this_.TARIF_REV as TARIF8_176_0_, this_.VALID_FROM_DATE as VALID9_176_0_, this_.VALID_TO_DATE as VALID10_176_0_, this_.COUNTRY_SYSTEMID as COUNTRY11_176_0_ 
from         INVOICE_VAT_POLICY this_ 
where this_.COUNTRY_SYSTEMID=4153
and this_.VALID_FROM_DATE<='Tue Dec 16 11:26:59 CET 2014' 
and this_.VALID_TO_DATE>'Tue Dec 16 11:26:59 CET 2014'

 system1_176_0_ | code176_0_ | descript3_176_0_ | is4_176_0_ | tarif5_176_0_ | tarif6_176_0_ | tarif7_176_0_ | tarif8_176_0_ |    valid9_176_0_    |     valid10_176_0_      | country11_176_0_ 
---------
       26605695 | NL VAT     | Netherlands VAT  |          0 |       0.00000 |      21.00000 |       6.00000 |       0.00000 | 2014-03-01 00:00:00 | 2049-12-31 23:59:59.999 |         
    4153
       26607045 | EU-VAT     | Europe VAT       |          0 |       0.00000 |      21.00000 |       6.00000 |       0.00000 | 2013-07-04 00:00:00 | 2016-05-29 23:59:59.999 |         
    4153
(2 rows)

/t
CustomerInvoiceGenerator.createNewInvoice(ShipmentOrderVO, InvoiceHeaderKey) line: 395	
		Collection<VatPolicy> vatPolicies = serviceImpl.getVatPolicyDAO().getVatPolicyByCountryCodeSystemIdRefDate(
				aKey.getSender().getCountryVO().getSystemId(), invoiceDate);
/ d
/ 2 entries	,

		header.setVatPolicy(vatPolicies.iterator().next());
com.mpobjects.invoice.model.entity.vatpolicy.VatPolicy@12333a6a[NL VAT,Netherlands VAT]
/ TODO (Waarom deze?)

		Date dueDate = DateUtils.addTo(invoiceDate, "D", aKey.getReceiver().getPaymentTerm());
/ een FinancialPartyVO's payment_term is 60 , en door "D" wordt dit opgevat als 60 dagen	, binnen deze termijn moet de factuur betaald	,
/ dueDate = eindtijd	,
/s
	public static Date addTo(Date aDate, String aType, int aQuantity) {
		Calendar myCalendar = Calendar.getInstance();
		myCalendar.setTime(aDate);
		int myType;
		if ("M".equals(aType)) {
/ NEE
		} else if ("D".equals(aType)) {
/ JA
			myType = Calendar.DAY_OF_YEAR;
/ Dus 60 betekent 60 dagen	,
		} else {
			throw new IllegalArgumentException("invalid type specified, must be one of:minute,hour,day");
		}

		myCalendar.add(myType, aQuantity);

/ eindtijd	,

		return myCalendar.getTime();

/t
CustomerInvoiceGenerator.createNewInvoice(ShipmentOrderVO, InvoiceHeaderKey) line: 402	
		Date dueDate = DateUtils.addTo(invoiceDate, "D", aKey.getReceiver().getPaymentTerm());
/d
		header.setInvoiceDueDate(dueDate);
/ direct	,
		header.setStatus(getGeneratingStatus());
/s
CustomerInvoiceGenerator.getGeneratingStatus() line: 624	
		if (generatingStatus == null) {
			generatingStatus = serviceImpl.getCustomerInvoiceHeaderStatusDAO().getByCode(CustomerInvoiceHeaderStatus.GENERATING);

$ vi CustomerInvoiceHeader.standard.hbm.xml

<hibernate-mapping package="com.mpobjects.customerinvoice.model.entity">
	<class name="CustomerInvoiceHeader" table="CUSTOMER_INVOICE_HEADER">
...

$ vi CustomerInvoiceHeaderStandard.standard.hbm.xml
<hibernate-mapping>
	<class name="com.mpobjects.customerinvoice.model.entity.CustomerInvoiceHeaderStatus" table="CUSTOMER_INVOICE_HEADER_STATUS">
...
isbscs=# select*from customer_invoice_header_status;
 system_id |       code       |         description         | is_deleted 
-----------+------------------+-----------------------------+------------
    554404 | CANCELLED        | CANCELLED                   |          0
  26613077 | CONCEPT          | Concept                     |          0
  26613078 | APPROVED         | Approved                    |          0
  26727974 | GENERATING       | Invoice is being generated. |          0	 / Deze dus	,
  26613079 | SENT_TO_CUSTOMER | Sent to Customer            |          0
  26727975 | PAID             | Paid                        |          0
  26727976 | PARTIALLY_PAID   | Partially Paid              |          0
(7 rows)

/s
CustomerInvoiceHeaderStatusDAOImpl(EnumeratedValueObjectHibernateDAO<T>).getByCode(String) line: 58	
	Map<String, Object> map = new HashMap<String, Object>(1);
		map.put(CODE_FIELD, aCode);
/ aCode="GENERATING"
		Collection<T> result = findEqualsWithQueryMap(map);
/s
	public Collection<Type> findEqualsWithQueryMap(Map<String, Object> aCriteriaQueryMap) {
		DetachedCriteria myDetachedCriteria = DetachedCriteria.forClass(type);
type	Class<T> (com.mpobjects.customerinvoice.model.entity.CustomerInvoiceHeaderStatus) (id=13270)	

		for (String myAttribute : aCriteriaQueryMap.keySet()) {
			myDetachedCriteria.add(Property.forName(myAttribute).eq(aCriteriaQueryMap.get(myAttribute)));
deleted="false
code="GENERATING"
		}
		HibernateTemplate myTemplate = getHibernateTemplate();
		myTemplate.setCacheQueries(true);
		return myTemplate.findByCriteria(myDetachedCriteria);

/t
CustomerInvoiceGenerator.getGeneratingStatus() line: 627	
			generatingStatus = serviceImpl.getCustomerInvoiceHeaderStatusDAO().getByCode(CustomerInvoiceHeaderStatus.GENERATING);
/d
generatingStatus	
com.mpobjects.customerinvoice.model.entity.CustomerInvoiceHeaderStatus@57f1f0e6[GENERATING,Invoice is being generated.]

/t
CustomerInvoiceGenerator.createNewInvoice(ShipmentOrderVO, InvoiceHeaderKey) line: 407	
		header.setRemarks(remarkGenerator.generateRemark(header));
/d
		serviceImpl.getCustomerInvoiceHeaderDAO().save(header);
		invoices.put(aKey, header);
{{ISB,SHELL,EUR,CustomerInvoice}=com.mpobjects.customerinvoice.model.entity.CustomerInvoiceHeader/id:27074993}
/ of meer detail	,
aKey	InvoiceHeaderKey  (id=16801)	
	currency	CurrencyVO_$$_javassist_133  (id=16112)	
	invoiceTemplate	InvoiceTemplate_$$_javassist_116  (id=16244)	
	receiver	FinancialPartyVO  (id=16743)	
	sender	FinancialPartyVO  (id=16783)	
header	CustomerInvoiceHeader  (id=16807)	
	approvalDate	null	
	approvedBy	null	
	approvementRemarks	"" (id=16065)	
	createDate	Date  (id=17003)	
	createdBy	Resource  (id=16051)	
	currency	CurrencyVO_$$_javassist_133  (id=16112)	
	document	null	
	externalInvoiceNumber	null	
	invoiceDate	Date  (id=16052)	
	invoiceDueDate	Date  (id=16931)	
	invoiceLines	PersistentSortedSet  (id=17004)	
	invoiceNumber	"INV-102370" (id=17005)	
	invoiceReceiver	FinancialPartyVO  (id=16743)	
	invoiceReceiverSystemId	Integer  (id=17006)	
	invoiceSender	FinancialPartyVO  (id=16783)	
	invoiceSenderSystemId	Integer  (id=17007)	
	invoiceTemplate	InvoiceTemplate_$$_javassist_116  (id=16244)	
	invoiceType	InvoiceType  (id=16194)	
	organization	Organization  (id=16092)	
	performanceMonitorService	null	
	remarks	"" (id=16065)	
	status	CustomerInvoiceHeaderStatus  (id=16966)	
	systemId	27074993	
	totalInvoiceAmountExcVat	BigDecimal  (id=17008)	
	totalInvoiceAmountFreeVat	BigDecimal  (id=17008)	
	totalInvoiceAmountHighVat	BigDecimal  (id=17008)	
	totalInvoiceAmountLowVat	BigDecimal  (id=17008)	
	totalInvoiceAmountRevVat	BigDecimal  (id=17008)	
	totalVatAmountHigh	BigDecimal  (id=17008)	
	totalVatAmountLow	BigDecimal  (id=17008)	
	vatPolicy	null	
	vatPolicySystemId	Integer  (id=17009)	


/ Intermezzo

isbscs=#  select*from invoice_financial_party where financial_party_id in ('SHELL','ISB')


  26617752 |                   500 |          0 | SHELL              | Shell |       | Postbus 5270 |          | 6130 PG | SITTARD |              |             4153 |              |  
  26605102 |                   500 |          0 | ISB                | Interstream Barging NL |       | Centraleweg 40 |          | 3021 DE | Geertruidenberg | Zuid Holland |         

/ we zien 2 invoices met sender isb en receiver shell	,

isbscs=# select*from customer_invoice_header where invoice_receiver_systemid=26617752 and invoice_sender_systemid=26605102;
 system_id |       create_date       | created_by_systemid | organization_systemid | currency_systemid | invoice_receiver_systemid | invoice_sender_systemid |      invoice_date       
|    invoice_due_date     |  status  | invoice_number | remarks | vat_policy_systemid | approvement_remarks | approved_by_systemid | approval_date | document_systemid | total_amount_e
xc_vat | total_amount_free_vat | total_amount_high_vat | total_amount_low_vat | total_amount_rev_vat | total_vat_high | total_vat_low | external_invoice_number | invoice_type | invoic
e_template_systemid 
--------------------
  27066535 | 2014-10-01 06:59:07.197 |               10100 |                   500 |              7001 |                  26617752 |                26605102 | 2014-10-01 06:59:07.171 
| 2014-11-30 06:59:07.171 | 26613077 | INV-102339     |         |            26607045 |                     |                      |               |                   |             50
0.0000 |                0.0000 |              500.0000 |               0.0000 |               0.0000 |       105.0000 |        0.0000 |                         | INVOICE      |       
                   
  27074834 | 2014-12-10 14:46:37.766 |            27074281 |                   500 |              7001 |                  26617752 |                26605102 | 2014-12-10 14:46:37.725 
| 2015-02-08 14:46:37.725 | 26727974 | INV-102367     |         |            26605695 |                     |                      |               |                   |               
0.0000 |                0.0000 |                0.0000 |               0.0000 |               0.0000 |         0.0000 |        0.0000 |                         | INVOICE      |       
           27074797
(2 rows)


/ Einde Intermezzo

/t
CustomerInvoiceGenerator.generateInvoice(ShipmentOrderVO, ShipmentOrderPricePartVO, InvoiceType, InvoiceTemplate) line: 499	
			header = createNewInvoice(aShipmentOrder, key);
/d
		CustomerInvoiceLine line = getInvoiceLine(header, aShipmentOrder);

/ Intermezzo

/ we zijn nog steeds in	 het maken van een invoice voor de eerste price part	,

		for (ShipmentOrderVO myShipmentOrderVO : aShipmentOrderList) {
			for (ShipmentOrderPricePartVO part : myShipmentOrderVO.getShipmentOrderPricePartList()) {
						generateInvoice(myShipmentOrderVO, part);


/ Einde Intermezzo

/ gegeven een invoice, er kunnen meerdere lines=sho's op staan	, en een sho kan op meerdere invoice's staan	, dus we moeten 2 arg geven	, invoice & sho	,
/s
CustomerInvoiceGenerator.getInvoiceLine(CustomerInvoiceHeader, ShipmentOrderVO) line: 638	
		Map<Integer, CustomerInvoiceLine> cache = lineCache.get(aHeader);
null
		List<CustomerInvoiceLine> existingLines = serviceImpl.getCustomerInvoiceLineDAO().findLine(aHeader, aShipmentOrder);
/s

/ gegeven een invoice, er kunnen meerdere lines=sho's op staan	, en een sho kan op meerdere invoice's staan	, dus we moeten 2 arg geven	, invoice & sho	,

$ vi CustomerInvoiceLine.standard.hbm.xml
<hibernate-mapping package="com.mpobjects.customerinvoice.model.entity">
	<class name="CustomerInvoiceLine" table="CUSTOMER_INVOICE_LINE">

		DetachedCriteria crit = DetachedCriteria.forClass(CustomerInvoiceLine.class);
		crit.add(Property.forName("invoiceHeader").eq(aHeader));
		crit.add(Property.forName("shipmentOrderSystemId").eq(aShipmentOrder.getSystemId()));
		crit.addOrder(Order.asc("lineNumber"));
		return findByCriteria(crit);

/ we zien	,
select this_.SYSTEM_ID as SYSTEM1_236_2_, this_.CREATE_DATE as CREATE2_236_2_, this_.CREATED_BY_SYSTEMID as CREATED3_236_2_, this_.SHIPMENT_ORDER_SYSTEMID as SHIPMENT4_236_2_, this_.REMARKS as REMARKS236_2_, this_.LINE_NUMBER as LINE6_236_2_, this_.INVOICE_HEADER_SYSTEMID as INVOICE7_236_2_,
                        (select sho.SHIPMENT_ORDER_ID from SHIPMENT_ORDER sho ,  CUSTOMER_INVOICE_LINE cil 
				where cil.SHIPMENT_ORDER_SYSTEMID = sho.SYSTEM_ID 
				and cil.system_id = this_.SYSTEM_ID) as formula4_2_, resource2_.SYSTEM_ID as SYSTEM1_86_0_, resource2_.USER_ID as USER2_86_0_, resource2_.USER_NAME as USER3_86_0_, resource2_.USER_PASSWORD as USER4_86_0_, resource2_.USER_EMAIL_ADDRESS as USER5_86_0_, resource2_.IS_ENABLED as IS6_86_0_, resource2_.IS_INTERFACE_ACCOUNT as IS7_86_0_, resource2_.IS_DELETED as IS8_86_0_, resource2_.LAST_LOGIN as LAST9_86_0_, resource2_.LAST_PASSWORD_UPDATE as LAST10_86_0_, resource2_.USER_REFERENCE1 as USER11_86_0_, resource2_.USER_REFERENCE2 as USER12_86_0_, resource2_.LOGIN_ATTEMPT as LOGIN13_86_0_, resource2_.GRACE_LOGIN as GRACE14_86_0_, resource2_.IS_FIRST_LOGIN as IS15_86_0_, resource2_.CHARGEABLE as CHARGEABLE86_0_, resource2_.LOCAL_ACCOUNT as LOCAL17_86_0_, resource2_.CREATED_BY as CREATED18_86_0_, resource2_.CREATED_ON as CREATED19_86_0_, resource3_.SYSTEM_ID as SYSTEM1_86_1_, resource3_.USER_ID as USER2_86_1_, resource3_.USER_NAME as USER3_86_1_, resource3_.USER_PASSWORD as USER4_86_1_, resource3_.USER_EMAIL_ADDRESS as USER5_86_1_, resource3_.IS_ENABLED as IS6_86_1_, resource3_.IS_INTERFACE_ACCOUNT as IS7_86_1_, resource3_.IS_DELETED as IS8_86_1_, resource3_.LAST_LOGIN as LAST9_86_1_, resource3_.LAST_PASSWORD_UPDATE as LAST10_86_1_, resource3_.USER_REFERENCE1 as USER11_86_1_, resource3_.USER_REFERENCE2 as USER12_86_1_, resource3_.LOGIN_ATTEMPT as LOGIN13_86_1_, resource3_.GRACE_LOGIN as GRACE14_86_1_, resource3_.IS_FIRST_LOGIN as IS15_86_1_, resource3_.CHARGEABLE as CHARGEABLE86_1_, resource3_.LOCAL_ACCOUNT as LOCAL17_86_1_, resource3_.CREATED_BY as CREATED18_86_1_, resource3_.CREATED_ON as CREATED19_86_1_ 
from CUSTOMER_INVOICE_LINE this_ 
inner join TMS_USER resource2_ on this_.CREATED_BY_SYSTEMID=resource2_.SYSTEM_ID 
left outer join TMS_USER resource3_ on resource2_.CREATED_BY=resource3_.SYSTEM_ID 
where this_.INVOICE_HEADER_SYSTEMID=? 
and this_.SHIPMENT_ORDER_SYSTEMID=? order by this_.LINE_NUMBER asc
2014-12-17 13:41:51,654 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [1] as [INTEGER] - 27074993
2014-12-17 13:41:51,654 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [2] as [INTEGER] - 27057351

/ leeg, want er is nog geen invoice line	, 

/ Intermezzo

/ LIE

/ alle invoice lines	,
isbscs=# select*from customer_invoice_line;
 system_id |       create_date       | created_by_systemid | shipment_order_systemid |     remarks     | line_number | invoice_header_systemid 
-----------+-------------------------+---------------------+-------------------------+-----------------+-------------+-------------------------
  27057305 | 2014-08-18 15:37:53.838 |            26594669 |                26729148 | #Colli: 0,      |          10 |                27057304
  27057308 | 2014-08-18 15:37:53.91  |            26594669 |                27055833 | #Colli: 0, null |          20 |                27057304
  26671363 | 2014-03-26 10:52:06.093 |            26594669 |                26659470 | #Colli: 0,      |          10 |                26671362
  27057311 | 2014-08-18 15:37:53.946 |            26594669 |                27056249 | #Colli: 0, null |          30 |                27057304
  27057314 | 2014-08-18 15:37:54.006 |            26594669 |                26714198 | #Colli: 0, null |          40 |                27057304
  27057317 | 2014-08-18 15:37:54.094 |            26594669 |                26738353 | #Colli: 0,      |          50 |                27057304
  27057320 | 2014-08-18 15:37:54.184 |            26594669 |                26733700 | #Colli: 0,      |          60 |                27057304
  27057323 | 2014-08-18 15:37:54.241 |            26594669 |                26698351 | #Colli: 0,      |          70 |                27057304
...

/ we zien lines op dezelfde invoice, bijv, 27057304, en we zien ook van welke sho afkomstig	, 
/ de created_by_systemid is een system_id in de tms_user tbl	,

/ 7	.

$ vi CustomerInvoiceLine.standard.hbm.xml

hibernate-mapping package="com.mpobjects.customerinvoice.model.entity">
	<class name="CustomerInvoiceLine" table="CUSTOMER_INVOICE_LINE">
		<property name="createDate" column="CREATE_DATE" not-null="true" />
		<many-to-one name="createdBy" column="CREATED_BY_SYSTEMID" class="com.mpobjects.oms.model.user.Resource" not-null="true" />
		<property name="shipmentOrderSystemId" column="SHIPMENT_ORDER_SYSTEMID" type="integer" not-null="false" />
		<property name="shipmentOrderId" insert="false" update="false">
			<formula>
			(select sho.SHIPMENT_ORDER_ID from SHIPMENT_ORDER sho ,  CUSTOMER_INVOICE_LINE cil where cil.SHIPMENT_ORDER_SYSTEMID = sho.SYSTEM_ID and 
			cil.system_id = SYSTEM_ID)
			</formula>
		</property>	
		<property name="remarks" column="REMARKS" />
		<property name="lineNumber" column="LINE_NUMBER" />
		<many-to-one name="invoiceHeader" column="INVOICE_HEADER_SYSTEMID" class="CustomerInvoiceHeader" insert="false"
			update="false" />
		<set name="invoiceDetails" order-by="LINE_NUMBER" sort="com.mpobjects.customerinvoice.util.LineNumberComparator"
			cascade="all" lazy="false" batch-size="50">
			<key column="INVOICE_LINE_SYSTEMID" not-null="true" />
			<one-to-many class="CustomerInvoiceDetail" />
		</set>

/ Als we met criteria deze query, welke props komen dan in de query terecht? 
/ we zien de formula, en we zien ook een lazy="false"	,
/ TODO
/ Wat uit de mapping verschijnt in het obj na een query	?
/ TODO

/ 7	.

select this_.SYSTEM_ID as SYSTEM1_236_2_, this_.CREATE_DATE as CREATE2_236_2_, this_.CREATED_BY_SYSTEMID as CREATED3_236_2_, this_.SHIPMENT_ORDER_SYSTEMID as SHIPMENT4_236_2_, this_.REMARKS as REMARKS236_2_, this_.LINE_NUMBER as LINE6_236_2_, this_.INVOICE_HEADER_SYSTEMID as INVOICE7_236_2_,
                        (select sho.SHIPMENT_ORDER_ID 
			from SHIPMENT_ORDER sho ,  CUSTOMER_INVOICE_LINE cil 
			where cil.SHIPMENT_ORDER_SYSTEMID = sho.SYSTEM_ID 
			and cil.system_id = this_.SYSTEM_ID) as formula4_2_, 
	resource2_.SYSTEM_ID as SYSTEM1_86_0_, resource2_.USER_ID as USER2_86_0_, resource2_.USER_NAME as USER3_86_0_, resource2_.USER_PASSWORD as USER4_86_0_, resource2_.USER_EMAIL_ADDRESS as USER5_86_0_, resource2_.IS_ENABLED as IS6_86_0_, resource2_.IS_INTERFACE_ACCOUNT as IS7_86_0_, resource2_.IS_DELETED as IS8_86_0_, resource2_.LAST_LOGIN as LAST9_86_0_, resource2_.LAST_PASSWORD_UPDATE as LAST10_86_0_, resource2_.USER_REFERENCE1 as USER11_86_0_, resource2_.USER_REFERENCE2 as USER12_86_0_, resource2_.LOGIN_ATTEMPT as LOGIN13_86_0_, resource2_.GRACE_LOGIN as GRACE14_86_0_, resource2_.IS_FIRST_LOGIN as IS15_86_0_, resource2_.CHARGEABLE as CHARGEABLE86_0_, resource2_.LOCAL_ACCOUNT as LOCAL17_86_0_, resource2_.CREATED_BY as CREATED18_86_0_, resource2_.CREATED_ON as CREATED19_86_0_, resource3_.SYSTEM_ID as SYSTEM1_86_1_, resource3_.USER_ID as USER2_86_1_, resource3_.USER_NAME as USER3_86_1_, resource3_.USER_PASSWORD as USER4_86_1_, resource3_.USER_EMAIL_ADDRESS as USER5_86_1_, resource3_.IS_ENABLED as IS6_86_1_, resource3_.IS_INTERFACE_ACCOUNT as IS7_86_1_, resource3_.IS_DELETED as IS8_86_1_, resource3_.LAST_LOGIN as LAST9_86_1_, resource3_.LAST_PASSWORD_UPDATE as LAST10_86_1_, resource3_.USER_REFERENCE1 as USER11_86_1_, resource3_.USER_REFERENCE2 as USER12_86_1_, resource3_.LOGIN_ATTEMPT as LOGIN13_86_1_, resource3_.GRACE_LOGIN as GRACE14_86_1_, resource3_.IS_FIRST_LOGIN as IS15_86_1_, resource3_.CHARGEABLE as CHARGEABLE86_1_, resource3_.LOCAL_ACCOUNT as LOCAL17_86_1_, resource3_.CREATED_BY as CREATED18_86_1_, resource3_.CREATED_ON as CREATED19_86_1_ 
from CUSTOMER_INVOICE_LINE this_ 
where this_.INVOICE_HEADER_SYSTEMID=27074993
and this_.SHIPMENT_ORDER_SYSTEMID=27057351 
order by this_.LINE_NUMBER asc

/ dus query een invoiceline, die staat op invoice=27074993, en afkomstig van sho=27057351, 
/ en ze vragen ook in een subselect naar de sho id="SHO0000200', op een ingewikkelde manier	,

isbscs=# select 
(select sho.SHIPMENT_ORDER_ID 
                        from SHIPMENT_ORDER sho ,  CUSTOMER_INVOICE_LINE cil
                        where cil.SHIPMENT_ORDER_SYSTEMID = sho.SYSTEM_ID 
                        and cil.system_id = this_.SYSTEM_ID) 
from CUSTOMER_INVOICE_LINE this_
where this_.INVOICE_HEADER_SYSTEMID=26736467;
 shipment_order_id 
-------------------
 SH000000154
(1 row)
/ we hebben een andere sho gekozen, die wel invoice lines heeft		,

/ we kunnen ook	,
isbscs=# select sho.shipment_order_id 
from customer_invoice_line cil 
join shipment_order sho on cil.shipment_order_systemid=sho.system_id 
where cil.invoice_header_systemid=26736467;
 shipment_order_id 
-------------------
 SH000000154
(1 row)


/ Einde Intermezzo

	List<CustomerInvoiceLine> existingLines = serviceImpl.getCustomerInvoiceLineDAO().findLine(aHeader, aShipmentOrder);
		if (!existingLines.isEmpty()) {
/NEE	,
		} else {
			// create new one
			line = new CustomerInvoiceLine();
			line.setCreateDate(new Date());
			line.setCreatedBy(creator);
			line.setLineNumber(getNextLineNumber(aHeader));
/s
	protected int getNextLineNumber(CustomerInvoiceHeader aHeader) {
		int highestNumber = serviceImpl.getCustomerInvoiceLineDAO().getHighestLineNumber(aHeader);
/s
CustomerInvoiceLineDAOImpl.getHighestLineNumber(CustomerInvoiceHeader) line: 53	
		DetachedCriteria crit = DetachedCriteria.forClass(CustomerInvoiceLine.class);
		crit.add(Property.forName("invoiceHeader").eq(aHeader));
		crit.addOrder(Order.desc("lineNumber"));
		List<CustomerInvoiceLine> res = findByCriteria(crit, 0, 1);

/ Intermezzo

/ we zien dat line_number altijd verschillend is voor dezelfde sho	,
/ TODO

isbscs=# select*from customer_invoice_line order by invoice_header_systemid,line_number;
 system_id |       create_date       | created_by_systemid | shipment_order_systemid |     remarks     | line_number | invoice_header_systemid 
-----------+-------------------------+---------------------+-------------------------+-----------------+-------------+-------------------------
  27057305 | 2014-08-18 15:37:53.838 |            26594669 |                26729148 | #Colli: 0,      |          10 |                27057304
  27057308 | 2014-08-18 15:37:53.91  |            26594669 |                27055833 | #Colli: 0, null |          20 |                27057304
  27057311 | 2014-08-18 15:37:53.946 |            26594669 |                27056249 | #Colli: 0, null |          30 |                27057304
  27057314 | 2014-08-18 15:37:54.006 |            26594669 |                26714198 | #Colli: 0, null |          40 |                27057304
  27057317 | 2014-08-18 15:37:54.094 |            26594669 |                26738353 | #Colli: 0,      |          50 |                27057304
  27057320 | 2014-08-18 15:37:54.184 |            26594669 |                26733700 | #Colli: 0,      |          60 |                27057304
  27057323 | 2014-08-18 15:37:54.241 |            26594669 |                26698351 | #Colli: 0,      |          70 |                27057304
  27057328 | 2014-08-18 15:37:54.309 |            26594669 |                26731506 | #Colli: 0,      |          80 |                27057304
  27057331 | 2014-08-18 15:37:54.352 |            26594669 |                26714236 | #Colli: 0,      |          90 |                27057304
  27057412 | 2014-08-19 09:25:42.772 |            26691380 |                26711301 |                 |          10 |                27057411
  27057445 | 2014-08-19 15:04:30.99  |            26595013 |                27055833 | #Colli: 0, null |          10 |                27057444
  27057450 | 2014-08-19 15:04:31.039 |            26595013 |                27056249 | #Colli: 0, null |          20 |                27057444
  27057459 | 2014-08-19 15:11:06.972 |            26595013 |                27055833 |                 |          10 |                27057458
  27057467 | 2014-08-19 15:11:07.793 |            26595013 |                27056249 |                 |          10 |                27057466
...

/ we zien de query	,

select this_.SYSTEM_ID as SYSTEM1_236_2_, this_.CREATE_DATE as CREATE2_236_2_, this_.CREATED_BY_SYSTEMID as CREATED3_236_2_, this_.SHIPMENT_ORDER_SYSTEMID as SHIPMENT4_236_2_, this_.REMARKS as REMARKS236_2_, this_.LINE_NUMBER as LINE6_236_2_, this_.INVOICE_HEADER_SYSTEMID as INVOICE7_236_2_,
                        (select sho.SHIPMENT_ORDER_ID from SHIPMENT_ORDER sho ,  CUSTOMER_INVOICE_LINE cil where cil.SHIPMENT_ORDER_SYSTEMID = sho.SYSTEM_ID and
                        cil.system_id = this_.SYSTEM_ID)
                         as formula4_2_, resource2_.SYSTEM_ID as SYSTEM1_86_0_, resource2_.USER_ID as USER2_86_0_, resource2_.USER_NAME as USER3_86_0_, resource2_.USER_PASSWORD as USER4_86_0_, resource2_.USER_EMAIL_ADDRESS as USER5_86_0_, resource2_.IS_ENABLED as IS6_86_0_, resource2_.IS_INTERFACE_ACCOUNT as IS7_86_0_, resource2_.IS_DELETED as IS8_86_0_, resource2_.LAST_LOGIN as LAST9_86_0_, resource2_.LAST_PASSWORD_UPDATE as LAST10_86_0_, resource2_.USER_REFERENCE1 as USER11_86_0_, resource2_.USER_REFERENCE2 as USER12_86_0_, resource2_.LOGIN_ATTEMPT as LOGIN13_86_0_, resource2_.GRACE_LOGIN as GRACE14_86_0_, resource2_.IS_FIRST_LOGIN as IS15_86_0_, resource2_.CHARGEABLE as CHARGEABLE86_0_, resource2_.LOCAL_ACCOUNT as LOCAL17_86_0_, resource2_.CREATED_BY as CREATED18_86_0_, resource2_.CREATED_ON as CREATED19_86_0_, resource3_.SYSTEM_ID as SYSTEM1_86_1_, resource3_.USER_ID as USER2_86_1_, resource3_.USER_NAME as USER3_86_1_, resource3_.USER_PASSWORD as USER4_86_1_, resource3_.USER_EMAIL_ADDRESS as USER5_86_1_, resource3_.IS_ENABLED as IS6_86_1_, resource3_.IS_INTERFACE_ACCOUNT as IS7_86_1_, resource3_.IS_DELETED as IS8_86_1_, resource3_.LAST_LOGIN as LAST9_86_1_, resource3_.LAST_PASSWORD_UPDATE as LAST10_86_1_, resource3_.USER_REFERENCE1 as USER11_86_1_, resource3_.USER_REFERENCE2 as USER12_86_1_, resource3_.LOGIN_ATTEMPT as LOGIN13_86_1_, resource3_.GRACE_LOGIN as GRACE14_86_1_, resource3_.IS_FIRST_LOGIN as IS15_86_1_, resource3_.CHARGEABLE as CHARGEABLE86_1_, resource3_.LOCAL_ACCOUNT as LOCAL17_86_1_, resource3_.CREATED_BY as CREATED18_86_1_, resource3_.CREATED_ON as CREATED19_86_1_ 
from CUSTOMER_INVOICE_LINE this_ 
inner join TMS_USER resource2_ on this_.CREATED_BY_SYSTEMID=resource2_.SYSTEM_ID 
left outer join TMS_USER resource3_ on resource2_.CREATED_BY=resource3_.SYSTEM_ID 
where this_.INVOICE_HEADER_SYSTEMID=? 
order by this_.LINE_NUMBER desc limit ?
2014-12-17 15:42:46,402 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [1] as [INTEGER] - 27074993


/ we rm weer de 2 joins	,

select this_.SYSTEM_ID as SYSTEM1_236_2_, this_.CREATE_DATE as CREATE2_236_2_, this_.CREATED_BY_SYSTEMID as CREATED3_236_2_, this_.SHIPMENT_ORDER_SYSTEMID as SHIPMENT4_236_2_, this_.REMARKS as REMARKS236_2_, this_.LINE_NUMBER as LINE6_236_2_, this_.INVOICE_HEADER_SYSTEMID as INVOICE7_236_2_,
                        (select sho.SHIPMENT_ORDER_ID from SHIPMENT_ORDER sho ,  CUSTOMER_INVOICE_LINE cil where cil.SHIPMENT_ORDER_SYSTEMID = sho.SYSTEM_ID and
                        cil.system_id = this_.SYSTEM_ID)
                         as formula4_2_, resource2_.SYSTEM_ID as SYSTEM1_86_0_, resource2_.USER_ID as USER2_86_0_, resource2_.USER_NAME as USER3_86_0_, resource2_.USER_PASSWORD as USER4_86_0_, resource2_.USER_EMAIL_ADDRESS as USER5_86_0_, resource2_.IS_ENABLED as IS6_86_0_, resource2_.IS_INTERFACE_ACCOUNT as IS7_86_0_, resource2_.IS_DELETED as IS8_86_0_, resource2_.LAST_LOGIN as LAST9_86_0_, resource2_.LAST_PASSWORD_UPDATE as LAST10_86_0_, resource2_.USER_REFERENCE1 as USER11_86_0_, resource2_.USER_REFERENCE2 as USER12_86_0_, resource2_.LOGIN_ATTEMPT as LOGIN13_86_0_, resource2_.GRACE_LOGIN as GRACE14_86_0_, resource2_.IS_FIRST_LOGIN as IS15_86_0_, resource2_.CHARGEABLE as CHARGEABLE86_0_, resource2_.LOCAL_ACCOUNT as LOCAL17_86_0_, resource2_.CREATED_BY as CREATED18_86_0_, resource2_.CREATED_ON as CREATED19_86_0_, resource3_.SYSTEM_ID as SYSTEM1_86_1_, resource3_.USER_ID as USER2_86_1_, resource3_.USER_NAME as USER3_86_1_, resource3_.USER_PASSWORD as USER4_86_1_, resource3_.USER_EMAIL_ADDRESS as USER5_86_1_, resource3_.IS_ENABLED as IS6_86_1_, resource3_.IS_INTERFACE_ACCOUNT as IS7_86_1_, resource3_.IS_DELETED as IS8_86_1_, resource3_.LAST_LOGIN as LAST9_86_1_, resource3_.LAST_PASSWORD_UPDATE as LAST10_86_1_, resource3_.USER_REFERENCE1 as USER11_86_1_, resource3_.USER_REFERENCE2 as USER12_86_1_, resource3_.LOGIN_ATTEMPT as LOGIN13_86_1_, resource3_.GRACE_LOGIN as GRACE14_86_1_, resource3_.IS_FIRST_LOGIN as IS15_86_1_, resource3_.CHARGEABLE as CHARGEABLE86_1_, resource3_.LOCAL_ACCOUNT as LOCAL17_86_1_, resource3_.CREATED_BY as CREATED18_86_1_, resource3_.CREATED_ON as CREATED19_86_1_ 
from CUSTOMER_INVOICE_LINE this_ 
where this_.INVOICE_HEADER_SYSTEMID=27074993 
order by this_.LINE_NUMBER desc limit 1

/ Geen row	, 
/ Maar we oef	,

isbscs=# select  *
from CUSTOMER_INVOICE_LINE this_
where this_.INVOICE_HEADER_SYSTEMID= 27057304 order by this_.LINE_NUMBER desc;
 system_id |       create_date       | created_by_systemid | shipment_order_systemid |     remarks     | line_number | invoice_header_systemid 
-----------+-------------------------+---------------------+-------------------------+-----------------+-------------+-------------------------
  27057331 | 2014-08-18 15:37:54.352 |            26594669 |                26714236 | #Colli: 0,      |          90 |                27057304
  27057328 | 2014-08-18 15:37:54.309 |            26594669 |                26731506 | #Colli: 0,      |          80 |                27057304
  27057323 | 2014-08-18 15:37:54.241 |            26594669 |                26698351 | #Colli: 0,      |          70 |                27057304
  27057320 | 2014-08-18 15:37:54.184 |            26594669 |                26733700 | #Colli: 0,      |          60 |                27057304
  27057317 | 2014-08-18 15:37:54.094 |            26594669 |                26738353 | #Colli: 0,      |          50 |                27057304
  27057314 | 2014-08-18 15:37:54.006 |            26594669 |                26714198 | #Colli: 0, null |          40 |                27057304
  27057311 | 2014-08-18 15:37:53.946 |            26594669 |                27056249 | #Colli: 0, null |          30 |                27057304
  27057308 | 2014-08-18 15:37:53.91  |            26594669 |                27055833 | #Colli: 0, null |          20 |                27057304
  27057305 | 2014-08-18 15:37:53.838 |            26594669 |                26729148 | #Colli: 0,      |          10 |                27057304
(9 rows)

isbscs=# select  *
from CUSTOMER_INVOICE_LINE this_
where this_.INVOICE_HEADER_SYSTEMID= 27057304 order by this_.LINE_NUMBER desc limit 1;
 system_id |       create_date       | created_by_systemid | shipment_order_systemid |   remarks   | line_number | invoice_header_systemid 
-----------+-------------------------+---------------------+-------------------------+-------------+-------------+-------------------------
  27057331 | 2014-08-18 15:37:54.352 |            26594669 |                26714236 | #Colli: 0,  |          90 |                27057304
(1 row)

/ Die met het hoogste nummer inderdaad	,

/ Einde Intermezzo

		List<CustomerInvoiceLine> res = findByCriteria(crit, 0, 1);
/ d
		if (res.isEmpty()) {
/ JA
			return 0;
		}
		return res.get(0).getLineNumber();
/ NIET

/t
CustomerInvoiceGenerator.getNextLineNumber(CustomerInvoiceHeader) line: 724	
		int highestNumber = serviceImpl.getCustomerInvoiceLineDAO().getHighestLineNumber(aHeader);
/d
		return highestNumber + lineNumberIncrement;
10

/t
CustomerInvoiceGenerator.getInvoiceLine(CustomerInvoiceHeader, ShipmentOrderVO) line: 659	
			line.setLineNumber(getNextLineNumber(aHeader));
/d
			line.setShipmentOrder(aShipmentOrder);

/ logisch, een sho is een invoice line op een customer invoice	,

/s
	if (shipmentOrder != null) {
			shipmentOrderSystemId = shipmentOrder.getSystemId();
/ ashipmentOrder is een proxy	, initialized	,
27057351
			shipmentOrderId = shipmentOrder.getShipmentOrderId();
theShipmentOrderId	"SH000000200" (id=17457)	

			line.setInvoiceHeader(aHeader);
			aHeader.addInvoiceLine(line);
			line.setRemarks(remarkGenerator.generateRemark(line, aShipmentOrder));

/ HERHALING
			line = new CustomerInvoiceLine();
			line.setCreateDate(new Date());
			line.setCreatedBy(creator);
			line.setLineNumber(getNextLineNumber(aHeader));
			line.setShipmentOrder(aShipmentOrder);
			line.setInvoiceHeader(aHeader);
			aHeader.addInvoiceLine(line);
			line.setRemarks(remarkGenerator.generateRemark(line, aShipmentOrder));

/ Dit staat er op een line	,

/ Einde HERHALING

			serviceImpl.getCustomerInvoiceLineDAO().save(line);

/t
CustomerInvoiceGenerator.generateInvoice(ShipmentOrderVO, ShipmentOrderPricePartVO, InvoiceType, InvoiceTemplate) line: 501	
		CustomerInvoiceLine line = getInvoiceLine(header, aShipmentOrder);
/d
		CustomerInvoiceDetail detail = new CustomerInvoiceDetail();
		detail.setCreateDate(new Date());
		detail.setCreatedBy(creator);
		detail.setVatTariffType(getVatTariffType(header, aShipmentOrder));
/s
	protected VatTariffType getVatTariffType(CustomerInvoiceHeader aHeader, ShipmentOrderVO aShipmentOrder) {
		if (vatCalculator == null) {
			vatCalculator = new VatCalculator();
/s
	public VatCalculator() {
		CountryGroup euGroup = MpoBeanFactory.getBean(CountryGroupDAO.class).getByCode("EU-VAT");
/s
CountryGroupDAOImpl(EnumeratedValueObjectHibernateDAO<T>).getByCode(String, boolean) line: 69	
	public T getByCode(String aCode, boolean aShowDeleted) {
...
		map.put(CODE_FIELD, aCode);
...
		Collection<T> result = findEqualsWithQueryMap(map);
/s
	public Collection<Type> findEqualsWithQueryMap(Map<String, Object> aCriteriaQueryMap) {
		DetachedCriteria myDetachedCriteria = DetachedCriteria.forClass(type);
type	Class<T> (com.mpobjects.oms.model.entity.countrygroup.CountryGroup) (id=2040)	

		for (String myAttribute : aCriteriaQueryMap.keySet()) {
			myDetachedCriteria.add(Property.forName(myAttribute).eq(aCriteriaQueryMap.get(myAttribute)));
"code":"EU-VAT"
		}
		HibernateTemplate myTemplate = getHibernateTemplate();
		myTemplate.setCacheQueries(true);
		return myTemplate.findByCriteria(myDetachedCriteria);

/ gens	,
select countries0_.COUNTRY_GROUP_SYSTEMID as COUNTRY2_43_1_, countries0_.COUNTRY_SYSTEMID as COUNTRY1_1_, country1_.SYSTEM_ID as SYSTEM1_41_0_, country1_.IS_DELETED         as IS2_41_0_, country1_.COUNTRY_CODE as COUNTRY3_41_0_, country1_.COUNTRY_NAME as COUNTRY4_41_0_, country1_.CODEALPHA3         as CODEALPHA5_41_0_, country1_.CODENUMERIC as CODENUME6_41_0_, country1_.POSTAL_CODE_PATTERN as POSTAL7_41_0_ 
from COUNTRY_IN_GROUP countries0_ 
inner join COUNTRY country1_ on countries0_.COUNTRY_SYSTEMID=country1_.SYSTEM_ID 
where countries0_.COUNTRY_GROUP_SYSTEMID=?
 189895 2014-12-18 14:29:53,783 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter         [1] as [INTEGER] - 26607046

/ we doen zelf	,
isbscs=# select countries0_.COUNTRY_GROUP_SYSTEMID as COUNTRY2_43_1_, countries0_.COUNTRY_SYSTEMID as COUNTRY1_1_, country1_.SYSTEM_ID as SYSTEM1_41_0_, country1_.IS_DELETED         as IS2_41_0_, country1_.COUNTRY_CODE as COUNTRY3_41_0_, country1_.COUNTRY_NAME as COUNTRY4_41_0_, country1_.CODEALPHA3         as CODEALPHA5_41_0_, country1_.CODENUMERIC as CODENUME6_41_0_, country1_.POSTAL_CODE_PATTERN as POSTAL7_41_0_ 
isbscs-# from COUNTRY_IN_GROUP countries0_ 
isbscs-# inner join COUNTRY country1_ on countries0_.COUNTRY_SYSTEMID=country1_.SYSTEM_ID 
isbscs-# where countries0_.COUNTRY_GROUP_SYSTEMID=26607046;
 country2_43_1_ | country1_1_ | system1_41_0_ | is2_41_0_ | country3_41_0_ |  country4_41_0_  | codealpha5_41_0_ | codenume6_41_0_ | postal7_41_0_ 
----------------+-------------+---------------+-----------+----------------+------------------+------------------+-----------------+---------------
       26607046 |        4019 |          4019 |         0 | BE             | BELGIUM (EU)     |                  |                 | 
       26607046 |        4052 |          4052 |         0 | DE             | GERMANY (EU)     |                  |                 | 
       26607046 |        4069 |          4069 |         0 | FR             | FRANCE (EU)      |                  |                 | 
       26607046 |        4153 |          4153 |         0 | NL             | NETHERLANDS (EU) |                  |                 | 

/ we doen ook zelf	, 
isbscs=# select*from country_group;
 system_id | country_group | is_deleted |  description   
-----------+---------------+------------+----------------
  26594817 | EU            |          0 | European Union
  26607046 | EU-VAT        |          0 | VAT europe
  27067761 | TR            |          1 | NORTH
(3 rows)

/t
VatCalculator.<init>() line: 30	
		CountryGroup euGroup = MpoBeanFactory.getBean(CountryGroupDAO.class).getByCode("EU-VAT");
/d
		euCountries = euGroup.getCountries();
[SystemId:4069	isDeleted:false	Code:FR	Description:FRANCE (EU), 
SystemId:4052	isDeleted:false	Code:DE	Description:GERMANY (EU), 
SystemId:4153	isDeleted:false	Code:NL	Description:NETHERLANDS (EU), 
SystemId:4019	isDeleted:false	Code:BE	Description:BELGIUM (EU)]

/ Intermezzo

/ we zien geen lazy in 	,
$ vi CountryGroup.standard.hbm.xml

<hibernate-mapping>
        <class name="com.mpobjects.oms.model.entity.countrygroup.CountryGroup" table="COUNTRY_GROUP">
                <cache usage="read-write" />
                <id name="systemId" type="int" unsaved-value="0">
                        <column name="SYSTEM_ID" />
                        <generator class="com.mpobjects.core.model.HibernateIdGenerator" />
                </id>
                <property name="code" column="COUNTRY_GROUP" />
                <property name="description" column="DESCRIPTION" />
                <property name="deleted" column="IS_DELETED" />
                <set name="countries" table="COUNTRY_IN_GROUP" inverse="false">
                        <cache usage="read-write" />
                        <key column="COUNTRY_GROUP_SYSTEMID" />
                        <many-to-many column="COUNTRY_SYSTEMID"
                                class="com.mpobjects.oms.model.entity.country.Country" />
                </set>
 

/ LIE
/ Oef zelf met een getByCode() en kijk of je de coll krijgt	,
/ TODO

/ Einde Intermezzo

/t
CustomerInvoiceGenerator.getVatTariffType(CustomerInvoiceHeader, ShipmentOrderVO) line: 737	
		if (vatCalculator == null) {
			vatCalculator = new VatCalculator();

		VatTariffType result = vatCalculator.determineTariffType(
							aHeader.getInvoiceSender().getCountryVO(), 
							aHeader.getInvoiceReceiver().getCountryVO(),
							aShipmentOrder.getFromPartyVO().getCountryVO(), 
							aShipmentOrder.getToPartyVO().getCountryVO(),
							!StringUtils.isBlank(aHeader.getInvoiceReceiver().getVatNumber()));
/s
VatCalculator.determineTariffType(Country, Country, Country, Country, boolean) line: 58	
	public VatTariffType determineTariffType(Country aInvoiceSenderCountry, Country aInvoiceReceiverCountry, Country aShipFromCountry, Country aShipToCountry,
			boolean aCustomerVatKnown) {
aInvoiceSenderCountry	Country_$$_javassist_57  (id=17232)	
/ initialized true	,
aInvoiceReceiverCountry	Country_$$_javassist_57  (id=17232)	
aShipFromCountry	Country_$$_javassist_57  (id=17580)	
aShipToCountry	Country_$$_javassist_57  (id=17232)	
aCustomerVatKnown	true	

/ euCountries is een PersistentSet, uninitialized	,
		boolean isEUShipFrom = euCountries.contains(aShipFromCountry);
/ euCountries is nu initialized	,
true
		boolean isEUShipTo = euCountries.contains(aShipToCountry);
true
		boolean isEUSender = euCountries.contains(aInvoiceSenderCountry);
true
		boolean isEUReceive = euCountries.contains(aInvoiceReceiverCountry);
true
		} else if (aInvoiceSenderCountry.equals(aInvoiceReceiverCountry)) {
			if (isEUShipFrom && isEUShipTo) {
				myType = VatTariffType.HIGH;
		return myType;
/t
		return result;
/t
CustomerInvoiceGenerator.generateInvoice(ShipmentOrderVO, ShipmentOrderPricePartVO, InvoiceType, InvoiceTemplate) line: 506	
		detail.setVatTariffType(getVatTariffType(header, aShipmentOrder));

		for (CustomerInvoiceDetail subd : line.getInvoiceDetails()) {
/ NEE, 
/ is er niet	,
		detail.setLineNumber(detailLineNo + detailNumberIncrement);
/ 0+10
		detail.setPriceType(aPart.getPriceTypeVO());
/= aPart.rateComponentType
theSystemId: 27058858Code :Heating Costs
...

		BigDecimal amount = aPart.getAmount();
0.0000
		detail.setPricePart(aPart);

/ Klopt, we denken een invoice line detail = price part	,
///////////////////////////////////////////////////////////////
/ 

isbscs=# select*from shipment_order_price_part where system_id=27074940;
 system_id | shipment_order_systemid | correction_type | price_type_systemid | sequence_nr | reason | entry_type | amount  | cost_component_spec_systemid | invoice_status | invoice_reference | currency_systemid | source_ref |  status   
-----------+-------------------------+-----------------+---------------------+-------------+--------+------------+---------+------------------------------+----------------+-----------
  27074940 |                27057351 | ADD             |            27058858 |          10 |        | MANUAL     | 0.00000 |                              | NOT_INVOICED   |           
        |              7001 |            | ESTIMATED
(1 row)

		aPart.setInvoiceStatus(InvoiceStatus.CONCEPT);
///////////////////////////////////////

		aPart.setInvoiceReference(header.getInvoiceNumber());
invoiceNumber	"INV-102371" (id=17326)	
////////////////////////////////////////

		header.setInvoiceType(aInvoiceType);
INVOICE
		detail.setAmount(amount.setScale(2, RoundingMode.HALF_UP));
0.00
		detail.recalculateVat(header.getVatPolicy());
com.mpobjects.invoice.model.entity.vatpolicy.VatPolicy@12333a6a[NL VAT,Netherlands VAT]
/ TODO

		detail.setInvoiceLine(line);
		line.addInvoiceDetail(detail);
		detail.setRemarks(remarkGenerator.generateRemark(detail, aPart));
		// serviceImpl.getCustomerInvoiceDetailDAO().save(detail);

/ Intermezzo

/ See	,
		// serviceImpl.getCustomerInvoiceDetailDAO().save(detail);

/ LIE
$ vi CustomerInvoiceLine.standard.hbm.xml

<hibernate-mapping package="com.mpobjects.customerinvoice.model.entity">
	<class name="CustomerInvoiceLine" table="CUSTOMER_INVOICE_LINE">
		<set name="invoiceDetails" order-by="LINE_NUMBER" sort="com.mpobjects.customerinvoice.util.LineNumberComparator"
			cascade="all" lazy="false" batch-size="50">
...

/ WH zo de details saved	, 
/ probeer zelf	,

/ Einde Intermezzo

		serviceImpl.savePricePart(aPart);

/ aPart is price part uit (*)	,

/s
CustomerInvoiceServiceImpl.savePricePart(ShipmentOrderPricePartVO) line: 704	
			shipmentOrderPricePartDAO.saveShipmentOrderPricePart(aPricePart);
/s
ShipmentOrderPricePartDAOImpl.saveShipmentOrderPricePart(ShipmentOrderPricePartVO) line: 127	
			if (ShipmentOrderCostPartUtil.isCostAllocationEnabled()) {
				FactorBaseTypeVO factorBaseType = ShipmentOrderCostPartUtil.getShipmentOrderCostPartService().getFactorBaseTypeVO();
/s
ShipmentOrderCostPartServiceImpl.getFactorBaseTypeVO() line: 127	
	public FactorBaseTypeVO getFactorBaseTypeVO() {
		if (factorBaseType == null) {
			final String factorBaseTypeStr = ApplicationPropertyManager.getInstance().getModuleProperty("oms", "shipmentordercostpart.create.factorbasetype",
					FactorBaseTypeVO.TYPE_KG);
"KG"
			factorBaseType = MpoBeanFactory.getBean(FactorBaseTypeDAO.class).getByCode(factorBaseTypeStr);
/s
FactorBaseTypeDAOHibernate(GenericHibernateDAO<Type>).findEqualsWithQueryMap(Map<String,Object>) line: 223	
		DetachedCriteria myDetachedCriteria = DetachedCriteria.forClass(type);
type	Class<T> (com.mpobjects.oms.model.factorbasetype.vo.FactorBaseTypeVO) (id=12254)	

		for (String myAttribute : aCriteriaQueryMap.keySet()) {
			myDetachedCriteria.add(Property.forName(myAttribute).eq(aCriteriaQueryMap.get(myAttribute)));
code=KG


isbscs=# select*from factor_base_type;
 system_id |         code          |     description     | is_deleted 
-----------+-----------------------+---------------------+------------
         1 | KG                    | Weight in Kilograms |          0
         2 | LDM                   | Loading meters      |          0
         3 | M3                    | Cubic meters        |          0
         4 | PRICE_PART:PAY_WEIGHT | Pay Weight          |          0
         5 | PAY_WEIGHT            | Pay Weight          |          0
(5 rows)

/t
ShipmentOrderCostPartServiceImpl.getFactorBaseTypeVO() line: 128	
			factorBaseType = MpoBeanFactory.getBean(FactorBaseTypeDAO.class).getByCode(factorBaseTypeStr);
/d
	factorBaseType	FactorBaseTypeVO  (id=17772)	
		code	"KG" (id=17777)	
		costType	null	
		deleted	false	
		description	"Weight in Kilograms" (id=17779)	
		performanceMonitorService	null	
		priceType	null	
		systemId	1	

/t
ShipmentOrderPricePartDAOImpl.saveShipmentOrderPricePart(ShipmentOrderPricePartVO) line: 127	
				FactorBaseTypeVO factorBaseType = ShipmentOrderCostPartUtil.getShipmentOrderCostPartService().getFactorBaseTypeVO();
/d
factorBaseType	FactorBaseTypeVO  (id=17772)	
	code	"KG" (id=17777)	
	costType	null	
	deleted	false	
	description	"Weight in Kilograms" (id=17779)	
	performanceMonitorService	null	
	priceType	null	
	systemId	1	
				myMustRaiseEvent = factorBaseType.isTypePricePart()
/ NEE
/s
		return getCode().startsWith(TYPE_PRICE_PART);
"PRICE_PART"
						&& factorBaseType.getPriceType().equalsIgnoreCase(aShipmentOrderPricePart.getPriceTypeVO().getCode());
/ NIET	,

			aShipmentOrderPricePart = merge(aShipmentOrderPricePart);
/s
		if (anObject.getSystemId() == 0) {
/ NEE
		} else {
/ JA
/ SPUM 
			anObject = type.cast(getHibernateTemplate().merge(anObject));

aShipmentOrderPricePart	ShipmentOrderPricePartVO  (id=16729)	
	amount	BigDecimal  (id=17422)	
	componentType	RateComponentType  (id=17629)	
	correctionType	CorrectionType  (id=17657)	
	costPartSet	PersistentSet  (id=17658)	
	currency	CurrencyVO_$$_javassist_133  (id=17245)	
	entryType	EntryType  (id=17661)	
	invoiceReference	"INV-102371" (id=17326)	
	invoiceStatus	InvoiceStatus  (id=17720)	
	performanceMonitorService	null	
	reason	"" (id=17668)	
	sequenceNr	10	
	shipmentOrder	ShipmentOrderVO_$$_javassist_135  (id=16707)	
	sourceRef	null	
	status	RatePartStatus  (id=17673)	
	systemId	27074940	

/t
CustomerInvoiceServiceImpl.savePricePart(ShipmentOrderPricePartVO) line: 704	
			shipmentOrderPricePartDAO.saveShipmentOrderPricePart(aPricePart);
/d
/ Deed een merge	,


/t
CustomerInvoiceGenerator.generateInvoice(ShipmentOrderVO, ShipmentOrderPricePartVO, InvoiceType, InvoiceTemplate) line: 540	
		serviceImpl.savePricePart(aPart);
/d

		// Generate extra price part in actual status so that those can be shown in that tab
/ TODO
		ShipmentOrderPricePartVO actualPricePart = (ShipmentOrderPricePartVO) aPart.clone();
/ Deze heeft systemId==0
/ TODO
		if (!aInvoiceType.equals(InvoiceType.CREDIT_NOTE)) {
/ JA
			actualPricePart.setInvoiceStatus(InvoiceStatus.INVOICED);
/ CONCEPT-> INVOICED
		actualPricePart.setStatus(RatePartStatus.ACTUAL);
status	RatePartStatus  (id=17938)	
ACTUAL
		serviceImpl.savePricePart(actualPricePart);
...
/s
ShipmentOrderPricePartDAOImpl.saveShipmentOrderPricePart(ShipmentOrderPricePartVO) line: 137	
		aShipmentOrderPricePart = merge(aShipmentOrderPricePart);
/s
ShipmentOrderPricePartDAOImpl(GenericHibernateDAO<Type>).merge(Type) line: 411	
	public Type merge(Type anObject) {
anObject	ShipmentOrderPricePartVO  (id=17933)	

		if (anObject.getSystemId() == 0) {
/ JA
			getHibernateTemplate().persist(anObject);

isbscs=# select*from shipment_order_price_part where status='ACTUAL' and invoice_reference='INV-102374';
/ TODO
/ NIETS	,

/t
CustomerInvoiceGenerator.generateInvoice(Collection<ShipmentOrderVO>, InvoiceTemplate) line: 247	

/ Terug bij (*)	,
			for (ShipmentOrderPricePartVO part : myShipmentOrderVO.getShipmentOrderPricePartList()) {
/ Volgende	,
						generateInvoice(myShipmentOrderVO, part);
/s
CustomerInvoiceGenerator.generateInvoice(ShipmentOrderVO, ShipmentOrderPricePartVO, InvoiceType, InvoiceTemplate) line: 447	
		InvoiceTemplate myInvoiceTemplate = invoiceTemplateService.resolveTemplate(aPart, aInvoiceType);
/ invoiceType=INVOICE
/ initialized H. proxy	,
/s
CustomerInvoiceGenerator.generateInvoice(ShipmentOrderVO, ShipmentOrderPricePartVO, InvoiceType, InvoiceTemplate) line: 443	

/ Intermezzo

/ LIE
CustomerInvoiceGenerator  (id=15769)	
	invoiceTemplateService	$Proxy344  (id=15885)	
	serviceImpl	CustomerInvoiceServiceImpl  (id=15763)	
/  TODO

/ Einde Intermezzo

		CustomerInvoiceLine line = getInvoiceLine(header, aShipmentOrder);
/s
CustomerInvoiceGenerator.getInvoiceLine(CustomerInvoiceHeader, ShipmentOrderVO) line: 645	
	protected CustomerInvoiceLine getInvoiceLine(CustomerInvoiceHeader aHeader, ShipmentOrderVO aShipmentOrder) {
		Map<Integer, CustomerInvoiceLine> cache = lineCache.get(aHeader);

/ cache= {27057351=com.mpobjects.customerinvoice.model.entity.CustomerInvoiceLine/id:27075217}
/ key is sho	, logisch	, want een invoice line op een invoice is een sho	,

		CustomerInvoiceLine line;

		if (cache != null) {
			line = cache.get(aShipmentOrder.getSystemId());
			if (line != null) {
/ JA
				return line;

/t
CustomerInvoiceGenerator.generateInvoice(ShipmentOrderVO, ShipmentOrderPricePartVO, InvoiceType, InvoiceTemplate) line: 501	
		CustomerInvoiceLine line = getInvoiceLine(header, aShipmentOrder);
/d
		CustomerInvoiceDetail detail = new CustomerInvoiceDetail();
...
		for (CustomerInvoiceDetail subd : line.getInvoiceDetails()) {
			detailLineNo = Math.max(detailLineNo, subd.getLineNumber());
10
		detail.setLineNumber(detailLineNo + detailNumberIncrement);
20
		detail.setPriceType(aPart.getPriceTypeVO());
detail	CustomerInvoiceDetail  (id=16664)	
	priceType	RateComponentType  (id=16143)	
	priceTypeSystemId	Integer  (id=16705)	

		detail.setPricePart(aPart);
/ logisch, een line op een invoice is een sho, en een detail is een price part	,

		detail.setInvoiceLine(line);
		line.addInvoiceDetail(detail);

		serviceImpl.savePricePart(aPart);
/s
			shipmentOrderPricePartDAO.saveShipmentOrderPricePart(aPricePart);
/s
			aShipmentOrderPricePart = merge(aShipmentOrderPricePart);
/ aShipmentOrderPricePart heeft een systemId	,
/ TODO
/s
		if (anObject.getSystemId() == 0) {
/ NEE
			getHibernateTemplate().persist(anObject);
		} else {
/ JA
/ SPUM 
/ TODO
			anObject = type.cast(getHibernateTemplate().merge(anObject));

/t
CustomerInvoiceGenerator.generateInvoice(ShipmentOrderVO, ShipmentOrderPricePartVO, InvoiceType, InvoiceTemplate) line: 542	
		if (!aInvoiceType.equals(InvoiceType.CREDIT_NOTE)) {
/ JA
			actualPricePart.setInvoiceStatus(InvoiceStatus.INVOICED);

		actualPricePart.setStatus(RatePartStatus.ACTUAL);
		serviceImpl.savePricePart(actualPricePart);
/s
ShipmentOrderPricePartDAOImpl.saveShipmentOrderPricePart(ShipmentOrderPricePartVO) line: 137	
			aShipmentOrderPricePart = merge(aShipmentOrderPricePart);
aShipmentOrderPricePart	ShipmentOrderPricePartVO  (id=17003)	
	systemId	0	
/ TODO
/s
		if (anObject.getSystemId() == 0) {
/ JA
			getHibernateTemplate().persist(anObject);
/ Nu heeft de price part weer een systemId	,
/ TODO

/t
/ (*)
CustomerInvoiceGenerator.generateInvoice(Collection<ShipmentOrderVO>, InvoiceTemplate) line: 247	
		for (ShipmentOrderVO myShipmentOrderVO : aShipmentOrderList) {
			for (ShipmentOrderPricePartVO part : myShipmentOrderVO.getShipmentOrderPricePartList()) {

/ Volgende,

						generateInvoice(myShipmentOrderVO, part);


/ 7	.

/ Finance, customer invoice, search invoices	,

/ geef INV-102375	,

/ 13	. 

/ we zien header.CIHListPage	,
public class CIHListPage extends BaseContextPage {
/ dit is 'Customer Invoices'	,
/ In CIHListPage.html
	<wicket:extend>
		<div wicket:id="feedback"></div>
		<div wicket:id="searchList"></div>
		<div style="height:10px"/>
		<form wicket:id="createForm">
			<button wicket:id="createButton" class="icon icon_new" wicket:message="title:create">
				<span><wicket:message key="create">Create new</wicket:message></span></button>
		</form>
		<wicket:child />
	</wicket:extend>

/ In BasePage.html
<body wicket:id="pageId">
	<div class="wicketPage">
		<wicket:child />
	</div>
...
</body>

/ TORM
/ BaseContextPage.java/.html moeten we  RM	,
/ CIHListPage.html : <wicket:panel> moet eruit	,
/ GenericListPanel.html : <wicket:panel> moet eruit	,

/ 13	. 

/ het search panel

/ In de <div id="searchList"> zit een form	,

/ In CIHListPage.java zien we 
		searchListPanel = new CIHSearchListPanel("searchList", null, webComponentEventSwitchBoard, daoWrapper);

/ we zien hieronder dat het inderdaad een panel is	, 

public class CIHSearchListPanel extends GenericListPanel<CustomerInvoiceHeader> {
...
/ we zien GEEN  CIHSearchListPanel.html	,
/ er is WEL een GenericListPanel.html	,

/ In GenericListPanel.java	,
	<wicket:extend>
		<div wicket:id="status" class="status">[[status messages]]</div>
		<form class="genericListPanelForm" wicket:id="filterForm" name="genericListPanelForm" id="genericListPanelForm">
...
/ Dus wicket:id="filterForm"	,

/ In GenericListPanel.java
	protected void makeTable(List<IColumn> aColumnsList) {
...
		filterForm = new FilterForm("filterForm", dataProvider);


/ Dus er is een parent,	
abstract public class GenericListPanel<T extends EntityInterface> extends BaseWebComponent {

/ we zien BaseWebComponent.html
<wicket:panel>
	<wicket:child/>
</wicket:panel>
/ Dit is OK	, 
/ hier zien we dus dat SearchListPanel inderdaad een panel is	,

/ Maar BaseContextPage.html is anders, en moet RM, want	, 
<wicket:extend>
	<wicket:child/>
</wicket:extend>

/ en	,
abstract public class BaseWebComponent extends Panel implements WebComponentListener, Serializable {
/ Als de .html begint met <wicket:panel>	, dan  daarom is de class type extends Panel	, 

/ we zien	,
<div wicket:id="searchList">
	<wicket:panel>
		<wicket:extend>
			<wicket:child>

/ 13	. 

CIHListPage.createListPanel() line: 73	
		searchListPanel = new CIHSearchListPanel("searchList", null, webComponentEventSwitchBoard, daoWrapper);
		searchListPanel.setPanelBuilder(new EntityListActionBuilder<CustomerInvoiceHeader>(getPanelActions()));
/ 1 action
		searchListPanel.setEntityGroupActions(getGroupActions());
/ 1 action
/d
		searchListPanel.initialize();
/s
CIHSearchListPanel(GenericListPanel<T>).initialize() line: 244	
		dataProvider = tableDataProviderBuilder.build(daoWrapper, getDefaultSortPropertyName());
/ daoWrapper is CustomerInvoiceHeaderDAOImpl	,

//////////////////////////////////////////////////////////////////////////
/ we geven alvast het result	,
dataProvider	GenericTableDataProvider  (id=18816)	
	daoWrapper	BeanWrapper  (id=18815)	
com.mpobjects.view.wicket.util.BeanWrapper@7ccdf35f[type=interface com.mpobjects.customerinvoice.dao.CustomerInvoiceHeaderDAO,beanName=<null>]
	filter	GenericTableDataProvider$FilterStateFilterExpression  (id=18819)	
		legacyFilterObject	CustomerInvoiceHeader  (id=18852)	
com.mpobjects.customerinvoice.model.entity.CustomerInvoiceHeader/id:0

/ dus dataProvider gaat customer invoice header's query (see de daoWrapper)	,
//////////////////////////////////////////////////////////////////////////




/s
GenericTableDataProvider$Builder<U>.build(BeanWrapper<BaseDAOInterface<U>>, String) line: 36	
			return new GenericTableDataProvider<U>(daoWrapper, defaultSortProperty);
/s
GenericTableDataProvider<T>.<init>(BeanWrapper<BaseDAOInterface<T>>, String) line: 178	
		resetFilterState();
/s
GenericTableDataProvider<T>.resetFilterState() line: 237	
		filter = new FilterStateFilterExpression();
/s
GenericTableDataProvider$FilterStateFilterExpression.<init>(GenericTableDataProvider) line: 61	
			legacyFilterObject = daoWrapper.getBean().createNewObject();

/////////////////////////////////////////////////////////////////
/ Dit filter obj wordt dus een customer invoice header 
/ van deze (obj) wordt 	,
	obj.setStatus(status);
	obj.setCreatedBy(ResourceUtil.getResource());
	obj.setOrganization(...



/s
/ tx
CustomerInvoiceHeaderDAOImpl.createNewObject() line: 40	
		CustomerInvoiceHeader obj = super.createNewObject();
/c return type.newInstance();
		CustomerInvoiceHeaderStatusDAO dao = MpoBeanFactory.getBean(CustomerInvoiceHeaderStatusDAO.class);
/ is Spring proxy to com.mpobjects.customerinvoice.dao.CustomerInvoiceHeaderStatusDAOImpl@725827da

		CustomerInvoiceHeaderStatus status = dao.getByCode(CustomerInvoiceHeaderStatus.CONCEPT);
/s
CustomerInvoiceHeaderStatusDAOImpl(EnumeratedValueObjectHibernateDAO<T>).getByCode(String) line: 58	
...
		Collection<T> result = findEqualsWithQueryMap(map);
/s
CustomerInvoiceHeaderStatusDAOImpl(GenericHibernateDAO<Type>).findEqualsWithQueryMap(Map<String,Object>) line: 223	
		DetachedCriteria myDetachedCriteria = DetachedCriteria.forClass(type);
...
		return myTemplate.findByCriteria(myDetachedCriteria);

/ we zien	,

select this_.SYSTEM_ID as SYSTEM1_235_0_, this_.CODE as CODE235_0_, this_.DESCRIPTION as DESCRIPT3_235_0_, this_.IS_DELETED as IS4_235_0_ 
from CUSTOMER_INVOICE_HEADER_STATUS this_ 
where this_.IS_DELETED=? and this_.CODE=?
  81535 2015-01-08 10:33:32,671 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2        :) binding parameter [1] as [BIT] - false
  81537 2015-01-08 10:33:32,671 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2        :) binding parameter [2] as [VARCHAR] - CONCEPT


/ we doen zelf	,
isbscs=# select *from customer_invoice_header_status;
 system_id |       code       |         description         | is_deleted 
-----------+------------------+-----------------------------+------------
    554404 | CANCELLED        | CANCELLED                   |          0
  26613077 | CONCEPT          | Concept                     |          0
  26613078 | APPROVED         | Approved                    |          0
  26727974 | GENERATING       | Invoice is being generated. |          0
  26613079 | SENT_TO_CUSTOMER | Sent to Customer            |          0
  26727975 | PAID             | Paid                        |          0
  26727976 | PARTIALLY_PAID   | Partially Paid              |          0
(7 rows)

/ dus	,
  26613077 | CONCEPT          | Concept                     |          0

/t
CustomerInvoiceHeaderDAOImpl.createNewObject() line: 40	
			CustomerInvoiceHeaderStatus status = dao.getByCode(CustomerInvoiceHeaderStatus.CONCEPT);
/d
			} else {
				obj.setStatus(status);
this	CustomerInvoiceHeaderDAOImpl  (id=630)	
obj	CustomerInvoiceHeader  (id=635)	
status	CustomerInvoiceHeaderStatus  (id=714)	
	code	"CONCEPT" (id=723)	
	deleted	false	
	description	"Concept" (id=726)	
	performanceMonitorService	null	
	systemId	26613077	

			obj.setCreatedBy(ResourceUtil.getResource());
			obj.setOrganization(MpoBeanFactory.getBean(OrganizationDAO.class).getByCode(obj.getCreatedBy().getActiveOrganization().getCode()));
/s
	public Organization getActiveOrganization() {
		if (activeOrganization == null) {
/ JA
			loadOrganizations();
/s
Resource.loadOrganizations() line: 873	
			for (UserOrganization myUO : getUserOrganizations()) {
[eric, ISB, true, true, 
eric, ISB-ARGOS, true, false, 
eric, ISB-C&S, true, false, 
eric, ISB-CPP, true, false, 
eric, ISB-VEGOIL, true, false, 
eric, MPO-CUST, true, false]
...
			setOrganizations(myOrganizations);
[SystemId:500	Id:ISB	Description:Interstream Barging, 
SystemId:540	Id:ISB-ARGOS	Description:Interstream Barging BU Argos, 
SystemId:520	Id:ISB-C&S	Description:Interstream Barging BU Chemicalien, 
SystemId:510	Id:ISB-CPP	Description:Interstream Barging BU Mineralen, 
SystemId:530	Id:ISB-VEGOIL	Description:Interstream Barging BU Vegetable Oils, 
SystemId:3150	Id:MPO-CUST	Description:MP Objects]
			setActivatableOrganizations(myActivatableOrganizations);
[SystemId:500	Id:ISB	Description:Interstream Barging, 
SystemId:540	Id:ISB-ARGOS	Description:Interstream Barging BU Argos, 
SystemId:520	Id:ISB-C&S	Description:Interstream Barging BU Chemicalien, 
SystemId:510	Id:ISB-CPP	Description:Interstream Barging BU Mineralen, 
SystemId:530	Id:ISB-VEGOIL	Description:Interstream Barging BU Vegetable Oils, 
SystemId:3150	Id:MPO-CUST	Description:MP Objects]

				if (myUO.isActive()) {
/ ISB
					activeOrganization = myOrganization;


/t
Resource.getActiveOrganization() line: 254	
			loadOrganizations();
/d
		return activeOrganization;
SystemId:500	Id:ISB	Description:Interstream Barging, 

/t
CustomerInvoiceHeaderDAOImpl.createNewObject() line: 53	
			obj.setOrganization(MpoBeanFactory.getBean(OrganizationDAO.class).getByCode(obj.getCreatedBy().getActiveOrganization().getCode()));
/ obj=CustomerInvoiceHeader inst	,
/ .getCode()='ISB'	,
/s
ResourceDAOHibernate(EnumeratedValueObjectHibernateDAO<T>).getByCode(String) line: 58	
/s
OrganizationDAOImpl.getByCode(String) line: 94	
		List myOrgList = getHibernateTemplate().findByCriteria(
				DetachedCriteria.forClass(Organization.class).add(Property.forName("organizationId").eq(anOrganizationCode)));


/ SPUM
/ we voegen code line toe	,
OrganizationDAOImpl.getByCode(String) line: 95	
		CacheManager.getInstance().clearAll();
		List myOrgList = getHibernateTemplate().findByCriteria(
				DetachedCriteria.forClass(Organization.class).add(Property.forName("organizationId").eq(anOrganizationCode)));

/ we zien	,
select ... 
from ORGANIZATION this_ 
left outer join ORGANIZATION organizati2_ on this_.ORGANIZATION_GROUP=organizati2_.SYSTEM_ID 
where this_.system_id in (
	select uo.organization_systemid 
	from user_organization uo 
	where uo.user_systemid = ?) 
and this_.ORGANIZATION_ID=?
2015-01-08 13:20:15,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-4:) binding parameter [1] as [INTEGER] - 27074281
2015-01-08 13:20:15,355 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-4:) binding parameter [2] as [VARCHAR] - ISB


/ we doen zelf	,
select * 
from ORGANIZATION this_ 
left outer join ORGANIZATION organizati2_ on this_.ORGANIZATION_GROUP=organizati2_.SYSTEM_ID 
where this_.system_id in (
        select uo.organization_systemid 
        from user_organization uo 
        where uo.user_systemid = 27074281) 
and this_.ORGANIZATION_ID='ISB'

/ 27074281 is de system_id in tms_user van user_id='eric'	,

/ SPUM
/ Waarom deze join	?

/ bij ISB komt door outer join er een lege organization bij	,
/ ISB-VEGOIL  heeft  organization_group=500	, dus komt ISB organization erbij	,
/ TODO

/t
CustomerInvoiceHeaderDAOImpl.createNewObject() line: 53	
			obj.setOrganization(MpoBeanFactory.getBean(OrganizationDAO.class).getByCode(obj.getCreatedBy().getActiveOrganization().getCode()));

/t
GenericTableDataProvider$FilterStateFilterExpression.<init>(GenericTableDataProvider) line: 61	
			legacyFilterObject = daoWrapper.getBean().createNewObject();
/d
/t
GenericTableDataProvider.resetFilterState() line: 237	
		filter = new FilterStateFilterExpression();
/d
/t
GenericTableDataProvider.<init>(BeanWrapper<BaseDAOInterface<T>>, String) line: 179	
		resetFilterState();
/d
/t
CIHSearchListPanel(GenericListPanel).initialize() line: 246	
		dataProvider = tableDataProviderBuilder.build(daoWrapper, getDefaultSortPropertyName());
/d
//////////////////////////////////////////////////////////////////////////
dataProvider	GenericTableDataProvider  (id=18816)	
	daoWrapper	BeanWrapper  (id=18815)	
com.mpobjects.view.wicket.util.BeanWrapper@7ccdf35f[type=interface com.mpobjects.customerinvoice.dao.CustomerInvoiceHeaderDAO,beanName=<null>]
	filter	GenericTableDataProvider$FilterStateFilterExpression  (id=18819)	
		legacyFilterObject	CustomerInvoiceHeader  (id=18852)	
com.mpobjects.customerinvoice.model.entity.CustomerInvoiceHeader/id:0

/ dus dataProvider gaat customer invoice header's query (see de daoWrapper)	,
//////////////////////////////////////////////////////////////////////////

/d
IHSearchListPanel(GenericListPanel).initialize() line: 246	
		dataProvider = tableDataProviderBuilder.build(daoWrapper, getDefaultSortPropertyName());
/d
		Model<String> filterColTitle = new IModel<String>() {
		...
		myColumnsList.add(new FilteredAbstractColumn(filterColTitle) {
			@Override
			public Component getFilter(final String componentId, final FilterForm form) {
			...
			@Override
			public void populateItem(final Item cellItem, final String componentId, final IModel model) {
			...

/ myColumnsList zijn de columns voor een table, die we hieronder gaan maken	,
/ we hebben een column add aan de list, dit is de 1ste column met 'Filter' erboven	,

/ FilteredAbstractColumn is in wicket-extensions	,
[eric@localhost repository]$ jar tvf org/apache/wicket/wicket-extensions/7.0.0-M4/wicket-extensions-7.0.0-M4.jar | grep FilteredAbstractColumn
  1560 Fri Oct 31 14:19:18 CET 2014 org/apache/wicket/extensions/markup/html/repeater/data/table/filter/FilteredAbstractColumn.class

/ FilteredAbstractColumn implements 
	IFilteredColumn , 	getFilter	,
	ICellPopulator	,	populateItem	,

		addFilterColumns(myColumnsList);
CIHSearchListPanel.addFilterColumns(List<IColumn>) line: 50	
	aColumnList.add(new ConfigurableTextFilteredPropertyColumn<String>(new ResourceModel(CustomerInvoiceHeaderConst.INVOICE_NUMBER), CustomerInvoiceHeaderConst.INVOICE_NUMBER, CustomerInvoiceHeaderConst.INVOICE_NUMBER, new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<String>(10)));
...

/ Intermezzo

/ er zijn 

java.lang.Object
org.apache.wicket.extensions.markup.html.repeater.data.table.AbstractColumn<T,S>
org.apache.wicket.extensions.markup.html.repeater.data.table.filter.FilteredAbstractColumn<T,S>

/ en 	,

java.lang.Object
org.apache.wicket.extensions.markup.html.repeater.data.table.AbstractColumn<T,S>
org.apache.wicket.extensions.markup.html.repeater.data.table.PropertyColumn<T,S>
org.apache.wicket.extensions.markup.html.repeater.data.table.filter.FilteredPropertyColumn<T,S>

/ Einde Intermezzo

/t
		columns.addAll(myColumnsList);

		makeTable(myColumnsList);
/s
CIHSearchListPanel(GenericListPanel).makeTable(List<IColumn>) line: 445	
		objectDataTable = getDefaultDataTable(aColumnsList);
/s
CIHSearchListPanel(GenericListPanel).getDefaultDataTable(List<IColumn>) line: 411	
		return new DefaultDataTable("objectTable", aColumnsList, dataProvider, getListLength());

/ See in wicket examples, repeater, DataTabelPage	,

/ DefaultDataTable  is in wicket extensions	,
[eric@localhost repository]$ jar tvf org/apache/wicket/wicket-extensions/7.0.0-M4/wicket-extensions-7.0.0-M4.jar | grep DefaultDataTable
  3119 Fri Oct 31 14:19:18 CET 2014 org/apache/wicket/extensions/ajax/markup/html/repeater/data/table/AjaxFallbackDefaultDataTable.class
  2920 Fri Oct 31 14:19:18 CET 2014 org/apache/wicket/extensions/markup/html/repeater/data/table/DefaultDataTable.class

/t
CIHSearchListPanel(GenericListPanel).makeTable(List<IColumn>) line: 448	
		objectDataTable = getDefaultDataTable(aColumnsList);
/d
		filterForm = new FilterForm("filterForm", dataProvider);
		if (isFilterOn()) {
			objectDataTable.addTopToolbar(new FilterToolbar(objectDataTable, filterForm, dataProvider));
/ via new FilterToolbar	,
/ TODO
/s
GenericListPanel$2.getFilter(String, FilterForm) line: 275	
			@Override
			public Component getFilter(final String componentId, final FilterForm form) {
->				ResetableGoAndClearFilter resetableGoAndClearFilter = new ResetableGoAndClearFilter(componentId, form, dataProvider, GenericListPanel.this);

/t
CIHSearchListPanel(GenericListPanel).makeTable(List<IColumn>) line: 453	
			objectDataTable.addTopToolbar(new FilterToolbar(objectDataTable, filterForm, dataProvider));
/d
...
		addOrReplace(filterForm);
/ 'n MarkupContainer method	, 
/ klopt	,
this	CIHSearchListPanel  (id=17396)	

/ 7	. 

/ we geven INV-102377	, en click filter button (GoFilter)	,

/ we vallen in	,
GenericTableDataProvider.iterator(int, int) line: 226	
/s
CustomerInvoiceHeaderDAOImpl(GenericHibernateDAO).runQuery(QueryParam, DAOFilterExpression<Type>) line: 430	
		DetachedCriteria myDetachedCriteria = prepareCriteria(filter.getLegacyFilter(), mySubMap);
		createCriteria(myDetachedCriteria, filter, mySubMap);
		...
		List<Type> myList = getHibernateTemplate().findByCriteria(myDetachedCriteria, queryParam.getFirst(), queryParam.getCount());
[com.mpobjects.customerinvoice.model.entity.CustomerInvoiceHeader/id:27075272]

/ we zien	,
/ SPUM
 select * 
from CUSTOMER_INVOICE_HEADER this_ 
inner join TMS_USER resource2_ on this_.CREATED_BY_SYSTEMID=resource2_.SYSTEM_ID 
left outer join TMS_USER resource3_ on resource2_.CREATED_BY=resource3_.SYSTEM_ID 
inner join ORGANIZATION organizati4_ on this_.ORGANIZATION_SYSTEMID=organizati4_.SYSTEM_ID 
left outer join ORGANIZATION organizati5_ on organizati4_.ORGANIZATION_GROUP=organizati5_.SYSTEM_ID 
left outer join INVOICE_FINANCIAL_PARTY financialp6_ on this_.INVOICE_RECEIVER_SYSTEMID=financialp6_.SYSTEM_ID 
left outer join INVOICE_FINANCIAL_PARTY financialp7_ on this_.INVOICE_SENDER_SYSTEMID=financialp7_.SYSTEM_ID 
left outer join TMS_USER resource8_ on this_.APPROVED_BY_SYSTEMID=resource8_.SYSTEM_ID 
where this_.ORGANIZATION_SYSTEMID in (
	select uo.organization_systemid from user_organization uo where uo.user_systemid = ?) 
and lower(this_.INVOICE_NUMBER) like ? 
order by this_.INVOICE_DATE asc limit ?
015-01-09 14:08:10,480 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:) binding parameter [1] as [INTEGER] - 27074281 
2015-01-09 14:08:10,480 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:) binding parameter [1] as [INTEGER] - 27074281
2015-01-09 14:08:10,481 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:) binding parameter [2] as [VARCHAR] - %inv-102377%

/ 7	. 

/ we click de edit button op de customer invoice header row (de enigste)	,

/ we vallen in	,
CIHListPage$3.onSubmit(Button, IModel<CustomerInvoiceHeader>) line: 149	

	protected void createListPanel() {
		searchListPanel = new CIHSearchListPanel("searchList", null, webComponentEventSwitchBoard, daoWrapper);
		searchListPanel.setPanelBuilder(new EntityListActionBuilder<CustomerInvoiceHeader>(getPanelActions()));
		searchListPanel.setEntityGroupActions(getGroupActions());
		searchListPanel.initialize();
		add(searchListPanel);
	}

	protected Collection<EntityAction<CustomerInvoiceHeader>> getPanelActions() {
		List<EntityAction<CustomerInvoiceHeader>> actions = new ArrayList<EntityAction<CustomerInvoiceHeader>>();
		EntityActionButton<CustomerInvoiceHeader> editAction = new EntityActionButton<CustomerInvoiceHeader>("edit", new ResourceModel("edit").wrapOnAssignment(CIHListPage.this)) {
			@Override
			protected void onSubmit(Button aButton, IModel<CustomerInvoiceHeader> aSelection) {
->				CIHEditPage page = getEditPage();


/ searchListPanel "searchList" contains het form , "alles, behalve de create button"	,
/ de button op de customer invoice header row is WH een submit button	,

/ s
CIHEditPage.createPage() line: 271	
		createHeaderEditPanel();
/ bovenste panel	,

		/** Lines stuff */
		lineDaoWrapper = new BeanWrapper(CustomerInvoiceLineDAO.class);
		linePanel = new CILinePanel("linePanel");
		createLineSearchPanel();
/s
CIHEditPage.createLineSearchPanel() line: 236	
		lineListPanel.setPanelBuilder(new EntityListActionBuilder<CustomerInvoiceLine>(getLineListActions()));

/ we zien op de row in de line panel links 3 buttons, ok, edit, delete	,
/s
CIHEditPage.getLineListActions() line: 662	
	List<EntityAction<CustomerInvoiceLine>> myActionList = new ArrayList<EntityAction<CustomerInvoiceLine>>();

		EntityActionButton<CustomerInvoiceLine> mySelectBtn = new EntityActionButton<CustomerInvoiceLine>("ok",
				new ResourceModel("selectLine").wrapOnAssignment(CIHEditPage.this)) {
			@Override
			protected void onSubmit(Button aButton, IModel<CustomerInvoiceLine> aSelection) {
				...

		EntityActionButton<CustomerInvoiceLine> myEditBtn = new EntityActionButton<CustomerInvoiceLine>("edit",
				new ResourceModel("editviewLine").wrapOnAssignment(CIHEditPage.this)) {
			@Override
			protected void onSubmit(Button aButton, IModel<CustomerInvoiceLine> aSelection) {
				...

		EntityActionButton<CustomerInvoiceLine> myDeleteBtn = new EntityActionButton<CustomerInvoiceLine>("delete",
				new ResourceModel("deleteLine").wrapOnAssignment(CIHEditPage.this)) {
			@Override
			protected Button createButton(IModel<CustomerInvoiceLine> aModel, String aId) {
				...

/t
		lineListPanel.initialize();
/s
CILineListPanel(GenericListPanel).initialize() line: 236	
		dataProvider = tableDataProviderBuilder.build(daoWrapper, getDefaultSortPropertyName());
/ daoWrapper=CustomerInvoiceLineDAO inst	,
...
		addFilterColumns(myColumnsList);
/s
CILineListPanel.addFilterColumns(List<IColumn>) line: 82	

/ Dit zijn andere columns als in CIHSearchListPanel hierboven	,


/7	. 

/ BEGIN ISB-778

/ werk notes bij, bij BIJWERKEN NOTES

/ we click op delete button row customer line	,
/s
AbstractEntityActionButton$1.onSubmit() line: 246	
			@Override
			public void onSubmit() {
->				AbstractEntityActionButton.this.onSubmit(this, aModel);
/s
CIHEditPage$20.onSubmit(Button, IModel<CustomerInvoiceLine>) line: 679	
		protected void onSubmit(Button aButton, IModel<CustomerInvoiceLine> aSelection) {
				MpoBeanFactory.getBean(CustomerInvoiceService.class).deleteInvoiceLine(aSelection.getObject());
/s
CustomerInvoiceServiceImpl.deleteInvoiceLine(CustomerInvoiceLine) line: 286	
	@Override
	public void deleteInvoiceLine(CustomerInvoiceLine anInvoiceLine) {

/ Intermezzo

anInvoiceLine	CustomerInvoiceLine  (id=18836)	
	invoiceDetails	PersistentSortedSet  (id=19204)	
[com.mpobjects.customerinvoice.model.entity.CustomerInvoiceDetail/id:27075287, com.mpobjects.customerinvoice.model.entity.CustomerInvoiceDetail/id:27075290]
	invoiceHeader	CustomerInvoiceHeader_$$_javassist_113  (id=18830)	
com.mpobjects.customerinvoice.model.entity.CustomerInvoiceHeader/id:27075285

com.mpobjects.customerinvoice.model.entity.CustomerInvoiceHeader/id:27075285



/ Einde Intermezzo

		deleteInvoiceLineWithoutSaveAndRecalc(anInvoiceLine);
/s
CustomerInvoiceServiceImpl.deleteInvoiceLineWithoutSaveAndRecalc(CustomerInvoiceLine) line: 951	

/ Intermezzo

/ er zijn de tables	,
customer_invoice_header
customer_invoice_line
customer_invoice_detail
shipment_order_price_part

isbscs=# select*from customer_invoice_header  where invoice_number='INV-102379';
 system_id |       create_date       | created_by_systemid | organization_systemid | currency_systemid | invoice_receiver_systemid | invoice_sender_systemid |      invoice_date       |    invoice_due_date     |  status  | invoice_number | remarks | vat_policy_systemid | approvement_remarks | approved_by_systemid | approval_date | document_systemid | total_amount_exc_vat | total_amount_free_vat | total_amount_high_vat | total_amount_low_vat | total_amount_rev_vat | total_vat_high | total_vat_low | external_invoice_number | invoice_type | invoice_template_systemid 
-----------+-------------------------+---------------------+-----------------------+-------------------+---------------------------+-------------------------+-------------------------+-------------------------+----------+----------------+---------+---------------------+---------------------+----------------------+---------------+-------------------+----------------------+-----------------------+-----------------------+----------------------+----------------------+----------------+---------------+-------------------------+--------------+---------------------------
  27075300 | 2015-01-13 11:10:07.887 |            27074281 |                   500 |              7001 |                  26617752 |                26605102 | 2015-01-13 11:10:07.767 | 2015-03-14 11:10:07.767 | 26727974 | INV-102379     |        |            26605695 |                     |                      |               |                   |               0.0000 |                0.0000 |                0.0000 |               0.0000 |               0.0000 |         0.0000 |       0.0000 |                         | INVOICE      |                  27074797
(1 row)

isbscs=# select*from customer_invoice_line  where invoice_header_systemid =27075300;
 system_id |       create_date       | created_by_systemid | shipment_order_systemid |     remarks     | line_number | invo
ice_header_systemid 
-----------+-------------------------+---------------------+-------------------------+-----------------+-------------+-----
--------------------
  27075301 | 2015-01-13 11:10:07.984 |            27074281 |                27073727 | #Colli: 0, null |          10 |     
           27075300


isbscs=# select*from customer_invoice_detail  where invoice_line_systemid= 27075301;
 system_id |       create_date       | created_by_systemid | vat_tariff_type | price_type_systemid | remarks | line_number | invoice_line_systemid | price_part_systemid | amount | amount_vat 
-----------+-------------------------+---------------------+-----------------+---------------------+---------+-------------+-----------------------+---------------------+--------+------------
  27075303 | 2015-01-13 11:10:08.01  |            27074281 | HIGH            |            27058858 |         |          10 |              27075301 |            27075291 | 0.0000 |     0.0000
  27075305 | 2015-01-13 11:10:08.088 |            27074281 | HIGH            |            26595000 |         |          20 |              27075301 |            27075293 | 0.0000 |     0.0000
(2 rows)


isbscs=# select*from  shipment_order_price_part where invoice_reference like 'INV-102379';
 system_id | shipment_order_systemid | correction_type | price_type_systemid | sequence_nr | reason | entry_type | amount  | cost_component_spec_systemid | invoice_status | invoice_reference | currency_systemid | source_ref |  status   
-----------+-------------------------+-----------------+---------------------+-------------+--------+------------+--------- +------------------------------+----------------+-------------------+-------------------+------------+-----------
  27075302 |                27073727 | ADD             |            27058858 |          10 |        | MANUAL     | 0.00000 |                              | INVOICED       | INV-102379        |              7001 |            | ACTUAL
  27075304 |                27073727 | ADD             |            26595000 |          20 |        | MANUAL     | 0.00000 |                              | INVOICED       | INV-102379        |              7001 |            | ACTUAL
  27075291 |                27073727 | ADD             |            27058858 |          10 |        | MANUAL     | 0.00000 |                              | CONCEPT        | INV-102379        |              7001 |            | ESTIMATED
  27075293 |                27073727 | ADD             |            26595000 |          20 |        | MANUAL     | 0.00000 |                              | CONCEPT        | INV-102379        |              7001 |            | ESTIMATED
(4 rows)



/ Einde Intermezzo

/s
CustomerInvoiceServiceImpl.deleteInvoiceLineWithoutSaveAndRecalc(CustomerInvoiceLine) line: 951	

anInvoiceLine	CustomerInvoiceLine  (id=17748)	
com.mpobjects.customerinvoice.model.entity.CustomerInvoiceLine/id:27075286

		Collection<CustomerInvoiceDetail> myInvoiceDetailList = new ArrayList<CustomerInvoiceDetail>(anInvoiceLine.getInvoiceDetails());
[com.mpobjects.customerinvoice.model.entity.CustomerInvoiceDetail/id:27075287, com.mpobjects.customerinvoice.model.entity.CustomerInvoiceDetail/id:27075290]

		for (CustomerInvoiceDetail myInvoiceDetail : myInvoiceDetailList) {
			anInvoiceLine.removeInvoiceDetail(myInvoiceDetail);
/ Klopt	, 27075287 is eraf	,
[com.mpobjects.customerinvoice.model.entity.CustomerInvoiceDetail/id:27075290]

			deleteInvoiceDetailWithoutRecalc(myInvoiceDetail);
/s
CustomerInvoiceServiceImpl.deleteInvoiceDetailWithoutRecalc(CustomerInvoiceDetail) line: 932	
/=
	private void deleteInvoiceDetailWithoutRecalc(CustomerInvoiceDetail anInvoiceDetail) {

/ anInvoiceDetail	CustomerInvoiceDetail  (id=22863)	
com.mpobjects.customerinvoice.model.entity.CustomerInvoiceDetail/id:27075287
/ die wordt verwijderd	,

		if (anInvoiceDetail.getPricePart() != null) {
/ JA	,
anInvoiceDetail.pricePart	ShipmentOrderPricePartVO_$$_javassist_45  (id=20843)	
/ uninitialized	,
/ id=27075278
			myPricePart = MpoBeanFactory.getBean(ShipmentOrderPricePartDAO.class).getBySystemId( anInvoiceDetail.getPricePart().getSystemId());
/ uninitialized proxy	,
27075278
/ een invoice detail refs naar de price part (waaruit hij voornamelijk bestaat)	,
/ TODO (Waarom 2de keer ophalen?)

			myShipmentOrder = myPricePart.getShipmentOrderVO();
/ myPricePart is nu initialized
/ TODO (Welke fct worden called?)
27073529
		if (myPricePart != null && InvoiceType.CREDIT_NOTE.equals(anInvoiceDetail.getInvoiceLine().getInvoiceHeader().getInvoiceType())) {
/ NEE, anInvoiceDetail.getInvoiceLine().getInvoiceHeader().getInvoiceType()="INVOICE"
		} else if (myPricePart != null) {
			myPricePart.setInvoiceStatus(InvoiceStatus.NOT_INVOICED);
			myPricePart.setInvoiceReference("");
			savePricePart(myPricePart);
/s
CustomerInvoiceServiceImpl.savePricePart(ShipmentOrderPricePartVO) line: 704	
			shipmentOrderPricePartDAO.saveShipmentOrderPricePart(aPricePart);
/s
ShipmentOrderPricePartDAOImpl.saveShipmentOrderPricePart(ShipmentOrderPricePartVO) line: 124	
				FactorBaseTypeVO factorBaseType = ShipmentOrderCostPartUtil.getShipmentOrderCostPartService().getFactorBaseTypeVO();
/s
ShipmentOrderCostPartServiceImpl.getFactorBaseTypeVO() line: 125	
			final String factorBaseTypeStr = ApplicationPropertyManager.getInstance().getModuleProperty("oms", "shipmentordercostpart.create.factorbasetype", FactorBaseTypeVO.TYPE_KG);
/ "KG"
			factorBaseType = MpoBeanFactory.getBean(FactorBaseTypeDAO.class).getByCode(factorBaseTypeStr);

/ Intermezzo

/ SPUM
<hibernate-mapping package="com.mpobjects.oms.model.factorbasetype.vo">
	<class name="FactorBaseTypeVO" lazy="false" table="FACTOR_BASE_TYPE">
/ lazy="false"

/ Einde Intermezzo

/t
ShipmentOrderPricePartDAOImpl.saveShipmentOrderPricePart(ShipmentOrderPricePartVO) line: 124	
				FactorBaseTypeVO factorBaseType = ShipmentOrderCostPartUtil.getShipmentOrderCostPartService().getFactorBaseTypeVO();
/d
				myMustRaiseEvent = factorBaseType.isTypePricePart()&&...
/ NEE
			aShipmentOrderPricePart = merge(aShipmentOrderPricePart);
/s
GenericHibernateDAO.merge
			anObject = type.cast(getHibernateTemplate().merge(anObject));

/ aShipmentOrderPricePart.invoiceStatus.name="NOT_INVOICED"	,
/ we zien in de db nog steeds CONCEPT	, omdat de dao call waar we inzitten,	 shipmentOrderPricePartDAO.saveShipmentOrderPricePart(aPricePart)	, zelf ook in een tx zit, en dus start de dao call geen tx	,
			

/ Intermezzo

/ in ShipmentOrderPricePart's mapping,

		<property name="invoiceStatus" column="INVOICE_STATUS">
			<type name="org.hibernate.type.EnumType">
				<param name="enumClass">com.mpobjects.oms.model.shipmentorderpricepart.vo.InvoiceStatus</param>
				<param name="type">12</param>
			</type>
		</property>
/ TODO

/ we zien de tx eerder start bij	,
CIHEditPage$20.onSubmit(Button, IModel<CustomerInvoiceLine>) line: 679	
				MpoBeanFactory.getBean(CustomerInvoiceService.class).deleteInvoiceLine(aSelection.getObject());
/s
tx
CustomerInvoiceServiceImpl.deleteInvoiceLine(CustomerInvoiceLine) line: 286	
		CustomerInvoiceHeader myHeader = anInvoiceLine.getInvoiceHeader();
		deleteInvoiceLineWithoutSaveAndRecalc(anInvoiceLine);
/ hier zitten we in	,


/ Einde Intermezzo


/t
CustomerInvoiceServiceImpl.savePricePart(ShipmentOrderPricePartVO) line: 723	
			shipmentOrderPricePartDAO.saveShipmentOrderPricePart(aPricePart);
/d
			// We only delete the actual price part
			deletePricePartByInvoceReferenceAndStatus(anInvoiceDetail.getInvoiceLine().getInvoiceHeader().getInvoiceNumber(), RatePartStatus.ACTUAL);
/ anInvoiceDetail.getInvoiceLine().getInvoiceHeader().getInvoiceNumber()="INV-102377"	,
/s
CustomerInvoiceServiceImpl.deletePricePartByInvoceReferenceAndStatus(String, RatePartStatus) line: 310	
			shipmentOrderPricePartDAO.deleteByInvoceReferenceAndStatus(invoiceReference, aPriceStatus);
/s
	public void deleteByInvoceReferenceAndStatus(String invoiceReference, RatePartStatus aPriceStatus) {

invoiceReference	"INV-102377" (id=26102)	
aPriceStatus	RatePartStatus  (id=25183)	
name: ACTUAL

		DetachedCriteria myCriteria = DetachedCriteria.forClass(ShipmentOrderPricePartVO.class).add(
				Property.forName("invoiceReference").like(invoiceReference, MatchMode.ANYWHERE).ignoreCase()).add(Property.forName("status").eq(aPriceStatus));
		List<ShipmentOrderPricePartVO> myList = getHibernateTemplate().findByCriteria(myCriteria);
/ *
		getHibernateTemplate().deleteAll(myList);
/ we zien geen delete stmt in de logs	,
/ TODO

/ we vragen die price parts die invoice 'INV-...' hebben, die status ACTUAL hebben	,
/ (WH we zouden ook de lines bij de invoice kunnen vragen, en van iedere line de details, en van elke detail de price part, die status ACTUAL hebben, TODO)
/ we delete deze price parts	,

/ we delete hieronder 1 invoice detail per keer, maar eerst worden alle actual price parts bij de invoice delete	,


/ Intermezzo

/ bij *	,

update SHIPMENT_ORDER_PRICE_PART set AMOUNT=?, CURRENCY_SYSTEMID=?, CORRECTION_TYPE=?, ENTRY_TYPE=?, INVOICE_REFERENCE=?, reason=?, SHIPMENT_ORDER_SYSTEMID=?, SEQUENCE_NR=?, PRICE_TYPE_SYSTEMID=?, INVOICE_STATUS=?, SOURCE_REF=?, STATUS=? where SYSTEM_ID=?
2015-01-12 14:12:57,959 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [1] as [NUMERIC] - 0.00000
2015-01-12 14:12:57,960 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [2] as [INTEGER] - 7001
2015-01-12 14:12:57,961 DEBUG [org.hibernate.type.EnumType] (http-0.0.0.0-8080-3:) Binding 'ADD' to parameter: 3
2015-01-12 14:12:57,961 DEBUG [org.hibernate.type.EnumType] (http-0.0.0.0-8080-3:) Binding 'MANUAL' to parameter: 4 
2015-01-12 14:12:57,962 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [5] as [VARCHAR] -  
2015-01-12 14:12:57,963 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [6] as [VARCHAR] -
2015-01-12 14:12:57,964 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [7] as [INTEGER] - 27074011
2015-01-12 14:12:57,965 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [8] as [INTEGER] - 0
2015-01-12 14:12:57,966 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [9] as [INTEGER] - 27058858
2015-01-12 14:12:57,966 DEBUG [org.hibernate.type.EnumType] (http-0.0.0.0-8080-3:) Binding 'NOT_INVOICED' to parameter: 10
2015-01-12 14:12:57,967 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [11] as [VARCHAR] - <null>
2015-01-12 14:12:57,967 DEBUG [org.hibernate.type.EnumType] (http-0.0.0.0-8080-3:) Binding 'ESTIMATED' to parameter: 12
2015-01-12 14:12:57,968 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [13] as [INTEGER] - 27075247

/ Waarom nu pas	?
/ TODO

/ de commit volgt later, want we zitten nog steeds in een tx die is started door	,
			shipmentOrderPricePartDAO.deleteByInvoceReferenceAndStatus(invoiceReference, aPriceStatus);


select * 
from SHIPMENT_ORDER_PRICE_PART this_ 
inner join RATE_COMPONENT_TYPE ratecompon2_ on this_.PRICE_TYPE_SYSTEMID=ratecompon2_.SYSTEM_ID 
where lower(this_.INVOICE_REFERENCE) like ? 
and this_.STATUS=?
 196384 2015-01-12 14:12:57,976 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3        :) binding parameter [1] as [VARCHAR] - %inv-102377%
 196385 2015-01-12 14:12:57,976 DEBUG [org.hibernate.type.EnumType] (http-0.0.0.0-8080-3:) Binding 'ACTUAL        ' to parameter: 2

/ SPUM
/ we zien dat rate_component_type lazy="false" mapping heeft	,  daarom als we een update of WH een query doen op shipment_order_price_part	, dan meteen een join , onnodig	,

<hibernate-mapping>
	<class name="com.mpobjects.oms.model.shipmentorderpricepart.vo.ShipmentOrderPricePartVO" table="SHIPMENT_ORDER_PRICE_PART">
		<many-to-one name="shipmentOrderVO" class="com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO" column="SHIPMENT_ORDER_SYSTEMID"/>
...

<hibernate-mapping>
	<class name="com.mpobjects.oms.model.ratecomponenttype.RateComponentType" table="RATE_COMPONENT_TYPE" lazy="false" >
...

/ 7	.

/ een customer invoice detail kent de shipment order price part	, 
/ een shipment order price part kent de customer invoice (header)	, 

isbscs=# select*from customer_invoice_detail  where invoice_line_systemid= 27075301;
 system_id |       create_date       | created_by_systemid | vat_tariff_type | price_type_systemid | remarks | line_number | invoice_line_systemid | price_part_systemid | amount | amount_vat 
-----------+-------------------------+---------------------+-----------------+---------------------+---------+------------- +-----------------------+---------------------+--------+------------
  27075303 | 2015-01-13 11:10:08.01  |            27074281 | HIGH            |            27058858 |         |          10 |              27075301 |            27075291 | 0.0000 |     0.0000
  27075305 | 2015-01-13 11:10:08.088 |            27074281 | HIGH            |            26595000 |         |          20 |              27075301 |            27075293 | 0.0000 |     0.0000
(2 rows)

isbscs=# select*from  shipment_order_price_part where invoice_reference like 'INV-102379';
 system_id | shipment_order_systemid | correction_type | price_type_systemid | sequence_nr | reason | entry_type | amount  | cost_component_spec_systemid | invoice_status | invoice_reference | currency_systemid | source_ref |  status   
-----------+-------------------------+-----------------+---------------------+-------------+--------+------------+--------- +------------------------------+----------------+-------------------+-------------------+------------+-----------
  27075302 |                27073727 | ADD             |            27058858 |          10 |        | MANUAL     | 0.00000 |                              | INVOICED       | INV-102379        |              7001 |            | ACTUAL
  27075304 |                27073727 | ADD             |            26595000 |          20 |        | MANUAL     | 0.00000 |                              | INVOICED       | INV-102379        |              7001 |            | ACTUAL
  27075291 |                27073727 | ADD             |            27058858 |          10 |        | MANUAL     | 0.00000 |                              | CONCEPT        | INV-102379        |              7001 |            | ESTIMATED
  27075293 |                27073727 | ADD             |            26595000 |          20 |        | MANUAL     | 0.00000 |                              | CONCEPT        | INV-102379        |              7001 |            | ESTIMATED
(4 rows)

/ Einde Intermezzo

/ we waren in 	,
ShipmentOrderPricePartDAOImpl.deleteByInvoceReferenceAndStatus(String, RatePartStatus) line: 84	
		List<ShipmentOrderPricePartVO> myList = getHibernateTemplate().findByCriteria(myCriteria);
/d
[theSystemId: 27075302, Amount :0.00000, theSystemId: 27075304, Amount :0.00000]

/ we hebben dus de actual price parts bij de invoice, 

		getHibernateTemplate().deleteAll(myList);
/ we zien NIETS	,
/ TODO

/s
CustomerInvoiceServiceImpl.deletePricePartByInvoceReferenceAndStatus(String, RatePartStatus) line: 312	
			shipmentOrderPricePartDAO.deleteByInvoceReferenceAndStatus(invoiceReference, aPriceStatus);
/d
/t
CustomerInvoiceServiceImpl.deleteInvoiceDetailWithoutRecalc(CustomerInvoiceDetail) line: 938	
			// We only delete the actual price part
			deletePricePartByInvoceReferenceAndStatus(anInvoiceDetail.getInvoiceLine().getInvoiceHeader().getInvoiceNumber(), RatePartStatus.ACTUAL);
/d
		if (myShipmentOrder != null) {
			shipmentOrderDao.getBySystemId(myShipmentOrder.getSystemId());
/ SPUM 
/ TODO (Wat doet deze?)

		// Unlink it to delete it
		anInvoiceDetail.setInvoiceLine(null);
		customerInvoiceDetailDAO.delete(anInvoiceDetail);
/ we zien niets	,
/ TODO

/ dit is een van de invoice details	, 303	,
/ we hebben zojuist alle actual price parts bij de invoice delete, 	ook die niet bij deze detail horen	,
/ TODO 

/t
CustomerInvoiceServiceImpl.deleteInvoiceLineWithoutSaveAndRecalc(CustomerInvoiceLine) line: 949	
		for (CustomerInvoiceDetail myInvoiceDetail : myInvoiceDetailList) {
/ volgende	,
			anInvoiceLine.removeInvoiceDetail(myInvoiceDetail);
			deleteInvoiceDetailWithoutRecalc(myInvoiceDetail);
...
/s
ShipmentOrderPricePartDAOImpl.deleteByInvoceReferenceAndStatus(String, RatePartStatus) line: 84	

		List<ShipmentOrderPricePartVO> myList = getHibernateTemplate().findByCriteria(myCriteria);
/ criteria: INV-102379, status=ACTUAL	, op shipment order price part	,

/ we zien	,

update SHIPMENT_ORDER_PRICE_PART 
set AMOUNT=?, CURRENCY_SYSTEMID=?, CORRECTION_TYPE=?, ENTRY_TYPE=?, INVOICE_REFERENCE=?, reason=        ?, SHIPMENT_ORDER_SYSTEMID=?, SEQUENCE_NR=?, PRICE_TYPE_SYSTEMID=?, INVOICE_STATUS=?, SOURCE_REF=?, STATUS=? 
where SYSTEM_ID=?
 358674 2015-01-13 13:01:38,177 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:)         binding parameter [1] as [NUMERIC] - 0.00000
 358676 2015-01-13 13:01:38,178 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:)         binding parameter [2] as [INTEGER] - 7001
 358678 2015-01-13 13:01:38,179 DEBUG [org.hibernate.type.EnumType] (http-0.0.0.0-8080-2:) Binding 'ADD' to p        arameter: 3
 358680 2015-01-13 13:01:38,179 DEBUG [org.hibernate.type.EnumType] (http-0.0.0.0-8080-2:) Binding 'MANUAL' t        o parameter: 4
 358682 2015-01-13 13:01:38,180 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:)         binding parameter [5] as [VARCHAR] -
 358686 2015-01-13 13:01:38,181 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:)         binding parameter [7] as [INTEGER] - 27073727
 358688 2015-01-13 13:01:38,182 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:)         binding parameter [8] as [INTEGER] - 20
 358690 2015-01-13 13:01:38,184 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:)         binding parameter [9] as [INTEGER] - 26595000
 358692 2015-01-13 13:01:38,184 DEBUG [org.hibernate.type.EnumType] (http-0.0.0.0-8080-2:) Binding 'NOT_INVOI        CED' to parameter: 10
 358694 2015-01-13 13:01:38,186 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:)         binding parameter [11] as [VARCHAR] - <null>
 358696 2015-01-13 13:01:38,186 DEBUG [org.hibernate.type.EnumType] (http-0.0.0.0-8080-2:) Binding 'ESTIMATED        ' to parameter: 12
 358698 2015-01-13 13:01:38,187 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:)         binding parameter [13] as [INTEGER] - 27075293

delete from SHO_PRICE_COST_PART_LINK 
where PRICE_PART_SYSTEMID=?
 358701 2015-01-13 13:01:38,193 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:)         binding parameter [1] as [INTEGER] - 27075302
/ actual	,

delete from SHO_PRICE_COST_PART_LINK 
where PRICE_PART_SYSTEMID=?
 358701 2015-01-13 13:01:38,193 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:)         binding parameter [1] as [INTEGER] - 27075304
/ actual	,

delete from SHIPMENT_ORDER_PRICE_PART 
where SYSTEM_ID=?
 358710 2015-01-13 13:01:38,200 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:)         binding parameter [1] as [INTEGER] - 27075302
/ actual 

delete from SHIPMENT_ORDER_PRICE_PART 
where SYSTEM_ID=?
 358710 2015-01-13 13:01:38,200 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:)         binding parameter [1] as [INTEGER] - 27075304
/ actual 

delete from CUSTOMER_INVOICE _DETAIL 
where SYSTEM_ID=?
 358714 2015-01-13 13:01:38,206 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:)         binding parameter [1] as [INTEGER] - 27075303

select * 
from SHIPMENT_ORDER_PRICE_PART this_ 
inner join RATE_COMPONENT_TYPE ratecompon2_ on this_.PRICE_TYPE_SYSTEMID=ratecompon2_.SYSTEM_ID 
where lower(this_.INVOICE_REFERENCE) like ? and this_.STATUS=?
 358717 2015-01-13 13:01:38,214 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:)         binding parameter [1] as [VARCHAR] - %inv-102379%
 358719 2015-01-13 13:01:38,215 DEBUG [org.hibernate.type.EnumType] (http-0.0.0.0-8080-2:) Binding 'ACTUAL' t        o parameter: 2

		List<ShipmentOrderPricePartVO> myList = getHibernateTemplate().findByCriteria(myCriteria);
/ []
/ we hadden alle actual pp's  al delete bij de vorige invoice detail	,
		getHibernateTemplate().deleteAll(myList);

/t
CustomerInvoiceServiceImpl.deleteInvoiceDetailWithoutRecalc(CustomerInvoiceDetail) line: 943	
		// Unlink it to delete it
		anInvoiceDetail.setInvoiceLine(null);
		customerInvoiceDetailDAO.delete(anInvoiceDetail);
/ 305

/t
CustomerInvoiceServiceImpl.deleteInvoiceLineWithoutSaveAndRecalc(CustomerInvoiceLine) line: 954	
		for (CustomerInvoiceDetail myInvoiceDetail : myInvoiceDetailList) {
/ d
/ geen volgende meer	,
		customerInvoiceLineDAO.delete(anInvoiceLine);
/ 301

/t
CustomerInvoiceServiceImpl.deleteInvoiceLine(CustomerInvoiceLine) line: 288	
		deleteInvoiceLineWithoutSaveAndRecalc(anInvoiceLine);
/d
		myHeader.getInvoiceLines().remove(anInvoiceLine);

/t
CIHEditPage$20.onSubmit(Button, IModel<CustomerInvoiceLine>) line: 679	
				MpoBeanFactory.getBean(CustomerInvoiceService.class).deleteInvoiceLine(aSelection.getObject());
/d
delete from CUSTOMER_INVOICE_DETAIL 
where SYSTEM_ID=?
  72348 2015-01-13 14:00:56,828 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:)         binding parameter [1] as [INTEGER] - 27075305

delete from CUSTOMER_INVOICE_LINE 
where SYSTEM_ID=?
  72351 2015-01-13 14:00:56,831 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:)         binding parameter [1] as [INTEGER] - 27075301

/////////////////////////////////////////////////////////////////////////
/ Nu is de tx commit	, en is de invoice line weg	,

/ Intermezzo


/ de invoice is er nog	,
isbscs=# select*from customer_invoice_header  where invoice_number='INV-102379';
 system_id |       create_date       | created_by_systemid | organization_systemid | currency_systemid | invoice_receiver_systemid | invoice_sender_systemid |      invoice_date       |    invoice_due_date     |  status  | invoice_number | remarks | vat_policy_systemid | approvement_remarks | approved_by_systemid | approval_date | document_systemid | total_amount_exc_vat | total_amount_free_vat | total_amount_high_vat | total_amount_low_vat | total_amount_rev_vat | total_vat_high | total_vat_low | external_invoice_number | invoice_type | invoice_template_systemid 
-----------+-------------------------+---------------------+-----------------------+-------------------+------------------- --------+-------------------------+-------------------------+-------------------------+----------+----------------+-------- -+---------------------+---------------------+----------------------+---------------+-------------------+------------------ ----+-----------------------+-----------------------+----------------------+----------------------+----------------+------- --------+-------------------------+--------------+---------------------------
  27075300 | 2015-01-13 11:10:07.887 |            27074281 |                   500 |              7001 |                  26617752 |                26605102 | 2015-01-13 11:10:07.767 | 2015-03-14 11:10:07.767 | 26727974 | INV-102379     |        |            26605695 |                     |                      |               |                   |               0.0000 |                0.0000 |                0.0000 |               0.0000 |               0.0000 |         0.0000 |       0.0000 |                         | INVOICE      |                  27074797
(1 row)

isbscs=# select*from customer_invoice_detail  where invoice_line_systemid= 27075301;
 system_id | create_date | created_by_systemid | vat_tariff_type | price_type_systemid | remarks | line_number | invoice_li
ne_systemid | price_part_systemid | amount | amount_vat 
-----------+-------------+---------------------+-----------------+---------------------+---------+-------------+-----------
------------+---------------------+--------+------------
(0 rows)
/ alle 2 de invoice details zijn weg, 

isbscs=#  select*from  shipment_order_price_part where invoice_reference like 'INV-102379';
 system_id | shipment_order_systemid | correction_type | price_type_systemid | sequence_nr | reason | entry_type | amount | cost_component_spec_systemid | invoice_status | invoice_reference | currency_systemid | source_ref | status -----------+-------------------------+-----------------+---------------------+-------------+--------+------------+--------+
------------------------------+----------------+-------------------+-------------------+------------+--------
(0 rows)
/ alle 4 de  pp's zijn weg	, actual=INVOICED en estimated=CONCEPT, 

/ Einde Intermezzo

/ we waren in	,
CIHEditPage$20.onSubmit(Button, IModel<CustomerInvoiceLine>) line: 680	
		MpoBeanFactory.getBean(CustomerInvoiceService.class).deleteInvoiceLine(aSelection.getObject());
/d
		MpoBeanFactory.getBean(CustomerInvoiceService.class).recalculate(aSelection.getObject().getInvoiceHeader());
/s
CustomerInvoiceServiceImpl.recalculate(CustomerInvoiceHeader) line: 673	
		customerInvoiceHeaderDAO.getCurrentSession().refresh(aHeader);
/ TODO

/ Intermezzo

/ ga op customerInvoiceHeaderDAO staan, f3
/ we komen op def in CustomerInvoiceServiceImpl	,
	private CustomerInvoiceHeaderDAO customerInvoiceHeaderDAO;
/ ga op CustomerInvoiceHeaderDAO staan, ctrl+t
/ we zien	,
package com.mpobjects.customerinvoice.dao;
public class CustomerInvoiceHeaderDAOImpl extends GenericHibernateDAO<CustomerInvoiceHeader> implements CustomerInvoiceHeaderDAO {
/ geef ctrl+o, ctrl+o
/ geen getcurrentsession	, 
package com.mpobjects.util.dao;
@Transactional
public abstract class BaseHibernateDAO<T> extends HibernateDaoSupport {
	public Session getCurrentSession() {
		return getHibernateTemplate().getSessionFactory().getCurrentSession();
	}

/ Einde Intermezzo

		aHeader.recalculate();
/ aHeaderr is init proxy naar een customer invoice header	,
/s
CustomerInvoiceHeader.recalculate() line: 349	
/ Doet niets, want er zijn geen customer invoice lines	,

/t
		customerInvoiceHeaderDAO.save(aHeader);

/ 7	. 

/ click Planning, Shipment Order, Search	,
/ we zien shipment-order_list	,
/ TODO

/ click edit button,
/ we zizen shipment-order_edit	, 
/ TODO

/ we komen in wicket	,
ShipmentOrderEditSelectionPage.<init>() line: 21	
/s
ShipmentOrderEditSelectionPage(AbstractMainPage).<init>() line: 32	
	public AbstractMainPage() {
		super();
/s
ShipmentOrderEditSelectionPage(AbstractPage).<init>() line: 38	
	public AbstractPage() {
		super();
		pageTitleModel = getPageTitle();
		processPageParameters(new PageParameters());
		initializePage();
/s
ShipmentOrderEditSelectionPage(AbstractMainPage).initializePage() line: 54	
	protected void initializePage() {
		...
		super.initializePage();
/s
ShipmentOrderEditSelectionPage(AbstractPage).initializePage() line: 78	
		...
		createPageComponents();
/s
ShipmentOrderEditSelectionPage.createPageComponents() line: 28	
		..
		ShipmentOrderPanelBuilder myBuilder = (ShipmentOrderPanelBuilder) Class.forName(myClass).newInstance();
		AbstractShipmentOrderPanel myPanel = myBuilder.build(null, myShipmentOrder, "editPanel");
/s
StandardShipmentOrderPanelBuilder.build(BasePage, ShipmentOrderVO, String) line: 19	
		IModel<ShipmentOrderVO> myModel = new EntityDetachableModel<ShipmentOrderVO>(aShipmentOrder, ShipmentOrderDao.class);
		return new ShipmentOrderMainPanel(aPage, anId, myModel);
/s
ShipmentOrderMainPanel.<init>(BasePage, String, IModel<ShipmentOrderVO>) line: 90	
...
		EntityActionButton<ShipmentOrderVO> myFinanceAct = new EntityActionButton<ShipmentOrderVO>("finance", new ResourceModel("finance")) {
			@Override
			protected void onSubmit(Button aButton, IModel<ShipmentOrderVO> aSelection) {
				ShipmentOrderVO myOrder = aSelection.getObject();
				// TODO? call page directly
				getRequestCycle().setRequestTarget(
						new RedirectRequestTarget(
								"../wicket/?module=oms&wicketpage=shipmentorder.shipmentorderfinancialdetails.ShipmentOrderFinancialPage&shipmentorder_systemid=" + myOrder.getSystemId()));
			}

/ Dus we komen in	,

/ 7	.

[eric@localhost isbscs]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/isbscs
[eric@localhost isbscs]$ rm deploy/pnloms-schedule-service.xml 

  <category name="org.hibernate.SQL" additivity="false">
      <priority value="DEBUG"/> <!-- DEBUG -->
      <appender-ref ref="QUERY"/>
      <appender-ref ref="HIBERNATE"/>
<!--
      <appender-ref ref="CONSOLE"/>
-->
   </category>

/ 7	.

/ Open sho 384	, 
/ wicket scherm	,
/ click Finance in de sho	,

/ 7	.

/ ERR	,
org.hibernate.ObjectNotFoundException: No row with the given identifier exists: [com.mpobjects.oms.model.shipmentorderpricepart.vo.ShipmentOrderPricePartVO#27075315]
     at org.hibernate.impl.SessionFactoryImpl$2.handleEntityNotFound(SessionFactoryImpl.java:435)
     at org.hibernate.event.def.DefaultLoadEventListener.load(DefaultLoadEventListener.java:233)
     at org.hibernate.event.def.DefaultLoadEventListener.proxyOrLoad(DefaultLoadEventListener.java:285)
     at org.hibernate.event.def.DefaultLoadEventListener.onLoad(DefaultLoadEventListener.java:152)
     at org.hibernate.impl.SessionImpl.fireLoad(SessionImpl.java:1090)
     at org.hibernate.impl.SessionImpl.internalLoad(SessionImpl.java:1038)
     at org.hibernate.type.EntityType.resolveIdentifier(EntityType.java:630)
     at org.hibernate.type.ManyToOneType.assemble(ManyToOneType.java:236)
     at org.hibernate.collection.PersistentSet.initializeFromCache(PersistentSet.java:147)
     at org.hibernate.cache.entry.CollectionCacheEntry.assemble(CollectionCacheEntry.java:58)
     at org.hibernate.event.def.DefaultInitializeCollectionEventListener.initializeCollectionFromCache(DefaultInitializeCollectionEventListener.java:159)
     at org.hibernate.event.def.DefaultInitializeCollectionEventListener.onInitializeCollection(DefaultInitializeCollectionEventListener.java:71)
     at org.hibernate.impl.SessionImpl.initializeCollection(SessionImpl.java:1863)
     at org.hibernate.collection.AbstractPersistentCollection.initialize(AbstractPersistentCollection.java:369)
     at org.hibernate.collection.AbstractPersistentCollection.read(AbstractPersistentCollection.java:111)
     at org.hibernate.collection.PersistentSet.iterator(PersistentSet.java:186)
     at com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO.getShipmentOrderPricePartByStatus(ShipmentOrderVO.java:1762)
   
/ we zien	, 
$ vi ShipmentOrder.standard.hbm.xml

		<set name="shipmentOrderPricePartList" cascade="all,delete-orphan" sort="com.mpobjects.util.dao.SequencedEntityComparator">
			<cache usage="read-write"/>
			<key column="SHIPMENT_ORDER_SYSTEMID" />
			<one-to-many class="com.mpobjects.oms.model.shipmentorderpricepart.vo.ShipmentOrderPricePartVO" />
		</set>

$ vi ShipmentOrderPricePart.standard.hbm.xml

		<many-to-one name="shipmentOrderVO" class="com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO" column="SHIPMENT_ORDER_SYSTEMID"/>

/ 7	.

/ we hebben create invoice gedaan	,
/ na rm invoice	(*),

isbscs=# select*from customer_invoice_header  where invoice_number='INV-102382';
/   system_id=27075318 
/* is er nog	,
isbscs=#  select*from  shipment_order_price_part where shipment_order_systemid= 27074218;
/ constant	,
/ * is er nog	, 
isbscs=# select*from customer_invoice_line  where invoice_header_systemid =27075318;
/ veranderlijk	,
/ system_id=27075319
isbscs=# select*from customer_invoice_detail  where invoice_line_systemid= 27075319;
  27075320 | 2015-01-13 17:17:58.138 |            27074281 | HIGH            |            27058858 |         |          10 |              27075319 |            27075237 |  0.0000 |     0.0000
  27075323 | 2015-01-13 17:17:58.201 |            27074281 | HIGH            |            26595000 |         |          20 |              27075319 |            27074251 | 55.0000 |    11.5500
/ veranderlijk	,
/ * weg	,

/ *
isbscs=#  select*from  shipment_order_price_part where shipment_order_systemid= 27074218;
-+------------------------------+----------------+-------------------+-------------------+------------+-----------
  27074251 |                27074218 | ADD             |            26595000 |          90 |        | MANUAL     | 55.00000 |                              | NOT_INVOICED   |                   |              7001 |            | ESTIMATED
  27075237 |                27074218 | ADD             |            27058858 |          10 |        | MANUAL     |  0.00000 |                              | NOT_INVOICED   |                   |              7001 |            | ESTIMATED
(2 rows)

/ dus de actuals zijn weg, en de estimated zijn OK hersteld	,

/ 7	. 

/ Voor rm	,

isbscs=# select*from customer_invoice_header  where invoice_number='INV-102383';
 system_id |       create_date       | created_by_systemid | organization_systemid | currency_systemid | invoice_receiver_systemid | invoice_sender_systemid |      invoice_date       |    invoice_due_date     |  status  | invoice_number | remarks | vat_policy_systemid | approvement_remarks | approved_by_systemid | approval_date | document_systemid | total_amount_exc_vat | total_amount_free_vat | total_amount_high_vat | total_amount_low_vat | total_amount_rev_vat | total_vat_high | total_vat_low | external_invoice_number | invoice_type | invoice_template_systemid 
------
  27075324 | 2015-01-14 12:37:38.667 |            27074281 |                   500 |              7001 |                  26628012 |                26605102 | 2015-01-14 12:37:38.618 | 2015-01-14 12:37:38.618 | 26727974 | INV-102383     |        |            26605695 |                     |                      |               |                   |               0.0000 |                0.0000 |                0.0000 |               0.0000 |               0.0000 |         0.0000 |       0.0000 |                         | INVOICE      |                  27074797
(1 row)

/ Voor rm	,
isbscs=#  select*from  shipment_order_price_part where shipment_order_systemid= 27074218;
 system_id | shipment_order_systemid | correction_type | price_type_systemid | sequence_nr | reason | entry_type |  amount | cost_component_spec_systemid | invoice_status | invoice_reference | currency_systemid | source_ref |  status   
-----------+-------------------------+-----------------+---------------------+-------------+--------+------------+--------- -+------------------------------+----------------+-------------------+-------------------+------------+-----------
  27074251 |                27074218 | ADD             |            26595000 |          90 |        | MANUAL     | 55.00000 |                              | CONCEPT        | INV-102383        |              7001 |            | ESTIMATED
  27075327 |                27074218 | ADD             |            27058858 |          10 |        | MANUAL     |  0.00000 |                              | INVOICED       | INV-102383        |              7001 |            | ACTUAL
  27075328 |                27074218 | ADD             |            26595000 |          90 |        | MANUAL     | 55.00000 |                              | INVOICED       | INV-102383        |              7001 |            | ACTUAL
  27075237 |                27074218 | ADD             |            27058858 |          10 |        | MANUAL     |  0.00000 |                              | CONCEPT        | INV-102383        |              7001 |            | ESTIMATED
(4 rows)
/ Na rm	,
isbscs=#  select*from  shipment_order_price_part where shipment_order_systemid= 27074218;
 system_id | shipment_order_systemid | correction_type | price_type_systemid | sequence_nr | reason | entry_type |  amount | cost_component_spec_systemid | invoice_status | invoice_reference | currency_systemid | source_ref |  status   
-----------+-------------------------+-----------------+---------------------+-------------+--------+------------+--------- -+------------------------------+----------------+-------------------+-------------------+------------+-----------
  27074251 |                27074218 | ADD             |            26595000 |          90 |        | MANUAL     | 55.00000 |                              | NOT_INVOICED   |                   |              7001 |            | ESTIMATED
  27075237 |                27074218 | ADD             |            27058858 |          10 |        | MANUAL     |  0.00000 |                              | NOT_INVOICED   |                   |              7001 |            | ESTIMATED
(2 rows)

isbscs=# select*from customer_invoice_line  where invoice_header_systemid =27075324;
 system_id |       create_date       | created_by_systemid | shipment_order_systemid |     remarks     | line_number | invoice_header_systemid 
-----------+-------------------------+---------------------+-------------------------+-----------------+-------------+-------------------------
  27075325 | 2015-01-14 12:37:38.826 |            27074281 |                27074218 | #Colli: 0, null |          10 |     27075324
(1 row)
/ Na rm is weg	,

isbscs=# select*from customer_invoice_detail  where invoice_line_systemid= 27075325;
 system_id |       create_date       | created_by_systemid | vat_tariff_type | price_type_systemid | remarks | line_number | invoice_line_systemid | price_part_systemid | amount  | amount_vat 
-----------+-------------------------+---------------------+-----------------+---------------------+---------+-------------+-----------------------+---------------------+---------+------------
  27075326 | 2015-01-14 12:37:38.835 |            27074281 | HIGH            |            27058858 |         |          10 |              27075325 |            27075237 |  0.0000 |     0.0000
  27075329 | 2015-01-14 12:37:38.88  |            27074281 | HIGH            |            26595000 |         |          20 |              27075325 |            27074251 | 55.0000 |    11.5500
(2 rows)
/ Na rm is weg	,


/ FIX ISB-778 

/ als we de invoice line delete	, op Finance, Customer invoice, Search Invoice	,

/s
AbstractEntityActionButton$1.onSubmit() line: 246	
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new Button(aId) {
			@Override
			public void onSubmit() {
				AbstractEntityActionButton.this.onSubmit(this, aModel);
/s
CIHEditPage$20.onSubmit(Button, IModel<CustomerInvoiceLine>) line: 679	
		EntityActionButton<CustomerInvoiceLine> myDeleteBtn = new EntityActionButton<CustomerInvoiceLine>("delete", new ResourceModel("deleteLine").wrapOnAssignment(CIHEditPage.this)) {
			@Override
			protected void onSubmit(Button aButton, IModel<CustomerInvoiceLine> aSelection) {
				MpoBeanFactory.getBean(CustomerInvoiceService.class).deleteInvoiceLine(aSelection.getObject());

/s
CustomerInvoiceServiceImpl.deleteInvoiceLine(CustomerInvoiceLine) line: 285	
...
		deleteInvoiceLineWithoutSaveAndRecalc(anInvoiceLine);
/s
CustomerInvoiceServiceImpl.deleteInvoiceLineWithoutSaveAndRecalc(CustomerInvoiceLine) line: 947	
		for (CustomerInvoiceDetail myInvoiceDetail : myInvoiceDetailList) {
...
			deleteInvoiceDetailWithoutRecalc(myInvoiceDetail);
/s
CustomerInvoiceServiceImpl.deleteInvoiceDetailWithoutRecalc(CustomerInvoiceDetail) line: 916	
...
			// We only delete the actual price part
			deletePricePartByInvoceReferenceAndStatus(anInvoiceDetail.getInvoiceLine().getInvoiceHeader().getInvoiceNumber(), RatePartStatus.ACTUAL);
/s
CustomerInvoiceServiceImpl.deletePricePartByInvoceReferenceAndStatus(String, RatePartStatus) line: 310	
			shipmentOrderPricePartDAO.deleteByInvoceReferenceAndStatus(invoiceReference, aPriceStatus);
/s
ShipmentOrderPricePartDAOImpl.deleteByInvoceReferenceAndStatus(String, RatePartStatus) line: 81	
	@Override
	public void deleteByInvoceReferenceAndStatus(String invoiceReference, RatePartStatus aPriceStatus) {
		DetachedCriteria myCriteria = DetachedCriteria.forClass(ShipmentOrderPricePartVO.class).add(Property.forName("invoiceReference").like(invoiceReference, MatchMode.ANYWHERE).ignoreCase()).add(Property.forName("status").eq(aPriceStatus));
		List<ShipmentOrderPricePartVO> myList = getHibernateTemplate().findByCriteria(myCriteria);

/////////////////////////////////
		for (ShipmentOrderPricePartVO part : myList) {
			part.getShipmentOrderVO().getShipmentOrderPricePartList().remove(part);
/ (*)
		}
////////////////////////////////

		getHibernateTemplate().deleteAll(myList);
	}

/ En dan als we op de shipment order, Finance click	,

//////////////////
/ Ze halen dus de coll op uit de db, niet uit de sho, zoals we altijd doen in onze oef	, dus we moeten corrigeren	, bij (*)
/ Je moeten de coll uit de sho halen, en zo via de sho del	,
/ Nu halen ze de coll uit db, en rm in db, buiten de sho om	, 

/s
AbstractEntityActionButton$1.onSubmit() line: 246	
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new Button(aId) {
			@Override
			public void onSubmit() {
				AbstractEntityActionButton.this.onSubmit(this, aModel);
...
/s
ShipmentOrderFinancialPage.<init>() line: 28	

/ later	,
/s
ShipmentOrderVO.getShipmentOrderPricePartByStatus(RatePartStatus) line: 1762	
		Collection<ShipmentOrderPricePartVO> myFoundParts = new ArrayList<ShipmentOrderPricePartVO>();
		for (ShipmentOrderPricePartVO myPart : getShipmentOrderPricePartList()) {
...
/ Hier was de ERR





/ Einde FIX ISB-778






/ we zien	,
com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO.getShipmentOrderPricePartByStatus(ShipmentOrderVO.java:1762









 





























/ 13	. 

/ het form op search panel	,

/ In CIHSearchListPanel.java
public class CIHSearchListPanel extends GenericListPanel<CustomerInvoiceHeader> {
	protected void addFilterColumns(List<IColumn> aColumnList) {
		aColumnList.add(new ConfigurableTextFilteredPropertyColumn<String>(new ResourceModel(CustomerInvoiceHeaderConst.INVOICE_NUMBER),
				CustomerInvoiceHeaderConst.INVOICE_NUMBER, CustomerInvoiceHeaderConst.INVOICE_NUMBER,
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<String>(10)));
/ Al de velden waarop je kunt filter,	 

/ In ConfigurableTextFilteredPropertyColumn.java
public class ConfigurableTextFilteredPropertyColumn<T> extends FilteredPropertyColumn<T> {

/ FilteredPropertyColumn is een Wicket type	,

/ We click op het filter button, "go"	,
/ We vallen eerst in I. , dan in II. , dan in III.	,


/ In GenericListPanel.java
abstract public class GenericListPanel<T extends EntityInterface> extends BaseWebComponent {

/ III
		myColumnsList.add(new FilteredAbstractColumn(filterColTitle) {
			...
			@Override
			public void populateItem(final Item cellItem, final String componentId, final IModel model) {
->				Collection<Component> myList = new ArrayList<Component>();
/s
	private class CheckPanel extends Panel {
		public CheckPanel(String id, Check<T> aCheck) {
->			super(id);
			add(aCheck);
/ en	,
	private class ActionPanel extends Panel {
		public ActionPanel(String id, Collection<Component> aComponentList) {
->			super(id);
			RepeatingView view = new RepeatingView("entity-actions");
			add(view);
			for (Component component : aComponentList) {
[[MarkupContainer [Component id = cell-check]], [MarkupContainer [Component id = cell-actions]]]
/ TODO
				view.add(component);

	protected List<IColumn> columns = new ArrayList<IColumn>();

	protected BeanWrapper<? extends BaseDAOInterface<T>> daoWrapper;

	protected TableDataProviderInterface<T> dataProvider = null;

	public void initialize() {
		final List<IColumn> myColumnsList = new ArrayList<IColumn>();
		myColumnsList.add(new FilteredAbstractColumn(filterColTitle) {

			@Override
			public Component getFilter(final String componentId, final FilterForm form) {
				ResetableGoAndClearFilter resetableGoAndClearFilter = new ResetableGoAndClearFilter(componentId, form, dataProvider, GenericListPanel.this);
				return resetableGoAndClearFilter;
			}
			@Override
			public void populateItem(final Item cellItem, final String componentId, final IModel model) {
			...
		});

		addFilterColumns(myColumnsList);
		columns.addAll(myColumnsList);
		makeTable(myColumnsList);
	}
	protected void makeTable(List<IColumn> aColumnsList) {

		objectDataTable = getDefaultDataTable(aColumnsList);
		filterForm = new FilterForm("filterForm", dataProvider);

/ FilteredAbstractColumn is een Wicket type	,
/ FiterForm is een Wicket type	,

/ FilteredAbstractColumn implements ICellPopulator<T>, IFilteredColumn<T,S>	,
/ implements	,
/ ICellPopulator.populateItem	,
/ IFilteredColumn.getFilter



/ In ResetableGoAndClearFilter.java

public class ResetableGoAndClearFilter<T extends EntityInterface> extends GoFilter {

	public ResetableGoAndClearFilter(String id, FilterForm form, IModel<String> clearModel, TableDataProviderInterface<T> aGenericTableDataProvider,
			final GenericListPanel<EntityInterface> genericListPanel) {
		super(id);

		genericTableDataProvider = aGenericTableDataProvider;

		clear = new Button("clear", clearModel) {
			@Override
			public void onSubmit() {
				onClearSubmit(this);
			}
		};

		// add accesskey attributes to the go and clear buttons. (Alt + key)
		clear.add(new AttributeModifier("accesskey", true, new Model<String>("C")));
		getGoButton().add(new AttributeModifier("accesskey", true, new Model<String>("R")));

		clear.setDefaultFormProcessing(true);

		add(clear);

		int myNumberOfLines = ApplicationPropertyManager.getInstance().getModuleApplicationProperty("oms", "excel.report.maxrows", 65535);
		excel = new ExcelDownloadButton("excel", genericListPanel, myNumberOfLines);
		add(excel);
	}

/ GoFilter is een Wicket type	,  
/ Hier worden er nog de clear en excel button bijgezet	,

/ 13	.

/ de dataProvider in GenericListPanel.java is	,

/ In GenericTableDataProvider.java

public class GenericTableDataProvider<T extends EntityInterface> extends SortableDataProvider<T> implements TableDataProviderInterface<T> {

	public GenericTableDataProvider(final BeanWrapper<? extends BaseDAOInterface<T>> aDaoWrapper, String defaultSortProperty) {
		daoWrapper = aDaoWrapper;
	...

	public class FilterStateFilterExpression extends GenericDAOFilterExpression<T> {
		protected Map<String, Object> filterValues;
		...
	}

/ GenericDAOFilterExpression<T> 
/ TODO


	@Override
	public void resetFilterState() {
		filter = new FilterStateFilterExpression();
	}


/ I.
	@Override
	public Iterator<T> iterator(final int first, final int count) {
		} else {
			return daoWrapper.getBean().runQuery(queryParam, filter).iterator();

this	GenericTableDataProvider<T>  (id=14331)	
	daoWrapper	BeanWrapper<T>  (id=14369)	
		bean	$Proxy415  (id=14372)	
			h	JdkDynamicAopProxy  (id=14374)	
				advised	ProxyFactory  (id=14377)	
					targetSource	SingletonTargetSource  (id=14398)	
						target	CustomerInvoiceHeaderDAOImpl  (id=14333)	

	filter	GenericTableDataProvider$FilterStateFilterExpression  (id=14341)	
		filterValues	HashMap<K,V>  (id=14347)	
{invoiceNumber=INV-102375}

/ II
/s
CustomerInvoiceHeaderDAOImpl(GenericHibernateDAO<Type>).runQuery(QueryParam, DAOFilterExpression<Type>) line: 425	
/=
/ CustomerInvoiceHeaderDAOImpl extends
/ In 
public class GenericHibernateDAO<Type extends EntityInterface> extends BaseHibernateDAO<Type> implements HibernateDAOInterface<Type> {
	@Override
	public List<Type> runQuery(final QueryParam queryParam, final DAOFilterExpression<Type> filter) {
		Map<String, DetachedCriteria> mySubMap = new HashMap<String, DetachedCriteria>();
		DetachedCriteria myDetachedCriteria = prepareCriteria(filter.getLegacyFilter(), mySubMap);
		createCriteria(myDetachedCriteria, filter, mySubMap);
		addSortOrderToQuery(myDetachedCriteria, mySubMap, queryParam.getSort(), queryParam.isSortAsc());
		List<Type> myList = getHibernateTemplate().findByCriteria(myDetachedCriteria, queryParam.getFirst(), queryParam.getCount());
		return myList;
	}

/ we zien	,
/ omdat	,
this	CustomerInvoiceHeaderDAOImpl  (id=14333)	
	type	Class<T> (com.mpobjects.customerinvoice.model.entity.CustomerInvoiceHeader) (id=5935)	

/ SPUM 

select ... 
from CUSTOMER_INVOICE_HEADER this_ 
inner join TMS_USER resource2_ on this_.CREATED_BY_SYSTEMID=resource2_.SYSTEM_ID 
left outer join TMS_USER resource3_ on resource2_.CREATED_BY=resource3_.SYSTEM_ID 
inner join ORGANIZATION organizati4_ on this_.ORGANIZATION_SYSTEMID=organizati4_.SYSTEM_ID 
left outer join ORGANIZATION organizati5_ on organizati4_.ORGANIZATION_GROUP=organizati5_.SYSTEM_ID 
left outer join INVOICE_FINANCIAL_PARTY financialp6_ on this_.INVOICE_RECEIVER_SYSTEMID=financialp6_.SYSTEM_ID 
left outer join INVOICE_FINANCIAL_PARTY financialp7_ on this_.INVOICE_SENDER_SYSTEMID=financialp7_.SYSTEM_ID 
left outer join TMS_USER resource8_ on this_.APPROVED_BY_SYSTEMID=resource8_.SYSTEM_ID 
where this_.ORGANIZATION_SYSTEMID in (
	select uo.organization_systemid 
	from user_organization uo 
	where uo.user_systemid = ?) 
and lower(this_.INVOICE_NUMBER) like ? 
order by this_.INVOICE_DATE asc limit ?
2014-12-23 16:15:54,942 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-1:) binding parameter [1] as [INTEGER] - 27074281
2014-12-23 16:15:54,943 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-1:) binding parameter [2] as [VARCHAR] - %inv-102375%

/ Antwoord	,
[com.mpobjects.customerinvoice.model.entity.CustomerInvoiceHeader/id:27075229

/ we doen het zelf	,

select * 
from CUSTOMER_INVOICE_HEADER this_ 
inner join TMS_USER resource2_ on this_.CREATED_BY_SYSTEMID=resource2_.SYSTEM_ID 
left outer join TMS_USER resource3_ on resource2_.CREATED_BY=resource3_.SYSTEM_ID 
inner join ORGANIZATION organizati4_ on this_.ORGANIZATION_SYSTEMID=organizati4_.SYSTEM_ID 
left outer join ORGANIZATION organizati5_ on organizati4_.ORGANIZATION_GROUP=organizati5_.SYSTEM_ID 
left outer join INVOICE_FINANCIAL_PARTY financialp6_ on this_.INVOICE_RECEIVER_SYSTEMID=financialp6_.SYSTEM_ID 
left outer join INVOICE_FINANCIAL_PARTY financialp7_ on this_.INVOICE_SENDER_SYSTEMID=financialp7_.SYSTEM_ID 
left outer join TMS_USER resource8_ on this_.APPROVED_BY_SYSTEMID=resource8_.SYSTEM_ID 
where this_.ORGANIZATION_SYSTEMID in (
	select uo.organization_systemid 
	from user_organization uo 
	where uo.user_systemid = 27074281) 
and lower(this_.INVOICE_NUMBER) like %inv-102375% 
order by this_.INVOICE_DATE asc limit ?
/ TODO


/ 7	. 

/ In	,
abstract public class GenericListPanel<T extends EntityInterface> extends BaseWebComponent {
	protected TableDataProviderInterface<T> dataProvider = null;
dataProvider	GenericTableDataProvider<T>  (id=920)	

/ in	,
public class GenericTableDataProvider<T extends EntityInterface> extends SortableDataProvider<T> implements TableDataProviderInterface<T> {
	@Override
	public Iterator<T> iterator(final int first, final int count) {
/ Hierin waren we net	,

/  we kwamen per ongelukt in	,
public class GenericDataTable<T> extends DataTable<T> {
	public GenericDataTable(String anId, IColumn<T>[] aColumnList, TableDataProviderInterface<T> aDataProvider, FilterForm aForm) {
...
/ TODO



/ 7	.

/ hierboven	,
/ we fill in onder Invoice Number 'INV-102375'	,
/ we clicked op "go"	, 
/ we krijgen 1 entry	, 

/ we click de edit button	,

public class CIHListPage extends BaseContextPage {

	protected CIHSearchListPanel searchListPanel;

	protected void createListPanel() {
		searchListPanel = new CIHSearchListPanel("searchList", null, webComponentEventSwitchBoard, daoWrapper);
		searchListPanel.setPanelBuilder(new EntityListActionBuilder<CustomerInvoiceHeader>(getPanelActions()));
...

	protected Collection<EntityAction<CustomerInvoiceHeader>> getPanelActions() {
		List<EntityAction<CustomerInvoiceHeader>> actions = new ArrayList<EntityAction<CustomerInvoiceHeader>>();
		EntityActionButton<CustomerInvoiceHeader> editAction = new EntityActionButton<CustomerInvoiceHeader>("edit",
				new ResourceModel("edit").wrapOnAssignment(CIHListPage.this)) {
			@Override
			protected void onSubmit(Button aButton, IModel<CustomerInvoiceHeader> aSelection) {
->				CIHEditPage page = getEditPage();
				page.setEditRecord(aSelection.getObject());
				setResponsePage(page);
			}
		};
		editAction.setSmallButton(true);
		actions.add(editAction);
		return actions;
	} 

/ bij -> ,
...
/s
CIHEditPage.createPage() line: 266	
		createHeaderEditPanel();
/s
CIHEditPage.createHeaderEditPanel() line: 218	
		EntityFormActionBuilder<CustomerInvoiceHeader> panelBuilder = new EntityFormActionBuilder<CustomerInvoiceHeader>(getHeaderFormActions());
/s
CIHEditPage.getHeaderFormActions() line: 425	
/ multiple actions	, 5 of meer	,
panelBuilder	EntityFormActionBuilder<T>  (id=16107)	
	actions	ArrayList<E>  (id=16108)	

		headerEditPanel = new CIHEditPanel("headerEditPanel", webComponentEventSwitchBoard, panelBuilder, daoWrapper);
/ er is oo CIHEditPanel.html	,
/ dit zijn de 5 tables bovenaan de page	, met de actions eronder	,
/s
CIHEditPanel(GenericFormPanel<T>).<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, T, FormActionsPanelBuilder<T>, BeanWrapper<BaseDAOInterface<T>>) line: 52	
			myObject = daoWrapper.getBean().createNewObject();
/ TODO
/ Welke queries	, 
/ SPUM	,
/ TODO
/s
CustomerInvoiceHeaderDAOImpl.createNewObject() line: 40	
		CustomerInvoiceHeader obj = super.createNewObject();
/=new
			CustomerInvoiceHeaderStatusDAO dao = MpoBeanFactory.getBean(CustomerInvoiceHeaderStatusDAO.class);
			CustomerInvoiceHeaderStatus status = dao.getByCode(CustomerInvoiceHeaderStatus.CONCEPT);
/s
CustomerInvoiceHeaderStatusDAOImpl(EnumeratedValueObjectHibernateDAO<T>).getByCode(String) line: 58	


...
			obj.setOrganization(MpoBeanFactory.getBean(OrganizationDAO.class).getByCode(obj.getCreatedBy().getActiveOrganization().getCode()));
/ Einde TODO
...
		createPanel(new GenericCompountPropertyModel<T>(myObject));
myObject	CustomerInvoiceHeader  (id=16555)	
/s
CIHEditPanel(GenericFormPanel<T>).createPanel(GenericCompountPropertyModel<T>) line: 166	
		add(form);
		AbstractActionsPanel<T> actionPanel = getActionsPanel("actionPanel", model);
/s
BaseActionBuilder$EntityActionPanel.<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, IModel<T>) line: 30	
...
			RepeatingView view = new RepeatingView("actions");
			add(view);
			createActions(view, aModel);
/s
EntityFormActionBuilder<T>(BaseActionBuilder<T>).createActions(RepeatingView, IModel<T>) line: 75	
		for (EntityAction<T> action : actions) {
->			Component component = action.createComponent(view.newChildId(), aModel);
			if (component != null) {
				view.add(component);
/s bij ->	,
CIHEditPage$7(EntityActionButton<T>).createComponent(String, IModel<T>) line: 49	
		return new EntityABPanel(aComponentId, createButton(aModel, "button"));

/ Ook	,
CIHEditPage$14(AbstractEntityActionButton<T>).createButton(IModel<T>, String) line: 219	
/ adds behaviors	, 

/t
CIHEditPanel(GenericFormPanel).createPanel(GenericCompountPropertyModel<T>) line: 168	
		AbstractActionsPanel<T> actionPanel = getActionsPanel("actionPanel", model);
		form.add(actionPanel);
/d
/ we hebben nu de buttons	,
/ nu de panels met fields	, boven de buttons,
		setForm(form);
/s
CIHEditPanel.setForm(GenericForm<CustomerInvoiceHeader>) line: 88	
		invoiceNumberField = new RequiredTextField<String>("invoiceNumber");
		invoiceNumberField.add(StringValidator.maximumLength(80));
		invoiceNumberField.setEnabled(false);
		aForm.addWithFeedBackLabel(invoiceNumberField);
...

/ BIJWERKEN NOTES 
/ TODO

/t
CIHEditPage.createHeaderEditPanel() line: 220	
		headerEditPanel = new CIHEditPanel("headerEditPanel", webComponentEventSwitchBoard, panelBuilder, daoWrapper);
/d


/t
CIHEditPage.createPage() line: 269	
		createHeaderEditPanel();
/d
		/** Lines stuff */
		lineDaoWrapper = new BeanWrapper(CustomerInvoiceLineDAO.class);
		linePanel = new CILinePanel("linePanel");
		createLineSearchPanel();
/s
	protected void createLineSearchPanel() {
		lineListPanel = new CILineListPanel("searchLineList", null, webComponentEventSwitchBoard, lineDaoWrapper);
/s
		super(aId, aParent, aWebComponentEventSwitchBoard, aDaoWrapper);
/s
CILineListPanel(GenericListPanel<T>).<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, BeanWrapper<BaseDAOInterface<T>>) line: 110	
/t
CIHEditPage.createLineSearchPanel() line: 236	
		lineListPanel = new CILineListPanel("searchLineList", null, webComponentEventSwitchBoard, lineDaoWrapper);
/d
		lineListPanel.setPanelBuilder(new EntityListActionBuilder<CustomerInvoiceLine>(getLineListActions()));
/s
CIHEditPage.getLineListActions() line: 644	
/ creates 2 'buttons'	,	
/ sets	,
this	CIHEditPage  (id=16543)	
	lineListPanel	CILineListPanel  (id=16570)	
		panelBuilder	EntityListActionBuilder<T>  (id=16578)	
			actions	ArrayList<E>  (id=16590)	

/t
CIHEditPage.createLineSearchPanel() line: 240	
		lineListPanel.setPanelBuilder(new EntityListActionBuilder<CustomerInvoiceLine>(getLineListActions()));
/d
		lineListPanel.initialize();
/s
CILineListPanel(GenericListPanel<T>).initialize() line: 292	
		myColumnsList.add(new FilteredAbstractColumn(filterColTitle) {
			@Override
			public Component getFilter(final String componentId, final FilterForm form) {
				...
			@Override
			public void populateItem(final Item cellItem, final String componentId, final IModel model) {
				...
		addFilterColumns(myColumnsList);
/s
/ adds 3 filters, 	op de 3 columns die we zien	,
/ TODO
/s
CILineListPanel.addFilterColumns(List<IColumn>) line: 82	
		aColumnList.add(new PropertyColumn<String>(new ResourceModel(CustomerInvoiceLineConst.LINE_NUMBER), CustomerInvoiceLineConst.LINE_NUMBER, CustomerInvoiceLineConst.LINE_NUMBER) {
		...
		aColumnList.add(new PropertyColumn<String>(new ResourceModel(CustomerInvoiceLineConst.SHIPMENT_ORDER), "shipmentOrderId", "shipmentOrderId"));
		aColumnList.add(new PropertyColumn<BigDecimal>(new ResourceModel("amount"), "totalAmount"));


/ Intermezzo

		/** Details stuff */
		detailDaoWrapper = new BeanWrapper(CustomerInvoiceDetailDAO.class);
		detailPanel = new CIDetailPanel("detailPanel");
		createDetailSearchPanel();
/s
			detailListPanel = new CIDetailListPanel("searchDetailList", null, webComponentEventSwitchBoard, detailDaoWrapper);
			detailListPanel.setPanelBuilder(new EntityListActionBuilder<CustomerInvoiceDetail>(getDetailListActions()));
/ 2 actions	, zien we als 2 buttons vooraan in de rij van een detail	, edit/delete	,
			detailListPanel.initialize();
/s
		myColumnsList.add(new FilteredAbstractColumn(filterColTitle) {...
		addFilterColumns(myColumnsList);
/s
CIDetailListPanel.addFilterColumns(List<IColumn>) line: 64	
/s
		aColumnList.add(new PropertyColumn<String>(new ResourceModel(CustomerInvoiceDetailConst.LINE_NUMBER), CustomerInvoiceDetailConst.LINE_NUMBER,
				CustomerInvoiceDetailConst.LINE_NUMBER));
		aColumnList.add(new PropertyColumn<String>(new ResourceModel("pricetype"), "priceType.code", "priceType.code"));
		aColumnList.add(new PropertyColumn<BigDecimal>(new ResourceModel("amount"), "amount", "amount"));
		aColumnList.add(new PropertyColumn<VatTariffType>(new ResourceModel("vatTariffType"), "vatTariffType", "vatTariffType"));




		createDetailEditPanel();



/ Einde Intermezzo




/t
CIHEditPage.createPage() line: 272	
		createLineSearchPanel();
/d
		createLineEditPanel();
/s
		EntityFormActionBuilder<CustomerInvoiceLine> panelBuilder = new EntityFormActionBuilder<CustomerInvoiceLine>(getLineFormActions());
/s
CIHEditPage.getLineFormActions() line: 605	
		lineSaveBtn = new EntityActionButton<CustomerInvoiceLine>("ok", new ResourceModel("saveLine")) {
...
		EntityActionButton<CustomerInvoiceLine> lineCancelBtn = new EntityActionButton<CustomerInvoiceLine>("cancel", new ResourceModel("cancelLine")) {


/s
CILineListPanel(GenericListPanel<T>).initialize() line: 292	
		myColumnsList.add(new FilteredAbstractColumn(filterColTitle) {
			@Override
			public Component getFilter(final String componentId, final FilterForm form) {
...
			@Override
			public void populateItem(final Item cellItem, final String componentId, final IModel model) {
...
/ TODO
		addFilterColumns(myColumnsList);

/ nu Invoice Details' panel	,
...
/s
CIHEditPage.createDetailSearchPanel() line: 171	
		detailListPanel.setPanelBuilder(new EntityListActionBuilder<CustomerInvoiceDetail>(getDetailListActions()));
/s
CIHEditPage.getDetailListActions() line: 416	
/ defs 2 actions	, edit/delete	,

/ HIER HIER HIER














/ 7	.















/ RM

/s
CustomerInvoiceGenerator.getFinancialParty(ShipmentOrderVO, String) line: 581	
		} else if (DefaultPartyTypeGroups.SHIP_TO.name().equals(aPartyType)) {
			party = aShipmentOrder.getToPartyVO();

/ Klopt, de financial parties bill_to, ... staan op het scherm ook van de sho	,

/ aShipmentOrder is een proxy	,

/s
ShipmentOrderVO(LogisticsOrderVO).getToPartyVO() line: 712	

/ this is weer de handler.target van de proxy	,

	return theToPartyVO;
this	ShipmentOrderVO  (id=17783)	
	theToPartyVO	VirtualParty  (id=17802)	
		address	"qwwe" (id=17804)	
		address2	"" (id=17805)	
		city	"Terneuzen" (id=17806)	
		contactName	"" (id=17857)	
		countryVO	Country_$$_javassist_57  (id=17858)	
		currencyDAO	null	
		dao	null	
		description	null	
		emailAddress	"" (id=17859)	
		entityDetails	HashMap<K,V>  (id=17860)	
		faxNumber	"" (id=17861)	
		latitude	null	
		longitude	null	
		manifestReport	"" (id=17796)	
		name	"Oiltanking" (id=17862)	
		name2	"TER" (id=17863)	
		organization	null	
		partyGroups	HashSet<E>  (id=17864)	
		partyId	"TER_OIL" (id=17865)	
		partyType	null	
		performanceMonitorService	null	
		phoneNumber	"" (id=17866)	
		postalCode	"" (id=17867)	
		prenotifyCarcon	false	
		qualifier	"" (id=17796)	
		reference1	"135.00" (id=17868)	
		reference2	"23.00" (id=17869)	
		reference3	"4.75" (id=17870)	
		reference4	"9.85" (id=17871)	
		reference5	"" (id=17872)	
		regionState	"" (id=17909)	
		scheduleVo	null	
		serviceOrderUrlExpression	"" (id=17796)	
		serviceRemarks	"" (id=17796)	
		systemId	0	
		theFormattedEntity	null	
		TimeZone	null	

		final String partyId = party.getCode();
partyId	"TER_OIL" (id=17865)	

		// look up the real party master data
		party = PartyDAOFactory.getInstance().getDAO().getPartyByPartyId(partyId);
/s
/ tx 
/ dao.methods altijd in een tx	,
/s
PartyDAOImpl.getPartyByPartyId(String) line: 193	
/s
	public PartyVO getPartyByPartyId(String aPartyId, boolean aDeleted) {
		DetachedCriteria myCriteria = DetachedCriteria.forClass(PartyVO.class);
		myCriteria.add(Property.forName("partyId").eq(aPartyId));
		myCriteria.add(Property.forName("deleted").eq(aDeleted));
		List<PartyVO> myList = findByCriteria(myCriteria);
/s
	public List<Type> findByCriteria(DetachedCriteria aDetachedCriteria) {
		return getHibernateTemplate().findByCriteria(aDetachedCriteria);
/s
ShipmentOrderVO(LogisticsOrderVO).getToPartyVO() line: 712	
		return theToPartyVO;

/t
CustomerInvoiceGenerator.getFinancialParty(ShipmentOrderVO, String) line: 605	
		party = PartyDAOFactory.getInstance().getDAO().getPartyByPartyId(partyId);
/d
party	PartyVO  (id=17938)	
	address	"qwwe" (id=17940)	
	address2	"" (id=17941)	
	attachments	PersistentSet  (id=17942)	
	city	"Terneuzen" (id=17943)	
	contactName	"" (id=17944)	
	countryVO	Country_$$_javassist_57  (id=17858)	
	currencyDAO	null	
	dao	null	
	deleted	false	
	description	null	
	emailAddress	"" (id=17945)	
	entityDetails	PersistentMap  (id=17946)	
	faxNumber	"" (id=17947)	
	latitude	null	
	longitude	null	
	manifestReport	"" (id=17948)	
	manifestReport	"" (id=17796)	
	name	"Oiltanking" (id=17949)	
	name2	"TER" (id=17950)	
	organization	Organization  (id=17270)	
	partyGroups	PersistentSet  (id=17951)	
	partyGroupsAsString	null	
	partyId	"TER_OIL" (id=17952)	
	partyPrenotificationRuleList	PersistentBag  (id=17953)	
	partyType	PartyType_$$_javassist_171  (id=17954)	
	performanceMonitorService	null	
	phoneNumber	"" (id=17962)	
	postalCode	"" (id=17963)	
	prenotifyCarcon	false	
	prenotifyCarcon	false	
	qualifier	"" (id=17796)	
	qualifier	"" (id=17796)	
	reference1	"135.00" (id=17964)	
	reference2	"23.00" (id=17965)	
	reference3	"4.75" (id=17966)	
	reference4	"9.85" (id=17967)	
	reference5	"" (id=17968)	
	regionState	"" (id=17969)	
	scheduleVo	null	
	scheduleVo	null	
	serviceOrderUrlExpression	"" (id=17970)	
	serviceOrderUrlExpression	"" (id=17796)	
	serviceRemarks	"" (id=17971)	
	serviceRemarks	"" (id=17796)	
	systemId	30551	
	theFormattedEntity	null	
	timeZone	null	
	TimeZone	null	
	tntZone	null	

		// first look for binding
		FinancialPartyPartyBinding binding = serviceImpl.getFinancialPartyPartyBindingDAO().getBinding(party);
/s
/ tx
/s
FinancialPartyPartyBindingDAOImpl.getBinding(Party) line: 37	
		args.put("party", aParty);
/ aParty=TER_OIL
		Collection<FinancialPartyPartyBinding> result = findEqualsWithQueryMap(args);
/s
FinancialPartyPartyBindingDAOImpl(GenericHibernateDAO<Type>).findEqualsWithQueryMap(Map<String,Object>) line: 223	
/=
	public Collection<Type> findEqualsWithQueryMap(Map<String, Object> aCriteriaQueryMap) {

/ we zien	,
<hibernate-mapping package="com.mpobjects.invoice.model">
	<class name="FinancialPartyPartyBinding" table="INVOICE_FINANCIAL_PARTY_BINDING">	



isbscs=# select*from invoice_financial_party_binding order by financial_party_systemid;
 system_id | financial_party_systemid | party_systemid 
-----------+--------------------------+----------------
  26595183 |                 26595181 |       26595155
  26597459 |                 26597455 |       26597456
  27074663 |                 26597455 |          30551
  27069752 |                 26597455 |       27059802
  26602887 |                 26602885 |       26602882
  26604599 |                 26602885 |       26604597
  26603046 |                 26603038 |       26603036
  26617755 |                 26617752 |       26617748
  26617757 |                 26617753 |       26617750
  27064499 |                 26628012 |          25013
  26628014 |                 26628012 |       26598679
  27072459 |                 26628012 |          22027
  27057457 |                 27057455 |       26594755
  27063217 |                 27063215 |       27058884
(14 rows)

isbscs=# select*from invoice_financial_party where system_id=26597455;       
 system_id | organization_systemid | is_deleted | financial_party_id |     name     | name2 | address | address2 | zipcode |     city     | region_state | country_systemid | contact_n
ame  |   emailaddress    | phonenumber  | faxnumber |  vat_number  | payment_block | payment_std_currency_systemid | payment_term | reference1 | reference2 | reference3 | reference4 |
 reference5 | remark | bill_to_name | bill_to_name2 |    bill_to_adress    | bill_to_adress2 | bill_to_zipcode | bill_to_city | bill_to_region_state | bill_to_country_code_systemid | 
bill_to_contact_name | bill_to_email_adress | bill_to_phonenumber | bill_to_faxnumber | payment_term_end_of_month | match_level | treshold_down_percentage | treshold_down_absolut | tr
eshold_up_percentage | treshold_up_absolut | match_invoice_identifier | creditor_code | match_all_cost_types | use_edi | disponability_term | disponability_percentage | self_bill | bi
lling_cycle | invoice_group_mode | self_bill_invoice_systemid | cost_allocation_method 
-----------+-----------------------+------------+--------------------+--------------+-------+---------+----------+---------+--------------+--------------+------------------+----------
-----+-------------------+--------------+-----------+--------------+---------------+-------------------------------+--------------+------------+------------+------------+------------+
------------+--------+--------------+---------------+----------------------+-----------------+-----------------+--------------+----------------------+-------------------------------+-
---------------------+----------------------+---------------------+-------------------+---------------------------+-------------+--------------------------+-----------------------+---
---------------------+---------------------+--------------------------+---------------+----------------------+---------+--------------------+--------------------------+-----------+---
------------+--------------------+----------------------------+------------------------
  26597455 |                   500 |          0 | ALCODIS SA         | Alcodis S.A. |       | TBD     |          | 54321   | Not Brussels |              |             4019 | David Tae
lman | dth@alcogroup.com | +32477883799 |           | BE1234567890 |             0 |                          7001 |           30 |            |            |            |            |
            |        | Alcodis      |               | Somewhere in Belgium |                 | 12345           | Brussels     |                      |                          4019 | 
Cecile Carlier       | dth@alcogroup.com    | +32475546311        |                   |                         0 | LEVEL B     |                  0.00000 |               0.00000 |   
             0.00000 |             0.00000 | SERVICE_ORDER_ID         | 00023151      |                    0 |       0 |                  0 |                  0.00000 |         0 |   
            |                    |                            | ON_HEADER_APPROVAL
(1 row)

isbscs=#   select*from party where system_id in ( 26597456,30551,27059802);
 system_id | is_deleted | party_id | party_type_systemid | organization_systemid |     name     | name2 |          address           | address2 |   city    | zipcode | country_systemi
d | contact_name | emailaddress | faxnumber | phonenumber | region_state | tnt_zone | reference1 | reference2 | reference3 | reference4 | reference5 | service_order_url_expression | m
anifest_report | time_zone | longitude | latitude | schedule_systemid | prenotify_carcon | service_remarks 
-----------+------------+----------+---------------------+-----------------------+--------------+-------+----------------------------+----------+-----------+---------+----------------
--+--------------+--------------+-----------+-------------+--------------+----------+------------+------------+------------+------------+------------+------------------------------+--
---------------+-----------+-----------+----------+-------------------+------------------+-----------------
  27059802 |          0 | BUNGE    |            26594712 |                   530 | .            |       | .                          |          |           |         |             415
3 |              |              |           |             |              |          |            |            |            |            |            |                              |  
               |           |           |          |                   |                0 | 
  26597456 |          0 | ALCODIS  |            26594712 |                   500 | Alcodis S.A. |       | Boulevard du Souverain 100 |          | Brussels  |         |             401
9 |              |              | !         |             |              |          |            |            |            |            |            |                              |  
               |           |           |          |                   |                0 | 
     30551 |          0 | TER_OIL  |            26594713 |                   500 | Oiltanking   | TER   | qwwe                       |          | Terneuzen |         |             415
3 |              |              |           |             |              |          | 135.00     | 23.00      | 4.75       | 9.85       |            |                              |  
               |           |           |          |                   |                0 | 
(3 rows)


/ een partij heeft meerdere afdelingen	, dat zijn de party's	,
/ ze hebben gemeenschappelijk een financial party	,



/ aCriteriaQueryMap={
party=SystemId:30551-
	Party:TER_OIL-
	PartyType:com.mpobjects.oms.model.entity.partytype.PartyType@5ee34e20[Terminal,Terminal]}

		DetachedCriteria myDetachedCriteria = DetachedCriteria.forClass(type);

/t
FinancialPartyPartyBindingDAOImpl.getBinding(Party) line: 46	
		Collection<FinancialPartyPartyBinding> result = findEqualsWithQueryMap(args);
result	ArrayList<E>  (id=18176)	
	elementData	Object[10]  (id=18179)	
		[0]	FinancialPartyPartyBinding  (id=18183)	
			financialParty	FinancialPartyVO  (id=18185)	
			party	PartyVO  (id=17938)	
			systemId	27074663	
/ De rij uit de db	,

/t
CustomerInvoiceGenerator.getFinancialParty(ShipmentOrderVO, String) line: 611	
		FinancialPartyPartyBinding binding = serviceImpl.getFinancialPartyPartyBindingDAO().getBinding(party);
/d
		if (binding != null) {
			return binding.getFinancialParty();

/t
CustomerInvoiceGenerator.generateInvoice(ShipmentOrderVO, ShipmentOrderPricePartVO, InvoiceType, InvoiceTemplate) line: 457	
		FinancialPartyVO receiver = getInvoiceReceiver(aShipmentOrder, myInvoiceTemplate);
/d
		FinancialPartyVO sender = getInvoiceSender(aShipmentOrder, myInvoiceTemplate);
/s
CustomerInvoiceGenerator.getInvoiceSender(ShipmentOrderVO, InvoiceTemplate) line: 709	
/=
protected FinancialPartyVO getInvoiceSender(ShipmentOrderVO aShipmentOrder, InvoiceTemplate aTemplate) {

/ aTemplate is een proxy, WH resolved	, 
		String partyType = null;
		if (aTemplate != null && !StringUtils.isBlank(aTemplate.getSenderCode())) {
			partyType = aTemplate.getSenderCode();
partyType	"SHIP_TO" (id=17746)	

		return getFinancialParty(aShipmentOrder, partyType);
/s
	protected FinancialPartyVO getFinancialParty(ShipmentOrderVO aShipmentOrder, String aPartyType) {
		} else if (DefaultPartyTypeGroups.SHIP_TO.name().equals(aPartyType)) {
			party = aShipmentOrder.getToPartyVO();
/ aShipmentOrder is WH resolved proxy	,
party	VirtualParty  (id=17802)	
PARTY id:TER_OIL(systemId:0)

		final String partyId = party.getCode();
TER_OIL
		// look up the real party master data
		party = PartyDAOFactory.getInstance().getDAO().getPartyByPartyId(partyId);
/s
PartyDAOImpl.getPartyByPartyId(String) line: 193	
		return getPartyByPartyId(aPartyId, false);
/s
	public PartyVO getPartyByPartyId(String aPartyId, boolean aDeleted) {
		DetachedCriteria myCriteria = DetachedCriteria.forClass(PartyVO.class);
		myCriteria.add(Property.forName("partyId").eq(aPartyId));
		myCriteria.add(Property.forName("deleted").eq(aDeleted));
		List<PartyVO> myList = findByCriteria(myCriteria);

/t
CustomerInvoiceGenerator.getFinancialParty(ShipmentOrderVO, String) line: 611	
		final String partyId = party.getCode();
/d
party	PartyVO  (id=17938)	
	address	"qwwe" (id=17940)	
	address2	"" (id=17941)	
	attachments	PersistentSet  (id=17942)	
	city	"Terneuzen" (id=17943)	
	contactName	"" (id=17944)	
	countryVO	Country_$$_javassist_57  (id=17858)	
	currencyDAO	null	
	dao	null	
	deleted	false	
	description	null	
	emailAddress	"" (id=17945)	
	entityDetails	PersistentMap  (id=17946)	
	faxNumber	"" (id=17947)	
	latitude	null	
	longitude	null	
	manifestReport	"" (id=17948)	
	manifestReport	"" (id=17796)	
	name	"Oiltanking" (id=17949)	
	name2	"TER" (id=17950)	
	organization	Organization  (id=17270)	
	partyGroups	PersistentSet  (id=17951)	
	partyGroupsAsString	null	
	partyId	"TER_OIL" (id=17952)	
	partyPrenotificationRuleList	PersistentBag  (id=17953)	
	partyType	PartyType_$$_javassist_171  (id=17954)	
	performanceMonitorService	null	
	phoneNumber	"" (id=17962)	
	postalCode	"" (id=17963)	
	prenotifyCarcon	false	
	prenotifyCarcon	false	
	qualifier	"" (id=17796)	
	qualifier	"" (id=17796)	
	reference1	"135.00" (id=17964)	
	reference2	"23.00" (id=17965)	
	reference3	"4.75" (id=17966)	
	reference4	"9.85" (id=17967)	
	reference5	"" (id=17968)	
	regionState	"" (id=17969)	
	scheduleVo	null	
	scheduleVo	null	
	serviceOrderUrlExpression	"" (id=17970)	
	serviceOrderUrlExpression	"" (id=17796)	
	serviceRemarks	"" (id=17971)	
	serviceRemarks	"" (id=17796)	
	systemId	30551	
	theFormattedEntity	null	
	timeZone	null	
	TimeZone	null	
	tntZone	null	

		// first look for binding
		FinancialPartyPartyBinding binding = serviceImpl.getFinancialPartyPartyBindingDAO().getBinding(party);
/s
/tx
/ s
FinancialPartyPartyBindingDAOImpl.getBinding(Party) line: 37	
		args.put("party", aParty);
		Collection<FinancialPartyPartyBinding> result = findEqualsWithQueryMap(args);
/s
FinancialPartyPartyBindingDAOImpl(GenericHibernateDAO<Type>).findEqualsWithQueryMap(Map<String,Object>) line: 226	

		DetachedCriteria myDetachedCriteria = DetachedCriteria.forClass(type);
type	Class<T> (com.mpobjects.invoice.model.FinancialPartyPartyBinding) (id=8692)	

		for (String myAttribute : aCriteriaQueryMap.keySet()) {
			myDetachedCriteria.add(Property.forName(myAttribute).eq(aCriteriaQueryMap.get(myAttribute)));
/ aCriteriaQueryMap=
{party=SystemId:30551-
Party:TER_OIL-
PartyType:com.mpobjects.oms.model.entity.partytype.PartyType@5ee34e20[Terminal,Terminal]}

/t
		Collection<FinancialPartyPartyBinding> result = findEqualsWithQueryMap(args);
/d
result	ArrayList<E>  (id=18319)	
	elementData	Object[1]  (id=18322)	
		[0]	FinancialPartyPartyBinding  (id=18183)	
			financialParty	FinancialPartyVO  (id=18185)	
			party	PartyVO  (id=17938)	
			systemId	27074663	

/t
CustomerInvoiceGenerator.getFinancialParty(ShipmentOrderVO, String) line: 611	
		FinancialPartyPartyBinding binding = serviceImpl.getFinancialPartyPartyBindingDAO().getBinding(party);
/d
		if (binding != null) {
			return binding.getFinancialParty();

/t
CustomerInvoiceGenerator.generateInvoice(ShipmentOrderVO, ShipmentOrderPricePartVO, InvoiceType, InvoiceTemplate) line: 469	
		FinancialPartyVO sender = getInvoiceSender(aShipmentOrder, myInvoiceTemplate);
/d

		CurrencyVO currency = aPart.getCurrencyVO();
aPart	ShipmentOrderPricePartVO  (id=17229)	
	currency	CurrencyVO_$$_javassist_133  (id=17838)	

		InvoiceHeaderKey key = new InvoiceHeaderKey(myInvoiceTemplate, sender, receiver, currency);
		CustomerInvoiceHeader header = invoices.get(key);
null
/ want	 invoices={}

			header = createNewInvoice(aShipmentOrder, key);
/s
CustomerInvoiceGenerator.createNewInvoice(ShipmentOrderVO, InvoiceHeaderKey) line: 383	
/=
	protected CustomerInvoiceHeader createNewInvoice(ShipmentOrderVO aShipmentOrder, InvoiceHeaderKey aKey) {

/ akey={ALCODIS SA,ALCODIS SA,EUR,Standard Freight}

/ Intermezzo

$ vi Party.standard.hbm.xml

	<class name="PartyVO" table="PARTY">

/ Einde Intermezzo

		CustomerInvoiceHeader header = new CustomerInvoiceHeader();
		header.setCreateDate(new Date());
		header.setCreatedBy(creator);
Resource:eric(systemId:27074281)
		header.setOrganization(aKey.getSender().getOrganizationVO());
		header.setCurrency(aKey.getCurrency());
		header.setInvoiceReceiver(aKey.getReceiver());
		header.setInvoiceSender(aKey.getSender());
		header.setInvoiceDate(invoiceDate);
		header.setInvoiceTemplate(aKey.getInvoiceTemplate());
com.mpobjects.invoice.model.invoicetemplate.InvoiceTemplate/id:27067160	,
/ dat is	,
  27067160 | Standard Freight |                         |                   500 |                27057569 |                        | SHIP_TO  |                      | SHIP_TO

		header.setStatus(getGeneratingStatus());
/s
CustomerInvoiceGenerator.getGeneratingStatus() line: 625	
			generatingStatus = serviceImpl.getCustomerInvoiceHeaderStatusDAO().getByCode(CustomerInvoiceHeaderStatus.GENERATING);
/s
CustomerInvoiceHeaderStatusDAOImpl(EnumeratedValueObjectHibernateDAO<T>).getByCode(String) line: 58	
...
/ TODO

/ t
CustomerInvoiceGenerator.createNewInvoice(ShipmentOrderVO, InvoiceHeaderKey) line: 405	
		header.setStatus(getGeneratingStatus());
/d
com.mpobjects.customerinvoice.model.entity.CustomerInvoiceHeaderStatus@184f3426[GENERATING,Invoice is being generated.]

		serviceImpl.getCustomerInvoiceHeaderDAO().save(header);

/ Intermezzo

serviceImpl	CustomerInvoiceServiceImpl  (id=15763)	
/ Geen proxy 	, 
/ terwijl toch	,
$ vi customerinvoice-sb.xml

	<bean id="com.mpobjects.customerinvoice.model.service.CustomerInvoiceService" parent="transactionRequiredTemplate">
		<property name="target">
			<bean class="com.mpobjects.customerinvoice.model.service.CustomerInvoiceServiceImpl">
				<property name="customerInvoiceDetailDAO" ref="com.mpobjects.customerinvoice.dao.CustomerInvoiceDetailDAO" />
...


/ Einde Intermezzo

/s
CustomerInvoiceHeaderDAOImpl(GenericHibernateDAO<Type>).save(Type) line: 476	
	if (anEntity.getSystemId() == 0) {
			getHibernateTemplate().persist(anEntity);

/t
		invoices.put(aKey, header);
aKey={ALCODIS SA,ALCODIS SA,EUR,Standard Freight}
header	CustomerInvoiceHeader  (id=18394)	
	approvalDate	null	
	approvedBy	null	
	approvementRemarks	"" (id=17796)	
	createDate	Date  (id=18425)	
	createdBy	Resource  (id=17212)	
	currency	CurrencyVO_$$_javassist_133  (id=17838)	
	document	null	
	externalInvoiceNumber	null	
	invoiceDate	Date  (id=17213)	
	invoiceDueDate	Date  (id=18488)	
	invoiceLines	PersistentSortedSet  (id=18508)	
	invoiceNumber	"INV-102369" (id=18510)	
	invoiceReceiver	FinancialPartyVO  (id=18185)	
	invoiceReceiverSystemId	Integer  (id=18513)	
	invoiceSender	FinancialPartyVO  (id=18185)	
	invoiceSenderSystemId	Integer  (id=18516)	
	invoiceTemplate	InvoiceTemplate_$$_javassist_116  (id=17315)	
	invoiceType	InvoiceType  (id=17230)	
	organization	Organization  (id=17270)	
	performanceMonitorService	null	
	remarks	"" (id=17796)	
	status	CustomerInvoiceHeaderStatus  (id=18480)	
	systemId	27074934	
	totalInvoiceAmountExcVat	BigDecimal  (id=18489)	
	totalInvoiceAmountFreeVat	BigDecimal  (id=18489)	
	totalInvoiceAmountHighVat	BigDecimal  (id=18489)	
	totalInvoiceAmountLowVat	BigDecimal  (id=18489)	
	totalInvoiceAmountRevVat	BigDecimal  (id=18489)	
	totalVatAmountHigh	BigDecimal  (id=18489)	
	totalVatAmountLow	BigDecimal  (id=18489)	
	vatPolicy	null	
	vatPolicySystemId	Integer  (id=18533)	

/t
CustomerInvoiceGenerator.generateInvoice(ShipmentOrderVO, ShipmentOrderPricePartVO, InvoiceType, InvoiceTemplate) line: 499	
			header = createNewInvoice(aShipmentOrder, key);
/d


		CustomerInvoiceLine line = getInvoiceLine(header, aShipmentOrder);

aShipmentOrder	ShipmentOrderVO_$$_javassist_135  (id=17193)	
ShipmentOrder: SH000000200(SystemId:27057351; Org:ISB)
		Map<Integer, CustomerInvoiceLine> cache = lineCache.get(aHeader);
lineCache={}
		List<CustomerInvoiceLine> existingLines = serviceImpl.getCustomerInvoiceLineDAO().findLine(aHeader, aShipmentOrder);
/s
	public List<CustomerInvoiceLine> findLine(CustomerInvoiceHeader aHeader, ShipmentOrderVO aShipmentOrder) {
		DetachedCriteria crit = DetachedCriteria.forClass(CustomerInvoiceLine.class);
		crit.add(Property.forName("invoiceHeader").eq(aHeader));
		crit.add(Property.forName("shipmentOrderSystemId").eq(aShipmentOrder.getSystemId()));
		crit.addOrder(Order.asc("lineNumber"));
		return findByCriteria(crit);

$ vi CustomerInvoiceLine.standard.hbm.xml
<hibernate-mapping package="com.mpobjects.customerinvoice.model.entity">
	<class name="CustomerInvoiceLine" table="CUSTOMER_INVOICE_LINE">




























/s
			} else {
				result = gen.generateInvoice(myToProcess);
/ myToProcess=
[ShipmentOrder: SH000000200(SystemId:27057351; Org:ISB)]
/s
CustomerInvoiceGenerator.generateInvoice(Collection<ShipmentOrderVO>, InvoiceTemplate) line: 237	
			for (ShipmentOrderPricePartVO part : myShipmentOrderVO.getShipmentOrderPricePartList()) {

[theSystemId: 27074717, Amount :8.00000, 
theSystemId: 27057434, Amount :10.00000, 
theSystemId: 27074679, Amount :100.00000, 
theSystemId: 27074753, Amount :10.00000, 
theSystemId: 27074754, Amount :100.00000, 
theSystemId: 27057436, Amount :20.00000, 
theSystemId: 27074666, Amount :20.00000, 
theSystemId: 27074693, Amount :30.00000, 
theSystemId: 27074697, Amount :30.00000]

/ Voorbeeld	,
isbscs=# select *from shipment_order_price_part  where system_id=27074717;
 system_id | shipment_order_systemid | correction_type | price_type_systemid | sequence_nr | reason | entry_type | amount | cost_component_spec_systemid | invoice_status | invoice_reference | currency_systemid | source_ref |  status   
----------
  27074717 |                27057351 | ADD             |            27058858 |           5 |        | MANUAL     | 8.00000 |                              | CONCEPT        | INV-102366        |              7001 |            | ESTIMATED

/ er zijn ook  shipment_order_price_part met invoice_reference is null	,

isbscs=# select system_id,invoice_reference from shipment_order_price_part where invoice_reference is null;
...
isbscs=# select system_id,invoice_reference from shipment_order_price_part where invoice_reference is not null;
...













 







 

 



/ Einde ISB-778

/ SVN

/ bij conficts	,
/ als je de remote file wilt: override and update
/ als je de local wilt: update

/ checkout: update
/ checkin: commit

/ Einde SVN


/ BUILD NA SVN

/ 1ste patch ERR	,
isbscs=# update mpo_scs_patch set status='SKIPPED' where name ='patch-465-order-validation-rule$postgresql.sql';

/ 2de patch ERR	,
 27061234 | BUA_DOW   | BUTYLACRYLATEN, GESTABILISEERD (n-BUTYLACRYLAAT, GESTABILISEERD) |                   500 | 8199   |       | BUA        |               |        |        |
        | 1.1110 |               |                  |               |                   |                        |                    |                     |            |         
   |            |            |             |            |             |                      |                  |                   |          0 |   1.00000 |                 |   
      |               |               |                       3453 |                        
  26653301 | ETH       | Ethanol                                                          |                   500 | 1170   |       | ETH        |               |        | 1.0000 |
        | 1.2660 |               |                  |               |                   |                        |                    |                     |            |         
   |            |            |             |            |             |                      |                  |                   |          0 |   1.00000 |                 |   
      | CHE           |               |                       3124 |                        

isbscs=#  update product set dg_adn_tankvessel_systemid =null; 

/ Einde BUILD NA SVN

/ NETWORK

[eric@localhost ~]$ ssh system.mp-objects.com
mpo@2014
eric@mpodt004:~$ pwd
/home/INTERNAL/eric
eric@mpodt004:/tmp$ ls
isbscs-2015-01-15.psql.gz ... 

[eric@localhost Backup]$ pwd
/home/eric/Devel/Postgres/Backup
[eric@localhost Backup]$ scp eric@mpodt004:/tmp/isbscs-2015-01-15.psql.gz .
/ OK

[eric@localhost forticlientsslvpn]$ pwd
/home/eric/Devel/Intermax/forticlientsslvpn
[eric@localhost forticlientsslvpn]$ ls
forticlientsslvpn  forticlientsslvpn_cli  helper

/ see LOG_18_jul_2014.txt	, 
/ Het VPN wachtwoord is nu HA65Fs8LTTCK
/ Use Digipass op telefoon	,

[eric@localhost forticlientsslvpn]$ sudo ./forticlientsslvpn_cli --server 80.95.170.62:443 --vpnuser vanderveldene
HA65Fs8LTTCK266983

/ doe dan	,
[eric@localhost forticlientsslvpn]$ ssh vanderveldene@192.168.171.1
h^Zgcyr&Q
[vanderveldene@scs-application-p ~]$ 

/ Lees	,
https://system.mp-objects.com/xwiki/bin/view/Technology/Intermax

[eric@localhost forticlientsslvpn]$ ssh vanderveldene@192.168.173.21
/ of	,
[eric@localhost forticlientsslvpn]$ ssh vanderveldene@interstream-a.intermax.mp-objects.com
h^Zgcyr&Q



/ Einde NETWORK

/ POSTGRESQL DUMP ISB IN ACCEPTANCE

/ 7	. 

[eric@localhost forticlientsslvpn]$ sudo ./forticlientsslvpn_cli --server 80.95.170.62:443 --vpnuser vanderveldene
HA65Fs8LTTCK...
[eric@localhost ]$ ssh vanderveldene@interstream-a.intermax.mp-objects.com

[vanderveldene@interstream-acc ~]$ vi /local/apps/jboss-4.0.5.GA/server/isbscs/log/server.log.2015-01-13
...
[vanderveldene@interstream-acc isbscs]$ pwd
/local/apps/jboss-4.0.5.GA/server/isbscs
$ vi deploy/postgres-ds.xml
               <xa-datasource-property name="DatabaseName">isbscs</xa-datasource-property>
               <xa-datasource-property name="User">mpopostgres</xa-datasource-property>
               <xa-datasource-property name="Password">mpopostgres@mpo</xa-datasource-property>

[vanderveldene@interstream-acc ~]$ PGPASSWORD=mpopostgres@mpo pg_dump -n public isbscs -U mpopostgres  -f isbscs.c.dump -F c
[vanderveldene@interstream-acc ~]$ PGPASSWORD=mpopostgres@mpo pg_dump -n public isbscs -U mpopostgres  -f isbscs.p.dump -F p

/ Op localhost	,

[eric@localhost tmp]$ scp vanderveldene@interstream-a.intermax.mp-objects.com:isbscs.c.dump .
vanderveldene@interstream-a.intermax.mp-objects.com's password:h^Zgcyr&Q
[eric@localhost tmp]$ scp vanderveldene@interstream-a.intermax.mp-objects.com:isbscs.p.dump .
vanderveldene@interstream-a.intermax.mp-objects.com's password:h^Zgcyr&Q

isbscs=# create database isbscs2;
CREATE DATABASE

[eric@localhost tmp]$ PGPASSWORD=mpopostgres@mpo pg_restore  -d isbscs2 -U mpopostgres --no-owner --no-acl isbscs.c.dump 

isbscs=# create database isbscs3;
CREATE DATABASE

[eric@localhost tmp]$ PGPASSWORD=mpopostgres@mpo psql  -d isbscs3 -U mpopostgres  -f isbscs.p.dump 
/ opties --no-user en --no-acl kent psql niet	,
/ TODO

[eric@localhost tmp]$ cp isbscs.c.dump ~/Devel/Postgres/Backup/isbscs-2015-01-15.from.interstream-a.intermax.mp-objects.com.c.dump
[eric@localhost tmp]$ cp isbscs.p.dump ~/Devel/Postgres/Backup/isbscs-2015-01-15.from.interstream-a.intermax.mp-objects.com.p.dump

[eric@localhost tmp]$ ls ~/Devel/Postgres/Backup/
isbscs-2015-01-15.psql.gz
/ Is van Paul, nog niet used	,

[eric@localhost isbscs]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/isbscs
[eric@localhost isbscs]$ vi deploy/postgres-ds.xml
...
                <xa-datasource-property name="DatabaseName">isbscs2</xa-datasource-property>
...
                <connection-url>jdbc:postgresql://127.0.0.1:5432/isbscs2</connection-url>



/ Einde POSTGRESQL DUMP ISB IN ACCEPTANCE

/ POSTGRESQL DUMP 

/ Lees	LOG_2_jun_2014.txt bij my.y over permissions	, want	,
[eric@localhost tmp]$ PGPASSWORD=foo pg_dump -h localhost -U foo -F c  -f foo.dump foo
pg_dump: [archiver (db)] query failed: ERROR:  permission denied for relation y
pg_dump: [archiver (db)] query was: LOCK TABLE my.y IN ACCESS SHARE MODE
/ Doe	,
/ TODO (Deze melding krijg ik niet meer, want foo heeft my.y drop table, en daarna weer my.y create table	,)	,

/ 7		.

/ we dump bar, create bar2	, insert dump bar in bar2	,

bar=> \c bar bar
bar2=>  create table x(s varchar(32));
CREATE TABLE
bar2=> insert into x values(7),(13);
INSERT 0 2

[eric@localhost tmp]$ PGPASSWORD=bar pg_dump -h localhost  -U bar  -f bar.dump 
/ we kunnen arg 'bar' weglaten, omdat user bar is	, maar als we db bar2 willen dump, dan moet het	,

bar=> create database bar2;
CREATE DATABASE

[eric@localhost tmp]$ sudo -u postgres psql -d bar2 -f bar.dump 
SET
SET
SET
SET
SET
SET
CREATE EXTENSION
COMMENT
SET
SET
SET
CREATE TABLE
ALTER TABLE
REVOKE
REVOKE
GRANT
GRANT

/ Omdat we -d bar2 , komt tables, ... in bar2 db	,

/ 7	.

/ we dump bar2, remove bar2 en restore bar2	,

/ voor de zekerheid, we rename table x naar y	,

[eric@localhost tmp]$ PGPASSWORD=bar pg_dump -h localhost  -U bar  -f bar2.dump bar2
/ we MOETEN bar2 arg geven	, anders pakt hij de bar db	,

bar=> drop database bar2;create database bar2;

[eric@localhost tmp]$ sudo -u postgres psql -d bar2 -f bar2.dump 
SET
SET
SET
SET
SET
SET
CREATE EXTENSION
COMMENT
SET
SET
SET
CREATE TABLE
ALTER TABLE
REVOKE
REVOKE
GRANT
GRANT

/ -d bar2 MOET	, anders komen we in db postgres	,
/ als we NIET -d bar2	, komt de tables uit bar2 in de postgres db, maar de owner is wel bar	, dat staat in het bar.dump script	,

/ in pg_class kan alleen de owner de table zien	, postgres niet eens	,

[eric@localhost tmp]$  PGPASSWORD=bar pg_dump -h localhost  -U bar  -f bar2.dump bar2
/ = -F p

/ 7	.

[eric@localhost tmp]$ PGPASSWORD=bar psql -U bar -d bar2  -f -C bar2.C.dump
/ Hoe restore?

/ 7	.

/ pg_restore -F c, t, d	, dus werkt niet met text	, use dan psql	,

bar=> create database bar2;
bar=> \c bar2
bar2=>   create table saskia(s varchar(32));
bar2=> insert into saskia values(7),(13);


[eric@localhost tmp]$  PGPASSWORD=bar pg_dump -h localhost  -U bar  -f bar2.c.dump -F c bar2

bar2=> \c bar
bar=> drop database bar2;

[eric@localhost tmp]$ sudo -u postgres psql  -f bar2.c.dump
/ ERR

[eric@localhost tmp]$  PGPASSWORD=bar pg_restore -h localhost  -U bar -d bar2 bar2.c.dump -F c
pg_restore: [archiver (db)] Error while PROCESSING TOC:
pg_restore: [archiver (db)] Error from TOC entry 2855; 0 0 COMMENT EXTENSION plpgsql 
pg_restore: [archiver (db)] could not execute query: ERROR:  must be owner of extension plpgsql
    Command was: COMMENT ON EXTENSION plpgsql IS 'PL/pgSQL procedural language';

pg_restore: WARNING:  no privileges could be revoked for "public"
pg_restore: WARNING:  no privileges could be revoked for "public"
pg_restore: WARNING:  no privileges were granted for "public"
pg_restore: WARNING:  no privileges were granted for "public"
WARNING: errors ignored on restore: 1
/ TODO

[eric@localhost tmp]$ sudo -u postgres pg_restore -h localhost  -d bar2 bar2.c.dump -F c
Password: 
/ geef Enter
pg_restore: [archiver (db)] connection to database "bar2" failed: fe_sendauth: no password supplied
/ ERR
/ terwijl wel	,
[eric@localhost tmp]$ sudo -u postgres psql bar2
psql (9.3.5)
Type "help" for help.

bar2=# \q
/ Maar ZONDER -h localhost is het OK	,
[eric@localhost tmp]$ sudo -u postgres pg_restore   -d bar2 bar2.c.dump -F c
/ TODO

/ 7	.

/ 13	.

/ met c	,

[eric@localhost tmp]$ PGPASSWORD=mpopostgres@mpo pg_dump -d isbscs -U mpopostgres  -f isbscs.c.ump -F c
/ -h localhost levert precies dezelfde dump file	,
/ TODO

isbscs=# create database isbscs3;
CREATE DATABASE

[eric@localhost tmp]$ PGPASSWORD=mpopostgres@mpo pg_restore  -d isbscs2 -U mpopostgres  isbscs.c.dump -F c
/ OK
/ GEEN ERR, 
/ TODO (Wel bij bar hierboven)	,

[eric@localhost tmp]$ cp -a  isbscs.c.dump ~/Devel/Postgres/Backup/isbscs-2015-01-15.c.dump

/ 13	. 

/ met p	,

[eric@localhost tmp]$ PGPASSWORD=mpopostgres@mpo pg_dump  -d isbscs -U mpopostgres  -f isbscs.p.dump -F p

isbscs=# create database isbscs3;
CREATE DATABASE

[eric@localhost tmp]$ PGPASSWORD=mpopostgres@mpo psql   -d isbscs3 -U mpopostgres  -f isbscs.p.dump
/ OK
/ GEEN ERR	, 

[eric@localhost tmp]$ cp -a isbscs.p.dump ~/Devel/Postgres/Backup/isbscs-2015-01-15.p.dump

isbscs=# drop database isbscs2;
isbscs=# drop database isbscs3;



/ Einde POSTGRESQL DUMP 

/ ISB-767 

/ 7	.

/ we doen in isbscs2 db, de acceptatie db	,

/ in patch-440-bundle.sql	,

ALTER TABLE OMS_BUNDLE ADD CONSTRAINT BUNDLE_USER_FK FOREIGN KEY (USER_SYSTEMID) REFERENCES TMS_USER(SYSTEM_ID);

ALTER TABLE OMS_BUNDLE ADD CONSTRAINT BUNDLE_ORG_FK FOREIGN KEY (ORGANIZATION_SYSTEMID) REFERENCES ORGANIZATION(SYSTEM_ID);

CREATE TABLE OMS_BUNDLE_OBJECT
(
   BUNDLE_SYSTEMID integer NOT NULL,
   OBJECT_ID integer NOT NULL
);
ALTER TABLE OMS_BUNDLE_OBJECT ADD CONSTRAINT BUNDLE_OBJECT_USER_FK PRIMARY KEY (BUNDLE_SYSTEMID, OBJECT_ID);
ALTER TABLE OMS_BUNDLE_OBJECT ADD CONSTRAINT BUNDLE_OBJECT_BUNDLE_FK FOREIGN KEY (BUNDLE_SYSTEMID) REFERENCES OMS_BUNDLE(SYSTEM_ID);

/ 7	.

[eric@localhost forticlientsslvpn]$ sudo ./forticlientsslvpn_cli --server 80.95.170.62:443 --vpnuser vanderveldene 
Password for VPN:HA65Fs8LTTCK...
[eric@localhost ]$ ssh vanderveldene@interstream-a.intermax.mp-objects.com
h^Zgcyr&Q

/ 7	. 

/ ga naar	,
Configuration, Execution, Triggers, Event trigger
/ we hebben create	, 
Name: RELEASE TO ISABEL
Organization: ISB-CPP
Event type: BARGE_CONFIRMED 		/ deze trigger wordt triggered bij deze event (type)	, 
On close:  check
On Unexpected: uncheck

Actions: EXPORT_TOUR 

/ ga naar	
Configuration, Execution, Triggers, Actions
Code: EXPORT_TOUR
Trigger task: EXPORT_CUSTOM_MESSAGE
Purpose code: TOUR-EXPORT

/ Ga in code naar	,
ExportCustomMessage.java
/ TODO


/ we zien	,
isbscs2=# select*from event_trigger;
 system_id |       name        | on_close | filter_expression | event_type_systemid | on_unexpected | organization_systemid 
-----------+-------------------+----------+-------------------+---------------------+---------------+-----------------------
  27067381 | RELEASE TO ISABEL |        1 |                   |            26594790 |             0 |                   510
  27082779 | RELEASE TO ISABEL |        1 |                   |            26594790 |             0 |                   500
/ we zien verschillende organizations	,

isbscs2=# select*from user_organization uo join tms_user u on u.system_id=uo.user_systemid join organization o on o.system_id=uo.organization_systemid where u.user_id='eric';
 user_systemid | organization_systemid | is_active | is_active_allowed | system_id | user_id |       user_name        | user_email_address | is_enabled | is_deleted |       last_login        | login_attempt | is_first_login |  last_password_update   | chargeable | grace_login | created_by | user_password | is_interface_account | user_reference1 | user_reference2 |       created_on        | local_account | system_id | organization_id |     description     | autom_rate_calc | is_deleted | organization_group | sequence 
---------------+-------------------------+---------------+-----------+-----------------+---------------------+-----------------+------------+--------------------+----------
      27082778 |                   500 |         1 |                 1 |  27082778 | eric    | Eric J. Van der Velden |                    |          1 |          0 | 2015-01-16 12:39:00.748 |             0 |              0 | 2015-01-16 09:36:45.517 |          1 |           0 |      10100 | rtdMpo45      |                    0 |                 |  | 2015-01-16 09:36:45.517 |             1 |       500 | ISB             | Interstream Barging |               0 |          0 |                    |        0
(1 row)

/ 7	. 

/ we debug	, 
Configuration, Execution, Triggers, Event trigger

/ we zien EventTriggerListPage	,

/ TODO

/ 7	. 

/ we komen in	,

AjaxButton$1.onSubmit(AjaxRequestTarget) line: 101	
...
/s
LogisticsOrderEventPanel$1.onSubmit(AjaxRequestTarget, Form<?>) line: 97	
						saveEvents(selected);
/s
ServiceOrderEventPanel(LogisticsOrderEventPanel).saveEvents(HashSet<EventVO>) line: 148	
			saveEventVO(myEventVO);
/s
ServiceOrderEventPanel(LogisticsOrderEventPanel).saveEventVO(EventVO) line: 360	
		getEventService().save(myEventVO);
...
/s
EventServiceImpl.save(EventVO) line: 750	
			List<EventVO> myResult = save(myList);
/s
EventServiceImpl.save(Collection<EventVO>) line: 732	
...
		myTracker.processAll();
/s
	EventServiceImpl$EventUpdateResultTracker.processAll() line: 152	
		public void processAll() {
			processUpdates();
			fireEventEvents();
			handleTriggers();
/s
	EventServiceImpl$EventUpdateResultTracker.handleTriggers() line: 226	
			for (EventVO myNewEvent : getProcessedEvents()) {
				EventUpdateResult myResult = processedEvents.get(myNewEvent);
				EventProcessAction myAction = myResult.getEventProcessAction();
				eventTriggerHandler.handleClose(myNewEvent, myNewEvent.isExpectedEvent(), ObjectUtils.equals(myAction, EventProcessAction.CLOSE));

/ myNewEvent is onze event, BARGE_CONFIRMED	,
/ EventProcessAction myAction =null
/ TODO

/s
	EventTriggerHandlerImpl.handleClose(EventVO, boolean, boolean) line: 43	
/=
	public void handleClose(EventVO anEvent, boolean expected, boolean onClose) {
		LOG.info("Handling event update for event [" + anEvent + "], expected [" + expected + "] and closed [" + onClose + "]");

		Collection<EventTrigger> myList = MpoBeanFactory.getBean(EventTriggerDAO.class).getAllForEventType(anEvent.getEventType());
		for (EventTrigger myTrigger : myList) {
			if (myTrigger.getOnClose() && onClose && expected) {
				LOG.debug("Checking trigger for closing expected event: " + anEvent);
				checkAndHandleTrigger(anEvent, myTrigger);
			} else if (myTrigger.getOnUnexpected() && !expected && onClose) {
				LOG.debug("Checking trigger for closing of unexpected event: " + anEvent);
				checkAndHandleTrigger(anEvent, myTrigger);
			}

/ anEvent	EventVO  (id=21750)	
Event id: [27082708], event type: [BARGE CONFIRMED], status: [CLOSED_NORMAL]
/ table is event_event	,
anEvent.getEventType()==EventType inst, BARGE CONFIRMED

isbscs2=# select*from event_event where system_id=27082708;
 system_id | event_template_systemid | party_systemid | service_action_systemid |      created_date       | event_type_systemid | expected_value | expected_start_expr | expected_end_expr | expected_start |    expected_end     | actual_value | closed_on | closed_on_system | event_status | reporting_level | close_action_systemid | consignment_systemid | service_order_systemid | is_required | is_public | organization_systemid | reason_code_systemid | alerted | is_shipment_item_event | shipment_item_system_id | visible | customer_informed | handled | inducer_systemid | carrier_remarks | remarks | version | carrier_date | export_date | purpose_code 
----------------+---------+------------------+-----------------+---------+---------+--------------+-------------+--------------
  27082708 |                26594791 |                |                27082689 | 2015-01-15 16:25:22.274 |            26594790 |                |                     | plannedStart+4H   |                | 2015-01-17 04:00:00 |              |           |                  | OPEN_DEFAULT | SERVICE_ACTION  |              27067311 |                    |               27082703 |           1 |         1 |                   500 |                      |       0 |                      0 |                         |       1 |   
                |       0 |                  |                 |         |       0 |              |             | 
(1 row)
isbscs2=# select*from event_type where system_id= 26594790;
 system_id |      name       | is_deleted | data_type |    description     | order_nr | is_exportable | alert_sms | alert_email | phone_number | email_address | visible_on_sec
ond_event | show_on_dashboard | can_be_closed_by_types | data_constraint 
-----------+-----------------+------------+-----------+--------------------+----------+---------------+-----------+-------------+--------------+---------------+---------------
----------+-------------------+------------------------+-----------------
  26594790 | BARGE CONFIRMED |          0 | STRING    | Barge Confirmation |       60 |             1 |         0 |           0 |              |               |               
        0 |                 0 |                        | 
(1 row)


myList	ArrayList  (id=21745)	
	elementData	Object[10]  (id=22899)	
		[0]	EventTrigger  (id=21749)	
			eventType	EventType  (id=23219)	
			expressionRuleUpdate	null	
			expressionUpdate	(id=23221)	
			filterExpression	null	
			filterExpressionRule	null	
			name	"RELEASE TO ISABEL" (id=23223)	
			onClose	Boolean  (id=23088)	
			onUnexpected	Boolean  (id=23091)	
			organization	Organization  (id=23224)	
			performanceMonitorService	null	
			systemId	27082779	
			triggerList	PersistentSet  (id=23254)	


anEvent	EventVO  (id=21750)	
	actualValue	null	
	alerted	false	
	carrierDate	null	
	carrierRemarks	"" (id=23096)	
	checked	false	
	closeActionSystemid	Integer  (id=23099)	
	closedOn	Date  (id=23101)	
	closedOnSystem	Date  (id=23103)	
	consignmentSystemid	null	
	consolidatedEventsList	null	
	createdDate	Timestamp  (id=23107)	
	customerInformed	null	
	eventStatus	EventStatus$3  (id=23110)	
	eventTemplate	EventTemplate  (id=23132)	
	eventTemplateSystemid	Integer  (id=23204)	
	eventType	EventType  (id=22911)	
		canBeClosedByTypes	null	
		code	"BARGE CONFIRMED" (id=23067)	
		dataConstraint	null	
		dataType	EventValueType  (id=23069)	
		deleted	false	
		description	"Barge Confirmation" (id=23084)	
		emailAddress	null	
		exportable	Boolean  (id=23088)	
		messages	PersistentSet  (id=23089)	
		order	Integer  (id=23090)	
		performanceMonitorService	null	
		phoneNumber	null	
		showOnDashboard	Boolean  (id=23091)	
		systemId	26594790	
		visibleOnSecondEvent	Boolean  (id=23091)	
	eventTypeSystemid	null	
	expectedEnd	Timestamp  (id=23208)	
	expectedEndExpr	"plannedStart+4H" (id=23210)	
	expectedStart	null	
	expectedStartExpr	null	
	expectedValue	null	
	exportDate	null	
	handled	true	
	inducerCode	null	
	organization	Organization  (id=24183)	
	organizationSystemid	Integer  (id=24184)	
	organizationVO	null	
	partyVO	null	
	performanceMonitorService	null	
	publicEvent	true	
	purposeCode	null	
	reasonCode	null	
	reasonCodeSystemid	null	
	remarks	"" (id=24186)	
	reportingLevel	EventReportingLevel$1  (id=24187)	
	required	true	
	serviceAction	ServiceActionVO_$$_javassist_7  (id=24199)	
	serviceOrder	ServiceOrderVO_$$_javassist_126  (id=24469)	
	shipmentItemEvent	false	
	shipmentItemVO	null	
	systemId	27082708	
	values	PersistentSet  (id=24644)	
	version	0	
	visible	true	
expected	true	
onClose	false	


/ 7	. 

/ FIX ISB-767

/ In de config zien we 	,
Execution, Events, Event template	,
/ Kies OCF-ISB	BARGE CONFIRMED	, want in ons event zien we dat dit het template is	,
isbscs2=# select code from event_event e join event_template t on e.event_template_systemid=t.system_id where e.system_id=27082708;
  code   
---------
 OCF-ISB
(1 row)
/ we zien	,
Close action: RELEASE ORDER
/ Deze calls 	,
Execution , Triggers, Service order type trigger
TOUR_EXPORT
On Release : check
Actions: EXPORT_TOUR Export to Isabel

/ Maar ook in 	, zien we dezelfde actie	,
Execution , Triggers, Event trigger
Name: RELEASE TO ISABEL
Organization: ISB
Service Order type: TOUR			/ dit is inderdaad de type van de seo die we altijd kiezen	,
Actions: EXPORT_TOUR Export to Isabel

/ Als we dit local	, als all-admin	,

   2215 2015-01-16 15:25:23,372 ERROR [com.mpobjects.oms.model.trigger.task.ExportCustomMessage] (JMS Session        Pool Worker-1:) An error occured while sending the message, for: N0000957
   2216 javax.jms.JMSException: Could not connect to broker URL: tcp://localhost:61616. Reason: java.net.Conn        ectException: Connection refused
...
   2285 2015-01-16 15:25:23,374 ERROR [com.mpobjects.oms.model.trigger.task.ExportCustomMessage] (JMS Session        Pool Worker-0:) An error occured while sending the message, for: N0000957

 








 

/ Einde ISB-767 

/ PRODUCTION ISSUE DSVSOL

/ Lees	,
https://system.mp-objects.com/xwiki/bin/view/Technology/Intermax

/ Ga naar acceptatie	,
Virtual Machines: Acceptance
application-a.intermax.mp-objects.com
/ ga daar naar de carcon inst in jboss	, en lees de firebird config file	,
/ doe updates	,

/ Lees	, 
visjs.org
d3js.org

/ 7	. 

/ in ~	,
$ mkdir bin
[eric@localhost bin]$ ls
application-acceptance.bash  mposerv11.bash
forticlientsslvpn.bash       scs-application-production.bash
interstream-acceptance.bash
/ Ze moeten anders	,

/ 7	.

/ we oef eerst op test omg	,
$ mposerv11.bash 
...
eric@mposerv11:~$ cd /local/apps/jboss-4.0.5.GA/server/carcon
$ vi deploy/firebird-ds.xml 
      <connection-url>jdbc:firebirdsql://192.168.1.8//local/apps/firebird/carconserver.fdb?no_result_set_tracking&amp;defaultResultSetHoldable=true</connection-url>
     <driver-class>org.firebirdsql.jdbc.FBDriver</driver-class>
     <user-name>SYSDBA</user-name>
     <password>masterkey</password>

/ use deze in squirrel	,

/ we install squirrel opnieuw	,
[eric@localhost squirrel-sql-3.5.3]$ pwd
/home/eric/Devel/Java/squirrel-sql-3.5.3
[eric@localhost squirrel-sql-3.5.3]$ ./squirrel-sql.sh 

/ click Aliases, click +
Name: mposerv11/carcon
Driver: Firebird jayBird	/ is er al in squirrel	,
URL:jdbc:firebirdsql://192.168.1.8//local/apps/firebird/carconserver.fdb?no_result_set_tracking&amp;defaultResultSetHoldable=true
Username:SYSDBA
Password:masterkey
Auto logon: check

/ 7	. 

/ command line client	,

$ isql-fb
SQL> connect 'mposerv8:/local/apps/firebird/carconserver.fdb'  user 'SYSDBA' password 'masterkey';
SQL> show database;
SQL> show tables;

/ of makkelijker	,
[eric@localhost forticlientsslvpn]$ isql-fb -u sysdba -p masterkey "mposerv8:/local/apps/firebird/carconserver.fdb"
SQL> show database;
SQL> show tables;

/ we maken een script in ~/bin
carcon-mposerv8.bash


/ Lees	,
http://www.firebirdsql.org/en/documentation/
/ clidk Reference manuals	,
http://www.firebirdsql.org/en/reference-manuals/
/ click Firebird's isql Interactive SQL tool	,
http://www.firebirdsql.org/file/documentation/reference_manuals/user_manuals/html/isql.html


/ describe table in firebird	,
SQL> show table cc_event;
SYSTEMID                        INTEGER Nullable 
LEVELEVENT                      VARCHAR(20) Nullable 
TRACKINGNUMBER                  VARCHAR(50) Nullable 
EVENTID                         INTEGER Nullable 
EVENTDATE                       TIMESTAMP Nullable 
STATUSCODE                      VARCHAR(10) Nullable 
CARRIER_SYSTEMID                INTEGER Nullable 
ORGANIZATION_SYSTEMID           INTEGER Nullable 
EVENTREGISTEREDDATE             TIMESTAMP Nullable 
EVENTXML                        BLOB segment 80, subtype TEXT Nullable 
ISEVENTSENTTOCLIENT             SMALLINT Nullable 
COLLO_SYSTEMID                  INTEGER Nullable 
SHIPMENTORDER_SYSTEMID          INTEGER Nullable 
INDUCER                         VARCHAR(25) Nullable DEFAULT ''
ORIGINALSTATUSCODE              VARCHAR(10) Nullable 
EVENTVALUE                      VARCHAR(80) Nullable 
CONSTRAINT CC_EVENT_CC_CARRIER_FK:
  Foreign key (CARRIER_SYSTEMID)    References CC_CARRIER (SYSTEMID)
CONSTRAINT CC_EVENT_CC_COLLO_FK:
  Foreign key (COLLO_SYSTEMID)    References CC_COLLO (SYSTEMID)
CONSTRAINT CC_EVENT_CC_ORGANIZATION_FK:
  Foreign key (ORGANIZATION_SYSTEMID)    References CC_ORGANIZATION (SYSTEMID)
CONSTRAINT CC_EVENT_CC_SHIPMENTORDER_FK:
  Foreign key (SHIPMENTORDER_SYSTEMID)    References CC_SHIPMENTORDER (SYSTEMID)
CONSTRAINT CC_EVENT_PK:
  Primary key (SYSTEMID)
CONSTRAINT CC_EVENT_TRCKN_EVTID_UK:
  Unique key (SHIPMENTORDER_SYSTEMID, COLLO_SYSTEMID, EVENTID)

SQL> show table organization;
SYSTEM_ID                       INTEGER Nullable 
ORGANIZATION_ID                 VARCHAR(20) Nullable 
DESCRIPTION                     VARCHAR(100) Nullable 
ORGANIZATION_GROUP              INTEGER Nullable 
AUTOM_RATE_CALC                 SMALLINT Nullable DEFAULT 0
IS_DELETED                      SMALLINT Nullable DEFAULT 0
CONSTRAINT ORGANIZATION_PK:
  Primary key (SYSTEM_ID)
CONSTRAINT ORGANIZATION_UK:
  Unique key (ORGANIZATION_ID)

SQL> show table cc_carrier
CON> ;
SYSTEMID                        INTEGER Nullable 
CODE                            VARCHAR(100) Nullable 
NAME                            VARCHAR(255) Nullable 
ROUTINGCODETABLEVERSION         VARCHAR(30) Nullable 
LABELTRANSFORMATIONFILE         VARCHAR(100) Nullable 
REPORTFILE                      VARCHAR(255) Nullable 
CONSTRAINT CC_CARRIER_PK:
  Primary key (SYSTEMID)
CONSTRAINT CC_CARRIER_CODE_UK:
  Unique key (CODE)

/ we oef	,

select first 5 e.systemid,e.organization_systemid,o.systemid,o.name,c.name,cast(e.eventdate as date)
/ of	,
select first 5 e.systemid,e.organization_systemid,o.systemid,o.name,c.name,e.eventdate
/ of	,
select e.systemid,e.organization_systemid,o.systemid,o.name,c.name,e.eventdate
from cc_event e 
join cc_organization o on e.organization_systemid=o.systemid
join cc_carrier c on e.carrier_systemid=c.systemid
where (c.name like '%DHL' or c.name like '%UPS%')
/ of	,
where c.name similar to '%(DHL|UPS)%' 
and e.statuscode='POD'
and cast(e.eventdate as date)=date '2012-03-22';
/ of	,
and e.eventdate<'2015-01-16'
and '2014-01-16'<e.eventdate

/ uiteindelijk	(Firebird)	,

select e.systemid,e.organization_systemid,o.systemid,o.name,c.name,e.eventdate,e.iseventsenttoclient
from cc_event e 
join cc_organization o on e.organization_systemid=o.systemid
join cc_carrier c on e.carrier_systemid=c.systemid
where o.name='DSV-NL-MDK'
and c.name similar to '%(DHL|UPS)%' 
and e.statuscode='POD'
and cast(e.eventdate as date)=date '2011-05-25'
and e.iseventsenttoclient=1


/ Lees	,
http://www.firebirdsql.org/refdocs/langrefupd25.html
/ Kies Operators and Predicates
SIMILAR

/ we kunnen ook	,
where c.name similar to '%DHL|UPS%' 
/ of	,
where c.name similar to '%(DHL|UPS)%' 

/ lees	,
http://www.firebirdsql.org/file/documentation/reference_manuals/reference_material/html/langrefupd25-shorthandcast.html

/ Intermezzo

/ timestamps op 2012-03-22	,

select e.eventdate
from cc_event e 
where '2012-03-22'<e.eventdate
and e.eventdate<'2012-03-23'

/ of	,

select e.eventdate
from cc_event e 
where '2012-03-22'=cast(e.eventdate as date)

/ of	,

select e.eventdate
from cc_event e 
where date '2012-03-22'=cast(e.eventdate as date)

/ Einde Intermezzo

/ 7	. 

$ scs-application-production.bash 
h^Zgcyr&Q
[vanderveldene@scs-application-p ~]$ cd /local/apps/jboss-4.0.5.GA/server/carcon/
[vanderveldene@scs-application-p carcon]$ vi deploy/firebird-ds.xml 
    <connection-url>jdbc:firebirdsql://localhost//local/apps/firebird/carconserver.fdb</connection-url>
     <driver-class>org.firebirdsql.jdbc.FBDriver</driver-class>
     <user-name>SYSDBA</user-name>
     <password>masterkey</password>
 
/ we maken hiermee	,
$ vi ~/bin/carcon-p.bash 

#!/bin/bash
isql-fb -u sysdba -p masterkey "scs-application-p.intermax.mp-objects.com:/local/apps/firebird/carconserver.fdb"

SQL> select count(*)
CON> from cc_event e
CON> join cc_organization o on e.organization_systemid=o.systemid
CON> join cc_carrier c on e.carrier_systemid=c.systemid
CON> where o.name='DSV-NL-MDK'
CON> and c.name similar to '%(DHL|UPS)%'
CON> and e.statuscode='POD'
CON> and cast(e.eventdate as date)=date '2015-01-15'
CON> and e.iseventsenttoclient=1;

       COUNT 
============ 
        1305 


/ we moeten uiteindelijk	,

update cc_event 
set iseventsenttoclient=0
where systemid in (
	select e.systemid
	from cc_event e 
	join cc_organization o on e.organization_systemid=o.systemid
	join cc_carrier c on e.carrier_systemid=c.systemid
	where o.name='DSV-NL-MDK'
	and c.name similar to '%(DHL|UPS)%' 
	and e.statuscode='POD'
	and cast(e.eventdate as date)=date '2011-05-25'
	and e.iseventsenttoclient=1
)


/ we kunnen 	,
select e.systemid 
from cc_event e 
join cc_organization o on e.organization_systemid=o.systemid
join cc_carrier c on e.carrier_systemid=c.systemid
where o.name='DSV-NL-MDK'
and c.name similar to '%(DHL|UPS)%' 
and e.statuscode='POD'
and cast(e.eventdate as date)=date '2015-01-15'
and e.iseventsenttoclient=1

select count(*) 
from cc_event e 
join cc_organization o on e.organization_systemid=o.systemid
join cc_carrier c on e.carrier_systemid=c.systemid
where o.name='DSV-NL-MDK'
and c.name similar to '%(DHL|UPS)%' 
and e.statuscode='POD'
and cast(e.eventdate as date)=date '2015-01-15'
and e.iseventsenttoclient=1

select first 5  *
from cc_event e 
join cc_organization o on e.organization_systemid=o.systemid
join cc_carrier c on e.carrier_systemid=c.systemid
where o.name='DSV-NL-MDK'
and c.name similar to '%(DHL|UPS)%' 
and e.statuscode='POD'
and cast(e.eventdate as date)=date '2015-01-15'
and e.iseventsenttoclient=1

select count(*)
from cc_event e
where e.trackingnumber='1ZE8W5326889568371'

select count(*) 
from cc_event e 
join cc_organization o on e.organization_systemid=o.systemid
join cc_carrier c on e.carrier_systemid=c.systemid
where o.name='DSV-NL-MDK'
and c.name similar to '%(DHL|UPS)%' 
and e.statuscode='POD'
and cast(e.eventdate as date)=date '2015-01-15'
and e.iseventsenttoclient=1
and e.trackingnumber in (
'1ZE8W5326889568371',
...
'JVGL05932512389004'
);

/ we set deze in /home/eric/Devel/Firebird/mpo's dsv_2015_01_15.sql

/ we oef eerst met andere script	,
[eric@localhost mpo]$ isql-fb -u sysdba -p masterkey "mposerv8:/local/apps/firebird/carconserver.fdb" -i dsv_2015_01_15-TEST-2.sql

       COUNT 
============ 
           4 

/ we gaan dit doen met carcon-mposerv8.bash script	,
[eric@localhost bin]$ vi carcon-mposerv8.bash
#!/bin/bash
isql-fb -u sysdba -p masterkey "mposerv8:/local/apps/firebird/carconserver.fdb" "$@"

[eric@localhost mpo]$  carcon-mposerv8.bash -i dsv_2015_01_15-TEST-2.sql

       COUNT 
============ 
           4 

///////////////////////////////////////////////
/ we doen uiteindelijk	,
/ 7	. 

[eric@localhost mpo]$ pwd
/home/eric/Devel/Firebird/mpo

[eric@localhost mpo]$ ls
dsv_2015_01_15-query.sql  dsv_2015_01_15-results.txt  dsv_2015_01_15-update.sql

$ forticlientsslvpn.bash 
[eric@localhost mpo]$ carcon-p.bash -i dsv_2015_01_15-update.sql 

$ vi  dsv_2015_01_15-update.sql
update cc_event
set iseventsenttoclient=0
where systemid in(

select e.systemid
from cc_event e
join cc_organization o on e.organization_systemid=o.systemid
join cc_carrier c on e.carrier_systemid=c.systemid
where o.name='DSV-NL-MDK'
and c.name similar to '%(DHL|UPS)%'
and e.statuscode='POD'
and cast(e.eventdate as date)=date '2015-01-15'
and e.iseventsenttoclient=1
and e.trackingnumber in (
'1ZE8W5326889568371',
...
'JVGL05932512389004'
)
);

/ 7	. 

/ we krijgen een extra excel	,
$ vi dsv_2015_01_15-query-2.sql
select count(e.trackingnumber)
from cc_event e
join cc_organization o on e.organization_systemid=o.systemid
join cc_carrier c on e.carrier_systemid=c.systemid
where o.name='DSV-NL-MDK'
and c.name similar to '%(DHL|UPS)%'
and e.statuscode='POD'
and (cast(e.eventdate as date) = date '2015-01-15'
or cast(e.eventdate as date) = date '2015-01-16')
and e.iseventsenttoclient=1
and e.trackingnumber in (
'1Z6F096V6889555271',
'1ZE8W6006889532243',
...
'1Z25247F6889601262'
);
/ er zit er ook een bij van 16 jan	, 
> 1Z2267240470882487 

/ we doen de update	,
[eric@localhost mpo]$ vi dsv_2015_01_15-update-2.sql

update cc_event
set iseventsenttoclient=0
where systemid in(

select e.systemid
from cc_event e
join cc_organization o on e.organization_systemid=o.systemid
join cc_carrier c on e.carrier_systemid=c.systemid
where o.name='DSV-NL-MDK'
and c.name similar to '%(DHL|UPS)%'
and e.statuscode='POD'
and (cast(e.eventdate as date) = date '2015-01-15'
or cast(e.eventdate as date) = date '2015-01-16')
and e.iseventsenttoclient=1
and e.trackingnumber in (
'1Z6F096V6889555271',
'1ZE8W6006889532243',
...
'1Z25247F6889601262'
)
);

[eric@localhost mpo]$ carcon-p.bash -i dsv_2015_01_15-update-2.sql





/ Einde PRODUCTION ISSUE DSVSOL

/ DSVSOL-2606

/ 7	.. 

[eric@localhost mpo]$ pwd
/home/eric/Devel/Firebird/mpo

/ Let op de ;	,
$ vi test2.sql
select count(*) 
from cc_event e;

[eric@localhost mpo]$ carcon-p.bash <test2.sql 

       COUNT 
============ 
     4432781 

select e.trackingnumber
from cc_event e
join cc_organization o on e.organization_systemid=o.systemid
join cc_carrier c on e.carrier_systemid=c.systemid
where o.name='DSV-NL-MDK'
and c.name similar to '%(UPS)%'
and e.statuscode='POD'
and cast(e.eventdate as date) = date '2015-04-23'
and e.iseventsenttoclient=1
and e.trackingnumber in (

/ Lees	,
-rw-r-----. 1 eric eric     47104 Apr 24 14:07 Expected-event-list-by-event-type-POD-201504241020.xls

/	7	.

/ 13	. 

/ we set de list van tracking numbers, (box tracking numbers) in test4.txt	, 
/ tel de verschillenden	,

[eric@localhost mpo]$ cat test4.txt | wc -l
105
[eric@localhost mpo]$ cat test4.txt | sort -u | wc -l
/ of	,
[eric@localhost mpo]$ cat test4.txt | sort | uniq | wc -l
56

[eric@localhost mpo]$ cat test4.txt |  uniq | wc -l
58
/ uniq werkt blijkbaar niet OK op unsorted lists	,

/ 13	. 

/ test4.req heeft de 105 tracking numbers uit de spreadsheet	,

[eric@localhost mpo]$ sort -u test4.req >test4.us
/ us : unique, sorted	,
/ 56 tracking numbers	,

/ test4.usq is met quotes	,

calhost mpo]$ cat test7.usqsql 

select count(e.trackingnumber)
from cc_event e
join cc_organization o on e.organization_systemid=o.systemid
join cc_carrier c on e.carrier_systemid=c.systemid
where o.name='DSV-NL-MDK'
and c.name similar to '%(UPS)%'
and e.statuscode='POD'
and cast(e.eventdate as date) = date '2015-04-23'
and e.iseventsenttoclient=1 
and e.trackingnumber in (
'1ZE8W5326801221284',
'1ZE8W5326801226430',
'1ZE8W5326801226430',
...
/ de 56 

[eric@localhost mpo]$ carcon-p.bash <test7.usqsql 

       COUNT 
============ 
          55 

/ 13	.

/ we vergl deze 55 tracking nummers met test4.us	,

$ vi test7.usqsql

select e.trackingnumber
from cc_event e
join cc_organization o on e.organization_systemid=o.systemid
join cc_carrier c on e.carrier_systemid=c.systemid
where o.name='DSV-NL-MDK'
and c.name similar to '%(UPS)%'
and e.statuscode='POD'
and cast(e.eventdate as date) = date '2015-04-23'
and e.iseventsenttoclient=1
and e.trackingnumber in (
'1Z25247F6801240530',
'1Z25247F6801240692',
/ de 56 trackingnumbers	,

[eric@localhost mpo]$ carcon-p.bash <test7.usqsql >test7.res

/ edit test7.res iets, 55 lines, OK	,

[eric@localhost mpo]$ comm test4.us <(sort test7.res )
...
1Z6F096V6801252039
	1Z6F096V6801252039                                 
1ZA536956801225278
1ZE8W5326801221284
	1ZE8W5326801221284     
...

/ Dus 

[eric@localhost mpo]$ vi test7.updatesql 

update cc_event
set iseventsenttoclient=0
where systemid in(

select e.systemid
from cc_event e
join cc_organization o on e.organization_systemid=o.systemid
join cc_carrier c on e.carrier_systemid=c.systemid
where o.name='DSV-NL-MDK'
and c.name similar to '%(UPS)%'
and e.statuscode='POD'
and cast(e.eventdate as date) = date '2015-04-23'
and e.iseventsenttoclient=1
and e.trackingnumber in (
'1Z25247F6801240530',
...
)
);


[eric@localhost mpo]$ carcon-p.bash <test7.updatesql 



/ Einde DSVSOL-2606

/ DSVSOL-2657

/ in xls we select column E, en copy, paste in file	,
pod-2657.txt
/ we quote, en komma erachter	,
[eric@localhost mpo]$ cat pod-2657.txt 
'1Z25247F6802284705',
'1Z25247F6802284705',
...

[eric@localhost mpo]$ sort -u pod-2657.txt > pod-2657.usq

/ we maken	,
[eric@localhost mpo]$ cat pod-2657.usqsql 
select e.trackingnumber
from cc_event e
join cc_organization o on e.organization_systemid=o.systemid
join cc_carrier c on e.carrier_systemid=c.systemid
where o.name='DSV-NL-MDK'
and c.name similar to '%(UPS)%'
and e.statuscode='POD'
and cast(e.eventdate as date) = date '2015-07-07'
and e.iseventsenttoclient=1 
and e.trackingnumber in (
'1Z25247F6802284705',
'1Z25247F6802293900',
'1Z25247F6802294418',
'1Z25247F6802298496',
'1Z6F096V6802282479',
'1Z6F096V6802282602',
'1Z6F096V6802290399',
'1Z6F096V6802300565',
'1Z6F096V6802301055',
'1Z6F096V6802302572',
'1Z6F097V6802288105',
'1Z6F097V6802294983',
'1ZE8W5326802267528',
'1ZE8W5326802268214',
'1ZE8W5326802271344',
'1ZE8W5326802283199',
'1ZE8W5326802288176'
);

/ we maken ook de count query	,
[eric@localhost mpo]$  cat pod-2657-count.usqsql 
select count(e.trackingnumber)
from cc_event e
join cc_organization o on e.organization_systemid=o.systemid
join cc_carrier c on e.carrier_systemid=c.systemid
where o.name='DSV-NL-MDK'
and c.name similar to '%(UPS)%'
and e.statuscode='POD'
and cast(e.eventdate as date) = date '2015-07-07'
and e.iseventsenttoclient=1 
and e.trackingnumber in (
'1Z25247F6802284705',
'1Z25247F6802293900',
'1Z25247F6802294418',
...

/ we zien dat van 2015-07-07 er 16 van de 17 nog in de carcon db zijn	, 

/ we veranderen in de query	,
and cast(e.eventdate as date) = date '2015-07-08'
/ en van 2015-07-08 een	, 
1Z6F096V6802290399 

/ Intermezzo

/ cc_event.eventdate is een timestamp	, we MOETEN cast(e.eventdate as date)	,
/ we hoeven NIET date '2015-07-07'	, '2015-07-07' is ook OK	,

QL> select count(*) from cc_event e where e.statuscode='POD' and cast(e.eventdate as date) between '2015-07-07'and '2015-07-08' and e.iseventsenttoclient=1 and e.trackingnumber in ('1Z25247F6802284705','1Z25247F6802293900','1Z6F096V6802290399');

       COUNT 
============ 
           3 

SQL> select count(*) from cc_event e where e.statuscode='POD' and cast(e.eventdate as date) = '2015-07-07' and e.iseventsenttoclient=1 and e.trackingnumber in ('1Z25247F6802284705','1Z25247F6802293900','1Z6F096V6802290399');

       COUNT 
============ 
           2 


/ Einde Intermezzo

/ we maken de update query

[eric@localhost mpo]$ cat pod-2657.updatesql 
update cc_event
set iseventsenttoclient=0
where systemid in(

select e.systemid
from cc_event e
join cc_organization o on e.organization_systemid=o.systemid
join cc_carrier c on e.carrier_systemid=c.systemid
where o.name='DSV-NL-MDK'
and c.name similar to '%(UPS)%'
and e.statuscode='POD'
and cast(e.eventdate as date) = date '2015-07-07'
and e.iseventsenttoclient=1 
and e.trackingnumber in (
'1Z25247F6802284705',
'1Z25247F6802293900',
'1Z25247F6802294418',
'1Z25247F6802298496',
'1Z6F096V6802282479',
'1Z6F096V6802282602',
'1Z6F096V6802290399',
'1Z6F096V6802300565',
'1Z6F096V6802301055',
'1Z6F096V6802302572',
'1Z6F097V6802288105',
'1Z6F097V6802294983',
'1ZE8W5326802267528',
'1ZE8W5326802268214',
'1ZE8W5326802271344',
'1ZE8W5326802283199',
'1ZE8W5326802288176'
)
);

/ we doen	,
[eric@localhost mpo]$ carcon-p.bash <test7.updatesql 
/ met date '2015-07-07' en '2015-07-08'	,


/ we hebben toch die van 8 juli hierboevn update	, maar achteraf	,
/ we willen weten of de  event van 8 juli gesloten is of niet	,
1Z6F096V6802290399 

/ dsvsol=dsvfms	, 
/ we moeten naar de db van dsvfms	,

$ cat ~/bin/dsvfms-db-p.bash
#/bin/bash
isql-fb -u sysdba -p masterkey "scs-application-p.intermax.mp-objects.com:/local/apps/firebird/dsvfms.fdb" "$@"

/ Het veld in de shipment_item table is reference2	,

SQL> select*from shipment_item where reference2='1Z6F096V6802290399';
   SYSTEM_ID SHIPMENT_ORDER_SYSTEMID SHIPPING_UNIT_SYSTEMID SHIPMENT_ITEM_ID                                                                 DESCRIPTION                                                                    
...
   111890016               111890007    

SQL>  select shipment_order_id from shipment_order where system_id='111890007';
SH002370038
/ Kijk op scherm	,

/ kijken we naar de juiste event?

SQL>  select*from event_event where SHIPMENT_ITEM_SYSTEM_ID=111890016;
/ 3 , waar van 1 de POD	,

SQL>  select EVENT_TYPE_SYSTEMID from event_event where SHIPMENT_ITEM_SYSTEM_ID=111890016; 

EVENT_TYPE_SYSTEMID 
=================== 
                  3 
           25032280 
                  1 
/ 1 is de POD	,

SQL>  select * from event_event where SHIPMENT_ITEM_SYSTEM_ID=111890016 and event_type_systemid=1;
...

SQL>  select closed_on from event_event where SHIPMENT_ITEM_SYSTEM_ID=111890016 and event_type_systemid=1;

                CLOSED_ON 
========================= 
2015-07-08 12:37:07.0000  

/ op https://scs.mp-objects.com/dsvfms/core/index_frameset	,
/ we zien op het scherm	 in de column remarks 'tr  1Z6F096V6802290380  delivered shipment item: SH002370038-2'	,







/ Einde DSVSOL-2657


/ PNL-313 PNL-314

https://test.scs.mp-objects.com/pnloms/core/index_frameset

ScheduleEntryPanel.html
language_en.properties
EntityActionGroupPanel.html
EntityActionGroupEditPage.html
ScheduleEntryPanel.html

/ Ga naar
Planning, shipment order, mass update dashboard
/ kies een actie, user_test12
/ De labels moeten uit language file komen	,

/ In EntityActionGroupEditPage.html
						<wicket:message key="description">Description</wicket:message>
/ ipv
						Description


/ Ga naar	,
Planning, shipment order, mass update
/ select alle 15	, en click update	,
/ Hier maken we zelf een actie die we hierboven zagen	,

Hold status: begin met type in text filed, CREDIT_HOLD	, hij geeft na c CREDIT_HOLD	, moet beter	,
/ Hoe vertalen, komt uit wicket	,
Save
/ Authorization, click start	, we zien 3 Auth komen	, alle 3 moeten ze approve	, 
/ click op een van de 3 codes, we kunnen Approve/Reject

/ Hetzelfde op 
configuration, master data, schedules
/ kies er een, ook hier moeten we de labels als boven	,

/ Kijk op mposerv11 voor de language_nl file in de config/ van pnl	,

/ Kies op 
Planning, shipment order, mass update
/ alle 15 , update,
/ click Actions	, Kies nu load window	, er verschijnt dynamisch text fields met dates	, ...
/ Hoe deze te vertalen	?

/ een entity action group is een group van actions	, dat zie je als je een group edit, dan zie je een of meerdere actions (die je kunt authorize)	,

/ 7	.

https://test.scs.mp-objects/pnloms/authentication/login-form
https://test.scs.mp-objects.com/pnloms/authentication/login-form

/ pnl (test internal)	,
https://test.scs.mp-objects.com/pnloms/core/index_frameset

$ vi ~/bin/pnloms-mposerv11.bash
#!/bin/bash
echo mpo@2014
ssh eric@mposerv11
/ we kunnen naar /local/app/jboss-4.0.5.../...	, en postgres-ds.xml lezen	,
/ maar niet nodig, op mposerv8's pnloms db kunnen we inloggen met eric:mpo@2014	,

eric@mposerv8:~$ psql pnloms
psql (9.1.13)
Type "help" for help.

pnloms=> 
/ TODO

/ we lezen tms_user, 
/ we zien user eric:eric	, we moeten password veranderen	,

/ password voor pnloms op test (internal)	,
rtdMpo45

/ local	,
[eric@localhost repository]$ PGPASSWORD=mpopostgres@mpo psql -U mpopostgres isbscs
/ of	,
[eric@localhost repository]$ PGPASSWORD=mpopostgres@mpo psql -U mpopostgres pnloms

/ Of login als 
MLopez
admin123@MPO


/ Einde PNL-313 PNL-314

/ DEBUG PNL-313 PNL-314

/ 7	. 

/ Hoe op 
Planning, shipment order, mass update
/ we zien EntityActionGroupListPage	,

/ we vallen in	,
EntityActionGroupListPage.<init>() line: 39	
/s
EntityActionGroupListPage.createListPanels() line: 57	

		ParameterImpl parameter = new ParameterImpl("requestedBy.systemId", AuthenticationUtils.getResource().getSystemId());
		parameter.setCriterium(MatchOperation.EQ);

		parameter = new ParameterImpl("status", EntityActionStatus.CLOSED);
		parameter.setCriterium(MatchOperation.NE);

		add(new EntityActionGroupSearchListPanel("myList", webComponentEventSwitchBoard, daoWrapper, parameters, getPanelAction()));
...
		parameter = new ParameterImpl("status", EntityActionStatus.CLOSED);
		parameter.setCriterium(MatchOperation.NE);
		add(new EntityActionGroupSearchListPanel("approvalList", webComponentEventSwitchBoard, daoWrapper, parameters, getPanelAction()));

/ eerst de 1ste	, 
/ daoWrapper is rond EntityActionGroupDAO	,
/ we lezen EntityActionGroup.standard.hbm.xml
/ tbl mau_action_group	,

pnloms=# select*from mau_action_group;
 system_id | description | status  | requested_by_systemid | bundle_systemid |       started_dtm       | executed_dtm |     last_update_dtm     
-----------+-------------+---------+-----------------------+-----------------+-------------------------+--------------+-------------------------
  26680604 | Test001     | INITIAL |              26673330 |        26680603 |                         |              | 
  26680608 | Test002     | INITIAL |              26673330 |        26680607 |                         |              | 
  26680611 | Test002a    | INITIAL |              26673330 |        26680610 |                         |              | 
  26680615 | Test3       | INITIAL |              26673330 |        26680614 |                         |              | 
  26680995 | all         | STARTED |                 10100 |        26680994 | 2014-10-22 16:58:38.293 |              | 2014-10-22 16:58:38.293
  26680999 | test        | STARTED |                 10100 |        26680998 | 2014-10-22 17:27:50.756 |              | 2014-10-22 17:27:50.756
(6 rows)

/ er is ook tbl mau_action	,

pnloms=> select*from mau_action;
 system_id | action_group_systemid | action_type_systemid |                                                                                  configuration                    
                                                               
-----------+-----------------------+----------------------+-------------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------
  26680675 |              26680674 |             26680606 | 
  26681300 |              26681299 |             26681168 | MASTERLOCK CODE
  26682701 |              26682700 |             26681510 | CREDIT_HOLD
...


/ 
/s
EntityActionGroupSearchListPanel.<init>(String, WebComponentEventSwitchBoard, BeanWrapper<BaseDAOInterface<EntityActionGroup>>, List<Parameter>, EntityListActionBuilder<EntityActionGroup>) line: 48	
		super(anId, null, aWebComponentEventSwitchBoard, aDaoWrapper, 0, new Builder(aParameterList), null);
/s
EntityActionGroupSearchListPanel(GenericListPanel).<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, BeanWrapper<BaseDAOInterface<T>>, int, TableDataProviderBuilder<T>, List<EntityGroupAction<T>>) line: 136	
		initialize();
/s
EntityActionGroupSearchListPanel(GenericListPanel).initialize() line: 244	

/ 7	.

/ als we click op filter button	, 

select * 
from MAU_ACTION_GROUP this_ 
inner join         TMS_USER resource1_ on this_.REQUESTED_BY_SYSTEMID=resource1_.SYSTEM_ID 
left outer join TMS_USER resource4_ on resource1_.CREATED_BY=resource4_.SYSTEM_ID 
where resource1_.SYSTEM_ID=? 
and this_.STATUS<>? 
limit ?
 657631 2015-01-23 16:33:36,580 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-4:) binding parameter [1] as         [INTEGER] - 10100
 657632 2015-01-23 16:33:36,580 DEBUG [org.hibernate.type.EnumType] (http-0.0.0.0-8080-4:) Binding 'CLOSED' to parameter: 2
/ 10100 is all-admin	,

select count(*) as y0_ 
from MAU_ACTION_GROUP this_ 
where this_.STATUS<>?
 657675 2015-01-23 16:33:36,599 DEBUG [org.hibernate.type.EnumType] (http-0.0.0.0-8080-4:) Binding 'CLOSED' to parameter: 1

select this_.SYSTEM_ID as SYSTEM1_261_0_, this_.DESC        RIPTION as DESCRIPT2_261_0_, this_.STATUS as STATUS261_0_, this_.REQUESTED_BY_SYSTEMID as REQUESTED4_261_0_, this_.BUNDLE_SYS        TEMID as BUNDLE5_261_0_, this_.STARTED_DTM as STARTED6_261_0_, this_.EXECUTED_DTM as EXECUTED7_261_0_, this_.LAST_UPDATE_DTM         as LAST8_261_0_ 
from MAU_ACTION_GROUP this_ 
where this_.STATUS<>? 
limit ?
 657680 2015-01-23 16:33:36,608 DEBUG [org.hibernate.type.EnumType] (http-0.0.0.0-8080-4:) Binding 'CLOSED' to parameter: 1

/ 7	. 

/ Ga naar 	,
planning, shipment order, mass update
/ maak een action group met 1 action	, 
/ click Save	,
/ we zien in de hib log	,
insert into MAU_ACTION_GROUP (DESCRIPTION, STATUS, R        EQUESTED_BY_SYSTEMID, BUNDLE_SYSTEMID, STARTED_DTM, EXECUTED_DTM, LAST_UPDATE_DTM, SYSTEM_ID) values (?, ?, ?, ?, ?, ?, ?, ?)
 860686 2015-01-23 16:48:14,039 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [1] as         [VARCHAR] - foo bar
 860688 2015-01-23 16:48:14,039 DEBUG [org.hibernate.type.EnumType] (http-0.0.0.0-8080-3:) Binding 'INITIAL' to parameter: 2
 860690 2015-01-23 16:48:14,039 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [3] as         [INTEGER] - 26681004
 860692 2015-01-23 16:48:14,039 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [4] as         [INTEGER] - 26681016
 860694 2015-01-23 16:48:14,039 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [5] as         [TIMESTAMP] - <null>
 860696 2015-01-23 16:48:14,039 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [6] as         [TIMESTAMP] - <null>
 860698 2015-01-23 16:48:14,039 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [7] as         [TIMESTAMP] - Fri Jan 23 16:48:14 CET 2015
 860700 2015-01-23 16:48:14,039 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [8] as         [INTEGER] - 26681017

pnloms=# select*from mau_action_group where description like 'foo bar';
 system_id | description | status  | requested_by_systemid | bundle_systemid | started_dtm | executed_dtm |     last_update_dtm     
-----------+-------------+---------+-----------------------+-----------------+-------------+--------------+-------------------------
  26681017 | foo bar     | INITIAL |              26681004 |        26681016 |             |              | 2015-01-23 16:48:14.017

/ we kunnen nu Start click	,


public class GenericTableDataProvider<T extends EntityInterface> extends SortableDataProvider<T> implements TableDataProviderInterface<T> {
 
/ 7	. 

/ we zijn op 
/ Planning, Shipment order, Mass update dashboard
/ In EntityActionGroupListPage.html

/ we click op een edit button	, 
/ we vallen in 	,
EntityActionGroupListPage$1.onSubmit(Button, IModel<EntityActionGroup>) line: 79	

public class EntityActionGroupListPage extends BaseContextPage {

	private EntityListActionBuilder<EntityActionGroup> getPanelAction() {
		Collection<EntityAction<EntityActionGroup>> actions = new ArrayList<EntityAction<EntityActionGroup>>();
		EntityActionButton<EntityActionGroup> editAction = new EntityActionButton<EntityActionGroup>("edit",
				new ResourceModel("edit").wrapOnAssignment(EntityActionGroupListPage.this)) {

			@Override
			protected void onSubmit(Button aButton, IModel<EntityActionGroup> aSelection) {
	->			setResponsePage(new EntityActionGroupEditPage(daoWrapper, Model.of(aSelection.getObject()), EntityActionGroupListPage.this));

/ Hier vallen we in als we op een edit button click 	,
/ Dit is wat 'new Label' ook doet	,
	Label label3=new Label("third",new ResourceModel("third"))  
/ hij wrapt om de resource model een loadabledetachablemodel	,  
				new ResourceModel("edit").wrapOnAssignment(EntityActionGroupListPage.this)) {

/ 7	. 

/ In EntityActionGroupEditPage.java

	public EntityActionGroupEditPage(BeanWrapper<BaseDAOInterface<EntityActionGroup>> daoWrapper, IModel<EntityActionGroup> anActionGroupModel,
			Page basePage) {
...
		createFeedbackPanel();
		add(new EntityActionGroupPanel("editPanel", anActionGroupModel, daoWrapper, basePage) {

/ In EntityActionGroupEditPage.html

<wicket:extend>
	<div wicket:id="feedback"></div>	
	<div wicket:id="editPanel"></div>
</wicket:extend>

/ In EntityActionGroupPanel.java
/=
public abstract class EntityActionGroupPanel extends Panel {
	public EntityActionGroupPanel(String id, IModel<EntityActionGroup> actionGroupModel, BeanWrapper<BaseDAOInterface<EntityActionGroup>> daoWrapper, Page page) {
...
		createPanel(form);

/ In EntityActionGroupPanel.java
	protected void createPanel(Form<EntityActionGroup> form) {
		final AuthorizationCommentFragment authorizationFragment = new AuthorizationCommentFragment(approveRejectPanel.getContentId(), this, approveRejectPanel);
		approveRejectPanel.setContent(authorizationFragment);
/s
public class AuthorizationCommentFragment extends Fragment {
	public AuthorizationCommentFragment(String id, MarkupContainer markupContainer, ModalWindow lookupPanel) {
		super(id, "authorizationCommentFragment", markupContainer);
/ id="lookupPanel"
/ Dus in EntityActionGroupPanel.html

			<div wicket:id="lookupPanel"></div>
...
		<wicket:fragment wicket:id="authorizationCommentFragment">
/ def	,

/ Intermezzo

       public ModalWindow setContent(final Component component)
                component.setOutputMarkupPlaceholderTag(true);
/ TODO
  
/ Einde Intermezzo


/ In het algemeen: we kunnen in de html page multiple fragments  def	, en in code afh van situatie (bijv manager of employee) zeggen welk fragment wordt gekozen,	
			<div wicket:id="comp"></div>
...
		<wicket:fragment wicket:id="fragment1">
		<wicket:fragment wicket:id="fragment2">

/ in code	,
	if(...)
		comp.setContent(fragment1);
	else
		comp.setContent(fragment2);

/ 13	. 

		final List<AuthorizationCode> myAuthorizationCodesForResource = MpoBeanFactory.getBean(ResourceAuthorizationCodeDAO.class)
				.getAuthorizationCodesForResource(resource);
/ we zien	,
/ in ResourceAuthorizationCode.standard.hbml.xml
	<class name="com.mpobjects.authorization.model.ResourceAuthorizationCode" table="AUT_USER_AUTH_CODE">

/ 13	. 

/ configuration, authorization, user authorization
/ Hier geven we een user auth	,

/ configuration, massupdate, entity action types
/ Hier kunnen we action create, die dan verschijnen in de drop down list bij planning, shipment order, mass update	,

/ 13	. 

/ we vervangen de db door die van de test (internal), dat is mposerv8	,

[eric@localhost Backup]$ PGPASSWORD=mpo@2014 pg_dump -U eric -Fc -h mposerv8 pnloms -f pnloms.3.dump
pnloms2=# create database pnloms2;
[eric@localhost Backup]$ PGPASSWORD=mpopostgres@mpo pg_restore -U mpopostgres -d pnloms2 pnloms.3.dump 
...
pg_restore: [archiver (db)] could not execute query: ERROR:  role "pnloms" does not exist
$ vi postgres-ds.xml
<datasources>
        <xa-datasource>
                <jndi-name>tmsdevDS</jndi-name>
                <xa-datasource-property name="DatabaseName">pnloms2</xa-datasource-property>
...
        </xa-datasource>
        <local-tx-datasource>
                <jndi-name>patchDS</jndi-name>
                <connection-url>jdbc:postgresql://127.0.0.1:5432/pnloms2</connection-url>
...

eric
rtdMpo45@pnloms

/ 13	. 

/ na approves staat in Status: APPROVED	, maar in mau_action_group EXECUTED	,
  27252879 | foo bar 5   | EXECUTED |              27245899 |        27252789 | 2015-01-28 15:57:45.511 | 2015-01-28 15:58:13.012 | 2015-01-28 15:58:13.012

/ in action group dashboard staat wel EXECUTED	,





/ 13	. 

/ we gaan verder	,

/ In EntityActionGroupPanel.java
	protected void createPanel(Form<EntityActionGroup> form) {
		final IModel<EntityActionGroup> actionGroupModel = form.getModel();
Model:classname=[org.apache.wicket.model.Model]:object=[EntityActionGroup [systemId:26680611, description:Test002a]]
/ We clicked edit button op deze	,

		final IModel<? extends List<EntityAction>> actionsModel = new PropertyModel<List<EntityAction>>(actionGroupModel, "actions");
Model:classname=[org.apache.wicket.model.PropertyModel]:nestedModel=[Model:classname=[org.apache.wicket.model.Model]:object=[EntityActionGroup [systemId:26680611, description:Test002a]]]:expression=[actions]

		final IModel<EntityActionStatus> statusModel = new PropertyModel<EntityActionStatus>(actionGroupModel, "status");

pnloms=# select*from mau_action_group;
 system_id | description | status  | requested_by_systemid | bundle_systemid |       started_dtm       | executed_dtm |     last_update_dtm     
-----------+-------------+---------+-----------------------+-----------------+-------------------------+--------------+-------------------------
  26680611 | Test002a    | INITIAL |              26673330 |        26680610 |                         |              | 

/13	. 

EntityActionGroupEditPage$1(EntityActionGroupPanel).createPanel(Form<EntityActionGroup>) line: 149	
/=
public abstract class EntityActionGroupPanel extends Panel {
	protected void createPanel(Form<EntityActionGroup> form) {
		final List<AuthorizationCode> myAuthorizationCodesForResource = MpoBeanFactory.getBean(ResourceAuthorizationCodeDAO.class)
				.getAuthorizationCodesForResource(resource);

select this_.USER_SYSTEMID as USER1_259_0_, this_.AUTHORIZATION_CODE_SYSTEMID as AUTHORIZ2_259_0_ 
from AUT_USER_AUTH_CODE this_ 
where this_.USER_SYSTEMID=?
 204720 2015-01-29 11:12:21,698 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-4:) binding parameter [1] as         [INTEGER] - 26681004

/ we hebben	, 
pnloms=# update shipment_order set authorization_codes='West-G';
/ want eric heeft  onder 	,
/ configuration, authorization, user authorization
/ alle auth's gekregen	,
pnloms=# select*from aut_user_auth_code;
 user_systemid | authorization_code_systemid 
---------------+-----------------------------
      26681004 |                    26680552
      26681004 |                    26680553
      26681004 |                    26680554
      26681004 |                    26680555
      26681004 |                    26680556

myAuthorizationCodesForResource	ArrayList  (id=17613)	
	elementData	Object[10]  (id=17614)	
		[0]	AuthorizationCode_$$_javassist_24  (id=17636)	
			handler	JavassistLazyInitializer  (id=17680)	
				id	Integer  (id=17687)	
				initialized	true	
				target	AuthorizationCode  (id=17693)	
					authorizationLevel	AuthorizationLevel_$$_javassist_57  (id=17699)	
					code	"Noord-G" (id=17719)	
					description	"Authorisatie level 1 voor regio Noord" (id=17720)	
					organization	Organization  (id=17721)	
					performanceMonitorService	null	
					systemId	26680552	
				unwrap	false	
			organization	null	
			performanceMonitorService	null	
			systemId	0	
		[1]	AuthorizationCode_$$_javassist_24  (id=17637)	
		[2]	AuthorizationCode_$$_javassist_24  (id=17671)	
		[3]	AuthorizationCode_$$_javassist_24  (id=17674)	
		[4]	AuthorizationCode_$$_javassist_24  (id=17675)	
	modCount	5	
	size	5	

/ 13	. 


		final List<AuthorizationCode> myAuthorizationCodesForResource = MpoBeanFactory.getBean(ResourceAuthorizationCodeDAO.class)
				.getAuthorizationCodesForResource(resource);
/d
		final IModel<EntityActionGroup> actionGroupModel = form.getModel();

/ Wat is form.getModel()	? Dit is een model om een action group	,
/ we gaan een action group edit	, dus wordt op een action group een form set	,
/ Terug, we zijn nog in	, 
				setResponsePage(new EntityActionGroupEditPage(daoWrapper, Model.of(aSelection.getObject()), EntityActionGroupListPage.this));
/ aSelection.getObject()=
aSelection	GenericListElementModel  (id=16718)	
	LOG	Log4JLogger  (id=19183)	
	attached	true	
	id	Integer  (id=19184)	
26681034
	transientModelObject	EntityActionGroup_$$_javassist_64  (id=19101)	
		handler	JavassistLazyInitializer  (id=19215)	
			id	Integer  (id=19223)	
26681034
			initialized	true	
			target	EntityActionGroup  (id=19236)	
				actions	PersistentBag  (id=19239)	
[com.mpobjects.massupdate.model.action.EntityAction/id:26681035]

pnloms=# select*from mau_action_group where system_id=26681034;
 system_id | description |  status  | requested_by_systemid | bundle_systemid |       started_dtm       |      executed_dtm       |     last_update_dtm     
-----------+-------------+----------+-----------------------+-----------------+-------------------------+-------------------------+-------------------------
  26681034 | foo bar 6   | EXECUTED |              26681004 |        26681033 | 2015-01-28 16:53:09.209 | 2015-01-28 16:53:21.614 | 2015-01-28 16:53:21.614
(1 row)

pnloms=# select*from mau_action where system_id=26681035
pnloms-# ;
 system_id | action_group_systemid | action_type_systemid | configuration 
-----------+-----------------------+----------------------+---------------
  26681035 |              26681034 |             26680606 | CREDIT_HOLD
(1 row)

/t
		final IModel<EntityActionGroup> actionGroupModel = form.getModel();
/d
		final IModel<? extends List<EntityAction>> actionsModel = new PropertyModel<List<EntityAction>>(actionGroupModel, "actions");
/ we hebben maar 1 action in actions	, 

		final IModel<EntityActionStatus> statusModel = new PropertyModel<EntityActionStatus>(actionGroupModel, "status");

/ 13	. 

		form.add(new Button("editBundle") {
/ Change/view button	,

		final MarkupContainer actionsPanel = new MarkupContainer("actionsPanel") {
		};
		BeanWrapper<BaseDAOInterface<EntityActionType>> entityActionWrapper = new BeanWrapper(EntityActionTypeDAO.class);
/ HOLD,...
		final Collection<EntityActionType> actionTypes = entityActionWrapper.getBean().getAll();

/ we zien	,
pnloms=# select*from mau_action_type;
 system_id | name | organization_systemid | action_type_definition 
-----------+------+-----------------------+------------------------
  26680606 | HOLD |                  1000 | SET_HOLD
  26681001 | my   |                  1000 | SET_REMARK

/ in de log	,
select this_.SYSTEM_ID as SYSTEM1_263_0_, this_.NAME as NAME263_0_, this_.ORGANIZATION_SYSTEMID as ORGANIZA3_263_0_, this_.ACTION_TYPE_DEFINITION as ACTION4_263_0_ 
from MAU_ACTION_TYPE this_

select authorizat0_.ACTION_TYPE_SYSTEMID as ACTION1_263_3_,         authorizat0_.AUTHORIZATION_LEVEL_SYSTEMID as AUTHORIZ2_3_, authorizat1_.SYSTEM_ID as SYSTEM1_258_0_, authorizat1_.CODE as CODE258_0_,         authorizat1_.DESCRIPTION as DESCRIPT3_258_0_, authorizat1_.LEVEL as LEVEL258_0_, authorizat1_.ORGANIZATION_SYSTEMID as ORGANIZA5_258        _0_, organizati2_.SYSTEM_ID as SYSTEM1_138_1_, organizati2_.IS_DELETED as IS2_138_1_, organizati2_.SEQUENCE as SEQUENCE138_1_, organi        zati2_.ORGANIZATION_ID as ORGANIZA4_138_1_, organizati2_.DESCRIPTION as DESCRIPT5_138_1_, organizati2_.ORGANIZATION_GROUP as ORGANIZA        6_138_1_, organizati2_.AUTOM_RATE_CALC as AUTOM7_138_1_, organizati3_.SYSTEM_ID as SYSTEM1_138_2_, organizati3_.IS_DELETED as IS2_138        _2_, organizati3_.SEQUENCE as SEQUENCE138_2_, organizati3_.ORGANIZATION_ID as ORGANIZA4_138_2_, organizati3_.DESCRIPTION as DESCRIPT5        _138_2_, organizati3_.ORGANIZATION_GROUP as ORGANIZA6_138_2_, organizati3_.AUTOM_RATE_CALC as AUTOM7_138_2_ 
from MAU_ACTION_TYPE_AUTHORIZATION_LEVEL authorizat0_ 
inner join AUT_AUTHORIZATION_LEVEL authorizat1_ on authorizat0_.AUTHORIZATION_LEVEL_SYSTEMID=authorizat1_.SYSTEM_ID 
left outer join ORGANIZATION organizati2_ on authorizat1_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID 
left outer join ORGANIZATION organizati3_ on organizati2_.ORGANIZATION_GROUP=organizati3_.SYSTEM_ID 
where authorizat0_.ACTION_TYPE_SYSTEMID=?
 407025 2015-01-29 12:06:40,812 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-4:) binding parameter [1] as [INTEGER] - 26681001
/ TODO

pnloms=# select*from mau_action_group;
 system_id | description |  status  | requested_by_systemid | bundle_systemid |       started_dtm       |      executed_dtm       |     last_update_dtm     
  26681034 | foo bar 6   | EXECUTED |              26681004 |        26681033 | 2015-01-28 16:53:09.209 | 2015-01-28 16:53:21.614 | 2015-01-28 16:53:21.614

pnloms=# select*from mau_action;
 system_id | action_group_systemid | action_type_systemid | configuration 
-----------+-----------------------+----------------------+---------------
  26681035 |              26681034 |             26680606 | CREDIT_HOLD

pnloms=# select*from mau_action_type;
 system_id | name | organization_systemid | action_type_definition 
  26680606 | HOLD |                  1000 | SET_HOLD

/ 13	. 

/ ERICJ TODO
EntityActionEditPanel.html
		<label class="inline-block label-width">Hold Status</label>
/ verander Hold Status	,

/ 13	. 

/ In EntityActionEditPanel.html

<wicket:panel xmlns:wicket="http://wicket.apache.org">
	<div id="panel" class="inline-block">
		<select wicket:id="actionType" class="actions-select"></select>
		<ul wicket:id="parametersPanel" class="inline-block">
			<li wicket:id="parameters">
				<div wicket:id="parameter"></div>
			</li>
		</ul>
	</div>
	
	<wicket:fragment wicket:id="holdStatusFragment">
		<label class="inline-block label-width">Hold Status</label>
		<input wicket:id="holdStatusField" />
	</wicket:fragment>
...

/ In EntityActionEditPanel.java

	parametersPanel.add(new ListView<EntityActionParameter<?>>("parameters", parameters) {
			@Override
			protected void populateItem(final ListItem<EntityActionParameter<?>> item) {
				Class<?> parameterType = item.getModelObject().getType();
/*
				} else if (parameterType == HoldStatus.class) {
					item.add(new HoldStatusFragment(item.getModel()));

class HoldStatusFragment extends Fragment {
		public HoldStatusFragment(IModel<EntityActionParameter<?>> parameter) {
			super(PARAMETER, "holdStatusFragment", EntityActionEditPanel.this);

/ *
/ item.getModelObject()=EntityActionParameter
	object=HoldStatus
		description="CREDIT_HOLD"

parameterType	Class (com.mpobjects.oms.model.entity.holdstatus.HoldStatus) (id=1025)	






/ 13	. 

/ Lees	,
https://wicket.apache.org/learn/examples/dropdownchoice.html




 
/ Einde DEBUG PNL-313 PNL-314

/ DEBUG PNL-313 PNL-314

/ 7	. 

/ click planning, shipment order, mass update

/ dat is ShipmentOrderMassUpdatePage	,

public class ShipmentOrderMassUpdatePage extends AbstractMainPage {

/ In AbstractMainPage.html	,
<body>
	<wicket:extend>
		<div id="pageHeader">
			<div class="pageTitle" wicket:enclosure="pageTitle">

/ TODO (wicket:enclosure)	,

/ we vallen in	,
ShipmentOrderMassUpdatePage	,
	protected void initializePage() {
		pageTitle = new Label("pageTitle", getPageTitle());
/s
ShipmentOrderMassUpdatePage(AbstractPage).getPageTitle() line: 65	
		return new ResourceModel("pageTitle").wrapOnAssignment(this);
/ ERICJ TODO( .wrapOnAssignment(this) doet wicket al	,

/ Voeg markup code toe aan ShipmentOrderMassUpdatePage.html	,

/ 7	.

$ vi ShipmentOrderMassUpdatePage.html

<wicket:extend>
	<div wicket:id="query"></div>
</wicket:extend>

$ vi AbstractMainPage.html

		<div id="pageContent">
			<div wicket:id="feedback"></div>

			<wicket:child />

		</div>

/ Dus 'alles' staat in <div wicket:id="query"/>	,

$ vi ShipmentOrderMassUpdatePage.java
		add(new QueryViewPanel("query", Model.of(myQuery), null, myGroupActions, selection) {
			@Override
			protected boolean isReadOnly() {
				return ShipmentOrderMassUpdatePage.this.isReadOnly();
			}
		});

$ vi QueryViewPanel.java

	protected void createComponents() {

		add(new Label("title", new AbstractReadOnlyModel<String>() {

			@Override
			public String getObject() {
				return getTitle();
			}

		}));
/ TODO

/ 7	.

/ We hebben ShipmentOrderMassUpdatePage.<init>  af	, we geven continue, we komen in render	,
/ we vallen in	,
ShipmentOrderMassUpdatePage$3(QueryViewPanel).getRowsOnPage() line: 144	
/=
	public List<List<Object>> getRowsOnPage() {
		if (dirty) {
			rowsOnPage.clear();
			Iterator<? extends List<Object>> myIterator = dataProvider.iterator((currentPage - 1) * rowsPerPage, rowsPerPage);
/s
	private void createDataProvider() {
		dataProvider = new SortableDataProvider<List<Object>>() {
			@Override
			public Iterator<List<Object>> iterator(int first, int count) {
				return loadEntriesFromDatabase(first, count).iterator();
/s
		private List<List<Object>> loadEntriesFromDatabase(int first, int count) {
			...
			List myResult = myCount.list();
/ Deze doet de query	, 
/ we zien	,
select shipmentor0_.SYSTEM_ID as col_0_0_, shipmentor0_.SHIPMENT_ORDER_ID as col_1_0_, shipmentor0_.REFERENCE1 as col_2_0_, shipmentor0_.FROM_NAME as col_3_0_, shipmentor0_.FROM_POSTAL_CODE as col_4_0_, shipmentor0_.FROM_CITY as col_5_0_, country1_.COUNTRY_CODE as col_6_0_, shipmentor0_.TO_NAME as col_7_0_, shipmentor0_.TO_POSTAL_CODE as col_8_0_, shipmentor0_.TO_CITY as col_9_0_, country2_.COUNTRY_CODE as col_10_0_ 
from SHIPMENT_ORDER shipmentor0_, COUNTRY country1_, COUNTRY country2_ 
where shipmentor0_.FROM_COUNTRY_SYSTEMID=country1_.SYSTEM_ID 
and shipmentor0_.TO_COUNTRY_SYSTEMID=country2_.SYSTEM_ID limit ?

/ We geven weer continue	,
/ we vallen in	,
	private void addDataRows() {
		dataView = new ListView<List<Object>>("rows", new PropertyModel<List<List<Object>>>(QueryViewPanel.this, "rowsOnPage")) {
			@Override
			protected void populateItem(final ListItem<List<Object>> aRow) {
->				ListView<Object> myRow = new ListView<Object>("cell", aRow.getModel()) {
...
/ cellValue
/ TODO


/ 13	.

/ Waar vallen we in als we een sho check op planning, shipment order, mass update	?

$ vi CheckPanel.java

		AjaxCheckBox myCheck = new AjaxCheckBox("checkbox", aModel) {

			@Override
			protected void onUpdate(AjaxRequestTarget aTarget) {
->				onPanelUpdate(aTarget);

/ Hier vallen we in als we een sho check op planning, shipment order, mass update	,

/ Waar in	,

$ vi QueryViewPanel.java

private void addDataRows() {
...
						CheckPanel myCheckPanel = new CheckPanel(myActions.newChildId(), myBooleanModel) {
...

/ 13	. 

/ CLICK ON UPDATE

/ we click op update	,

/ we vallen in	,

ShipmentOrderMassUpdatePage$1.execute(Set<Serializable>) line: 110	

$ vi ShipmentOrderMassUpdatePage.java
			myGroupActions.add(new GroupAction("update", "edit") {
				@Override
				public void execute(Set<? extends Serializable> aSelectedRowSet) {
->					LOG.debug("Starting mass update for [" + aSelectedRowSet.size() + "] items");
					BundleDAO myDAO = MpoBeanFactory.getBean(BundleDAO.class);
					...
					if (myBundle == null) {
						myBundle = new Bundle();
						myBundle.setOwner(myResource);
						myBundle.setOrganization(myResource.getActiveOrganization());
						myBundle.setCode("SHO_MASS_UPDATE_" + System.currentTimeMillis());
						myBundle.setSourceReference("SHIPMENTORDER_BUNDLE");
						myBundle.setLastUpdate(new Date());
						myBundle.setShared(false);
						myBundle.setDescription(aSelectedRowSet.size() + " shipment order(s)");


$ vi Bundle.standard.hbm.xml

	<class name="com.mpobjects.oms.model.bundle.Bundle"
		table="OMS_BUNDLE">

					if (page == null) {
						myBundle = myDAO.save(myBundle);
/ Omdat dao.save in een tx	,
pnloms=# select*from oms_bundle; 
 system_id |             code              |     description     |   source_reference   | user_systemid | organization_systemid | is_shared | is_locked |       last_update   
-----------+-------------------------------+---------------------+----------------------+---------------+-----------------------+-----------+-----------+---------------------
...
  26681052 | SHO_MASS_UPDATE_1422952027933 | 1 shipment order(s)  | SHIPMENTORDER_BUNDLE |      26681004 |                  1000 |         0 |         0 | 2015-02-03 09:27:08
.76

/ in de log zien we inderdaad	,
 104441 2015-02-03 09:28:25,769 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-3:) insert into OMS_BUNDLE (CODE, DESCRIPTION, SOURCE_REFERENCE,         IS_SHARED, IS_LOCKED, LAST_UPDATE, USER_SYSTEMID, ORGANIZATION_SYSTEMID, SYSTEM_ID) values (?, ?, ?, ?, ?, ?, ?, ?, ?)
 104443 2015-02-03 09:28:25,771 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [1] as [VARCHA        R] - SHO_MASS_UPDATE_1422952027933
 104444 2015-02-03 09:28:25,772 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [2] as [VARCHA        R] - 1 shipment order(s)
...


						EntityActionGroup myEntityActionGroup = new EntityActionGroup();
						myEntityActionGroup.setBundle(myBundle);
						myEntityActionGroup.setRequestedBy(myResource);
						page = new EntityActionGroupEditPage(Model.of(myEntityActionGroup), ShipmentOrderMassUpdatePage.this);
/s
	public EntityActionGroupEditPage(IModel<EntityActionGroup> anEntityActionGroupModel, Page basePage) {
		this(new BeanWrapper(EntityActionGroupDAO.class), anEntityActionGroupModel, basePage);

/ Hoe checked sho in entityactiongroup, or in model?
/ TODO

...
/s
EntityActionGroupEditPage$1(EntityActionGroupPanel).<init>(String, IModel<EntityActionGroup>, BeanWrapper<BaseDAOInterface<EntityActionGroup>>, Page) line: 57	
/=
	public EntityActionGroupPanel(String id, IModel<EntityActionGroup> actionGroupModel, BeanWrapper<BaseDAOInterface<EntityActionGroup>> daoWrapper, Page page) {
		createPanel(form);
/s

/ ERICJ TODO
/ rename keys, zoals description in EntityActionGroupPanel.html

/ 7	.

/ we zien de 2 buttons op het modal window in een fragment	,

$ vi EntityActionGroupPanel.java

	protected void createPanel(Form<EntityActionGroup> form) {
		final AuthorizationCommentFragment authorizationFragment = new AuthorizationCommentFragment(approveRejectPanel.getContentId(), this, approveRejectPanel);

/ Intermezzo

/ approveRejectPanel='n ModalWindow	,
/ this=EntityActionGroupEditPage$1='n EntityActionGroupPanel inst	, 
/ want 
	public EntityActionGroupEditPage(BeanWrapper<BaseDAOInterface<EntityActionGroup>> daoWrapper, IModel<EntityActionGroup> anActionGroupModel, Page basePage) {
		...
		add(new EntityActionGroupPanel("editPanel", anActionGroupModel, daoWrapper, basePage) {
/s

	public EntityActionGroupPanel(String id, IModel<EntityActionGroup> actionGroupModel, BeanWrapper<BaseDAOInterface<EntityActionGroup>> daoWrapper, Page page) {
		createPanel(form);

/ Einde Intermezzo

/s
	public AuthorizationCommentFragment(String id, MarkupContainer markupContainer, ModalWindow lookupPanel) {
/ markupContainer=het panel, EntityActionGroupPanel	,
		super(id, "authorizationCommentFragment", markupContainer);
		this.lookupPanel = lookupPanel;
/ In de HTML van het panel vinden we dus de HTML van het fragment	,
/ Klopt	, 
$ vi EntityActionGroupPanel.html
		...
		<wicket:fragment wicket:id="authorizationCommentFragment">
			<p />
			<form wicket:id="form" class="authorizationForm">
				<textarea wicket:id="comment" class="comment"></textarea>
				<br/>
				<button wicket:id="approveButton" class="icon icon_ok" title="Save" type="submit">Approve</button>
				<button wicket:id="rejectButton" class="icon icon_cancel" title="Reject" type="submit">Reject</button>
			</form>
		</wicket:fragment>

/ approveRejectPanel.getContentId()="content" is de wicket:id van het corresp ... in HTML (TODO), In AuthorizationCommentFragment.<init> staat super(id,"authorizationFragment",...) en authorizationFragment is de wicket:id van de HTML code van het fragment	, 
/s
$ vi AuthorizationCommentFragment.java
		form.add(new IndicatingAjaxButton("approveButton", form) {
		form.add(new IndicatingAjaxButton("rejectButton", form) {

/ 7	.

EntityActionGroupEditPage$1(EntityActionGroupPanel).createPanel(Form<EntityActionGroup>) line: 178	
		BeanWrapper<BaseDAOInterface<EntityActionType>> entityActionWrapper = new BeanWrapper(EntityActionTypeDAO.class);
		final Collection<EntityActionType> actionTypes = entityActionWrapper.getBean().getAll();

/ we zien	,
select ... 
from MAU_ACTION_TYPE this_

/t
		final List<AuthorizationCode> myAuthorizationCodesForResource = MpoBeanFactory.getBean(ResourceAuthorizationCodeDAO.class)
				.getAuthorizationCodesForResource(resource);
$ vi ResourceAuthorizationCode.standard.hbm.xml
	<class name="com.mpobjects.authorization.model.ResourceAuthorizationCode" table="AUT_USER_AUTH_CODE">

pnloms=# select*from aut_user_auth_code;
 user_systemid | authorization_code_systemid 
---------------+-----------------------------
      26681004 |                    26680552
      26681004 |                    26680553
      26681004 |                    26680554
      26681004 |                    26680555
      26681004 |                    26680556
pnloms=# select*from aut_authorization_code;
 system_id |   code   |              description              | organization_systemid | authorization_level_system_id 
-----------+----------+---------------------------------------+-----------------------+-------------------------------
  26680552 | Noord-G  | Authorisatie level 1 voor regio Noord |                  1010 |                      26680549
  26680553 | Noord-P1 | Autorisatie Procuratie 1, level 2     |                  1010 |                      26680550
  26680554 | Noord-P2 | Autorisatie procuratie 2, Level 3     |                  1010 |                      26680551
  26680555 | West-G   | Autorisatie Level 1 - operationeel    |                  1010 |                      26680549
  26680556 | West-P1  | Autorisatie Procuratie 1, level 2     |                  1010 |                      26680550
(5 rows)
pnloms=# \d+ aut_user_auth_code
    "autuser_autcode_autcode_fk" FOREIGN KEY (authorization_code_systemid) REFERENCES aut_authorization_code(system_id)
    "autuser_autcode_tmsuser_fk" FOREIGN KEY (user_systemid) REFERENCES tms_user(system_id)


		BeanWrapper<BaseDAOInterface<EntityActionType>> entityActionWrapper = new BeanWrapper(EntityActionTypeDAO.class);
		final Collection<EntityActionType> actionTypes = entityActionWrapper.getBean().getAll();

/ Intermezzo

/ In EntityActionType.standard.hbm.xml	,
<hibernate-mapping>
	<class name="com.mpobjects.massupdate.model.actiontype.EntityActionType" table="MAU_ACTION_TYPE">
		<set name="authorizationLevels" table="MAU_ACTION_TYPE_AUTHORIZATION_LEVEL" lazy="false">
...
/ dus lazy="false"
/ dit geeft een extra query	,
/ ERICJ TODO

/ we zien in de log	,

675778 2015-02-04 14:57:16,188 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-4:) select this_.SYSTEM_ID as SYSTEM1_263_0_, this_.NAME as NAME        263_0_, this_.ORGANIZATION_SYSTEMID as ORGANIZA3_263_0_, this_.ACTION_TYPE_DEFINITION as ACTION4_263_0_ from MAU_ACTION_TYPE this_

/ maar even later ook	,

select ... 
from MAU_ACTION_TYPE_AUTHORIZATION_LEVEL authorizat0_ 
inner join AUT_AUTHORIZATION_LEVEL authorizat1_ on authorizat0_.AUTHORIZATION_LEVEL_SYSTEMID=authorizat1_.SYSTEM_ID 
left outer join ORGANIZATION organizati2_ on authorizat1_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID 
left outer join ORGANIZATION organizati3_ on organizati2_.ORGANIZATION_GROUP=organizati3_.SYSTEM_ID 
where authorizat0_.ACTION_TYPE_SYSTEMID in (?, ?)
 675813 2015-02-04 14:57:16,655 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-4:) binding parameter [1] as [INTEGER] - 26681001
 675814 2015-02-04 14:57:16,655 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-4:) binding parameter [2] as [INTEGER] - 26680606

/ we zien	,
$ vi EntityActionType.standard.hbm.xml
	<class name="com.mpobjects.massupdate.model.actiontype.EntityActionType" table="MAU_ACTION_TYPE">

pnloms=# select*from mau_action_type;
 system_id | name | organization_systemid | action_type_definition 
-----------+------+-----------------------+------------------------
  26680606 | HOLD |                  1000 | SET_HOLD
  26681001 | my   |                  1000 | SET_REMARK
(2 rows)

pnloms=# \d+ MAU_ACTION_TYPE_AUTHORIZATION_LEVEL
                    Table "public.mau_action_type_authorization_level"
            Column            |  Type   | Modifiers | Storage | Stats target | Description 
------------------------------+---------+-----------+---------+--------------+-------------
 action_type_systemid         | integer | not null  | plain   |              | 
 authorization_level_systemid | integer | not null  | plain   |              | 
Foreign-key constraints:
    "mau_action_type_authorization_authorization_level_systemid_fkey" FOREIGN KEY (authorization_level_systemid) REFERENCES aut_authorization_level(system_id)
    "mau_action_type_authorization_level_action_type_systemid_fkey" FOREIGN KEY (action_type_systemid) REFERENCES mau_action_type(system_id)
Has OIDs: no


pnloms=# select*from aut_authorization_level;
 system_id | code |              description               | level | organization_systemid 
-----------+------+----------------------------------------+-------+-----------------------
  26680549 | L1   | Goedkeuren vanuit operationeel oogpunt |     1 |                  1010
  26680550 | L2   | Procuratie 1                           |     2 |                  1010
  26680551 | L3   | Procuratie 2                           |     3 |                  1010
(3 rows)

/ Einde Intermezzo

/ we zien bij de actions een actionsPanel.. , deze omvat het hele ding qua actions	,
/ op actionsPanel zien we een list van actionPanel's, 	en een add button	,
/ op dit panel zien we steeds een delete button, en daarnaast ook een panel	, een actionPanel..	, 
/ we kiezen acties Hold en Load window	,
/ op Hold-actionPanel zien we een select met Hold, en daarnaast een ul van een label en een input
/ op Load window-actionPanel zien we een select met Load window, en daarnaast een ul van 2 , 2 keer : een label , een input, een datepicker, een input en een input

		final MarkupContainer actionsPanel = new MarkupContainer("actionsPanel") {};
		..
		actionsPanel.add(new ListView<EntityAction>("actions", actionsModel) {
/ actionsPanel is een EntityActionGroupPanel$4	,

/ In EntityActionGroupPanel.html
			<ul wicket:id="actionsPanel">
				<li wicket:id="actions">
					<button wicket:id="deleteButton" type="submit" class="icon icon_delete small sbtn" title="Delete"></button>
					<div class="inline-block" wicket:id="actionPanel"></div>
				</li>
			</ul>
			<button wicket:id="addButton" type="submit" class="icon icon_add small sbtn" title="Add" style="display:block"></button>


/ list	,
			@Override
			protected void populateItem(final ListItem<EntityAction> item) {
				AjaxButton deleteButton = new AjaxButton("deleteButton") {
					protected void onSubmit(AjaxRequestTarget target, Form<?> form) {
/ delete button	,
				item.add(deleteButton);
				item.add(new EntityActionEditPanel("actionPanel", item.getModel(), actionTypes) {
/ de actionPanel	, 
/ Maar hier komen we later pas	,

		final AjaxButton addActionButton = new AjaxButton("addButton", new StringResourceModel("add", actionGroupModel)) {
			@Override
			public boolean isEnabled() {
				return editable(statusModel);
			}

			@Override
			protected void onSubmit(AjaxRequestTarget target, Form<?> form) {
				actionsModel.getObject().add(new EntityAction(actionGroupModel.getObject()));
				target.addComponent(actionsPanel);
			}
		};
		addActionButton.setDefaultFormProcessing(false);
		form.add(addActionButton);

/ 7	. 

/ auth panel	,

/ In EntitActionGroupPanel.html

->				<table wicket:id="authorizationPanel" class="grid authorization-panel inline-block">
				...
					<tbody>
						<tr wicket:id="authorization">
							<td><span wicket:id="code">AZ1</span></td>
							<td><span wicket:id="approved">Approved</span></td>
							<td><span wicket:id="user">Chris</span></td>
							<td><span wicket:id="date">date</span></td>
							<td><pre wicket:id="comment" class="comment">OK</pre></td>
						</tr>
					</tbody>

/ In EntitActionGroupPanel.java

		final MarkupContainer authorizationPanel = new MarkupContainer("authorizationPanel") {
		};


$ vi EntityActionGroupAuthorization.standard.hbm.xml
	<class name="com.mpobjects.massupdate.model.actiongroup.EntityActionGroupAuthorization" table="MAU_ACTION_GROUP_AUTHORIZATION">

pnloms=#  select*from MAU_ACTION_GROUP_AUTHORIZATION;
 system_id | action_group_systemid |  status  | user_systemid |     auth_date_time      | comment | authorization_code_systemid 
-----------+-----------------------+----------+---------------+-------------------------+---------+-----------------------------
  26681036 |              26681034 | APPROVED |      26681004 | 2015-01-28 16:53:20.042 | c       |                    26680555
pnloms=# \d+ MAU_ACTION_GROUP_AUTHORIZATION;
    "mau_action_group_authorization_action_group_systemid_fkey" FOREIGN KEY (action_group_systemid) REFERENCES mau_action_group(system_id)
    "mau_action_group_authorization_authorization_code_systemid_fkey" FOREIGN KEY (authorization_code_systemid) REFERENCES aut_authorization_code(system_id)
    "mau_action_group_authorization_user_systemid_fkey" FOREIGN KEY (user_systemid) REFERENCES tms_user(system_id)

/t
ShipmentOrderMassUpdatePage$1.execute(Set<Serializable>) line: 138	
/=
			myGroupActions.add(new GroupAction("update", "edit") {
/ TODO
				@Override
				public void execute(Set<? extends Serializable> aSelectedRowSet) {
						page = new EntityActionGroupEditPage(Model.of(myEntityActionGroup), ShipmentOrderMassUpdatePage.this);
/d
					for (Serializable myId : aSelectedRowSet) {
						BundleObject myObject = new BundleObject(myBundle, (Integer) myId);

/ we hadden maar 1 sho select	,
pnloms=# select*from shipment_order where system_id=26673468;
...
/ 1 row	,
/ OK

					myBundle = myDAO.merge(myBundle);
	<class name="com.mpobjects.oms.model.bundle.Bundle"
		table="OMS_BUNDLE">
insert into OMS_BUNDLE_OBJECT (EXECUTION_STATUS, RETRY_ATTEMPT, BUNDLE_SYSTEMID, OBJECT_ID) values (?, ?, ?, ?)
 838134 2015-02-05 10:50:34,403 DEBUG [org.hibernate.type.EnumType] (http-0.0.0.0-8080-3:) Binding 'INITIAL' to parameter: 1
 838136 2015-02-05 10:50:34,403 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [2] as [INTEGE        R] - 0
 838138 2015-02-05 10:50:34,404 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [3] as [INTEGE        R] - 26681054
 838140 2015-02-05 10:50:34,404 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [4] as [INTEGE        R] - 26673468

					setResponsePage(page);
/ page=EntityActionGroupEditPage	,


/ 7	 . 

/ we click op het entityactiongrouppanel bij Actions op +

/ we vallen in 	,
EntityActionGroupPanel$5.populateItem(ListItem<EntityAction>) line: 193	
		actionsPanel.add(new ListView<EntityAction>("actions", actionsModel) {
			@Override
			protected void populateItem(final ListItem<EntityAction> item) {
				...
				AjaxButton deleteButton = new AjaxButton("deleteButton") {
					...
				deleteButton.setDefaultFormProcessing(false);
				item.add(deleteButton);
				item.add(new EntityActionEditPanel("actionPanel", item.getModel(), actionTypes) {
/s
	public EntityActionEditPanel(String name, final IModel<EntityAction> entityActionModel, Collection<EntityActionType> actionTypes) {
		...
		final PropertyModel<EntityActionType> actionTypeModel = new PropertyModel<EntityActionType>(entityActionModel, "actionType");
/ entityActionModel is een IModel<EntityAction>	, een ListItemModelen actionType is een property van EntityAction	,


/ QueryViewList is het hele ding, waar we alle sho's zien die we kunnen select voor de masss update	, ook planning, shipment order, mass update	,

$ vi QueryViewPanel.java
							CheckPanel myCheckPanel = new CheckPanel(myActions.newChildId(), myBooleanModel) {
								@Override
								public void onPanelUpdate(AjaxRequestTarget aTarget) {
		->							aTarget.addComponent(QueryViewPanel.this);
/ Wat gebeurt hier?
/ ERICJ TODO (Hoe wordt de select saved?)

/ we click op Update	, 
/ see boven	,

/ 7	.

/ click op + bij Actions	, op de EnityActionGroupPanel	,
		final AjaxButton addActionButton = new AjaxButton("addButton", new StringResourceModel("add", actionGroupModel)) {
			@Override
			protected void onSubmit(AjaxRequestTarget target, Form<?> form) {
->				actionsModel.getObject().add(new EntityAction(actionGroupModel.getObject()));
/s
EntityAction.<init>(EntityActionGroup) line: 28	
this	EntityAction  (id=20457)	
actionGroup	EntityActionGroup  (id=20458)	
	actions	ArrayList  (id=20476)	
[]
	authorizations	ArrayList  (id=20477)	
[]
	bundle	Bundle  (id=20478)	
...
/ TODO
	description	null	
	executionDate	null	
	lastUpdateDate	null	
	performanceMonitorService	null	
	requestedBy	Resource  (id=20436)	
	startDate	null	
	status	EntityActionStatus  (id=18253)	
	systemId	0	

/ Hier komt dus een entity action erbij, die we moeten fill in	,
/ TODO

/ we geven continue	,
EntityActionGroupPanel$5$1.<init>(EntityActionGroupPanel$5, String, IModel, IModel, ListItem, MarkupContainer) line: 181	
/=
		actionsPanel.add(new ListView<EntityAction>("actions", actionsModel) {
			@Override
			protected void populateItem(final ListItem<EntityAction> item) {
				AjaxButton deleteButton = new AjaxButton("deleteButton") {

				item.add(new EntityActionEditPanel("actionPanel", item.getModel(), actionTypes) {

/ we select in ddc HOLD	,
/ we vallen in 	,
EntityActionEditPanel$3.onUpdate(AjaxRequestTarget) line: 141	
		dropDownChoice.add(new AjaxFormComponentUpdatingBehavior("onchange") {
			@Override
			protected void onUpdate(AjaxRequestTarget target) {
->				entityActionModel.getObject().clearParameters();
/s 
EntityAction.clearParameters	,
				entityActionModel.getObject().setActionType(actionTypeModel.getObject());
				target.addComponent(parametersPanel);
			}
		});

/ Intermezzo
/ EntityActionEditPanel is het panel naast de delete button	,
/ Eerder	,
$ vi EntityActionEditPanel.java
	final MarkupContainer parametersPanel = new MarkupContainer("parametersPanel") {};

$ vi EntityActionEditPanel.html

wicket:panel xmlns:wicket="http://wicket.apache.org">
	<div id="panel" class="inline-block">
		<select wicket:id="actionType" class="actions-select"></select>
		<ul wicket:id="parametersPanel" class="inline-block">
			<li wicket:id="parameters">
				<div wicket:id="parameter"></div>
			</li>
		</ul>
	</div>
/ Einde Intermezzo
	

/ we geven cont	, we komen in 	,

EntityActionEditPanel$4.populateItem(ListItem<EntityActionParameter<?>>) line: 153	
/=
		parametersPanel.add(new ListView<EntityActionParameter<?>>("parameters", parameters) {
			@Override
			protected void populateItem(final ListItem<EntityActionParameter<?>> item) {
				...
				} else if (parameterType == HoldStatus.class) {
->					item.add(new HoldStatusFragment(item.getModel()));
/ parametersPanel is een 
/s
	class HoldStatusFragment extends Fragment {
		public HoldStatusFragment(IModel<EntityActionParameter<?>> parameter) {
parameter	ListItemModel  (id=20900)	


/ EntityActionEditPanel.html/.java:  click op + bij Actions, dan verschijnt er een panel, met een select box	, en een fragment	,
/ dit kan een HoldStatusFragment zijn, of een andere	,

			add(new HoldStatusField("holdStatusField", convertModel));
/ add 'n text field aan het fragment 	,

$ vi EntityActionEditPanel.html

	<wicket:fragment wicket:id="holdStatusFragment">
		<label class="inline-block label-width">Hold Status</label>
		<input wicket:id="holdStatusField" />
	</wicket:fragment>

/ 7	. 

[eric@localhost trunk]$ find -name language_en.properties
./base-framework/core/conf/language_en.properties


/ OVERZICHT MODELS

ShipmentOrderMassUpdatePage$1.execute(Set<Serializable>) line: 133	
/=
public class ShipmentOrderMassUpdatePage extends AbstractMainPage {
	@Override
	protected void createPageComponents() {
		List<GroupAction> myGroupActions = new ArrayList<GroupAction>();
			myGroupActions.add(new GroupAction("update", "edit") {
				@Override
				public void execute(Set<? extends Serializable> aSelectedRowSet) {
						...
						EntityActionGroup myEntityActionGroup = new EntityActionGroup();
						myEntityActionGroup.setBundle(myBundle);
						myEntityActionGroup.setRequestedBy(myResource);
						page = new EntityActionGroupEditPage(Model.of(myEntityActionGroup), ShipmentOrderMassUpdatePage.this);
myEntityActionGroup	EntityActionGroup  (id=21298)	
	actions	ArrayList  (id=21302)	
[]
	authorizations	ArrayList  (id=21303)	
[]
	bundle	Bundle  (id=21300)	
		code	"SHO_MASS_UPDATE_1423144314286" (id=21306)	
		description	"1 shipment order(s)" (id=21308)	
		lastUpdate	Date  (id=21310)	
		locked	false	
		objectList	PersistentSet  (id=21313)	
[]
		organization	Organization  (id=21315)	
SystemId:1000	Id:PNL-OMS-GEN	Description:Post NL Generic
		owner	Resource  (id=21299)	
		performanceMonitorService	null	
		shared	false	
		sourceReference	"SHIPMENTORDER_BUNDLE" (id=18909)	
		systemId	26681059	

/ Model.of(myEntityActionGroup) is het model wat steeds voor zal komen	,

/ we schrijven nog een keer	,
						page = new EntityActionGroupEditPage(Model.of(myEntityActionGroup), ShipmentOrderMassUpdatePage.this);
...
/s
EntityActionGroupEditPage.<init>(BeanWrapper<BaseDAOInterface<EntityActionGroup>>, IModel<EntityActionGroup>, Page) line: 40	
		add(new EntityActionGroupPanel("editPanel", anActionGroupModel, daoWrapper, basePage) {
/s
EntityActionGroupEditPage$1(EntityActionGroupPanel).<init>(String, IModel<EntityActionGroup>, BeanWrapper<BaseDAOInterface<EntityActionGroup>>, Page) line: 57	
		Form<EntityActionGroup> form = new Form<EntityActionGroup>("form", actionGroupModel) {
			...
		};
		createPanel(form);
/s
EntityActionGroupEditPage$1(EntityActionGroupPanel).createPanel(Form<EntityActionGroup>) line: 122	

		final IModel<EntityActionGroup> actionGroupModel = form.getModel();
		final IModel<? extends List<EntityAction>> actionsModel = new PropertyModel<List<EntityAction>>(actionGroupModel, "actions");

		final MarkupContainer actionsPanel = new MarkupContainer("actionsPanel") {
		};
		actionsPanel.add(new ListView<EntityAction>("actions", actionsModel) {
			@Override
			protected void populateItem(final ListItem<EntityAction> item) {
				AjaxButton deleteButton = new AjaxButton("deleteButton") {				/ (*)
				...
				item.add(new EntityActionEditPanel("actionPanel", item.getModel(), actionTypes) {
/s
/ een ListItem heeft altijd een model, een ListItemModel	, WH is dit het model om de EntityAction 	, 
/ TODO
/ het is een model om een EntityAction	,
/s
EntityActionGroupPanel$5$2(EntityActionEditPanel).<init>(String, IModel<EntityAction>, Collection<EntityActionType>) line: 119	

		actions.addAll(actionTypes);
/ 2	, HOLD , en nog een	,
		final PropertyModel<EntityActionType> actionTypeModel = new PropertyModel<EntityActionType>(entityActionModel, "actionType");
		DropDownChoice<EntityActionType> dropDownChoice = new DropDownChoice<EntityActionType>("actionType", actionTypeModel, actions, new ChoiceRenderer<EntityActionType>("name")) {


		final MarkupContainer parametersPanel = new MarkupContainer("parametersPanel") {
		};


/ CREATE ACTION 
/ we click op het group panel op + bij Actions
/s

EntityActionGroupPanel$6.onSubmit(AjaxRequestTarget, Form<?>) line: 213	
			@Override
			protected void onSubmit(AjaxRequestTarget target, Form<?> form) {
				actionsModel.getObject().add(new EntityAction(actionGroupModel.getObject()));		
				target.addComponent(actionsPanel);
/ Hier staat het : er wordt een EntityAction create, de 1ste als het de 1ste keer is als je clickt	,  
/ eerder was	,
		final IModel<? extends List<EntityAction>> actionsModel = new PropertyModel<List<EntityAction>>(actionGroupModel, "actions");
/ Dus de action group wordt set in de action, en de action wordt add in de action group	,

/ geef continue	,
/ dan komen in we in code bij (*) hier vlak boven	,
EntityActionGroupPanel$5$1.<init>(EntityActionGroupPanel$5, String, IModel, IModel, ListItem, MarkupContainer) line: 181	

		BeanWrapper<BaseDAOInterface<EntityActionType>> entityActionWrapper = new BeanWrapper(EntityActionTypeDAO.class);
		final Collection<EntityActionType> actionTypes = entityActionWrapper.getBean().getAll();

		actionsPanel.add(new ListView<EntityAction>("actions", actionsModel) {
			@Override
			protected void populateItem(final ListItem<EntityAction> item) {
				AjaxButton deleteButton = new AjaxButton("deleteButton") {
					@Override
					protected void onSubmit(AjaxRequestTarget target, Form<?> form) {
						actionsModel.getObject().remove(item.getModelObject());	 		/ (**)
						target.addComponent(actionsPanel);
					}
				};
				deleteButton.setDefaultFormProcessing(false);
				item.add(deleteButton);
				item.add(new EntityActionEditPanel("actionPanel", item.getModel(), actionTypes) {

/ actions(Model) bestaat uit 1 EntityAction	, item.getModel() is een ListItemModel, is WH  model om deze EntityAction	,
/ bij (**) : remove action van de actions	,


/ Einde OVERZICHT MODELS

/ OVERZICHT BREAKPOINTS (PNL-313)

/ 7	.

/ QueryViewPanel is planning, shipmentorder , mass update
/ check een sho hierop, 
/ we vallen in	,
 */
public abstract class CheckPanel extends Panel {

	public CheckPanel(String id, final IModel<Boolean> aModel) {
		super(id);

		AjaxCheckBox myCheck = new AjaxCheckBox("checkbox", aModel) {

			@Override
			protected void onUpdate(AjaxRequestTarget aTarget) {
	->			onPanelUpdate(aTarget);

/ 7	.

/ QueryViewPanel is planning, shipmentorder , mass update
/ click Update 	,
/ we vallen in 	,
ShipmentOrderMassUpdatePage$1	,
		List<GroupAction> myGroupActions = new ArrayList<GroupAction>();
		if (!isReadOnly()) {
			myGroupActions.add(new GroupAction("update", "edit") {
				@Override
				public void execute(Set<? extends Serializable> aSelectedRowSet) {
->					LOG.debug("Starting mass update for [" + aSelectedRowSet.size() + "] items");	
					...
						page = new EntityActionGroupEditPage(Model.of(myEntityActionGroup), ShipmentOrderMassUpdatePage.this);

 
/ 7	.

/ click + bij Actions op het entityactiongrouppanel	,
/ in EntityActionGroupPanel$6	,
		final AjaxButton addActionButton = new AjaxButton("addButton", new StringResourceModel("add", actionGroupModel)) {
			@Override
			protected void onSubmit(AjaxRequestTarget target, Form<?> form) {
->				actionsModel.getObject().add(new EntityAction(actionGroupModel.getObject()));
				target.addComponent(actionsPanel);
			}
...
		BeanWrapper<BaseDAOInterface<EntityActionType>> entityActionWrapper = new BeanWrapper(EntityActionTypeDAO.class);
		final Collection<EntityActionType> actionTypes = entityActionWrapper.getBean().getAll();
/=drop down list content

EntityActionGroupPanel$5$1.<init>(EntityActionGroupPanel$5, String, IModel, IModel, ListItem, MarkupContainer) line: 185	
		actionsPanel.add(new ListView<EntityAction>("actions", actionsModel) {
			@Override
			protected void populateItem(final ListItem<EntityAction> item) {
				...
->				item.add(new EntityActionEditPanel("actionPanel", item.getModel(), actionTypes) {
/ in actionsModel zit 1 action	, die hierboven is create	, dat is item nu	,
/s
EntityActionGroupPanel$5$2(EntityActionEditPanel).<init>(String, IModel<EntityAction>, Collection<EntityActionType>) line: 134	
/=
	public EntityActionEditPanel(String name, final IModel<EntityAction> entityActionModel, Collection<EntityActionType> actionTypes) {
		List<EntityActionType> actions = new ArrayList<EntityActionType>();
		actions.addAll(actionTypes);
/ Dit is de drop down list	, meegekregen	,
/ Hier staan alle fragments,	

/ 7	. 

/ kies in de dropdownlist een actiontype,	 
/ we vallen in 	,
EntityActionEditPanel$3.onUpdate(AjaxRequestTarget) line: 151	
		dropDownChoice.add(new AjaxFormComponentUpdatingBehavior("onchange") {

			@Override
			protected void onUpdate(AjaxRequestTarget target) {
->				entityActionModel.getObject().clearParameters();
...
/ Daarna vallen we in	,
EntityActionEditPanel$4.populateItem(ListItem<EntityActionParameter<?>>) line: 163	
		parametersPanel.add(new ListView<EntityActionParameter<?>>("parameters", parameters) {
			@Override
			protected void populateItem(final ListItem<EntityActionParameter<?>> item) {
->				Class<?> parameterType = item.getModelObject().getType();
...
				} else if (parameterType == HoldStatus.class) {
					item.add(new HoldStatusFragment(item.getModel()));

/ EntityActionEditPanel heeft de fragments	,

/ Einde OVERZICHT BREAKPOINTS (PNL-313) 

/ 7	. 

/ ACTION PANEL	, ACTION TYPE -> FRAGMENTS

/ In Action Panel, hoe action type -> fragments	,

/ In EntityActionEditPanel	,
		parametersPanel.add(new ListView<EntityActionParameter<?>>("parameters", parameters) {
			@Override
			protected void populateItem(final ListItem<EntityActionParameter<?>> item) {
				Class<?> parameterType = item.getModelObject().getType();
...
/s
EntityAction.getParameters() line: 65	
/=
	public List<EntityActionParameter<?>> getParameters() {
		if (parameters == null) {
			parameters = new LinkedList<EntityActionParameter<?>>();
		}
		if (actionType != null) {
->			actionType.getDefinition(parameters);
/s
EntityActionType.getDefinition(List<EntityActionParameter<?>>) line: 38	
	public ActionTypeDefinition getDefinition(List<EntityActionParameter<?>> parameters) {
		getDefinition();
		definition.setParameters(parameters);
/s
	public void setParameters(List<EntityActionParameter<?>> parameters) {
		this.parameters = parameters;
		index = 0;
		defineParameters();
/s
SetRequestedStartActionType.defineParameters() line: 61	
		startAfterParameter = setParameter(Date.class, "After");
		startAfterParameter.setRequired(true);
		startBeforeParameter = setParameter(Date.class, "Before");
		startBeforeParameter.setRequired(true);

/ Er is ook SetRequestedEndActionType

Added titles to the shipmentordermassupdatepage and the entityactiongroupeditpage. 
Set in the HoldStatus fragment the label translatable. The other fragments have to be refactored first before the labels can be translated as well.
Committed revision 18222.


/ Einde DEBUG PNL-313 PNL-314

/ DEBUG PNL-313

/ action types

/ configuration, mass update, entity action types
/ click create	,
/ dan zien we een drop down list	, met de verschillende action types	, 
/ Waar komen deze vandaan	?

/ configuration, mass update, entity action types
/ we zien EntityActionTypeListPage	,

/ ERICJ TOOD
/ rm <wicket:panel> uit GenericListPanel.html

/ ERICJ TODO 
/ In EntityActionTypeListPage	, 

/ ERICJ TODO 
/ rm <wicket:panel> uit EntityActionTypeListPage.html
/ wat doet wicket:message op createButton (2 keer)?
/  in EntityActionTypeListPage.java, new ResourceModel("edit").wrapOnAssignment	,

EntityActionTypeListPage
BaseContextPage				/ rm .html

EntityActionTypeSearchListPanel
GenericListPanel
BaseWebComponent
Panel

/ 7	.

/ we click op Create	,

EntityActionTypeListPage$1.onSubmit(AjaxRequestTarget, Form<?>) line: 73	
	private void createNewButton() {
	...
			@Override
			protected void onSubmit(AjaxRequestTarget target, Form<?> form) {
	->			EntityActionTypeEditPage page = getEditPage();
/s
EntityActionTypeListPage.getEditPage() line: 47	
	protected EntityActionTypeEditPage getEditPage() {
		if (editPage == null) {
			editPage = new EntityActionTypeEditPage(daoWrapper, this);
/s
EntityActionTypeEditPage.<init>(BeanWrapper<BaseDAOInterface<EntityActionType>>, EntityActionTypeListPage) line: 34	

/ Intermezzo 

$ vi EntityActionTypeEditPage.java

	protected boolean save(IModel<EntityActionType> selection) {
		try {
			daoWrapper.getBean().save(selection.getObject());
			getSession().info(new StringResourceModel("savemessage", EntityActionTypeEditPage.this, selection, "${name} saved").getObject());
/ TODO


/ Einde Intermezzo 

		createPage();
/s
EntityActionTypeEditPage.createPage() line: 65	
		editPanel = new EntityActionTypePanel("editPanel", webComponentEventSwitchBoard, panelBuilder, daoWrapper);
...
/s
EntityActionTypePanel(GenericFormPanel).<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, T, FormActionsPanelBuilder<T>, BeanWrapper<BaseDAOInterface<T>>) line: 70	
		createPanel(new GenericCompountPropertyModel<T>(myObject));
/ myObject is een EntityActionType	,
EntityActionTypePanel(GenericFormPanel).createPanel(GenericCompountPropertyModel<T>) line: 168	
		form = new GenericForm<T>("genericForm", model);
		add(form);
		AbstractActionsPanel<T> actionPanel = getActionsPanel("actionPanel", model);
/ TODO
		form.add(actionPanel);
		setForm(form);
/s
EntityActionTypePanel.setForm(GenericForm<EntityActionType>) line: 75	


/ Intermezzo

public class EntityActionType extends ValueObject implements SoftDeletable {
	private ShipmentOrderAction shipmentOrderAction;

public enum ShipmentOrderAction {
	EXECUTE_SERVICE_ORDER_TRIGGERS(ExecuteServiceOrderTriggerActionType.class),
	SET_AUTHORIZATION_APPROVED(SetAuthorizationApprovedActionType.class),
	SET_HOLD(SetHoldActionType.class),
	SET_REMARK(SetRemarkActionType.class),
	SET_REMARK2(SetRemark2ActionType.class),
	SET_REQUESTED_END(SetRequestedEndActionType.class),
	SET_REQUESTED_START(SetRequestedStartActionType.class),
	SET_SHIP_FROM(SetShipFromPartyActionType.class),
	SET_SHIP_TO(SetShipToPartyActionType.class),
	UPDATE_SCHEDULE(UpdateSchedule.class);

public class SetRequestedStartActionType extends ActionTypeDefinition {
	private EntityActionParameter<Date> startAfterParameter;
	private EntityActionParameter<Date> startBeforeParameter;
	@Override
	protected void defineParameters() {
		startAfterParameter = setParameter(Date.class, "After");
		startBeforeParameter = setParameter(Date.class, "Before");

public class SetAuthorizationApprovedActionType extends ActionTypeDefinition {
	private EntityActionParameter<ApprovalStatus> authorizationApprovedParameter;
	@Override
	protected void defineParameters() {
		authorizationApprovedParameter.setLabel("Approve");

public class SetHoldActionType extends ActionTypeDefinition {
	private EntityActionParameter<HoldStatus> holdStatusParameter;
	@Override
	protected void defineParameters() {
		holdStatusParameter = setParameter(HoldStatus.class);
/ TODO

public class SetRequestedEndActionType extends SetRequestedStartActionType {
	private EntityActionParameter<Date> endAfterParameter;
	private EntityActionParameter<Date> endBeforeParameter;
	@Override
	protected void defineParameters() {
		endAfterParameter = setParameter(Date.class, "After");
		endBeforeParameter = setParameter(Date.class, "Before");

public class SetRemarkActionType extends SetTextActionType {
	protected EntityActionParameter<String> remarkParameter;
	@Override
	protected void defineParameters() {
		remarkParameter = setParameter(String.class, "Value");

public class SetRemark2ActionType extends SetRemarkActionType {
...

public class SetShipFromPartyActionType extends SetShipToPartyActionType {
...

public class SetShipToPartyActionType extends ActionTypeDefinition {
	protected EntityActionParameter<PartyVO> partyParameter;
	@Override
	public String serialize() {
		PartyVO party = partyParameter.getObject();
		return party == null ? "" : party.getCode();
	}
	@Override
	protected void defineParameters() {
		partyParameter = setParameter(PartyVO.class);

/ 7	. 

/ We zien op de EntityActionTypeEditPage de 3 buttons, Save, Save & close, Delete	, naast het EntityActionTypePanel	,

	private Collection<EntityAction<EntityActionType>> getAction() {
		List<EntityAction<EntityActionType>> actions = new ArrayList<EntityAction<EntityActionType>>();
		actions.add(new EntityActionButton<EntityActionType>("ok", new ResourceModel("save")) {
			@Override
			protected void onSubmit(Button aButton, IModel<EntityActionType> selection) {
	->			save(selection);

/ Einde Intermezzo

/ Einde DEBUG PNL-313


/ PNL-313 TITLE GENERICLISTPANEL ENTITYACTIONSEARCHLISTPANEL 


/ Page title op configuration, mass update, entity action types

/ de title zit in het form	,

$ vi GenericListPanel.html

		<form class="genericListPanelForm" wicket:id="filterForm" name="genericListPanelForm" id="genericListPanelForm">
		<wicket:enclosure>
			<h2><div wicket:id="tableTitle" /></h2>
		</wicket:enclosure>


$ vi GenericListPanel.java

		titleLabel = new Label("tableTitle", new PropertyModel<String>(this, "title")) {
		...
/ calls getTitle	,

$ vi EntityActionTypeSearchListPanel.java

	@Override
	public String getTitle() {
		return getModel("entityactiontype").getObject();
	}

$ vi language_en.properties

entityactiontype=Action Type


/ Einde PNL-313 TITLE GENERICLISTPANEL ENTITYACTIONSEARCHLISTPANEL 

/ PNL-314

/ 7	. 

/ configuration, master data, schedules
/ we zien ScheduleListPage	,

$ vi ScheduleListPage.java
		searchListPanel.setPanelBuilder(new EntityListActionBuilder<Schedule>(getPanelAction()));
///////////////////////////////////////////////////////
/ searchListPanel is het panel met alle schedules erop 	, en 3 buttons: edit, copy, delelte, en die staan in getPanelAction(), en komen via .setPanelBuilder in searchListPanel	
/ het is een GenericListPanel	,
	private Collection<EntityAction<Schedule>> getPanelAction() {
		ArrayList<EntityAction<Schedule>> actionList = new ArrayList<EntityAction<Schedule>>();
		EntityActionButton<Schedule> editButton = new EntityActionButton<Schedule>("edit", new ResourceModel("edit").wrapOnAssignment(ScheduleListPage.this)) {
...
		EntityActionButton<Schedule> copyButton = new EntityActionButton<Schedule>("copy", new ResourceModel("copy").wrapOnAssignment(ScheduleListPage.this)) {
...
		EntityActionButton<Schedule> deleteButton = new EntityActionAjaxButton<Schedule>("delete",
...

/ We hebben dus een panel (met alle schedules), en een create button:	,
	createForm.add(new Button("createButton") {

/ we click op Create	,
	protected ScheduleEditPage getEditPage() {
		if (editPage == null) {
			editPage = new ScheduleEditPage(daoWrapper, this);
/s
	public ScheduleEditPage(BeanWrapper<? extends BaseDAOInterface<Schedule>> aDaoWrapper, BaseContextPage basePage) {
		createPage();
/s
	private void createPage() {
		editPanel = new ScheduleEditPanel("editPanel", null, daoWrapper, basePage);
/s

/ we geven continue,	
/s
ScheduleEditPanel.onBeforeRender() line: 102	
	protected void onBeforeRender() {
		Form<Schedule> form = new Form<Schedule>("form", scheduleModel) {
...
		setForm(form);
/s
ScheduleEditPanel.setForm(Form<Schedule>) line: 211	
...
		myEntryPanel = new ScheduleEntryPanel("panel", false, readOnly) {

/ er zijn ScheduleEditPanel.java/.html 

/ en er zijn ScheduleEntryPanel.java/.html	,
/ Hier zitten veel fragments in	,

/ Later	,
ScheduleEntryPanel$RightFragment.onBeforeRender() line: 72	
		protected void onBeforeRender() {
			addOrReplace(getFragment(EXPRESSION_FRAGMENT, markupProvider, model));
/s
ScheduleEditPanel$11(ScheduleEntryPanel).getFragment(String, ScheduleEntryPanel, IModel<DateExpression>) line: 158	
/=
	public MarkupContainer getFragment(String id, final ScheduleEntryPanel markupProvider, IModel<? extends DateExpression> currentModel) {
		DateExpression expression = currentModel.getObject();
		if (expression instanceof Difference) {
/ JA
			return new DifferenceExpressionFragment(id, markupProvider, new Model<Difference>((Difference) expression), readOnly) {
id	"expressionFragment" (id=18144)	
/s
ScheduleEntryPanel$3(DifferenceExpressionFragment).<init>(String, MarkupContainer, IModel<Difference>, boolean) line: 24	
/=
	public DifferenceExpressionFragment(String id, MarkupContainer markupProvider, IModel<Difference> model, boolean readOnly) {
		super(id, "differenceFragment", markupProvider, model);
id	"expressionFragment" (id=18144)	



/ we moeten ScheduleEditPanel.html edit	,
/ In language_en.properties moeten de keys kleine letters hebben	,

/ 7	. 

/ op het schedule edit panel is nog een panel, schedule entry panel, 

/ op de ScheduleEditPanel 
	Name										, add aan form
	...
	Horizon(D)									, add aan form
	myEntrypanel=ScheduleEntryPanel("panel",...					, (panel) add aan form	,
		Included
		Excluded
	lookupWindow =ModalWindow							, add aan form	,	
		modalScheduleEntry=ScheduleEntryPanel("content",...			, (panel) add (eig. setContent) aan lookupWindow	,
			Name text field						/zien we dus op het modal window	,
			Type dropdownlist					/zien we dus op het modal window	,
			

/ we click op Add button achter Included,  dus in ScheduleEntryPanel	,
/ =
UnionFragment$2.onSubmit(AjaxRequestTarget, Form<?>) line: 82	
	@Override
	protected void onBeforeRender() {
		Button addButton = new AjaxButton("addButton") {
			@Override
			protected void onSubmit(AjaxRequestTarget aTarget, Form<?> aForm) {
->				addExpression(aTarget, model);
/s
DifferenceExpressionFragment$1.addExpression(AjaxRequestTarget, IModel<DateExpression>) line: 48	
/=
public abstract class DifferenceExpressionFragment extends Fragment implements DateExpressionListFragment {
	private UnionFragment createUnion(String id, MarkupContainer markupProvider, IModel<Union> model) {
		return new UnionFragment(id, markupProvider, model, readOnly) {
			@Override
			public void addExpression(AjaxRequestTarget aTarget, IModel<? extends DateExpression> model) {
->				DifferenceExpressionFragment.this.addExpression(aTarget, model);
/s
ScheduleEntryPanel$3.addExpression(AjaxRequestTarget, IModel<DateExpression>) line: 162	
public class ScheduleEntryPanel extends Panel {
...
	public MarkupContainer getFragment(String id, final ScheduleEntryPanel markupProvider, IModel<? extends DateExpression> currentModel) {
...
			return new DifferenceExpressionFragment(id, markupProvider, new Model<Difference>((Difference) expression), readOnly) {
				@Override
				public void addExpression(AjaxRequestTarget aTarget, IModel<? extends DateExpression> model) {
->					markupProvider.addExpression(aTarget, model);
/s
ScheduleEditPanel$11.addExpression(AjaxRequestTarget, IModel<DateExpression>) line: 215	
	myEntryPanel = new ScheduleEntryPanel("panel", false, readOnly) {
			@Override
			protected void addExpression(AjaxRequestTarget aTarget, IModel<? extends DateExpression> model) {
model	PropertyModel  (id=19450)	
	expression	"included" (id=19456)	
	target	Model  (id=19448)	
		object	Difference  (id=19429)	
			excluded	Union  (id=19552)	
			included	Union  (id=19558)	
			name	null	
/s
ScheduleEditPanel$12(ScheduleEntryPanel).setCurrentModel(IModel<DateExpression>, IModel<DateExpression>) line: 254	
			if (parentExpression != null && parentExpression instanceof PropertyModel) {
...
					scheduleEntryChoices = loadChoices(type);
[Day In Week]
currentModel	Model  (id=19539)	
scheduleEntryChoices	ArrayList  (id=19619)	
	elementData	Object[10]  (id=19623)	
		[0]	ScheduleEntry  (id=19625)	
			map	HashMap  (id=19697)	
{class com.mpobjects.oms.model.calendar.Difference=Difference, 
class com.mpobjects.oms.model.calendar.RangeEachYear=Range each Year, 
class com.mpobjects.oms.model.calendar.ScheduleLink=Other Schedule, 
class com.mpobjects.oms.model.calendar.DayInMonth=Day in Month, 
class com.mpobjects.oms.model.calendar.DayInWeek=Day In Week, 
class com.mpobjects.oms.model.calendar.WeekdayInMonth=Weekday In Month, 
class com.mpobjects.oms.model.calendar.Intersection=Intersection, 
class com.mpobjects.oms.model.calendar.Union=Union, 
class com.mpobjects.oms.model.calendar.SpecificDay=Specific Day}
/ TODO

/ 7	.

/ In ScheduleEntryPanel zien we 
	new RightFragment 
/ en	,
	getFragment		/ voor alle andere fragments, zoals DifferenceExpressionFragment	,...

/ In schedule entity panel is een wicket:id="right" field	, dit is een RightFragment	, "rightFragment" is de 2de arg in de Fragment ctor, en dat is de wicket:id in de HTML waar het fragment is def	,

/ In ScheduleEntryPanel.html	,
	    <div wicket:id="right" class="inline"></div>
...
  <wicket:fragment wicket:id="rightFragment">
      <div wicket:id="expressionFragment"></div>  
  </wicket:fragment>
 
  <wicket:fragment wicket:id="differenceFragment">
... 

/ wicket:id="expressionFragment" is een DifferenceExpressionFragment bijv	, en 2de arg Fragment ctor is "differenceFragment"	, en die zien we ook als wicket:id in de HTML waar deze fragment is def	,

/ alle fragments staan in 1 HTML, ScheduleEntryPanel.html
/ In Java moet je de MarkupProvider geven waar de HMTL is	, dat is een ScheduleEditPanel	, of die linksonder, of die op het modal window	,
/ TODO ( Hoe dat precies gaat)	,


   

/ 7	. 

/ Lees ticker PNL-237	,

/ op schedule edit panel is linksnder een schedule entry panel met een difference fragment	, 
/ op het modal window is ook een schedule entry panel, en daar kun je verschillende fragments zien , een day in week-fragment of een difference-fragment	,
/ we moeten een property maken in de properties en properties_value tables	, 
/ via GUI	,
configuration, administration, properties	,
create new property
module.oms.schedule.entry.included.difference.hidden	
configuration, administration, properties value	,
create
filter op difference: module.oms.schedule.entry.included.difference.hidden
Value : false

/ Nu hebben we in de dropdownlist in de schedule entry panel 2 mogelijkheden	, kies difference, dan zien we precies hetzelfde als linksonder op de schedule entity panel: 2 unions: included en excluded	,

 






	



/ Einde PNL-314

/ PNL-374 

/ configuration, mass update, entity action types:
/ we komen op een entityactiontypelistpage contains a entityactiontypesearchlistpage

/ click op edit button op een row in deze list	,
/ we maken een entityactiontypeeditpage	, contains an enttyactiontypepanel 


/ configuration, mass update, entity action types:

EntityActionTypeListPage

/s
EntityActionTypeListPage.createPage() line: 84	
		createListPanel();
/s
...

/ we click Create	,
/s
EntityActionTypeListPage$1.onSubmit(AjaxRequestTarget, Form<?>) line: 73	
			protected void onSubmit(AjaxRequestTarget target, Form<?> form) {
				EntityActionTypeEditPage page = getEditPage();
/s
EntityActionTypeListPage.getEditPage() line: 47	
			editPage = new EntityActionTypeEditPage(daoWrapper, this);
/s
EntityActionTypeEditPage.<init>(BeanWrapper<BaseDAOInterface<EntityActionType>>, EntityActionTypeListPage) line: 37	
		createPage();
/s
EntityActionTypeEditPage.createPage() line: 63	
		EntityFormActionBuilder<EntityActionType> panelBuilder = new EntityFormActionBuilder<EntityActionType>(getAction());
/s
	private Collection<EntityAction<EntityActionType>> getAction() {
		List<EntityAction<EntityActionType>> actions = new ArrayList<EntityAction<EntityActionType>>();
		actions.add(new EntityActionButton<EntityActionType>("ok", new ResourceModel("save")) {
		actions.add(new EntityActionButton<EntityActionType>("ok", new ResourceModel("saveAndClose")) {
		EntityActionButton<EntityActionType> cancelButton = new EntityActionButton<EntityActionType>("cancel", new ResourceModel("cancel")) {
...

/ Intermezzo
/ dus de Save, Save and Close and Cancel buttons die we onderaan het panel zien, zien we ook in de rows van de action types , daar edit, delete	,
/ er wordt een EntityActionPanel build met de buttons erop, onderaan een panel, of op iedere row in de list	,
/ want,
/ In EntityFormActionBuilder
	public AbstractActionsPanel<T> build(String aId, GenericCompountPropertyModel<T> aModel, WebComponentEventSwitchBoard aWebComponentEventSwitchBoard,
			GenericFormPanel<T> aParent) {
		return new EntityActionPanel(aId, aParent, aWebComponentEventSwitchBoard, aModel);
/ Einde Intermezzo

		EntityFormActionBuilder<EntityActionType> panelBuilder = new EntityFormActionBuilder<EntityActionType>(getAction());
/d
		editPanel = new EntityActionTypePanel("editPanel", webComponentEventSwitchBoard, panelBuilder, daoWrapper);

//////////////////////////////////////////
/ EntityActionTypePanel is  het hele ding, met de EntityActionPanel onderaan er in, met de 3 buttons	,

/s
EntityActionTypePanel.<init>(String, WebComponentEventSwitchBoard, EntityFormActionBuilder<EntityActionType>, BeanWrapper<BaseDAOInterface<EntityActionType>>) line: 54	
		super(id, null, webComponentEventSwitchBoard, null, panelBuilder, daoWrapper);
/s
EntityActionTypePanel(GenericFormPanel).<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, T, FormActionsPanelBuilder<T>, BeanWrapper<BaseDAOInterface<T>>) line: 52	
			myObject = daoWrapper.getBean().createNewObject();
/ 'n EntityActionType
		createPanel(new GenericCompountPropertyModel<T>(myObject));
/s
EntityActionTypePanel(GenericFormPanel).createPanel(GenericCompountPropertyModel<T>) line: 163	
		form = new GenericForm<T>("genericForm", model);
////////////////////////////////////////////////////////////////////////
/ Dus de model van het form is de new created EntityActionType	inst	,

		AbstractActionsPanel<T> actionPanel = getActionsPanel("actionPanel", model);
/s
		return panelBuilder.build(componentId, model, webComponentEventSwitchBoard, this);
/s
EntityFormActionBuilder.build(String, GenericCompountPropertyModel<T>, WebComponentEventSwitchBoard, GenericFormPanel<T>) line: 37	
		return new EntityActionPanel(aId, aParent, aWebComponentEventSwitchBoard, aModel);
/s
BaseActionBuilder$EntityActionPanel.<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, IModel<T>) line: 31	
			createActions(view, aModel);
/s
EntityFormActionBuilder(BaseActionBuilder).createActions(RepeatingView, IModel<T>) line: 74	
		for (EntityAction<T> action : actions) {
action.label.resourceKey="save"/"saveAndClose"/...
			Component component = action.createComponent(view.newChildId(), aModel);
/s
EntityActionTypeEditPage$1(EntityActionButton).createComponent(String, IModel<T>) line: 49	
		return new EntityABPanel(aComponentId, createButton(aModel, "button"));
/s
EntityActionTypeEditPage$1(AbstractEntityActionButton).createButton(IModel<T>, String) line: 207	
//////////////////////////////////
/ LABELS ON BUTTONS
/s
EntityActionTypeEditPage$1(AbstractEntityActionButton).createButtonInstance(IModel<T>, String) line: 238	
		return new Button(aId) {
/ aId="button"
/t
EntityActionTypeEditPage$1(AbstractEntityActionButton).createButton(IModel<T>, String) line: 207	
		button.setDefaultFormProcessing(isDefaultFormProcessing());
/true
		if (label != null) {
			button.add(new AttributeModifier("title", true, label));
		button.add(lbl);
/ TODO

/t
EntityActionTypePanel(GenericFormPanel).createPanel(GenericCompountPropertyModel<T>) line: 167	
		AbstractActionsPanel<T> actionPanel = getActionsPanel("actionPanel", model);
/d
		setForm(form);
/s
EntityActionTypePanel.setForm(GenericForm<EntityActionType>) line: 84	
...
		IModel<ShipmentOrderAction> actionTypeModel = new PropertyModel<ShipmentOrderAction>(form.getModel(), "shipmentOrderAction");
/form.getModel=model om new EntityActionType	, en nu model om de shipmentOrderAction property daaruit	,
/ We zien in de dropdownlist dus shipmentorderactions	,
		form.add(new DropDownChoice<ShipmentOrderAction>("actionType", actionTypeModel, new ArrayList<ShipmentOrderAction>(Arrays.asList(ShipmentOrderAction.values()))));

/t
EntityActionTypeEditPage.createPage() line: 66	
		editPanel = new EntityActionTypePanel("editPanel", webComponentEventSwitchBoard, panelBuilder, daoWrapper);
/d

/ 7	. 

/ we click edit op row in list	op de entityactiontypelistpage.	,
/s
AbstractEntityActionButton$1.onSubmit() line: 246	
/=
public abstract class AbstractEntityActionButton<T> implements Serializable {
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new Button(aId) {
			@Override
			public void onSubmit() {
->				AbstractEntityActionButton.this.onSubmit(this, aModel);
			}
/s
EntityActionTypeListPage$2.onSubmit(Button, IModel<EntityActionType>) line: 99	
/=
	private Collection<EntityAction<EntityActionType>> getPanelAction() {
...
		EntityActionButton<EntityActionType> editAction = new EntityActionButton<EntityActionType>("edit",
				new ResourceModel("edit").wrapOnAssignment(EntityActionTypeListPage.this)) {
			@Override
			protected void onSubmit(Button aButton, IModel<EntityActionType> aSelection) {
->				EntityActionTypeEditPage page = getEditPage();

/ Klopt dus 	, edit	,
/s
EntityActionTypeListPage.getEditPage() line: 47	
			editPage = new EntityActionTypeEditPage(daoWrapper, this);
/s
		createPage();
/s
EntityActionTypeEditPage.createPage() line: 63	
		editPanel = new EntityActionTypePanel("editPanel", webComponentEventSwitchBoard, panelBuilder, daoWrapper);
/s
	public EntityActionTypePanel(String id, WebComponentEventSwitchBoard webComponentEventSwitchBoard,
			EntityFormActionBuilder<EntityActionType> panelBuilder, BeanWrapper<BaseDAOInterface<EntityActionType>> daoWrapper) {
		super(id, null, webComponentEventSwitchBoard, null, panelBuilder, daoWrapper);
/s
EntityActionTypePanel(GenericFormPanel).<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, T, FormActionsPanelBuilder<T>, BeanWrapper<BaseDAOInterface<T>>) line: 70	

/ T=EntityActionType	,
			myObject = daoWrapper.getBean().createNewObject();
this	EntityActionTypePanel  (id=13765)	
id	"editPanel" (id=13793)	
myObject	EntityActionType  (id=13795)	
	authorizationLevels	HashSet  (id=13796)	
	definition	null	
	deleted	false	
	name	null	
	organization	null	
	performanceMonitorService	null	
	shipmentOrderAction	null	
	systemId	0	

/ Dus shipmentOrderAction is er bij	,

		createPanel(new GenericCompountPropertyModel<T>(myObject));
/s
EntityActionTypePanel(GenericFormPanel).createPanel(GenericCompountPropertyModel<T>) line: 168	
/=
	protected void createPanel(GenericCompountPropertyModel<T> model) {
		form = new GenericForm<T>("genericForm", model);
/s
s	EntityActionTypePanel  (id=13765)	
model	GenericCompountPropertyModel  (id=13808)	
	id	0	
	target	EntityActionType  (id=13795)	
		authorizationLevels	HashSet  (id=13796)	
		definition	null	
		deleted	false	
		name	null	
		organization	null	
		performanceMonitorService	null	
		shipmentOrderAction	null	
		systemId	0	

		setForm(form);
/s
EntityActionTypePanel.setForm(GenericForm<EntityActionType>) line: 75	

/ FIX PNL-374

/ We hebben	,

$ vi EntityActionTypePanel.java

		form.add(new DropDownChoice<ShipmentOrderAction>("shipmentOrderAction", new ArrayList<ShipmentOrderAction>(Arrays.asList(ShipmentOrderAction.values()))));

$ vi EntityActionTypePanel.html

			<td class="label" valign="top">
					<wicket:message key="shipmentOrderAction">Action Type</wicket:message>
				</td>
				<td nowrap="nowrap" class="input" valign="top">
					<select wicket:id="shipmentOrderAction" style="vertical-align:top"></select>

/ Einde FIX PNL-374






/ 7	. 

/ we 3 buttons op de EntityActionTypeEditPage waren create in EntityActionTypeEditPage.java	,

/ we maken een entity action type	,
/ we click create	,
/ we click save	,
/s
AbstractEntityActionButton$1.onSubmit() line: 246	
			public void onSubmit() {
				AbstractEntityActionButton.this.onSubmit(this, aModel);
/s
/ aModel is form's model, een compoundpropertymodel om de new EntityActionType inst 	,

/s
EntityActionTypeEditPage$1.onSubmit(Button, IModel<EntityActionType>) line: 75	
	private Collection<EntityAction<EntityActionType>> getAction() {
		List<EntityAction<EntityActionType>> actions = new ArrayList<EntityAction<EntityActionType>>();
		actions.add(new EntityActionButton<EntityActionType>("ok", new ResourceModel("save")) {
			@Override
			protected void onSubmit(Button aButton, IModel<EntityActionType> selection) {
				save(selection);

/ Dit is de def van 1 van de 3 buttons op de EntityActionTypeEditPage	, (in het begin)	,
/s
EntityActionTypeEditPage.save(IModel<EntityActionType>) line: 46	
			daoWrapper.getBean().save(selection.getObject());
pnloms=# select*from mau_action_type;
 system_id |      name       | organization_systemid |     action_type_definition     | is_deleted 
-----------+-----------------+-----------------------+--------------------------------+------------
  26680606 | HOLD            |                  1000 | SET_HOLD                       |          0
  26681077 | Load Window     |                  1000 | SET_REQUESTED_START            |          0
  26681081 | Remark2 update  |                  1000 | SET_REMARK2                    |          0
  26681001 | Remark update   |                  1000 | SET_REMARK                     |          0
  26681090 | schedule        |                  1000 | UPDATE_SCHEDULE                |          0
  26681080 | Approve Order   |                  1000 | SET_AUTHORIZATION_APPROVED     |          0
  26681091 | sent to carrier |                  1000 | EXECUTE_SERVICE_ORDER_TRIGGERS |          0
  26681092 | set ship from   |                  1000 | SET_SHIP_FROM                  |          0
  26681093 | Set_SHIP_To     |                  1000 | SET_SHIP_TO                    |          0
  26681103 | test            |                  1000 | EXECUTE_SERVICE_ORDER_TRIGGERS |          0
/ We zien hem erbij staan	,

			getSession().info(new StringResourceModel("savemessage", EntityActionTypeEditPage.this, selection, "${name} saved").getObject());
/ TODO

/ 7	.

/ we zien op een row 2 buttons, in zo'n panel	, edit, delete
/ we click edit	,
/ op Load Window	,
/ we zien de shipmentorderaction SET_REQUESTED_START
/s
AbstractEntityActionButton$1.onSubmit() line: 246	
public abstract class AbstractEntityActionButton<T> implements Serializable {
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new Button(aId) {
			@Override
			public void onSubmit() {
->				AbstractEntityActionButton.this.onSubmit(this, aModel);
/////////////////////
/ aModel is een GenericListElementModel extends LoadableDetachableModel, en H. proxy komt in transient obj	,
this	AbstractEntityActionButton$1  (id=16979)	
	val$aModel	GenericListElementModel  (id=17703)	
		transientModelObject	EntityActionType_$$_javassist_91  (id=17871)	
			handler	JavassistLazyInitializer  (id=18260)	
				target	EntityActionType  (id=18282)	
					authorizationLevels	PersistentSet  (id=18285)	
					definition	null	
					deleted	false	
					name	"Load Window" (id=18286)	
					organization	Organization  (id=18287)	
					performanceMonitorService	null	
					shipmentOrderAction	ShipmentOrderAction  (id=18462)	
					systemId	26681077	
/ TODO
/s
EntityActionTypeListPage$2.onSubmit(Button, IModel<EntityActionType>) line: 99	
		EntityActionButton<EntityActionType> editAction = new EntityActionButton<EntityActionType>("edit",
				new ResourceModel("edit").wrapOnAssignment(EntityActionTypeListPage.this)) {
			@Override
			protected void onSubmit(Button aButton, IModel<EntityActionType> aSelection) {
->				EntityActionTypeEditPage page = getEditPage();

////////////////////////////////////
/ de 3 buttons Save, Save and close, Delete worden def op EnttiyActionTypeListPage	,
/ de  buttons Edit, Delete op iedere row worden def op EnttiyActionTypeEditPage	,
/ logisch	,

/s
			editPage = new EntityActionTypeEditPage(daoWrapper, this);
/ gewoon een nieuwe page	,
/t
EntityActionTypeListPage$2.onSubmit(Button, IModel<EntityActionType>) line: 100	
			protected void onSubmit(Button aButton, IModel<EntityActionType> aSelection) {
///////////////
/ aSelection=compoundpropertymodel om de EntityActionType inst	,
				EntityActionTypeEditPage page = getEditPage();
/d
/ gewoon een nieuwe page	,
				page.setEditRecord(aSelection.getObject());
/s
EntityActionTypeEditPage.setEditRecord(EntityActionType) line: 41	
		editPanel.setEditRecord(record);
/s
EntityActionTypePanel.setEditRecord(EntityActionType) line: 63	
		setObject(record);
/ record is H. proxy naar de sel. EntityActionType	,  
/s
EntityActionTypePanel(GenericFormPanel).setObject(T) line: 238	
/////////////////////////////////////////////////////
		form.setModelObject(object);


/t
EntityActionTypeListPage$2.onSubmit(Button, IModel<EntityActionType>) line: 101	
			@Override
			protected void onSubmit(Button aButton, IModel<EntityActionType> aSelection) {
				page.setEditRecord(aSelection.getObject());
/d

/ 7	. 
/ we click Cancel	,
/s
AbstractEntityActionButton$1.onSubmit() line: 246	
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new Button(aId) {
			@Override
			public void onSubmit() {
->				AbstractEntityActionButton.this.onSubmit(this, aModel);
/s
EntityActionTypeEditPage$3.onSubmit(Button, IModel<EntityActionType>) line: 91	
		EntityActionButton<EntityActionType> cancelButton = new EntityActionButton<EntityActionType>("cancel", new ResourceModel("cancel")) {
			@Override
			protected void onSubmit(Button aButton, IModel<EntityActionType> selection) {
				setResponsePage(basePage);
/ basePage=EntityActionTypeListPage	,

/ Hij gaat de list van EntityActionType's opnieuw create	,
/s
GenericListPanel$2.populateItem(Item, String, IModel) line: 285	
/=
		myColumnsList.add(new FilteredAbstractColumn(filterColTitle) {
				myList.add(GenericListPanel.this.createNewListPanel(componentId + "-actions", model));
/ Dit zijn de 2 actions voor de 2 buttons, Edit en Delete	,
/ model=tr model om de EntityActionType inst in de row	,
/s
EntityActionTypeSearchListPanel(GenericListPanel).createNewListPanel(String, IModel<T>) line: 398	
	protected AbstractActionsPanel<T> createNewListPanel(String componentId, IModel<T> model) {
		AbstractActionsPanel<T> myPanel = panelBuilder.build(componentId, webComponentEventSwitchBoard, this, model);
/s
EntityListActionBuilder.build(String, WebComponentEventSwitchBoard, GenericListPanel<T>, IModel<T>) line: 44	
	@Override
	public AbstractActionsPanel<T> build(String aId, WebComponentEventSwitchBoard aWebComponentEventSwitchBoard, GenericListPanel<T> aParent, IModel<T> aModel) {
		return new EntityActionPanel(aId, aParent, aWebComponentEventSwitchBoard, aModel);
/s
BaseActionBuilder$EntityActionPanel.<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, IModel<T>) line: 30	
public class BaseActionBuilder<T extends EntityInterface> implements Serializable {
	protected class EntityActionPanel extends AbstractActionsPanel<T> {
		public EntityActionPanel(String aId, BaseWebComponent aParent, WebComponentEventSwitchBoard aWebComponentEventSwitchBoard, IModel<T> aModel) {
			super(aId, aParent, aWebComponentEventSwitchBoard);
			RepeatingView view = new RepeatingView("actions");
			add(view);
			createActions(view, aModel);
/s
EntityListActionBuilder(BaseActionBuilder).createActions(RepeatingView, IModel<T>) line: 74	
		for (EntityAction<T> action : actions) {

/ this.actions , zitten dus in de bulder	,
/ action.label.resourcekey="edit"/"delete"

			Component component = action.createComponent(view.newChildId(), aModel);
/s
EntityActionTypeListPage$2(EntityActionButton).createComponent(String, IModel<T>) line: 49	
		return new EntityABPanel(aComponentId, createButton(aModel, "button"));
/s
EntityActionTypeListPage$2(AbstractEntityActionButton).createButton(IModel<T>, String) line: 207	

			if (component != null) {
				view.add(component);


/ Nu click we weer Edit op een andere action type	, op HOLD	,



/ Einde PNL-374 

/ DSVMHC-43

/ finance->revenue->customer invoice 

/ we zien dat de entries er al zijn in	,
$ vi customerinvoice-menu.xml

	<m:add path="finance.revenue.customerInvoice.generateInvoices" actionUrl="wicket/?module=customerinvoice&amp;wicketpage=GenerateInvoices"
		privilege="customerinvoiceheader.edit" index="5601" />
	<m:add path="finance.revenue.customerInvoice.searchInvoice" actionUrl="wicket/?module=customerinvoice&amp;wicketpage=header.CIHListPage"
		privilege="customerinvoiceheader.list" index="5602" />
	<m:add path="finance.revenue.customerInvoice.approveInvoices" actionUrl="wicket/?module=customerinvoice&amp;wicketpage=header.CIHApproveListPage"
		privilege="customerinvoiceheader.list" index="5603" />
	<m:add path="finance.revenue.customerInvoice.finalizeInvoices" actionUrl="wicket/?module=customerinvoice&amp;wicketpage=header.CIHFinalizeListPage"
		privilege="customerinvoiceheader.list" index="5604" />

/ Maar de module was nog niet toegevoegd aan dsvcts	,

/ we zien de modules die zijn build in dsvcts	, in 
$ vi dsvcts-build-config.properties

module.document.component=module
module.oms.component=module
module.emailnot.component=module
module.interfacing.component=module
module.interfacing-activemq.component=module
module.tracking.component=module
module.extracking.component=module
module.event.component=module
module.invoice.component=module
module.ratecalc.component=module
module.optimize.component=module
module.dataexport.component=module
module.mpolookandfeel.component=module
module.dsvcts.component=dsvcts
product.interfaces.username = all-admin
product.interfaces.password = admin123@MPO

/ FIX DSVMHC-43

/ Lees	,
https://system.mp-objects.com/jira/browse/SCS-4480
/ over price_type view	,

/ we voegen een module toe	,
module.customerinvoice.component=module

/ patch ERRs	,

/ ga naar	,
http://www.firebirdsql.org/en/reference-manuals/
/ kies	,
http://www.firebirdsql.org/file/documentation/reference_manuals/reference_material/html/langrefupd25.html
/ kies	Table	, onder 6	,
/ we zien alle changes	, alle versies	,

[eric@localhost Firebird]$ pwd
/home/eric/Devel/Firebird
[eric@localhost Firebird]$ sudo cp -a dsvcts.fdb dsvcts.fdb.bak
/ save db	,

/ we zien	,

SQL> show view price_type;
...
View Source:
==== ======
select rct.SYSTEM_ID,rct.CODE,rct.DESCRIPTION,rct.IS_DELETED, rct.REASON_MANDATORY, rct.SEQUENCE_NR from RATE_COMPONENT_TYPE rct 
where rct.RCT_GROUP = 'PRICE'



/ we doen	,
create view price_type as 
select rct.SYSTEM_ID,rct.CODE,rct.DESCRIPTION,rct.IS_DELETED, rct.REASON_MANDATORY, rct.SEQUENCE_NR from RATE_COMPONENT_TYPE rct 
where rct.RCT_GROUP = 'PRICE'
grant all on view_price to public;
/ OK

/ We kunnen	,
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i /home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/2015.01/module/customerinvoice/src/sql/create-tables.sql

/ Maar we maken aparte dir voor deze scripts	,`

/ 7	. 

/ In de customerinvoice module in dsvcts is er create-tables.sql	,
/ we maken eerst zelf een script die deze ongedaan maakt	,

[eric@localhost dsvcts]$ pwd
/home/eric/Devel/Firebird/scripts/dsvcts
[eric@localhost dsvcts]$ ORIG_PATCH_DIR=/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/2015.01/module/customerinvoice/src/sql/patch/

/ 7	.

[eric@localhost dsvcts]$ cp $ORIG_PATCH_DIR/../create-tables.sql patch-0000-create-tables.sql


/ we zien	,
CUSTOMER_INVOICE_HEADER_STATUS
/ ref by	,
CUSTOMER_INVOICE_HEADER
/ ref by	,
CUSTOMER_INVOICE_LINE
/ ref by	,
CUSTOMER_INVOICE_DETAIL

/ Dus als we deze tables willen drop, moeten we omdraaien	,

$ vi patch-0000-create-tables.sql

CREATE TABLE CUSTOMER_INVOICE_HEADER_STATUS(
);
CREATE UNIQUE INDEX PK_CIH_STATUS ON CUSTOMER_INVOICE_HEADER_STATUS(SYSTEM_ID);
CREATE UNIQUE INDEX PK_CIH_STATUS_CODE ON CUSTOMER_INVOICE_HEADER_STATUS(CODE);

CREATE TABLE CUSTOMER_INVOICE_HEADER(
);
CREATE UNIQUE INDEX PK_CI_HEADER ON CUSTOMER_INVOICE_HEADER(SYSTEM_ID);
CREATE UNIQUE INDEX PK_CI_HEADER_NUMBER ON CUSTOMER_INVOICE_HEADER(INVOICE_NUMBER);

CREATE TABLE CUSTOMER_INVOICE_LINE(
);
CREATE UNIQUE INDEX PK_CI_LINE ON CUSTOMER_INVOICE_LINE(SYSTEM_ID);

CREATE TABLE CUSTOMER_INVOICE_DETAIL(
);
CREATE UNIQUE INDEX PK_CI_DETAIL ON CUSTOMER_INVOICE_DETAIL(SYSTEM_ID);

insert into BUSINESS_OBJECT (SYSTEM_ID, NAME, DESCRIPTION) values (GEN_ID(BUSIOBJE_SYSID, 1), 'customerinvoiceheader', 'Customer Invoice Header');
insert into BUSINESS_OBJECT (SYSTEM_ID, NAME, DESCRIPTION) values (GEN_ID(BUSIOBJE_SYSID, 1), 'customerinvoiceheaderstatus', 'Customer Invoice Header Status');
insert into BUSINESS_OBJECT (SYSTEM_ID, NAME, DESCRIPTION) values (GEN_ID(BUSIOBJE_SYSID, 1), 'customerinvoiceline', 'Customer Invoice Line');
insert into BUSINESS_OBJECT (SYSTEM_ID, NAME, DESCRIPTION) values (GEN_ID(BUSIOBJE_SYSID, 1), 'customerinvoicedetail', 'Customer Invoice Detail');


$ vi anti-patch-0000-create-tables.sql

drop INDEX PK_CI_DETAIL;
drop TABLE CUSTOMER_INVOICE_DETAIL;

drop INDEX PK_CI_LINE;
drop TABLE CUSTOMER_INVOICE_LINE;

drop INDEX PK_CI_HEADER;
drop INDEX PK_CI_HEADER_NUMBER;
drop TABLE CUSTOMER_INVOICE_HEADER;

drop INDEX PK_CIH_STATUS;
drop INDEX PK_CIH_STATUS_CODE;
drop TABLE CUSTOMER_INVOICE_HEADER_STATUS;

delete from BUSINESS_OBJECT where name='customerinvoiceheader';
delete from BUSINESS_OBJECT where name='customerinvoiceheaderstatus';
delete from BUSINESS_OBJECT where name='customerinvoiceline';
delete from BUSINESS_OBJECT where name='customerinvoicedetail';


[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/patch-0000-create-tables.sql 
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/anti-patch-0000-create-tables.sql 
...
/ zo vaak je wilt	,
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/patch-0000-create-tables.sql 


/ 7	.

[eric@localhost dsvcts]$ echo  $ORIG_PATCH_DIR
/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/2015.01/module/customerinvoice/src/sql/patch/

[eric@localhost dsvcts]$ cp  $ORIG_PATCH_DIR/patch-0001.sql .

[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/patch-0001.sql 
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/anti-patch-0001.sql 
...
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/patch-0001.sql 

/ 7	.

[eric@localhost dsvcts]$ cp  $ORIG_PATCH_DIR/patch-0002-cil_shipment_order_fk.sql .

/ Deze patch kan RM	,
/ Deze fk is er al	,

/ 7	.

[eric@localhost dsvcts]$ cp  $ORIG_PATCH_DIR/patch-0003-businessobjects.sql .

/ Deze patch kan RM	,
/ Hebben we al in patch-0000

/ we doen patch 1,3

/ 7	.

[eric@localhost dsvcts]$ cp  $ORIG_PATCH_DIR/patch-0004-pricepart-constraint.sql .

[eric@localhost dsvcts]$ vi anti-patch-0004-pricepart-constraint.sql 
alter table CUSTOMER_INVOICE_DETAIL drop CONSTRAINT CID_SHO_PRICE_PART_FK;

/ we doen patch 1,3,4

/ 7	. 

/ we doen op CUSTOMER_INVOICE_DETAIL	, 
AMOUNT                          FLOAT Not Null DEFAULT '0'
/ naar	,
AMOUNT                          DECIMAL(18, 4) Nullable 

AMOUNT_VAT                          FLOAT Not Null DEFAULT '0'
/ naar	,
AMOUNT_VAT                          DECIMAL(18, 4) Nullable 

/ we doen op CUSTOMER_INVOICE_HEADER	,
TOTAL_AMOUNT_EXC_VAT            FLOAT Not Null DEFAULT '0'
/ naar	,
TOTAL_AMOUNT_EXC_VAT            DECIMAL(18, 4) Nullable

TOTAL_AMOUNT_FREE_VAT           FLOAT Not Null DEFAULT '0'
/ naar	,
TOTAL_AMOUNT_FREE_VAT           DECIMAL(18, 4) Nullable 

TOTAL_AMOUNT_HIGH_VAT           FLOAT Not Null DEFAULT '0'
/ naar	,
TOTAL_AMOUNT_HIGH_VAT           DECIMAL(18, 4) Nullable 

TOTAL_AMOUNT_LOW_VAT            FLOAT Not Null DEFAULT '0'
/ naar	,
TOTAL_AMOUNT_LOW_VAT            DECIMAL(18, 4) Nullable 

TOTAL_AMOUNT_REV_VAT            FLOAT Not Null DEFAULT '0'
/ naar	,
TOTAL_AMOUNT_REV_VAT            DECIMAL(18, 4) Nullable 

TOTAL_VAT_HIGH                  FLOAT Not Null DEFAULT '0'
/ naar	,
TOTAL_VAT_HIGH                  DECIMAL(18, 4) Nullable 

TOTAL_VAT_LOW                   FLOAT Not Null DEFAULT '0'
/ naar	,
TOTAL_VAT_LOW                   DECIMAL(18, 4) Nullable 

[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/patch-0005-decimaltype.sql 
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/anti-patch-0005-decimaltype.sql 
...
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/patch-0005-decimaltype.sql 

/ we doen patch 1,3,4,5

/ 7	.

[eric@localhost dsvcts]$ cp  $ORIG_PATCH_DIR/patch-0006-reportforcustomerinvoice.sql .

SQL> select*from report where name='StandardCustomerInvoice';

   SYSTEM_ID NAME                                                                                                 DESCRIPTION                                                                                                                                                                                                                                                     LOCATION                                                                                                                                                                                                                                                        IS_TEST MENU                                                                                                     REPORT_SOURCE REPORT_ID                                      LAST_UPDATE IS_PUBLIC INPUTTYPE                        OUTPUTTYPE                       REPORT_SRC_FILENAME                                                                                  EXCEL_TEMPLATE_FILENAME                                                                                 EXCEL_TEMPLATE INPUT_TYPE                       OUTPUT_TYPE                           INPUT_SOURCE   MENU_INDEX SHOW_ON_EVENT_SCAN 
============ =============================================================================== =============================================================================== =============================================================================== ======= =============================================================================== ================= ================================ ========================= ========= ================================ ================================ =============================================================================== =============================================================================== ================= ================================ ================================ ================= ============ ================== 
       24807 StandardCustomerInvoice                                                                              Customer Invoice                                                                                                                                                                                                                                                /customerinvoice/report/standard_customer_invoice.jrxml                                                                                                                                                                                                               0 <null>                                                                                                            8f:4 standardcustomerinvoice          2012-10-20 00:00:00.0000          0 <null>                           <null>                           <null>                                                                                               <null>                                                                                                          <null> SERVICE_ORDER                    PDF                                         <null>         9999                  0 
==============================================================================
REPORT_SOURCE:  
 
==============================================================================

/ entry in report table is er al	,

/ we maken 
[eric@localhost dsvcts]$ vi anti-patch-0006-reportforcustomerinvoice.sql 


/ we doen patch 1,3,4,5

/ 7	.

[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/patch-0007-customer-invoice_external_invoice_number.sql 
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/anti-patch-0007-customer-invoice_external_invoice_number.sql 
...
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/patch-0007-customer-invoice_external_invoice_number.sql 

/ we doen patch 1,3,4,5,7

/ 7	.

/ Lees	,
http://www.firebirdfaq.org/faq167/

[eric@localhost dsvcts]$ cp  $ORIG_PATCH_DIR/patch-0008-customer-invoice-detail-price-type.sql .

[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/patch-0008-customer-invoice-detail-price-type.sql 
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/anti-patch-0008-customer-invoice-detail-price-type.sql 
...
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/patch-0008-customer-invoice-detail-price-type.sql 

/ we doen patch 1,3,4,5,7,8

/ 7	.

[eric@localhost dsvcts]$ cp  $ORIG_PATCH_DIR/patch-0009-rpt_invoice_lines_view.sql .

/ RM	, 
/ view rpt_invoice_lines is er al	,

/ we doen patch 1,3,4,5,7,8

/ 7	.

[eric@localhost dsvcts]$ cp $ORIG_PATCH_DIR/patch-0010-CIHStatus_cancelled\$firebird.sql .

[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/patch-0010-CIHStatus_cancelled\$firebird.sql 
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/anti-patch-0010-CIHStatus_cancelled\$firebird.sql 
...
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/patch-0010-CIHStatus_cancelled\$firebird.sql 

/ we maken	,
[eric@localhost dsvcts]$ vi anti-patch-0010-CIHStatus_cancelled\$firebird.sql 
delete from CUSTOMER_INVOICE_HEADER_STATUS where code='CANCELLED';

/ we doen patch 1,3,4,5,7,8,10-CIHStatus_cancelled 

/ 7	.

[eric@localhost dsvcts]$ cp $ORIG_PATCH_DIR/patch-0010-CIHStatus_cancelled\$postgresql.sql .
/ TODO

/ 7	.


[eric@localhost dsvcts]$ cp $ORIG_PATCH_DIR/patch-0010-generating-status\$firebird.sql .

[eric@localhost dsvcts]$ vi patch-0010-generating-status\$firebird.sql 
insert into CUSTOMER_INVOICE_HEADER_STATUS (SYSTEM_ID, CODE, DESCRIPTION, IS_DELETED) values (next value for sysid, 'GENERATING', 'Invoice is being generated.', 0);

/ als we deze 2 keer doen	, dan 	,
/ ERR
attempt to store duplicate value (visible to active transactions) in unique index "PK_CIH_STATUS_CODE"
/ TODO (next value for sysid)	,
/ VERG met patch-12, waar GEN_ID(SYSID,1)	,


/ we maken	,
[eric@localhost dsvcts]$ vi anti-patch-0010-generating-status\$firebird.sql 

delete from CUSTOMER_INVOICE_HEADER_STATUS where code='GENERATING';


[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/patch-0010-generating-status\$firebird.sql 
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/anti-patch-0010-generating-status\$firebird.sql 
...
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/patch-0010-generating-status\$firebird.sql 


/ we doen patch 1,3,4,5,7,8,10-CIHStatus_cancelled , 10-generating-status	,

/ 7	.

[eric@localhost dsvcts]$ cp $ORIG_PATCH_DIR/patch-0011-invoice-type.sql .

$ vi patch-0011-invoice-type.sql

ALTER TABLE CUSTOMER_INVOICE_HEADER ADD INVOICE_TYPE VARCHAR(15);
UPDATE CUSTOMER_INVOICE_HEADER SET INVOICE_TYPE = 'INVOICE';

/ TODO (want de table is leeg)	,

[eric@localhost dsvcts]$ vi anti-patch-0011-invoice-type.sql 
ALTER TABLE CUSTOMER_INVOICE_HEADER DROP INVOICE_TYPE;

/ we doen patch 1,3,4,5,7,8,10-CIHStatus_cancelled , 10-generating-status	, 11	,

/ 7	.

$ vi patch-0012-add_pay_to_customer_invoice$firebird.sql

UPDATE CUSTOMER_INVOICE_HEADER_STATUS SET DESCRIPTION='Sent to Customer' WHERE CODE='FINAL';
UPDATE CUSTOMER_INVOICE_HEADER_STATUS SET CODE='SENT_TO_CUSTOMER' WHERE CODE='FINAL';
INSERT INTO CUSTOMER_INVOICE_HEADER_STATUS (SYSTEM_ID,CODE,DESCRIPTION,IS_DELETED) VALUES(GEN_ID(SYSID,1),'PAID','Paid',0);
INSERT INTO CUSTOMER_INVOICE_HEADER_STATUS (SYSTEM_ID,CODE,DESCRIPTION,IS_DELETED) VALUES(GEN_ID(SYSID,1),'PARTIALLY_PAID','Partially Paid',0);

/ De updates doen niets	, want ze zijn er niet	,

/ Als we een insert 2 keer doen	, dan	,
/ ERR 
attempt to store duplicate value (visible to active transactions) in unique index "PK_CIH_STATUS_CODE"
/ TODO 
/ VERGL patch-10-generating hierboven	,

[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/patch-0012-add_pay_to_customer_invoice\$firebird.sql 
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/anti-patch-0012-add_pay_to_customer_invoice\$firebird.sql 
...
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/patch-0012-add_pay_to_customer_invoice\$firebird.sql 

/ we doen patch 1,3,4,5,7,8,10-CIHStatus_cancelled , 10-generating-status	, 11	, 12	,

/ 7	.

[eric@localhost dsvcts]$ cp $ORIG_PATCH_DIR/patch-0013-add_invoice_template.sql .

[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/patch-0013-add_invoice_template.sql 
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/anti-patch-0013-add_invoice_template.sql 
...
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -u sysdba -p masterkey -i scripts/dsvcts/patch-0013-add_invoice_template.sql 

/ we doen patch 1,3,4,5,7,8,10-CIHStatus_cancelled , 10-generating-status	, 11	, 12	, 13	sql-fb dsvcts.fdb -u sysdba -p masterkey -i,

/ 7	. 

/ we doen toch alle patches	,

$ vi ~/bin/all-patches.bash
...
$ vi ~/bin/all-anti-patches.bash

/ we doen	,
[eric@localhost dsvcts]$ all-patches.bash 
[eric@localhost dsvcts]$ all-anti-patches.bash 
/ OK

/ In Eclipse	,
/ create-tables.sql 
/ die inserts into business_object rm	,
/ set alles in patch-0001	, 
/ die inserts into business_object staan als in patch-3	,
...

/ See DataBasePatcher.java	,

/ 7	.

SQL> select*from mpo_scs_patch  where name='patch-0001.sql' and module='customerinvoice';

update mpo_scs_patch  
set sql_script='...'
where name='patch-0001.sql' and module='customerinvoice';

> select name,status from mpo_scs_patch where module='customerinvoice';

> update mpo_scs_patch set status='NOT_APPLIED' where module='customerinvoice';

/ TODO (dsvcts patches met de hand)

/ we doen patch 7 en 8 met de hand	,
eric@mposerv8:/local/apps/firebird$ isql-fb
connect 'mposerv8:/local/apps/firebird/dsvcts.fdb'  user 'SYSDBA' password 'masterkey';

/ 7	.

$ vi PatchStatus.java

public enum PatchStatus {

	/**
	 * The patch was applied successfully
	 */
	APPLIED,
	/**
	 * The patch failed to apply
	 */
	FAILED,
	/**
	 * Patch has been manually applied
	 */
	MANUALLY_APPLIED,
	/**
	 * The patch has not been applied yet
	 */
	NOT_APPLIED,
	/**
	 * A user can choose to skip a patch in case the patch should not be applied in a specific situation
	 */
	SKIPPED,
	/**
	 * No idea
	 */
	UNKNOWN;

/ we set	,
SQL>  update mpo_scs_patch set status='NOT_APPLIED' where module='customerinvoice';
SQL> commit;
> select name,status from mpo_scs_patch where module='customerinvoice';

///////////////////////////////////////////////////////////////////////////////////////////////
SQL>  update mpo_scs_patch set status='NOT_APPLIED' where module='customerinvoice';
[eric@localhost Firebird]$ all-anti-patches.bash 
> create view rpt_invoice_lines as select*from unit;
/ NB. create deze view na all-anti-patches.bash	,
/ start server	,
//////////////////////////////////////////////////////////////////////////////////////////////









/ Einde FIX DSVMHC-43

/ DSVMHC-33

/ Intermezzo

[eric@localhost 2015.01]$ ls
application.properties  carcon     dsvcts  els     jnjedobe  mposcs    pnltms   rollsroyce     terex
base-framework          carconmpo  dsvfms  geodis  module    naccomfg  pom.xml  rollsroyceoms  tntwillebroek
bin                     cevaoms    dsvoms  isbscs  mpo       pnloms    rfsdms   src            wartsila
/ We zien instances	,

[eric@localhost 2015.01]$ ls module/
alliancelookandfeeltwo  contract           demo              graphplan             mpolookandfeel         ratecalc           tracking
app                     crossdock          devtools          interfacing           oms                    scanandprint       wmstracking
authorization           crossdockext       dhlexpressxmlpi   interfacing-activemq  omscarcon              scannerinterface   zebra
capabletopromise        customerinvoice    document          interfacing-tibco     optimize               supplierportal
carconclient            customerportal     emailnot          intertour             pincvisionlookandfeel  supplierquotation
carconserver            customerquotation  event             inventory             preload                tntexpressconnect
cevalookandfeeltwo      dashboard          extracking        invoice               printing               tnticonnection
cevareports             dataexport         fedexshipmanager  massupdate            quoteagreement         tools
/ we zien modules	,

///////////////////////////////////////
/ Er zijn menu's in de modules	, maar ook in de instances	,
/ in de modules	,
[eric@localhost 2015.01]$ ls module/oms/oms-menu.xml 
[eric@localhost 2015.01]$ ls module/customerinvoice/customerinvoice-menu.xml 

/ In de instances	,
[eric@localhost 2015.01]$ ls dsvcts
buildscripts  dsvcts  dsvcts-build-config.properties  dsvcts.properties
[eric@localhost 2015.01]$ ls dsvcts/dsvcts
conf  dsvcts-menu.xml  factory  jboss-root-conf  src  war

/ Einde Intermezzo

/ we add aan dsvcts-menu.xml

	<m:add path="planning.shipmentOrder.massUpdateShipmentOrder" actionUrl="wicket?module=oms&amp;wicketpage=shipmentorder.MassUpdateShipmentOrderListPage" privilege="mass-update-shipment-order.list" index="2085"/> 

/ de module is oms	, is al added aan dsvcts instance	,

/ Maar we zien ERR	,
ava.lang.IndexOutOfBoundsException: Property [module.oms.massupdate.shipmentorder.columndefinition] does not exist
     at com.mpobjects.core.ApplicationPropertyManager.getProperty(ApplicationPropertyManager.java:475)
     at com.mpobjects.core.ApplicationPropertyManager.getModuleProperty(ApplicationPropertyManager.java:333)
     at com.mpobjects.oms.view.wicket.shipmentorder.AbstractShipmentOrderListPage.getColumnDefinition(AbstractShipmentOrderListPage.java:280)
     at com.mpobjects.oms.view.wicket.AbstractObjectListPage.processColumns(AbstractObjectListPage.java:160)
     at com.mpobjects.oms.view.wicket.shipmentorder.MassUpdateShipmentOrderListPage.<init>(MassUpdateShipmentOrderListPage.java:170)

/ We voegen deze property toe	,
configuration, administration, propperties	,
create new property	,
Code: module.oms.massupdate.shipmentorder.columndefinition
Description: ... 
Type : String
Save	,

configuration, administration, propperties values	,
property: module.oms.massupdate.shipmentorder.columndefinition
organization: DSV-MHC	/ TODO (nodig?)
Value: ShipmentOrderId




 

/ Einde DSVMHC-33

/ PNL-378

/ 7	.

$ vi shipment-order_edit.jsp

		<c:forEach var="myShipmentOrderParty" items="${formVO.shipmentOrderParties}">

				<mpo:tab name="${myShipmentOrderParty.partyTypeGroup.code}">
					<tmstags:sho-party party="${myShipmentOrderParty}" />
				</mpo:tab>
			</c:forEach>

/ De 1ste 3 tabs , shipfrom, shipto, billto hebben shipform.tag	, ...
/ De laatste 2 tabs zijn met sho-party.tag create	,


$ vi shipfrom.tag
		<c:if test="${cf:property('oms', copyFromHidden, 'false')=='false'}">
			<td>
				<mpo:setFormVO valueObject="${formVO}">
					<c:if test="${formid=='shipmentorder'}">
						<mpo:dropDownField name="syncFromFlag" showFieldContext="false" required="true">
							<mpo:dropDownOption name="disabled" value="D" />
							<!-- dropDownOption name="template" value="T"  -->
							<mpo:dropDownOption name="partyId" value="P" />
						</mpo:dropDownField>

/ formVO is een ShipmentOrderVO	,  we zoeken in code naar	,
public class ShipmentOrderVO extends LogisticsOrderVO implements CustomerStatusSupport, ReferenceSupport, Authorizable, ImportExportTrackable {
	private String theSyncBillToFlag;

	private String theSyncFromFlag;

	private String theSyncToFlag;

/ Ga op een staan, en click ctrl+alt+h (call hierarchy)	,
setSyncFromFlag(String)
	copyTo(ShipmentOrderVO)
	process(Node)

/ Kies process	,
public class ShipmentOrderBodyProcessor extends XMLProcessor {


/ SETSYNCFLAG
	public ShipmentOrderVO process(Node aNode) throws ShipmentOrderException {

		try {
			ShipmentOrderVO myShipmentOrderVO = ShipmentOrderVOFactory.getShipmentOrderVO();

			myShipmentOrderVO.setSyncToFlag(getSyncFlag("to"));
			myShipmentOrderVO.setSyncFromFlag(getSyncFlag("from"));
			myShipmentOrderVO.setSyncBillToFlag(getSyncFlag("billto"));
/s
	protected static String getSyncFlag(String aType) {
		String myKey = "interface.shipmentorder.sync." + aType + ".flag".toLowerCase();
		return ApplicationPropertyManager.getInstance().getModuleProperty("oms", myKey, PartySyncFlag.DISABLED_CODE);
	}
/ Haalt value uit de properties file	,

/ Deze method wordt called als we een bericht via jms inlezen	,
/ Maar niet als we een sho van een template maken	,

/ we zien bijv in	,
$ vi  dsvfms.properties
module.oms.interface.shipmentorder.sync.billto.flag=P

$ vi naccofmg.properties
module.oms.interface.shipmentorder.sync.from.flag=D
module.oms.interface.shipmentorder.sync.to.flag=D
module.oms.interface.shipmentorder.sync.billto.flag=D

/ 7	.

$ vi mpo.tld

	<tag>
		<name>dropDownField</name>
		<tagclass>com.mpobjects.view.taglib.form.DropDownFieldTag</tagclass>
		<bodycontent>JSP</bodycontent>
		<info>A drop down field</info>
		<attribute>
			<name>name</name>
			<required>true</required>
			<rtexprvalue>true</rtexprvalue>
		</attribute>
		...

	<tag>
		<name>label</name>
		<tagclass>com.mpobjects.view.taglib.LabelTag</tagclass>
		<bodycontent>empty</bodycontent>
		<info>the label tag, to define multilang label</info>

				<mpo:setFormVO valueObject="${formVO}">
/ TODO

$ vi ServiceOrderCreateAction.java

public class ServiceOrderCreateAction extends ActionBase {
	@Override
	public Map act() throws java.lang.Exception {
			if (myVO.getSyncFromFlag().equals("T")) {
				myVO.setSyncFromFlag("D");
			}

			if (myVO.getSyncToFlag().equals("T")) {
				myVO.setSyncToFlag("D");
			}

$ vi ServiceOrderServiceImpl.java

	public ServiceOrderVO buildServiceOrder(ServiceActionVO aServiceAction, ServiceOrderVO aServiceOrderTemplate) {
...
		if (myServiceOrder.getSyncFromFlag() != null) {
			if (myServiceOrder.getSyncFromFlag().equals("P") && myServiceOrder.getToPartyVO() != null


$ vi ShipmentOrderServiceImpl.java

		if (PartySyncFlag.PARTY_ID_CODE.equals(aShipmentOrder.getSyncFromFlag()) && StringUtils.isNotEmpty(myFromPartyCode)) {
...




/ 7	.

/ planning, sho , create
/ we komen op	,
Shipment Order Template
/ kies	,
Emballage breng GVV, click 'Create order'	,

/ Dan zien we bij Laadlocatie, Ontvanger, Bill to
Copy from 
Disabled
/ Moet zijn : Party Id
/ want kies er een	, door select naast Los party	, rm van antwoord Straat	, en click Save sho	, dan wordt de Straat weer filled in , want allen worden filled in 	,

/ 7	.

/ Intermezzo

$ vi shipment-order_edit.jsp

		<mpo:tabCollection name="location" defaultTab="${formVO.shipmentOrderProcess=='INBOUND'?'shipFrom':'shipTo'}">
			<mpo:tabList>
				<mpo:defineTab name="shipFrom" />
				<mpo:defineTab name="shipTo" />
				<mpo:defineTab name="billTo" />
				...
			</mpo:tabList>

			<mpo:tab name="shipFrom">
				<tmstags:shipfrom formid="shipmentorder" />
			</mpo:tab>

$ vi mpo.tld

<taglib>
	<tag>
		<name>tabCollection</name>
		<tagclass>com.mpobjects.view.taglib.tab.TabCollectionTag</tagclass>
		<bodycontent>JSP</bodycontent>
		<attribute> 
			<name>entity</name>
			<required>false</required>
			<rtexprvalue>true</rtexprvalue>
		</attribute>
		<attribute> 
			<name>name</name>
			<required>true</required>
			<rtexprvalue>true</rtexprvalue>
		</attribute>
		<attribute>
			<name>defaultTab</name>
			<required>false</required>
			<rtexprvalue>true</rtexprvalue>
		</attribute>
	</tag>

	<tag>
		<name>tabList</name>
		<tagclass>com.mpobjects.view.taglib.tab.TabListTag</tagclass>
		<bodycontent>JSP</bodycontent>
	</tag>		
	<tag>
		<name>defineTab</name>
		<tagclass>com.mpobjects.view.taglib.tab.DefineTabTag</tagclass>
		<bodycontent>EMPTY</bodycontent>
		<attribute>
			<name>name</name>
			<required>true</required>
			<rtexprvalue>true</rtexprvalue>
		</attribute>
	</tag>		
	<tag>
		<name>tab</name>
		<tagclass>com.mpobjects.view.taglib.tab.TabTag</tagclass>
		<bodycontent>JSP</bodycontent>
		<attribute>
			<name>name</name>
			<required>true</required>
			<rtexprvalue>true</rtexprvalue> 
		</attribute>
	</tag>
</taglib>

$ vi ./base-framework/core/src/java/com/mpobjects/view/taglib/tab/DefineTabTag.java

public class DefineTabTag extends TagBase {
	private String theName;

	@Override
	public int doStartTag() throws JspException {
		TabListTag myParent = (TabListTag) findAncestorWithClass(this, TabListTag.class);
		myParent.addTab(getName());
		return EVAL_PAGE;
	}
	...

$ vi ./base-framework/core/src/java/com/mpobjects/view/taglib/TagBase.java

public abstract class TagBase extends TagSupport {
...
////////////////////////////////////////////////////////////////////
/ Het is javax.servlet.jsp.tagext.TagSupport
/ See LOG_8_sep_2014.txt	,

$ vi shipfrom.tag

/ Einde Intermezzo

/ 7	.

$ vi shipment-order_edit.jsp

<jsp:useBean id="myShipmentOrderView" scope="session" class="com.mpobjects.oms.view.shipmentorder.ShipmentOrderView" />
<%
	ShipmentOrderVO myVO = myShipmentOrderView.getShipmentOrderVO();
	...
	request.setAttribute("formVO", myVO);
	...
%>

		<mpo:tabCollection name="location" defaultTab="${formVO.shipmentOrderProcess=='INBOUND'?'shipFrom':'shipTo'}">
			<mpo:tabList>
				<mpo:defineTab name="shipFrom" />
				<mpo:defineTab name="shipTo" />
				<mpo:defineTab name="billTo" />

$ vi shipfrom.tag

				<mpo:setFormVO valueObject="${formVO}">
					<c:if test="${formid=='shipmentorder'}">
						<mpo:dropDownField name="syncFromFlag" showFieldContext="false" required="true">
							<mpo:dropDownOption name="disabled" value="D" />
							<mpo:dropDownOption name="partyId" value="P" />
						</mpo:dropDownField>

/ we moeten in pnloms.properties 	,
/ of	,
/ in db	, 
configuration, administration	, properties	,
/ def prop	,
configuration, administration	, properties values	,  
/ value prop	, en set organization	, 

/ FIX PNL-378

/ com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO is in module/oms/src/java	, dus in de oms module	, 
/ daarom set we de properties als module.oms....

$ vi pnloms.properties

module.oms.shipmentorder.sync.from.flag=P
module.oms.shipmentorder.sync.to.flag=P
module.oms.shipmentorder.sync.billto.flag=P

$ vi ShipmentOrderCreateAction.java

	protected static String getSyncFlag(String aType) {
		String myKey = "shipmentorder.sync." + aType + ".flag".toLowerCase();
		return ApplicationPropertyManager.getInstance().getModuleProperty("oms", myKey, PartySyncFlag.DISABLED_CODE);
	}

	@Override
	public Map act() throws java.lang.Exception {
		...
		ShipmentOrderVO myVO = MpoBeanFactory.getBean(ShipmentOrderService.class).create(myTemplate);
		...
		myVO.setSyncToFlag(getSyncFlag("to"));
		myVO.setSyncFromFlag(getSyncFlag("from"));
		myVO.setSyncBillToFlag(getSyncFlag("billto"));
		...


/ Bij incheck zien we 1 conflict	, 
/ maar staan los van elkaar	, dus we doen copy right to left	,
/ dan zien we nog steeds een conflict	, doe : marke as merged	.







/ Einde FIX PNL-378

/ Einde PNL-378

/ DEBUG PNL-378

/ we geven	, 
Planning, Shipment order, Create
/ we zien shipment-order-template_list	,

			<map:match pattern="shipment-order-template_list">
				<map:call resource="dynatablePage">
					<map:parameter name="xsp" value="xsp/shipment-order-template_list.xml"/>
					<map:parameter name="xsl" value="xsl/shipment-order-template_list.xsl"/>
				</map:call>


$ vi oms-sitemap.xml

			<map:match pattern="shipment-order-template_list">
				<map:call resource="dynatablePage">
					<map:parameter name="xsp" value="xsp/shipment-order-template_list.xml"/>
					<map:parameter name="xsl" value="xsl/shipment-order-template_list.xsl"/>
				</map:call>
			</map:match>

/ De query van de templates die we zien  is in de xsp	, 
/ er is geen Action class type met een act fct	,

/ Deze Action is er wel bij	,
		<map:match pattern="shipment-order_list">
				<map:act type="shipmentOrderList"/>			
				<map:call resource="dynatablePage">
					<map:parameter name="xsp" value="xsp/shipment-order_list.xml"/>
				</map:call>
			</map:match>
			<map:action logger="shipmentorder" name="shipmentOrderList" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderListAction"/>			

/ 7	.

/ we geven 	,
planning, shipment order, create
/ De query in de xsp in shipment-order-template_list.xml wordt NIET gedaan	, we zien ook geen rows van templates	, 

/ Maar dan click we filter	,
/ Dan wordt de query gedaan	,

/s
	ShipmentOrderView.executeDynaQuery(DynaQuery) line: 51	
/ We hebben MISSCHIEN GEEN b op deze , anders ERR in eclipse	, 
			return getDao().executeDynaQuery(aQuery);

	shipment_order_template_list_xml.generate() line: 536	
    <dynatable:populate>
        <xsp:logic>
			ShipmentOrderView myView = new ShipmentOrderView();
            		Collection myList = myView.executeDynaQuery(myTable.getDynaQuery());
/s
ShipmentOrderDaoImpl.executeDynaQuery(DynaQuery) line: 248	
/ We hebben GEEN b op deze , anders ERR in eclipse	, 
/TODO

		String mySql = aQuery.toSQL();
/ We hebben GEEN b op deze , anders ERR in eclipse	, 

mySql	"SELECT * FROM SHIPMENT_ORDER WHERE IS_TEMPLATE = 1 AND IS_DELETED = 0 AND ORGANIZATION_SYSTEMID IN (0,1010,1000,1) " (id=16753)	

pnloms=# select*from organization;
 system_id | organization_id |               description                | autom_rate_calc | is_deleted | organization_group | sequence 
-----------+-----------------+------------------------------------------+-----------------+------------+--------------------+----------
         1 | SYSTEM          | SYSTEM                                   |               0 |          0 |                    |        0
      1000 | PNL-OMS-GEN     | Post NL Generic                          |               0 |          0 |                    |        0
      1010 | PNL-OMS-DEM     | Post NL Demand                           |               0 |          0 |                    |        0
      1020 | PNL-OMS-DOCK    | People at the loading and unloading dock |               0 |          0 |                    |        0
      1080 | PNL-OMS-AB      | Post NL Autobedrijf                      |               0 |          0 |                    |        0
(5 rows)

		return executeSqlSelect(mySql, "SHO", aQuery.getMaxResultCount());

/ De sho templates zijn ook in de shipment_order tbl, ze hebben column template=1	,

pnloms=# SELECT count(*) FROM SHIPMENT_ORDER WHERE IS_TEMPLATE = 1 AND IS_DELETED = 0 AND ORGANIZATION_SYSTEMID IN (0,1010,1000,1);
 count 
-------
     5
(1 row)

/ click 'create order' op PNL-GVV	,
/ dat is shipment-order_create	,

$ vi oms-sitemao.xmap

			<map:match pattern="shipment-order_create">
				<map:act type="shipmentOrderCreate"/>
				<map:select type="session-attribute">
					<map:parameter name="attribute-name" value="builder"/>
					<map:when test="jsp">
						<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order_edit.jsp"/>

			<map:action logger="shipmentorder" name="shipmentOrderCreate" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderCreateAction"/>

/s
ShipmentOrderCreateAction.act() line: 38	
		int mySystemId = getSystemIdFromRequest();
mySystemId	26674125	

/ Klopt	,
pnloms=# select is_template,shipment_order_id from shipment_order where system_id=26674125;
 is_template | shipment_order_id 
-------------+-------------------
           1 | PNL GVV
(1 row)

			myTemplate = MpoBeanFactory.getBean(ShipmentOrderDao.class).getBySystemId(mySystemId);
myTemplate	ShipmentOrderVO_$$_javassist_133  (id=17286)	
ShipmentOrder: PNL GVV(SystemId:26674125; Org:PNL-OMS-DEM)
/s
ShipmentOrderServiceImpl.create(ShipmentOrderVO, boolean) line: 516	
/=
	@Override
	public ShipmentOrderVO create(ShipmentOrderVO aShipmentOrderTemplate, boolean isTemplate) {
		} else {
			LOG.debug("Copying shipment order template: " + aShipmentOrderTemplate);
			myVO = aShipmentOrderTemplate.copy();
			copyShipmentOrderParties(aShipmentOrderTemplate, myVO);
/s
ShipmentOrderServiceImpl.copyShipmentOrderParties(ShipmentOrderVO, ShipmentOrderVO) line: 492	
			Collection<ShipmentOrderParty> myShipmentOrderParties = anOriginal.getShipmentOrderParties();
/=
		return theShipmentOrderPartyList;
theShipmentOrderPricePartList	PersistentSortedSet  (id=21059)	
[]

/t
ShipmentOrderServiceImpl.create(ShipmentOrderVO, boolean) line: 534	
			Collection<ShipmentOrderParty> myShipmentOrderParties = anOriginal.getShipmentOrderParties();
/d
			EntityDetailUtil.copyCorrespondingEntityDetails(aShipmentOrderTemplate, myVO);
/s
EntityDetailUtil.copyCorrespondingEntityDetails(EntityDetailSupport, EntityDetailSupport) line: 97	
			Map<EntityDetailType, String> myTo = aCopyTo.getEntityDetails();
			for (Entry<EntityDetailType, String> entry : aCopyFrom.getEntityDetails().entrySet()) {
				EntityDetailType myType = entry.getKey();
myType	EntityDetailType_$$_javassist_9  (id=21086)	
SystemId:26674124	IsDeleted:false	Detail Type:trailerBereikbaar	ValueType:BOOLEAN	

				if (myTo.containsKey(myType)) {
					myTo.put(myType, entry.getValue());
SystemId:26674124	IsDeleted:false	Detail Type:trailerBereikbaar	ValueType:BOOLEAN	
SystemId:26673820	IsDeleted:false	Detail Type:procuratiehouder	ValueType:STRING	
SystemId:26673790	IsDeleted:false	Detail Type:losvenstertype	ValueType:LIST	
SystemId:26673491	IsDeleted:false	Detail Type:laadvenstertype	ValueType:LIST	

/t
ShipmentOrderServiceImpl.create(ShipmentOrderVO, boolean) line: 535	
			EntityDetailUtil.copyCorrespondingEntityDetails(aShipmentOrderTemplate, myVO);
/d
			myVO.setSystemId(ValueObject.VOLATILE_SYSTEM_ID);
0
			myVO.setShipmentOrderId("");
			myVO.setShipmentOrderTemplate(aShipmentOrderTemplate);
			myVO.setTemplate(isTemplate);
false

			if (!myResource.getActivatableOrganizationSystemids().contains(myVO.getOrganization().getSystemId())) {
/ NEE

		addShipmentOrderParties(myVO);
/s
ShipmentOrderServiceImpl.addShipmentOrderParties(ShipmentOrderVO) line: 262	
			if (aShipmentOrder.getBillToPartyVO() == null) {
/ NEE
/ hij is er, maar alles is default 0 of ""	,

			if (aShipmentOrder.getEmployeeResponsiblePartyVO() == null) {
/ NEE

			List<PartyTypeGroupVO> myPartyGroupsToCreate = new ArrayList<PartyTypeGroupVO>();
			myPartyGroupsToCreate.addAll(MpoBeanFactory.getBean(PartyTypeGroupDAO.class).getShowOnShipmentOrder());

$ vi PartyTypeGroupVO.standard.hbm.xml
	<class name="PartyTypeGroupVO" table="PARTY_TYPE_GROUP">

pnloms=# select*from party_type_group;
 system_id | party_type_group |   description   | is_deleted | show_on_sho | show_on_so | is_system | show_on_co | show_on_col 
-----------+------------------+-----------------+------------+-------------+------------+-----------+------------+-------------
  26673487 | PREFERRED_PARTY  | PREFERRED_PARTY |          0 |           0 |          0 |         0 |          0 |           0
  26673687 | BILL_TO          | BILL TO         |          0 |           0 |          0 |         0 |          0 |           0
  26678850 | VIA              | VIA             |          0 |           1 |          0 |         0 |          0 |           0
  26674086 | DELIVERY         |                 |          0 |           0 |          0 |         0 |          0 |           0
  26674141 | COLLECTION       |                 |          0 |           0 |          0 |         0 |          0 |           0
  26680439 | Customer         |                 |          0 |           1 |          0 |         0 |          0 |           0

/s
PartyTypeGroupDAOHibernate.getShowOnShipmentOrder() line: 59	
		DetachedCriteria myDetachedCriteria = DetachedCriteria.forClass(PartyTypeGroupVO.class).add(Property.forName("showOnSho").eq(true))
				.add(Property.forName("system").eq(false)).add(Property.forName("deleted").eq(false));
/ we zien	,
select ... 
from PARTY_TYPE_GROUP this_ 
where this_.SHOW_ON_SHO=? 
and this_.IS_SYSTEM=? and this_.IS_DELETED=?
 299801 2015-02-24 14:25:15,895 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-5:) binding parameter [1] as [BI        T] - true
 299803 2015-02-24 14:25:15,896 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-5:) binding parameter [2] as [BI        T] - false
 299805 2015-02-24 14:25:15,897 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-5:) binding parameter [3] as [BI        T] - false

pnloms=# select*from party_type_group;
 system_id | party_type_group |   description   | is_deleted | show_on_sho | show_on_so | is_system | show_on_co | show_on_col 
-----------+------------------+-----------------+------------+-------------+------------+-----------+------------+-------------
  26673487 | PREFERRED_PARTY  | PREFERRED_PARTY |          0 |           0 |          0 |         0 |          0 |           0
  26673687 | BILL_TO          | BILL TO         |          0 |           0 |          0 |         0 |          0 |           0
  26678850 | VIA              | VIA             |          0 |           1 |          0 |         0 |          0 |           0
  26674086 | DELIVERY         |                 |          0 |           0 |          0 |         0 |          0 |           0
  26674141 | COLLECTION       |                 |          0 |           0 |          0 |         0 |          0 |           0
  26680439 | Customer         |                 |          0 |           1 |          0 |         0 |          0 |           0
(6 rows)


/t
ShipmentOrderServiceImpl.addShipmentOrderParties(ShipmentOrderVO) line: 277	
			myPartyGroupsToCreate.addAll(MpoBeanFactory.getBean(PartyTypeGroupDAO.class).getShowOnShipmentOrder());
/d
[theSystemId: 26678850PartyTypeGroup :VIA, theSystemId: 26680439PartyTypeGroup :Customer]

			for (ShipmentOrderParty myParty : aShipmentOrder.getShipmentOrderParties()) {
[]
			for (PartyTypeGroupVO myGroup : myPartyGroupsToCreate) {
				ShipmentOrderParty myShipmentOrderParty = new ShipmentOrderParty();
				myShipmentOrderParty.setPartyTypeGroup(myGroup);
				aShipmentOrder.addShipmentOrderParty(myShipmentOrderParty);
/=
		theShipmentOrderPartyList.add(aShipmentOrderParty);
		aShipmentOrderParty.setShipmentOrder(this);

/t
ShipmentOrderServiceImpl.create(ShipmentOrderVO, boolean) line: 565	
		addShipmentOrderParties(myVO);
/d
myVO
	theShipmentOrderPartyList	ArrayList  (id=25165)	
[com.mpobjects.oms.model.entity.shipmentorderparty.ShipmentOrderParty@1a72d39c[shipmentOrder=ShipmentOrder: (SystemId:0; Org:PNL-OMS-DEM),name=,partyTypeGroup=theSystemId: 26678850PartyTypeGroup :VIA], 
com.mpobjects.oms.model.entity.shipmentorderparty.ShipmentOrderParty@11ed2c77[shipmentOrder=ShipmentOrder: (SystemId:0; Org:PNL-OMS-DEM),name=,partyTypeGroup=theSystemId: 26680439PartyTypeGroup :Customer]]

		MpoBeanFactory.getBean(EntityDetailService.class).initialize(myVO);
/s
EntityDetailServiceImpl.initialize(EntityDetailSupport) line: 125	
/=
	public void initialize(EntityDetailSupport anEntityDetailSupport) {
anEntityDetailSupport	ShipmentOrderVO  (id=21768)	

anEntityDetailSupport	ShipmentOrderVO  (id=21768)	
	entityDetails	HashMap  (id=21805)	
{SystemId:26674124	IsDeleted:false	Detail Type:trailerBereikbaar	ValueType:BOOLEAN	=0, 
SystemId:26673820	IsDeleted:false	Detail Type:procuratiehouder	ValueType:STRING	=, 
SystemId:26673790	IsDeleted:false	Detail Type:losvenstertype	ValueType:LIST	=, 
SystemId:26673491	IsDeleted:false	Detail Type:laadvenstertype	ValueType:LIST	=}
/ Deze komen met het sho template	,

		List<EntityDetailType> myList = getDAO().getByEntity(anEntityDetailSupport.getEntity());
/s
	public EntityType getEntity() {
		return EntityType.SHIPMENT_ORDER;

/ we willen inderdaad SHIPMENT_ORDER	, see beneden	,
/t
/s
EntityDetailTypeDAOImpl.getByEntity(EntityType) line: 37	
/=
	public List<EntityDetailType> getByEntity(EntityType anEntity) {
		List<EntityDetailType> myTypeList = getHibernateTemplate().findByCriteria(
				DetachedCriteria.forClass(EntityDetailType.class).add(Property.forName("entity").eq(anEntity)).add(Property.forName("deleted").eq(false)));

/ we zien	,
select ... 
from ENTITY_DETAIL_TYPE this_ 
where this_.organization_Systemid in (
	select uo.organization_systemid 
	from user_organization uo 	
	where uo.user_systemid = ?) 
	and this_.ENTITY=? and this_.IS_DELETED=?
 352722 2015-02-24 14:39:00,008 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-5:) binding parameter [1] as [INTEGER] - 26681004
 352723 2015-02-24 14:39:00,008 DEBUG [org.hibernate.type.EnumType] (http-0.0.0.0-8080-5:) Binding 'SHIPMENT_ORDER' to parameter: 2
 352725 2015-02-24 14:39:00,009 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-5:) binding parameter [3] as [BIT] - false

/ user_organization is join table tussen users en organization	,
pnloms=# select * from user_organization;
 user_systemid | organization_systemid | is_active | is_active_allowed 
---------------+-----------------------+-----------+-------------------
      26673330 |                  1010 |         1 |                 1
...


select uo.organization_systemid 
from user_organization uo 	
where uo.user_systemid = ?) 

pnloms=# select * from user_organization where user_systemid=26681004;
 user_systemid | organization_systemid | is_active | is_active_allowed 
---------------+-----------------------+-----------+-------------------
      26681004 |                  1010 |         0 |                 1
      26681004 |                  1000 |         1 |                 1
      26681004 |                     1 |         0 |                 1
(3 rows)
pnloms=# select o.organization_id,o.description from user_organization uo join organization o on uo.organization_systemid=o.system_id where user_systemid=26681004;
 organization_id |   description   
-----------------+-----------------
 PNL-OMS-DEM     | Post NL Demand
 PNL-OMS-GEN     | Post NL Generic
 SYSTEM          | SYSTEM
(3 rows)


select * 
from ENTITY_DETAIL_TYPE this_ 
where this_.organization_Systemid in (1010,1000,1) 
and this_.ENTITY='SHIPMENT_ORDER' 
and this_.IS_DELETED=false 

/t
EntityDetailServiceImpl.initialize(EntityDetailSupport) line: 130	
		List<EntityDetailType> myList = getDAO().getByEntity(anEntityDetailSupport.getEntity());
/d
[SystemId:26673491	IsDeleted:false	Detail Type:laadvenstertype	ValueType:LIST	, 
SystemId:26673790	IsDeleted:false	Detail Type:losvenstertype	ValueType:LIST	, 
SystemId:26674124	IsDeleted:false	Detail Type:trailerBereikbaar	ValueType:BOOLEAN	, 
SystemId:26673820	IsDeleted:false	Detail Type:procuratiehouder	ValueType:STRING	, 
/ Deze zitten al in het sho template	,
SystemId:26674127	IsDeleted:false	Detail Type:noValidationRequired	ValueType:BOOLEAN	, 
SystemId:26678883	IsDeleted:false	Detail Type:handlingTijd	ValueType:STRING	, 
SystemId:26680301	IsDeleted:false	Detail Type:SCS	ValueType:STRING	]
/ TODO
/ Er is er 1 NIET	,
  26680314 |          0 | itemRemarks          | STRING     | SHIPMENT_ITEM  |                  1000 | EDIT      | 25     |    1 |        0 |            |            
    |       26680313
/ Klopt, see boven	, 

		if (anEntityDetailSupport.getEntityDetails() != null) {
/ JA
			myList.removeAll(anEntityDetailSupport.getEntityDetails().keySet());
[SystemId:26674127	IsDeleted:false	Detail Type:noValidationRequired	ValueType:BOOLEAN	, 
SystemId:26678883	IsDeleted:false	Detail Type:handlingTijd	ValueType:STRING	, 
SystemId:26680301	IsDeleted:false	Detail Type:SCS	ValueType:STRING	]
/ De overige	,

		for (EntityDetailType myEntityDetailType : myList) {
			anEntityDetailSupport.setEntityDetail(myEntityDetailType, spaceAsInitialValue ? " " : "");

/t
ShipmentOrderServiceImpl.create(ShipmentOrderVO, boolean) line: 570	
		MpoBeanFactory.getBean(EntityDetailService.class).initialize(myVO);
/d
		myVO.setCreatedBy(myResource);
/=
	theCreatedBy=...

		myVO.setOrderStatusVO(MpoBeanFactory.getBean(OrderStatusDAO.class).getByCode(OrderStatusVO.STATUS_UNPLANNED));

pnloms=# select*from order_status;
 system_id | is_deleted | status_code | status_type |         status_description         
-----------+------------+-------------+-------------+------------------------------------
         1 |          0 | 9000        | ENDED       | FINISHED
         2 |          0 | 8000        | STARTED     | STARTED
        28 |          0 | 1450        | PLANNED     | PLANNED
...
(35 rows)

		ScheduleLineService myScheduleLineService = MpoBeanFactory.getBean(ScheduleLineService.class);

		ShipmentServiceLevelVO myServiceLevel = myVO.getActualServiceLevelVO();
null

		} else {
			String myReqStartDateOffset = ApplicationPropertyManager.getInstance().getModuleProperty("oms","view.shipmentorder.requested.start.date.after.offset");
/s
ApplicationPropertyManager.getProperty(String, String) line: 520	
		if (myResource != null) {
			myReturnValue = myResource.getProperty(aKey);
null
			if (myReturnValue == null) {
				myReturnValue = getDatabaseProperty(aKey, null);
null
/ in properties table in pnloms db	,

		if (myReturnValue == null) {
			myReturnValue = getApplicationProperty(aKey, aDefaultValue);
/s
	public String getApplicationProperty(String aKey, String aDefaultValue) {
		return theProperties.getProperty(aKey, aDefaultValue);
"0"
/ want 
$ vi oms.properties

# Default start and end dates for the shipment order in days, negative numbers may be used as well
module.oms.view.shipmentorder.requested.start.date.after.offset = 0
module.oms.view.shipmentorder.requested.end.date.after.offset = 3

/t
ShipmentOrderServiceImpl.create(ShipmentOrderVO, boolean) line: 601	
			String myReqStartDateOffset = ApplicationPropertyManager.getInstance().getModuleProperty("oms","view.shipmentorder.requested.start.date.after.offset");
/d
"0"
			String myReqEndDateOffset = ApplicationPropertyManager.getInstance().getModuleProperty("oms", "view.shipmentorder.requested.end.date.after.offset");
"1"

/ Want	,
$ vi pnloms.properties
...
module.oms.view.shipmentorder.requested.end.date.after.offset = 1

			if (StringUtils.isNotEmpty(myReqStartDateOffset)) {
/ JA
				int myOffSet = Integer.parseInt(myReqStartDateOffset);
0
				Calendar myCalendar = Calendar.getInstance(timeService.getTimeZone(myVO.getOrganization()));
				myCalendar.setTime(timeService.getPresentDate(myVO.getOrganization()));
				myCalendar.add(Calendar.DATE, myOffSet);
				myVO.getDateSetVO().setRequestedStartAfter(myCalendar.getTime());
				myVO.getDateSetVO().setRequestedStartBefore(myCalendar.getTime());

			if (StringUtils.isNotEmpty(myReqEndDateOffset)) {
				int myOffSet = Integer.parseInt(myReqEndDateOffset);
1
				Calendar myCalendar = Calendar.getInstance(timeService.getTimeZone(myVO.getOrganizationVO()));
				myCalendar.setTime(timeService.getPresentDate(myVO.getOrganizationVO()));
				myCalendar.add(Calendar.DATE, myOffSet);
				myVO.getDateSetVO().setRequestedEndAfter(myCalendar.getTime());
				myVO.getDateSetVO().setRequestedEndBefore(myCalendar.getTime());

		// Setting the order process
		if (myVO.getOrderProcess() == null) {
/ NEE	,
/ OUTBOUND

		if (myVO.getSystemId() == ValueObject.VOLATILE_SYSTEM_ID) {
/ JA
0
			String defaultIncoTerm = ApplicationPropertyManager.getInstance().getProperty("module.oms.shipmentorder.default.incoterm", "");
""
			if (!StringUtils.isEmpty(defaultIncoTerm)) {
/ NEE

		return myVO;
/t
ShipmentOrderCreateAction.act() line: 49	
		ShipmentOrderVO myVO = MpoBeanFactory.getBean(ShipmentOrderService.class).create(myTemplate);
/d
		Session mySession = myRequest.getSession();
		mySession.setAttribute(ShipmentOrderView.ACTIVE_SHIPMENTORDER, myVO);

		String showCustomerOrderId = ApplicationPropertyManager.getInstance().getModuleProperty("oms", "productitem.showcustomerorderid", null);
"false"

$ vi pnloms.properties 
module.oms.productitem.showcustomerorderid=false

		getRequest().setAttribute("hasCustomerOrderId", BooleanUtils.isTrue(showCustomerOrderId));

		ProductItemVO myProductItemVO = (ProductItemVO) VOFactory.getValueObject(ProductItemVO.class);

		MpoBeanFactory.getBean(EntityDetailService.class).initialize(myVO);
/ Laat myVO.entityDetails onveranderd	,
/ Hij queries weer de db tbl op 'SHIPMENT_ORDER'	, en haalt eraf die hij al heeft, maar dat zijn precies deze nu	(de 1ste keer waren dat de 4 uit de sho tpl, en toen voegde hij de overigen toe WH TODO)

		MpoBeanFactory.getBean(EntityDetailService.class).initialize(myProductItemVO);
/s
EntityDetailServiceImpl.initialize(EntityDetailSupport) line: 125	
		List<EntityDetailType> myList = getDAO().getByEntity(anEntityDetailSupport.getEntity());
anEntityDetailSupport.getEntity()='PRODUCT_ITEM'	,
[]
		if (myList.isEmpty()) {
			return;

/t
ShipmentOrderCreateAction.act() line: 66	
		MpoBeanFactory.getBean(EntityDetailService.class).initialize(myProductItemVO);
/d
{}
		getSession().setAttribute(ShipmentItemView.ACTIVE_SHIPMENTITEM, myShipmentItemVO);
		getSession().setAttribute("productItemVO", myProductItemVO);
		getSession().setAttribute("builder", ShipmentOrderUtil.getBuilder(myVO));
/s
ShipmentOrderUtil.getBuilder(ShipmentOrderVO) line: 28	
		String myClass = "jsp";
		// Select the screen
		String myProperty = ApplicationPropertyManager.getInstance().getOrganizationProperty(aShipmentOrder.getOrganization(), "module.oms.shipmentorder.edit.screen.builder", myClass);
/s
ApplicationPropertyManager.getOrganizationProperty(Organization, String, String) line: 432	
			return getProperty(anOrganization.getSystemId(), aKey, aDefaultValue);
anOrganization: SystemId:1010	Id:PNL-OMS-DEM	Description:Post NL Demand
/s
ApplicationPropertyManager.getProperty(int, String, String) line: 450	
			myRet = getOrganizationProperty(aPreferedOrganizationSystemid, aPropertyKey, NOTSET, true);
/s
ApplicationPropertyManager.getOrganizationProperty(int, String, String, boolean) line: 385	
/=
	public String getOrganizationProperty(int anOrganizationSystemid, String aPropertyKey, String aDefaultValue, boolean aThrowException) {
anOrganizationSystemid	1010	
aPropertyKey	"module.oms.shipmentorder.edit.screen.builder" (id=17659)	
aDefaultValue	"notset" (id=17734)	
		if (myResource != null) {
			for (Organization myResourceOrganization : myResource.getOrganizations()) {
				if (myResourceOrganization.getSystemId() == anOrganizationSystemid) {
					myOrganization = myResourceOrganization;
/ JA

		String myRet = myOrganization.getProperty(aPropertyKey, aDefaultValue);
aPropertyKey	"module.oms.shipmentorder.edit.screen.builder" (id=17659)	
aDefaultValue	"notset" (id=17734)	
/s
Organization.getProperty(String, String) line: 112	
		PropertiesValueVO prop = mappedProperties.get(aProperty);
null
/ want	,
/ de org heeft dus mapped properties	, 1 property	,
{module.oms.recurring.shipmentorder.schedule.horizon.hours=com.mpobjects.oms.model.propertiesvalue.vo.PropertiesValueVO@6c462d1[systemId=26680240,property=module.oms.recurring.shipmentorder.schedule.horizon.hours - recurring.shipmentorder.schedule.horizon.hours/false,value=72]}

		return aDefaultValue;
/t
ApplicationPropertyManager.getProperty(int, String, String) line: 456	
			myRet = getOrganizationProperty(aPreferedOrganizationSystemid, aPropertyKey, NOTSET, true);
/d
"notset"
			myRet = getDatabaseProperty(aPropertyKey, NOTSET);
"notset"
			myRet = getApplicationProperty(aPropertyKey, aDefaultValue);
"jsp"
/ want dat is de aDefaultValue

/t
ShipmentOrderUtil.getBuilder(ShipmentOrderVO) line: 31	
		String myProperty = ApplicationPropertyManager.getInstance().getOrganizationProperty(aShipmentOrder.getOrganization(),
				"module.oms.shipmentorder.edit.screen.builder", myClass);
/d
"jsp"
		if (!StringUtils.isEmpty(myProperty)) {
			myClass = myProperty;
"jsp"
		return myClass;


























/ Einde DEBUG PNL-378

/ PNL-344

$ vi FieldTag.java

	protected void handleOverridable() {
		if (isOverRideable()) {
			String myRequiredPropertyValue = checkForPropertyOverwrites(getName(), "required");
			if (myRequiredPropertyValue != null) {
				setRequired(BooleanUtils.isTrue(myRequiredPropertyValue));
			}

$ vi shipment-order_edit.jsp
						<mpo:listField name="orderProcess" type="orderProcess" overRideable="true" required="false"/>

$ vi ProductItemVO.java

	private String theDescription
/ click ctrl+alt+h
/ we zien de fct die theDescription  iets mee doen: null pointer exception	?







/ Einde PNL-344

/ DEBUG PNL-344

/ 7	.


$ vi mpo.tld
<taglib>
	<tlibversion>1.0</tlibversion>
	<jspversion>2.0</jspversion>
	<shortname>mt</shortname>
	<uri>http://www.mp-objects.com/taglibs/mpo</uri>
	    ...
	    <tag>
		<name>tab</name>
		<tagclass>com.mpobjects.view.taglib.tab.TabTag</tagclass>
		<bodycontent>JSP</bodycontent>
	    ...
	    <tag>
		...
		<name>label</name>
		<tagclass>com.mpobjects.view.taglib.LabelTag</tagclass>
		<bodycontent>empty</bodycontent>
		<attribute>
			...

/ we geven de uri in de tld zelf op	, niet de binding tussen de tld en de uri in web.xml	,


/ 7	.

$ vi shipment-order_edit.jsp

<%@taglib prefix="cf" uri="/WEB-INF/tld/core-functions.tld"%>
<%@taglib prefix="tmstags" tagdir="/WEB-INF/tags/oms/"%>
<%@taglib prefix="mpo" uri="http://www.mp-objects.com/taglibs/mpo"%>

				<c:if test="${cf:property('oms', 'shipmentorder.hide.productitems', 'false')=='false'}">
					<mpo:tab name="productItems">
						<tmstags:sho-productitems />
					</mpo:tab>
				</c:if>

/ 13	. 

$ vi core-functions.tld
...
<function>
	<name>property</name>
    	<function-class>com.mpobjects.core.ApplicationPropertyManager</function-class>
    	<function-signature>
        	java.lang.String  taglibGetProperty(java.lang.String,java.lang.String,java.lang.String)
    	</function-signature>
</function>

$ vi AppplicationPropertyManager.java 
	public static String taglibGetProperty(String aModule, String aKey, String aDefaultValue) {
		return getInstance().getModuleProperty(aModule, aKey, aDefaultValue);
	}

/ Dus gewoon .getModuleProperty	,

/ 13	. 

/ shipment-order_edit.jsp is in oms module, dus daar moeten we kijken voor WEB-INF	,
[eric@localhost trunk]$ ls ./module/oms/war/WEB-INF/tags/oms/
...
party-group-query-type.tag          sho-productitems.tag                tab-sa-serviceactions.tag
/ Klopt	,

/ TODO (dit zijn JSP's	, kunnen we dit ook?, wij used alleen Java class types)

/ 7	.

$ vi sho-productitems.tag

<%@taglib prefix="mpo" uri="http://www.mp-objects.com/taglibs/mpo"%>
				<th><mpo:label name="description" entity="productitem" /></th>


/ 7	.

$ vi sho-productitems.tag

	<div id="productItemForm" class="${productItemVO.systemId==0 && !empty(formVO.productItemList)?'hidden':''}">

		<mpo:setFormVO valueObject="${productItemVO}" prefix="productItem">

			<div style="height: 330px">
				<mpo:tabCollection name="product-item" defaultTab="productItem">

/ we zien	,
	<div id="productItemForm">
		...
		<div id="product-itemTabCollection" class="tabCollection">

$ vi mpo.tld
	<tag>
		<name>tabCollection</name>
		<tagclass>com.mpobjects.view.taglib.tab.TabCollectionTag</tagclass>
		<bodycontent>JSP</bodycontent>
	<tag>
		<name>setFormVO</name>
		<tagclass>com.mpobjects.view.taglib.form.SetFormVOTag</tagclass>
		<bodycontent>JSP</bodycontent>


$ vi TabCollectionTag.java
	@Override
	public int doStartTag() {
		String myId = getName() + "TabCollection";

		StringBuffer myRet = new StringBuffer();

		myRet.append("<div ");
		myRet.append(" id=\"" + myId + "\" ");
		myRet.append(" class=\"tabCollection\"");
		myRet.append(">");
		printLn(myRet);

		return EVAL_BODY_INCLUDE;
	}


/ Wat doet <mpo:setFormVO>	?
/ TODO

/ 7	.

/ Nu naar het field	,

$ vi sho-productitem.tag

					<mpo:tab name="productItem">
						<table>
							....
							<tr>
								<mpo:numberField name="systemId" type="int" readOnly="true" hidden="true" />
/ 			(*)
									<table>
										<c:if test="${cf:property('oms', 'customerorder.lookup.fields.hidden', 'true')=='false'}">
/ 			JA
											<mpo:listField name="product" type="product" populate="productId" />
											<mpo:field name="productId" hidden="true" />
											<mpo:listField name="customerOrderLine" type="customerOrderLine" />
											<mpo:numberField name="customerOrderLineSystemId" type="int" hidden="true" />
										</c:if>
										<c:if test="${cf:property('oms', 'customerorder.lookup.fields.hidden', 'true')=='true'}">
											<mpo:field name="productId" hidden="true" />
										</c:if>
										<mpo:field languageKey="productitem.description" name="description" required="true" />
										<mpo:numberField name="quantity" minValue="0.1" type="float" required="true" />
										<mpo:numberField name="actualQuantity" minValue="0" type="float" />


/ ad (*)
$ vi mpo.tld
	<tag>
		<name>numberField</name>
		<tagclass>com.mpobjects.view.taglib.form.NumberFieldTag</tagclass>
/ we zien	,
	<input type="hidden" name="productItemSystemId" id="productItemSystemId" value="0">

/ In FieldTag : prefix en name	, prefix moet ...
/ TODO   

/ we edit, niet in Eclipse, maar in JBoss	, (later ook in Eclipse)	,

[eric@localhost pnloms]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms
$ vim ./deploy/tms.war/WEB-INF/tags/oms/sho-productitems.tag
                 <mpo:field languageKey="productitem.description" name="description" required="true" overRideable="true"/>

[eric@localhost pnloms]$ vim conf/application.properties 
module.oms.shipmentorder.description.required=false

/ 7	.

/ we edit een shipment order	,

/ in sho-productitem.tag	,
		<mpo:field languageKey="productitem.description" name="description" required="true" />

/ we zien dat name "descrption" is	,

/ we maken een conditional breakpoints	,
/ maak breakpoint, right click , en kies in contextual menu 'breakpoint properties'	, 
this.name.equals("description")
/ dan stop hij alleen in het b als dit zo is	,
/s
FieldTag.handleOverridable() line: 1179	
this	FieldTag  (id=18397)	
	class$javax$servlet$jsp$tagext$Tag	Class (javax.servlet.jsp.tagext.Tag) (id=4455)	
	activeValueObjectHolder	SetFormVOTag  (id=18400)	
	content	null	
	DECIMAL_GROUPING_SEPERATOR	"," (id=16401)	
	DECIMAL_SYMBOL	"." (id=16402)	
	disabled	"" (id=16781)	
	errorManager	null	
	FALSE	"false" (id=18404)	
	fieldOwnerType	"form" (id=18406)	
	filter	"" (id=16781)	
	id	null	
	infoValue	"" (id=16781)	
	infoVisible	false	
	isHidden	false	
	isOverRideable	true	
	isPrefixSpecifiedForField	false	
	isUnique	false	
	isValid	true	
	languageKey	"productitem.description" (id=18417)	
	maxLength	250	
	name	"description" (id=18420)	
	pageContext	JspContextWrapper  (id=18422)	
	parent	TabTag  (id=18424)	
	pefix	"productItem" (id=18431)	
	readOnly	"" (id=16781)	
	readOnlySet	false	
	required	true	
	showFieldContext	true	
	size	20	
	theActiveValueObject	null	

/s
FieldTag.checkForPropertyOverwrites(String, String) line: 225	
	if (isOverRideable()) {
		String myHiddenPropertyValue = checkForPropertyOverwrites(getName(), "hidden");
		String myPropertyPrefix = getPropertyPrefix(aFieldName);
		...
		String myRequiredPropertyValue = checkForPropertyOverwrites(getName(), "required");
		...
		String myReadOnlyPropertyValue = checkForPropertyOverwrites(getName(), "readonly");
		...
		String myMaxLengthPropertyValue = checkForPropertyOverwrites(getName(), "maxlength");
		...

/ we zijn in	,
FieldTag.
	@Override
	public int doStartTag() throws JspException {
		if (isFieldContextForm()) {
->			handleOverridable();

/ Eerst	,
		String myHiddenPropertyValue = checkForPropertyOverwrites(getName(), "hidden");
/ getName()="description"
/s
FieldTag.checkForPropertyOverwrites(String, String) line: 225	
		String myPropertyPrefix = getPropertyPrefix(aFieldName);
aFieldName="description"
/s
FieldTag.getPropertyPrefix(String) line: 500	
/=
	public String getPropertyPrefix(String aFieldName) {
		return ("module." + EntityActionUtil.getModule(getRequest()) + "." + getFieldOwner().getEntity() + "." + aFieldName + ".").toLowerCase();
module.oms.shipmentOrder.description.
/s
FieldTag.getRequest() line: 525	
		return getFieldOwner().getRequest();
/s
FieldTag.getFieldOwner() line: 1087	
		return getActiveValueObjectHolder().getFieldOwner();
getActiveValueObjectHolder()=com.mpobjects.view.taglib.form.SetFormVOTag@222fa760
getActiveValueObjectHolder().getFieldOwner()=com.mpobjects.view.taglib.form.FormTag@2b713895

/s
FieldTag.getActiveValueObjectHolder
/= this.activeValueObjectHolder, this=FieldTag	,
/t
/s
SetFormVOTag.getFieldOwner() line: 142	
		return getForm();
/=
this.formTag

/t
FieldTag.getRequest() line: 525	
		return getFieldOwner().getRequest();
/t
	public String getPropertyPrefix(String aFieldName) {
		return ("module." + EntityActionUtil.getModule(getRequest()) + "." + getFieldOwner().getEntity() + "." + aFieldName + ".").toLowerCase();

/ getRequest()=org.apache.cocoon.components.jsp.JSPEngineServletRequest@1123e9cd
/s
EntityActionUtil.getModule(HttpServletRequest) line: 83	
		String myUrlParts[] = aRequest.getRequestURI().split("/");
aRequest	JSPEngineServletRequest  (id=19558)	
myUrlParts	String[4]  (id=19565)	
	[0]	"" (id=19566)	
	[1]	"tms" (id=19567)	
	[2]	"oms" (id=19568)	
	[3]	"shipment-order_edit" (id=19569)	
		String myCurrentModule = myUrlParts[myUrlParts.length - 2];
oms

/ Intermezzo

/ Als we de edit button right click en kiezen 'open in new tab', dan zien we	,
https://test-scs.mp-objects.com/pnloms/oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=26680261&systemId=26680261
/ Vergl met "" en "tms"	,
/ TODO

/ Einde Intermezzo

/t
	public String getPropertyPrefix(String aFieldName) {
		return ("module." + EntityActionUtil.getModule(getRequest()) + "." + getFieldOwner().getEntity() + "." + aFieldName + ".").toLowerCase();
getFieldOwner().getEntity()="shipmentOrder"

/t
	public String checkForPropertyOverwrites(String aFieldName, String anAtrribute) {

		String myPropertyPrefix = getPropertyPrefix(aFieldName);
/d
module.oms.shipmentorder.description.

		String myTagProperty = myPropertyPrefix + anAtrribute;
module.oms.shipmentorder.description.hidden

		return getProperty(myTagProperty, null);
/s
pnloms=# select*from properties where property_name like '%module.oms.shipmentorder.description.%';
 system_id | is_deleted | property_name | property_type | mandatory | is_visible | description 
-----------+------------+---------------+---------------+-----------+------------+-------------
(0 rows)

/ we zien alleen in rollsroyce.properties
module.oms.shipmentorder.description.hidden=true

/t
FieldTag.handleOverridable() line: 1180	
			String myHiddenPropertyValue = checkForPropertyOverwrites(getName(), "hidden");
null
			String myRequiredPropertyValue = checkForPropertyOverwrites(getName(), "required");
false
			if (myRequiredPropertyValue != null) {
				setRequired(BooleanUtils.isTrue(myRequiredPropertyValue));
/s
FieldTag.setRequired(boolean) line: 777	
		required = aRequired;


/ FIX PNL-344

[eric@localhost pnloms]$ pwd
$ vim module/oms/war//WEB-INF/tags/oms/sho-productitems.tag
                 <mpo:field languageKey="productitem.description" name="description" required="true" overRideable="true"/>

[eric@localhost pnloms]$ vim pnloms.properties 
module.oms.shipmentorder.description.required=false

/ Einde FIX PNL-344

/ Einde DEBUG PNL-344

/ PNL-384

/ configuration, master data, schedules
/ = ScheduleListPage	,
/ edit er een	,
/ we komen in	,
$ vi ScheduleEditPage.html
<wicket:extend> 
	<div wicket:id="editPanel"></div>
</wicket:extend>

$ vi ScheduleEditPage.java
ScheduleEditPage.<init>(BeanWrapper<BaseDAOInterface<Schedule>>, BaseContextPage) line: 28	
		createPage();
/s
	private void createPage() {
		editPanel = new ScheduleEditPanel("editPanel", null, daoWrapper, basePage);


$ vi ScheduleEditPanel.html

<style>

label span {
	display: inline-block;
	width: 100px;
	font-weight: bold;
}
</style>
			<wicket:enclosure>
			<li>
				<label>
					<span><wicket:message key="horizon.days">Horizon(d)</wicket:message></span>
					<input wicket:id="horizon" />
				</label>
			</li>
			</wicket:enclosure>

/ op <span> hebben we css attributes	,  <wicket:message/> wordt een text node, geen html tag	, dus daar kunnen we geen style op set	,


$ vi ScheduleEditPanel.java

		NumberField horizonField = new NumberField("horizon", new PropertyModel<Integer>(scheduleModel, "horizon")) {
			...
		};
		horizonField.setVisible(true);
/ OK 
/ of	,
		IBehavior b = new AttributeAppender("style", new Model<String>("display:none"), "");
		horizonField.add(b);
/ NIET
/ Deze maakt het text field not visible, maar het label is er toch	,
/ TODO

/ Bij PNL-378, description field van product item op shipment order required="false" set	, hebben we een JSP tag, en die verwacht een properties van een bepaalde vorm	,
module.oms.shipmentorder.description.
/ in 	,
module.oms.shipmentorder.description.required=false

/ we doen	,

$ vi ScheduleEditPanel.java

		String horizonVisibleAsString = ApplicationPropertyManager.getInstance().getProperty("module.oms.massupdate.schedule.horizon");
		boolean horizonVisible=BooleanUtils.isTrue(horizonVisibleAsString);
		horizonField.setVisible(horizonVisible);


/ FIX PNL-384

$ vi pnloms.properties
module.oms.schedule.horizon.hidden=true

$ vi ScheduleEditPanel.java

	String horizonHiddenAsString = ApplicationPropertyManager.getInstance().getProperty("module.oms.schedule.horizon.hidden", "false");
	boolean horizonHidden = BooleanUtils.isTrue(horizonHiddenAsString);
	horizonField.setVisible(!horizonHidden);



/ Einde FIX PNL-384


/ Einde PNL-384

/ PNL-401

$ vi sho-productitems.tag


/ in 'Create New Product Item' form	,

/ 7	. 

Description 	...
Aantal		...

/ In HTML	,

<tr>
	<td class="label">Description</td>
	<td nowrap="nowrap" class="input">
		<span id="productItemDescription_div">
			<input type="text" name="productItemDescription" id="productItemDescription" size="20" maxlength="250" value="" class="fieldInput">
		</span>
	</td>
</tr>

<tr>
	<td class="label">Aantal</td>
	<td nowrap="nowrap" class="input">
		<span id="productItemQuantity_div">
			<input type="text" name="productItemQuantity" id="productItemQuantity" size="20" maxlength="250" value="0.00" class="fieldInput required ">
		</span>
	</td>
</tr>

$ vi sho-productitems.tag
		<mpo:field languageKey="productitem.description" name="description" required="true" overRideable="true"/>
		<mpo:numberField name="quantity" minValue="0.1" type="float" required="true" /> 

$ vi mpo.tld

	<tag>
		<name>field</name>
		<tagclass>com.mpobjects.view.taglib.form.FieldTag</tagclass>
		<bodycontent>JSP</bodycontent>
		<info>the input tag</info>
		<attribute>
			<name>name</name>
...
		<name>numberField</name>
		<tagclass>com.mpobjects.view.taglib.form.NumberFieldTag</tagclass>
		<bodycontent>JSP</bodycontent>
		<info>the number input tag</info>
		<attribute>
			<name>name</name>
...

$ vi FieldTag.java

	@Override
	public int doStartTag() throws JspException {

				if (showFieldContext()) {
					appendHeaderStart(myRet);
					appendLabelPart(myRet);
					appendInputPartPrefix(myRet);
					appendInputPart(myRet);

	protected void appendHeaderStart(StringBuffer aBuffer) {
		aBuffer.append("<tr>");

	protected void appendLabelPart(StringBuffer aBuffer) {
		aBuffer.append("<td class=\"label\">");
		aBuffer.append(getLabel());
		aBuffer.append("</td>");

	protected void appendInputPartPrefix(StringBuffer aBuffer) {
		aBuffer.append("<td nowrap=\"nowrap\" class=\"input\">");
		aBuffer.append("<span id=\"" + getFormFieldName() + "_div\">");

	protected void appendInputPart(StringBuffer aBuffer) {
		if (isFieldContextList() && isCurrentlyReadOnly()) {
			aBuffer.append(getDisplayValueAsString());
		} else {
			aBuffer.append("<input type=\"text\"");
			aBuffer.append(" name=\"" + getFormFieldName() + "\"");
			aBuffer.append(" id=\"" + getFormFieldName() + "\"");
			aBuffer.append(" size=\"" + getSize() + "\"");
			aBuffer.append(" maxLength=\"" + getMaxLength() + "\"");
		...
/ Hier wordt dus de HTML create die we zien	,
/ we debug deze hieronder	,

/ 7	.


			<mpo:listField name="product" type="product" populate="productId" />
			<mpo:field name="productId" hidden="true" />



	<tag>
		<name>listField</name>
		<tagclass>com.mpobjects.view.taglib.form.ListFieldTag</tagclass>
		<bodycontent>JSP</bodycontent>
		<info>the ListField tag</info>
		<attribute>
			<name>name</name>
			...

/ we zien	,


<tr>
	<td class="label">Product</td>
	<td nowrap="nowrap" class="input">
		<span id="productItemProduct_div">
			<span class="selector_visible" id="productItemProduct_text_div">
				<input type="text" id="productItemProduct" name="productItemProduct" value="" size="19" onchange="valueToUpper(this);" class=" listFieldInput "> 
			</span>
			<span class="selector_invisible" id="productItemProduct_select_div">
				<select id="productItemProduct_select" name="productItemProduct_select" class="invisible"></select>
			</span>
			<span>
				<a href="#" id="productItemProduct_href" onclick="return mpobjects.ui.selectors.product('productItemProduct');">
					<img src="../lookandfeel/images/icons/lookup.png" border="0" id="productItemProduct_icon" class="selector_icon" )="">
				</a>
			</span>
		</span>
	</td>
</tr>

/////////////////////////////////////////////
/ we zien	,
				onchange="valueToUpper(this);" 
				onclick="return mpobjects.ui.selectors.product('productItemProduct')

/ 7	. 

<input type="hidden" name="productItemProductId" id="productItemProductId" value="">





/ 7	.
			<mpo:listField name="customerOrderLine" type="customerOrderLine" />
			<mpo:numberField name="customerOrderLineSystemId" type="int" hidden="true" />
/ TODO


/ Einde PNL-401


/ we gaan doStartTag debug	,

/ 7	.

/ we maken conditional b op 
this.name.equals("description")

/s
FieldTag.doStartTag() line: 317	
		if (isFieldContextForm()) {
/ JA
			handleOverridable();

		if (handleShowField) {
			// was:overridable
			if (isFieldContextForm()) {
				findSetFormVOTag();
/s
FieldTag.findSetFormVOTag() line: 1062	
		Tag myParent = this;
FieldTag
	while (myParent != null && !(myParent instanceof SetFormVOTag) && i < max) {
			myParent = myParent.getParent();
/ eerst 
TabTag
	theName	"productItem"
/ dan
TabCollectionTag
	theName	"product-item"
/ dan
SetFormVOTag

		SetFormVOTag myTag = (SetFormVOTag) myParent;
		setActiveValueObjectHolder((SetFormVOTag) myTag.clone());

/t
FieldTag.doStartTag() line: 342	
			} else {

				if (showFieldContext()) {
/ JA
					appendHeaderStart(myRet);
/s
		aBuffer.append("<tr>");

					appendLabelPart(myRet);
/s
		aBuffer.append("<td class=\"label\">");
		aBuffer.append(getLabel());
/s
		return getLabel(StringUtils.isEmpty(getLanguageKey())            ? getName() : getLanguageKey());
/ getLanguageKey()="productitem.description"
/s
	protected String getLabel(String aName) {
/ aName="productitem.description"
		return getLanguageManager().getByJavaName(getFieldOwner().getEntity(), aName);
/ fieldOwner=com.mpobjects.view.taglib.form.FormTag@24564365
/ getFieldOwner().getEntity()="shipmentorder"
/s
LanguageManager.getByJavaName(String, String) line: 268	
/=
	public String getByJavaName(String anEntityName, String aFieldName) {
		String myTableName = StringUtils.formatJavaToSql(anEntityName).toString();
		String myFieldName = StringUtils.formatJavaToSql(aFieldName).toString();
anEntityName	"shipmentOrder" (id=19540)	
aFieldName	"productitem.description" (id=18202)	
myTableName	"shipment_order" (id=19748)	
myFieldName	"productitem.description" (id=19751)	

			myRet = get(myTableName, myFieldName);
/s
LanguageManager.get(String, String) line: 169	
		} else {
			aTableName = StringUtils.formatJavaToSql(aTableName).toString();
			aTableName = aTableName.replaceAll("-", "_");
"shipment_order"
			myFullCode = "table_" + aTableName + "_" + aField;
myFullCode	"table_shipment_order_productitem.description" (id=19753)	
/s
	public String get(String aFullCode, boolean aThrowExceptionIfNotFound) {
		return get(aFullCode, StringUtils.EMPTY_STRING_MAP, aThrowExceptionIfNotFound);
/s
	private String get(String aFullCode, Map<String, String> aFieldMap, boolean aThrowExceptionIfNotFound) throws IndexOutOfBoundsException {
		String myProductSpecificCode = getProduct() + "." + myFullCode;
myProductSpecificCode	"pnloms.table_shipment_order_productitem.description" (id=19757)	

		if (getPropertiesFile().containsKey(myProductSpecificCode)) {
/s
	protected Properties getPropertiesFile() {
		Map<Locale, Properties> myPropertiesFiles = getPropertiesFiles();
/s
/= thePropertiesFiles
{en={	tab_route_consignment_nr=Consignment nr, 
	shipmentorder.reference4.dsvcts.general=Reference4, 
	monitoring-dashboard.ismailthreshold=Send mail,
	...
		if (myPropertiesFiles.containsKey(getLocale())) {
			myRet = myPropertiesFiles.get(getLocale());
/ WH is dat { tab_route_consignment_nr=... } achter en	,

/t
		if (getPropertiesFile().containsKey(myProductSpecificCode)) {
myProductSpecificCode	"pnloms.table_shipment_order_productitem.description" (id=19757)	
/ NEE
		} else if (getPropertiesFile().containsKey(myFullCode)) {
myFullCode	"table_shipment_order_productitem.description" (id=19753)	
/ NEE
		} else {
			if (aThrowExceptionIfNotFound) {
/ JA
				throw new IndexOutOfBoundsException(myFullCode + " Not found in language file.");

/t
LanguageManager.get(String, String) line: 170	
		try {
			myRet = get(myFullCode, true);
		} catch (IndexOutOfBoundsException e) {
		}
/d
		if (myRet == null) {
/ JA
			try {
				myRet = get(aField, true);
aField	"productitem.description" (id=19751)	
/s
/ Deze is er wel	,
$ vi language_en.properties
productitem.description = Description

/t
FieldTag.appendLabelPart(StringBuffer) line: 970	
		aBuffer.append(getLabel());
/d
aBuffer="<tr><td class="label">Description"

/////////////////////////////////////////////////////////////////////////////////
/ Dus	,
		aBuffer.append(getLabel());
/ ook uit de language file	, maar anders als bij wicket	,

/t
FieldTag.doStartTag() line: 345	
					appendLabelPart(myRet);
/d
					appendInputPartPrefix(myRet);
/s
		aBuffer.append("<td nowrap=\"nowrap\" class=\"input\">");
		aBuffer.append("<span id=\"" + getFormFieldName() + "_div\">");

/t
FieldTag.doStartTag() line: 345	
					appendInputPartPrefix(myRet);
/d
					appendInputPart(myRet);
/s
	protected void appendInputPart(StringBuffer aBuffer) {
		if (isFieldContextList() && isCurrentlyReadOnly()) {
/NEE
		} else {
			aBuffer.append("<input type=\"text\"");
			aBuffer.append(" name=\"" + getFormFieldName() + "\"");
/s
FieldTag.getFormFieldName() line: 1107	
		String myPrefix = getPrefix();
"productItem"
			myRet = myPrefix + StringUtils.firstCharToUpper(getName());
productItemDescription
			aBuffer.append(" id=\"" + getFormFieldName() + "\"");
			aBuffer.append(" size=\"" + getSize() + "\"");
			aBuffer.append(" maxLength=\"" + getMaxLength() + "\"");

			if (isBindToVO()) {
/ JA
				aBuffer.append(" value=\"" + getDisplayValueAsString().replaceAll("\"", "") + "\"");
/ getDisplayValueAsString()=""

			if (StringUtils.isNotEmpty(myClasses)) {
/ JA
				aBuffer.append(" class=\"" + myClasses + "\" ");
myClasses	"fieldInput" (id=19946)	

			aBuffer.append("/>");
<tr><td class="label">Description</td><td nowrap="nowrap" class="input"><span id="productItemDescription_div"><input type="text" name="productItemDescription" id="productItemDescription" size="20"<input type="text" name="productItemDescription" id="productItemDescription" size="20" maxLength="250" value="" class="fieldInput" />

/t
FieldTag.doStartTag() line: 355	
					appendInputPart(myRet);
/d
		if (isFieldContextForm()) {
/ JA
			addFieldToOwner(this);
/s
		getFieldOwner().addField(aTag);

/ 7	. 

/ Nu de 2 velden erboven	,

			<mpo:listField name="product" type="product" populate="productId" />
			<mpo:field name="productId" hidden="true" />

/ we set op FieldTag.doStartTag een conditional b	,
this.name.equals("productId") 
||
this.name.equals("product")

/ we vallen eerst in	,
ListFieldTag(FieldTag).doStartTag() line: 314	
this.name="product"

	if (handleShowField) {
			if (isFieldContextForm()) {
				findSetFormVOTag();
/s
ListFieldTag(FieldTag).findSetFormVOTag() line: 1058	
		Tag myParent = this;
this ListFieldTag
		while (myParent != null && !(myParent instanceof SetFormVOTag) && i < max) {
			myParent = myParent.getParent();
myParent	IfTag  (id=24145)	
myParent	TabTag  (id=24534)	
myParent	TabCollectionTag  (id=24548)	
myParent	SetFormVOTag  (id=24553)	

/t
ListFieldTag(FieldTag).doStartTag() line: 342	
				if (showFieldContext()) {
					appendHeaderStart(myRet);
					appendLabelPart(myRet);
					appendInputPartPrefix(myRet);
/s
		aBuffer.append("<td nowrap=\"nowrap\" class=\"input\">");
		aBuffer.append("<span id=\"" + getFormFieldName() + "_div\">");
/t
					appendInputPart(myRet);
/s
ListFieldTag.appendInputPart(StringBuffer) line: 437	
///////////////////////////////////////////////////////////////
/ Inderdaad	, ListFieldTag	,
			String myOnClickDef = ApplicationPropertyManager.getInstance().getModuleApplicationProperty("core",
					"listinput." + theType.toLowerCase() + ".selector.onclick");
return mpobjects.ui.selectors.product('[name]');

			String myFieldLength = ApplicationPropertyManager.getInstance().getModuleApplicationProperty("core",
					"listinput." + theType.toLowerCase() + ".selector.view.size", "5");
19

			HashMap<String, String> myMap = new HashMap<String, String>();
			myMap.put("name", getFormFieldName());
productItemProduct
			myMap.put("type", getType());
product
			myMap.put("value", myValue);
""
			myMap.put("filter", myFilter);
""
			String myOnClickUrl = StringUtils.replaceVars(myOnClickDef, myMap);
myOnClickUrl	"return mpobjects.ui.selectors.product('productItemProduct');" 

			aBuffer.append("<span class=\"selector_visible\"");
			aBuffer.append(" id=\"" + getFormFieldName() + "_text_div\">");

			aBuffer.append("<input type=\"text\"");
			aBuffer.append(" id=\"" + getFormFieldName() + "\"");
			aBuffer.append(" name=\"" + getFormFieldName() + "\"");
			aBuffer.append(" value=\"" + myValue + "\"");
			aBuffer.append(" size=\"" + myFieldLength + "\"");

			} else {
				if (StringUtils.isTrue(getUpperCaseOnly())) {
					aBuffer.append(" onchange=\"valueToUpper(this);\"");

				if (isRequired()) {
/ NEE
				} else {
					aBuffer.append("class=\" listFieldInput \"");
			aBuffer.append(" /> ");
			aBuffer.append("</span>");

			if (!isCurrentlyReadOnly()) {
/ JA
				aBuffer.append("<span class=\"selector_invisible\"");
				aBuffer.append(" id=\"" + getFormFieldName() + "_select_div\">");

				aBuffer.append("<select");
				aBuffer.append(" id=\"" + getFormFieldName() + "_select\"");
productItemProduct
				aBuffer.append(" name=\"" + getFormFieldName() + "_select\"");
				aBuffer.append(" class=\"invisible\"");
				aBuffer.append("></select>");
				aBuffer.append("</span>");

				aBuffer.append("<span>");
				aBuffer.append("<a href=\"#\"");
				aBuffer.append(" id=\"" + getFormFieldName() + "_href\"");
				aBuffer.append(" onclick=\"" + myOnClickUrl + "\"");
return mpobjects.ui.selectors.product('productItemProduct');
				aBuffer.append(">");
				aBuffer.append("<img src=\"../lookandfeel/images/icons/lookup.png\"");
				aBuffer.append(" border=\"0\"");
				aBuffer.append(" id=\"" + getFormFieldName() + "_icon\"");
				aBuffer.append(" class=\"selector_icon\"");
				aBuffer.append(")/>"); //

				aBuffer.append("</a>");
				aBuffer.append("</span>");

/ 7	.

/ we komen in 	,
FieldTag.doStartTag() line: 314	
name	"productId" (id=18192)	
			if (isHidden()) {
/ JA
				appendHiddenPart(myRet);
/s
	protected void appendHiddenPart(StringBuffer aBuffer) {
		aBuffer.append("<input type=\"hidden\"");
		aBuffer.append(" name=\"" + getFormFieldName() + "\"");
productItemProductId
		aBuffer.append(" id=\"" + getFormFieldName() + "\"");
		if (isBindToVO()) {
/ JA
			aBuffer.append(" value=\"" + VOReflectionInvoker.getValueAsString(getActiveValueObject(), getName()) + "\"");
		}
		aBuffer.append("/>");

/ we zien	,
<input type="hidden" name="productItemProductId" id="productItemProductId" value="">

/ 7	. 

/ we zien in product	,
				onchange="valueToUpper(this);" 
				onclick="return mpobjects.ui.selectors.product('productItemProduct')

/ waar zijn deze js fcts?


$ vi sho-productitems.tag

	<script type="text/javascript">
		...
		mpobjects.ui.selectors.product = function(target) {
			...

/ Hoe een b set hierin?

/ geef in de console van chrome	,
> mpobjects.ui.selectors.product 
/ Kies het juiste frame, en geeft weer	,
> mpobjects.ui.selectors.product 
/ We vinden het juiste frame	, en de js fct verschijnt	, die is def in de sho-productitem.tag	,
function (target) {
			var pne = document.getElementById(target);
			mpobjects.ui.selectors['product_' + target] = function(value) {
				pne.value = value;
			}

			mpobjects.ui.selectors.product_fillField = function(id, value) {
				if (document.getElementById(id) != null)
					document.getElementById(id).value = value;
			}

			var callback = 'window.opener.mpobjects.ui.selectors.product_'
					+ target + '(\'[code]\');';
			callback += 'window.opener.mpobjects.ui.selectors.product_fillField(\'productItemDescription\', \'[description]\');';
			callback += 'window.opener.mpobjects.ui.selectors.product_fillField(\'productItemWeightKg\', \'[weightKg]\');';

/ we zien rechtsonder een link	, click	, we komen in de code onder Sources	,

/ we zien in het menu links de js file	,
/ onder oms/	,
http://localhost:8080/tms/oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=26680261&systemId=26680261 
/ Inderdaad , we zien het result van de JSP , dus alle HTML en de JS onderin	,

/ we zien in het menu bij een gewone js file	,
/ onder script/	,
http://localhost:8080/tms/script/class.dhtmlutils.js

/ we zien in chrome 
tms
	core
	lookandfeelstyles
	m_script/oms
	oms
	script
	wicket/js

/ in meer detail	,
/ TODO

/ 7	.

/ we click op het icon	, 
/ we vallen inderdaad	 in	,
		mpobjects.ui.selectors.product = function(target) {
target: "productItemProduct"

> mpobjects.ui.selectors===this
true
/ this is een coll fcts	, waaronder product	,

			var pne = document.getElementById(target);
pne: input#productItemProduct.listFieldInput

			mpobjects.ui.selectors['product_' + target] = function(value) {
				pne.value = value;
			}
			mpobjects.ui.selectors.product_fillField = function(id, value) {
				if (document.getElementById(id) != null)
					document.getElementById(id).value = value;
			}
/ 2 fcts erbij	,
/ Deze worden hieronder used	, 

			var callback = 'window.opener.mpobjects.ui.selectors.product_' + target + '(\'[code]\');';
			callback += 'window.opener.mpobjects.ui.selectors.product_fillField(\'productItemDescription\', \'[description]\');';
			...
> callback
"window.opener.mpobjects.ui.selectors.product_productItemProduct('[code]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemDescription', '[description]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemWeightKg', '[weightKg]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemTotalVolumeM3', '[volume]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemCustomsNumber', '[customsNumber]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemIndividualItemValue', '[individualItemValue]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemValueCurrency', '[valueCurrency]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemPartNumber', '[partNumber]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemProductModel', '[productModel]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemProductSeries', '[productSeries]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemProductId', '[productId]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemProductGroup', '[productGroup]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemProductOwner', '[productOwner]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemCountryOfOrigin', '[countryOfOrigin]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemReference1', '[reference1]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemReference2', '[reference2]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemReference3', '[reference3]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemActualAdrCode', '[actualAdrCode]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemActualUnNumber', '[actualUnNumber]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemFlashpoint', '[flashpoint]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemPackagingGroup', '[packagingGroup]');
window.opener.mpobjects.ui.selectors.product_fillField('productItemRemarks', '[remarks]');"

		var mapForm = document.createElement('form');
			mapForm.target = 'productSelect';
			mapForm.method = 'POST';
			mapForm.action = '../wicket/';

			var mapInput1 = document.createElement('input');
			mapInput1.type = 'hidden';
			mapInput1.name = 'module';
			mapInput1.value = 'oms';
			mapForm.appendChild(mapInput1);

			var mapInput2 = document.createElement('input');
			mapInput2.type = 'hidden';
			mapInput2.name = 'wicketpage';
			mapInput2.value = 'product.ProductSelectPage';
			mapForm.appendChild(mapInput2);

			var mapInput3 = document.createElement('input');
			mapInput3.type = 'hidden';
			mapInput3.name = 'callback';
			mapInput3.value = callback;

			mapForm.appendChild(mapInput3);
			document.body.appendChild(mapForm);

/ Iedere keer als we click op dit icon, verschijnt er een nieuwe form in HTML	, dus na 3 keer click	,

<form target="productSelect" method="POST" action="../wicket/">
	<input type="hidden" name="module" value="oms">
	<input type="hidden" name="wicketpage" value="product.ProductSelectPage">
	<input type="hidden" name="callback" value="window.opener.mpobjects.ui.selectors.product_productItemProduct('[code]');...>
</form>
<form target="productSelect" method="POST" action="../wicket/">
	<input type="hidden" name="module" value="oms">
/////////////////////////////////////////////////////////////////////////////////////////////////
	<input type="hidden" name="wicketpage" value="product.ProductSelectPage">
	<input type="hidden" name="callback" value="window.opener.mpobjects.ui.selectors.product_productItemProduct('[code]');...>
</form>
<form target="productSelect" method="POST" action="../wicket/">
	<input type="hidden" name="module" value="oms">
	<input type="hidden" name="wicketpage" value="product.ProductSelectPage">
	<input type="hidden" name="callback" value="window.opener.mpobjects.ui.selectors.product_productItemProduct('[code]');...>
</form>

/ we gaan verder	, 
			window.open('', 'productSelect',
					'width=400,height=300,scrollbars=yes,resizable=yes');

/ er verschijnt inderdaad een leeg window 	,

		mapForm.submit();
			return false;

/ we geven continue	, er verschijnt in het window	,
http://localhost:8080/tms/wicket/?wicket:interface=:1::::
/ we zien het Search Product wicket form	,

/ TODO

/ 7	.

/ we select een product	,
/ we vallen in	,
	mpobjects.ui.selectors.product = function(target) {
			var pne = document.getElementById(target);
			mpobjects.ui.selectors['product_' + target] = function(value) {
->				pne.value = value;
 



/ DEBUG PNL-401



/ Einde DEBUG PNL-401

/ MPO-81

/ 7	. 

/ In mpo test	,
https://test-scs.mp-objects.com/mpo/core/index_frameset

/ EVENTS OP SERVICE ORDER 
/ Hoe events te zien op events dashboard	?

/ neem een sho,
/ als hij planned is	, click unplan	, save
/ nu zijn er geen events op de sho	,
/ Geef een Req. End (After), Req. End (Before)
/ click Manually assign path	, kies er een	, save
/ we zien event(s) op de sho	, en de date is Req. End (Before)	, we zien een pod	,

/ we zien nu de pod  op events dashboard	, let op het aantal, 2 bijv	, als er al een pod stond	,

/ we kunnen de event zien op de sho	, maar ook door de consignment te kiezen en op de seo te kijken naar de events	,

/ 7	. 

/ we zien local geen ERRs. We copy mpo test db naar local	,

[eric@localhost Backup]$ PGPASSWORD=mpo@2014 pg_dump -U eric -Fc -h mposerv8 mpo -f mpo_2014_01_v2.dump 

/ in db	,
mpo_2014_01=# create database mpo_2014_01_v2;

[eric@localhost Backup]$ PGPASSWORD=mpopostgres@mpo pg_restore -U mpopostgres -d mpo_2014_01_v2 mpo_2014_01_v2.dump 

List all of the current sessions
--------- */
SELECT * FROM pg_stat_activity;

/ 7	.

/ See mposcs-build-config.properties
/ See pnloms-build-config.properties
...

/ 7	. 

Execution , Execution Dashboard
/ Dat is EventDashboardPage	,

	public EventDashboardPage() {
		super();
		daoEventCacheWrapper = new BeanWrapper(EventCacheDAO.class);

		daoWrapper = new BeanWrapper(EventDashboardItemDAO.class);
		eventCustomQueryDaoWrapper = new BeanWrapper(EventCustomQueryDAO.class);
		createPage();

/ 7	. 


$ vi EventCache.standard.hbm.xml
	<class name="com.mpobjects.event.eventcache.model.EventCacheVO" lazy="false" table="EVENT_CACHE">

/ 7	.

$ vi Event.standard.hbm.xml
		<many-to-one name="eventTemplate" fetch="select" column="EVENT_TEMPLATE_SYSTEMID" class="com.mpobjects.event.model.entity.eventtemplate.EventTemplate" insert="false" update="false" />


/ Het WAS	,
	public EventTemplate getEventTemplate() {
		if (eventTemplate == null && eventTemplateSystemid != null) {
			eventTemplate = MpoBeanFactory.getBean(EventTemplateDAO.class).getBySystemId(getEventTemplateSystemid());
		}
		return eventTemplate;
	}
/ Het IS	,
		return eventTemplate;

/ 7	.

/ In 
public class EventCacheDAOImpl extends GenericHibernateDAO<EventCacheVO> implements EventCacheDAO {
	public List<Object[]> statusCount(EventType anEventType, Date aFromDate) {

String myQuery=" 
select count(distinct e.serviceOrderSystemid), e.eventStatus, e.organizationSystemid 
from EventVO e 
where e.eventType.systemId = :eventTypeSystemId 
and e.createdDate > :fromDate 
and e.closedOn is null 
and e.expectedEnd is not null 
and (e.eventTemplate is not null) 
group by e.eventStatus, e.eventType.systemId, e.organizationSystemid";
"

/ IS
and (e.eventTemplate is not null) 
/ WAS
and (e.eventTemplateSystemid != 0 or e.eventTemplateSystemid is not null) 

/ PAUL

/ 7	. 

EventDashboardPage.getUnExpectedPrefilterParameters() line: 168	
/ UNUSED

/ want later	,
EventDashboardItemDAOImpl.getUnexpectedDashboardItems(DAOFilterExpression) line: 131	
		String myQuery = 
			"select et.system_id as \"eventType\", count(distinct service_order_systemid) as \"count\" from event_event ev, event_type et "
				+ "where ev.event_template_systemid is null and ev.created_date > :createdDate and ev.event_type_systemid = et.system_id "
				+ "and ev.organization_systemid in (:organizationSystemId) " + "and (ev.actual_value is null or ev.actual_value = '') "
				+ "and et.name like :eventName and et.description like :eventDescription "
				+ "group by et.system_id, et.name order by et.name;";
		SQLQuery mySQLQuery = session.createSQLQuery(myQuery);
		mySQLQuery.setParameter("createdDate", calendar.getTime());
		...

/ 7	.





/ Einde PAUL



/ Einde MPO-81

/ DEBUG MPO-81

/ 7	. 

/ BREAKPOINTS



/ Einde BREAKPOINTS

/ 7	.

/s
EventDashboardPage.<init>() line: 68	
/s
...
EventDashboardPage(BasePage).<init>() line: 50	
		WebMarkupContainer myPageBody = new WebMarkupContainer("pageId") {
			...
		};
		myPageBody.add(new AttributeModifier("id", true, new Model<String>(getClass().getSimpleName())));
/ getClass().getSimpleName()="EventDashboardPage"

$ vi BasePage.html

<body wicket:id="pageId">

/ In HTML zien we	,
<body id="EventDashboardPage" class=" xMenu">

/ Klopt	,

/ 7	.

EventDashboardPage.createListPanel() line: 89	

		eventCustomQuerySearchListPanel = new EventCustomQueryDashboardSearchListPanel("eventCustomQuerySearchList", null, webComponentEventSwitchBoard, eventCustomQueryDaoWrapper, getEventCustomQueryListPanelAction(), new GenericTableDataProvider.Builder<EventCustomQuery>());

		expectedEventSearchListPanel = new EventCacheSearchListPanel("expectedEventSearchList", null, webComponentEventSwitchBoard, daoEventCacheWrapper, getEventListPanelAction(true), new EventCacheDataProvider.Builder());

		unexpectedEventSearchListPanel = new UnExpectedEventDashboardItemSearchListPanel("unexpectedEventSearchList", null, webComponentEventSwitchBoard, daoWrapper, null, new UnExpectedEventDashboardItemDataProvider.Builder(getUnExpectedPrefilterParameters()));

/ we zien 3 panels, klopt	, custom, expected, unexpected events	,

/ 7	.

/ Intermezzo

/t
EventDashboardPage.<init>() line: 69	

$ vi event/event/model/dao/Event.standard.hbm.xml
	<class name="com.mpobjects.event.event.model.EventVO" lazy="true" table="EVENT_EVENT">

$ vi event/eventcache/model/dao/EventCache.standard.hbm.xml
	<class name="com.mpobjects.event.eventcache.model.EventCacheVO" lazy="false" table="EVENT_CACHE">
/ HIBERNATETODO

/ Intermezzo

$ vi DeferredEventCache.standard.hbm.xml 

	<class name="com.mpobjects.event.eventdashboarditem.model.dao.DeferredEventCacheVO" lazy="false" table="DEFERRED_EVENT_CACHE">
/ HIBERNATETODO
		<many-to-one name="eventType"
			class="com.mpobjects.event.model.entity.eventtype.EventType" column="EVENT_TYPE_SYSTEMID"
			lazy="false" /> 
/ HIBERNATETODO

/ Einde Intermezzo

/ 7	. 

////////////////////////////////////////////////////////////////////////////
/ GenericListPanel.initialize calls GenericListPanel.makeTable, die 
		objectDataTable = getDefaultDataTable(aColumnsList);


/ panels	, 

EventDashboardPage.createListPanel() line: 89	

		eventCustomQuerySearchListPanel = new EventCustomQueryDashboardSearchListPanel("eventCustomQuerySearchList", null, webComponentEventSwitchBoard, eventCustomQueryDaoWrapper, getEventCustomQueryListPanelAction(), new GenericTableDataProvider.Builder<EventCustomQuery>());

/ custom	,


/s
EventCustomQueryDashboardSearchListPanel.<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, BeanWrapper<BaseDAOInterface<EventCustomQuery>>, Collection<EntityAction<EventCustomQuery>>, TableDataProviderBuilder<EventCustomQuery>) line: 45	
		super(aId, aParent, aWebComponentEventSwitchBoard, new EntityListActionBuilder<EventCustomQuery>(actions), aDaoWrapper, 0, aTableDataProviderBuilder, null);
/s
EventCustomQueryDashboardSearchListPanel(GenericListPanel).<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, ListActionsPanelBuilder<T>, BeanWrapper<BaseDAOInterface<T>>, int, TableDataProviderBuilder<T>, List<EntityGroupAction<T>>) line: 181	
		this(id, parent, aWebComponentEventSwitchBoard, aDaoWrapper, aListLength, tableDataProviderBuilder, aGroupActionList);
/s
EventCustomQueryDashboardSearchListPanel(GenericListPanel).<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, BeanWrapper<BaseDAOInterface<T>>, int, TableDataProviderBuilder<T>, List<EntityGroupAction<T>>) line: 136	
	initialize();
/s
EventCustomQueryDashboardSearchListPanel(GenericListPanel).initialize() line: 303	

		addFilterColumns(myColumnsList);
		...
		makeTable(myColumnsList);

/ In meer detail	,
		addFilterColumns(myColumnsList);
/s
EventCustomQueryDashboardSearchListPanel.addFilterColumns(List<IColumn>) line: 56	
		aColumnList.add(new ExtendedConfigurableTextFilteredPropertyColumn("eventDashboardItemVO.openDefaultCount", "eventDashboardItemVO.openDefaultCount",
				"eventDashboardItemVO.openDefaultCount", new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<Integer>(15)) {
			@Override
			public void populateItem(Item aCellItem, String aComponentId, IModel aModel) {
...
/t
		makeTable(myColumnsList);
/s
EventCustomQueryDashboardSearchListPanel(GenericListPanel).makeTable(List<IColumn>) line: 445	
		objectDataTable = getDefaultDataTable(aColumnsList);
/s
EventCustomQueryDashboardSearchListPanel(GenericListPanel).getDefaultDataTable(List<IColumn>) line: 411	
		return new DefaultDataTable("objectTable", aColumnsList, dataProvider, getListLength());
/ Hier zit de dataProvider	,
/t
		filterForm = new FilterForm("filterForm", dataProvider);
		...




/ expected	,

/t
EventDashboardPage.createListPanel() line: 89	

		expectedEventSearchListPanel = new EventCacheSearchListPanel("expectedEventSearchList", null, webComponentEventSwitchBoard, daoEventCacheWrapper, getEventListPanelAction(true), new EventCacheDataProvider.Builder());

/s
EventCacheSearchListPanel.<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, BeanWrapper<BaseDAOInterface<EventCacheVO>>, Collection<EntityAction<EventCacheVO>>, TableDataProviderBuilder<EventCacheVO>) line: 41	
...
/s
EventCustomQueryDashboardSearchListPanel(GenericListPanel).initialize() line: 303	

		addFilterColumns(myColumnsList);
		...
		makeTable(myColumnsList);

/ unexpected	,

/t
EventDashboardPage.createListPanel() line: 89	

		unexpectedEventSearchListPanel = new UnExpectedEventDashboardItemSearchListPanel("unexpectedEventSearchList", null, webComponentEventSwitchBoard, daoWrapper, null, new UnExpectedEventDashboardItemDataProvider.Builder(getUnExpectedPrefilterParameters()));
/s
EventDashboardPage.getUnExpectedPrefilterParameters() line: 168	
/t
/s
UnExpectedEventDashboardItemSearchListPanel.<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, BeanWrapper<BaseDAOInterface<EventDashboardItemVO>>, Collection<EntityAction<EventDashboardItemVO>>, TableDataProviderBuilder<EventDashboardItemVO>) line: 40	

/s
EventCustomQueryDashboardSearchListPanel(GenericListPanel).initialize() line: 303	

		addFilterColumns(myColumnsList);
		...
		makeTable(myColumnsList);


/ 7	. 

/ sizes	, 

/ custom	,

GenericTableDataProvider.size() line: 257	
		int size = daoWrapper.getBean().runQueryCount(filter);
/ daoWrapper=com.mpobjects.view.wicket.util.BeanWrapper@a3fb70c[type=interface com.mpobjects.event.dao.eventcustomquery.EventCustomQueryDAO,beanName=<null>]
/s
EventCustomQueryDAOImpl(GenericHibernateDAO).runQueryCount(DAOFilterExpression<Type>) line: 454	
EventCustomQueryDAOImpl(GenericHibernateDAO).runQueryCount(DAOFilterExpression<Type>) line: 459	
		myDetachedCriteria.setProjection(Projections.rowCount());
		List<Long> myList = getHibernateTemplate().findByCriteria(myDetachedCriteria);

/ we zien	,
49421 2015-03-04 10:24:26,470 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-3:) select count(*) as y0_ from EVENT_CUSTOM_QUERY this_ where this_.IS_DELETED=?
49422 2015-03-04 10:24:26,506 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding para      meter [1] as [BIT] - false

/ expected	,

EventCacheDataProvider.size() line: 69	
		int size = daoWrapper.getBean().runQueryCount(filter);
/s
EventCacheDAOImpl.runQueryCount(DAOFilterExpression<EventCacheVO>) line: 154	
		myDetachedCriteria.setProjection(Projections.rowCount());
		myDetachedCriteria.setProjection(Projections.distinct(Projections.countDistinct("eventType")));
		myDetachedCriteria.add(Restrictions.disjunction().add(Property.forName("openAlertCount").ne(0)).add(Property.forName("openDefaultCount").ne(0)));
		return ((Number) getHibernateTemplate().findByCriteria(myDetachedCriteria).get(0)).intValue();

/ we zien	,
select distinct count(distinct this_.EVENT_TYPE_SYSTEMID) as y0_ 
from EVENT_CACHE this_ 
where this_.organization_systemid in (
	select uo.organization_systemid 
	from user_organization uo 
	where uo.user_systemid = ?) 
and (this_.OPEN_ALERT_COUNT<>? 
or this_.OPEN_DEFAULT_COUNT<>?)
64665 2015-03-04 11:06:02,061 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [1] as [INTEGER] - 26877200
64667 2015-03-04 11:06:02,067 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [2] as [INTEGER] - 0
64669 2015-03-04 11:06:02,071 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [3] as [INTEGER] - 0

/ we doen zelf	,
select distinct count(distinct this_.EVENT_TYPE_SYSTEMID) as y0_ 
from EVENT_CACHE this_ 
where this_.organization_systemid in (
	select uo.organization_systemid 
	from user_organization uo 
	where uo.user_systemid = 26877200) 
and (this_.OPEN_ALERT_COUNT<>0 
or this_.OPEN_DEFAULT_COUNT<>0)

 y0_ 
-----
   1
(1 row)

/ Daarna	, omdat er 1 is	,

DataTable$1(AbstractRepeater).onBeforeRender() line: 131	
/s
DataTable$1(RefreshingView).onPopulate() line: 94	
/s
DataTable$1(AbstractPageableView).getItemModels() line: 107	
/s
DataTable$1(DataViewBase).getItemModels(int, int) line: 76	
/s
DataViewBase$ModelIterator.<init>(IDataProvider<T>, int, int) line: 109	
/s
EventCacheDataProvider.iterator(int, int) line: 41	

		return daoWrapper.getBean().runQuery(queryParam, filter).iterator();
/s
EventCacheDAOImpl.runQuery(QueryParam, DAOFilterExpression<EventCacheVO>) line: 125	

select this_.... , eventtype1_....
from EVENT_CACHE this_ 
inner join EVENT_TYPE eventtype1_ on this_.EVENT_TYPE_SYSTEMID=eventtype1_.SYSTEM_ID 
where this_.organization_systemid in (
	select uo.organization_systemid 
	from user_organization uo 
	where uo.user_systemid = ?) 
and this_.ORGANIZATION_SYSTEMID in (?, ?, ?, ?, ?, ?) 
and not (this_.OPEN_ALERT_COUNT=? 
and this_.OPEN_DEFAULT_COUNT=?) 
order by eventtype1_.NAME asc

66870 2015-03-04 11:15:14,068 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [1] as [INTEGER] - 26877200
66872 2015-03-04 11:15:14,074 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [2] as [INTEGER] - 103
66874 2015-03-04 11:15:14,078 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [3] as [INTEGER] - 4000
66876 2015-03-04 11:15:14,083 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [4] as [INTEGER] - 3150
66878 2015-03-04 11:15:14,088 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [5] as [INTEGER] - 101
66880 2015-03-04 11:15:14,092 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [6] as [INTEGER] - 102
66882 2015-03-04 11:15:14,097 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [7] as [INTEGER] - 1
66884 2015-03-04 11:15:14,101 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [8] as [INTEGER] - 0
66887 2015-03-04 11:15:14,105 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [9] as [INTEGER] - 0

select * 
from EVENT_CACHE this_ 
inner join EVENT_TYPE eventtype1_ on this_.EVENT_TYPE_SYSTEMID=eventtype1_.SYSTEM_ID 
where this_.organization_systemid in (
	select uo.organization_systemid 
	from user_organization uo 
	where uo.user_systemid = 26877200) 
and this_.ORGANIZATION_SYSTEMID in (103,4000,3150,101,102,1) 
and not (this_.OPEN_ALERT_COUNT=0  and this_.OPEN_DEFAULT_COUNT=0) 
order by eventtype1_.NAME asc

 system_id | custom_event_query_systemid | event_type_systemid | organization_systemid |      last_refresh       | open_default_count | open
_alert_count | system_id | name | is_deleted | data_type |    description    | order_nr | is_exportable | alert_sms | alert_email | phone_nu
mber | email_address | visible_on_second_event | show_on_dashboard | can_be_closed_by_types | data_constraint 
-----------+-----------------------------+---------------------+-----------------------+-------------------------+--------------------+-----
-------------+-----------+------+------------+-----------+-------------------+----------+---------------+-----------+-------------+---------
-----+---------------+-------------------------+-------------------+------------------------+-----------------
  26632091 |                             |            26631835 |                  4000 | 2015-03-03 16:20:57.881 |                 85 |     
           0 |  26631835 | POD  |          0 | STRING    | Proof of Delivery |        1 |             0 |         0 |           0 |         
     |               |                       0 |                 0 |                        | 
(1 row)

/ Daarna	,

EventCacheSearchListPanel$1.populateItem(Item, String, IModel) line: 61	

	protected void addFilterColumns(List<IColumn> aColumnList) {
		aColumnList.add(new ExtendedConfigurableTextFilteredPropertyColumn("openDefaultCount", "openDefaultCount", "openDefaultCount",
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<Integer>(15)) {
			@Override
			public void populateItem(Item aCellItem, String aComponentId, IModel aModel) {
->				final EventCacheVO item = (EventCacheVO) aModel.getObject();
				Link<EventVO> link = new Link<EventVO>("link", aModel) {
				aCellItem.add(new LinkPanel(aComponentId, link, item.getOpenDefaultCount().toString()).setOutputMarkupId(true));

/ Ook	,
		aColumnList.add(new ExtendedConfigurableTextFilteredPropertyColumn("openAlertCount", "openAlertCount", "openAlertCount",
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<Integer>(5)) {
			@Override
			public void populateItem(Item aCellItem, String aComponentId, IModel aModel) {

...
		aColumnList.add(new PropertyColumn(new ResourceModel("totalOpen"), "totalOpen") {
			@Override
			public void populateItem(Item aCellItem, String aComponentId, IModel aModel) {




//////////////////////////////////////////
/ We zien alleen deze	, omdat de andere ook worden called, maar 'gewoon' gaan	, hier hebben we een b in set	,

/ unexpected	,

/s
UnExpectedEventDashboardItemDataProvider.size() line: 69	
		int size = ((EventDashboardItemDAO) daoWrapper.getBean()).runUnExpectedQueryCount(filter);
/ daoWrapper=com.mpobjects.view.wicket.util.BeanWrapper@7a7bf50f[type=interface com.mpobjects.event.eventdashboarditem.model.dao.EventDashboardItemDAO,beanName=<null>]
/s
EventDashboardItemDAOImpl.runUnExpectedQueryCount(DAOFilterExpression) line: 261	
		return getUnexpectedDashboardItems(filter).size();
/s
EventDashboardItemDAOImpl.getUnexpectedDashboardItems(DAOFilterExpression) line: 131	
		String myQuery = 
	"select et.system_id as \"eventType\", count(distinct service_order_systemid) as \"count\" from event_event ev, event_type et "
				+ "where ev.event_template_systemid is null and ev.created_date > :createdDate and ev.event_type_systemid = et.system_id "
				+ "and ev.organization_systemid in (:organizationSystemId) " + "and (ev.actual_value is null or ev.actual_value = '') "
				+ "and et.name like :eventName and et.description like :eventDescription "
				+ "group by et.system_id, et.name order by et.name;";
...
		List<Map<String, Integer>> resultList = mySQLQuery.list();

select et.system_id as "eventType", count(distinct service_order_systemid) as "count" 
from event_event ev, event_type et 
where ev.event_template_systemid is null 
and ev.created_date > ? 
and ev.event_type_systemid = et.system_id 
and ev.organization_systemid in (?, ?, ?, ?, ?, ?) 
and (ev.actual_value is null or ev.actual_value = '') 
and et.name like ? and et.description like ? 
group by et.system_id, et.name order by et.name;

71275 2015-03-04 11:31:35,067 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [1] as [TIMESTAMP] - Thu Dec 04 11:31:03 CET 2014
71277 2015-03-04 11:31:35,072 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [2] as [INTEGER] - 103
71269 2015-03-04 11:31:35,053 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [3] as [INTEGER] - 4000
71271 2015-03-04 11:31:35,057 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [4] as [INTEGER] - 3150
71265 2015-03-04 11:31:35,043 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [5] as [INTEGER] - 101
71263 2015-03-04 11:31:35,039 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [6] as [INTEGER] - 102
71261 2015-03-04 11:31:35,033 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [7] as [INTEGER] - 1
71273 2015-03-04 11:31:35,061 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [8] as [VARCHAR] - %
71267 2015-03-04 11:31:35,048 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding para      meter [9] as [VARCHAR] - %

/ we doen zelf	,

select et.system_id as "eventType", count(distinct service_order_systemid) as "count" 
from event_event ev, event_type et 
where ev.event_template_systemid is null 
and ev.created_date > 'Thu Dec 04 11:31:03 CET 2014' 
and ev.event_type_systemid = et.system_id 
and ev.organization_systemid in (103,4000,3150,101,102,1)
and (ev.actual_value is null or ev.actual_value = '') 
and et.name like '%' and et.description like '%' 
group by et.system_id, et.name order by et.name;

 eventType | count 
-----------+-------
  26631835 |    27
(1 row)

/ later	, want er is er 1	,
UnExpectedEventDashboardItemDataProvider.iterator(int, int) line: 56	
		return ((EventDashboardItemDAO) daoWrapper.getBean()).getUnexpectedDashboardItems(filter).iterator();
/s
EventDashboardItemDAOImpl.getUnexpectedDashboardItems(DAOFilterExpression) line: 131	
/ Weer	,
/ TODO

/ Daarna	,

UnExpectedEventDashboardItemSearchListPanel$1.populateItem(Item, String, IModel) line: 62	
		aColumnList.add(new PropertyColumn(new ResourceModel("closed"), "closed") {
/ al	,
			@Override
			public void populateItem(Item aCellItem, String aComponentId, IModel aModel) {
->				final EventDashboardItemVO item = (EventDashboardItemVO) aModel.getObject();
item	EventDashboardItemVO  (id=17009)	
	...
	theEventType	EventType  (id=17019)	
POD
	theLastRefresh	Date  (id=17021)	
Wed Mar 04 11:41:38 CET 2015

				aCellItem.add(new LinkPanel(aComponentId, link, item.getClosed().toString()).setOutputMarkupId(true));








...
/ TODO
/s
GenericTableDataProvider.size() line: 257	
		int size = daoWrapper.getBean().runQueryCount(filter);
/s
EventCustomQueryDAOImpl(GenericHibernateDAO).runQueryCount(DAOFilterExpression<Type>) line: 459	
		myDetachedCriteria.setProjection(Projections.rowCount());
		List<Long> myList = getHibernateTemplate().findByCriteria(myDetachedCriteria);

/ we zien	,
49421 2015-03-04 10:24:26,470 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-3:) select count(*) as y0_ from EVENT_CUSTOM_QUERY this_ where this_.IS_DELETED=?
49422 2015-03-04 10:24:26,506 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding para      meter [1] as [BIT] - false

/ 7	. 

/ expected events	,

/ we komen in EventCacheDAOImpl.runQueryCount	, 

EventCacheDataProvider.size() line: 69	
		int size = daoWrapper.getBean().runQueryCount(filter);
/s
EventCacheDAOImpl.runQueryCount(DAOFilterExpression<EventCacheVO>) line: 154	
		myDetachedCriteria.setProjection(Projections.rowCount());
		myDetachedCriteria.setProjection(Projections.distinct(Projections.countDistinct("eventType")));
		myDetachedCriteria.add(Restrictions.disjunction().add(Property.forName("openAlertCount").ne(0)).add(Property.forName("openDefaultCount").ne(0)));
		return ((Number) getHibernateTemplate().findByCriteria(myDetachedCriteria).get(0)).intValue();

select distinct count(distinct this_.EVENT_TYPE_SYSTEMID) as y0_ 
from EVENT_CACHE this_ 
where this_.organization_systemid in (
	select uo.organization_systemid 
	from user_organization uo 
	where uo.user_systemid = ?) 
and (this_.OPEN_ALERT_COUNT<>? or this_.OPEN_DEFAULT_COUNT<>?)

51625 2015-03-04 10:33:18,252 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding para      meter [1] as [INTEGER] - 26877200
51627 2015-03-04 10:33:18,257 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding para      meter [2] as [INTEGER] - 0
51629 2015-03-04 10:33:18,262 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding para      meter [3] as [INTEGER] - 0
516

/ we doen zelf	,

select distinct count(distinct this_.EVENT_TYPE_SYSTEMID) as y0_ 
from EVENT_CACHE this_ 
where this_.organization_systemid in (
	select uo.organization_systemid 
	from user_organization uo 
	where uo.user_systemid = 26877200)								/* eric */ 
and (this_.OPEN_ALERT_COUNT<>0 or this_.OPEN_DEFAULT_COUNT<>0)






/ 7	.


$ vi EventDashboardPage.html
	<fieldset>
		<legend><wicket:message key="evlHeader">Expected events</wicket:message></legend>
		<div wicket:id="expectedEventSearchList"></div>
	</fieldset>

	public EventDashboardPage() {
		...
		createPage();
/s
		createListPanel();
/s
EventDashboardPage.createListPanel() line: 82	


		eventCustomQuerySearchListPanel = new EventCustomQueryDashboardSearchListPanel("eventCustomQuerySearchList", null, webComponentEventSwitchBoard, eventCustomQueryDaoWrapper, getEventCustomQueryListPanelAction(), new GenericTableDataProvider.Builder<EventCustomQuery>());

$ vi BasePage.java
	protected WebComponentEventSwitchBoard webComponentEventSwitchBoard = new WebComponentEventSwitchBoard();
/ TODO
/ eventCustomQueryDaoWrapper=com.mpobjects.event.dao.eventcustomquery.EventCustomQueryDAO
/ getEventCustomQueryListPanelAction()=refresh action, die zien we op iedere event row	, links	, (als er een row is)	,

		expectedEventSearchListPanel = new EventCacheSearchListPanel("expectedEventSearchList", null, webComponentEventSwitchBoard, daoEventCacheWrapper, getEventListPanelAction(true), new EventCacheDataProvider.Builder());
/ daoEventCacheWrapper=EventCacheDAO
/ getEventCustomQueryListPanelAction()=refresh action, die zien we op iedere event row	, links	, (als er een row is)	,
/s


/ 7	.

public class UnExpectedEventDashboardItemDataProvider extends PrefilteredTableDataProvider<EventDashboardItemVO> {
/ en	,
			return new EventCacheDataProvider(daoWrapper, defaultSortProperty)	, extends GenericTableDataProvider	,
/ expected events	,

/ 7	.

/ show events in dashboard	, welke queries worden er gedaan	?

/ 13	. 

/ custom query events,

GenericTableDataProvider.size() line: 257	
		int size = daoWrapper.getBean().runQueryCount(filter);
/ daoWrapper=interface com.mpobjects.event.dao.eventcustomquery.EventCustomQueryDAO
EventCustomQueryDAOImpl(GenericHibernateDAO).runQueryCount(DAOFilterExpression<Type>) line: 459	


$ vi log/hibernate.log
...
130588 2015-03-03 12:25:46,109 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-2:) select count(*) as y0_ from EVENT_CUSTOM_QUERY this_ where this_.IS_DELETED=?
130589 2015-03-03 12:25:46,121 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:) binding parameter [1] as [BIT] - false

/ 13	. 

/ expected events	,

EventCacheDataProvider.size() line: 69	
		int size = daoWrapper.getBean().runQueryCount(filter);
daoWrapper=omheen EventCacheDAO	,
/ tx
/s
EventCacheDAOImpl.runQueryCount(DAOFilterExpression<EventCacheVO>) line: 150	

/ de hibernate log gaat per inst	,
[eric@localhost mpo]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/mpo
$ vi log/hibernate.log
...
select distinct count(distinct this_.EVENT_TYPE_SYSTEMID) as y0_ from EVENT_CACHE this_ 
where this_.organization_systemid in (select uo.organization_systemid from user_organization uo where uo.user_systemid = ?) 
and (this_.OPEN_ALERT_COUNT<>? or this_.OPEN_DEFAULT_COUNT<>?)
130073 2015-03-03 12:21:50,899 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding par       ameter [1] as [INTEGER] - 26632643
130075 2015-03-03 12:21:50,916 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding par       ameter [2] as [INTEGER] - 0
130076 2015-03-03 12:21:50,922 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding par       ameter [3] as [INTEGER] - 0

/ 13	. 

EventCacheDataProvider.iterator(int, int) line: 59	
/=
	@Override
	public Iterator<EventCacheVO> iterator(final int first, final int count) {
		return daoWrapper.getBean().runQuery(queryParam, filter).iterator();
/s
EventCacheDAOImpl.runQuery(QueryParam, DAOFilterExpression<EventCacheVO>) line: 125	

/ QUERY EVENT_CACHE
/ we zien	,
select this_...._, eventtype1_....
from EVENT_CACHE this_ 
inner join EVENT_TYPE eventtype1_ on this_.EVENT_TYPE_SYSTEMID=eventtype1_.SYSTEM_ID 
where this_.organization_systemid in (
	select uo.organization_systemid 
	from user_organization uo 
	where uo.user_systemid = ?
) 
and this_.ORGANIZATION_SYSTEMID in (?, ?, ?,?,?,?) 
and not (
	this_.OPEN_ALERT_COUNT=? 
	and this_.OPEN_DEFAULT_COUNT=?
) 
order by eventtype1_.NAME asc

2015-03-03 14:23:47,060 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-1:) binding parameter [1] as [INTEGER] - 26877200
2015-03-03 14:23:47,065 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-1:) binding parameter [2] as [INTEGER] - 103
2015-03-03 14:23:47,069 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-1:) binding parameter [3] as [INTEGER] - 4000
2015-03-03 14:23:47,074 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-1:) binding parameter [4] as [INTEGER] - 3150
2015-03-03 14:23:47,080 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-1:) binding parameter [5] as [INTEGER] - 101
2015-03-03 14:23:47,085 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-1:) binding parameter [6] as [INTEGER] - 102
2015-03-03 14:23:47,089 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-1:) binding parameter [7] as [INTEGER] - 1
2015-03-03 14:23:47,094 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-1:) binding parameter [8] as [INTEGER] - 0
2015-03-03 14:23:47,099 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-1:) binding parameter [9] as [INTEGER] - 0



/ Intermezzo

/ we maken zelf	,

select * 
from EVENT_CACHE this_ 
inner join EVENT_TYPE eventtype1_ on this_.EVENT_TYPE_SYSTEMID=eventtype1_.SYSTEM_ID 
where this_.organization_systemid in (
	select uo.organization_systemid 
	from user_organization uo 
	where uo.user_systemid = 26877200 							/* eric */
) 
and this_.ORGANIZATION_SYSTEMID in (103,4000,3150,101,102,1)	/* BISCHOFF, HAAL-ZW, MPO, OEGEMA,  REENEN, SYSTEM */
and not (
	this_.OPEN_ALERT_COUNT=0 
	and this_.OPEN_DEFAULT_COUNT=0
)
 system_id | custom_event_query_systemid | event_type_systemid | organization_systemid |      last_refresh       | open_default_count | open
_alert_count | system_id | name | is_deleted | data_type |    description    | order_nr | is_exportable | alert_sms | alert_email | phone_nu
mber | email_address | visible_on_second_event | show_on_dashboard | can_be_closed_by_types | data_constraint 
-----------+-----------------------------+---------------------+-----------------------+-------------------------+--------------------+-----
-------------+-----------+------+------------+-----------+-------------------+----------+---------------+-----------+-------------+---------
-----+---------------+-------------------------+-------------------+------------------------+-----------------
  26632091 |                             |            26631835 |                  4000 | 2015-03-03 14:22:39.953 |                 85 |     
           0 |  26631835 | POD  |          0 | STRING    | Proof of Delivery |        1 |             0 |         0 |           0 |         
     |               |                       0 |                 0 |                        | 
(1 row)

/ Inderdaad, eric	,
mpo_2014_01_v2=# select*from tms_user where system_id=26877200;
 system_id | user_id |       user_name        | user_email_address | is_enabled | is_deleted |       last_login        | login_attempt | is_
first_login |  last_password_update   | chargeable | grace_login | created_by | created_on | user_password | is_interface_account | user_ref
erence1 | user_reference2 
-----------+---------+------------------------+--------------------+------------+------------+-------------------------+---------------+----
------------+-------------------------+------------+-------------+------------+------------+---------------+----------------------+---------
--------+-----------------
  26877200 | eric    | Eric J. Van der Velden |                    |          1 |          0 | 2015-03-03 14:22:20.464 |             0 |    
          0 | 2015-03-02 12:09:22.665 |          0 |           0 |      10100 | 2015-03-02 | rtdMpo45      |                    0 |         
        | 
(1 row)

/ Waarom  ?
inner join EVENT_TYPE eventtype1_ on this_.EVENT_TYPE_SYSTEMID=eventtype1_.SYSTEM_ID 
where this_.organization_systemid in (
	select uo.organization_systemid 
	from user_organization uo 
	where uo.user_systemid = 26877200 							/* eric */

/ Omdat in EventCache.standard.hbm.xml
	<class name="com.mpobjects.event.eventcache.model.EventCacheVO" lazy="false" table="EVENT_CACHE">
		<many-to-one name="eventType" 
			class="com.mpobjects.event.model.entity.eventtype.EventType" 
			column="EVENT_TYPE_SYSTEMID" lazy="false"/>		

/ Einde Intermezzo


/ 7	. 
/////////////////////////////////////////////
/ BREAKPOINTS IN EVENTS DASHBOARD

EventCacheDataProvider.iterator(int, int) line: 59	
/s
EventCacheDAOImpl.runQuery(QueryParam, DAOFilterExpression<EventCacheVO>) line: 125	

/ 7	.


/ we zien verschil query custom, unexpected en expected events	,

/ unexpected	,

UnExpectedEventDashboardItemDataProvider.size() line: 69	
		int size = ((EventDashboardItemDAO) daoWrapper.getBean()).runUnExpectedQueryCount(filter);
/s
EventDashboardItemDAOImpl.runUnExpectedQueryCount(DAOFilterExpression) line: 261	
		return getUnexpectedDashboardItems(filter).size();
/s
EventDashboardItemDAOImpl.getUnexpectedDashboardItems(DAOFilterExpression) line: 154	

		Calendar calendar = Calendar.getInstance();
		calendar.add(Calendar.DATE, -daysback);
		String myQuery = 
		"select et.system_id as \"eventType\", count(distinct service_order_systemid) as \"count\" from event_event ev, event_type et "
				+ "where ev.event_template_systemid is null and ev.created_date > :createdDate and ev.event_type_systemid = et.system_id "
				+ "and ev.organization_systemid in (:organizationSystemId) " + "and (ev.actual_value is null or ev.actual_value = '') "
				+ "and et.name like :eventName and et.description like :eventDescription "
				+ "group by et.system_id, et.name order by et.name;";

/ Hardcoded!

		List<Map<String, Integer>> resultList = mySQLQuery.list();
[{count=27, eventType=26631835}]
/ 26631835=POD

		SQLQuery mySQLQuery = session.createSQLQuery(myQuery);

select et.system_id as "eventType", count(distinct service_order_systemid) as "count" 
/=select et.system_id as "eventType", count(distinct ev.service_order_systemid) as "count" 
from event_event ev, event_type et 
where ev.event_template_systemid is null 
and ev.created_date > ? 
and ev.event_type_systemid = et.system_id 
and ev.organization_systemid in (?, ?, ?, ?, ?, ?) 
and (ev.actual_value is null or ev.actual_value = '') 
and et.name like ? and et.description like ? 
group by et.system_id, et.name order by et.name;

/ Dus event is unexpected als z'n template is null , en actual_value is null of =''	,
/ TODO

29263 2015-03-04 09:36:06,517 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-4:) binding para      meter [1] as [TIMESTAMP] - Thu Dec 04 09:35:32 CET 2014
29265 2015-03-04 09:36:06,522 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-4:) binding para      meter [2] as [INTEGER] - 103
29257 2015-03-04 09:36:06,503 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-4:) binding para      meter [3] as [INTEGER] - 4000
29259 2015-03-04 09:36:06,507 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-4:) binding para      meter [4] as [INTEGER] - 3150
29253 2015-03-04 09:36:06,495 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-4:) binding para      meter [5] as [INTEGER] - 101
29251 2015-03-04 09:36:06,489 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-4:) binding para      meter [6] as [INTEGER] - 102
29249 2015-03-04 09:36:06,484 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-4:) binding para      meter [7] as [INTEGER] - 1 
29261 2015-03-04 09:36:06,512 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-4:) binding para      meter [8] as [VARCHAR] - %
29255 2015-03-04 09:36:06,499 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-4:) binding para      meter [9] as [VARCHAR] - %

/ we doen zelf	,

select et.system_id as "eventType", count(distinct service_order_systemid) as "count" 
from event_event ev, event_type et 
where ev.event_template_systemid       is null 
and ev.created_date > 'Thu Dec 04 09:35:32 CET 2014'
and ev.event_type_systemid = et.system_id 
and ev.organization_systemid in (103,4000,3150,101,102,1)
and (ev.actual_value is null or ev.actual_value = '') 
and et.name like '%' and et.description like '%' 
group by et.system_id, et.name order by et.name;

 eventType | count 
-----------+-------
  26631835 |    27
(1 row)


 


		Collection<EventType> eventTypeList = MpoBeanFactory.getBean(EventTypeDAO.class).getAll();
[POD, CONF, CCD, VCD, ICD, ALP, DLP, STL, FNL, STD, FND, LDC, VLD, ISD, SBT, QCF, BRR, DHB, QC_CC, QC_VC, RTD, ADP, DDP]

/t
/ dan	,
UnExpectedEventDashboardItemDataProvider.iterator(int, int) line: 56	
		return ((EventDashboardItemDAO) daoWrapper.getBean()).getUnexpectedDashboardItems(filter).iterator();
/ daoWrapper=EventDashboardItemDAO	,
/ Weer dezelfde	,

select count(distinct eventvo0_.SERVICE_ORDER_SYSTEMID) as col_0_0_, eventvo0_.EVENT_STATUS as col_1_0_, eventvo0_.ORGANIZATION_SYSTEMID as col_2_0_ 
from EVENT_EVENT eventvo0_ 
where eventvo0_.EVENT_TYPE_SYSTEMID=? 
and eventvo0_.CREATED_DATE>? 
and (eventvo0_.CLOSED_ON is null) 
and (eventvo0_.EXPECTED_END is not null) 
and (
	eventvo0_.EVENT_TEMPLATE_SYSTEMID<>0 
	or eventvo0_.EVENT_TEMPLATE_SYSTEMID is not null
) 
group by eventvo0_.EVENT_STATUS , eventvo0_.EVENT_TYPE_SYSTEMID , eventvo0_.ORGANIZATION_SYSTEMID

2015-03-03 16:20:57,869 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [1] as [INTEGER] - 26631835
2015-03-03 16:20:57,869 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [2] as [TIMESTAMP] - Wed Dec 03 16:20:57 CET 2014


/ Einde DEBUG MPO-81

/ SCS-4397

/ in trunk	,
$ vi application.properties

base.product = pnloms
build.war.dir = /home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/${base.product}/deploy/tms.war/
jboss.configuration = ${base.product}

[eric@localhost server]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server
[eric@localhost server]$ ls -ltr
...
drwxrwxr-x. 9 eric eric 4096 Mar  4 15:06 pnloms

$ vi application.properties

base.product = mposcs 
build.war.dir = /home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/${base.product}/deploy/tms.war/
jboss.configuration = ${base.product}

[eric@localhost server]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server
[eric@localhost server]$ ls -ltr
...
drwxrwxr-x. 9 eric eric 4096 Mar  4 15:09 mposcs

/ Einde SCS-4397

/ DEBUG SCS-4524

/ Kes Configuration, Resources, Resource	,

/s

com.mpobjects.capabletopromise.view.wicket.resource.ResourcePage.<init>
		daoWrapper = new BeanWrapper(ResourceDAO.class);

$ vi Resource.standard.hbm.xml
<hibernate-mapping auto-import="false">
	<class name="com.mpobjects.capabletopromise.model.entity.resource.Resource"	table="CTP_RESOURCE">

pnloms=# select*from ctp_resource;
 system_id | name | description | organization_systemid | resource_type_systemid | is_deleted | is_updated | longitude | latitude | referen
ce1 | reference2 | reference3 | reference4 | reference5 | reference6 | reference7 | reference8 | reference9 | reference10 
-----------+------+-------------+-----------------------+------------------------+------------+------------+-----------+----------+--------
----+------------+------------+------------+------------+------------+------------+------------+------------+-------------
(0 rows)

/s
		createNewButton();
/s
	protected void createNewButton() {
		Form<T> createForm = new Form<T>("createForm");
		add(createForm);
		createButton = new AjaxFallbackButton("createButton", createForm) {
			@Override
			protected void onSubmit(AjaxRequestTarget aTarget, Form<?> aForm) {
->				ResourceEditFormPage page = getEditPage();
/s
ResourcePage.getEditPage() line: 97	
			editPage = new ResourceEditFormPage(daoWrapper, this, null);
/s
ResourceEditFormPage.<init>(BeanWrapper<BaseDAOInterface<Resource>>, BasePage, IModel<Resource>) line: 96	
/s
	protected void createPage() {
		...
		createEditPanel();
/s
	protected void createEditPanel() {
		EntityFormActionBuilder<Resource> myPanelBuilder = new EntityFormActionBuilder<Resource>(getFormActions());
		editPanel = new ResourceEditPanel("editPanel", new WebComponentEventSwitchBoard(), myPanelBuilder, daoWrapper, null);

$ vi ResourceEditPanel.html
/ Hier zie we alle HTML tags.

/ 7	.





/ Einde DEBUG SCS-4524


/ Einde SCS-4524

/ PNL-416

/ 7	.

/ configuration, execution, triggers, service order type trigger
/ click filter, open de (enigste) trigger	,
/ click filters	, we komen in new window	, we zien een dropdownlist met selected item 'ACTUAL DEMURRAGE TIME (SHO)', 
/ klap open, dan  zien we alleen die van type string,

/ configuration, finance, service management, order details	,
/ click filter, we zien ze allemaal, van type string, boolean, ...

/ In de dropdown op service order type trigger moeten ook de booleans komen	,



/ Einde PNL-416

/ DEBUG PNL-416

/ ORDER_DETAIL	,

/ configuration, finance, service management, order details	,
/ dat is OrderDetailListPage	,

/ 7	.

/ CLICK FILTER 

/ als we op filter click vallen we in 	,
	public void initialize() {
		final List<IColumn> myColumnsList = new ArrayList<IColumn>();
		myColumnsList.add(new FilteredAbstractColumn(filterColTitle) {
			@Override
			public void populateItem(final Item cellItem, final String componentId, final IModel model) {
->				Collection<Component> myList = new ArrayList<Component>();

		makeTable(myColumnsList);

	protected void makeTable(List<IColumn> aColumnsList) {

		objectDataTable = getDefaultDataTable(aColumnsList);
		filterForm = new FilterForm("filterForm", dataProvider);
/ TODO

/ Einde CLICK FILTER 

/ 7	.

/ wat zien we?

/ order details	, 
/ want	,

OrderDetailListPage.createListPanel() line: 71	
		searchListPanel = new OrderDetailListPanel("searchList", null, webComponentEventSwitchBoard, daoWrapper);
/ daoWrapper=rond OrderDetailDAO	,

$ vi OrderDetail.standard.hbm.xml

   <class name="com.mpobjects.oms.ratecalc.model.orderdetail.vo.OrderDetail" lazy="false" table="ORDER_DETAIL">

/ lazy="false"
/ TODOHIBERNATE

pnloms=# \d+ order_detail
                                     Table "public.order_detail"
         Column          |          Type          | Modifiers | Storage  | Stats target | Description 
-------------------------+------------------------+-----------+----------+--------------+-------------
 parameter_type_systemid | integer                |           | plain    |              | 
Foreign-key constraints:
    "od_par_type_systemid" FOREIGN KEY (parameter_type_systemid) REFERENCES parameter_type(system_id)

pnloms=# select*from parameter_type;
 system_id |   name   | description | is_deleted 
-----------+----------+-------------+------------
   3700001 | STRING   |             |          0
   3700002 | INTEGER  |             |          0
   3700003 | FLOAT    |             |          0
   3700004 | BOOLEAN  |             |          0
   3700005 | DATETIME |             |          0
(5 rows)
pnloms=# select od.name, pt.name from order_detail od join parameter_type pt on od.parameter_type_systemid =pt.system_id;
          name           |   name   
-------------------------+----------
 SHIP WEIGHT             | INTEGER
 SHIP VOLUME             | INTEGER
 BILL_TO_PARTY_GROUPS    | STRING
 TO_PARTY_TYPE           | STRING
 FROM_PARTY_TYPE         | STRING
 ORGANIZATION_ID         | STRING
 CARRIER                 | STRING
 BOOKING DATE            | DATETIME
 FROM COUNTRY            | STRING
 VOLUME                  | INTEGER
 TO POSTALCODE           | STRING
...
 NO_VALIDATION_REQ       | STRING
 EDT Trailer             | BOOLEAN
 EDT Laadvenstertype     | STRING
 FROM POSTALCODE         | STRING

pnloms=# select od.name, pt.name from order_detail od join parameter_type pt on od.parameter_type_systemid =pt.system_id where pt.name='BOOLEAN';
    name     |  name   
-------------+---------
 EDT Trailer | BOOLEAN
 EDT Trailer | BOOLEAN
(2 rows)

pnloms=# select od.name, pt.name from order_detail od join parameter_type pt on od.parameter_type_systemid =pt.system_id where pt.name='INTEGER';
        name        |  name   
--------------------+---------
 SHIP WEIGHT        | INTEGER
 SHIP VOLUME        | INTEGER
 VOLUME             | INTEGER
 ACT_VOLUME         | INTEGER
 CALC_VOLUME        | INTEGER
 WEIGHT             | INTEGER
 ACT_WEIGHT         | INTEGER
 CALC_WEIGHT        | INTEGER
 CALC_LDM           | INTEGER
 NR_OF_DELIVERIES   | INTEGER
 EDT HANDLINGTIME   | INTEGER
 NR_OF_CONSIGNMENTS | INTEGER
 NR_OF_COLLECTIONS  | INTEGER

pnloms=# select od.name, pt.name from order_detail od join parameter_type pt on od.parameter_type_systemid =pt.system_id where pt.name='DATETIME';
       name        |   name   
-------------------+----------
 BOOKING DATE      | DATETIME
 ACTUAL END        | DATETIME
 REQ END           | DATETIME
 REQ_END_AFTER     | DATETIME
 REQ_START_BEFORE  | DATETIME
 REQ_END_BEFORE    | DATETIME
 REQ_START_AFTER   | DATETIME
 PLANNED_START_DTM | DATETIME
 PLANNED_END_DTM   | DATETIME
 REQ_END           | DATETIME
 REQ_END_BEFORE    | DATETIME
 REQ_START_AFTER   | DATETIME
 REQ_START_BEFORE  | DATETIME
 REQ_END_AFTER     | DATETIME
 ACTUAL END        | DATETIME
(15 rows)





/ 7	.

/ EDIT DELETE BUTTONS ON PANEL IN LIST

/ create page	,

public class OrderDetailListPage extends BaseContextPage {
	protected void createListPanel() {
		searchListPanel = new OrderDetailListPanel("searchList", null, webComponentEventSwitchBoard, daoWrapper);
		searchListPanel.setPanelBuilder(new EntityListActionBuilder<OrderDetail>(getPanelActions()));


/ click filter	,

abstract public class GenericListPanel<T extends EntityInterface> extends BaseWebComponent {
	public void initialize() {
		myColumnsList.add(new FilteredAbstractColumn(filterColTitle) {
			@Override
			public void populateItem(final Item cellItem, final String componentId, final IModel model) {
				Collection<Component> myList = new ArrayList<Component>();
->				myList.add(GenericListPanel.this.createNewListPanel(componentId + "-actions", model));
/s
OrderDetailListPanel(GenericListPanel).createNewListPanel(String, IModel<T>) line: 398	
		AbstractActionsPanel<T> myPanel = panelBuilder.build(componentId, webComponentEventSwitchBoard, this, model);
/s
EntityListActionBuilder.build(String, WebComponentEventSwitchBoard, GenericListPanel<T>, IModel<T>) line: 44	
		return new EntityActionPanel(aId, aParent, aWebComponentEventSwitchBoard, aModel);


/ Einde EDIT DELETE BUTTONS ON PANEL IN LIST

/ 7	.

/ we click op Edit button op een row=OrderDetail	,

OrderDetailListPage$2.onSubmit(Button, AjaxRequestTarget, IModel<OrderDetail>) line: 120	
		EntityActionButton<OrderDetail> editButton = new EntityActionAjaxButton<OrderDetail>("edit", new ResourceModel("edit")) {
			@Override
			protected void onSubmit(Button aButton, AjaxRequestTarget aTarget, IModel<OrderDetail> aSelection) {
				OrderDetailEditPage page = getEditPage();
/s
OrderDetailListPage.getEditPage() line: 105	
			editPage = new OrderDetailEditPage(daoWrapper, this);
/ daoWrapper=OrderDetailDAO
...
/s
OrderDetailEditPage.createHeaderEditPanel() line: 70	
		EntityFormActionBuilder<OrderDetail> panelBuilder = new EntityFormActionBuilder<OrderDetail>(getFormActions());

/ Hier komen de Save, Cancel buttons op	, dat zijn de 2 form actions	,

/ Intermezzo

/ Er zijn dus EntityListActionBuilder, EntityFormActionBuilder	,

$ vi EntityListActionBuilder
	public AbstractActionsPanel<T> build(String aId, WebComponentEventSwitchBoard aWebComponentEventSwitchBoard, GenericListPanel<T> aParent, IModel<T> aModel) {
		return new EntityActionPanel(aId, aParent, aWebComponentEventSwitchBoard, aModel);
	}


$ vi EntityFormActionBuilder	,
	public AbstractActionsPanel<T> build(String aId, GenericCompountPropertyModel<T> aModel, WebComponentEventSwitchBoard aWebComponentEventSwitchBoard, GenericFormPanel<T> aParent) {
		return new EntityActionPanel(aId, aParent, aWebComponentEventSwitchBoard, aModel);

/ wH hetzelfde	,

/ Einde Intermezzo

/t
	protected void createHeaderEditPanel() {
		EntityFormActionBuilder<OrderDetail> panelBuilder = new EntityFormActionBuilder<OrderDetail>(getFormActions());
/ builds buttons panel (Save, Cancel)
		editPanel = new OrderDetailEditPanel("editPanel", webComponentEventSwitchBoard, panelBuilder, daoWrapper);
/ builds form panel (Name, Expression, ...)

/ In detail	,
		EntityFormActionBuilder<OrderDetail> panelBuilder = new EntityFormActionBuilder<OrderDetail>(getFormActions());
/d
		editPanel = new OrderDetailEditPanel("editPanel", webComponentEventSwitchBoard, panelBuilder, daoWrapper);
/s
		super(aId, null, aWebComponentEventSwitchBoard, null, aPanelBuilder, aDaoWrapper);
/s
OrderDetailEditPanel(GenericFormPanel).<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, T, FormActionsPanelBuilder<T>, BeanWrapper<BaseDAOInterface<T>>) line: 52	

			myObject = daoWrapper.getBean().createNewObject();

		if (formActionsPanelBuilder != null) {
			panelBuilder = formActionsPanelBuilder;

///////////////////////////////////////
/ Hiermee overwrite we	, wat eerder in <init> was gedaan	,
	protected FormActionsPanelBuilder<T> panelBuilder = new FormCrudActionsPanel.Builder<T>();
///////////////////////////////////////

/////////////////////////////////////////////
/ Er zijn OrderDetailListPanel, en OrderDetailEditPanel	, 
/ Eerder: OrderDetailListPanel, nu OrderDetailEditPanel	,

		createPanel(new GenericCompountPropertyModel<T>(myObject));
/ myObject is een new OrderDetail	,
/s
OrderDetailEditPanel(GenericFormPanel).createPanel(GenericCompountPropertyModel<T>) line: 163	
		AbstractActionsPanel<T> actionPanel = getActionsPanel("actionPanel", model);
/s
		return panelBuilder.build(componentId, model, webComponentEventSwitchBoard, this);
/ panelBuilder=EntityFormActionBuilder	,
/s
/////////////////////////////////
/ we komen weer in	,
	public AbstractActionsPanel<T> build(String aId, GenericCompountPropertyModel<T> aModel, WebComponentEventSwitchBoard aWebComponentEventSwitchBoard,
			GenericFormPanel<T> aParent) {
->		return new EntityActionPanel(aId, aParent, aWebComponentEventSwitchBoard, aModel);
/s
BaseActionBuilder$EntityActionPanel.<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, IModel<T>) line: 34	
			RepeatingView view = new RepeatingView("actions");
			createActions(view, aModel);
/s
EntityFormActionBuilder(BaseActionBuilder).createActions(RepeatingView, IModel<T>) line: 75	
		for (EntityAction<T> action : actions) {
			Component component = action.createComponent(view.newChildId(), aModel);
/s
OrderDetailEditPage$1(EntityActionButton).createComponent(String, IModel<T>) line: 49	
		return new EntityABPanel(aComponentId, createButton(aModel, "button"));
/s
OrderDetailEditPage$1(AbstractEntityActionButton).createButton(IModel<T>, String) line: 207	
		button = createButtonInstance(aModel, aId);
/ TODO (Afmaken )

/t
AbstractEntityActionButton$EntityABPanel.<init>(String, Button) line: 58	
	public static class EntityABPanel extends Panel {
		public EntityABPanel(String aId, Button aButton) {
->			super(aId);
			add(aButton);

/t
EntityFormActionBuilder(BaseActionBuilder).createActions(RepeatingView, IModel<T>) line: 76	
		for (EntityAction<T> action : actions) {
			Component component = action.createComponent(view.newChildId(), aModel);
/d
component	AbstractEntityActionButton$EntityABPanel  (id=19853)	
f (component != null) {
				view.add(component);
...
/ t
OrderDetailEditPanel(GenericFormPanel).createPanel(GenericCompountPropertyModel<T>) line: 168	
		AbstractActionsPanel<T> actionPanel = getActionsPanel("actionPanel", model);
		...
		setForm(form);
/s
OrderDetailEditPanel.setForm(GenericForm<OrderDetail>) line: 67	



/t
OrderDetailEditPage.createHeaderEditPanel() line: 71	
		EntityFormActionBuilder<OrderDetail> panelBuilder = new EntityFormActionBuilder<OrderDetail>(getFormActions());
/d
		editPanel = new OrderDetailEditPanel("editPanel", webComponentEventSwitchBoard, panelBuilder, daoWrapper);
/s

/ 7	.

/ SERVICE ORDER TYPE TRIGGER

/ configuration, execution, triggers, service order type trigger	,

/ we zien SotTriggerListPage.java/.html

SotTriggerListPage.createListPanel() line: 69	

		searchListPanel = new SotTriggerSearchListPanel("searchList", null, webComponentEventSwitchBoard, daoWrapper);
		searchListPanel.setPanelBuilder(new EntityListActionBuilder<ServiceOrderTypeTrigger>(getPanelActions()));
		searchListPanel.initialize();
/ In detail,

		searchListPanel = new SotTriggerSearchListPanel("searchList", null, webComponentEventSwitchBoard, daoWrapper);
/ hele ding	, 
		searchListPanel.setPanelBuilder(new EntityListActionBuilder<ServiceOrderTypeTrigger>(getPanelActions()));
/ overwrites panelBuilder, deze doet	,	
	return new EntityActionPanel(aId, aParent, aWebComponentEventSwitchBoard, aModel);
		searchListPanel.initialize();
/ create columns, table, filters (TODO)	,
/ maar NIET: data (rows)	, dat zien we ook , we zien geen rows, alleen filter	, 

/ 13	. 

SotTriggerSearchListPanel(GenericListPanel).initialize() line: 292	
		searchListPanel = new SotTriggerSearchListPanel("searchList", null, webComponentEventSwitchBoard, daoWrapper);
		...
		searchListPanel.initialize();
/s
SotTriggerSearchListPanel(GenericListPanel).initialize() line: 292	

/ Eerst de filter column	, dan de overige columns	,

////////////////////
/ filter column, met de action-panel met buttons Edit, Delete	, op de ROW dus, NIET in de header!
		myColumnsList.add(new FilteredAbstractColumn(filterColTitle) {
			@Override
			public void populateItem(final Item cellItem, final String componentId, final IModel model) {
				...

/ de overige columns	,
		addFilterColumns(myColumnsList);
/s
SotTriggerSearchListPanel.addFilterColumns(List<IColumn>) line: 48	
		aColumnList.add(new ConfigurableTextFilteredPropertyColumn<String>(getModel("organization"), "organization.code", "organization.code", new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<String>(10)));
		aColumnList.add(new ConfigurableTextFilteredPropertyColumn<String>(getModel("name"), NAME, NAME, new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<String>(10)));
		aColumnList.add(new ConfigurableTextFilteredPropertyColumn<String>(getModel("service.order.type"), "serviceOrderType.code", "serviceOrderType.code", new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<String>(10)));

/ er is ook	,, 	
	private IModel<String> getModel(String aString) {
		return new StringResourceModel(aString, this, getDefaultModel());

/ Deze wordt inderdaad called in addFilterColumns hierboven	,

/ 13	. 

/ als we click op filter button	, dan in	,
		myColumnsList.add(new FilteredAbstractColumn(filterColTitle) {
			@Override
			public void populateItem(final Item cellItem, final String componentId, final IModel model) {
->				...
				myList.add(GenericListPanel.this.createNewListPanel(componentId + "-actions", model));
				Panel myActionPanel = new GenericListPanel.ActionPanel(componentId, myList);
/ Intermezzo

/ Er zijn 2 panels	,
[0]	BaseActionBuilder$EntityActionPanel  (id=22537)	
/ er is een BaseActionBuilder$EntityActionPanel.html

GenericListPanel.ActionPanel
/ er is ook een GenericListPanel.ActionPanel.html

$ vi GenericListPanel.ActionPanel.html
<wicket:panel>
	<div id="entity-actions">
		<span wicket:id="entity-actions"></span>
		<wicket:child />
	</div>
</wicket:panel>

$ vi BaseActionBuilder$EntityActionPanel.html
<wicket:panel>
	<span wicket:id="actions"></span>
	<wicket:child />
</wicket:panel>

/ TODO

/ Einde Intermezzo

/ In detail	,
		searchListPanel = new SotTriggerSearchListPanel("searchList", null, webComponentEventSwitchBoard, daoWrapper);
/ daoWrapper=ServiceOrderTypeTriggerDAO

$ vi ServiceOrderTypeTriggerDAO.standard.hbm.xml
	<class name="com.mpobjects.oms.model.trigger.ServiceOrderTypeTrigger" table="SO_TYPE_TRIGGER">

pnloms=# select*from so_type_trigger;
 system_id |           name           | on_start | on_end | so_type_systemid | on_plan | on_release | on_planned_start_change | on_planned_
end_change | on_create | filter_expression | organization_systemid | on_update | expression_update | on_pre_calc_approval | on_post_calc_ap
proval 
-----------+--------------------------+----------+--------+------------------+---------+------------+-------------------------+------------
-----------+-----------+-------------------+-----------------------+-----------+-------------------+----------------------+----------------
-------
  26673498 | SERVICE_ORDER_MSG_EXPORT |        0 |      0 |         26673359 |       0 |          1 |                       0 |            
         0 |         0 |                   |                  1000 |         1 | \x5c783030        |                    0 |                
     0
(1 row)


/ 7	.

/ click Edit op een row	, 

/s
SotTriggerListPage$2.onSubmit(Button, IModel<ServiceOrderTypeTrigger>) line: 120	
/=
	protected Collection<EntityAction<ServiceOrderTypeTrigger>> getPanelActions() {
		List<EntityAction<ServiceOrderTypeTrigger>> actions = new ArrayList<EntityAction<ServiceOrderTypeTrigger>>();
		EntityActionButton<ServiceOrderTypeTrigger> editAction = new EntityActionButton<ServiceOrderTypeTrigger>("edit",
				new ResourceModel("edit").wrapOnAssignment(SotTriggerListPage.this)) {
			@Override
			protected void onSubmit(Button aButton, IModel<ServiceOrderTypeTrigger> aSelection) {
->				SotTriggerEditPage page = getEditPage();
/s
			editPage = new SotTriggerEditPage(daoWrapper, this);
/s

////////////////////////////////
/ Zojuist waren we in SotTriggerListPage, nu in SotTriggerEditPage	,

/s
SotTriggerEditPage.createPage() line: 54	
		EntityFormActionBuilder<ServiceOrderTypeTrigger> panelBuilder = new EntityFormActionBuilder<ServiceOrderTypeTrigger>(getActions());
/ buttons	,
		editPanel = new SotTriggerEditPanel("editPanel", webComponentEventSwitchBoard, panelBuilder, daoWrapper);
/ form	,

/ dao=com.mpobjects.oms.dao.trigger.ServiceOrderTypeTriggerDAO
$ vi ServiceOrderTypeTrigger.standard.hbm.xml 
	<class name="com.mpobjects.oms.model.trigger.ServiceOrderTypeTrigger" table="SO_TYPE_TRIGGER">

/ s
SotTriggerEditPanel.setForm(GenericForm<ServiceOrderTypeTrigger>) line: 92	

$ vi SotTriggerEditPage.html

<wicket:extend>
	<div wicket:id="feedback"></div>	
	<div wicket:id="editPanel">binaryEdit</div>
</wicket:extend>

$ vi SotTriggerEditPanel.html
		...
		<tr>
			<td class="label" valign="top"><wicket:message key="filter">Filter</wicket:message></td>
			<td valign="top"><span wicket:id="filterRule"></span></td>
		</tr>
/ Klopt, in deze <span> zit alles	,

/s
SotTriggerEditPanel(GenericFormPanel).<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, T, FormActionsPanelBuilder<T>, BeanWrapper<BaseDAOInterface<T>>) line: 70	
			myObject = daoWrapper.getBean().createNewObject();
/ new ServiceOrderTypeTrigger()	,
/t
		createPanel(new GenericCompountPropertyModel<T>(myObject));
/s
SotTriggerEditPanel(GenericFormPanel).createPanel(GenericCompountPropertyModel<T>) line: 163	
		form = new GenericForm<T>("genericForm", model);
/ form met een compoundpropertymodel rond een ServiceOrderTypeTrigger	,

		AbstractActionsPanel<T> actionPanel = getActionsPanel("actionPanel", model);
/ de actions vinden we in SotTriggerEditPage	,
	protected Collection<EntityAction<ServiceOrderTypeTrigger>> getActions() {
...
/s
SotTriggerEditPanel(GenericFormPanel).createPanel(GenericCompountPropertyModel<T>) line: 166	
		AbstractActionsPanel<T> actionPanel = getActionsPanel("actionPanel", model);
/s
		return panelBuilder.build(componentId, model, webComponentEventSwitchBoard, this);
/s
EntityFormActionBuilder.build(String, GenericCompountPropertyModel<T>, WebComponentEventSwitchBoard, GenericFormPanel<T>) line: 37	
		return new EntityActionPanel(aId, aParent, aWebComponentEventSwitchBoard, aModel);
/s
BaseActionBuilder$EntityActionPanel.<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, IModel<T>) line: 34	
/ dit is het panel	,
			createActions(view, aModel);
/s
EntityFormActionBuilder(BaseActionBuilder).createActions(RepeatingView, IModel<T>) line: 75	
		for (EntityAction<T> action : actions) {
[com.mpobjects.oms.view.wicket.serviceordertypetrigger.SotTriggerEditPage$1@10f57dd0, com.mpobjects.oms.view.wicket.serviceordertypetrigger.SotTriggerEditPage$2@6516eb62, com.mpobjects.oms.view.wicket.serviceordertypetrigger.SotTriggerEditPage$3@43b7a2c7]

/ Intermezzo

/ In SotTriggerEditPage.java

	protected Collection<EntityAction<ServiceOrderTypeTrigger>> getActions() {
		EntityActionButton<ServiceOrderTypeTrigger> saveBtn = new EntityActionButton<ServiceOrderTypeTrigger>("ok", new ResourceModel("save")) {
		EntityActionButton<ServiceOrderTypeTrigger> saveAndCloseBtn = new EntityActionButton<ServiceOrderTypeTrigger>("ok", new ResourceModel("saveAndClose")) {
		EntityActionButton<ServiceOrderTypeTrigger> cancelReportBtn = new EntityActionButton<ServiceOrderTypeTrigger>("cancel", new ResourceModel("cancel")) {
		...
		return myActionList;
	}


		EntityFormActionBuilder<ServiceOrderTypeTrigger> panelBuilder = new EntityFormActionBuilder<ServiceOrderTypeTrigger>(getActions());
/ dus de panelBuilder heeft de  3 actions	, 
		editPanel = new SotTriggerEditPanel("editPanel", webComponentEventSwitchBoard, panelBuilder, daoWrapper);

/ dus de panelBuilder wordt meegegeven aan de SotTriggerEditPanel	, is een GenericFormPanel	, die	,

$ vi GenericFormPanel.java

	public GenericFormPanel(final String id, BaseWebComponent parent, final WebComponentEventSwitchBoard aWebComponentEventSwitchBoard, final T anObject, FormActionsPanelBuilder<T> formActionsPanelBuilder, BeanWrapper<? extends BaseDAOInterface<T>> aDaoWrapper) {

			panelBuilder = formActionsPanelBuilder;
		createPanel(new GenericCompountPropertyModel<T>(myObject));
/s
	protected void createPanel(GenericCompountPropertyModel<T> model) {
		AbstractActionsPanel<T> actionPanel = getActionsPanel("actionPanel", model);
/s
	protected AbstractActionsPanel<T> getActionsPanel(String componentId, GenericCompountPropertyModel<T> model) {
		return panelBuilder.build(componentId, model, webComponentEventSwitchBoard, this);
/s


/ Einde Intermezzo

/ later	,
/s
SotTriggerEditPanel.setForm(GenericForm<ServiceOrderTypeTrigger>) line: 92	
		...
		CheckBox onUpdate = new CheckBox("onUpdate");
		RuleEditButton myFilterButton = new RuleEditButton("filterRule", new PropertyModel<Rule>(this, "object.filterExpressionRule")) {
/ onUpdate, filterExpressionRule zijn beide properties van de ServiceOrderTypeTrigger, waar compoundpropertymodel omheen is	,
/ Waarom apart model voor de property filterExpressionRule property?
/ TODO (Omdat we deze model op de Rule heen nodig hebben in ...) 
/ In GenericFormPanel.java	 
	public T getObject() {
		return form.getModel().getObject();
	}
/ Dus new PropertyModel<Rule>(this, "object.filterExpressionRule"): filterExpressionRule inderdaad in de object van de compound property model van het form , een ServiceOrderTypeTrigger	,

/ een panel in het form naast 'filters'	, als we op het edit (rule) button click verschijnt een modal window	,


/ Intermezzo

/ we zien GenericForm<ServiceOrderTypeTrigger>	,

/ SotTriggerEditPanel's superclass GenericFormPanel heeft 	,
	public T getObject() {
		return form.getModel().getObject();
/ T=ServiceOrderTypeTrigger	, omdate er staat GenericForm<ServiceOrderTypeTrigger>	,

/ een seo type trigger heeft een rule, named filterExpressionRule	,  dat gebeurt in het modal window	,

/ ServiceOrderTypeTrigger extends	,
$ vi AbstractTrigger.java
	private Rule filterExpressionRule = null;

/ dus de so trigger edit panel heeft een property: object, dat een  ServiceOrderTypeTrigger is	, die een property: filterExpressionRule heeft	,  dat een Rule is	, 
/ klopt	: new PropertyModel<Rule>(this, "object.filterExpressionRule")
/ er staat <Rule>	,
/ Dus we write een rule in de seo type trigger	,

/ Einde Intermezzo

/ Intermezzo

/s
SotTriggerEditPanel$1(RuleEditButton).<init>(String, IModel<Rule>) line: 27	
/=
public class RuleEditButton extends Panel {

/ dit is een panel in het form naast 'Filters'	, we zien een <span> met de xpath expr, een edit (rule), delete (rule)	, 
/ als we op het edit (rule) button click verschijnt een modal window	,
/ de add (rule) zien we NIET	, 
/ TODO

$ vi RuleEditButton.html
 
<wicket:panel>
	<span style="background-color: #F0F0F0 ; vertical-align: middle; padding-top: 2px; padding-bottom: 5px; padding-left: 2px; padding-right: 2px; border-style: solid; border-width: 1px; border-color: gray;" wicket:id="ruleText"></span>
	<button class="icon small icon_add" wicket:id="addButton" wicket:message="title:rule.add" />
	<button class="icon small icon_edit" wicket:id="editButton" wicket:message="title:rule.edit" />
	<button class="icon small icon_delete" wicket:id="deleteButton" wicket:message="title:rule.delete" />
	<div wicket:id="lookupWindow"></div>
</wicket:panel>

/ in <span wicket:id="ruleText"> zien we de XPath expr	,  
/ we zien geen id in deze <span>
/ TODO

/ De RuleEditButton heeft als model de Rule uit ServiceOrderTypeTrigger, die filterExpressionRule heet	,

/s
SotTriggerEditPanel$1(RuleEditButton).createPage() line: 43	
		AjaxButton addButton = new AjaxButton("addButton") {
		AjaxButton editButton = new AjaxButton("editButton") {
		AjaxButton deleteButton = new AjaxButton("deleteButton") {
/ de buttons op het panel naast 'filters' op het form	,

		LimitedLabel myRule = new LimitedLabel("ruleText", new PropertyModel<String>(RuleEditButton.this, "model.object.toUserString"), 20) {
/ Hier zien we de xpath expr in	,

		lookupWindow = new ModalWindow("lookupWindow");
		lookupWindow.setPageCreator(new ModalWindow.PageCreator() {
			public Page createPage() {
->				return new ModalRuleEditPage(lookupWindow, model);


/ we zien naast filters in het form op het panel alleen de add-button	,
/ click er op	,
/s
RuleEditButton$1.onSubmit(AjaxRequestTarget, Form) line: 51	
		AjaxButton addButton = new AjaxButton("addButton") {
			protected void onSubmit(AjaxRequestTarget aTarget, Form aForm) {
->				Rule myRule = new Rule();
				Expression myExpression = new Expression(Operator.REGEX);
				myRule.getExpression().addExpression(myExpression);
				RuleEditButton.this.setRule(myRule);

///////////////////////////////
/ sets
/s
SotTriggerEditPanel$1(RuleEditButton).setRule(Rule) line: 38	
		model.setObject(aRule);
		onSetRule(aRule);
/s
SotTriggerEditPanel$1.onSetRule(Rule) line: 145	
/=
		RuleEditButton myFilterButton = new RuleEditButton("filterRule", new PropertyModel<Rule>(this, "object.filterExpressionRule")) {
			public void onSetRule(Rule aRule) {
->				SotTriggerEditPanel.this.getObject().setFilterExpressionRule(aRule);
/////////////////////////////////////
/ sets the new Rule(), in de form's model's object , de ServiceOrderTypeTrigger, in de filterExpressionRule	,

...
/s
ServiceOrderTypeTrigger(AbstractTrigger).setFilterExpressionRule(Rule) line: 121	
		filterExpressionRule = aRule;
		serializeFilterExpressionRule();

/ Waarom ook via	, 
		model.setObject(aRule);
/ komen we in deze fct,
/ TODO


/t
		RuleEditButton myFilterButton = new RuleEditButton("filterRule", new PropertyModel<Rule>(this, "object.filterExpressionRule")) {
				RuleEditButton.this.setRule(myRule);
/d


/ we geven continue	,
/s
RuleEditButton$5.createPage() line: 113	
/=
		lookupWindow.setPageCreator(new ModalWindow.PageCreator() {
			public Page createPage() {
->				return new ModalRuleEditPage(lookupWindow, model);

/ Intermezzo

this	RuleEditButton$5  (id=21314)	
	this$0	SotTriggerEditPanel$1  (id=20945)	
		data	Object[2]  (id=21317)	
			[0]	PropertyModel  (id=20946)	
Model:classname=[org.apache.wicket.model.PropertyModel]:nestedModel=[[MarkupContainer [Component id = editPanel]]]:expression=[object.filterExpressionRule]
			[1]	MetaDataEntry  (id=21318)	
/ TODO

/ model=PropertyModel om de rule	,

/ Einde Intermezzo


$ vi ModalRuleEditPage.html
<wicket:extend>
	<div wicket:id="rulepanel"></div>
</wicket:extend>

/ De ModalRuleEditPage zien we in het modalWindow	,

/ Waarom is deze pagina er?
/ TODO

$ vi ModalRuleEditPage.java
		RulePanel myPanel = new RulePanel("rulepanel", aModel.getObject()) {
/s
ModalRuleEditPage$1(RulePanel).<init>(String, Rule) line: 35	

$ vi RulePanel.html

<wicket:panel>
	<form wicket:id="form">
		<div wicket:id="feedback"></div>
		<div wicket:id="groupExpression" ></div>
		<div class="button">
			<input type="button" class="icon icon_ok" wicket:id="saveButton" value="Save rule" /> &nbsp;
			<input type="button" class="icon icon_cancel" wicket:id="cancelButton" value="Cancel" />
		</div>
	</form>
</wicket:panel>

/s
	public RulePanel(String aName, Rule aRule) {
		super(aName);
		model = new CompoundPropertyModel<Rule>(aRule);
		setDefaultModel(model);

/ Intermezzo

this	ModalRuleEditPage$1  (id=21353)	
	data	CompoundPropertyModel  (id=21354)	
		target	Rule  (id=21016)	


this	SotTriggerEditPanel$1  (id=20945)	
	data	PropertyModel  (id=20946)	
		expression	"object.filterExpressionRule" (id=19134)	
		target	SotTriggerEditPanel  (id=20937)	
/ Klopt	, de property liep via het panel,

/ In meer detail	,
	data
Model:classname=[org.apache.wicket.model.PropertyModel]:nestedModel=[[MarkupContainer [Component id = editPanel]]]:expression=[object.filterExpressionRule]

/ Einde Intermezzo


/ Na setDefaultModel is this.data==this.model	,
this	ModalRuleEditPage$1  (id=19839)	
	data	CompoundPropertyModel  (id=19895)	
		target	Rule  (id=19782)	
jx:shipmentOrder:./entityDetailValueMap[@name='Actual Demurrage time'] REGEX null
/ dit zie je als er al een rule is	,

		createPage();
/s
ModalRuleEditPage$1(RulePanel).createPage() line: 48	
		final Form<Rule> myForm = new Form<Rule>("form", model);
/model = CompoundPropertyModel op de  rule	, 

		myForm.add(new GroupExpressionPanel("groupExpression", new PropertyModel<GroupExpression>(model, "expression")));

/ Dus de rule.expression wordt model van GroupExpressionPanel	, 
/ Klopt, rule.expression is een GroupExpression	,
/s

/ dit is wat we zien , met Match , en de expressions (lines zijn expressions)	, 
/ TODO

$ vi GroupExpressionPanel.html

	<div class="groupExpression">
		<table>
			<wicket:enclosure child="type">
				<tr>
					<td><label><wicket:message key="match">Match</wicket:message> </label>
					</td>
					<td><select wicket:id="type" />
					</td>
					<td>&nbsp;</td>
				</tr>
			</wicket:enclosure>
			...
			<tr wicket:id="expressionList">
				<td valign="top"><span wicket:id="expression"></span></td>
				<td valign="top"><span class="button">
						<button type="submit" class="icon icon_row_add_after small" wicket:id="add" title="Add"></button>&nbsp;
						<button type="submit" class="icon icon_row_delete small" wicket:id="delete" title="Delete"></button>&nbsp;
						<button type="submit" class="icon icon_column_add_after small" wicket:id="addGroup" title="Add Group"></button> </span>
				</td>
		</table>
	</div>

/s
	public GroupExpressionPanel(String aName, IModel<GroupExpression> aModel) {
		super(aName, aModel);

/ Intermezzo

aModel	PropertyModel  (id=21367)	
	expression	"expression" (id=19709)	
	target	CompoundPropertyModel  (id=21354)	
		target	Rule  (id=21016)	

/ In meer detail	,

aModel	PropertyModel  (id=21367)	
Model:classname=[org.apache.wicket.model.PropertyModel]:nestedModel=[Model:classname=[org.apache.wicket.model.CompoundPropertyModel]:nestedModel=[null REGEX null]]:expression=[expression]
	expression	"expression" (id=19709)	
	target	CompoundPropertyModel  (id=21354)	
Model:classname=[org.apache.wicket.model.CompoundPropertyModel]:nestedModel=[null REGEX null]
		target	Rule  (id=21016)	
null REGEX null

/ dit is model om rule.expression, is een GroupExpression	,
/ nested models : een PropertyModel, op property "expression", om een CompoundPropertyModel om een rule heen	,

/ dit is de default model hieronder	,


/ Einde Intermezzo
		createPage();
/s
	protected void createPage() {

/ getDefaultModel is de GroupExpression uit de Rule	, 

/ Match: ALL/ANY dropdown	, GroupExpression's type	,
		DropDownChoice<GroupExpressionType> myGroupExpressionType = new DropDownChoice<GroupExpressionType>("type", new PropertyModel<GroupExpressionType>( getDefaultModel(), "type"), Arrays.asList(GroupExpressionType.values())) {
			...
/ getDefaultModel() is ... model om een rule.expression, een GroupExpression	,

/ Intermezzo

/ Nested models	,
myGroupExpressionType	GroupExpressionPanel$1  (id=20379)	
	data	PropertyModel  (id=20380)	
		expression	"type" (id=19698)	
		target	PropertyModel  (id=20002)	
			expression	"expression" (id=19709)	
			target	CompoundPropertyModel  (id=19999)	
				target	Rule  (id=19782)	

/ Dus een model om rule.expression.type	,

/ In meer detail, met prints	,

	data	PropertyModel  (id=20380)	
Model:classname=[org.apache.wicket.model.PropertyModel]:nestedModel=[Model:classname=[org.apache.wicket.model.PropertyModel]:nestedModel=[Model:classname=[org.apache.wicket.model.CompoundPropertyModel]:nestedModel=[jx:shipmentOrder:./entityDetailValueMap[@name='Actual Demurrage time'] REGEX null]]:expression=[expression]]:expression=[type]
		expression	"type" (id=19698)	
		target	PropertyModel  (id=20002)	
Model:classname=[org.apache.wicket.model.PropertyModel]:nestedModel=[Model:classname=[org.apache.wicket.model.CompoundPropertyModel]:nestedModel=[jx:shipmentOrder:./entityDetailValueMap[@name='Actual Demurrage time'] REGEX null]]:expression=[expression]
			expression	"expression" (id=19709)	
			target	CompoundPropertyModel  (id=19999)	
Model:classname=[org.apache.wicket.model.CompoundPropertyModel]:nestedModel=[jx:shipmentOrder:./entityDetailValueMap[@name='Actual Demurrage time'] REGEX null]
				target	Rule  (id=19782)	
jx:shipmentOrder:./entityDetailValueMap[@name='Actual Demurrage time'] REGEX null


/ Einde Intermezzo


		final ListView<BooleanExpression> myNestedRuleView = new ListView<BooleanExpression>("expressionList", new PropertyModel<List<BooleanExpression>>( getDefaultModel(), "expressionList")) {

/ model om rule.expression.expressionList	,

/ Intermezzo

this	GroupExpressionPanel  (id=20001)	
myNestedRuleView	GroupExpressionPanel$2  (id=20459)	
	data	PropertyModel  (id=20461)	
		expression	"expressionList" (id=20462)	
		target	PropertyModel  (id=20002)	
			expression	"expression" (id=19709)	
			target	CompoundPropertyModel  (id=19999)	
				target	Rule  (id=19782)	

/ Meer detail	,

	data	PropertyModel  (id=20461)	
Model:classname=[org.apache.wicket.model.PropertyModel]:nestedModel=[Model:classname=[org.apache.wicket.model.PropertyModel]:nestedModel=[Model:classname=[org.apache.wicket.model.CompoundPropertyModel]:nestedModel=[jx:shipmentOrder:./entityDetailValueMap[@name='Actual Demurrage time'] REGEX null]]:expression=[expression]]:expression=[expressionList]
		expression	"expressionList" (id=20462)	
		target	PropertyModel  (id=20002)	
Model:classname=[org.apache.wicket.model.PropertyModel]:nestedModel=[Model:classname=[org.apache.wicket.model.CompoundPropertyModel]:nestedModel=[jx:shipmentOrder:./entityDetailValueMap[@name='Actual Demurrage time'] REGEX null]]:expression=[expression]
			expression	"expression" (id=19709)	
			target	CompoundPropertyModel  (id=19999)	
Model:classname=[org.apache.wicket.model.CompoundPropertyModel]:nestedModel=[jx:shipmentOrder:./entityDetailValueMap[@name='Actual Demurrage time'] REGEX null]
				target	Rule  (id=19782)	
jx:shipmentOrder:./entityDetailValueMap[@name='Actual Demurrage time'] REGEX null

/ Einde Intermezzo


		final ListView<BooleanExpression> myNestedRuleView = new ListView<BooleanExpression>("expressionList", new PropertyModel<List<BooleanExpression>>( getDefaultModel(), "expressionList")) {

/ getDefaultModel() is model rule.expressionList , is een GroupExpression	,


/ In wicket:id="expression" komt een ExpressionPanel, met een dropdownlist	, met de order details!	, en nog een dropdown (REGEX) en een text field	,
/ Daarnaast zien we de 3 buttons	, add, delete, add group	,
 click op de add-button	,
/ We zien dan de match zien we als we een 2de rule create	,



/  We geven continue	,
/ we vallen in	,
GroupExpressionPanel$2.populateItem(ListItem<BooleanExpression>) line: 61	
/=
public class GroupExpressionPanel extends Panel {
	protected void createPage() {
		final ListView<BooleanExpression> myNestedRuleView = new ListView<BooleanExpression>("expressionList", new PropertyModel<List<BooleanExpression>>( getDefaultModel(), "expressionList")) {
			protected void populateItem(ListItem<BooleanExpression> aItem) {
->				final GroupExpression myGroup = (GroupExpression) GroupExpressionPanel.this.getDefaultModelObject();
myGroup	GroupExpression  (id=21018)	
	expressionList	ArrayList  (id=21453)	
[null REGEX null]
				final BooleanExpression myExpression = aItem.getModelObject();
[null REGEX null]
				if (myExpression instanceof GroupExpression) {
/ NEE
				} else {
					aItem.add(new ExpressionPanel("expression", new Model<Expression>((Expression) myExpression)));
/s
ExpressionPanel.<init>(String, IModel<Expression>) line: 23	

$ vi ExpressionPanel.html

<wicket:panel>
	<label><wicket:message key="negate">Not</wicket:message></label><input type="checkbox" wicket:id="negate"></input>
	<span wicket:id="leftHand"></span>&nbsp;
	<select wicket:id="operator"/>&nbsp;
	<span wicket:id="rightHand"></span>
</wicket:panel>

$ vi ExpressionPanel.java

	public ExpressionPanel(String aName, IModel<Expression> aModel) {
aModel	Model  (id=21566)	
	object	Expression  (id=21017)	

		super(aName, aModel);
/ Dus =default model	,
		createPage();
/s
	protected void createPage() {

		add(new CheckBox("negate", new PropertyModel<Boolean>(getDefaultModel(), "negate")).setOutputMarkupId(true));

		VariablePanel myLeft = new VariablePanel("leftHand", new PropertyModel<Variable>(getDefaultModel(), "leftHand"), true);
/s
class VariablePanel
	private List<VariableChoice> choiceList = new ArrayList<VariableChoice>();
	protected void createPage() {
		TextField<String> myText = new TextField<String>("input", new PropertyModel<String>(getDefaultModel(), "expression"));

/ Intermezzo

this	VariablePanel  (id=22073)	
	data	PropertyModel  (id=22074)	
		expression	"leftHand" (id=21629)	
		target	Model  (id=22068)	
			object	Expression  (id=21735)	

/ In detail	,
this	VariablePanel  (id=22073)	
	data	PropertyModel  (id=22074)	
Model:classname=[org.apache.wicket.model.PropertyModel]:nestedModel=[Model:classname=[org.apache.wicket.model.Model]:object=[null REGEX null]]:expression=[leftHand]
		expression	"leftHand" (id=21629)	
		target	Model  (id=22068)	
Model:classname=[org.apache.wicket.model.Model]:object=[null REGEX null]
			object	Expression  (id=21735)	
null REGEX null

/ model om variable.lefthand	,
/ Waarom zien we de Variable inst niet in het model?
/ TODO

/ Einde Intermezzo

/ Dus myText is text field op de Variable's leftHand	,

		initChoice();
/s
	private void initChoice() {
		choiceList.addAll(MpoBeanFactory.getBean(VariablePopulationService.class).getVariableChoiceList());
/s
VariablePopulationServiceImpl.getVariableChoiceList() line: 28	
/=
public class VariablePopulationServiceImpl implements VariablePopulationService {
	public List<VariableChoice> getVariableChoiceList() {
		for (OrderDetail myDetail : MpoBeanFactory.getBean(OrderDetailDAO.class).getAll()) {
/s
OrderDetailDAOImpl(GenericHibernateDAO).getAll(boolean) line: 265	
			return (List<Type>) getHibernateTemplate().loadAll(type);
type	Class (com.mpobjects.oms.ratecalc.model.orderdetail.vo.OrderDetail) (id=2936)	

/ we zien	,
select this_.SYSTEM_ID as SYSTEM1_220,..., unit2_.SYSTEM_ID as SYSTEM1_235_0_, ...,  parametert3_.SYSTEM_ID as SYSTEM1_227_1_, ...
from ORDER_DETAIL this_         
left outer join UNIT unit2_ on this_.UNIT_SYSTEMID=unit2_.SYSTEM_ID 
left outer join PARAMETER_TYPE parametert3_ on this_.PARAMETER_TYPE_SYSTEMID=parametert3_.SYSTEM_ID

/t
VariablePopulationServiceImpl.getVariableChoiceList() line: 28	
/=
public class VariablePopulationServiceImpl implements VariablePopulationService {
	public List<VariableChoice> getVariableChoiceList() {
		for (OrderDetail myDetail : MpoBeanFactory.getBean(OrderDetailDAO.class).getAll()) {
/d
/ myDetail=
SystemId: 4200504, Name :SHIP WEIGHT, PathOrClass :./requestedTotalWeightKg

			if (myDetail.getParameterType().getName().equalsIgnoreCase("string")) {
/ Alleen strings
/ PNL-416
/ myDetail=
SystemId: 21953, Name :BILL_TO_PARTY_GROUPS, PathOrClass :./billToPartyVO/partyGroupAsString
/ myDetail.parameterType=
theSystemId: 3700001Name :STRING

				switch (myDetail.getEntityType()) {
					case SHIPMENT_ORDER:
						myChoice = new VariableChoice(
	i++, 
	myDetail.getName() + " (SHO)", 
	Variable.JXPATH_EXPRESSION + Variable.EXPRESSION_SEPARATOR + ExpressionContext.SHIPMENT_ORDER + Variable.EXPRESSION_SEPARATOR + myDetail.getPathOrClass());
/ dit zijn id, name, expression	,

myChoice	VariableChoice  (id=17533)	
	id	"1" (id=17548)	
	name	"BILL_TO_PARTY_GROUPS (SHO)" (id=17550)	
	expression	"jx:shipmentOrder:./billToPartyVO/partyGroupAsString" (id=17546)	

/ er zijn 68 order details van type string	,

/t
VariablePanel.createPage() line: 79	
		initChoice();
/d
		DropDownChoice<VariableChoice> myDropDown = new DropDownChoice<VariableChoice>("dropdown", new PropertyModel<VariableChoice>(this, "choice"), choiceList, new VariableChoiceRenderer());



						myList.add(myChoice);
						break;

/t
		add(myLeft);

		DropDownChoice<Operator> myOperator = new DropDownChoice<Operator>("operator", new PropertyModel<Operator>(getDefaultModel(), "operator"),
				Arrays.asList(Operator.values()));
		add(myOperator);

		VariablePanel myRight = new VariablePanel("rightHand", new PropertyModel<Variable>(getDefaultModel(), "rightHand"), false);
		add(myRight);



/ Intermezzo

/ Er zijn GenericListPanel en GenericFormPanel	,

/  we add filters, rules in de code	, 
/ in de trigger staat seo type	, bijv delivery	,
/ we add een filter, bijv, from city(so) regex Rotterdam
/ op de trigger staan checkboxes: start, end, ... We zien dat start, end checked	,
/ onderaan de trigger staan actions	,
/ Als we een seo van type delivery save, worden de actions gedaan	,

/ in eclipse, ctrl+alt+h is call hierarchy (ga op ServiceOrderTypeTrigger.getOnStart staan) , 
/ we komen in ServiceOrderTriggerHandlerImpl.handleUpdate
				evaluateAndExecuteRequest(myNew, mySotTrigger);
/s
	public boolean evaluateAndExecuteRequest(ServiceOrderVO aServiceOrderVO, ServiceOrderTypeTrigger aSotTrigger) {

/ Set hier b's 	.

/ we kunnen hetzelfde doen voor ServiceOrderTypeTrigger.getOnEnd



/ we kunnen dit testen  door in eclipse b's 

/ Einde Intermezzo


/ 7	. 

/ we geven een filter	,
FROM PARTY_ID (SO) regex SC4
/ we click save	,
/s
RulePanel$1.onSubmit(AjaxRequestTarget, Form<?>) line: 61	
/=
public class RulePanel extends Panel {
	protected void createPage() {
		final Form<Rule> myForm = new Form<Rule>("form", model);
		add(myForm);
		myForm.add(new GroupExpressionPanel("groupExpression", new PropertyModel<GroupExpression>(model, "expression")));
		AjaxButton mySaveBtn = new AjaxButton("saveButton") {
			protected void onSubmit(AjaxRequestTarget aTarget, Form<?> aForm) {
->				Rule myRule = (Rule) aForm.getModel().getObject();
jx:serviceOrder:./fromPartyVO/partyId REGEX SC4

myRule	Rule  (id=19365)	
	expression	GroupExpression  (id=19400)	
		expressionList	ArrayList  (id=19419)	
			elementData	Object[10]  (id=19434)	
				[0]	Expression  (id=19435)	
					leftHand	Variable  (id=19454)	
						expression	"jx:serviceOrder:./fromPartyVO/partyId" (id=19519)		/ is een string	,
						type	VariableType  (id=19521)	
							name "STRING"
					negate	false	
					operator	Operator  (id=19468)	
						leftHandType	VariableType
							name "STRING"
						name "REGEX"
					parent	GroupExpression  (id=19400)	
					rightHand	Variable  (id=19520)	
						expression	"SC4" (id=19583)	
						type	VariableType  (id=19521)	
							name "STRING"
			modCount	1	
			size	1	
		parent	null	
		type	GroupExpressionType  (id=19420)	
aTarget	AjaxRequestTarget  (id=19366)	
aForm	Form  (id=19367)	

				save(aTarget, myRule);
/s
ModalRuleEditPage$1.save(AjaxRequestTarget, Rule) line: 34	
/=
	public ModalRuleEditPage(final ModalWindow window, final IModel<Rule> aModel) {
		RulePanel myPanel = new RulePanel("rulepanel", aModel.getObject()) {
			public void save(AjaxRequestTarget aTarget, Rule aRule) {
->				aModel.setObject(aRule);


/ 7	. 

/ we add een boolean order detail 'recurring'	,
finance, service management, order details
Name : recurring
expression: ./recurring				/ zal property zoeken in seo	, zal getRecurring() call	,

/ we maken een filter expression op een service order type trigger	, met als service order type DELIVERY







 



/ Einde DEBUG PNL-416



/ RATE AGREEMENTS

/ Order details worden used in rate agreements	,
configuration, finance, service management, service agreements(admin)

/ rate agreements (kosten berekenen) worden service agreements genoemd	, omdat ze ook hubs  berekenen, ipv alleen prijzen	,
/ click een service agreement open	,

selection criteria	,
/ dit zijn de order details
/ als een sho of seo matches aan deze order details, dan worden de rate agreements berekend	,

rate components
/ click een open	,
/ we zien Parameter	,
/ deze vinden we onder, terug, click tab
parameters 





/ Einde RATE AGREEMENTS

/ DEBUG MPO-84 SCS-4750

/ 2014.01_mpo	,

/ 7	. 

/ seo list page	,

$ vi oms-sitemap.xmap 

	<map:pipeline>
			<!-- *********************************************************** -->
			<!-- Service Order                                               -->
			<!-- *********************************************************** -->
			<map:match pattern="service-order_list">
				<map:generate type="serverpages" src="xsp/service-order_list.xml"/>
				<map:call resource="dynatable-styler"/>
			</map:match>

$ vi service-order_list.xml

           // Dynamic query
            myTable.setQuery(
            "SELECT distinct SO.* FROM SERVICE_ORDER SO " +
            "LEFT JOIN CONSIGNMENT C on C.SERVICE_ORDER_SYSTEMID =SO.SYSTEM_ID " + 
            "LEFT JOIN SERVICE_ACTION SA on SA.CONSIGNMENT_SYSTEMID = C.SYSTEM_ID " +
            "LEFT JOIN SHIPMENT_ORDER SHO on SHO.SYSTEM_ID= SA.SHIPMENT_ORDER_SYSTEMID " + 
            "WHERE SO.IS_TEMPLATE = 0 AND SO.ORGANIZATION_SYSTEMID IN {USER_ORGANIZATIONS} " +
            "-#1 AND SO.FROM_COUNTRY_SYSTEMID IN (SELECT SYSTEM_ID FROM COUNTRY WHERE ?)#-" +
            "-#2 AND SO.EXECUTED_BY_PARTY_SYSTEMID IN (SELECT SYSTEM_ID FROM PARTY WHERE ?)#-" +
            "-#3 AND SO.SERVICE_STATUS_SYSTEMID IN (SELECT SYSTEM_ID FROM ORDER_STATUS WHERE ?)#-"+
            "-#4 AND SO.TO_COUNTRY_SYSTEMID IN (SELECT SYSTEM_ID FROM COUNTRY WHERE ?)#-" +
            "-#5 AND SO.HOLD_STATUS_SYSTEMID IN (SELECT SYSTEM_ID FROM HOLD_STATUS WHERE ?)#-" +
            "-#6 AND SO.SERVICE_ORDER_TYPE_SYSTEMID IN (SELECT SYSTEM_ID FROM SERVICE_ORDER_TYPE WHERE ?)#-" +
            "-#7 AND SO.EXECUTED_BY_PARTY2_SYSTEMID IN (SELECT SYSTEM_ID FROM PARTY WHERE ?)#-" +
            "-#8 AND SO.ORGANIZATION_SYSTEMID IN (SELECT SYSTEM_ID FROM ORGANIZATION WHERE ?)#-" +
            "-#9 AND SO.SERVICE_TYPE_SYSTEMID IN (SELECT SYSTEM_ID FROM SERVICE_TYPE WHERE ?)#-" +
            "-#10  AND SHO.REFERENCE5 = ? #-" +
            "-#11 AND SO.ORDER_PROCESS_SYSTEMID IN (SELECT SYSTEM_ID FROM ORDER_PROCESS WHERE ?)#-" +
            "-#13 AND SO.CREATED_BY_SYSTEMID IN (SELECT SYSTEM_ID FROM TMS_USER WHERE ?)#-" ,
            myMaxResult
            );
            myTable.addHiddenColumn("SYSTEMID");
			...

/ Wat is myTable	?
/ TODO

/ we zien in de log	,

21359 2015-03-13 13:27:00,010 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-3:) SELECT distinct SO.* FROM SERVICE_ORDER SO LEFT JOIN CONSIGNMENT C on C.SERVICE_ORDER_SYSTEMID =SO.SYSTEM_ID LEFT JOIN SERVICE_ACTION SA on SA.CONSIGNMENT_SYSTEMID = C.SYSTEM_ID LEFT JOIN SHIPMENT_ORDER SHO on SHO.SYSTEM_ID= SA.SHIPMENT_ORDER_SYSTEMID WHERE SO.IS_TEMPLATE = 0 AND SO.ORGANIZATION_SYSTEMID IN  (0,103,4000,3150,101,102,1)  and upper(SO.service_order_id) LIKE '%1873%'




/ Zoek seo  N0001873

/ Onder route	, click pijltje naar boven	, dat is : verwissel de consignments van volgorde	,
/ dan ERR	,

/ Intermezzo

/ op seo list page	, zien we N0001873 in de list	,
/ de edit button op deze row is	,
<a class="action" href="../oms/service-order_edit?base_sessionLevelOffset=1&amp;systemid=26756976&amp;systemId=26756976">
	<img src="../lookandfeel/styles/images/icons/check24.gif" border="0" alt="Edit" title="Edit">
</a>

/ In Route tab	, we zien up-icon	,
<img src="../lookandfeel/styles/images/icons/arrow_up_green.gif" alt="Move consignment up" title="Move consignment up" onclick="moveAction('26806868', 'up');">

/ SEARCH FUNCTION IN JAVASCRIPT

/ we hebben al die frames	, we moeten eerst op zoek naar het juiste frame	,

/ in console, click pijltje naar beneden	,
/ kies frame : main_frame(service-order_edit)
/ Geef
> moveAction
/ De fct def verschijnt al, maar niet de js file waar hij is	, 
/ rechtsonder is een link	, click deze	,
/ zoeken in eclipse : tab-sa-source.tag	, een jsp dus	,


/ Einde SEARCH FUNCTION IN JAVASCRIPT

/ 13	. 

$ vi service-order_edit.jsp

		<mpo:tab name="route">
			<ttf:tab-sa-route />
		</mpo:tab>

/ Dus 	,

$ vi tab-sa-route.tag

function moveAction(aConsignmentId, aDirection) {
	document.getElementById("moveDirection").value=aDirection;
	document.getElementById("base_routeAction").value="moveConsignment";
	document.getElementById("base_consignmentSystemid").value=aConsignmentId;
	with (document.getElementById("mpoForm")) {
		action="changeConsignmentSequence";
		submit();
	}	
}

function editConsignment(aConsignmentId) {
	document.getElementById("base_consignmentSystemid").value=aConsignmentId;
	document.getElementById("base_routeAction").value="consignmentEdit";
	document.getElementById("mpoForm").submit();
}

function saveConsignment(aConsignmentId) {
	document.getElementById("base_consignmentSystemid").value=aConsignmentId;
	document.getElementById("base_routeAction").value="";
	with (document.getElementById("mpoForm")) {
		action="saveConsignment";
		submit();
	}	
}
</script>

	<input type="hidden" id="moveDirection" name="moveDirection" value="moveDirection"/>
	<input type="hidden" id="base_consignmentSystemid" name="base_consignmentSystemid"/>
	<mpo:requestParamField name="base_routeAction"/>
  	<input type="hidden" name="routeAction" id="routeAction" value="<%=request.getParameter("routeAction")%>"">

	<tr class="<%=myClass%>">
				<td nowrap="nowrap">
					<% if (!isFirst) {%>
					<a href="#"><img src="../lookandfeel/styles/images/icons/arrow_up_green.gif" alt="Move consignment up"  title="Move consignment up" onclick="moveAction('<%=myConsignmentVO.getSystemId()%>', 'up');"/>


$ vi ./base-framework/core/war/WEB-INF/tld/mpo.tld
/ TODO

<taglib>
	<uri>http://www.mp-objects.com/taglibs/mpo</uri>
	<tag>
		<name>requestParamField</name>
		<tagclass>com.mpobjects.view.taglib.RequestParamField</tagclass>
		<bodycontent>empty</bodycontent>
		<attribute>
			<name>name</name>
			<required>true</required>
			<rtexprvalue>true</rtexprvalue>
		</attribute>
	</tag>

$ vi  RequestParamField.java

public class RequestParamField extends TagBase {

	private String theName;

	@Override
	public int doStartTag() throws JspTagException {
		StringBuffer myRet = new StringBuffer();
		FieldUtil myField = new FieldUtil(getRequest());
		myField.appendField("hidden", getName(), myRet);
		printLn(myRet);
		return 0;
	}

	public String getName() {
		return theName;
	}

	public void setName(String aName) {
		theName = aName;
	}
}
/ TODO


mpo_2014_01_v2=# select*from consignment where system_id=26806868;
 system_id | consignment_number | service_order_systemid | sequence_number | consignment_status_systemid | to_location_id |     to_name    
  | to_name2 |       to_address        | to_address2 |  to_city  | to_postal_code | to_region_state | to_country_systemid | to_phone_number
 | to_fax_number | to_email_address | to_contact_name | from_location_id |            from_name            | from_name2 |      from_address
       | from_address2 | from_city | from_postal_code | from_region_state | from_country_systemid | from_phone_number | from_fax_number | f
rom_email_address | from_contact_name | requested_start_before | requested_start_after | planned_start_before | planned_start_after | org_p
lanned_start_before | org_planned_start_after | requested_end_before | requested_end_after | planned_end_before  |  planned_end_after  | or
g_planned_end_before | org_planned_end_after | actual_start |     actual_end      | reference1 | reference2 | reference3 | reference4 | ref
erence5 | pod_reference | total_ldm | total_volume | comments | close_date | is_temporary 
--------+---------------+-----------+--------------+----------+------------+--------------
  26806868 | N0001873.2         |               26756976 |        26806867 |                           1 | 3              | HEGRON COSMETIC
S |          | Van IJsendijkstraat 174 |             | PURMEREND | 1442 LC        |                 |                4153 | 0299-433789    
 |               |                  |                 | 1045             | GERRESHEIMER MOULDED GLASS GMBH |            | Tettaugrundstrass
e  1 5 |               | Tettau    | 96355            |                   |                  4052 | 0049-926991181    |                 |  
                  |                   | 2014-11-05 22:59:00    | 2014-11-05 00:00:00   | 2014-11-12 22:59:00  | 2014-11-12 22:59:00 |      
                    |                         | 2014-11-13 22:59:00  | 2014-11-13 00:00:00 | 2014-11-13 22:59:00 | 2014-11-13 22:59:00 |   
                     |                       |              | 2014-11-13 17:25:00 |            |            |            |            |    
        |               |       7.6 |            0 |          |            |            0
(1 row)

/ Klopt, de seo waar we mee begonnen, waar deze consignment in is	, is  26756976	,
/ we zien seq number 26806867	,

/ we zien in de list 3 cons	, klopt dit?
mpo_2014_01_v2=# select count(*)from consignment where service_order_systemid=26756976;
 count 
-------
     3
(1 row)

mpo_2014_01_v2=# select * from consignment where service_order_systemid=26756976;
 system_id | consignment_number | service_order_systemid | sequence_number | consignment_status_systemid | to_location_id |         to_name
          | to_name2 |         to_address         | to_address2 |  to_city  | to_postal_code | to_region_state | to_country_systemid | to_p
hone_number | to_fax_number | to_email_address | to_contact_name | from_location_id |            from_name            | from_name2 |      f
rom_address       | from_address2 |    from_city    | from_postal_code | from_region_state | from_country_systemid | from_phone_number | fr
om_fax_number | from_email_address | from_contact_name | requested_start_before | requested_start_after | planned_start_before | planned_st
art_after | org_planned_start_before | org_planned_start_after | requested_end_before | requested_end_after | planned_end_before  |  planne
d_end_after  | org_planned_end_before | org_planned_end_after | actual_start |     actual_end      | reference1 | reference2 | reference3 |
 reference4 | reference5 | pod_reference | total_ldm | total_volume | comments | close_date | is_temporary 
------------+------------+---------------+-----------+--------------+----------+------------+--------------
  26756979 | N0001873.1         |               26756976 |        26756978 |                           1 | 9              | KONINKLIJKE SAN
DERS B.V. |          | Industriepark Vliedberg 12 |             | VLIJMEN   | 5251  RG       |                 |                4153 |     
            |               |                  |                 | 1001             | HEINZ PLASTICS BOHM GmbH        |            | Franke
nwaldstrasse 29   |               | TETTAU-LANGENAU | 96355            |                   |                  4052 | 0049-926999040    |   
              |                    |                   | 2014-10-10 22:59:00    | 2014-10-10 00:00:00   | 2014-11-12 22:59:00  | 2014-11-12
 22:59:00 |                          |                         | 2014-11-13 22:59:00  | 2014-11-13 00:00:00 | 2014-11-13 22:59:00 | 2014-11
-13 22:59:00 |                        |                       |              | 2014-11-13 17:25:00 |            |            |            |
            |            |               |       4.8 |            0 |          |            |            0

  26806868 | N0001873.2         |               26756976 |        26806867 |                           1 | 3              | HEGRON COSMETIC
S         |          | Van IJsendijkstraat 174    |             | PURMEREND | 1442 LC        |                 |                4153 | 0299
-433789     |               |                  |                 | 1045             | GERRESHEIMER MOULDED GLASS GMBH |            | Tettau
grundstrasse  1 5 |               | Tettau          | 96355            |                   |                  4052 | 0049-926991181    |   
              |                    |                   | 2014-11-05 22:59:00    | 2014-11-05 00:00:00   | 2014-11-12 22:59:00  | 2014-11-12
 22:59:00 |                          |                         | 2014-11-13 22:59:00  | 2014-11-13 00:00:00 | 2014-11-13 22:59:00 | 2014-11
-13 22:59:00 |                        |                       |              | 2014-11-13 17:25:00 |            |            |            |
            |            |               |       7.6 |            0 |          |            |            0

  26807360 | N0001873.3         |               26756976 |        26807359 |                           1 | 9              | KONINKLIJKE SAN
DERS B.V. |          | Industriepark Vliedberg 12 |             | VLIJMEN   | 5251  RG       |                 |                4153 |     
            |               |                  |                 | 1065             | HEINZ PLASTICS BOHM GmbH ROVAL  |            | Franke
nwaldstrasse 29   |               | TETTAU LANGENAU | 96355            |                   |                  4052 | 0049-926999040    |   
              |                    |                   | 2014-08-20 22:59:00    | 2014-08-20 00:00:00   | 2014-11-12 22:59:00  | 2014-11-12
 22:59:00 |                          |                         | 2014-11-13 22:59:00  | 2014-11-13 00:00:00 | 2014-11-13 22:59:00 | 2014-11
-13 22:59:00 |                        |                       |              | 2014-11-13 17:25:00 |            |            |            |
            |            |               |       0.4 |            0 |          |            |            0
(3 rows)

mpo_2014_01_v2=# select  system_id, consignment_number,sequence_number from consignment where service_order_systemid=26756976;
 system_id | consignment_number | sequence_number 
-----------+--------------------+-----------------
  26756979 | N0001873.1         |        26756978
  26806868 | N0001873.2         |        26806867
  26807360 | N0001873.3         |        26807359
(3 rows)


/ Einde Intermezzo

/ we gaan debug	,

function moveAction(aConsignmentId, aDirection) {
aConsignmentId: "26806868"
/ dit is de middelste	, klpt	,
aDirection: "up"
	document.getElementById("moveDirection").value=aDirection;
	document.getElementById("base_routeAction").value="moveConsignment";
	document.getElementById("base_consignmentSystemid").value=aConsignmentId;
/ set de hidden fields, 	gaan met form mee	,
	with (document.getElementById("mpoForm")) {
		action="changeConsignmentSequence";
		submit();
	}	
}

////////////////////////////////////////////////////////
/ Op het up-icon staat moveAction, maar deze submit het grote form , net als Save
/ Hoe werkt precies het action attr?
/ TODO
/ Kijk nu in oms-sitemap.xmap	,
		<map:match pattern="changeConsignmentSequence">
				<map:act type="changeConsignmentSequence"/>
				<map:act type="redirectAfterSave">
					<map:parameter name="redirectTo" value="service-order_edit?systemId={request-param:systemId}&amp;base_routeAction=moveConsignment"/>
				</map:act>
			</map:match>

$ vi oms-sitemap.xmap 

            <map:match pattern="service-order_list-status-update">
                <map:act type="setAttributes">
			         <map:parameter name="attributesType" value="request"/>
			    </map:act>
			    <map:call resource="dynatablePage">
			    	<map:parameter name="recordsPerPage" value="250"/>
			    	<map:parameter name="xsp" value="xsp/service-order_list-status-update.xml"/>
                    <map:parameter name="xsl" value="xsl/dashboard-serviceorder-list.xsl"/>
			    </map:call>
			</map:match>


$ vi xsp/service-order_list-status-update.xml
/ NIETS over de consignment query	,


$ vi service-order_edit.jsp

		<mpo:form name="mpoForm" action="service-order_save" entity="serviceOrder" readOnly="${readOnly}">
			...
			<mpo:tab name="serviceActions">
				<ttf:tab-sa-serviceactions />
			</mpo:tab>
		</mpo:form>


/ we set b in 	,
ConsignmentSequenceAction.act() line: 49	
ConsignmentDAOImpl.getConsignmentBySequence(int, String) line: 72	

/ we click op groene pijlte onder Route	,

$ vi dashboard.js
/**
 * opens a consignment
 */                
function gotoConsignment(aConsignmentId){
    document.location.href="edit_consignment?base_sessionLevelOffset=1&consignmentId=" + aConsignmentId;
}

$ vi oms-sitemap.xmap

		<map:pipeline>
			<!-- *********************************************************** -->
			<!-- Service Order                                               -->
			<map:match pattern="edit_consignment">
				<map:act type="editConsignment"/>
				<map:redirect-to uri="service-order_edit?systemId={request-attr:serviceOrderSystemid}&amp;base_routeAction=consignmentEdit&amp;base_activeTab=tab-sa-route.jsp&amp;base_consignmentSystemid={request-attr:consignmentSystemid}"/>
			</map:match>

/ In workspace/2014.01_mpo	,
$ vi ./module/oms/war/WEB-INF/tags/oms/tab-sa-route.tag

<script type="text/javascript">
/**
* @param  int consignmentId
* @param String aDirection in {"up", "down"}
*/
function moveAction(aConsignmentId, aDirection) {
/ middelste cons, "up"
	document.getElementById("moveDirection").value=aDirection;
	document.getElementById("base_routeAction").value="moveConsignment";
	document.getElementById("base_consignmentSystemid").value=aConsignmentId;
	with (document.getElementById("mpoForm")) {
		action="changeConsignmentSequence";
		submit();
	}	
}

/ In workspace/2014.01_mpo	,
$ vi ./module/oms/war/oms/jsp/service-order_edit.jsp
...
<%@taglib prefix="ttf" tagdir="/WEB-INF/tags/oms/"%>
...
		<mpo:tab name="route">
			<ttf:tab-sa-route />
		</mpo:tab>

/ In workspace/2014.01_mpo	,
[eric@localhost 2014.01_mpo]$ find module/oms/war/
module/oms/war/oms
module/oms/war/oms/oms-sitemap.xmap
module/oms/war/oms/jsp/service-order_edit.jsp
module/oms/war/oms/cforms/extracost/costtype-edit-definition.xml
module/oms/war/oms/xsp/servicetype-list.xml
module/oms/war/oms/styles/oms.css
module/oms/war/oms/script/smartsave.js
module/oms/war/WEB-INF/tags/event/service-order-tab-events.tag
module/oms/war/WEB-INF/tags/oms/tab-sa-route.tag
module/oms/war/WEB-INF/tags/supplierinvoice/createinvoice.tag
module/oms/war/WEB-INF/tld/oms.tld

/ we zien in de browser's debugger bij sources	,
service-order_edit?base_sessionLevelOffset=1&systemid=26756976&systemId=26756976
/ dat is	,
http://localhost:8080/tms/oms/service-order_edit?base_sessionLevelOffset=1&systemid=26756976&systemId=26756976

/ Daarin zien we	,
function editConsignment(aConsignmentId) {
	document.getElementById("base_consignmentSystemid").value=aConsignmentId;
	document.getElementById("base_routeAction").value="consignmentEdit";
	document.getElementById("mpoForm").submit();
}
/ Hier kunnen we een b in set	,

/ 13	. 

/ we zien in html	,

	<input type="hidden" id="moveDirection" name="moveDirection" value="moveDirection"/>
	<input type="hidden" id="base_consignmentSystemid" name="base_consignmentSystemid"/>
	<input type="hidden" name="base_routeAction" id="base_routeAction" value="" size="20"/>
  	<input type="hidden" name="routeAction" id="routeAction" value="null"">

/ 13	. 

/ In welke volgorde komen de cons in de list in tab-sa-route.tag	?

/ Als we de seo N0001873 in de list hebben op seo list page	, dan zien we in 
$ vi hibernate.log	,

select consignmen0_.SERVICE_ORDER_SYSTEMID as SERVICE3_18_1_, ... 
from CONSIGNMENT consignmen0_ 
where consignmen0_.SERVICE_ORDER_SYSTEMID=? 
order by consignmen0_.SEQUENCE_NUMBER


$ vi tab-sa-route.tag

			Collection myConsignmentVOList = myRouteView.getConsignmentsByServiceOrder(ActionHelper.getSystemId(request)); 
/s
ConsignmentView.getConsignmentsByServiceOrder(int) line: 44	
/=
	public Collection<ConsignmentVO> getConsignmentsByServiceOrder(int aServiceOrderId) throws AbstractException {
		List<ConsignmentVO> myList = MpoBeanFactory.getBean(ServiceOrderDao.class).getBySystemId(aServiceOrderId).getConsignmentList();
aServiceOrderId	26756976	



/ 13	.

/ we vallen in	,
ConsignmentSequenceAction.act() line: 49	

	public synchronized Map act() throws Exception {

->		getLogger().info("entering action consignmentSequenceAction");


		int myConsignmentId = Integer.parseInt(getRequest().getParameter("base_consignmentSystemid"));
/ hidden field, dat meekomt met form submit	,
26806868
/ klopt	,

		String myDirection = getRequest().getParameter("moveDirection");
/ hidden field, dat meekomt met form submit	,
"up"
/ klopt	,
		ConsignmentDAO myDAO = MpoBeanFactory.getBean(ConsignmentDAO.class);
/ Spring proxy naar com.mpobjects.oms.dao.ConsignmentDAOImpl@26f68b47

		ConsignmentVO mySwapVO = myDAO.getConsignmentBySequence(myConsignmentId, myDirection);
/s
ConsignmentDAOImpl.getConsignmentBySequence(int, String) line: 80	
/=
	public ConsignmentVO getConsignmentBySequence(int aConsignmentId, String aDirection) throws ConsignmentException {
		String hql = "SELECT C1.* FROM CONSIGNMENT C1, CONSIGNMENT C2, SERVICE_ORDER SO WHERE SO.SYSTEM_ID=C1.SERVICE_ORDER_SYSTEMID "
				+ "AND  C1.service_order_systemid = C2.service_order_systemid AND c2.system_id= :consignmentsystemid ";

		if (aDirection.equalsIgnoreCase("up")) {
			hql += "C1.sequence_number < C2.sequence_number ORDER BY c1.sequenceNr DESC";
		} else {
			hql += "C1.sequence_number > C2.sequence_number ORDER BY c1.sequenceNr ASC";
		}
SELECT C1.* 
FROM CONSIGNMENT C1, CONSIGNMENT C2, SERVICE_ORDER SO 
WHERE SO.SYSTEM_ID=C1.SERVICE_ORDER_SYSTEMID 
AND  C1.service_order_systemid = C2.service_order_systemid 
AND c2.system_id= :consignmentsystemid AND C1.sequence_number < C2.sequence_number ORDER BY c1.sequenceNr DESC

		Query query = getHibernateTemplate().getSessionFactory().getCurrentSession().createQuery(hql);

/ 13	. 

/ Volgende ERR	,

3471 Caused by: java.lang.RuntimeException: The unit can not be converted to a currency [CURRENCY], check the table 'C     URRENCY'
3472     at com.mpobjects.ratecalc.entity.Unit.getAsCurrency(Unit.java:49)
3473     at com.mpobjects.oms.ratecalc.model.process.function.RateResult.getCurrency(RateResult.java:120)
3474     at com.mpobjects.oms.ratecalc.model.process.function.RateResult.toXML(RateResult.java:289)
3475     at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationAlternative.getAsElement(RateCalculatio     nAlternative.java:153)
3476     at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.createXMLLog(RateCalculationVO.java:     300)
3477     at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.runFor(RateCalculationVO.java:800)
3478     ... 206 more
3479 2015-03-12 09:35:14,593 WARN  [com.mpobjects.control.action.AbstractAction] (http-0.0.0.0-8080-4:) method act(..)     : error capture and analysis: class java.lang.RuntimeException In updateConsignment(26806868,id/value: 972989519/     0]):java.lang.RuntimeException: In updateServiceOrder(N0001873/26756976):In runFor(theSystemId: 26631689Name :REE     NEN^M
3480 Description :null^M
3481 Organization :SystemId:4000 Id:HAAL-ZW  Description:HAAL^M
3482 Unit :theSystemId: 1000072  Symbol :EUR Description :Euro   UnitType :CURRENCY  IsDeleted :0    ^M
3483 IsDeleted :false^M
3484 RateType :service_order_cost^M
3485 ), save ratecalc failed:java.lang.RuntimeException: The unit can not be converted to a currency [CURRENCY], check      the table 'CURRENCY'
3486 2015-03-12 09:35:24,174 INFO  [com.mpobjects.util.ejb.ClientLoginUtil] (interfaceTriggerEventTimerFactory:) Clien     tLoginUtil, method loginAsInterface() entered.
3487 2015-03-12 09:35:24,175 INFO  [com.mpobjects.util.ejb.ClientLoginUtil] (interfaceTriggerEventTimerFactory:) Clien     tLoginUtil, method loginAsInterface() attempt login as user: all-admin , with pw: admin123@MPO .
3488 2015-03-12 09:35:24,177 INFO  [com.mpobjects.util.ejb.ClientLoginUtil] (interfaceTriggerEventTimerFactory:) Clien     tLoginUtil, method loginAsInterface() login done as user: all-admin , with pw: admin123@MPO .
3489 2015-03-12 09:35:24,177 INFO  [com.mpobjects.util.ejb.ClientLoginUtil] (interfaceTriggerEventTimerFactory:) Clien     tLoginUtil, method loginAsInterface() exited.

/ 13	. 

////////////////////////////////////////////////////
/ Deze stack gaat OK met Unit.getAsCurrency

/ we komen in	,
ConsignmentSequenceAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 170	
				Map myMap = act();
/s
ConsignmentSequenceAction.act() line: 60	
	myService.swapConsignmentsBySequence(myConsignmentId, myDirection);
/s
ConsignmentServiceImpl.swapConsignmentsBySequence(int, String) line: 747	
			ConsignmentVO mySwapVO = consignmentDAO.getConsignmentBySequence(aConsignmentId, aDirection);
/bovenste	,
			ConsignmentVO myVO = consignmentDAO.getBySystemId(aConsignmentId);
middelste, target
			int mySwapSequenceNr = mySwapVO.getSequenceNr();
			mySwapVO.setSequenceNr(myVO.getSequenceNr());

			myVO.setSequenceNr((int) new Date().getTime());

			updateConsignment(myVO, new TMSEventContext(0), true);
/s
ConsignmentServiceImpl.updateConsignment(ConsignmentVO, TMSEventContext, boolean) line: 786	

					consignmentDAO.saveConsignment(aConsignment);
/ de target (middelste) cons	, die naar boven moet	, het is een proxy, en theSequenceNr=new Date()	,
/s
ConsignmentDAOImpl.saveConsignment(ConsignmentVO) line: 143	
		return save(aConsignmentVO);
/s
ConsignmentDAOImpl(GenericHibernateDAO).save(Type) line: 476	
			getHibernateTemplate().update(anEntity);
/ is NOT done now
/ TODO
/t
		myService.updateConsignment(myVO, new TMSEventContext(0), true);
/s
ConsignmentServiceImpl.updateConsignment(ConsignmentVO, TMSEventContext, boolean) line: 766	

			serviceOrderService.handleConsignmentSwitch(aConsignment, myOldConsignment);
/s
ServiceOrderServiceImpl.handleConsignmentSwitch(ConsignmentVO, ConsignmentVO) line: 887	

/ een seo heeft list van cons	, en de middelste is al update	, dus er wordt geen cons uit de list gehaald en erbij gezet	, want 	,
/ er gebeurt niets	 wat dat betreft	, de cons is al update	,

			if (!ObjectUtils.equals(myOldServiceOrderVO, myNewServiceOrderVO)) {
/ NEE
					removeConsignment(aOldConsignmentVO);
					addConsignment(myNewServiceOrderVO, aNewConsignmentVO, myContext);
				}
			} else {
/ JA
					myNewServiceOrderVO = getServiceOrder(myNewServiceOrderVO.getSystemId());
					myNewServiceOrderVO.setRecalculate();

					if (myNewServiceOrderVO.addOrReplaceConsignment(aNewConsignmentVO)) {
/s
ServiceOrderVO.addOrReplaceConsignment(ConsignmentVO) line: 311	
		if (myOneToReplace != null) {
			int replaceIndex = consignmentList.indexOf(myOneToReplace);
			consignmentList.set(replaceIndex, aConsignment);
			setRecalculate();
			return true;
/t

					updateServiceOrder(myNewServiceOrderVO, myContext, true, false);
/s
ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderVO, TMSEventContext, boolean, boolean) line: 1355	
				serviceOrderDAO.save(aServiceOrder);

					triggerEventHandler(myOldServiceOrderVO, aServiceOrder, false, aContext);
/ myOldServiceOrderVO, aServiceOrder zijn verschillende insts	, maar de consignmentList is dezelfde inst	, een PersistentBag	,
/s
ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderVO, ServiceOrderVO, boolean, TMSEventContext) line: 1679	
			eventHandlerService.handleEvent(myEvent);
/s
EventHandlerServiceImpl.handleEvent(Event) line: 89	

			listenerList.fireEvent(anEvent);
/s
ListenerList.fireEvent(Event) line: 80	
		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);
/s
EventEventListener.handleEvent(Event) line: 107	
		} else if (myType.equals(ServiceOrderEvent.UPDATED)) {
			handleServiceOrderChange((ServiceOrderEvent) anEvent);
/s
EventEventListener.handleServiceOrderChange(ServiceOrderEvent) line: 605	
		ServiceOrderVO myOldServiceOrder = anEvent.getOldServiceOrderVO();
		ServiceOrderVO myNewServiceOrder = anEvent.getNewServiceOrderVO();

		if (!myOldServiceOrder.getDateSetVO().equals(myNewServiceOrder.getDateSetVO())) {
			updateEventTimesForServiceOrder(myNewServiceOrder);
/s
EventEventListener.updateEventTimesForServiceOrder(ServiceOrderVO) line: 1018	
		Collection<EventVO> myNewEventList = eventService.getEventsForServiceOrder(myNewServiceOrderVO.getSystemId());

/ de echte events, die op een sho staan, zoals pod	,...
/ ze staan in de pod table, als ze op een sho staan	,

/s
EventServiceImpl
	public Collection<EventVO> getEventsForServiceOrder(int aSystemId) {
		return getDAO().getEventsForServiceOrder(aSystemId);
	}
/s
EventDAOImpl
	@Override
	public Collection<EventVO> getEventsForServiceOrder(int aSystemId) {

		String myQuery = "select ev.* from event_event ev " + " where ev.service_order_systemid = :serviceOrderId "
				+ " order by ev.closed_on, ev.expected_end ";
		Collection<QueryParameter> params = new ArrayList<QueryParameter>();
		params.add(new IntNamedQueryParameter("serviceOrderId", aSystemId));
		Collection<EventVO> myEventList = executeSqlSelect(myQuery, "ev", params);
		return myEventList;

/ Intermezzo

/ we zien	,

88150 2015-03-17 16:47:21,765 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-7:) select ev.* from event_event ev  where ev.service_order_sytemid = ?  order by ev.closed_on, ev.expected_end
88152 2015-03-17 16:47:21,768 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [1] as [INTEGER] - 26756976 

/ we doen zelf	,
 
_2014_01_v2=# select e.system_id, t.name, e.event_status from event_event e join event_type t on e.event_type_systemid=t.system_id where service_order_systemid = 26756976;
 system_id | name | event_status  
-----------+------+---------------
  26807104 | POD  | CLOSED_NORMAL
  26806695 | POD  | CLOSED_NORMAL
  26806988 | POD  | CLOSED_NORMAL
  26807045 | POD  | CLOSED_NORMAL
  26805798 | POD  | CLOSED_NORMAL
  26756984 | POD  | CLOSED_NORMAL

/ Einde Intermezzo

/t
ListenerList.fireEvent(Event) line: 78	
		for (EventListener myListener : theListenerList) {
			LOG.info("Notifying event [" + anEvent.getEventType() + "] to [" + myListener.getClass() + "] eventContext [" + anEvent.getEventContext() + "]");
			myListener.handleEvent(anEvent);



/s
RateCalcEventListener.handleEvent(Event) line: 67	
			if (myRecalcExecution.equalsIgnoreCase("auto")) {
				recalcServiceOrderCost(anEvent);
/s
RateCalcEventListener.recalcServiceOrderCost(Event) line: 170	
			recalculate(myServiceOrder, RateType.RATE_TYPE_SERVICE_ORDER_COST, anEvent.getEventContext());
/s
RateCalcEventListener.recalculate(ServiceOrderVO, String, TMSEventContext) line: 258	
				myService.recalculate(myOrder, RateType.RATE_TYPE_SERVICE_ORDER_COST, anEventContext);
/s
CalculationServiceImpl.recalculate(LogisticsOrderVO, String, TMSEventContext) line: 405	
				myRateCalculationVO.runFor(mySelectedRateAgreement);
/s
RateCalculationVO.runFor(RateAgreementVO) line: 726	
				runFor(aRateAgreementVO, myAlterNative);
/s
RateCalculationVO.runFor(RateAgreementVO, RateCalculationAlternative) line: 1307	
								myTotal.add(myResult.getCurrency(), RateResultUtils.getBigDecimalValue(myResult, BigDecimal.ZERO));
/s
RateResult.getCurrency() line: 120	
				return getUnitVO().getAsCurrency();
/s
Unit.getAsCurrency() line: 45	

/ we zijn dus in 
Unit.getAsCurrency() line: 45	
this Unit
theSystemId: 1000072	Symbol :EUR	Description :Euro	UnitType :CURRENCY	IsDeleted :0	

				return MpoBeanFactory.getBean(CurrencyDAO.class).getByCode(getSymbol());
/s
/ MpoBeanFactory.getBean(CurrencyDAO.class)=com.mpobjects.oms.model.currency.dao.CurrencyDaoHibernate@17931868
		return getBean(aClass.getName(), aClass);
/s
MpoBeanFactory.getBean(String, Class<T>) line: 76	
/=
	public static <T> T getBean(String aBeanName, Class<T> aClass) {
		return aClass.cast(getBeanFactory().getBean(aBeanName, aClass));
aBeanName	"com.mpobjects.oms.model.currency.dao.CurrencyDAO" (id=17537)	
getBeanFactory()=ApplicationContext 'mpo': startup date [Thu Mar 12 09:33:34 CET 2015]; root of context hierarchy
getBeanFactory().getClass()=class org.springframework.context.support.ClassPathXmlApplicationContext
/ getBean is een method van AbstractApplicationContext	, spring method dus	,

/ Lees	,
$ vi oms-dao.sb.xml
	<bean id="com.mpobjects.oms.model.currency.dao.CurrencyDAO" parent="HibernateDAOTemplate"
		class="com.mpobjects.oms.model.currency.dao.CurrencyDaoHibernate" />

/ wordt used in 
$ vi oms-service.sb.xml

/t
	public CurrencyVO getAsCurrency() {
				return MpoBeanFactory.getBean(CurrencyDAO.class).getByCode(getSymbol());
/s

/ Intermezzo

public class CurrencyDaoHibernate extends EnumeratedValueObjectHibernateDAO<CurrencyVO> implements CurrencyDAO {
/e
public class EnumeratedValueObjectHibernateDAO<T extends EnumeratedValueObject> extends GenericHibernateDAO<T> implements EnumeratedValueObjectDAOInterface<T> {
	public T getByCode(String aCode, boolean aShowDeleted) {
...

/ er zijn ook 	,
public class ServiceOrderDAOImpl extends GenericHibernateDAO<ServiceOrder> implements ServiceOrderDAO {

/ Einde Intermezzo

/s
CurrencyDaoHibernate(EnumeratedValueObjectHibernateDAO).getByCode(String, boolean) line: 69	
		Collection<T> result = findEqualsWithQueryMap(map);
{deleted=false, code=EUR}
/s
CurrencyDaoHibernate(GenericHibernateDAO).findEqualsWithQueryMap(Map<String,Object>) line: 217	
		return myTemplate.findByCriteria(myDetachedCriteria);
/ myDetachedCriteria=
DetachableCriteria(CriteriaImpl(com.mpobjects.oms.model.currency.vo.CurrencyVO:this[][deleted=false, code=EUR]))

/ Intermezzo

$ vi currencyVO.standard.hbm.xml
...
/ Einde Intermezzo

/t
CurrencyDaoHibernate(EnumeratedValueObjectHibernateDAO).getByCode(String, boolean) line: 71	
		Collection<T> result = findEqualsWithQueryMap(map);
/d
aCode	"EUR" (id=17403)	
aShowDeleted	false	
result	ArrayList  (id=17636)	
	elementData	Object[1]  (id=17640)	
		[0]	CurrencyVO_$$_javassist_78  (id=17644)	
			handler	JavassistLazyInitializer  (id=17654)	
				id	Integer  (id=17661)	
				initialized	true	
				target	CurrencyVO  (id=17675)	
					code	"EUR" (id=17679)	
					deleted	false	
					description	"Euro" (id=17680)	
					performanceMonitorService	null	
					systemId	7001	

/ we zien in hibernate.log	,

select this_.SYSTEM_ID as SYSTEM1_97_0_, this_.CURRENCY_NAME as CURRENCY2_97_0_, this_.CURRENCY_CODE as CURRENCY3_97_0_, this_.IS       _DELETED as IS4_97_0_ 
from CURRENCY this_ l
where this_.IS_DELETED=? and this_.CURRENCY_CODE=?; 
parameters: false       , EUR, ; 

/t
RateResult.getCurrency() line: 120	

/ 13	. 

/ Deze stack gaat OK met Unit.getAsCurrency	,

RateCalculationVO.runFor(RateAgreementVO) line: 769	
				runFor(aRateAgreementVO, myAlterNative);
/d
/ Zonet, OK 
							updateServiceOrderCostPartList(firstAlt);
/ OK

/ 13	. 

/ Deze stack gaat ERR met Unit.getAsCurrency	,

ConsignmentServiceImpl.updateConsignment(ConsignmentVO, TMSEventContext, boolean) line: 766	
			serviceOrderService.handleConsignmentSwitch(aConsignment, myOldConsignment);
/s
ServiceOrderServiceImpl.handleConsignmentSwitch(ConsignmentVO, ConsignmentVO) line: 887	
					updateServiceOrder(myNewServiceOrderVO, myContext, true, false);
/s
ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderVO, TMSEventContext, boolean, boolean) line: 1355	
					triggerEventHandler(myOldServiceOrderVO, aServiceOrder, false, aContext);
/s
ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderVO, ServiceOrderVO, boolean, TMSEventContext) line: 1679	
			eventHandlerService.handleEvent(myEvent);
/s
EventHandlerServiceImpl.handleEvent(Event) line: 89	
			listenerList.fireEvent(anEvent);
/s
ListenerList.fireEvent(Event) line: 80	
		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);
/s
RateCalcEventListener.handleEvent(Event) line: 67	
				recalcServiceOrderCost(anEvent);
/s
RateCalcEventListener.recalcServiceOrderCost(Event) line: 170	
			recalculate(myServiceOrder, RateType.RATE_TYPE_SERVICE_ORDER_COST, anEvent.getEventContext());
/s
RateCalcEventListener.recalculate(ServiceOrderVO, String, TMSEventContext) line: 258	
				myService.recalculate(myOrder, RateType.RATE_TYPE_SERVICE_ORDER_COST, anEventContext);
/s
CalculationServiceImpl.recalculate(LogisticsOrderVO, String, TMSEventContext) line: 405	
				// Now calculate the rates
				myRateCalculationVO.runFor(mySelectedRateAgreement);
/s
RateCalculationVO.runFor(RateAgreementVO) line: 800	
				runFor(aRateAgreementVO, myAlterNative);
/d 
/ Zonet, 1ste run die OK was	,
						createXMLLog();
/s
RateCalculationVO.createXMLLog() line: 300	
		if (alternativeList != null && alternativeList.size() > 0) {
			Element myAlternativeListElement = myDocument.createElement("AlternativeList");
			myRootElement.appendChild(myAlternativeListElement);
			for (RateCalculationAlternative myAlternative : alternativeList) {
				myAlternativeListElement.appendChild(myAlternative.getAsElement(myAlternativeListElement));
/s
RateCalculationAlternative.getAsElement(Element) line: 153	
		/* Add cost components */
		for (CostComponentSpecificationVO myCostComponent : keySet()) {
			Element myCostComponentElement = myCostComponent.toXML(myDocument);
			List<RateResult> myResultList = get(myCostComponent);
			for (RateResult myResult : myResultList) {
				Element myRateResultElement = myResult.toXML(myDocument);
/s
RateResult.toXML(Document) line: 289	
		if (getUnitVO() != null && getUnitVO().isCurrency()) {
			XMLUtil.appendTextElement(myRateResultElement, "Value", getCurrency().round(RateResultUtils.getBigDecimalValue(this)) + " "
					+ getCurrency().getCode());
/s
RateResult.getCurrency() line: 120	
			if (getUnitVO().isCurrency()) {
				return getUnitVO().getAsCurrency();
/s
Unit.getAsCurrency() line: 45	

select this_.SYSTEM_ID as SYSTEM1_97_0_, this_.CURRENCY_NAME as CURRENCY2_97_0_, this_.CURRENCY_CODE as CURRENCY3_97_0_, this_.IS_DELETED as IS4_97_0_ 
from CURRENCY this_ 
where this_.IS_DELETED=false
and this_.CURRENCY_CODE='EUR'

/ 13	. 

/ $ vi ratecalc/entity/Unit.java

	public CurrencyVO getAsCurrency() {
		if (isCurrency()) {
			try {
				return MpoBeanFactory.getBean(CurrencyDAO.class).getByCode(getSymbol());
			} catch (Exception anException) {
				throw new RuntimeException("The unit can not be converted to a currency [" + getUnitType() + "], check the table 'CURRENCY'", anException);

/ Michel heeft de laatste anException erbij set	,
/ Daardoor zien we in de stacktrace de ERR, en de causes	,
/ De ERR is eerder, de tx is rollback	, 

/ we zien in de logs	,
), save ratecalc failed:java.lang.RuntimeException: In updateShipmentOrderPricePartList([RC_MAUT = 59.2] [RC_FUEL = 61.344] [RC_ADDITIONAL_ADDRESS = 252.00] [RC_RELEASE_DATE = 2014-11-07 12:00:00] [RC_SERVICE = STANDARD] [RC_FREIGHT = 511.2] [RC_START_AFTER = 2014-11-11 22:59:00] ), when saving  shipment order:In updateServiceOrder(N0001873/26756976):Data access error for class 'com.mpobjects.event.event.model.EventVO': Query failed: select ev.* from event_event ev  where ev.service_order_systemid = :serviceOrderId  order by ev.closed_on, ev.expected_end : com.mpobjects.util.dao.IntNamedQueryParameter@92e1225
java.lang.RuntimeException: In updateShipmentOrderPricePartList([RC_MAUT = 59.2] [RC_FUEL = 61.344] [RC_ADDITIONAL_ADDRESS = 252.00] [RC_RELEASE_DATE = 2014-11-07 12:00:00] [RC_SERVICE = STANDARD] [RC_FREIGHT = 511.2] [RC_START_AFTER = 2014-11-11 22:59:00] ), when saving  shipment order:In updateServiceOrder(N0001873/26756976):Data access error for class 'com.mpobjects.event.event.model.EventVO': Query failed: select ev.* from event_event ev  where ev.service_order_systemid = :serviceOrderId  order by ev.closed_on, ev.expected_end : com.mpobjects.util.dao.IntNamedQueryParameter@92e1225
    at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.updateServiceOrderCostPartList(RateCalculationVO.java:1609)
	...
/ Dus op	,
select ev.* from event_event ev  
where ev.service_order_systemid = :serviceOrderId  order by ev.closed_on, ev.expected_end 

/ In meer detail	,

Caused by: java.lang.RuntimeException: In updateServiceOrder(N0001873/26756976):Data access error for class 'com.mpobjects.event.event.model.EventVO': Query failed: select ev.* from event_event ev  where ev.service_order_systemid = :serviceOrderId  order by ev.closed_on, ev.expected_end : com.mpobjects.util.dao.IntNamedQueryParameter@92e1225
    at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderServiceImpl.java:1370)
    at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.updateServiceOrderCostPartList(RateCalculationVO.java:1600)

/ 1313

/ we zien dat de fout in	,
/ en blijkt bij ->	,

$ vi RateCalculationVO.java
	protected void updateServiceOrderCostPartList(RateCalculationAlternative anAlternative) throws Exception {
		...
		if (orderChanged) {
			try {
				LOG.info("Updating service order due to changes by rate calculation.");
				serviceOrder.calculateTotalCosts();
				// We need to propagate the changes otherwise EventEventListener won't get the update
				TMSEventContext eventCtx = new TMSEventContext();
				eventCtx.removeFlag(TMSEventContext.FLAG_MAY_RATE_CALC);
				serviceOrder.setRatecalcMd5Hash(RateCalcHashCalculator.calculate(rateAgreement, serviceOrder));
->				getServiceOrderFacade().updateServiceOrder(serviceOrder, eventCtx, true, false);
 
/ Intermezzo

/ in 2014.01_mpo

$ vi RateCalculationVO.java
	public void runFor(RateAgreementVO aRateAgreementVO) {
							updateServiceOrderCostPartList(firstAlt);
/s
RateCalculationVO.updateServiceOrderCostPartList(RateCalculationAlternative) line: 1600	
		if (orderChanged) {
			try {
				LOG.info("Updating service order due to changes by rate calculation.");
				serviceOrder.calculateTotalCosts();
				// We need to propagate the changes otherwise EventEventListener won't get the update
				TMSEventContext eventCtx = new TMSEventContext();
				eventCtx.removeFlag(TMSEventContext.FLAG_MAY_RATE_CALC);
				serviceOrder.setRatecalcMd5Hash(RateCalcHashCalculator.calculate(rateAgreement, serviceOrder));
				getServiceOrderFacade().updateServiceOrder(serviceOrder, eventCtx, true, false);

/ In trunk	

$ vi RateCalculationVO.java
    public void runFor(List<RateAgreementVO> aRateAgreementVO) {
                                    MpoBeanFactory.getBean(ServiceOrderCalculationService.class).updateServiceOrder(myServiceOrder, mySet, myLog);
/s
                               case SERVICE_ORDER:
									...
                                    MpoBeanFactory.getBean(ServiceOrderCalculationService.class).updateServiceOrder(myServiceOrder, mySet, myLog);

$ vi ./module/ratecalc/src/java/com/mpobjects/ratecalc/service/ServiceOrderCalculationServiceImpl.java
       if (orderChanged) {
            try {
                LOG.info("Updating service order due to changes by rate calculation.");
                aServiceOrder.calculateTotalCosts();
                // We need to propagate the changes otherwise EventEventListener won't get the update
                TMSEventContext eventCtx = new TMSEventContext();
                eventCtx.removeFlag(TMSEventContext.FLAG_MAY_RATE_CALC);
                aServiceOrder.setRatecalcMd5Hash(RateCalcHashCalculator.calculate(anAlternative.getRateCalculation().getRateAgreementVO(), aServiceOrder));
                serviceOrderService.updateServiceOrder(aServiceOrder, eventCtx, true, false);

 

/ Einde Intermezzo

/ we waren	,
->				getServiceOrderFacade().updateServiceOrder(serviceOrder, eventCtx, true, false);
/s
/=getServiceOrderFacade()=com.mpobjects.oms.model.service.ServiceOrderServiceImpl@768c8c1c
/s
ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderVO, TMSEventContext, boolean, boolean) line: 1280	
					triggerEventHandler(myOldServiceOrderVO, aServiceOrder, false, aContext);
		} catch (Exception e) {
com.mpobjects.util.dao.DAOException: Data access error for class 'com.mpobjects.event.event.model.EventVO': Query failed: select ev.* from event_event ev  where ev.service_order_systemid = :serviceOrderId  order by ev.closed_on, ev.expected_end : com.mpobjects.util.dao.IntNamedQueryParameter@277c5e4e
/s
ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderVO, ServiceOrderVO, boolean, TMSEventContext) line: 1676	
			eventHandlerService.handleEvent(myEvent);
/s
EventHandlerServiceImpl.handleEvent(Event) line: 52	
			listenerList.fireEvent(anEvent);
/s
ListenerList.fireEvent(Event) line: 78	
		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);
/s
EventEventListener.handleEvent(Event) line: 62	
		} else if (myType.equals(ServiceOrderEvent.UPDATED)) {
			handleServiceOrderChange((ServiceOrderEvent) anEvent);
/s
EventEventListener.handleServiceOrderChange(ServiceOrderEvent) line: 608	
		if (!myOldServiceOrder.getDateSetVO().equals(myNewServiceOrder.getDateSetVO())) {
			updateEventTimesForServiceOrder(myNewServiceOrder);
/s
EventEventListener.updateEventTimesForServiceOrder(ServiceOrderVO) line: 1016	
		Collection<EventVO> myNewEventList = eventService.getEventsForServiceOrder(myNewServiceOrderVO.getSystemId());
/s
EventServiceImpl.getEventsForServiceOrder(int) line: 463	
/ aSystemId=26756976
		return getDAO().getEventsForServiceOrder(aSystemId);
/ getDAO()=com.mpobjects.event.event.model.dao.EventDAOImpl@7a6883f8
/s
EventDAOImpl.getEventsForServiceOrder(int) line: 453	
		String myQuery = "select ev.* from event_event ev " + " where ev.service_order_systemid = :serviceOrderId "
				+ " order by ev.closed_on, ev.expected_end ";
		Collection<QueryParameter> params = new ArrayList<QueryParameter>();
		params.add(new IntNamedQueryParameter("serviceOrderId", aSystemId));
		Collection<EventVO> myEventList = executeSqlSelect(myQuery, "ev", params);
/s
EventDAOImpl(BaseHibernateDAO).executeSqlSelect(String, String, Collection<QueryParameter>) line: 166	
		return executeSqlSelect(aSql, anAlias, aParameters, 0);
/s
EventDAOImpl(BaseHibernateDAO).executeSqlSelect(String, String, Collection<QueryParameter>, int) line: 184	
		return executeSqlSelect(aSql, anAlias, aParameters, aMaxResult, 0);
/s
EventDAOImpl(BaseHibernateDAO).executeSqlSelect(String, String, Collection<QueryParameter>, int, int) line: 207	
			return getHibernateTemplate().executeFind(new HibernateCallback() {
				@Override
				public Object doInHibernate(Session aSession) throws HibernateException, SQLException {
					SQLQuery query = aSession.createSQLQuery(aSql);
					for (QueryParameter parameter : aParameters) {
						parameter.setValue(query);
					}
					query.addEntity(anAlias, type);
type	Class (com.mpobjects.event.event.model.EventVO) (id=7444)	
/ TODO
					if (aMaxResult > 0) {
						query.setMaxResults(aMaxResult);
					}
					if (aFirstResult > 0) {
						query.setFirstResult(aFirstResult);
					}
					return query.list();
				}
			});
		} catch (Exception e) {
org.springframework.dao.DataIntegrityViolationException: Could not execute JDBC batch update; SQL [
update CONSIGNMENT 
set CONSIGNMENT_NUMBER=?, SERVICE_ORDER_SYSTEMID=?, SEQUENCE_NUMBER=?, CONSIGNMENT_STATUS_SYSTEMID=?, FROM_LOCATION_ID=?, FROM_NAME=?, FROM_NAME2=?, FROM_ADDRESS=?, FROM_ADDRESS2=?, FROM_CITY=?, FROM_POSTAL_CODE=?, FROM_REGION_STATE=?, FROM_COUNTRY_SYSTEMID=?, FROM_PHONE_NUMBER=?, FROM_FAX_NUMBER=?, FROM_EMAIL_ADDRESS=?, FROM_CONTACT_NAME=?, TO_LOCATION_ID=?, TO_NAME=?, TO_NAME2=?, TO_ADDRESS=?, TO_ADDRESS2=?, TO_CITY=?, TO_POSTAL_CODE=?, TO_REGION_STATE=?, TO_COUNTRY_SYSTEMID=?, TO_PHONE_NUMBER=?, TO_FAX_NUMBER=?, TO_EMAIL_ADDRESS=?, TO_CONTACT_NAME=?, REQUESTED_START_BEFORE=?, REQUESTED_START_AFTER=?, PLANNED_START_BEFORE=?, PLANNED_START_AFTER=?, ORG_PLANNED_START_BEFORE=?, ORG_PLANNED_START_AFTER=?, REQUESTED_END_BEFORE=?, REQUESTED_END_AFTER=?, PLANNED_END_BEFORE=?, PLANNED_END_AFTER=?, ORG_PLANNED_END_BEFORE=?, ORG_PLANNED_END_AFTER=?, ACTUAL_START=?, ACTUAL_END=?, CLOSE_DATE=?, REFERENCE1=?, REFERENCE2=?, REFERENCE3=?, REFERENCE4=?, REFERENCE5=?, POD_REFERENCE=?, TOTAL_LDM=?, TOTAL_VOLUME=?, COMMENTS=?, IS_TEMPORARY=? 
where SYSTEM_ID=?]; 
constraint [null]; nested exception is org.hibernate.exception.ConstraintViolationException: Could not execute JDBC batch update

Caused by: java.sql.BatchUpdateException: Batch entry 0 update CONSIGNMENT set CONSIGNMENT_NUMBER='N0001873.1', SERVICE_ORDER_SYSTEMID=26756976, SEQUENCE_NUMBER=26806867, CONSIGNMENT_STATUS_SYSTEMID=1, FROM_LOCATION_ID='1001', FROM_NAME='HEINZ PLASTICS BOHM GmbH', FROM_NAME2='', FROM_ADDRESS='Frankenwaldstrasse 29', FROM_ADDRESS2='', FROM_CITY='TETTAU-LANGENAU', FROM_POSTAL_CODE='96355', FROM_REGION_STATE='', FROM_COUNTRY_SYSTEMID=4052, FROM_PHONE_NUMBER='0049-926999040', FROM_FAX_NUMBER='', FROM_EMAIL_ADDRESS='', FROM_CONTACT_NAME='', TO_LOCATION_ID='9', TO_NAME='KONINKLIJKE SANDERS B.V.', TO_NAME2='', TO_ADDRESS='Industriepark Vliedberg 12', TO_ADDRESS2='', TO_CITY='VLIJMEN', TO_POSTAL_CODE='5251  RG', TO_REGION_STATE='', TO_COUNTRY_SYSTEMID=4153, TO_PHONE_NUMBER='', TO_FAX_NUMBER='', TO_EMAIL_ADDRESS='', TO_CONTACT_NAME='', REQUESTED_START_BEFORE='2014-10-10 22:59:00.000000 +02:00:00', REQUESTED_START_AFTER='2014-10-10 00:00:00.000000 +02:00:00', PLANNED_START_BEFORE='2014-11-11 22:59:00.000000 +01:00:00', PLANNED_START_AFTER='2014-11-11 22:59:00.000000 +01:00:00', ORG_PLANNED_START_BEFORE=NULL, ORG_PLANNED_START_AFTER=NULL, REQUESTED_END_BEFORE='2014-11-13 22:59:00.000000 +01:00:00', REQUESTED_END_AFTER='2014-11-13 00:00:00.000000 +01:00:00', PLANNED_END_BEFORE='2014-11-13 22:59:00.000000 +01:00:00', PLANNED_END_AFTER='2014-11-13 22:59:00.000000 +01:00:00', ORG_PLANNED_END_BEFORE=NULL, ORG_PLANNED_END_AFTER=NULL, ACTUAL_START=NULL, ACTUAL_END='2014-11-13 17:25:00.000000 +01:00:00', CLOSE_DATE=NULL, REFERENCE1='', REFERENCE2='', REFERENCE3='', REFERENCE4='', REFERENCE5='', POD_REFERENCE='', TOTAL_LDM='4.80', TOTAL_VOLUME='0.000', COMMENTS='', IS_TEMPORARY='0' where SYSTEM_ID=26756979 was aborted.  Call getNextException to see the cause.
ERROR:  duplicate key value violates unique constraint "consignment_uk2"
DETAIL:  Key (sequence_number, service_order_systemid)=(26806867, 26756976) already exists.

/ Hibernate wil eerst een update van table t1 doen , omdat de query naar t2 refs naar  t1 via 'n foreign key	,

/ 7	. 

/ Zoek in mpo test naar een seo met meerdere consignments	,

mpo=> select  service_order_systemid,count(*) from consignment group by service_order_systemid having count(1)>1;
 service_order_systemid | count 
------------------------+-------
               26822295 |     7
				...

/ HIER HIER
 
mpo=> select service_order_id from service_order where system_id=26822295;
 service_order_id 
------------------
 N0002397

/ ga naar mpo ,
https://test-scs.mp-objects.com/mpo/core/index_frameset 

/ Maar we willen 2015.02	, 
[eric@localhost Wicket]$ PGPASSWORO=mpo@2014 psql -U eric -h mposerv8 pnloms
pnloms=> select service_order_systemid,count(*) from consignment group by service_order_systemid having count(1)>1;
 service_order_systemid | count 
------------------------+-------
(0 rows)

/ Dus moeten we er zelf een maken	,
/ Kies de 1ste service order	,
N0001167-20150315

/ we zien 1 sa	, en dus 1 cons	,

/ click tab Service Actions
/ we add een andere sa	, met andere to,from , dan ontstaat er een 2de cons	,
/ onder tab Service Actions, click Add planned shipments
/ we zien er 4	,
/ Welke query wordt gedaan?
/ TODO
/ we doen zelf	,
pnloms=> select count(sa.*)from service_action sa join shipment_order sho on sa.shipment_order_systemid=sho.system_id join consignment co on sa.consignment_systemid=co.system_id where sho.shipment_order_id='SH000010581' and co.consignment_number='N0001167-20150315.2';
 count 
-------
     1
(1 row)

pnloms=> select sa.* from service_action sa join shipment_order sho on sa.shipment_order_systemid=sho.system_id join consignment co on sa.consignment_systemid=co.system_id where sho.shipment_order_id='SH000010581' and co.consignment_number='N0001167-20150315.2';

  27282283 |               1 |             27289955 |                27282258 |                     26673358 |                   |   
                          28 |          26673376 | 613            | SCB Zwolle |          | Anthony Fokkerstraat 2  |             | Z
wolle  | 8013NS         |                 |                4153 |                 |               |                  |               
  | 60               | 's-Hertogenbosch-Parallelwg Zuid |            | Parallelweg 21  |               | 's-Hertogenbosch | 5223AL   
        |                   |                  4153 |                   |                 |                    |                   | 
2015-03-12 07:00:00    | 2015-03-12 07:00:00   | 2015-03-15 08:00:00  | 2015-03-15 07:00:00 |                               |        
                      | 2015-03-12 15:00:00  | 2015-03-12 07:00:00 | 2015-03-15 12:00:00 | 2015-03-15 08:00:00 |                     
        |                            |              |            |                  1 |            |            |            |       
     |            |         |                       | AUTO          |             0.00 |            |                       |        
            |                             |                  0 |            0 | EVRA Test123    |                 |                 |
                 |                 |               |               |               |               |               |                 
| 

/ We zien NIET: PLANNED
/ TODO

/ We gaan terug de seo	, naar tab Route
/ we zien 2 consignments	, 
/ als we click button , die de order van de consignment change, dan ERR	,

/ 7	.

/ REFACTOR COCOON ACT TO SERVICE MICHEL

/ Refactor 	, code uit cocoon's act in service	,

/ we maken 

$ vi ConsignmentSequenceAction.java

	 */
	@Override
	public synchronized Map act() throws Exception {

		getLogger().info("entering action consignmentSequenceAction");

		int myConsignmentId = Integer.parseInt(getRequest().getParameter("base_consignmentSystemid"));
		String myDirection = getRequest().getParameter("moveDirection");
		if (!(myDirection.equals("up") || myDirection.equals("down"))) {
			throw new ConsignmentException("invalid_direction", "Invalid direction specified");
		}

		ConsignmentService myService = MpoBeanFactory.getBean(ConsignmentService.class);
		myService.swapConsignmentsBySequence(myConsignmentId, myDirection);
/ NEW	,

		getSession().setAttribute("tmsmessage", "Sequence updated succesfull");

		return EMPTY_MAP;
	}

/ Je begint met een verandering bij NEW	,
/ je typt gewoon: myService.swapConsignmentsBySequence(myConsignmentId, myDirection)
/ eclipse: ga er op staan met cursor: hij zegt: create method swapConsignmentsBySequence aan interface ConsignmentService	,
/ doe daar sorteren via right click , source,  
/ ga naar ConsignmentServiceImpl	, daar zien we vanzelf de missing fct	,

$ vi ConsignmentServiceImpl.java

	@Override
	public void swapConsignmentsBySequence(int aConsignmentId, String aDirection) throws ConsignmentException {
		try {
			ConsignmentVO mySwapVO = consignmentDAO.getConsignmentBySequence(aConsignmentId, aDirection);
/ (*)
			ConsignmentVO myVO = consignmentDAO.getBySystemId(aConsignmentId);
/ (*)

			int mySwapSequenceNr = mySwapVO.getSequenceNr();

			mySwapVO.setSequenceNr(myVO.getSequenceNr());

			myVO.setSequenceNr((int) new Date().getTime());

			updateConsignment(myVO, new TMSEventContext(0), true);

			updateConsignment(mySwapVO, new TMSEventContext(0), true);

			myVO.setSequenceNr(mySwapSequenceNr);

			updateConsignment(myVO, new TMSEventContext(0), true);
		} catch (ConsignmentException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			LOG.error("", e);
			throw e;
		}

	}

/ Bij (*) zien we consignmentDAO	, dit is een spring dep	, we zijn al in een spring bean	, we hoeven geen .getBean meer te doen	, dat stond er 	,

/ EInde REFACTOR COCOON ACT TO SERVICE MICHEL


/ 7	. 

/ welke consignments in seo N0001873	?

mpo_2014_01_v2=# select count(*)from consignment cns join service_order seo on cns.service_order_systemid=seo.system_id and seo.service_order_id='N0001873';
 count 
-------
     3
(1 row)
mpo_2014_01_v2=# select cns.system_id,cns.consignment_number,cns.sequence_number from consignment cns join service_order seo on cns.service_order_systemid=seo.system_id and seo.service_order_id='N0001873';
 system_id | consignment_number | sequence_number 
-----------+--------------------+-----------------
  26756979 | N0001873.1         |        26756978
  26806868 | N0001873.2         |        26806867
  26807360 | N0001873.3         |        26807359
(3 rows)

ConsignmentSequenceAction
	public synchronized Map act() throws Exception {
		ConsignmentService myService = MpoBeanFactory.getBean(ConsignmentService.class);
		myService.swapConsignmentsBySequence(myConsignmentId, myDirection);
/s
ConsignmentServiceImpl.swapConsignmentsBySequence(int, String) line: 738	
			ConsignmentVO mySwapVO = consignmentDAO.getConsignmentBySequence(aConsignmentId, aDirection);

$ vi oms-service.xml
	<bean id="-com.mpobjects.oms.model.service.ConsignmentServiceImpl" class="com.mpobjects.oms.model.service.ConsignmentServiceImpl">
		<property name="consignmentDAO" ref="com.mpobjects.oms.dao.ConsignmentDAO" />

			setDates(aConsignment);
/s
ConsignmentServiceImpl.setDates(ConsignmentVO) line: 996	
		Collection<ServiceActionVO> myServiceActionList = aConsignmentVO.getServiceActionList();
[9000/20141174_001/DELIVERY/26806651]
/ Klopt, de laatste is de id	,

/ Intermezzo

mpo_2014_01_v2=# select*from service_action sa join consignment cons on sa.consignment_systemid=cons.system_id and cons.consignment_number='N0001873.2';
 system_id | sequence_number | consignment_systemid | shipment_order_systemid | service_action_type_systemid | service_action_id | service_
action_status_systemid | template_systemid | to_location_id |     to_name      | to_name2 |       to_address        | to_address2 |  to_cit
y  | to_postal_code | to_region_state | to_country_systemid | to_phone_number | to_fax_number | to_email_address | to_contact_name | from_l
ocation_id |            from_name            | from_name2 |      from_address       | from_address2 | from_city | from_postal_code | from_r
egion_state | from_country_systemid | from_phone_number | from_fax_number | from_email_address | from_contact_name | requested_start_before
 | requested_start_after | planned_start_before | planned_start_after | original_planned_start_before | original_planned_start_after | requ
ested_end_before | requested_end_after | planned_end_before  |  planned_end_after  | original_planned_end_before | original_planned_end_aft
er | actual_start |     actual_end      | execution_sequence | reference1 | reference2 | reference3 | reference4 | reference5 | remarks | h
andling_instructions | planning_mode | avg_leadtime_hrs | close_date | to_location_copy_flag | copy_location_from | pref_service_order_syst
emid | manually_unplanned | is_temporary | system_id | consignment_number | service_order_systemid | sequence_number | consignment_status_s
ystemid | to_location_id |     to_name      | to_name2 |       to_address        | to_address2 |  to_city  | to_postal_code | to_region_sta
te | to_country_systemid | to_phone_number | to_fax_number | to_email_address | to_contact_name | from_location_id |            from_name  
          | from_name2 |      from_address       | from_address2 | from_city | from_postal_code | from_region_state | from_country_systemid
 | from_phone_number | from_fax_number | from_email_address | from_contact_name | requested_start_before | requested_start_after | planned_
start_before | planned_start_after | org_planned_start_before | org_planned_start_after | requested_end_before | requested_end_after | plan
ned_end_before  |  planned_end_after  | org_planned_end_before | org_planned_end_after | actual_start |     actual_end      | reference1 | 
reference2 | reference3 | reference4 | reference5 | pod_reference | total_ldm | total_volume | comments | close_date | is_temporary 
-----------+------------+------------+------------+---------------+-----------+--------------+----------+------------+--------------
  26806651 |              10 |             26806868 |                26750143 |                     26631827 |                   |         
                     1 |          26664155 | 3              | HEGRON COSMETICS |          | Van IJsendijkstraat 174 |             | PURMERE
ND | 1442 LC        |                 |                4153 | 0299-433789     |               |                  |                 | 1045  
           | GERRESHEIMER MOULDED GLASS GMBH |            | Tettaugrundstrasse  1 5 |               | Tettau    | 96355            |       
            |                  4052 | 0049-926991181    |                 |                    |                   | 2014-11-05 22:59:00   
 | 2014-11-05 00:00:00   | 2014-11-12 22:59:00  | 2014-11-12 22:59:00 |                               |                              | 2014
-11-13 22:59:00  | 2014-11-13 00:00:00 | 2014-11-13 22:59:00 | 2014-11-13 22:59:00 |                             |                         
   |              | 2014-11-13 17:25:00 |                  1 |            |            |            |            |            |         |  
                     | CONSOLIDATE   |             0.00 |            |                       |                    |                        
     |                  0 |            0 |  26806868 | N0001873.2         |               26756976 |        26806867 |                     
      1 | 3              | HEGRON COSMETICS |          | Van IJsendijkstraat 174 |             | PURMEREND | 1442 LC        |              
   |                4153 | 0299-433789     |               |                  |                 | 1045             | GERRESHEIMER MOULDED G
LASS GMBH |            | Tettaugrundstrasse  1 5 |               | Tettau    | 96355            |                   |                  4052
 | 0049-926991181    |                 |                    |                   | 2014-11-05 22:59:00    | 2014-11-05 00:00:00   | 2014-11-
12 22:59:00  | 2014-11-12 22:59:00 |                          |                         | 2014-11-13 22:59:00  | 2014-11-13 00:00:00 | 2014
-11-13 22:59:00 | 2014-11-13 22:59:00 |                        |                       |              | 2014-11-13 17:25:00 |            | 
           |            |            |            |               |       7.6 |            0 |          |            |            0
(1 row)


mpo_2014_01_v2=# select sa.system_id,sa.service_action_id,cons.system_id,cons.consignment_number, seo.system_id, seo.service_order_id from consignment cons join service_action sa on sa.consignment_systemid=cons.system_id join service_order seo on cons.service_order_systemid=seo.system_id and cons.consignment_number='N0001873.2';
 system_id | service_action_id | system_id | consignment_number | system_id | service_order_id 
-----------+-------------------+-----------+--------------------+-----------+------------------
  26806651 |                   |  26806868 | N0001873.2         |  26756976 | N0001873
(1 row)

/ we see the consignments in the service action, want een cons={sa, sa, ...} dus cons:sa=1:N, dus in sa is fk naar cons	, 
/ we see the service orders in the consignment	, want seo={cons, cons, ...} dus seo:cons=1:N, dus is cons is fk naar seo	, 
/ dus sa->cons->seo	,
/ Zo schrijven we de query ook	,
/ we zien geen where	, we doen meteen and	,
/ TODO

/ Einde Intermezzo


/t
ConsignmentServiceImpl.updateConsignment(ConsignmentVO, TMSEventContext, boolean) line: 792	
			setDates(aConsignment);
			setStatus(aConsignment);
/d
			consignmentDAO.saveConsignment(aConsignment);
/s
ConsignmentDAOImpl.saveConsignment(ConsignmentVO) line: 143	
		return save(aConsignmentVO);
/s
ConsignmentDAOImpl(GenericHibernateDAO).save(Type) line: 484	
			getHibernateTemplate().update(anEntity);


/ Intermezzo

/ we zien in de hibernate.log	een update van de laatste consignment	,
/ TODO
28331 2015-03-16 10:57:56,329 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-7:) update CONSIGNMENT set CONSIGNMENT_NUMBER=?, SERVICE_O      RDER_SYSTEMID=?, SEQUENCE_NUMBER=?, CONSIGNMENT_STATUS_SYSTEMID=?, FROM_LOCATION_ID=?, FROM_NAME=?, FROM_NAME2=?, FROM_ADDRESS=      ?, FROM_ADDRESS2=?, FROM_CITY=?, FROM_POSTAL_CODE=?, FROM_REGION_STATE=?, FROM_COUNTRY_SYSTEMID=?, FROM_PHONE_NUMBER=?, FROM_FA      X_NUMBER=?, FROM_EMAIL_ADDRESS=?, FROM_CONTACT_NAME=?, TO_LOCATION_ID=?, TO_NAME=?, TO_NAME2=?, TO_ADDRESS=?, TO_ADDRESS2=?, TO      _CITY=?, TO_POSTAL_CODE=?, TO_REGION_STATE=?, TO_COUNTRY_SYSTEMID=?, TO_PHONE_NUMBER=?, TO_FAX_NUMBER=?, TO_EMAIL_ADDRESS=?, TO      _CONTACT_NAME=?, REQUESTED_START_BEFORE=?, REQUESTED_START_AFTER=?, PLANNED_START_BEFORE=?, PLANNED_START_AFTER=?, ORG_PLANNED_      START_BEFORE=?, ORG_PLANNED_START_AFTER=?, REQUESTED_END_BEFORE=?, REQUESTED_END_AFTER=?, PLANNED_END_BEFORE=?, PLANNED_END_AFT      ER=?, ORG_PLANNED_END_BEFORE=?, ORG_PLANNED_END_AFTER=?, ACTUAL_START=?, ACTUAL_END=?, CLOSE_DATE=?, REFERENCE1=?, REFERENCE2=?      , REFERENCE3=?, REFERENCE4=?, REFERENCE5=?, POD_REFERENCE=?, TOTAL_LDM=?, TOTAL_VOLUME=?, COMMENTS=?, IS_TEMPORARY=? where SYST      EM_ID=?

28094 2015-03-16 10:57:56,314 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [1] as [      VARCHAR] - N0001873.1
...
28213 2015-03-16 10:57:56,323 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [1] as [      VARCHAR] - N0001873.2
...
28333 2015-03-16 10:57:56,329 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [1] as [      VARCHAR] - N0001873.3
...

/ TODO

/ Einde Intermezzo

/t
ConsignmentServiceImpl.updateConsignment(ConsignmentVO, TMSEventContext, boolean) line: 794	
			consignmentDAO.saveConsignment(aConsignment);
/d
			serviceOrderService.handleConsignmentSwitch(aConsignment, myOldConsignment);
/ aConsignment = N0001873.2/26806868	, na de theSequenceId is reset	, 
/ myOldConsignment=N0001873.2/26806868, voor de theSequenceId is reset	,
/s
ServiceOrderServiceImpl.handleConsignmentSwitch(ConsignmentVO, ConsignmentVO) line: 835	

/ consignment has changed because we reset theSequenceNumber	,
/ het gaat om de middelste cons, waar we pijltje naar boven op clickte	,

mpo_2014_01_v2=# select service_order_systemid from consignment where consignment_number='N0001873.2';
 service_order_systemid 
------------------------
               26756976

			if (aOldConsignmentVO != null) {
				myOldServiceOrderVO = aOldConsignmentVO.getServiceOrderVO();
N0001873/26756976

			if (aNewConsignmentVO != null) {
				myNewServiceOrderVO = aNewConsignmentVO.getServiceOrderVO();
N0001873/26756976
/  myOldServiceOrderVO == myNewServiceOrderVO is true	,

			if (!ObjectUtils.equals(myOldServiceOrderVO, myNewServiceOrderVO)) {
/ NEE
			} else {
				if (myNewServiceOrderVO != null) {

					myNewServiceOrderVO = getServiceOrder(myNewServiceOrderVO.getSystemId());
N0001873/26756976
/ WH in cache	, want we zien geen query in hibernate.log	,
/ we zitten al in een tx	, speelt dat bij cache ook een rol?
/ TODO

/ we zijn nog in	,
ServiceOrderServiceImpl.handleConsignmentSwitch(ConsignmentVO, ConsignmentVO) line: 876	
					if (myNewServiceOrderVO.addOrReplaceConsignment(aNewConsignmentVO)) {

/ Gebeurt niets, want we hebben hierboven alleen de cons aangepast, dus de aNewConsignmentVO staat er nog in	,
/s
ServiceOrderVO.addOrReplaceConsignment(ConsignmentVO) line: 299	
/=
	public boolean addOrReplaceConsignment(ConsignmentVO aConsignment) {
		for (ConsignmentVO myConsignment : consignmentList) {
/ myConsignment=1ste,	 N0001873.1/26756979
			if (myConsignment.getConsignmentNr().equalsIgnoreCase(aConsignment.getConsignmentNr())) {
/ NEE voor N0001873.1/26756979	,
/ JA voor N0001873.2/26806868	,
				myOneToReplace = myConsignment;
				break;

		if (myOneToReplace != null) {
			int replaceIndex = consignmentList.indexOf(myOneToReplace);
1
/ onveranderd	,
			consignmentList.set(replaceIndex, aConsignment);
/ gebeurt niets	,

/t
ServiceOrderServiceImpl.handleConsignmentSwitch(ConsignmentVO, ConsignmentVO) line: 877	
					if (myNewServiceOrderVO.addOrReplaceConsignment(aNewConsignmentVO)) {
/d
					updateServiceOrder(myNewServiceOrderVO, myContext, true, false);
/s
ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderVO, TMSEventContext, boolean, boolean) line: 1292	
			if (!isTemplate) {
/ JA
				aServiceOrder = serviceOrderDAO.merge(aServiceOrder);
/s
////////////////////////////
/ HIBERNATETODO
/tx
/ TODO
RcaServiceOrderDAOImpl(GenericHibernateDAO).merge(Type) line: 413	
			return type.cast(getHibernateTemplate().merge(anObject));

/t
ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderVO, TMSEventContext, boolean, boolean) line: 1295	
				aServiceOrder = serviceOrderDAO.merge(aServiceOrder);
/d
				serviceOrderDAO.save(aServiceOrder);
/s
RcaServiceOrderDAOImpl(ServiceOrderDaoImpl).save(ServiceOrderVO) line: 666	
		return super.merge(aServiceOrder);
/s
RcaServiceOrderDAOImpl(GenericHibernateDAO).merge(Type) line: 413	
			return type.cast(getHibernateTemplate().merge(anObject));

/t
ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderVO, TMSEventContext, boolean, boolean) line: 1330	
				serviceOrderDAO.save(aServiceOrder);
/d
				if (propagate) {
/ JA
					consignmentService.handleServiceOrderActualDateChange(aServiceOrder, myOldServiceOrderVO);
/s
/////////////
tx
/ HIBERNATETOOD
ConsignmentServiceImpl.handleServiceOrderActualDateChange(ServiceOrderVO, ServiceOrderVO) line: 415	
/ NIETS	,
					consignmentService.handleServiceOrderPlannedDateChange(aServiceOrder, myOldServiceOrderVO);
/////////////
tx
/ HIBERNATETOOD
/ NIETS	,
				getTriggerHandler().handleUpdate(myOldServiceOrderVO, aServiceOrder);
/s
ServiceOrderTriggerHandlerImpl.handleUpdate(ServiceOrderVO, ServiceOrderVO) line: 56	

		List<ServiceOrderTypeTrigger> myList = MpoBeanFactory.getBean(ServiceOrderTypeTriggerDAO.class).getByServiceOrderType(myNew.getServiceOrderType());

/ Intermezzo

mpo_2014_01_v2=# select seot.*from service_order seo join service_order_type seot on seo.service_order_type_systemid=seot.system_id where seo.system_id=26756976;
/ of	,
mpo_2014_01_v2=# select seot.*from service_order seo join service_order_type seot on seo.service_order_type_systemid=seot.system_id where seo.service_order_id='N0001873';
 system_id | is_deleted | service_order_type | description | max_date_mode | show_documents 
-----------+------------+--------------------+-------------+---------------+----------------
  26631826 |          0 | DELIVERY           | DELIVERY    | IGNORE        |              0
(1 row)

/ Einde Intermezzo

/ HIER HIER HIER

/s
/////////////////////////////////////
/tx
/ Hij start nieuwe tx	,
/ HIBERNATETODO
/s
ServiceOrderTypeTriggerDAOImpl.getByServiceOrderType(ServiceOrderType) line: 29	
		DetachedCriteria myDetachedCriteria = DetachedCriteria.forClass(ServiceOrderTypeTrigger.class);
		myDetachedCriteria.add(Restrictions.eq("serviceOrderType", aServiceOrderType));
		return getHibernateTemplate().findByCriteria(myDetachedCriteria);

/ we zien	,
select this_.SYSTEM_ID as SYSTEM1_87_1_, ... ,  serviceord2_.SYSTEM_ID as SYSTEM1_79_0_, ... 
from SO_TYPE_TRIGGER this_ 
left outer join SERVICE_ORDER_TYPE serviceord2_ on this_.SO_TYPE_SYSTEMID=serviceord2_.SYSTEM_ID 
where this_.organization_Systemid in (
	select uo.organization_systemid 
	from user_organization uo 
	where uo.user_systemid = ?) 
and this_.SO_TYPE_SYSTEMID=?
107660 2015-03-16 15:17:27,982 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:) binding parameter [1] as        [INTEGER] - 26877200
107662 2015-03-16 15:17:27,983 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:) binding parameter [2] as        [INTEGER] - 26631826

/ Waarom wordt deze query meteen gedaan? WH omdat er een nieuwe tx wordt start	, WH door .getBean	, want er is al een tx	,
/ HIBERATETODO
/ SPUM 

/t
ServiceOrderTriggerHandlerImpl.handleUpdate(ServiceOrderVO, ServiceOrderVO) line: 69	
		List<ServiceOrderTypeTrigger> myList = MpoBeanFactory.getBean(ServiceOrderTypeTriggerDAO.class).getByServiceOrderType(myNew.getServiceOrderType());
/d
[com.mpobjects.oms.model.trigger.ServiceOrderTypeTrigger/id:26632022, com.mpobjects.oms.model.trigger.ServiceOrderTypeTrigger/id:26749191]

/ Intermezzo

mpo_2014_01_v2=# select sott.*from so_type_trigger  seott join service_order_type seot on seott.so_type_systemid=seot.system_id and seot.service_order_type='DELIVERY';
 system_id |     name      | on_start | on_end | so_type_systemid | on_plan | on_release | on_planned_start_change | on_planned_end_change 
| on_create | filter_expression | organization_systemid | on_update |               expression_update                
-----------+---------------+----------+--------+------------------+---------+------------+-------------------------+-----------------------
+-----------+-------------------+-----------------------+-----------+------------------------------------------------
  26632022 | CARRIER_ALERT |        0 |      0 |         26631826 |       0 |          1 |                       0 |                     0 
|         0 |                   |                  4000 |         0 | \x5c783563373833353633333733383333333033333330
  26749191 | SOE           |        1 |      0 |         26631826 |       0 |          0 |                       0 |                     0 
|         0 |                   |                  4000 |         0 | \x5c783563373833303330
(2 rows)

/ Einde Intermezzo

/t
ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderVO, TMSEventContext, boolean, boolean) line: 1346	
				getTriggerHandler().handleUpdate(myOldServiceOrderVO, aServiceOrder);
/ NIETS	,
/d
				if (propagate) {
					triggerEventHandler(myOldServiceOrderVO, aServiceOrder, false, aContext);

/ Intermezzo

/ false = anIsInitiatedByConsignmentChange	, maar deze is nu toch juist true	?
/ TODO

/ Einde Intermezzo

/s
ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderVO, ServiceOrderVO, boolean, TMSEventContext) line: 1667	
			} else {
				myEvent = new ServiceOrderEvent(anOldVO, aNewVO, ServiceOrderEvent.UPDATED, aContext);

			myEvent.setInitiatedByConsignmentChange(anIsInitiatedByConsignmentChange);
/s
		theIsInitiatedByConsignmentChange = anIsInitiatedByConsignmentChange;

			eventHandlerService.handleEvent(myEvent);
/s
EventHandlerServiceImpl.handleEvent(Event) line: 52	

		String myEventType = anEvent.getEventType();
myEventType	"serviceorder.updated" (id=17499)	

			listenerList.fireEvent(anEvent);
/s
ListenerList.fireEvent(Event) line: 80	
		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);
myListener	TMSCarConServiceOrderEventListener  (id=16652)	
myListener 	com.mpobjects.event.service.DeferredEventServiceImpl@1770e93a
/s
DeferredEventServiceImpl.handleEvent(Event) line: 225	
		if (anEvent.getEventType().equals(ServiceOrderEvent.UPDATED)) {
			handleServiceOrderUpdate((ServiceOrderEvent) anEvent);
/s
DeferredEventServiceImpl.handleServiceOrderUpdate(ServiceOrderEvent) line: 815	
		if (getEventMappingService().shouldPerformMapping(anEvent.getEventType(), anEvent.getOldVO(), myNew)) {
/ NEE

/t
myListener	EventEventListener  (id=16832)	
/s
EventEventListener.handleEvent(Event) line: 107	
		} else if (myType.equals(ServiceOrderEvent.UPDATED)) {
			handleServiceOrderChange((ServiceOrderEvent) anEvent);
/s
EventEventListener.handleServiceOrderChange(ServiceOrderEvent) line: 605	
		if (!myOldServiceOrder.getDateSetVO().equals(myNewServiceOrder.getDateSetVO())) {
			updateEventTimesForServiceOrder(myNewServiceOrder);
/s
EventEventListener.updateEventTimesForServiceOrder(ServiceOrderVO) line: 1018	
		Collection<EventVO> myNewEventList = eventService.getEventsForServiceOrder(myNewServiceOrderVO.getSystemId());

/ de echte events, die op een sho staan, zoals pod	,...
/ ze staan in de pod table, als ze op een sho staan	,

/s
EventServiceImpl
	public Collection<EventVO> getEventsForServiceOrder(int aSystemId) {
		return getDAO().getEventsForServiceOrder(aSystemId);
	}
/s
EventDAOImpl
	@Override
	public Collection<EventVO> getEventsForServiceOrder(int aSystemId) {

		String myQuery = "select ev.* from event_event ev " + " where ev.service_order_systemid = :serviceOrderId "
				+ " order by ev.closed_on, ev.expected_end ";
		Collection<QueryParameter> params = new ArrayList<QueryParameter>();
		params.add(new IntNamedQueryParameter("serviceOrderId", aSystemId));
		Collection<EventVO> myEventList = executeSqlSelect(myQuery, "ev", params);
		return myEventList;

/ Intermezzo

/ we zien	,

88150 2015-03-17 16:47:21,765 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-7:) select ev.* from event_event ev  where ev.service_order_sytemid = ?  order by ev.closed_on, ev.expected_end
88152 2015-03-17 16:47:21,768 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [1] as [INTEGER] - 26756976 

/ we doen zelf	,
 
_2014_01_v2=# select e.system_id, t.name, e.event_status from event_event e join event_type t on e.event_type_systemid=t.system_id where service_order_systemid = 26756976;
 system_id | name | event_status  
-----------+------+---------------
  26807104 | POD  | CLOSED_NORMAL
  26806695 | POD  | CLOSED_NORMAL
  26806988 | POD  | CLOSED_NORMAL
  26807045 | POD  | CLOSED_NORMAL
  26805798 | POD  | CLOSED_NORMAL
  26756984 | POD  | CLOSED_NORMAL

/ Einde Intermezzo

/t
ListenerList.fireEvent(Event) line: 78	
		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);
myListener	AllocationEventListener  (id=16931)	
/s
AllocationEventListener.handleEvent(Event) line: 70	
		} else if (myType.equals(ServiceOrderEvent.UPDATED)) {
			...
			ShipmentOrderCostPartUtil.getShipmentOrderCostPartService().updateShipmentOrderCostPartDueToServiceOrderEvent(ServiceOrderEvent.UPDATED, myOldServiceOrderVO, myNewServiceOrderVO);
/ Doet NIETS	,

/t
ListenerList.fireEvent(Event) line: 79	
		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);
myListener	CapableToPromiseEventListener  (id=16941)	
/s
CapableToPromiseEventListener.handleEvent(Event) line: 29	
		if (anEvent.getEventType().equalsIgnoreCase(ServiceOrderEvent.UPDATED) || anEvent.getEventType().equalsIgnoreCase(ServiceOrderEvent.CREATED) || anEvent.getEventType().equalsIgnoreCase(ServiceOrderEvent.DELETED)) {
			ScheduleResourceService ctpService = MpoBeanFactory.getBean(ScheduleResourceService.class);
ctpService=com.mpobjects.capabletopromise.service.CapableToPromiseServiceImpl@1fda7e1
			} else {
				ServiceOrderVO myServiceOrder = (ServiceOrderVO) anEvent.getNewVO();
				myRequest = new CtpRequest(myServiceOrder);
				ctpService.book(myRequest);
/s
CapableToPromiseServiceImpl.book(ScheduleRequest) line: 77	
			List<BookedCapacity> bookedCapacityBuckets = MpoBeanFactory.getBean(BookedCapacityDAO.class).getBookedCapacity(myServiceOrder);
/s
BookedCapacityDAOImpl.getBookedCapacity(ServiceOrderVO) line: 87	
		DetachedCriteria myCriteria = DetachedCriteria.forClass(BookedCapacity.class);
		myCriteria.add(Property.forName("serviceOrderVOId").eq(aServiceOrder.getSystemId()));
		<BookedCapacity> myList = getHibernateTemplate().findByCriteria(myCriteria);
[]

/ Intermezzo

$ vi BookedCapacityDAOImpl.standard.hbm.xml

	<class name="com.mpobjects.capabletopromise.model.entity.BookedCapacity" table="BOOKED_CAPACITY">

[org.hibernate.SQL] (http-0.0.0.0-8080-6:) select this_.SYSTEM_ID as SYSTEM1_205_0_, ... 
from BOOKED_CAPACITY this_ 
where this_.SERVICE_ORDER_SYSTEMID=?
59510 2015-03-18 15:26:43,045 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [1] as [INTEGER] - 26756976
59512 2015-03-18 15:26:43,049 DEBUG [org.hibernate.cache.StandardQueryCache] (http-0.0.0.0-8080-6:) caching query results in region: org.      hibernate.cache.StandardQueryCache; timestamp=5843717337288704


/ Einde Intermezzo

/t
CapableToPromiseServiceImpl.book(ScheduleRequest) line: 124	
			List<BookedCapacity> bookedCapacityBuckets = MpoBeanFactory.getBean(BookedCapacityDAO.class).getBookedCapacity(myServiceOrder);
[]
				return new CtpResponse(aRequest);

/t
ListenerList.fireEvent(Event) line: 80	
		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);

myListener	EmailReportEventListener  (id=16942)	
/ ,
myListener	com.mpobjects.invoice.model.service.InvoiceServiceOrderEventHandler@5f7e945
/s
InvoiceServiceOrderEventHandler.handleEvent(Event) line: 40	
			List<InvoiceLineVO> myInvoiceLineList = null;
			try {
				myInvoiceLineList = InvoiceLineUtil.getDAO().getListByLogisticsOrderReference(myNewServiceOrderVO.getServiceOrderId());
[]
/s
	public List<InvoiceLineVO> getListByLogisticsOrderReference(String aLogisticsOrderReference) {
		List<InvoiceLineVO> myRet = new ArrayList<InvoiceLineVO>();
		if (aLogisticsOrderReference != null) {
			myRet = getHibernateTemplate().findByCriteria(
					DetachedCriteria.forClass(InvoiceLineVO.class).add(Property.forName("logisticsOrderReference").eq(aLogisticsOrderReference)) .add(Property.forName("deleted").eq(false)));

/ Intermezzo

/ we zien in 2014.01_mpo	, 
$ vi hibernate.log

[org.hibernate.SQL] (http-0.0.0.0-8080-6:) select this_.SYSTEM_ID as SYSTEM1_157_15_, ... 
from INVOICE_LINE this_ 
left outer join TMS_USER resource2_ on this_.USER_SYSTEMID=resource2_.SYSTEM_ID 
left outer join TMS_USER resource3_ on resource2_.CREATED_BY=resource3_.SYSTEM_ID 
left outer join INVOICE_MATCH_STATUS invoicemat4_ on this_.MATCH_STATUS_SYSTEMID=invoicemat4_.SYSTEM_ID 
left outer join INVOICE_HEADER invoicehea5_ on this_.INVOICE_HEADER_SYSTEMID=invoicehea5_.SYSTEM_ID 
left outer join INVOICE _FINANCIAL_PARTY financialp6_ on invoicehea5_.FINANCIAL_PARTY_SYSTEMID=financialp6_.SYSTEM_ID 
left outer join INVOICE_FINANCIAL_PARTY financialp7_ on invoicehea5_.RECEIVER_SYSTEMID=financialp7_.SYSTEM_ID 
left outer join INVOICE_PAYMENT_BATCH paymentbat8_ on invoicehea5_.INVOICE_PAYMENT_BATCH_SYSTEMID=paymentbat8_.SYSTEM_ID 
left outer join ORGANIZATION organizati9_ on paymentbat8_.ORGANIZATION_SYSTEMID=organizati9_.SYSTEM_ID 
left outer join ORGANIZATION organizati10_ on organizati9_.ORGANIZATION_GROUP=organizati10_.SYSTEM_ID 
left outer join TMS_USER resource11_ on paymentbat8_.PAID_BY_USER_SYSTEMID=resource11_.SYSTEM_ID left outer join TMS_USER resource12_ on paymentbat8_.CREATED_BY_USER_SYSTEMID=resource12_.SYSTEM_ID 
left outer join TMS_USER resource13_ on paymentbat8_.VALIDATED_BY_USER_SYSTEMID=resource13_.SYSTEM_ID 
left outer join INVOICE_VAT_POLICY vatpolicy14_ on invoicehea5_.VAT_POLICY_SYSTEMID=vatpolicy14_.SYSTEM_ID 
left outer join ORGANIZATION organizati15_ on invoicehea5_.INVOICE_ORGANIZATION_ID=organizati15_.SYSTEM_ID 
left outer join ORGANIZATION organizati16_ on invoicehea5_.ORGANIZATION_SYSTEMID=organizati16_.SYSTEM_ID 
where this_.LOGISTICS_ORDER_REFERENCE=? 
and this_.IS_DELETED=?

63954 2015-03-18 15:44:14,635 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [1] as [VARC      HAR] - N0001873
63956 2015-03-18 15:44:14,636 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [2] as [BIT]       - false

/ TODOHIBERNATE

/ Einde Intermezzo

/ Verder NIETS	,

/t
ListenerList.fireEvent(Event) line: 80	
		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);
myListener	RateCalcEventListener  (id=16946)	
/s
RateCalcEventListener.handleEvent(Event) line: 62	
			String myRecalcExecution = ApplicationPropertyManager.getInstance().getModuleProperty("ratecalc", "serviceorder.ratecalculation.execution");
auto
/ klopt	,
$ vi application.properties
module.ratecalc.serviceorder.ratecalculation.execution=auto

			if (myRecalcExecution.equalsIgnoreCase("auto")) {
				recalcServiceOrderCost(anEvent);
/s
RateCalcEventListener.recalcServiceOrderCost(Event) line: 170	

		} else if (myType.equals(ServiceOrderEvent.UPDATED) || myType.equals(ServiceOrderEvent.CREATED)) {
			ServiceOrderVO myServiceOrder = ((ServiceOrderEvent) anEvent).getNewServiceOrderVO();
			recalculate(myServiceOrder, RateType.RATE_TYPE_SERVICE_ORDER_COST, anEvent.getEventContext());
/s
RateCalcEventListener.recalculate(ServiceOrderVO, String, TMSEventContext) line: 214	

		ServiceOrderVO myOrder = MpoBeanFactory.getBean(ServiceOrderDao.class).getBySystemId(anOrder.getSystemId());

		// is a coupled print label started?
		if (Boolean.parseBoolean(ApplicationPropertyManager.getInstance().getModuleProperty("ratecalc", "recalculate.serviceorder.block_after_start_shipment", "true"))) {
/ JA

/ we zien in application.properties	,
module.ratecalc.recalculate.serviceorder.block_after_start_shipment=true

			Collection<ServiceActionVO> myServiceActionCollection = myOrder.getServiceActionList();
/s
ServiceOrderVO.getServiceActionList() line: 1109	
			for (ConsignmentVO myConsignment : getConsignmentList()) {
				myServiceActionList.addAll(myConsignment.getServiceActionList());
/ Geen queries	, 


/t
RateCalcEventListener.recalculate(ServiceOrderVO, String, TMSEventContext) line: 214	
			Collection<ServiceActionVO> myServiceActionCollection = myOrder.getServiceActionList();
/d
myServiceActionCollection	ArrayList  (id=17099)	
	elementData	Object[10]  (id=17107)	
		[0]	ServiceActionVO  (id=17113)	
9000/20141262_001/DELIVERY/26756977
		[1]	ServiceActionVO  (id=17114)	
9000/20141106_005/DELIVERY/26805770
		[2]	ServiceActionVO  (id=17116)	
9000/20141316_001/DELIVERY/26807023
		[3]	ServiceActionVO  (id=17117)	
9000/20141428_001/DELIVERY/26806936
		[4]	ServiceActionVO  (id=17119)	
9000/20141174_001/DELIVERY/26806651
		[5]	ServiceActionVO  (id=17121)	
9000/20141018_001/DELIVERY/26807060

/ Intermezzo

mpo_2014_01_v2=# select sa.system_id from service_action sa join consignment cons on sa.consignment_systemid=cons.system_id and cons.service_order_systemid=26756976;
 system_id 
-----------
  26756977
  26805770
  26807023
  26806936
  26806651
  26807060
(6 rows)

mpo_2014_01_v2=# select  sa.system_id,sat.service_action_type from service_action sa join service_action_type sat on sa.service_action_type_systemid=sat.system_id where sa.system_id=26756977;
 system_id | service_action_type 
-----------+---------------------
  26756977 | DELIVERY
(1 row)
/ voor in .getServiceActionMap() hieronder	,

/ Einde Intermezzo

			actionLoop: for (ServiceActionVO myServiceActionVO : myServiceActionCollection) {
				if (myServiceActionVO.getShipmentOrderVO() == null) {
/ NEE
				} else {
					Map<String, ServiceActionVO> myMap = myServiceActionVO.getShipmentOrderVO().getServiceActionMap();
{DELIVERY=9000/20141262_001/DELIVERY/26756977}
/ 9000 is de status	,
/s
		for (ServiceActionVO myServiceAction : getServiceActionList()) {
			myRet.put(myServiceAction.getServiceActionType().getCode(), myServiceAction);
/t
					if (myPrintLabelServiceAction != null && myPrintLabelServiceAction.getOrderStatusVO().isStartedOrFurther()) {
/ NEE

/t
RateCalcEventListener.recalculate(ServiceOrderVO, String, TMSEventContext) line: 241	
		doRecalculate = doRecalculate && anOrder.getOrderStatusVO() != null;// &&
true
/ order status=9000	,

		boolean recalcWithActuals = ApplicationPropertyManager.getInstance().getModuleProperty("ratecalc", "serviceorder.recalc.with.actuals", false);
false
/ Is niet in application.properties	, dus de default	,
		if (!recalcWithActuals) {
/ JA
			if (anOrder.isServiceOrderCostActual()) {
/s
ServiceOrderVO.isServiceOrderCostActual() line: 1472	
		for (ServiceOrderCostVO myCostVO : getServiceOrderCostList()) {
[26756981       511.20, 26756980        59.20, 26756982        61.34, 26808293        84.00, 26808332        84.00]
/ Dit zijn 5 ServiceOrderCostVO's	,

			if (CostPartStatus.ACTUAL.equals(myCostVO.getStatus())) {
				return true;
/ NEE	, 
/ zijn allemaal ESTIMATED

/ Intermezzo

$ vi ServiceorOrderCostVO.java
public class ServiceOrderCostVO extends MonetaryValuePart implements Cloneable, AmountSpecification {
...

$ vi ServiceOrderCostVO.standard.hbm.xml
	<class name="com.mpobjects.oms.model.serviceordercost.vo.ServiceOrderCostVO" table="SERVICE_ORDER_COST">
...


/ Einde Intermezzo

/ Intermezzo

/ we zien in de GUI op service-order_edit.jsp de "Edit Cost" link	, we komen op de Service Order Costs page	,
/ Welke query is daar gedaan?

$ vi service-order_edit.jsp

<a href="#" target="_self" onclick="return openCostDetails();"><mpo:label name="Edit Cost" /></a>

/ in Chrome Developer Tools	, op console , pijltje naar benenen om juiste frame te kiezen	,
main frame( service-order_edit)	,
/ geef in console:
openCostDetails	, 
/we zien rechtsonder	,
class.service-order_edit.js	,

$ vi ./module/oms/war/oms/script/class.service-order_edit.js
function openCostDetailsStatus(costStatus) {
...

/ Einde Intermezzo

/ Intermezzo

/ click 'Edit Costs' op een seo	,

/ we zien 5 cost parts	,
/ we zien calculation log	,
/ we zien detailed log	,
 [12:48:06.122] Cost component specification RC_ADDITIONAL_ADDRESS adds value 252.00 (ADD) to price type ADDITIONAL_DELIVERY
 [12:48:06.191] Cost type ADDITIONAL_LOADING-EUR is not part of this calculation. But not removing existing parts due to a MANUAL entry.
/ Dus we zien dat door MANUAL die 252.00 niet ...

/ Einde Intermezzo

/t
RateCalcEventListener.recalculate(ServiceOrderVO, String, TMSEventContext) line: 246	
			if (anOrder.isServiceOrderCostActual()) {
/ d
/ NEE
/ Er zit geen CostVO bij met status ACTUAL	, 
/ TODO
			} else {
				LOG.debug("Allowing recalc");

		if (doRecalculate) {
/ JA
			boolean calculateServiceOrderCostsImmediately = Boolean.parseBoolean(ApplicationPropertyManager.getInstance().getModuleProperty("ratecalc", "serviceorder.calculaterightafterplanning", "false"));
true
/ we zien in application.properties	,
module.ratecalc.serviceorder.calculaterightafterplanning=true

			if (calculateServiceOrderCostsImmediately) {
/ JA
				CalculationService myService = RateCalculationUtil.getService();
com.mpobjects.oms.ratecalc.model.service.CalculationServiceImpl@6d442f24

				myService.recalculate(myOrder, RateType.RATE_TYPE_SERVICE_ORDER_COST, anEventContext);
/s
CalculationServiceImpl.recalculate(LogisticsOrderVO, String, TMSEventContext) line: 348	

			RateAgreementVO mySelectedRateAgreement = getFirstMatchingRateAgreement(anOrder, aRateType);
/s
CalculationServiceImpl.getFirstMatchingRateAgreement(LogisticsOrderVO, String) line: 546	

			if (aLogisticsOrder.isPersistent()) {
				if (aLogisticsOrder instanceof ServiceOrderVO) {
					// In case of a service order, the executed by party is often determining the rate agreement
					myKey = "SO-" + aLogisticsOrder.getSystemId() + "-" + EntityUtil.getSystemId(((ServiceOrderVO) aLogisticsOrder).getExecutedByPartyVO());
SO-26756976-26631668
(ServiceOrderVO) aLogisticsOrder).getExecutedByPartyVO()=
SystemId:26631668-Party:REENEN-PartyType:com.mpobjects.oms.model.entity.partytype.PartyType@4dde8a56[SERVICE_PROVIDER,SERVICE_PROVIDER]
/ Deze zien we in de GUI als Carrier op de seo	,

/ Intermezzo

/ mpo_2014_01_v2=# select*from party where party_id like '%REENEN%';
-----
  26631668 |          0 | REENEN   |            26631667 |                  4000 | Van Reenen |       | Energieweg 31 | Industrieterrein Harselaar-Oost | Barneve
ld | 3771 NA |             4153 | Planning     | orders@reenen.nl |           | 0342 - 405 405 |              |          |            |            |            |
            |            |                              |                 |           |           |          |                   |                0 | 
(1 row)

/ Einde Intermezzo

			for (RateAgreementVO myRateAgreementVO : getRateAgreementList(aRateType)) {
aRateType	"service_order_cost" (id=16454)	
/s
	private Collection<RateAgreementVO> getRateAgreementList(String aRateType) throws AbstractException {
		return rateAgreementDao.getByType(aRateType);

/ Intermezzo

/ SUBCLIPSE ERROR
http://subclipse.tigris.org/wiki/JavaHL#head-bb1dd50f9ec2f0d8c32246430c00e237d27a04fe

/ Einde Intermezzo

/ Intermezzo

$ vi RateAgreementVO.java

	<class name="com.mpobjects.oms.ratecalc.model.rateagreement.vo.RateAgreementVO" lazy="false" table="RATE_AGREEMENT">

/ we zien	,
DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-3:) 
select ... 
from RATE_AGREEMENT this_ 
left outer join UNIT unit2_ on this_.UNIT_SYSTEMID=unit2_.SYSTEM_ID 
where this_.organization_Systemid in (
	select uo.organization_systemid 
	from user_organization uo 
	where uo.user_systemid = ?) 
and this_.RATE_TYPE=? 
and this_.IS_TEMPLATE=? 
and this_.IS_QUOTATION=? 
and this_.IS_DELETED=?
2015-03-19 13:22:37,024 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [1] as [INTEGER] - 26877200
2015-03-19 13:22:37,026 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [2] as [VARCHAR] - service_order_cost
2015-03-19 13:22:37,027 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [3] as [BIT] - false
2015-03-19 13:22:37,028 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [4] as [BIT] - false
2015-03-19 13:22:37,030 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-3:) binding parameter [5] as [BIT] - false

/we doen zelf	,
mpo_2014_01_v2=# select*from rate_agreement where rate_type='service_order_cost';
 system_id |                       name                       |                      description                       | organization_syste
mid | unit_systemid | is_deleted |     rate_type      | is_quotation | is_template 
-----------+--------------------------------------------------+--------------------------------------------------------+-------------------
----+---------------+------------+--------------------+--------------+-------------
  26634797 | X                                                |                                                        |                  4
000 |       1000072 |          1 | service_order_cost |            0 |           0
  26633343 | KOOPS                                            |                                                        |                  4
000 |       1000072 |          1 | service_order_cost |            0 |           0
  26850818 | Angelos Logistics preferential cost agreement    | Angelo Logistics cost RA for preferential customer     |                   
 11 |      26677443 |          0 | service_order_cost |            0 |           0
  26633242 | BISCHOFF                                         |                                                        |                  4
000 |       1000072 |          0 | service_order_cost |            0 |           0
  26635063 | TWENTEPOORT                                      |                                                        |                  4
000 |       1000072 |          0 | service_order_cost |            0 |           0
  26851868 | Angelo Logistics non preferential cost agreement | Angelo Logistics cost RA for non preferential customer |                   
 11 |      26677443 |          0 | service_order_cost |            0 |           0
  26634922 | NORD_CARGO                                       |                                                        |                  4
000 |       1000072 |          0 | service_order_cost |            0 |           0
  26631869 | OEGEMA                                           |                                                        |                  4
000 |       1000072 |          0 | service_order_cost |            0 |           0
  26634800 | BENTUM                                           |                                                        |                  4
000 |       1000072 |          0 | service_order_cost |            0 |           0
  26631689 | REENEN                                           |                                                        |                  4
000 |       1000072 |          0 | service_order_cost |            0 |           0
(10 rows)

/ Einde Intermezzo

			for (RateAgreementVO myRateAgreementVO : getRateAgreementList(aRateType)) {
				if (myEducatedGuess == null || !myEducatedGuess.equals(myRateAgreementVO)) {
					if (myRateAgreementVO.matches(myContext)) {
/ JA
/ voor 
theSystemId: 26631689Name :REENEN
Description :null
Organization :SystemId:4000	Id:HAAL-ZW	Description:HAAL
Unit :theSystemId: 1000072	Symbol :EUR	Description :Euro	UnitType :CURRENCY	IsDeleted :0	
IsDeleted :false
RateType :service_order_cost

/ Intermezzo

	private RateAgreementVO getFirstMatchingRateAgreement(LogisticsOrderVO aLogisticsOrder, String aRateType) {
			for (RateAgreementVO myRateAgreementVO : getRateAgreementList(aRateType)) {
theSystemId: 26633242Name :BISCHOFF
/ See	,
mpo_2014_01_v2=# select*from rate_agreement where rate_type='service_order_cost';

					if (myRateAgreementVO.matches(myContext)) {
/s
RateAgreementVO.matches(JXPathContext) line: 333	
		Collection<RAgreementSelCriterion> myRagreementSelCriteriumList = getRateAgreementSelCriterionList();

myRagreementSelCriteriumList	PersistentBag  (id=13525)	
	bag	ArrayList  (id=13534)	
		elementData	Object[10]  (id=13548)	
			[0]	RAgreementSelCriterion  (id=13526)	
			[1]	RAgreementSelCriterion  (id=13550)	
			[2]	RAgreementSelCriterion  (id=13553)	
/ In meer detail	,

theSystemId: 26633244
RateAgreementSystemid: 26633242
Unit: null
ValueFrom: HAAL-ZW
ValueTo: null
MatchType: SystemId [3800001], Name [REGEX]
OrderDetail: SystemId: 554184, Name :ORGANIZATION_ID, PathOrClass :./organizationVO/code

theSystemId: 26658860
RateAgreementSystemid: 26633242
Unit: null
ValueFrom: !SPOTBUY
ValueTo: null
MatchType: SystemId [3800001], Name [REGEX]
OrderDetail: SystemId: 42000604, Name :SHIPMENT_TYPE, PathOrClass :./consignmentList[1]/serviceActionList[1]/shipmentOrderVO/shipmentTypeVO/code

theSystemId: 26633243
RateAgreementSystemid: 26633242
Unit: null
ValueFrom: BISCHOFF
ValueTo: null
MatchType: SystemId [3800001], Name [REGEX]
OrderDetail: SystemId: 4200001, Name :CARRIER, PathOrClass :./executedByPartyVO/partyId

/ we zien de order details, met xpath expr	,

		for (RAgreementSelCriterion myRagreementSelCriteriumVO : myRagreementSelCriteriumList) {
			if (!myRagreementSelCriteriumVO.matches(aContext)) {
/s
RAgreementSelCriterion.matches(JXPathContext) line: 133	
/ this=1ste crit	,
		Object myValue = getMatchValue(aJXPathContext);
/s
RAgreementSelCriterion.getMatchValue(JXPathContext) line: 223	
		OrderDetail myOrderDetail = getOrderDetail();
/ in this=crit zit de order detail	,
		Object myValue = myOrderDetail.retrieveValueFromOrder(aJXPathContext);
/s
OrderDetail.retrieveValueFromOrder(JXPathContext) line: 128	
/ this=order detail	, SystemId: 554184, Name :ORGANIZATION_ID, PathOrClass :./organizationVO/code
		String myPathOrClass = getPathOrClass();
./organizationVO/code
		Object myValue = aContext.getValue(myPathOrClass);
HAAL-ZW
/ we doen met de hand	,  seo.organizationVO.code="HAAL-ZW"
/ hij calls ServiceOrderVO.getOrganization() en Organization.getCode()	,

/t
RAgreementSelCriterion.matches(JXPathContext) line: 137	
		Object myValue = getMatchValue(aJXPathContext);
HAAL-ZW
/ Deze komt uit de seo	, want de seo zit in de aJXPATHContext	,

			return matchValue(myValue);
/s
RAgreementSelCriterion.matchValue(Object) line: 155	
		Matcher myMatcher = getMatchTypeName().getMatcher(this);
myMatcher	RegexMatcher  (id=13203)	

/ Intermezzo
/ want	,
this	RAgreementSelCriterion  (id=13175)	
	theMatchType	MatchTypeVO  (id=13185)	
		matchTypeName	MatchTypeName$5  (id=13187)	

public class MatchTypeVO extends ValueObject {
	private MatchTypeName matchTypeName;
/ en	,
public enum MatchTypeName {
	REGEX {
		@Override
		public Matcher getMatcher(MatchCriterium aMatchCriterium) {
			return new RegexMatcher(aMatchCriterium.getValueFrom());
		}
	},
/ Einde Intermezzo

		boolean myResult = myMatcher.match(aValue);
true

/t
RateAgreementVO.matches(JXPathContext) line: 333	
/ seo is de JXPathContext arg	,
		for (RAgreementSelCriterion myRagreementSelCriteriumVO : myRagreementSelCriteriumList) {
			if (!myRagreementSelCriteriumVO.matches(aContext)) {
/ NEE
/ want de seo matches deze crit	,

/ volgende	,
		for (RAgreementSelCriterion myRagreementSelCriteriumVO : myRagreementSelCriteriumList) {
			if (!myRagreementSelCriteriumVO.matches(aContext)) {
/crit=
theSystemId: 26658860
RateAgreementSystemid: 26633242
Unit: null
ValueFrom: !SPOTBUY
ValueTo: null
MatchType: SystemId [3800001], Name [REGEX]
OrderDetail: SystemId: 42000604, Name :SHIPMENT_TYPE, PathOrClass :./consignmentList[1]/serviceActionList[1]/shipmentOrderVO/shipmentTypeVO/code
/ [1]: WH de 1ste (index 0)	, 

/s
RAgreementSelCriterion.matches(JXPathContext) line: 134	
		Object myValue = getMatchValue(aJXPathContext);
"NORMAL"
/ ShipmentType heeft getCode()	, is een String	,

/ Deze macthes ook Want NORMAL is !SPOTBUY	,

/ volgende,	
		for (RAgreementSelCriterion myRagreementSelCriteriumVO : myRagreementSelCriteriumList) {
			if (!myRagreementSelCriteriumVO.matches(aContext)) {
RAgreementSelCriterion.matches(JXPathContext) line: 133	

/ this=crit=
theSystemId: 26633243
RateAgreementSystemid: 26633242
Unit: null
ValueFrom: BISCHOFF
ValueTo: null
MatchType: SystemId [3800001], Name [REGEX]
OrderDetail: SystemId: 4200001, Name :CARRIER, PathOrClass :./executedByPartyVO/partyId

		Object myValue = getMatchValue(aJXPathContext);
/ uit de seo	,
myValue	"REENEN" (id=15125)	

			return matchValue(myValue);
/ value in crit == uit de seo?
/s
RAgreementSelCriterion.matchValue(Object) line: 155	
		Matcher myMatcher = getMatchTypeName().getMatcher(this);
myMatcher	RegexMatcher  (id=15130)	
		boolean myResult = myMatcher.match(aValue);
false
/ want in crit staat BISHOFF

/t
RateAgreementVO.matches(JXPathContext) line: 334	
		for (RAgreementSelCriterion myRagreementSelCriteriumVO : myRagreementSelCriteriumList) {
			if (!myRagreementSelCriteriumVO.matches(aContext)) {
/ JA
				return false;

/t
CalculationServiceImpl.getFirstMatchingRateAgreement(LogisticsOrderVO, String) line: 561	
			for (RateAgreementVO myRateAgreementVO : getRateAgreementList(aRateType)) {
					if (myRateAgreementVO.matches(myContext)) {
/ NEE
/ Volgende	,

/ op een gegeven moment	,
			if (myEducatedGuess == null || !myEducatedGuess.equals(myRateAgreementVO)) {
					if (myRateAgreementVO.matches(myContext)) {
/ JA
							matching_cache.addObject(myKey, myRateAgreementVO.getSystemId());
						return myRateAgreementVO;
/t
CalculationServiceImpl.recalculate(LogisticsOrderVO, String, TMSEventContext) line: 351	
			RateAgreementVO mySelectedRateAgreement = getFirstMatchingRateAgreement(anOrder, aRateType);
/d

/ Hieronder bij (*) verder	,

/ Einde Intermezzo

/ Intermezzo

/ 13	. 

/ In de GUI,

configuration, finacne, service management	, service agreements(admin)
/ Hier zien we rate agreements	,
/ edit er een	, REENEN, 
/ we zien Selection criteria tab	, 
/ we zien Order details, deze worden used voor matching	,

configuration, finance, service management	, order details	,
/ kies entity type: service_order_cost	, we zien alle order details op een service order cost calc	,
/ edit=open een order detail op een seo, we zien een xpath expr	,

/ 13	. 

/ in de code	,
	private RateAgreementVO getFirstMatchingRateAgreement(LogisticsOrderVO aLogisticsOrder, String aRateType) {
		JXPathContext myContext = JXPathContext.newContext(aLogisticsOrder);
		try {
			for (RateAgreementVO myRateAgreementVO : getRateAgreementList(aRateType)) {
				if (myEducatedGuess == null || !myEducatedGuess.equals(myRateAgreementVO)) {
					if (myRateAgreementVO.matches(myContext)) {

/ myContext.contextBean=seo, 
/ de xpath expr zijn in de order details, die in de rate agreement zitten	, myContext doet de matching	,
myContext	JXPathContextReferenceImpl  (id=16529)	
/ Dus in 	,
					if (myRateAgreementVO.matches(myContext)) {
/ staat: er zijn 3 sel criteria: = orderdetail(xpath)+regex+value , en die moet kloppen	,
/ dus	,
ServiceOrderVO.getOrganizationVO().getCode()=="HAAL-ZW"  
((ServiceOrderVO)aLogisticOrder).getConsignmentList()[1].getServiceActionList().get(1)getShipmentOrderVO().getShipmentTypeVO().getCode()!="SPOTBUY"
ServiceOrderVO.getExecutedByPartyVO().getPtyId()=="REENEN"

/ 13	. 

/ maar de xpath expressie zit in de rate agreement	, 
/ In eclipse debugger	,
myRateAgreementVO	RateAgreementVO  (id=16646)	
	rateAgreementSelCriterionList	PersistentBag  (id=16690)	
		bag	ArrayList  (id=16774)	
			elementData	Object[10]  (id=16833)	
				[0]	RAgreementSelCriterion  (id=16778)	
				[1]	RAgreementSelCriterion  (id=16779)	
				[2]	RAgreementSelCriterion  (id=16780)	
/////////////
[theSystemId: 26631816
RateAgreementSystemid: 26631689
Unit: null
ValueFrom: HAAL-ZW
ValueTo: null
MatchType: SystemId [3800001], Name [REGEX]
OrderDetail: SystemId: 554184, Name :ORGANIZATION_ID, PathOrClass :./organizationVO/code

, theSystemId: 26659044
RateAgreementSystemid: 26631689
Unit: null
ValueFrom: !SPOTBUY
ValueTo: null
MatchType: SystemId [3800001], Name [REGEX]
OrderDetail: SystemId: 42000604, Name :SHIPMENT_TYPE, PathOrClass :./consignmentList[1]/serviceActionList[1]/shipmentOrderVO/shipmentTypeVO/code

, theSystemId: 26631690
RateAgreementSystemid: 26631689
Unit: null
ValueFrom: REENEN
ValueTo: null
MatchType: SystemId [3800001], Name [REGEX]
OrderDetail: SystemId: 4200001, Name :CARRIER, PathOrClass :./executedByPartyVO/partyId
]
////////////////////

$ vi RAgreementSelectionCritertion.java

 <class name="RAgreementSelCriterion" table="RAGREEMENT_SEL_CRITERIUM">

mpo_2014_01_v2=# select*from ragreement_sel_criterium where system_id in (26631816,26659044,26631690);
 system_id | rate_agreement_systemid | unit_systemid | value_from | value_to | match_type_systemid | order_detail_systemid | is_date 
-----------+-------------------------+---------------+------------+----------+---------------------+-----------------------+---------
  26631816 |                26631689 |               | HAAL-ZW    |          |             3800001 |                554184 |       0
  26659044 |                26631689 |               | !SPOTBUY   |          |             3800001 |              42000604 |       0
  26631690 |                26631689 |               | REENEN     |          |             3800001 |               4200001 |       0
(3 rows)

mpo_2014_01_v2=# select*from order_detail where system_id in (554184,42000604,4200001) ;
 system_id |                                 path_or_class                                 |      name       | unit_systemid | parameter_ty
pe_systemid |     rate_type      
-----------+-------------------------------------------------------------------------------+-----------------+---------------+-------------
------------+--------------------
    554184 | ./organizationVO/code                                                         | ORGANIZATION_ID |               |             
    3700001 | service_order_cost
  42000604 | ./consignmentList[1]/serviceActionList[1]/shipmentOrderVO/shipmentTypeVO/code | SHIPMENT_TYPE   |               |             
    3700001 | service_order_cost
   4200001 | ./executedByPartyVO/partyId                                                   | CARRIER         |               |             
    3700001 | service_order_cost
(3 rows)
/ Deze zien we in de Rate agreement, tab Selection criteria	,

mpo_2014_01_v2=# select*from match_type where system_id in (3800001);
 system_id | name  
-----------+-------
   3800001 | REGEX
(1 row)

/ Einde Intermezzo

/ we zijn in 	,
CalculationServiceImpl.getFirstMatchingRateAgreement(LogisticsOrderVO, String) line: 562	
			for (RateAgreementVO myRateAgreementVO : getRateAgreementList(aRateType)) {
				if (myEducatedGuess == null || !myEducatedGuess.equals(myRateAgreementVO)) {
					if (myRateAgreementVO.matches(myContext)) {
/ JA
/ we hebben een ra die matches de seo	,
						if (aLogisticsOrder.isPersistent() && !RateAgreementVO.TYPE_SHIPMENT_ORDER_DATE.equals(aRateType)) {
							matching_cache.addObject(myKey, myRateAgreementVO.getSystemId());
						return myRateAgreementVO;
/t
CalculationServiceImpl.recalculate(LogisticsOrderVO, String, TMSEventContext) line: 351	
		try {
			RateAgreementVO mySelectedRateAgreement = getFirstMatchingRateAgreement(anOrder, aRateType);
/d
theSystemId: 26631689Name :REENEN
Description :null
Organization :SystemId:4000	Id:HAAL-ZW	Description:HAAL
Unit :theSystemId: 1000072	Symbol :EUR	Description :Euro	UnitType :CURRENCY	IsDeleted :0	
IsDeleted :false
RateType :service_order_cost

			// Now calculate the rates
			RateCalculationVO myRateCalculationVO = new RateCalculationVO();
			if (anOrder instanceof ServiceOrderVO) {
				myRateCalculationVO.setServiceOrder((ServiceOrderVO) anOrder);

			if (mySelectedRateAgreement != null) {
				myRateCalculationVO.setRateAgreementVO(mySelectedRateAgreement);

					if (!myRateCalculationVO.rateCalculationRequired()) {
/ NEE
					} else {
/ JA
						anEventContext.removeFlag(TMSEventContext.FLAG_MAY_RATE_CALC);
				// Now calculate the rates
				myRateCalculationVO.runFor(mySelectedRateAgreement);
/s
RateCalculationVO.runFor(RateAgreementVO) line: 711	
			Set<Variable> myList = aRateAgreementVO.getVariableList();
[]
			if (myList.size() == 0) {
				RateCalculationAlternative myAlterNative = new RateCalculationAlternative(this);
				alternativeList.add(myAlterNative);
				runFor(aRateAgreementVO, myAlterNative);
/s
RateCalculationVO.runFor(RateAgreementVO, RateCalculationAlternative) line: 1276	

//////////////
/ TODO
			Collection<CostComponentSpecificationVO> myCostComponentSpecificationList = aRateAgreementVO.getCostComponentSpecificationList();
[1]	HashMap$Entry  (id=16742)	
CostComponentSpecification:26631808/RC_START_AFTER/Planned start after=java.lang.Object@6835ae96
[3]	HashMap$Entry  (id=16743)	
CostComponentSpecification:26631822/RC_ADDITIONAL_ADDRESS/Additional Stop costs=java.lang.Object@6835ae96
[6]	HashMap$Entry  (id=16744)	
CostComponentSpecification:26635971/RC_SERVICE/Service=java.lang.Object@6835ae96
[12]	HashMap$Entry  (id=16746)	
CostComponentSpecification:26631730/RC_FREIGHT/Freight costs=java.lang.Object@6835ae96

/ Intermezzo

$ vi CostComponentSpecification.standard.hbm.xml
	<class name="com.mpobjects.oms.ratecalc.model.costcomponentspecification.vo.CostComponentSpecificationVO" table="COST_COMPONENT_SPECIFICATION">

mpo_2014_01_v2=# select*from cost_component_specification where rate_agreement_systemid=26631689;
 system_id |         name          |      description      | parameter_systemid | correction_type_systemid | order_rate_part_systemid | seq
uence_nr | rate_agreement_systemid | rate_plus_mode 
-----------+-----------------------+-----------------------+--------------------+--------------------------+--------------------------+----
---------+-------------------------+----------------
  26635971 | RC_SERVICE            | Service               |           26635970 |                 38500004 |                 26631782 |    
       0 |                26631689 | NONE
  26631759 | RC_FUEL               | Fuel costs            |           26631739 |                 38500001 |                 26631760 |    
       0 |                26631689 | NONE
  26631781 | RC_RELEASE_DATE       | Release Date          |           26658872 |                 38500007 |                 26631782 |    
       0 |                26631689 | NONE
  26631730 | RC_FREIGHT            | Freight costs         |           26631729 |                 38500001 |                 26600544 |    
       0 |                26631689 | NONE
  26631822 | RC_ADDITIONAL_ADDRESS | Additional Stop costs |           26673290 |                 38500001 |                 26631763 |    
       0 |                26631689 | NONE
  26631771 | RC_MAUT               | Maut costs            |           26690486 |                 38500001 |                 26631761 |    
       0 |                26631689 | NONE
  26631808 | RC_START_AFTER        | Planned start after   |           26631807 |                 38500005 |                 26631782 |    
       0 |                26631689 | NONE
(7 rows)

/ we zien deze list op de Rate Agreement page, tab Rate Components	,

/ Einde Intermezzo

/t
	public void runFor(RateAgreementVO aRateAgreementVO) {
			Set<Variable> myList = aRateAgreementVO.getVariableList();
[]
			if (myList.size() == 0) {
				runFor(aRateAgreementVO, myAlterNative);
/d
/ Wat gedaan?
/ TODO

		if (isTest()) {
/ NEE
			} else {
/ JA
				try {
					if (serviceOrder != null || shipmentOrder != null) {
						RateCalculationAlternative firstAlt = alternativeList.iterator().next();
						if (getRateAgreementVO().getRateType().equals(RateAgreementVO.TYPE_SERVICE_ORDER_COST)) {
/ JA
							// Update the service order cost records
							updateServiceOrderCostPartList(firstAlt);
/s
RateCalculationVO.updateServiceOrderCostPartList(RateCalculationAlternative) line: 1527	

/ MPO

/ SCS

/ 7		.

/ op een sho rechts zien we Laadlocatie, Ontvanger, Bill to. Dit zijn virtual party's	,
/ Daarnaast zien we V/A, Notify: dit zijn shipmentorderparty's	,
/ In 'Shipment order details' zien we : preferred party. Dit is een party	,

/ 7	. 

/ (*)

/ we waren in 	,
CalculationServiceImpl.recalculate(LogisticsOrderVO, String, TMSEventContext) line: 353	
			RateAgreementVO mySelectedRateAgreement = getFirstMatchingRateAgreement(anOrder, aRateType);
/d
REENEN

			// Now calculate the rates
			RateCalculationVO myRateCalculationVO = new RateCalculationVO();
			if (anOrder instanceof ServiceOrderVO) {
				myRateCalculationVO.setServiceOrder((ServiceOrderVO) anOrder);

			if (mySelectedRateAgreement != null) {
				myRateCalculationVO.setRateAgreementVO(mySelectedRateAgreement);

					if (!myRateCalculationVO.rateCalculationRequired()) {
/s
RateCalculationVO.rateCalculationRequired() line: 682	
		if (shipmentOrder != null
/ NEE
		if (serviceOrder != null && !StringUtils.isEmpty(serviceOrder.getRatecalcMd5Hash())) {
			String myHash = RateCalcHashCalculator.calculate(rateAgreement, getOrder());
/ getOrder()= N0001873/26756976	, de seo	, want	,
/s
RateCalculationVO.getOrder() line: 531	
		if (getRateAgreementVO() != null) {
			if (isServiceOrderCostRate()) {
				return serviceOrder;
/ JA	, want	,
/s
RateCalculationVO.isServiceOrderCostRate() line: 2552	
			return getRateAgreementVO().getRateType().equals(RateAgreementVO.TYPE_SERVICE_ORDER_COST);
/ JA	, want	,
/ getRateAgreementVO().getRateType()="service_order_cost"	,

/t
RateCalcHashCalculator.calculate(RateAgreementVO, LogisticsOrderVO) line: 31	
			Hibernate.initialize(anOrder.getEntityDetails());
{}
			Collection<Object> myValues = aRateAgreement.getOrderDetailValues(anOrder);
/s
RateAgreementVO.getOrderDetailValues(Object) line: 168	

		JXPathContext myContext = JXPathContext.newContext(anOrderVO);
/ seo

		Collection<RateParameterVO> myRateParameterList = getRateParameterList();

/ Dit zijn alle rate params bij rate agreement REENEN	,

/ Intermezzo

/ Later	,

$ vi RateCalculationVO.java

	public AbstractRateFunction getRateFunction(RateParameterVO aRateParameterVO) throws RateException {
		String myKey = aRateParameterVO.getName();
		AbstractRateFunction myFunction = rateFunctionCache.get(myKey);
		if (myFunction == null) {
			RateFunctionVO myOutputfromFunction = aRateParameterVO.getOutputfromFunctionVO();
			FunctionDefinitionVO myFunctionDefinition = myOutputfromFunction.getFunctionDefinitionVO();
			String myClassName = myFunctionDefinition.getDefinition();
			try {
				Class<?> myClass = Class.forName(myClassName);
				myFunction = (AbstractRateFunction) myClass.newInstance();
	->			myFunction.setRateFunctionVO(myOutputfromFunction);
				myFunction.setRateContext(this);
			} catch (Exception anException) {
				throw new RateException("Could not instantatie function for class [" + myClassName + "]", anException);
			}
			rateFunctionCache.put(myKey, myFunction);
		}
		return myFunction;
	}

/ Er zijn ook	,
RateParameterVO.java
RateFunctionVO.java
RateFunctionVO.standard.hbm.xml
RateParameterVO.standard.hbm.xml


/ Einde Intermezzo

/ Intermezzo

		Collection<RateParameterVO> myRateParameterList = getRateParameterList();

[theSystemId: 26690486Name :RP_MAUT
Description :null
, theSystemId: 26631724Name :RT-FREIGHT-DE-HAAL_OUTPUT
Description :null
, theSystemId: 26673277Name :RT-FUEL_OUTPUT
Description :null
, theSystemId: 26631849Name :ZONE-TO_OUTPUT
Description :null
, theSystemId: 26659453Name :IF_DE_OUTPUT
Description :null
, theSystemId: 26631774Name :RP_RELEASE_DATE
Description :null
, theSystemId: 26659466Name :RP_START_DATE_IT
Description :null
, theSystemId: 26659433Name :LT_COUNTRIES_OUTPUT
Description :null
, theSystemId: 26659483Name :RP_IF_IT
Description :null
, theSystemId: 26752979Name :RP_ADDITIONAL_STOP
Description :null
, theSystemId: 26633134Name :RT-FREIGHT-NL-FR_OUTPUT
Description :null
, theSystemId: 26659446Name :LT_RELEASE_CARRIER-TIME_OUTPUT
Description :null
, theSystemId: 26673290Name :RP_ADD_ADDRESS
Description :null
, theSystemId: 26631807Name :RP_START_DATE
Description :null
, theSystemId: 26659407Name :LT_TRANSPORT-FR_OUTPUT
Description :null
, theSystemId: 26635970Name :SERVICE
Description :null
, theSystemId: 26659491Name :IF_IT_OUTPUT
Description :null
, theSystemId: 26673284Name :RP_ADDRESS_FUEL
Description :null
, theSystemId: 26659457Name :RP_START_DATE_DE
Description :null
, theSystemId: 26631770Name :RT-MAUT FROM DE96_OUTPUT
Description :null
, theSystemId: 26631729Name :RP_FREIGHT
Description :null
, theSystemId: 26633063Name :RT-FREIGHT-DE-BE_OUTPUT
Description :null
, theSystemId: 26633094Name :RT-FREIGHT-IT-NLBE_OUTPUT
Description :null
, theSystemId: 26659412Name :RP_LEADTIME
Description :null
, theSystemId: 26752973Name :RT_ADDITIONAL_LOADING_ADDRESS_OUTPUT
Description :null
, theSystemId: 26694008Name :RT-FREIGHT-DE27-FR61_OUTPUT
Description :null
, theSystemId: 26659470Name :RP_IF_START
Description :null
, theSystemId: 26631778Name :RP_MAX_RELEASE_LT
Description :null
, theSystemId: 26658872Name :RP_RELEASE_DATE_TIME
Description :null
, theSystemId: 26631697Name :LT_RELEASE_CARRIER_OUTPUT
Description :null
, theSystemId: 26631739Name :RP_FUEL
Description :null
, theSystemId: 26693996Name :RT-MAUT FROM IT_OUTPUT
Description :null
, theSystemId: 26633046Name :RT-FREIGHT-DE-NL_OUTPUT
Description :null
, theSystemId: 26631821Name :RT_ADDITIONAL_DELIVERY_ADDRESS_OUTPUT
Description :null
, theSystemId: 26690482Name :RT-MAUT FROM DE_OUTPUT
Description :null
, theSystemId: 26631704Name :LT_RELEASE_SUPPLIER_OUTPUT
Description :null
, theSystemId: 26631757Name :ZONE_FROM_OUTPUT
Description :null
]

/ Dit zijn er 37	,

mpo_2014_01_v2=# select count(*)from rate_parameter rp join rate_agreement ra on rp.rate_agreement_systemid=ra.system_id where ra.name='REENEN';
 count 
-------
    37
(1 row)

/ Einde Intermezzo

/ volgende	, (eerste)	,

		for (RateParameterVO myParameter : myRateParameterList) {
theSystemId: 26631704Name :LT_RELEASE_SUPPLIER_OUTPUT

			if (myParameter.getOutputfromFunctionVO() != null) {
				myInputParameterList = myParameter.getOutputfromFunctionVO().getInputParameterList();
[SystemId: 26631701]

/ Intermezzo

/ we bouwen langzaam op	,

mpo_2014_01_v2=#   select rf.*from rate_function rf join rate_parameter rp on rf.system_id=rp.outputfrom_function_systemid where rp.name='LT_RELEASE_SUPPLIER_OUTPUT';
 system_id | function_definition_systemid | is_user_defined | user_func_def | rate_table_systemid | unit_systemid 
-----------+------------------------------+-----------------+---------------+---------------------+---------------
  26631703 |                      3500001 |               0 |               |            26631698 |              
(1 row)

mpo_2014_01_v2=# select ip.*from input_parameter ip join rate_function rf on ip.rate_func_systemid=rf.system_id join rate_parameter rp on rf.system_id=rp.outputfrom_function_systemid where rp.name='LT_RELEASE_SUPPLIER_OUTPUT';
 system_id | parameter_systemid | func_par_def_systemid | rate_func_systemid | dimension_systemid | configuration_value | order_detail_systemid | free_value 
-----------+--------------------+-----------------------+--------------------+--------------------+---------------------+-----------------------+------------
  26631701 |                    |                       |           26631703 |                    |                     |               4200010 |           
(1 row)

mpo_2014_01_v2=# select od.* from order_detail od join input_parameter ip on od.system_id=ip.order_detail_systemid join rate_function rf on ip.rate_func_systemid=rf.system_id join rate_parameter rp on rf.system_id=rp.outputfrom_function_systemid where rp.name='LT_RELEASE_SUPPLIER_OUTPUT';
 system_id |     path_or_class     |     name      | unit_systemid | parameter_type_systemid |     rate_type      
-----------+-----------------------+---------------+---------------+-------------------------+--------------------
   4200010 | ./fromPartyVO/partyId | FROM PARTY ID |               |                 3700001 | service_order_cost
(1 row)

/ Einde Intermezzo

				for (InputParameterVO element : myInputParameterList) {
SystemId: 26631701
					OrderDetail myOrderDetailVO = element.getOrderDetailVO();
SystemId: 4200010, Name :FROM PARTY ID, PathOrClass :./fromPartyVO/partyId
					if (myOrderDetailVO != null) {
						myRet.add(myOrderDetailVO.retrieveValueFromOrder(myContext));
/s
OrderDetail.retrieveValueFromOrder(JXPathContext) line: 128	
		String myPathOrClass = getPathOrClass();
./fromPartyVO/partyId
		Object myValue = aContext.getValue(myPathOrClass);
"1001"

/ Intermezzo

aContext	JXPathContextReferenceImpl  (id=16603)	
	contextBean	ServiceOrderVO_$$_javassist_62  (id=16457)	
		handler	JavassistLazyInitializer  (id=16533)	
			target	ServiceOrderVO  (id=16541)	
				executionStrategy	"FIXED" (id=16562)	
				theFromPartyVO	VirtualParty  (id=17231)	
					partyId	"1001" (id=17276)	


/ Einde Intermezzo

/t
RateAgreementVO.getOrderDetailValues(Object) line: 184	

		Collection<RateParameterVO> myRateParameterList = getRateParameterList();
/ alle bij deze rate agreement	,
		Collection<InputParameterVO> myInputParameterList;
		for (RateParameterVO myParameter : myRateParameterList) {
			if (myParameter.getOutputfromFunctionVO() != null) {
				myInputParameterList = myParameter.getOutputfromFunctionVO().getInputParameterList();
				for (InputParameterVO element : myInputParameterList) {
					OrderDetail myOrderDetailVO = element.getOrderDetailVO();
					if (myOrderDetailVO != null) {
						myRet.add(myOrderDetailVO.retrieveValueFromOrder(myContext));
/ myRet=["1001"]

/ 13	. 

/ volgende	,

      for (RateParameterVO myParameter : myRateParameterList) {
theSystemId: 26752973Name :RT_ADDITIONAL_LOADING_ADDRESS_OUTPUT

/ Intermezzo

mpo_2014_01_v2=# select ip.*from input_parameter ip join rate_function rf on ip.rate_func_systemid=rf.system_id join rate_parameter rp on rf.system_id=rp.outputfrom_function_systemid where rp.name='RT_ADDITIONAL_LOADING_ADDRESS_OUTPUT';
/=
mpo_2014_01_v2=# select ip.*from input_parameter ip join rate_function rf on ip.rate_func_systemid=rf.system_id join rate_parameter rp on rf.system_id=rp.outputfrom_function_systemid where rp.system_id=26752973;
 system_id | parameter_systemid | func_par_def_systemid | rate_func_systemid | dimension_systemid | configuration_value | order_detail_systemid | free_value 
-----------+--------------------+-----------------------+--------------------+--------------------+---------------------+-----------------------+------------
  26752971 |                    |                       |           26752972 |                    |                     |              26659025 |           
(1 row)

mpo_2014_01_v2=# select od.* from order_detail od join input_parameter ip on od.system_id=ip.order_detail_systemid join rate_function rf on ip.rate_func_systemid=rf.system_id join rate_parameter rp on rf.system_id=rp.outputfrom_function_systemid where rp.name='RT_ADDITIONAL_LOADING_ADDRESS_OUTPUT';
 system_id |    path_or_class    |       name        | unit_systemid | parameter_type_systemid |     rate_type      
-----------+---------------------+-------------------+---------------+-------------------------+--------------------
  26659025 | numberOfCollections | NR_OF_COLLECTIONS |               |                 3700002 | service_order_cost
(1 row)

/ er is ServiceOrderVO.getNumberOfCollections()	, dat is de numberOfCollections property	, er is geen field numberOfCollections	,


/ Einde Intermezzo

					if (myOrderDetailVO != null) {
						myRet.add(myOrderDetailVO.retrieveValueFromOrder(myContext));
/s
ServiceOrderVO.getNumberOfCollections() line: 2184	

/ consignmentList=[N0001873.1/26756979, N0001873.2/26806868, N0001873.3/26807360]
		for (ConsignmentVO consignment : consignmentList) {
N0001873.1/26756979
			if (consignment.getFromPartyVO() != null && StringUtils.isNotEmpty(consignment.getFromPartyVO().getPartyId())) {
com.mpobjects.oms.model.entity.VirtualParty@2528ec5c[1001,]
				partyIdSet.add(consignment.getFromPartyVO().getPartyId());
["1001"]

/ Intermezzo

/ de from party is een virtual party	, deze is NIET in de party table	, maar in de consignment zelf	,

mpo_2014_01_v2=# select*from consignment where consignment_number='N0001873.1';
 system_id | consignment_number | service_order_systemid | sequence_number | consignment_status_systemid | to_location_id |         to_name          | to_name2 |
         to_address         | to_address2 | to_city | to_postal_code | to_region_state | to_country_systemid | to_phone_number | to_fax_number | to_email_address
 | to_contact_name | from_location_id |        from_name         | from_name2 |     from_address      | from_address2 |    from_city    | from_postal_code | from
_region_state | from_country_systemid | from_phone_number | from_fax_number | from_email_address | from_contact_name | requested_start_before | requested_start_a
fter | planned_start_before | planned_start_after | org_planned_start_before | org_planned_start_after | requested_end_before | requested_end_after | planned_end
_before  |  planned_end_after  | org_planned_end_before | org_planned_end_after | actual_start |     actual_end      | reference1 | reference2 | reference3 | ref
erence4 | reference5 | pod_reference | total_ldm | total_volume | comments | close_date | is_temporary 
-----------+--------------------+------------------------+-----------------+-----------------------------+----------------+--------------------------+----------+
----------------------------+-------------+---------+----------------+-----------------+---------------------+-----------------+---------------+-----------------
-+-----------------+------------------+--------------------------+------------+-----------------------+---------------+-----------------+------------------+-----
--------------+-----------------------+-------------------+-----------------+--------------------+-------------------+------------------------+------------------
-----+----------------------+---------------------+--------------------------+-------------------------+----------------------+---------------------+------------
---------+---------------------+------------------------+-----------------------+--------------+---------------------+------------+------------+------------+----
--------+------------+---------------+-----------+--------------+----------+------------+--------------
  26756979 | N0001873.1         |               26756976 |        26756978 |                           1 | 9              | KONINKLIJKE SANDERS B.V. |          |
 Industriepark Vliedberg 12 |             | VLIJMEN | 5251  RG       |                 |                4153 |                 |               |                 
 |                 | 1001             | HEINZ PLASTICS BOHM GmbH |            | Frankenwaldstrasse 29 |               | TETTAU-LANGENAU | 96355            |     
              |                  4052 | 0049-926999040    |                 |                    |                   | 2014-10-10 22:59:00    | 2014-10-10 00:00:
00   | 2014-11-11 22:59:00  | 2014-11-11 22:59:00 |                          |                         | 2014-11-13 22:59:00  | 2014-11-13 00:00:00 | 2014-11-13 
22:59:00 | 2014-11-13 22:59:00 |                        |                       |              | 2014-11-13 17:25:00 |            |            |            |    
        |            |               |       4.8 |            0 |          |            |            0
(1 row)

/ We zien fields met from_ en to_, dus de from party en to party	,

/  We zien from_location_id='1001' 	, 	
/ en in Java zien we 	,
consignment	ConsignmentVO_$$_javassist_71  (id=16402)	
	handler	JavassistLazyInitializer  (id=17654)	
		target	ConsignmentVO  (id=17678)	
			theFromPartyVO	VirtualParty  (id=17711)	
				partyId	"1001" (id=17735)	

/ volgende	,

mpo_2014_01_v2=# select*from consignment where consignment_number='N0001873.2';
 system_id | consignment_number | service_order_systemid | sequence_number | consignment_status_systemid | to_location_id |     to_name      | to_name2 |       t
o_address        | to_address2 |  to_city  | to_postal_code | to_region_state | to_country_systemid | to_phone_number | to_fax_number | to_email_address | to_con
tact_name | from_location_id |            from_name            | from_name2 |      from_address       | from_address2 | from_city | from_postal_code | from_regio
n_state | from_country_systemid | from_phone_number | from_fax_number | from_email_address | from_contact_name | requested_start_before | requested_start_after |
 planned_start_before | planned_start_after | org_planned_start_before | org_planned_start_after | requested_end_before | requested_end_after | planned_end_befor
e  |  planned_end_after  | org_planned_end_before | org_planned_end_after | actual_start |     actual_end      | reference1 | reference2 | reference3 | reference
4 | reference5 | pod_reference | total_ldm | total_volume | comments | close_date | is_temporary 
-----------+--------------------+------------------------+-----------------+-----------------------------+----------------+------------------+----------+--------
-----------------+-------------+-----------+----------------+-----------------+---------------------+-----------------+---------------+------------------+-------
----------+------------------+---------------------------------+------------+-------------------------+---------------+-----------+------------------+-----------
--------+-----------------------+-------------------+-----------------+--------------------+-------------------+------------------------+-----------------------+
----------------------+---------------------+--------------------------+-------------------------+----------------------+---------------------+------------------
---+---------------------+------------------------+-----------------------+--------------+---------------------+------------+------------+------------+----------
--+------------+---------------+-----------+--------------+----------+------------+--------------
  26806868 | N0001873.2         |               26756976 |        26806867 |                           1 | 3              | HEGRON COSMETICS |          | Van IJs
endijkstraat 174 |             | PURMEREND | 1442 LC        |                 |                4153 | 0299-433789     |               |                  |       
          | 1045             | GERRESHEIMER MOULDED GLASS GMBH |            | Tettaugrundstrasse  1 5 |               | Tettau    | 96355            |           
        |                  4052 | 0049-926991181    |                 |                    |                   | 2014-11-05 22:59:00    | 2014-11-05 00:00:00   |
 2014-11-11 22:59:00  | 2014-11-11 22:59:00 |                          |                         | 2014-11-13 22:59:00  | 2014-11-13 00:00:00 | 2014-11-13 22:59:
00 | 2014-11-13 22:59:00 |                        |                       |              | 2014-11-13 17:25:00 |            |            |            |          
  |            |               |       7.6 |            0 |          |            |            0
(1 row)

/ volgende	,

mpo_2014_01_v2=# select*from consignment where consignment_number='N0001873.3';
 system_id | consignment_number | service_order_systemid | sequence_number | consignment_status_systemid | to_location_id |         to_name          | to_name2 |
         to_address         | to_address2 | to_city | to_postal_code | to_region_state | to_country_systemid | to_phone_number | to_fax_number | to_email_address
 | to_contact_name | from_location_id |           from_name            | from_name2 |     from_address      | from_address2 |    from_city    | from_postal_code 
| from_region_state | from_country_systemid | from_phone_number | from_fax_number | from_email_address | from_contact_name | requested_start_before | requested_s
tart_after | planned_start_before | planned_start_after | org_planned_start_before | org_planned_start_after | requested_end_before | requested_end_after | plann
ed_end_before  |  planned_end_after  | org_planned_end_before | org_planned_end_after | actual_start |     actual_end      | reference1 | reference2 | reference3
 | reference4 | reference5 | pod_reference | total_ldm | total_volume | comments | close_date | is_temporary 
-----------+--------------------+------------------------+-----------------+-----------------------------+----------------+--------------------------+----------+
----------------------------+-------------+---------+----------------+-----------------+---------------------+-----------------+---------------+-----------------
-+-----------------+------------------+--------------------------------+------------+-----------------------+---------------+-----------------+------------------
+-------------------+-----------------------+-------------------+-----------------+--------------------+-------------------+------------------------+------------
-----------+----------------------+---------------------+--------------------------+-------------------------+----------------------+---------------------+------
---------------+---------------------+------------------------+-----------------------+--------------+---------------------+------------+------------+-----------
-+------------+------------+---------------+-----------+--------------+----------+------------+--------------
  26807360 | N0001873.3         |               26756976 |        26807359 |                           1 | 9              | KONINKLIJKE SANDERS B.V. |          |
 Industriepark Vliedberg 12 |             | VLIJMEN | 5251  RG       |                 |                4153 |                 |               |                 
 |                 | 1065             | HEINZ PLASTICS BOHM GmbH ROVAL |            | Frankenwaldstrasse 29 |               | TETTAU LANGENAU | 96355            
|                   |                  4052 | 0049-926999040    |                 |                    |                   | 2014-08-20 22:59:00    | 2014-08-20 
00:00:00   | 2014-11-11 22:59:00  | 2014-11-11 22:59:00 |                          |                         | 2014-11-13 22:59:00  | 2014-11-13 00:00:00 | 2014-
11-13 22:59:00 | 2014-11-13 22:59:00 |                        |                       |              | 2014-11-13 17:25:00 |            |            |           
 |            |            |               |       0.4 |            0 |          |            |            0
(1 row)
 

/ Einde Intermezzo

/t
ServiceOrderVO.getNumberOfCollections() line: 2190	
		for (ConsignmentVO consignment : consignmentList) {
			if (consignment.getFromPartyVO() != null && StringUtils.isNotEmpty(consignment.getFromPartyVO().getPartyId())) {
				partyIdSet.add(consignment.getFromPartyVO().getPartyId());
			}
		}
		return partyIdSet.size();
3

/t
OrderDetail.retrieveValueFromOrder(JXPathContext) line: 130	
		Object myValue = aContext.getValue(myPathOrClass);
3
		return myValue;
/t
RateAgreementVO.getOrderDetailValues(Object) line: 189	
		for (RateParameterVO myParameter : myRateParameterList) {
			if (myParameter.getOutputfromFunctionVO() != null) {
				myInputParameterList = myParameter.getOutputfromFunctionVO().getInputParameterList();
				for (InputParameterVO element : myInputParameterList) {
					OrderDetail myOrderDetailVO = element.getOrderDetailVO();
					if (myOrderDetailVO != null) {
						myRet.add(myOrderDetailVO.retrieveValueFromOrder(myContext));
["1001", 3]

/ 13	. 

/ volgende	,

		for (RateParameterVO myParameter : myRateParameterList) {
theSystemId: 26631778Name :RP_MAX_RELEASE_LT

/ Intermezzo

mpo_2014_01_v2=# select ip.*from input_parameter ip join rate_function rf on ip.rate_func_systemid=rf.system_id join rate_parameter rp on rf.system_id=rp.outputfrom_function_systemid where rp.name='RP_MAX_RELEASE_LT';
/=
mpo_2014_01_v2=# select ip.*from input_parameter ip join rate_function rf on ip.rate_func_systemid=rf.system_id join rate_parameter rp on rf.system_id=rp.outputfrom_function_systemid where rp.system_id=26631778;
 system_id | parameter_systemid | func_par_def_systemid | rate_func_systemid | dimension_systemid | configuration_value | order_detail_systemid | free_value 
-----------+--------------------+-----------------------+--------------------+--------------------+---------------------+-----------------------+------------
  26658689 |           26631704 |                       |           26631775 |                    |                     |                       |           
  26658690 |           26631697 |                       |           26631775 |                    |                     |                       |           
(2 rows)

/ Einde Intermezzo

/ Geen order details	,

/ 13	. 

/ volgende	,

		for (RateParameterVO myParameter : myRateParameterList) {
theSystemId: 26631774Name :RP_RELEASE_DATE

/ Intermezzo

mpo_2014_01_v2=# select ip.*from input_parameter ip join rate_function rf on ip.rate_func_systemid=rf.system_id join rate_parameter rp on rf.system_id=rp.outputfrom_function_systemid where rp.system_id=26631774;
 system_id | parameter_systemid | func_par_def_systemid | rate_func_systemid | dimension_systemid | configuration_value | order_detail_systemid | free_value 
-----------+--------------------+-----------------------+--------------------+--------------------+---------------------+-----------------------+------------
  26659492 |           26659470 |                       |           26631772 |                    |                     |                       |           
  26659493 |           26631778 |                       |           26631772 |                    |                     |                       |           
(2 rows)

/ Ook weer geen enkele order detail	,

/ Einde Intermezzo

		for (RateParameterVO myParameter : myRateParameterList) {
			if (myParameter.getOutputfromFunctionVO() != null) {
				myInputParameterList = myParameter.getOutputfromFunctionVO().getInputParameterList();
				for (InputParameterVO element : myInputParameterList) {
					OrderDetail myOrderDetailVO = element.getOrderDetailVO();
null

/ volgende	,

		for (RateParameterVO myParameter : myRateParameterList) {
theSystemId: 26673284Name :RP_ADDRESS_FUEL

/ Intermezzo

mpo_2014_01_v2=# select ip.*from input_parameter ip join rate_function rf on ip.rate_func_systemid=rf.system_id join rate_parameter rp on rf.system_id=rp.outputfrom_function_systemid where rp.name='RP_ADDRESS_FUEL';
/=
mpo_2014_01_v2=# select ip.*from input_parameter ip join rate_function rf on ip.rate_func_systemid=rf.system_id join rate_parameter rp on rf.system_id=rp.outputfrom_function_systemid where rp.system_id=26673284;
 system_id | parameter_systemid | func_par_def_systemid | rate_func_systemid | dimension_systemid | configuration_value | order_detail_systemid | free_value 
-----------+--------------------+-----------------------+--------------------+--------------------+---------------------+-----------------------+------------
  26752980 |           26752979 |                       |           26673281 |                    |                     |                       |           
  26752981 |           26673277 |                       |           26673281 |                    |                     |                       |           

/ Einde Intermezzo

/ 13	. 

/ volgende	,

		for (RateParameterVO myParameter : myRateParameterList) {
theSystemId: 26631697Name :LT_RELEASE_CARRIER_OUTPUT

/ Intermezzo

/ we zien dat er meerdere rate parameters zijn met dezelfde name	,

mpo_2014_01_v2=# select*from rate_parameter rp where rp.name='LT_RELEASE_CARRIER_OUTPUT';
 system_id |           name            | description | outputfrom_function_systemid | rate_agreement_systemid | is_persistent | sequence_nr | parameter_type_syst
emid | is_user_editable 
-----------+---------------------------+-------------+------------------------------+-------------------------+---------------+-------------+--------------------
-----+------------------
  26631697 | LT_RELEASE_CARRIER_OUTPUT |             |                     26631696 |                26631689 |             0 |           0 |                    
     |                0
  26634869 | LT_RELEASE_CARRIER_OUTPUT |             |                     26634865 |                26634800 |             0 |           0 |                    
     |                0
  26633319 | LT_RELEASE_CARRIER_OUTPUT |             |                     26633318 |                26633242 |             0 |           0 |                    
     |                0
  26633420 | LT_RELEASE_CARRIER_OUTPUT |             |                     26633416 |                26633343 |             0 |           0 |                    
     |                0
  26634963 | LT_RELEASE_CARRIER_OUTPUT |             |                     26634959 |                26634922 |             0 |           0 |                    
     |                0
  26635096 | LT_RELEASE_CARRIER_OUTPUT |             |                     26635092 |                26635063 |             0 |           0 |                    
     |                0
(6 rows)

/ Dit is dus NIET OK	,

mpo_2014_01_v2=# select ip.*from input_parameter ip join rate_function rf on ip.rate_func_systemid=rf.system_id join rate_parameter rp on rf.system_id=rp.outputfrom_function_systemid where rp.name='LT_RELEASE_CARRIER_OUTPUT';
 system_id | parameter_systemid | func_par_def_systemid | rate_func_systemid | dimension_systemid | configuration_value | order_detail_systemid | free_value 
-----------+--------------------+-----------------------+--------------------+--------------------+---------------------+-----------------------+------------
  26631694 |                    |                       |           26631696 |                    |                     |               4200003 |           
  26631695 |                    |                       |           26631696 |                    |                     |               4200006 |           
  26633418 |                    |                       |           26633416 |                    |                     |               4200007 |           
  26633417 |                    |                       |           26633416 |                    |                     |              26631726 |           
  26633419 |                    |                       |           26633416 |                    |                     |               4200006 |           
  26633315 |                    |                       |           26633318 |                    |                     |               4200006 |           
  26633316 |                    |                       |           26633318 |                    |                     |              26631726 |           
  26633317 |                    |                       |           26633318 |                    |                     |               4200007 |           
  26634962 |                    |                       |           26634959 |                    |                     |               4200006 |           
  26634961 |                    |                       |           26634959 |                    |                     |               4200003 |           
  26634960 |                    |                       |           26634959 |                    |                     |              26631726 |           
  26634868 |                    |                       |           26634865 |                    |                     |               4200003 |           
  26634867 |                    |                       |           26634865 |                    |                     |              26631726 |           
  26634866 |                    |                       |           26634865 |                    |                     |               4200006 |           
  26635093 |                    |                       |           26635092 |                    |                     |               4200003 |           
  26635094 |                    |                       |           26635092 |                    |                     |              26631726 |           
  26635095 |                    |                       |           26635092 |                    |                     |               4200006 |           
(17 rows)

/ we moeten op id zoeken	,

mpo_2014_01_v2=# select ip.*from input_parameter ip join rate_function rf on ip.rate_func_systemid=rf.system_id join rate_parameter rp on rf.system_id=rp.outputfrom_function_systemid where rp.system_id=26631697;
 system_id | parameter_systemid | func_par_def_systemid | rate_func_systemid | dimension_systemid | configuration_value | order_detail_systemid | free_value 
-----------+--------------------+-----------------------+--------------------+--------------------+---------------------+-----------------------+------------
  26631694 |                    |                       |           26631696 |                    |                     |               4200003 |           
  26631695 |                    |                       |           26631696 |                    |                     |               4200006 |           
(2 rows)

mpo_2014_01_v2=# select od.* from order_detail od join input_parameter ip on od.system_id=ip.order_detail_systemid join rate_function rf on ip.rate_func_systemid=rf.system_id join rate_parameter rp on rf.system_id=rp.outputfrom_function_systemid where rp.system_id=26631697;
 system_id |        path_or_class         |     name     | unit_systemid | parameter_type_systemid |     rate_type      
-----------+------------------------------+--------------+---------------+-------------------------+--------------------
   4200003 | ./fromPartyVO/countryVO/code | FROM COUNTRY |               |                 3700001 | service_order_cost
   4200006 | ./toPartyVO/countryVO/code   | TO COUNTRY   |               |                 3700001 | service_order_cost
(2 rows)


/ Einde Intermezzo


		for (RateParameterVO myParameter : myRateParameterList) {
theSystemId: 26631697Name :LT_RELEASE_CARRIER_OUTPUT

			if (myParameter.getOutputfromFunctionVO() != null) {
				myInputParameterList = myParameter.getOutputfromFunctionVO().getInputParameterList();
				for (InputParameterVO element : myInputParameterList) {
					OrderDetail myOrderDetailVO = element.getOrderDetailVO();
					if (myOrderDetailVO != null) {
						myRet.add(myOrderDetailVO.retrieveValueFromOrder(myContext));
[1001, 3, NL, DE]

/ 13	. 

/ volgende	,

		for (RateParameterVO myParameter : myRateParameterList) {
theSystemId: 26659483Name :RP_IF_IT


mpo_2014_01_v2=# select ip.*from input_parameter ip join rate_function rf on ip.rate_func_systemid=rf.system_id join rate_parameter rp on rf.system_id=rp.outputfrom_function_systemid where rp.system_id=26659483;
 system_id | parameter_systemid | func_par_def_systemid | rate_func_systemid | dimension_systemid | configuration_value | order_detail_systemid | free_value 
-----------+--------------------+-----------------------+--------------------+--------------------+---------------------+-----------------------+------------
  26659485 |           26659466 |                     2 |           26659482 |                    |                     |                       |           
  26659486 |           26631807 |                     1 |           26659482 |                    |                     |                       |           
  26659484 |           26659491 |                     3 |           26659482 |                    |                     |                       |           
(3 rows)

/ 13	. 

/ volgende	,

		for (RateParameterVO myParameter : myRateParameterList) {
theSystemId: 26631807Name :RP_START_DATE

mpo_2014_01_v2=# select ip.*from input_parameter ip join rate_function rf on ip.rate_func_systemid=rf.system_id join rate_parameter rp on rf.system_id=rp.outputfrom_function_systemid where rp.system_id=26631807;
 system_id | parameter_systemid | func_par_def_systemid | rate_func_systemid | dimension_systemid | configuration_value | order_detail_systemid | free_value 
-----------+--------------------+-----------------------+--------------------+--------------------+---------------------+-----------------------+------------
  26706742 |           26659412 |                       |           26631804 |                    |                     |                       |           
  26706743 |                    |                       |           26631804 |                    |                     |               4200529 |           
(2 rows)

mpo_2014_01_v2=# select od.* from order_detail od join input_parameter ip on od.system_id=ip.order_detail_systemid join rate_function rf on ip.rate_func_systemid=rf.system_id join rate_parameter rp on rf.system_id=rp.outputfrom_function_systemid where rp.system_id=26631807;
 system_id |        path_or_class        |      name       | unit_systemid | parameter_type_systemid |     rate_type      
-----------+-----------------------------+-----------------+---------------+-------------------------+--------------------
   4200529 | ./dateSetVO/plannedEndAfter | PLANNED_END_DTM |       1000536 |                 3700005 | service_order_cost

		for (RateParameterVO myParameter : myRateParameterList) {
			if (myParameter.getOutputfromFunctionVO() != null) {
				myInputParameterList = myParameter.getOutputfromFunctionVO().getInputParameterList();
				for (InputParameterVO element : myInputParameterList) {
					OrderDetail myOrderDetailVO = element.getOrderDetailVO();
					if (myOrderDetailVO != null) {
						myRet.add(myOrderDetailVO.retrieveValueFromOrder(myContext));
[1001, 3, NL, DE, 2014-11-13 22:59:00.0]

/ want	,
/ In LogisticsOrderVO is getDateSetVO()=theDateSetVO	, 
/ In DateSetVO is getPlannedEndAfter()=thePlannedEndAfter	,


/ 13	. 

		for (RateParameterVO myParameter : myRateParameterList) {
theSystemId: 26693996Name :RT-MAUT FROM IT_OUTPUT

/ Intermezzo

mpo_2014_01_v2=# select ip.*from input_parameter ip join rate_function rf on ip.rate_func_systemid=rf.system_id join rate_parameter rp on rf.system_id=rp.outputfrom_function_systemid where rp.system_id=26693996;
 system_id | parameter_systemid | func_par_def_systemid | rate_func_systemid | dimension_systemid | configuration_value | order_detail_systemid | free_value 
-----------+--------------------+-----------------------+--------------------+--------------------+---------------------+-----------------------+------------
  26693993 |                    |                       |           26693995 |                    |                     |              26631726 |           
  26693994 |           26631757 |                       |           26693995 |                    |                     |                       |           
(2 rows)

mpo_2014_01_v2=# select od.* from order_detail od join input_parameter ip on od.system_id=ip.order_detail_systemid join rate_function rf on ip.rate_func_systemid=rf.system_id join rate_parameter rp on rf.system_id=rp.outputfrom_function_systemid where rp.system_id=26693996;
 system_id |         path_or_class          |   name   | unit_systemid | parameter_type_systemid |     rate_type      
-----------+--------------------------------+----------+---------------+-------------------------+--------------------
  26631726 | ./calculatedTotalLoadingMeters | CALC_LDM |      26631725 |                 3700002 | service_order_cost
(1 row)

$ vi LogisticsOrderVO.java 

	public BigDecimal getCalculatedTotalLoadingMeters() {
		if (getActualTotalLoadingMeters() != null) {
			return getActualTotalLoadingMeters();
		}
		return getRequestedTotalLoadingMeters();


/ Einde Intermezzo

		for (RateParameterVO myParameter : myRateParameterList) {
			if (myParameter.getOutputfromFunctionVO() != null) {
				myInputParameterList = myParameter.getOutputfromFunctionVO().getInputParameterList();
				for (InputParameterVO element : myInputParameterList) {
					OrderDetail myOrderDetailVO = element.getOrderDetailVO();
					if (myOrderDetailVO != null) {
						myRet.add(myOrderDetailVO.retrieveValueFromOrder(myContext));

/ VERDER MET RATEAGREEMENT



/ Einde DEBUG MPO-84 SCS-4750

/ MPO-84 SCS-4750

/ orig	,
ConsignmentServiceImpl.swapConsignmentsBySequence(int, String) line: 747	
	try{
			ConsignmentVO mySwapVO = consignmentDAO.getConsignmentBySequence(aConsignmentId, aDirection);
			ConsignmentVO myVO = consignmentDAO.getBySystemId(aConsignmentId);

			int mySwapSequenceNr = mySwapVO.getSequenceNr();

			mySwapVO.setSequenceNr(myVO.getSequenceNr());

			myVO.setSequenceNr((int) new Date().getTime());

			updateConsignment(myVO, new TMSEventContext(0), true);

			updateConsignment(mySwapVO, new TMSEventContext(0), true);

			myVO.setSequenceNr(mySwapSequenceNr);

			updateConsignment(myVO, new TMSEventContext(0), true);

select ... 
from CONSIGNMENT consignmen0_ 
cross join CONSIGNMENT consignmen1_ 
cross join SERVICE_ORDER serviceord2_ 
where consignmen0_.system_id in (
	SELECT C.SYSTEM_ID FROM CONSIGNMENT C, SERVICE_ORDER SO 
	WHERE C.SERVICE_ORDER_SYSTEMID=SO.SYSTEM_ID 
	AND SO.ORGANIZATION_SYSTEMID IN  (
		select uo.organization_systemid 
		from user_organization uo 
		where uo.user_systemid = ?
	)
) 
and consignmen1_.system_id in (
	SELECT C.SYSTEM_ID 
	FROM CONSIGNMENT C, SERVICE_ORDER SO 
	WHERE C.SERVICE_ORDER_SYSTEMID=SO.SYSTEM_ID 
	AND SO.ORGANIZATION_SYSTEMID IN  (
		select uo.organization_systemid 
		from user_organization uo 
		where uo.user_systemid =?
	)
) 
and serviceord2_.SYSTEM_ID=consignmen0_.SERVICE_ORDER_SYSTEMID 
and consignmen0_.SERVICE_ORDER_SYSTEMID=consignmen1_.SERVICE_ORDER_SYSTEMID 
and consignmen1_.SYSTEM_ID=? 
and consignmen0_.SEQUENCE_NUMBER<consignmen1_.SEQUENCE_NUMBER 
order by consignmen0_.SEQUENCE_NUMBER DESC

/ Klopt	, 
/ als de order is 1,2,3	, en we click op 3	, dan  is het antwoord: [2,1]	, 
/ hij zal dan 2 kiezen	 want	, 

	consignmentDAOImpl.getConsignmentBySequence(int, String) line: 87	
		...
		return result.iterator().next();
/t
ConsignmentServiceImpl.swapConsignmentsBySequence(int, String) line: 739	

		Query query = getHibernateTemplate().getSessionFactory().getCurrentSession().createQuery(hql);


			int mySwapSequenceNr = mySwapVO.getSequenceNr();
			int mySequenceNr = myVO.getSequenceNr();

			myVO.setSequenceNr(Integer.MAX_VALUE);
			consignmentDAO.getCurrentSession().flush();

			mySwapVO.setSequenceNr(mySequenceNr);
			myVO.setSequenceNr(mySwapSequenceNr);
			consignmentDAO.getCurrentSession().flush();

/ Waarom opsplitsen?
/ Als we	,
			myVO.setSequenceNr(Integer.MAX_VALUE);
			mySwapVO.setSequenceNr(mySequenceNr);
			myVO.setSequenceNr(mySwapSequenceNr);
			consignmentDAO.getCurrentSession().flush();

/ dan staat er in de 1ste cache dat myVO seq no die van mySwapVO heeft	, die MAX_VALUE is overwrite	,  dus dan ERR omdat we dan toch hetzelfde seq nu (die van mySwapVO in deze col krijgen, en dat mag niet	,

/ Dus hij moet 2 keer de 1ste cache flush	, en blijkbaar worden er toch queries created	, en queued	, en in een volgorde process	,

/ Einde MPO-84 SCS-4750


/ MPO-84 STACKTRACES

/ 7	. 

/ 13	. 

ERROR [com.mpobjects.oms.model.service.ServiceOrderServiceImpl] (http-0.0.0.0-8080-2:) In updateServiceOrder(N0001873/26756976):Data access error for class 'com.mpobjects.event.event.model.EventVO': Query failed: select ev.* from event_event ev  where ev.service_order_systemid = :serviceOrderId  order by ev.closed_on, ev.expected_end : com.mpobjects.util.dao.IntNamedQueryParameter@607d5fbf
com.mpobjects.util.dao.DAOException: Data access error for class 'com.mpobjects.event.event.model.EventVO': Query failed: select ev.* from event_event ev  where ev.service_order_systemid = :serviceOrderId  order by ev.closed_on, ev.expected_end : com.mpobjects.util.dao.IntNamedQueryParameter@607d5fbf


/ de 1ste stack trace	, en we draaien hem om	,

[eric@localhost LOGS]$ awk  '810<=NR && NR<=1147 && $0~"at com.mpobjects"' LOG_MPO_81.txt.cp | awk '{l[n++]=$0}END{while(n--)print l[n]}'

    at com.mpobjects.control.action.AbstractAction.act(AbstractAction.java:170)
/s
    at com.mpobjects.oms.control.consignment.action.ConsignmentSequenceAction.act(ConsignmentSequenceAction.java:46)
		myService.swapConsignmentsBySequence(myConsignmentId, myDirection);
/s
    at com.mpobjects.oms.model.service.ConsignmentServiceImpl.swapConsignmentsBySequence(ConsignmentServiceImpl.java:747)
			updateConsignment(myVO, new TMSEventContext(0), true);
/s
    at com.mpobjects.oms.model.service.ConsignmentServiceImpl.updateConsignment(ConsignmentServiceImpl.java:794)
			serviceOrderService.handleConsignmentSwitch(aConsignment, myOldConsignment);
/s
    at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.handleConsignmentSwitch(ServiceOrderServiceImpl.java:887)
					updateServiceOrder(myNewServiceOrderVO, myContext, true, false);
/s
    at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderServiceImpl.java:1355)
					triggerEventHandler(myOldServiceOrderVO, aServiceOrder, false, aContext);
/s
    at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderServiceImpl.java:1679)
			eventHandlerService.handleEvent(myEvent);
/s
    at com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:89)
			listenerList.fireEvent(anEvent);
/s
    at com.mpobjects.oms.model.eventhandler.util.ListenerList.fireEvent(ListenerList.java:80)
			myListener.handleEvent(anEvent);
/s
    at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.handleEvent(RateCalcEventListener.java:67)
				recalcServiceOrderCost(anEvent);
/s
    at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalcServiceOrderCost(RateCalcEventListener.java:170)
		} else if (myType.equals(ShipmentOrderEvent.UPDATED)) {
			recalculate(myServiceOrder, RateType.RATE_TYPE_SERVICE_ORDER_COST, anEvent.getEventContext());
/s
    at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalculate(RateCalcEventListener.java:258)
				myService.recalculate(myOrder, RateType.RATE_TYPE_SERVICE_ORDER_COST, anEventContext);
/s
    at com.mpobjects.oms.ratecalc.model.service.CalculationServiceImpl.recalculate(CalculationServiceImpl.java:405)
				// Now calculate the rates
				myRateCalculationVO.runFor(mySelectedRateAgreement);
/s
    at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.runFor(RateCalculationVO.java:769)
							updateServiceOrderCostPartList(firstAlt);
/s
    at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.updateServiceOrderCostPartList(RateCalculationVO.java:1600)
				getServiceOrderFacade().updateServiceOrder(serviceOrder, eventCtx, true, false);
/s
    at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderServiceImpl.java:1355)
					triggerEventHandler(myOldServiceOrderVO, aServiceOrder, false, aContext);
/s
    at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderServiceImpl.java:1679)
			eventHandlerService.handleEvent(myEvent);
/s
    at com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:89)
			listenerList.fireEvent(anEvent);
/s
	at com.mpobjects.oms.model.eventhandler.util.ListenerList.fireEvent(ListenerList.java:80)
		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);
/s
	at com.mpobjects.event.event.model.util.EventEventListener.handleEvent(EventEventListener.java:114)
		} else if (myType.equals(ServiceOrderEvent.UPDATED)) {
			handleServiceOrderChange((ServiceOrderEvent) anEvent);
/s
	at com.mpobjects.event.event.model.util.EventEventListener.handleServiceOrderChange(EventEventListener.java:609)
			updateEventTimesForServiceOrder(myNewServiceOrder);
/s
	at com.mpobjects.event.event.model.util.EventEventListener.updateEventTimesForServiceOrder(EventEventListener.java:1016)
		Collection<EventVO> myNewEventList = eventService.getEventsForServiceOrder(myNewServiceOrderVO.getSystemId());
/s
	at com.mpobjects.event.event.model.service.EventServiceImpl.getEventsForServiceOrder(EventServiceImpl.java:463)
		return getDAO().getEventsForServiceOrder(aSystemId);
	at com.mpobjects.core.performance.PerformanceMeasurementAspect.measurePerformance(PerformanceMeasurementAspect.java:56)
/s
	at com.mpobjects.event.event.model.dao.EventDAOImpl.getEventsForServiceOrder(EventDAOImpl.java:457)
		Collection<EventVO> myEventList = executeSqlSelect(myQuery, "ev", params);
/s
	at com.mpobjects.util.dao.BaseHibernateDAO.executeSqlSelect(BaseHibernateDAO.java:166)
		return executeSqlSelect(aSql, anAlias, aParameters, 0);
/s
	at com.mpobjects.util.dao.BaseHibernateDAO.executeSqlSelect(BaseHibernateDAO.java:184)
		return executeSqlSelect(aSql, anAlias, aParameters, aMaxResult, 0);
/s
	at com.mpobjects.util.dao.BaseHibernateDAO.executeSqlSelect(BaseHibernateDAO.java:231)
			throw new DAOException(msg, e);

/ 13	.

Caused by: org.springframework.dao.DataIntegrityViolationException: Could not execute JDBC batch update; SQL [
update CONSIGNMENT set CONSIGNMENT_NUMBER=?, SERVICE_ORDER_SYSTEMID=?, SEQUENCE_NUMBER=?, CONSIGNMENT_STATUS_SYSTEMID=?, FROM_LOCATION_ID=?, FROM_NAME=?, FROM_NAME2=?, FROM_ADDRESS=?, FROM_ADDRESS2=?, FROM_CITY=?, FROM_POSTAL_CODE=?, FROM_REGION_STATE=?, FROM_COUNTRY_SYSTEMID=?, FROM_PHONE_NUMBER=?, FROM_FAX_NUMBER=?, FROM_EMAIL_ADDRESS=?, FROM_CONTACT_NAME=?, TO_LOCATION_ID=?, TO_NAME=?, TO_NAME2=?, TO_ADDRESS=?, TO_ADDRESS2=?, TO_CITY=?, TO_POSTAL_CODE=?, TO_REGION_STATE=?, TO_COUNTRY_SYSTEMID=?, TO_PHONE_NUMBER=?, TO_FAX_NUMBER=?, TO_EMAIL_ADDRESS=?, TO_CONTACT_NAME=?, REQUESTED_START_BEFORE=?, REQUESTED_START_AFTER=?, PLANNED_START_BEFORE=?, PLANNED_START_AFTER=?, ORG_PLANNED_START_BEFORE=?, ORG_PLANNED_START_AFTER=?, REQUESTED_END_BEFORE=?, REQUESTED_END_AFTER=?, PLANNED_END_BEFORE=?, PLANNED_END_AFTER=?, ORG_PLANNED_END_BEFORE=?, ORG_PLANNED_END_AFTER=?, ACTUAL_START=?, ACTUAL_END=?, CLOSE_DATE=?, REFERENCE1=?, REFERENCE2=?, REFERENCE3=?, REFERENCE4=?, REFERENCE5=?, POD_REFERENCE=?, TOTAL_LDM=?, TOTAL_VOLUME=?, COMMENTS=?, IS_TEMPORARY=? 
where SYSTEM_ID=?]; constraint [null]; 
nested exception is org.hibernate.exception.ConstraintViolationException: Could not execute JDBC batch update
    at org.springframework.orm.hibernate3.SessionFactoryUtils.convertHibernateAccessException(SessionFactoryUtils.java:645)
    at org.springframework.orm.hibernate3.HibernateAccessor.convertHibernateAccessException(HibernateAccessor.java:412)
    at org.springframework.orm.hibernate3.HibernateTemplate.doExecute(HibernateTemplate.java:412)
    at org.springframework.orm.hibernate3.HibernateTemplate.executeFind(HibernateTemplate.java:344)
    at com.mpobjects.util.dao.BaseHibernateDAO.executeSqlSelect(BaseHibernateDAO.java:207)

/ 13	. 

Caused by: org.hibernate.exception.ConstraintViolationException: Could not execute JDBC batch update
...
    ... 339 more

/ 13	.

Caused by: java.sql.BatchUpdateException: Batch entry 0 
update CONSIGNMENT set CONSIGNMENT_NUMBER='N0001873.1', SERVICE_ORDER_SYSTEMID=26756976, SEQUENCE_NUMBER=26806867, CONSIGNMENT_STATUS_SYSTEMID=1, FROM_LOCATION_ID='1001', FROM_NAME='HEINZ PLASTICS BOHM GmbH', FROM_NAME2='', FROM_ADDRESS='Frankenwaldstrasse 29', FROM_ADDRESS2='', FROM_CITY='TETTAU-LANGENAU', FROM_POSTAL_CODE='96355', FROM_REGION_STATE='', FROM_COUNTRY_SYSTEMID=4052, FROM_PHONE_NUMBER='0049-926999040', FROM_FAX_NUMBER='', FROM_EMAIL_ADDRESS='', FROM_CONTACT_NAME='', TO_LOCATION_ID='9', TO_NAME='KONINKLIJKE SANDERS B.V.', TO_NAME2='', TO_ADDRESS='Industriepark Vliedberg 12', TO_ADDRESS2='', TO_CITY='VLIJMEN', TO_POSTAL_CODE='5251  RG', TO_REGION_STATE='', TO_COUNTRY_SYSTEMID=4153, TO_PHONE_NUMBER='', TO_FAX_NUMBER='', TO_EMAIL_ADDRESS='', TO_CONTACT_NAME='', REQUESTED_START_BEFORE='2014-10-10 22:59:00.000000 +02:00:00', REQUESTED_START_AFTER='2014-10-10 00:00:00.000000 +02:00:00', PLANNED_START_BEFORE='2014-11-11 22:59:00.000000 +01:00:00', PLANNED_START_AFTER='2014-11-11 22:59:00.000000 +01:00:00', ORG_PLANNED_START_BEFORE=NULL, ORG_PLANNED_START_AFTER=NULL, REQUESTED_END_BEFORE='2014-11-13 22:59:00.000000 +01:00:00', REQUESTED_END_AFTER='2014-11-13 00:00:00.000000 +01:00:00', PLANNED_END_BEFORE='2014-11-13 22:59:00.000000 +01:00:00', PLANNED_END_AFTER='2014-11-13 22:59:00.000000 +01:00:00', ORG_PLANNED_END_BEFORE=NULL, ORG_PLANNED_END_AFTER=NULL, ACTUAL_START=NULL, ACTUAL_END='2014-11-13 17:25:00.000000 +01:00:00', CLOSE_DATE=NULL, REFERENCE1='', REFERENCE2='', REFERENCE3='', REFERENCE4='', REFERENCE5='', POD_REFERENCE='', TOTAL_LDM='4.80', TOTAL_VOLUME='0.000', COMMENTS='', IS_TEMPORARY='0' 
where SYSTEM_ID=26756979 was aborted.  Call getNextException to see the cause.

/ 7	.

/ 13	. 

ERROR [com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO] (http-0.0.0.0-8080-2:) In updateShipmentOrderPricePartList([RC_MAUT = 59.2] [RC_FUEL = 61.344] [RC_ADDITIONAL_ADDRESS = 252.00] [RC_FREIGHT = 511.2] [RC_RELEASE_DATE = 2014-11-07 12:00:00] [RC_START_AFTER = 2014-11-11 22:59:00] [RC_SERVICE = STANDARD] ), when saving  shipment order:In updateServiceOrder(N0001873/26756976):Data access error for class 'com.mpobjects.event.event.model.EventVO': Query failed: 
select ev.* from event_event ev  where ev.service_order_systemid = :serviceOrderId  order by ev.closed_on, ev.expected_end : com.mpobjects.util.dao.IntNamedQueryParameter@607d5fbf

	at com.mpobjects.control.filter.FirstLoginFilter.doFilter(FirstLoginFilter.java:75)
	at com.mpobjects.control.action.AbstractAction.act(AbstractAction.java:170)
	at com.mpobjects.oms.control.consignment.action.ConsignmentSequenceAction.act(ConsignmentSequenceAction.java:46)
	at com.mpobjects.oms.model.service.ConsignmentServiceImpl.swapConsignmentsBySequence(ConsignmentServiceImpl.java:747)
	at com.mpobjects.oms.model.service.ConsignmentServiceImpl.updateConsignment(ConsignmentServiceImpl.java:794)
	at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.handleConsignmentSwitch(ServiceOrderServiceImpl.java:887)
	at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderServiceImpl.java:1355)
	at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderServiceImpl.java:1679)
	at com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:89)
	at com.mpobjects.oms.model.eventhandler.util.ListenerList.fireEvent(ListenerList.java:80)
	at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.handleEvent(RateCalcEventListener.java:67)
	at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalcServiceOrderCost(RateCalcEventListener.java:170)
	at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalculate(RateCalcEventListener.java:258)
	at com.mpobjects.oms.ratecalc.model.service.CalculationServiceImpl.recalculate(CalculationServiceImpl.java:405)
	at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.runFor(RateCalculationVO.java:769)
	at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.updateServiceOrderCostPartList(RateCalculationVO.java:1600)
	at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderServiceImpl.java:1370)

/ 7	. 

/ 13	. 

), save ratecalc failed:java.lang.RuntimeException: In updateShipmentOrderPricePartList([RC_MAUT = 59.2] [RC_FUEL = 61.344] [RC_ADDITIONAL_ADDRESS = 252.00] [RC_FREIGHT = 511.2] [RC_RELEASE_DATE = 2014-11-07 12:00:00] [RC_START_AFTER = 2014-11-11 22:59:00] [RC_SERVICE = STANDARD] ), when saving  shipment order:In updateServiceOrder(N0001873/26756976):Data access error for class 'com.mpobjects.event.event.model.EventVO': Query failed: select ev.* from event_event ev  where ev.service_order_systemid = :serviceOrderId  order by ev.closed_on, ev.expected_end : com.mpobjects.util.dao.IntNamedQueryParameter@607d5fbf

[eric@localhost LOGS]$ awk  '1588<=NR && NR<=1796 && $0~"at com.mpobjects"' LOG_MPO_81.txt | awk '{l[n++]=$0}END{while(n--)print l[n]}'	at com.mpobjects.control.filter.FirstLoginFilter.doFilter(FirstLoginFilter.java:75)
	at com.mpobjects.control.action.AbstractAction.act(AbstractAction.java:170)
	at com.mpobjects.oms.control.consignment.action.ConsignmentSequenceAction.act(ConsignmentSequenceAction.java:46)
	at com.mpobjects.oms.model.service.ConsignmentServiceImpl.swapConsignmentsBySequence(ConsignmentServiceImpl.java:747)
	at com.mpobjects.oms.model.service.ConsignmentServiceImpl.updateConsignment(ConsignmentServiceImpl.java:794)
	at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.handleConsignmentSwitch(ServiceOrderServiceImpl.java:887)
	at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderServiceImpl.java:1355)
	at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderServiceImpl.java:1679)
	at com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:89)
	at com.mpobjects.oms.model.eventhandler.util.ListenerList.fireEvent(ListenerList.java:80)
	at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.handleEvent(RateCalcEventListener.java:67)
	at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalcServiceOrderCost(RateCalcEventListener.java:170)
	at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalculate(RateCalcEventListener.java:258)
	at com.mpobjects.oms.ratecalc.model.service.CalculationServiceImpl.recalculate(CalculationServiceImpl.java:405)
	at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.runFor(RateCalculationVO.java:769)
	at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.updateServiceOrderCostPartList(RateCalculationVO.java:1609)

/ 7	.

2015-03-18 17:15:00,668 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-2:) 
select this_.SYSTEM_ID as SYSTEM1_97_0_, this_.CURRENCY_NAME as CURRENCY2_97_0_, this_.CURRENCY_CODE as CURRENCY3_97_0_, this_.IS_DELETED as IS4_97_0_ 
from CURRENCY this_ 
where this_.IS_DELETED=? 
and this_.CURRENCY_CODE=?
2015-03-18 17:15:00,688 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:) binding parameter [1] as [BIT] - false
2015-03-18 17:15:00,688 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:) binding parameter [2] as [VARCHAR] - EUR


calhost LOGS]$ awk  '1987<=NR && NR<=2198 && $0~"at com.mpobjects"' LOG_MPO_81.txt | awk '{l[n++]=$0}END{while(n--)print l[n]}'
	at com.mpobjects.control.filter.FirstLoginFilter.doFilter(FirstLoginFilter.java:75)
	at com.mpobjects.control.action.AbstractAction.act(AbstractAction.java:170)
	at com.mpobjects.oms.control.consignment.action.ConsignmentSequenceAction.act(ConsignmentSequenceAction.java:46)
	at com.mpobjects.oms.model.service.ConsignmentServiceImpl.swapConsignmentsBySequence(ConsignmentServiceImpl.java:747)
	at com.mpobjects.oms.model.service.ConsignmentServiceImpl.updateConsignment(ConsignmentServiceImpl.java:794)
	at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.handleConsignmentSwitch(ServiceOrderServiceImpl.java:887)
	at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderServiceImpl.java:1355)
	at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderServiceImpl.java:1679)
	at com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:89)
	at com.mpobjects.oms.model.eventhandler.util.ListenerList.fireEvent(ListenerList.java:80)
	at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.handleEvent(RateCalcEventListener.java:67)
	at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalcServiceOrderCost(RateCalcEventListener.java:170)
	at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalculate(RateCalcEventListener.java:258)
	at com.mpobjects.oms.ratecalc.model.service.CalculationServiceImpl.recalculate(CalculationServiceImpl.java:405)
	at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.runFor(RateCalculationVO.java:800)
	at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.createXMLLog(RateCalculationVO.java:300)
	at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationAlternative.getAsElement(RateCalculationAlternative.java:153)
	at com.mpobjects.oms.ratecalc.model.process.function.RateResult.toXML(RateResult.java:289)
	at com.mpobjects.oms.ratecalc.model.process.function.RateResult.getCurrency(RateResult.java:120)
	at com.mpobjects.ratecalc.entity.Unit.getAsCurrency(Unit.java:49)

/ Hierboven waren we ook in RateCalculationVO.runFor	, toen op een andere plaats een ERR	,

/ In RateCalculationVO.java
	public void runFor(RateAgreementVO aRateAgreementVO) {
769:							updateServiceOrderCostPartList(firstAlt);
/ Hierboven	,
				} finally {
800:						createXMLLog();

















/ Einde MPO-84 STACKTRACES

/ NIP-45

/ 7	.

/ Michel : PNL-449

/ Pascal: DSVHMC-7 

$ vi ShipmentOrderBodyProcessor.java


	protected void processShipmentOrderParty(ShipmentOrderVO aShipmentOrderVO, Node aNode) throws TransformerException, PartyException, ShipmentOrderException {

/ NU
		} else if (myPartyRole.equals(PARTY_ROLE_EMPLOYEE_RESPONSIBLE_QUALIFIER)) {
			Party myParty = new PartyProcessor(this).process(partyNode);
			myParty = PartyProcessor.storeParty(aShipmentOrderVO, "employee_responsible", myParty);
			if (myParty != null) {
				myParty = new VirtualParty(myParty);
			}

/ WAS
		} else if (myPartyRole.equals(PARTY_ROLE_EMPLOYEE_RESPONSIBLE_QUALIFIER)) {
			Party myParty = new PartyProcessor(this).process(partyNode);
			if (myParty != null) {
				myParty = new VirtualParty(myParty);
			}
			myParty = PartyProcessor.storeParty(aShipmentOrderVO, "employee_responsible", myParty);

/ 7	.

/ install commit-monitor (windows)

/ 7	. 

/ nip-45:

<mtccore:SHIPMENT_ORDER_PARTY> 
               <mtccore:PARTY_ROLE>PREFERED_EXECUTION</mtccore:PARTY_ROLE> 

		} else if (myPartyRole.equals(PARTY_ROLE_PREFERED_EXECUTION_PARTY)) {
			...
693:			aShipmentOrderVO.setPreferedPartyVO(myParty);


/ Probeer ook andere <mtccore:PARTY_ROLE>	, zoals ROLE_EMPLOYEE	,

/ we moeten 
				if(party.system_id==null)throw PartyException(...)
				else aShipmentOrderVO.setPreferedPartyVO(myParty);
	

/ 7	.





/ Einde NIP-45

/ SCS-4742

/ Zoek in de application naar	,
		getMarkupSettings().setStripWicketTags(true);

/ ApplicationUtils.init wordt called in WicketWebApplication.init	,

$ vi ApplicationUtils.java

		if (ApplicationServerType.PRODUCTION != serverType) {
			Application.get().getDebugSettings().setOutputComponentPath(true);
		}

/ Nu zien we een wicketpath attribute op elk wicket component	,





/ Einde SCS-4742

/ MPO-84

/ we hadden de b's , removed	,

ConsignmentSequenceAction [line: 37] - act()	
ConsignmentServiceImpl [line: 738] - swapConsignmentsBySequence(int, String)	
ConsignmentServiceImpl [line: 743] - swapConsignmentsBySequence(int, String)	
ConsignmentView [line: 44] - getConsignmentsByServiceOrder(int)	
EventCacheDAOImpl [line: 36] - EventCacheDAOImpl()	
EventCacheDAOImpl [line: 41] - findByCriteria(DAOFilterExpression<EventCacheVO>, int, int)	
EventCacheDAOImpl [line: 125] - runQuery(QueryParam, DAOFilterExpression<EventCacheVO>)	
EventCacheDAOImpl [line: 150] - runQueryCount(DAOFilterExpression<EventCacheVO>)	
EventCacheDAOImpl [line: 162] - statusCount(EventType, Date)	
EventCacheDataProvider [line: 41] - iterator(int, int)	
EventCacheDataProvider [line: 64] - model(EventCacheVO)	
EventCacheDataProvider [line: 69] - size()	
EventCacheDataProvider$Builder [line: 30] - build(BeanWrapper, String)	
EventCacheSearchListPanel [line: 41] - EventCacheSearchListPanel(String, BaseWebComponent, WebComponentEventSwitchBoard, BeanWrapper<? extends BaseDAOInterface<EventCacheVO>>, Collection<EntityAction<EventCacheVO>>, TableDataProviderBuilder<EventCacheVO>)	
EventCacheSearchListPanel [line: 52] - addFilterColumns(List<IColumn>)	
EventCacheSearchListPanel [line: 61] - populateItem(Item, String, IModel)	
EventCacheSearchListPanel [line: 66] - onClick()	
EventCacheSearchListPanel [line: 80] - populateItem(Item, String, IModel)	
EventCacheSearchListPanel [line: 99] - populateItem(Item, String, IModel)	
EventCustomQuery [line: 153] - getEventDashboardItemVO()	
EventCustomQuery [line: 172] - getQuery()	
EventCustomQueryDAOImpl [line: 21] - getAllDashboardItemVO()	
EventCustomQueryDashboardSearchListPanel [line: 39] - EventCustomQueryDashboardSearchListPanel(String, BaseWebComponent, WebComponentEventSwitchBoard, BeanWrapper<? extends BaseDAOInterface<EventCustomQuery>>, Collection<EntityAction<EventCustomQuery>>)	
EventCustomQueryDashboardSearchListPanel [line: 45] - EventCustomQueryDashboardSearchListPanel(String, BaseWebComponent, WebComponentEventSwitchBoard, BeanWrapper<? extends BaseDAOInterface<EventCustomQuery>>, Collection<EntityAction<EventCustomQuery>>, TableDataProviderBuilder<EventCustomQuery>)	
EventCustomQueryDashboardSearchListPanel [line: 56] - addFilterColumns(List<IColumn>)	
EventCustomQueryDashboardSearchListPanel [line: 63] - populateItem(Item, String, IModel)	
EventCustomQueryDashboardSearchListPanel [line: 103] - populateItem(Item, String, IModel)	
EventCustomQueryDashboardSearchListPanel [line: 109] - onClick()	
EventDAOImpl [line: 453] - getEventsForServiceOrder(int)	
EventDashboardItemDAOImpl [line: 64] - getAll()	
EventDashboardItemDAOImpl [line: 96] - getAllUnexpected()	
EventDashboardItemDAOImpl [line: 116] - getEventDashboardItem(EventCustomQuery, int)	
EventDashboardItemDAOImpl [line: 131] - getUnexpectedDashboardItems(DAOFilterExpression)	
EventDashboardItemDAOImpl [line: 193] - refresh(int, Resource)	
EventDashboardItemDAOImpl [line: 204] - refreshAll(Resource)	
EventDashboardItemDAOImpl [line: 221] - runQuery(QueryParam, DAOFilterExpression)	
EventDashboardItemDAOImpl [line: 222] - runQuery(QueryParam, DAOFilterExpression)	
EventDashboardItemDAOImpl [line: 236] - runQueryCount(DAOFilterExpression)	
EventDashboardItemDAOImpl [line: 250] - runUnExpectedQuery(QueryParam, DAOFilterExpression)	
EventDashboardItemDAOImpl [line: 261] - runUnExpectedQueryCount(DAOFilterExpression)	
EventDashboardItemDAOImpl [line: 305] - getDashboardItemList(Collection<EventCacheVO>)	
EventDashboardItemDAOImpl [line: 351] - getFromDate()	
EventDashboardItemDAOImpl [line: 358] - getUnexpectedList(Collection<EventVO>)	
EventDashboardPage [line: 68] - EventDashboardPage()	
EventDashboardPage [line: 106] - onSubmit()	
EventDashboardPage [line: 131] - onSubmit(Button, AjaxRequestTarget, IModel<EventCustomQuery>)	
EventDashboardPage [line: 150] - onSubmit(Button, AjaxRequestTarget, IModel<EventCacheVO>)	
EventDashboardPage [line: 168] - getUnExpectedPrefilterParameters()	
EventHandlerServiceImpl [line: 52] - handleEvent(Event)	
EventHandlerServiceImpl [line: 97] - handleEvent(Event)	
EventSearchListPanel [line: 37] - EventSearchListPanel(String, BaseWebComponent, WebComponentEventSwitchBoard, BeanWrapper<? extends BaseDAOInterface<E>>, Collection<EntityAction<E>>)	
EventSearchListPanel [line: 48] - addFilterColumns(List<IColumn>)	
EventServiceImpl [line: 463] - getEventsForServiceOrder(int)	
GenericHibernateDAO [line: 431] - runQuery(QueryParam, DAOFilterExpression<Type>)	
GenericHibernateDAO [line: 454] - runQueryCount(DAOFilterExpression<Type>)	
GenericListPanel [line: 303] - initialize()	
GenericTableDataProvider [line: 203] - iterator(int, int)	
GenericTableDataProvider [line: 257] - size()	
RateCalculationVO [line: 1594] - updateServiceOrderCostPartList(RateCalculationAlternative)	
ServiceOrderServiceImpl [line: 1280] - updateServiceOrder(ServiceOrderVO, TMSEventContext, boolean, boolean)	
ServiceOrderServiceImpl [line: 1355] - updateServiceOrder(ServiceOrderVO, TMSEventContext, boolean, boolean)	
UnExpectedEventDashboardItemDataProvider [line: 56] - iterator(int, int)	
UnExpectedEventDashboardItemDataProvider [line: 69] - size()	
UnExpectedEventDashboardItemDataProvider [line: 70] - size()	
UnExpectedEventDashboardItemSearchListPanel [line: 40] - UnExpectedEventDashboardItemSearchListPanel(String, BaseWebComponent, WebComponentEventSwitchBoard, BeanWrapper<? extends BaseDAOInterface<EventDashboardItemVO>>, Collection<EntityAction<EventDashboardItemVO>>, TableDataProviderBuilder<EventDashboardItemVO>)	
UnExpectedEventDashboardItemSearchListPanel [line: 52] - addFilterColumns(List<IColumn>)	
UnExpectedEventDashboardItemSearchListPanel [line: 62] - populateItem(Item, String, IModel)	
UnExpectedEventDashboardItemSearchListPanel [line: 67] - onClick()	
Unit [line: 45] - getAsCurrency()	
EventDashboardPage [entry] - onSubmit(Button, AjaxRequestTarget, IModel<EventCacheVO>)	
EventDashboardPage [entry] - onSubmit(Button, AjaxRequestTarget, IModel<EventCacheVO>)	
EventDashboardPage [entry] - onSubmit(Button, AjaxRequestTarget, IModel<EventCacheVO>)	
tab-sa-route.tag [line: 71]	




/ Einde MPO-84

/ NIP-39

/ 7	.

/ JMS MESSAGE ENTRY

////////////////////////////////////////////////////////////////
$ vi conf/local_application.properties
module.interfacing.jms.listener.autostartup=true

/ dan komen de msg binnen	,

/ 7	.

http://localhost:8161/admin/queues.jsp

/ webconsole van activemq	,

/ 7	.


/ Einde NIP-39



/ CONNECTIONS 

/ 7	. 

/ forticlient 

/ we kunnen alleen Keep connection alive alleen met window-versie door een config default te create	,

/ see	,
http://serverfault.com/questions/676348/how-to-say-keep-connection-alive-with-command-line-script-forticlientsslvpn-cli

[eric@localhost forticlientsslvpn]$ ./forticlientsslvpn
/ click settings

/ select default
/ als we dit niet doen, gaat de config verloren	, hij moet een name hebben	,

/ we geven	,
[eric@localhost forticlientsslvpn]$ ./forticlientsslvpn

Keep connection alive until manually stopped	: check
Start connection automatically					: TODO
Server: 80.95.170.62:443
User: vanderveldene
Password: HA65Fs8LTTCK
Done						: click

/ Als we een connection create, dan kiezen we default config, en geven nog de 6 getallen achter het password	,

 
/ 7	. 

/ ssh naar application op test	,
[eric@localhost my]$ ssh mposerv11
eric@mposerv8's password: mpo@2014

/ 7	. 

/ conn naar pnloms db op test	,
[eric@localhost my]$ PGPASSWORD=mpo@2014  psql -U eric -h mposerv8 pnloms 
pnloms=> \q


/ 7	 .

/ ssh naar application op acceptance	,
[eric@localhost my]$ ssh vanderveldene@application-a.intermax.mp-objects.com
Password: h^Zgcyr&Q

/ 7	. 

/ we zien dat op application-acceptance de database van mpo op de database-acceptance staat	,

/ psql naar  database-acceptance
[eric@localhost my]$ PGPASSWORD=mpopostgres@mpo psql -U mpopostgres -h database-a.intermax.mp-objects.com mpo
mpo=# \dg
                              List of roles
  Role name  |                   Attributes                   | Member of 
-------------+------------------------------------------------+-----------
 hendriksm   | Superuser, Create role, Create DB              | {}
 mpo         | Password valid until infinity                  | {}
 mpopostgres | Superuser, Replication                         | {}
 postgres    | Superuser, Create role, Create DB, Replication | {}

/ 7	. 

/ local	,
[eric@localhost ~]$ PGPASSWORD=mpopostgres@mpo psql -U mpopostgres pnloms

/ 7	. 

/ pg_dump, pg_restore	,

/ we maken een dump van pnloms op test	, mposerv8, en install local	,

/ we hebben al op 1 mei	, local	,
postgres=# create user mpopostgres createdb password 'mpopostgres@mpo'\g

/ local	,
pnloms=# \dg
                              List of roles
  Role name  |                   Attributes                   | Member of 
-------------+------------------------------------------------+-----------
 mpopostgres | Superuser, Create DB                           | {}

/ Dus WH is alter role	, om superuser te set	,
/ TODO

/ user komen NIET met een backup	,
/ mpopostgres is Superuser	, 

/ probeer	,
[eric@localhost Backup]$  pg_dump -U eric -Fc -h mposerv8 pnloms -f  pnloms.dump

/ WH omdat mpopostgres een superuser is, kan hij pg_restore	,
=> \c ... mpopostgres
You are now connected to database "mpo" as user "mpopostgres".
...=# create database pnloms\g
CREATE DATABASE

[eric@localhost Backup]$ pg_restore -U mpopostgres -d pnloms pnloms.dump
mpopostgres@mpo

/ we zien dat op test er inderdaad geen (superuser) mpopostgres is	

[eric@localhost my]$ PGPASSWORD=mpo@2014 psql -U eric -h mposerv8 pnloms
pnloms=> \dg
                                       List of roles
  Role name  |                   Attributes                   |         Member of          
-------------+------------------------------------------------+----------------------------
 eric        |                                                | {admin}
...
/ Geen mpopostgres	,





 

/ Einde CONNECTIONS 

/ 2015.01 MPO

/ 7	.

/ conflict
$ vi dsvcts.properties

/ local	,
module.oms.interface.shipmentorder.party.prefered_execution.mode = lookup_create
/ remote	,
module.oms.interface.shipmentorder.party.prefered_execution.mode = merge_from_masterdata

[eric@localhost forticlientsslvpn]$ ./forticlientsslvpn
/ window	,
Server: 80.95.170.62:443
User: vanderveldene
Password: HA65Fs8LTTCKxxxxxx 

[eric@localhost workspace]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace

[eric@localhost workspace]$ vi 2015.01/application.properties 

base.product=mpo
build.war.dir = /home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/${base.product}/deploy/tms.war/
jboss.configuration = ${base.product}
jboss.home=/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA
ant.home=/usr/share/ant

/ Nu de db	 van acceptance halen	,

[eric@localhost ]$ ssh vanderveldene@application-a.intermax.mp-objects.com
h^Zgcyr&Q
[vanderveldene@application-a mpo]$ pwd
/local/apps/jboss-4.0.5.GA/server/mpo
[vanderveldene@application-a mpo]$ vi deploy/postgres-ds.xml
               <xa-datasource-property name="ServerName">192.168.173.20</xa-datasource-property>
                <xa-datasource-property name="PortNumber">5432</xa-datasource-property>
                <xa-datasource-property name="DatabaseName">mpo</xa-datasource-property>
                <xa-datasource-property name="User">mpo</xa-datasource-property>

/ Op https://system.mp-objects.com/xwiki/bin/view/Technology/Intermax zien we dat dit de database server is op acceptance	,
database-a.intermax.mp-objects.com	,

/ 7     .

/ bij autowire="byType" mag er maar 1 impl zijn, anders,

org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'home' defined in class path resource [spring-book.xml]: Unsatisfied dependency expressed through bean property 'my2': : No qualifying bean of type [my.test.own.spring_book.My] is defined: expected single matching bean but found 2: my,my2; nested exception is org.springframework.beans.factory.NoUniqueBeanDefinitionException: No qualifying bean of type [my.test.own.spring_book.My] is defined: expected single matching bean but found 2: my,my2

PGPASSWORD=mpopostgres@mpo pg_restore -U mpopostgres -d mpo_2014_01_v2 mpo_2014_01_v2.dump

/ Zorg dat we een forticlient conn hebben	,
/ dan	,
[eric@localhost Backup]$ PGPASSWORD=mpopostgres@mpo pg_dump -U mpopostgres -Fc -h database-a.intermax.mp-objects.com mpo -f mpo_2015.01.dump
/ dan	,
/ create database	,
# create database mpo_2015_01;
/ dan	,
[eric@localhost Backup]$ PGPASSWORD=mpopostgres@mpo pg_restore -U mpopostgres -d mpo_2015_01 mpo_2015.01.dump 

[eric@localhost mpo]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/mpo
[eric@localhost mpo]$ vi deploy/postgres-ds.xml
<datasources>
    <xa-datasource>
		...
        <xa-datasource-property name="DatabaseName">mpo_2015_01</xa-datasource-property>

    <local-tx-datasource>
		...
        <connection-url>jdbc:postgresql://127.0.0.1:5432/mpo_2015_01</connection-url>

/ Start appl	,
/ OK

[eric@localhost 2015.01_mpo]$ pwd
/home/eric/Devel/Interfaces/2015.01_mpo
[eric@localhost 2015.01_mpo]$ unzip  ~/Downloads/SHO.xml.zip 
[eric@localhost 2015.01_mpo]$ ls SHO.xml/
O91T50555.CMP.xml  O91T53316.CMP.xml  O91T53506.CMP.xml  O91T53556.CMP.xml  O91T53582.CMP.xml  O91T53622.CMP.xml  O91T53661.CMP.xml
O91T53086.CMP.xml  O91T53330.CMP.xml  O91T53517.CMP.xml  O91T53557.CMP.xml  O91T53583.CMP.xml  O91T53635.CMP.xml  O91T53662.CMP.xml
O91T53175.CMP.xml  O91T53342.CMP.xml  O91T53519.CMP.xml  O91T53558.CMP.xml  O91T53584.CMP.xml  O91T53636.CMP.xml  O91T53663.CMP.xml
O91T53185.CMP.xml  O91T53345.CMP.xml  O91T53523.CMP.xml  O91T53559.CMP.xml  O91T53585.CMP.xml  O91T53637.CMP.xml  O91T53664.CMP.xml
O91T53188.CMP.xml  O91T53369.CMP.xml  O91T53531.CMP.xml  O91T53560.CMP.xml  O91T53586.CMP.xml  O91T53638.CMP.xml  O91T53665.CMP.xml
O91T53205.CMP.xml  O91T53373.CMP.xml  O91T53532.CMP.xml  O91T53561.CMP.xml  O91T53588.CMP.xml  O91T53639.CMP.xml  O91T53666.CMP.xml
O91T53207.CMP.xml  O91T53374.CMP.xml  O91T53533.CMP.xml  O91T53562.CMP.xml  O91T53589.CMP.xml  O91T53640.CMP.xml  O91T53667.CMP.xml
O91T53211.CMP.xml  O91T53398.CMP.xml  O91T53534.CMP.xml  O91T53563.CMP.xml  O91T53591.CMP.xml  O91T53641.CMP.xml  O91T53668.CMP.xml
O91T53220.CMP.xml  O91T53404.CMP.xml  O91T53540.CMP.xml  O91T53564.CMP.xml  O91T53601.CMP.xml  O91T53642.CMP.xml  O91T53669.CMP.xml
O91T53222.CMP.xml  O91T53454.CMP.xml  O91T53541.CMP.xml  O91T53565.CMP.xml  O91T53602.CMP.xml  O91T53646.CMP.xml  O91T53670.CMP.xml
O91T53257.CMP.xml  O91T53455.CMP.xml  O91T53542.CMP.xml  O91T53566.CMP.xml  O91T53603.CMP.xml  O91T53647.CMP.xml  O91T53671.CMP.xml
O91T53267.CMP.xml  O91T53456.CMP.xml  O91T53543.CMP.xml  O91T53568.CMP.xml  O91T53604.CMP.xml  O91T53648.CMP.xml  O91T53674.CMP.xml
O91T53268.CMP.xml  O91T53462.CMP.xml  O91T53544.CMP.xml  O91T53569.CMP.xml  O91T53606.CMP.xml  O91T53649.CMP.xml  O91T53677.CMP.xml
O91T53269.CMP.xml  O91T53463.CMP.xml  O91T53545.CMP.xml  O91T53570.CMP.xml  O91T53607.CMP.xml  O91T53650.CMP.xml  O91T53689.CMP.xml
O91T53281.CMP.xml  O91T53464.CMP.xml  O91T53546.CMP.xml  O91T53571.CMP.xml  O91T53608.CMP.xml  O91T53651.CMP.xml  O91T53690.CMP.xml
O91T53282.CMP.xml  O91T53468.CMP.xml  O91T53547.CMP.xml  O91T53572.CMP.xml  O91T53609.CMP.xml  O91T53653.CMP.xml
O91T53283.CMP.xml  O91T53500.CMP.xml  O91T53548.CMP.xml  O91T53573.CMP.xml  O91T53610.CMP.xml  O91T53654.CMP.xml
O91T53295.CMP.xml  O91T53501.CMP.xml  O91T53550.CMP.xml  O91T53574.CMP.xml  O91T53611.CMP.xml  O91T53656.CMP.xml
O91T53312.CMP.xml  O91T53503.CMP.xml  O91T53553.CMP.xml  O91T53577.CMP.xml  O91T53612.CMP.xml  O91T53658.CMP.xml
O91T53314.CMP.xml  O91T53504.CMP.xml  O91T53554.CMP.xml  O91T53580.CMP.xml  O91T53613.CMP.xml  O91T53659.CMP.xml
O91T53315.CMP.xml  O91T53505.CMP.xml  O91T53555.CMP.xml  O91T53581.CMP.xml  O91T53620.CMP.xml  O91T53660.CMP.xml





/ we deden per ongeluk	,
PGPASSWORD=mpopostgres@mpo pg_restore -U mpopostgres -d mpo_2014_01_v2 mpo_2014_01_v2.dump
/ Misschien moeten we deze opnieuw	 voor MPO-84	,


/ 7	. 



./module/interfacing/src/java/interfacing-service.sb.xml
./module/interfacing/src/java/interfacing-jms.sb.xml

./module/interfacing/war/interfacing/interfacing-sitemap.xmap
./module/interfacing/war/interfacing/jsp/jms-message_entry.jsp

./module/interfacing/src/java/com/mpobjects/interfacing/jmsmessage/control/JMSMessageEntryAction.java
./module/interfacing/src/java/com/mpobjects/interfacing/jmsmessage/control/JMSMessageSendAction.java

./mpo/mpo.properties
./mpo/mpo-build-config.properties
./application.properties

/ 7	.

/ click op action send	,

/ in chrome debugger bij Network	,
/ we zien een bericht	,
http://localhost:8080/tms/interfacing/jms-message_send
/ we zien bij Request-Headers, 
Referer:http://localhost:8080/tms/interfacing/jms-message_entry?base_windowToOpenUrl=&base_windowToOpenTitle=&base_sessionLevelOffset=0&emptySession=true&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=0&randomizingurl=1426586114139

$ vi interfacing-sitemap.xmap

	<map:pipelines>
		<map:pipeline>
			<map:match pattern="jms-message_entry">
				<map:act type="jmsMessageEntry"/>
				<map:read mime-type="text/html" src="jsp/jms-message_entry.jsp" type="jsp"/>
			</map:match>


	<map:components>
		<map:actions>
			<map:action name="jmsMessageEntry" src="com.mpobjects.interfacing.jmsmessage.control.JMSMessageEntryAction"/>

/	 7. 


/ Einde 2015.01 MPO



/ DEPLOY JENKINS

/ voor pnloms op test	, 

$ forticlientsslvpn
...
[eric@localhost pnloms]$ pnl-test.bash 
h^Zgcyr&Q

/ of naar mposerv11	,


/ we deploy mpo op test	,


/ 7	.

/ In de 2014.01_mpo branch	, we maken instance mpo	,
[eric@localhost workspace]$ vi 2014.01_mpo/application.properties 

base.product = mpo

#build.war.dir = /home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/2014.01_${base.product}/deploy/tms.war/
#jboss.configuration = 2014.01_${base.product}

build.war.dir = /home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/${base.product}/deploy/tms.war/
jboss.configuration = ${base.product}

/ we hadden instance 2014.01_mpo genoemd, omdat we mpo wilden bewaren	,

/ we zien	,
[eric@localhost server]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server
[eric@localhost server]$ ls -ltr
...
drwxrwxr-x. 9 eric eric 4096 Mar  2 16:13 mpo

/ we moeten ook de server config aanpassen	,
Program arguments: -c mpo
Server configuration: mpo

/ 7	.

https://system.mp-objects.com/jenkins/

[eric@localhost server]$ svn ls https://system.mp-objects.com/svn/tms
branches/
patches/
trunk/
[eric@localhost server]$ svn ls https://system.mp-objects.com/svn/tms/patches
2014.01/
[eric@localhost server]$ svn ls https://system.mp-objects.com/svn/tms/patches/2014.01
mpo/



/ Quick links: SCS-OnDemand
https://system.mp-objects.com/jenkins/job/SCS-OnDemand/

/ Build with parameters
build product: mpo
build.revision: HEAD
build.svn.baseurl: /patches/2014.01/mpo 
/ Build 
/ we zien links een progress bar, met #2107	,

/ click in menu SCS-OnDemand
/ kies links de build #2107
https://system.mp-objects.com/jenkins/job/SCS-OnDemand/2107
/ We copy de link 'Build Artifacts', latest_tms-mpo-18542-2014.01_mpo-patch.zip	 met 'Copy link location'	, 
https://system.mp-objects.com/jenkins/job/SCS-OnDemand/2107/artifact/dist/latest_tms-mpo-18542-2014.01_mpo-patch.zip

[eric@localhost eclipse-jee-test]$ ssh mposerv11
password: mpo@2014
eric@mposerv11:~$ sudo su - jboss 
$ cd releases
boss@mposerv11:~/releases$ curl -u eric -O https://system.mp-objects.com/jenkins/job/SCS-OnDemand/2012/artifact/dist/latest_tms-pnloms-18345-trunk.zip
Enter host password for user 'eric': mpo@2014 
/ We paste de link hier	,

jboss@mposerv11:~/releases$ cd ../bin
jboss@mposerv11:~/bin$ mpo stop
boss@mposerv11:~/bin$ ./deploy-mpo.sh  /local/apps/releases/latest_tms-mpo-18542-2014.01_mpo-patch.zip /local/apps/jboss-4.0.5.GA/server/mpo
jboss@mposerv11:~/bin$ mpo start track

/ Einde DEPLOY JENKINS

/ DEPLOY

/ Op application-a kunnen we niet naar /tmp scp	, 
/ TODO
/ vanderveldene scp naar zijn home dir	,
/ vanderveldene kan 	,
[vanderveldene@application-a ~]$ cp hibernate3.6.10.mpo.1.jar /local/apps/jboss-4.0.5.GA/server/dsvcts/lib/
[vanderveldene@application-a ~]$ rm /local/apps/jboss-4.0.5.GA/server/dsvcts/lib/hibernate3.jar 

[vanderveldene@application-a ~]$ sudo su - jboss
/ voor deployment	,



/ Einde DEPLOY




/ INTERSTREAM

[eric@localhost ]$ forticlientsslvpn.bash 
HA65Fs8LTTCK
Password for VPN:

/ to acceptance db	,
[eric@localhost pnloms]$  PGPASSWORD=mpopostgres@mpo psql -U mpopostgres -h application-a.intermax.mp-objects.com pnloms
/ ERR

[eric@localhost pnloms]$ ssh vanderveldene@interstream-a.intermax.mp-objects.com
h^Zgcyr&Q
/ OK
[eric@localhost pnloms]$ ssh vanderveldene@application-a.intermax.mp-objects.com
h^Zgcyr&Q
/ OK
[eric@localhost pnloms]$ ssh vanderveldene@database-a.intermax.mp-objects.com
h^Zgcyr&Q
/ ERR 

[eric@localhost pnloms]$  PGPASSWORD='h^Zgcyr&Q'  psql -U vanderveldene -h pnl-app-a.intermax.mp-objects.com pnloms
psql (9.3.5)







/ Einde INTERSTREAM


/ MPO BUSINESS

/ DSVCTS

/ create shipment order	,
/ fill in verplichte velden	,
Organization: DSV-MHC 				/ al	,
Actual service level: 3				/ bijv	,
Inco term: DDP					/ bijv	,
/ Kies een Ship from , Ship to party	,
Save
/ set 
Shipment Type : Ftc
Number (Rerefence8): LAADSL
Save
/ Deze kunnen we vinden door	,
configuration, planning, path templates
Geef bij Organization: MHC
/ Kies de 1ste	, click Path templates	,
Daar zien we : 
Reference8: LAADSL
Shipment_type: FtC

/ We zien dat de sho planned is (status is 1450): onderaan zien we de sa's 	, 

/ click op een sa op een row in de consignment column,  bijv N1624502.1	,
/ we komen op een seo	, 
/ de status is 1450	, planned	, 
/ asl we actual start date geven, en save dan is status 8000 (started) 
/ asl we actual end date geven, en save dan is status 9000 (finished) 

/ als we dit voor alle 3 de seo's doen, wordt de sho ook 9000 (finished)	.


/ Einde MPO BUSINESS

/ DEPLOY JENKINS

/ deploy dsvtcs op acceptance	,

/ Build with parameters
build product: dsvcts
build.revision: HEAD
build.svn.baseurl: /branches/2015.01
/ Save
/ we zien links een progress bar, met #2214	,

/ click in menu SCS-OnDemand
/ kies links de build #2214	,
https://system.mp-objects.com/jenkins/job/SCS-OnDemand/2214/

[eric@localhost forticlientsslvpn]$ ./forticlientsslvpn 
/ window	,
Server: 80.95.170.62:443
User: vanderveldene
Password: HA65Fs8LTTCKxxxxxx 

[eric@localhost data]$ ~/bin/application-acceptance.bash 
h^Zgcyr&Q
Password: 

[vanderveldene@application-a ~]$ sudo su - jboss
[jboss@application-a ~]$ cd releases/
[jboss@application-a releases]$ curl -u eric -O https://system.mp-objects.com/jenkins/job/SCS-OnDemand/2214/artifact/dist/latest_tms-dsvcts-18791-2015.01.zip
Enter host password for user 'eric': mpo@2014/Eric123@MPO
/ WH passwo op jenkins	,
/ De url achter -O copy we van jenkins	,

[jboss@application-a releases]$ cd ../bin
[jboss@application-a bin]$ dsvcts stop
[jboss@application-a bin]$ deploy-dsvcts.sh /local/apps/releases/latest_tms-dsvcts-18791-2015.01.zip /local/apps/jboss-4.0.5.GA/server/dsvcts/ 
[jboss@application-a bin]$ dsvcts start track

/ DEPLOY JENKINS

/ deploy pnllogistics op test,



/ Build with parameters
build product: pnllogistics 
build.revision: HEAD
build.svn.baseurl: /trunk 
/ Save
/ we zien links een progress bar, met #2214	,

/ click in menu SCS-OnDemand
/ kies links de build #2214	,
https://system.mp-objects.com/jenkins/job/SCS-OnDemand/2214/

[eric@localhost forticlientsslvpn]$ ./forticlientsslvpn 
/ window	,
Server: 80.95.170.62:443
User: vanderveldene
Password: HA65Fs8LTTCKxxxxxx 

[eric@localhost data]$ pnl-ssh-t.sh 
h^Zgcyr&Q
Password: 

[vanderveldene@application-a ~]$ sudo su - jboss
[jboss@application-a ~]$ cd releases/
[jboss@application-a releases]$ curl -u eric -O https://system.mp-objects.com/jenkins/job/SCS-OnDemand/2214/artifact/dist/latest_tms-dsvcts-18791-2015.01.zip
Enter host password for user 'eric': mpo@2014/Eric123@MPO/Eric456@MPO
/ WH passwo op jenkins	,
/ De url achter -O copy we van jenkins	,

[jboss@application-a releases]$ cd ../bin
[jboss@application-a bin]$ dsvcts stop
[jboss@application-a bin]$ deploy-dsvcts.sh /local/apps/releases/latest_tms-dsvcts-18791-2015.01.zip /local/apps/jboss-4.0.5.GA/server/dsvcts/ 
[jboss@application-a bin]$ dsvcts start track

/ 7	. 

/ Soms moeten we nieuwe jar files opload	,

2015-07-29 13:11:07,541 INFO  [com.mpobjects.libcheck.LibCheckService] (main:) Checking jars in directory [/local/apps/jboss-4.0.5.G
A/server/pnllogistics/lib] for checksums in file [/local/apps/jboss-4.0.5.GA/server/pnllogistics/conf/library-checksum.properties]
2015-07-29 13:11:07,742 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)    MUST_BE_REMOVED : activeio-core-3.1.2.jar
2015-07-29 13:11:07,742 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : activeio-core-3.1.4.jar
2015-07-29 13:11:07,742 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : activemq-broker-5.10.2.jar
2015-07-29 13:11:07,742 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : activemq-client-5.10.2.jar
2015-07-29 13:11:07,742 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)    MUST_BE_REMOVED : activemq-core-5.3.0.jar
2015-07-29 13:11:07,742 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : activemq-kahadb-store-5.10.2.jar
2015-07-29 13:11:07,743 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : activemq-openwire-legacy-5.10.2.jar
2015-07-29 13:11:07,743 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)    MUST_BE_REMOVED : activemq-pool-5.3.0.jar
2015-07-29 13:11:07,743 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : activemq-protobuf-1.1.jar
2015-07-29 13:11:07,743 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)    MUST_BE_REMOVED : activemq-ra-5.3.0.jar
2015-07-29 13:11:07,743 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : activemq-spring-5.10.2.jar
2015-07-29 13:11:07,744 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : bcprov-jdk15on-1.52.jar
2015-07-29 13:11:07,744 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)    MUST_BE_REMOVED : bcprov-jdk16-1.46.jar
2015-07-29 13:11:07,747 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : commons-csv-1.1.jar
2015-07-29 13:11:07,750 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : hawtbuf-1.10.jar
2015-07-29 13:11:07,751 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : jackson-annotations-2.6.0.jar
2015-07-29 13:11:07,751 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : jackson-core-2.6.0.jar
2015-07-29 13:11:07,751 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : jackson-databind-2.6.0.jar
2015-07-29 13:11:07,761 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)    MUST_BE_REMOVED : wiquery-1.2.3.1-20150306.104916-1.jar
2015-07-29 13:11:07,761 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : wiquery-1.2.3.2-20150604.122120-1.jar

[jboss@pnl-app-a lib]$ rm activeio-core-3.1.2.jar activemq-core-5.3.0.jar activemq-pool-5.3.0.jar activemq-ra-5.3.0.jar bcprov-jdk16-1.46.jar wiquery-1.2.3.1-20150306.104916-1.jar 

/ Vanaf laptop	,
[eric@localhost lib]$ scp activeio-core-3.1.4.jar activemq-broker-5.10.2.jar activemq-client-5.10.2.jar  activemq-kahadb-store-5.10.2.jar activemq-openwire-legacy-5.10.2.jar activemq-protobuf-1.1.jar activemq-spring-5.10.2.jar bcprov-jdk15on-1.52.jar commons-csv-1.1.jar hawtbuf-1.10.jar  jackson-annotations-2.6.0.jar jackson-core-2.6.0.jar jackson-databind-2.6.0.jar wiquery-1.2.3.2-20150604.122120-1.jar vanderveldene@pnl-app-a.intermax.mp-objects.com:/tmp
/ en dan cp van /tmp naar /local/apps/jboss-4.0.5.GA/server/pnllogistics/lib	, als jboss	,
/ we zien verschillende permissions	, 
[jboss@pnl-app-a lib]$ ls -l
-rwxrwxr-x+ 1 jboss jboss   57398 Mar 30 16:07 activation.jar
-rw-rw-r--  1 jboss jboss  102578 Jul 29 13:36 activeio-core-3.1.4.jar
/ TODO

/ op laptop	,
[eric@localhost bin]$ cat pnl-scp-from-a.sh 
#!/bin/bash
echo 'h^Zgcyr&Q'
scp vanderveldene@pnl-app-a.intermax.mp-objects.com:/local/apps/jboss-4.0.5.GA/server/"$@" .

/ Hoe moeten we 	,
[eric@localhost bin]$ cat pnl-scp-to-a.sh 
#!/bin/bash
echo 'h^Zgcyr&Q'
scp "$@" vanderveldene@pnl-app-a.intermax.mp-objects.com:/local/apps/jboss-4.0.5.GA/server/"$@" .
/ TODO

/ 13	. 

/ geosco op mposerv11	, 

2015-08-04 13:00:57,666 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)    MUST_BE_REMOVED : activeio-core-3.1.2.jar
2015-08-04 13:00:57,666 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : activeio-core-3.1.4.jar
2015-08-04 13:00:57,667 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : activemq-broker-5.10.2.jar
2015-08-04 13:00:57,667 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : activemq-client-5.10.2.jar
2015-08-04 13:00:57,667 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)    MUST_BE_REMOVED : activemq-core-5.3.0.jar
2015-08-04 13:00:57,667 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : activemq-kahadb-store-5.10.2.jar
2015-08-04 13:00:57,667 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : activemq-openwire-legacy-5.10.2.jar
2015-08-04 13:00:57,667 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)    MUST_BE_REMOVED : activemq-pool-5.3.0.jar
2015-08-04 13:00:57,668 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : activemq-protobuf-1.1.jar
2015-08-04 13:00:57,668 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)    MUST_BE_REMOVED : activemq-ra-5.3.0.jar
2015-08-04 13:00:57,668 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : activemq-spring-5.10.2.jar
2015-08-04 13:00:57,671 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : bcprov-jdk15on-1.52.jar
2015-08-04 13:00:57,671 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)    MUST_BE_REMOVED : bcprov-jdk16-1.46.jar
2015-08-04 13:00:57,680 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : commons-csv-1.1.jar
2015-08-04 13:00:57,689 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : hawtbuf-1.10.jar
2015-08-04 13:00:57,692 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : jackson-annotations-2.6.0.jar
2015-08-04 13:00:57,692 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : jackson-core-2.6.0.jar
2015-08-04 13:00:57,692 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : jackson-databind-2.6.0.jar
2015-08-04 13:00:57,717 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)    MUST_BE_REMOVED : wiquery-1.2.3.1-20150306.104916-1.jar
2015-08-04 13:00:57,718 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : wiquery-1.2.3.2-20150604.122120-1.jar

/ jboss doet op mposerv11	,
jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/geosco/lib$  rm activeio-core-3.1.2.jar activemq-core-5.3.0.jar activemq-pool-5.3.0.jar activemq-ra-5.3.0.jar bcprov-jdk16-1.46.jar wiquery-1.2.3.1-20150306.104916-1.jar

/ laptop, cargo inst,	 
[eric@localhost lib]$ scp activeio-core-3.1.4.jar activemq-broker-5.10.2.jar activemq-client-5.10.2.jar  activemq-kahadb-store-5.10.2.jar activemq-openwire-legacy-5.10.2.jar activemq-protobuf-1.1.jar activemq-spring-5.10.2.jar bcprov-jdk15on-1.52.jar commons-csv-1.1.jar hawtbuf-1.10.jar  jackson-annotations-2.6.0.jar jackson-core-2.6.0.jar jackson-databind-2.6.0.jar wiquery-1.2.3.2-20150604.122120-1.jar eric@mposerv11:
eric@mposerv11's password: 
activeio-core-3.1.4.jar                                                                             100%  100KB 100.2KB/s   00:00    
activemq-broker-5.10.2.jar                                                                          100% 1013KB   1.0MB/s   00:00    
activemq-client-5.10.2.jar                                                                          100% 1151KB   1.1MB/s   00:00    
activemq-kahadb-store-5.10.2.jar                                                                    100%  535KB 534.6KB/s   00:00    
activemq-openwire-legacy-5.10.2.jar                                                                 100%  669KB 669.4KB/s   00:00    
activemq-protobuf-1.1.jar                                                                           100%  144KB 144.4KB/s   00:00    
activemq-spring-5.10.2.jar                                                                          100%  159KB 159.0KB/s   00:01    
bcprov-jdk15on-1.52.jar                                                                             100% 2835KB   2.8MB/s   00:00    
commons-csv-1.1.jar                                                                                 100%   36KB  36.0KB/s   00:00    
hawtbuf-1.10.jar                                                                                    100%   49KB  49.0KB/s   00:00    
jackson-annotations-2.6.0.jar                                                                       100%   46KB  45.9KB/s   00:00    
jackson-core-2.6.0.jar                                                                              100%  253KB 252.8KB/s   00:00    
jackson-databind-2.6.0.jar                                                                          100% 1134KB   1.1MB/s   00:00    
wiquery-1.2.3.2-20150604.122120-1.jar                                                               100% 1692KB   1.7MB/s   00:00    

/ en dan op mposerv11	,
eric@mposerv11:~$ ls
activeio-core-3.1.4.jar           activemq-openwire-legacy-5.10.2.jar  commons-csv-1.1.jar            jackson-databind-2.6.0.jar
activemq-broker-5.10.2.jar        activemq-protobuf-1.1.jar            hawtbuf-1.10.jar               wiquery-1.2.3.2-20150604.122120-1.jar
activemq-client-5.10.2.jar        activemq-spring-5.10.2.jar           jackson-annotations-2.6.0.jar
activemq-kahadb-store-5.10.2.jar  bcprov-jdk15on-1.52.jar              jackson-core-2.6.0.jar

jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/geosco/lib$ pwd
/local/apps/jboss-4.0.5.GA/server/geosco/lib
jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/geosco/lib$ cp  /home/INTERNAL/eric/*.jar .






/ DEPLOY JENKINS

/ pnloms op test	, 

https://system.mp-objects.com/jenkins/

/ Quick links: SCS-OnDemand
https://system.mp-objects.com/jenkins/job/SCS-OnDemand/

/ Build with parameters
build product: pnloms
build.revision: HEAD
build.svn.baseurl: /trunk
/ Save
/ we zien links een progress bar, met #2012	,

/ click in menu SCS-OnDemand
/ kies links de build #2012	,
https://system.mp-objects.com/jenkins/job/SCS-OnDemand/2012/

[eric@localhost eclipse-jee-test]$ ssh mposerv11
eric@mposerv11:~$ sudo su - jboss 
$ cd releases
boss@mposerv11:~/releases$ curl -u eric -O https://system.mp-objects.com/jenkins/job/SCS-OnDemand/2012/artifact/dist/latest_tms-pnloms-18345-trunk.zip
Enter host password for user 'eric': 

jboss@mposerv11:~/releases$ cd ../bin
jboss@mposerv11:~/bin$ pnloms stop
jboss@mposerv11:~/bin$ ./deploy-pnloms.sh /local/apps/releases/latest_tms-pnloms-18345-trunk.zip /local/apps/jboss-4.0.5.GA/server/pnloms/
jboss@mposerv11:~/bin$ pnloms start track

/ we moeten 1 keer	,
[eric@localhost lib]$ scp postgresql-9.4-1200.jdbc4.jar jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/pnloms/lib
jboss@mposerv11's password: jboss@mpo

jboss@mposerv11:~/bin$ pnloms stop
jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/pnloms/lib$ rm postgresql-9.2-1003.jdbc4.jar
jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/pnloms/lib$ pnloms start track
/ Einde 1 keer	,

/ Check of alle jars er zijn	,

/ 1ste mog	,
jboss@mposerv11:~/bin$ pnloms track
ctrl-c
:?
...
2015-02-26 16:02:39,138 INFO  [com.mpobjects.libcheck.LibCheckService] (main:)                 OK : xstream-1.3.1.jar
2015-02-26 16:02:39,138 INFO  [com.mpobjects.libcheck.LibCheckService] (main:) Summary:         CHECKSUM_MISMATCH=0     MISSING=0       MUST_BE_REMOVED=0       OK=270
/ OK

/ 2de mog	,

/ Via web jconsole van jboss	,

/ check of port 9280  pnloms is	,
Geef
http://192.168.1.11:9280/pnloms
/ OK

/ Geef	,
http://192.168.1.11:9280/
/ kies JMX console

/ search libcheck	,
Mpo objects
service=LibCheckService
/ we komen op	,
http://192.168.1.11:9280/jmx-console/HtmlAdaptor?action=inspectMBean&name=mpobjects%3Aservice%3DLibCheckService

/ beneden	,
java.lang.String checkLibraries()
MBean Operation.
/ click invoke	, 
/ we zien list	en	,
		...
               OK : xstream-1.3.1.jar
Summary: 	CHECKSUM_MISMATCH=0	MISSING=0	MUST_BE_REMOVED=0	OK=270
Library checking complete


/ Einde DEPLOY JENKINS

/ DEPLOY JENKINS

https://test-pnl.mp-objects.com/pnllogistics/core/index_frameset

/ we hebben pnl-test.bash create	,

/ Einde DEPLOY JENKINS


/ FIREBIRD

/ 7	. 


/ docs	,

/ firebird	,
http://www.firebirdsql.org/en/reference-manuals/
/ kies	,
http://www.firebirdsql.org/file/documentation/reference_manuals/reference_material/html/langrefupd25.html
/ kies	Table	, onder 6	,
/ we zien alle changes	, alle versies	,

/ isql-fb	,
http://www.firebirdsql.org/manual/isql.html

/ 7	. 

/ we kunnen soms niet zomaar een table rm, als er een view op is of een index op is	, deze moeten we dan eerst rm	,

SQL> create table x(i int not null);
SQL> create view vx as select *from x;
SQL> create unique index dxi on x(i);
SQL> insert into x values(7);
SQL> insert into x values(7);
Statement failed, SQLSTATE = 23000
attempt to store duplicate value (visible to active transactions) in unique index "DXI"
SQL> insert into x values(13);

SQL> show table x;
I                               INTEGER Not Null 
SQL> show indices;
DXI UNIQUE INDEX ON X(I) 
RDB$FOREIGN4 INDEX ON XREF(I) 
RDB$PRIMARY1 UNIQUE INDEX ON YI(I) 
Z_INDEX UNIQUE INDEX ON Z(S) 
SQL> show index dxi;
DXI UNIQUE INDEX ON X(I) 
SQL> show view vx;
I                               INTEGER Not Null 
View Source:
==== ======
 select *from x

SQL> drop table x;
Statement failed, SQLSTATE = 42000
unsuccessful metadata update
-cannot delete
-COLUMN X.I
-there are 1 dependencies
SQL> drop view vx;
SQL> drop index dxi;
SQL> drop table x;
Statement failed, SQLSTATE = 42000
unsuccessful metadata update
-object X is in use
SQL> delete from x;
SQL> drop table x;
Statement failed, SQLSTATE = 42000
unsuccessful metadata update
-object X is in use
SQL> select*from x;
SQL> insert into x values(7);
SQL> commit;
SQL> drop table x;

/ Als we een table drop, zijn de grants ook weg,  dus die hoeven we niet eerst de rm	,

/ 7	. 

SQL> create table x(i int);
SQL> select*from x;
SQL> drop table x;
Statement failed, SQLSTATE = 42000
unsuccessful metadata update
-object X is in use
SQL> commit;
SQL> drop table x;

SQL> drop table x;
SQL> create table x(i int);
SQL> insert into x values(7);
SQL>  drop table x;
Statement failed, SQLSTATE = 42000
unsuccessful metadata update
-object X is in use
SQL> commit;
SQL>  drop table x;

/ als we een table create	, en we willen hem drop, maar ertussen door doen we iets, een select, of een insert, dan moeten we eerst commit, voordat we kunnen drop	,
/ TODO







/ Einde FIREBIRD

/ Einde DSVMHC-43

/ ECLIPSE 

/ bij merge conflict	, als je de remote file wilt, en die van jezelf niet	, 
/right click file en kies 'Override and Update'	,


/ Einde ECLIPSE 

/ PNL-313 TODOS

/ planning, shipment order, mass update heeft geen title
/ Voeg markup code toe aan ShipmentOrderMassUpdatePage.html	,
/ see QueryViewPanel.getTitle	,

approveRejectPanel.setTitle("Approve/reject");
/ TODO (werkt niet)

/ EntityActionGroupEditPage sets geen title	,

		final AjaxButton addActionButton = new AjaxButton("addButton", new StringResourceModel("add", actionGroupModel)) {
/ StringResourceModel-> ResourceModel	,






/ Einde PNL-313 TODOS

/ FIX PNL-313 PNL-314

/ 13	. 

/ Planning, Shipment order, Mass update dashboard
/ In EntityActionGroupListPage.html
/ OK

/ we edit een action group	,
EntityActionGroupEditPage.html	,
wicket:extend>
	<div wicket:id="feedback"></div>	
	<div wicket:id="editPanel"></div>
</wicket:extend>

/ 13	. 

/ wat is EntityEditActionPanel.html/


/ 13	. 
/ Configuration, Master data, Schedules
ScheduleListPage.html

/ we zien	,
<body wicket:id="pageId" id="ScheduleListPage" class=" xMenu">
/ See BasePage.java	,
...
	<wicket:enclosure child="tableTitle"
		<div wicket:id="tableTitle">Schedule</div>
/ See ScheduleListPage.java	,





/ Einde FIX PNL-313 PNL-314





/ POSTGRESQL DATE TIMESTAMP

foo=> create table xd(d date);
CREATE TABLE
foo=> create table xt(t timestamp);
CREATE TABLE
foo=> insert into xt select now();
INSERT 0 1
foo=> select*from xt;
             t              
----------------------------
 2015-01-19 08:34:02.440151
(1 row)

foo=> insert into xd select now();
foo=> select*from xd;
     d      
------------
 2015-01-19
(1 row)

/ TODO (isodate , met T)


/ Einde POSTGRESQL DATE TIMESTAMP

/ POSTGRESQL UPDATE WITH JOIN 

foo=> create table xi(i int);

foo=> create table yref(s text,r int references xi(i));
ERROR:  there is no unique constraint matching given keys for referenced table "xi"

/ Klopt	,  we moeten een orimary key add  aan col i	,
foo=>  alter table xi add primary key (i);

foo=> create table yref(s text,r int references xi(i));
/ Nu OK	,

/ TODO (Hoe lezen alter table help)	,

/ we keren pk en fk om	,

foo=> drop table yref;create table yi(i int primary key);
foo=> drop table xi;create table xref(i int references yi(i),s text);
foo=> insert into yi values(7),(13);
foo=> insert into xref values(7,'foo'),(13,'bar');
foo=> alter table yi add column s text;

foo=> create table yref(i int,s text);
foo=> insert into yref values(7,'foo'),(13,'bar');


=> select yi.*from yi join xref on yi.i=xref.i and xref.s='foo';
 i | s  
---+----
 7 | 
(1 row)

/ 13	. 

update yi
set i=yi.i+1
from  xref 
where yi.i=xref.i
and xref.s='foo'
/ NB. set i=yi.i+1	, anders ambiguous column i	,
/ ERR 
/ vanwege fk constraint	,

update yi
set s='OK' 
from  xref 
where yi.i=xref.i
and xref.s='foo'
/ OK

foo=> select*from yi;
 i  | s  
----+----
 13 | 
  7 | OK
(2 rows)
foo=> select*from xref;
 i  |  s  
----+-----
  7 | foo
 13 | bar
(2 rows)

update yi
set s='OK' 
from  xref 
where yi.i=xref.i
and xref.s='foo'
/ OK

update yi
set s='OK' 
from  xref,yref
where yi.i=xref.i
and yi.i=yref.i
and xref.s='foo'
and yref.s='foo'
/ OK

update yi
set s='OK' 
from  xref,yref 
where yi.i=xref.i
and yi.i=yref.i
and xref.s='foo'
and yref.s='foo'
/ OK

update yi
set s='OK' 
from  xref cross join yref 
where yi.i=xref.i
and yi.i=yref.i
and xref.s='foo'
and yref.s='foo'
/ OK

update yi
set s='OK' 
from  xref 
where yi.i=xref.i
inner join yref on yi.i=yref.i
and xref.s='foo'
and yref.s='foo'
/ TODO

/ MORGEN HIER HIER HIER


update yi
set s='OK' 
from yi a 
join xref on a.i=xref.i
where xref.s='foo'
UPDATE 2
/ TODO
/ MORGEN


/ In MySQL	,
update yi 
join xref on yi.i=xref.i 
set yi.s='OK' 
where xref.s='foo';
/ OK

update x 
set s='OK' 
from r,r2 
where x.i=r.i
and x.i=r2.i
and r.s='foo'
and r2.s='foo'
/ PostgreSQL OK

update x 
set s='OK' 
from x x_ join r 
on x_.i=r.i
join r2
on x_.i=r2.i
where r.s='foo'
and r2.s='foo'
/ PostgreSQL ERR	, 2 rows updated	,
/ Net als	,
update x 
set s='OK' 
from r 
/ PostgreSQL , 2 rows updated	,





/ 13	. 

/ MySQL, PostgreSQL	,
drop table if exists x,r,r2;
create table x(i int primary key,s text);
create table r(i int references x(i),s text);
create table r2(i int references x(i),s text);
insert into x(i)values(7),(13);
insert into r values(7,'foo'),(13,'bar');
insert into r2 values(7,'foo'),(13,'bar');

update x 
join r on x.i=r.i 
join r2 on x.i=r2.i 
set x.s='OK' 
where r.s='foo'
and r2.s='foo';
/ MySQL OK




/ Einde POSTGRESQL UPDATE WITH JOIN 

/ POSTGRESQL

select*
from  yi,xref,yref 
where yi.i=xref.i
and yi.i=yref.i
and xref.s='foo'
and yref.s='foo'
i | s  | i |  s  | i |  s  
---+----+---+-----+---+-----
 7 | OK | 7 | foo | 7 | foo

select*
from  yi 
join xref on yi.i=xref.i
join yref on yi.i=yref.i
and xref.s='foo'
and yref.s='foo'
i | s  | i |  s  | i |  s  
---+----+---+-----+---+-----
 7 | OK | 7 | foo | 7 | foo




/ Einde POSTGRESQL

/ FIREBIRD UPDATE WITH JOIN 


[eric@localhost Firebird]$ pwd
/home/eric/Devel/Firebird
[eric@localhost Firebird]$ isql-fb -user sysdba -password masterkey first.fdb

/ 7	.

SQL> create table yi(i int primary key);
SQL> drop table xref; create table xref(i int references yi(i) ,s varchar(32));
SQL> alter table yi add s varchar(32);
SQL> insert into yi(i) values(7);
SQL> insert into yi(i) values(13);
SQL> insert into xref values(7,'foo');
SQL> insert into xref values(13,'bar');

/ we hoeven de column name i niet te geven omdat dat de pk is in yi	,,
SQL> drop table xref; create table xref(i int references yi ,s varchar(32));

/ in alter table	, we moeten niet add column doen als in postgres,	maar add	,

/ we kunnen niet zoals in postgres	values(7),(13)	, maar alleen values(7) , dus moeten 2 insert stmts maken	,



/ Einde FIREBIRD UPDATE WITH JOIN 

/ POSTGRESQL MYSQL

/ In beide	,
create table x(i int);
insert into x values(7),(13);

/ 7	.

/ Dit ERR in MySQL	,

MariaDB [test]> update x set i=i+1 where i=(select i from x where i>10);
/ of	,
MariaDB [test]> update x set i=i+1 where i=(select max(i) from x);
ERROR 1093 (HY000): You can't specify target table 'x' for update in FROM clause

/ Dit OK in PostgreSQL	,

foo=> update x set i=i+1 where i=(select i from x where i>10);
/ of	,
foo=> update x set i=i+1 where i=(select max(i) from x);
UPDATE 1
foo=> select i from x where i>10;
 i  
----
 14
(1 row)

/ 7	. 

/ lees	 ,
http://stackoverflow.com/questions/20565999/mysql-max-strict-mode
/ See laatste item	,

/ Lees	,
http://stackoverflow.com/questions/45494/mysql-error-1093-cant-specify-target-table-for-update-in-from-clause/947417#947417

/ Oplossing in MySQL	,
MariaDB [test]> update x set i=i+1 where i=(select * from (select i from x where i>10)as x_);
/ of	,
MariaDB [test]> update x set i=i+1 where i=(select * from (select max(i) from x)as x_);
Query OK, 1 row affected (0.05 sec)
Rows matched: 1  Changed: 1  Warnings: 0

/ Let op : select * from x_, NIET select i from x_	, want 	,
MariaDB [test]> select * from (select max(i) from x)as x_;
+--------+
| max(i) |
+--------+
|     20 |
+--------+
1 row in set (0.00 sec)


MariaDB [test]> select*from x;
+------+
| i    |
+------+
|    7 |
|   14 |





/ Einde POSTGRESQL MYSQL

/ CLICK ON FILTER 


/ s
PrefilteredTableDataProvider(GenericTableDataProvider).iterator(int, int) line: 226	
		} else {
			return daoWrapper.getBean().runQuery(queryParam, filter).iterator();
/s
/ in GenericHibernateDAO.java
	@Override
	public List<Type> runQuery(final QueryParam queryParam, final DAOFilterExpression<Type> filter) {
		Map<String, DetachedCriteria> mySubMap = new HashMap<String, DetachedCriteria>();
		DetachedCriteria myDetachedCriteria = prepareCriteria(filter.getLegacyFilter(), mySubMap);
		createCriteria(myDetachedCriteria, filter, mySubMap);
		addSortOrderToQuery(myDetachedCriteria, mySubMap, queryParam.getSort(), queryParam.isSortAsc());
		List<Type> myList = getHibernateTemplate().findByCriteria(myDetachedCriteria, queryParam.getFirst(), queryParam.getCount());

/ myDetachedCriteria =
DetachableCriteria(CriteriaImpl(com.mpobjects.invoice.model.invoicetemplate.InvoiceTemplateMapping:this[Subcriteria(organization:)][]))
/ see	,
$ vi InvoiceTemplateMapping.standard.hbm.xml 
<hibernate-mapping>
	<class name="com.mpobjects.invoice.model.invoicetemplate.InvoiceTemplateMapping" table="SIN_INVOICE_TEMPLATE_MAPPING">

/ we zien	,
select * 
from SIN_INVOICE_TEMPLATE_MAPPING this_ 
inner join ORGANIZATION organizati1_ on this_.ORGANIZATION_SYSTEMID=organizati1_.SYSTEM_ID 
left outer join ORGANIZATION organizati4_ on organizati1_.ORGANIZATION_GROUP=organizati4_.SYSTEM_ID 
left outer join PARTY_GROUP partygroup5_ on this_.RECEIVER_GROUP_SYSTEMID=partygroup5_.SYSTEM_ID 
left outer join ORGANIZATION organizati6_ on partygroup5_.ORGANIZATION_SYSTEMID=organizati6_.SYSTEM_ID 
left outer join RATE_COMPONENT_TYPE ratecompon7_ on this_.RATE_COMPONENT_TYPE_SYSTEMID=ratecompon7_.SYSTEM_ID 
order by organizati1_.ORGANIZATION_ID asc limit 16 

/ deze verschijnt telkens als we de filter button click	,
/ dus query niet in 2c	,


/ Einde CLICK ON FILTER 

/ ISB-729

/ Ga naar	,
https://acceptance.scs.mp-objects.com/isbscs/core/index_frameset

/ Ga naar inv-9	, deze is SELF-BILL, INITIAL
/ Deze is linked aan een seo	, N0000317	,
/ Daar zijn die price parts invoiced	,
/ we remove een detail, price part	, Bunker	,
/ onder invoice line, save
/ onder invoice header, save and close	, 



/ Kies een initial carrier invoice, inv-2
/ click edit mode	, 
/ we zien een invoice line	, met 1 detail	,
/ click 'Create mode: new page'	,
/ we add een detail	,

/ Raghu hoe in een seo price parts add	, 

/ 7	. 




/ Einde ISB-729


/ ISB-780

/ ga naar finance, carrier invoice, search	,
/ click edit button op een entry	,
/ we komen in	,
$ vi InvoiceHeaderFormAction.java

	public Map act() throws java.lang.Exception {

		} else {
			// myVO = InvoiceHeaderUtil.getDAO().getInitializedSurchargesBySystemId(getSystemIdFromRequest());
			myVO = InvoiceHeaderUtil.getDAO().getBySystemId(mySystemId);


/ Als we Save click	,
$ vi InvoiceHeadeSaveAction.java
	public void handleSave() throws Exception {
		InvoiceHeaderVO myVO = (InvoiceHeaderVO) getValueObject();
/ Dit is deze van hierboven	, 
/ heeft PersistentSet's, H. proxy's	,
/ Is WH aangepast met edits uit het form	,
/ TODO
/ we zien de act method in superclass 	,
public abstract class AbstractSaveAction extends AbstractAction implements NonScreenAction {
	public final Map act() throws Exception {
...
		} else {
...
			handleSave();

/ Einde RM



/ Einde ISB-780


/ APPLICATIONS

/ lees	,
https://system.mp-objects.com/xwiki/bin/view/CodeCon/CodeStyle

/ we install codestyle-1.3.xml in eclipse onder	,
Java, Code style, formatter

/ we install ook de checkstyle plugin in eclipse via marketplace	, en config deze zodat hij external leest 
[eric@localhost trunk]$ ls base-framework/buildscripts/checkstyle/mpo-checks.xml 
/ external, want hij leest deze file nu altijd, in elk project	,
/ we hebben deze als default ingesteld	,
/ er is ook een ant task checkstyle, die kijkt naar base-framework/buildscripts/checkstyle/mpo-checks.xml in het project waarin je dan bent	,

/ dan is er een e-mail van Michiel	,
/ Zoek in eclipse in window, preferences naar sort
Java, Appearance, Members Sort Order	,
/ Zoek in eclipse in window, preferences naar save
Java, Editor, Save actions
/ click configure, en loop al de tabs af	, de samenvatting van alle added rules verschijnt op de Java, Editor, Save actions	,

 






/ Einde APPLICATIONS

/ MPO WICKET

/ Kijk later in UserCrudEditPanel	, 

/ Einde MPO WICKET

/ MPO

/ MPOFS1/business	,
/ Doc	,

/ Einde MPO

/ MPO-33

/ See   ,
https://acceptance.scs.mp-objects.com/mpo/core/index_frameset





/ Einde MPO-33

/ SCS-728

$ vi Work.hbm.xml

	<set
 		name="employees"
 		inverse="true"
  		lazy="true"
		cascade="save-update,delete"
 	>

$ vi Employee.hbm.xml

	<many-to-one 
		name="work"
		column="work_"
		not-null="true/false"
		lazy="proxy"

	/>


$ vi ISBApp.java

/ new session	,
		  	for(int i=1;i<=WORKSIZ;i++){
				Work work=new Work((long)i,"WorkStreet "+i, i+" Work", "WorkCity"+i);
				session.save(work);
				for(int j=1;j<=EMPLSIZ;j++){
					int k=10*i+j;
					int l=100+k;
					Employee employee=new Employee((long)k,"Foo"+k,(double)k);
					work.getEmployees().add(employee);
					employee.setWork(work);
//					session.save(employee);

/ new session	,

			session.delete(work);

/ Als we de cont save	, save we ook de elems uit de set	,

/ Als we de cont delete, delete we ook de elems uit de set	,
/ als we NIET cascade="...,delete"	, dan door session.delete(work) gaat H. alleen de work_isb tbl delete, maar dan krijgen we fk constraint errors	 in de employee_isb tbl, deze heeft NIETS te maken met of de fk not-null is of niet	, je verandert de fk niet, alleen je rm waar de fk naar wijst, en dat mag niet	,
//////////////////////////////


/ coll, in andere session rm 1 item	, maar toch OK
/ TODO


/ Einde SCS-728

/ MPO SHIPMENTITEM SHIPMENTORDER

/ er is	,
file:///home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/module/oms/src/java/com/mpobjects/oms/model/shipmentorder/vo/ShipmentItemVO.java 

file:///home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/module/oms/src/java/com/mpobjects/oms/model/shipmentorder/dao/ShipmentItem.standard.hbm.xml 

	<class name="com.mpobjects.oms.model.shipmentorder.vo.ShipmentItemVO"
		discriminator-value="SHIPMENT_ITEM"
		table="SHIPMENT_ITEM">




/ Einde MPO SHIPMENTITEM SHIPMENTORDER

/ PERFORMANCE 

/ mposrv13	,

[eric@localhost wicket-in-action-1.0]$ ssh eric@mposerv13
rtdMpo45
eric@mposerv13:/local/apps/releases$ pwd
/local/apps/releases

eric@mposerv13:/local/apps/jboss-4.0.5.GA/server$ pwd
/local/apps/jboss-4.0.5.GA/server
eric@mposerv13:/local/apps/jboss-4.0.5.GA/server$ ls
mposcs
/ er moet pnl erbij komen	,
$ sudo su - jboss
$ mkdir pnloms

/ op mposerv11	,
$ scp -r deploy paul@mposerv13
$ scp -r lib paul@mposerv13
$ scp -r conf paul@mposerv13
$ scp -r run.conf paul@mposerv13	, perm gen, heap size	,

/ op mposerv13	, naar jboss/	,

$ sudo chown jboss  
$ sudo chgrp jboss  

eric@mposerv13:/local/apps/jboss-4.0.5.GA/server/pnloms$ pwd
/local/apps/jboss-4.0.5.GA/server/pnloms
eric@mposerv13:/local/apps/jboss-4.0.5.GA/server/pnloms$ ls
conf  deploy  lib  run.conf

/ omdat je jboss bent	,
$ ln -s /usr/bin/mpo-jboss pnloms
jboss@mposerv13:~/bin$ pwd
/home/jboss/bin
jboss@mposerv13:~/bin$ ls
cleanup.sh  deploy-mposcs.sh  interface-cleanup.sh  mposcs  pnloms
/ we zien pnloms erbij	,
$ ls -l
lrwxrwxrwx 1 jboss jboss   18 Nov 17 14:21 pnloms -> /usr/bin/mpo-jboss

/ in home dir van jboss	,
jboss@mposerv13:~$ ln -s /local/apps/jboss-4.0.5.GA/server/pnloms/ pnloms
jboss@mposerv13:~$ ls
bin  mposcs  pnloms  releases


jboss@mposerv13:~/pnloms$ pwd
/home/jboss/pnloms
jboss@mposerv13:~/pnloms$ pwd -P
/local/apps/jboss-4.0.5.GA/server/pnloms
$ cd conf
jboss@mposerv13:~/pnloms/conf$ ls
application.properties     ...
$ vi application.properties
...
$ vi local_application.properties
module.interfacing.jms.server.url=tcp\://jms-test\:61616
module.interfacing.jms.pnloms.queue=MPOBJECTS.TO.PNLOMS_HVP
module.customerinvoice.jms.queue=CUSTOMER_INVOICE_HVP.QUEUE_HVP
module.interfacing.jms.event.queue=PNLOMS_HVP.LOGISTICSORDEREVENTS
module.interfacing.jms.shipmentorder.queue=PNLOMS_HVP.SHIPMENTORDERS
module.interfacing.jms.pnloms.queue=MPOBJECTS.TO.PNLOMS_HVP

/ op eigen laptop	,
[eric@localhost Backup]$ pg_dump -U eric -Fc -h mposerv8 pnloms -f pnloms.dump
[eric@localhost Backup]$ scp pnloms.2.dump eric@mposerv13:
/ vergeet : niet	, gaat naar  home dir op mposerv13	,  

/ op mposerv13	, pnloms user, pnloms password	,


eric@mposerv13:~$ pg_restore -U pnloms -d pnloms pnloms.dump -h localhost
/ op mposerv13 moeten we -h localhost geven	,

eric@mposerv13:~$ psql -U pnloms pnloms -h localhost
/ Ook hier -h localhost	,
 
jboss@mposerv13:~/pnloms$ pnloms start
jboss@mposerv13:~/pnloms$ pnloms track
/ bekijk log	,

/ op mposerv11	,
jboss@mposerv11:/local/apps/jboss-shared$ scp mpo-server-bindings.xml eric@mposerv13:

/ op mposerv13	,
jboss@mposerv13:/local/apps/jboss-shared$ cp /home/INTERNAL/eric/mpo-server-bindings.xml .
jboss@mposerv13:/local/apps/jboss-shared$ ls -l
total 88
-rw-rw-r-- 1 jboss jboss 86417 Nov 17 17:02 mpo-server-bindings.xml
jboss@mposerv13:/local/apps/jboss-shared$ pnloms restart
NOTICE : Sending SIGTERM to JBoss instance pnloms; PID=9839 ...
...
NOTICE : JBoss instance pnloms has been stopped
NOTICE : Cleaning server directory (lite): /local/apps/jboss-4.0.5.GA/server/pnloms/[work|tmp]
NOTICE : Starting JBoss server instance: pnloms
NOTICE : Server output logged in /local/apps/jboss-4.0.5.GA/server/pnloms/log/stderr.log
..
NOTICE : JBoss server instance pnloms started; PID=11002

/ 7	.

eric@mposerv13:~$ su - jboss
Password:jboss@mpo
jboss@mposerv13:~$ sudo -u postgres psql
psql (9.3.5)
Type "help" for help.

postgres=# \l
                                  List of databases
   Name    |  Owner   | Encoding |   Collate   |    Ctype    |   Access privileges   
-----------+----------+----------+-------------+-------------+-----------------------
 mposcs    | mposcs   | UTF8     | en_US.UTF-8 | en_US.UTF-8 | 
 pnloms    | pnloms   | UTF8     | en_US.UTF-8 | en_US.UTF-8 | 
 postgres  | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | 
 template0 | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres          +
           |          |          |             |             | postgres=CTc/postgres
 template1 | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | postgres=CTc/postgres+
           |          |          |             |             | =c/postgres
(5 rows)

postgres=# \dg
                                   List of roles
 Role name |                   Attributes                   |       Member of       
-----------+------------------------------------------------+-----------------------
 admin     | Cannot login                                   | {}
 eric      | Superuser                                     +| {admin}
           | Password valid until infinity                  | 
 michielh  | Superuser, Create role, Create DB, Replication | {admin}
 mposcs    | Password valid until infinity                  | {}
 paul      | Superuser                                     +| {admin}
           | Password valid until infinity                  | 
 pnloms    | Password valid until infinity                  | {admin,reader,writer}
 postgres  | Superuser, Create role, Create DB, Replication | {}
 reader    | Cannot login                                   | {}
 writer    | Cannot login                                   | {}


postgres=# \q

/ Als we,	
jboss@mposerv13:~$ sudo -u postgres  psql -h localhost
Password: 
/ WH niet via unix domain socket,
/ TODO

jboss@mposerv13:~$ psql -U pnloms  -h localhost
Password for user pnloms: 
psql (9.3.5)
SSL connection (cipher: DHE-RSA-AES256-SHA, bits: 256)
Type "help" for help.

pnloms=> \q

/ Nu moeten we -h localhost, omdat we via tcp/ip socket, niet via unix domain socket	,	
jboss@mposerv13:~$ psql -U pnloms 
psql: FATAL:  no pg_hba.conf entry for host "[local]", user "pnloms", database "pnloms", SSL off
/ TODO

jboss@mposerv13:~$ psql -U eric  -h localhost
Password for user eric: 
/ Kan niet	, 
/ TODO
/ Wel vanuit mijn laptop	,
[eric@localhost Selenium]$ psql -h mposerv13 pnloms
/ of	,
[eric@localhost Selenium]$ psql -U eric -h mposerv13 pnloms
Password:rtdMpo45
psql (9.3.5)
SSL connection (cipher: DHE-RSA-AES256-SHA, bits: 256)
Type "help" for help.

pnloms=# 
/ Via ldap	, in 
jboss@mposerv13:~$ less /etc/postgresql/9.3/main/pg_hba.conf 
host    all             all             0.0.0.0/32		dap, ... 

/ TODO


/ 7	.

/ Lees LOG_2_jun_2014.txt over create role	,

/ we oef op local postgres	,

foo=> create role sas login;
CREATE ROLE
/ kan niet login	,
foo=> alter role sas password 'sas';
ALTER ROLE
/ kan nu wel login	,
foo=>  \dg
                              List of roles
  Role name  |                   Attributes                   | Member of 
-------------+------------------------------------------------+-----------
 bar         | Create role, Create DB                         | {}
 baz         | Create DB                                      | {}
 eric        | Create DB                                      | {}
 foo         | Create role, Create DB                         | {}
 grp         | Create role, Create DB, Cannot login           | {}
 mpopostgres | Superuser, Create DB                           | {}
 postgres    | Superuser, Create role, Create DB, Replication | {}
 sas         |                                                | {}
 usr         |                                                | {grp}

foo=> alter role sas createrole createdb;
ALTER ROLE
foo=> \dg
                              List of roles
  Role name  |                   Attributes                   | Member of 
-------------+------------------------------------------------+-----------
 sas         | Create role, Create DB                         | {}
...

foo=> drop role sas;
DROP ROLE

/ 7	.



/ Einde PERFORMANCE 

/ OPEN IN CHROME

http://embarcaderos.net/2011/01/23/parallel-processing-and-multi-core-utilization-with-java/

http://tech.puredanger.com/2009/07/10/hibernate-query-cache/
https://docs.oracle.com/javase/tutorial/jdbc/basics/prepared.html
http://jdbc.postgresql.org/documentation/head/index.html
http://docs.jboss.org/hibernate/orm/4.3/manual/en-US/html/ch10.html#inheritance-strategies
http://www.postgresql.org/docs/9.2/static/sql-set-transaction.html
https://docs.jboss.org/hibernate/orm/4.3/manual/en-US/html/ch20.html#performance-fetching-lazyproperties
http://brie.com/brian/blog/?p=61	/ wicket	,
http://web.itu.edu.tr/uyar/wicket-application-development/forms.html
http://192.168.1.13:9280/



/ Nog open,
http://www.mkyong.com/hibernate/hibernate-mutable-example-class-and-collection/
http://codespot.net/2014/02/03/hibernate-caching-strategies/
http://www.mkyong.com/hibernate/hibernate-fetching-strategies-examples/
http://hibernate-jcons.sourceforge.net/usage.html

https://system.mp-objects.com/xwiki/bin/view/Technology/PostgreSQL
https://test.scs.mp-objects.com/mposcs/core/index_frameset
http://localhost:8080/tms/core/index_frameset
http://ci.apache.org/projects/wicket/apidocs/7.x/

http://tech.puredanger.com/2009/07/10/hibernate-query-cache/
http://codespot.net/2014/02/03/hibernate-caching-strategies/

http://www.mkyong.com/hibernate/hibernate-mutable-example-class-and-collection/
http://www.mkyong.com/hibernate/hibernate-fetching-strategies-examples/
http://www.mkyong.com/wicket/wicket-spring-integration-example/
http://www.mkyong.com/spring-mvc/spring-mvc-log4j-integration-example/
http://stackoverflow.com/questions/9182805/spring-attaching-qualifer-to-java-configured-beans


http://brie.com/brian/blog/?p=61
http://web.itu.edu.tr/uyar/wicket-application-development/forms.html		/ !
http://wicket.apache.org/learn/examples/markupinheritance.html
http://stackoverflow.com/questions/7414794/difference-between-contextannotation-config-vs-contextcomponent-scan


http://www.journaldev.com/2410/spring-dependency-injection-example-with-annotations-and-xml-configuration
http://refcardz.dzone.com/refcardz/spring-annotations


/ Einde OPEN IN CHROME

/ PNLOMS WICKET TEST


/ 7	. 

/ de src files worden niet gevonden van file:///home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/module/massupdate/src/java/com/mpobjects/massupdate/view/wicket/shipmentorder/ShipmentOrderMassUpdatePage.java  

/ er zijn 2 nieuwe modules die niet in onze .classpath stonden, omdat we die hadden cp  uit een oud project	,
/ select project trunk, right click , properties	,
Java Build Path, Source 
/click Add Folder...
module/authorization/src/java
module/massupdate/src/java

/ Kijk ook in 	,
/ Hier moeten alle modules in staan	,
pnloms/pnloms-build-config.properties
/ TODO

[eric@localhost trunk]$ ls module/
alliancelookandfeeltwo  crossdockext       event                 massupdate             scanandprint
...
$ vi module/massupdate/src/java/com/mpobjects/massupdate/view/wicket/actiontype/EntityActionTypeListPage.html




module/massupdate/src/java/com/mpobjects/massupdate/view/wicket/actiontype/EntityActionTypeListPage.java


 

/ 7	. 

/ wicket scherm test	,
configuration, massupdate, entity action types

/ click create
/ we komen in 
Action Type 
/ click Create
Name: my
Organization: PNL-OMS-DEM
Action Type: SET_REMARK2
/ In Authorization Levels: Goedkeuren vanuit operationeel oogpunt 	, zit er al in	,
Save

/ Kies nu 
Planning, shipment order, mass update dashboard	,
/ Kies een awating my approval	, die status INITIAL heeft	, 
/ click Edit button	,
/ bij Actions	, kun je kiezen tussen HOLD en my	,

/ 7	. 

/ wicket scherm test	,
planning, shipment order, mass update
/ select all bijv, 
/ click update	, we gaan al deze shipment orders update	,
/ we komen op scherm Action Group	,
Description: fill in 
actions : HOLD 	, Hold status: CREDIT_HOLD
Save
Auth Start: ERR


/ Einde PNLOMS WICKET TEST

/ PNLOMS HIBERATE.INIT

/ Zie Jira CEVA-14170

/ Ga naar Finance, Service order recalc	,
/ Daar ERR	, in	,
[com.mpobjects.ratecalc.view.wicket.batchrecalc.ServiceOrderBatchRecalc] (Thread-204487:) failed to lazily initialize a collection of role: com.mpobjects.oms.ratecalc.model.rateagreement.vo.RateAgreementVO.rateAgreementSelCriterionList, no session or session was closed 
org.hibernate.LazyInitializationException: failed to lazily initialize a collection of role: com.mpobjects.oms.ratecalc.model.rateagreement.vo.RateAgreementVO.rateAgreementSelCriterionList, no session or session was closed 
        at org.hibernate.collection.AbstractPersistentCollection.throwLazyInitializationException(AbstractPersistentCollection.java:358)
        at org.hibernate.collection.AbstractPersistentCollection.throwLazyInitializationExceptionIfNotConnected(AbstractPersistentCollection.java:350)
        at org.hibernate.collection.AbstractPersistentCollection.initialize(AbstractPersistentCollection.java:343) 
        at org.hibernate.collection.AbstractPersistentCollection.read(AbstractPersistentCollection.java:86) 
        at org.hibernate.collection.PersistentBag.iterator(PersistentBag.java:249) 
        at com.mpobjects.oms.ratecalc.model.rateagreement.vo.RateAgreementVO.matches(RateAgreementVO.java:337) 
        at com.mpobjects.ratecalc.view.wicket.batchrecalc.BaseBatchRecalc.hasRateAgreement(BaseBatchRecalc.java:267) 
        at com.mpobjects.ratecalc.view.wicket.batchrecalc.ServiceOrderBatchRecalc$1.run(ServiceOrderBatchRecalc.java:163)  
 

$ vi file:///home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/module/ratecalc/src/java/com/mpobjects/oms/ratecalc/model/rateagreement/dao/RateAgreementHibernateDAOImpl.java 

	@Override
	public List<RateAgreementVO> getByType(AgreementType aRateType) {
		DetachedCriteria myCriteria = DetachedCriteria.forClass(RateAgreementVO.class);
		myCriteria.add(Property.forName("agreementType").eq(aRateType)).add(Property.forName("template").eq(false))
				.add(Property.forName("quotation").eq(false));
		return findNonDeleted(myCriteria);
	}

	@Override
	public List<RateAgreementVO> getInitializedByType(AgreementType aRateType) {
		List<RateAgreementVO> myList = getByType(aRateType);
		for (RateAgreementVO myRA : myList) {
			Hibernate.initialize(myRA.getRateAgreementSelCriterionList());
		}
		return myList;
	}

/ Einde PNLOMS HIBERATE.INIT

/ CEVA-14290 WARTSILA

[eric@localhost workspace]$ svn co https://system.mp-objects.com/svn/tms/branches/2013.04.01
[eric@localhost workspace]$ cp 2015.01/application.properties 2013.04.01/
[eric@localhost workspace]$ cp 2015.01/.project 2013.04.01/
[eric@localhost workspace]$ cp 2015.01/.classpath 2013.04.01/
$ vi application.properties
base.product = wartsila

$ vi .claspath
$ vi .project
2015.01-> 2013.04.01

[eric@localhost server]$ cp -a dsvcts/ wartsila
[eric@localhost deploy]$ mv dsvcts-schedule-service.xml wartsila-schedule-service.xml
$ vi wartsila-schedule-service.xml
        <mbean code="org.jboss.varia.scheduler.Scheduler" name=":service=WartsilaInterfaces">
                <attribute name="SchedulableArguments">ejb/WartsilaInterfaceRunnerFacade,all-admin,admin123@MPO</attribute>

[eric@localhost Firebird]$ pwd
/home/eric/Devel/Firebird

[eric@localhost Firebird]$ scp mposerv8:/backup/mpo-backup/db/dsvfms.fdb_20150210-000015.fbk.gz .
[eric@localhost Firebird]$ sudo chown firebird.firebird dsvfms.fdb_20150210-000015.fbk.gz
[eric@localhost Firebird]$ sudo -u firebird gzip -d  dsvfms.fdb_20150210-000015.fbk.gz
[eric@localhost Firebird]$ gbak -c -v -n -rep -user sysdba -password masterkey dsvfms.fdb_20150210-000015.fbk dsvfms.fdb

[eric@localhost Firebird]$ sudo cp -a dsvcts.fdb wartsila.fdb


calhost wartsila]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/wartsila
[eric@localhost wartsila]$ vi deploy/firebird-ds.xml 
        <connection-url>jdbc:firebirdsql://127.0.0.1//home/eric/Devel/Firebird/dsvfms.fdb?no_result_set_tracking&amp;defaultResultSetHoldable=true</connection-url>


/ we hebben edit	,

$ vi LightWeightDataSource.java

import java.util.logging.Logger;
	/**
	 * Required for java 7
	 * 
	 * @return
	 * @throws SQLFeatureNotSupportedException
	 */
	@Override
	public Logger getParentLogger() throws SQLFeatureNotSupportedException {
		throw new SQLFeatureNotSupportedException("Not Implemented");
	}

$ vi LoggableStatement.java

	/**
	 * Required for java 7
	 */
	private boolean closeOnCompletion;

	/**
	 * Required for java 7
	 * 
	 * @throws SQLException
	 */
	@Override
	public void closeOnCompletion() throws SQLException {
		closeOnCompletion = true;
	}
	@Override
	public boolean isCloseOnCompletion() throws SQLException {
		return closeOnCompletion;
	}


[eric@localhost Firebird]$ isql-fb dsvfms.fdb -u sysdba -p masterkey
/ OK

/ 13	. 

SQL> update mpo_scs_patch set status='SKIPPED' where name like '%patch-on-success%';


$ vi wartsila-menu.xml
$ vi terex-menu.xml
$ vi naccomfg-menu.xml
	<m:remove path="finance.cost.match.mismatchDetailsReport" />




/ Einde CEVA-14290 WARTSILA

/ FIREBIRD EXECUTE BLOCK

/ 7	. 

/ Lees	,
http://www.firebirdsql.org/refdocs/langrefupd20-execblock.html

/ Lees	,
http://stackoverflow.com/questions/19297887/define-variable-and-run-a-query-using-execute-block

[eric@localhost Firebird]$ isql-fb first.fdb -u sysdba -p masterkey
Database:  first.fdb, User: sysdba

SQL> drop table x;create table x(i int);


set term #;
execute block
as 
begin
insert into x values(7);
end#
set term ;#

/ OK in isql-fb, 	ERR in squirrel	, 


/ Einde FIREBIRD EXECUTE BLOCK

/ DSVMHC-34 

/ CREATE INSTANCE

[eric@localhost workspace]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace
[eric@localhost workspace]$ svn co https://system.mp-objects.com/svn/tms/branches
...
[eric@localhost workspace]$ svn co https://system.mp-objects.com/svn/tms/branches/2015.01

[localhost workspace]$ cp trunk/application.properties 2015.01/
$ vi 2015.01/application.properties
base.product = dsvcts
...

[eric@localhost workspace]$ cp trunk/.project 2015.01/
$ vi 2015.01/.project
<projectDescription>
        <name>2015.01</name>

[eric@localhost workspace]$ cp trunk/.classpath 2015.01/
$ vi .classpath
        <classpathentry kind="con" path="org.dbpowder.plugins.LIB_CONTAINER/recurse~project/2015.01/base-framework/core/lib/jar"/>
        <classpathentry kind="con" path="org.dbpowder.plugins.LIB_CONTAINER/recurse~project/2015.01/base-framework/buildscripts/build-lib"/>
        <classpathentry kind="con" path="org.dbpowder.plugins.LIB_CONTAINER/recurse~project/2015.01/module/interfacing/lib"/>

/ 13	. 

/ we cp de db van dsvcts op test	,
[eric@localhost workspace]$ ssh eric@mposerv11
mpo@2014
eric@mposerv11:~$ cd /local/apps/jboss-4.0.5.GA/server/dsvcts/
eric@mposerv11:/local/apps/jboss-4.0.5.GA/server/dsvcts$ vi deploy/firebird-ds.xml 
        <connection-url>jdbc:firebirdsql://192.168.1.8//local/apps/firebird/dsvcts.fdb?no_result_set_tracking&amp;defaultResultSetHoldable=true</connection-url>
/ we moeten dus deze db copy van mposerv8	,

[eric@localhost Firebird]$ pwd
/home/eric/Devel/Firebird
[eric@localhost Firebird]$ scp eric@mposerv8:/backup/mpo-backup/db/dsvcts.fdb_20150130-011856.fbk.gz .
[eric@localhost Firebird]$ ls
dsvcts.fdb_20150130-011856.fbk.gz

[eric@localhost Firebird]$ sudo chown firebird.firebird dsvcts.fdb_20150130-011856.fbk.gz 
/ TODO

[eric@localhost Firebird]$ sudo -u firebird gzip -d dsvcts.fdb_20150130-011856.fbk.gz 
$ ls
dsvcts.fdb_20150130-011856.fbk
[eric@localhost Firebird]$ gbak -c -v -n -rep -user sysdba -password masterkey dsvcts.fdb_20150130-011856.fbk dsvcts.fdb
gbak:restoring data for table OMS_ENTITY_LOG
gbak:   10000 records restored
gbak:   17748 records restored
gbak:    restoring index PK_SOCONTAINER
gbak:    restoring index FK_SOC_C
...
gbak:    activating and creating deferred index FK_ORGANIZATION_ORG_GROUP
gbak:    committing metadata
gbak:finishing, closing, and going home

[eric@localhost server]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server
[eric@localhost server]$ cp -a dsvfms dsvcts
[eric@localhost dsvcts]$ vi deploy/firebird-ds.xml 
       <connection-url>jdbc:firebirdsql://127.0.0.1//home/eric/Devel/Firebird/dsvcts.fdb?no_result_set_tracking&amp;defaultResultSetHoldable=true</connection-url>

[eric@localhost deploy]$ mv mpo-schedule-service.xml dsvcts-schedule-service.xml 
[eric@localhost deploy]$ vi dsvcts-schedule-service.xml 
        <mbean code="org.jboss.varia.scheduler.Scheduler" name=":service=DsvCtsInterfaces">
                <attribute name="SchedulableArguments">ejb/DsvCtsInterfaceRunnerFacade,all-admin,admin123@MPO</attribute>

/ in eclipse	,
service config van dsvcts (cp die van dsvfms)	,
Service name: dsvcts
Server configuration: dsvcts
Open launch configuration
Arguments, program arguments
-c dsvcts


[eric@localhost Firebird]$ isql-fb -u sysdba -p masterkey dsvcts.fdb
/ we zien account PDurr, admin123@MPO
/ Log zo in	,

/ we maken user	
eric
Eric Van der Velden
rtdMpo45 
ADMINISTRATOR

enabled
local account

Organizations	 Member Of	,
CANCEL	CANCEL	
DSV-DK-BRB	DSV Denmark Brøndby
DSV-DK-BRB-3M	3M - DSV Denmark Brøndby
DSV-DK-BRB-LOREAL	L'Oreal - DSV Denmark Brøndby	
DSV-DOW	Dow Control Tower
DSV-MHC	DSV Molnlycke Health Care	
SYSTEM	Organization for welcome banner	

/ allen Activatable	, DSV-MHC DSV Molnlycke Health Care  Active

/ 13	. 

/ Start ActiveMQ	,

[eric@localhost apache-activemq-5.10.1]$ bin/activemq console
...

/ In SCS	,
Support, System, Jms message entry	,

[eric@localhost ActiveMQ]$ pwd
/home/eric/Devel/Java/ActiveMQ
[eric@localhost ActiveMQ]$ ls
apache-activemq-5.10.1  SHIPMENT_ORDER_MSG.TransientObjectException.xml
5:09:06,823 ERROR [AbstractShipmentOrderMsgProcessor] Error while handling shipment order update: In createShipmentOrder(ParsedShipmentOrder (shipmentOrder:ShipmentOrder: SH001289446(SystemId:27042376; Org:DSV-MHC), productItems:[PRODUCT_ITEM id:null(systemId:0)], shipmentItems:[shipmentItem: (systemId:0, labelInfo:null), shipmentItem: (systemId:0, labelInfo:null), shipmentItem: (systemId:0, labelInfo:null), shipmentItem: (systemId:0, labelInfo:null), shipmentItem: (systemId:0, labelInfo:null), shipmentItem: (systemId:0, labelInfo:null), shipmentItem: (systemId:0, labelInfo:null), shipmentItem: (systemId:0, labelInfo:null)])):[Could not create shipmentorder:object references an unsaved transient instance - save the transient instance before flushing: com.mpobjects.oms.model.party.vo.PartyVO; nested exception is org.hibernate.TransientObjectException: object references an unsaved transient instance - save the transient instance before flushing: com.mpobjects.oms.model.party.vo.PartyVO] object references an unsaved transient instance - save the transient instance before flushing: com.mpobjects.oms.model.party.vo.PartyVO; nested exception is org.hibernate.TransientObjectException: object references an unsaved transient instance - save the transient instance before flushing: com.mpobjects.oms.model.party.vo.PartyVO
java.lang.RuntimeException: In createShipmentOrder(ParsedShipmentOrder (shipmentOrder:ShipmentOrder: SH001289446(SystemId:27042376; Org:DSV-MHC), productItems:[PRODUCT_ITEM id:null(systemId:0)], shipmentItems:[shipmentItem: (systemId:0, labelInfo:null), shipmentItem: (systemId:0, labelInfo:null), shipmentItem: (systemId:0, labelInfo:null), shipmentItem: (systemId:0, labelInfo:null), shipmentItem: (systemId:0, labelInfo:null), shipmentItem: (systemId:0, labelInfo:null), shipmentItem: (systemId:0, labelInfo:null), shipmentItem: (systemId:0, labelInfo:null)])):[Could not create shipmentorder:object references an unsaved transient instance - save the transient instance before flushing: com.mpobjects.oms.model.party.vo.PartyVO; nested exception is org.hibernate.TransientObjectException: object references an unsaved transient instance - save the transient instance before flushing: com.mpobjects.oms.model.party.vo.PartyVO] object references an unsaved transient instance - save the transient instance before flushing: com.mpobjects.oms.model.party.vo.PartyVO; nested exception is org.hibernate.TransientObjectException: object references an unsaved transient instance - save the transient instance before flushing: com.mpobjects.oms.model.party.vo.PartyVO
	at com.mpobjects.oms.model.service.ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderServiceImpl.java:875)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:96)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:260)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
	at com.sun.proxy.$Proxy234.createShipmentOrder(Unknown Source)
	at com.mpobjects.dsvcts.model.shipmentorder.xml.DsvCtsShipmentOrderMsgProcessor.processOriginal(DsvCtsShipmentOrderMsgProcessor.java:71)
	at com.mpobjects.dsvcts.model.shipmentorder.xml.DsvCtsShipmentOrderMsgProcessor.processUpdate(DsvCtsShipmentOrderMsgProcessor.java:97)
	at com.mpobjects.oms.model.shipmentorder.xml.AbstractShipmentOrderMsgProcessor.process(AbstractShipmentOrderMsgProcessor.java:266)
	at com.mpobjects.oms.model.shipmentorder.util.ShipmentOrderMsgConsumer.process(ShipmentOrderMsgConsumer.java:56)
	... // proxy	,
	at com.mpobjects.util.sap.control.MessageConsumer.handle(MessageConsumer.java:108)
	at com.mpobjects.util.sap.control.MessageSwitch.forwardDataMessage(MessageSwitch.java:1198)
	at com.mpobjects.util.sap.control.MessageSwitch.handleMessage(MessageSwitch.java:306)
	at com.mpobjects.util.sap.link.IncomingLink.postMessage(IncomingLink.java:143)
	at com.mpobjects.util.sap.link.IncomingXmlMessageLink.unMarshalFrom(IncomingXmlMessageLink.java:158)
	at com.mpobjects.util.sap.link.IncomingLink.handle(IncomingLink.java:89)
	at com.mpobjects.dsvcts.integration.jms.JmsDsvCtsListener.onMessage(JmsDsvCtsListener.java:64)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:562)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:500)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:468)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:263)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1101)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1093)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:990)
	at java.lang.Thread.run(Thread.java:745)

Caused by: org.hibernate.TransientObjectException: object references an unsaved transient instance - save the transient instance before flushing: com.mpobjects.oms.model.party.vo.PartyVO
	at org.hibernate.engine.ForeignKeys.getEntityIdentifierIfNotUnsaved(ForeignKeys.java:243)
	at org.hibernate.type.EntityType.getIdentifier(EntityType.java:456)
	at org.hibernate.type.ManyToOneType.isDirty(ManyToOneType.java:265)
	at org.hibernate.type.ManyToOneType.isDirty(ManyToOneType.java:275)
	at org.hibernate.type.TypeHelper.findDirty(TypeHelper.java:295)
	at org.hibernate.persister.entity.AbstractEntityPersister.findDirty(AbstractEntityPersister.java:3404)
	at org.hibernate.event.def.DefaultFlushEntityEventListener.dirtyCheck(DefaultFlushEntityEventListener.java:520)
	at org.hibernate.event.def.DefaultFlushEntityEventListener.isUpdateNecessary(DefaultFlushEntityEventListener.java:230)
	at org.hibernate.event.def.DefaultFlushEntityEventListener.onFlushEntity(DefaultFlushEntityEventListener.java:154)
	at org.hibernate.event.def.AbstractFlushingEventListener.flushEntities(AbstractFlushingEventListener.java:219)
	at org.hibernate.event.def.AbstractFlushingEventListener.flushEverythingToExecutions(AbstractFlushingEventListener.java:99)
	at org.hibernate.event.def.DefaultAutoFlushEventListener.onAutoFlush(DefaultAutoFlushEventListener.java:58)
	at org.hibernate.impl.SessionImpl.autoFlushIfRequired(SessionImpl.java:1185)
	at org.hibernate.impl.SessionImpl.list(SessionImpl.java:1709)
	at org.hibernate.impl.CriteriaImpl.list(CriteriaImpl.java:347)
	at org.springframework.orm.hibernate3.HibernateTemplate$5.doInHibernate(HibernateTemplate.java:591)
	at org.springframework.orm.hibernate3.HibernateTemplate$5.doInHibernate(HibernateTemplate.java:585)
	at org.springframework.orm.hibernate3.HibernateTemplate.doExecute(HibernateTemplate.java:407)
	... 82 more

Caused by: org.springframework.dao.InvalidDataAccessApiUsageException: object references an unsaved transient instance - save the transient instance before flushing: com.mpobjects.oms.model.party.vo.PartyVO; nested exception is org.hibernate.TransientObjectException: object references an unsaved transient instance - save the transient instance before flushing: com.mpobjects.oms.model.party.vo.PartyVO
	at org.springframework.orm.hibernate3.SessionFactoryUtils.convertHibernateAccessException(SessionFactoryUtils.java:673)
	at org.springframework.orm.hibernate3.HibernateAccessor.convertHibernateAccessException(HibernateAccessor.java:412)
	at org.springframework.orm.hibernate3.HibernateTemplate.doExecute(HibernateTemplate.java:412)
	at org.springframework.orm.hibernate3.HibernateTemplate.executeWithNativeSession(HibernateTemplate.java:375)
	at org.springframework.orm.hibernate3.HibernateTemplate.loadAll(HibernateTemplate.java:585)
	at com.mpobjects.util.dao.GenericHibernateDAO.getAll(GenericHibernateDAO.java:250)
	at com.mpobjects.util.dao.GenericHibernateDAO.getAll(GenericHibernateDAO.java:244)
	at com.mpobjects.util.dao.GenericHibernateDAO.getAll(GenericHibernateDAO.java:66)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)
	at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:80)
	at com.mpobjects.core.performance.PerformanceMeasurementAspect.measurePerformance(PerformanceMeasurementAspect.java:56)
	at sun.reflect.GeneratedMethodAccessor80.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:621)
	at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:610)
	at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:65)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.framework.adapter.MethodBeforeAdviceInterceptor.invoke(MethodBeforeAdviceInterceptor.java:51)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:161)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:96)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:260)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:91)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
	at com.sun.proxy.$Proxy212.getAll(Unknown Source)
	at com.mpobjects.oms.service.trigger.ShipmentOrderTriggerHandlerImpl.handleCreate(ShipmentOrderTriggerHandlerImpl.java:34)
	at com.mpobjects.oms.model.service.ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderServiceImpl.java:921)
	... 49 more

/ 7	.

[eric@localhost mhc]$ pwd
/home/eric/Devel/Interfaces/mhc
[eric@localhost mhc]$ ls
mhc.xml





/ Einde DSVMHC-34

/ DEBUG DSVMHC-34

/ we komen in	,

JmsDsvCtsListener.onMessage(Message) line: 64	
/=
public class JmsDsvCtsListener implements MessageListener {
	@Override
	public void onMessage(Message aMessage) {

aMessage	ActiveMQTextMessage  (id=13562)	
producerId	ProducerId  (id=13882)	
text	"<?xml version="1.0" encoding="UTF-8"?>\r\n<mtc:SHIPMENT_ORDER_MSG xmlns:mtc="http://system.mp-...
			...
			TextMessage myTextMessage = (TextMessage) aMessage;
			...
			myMarshalledMessageText = myTextMessage.getText();
			theIncomingLink.handle(myMarshalledMessageText);
/s
IncomingXmlMessageLink(IncomingLink).handle(String) line: 89	
			// The incoming octet sequence has been used for assembly of the incoming protocol data unit
			unMarshalFrom(octets);
/s
IncomingXmlMessageLink.unMarshalFrom(String) line: 158	
			// When compilation went fine, the document can be embedded in a sap message
			if (getParseOk()) {
				postMessage(myNewMessage);
/s
IncomingXmlMessageLink(IncomingLink).postMessage(Message) line: 143	
		// post to all subscribers
		for (Iterator it = theSubscribers.iterator(); it.hasNext();) {
			((IncomingMessageSubscriber) it.next()).handleMessage(aMessage);
/s
MessageSwitch.handleMessage(Message) line: 306	
		// dispatch on message type
		myMSH = aMessage.getMessageHeader();
SapXMessageHeader (Identifier:ID-mposerv13-42996-1420530662478-50-4, type:SHIPMENT_ORDER_MSG)

		} else {
			// No sequence number mismatch, so the data message can be forwarded for further processing
			forwardDataMessage(aMessage);
/s
MessageSwitch.forwardDataMessage(Message) line: 1198	
		// Let consumer process the message, if sequence numbers were ok.
		if (!retransmissionAfterLostAcknowledgement) {
			if (myRecord.getStatus() == MC_STATUS_OK) {
				LOG.info("Message posted to the consumer");
				theMessageConsumer.handle(aDataMessage);
/s
IncomingMessageDemultiplexer(MessageConsumer).handle(Message) line: 108	
		} else {
			// Initialise status
			theStatus = MC_STATUS_OK;
			theExplanation = "";

			// validate the message to determine if it is suitable for processing
			validate(incomingMessage);

			// When message passed all checks it is eligible for processing
			if (theStatus == MC_STATUS_OK) {
				process(incomingMessage);
/s
IncomingMessageDemultiplexer.process(Message) line: 123	
		MessageConsumerInterface myMessageConsumer = getConsumer(aIncomingMessage.getMessageHeader().getType());
myMessageConsumer	$Proxy281  (id=13285)	
com.mpobjects.oms.model.shipmentorder.util.ShipmentOrderMsgConsumer@2c0a1e3b

		try {
			myMessageConsumer.process(aIncomingMessage);
/s
//////////
/tx 
ShipmentOrderMsgConsumer.process(Message) line: 56	
					myProcessor.process(((SapXMessage) aIncomingMessage).getBody());

/ Nu heeft alncomingMessage alleen een header	,
bodyNode	DeferredElementImpl  (id=13966)	
[mtc:body: null]
theMemoisedMessageHeader	SapXMessageHeader  (id=13913)	
SapXMessageHeader (Identifier:ID-mposerv13-42996-1420530662478-50-4, type:SHIPMENT_ORDER_MSG)
/ TODO
/s
SapXMessage.getBody() line: 101	
		if (bodyNode == null) {
			bodyNode = XMLUtil.selectSingleNode(getDocument().getDocumentElement(), "body");
/t
/s
DsvCtsShipmentOrderMsgProcessor(AbstractShipmentOrderMsgProcessor).process(Node) line: 266	
/ of	,
MpoShipmentOrderMsgProcessor(AbstractShipmentOrderMsgProcessor).process(Node) line: 213	
/=
	public void process(Node aNode) throws ShipmentOrderException {
aNode.name	"mtc:body" (id=13800)	
			for (Node myNode : selectNodeIterable(aNode, "SHIPMENT_ORDER")) {
myNode.name	"mtc:SHIPMENT_ORDER" (id=13852)	

					...
					ShipmentOrderProcessor myProcessor = new ShipmentOrderProcessor();
					myProcessor.setProcessingContext(getProcessingContext());
256:					myShipmentOrder = myProcessor.process(myNode);

/ Intermezzo

/ centrale method	,

MpoShipmentOrderMsgProcessor(AbstractShipmentOrderMsgProcessor).process(Node) line: 256	
256:...
266:...

/ Einde Intermezzo

/s
ShipmentOrderProcessor.process(Node) line: 208	
			myShipmentOrderVO = myProcessor.process(selectSingleNode(aNode, SHIPMENT_ORDER_BODY_TAG));
/s
ShipmentOrderProcessor.process(Node) line: 208	
/=
	public ParsedShipmentOrder process(Node aNode) throws ShipmentOrderException {
aNode.name	"mtc:SHIPMENT_ORDER" (id=13852)	
...
				monitorMeta[4] = Boolean.FALSE.toString();
/ monitorMeta= [ID-mposerv13-42996-1420530662478-50-4, 05, , DSV-MHC, false]

		ShipmentOrderVO myShipmentOrderVO = null;
		ShipmentOrderBodyProcessor myProcessor = Factory.getFactory().getInstance(ShipmentOrderBodyProcessor.class);
		try {
			myProcessor.setProcessingContext(getProcessingContext());
			myProcessor.setParent(this);
			myShipmentOrderVO = myProcessor.process(selectSingleNode(aNode, SHIPMENT_ORDER_BODY_TAG));
/s
ShipmentOrderBodyProcessor.process(Node) line: 481	
/=
	public ShipmentOrderVO process(Node aNode) throws ShipmentOrderException {
aNode.name	"mtc:SHIPMENT_ORDER_BODY"
/ In de sho body zitten NIET de product items en de shipment items	,

			ShipmentOrderVO myShipmentOrderVO = ShipmentOrderVOFactory.getShipmentOrderVO();
/=new ShipmentOrderVO	,
			myShipmentOrderVO.setSyncToFlag(getSyncFlag("to"));
myKey	"interface.shipmentorder.sync.to.flag" (id=13889)	
"D"
			myShipmentOrderVO.setSyncFromFlag(getSyncFlag("from"));
myKey	"interface.shipmentorder.sync.from.flag" (id=13889)	
"D"
			myShipmentOrderVO.setSyncBillToFlag(getSyncFlag("billto"));
myKey	"interface.shipmentorder.sync.billto.flag" (id=14161)	
"D"
			myShipmentOrderVO.setSyncEmployeeResponsibleFlag(getSyncFlag("employeeresponsible"));
myKey	"interface.shipmentorder.sync.employeeresponsible.flag" (id=14172)	
"D"

/ Intermezzo
			myShipmentOrderVO.setSyncToFlag(getSyncFlag("to"));
/s
	protected static String getSyncFlag(String aType) {
		String myKey = "interface.shipmentorder.sync." + aType + ".flag".toLowerCase();
myKey	"interface.shipmentorder.sync.to.flag" (id=13889)	
		return ApplicationPropertyManager.getInstance().getModuleProperty("oms", myKey, PartySyncFlag.DISABLED_CODE);
/ PartySyncFlag.DISABLED_CODE="D"
/s
	public String getModuleProperty(String aModule, String aKey, String aDefaultValue) {
		return getProperty(getPropertyKey(aModule, aKey), aDefaultValue);
/s
	protected String getPropertyKey(String aModule, String aKey) {
		if (StringUtils.isNotEmpty(aModule)) {
			myRet = "module." + aModule + "." + aKey;
		} else {
			myRet = aKey;
/t
/s
	public String getProperty(String aKey, String aDefaultValue) {
aKey	"module.oms.interface.shipmentorder.sync.to.flag" (id=13931)	

		Resource myResource = AuthenticationUtils.getResource();
all-admin
		if (myResource != null) {
			myReturnValue = myResource.getProperty(aKey);
null
			if (myReturnValue == null) {
				myReturnValue = getDatabaseProperty(aKey, null);
/s
	protected String getDatabaseProperty(String aKey, String aDefaultValue) {
			if (dbProperties == null) {
/ NEE
				loadDatabaseProperties();
			}
			return dbProperties.getProperty(aKey, aDefaultValue);

/ Intermezzo

/ Eerder	,

	private void loadDatabaseProperties() {
			dbProperties = new Properties();
			List<PropertiesValueVO> myList = MpoBeanFactory.getBean(PropertiesValueDAO.class).getAllWithoutOrgAndUser();

/ In PropertiesValue.standard.hbm.xml	,
	<class name="com.mpobjects.oms.model.propertiesvalue.vo.PropertiesValueVO" table="PROPERTIES_VALUE">
/s
	public List<PropertiesValueVO> getAllWithoutOrgAndUser() {
		Criteria myCriteria = getCurrentSession().createCriteria(PropertiesValueVO.class);
		myCriteria.add(Property.forName("resource.systemId").isNull()).add(Property.forName("organization.systemId").isNull());

SQL> select count(*)from properties_value where USER_SYSTEM_ID is null and ORGANIZATION_SYSTEM_ID is null;
       COUNT 
============ 
           8 

SQL> select p.property_name from properties_value v join properties p on p.system_id=v.properties_system_id where USER_SYSTEM_ID is null and ORGANIZATION_SYSTEM_ID is null;
PROPERTY_NAME   
=============================================================================== 
module.emailnot.prenotificationExclusionRule
module.optimize.ratingrequest.costgroups
module.optimize.ratingrequest.pricegroups
module.optimize.ratingrequest.carrierinfo.enabled
module.optimize.ratingrequest.leadtime.enabled
module.oms.milestone.serviceaction.calculation.mode
module.oms.tab.serviceaction.createdby.hidden
module.optimize.ratingrequest.markup.percentage 

/ Einde Intermezzo

/t
	public String getProperty(String aKey, String aDefaultValue) {
				myReturnValue = getDatabaseProperty(aKey, null);
		if (myReturnValue == null) {
/ JA
			myReturnValue = getApplicationProperty(aKey, aDefaultValue);
/s
	public String getApplicationProperty(String aKey, String aDefaultValue) {
		// TODO make this one check the DB first?
		return theProperties.getProperty(aKey, aDefaultValue);
"D"


/ Einde Intermezzo

			// Defaults for the object, must be set before node processing
			myShipmentOrderVO.setShipmentOrderProcess(OrderProcess.OUTBOUND);
/s
		setOrderProcess(OrderProcessUtils.getByCode(aShipmentOrderProcess));
/s
	public static OrderProcess getByCode(String aCode) {
		OrderProcess myProcess = MpoBeanFactory.getBean(OrderProcessDAO.class).getByCode(aCode);

/ Intermezzo

$ vi OrderProcess.standard.hbm.xml
	<class name="OrderProcess" table="ORDER_PROCESS">

pnloms=# select*from order_process;
 system_id |   code   | description | organization_systemid | is_deleted 
-----------+----------+-------------+-----------------------+------------
  26594670 | OUTBOUND | Outbound    |                       |          0
(1 row)

/ Einde Intermezzo

/t
	public ShipmentOrderVO process(Node aNode) throws ShipmentOrderException {
			myShipmentOrderVO.setShipmentOrderProcess(OrderProcess.OUTBOUND);
/s
	public void setOrderProcess(OrderProcess aProcess) {
		orderProcess = aProcess;
this	ShipmentOrderVO  (id=13882)	
aProcess	OrderProcess  (id=14222)	
	code	"OUTBOUND" (id=14223)	
	deleted	false	
	description	"OUTBOUND" (id=14225)	
	organization	null	
	performanceMonitorService	null	
	systemId	24865	

/ ERICJ TODO 
/ Soms	,
			myShipmentOrderVO.setShipmentOrderProcess(OrderProcess.OUTBOUND);
		} catch (Exception anException) {
anException	UncategorizedSQLException  (id=14293)	
org.springframework.jdbc.UncategorizedSQLException: Hibernate operation: could not execute query; uncategorized SQLException for SQL [select this_.SYSTEM_ID as SYSTEM1_69_2_, this_.CODE as CODE69_2_, this_.DESCRIPTION as DESCRIPT3_69_2_, this_.ORGANIZATION_SYSTEMID as ORGANIZA4_69_2_, this_.IS_DELETED as IS5_69_2_, organizati2_.SYSTEM_ID as SYSTEM1_138_0_, organizati2_.IS_DELETED as IS2_138_0_, organizati2_.SEQUENCE as SEQUENCE138_0_, organizati2_.ORGANIZATION_ID as ORGANIZA4_138_0_, organizati2_.DESCRIPTION as DESCRIPT5_138_0_, organizati2_.ORGANIZATION_GROUP as ORGANIZA6_138_0_, organizati2_.AUTOM_RATE_CALC as AUTOM7_138_0_, organizati3_.SYSTEM_ID as SYSTEM1_138_1_, organizati3_.IS_DELETED as IS2_138_1_, organizati3_.SEQUENCE as SEQUENCE138_1_, organizati3_.ORGANIZATION_ID as ORGANIZA4_138_1_, organizati3_.DESCRIPTION as DESCRIPT5_138_1_, organizati3_.ORGANIZATION_GROUP as ORGANIZA6_138_1_, organizati3_.AUTOM_RATE_CALC as AUTOM7_138_1_ 
from ORDER_PROCESS this_ 
left outer join ORGANIZATION organizati2_ on this_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID 
left outer join ORGANIZATION organizati3_ on organizati2_.ORGANIZATION_GROUP=organizati3_.SYSTEM_ID 
where this_.IS_DELETED=? 
and this_.CODE=?]; 
SQL state [null]; error code [0]; Transaction is not active: tx=TransactionImpl:XidImpl[FormatId=257, GlobalId=localhost.localdomain/1236, BranchQual=, localId=1236]; - nested throwable: (javax.resource.ResourceException: Transaction is not active: tx=TransactionImpl:XidImpl[FormatId=257, GlobalId=localhost.localdomain/1236, BranchQual=, localId=1236]); nested exception is org.jboss.util.NestedSQLException: Transaction is not active: tx=TransactionImpl:XidImpl[FormatId=257, GlobalId=localhost.localdomain/1236, BranchQual=, localId=1236]; - nested throwable: (javax.resource.ResourceException: Transaction is not active: tx=TransactionImpl:XidImpl[FormatId=257, GlobalId=localhost.localdomain/1236, BranchQual=, localId=1236])

/t
			myShipmentOrderVO.setShipmentOrderProcess(OrderProcess.OUTBOUND);
/d
			Node myNode = selectSingleNode(aNode, ORGANIZATION_ID_TAG);

/ Intermezzo

  <mtc:body>
      <mtc:SHIPMENT_ORDER>
	<mtccore:SHIPMENT_ORDER_ID/> <!-- SHIPMENT_ORDER_ID:TO BE DETERMINED BY THE SYSTEM -->
	<mtccore:ORGANIZATION_ID>DSV-MHC</mtccore:ORGANIZATION_ID>

/ Hij staat wat in het midden	,

/ Einde Intermezzo

aNode	DeferredElementImpl  (id=16252)	
	firstChild	DeferredTextImpl  (id=16263)	
[#text: 
            ]
	name	"mtc:SHIPMENT_ORDER_BODY" (id=16264)	
	nextSibling	DeferredTextImpl  (id=16265)	
[#text: 
            ]


myNode	DeferredElementImpl  (id=16464)	
	firstChild	DeferredTextImpl  (id=16468)	
[#text: DSV-MHC]
	name	"mtccore:ORGANIZATION_ID" (id=16473)	
	nextSibling	DeferredTextImpl  (id=16475)	
[#text: 
            ]

			Node myNode = selectSingleNode(aNode, ORGANIZATION_ID_TAG);
myNode.name	"mtccore:ORGANIZATION_ID" (id=14372)	
/d
			if (myNode != null) {
				Organization myOrganizationVO = OrganizationUtil.getOrganizationFacadeLocal().getOrganization(myNode.getTextContent());
myNode.getTextContent()="DSV-MHC"
/s
	public Organization getOrganization(String aOrganization) {
			return organizationDAO.getOrganization(aOrganization);
/t
				Organization myOrganizationVO = OrganizationUtil.getOrganizationFacadeLocal().getOrganization(myNode.getTextContent());
myOrganizationVO=SystemId:3001	Id:DSV-MHC	Description:DSV Molnlycke Health Care
/d
			Node childNode = aNode.getFirstChild();
/ eerst "     \n", maar de volgende,	
childNode.name	"mtccore:COMMON" (id=14113)	
/ Klopt	,
         <mtc:SHIPMENT_ORDER_BODY>
            <mtccore:COMMON>

					} else if (COMMON_TAG.equals(myTag)) {
/ JA
						new LogisticsOrderBodyProcessor(this).process(childNode, myShipmentOrderVO);
/s
LogisticsOrderBodyProcessor.process(Node, LogisticsOrderVO) line: 189	
/=
	public void process(Node aNode, LogisticsOrderVO aLogisticsOrderVO) throws LogisticsOrderException {
			Node myNode = aNode.getFirstChild();
				myNode = myNode.getNextSibling();
/ want myNode.data="\n               " (id=14130)	
myNode.name	"mtccore:FROM_LOCATION" (id=14137)	
/ volgende while loop	,
				if (myNode.getNodeType() == Node.ELEMENT_NODE) {
					String myElementName = getElementName(myNode);
					if (myElementName.equals(FROM_LOCATION_TAG)) {
						Party myLocation = new LocationProcessor(this).process(myNode);
this	LogisticsOrderBodyProcessor  (id=13857)	
/s
LocationProcessor.process(Node) line: 117	
/=
	public Party process(Node aNode) throws LocationException {
aNode.name	"mtccore:FROM_LOCATION" (id=14137)	
			Party myPartyVO = new PartyProcessor(this).process(aNode);
/s
PartyProcessor.process(Node) line: 375	
/=
	public Party process(Node aNode) throws PartyException {
			Party myVO = new PartyVO();

			Node childNode = aNode.getFirstChild();
			while (childNode != null) {
childNode.name	"mtccore:LOCATION_ID" (id=14200)	
/ doet NIETS mee	,
childNode.name	"mtccore:ORGANIZATION_ID" (id=14248)	
/ doet NIETS mee	,
childNode.name	"mtccore:LOCATION_TYPE" (id=14254)	
/ doet NIETS mee	,
childNode.name	"mtccore:LOCATION_GROUP" (id=14254)	
/ doet NIETS mee	,
childNode.name	"mtccore:NAME" (id=14254)	
					} else if (NAME_TAG.equals(tag)) {
						myVO.setName(childNode.getTextContent());
childNode.name	"mtccore:NAME2" (id=14254)	
					} else if (NAME2_TAG.equals(tag)) {
						myVO.setName2(childNode.getTextContent());
childNode.name	"mtccore:ADDRESS" (id=14254)	
					} else if (ADDRESS_TAG.equals(tag)) {
						myVO.setAddress(childNode.getTextContent());
childNode.name	"mtccore:ADDRESS2" (id=14254)	
					} else if (ADDRESS2_TAG.equals(tag)) {
						myVO.setAddress2(childNode.getTextContent());
childNode.name	"mtccore:CITY (id=14254)	
					} else if (CITY_TAG.equals(tag)) {
						myVO.setCity(childNode.getTextContent());

childNode.name	"mtccore:POSTAL_CODE(id=14254)	
					} else if (POSTAL_CODE_TAG.equals(tag)) {
						myVO.setPostalCode(childNode.getTextContent());
childNode.name	"mtccore:REGION_STATE(id=14254)	
					} else if (REGION_STATE_TAG.equals(tag)) {
						myVO.setRegionState(childNode.getTextContent());
childNode.name	"mtccore:COUNTRY(id=14254)	
					} else if (COUNTRY_TAG.equals(tag)) {
						myVO.setCountryVO(new CountryProcessor(this).process(childNode));
childNode.name	"mtccore:PHONE_NUMBER(id=14254)	
					} else if (PHONE_NUMBER_TAG.equals(tag)) {
						myVO.setPhoneNumber(childNode.getTextContent());
childNode.name	"mtccore:FAX_NUMBER(id=14254)	
					} else if (FAX_NUMBER_TAG.equals(tag)) {
						myVO.setFaxNumber(childNode.getTextContent());
childNode.name	"mtccore:EMAIL_ADDRESS(id=14254)	
					} else if (EMAIL_ADDRESS_TAG.equals(tag)) {
						myVO.setEmailAddress(childNode.getTextContent());
childNode.name	"mtccore:CONTACT_NAME(id=14254)	
					} else if (CONTACT_NAME_TAG.equals(tag)) {
						myVO.setContactName(childNode.getTextContent());
childNode.name	"mtccore:PARTY_REFERENCE(id=14254)	
						processPartyReference(myVO, childNode);
/s
PartyProcessor.processPartyReference(Party, Node) line: 442	
/=
protected void processPartyReference(Party myVO, Node aNode) {
		boolean isHandled = true;
		ReferenceVO myReference = new ReferenceProcessor(this).process(aNode);
/s
ReferenceProcessor.process(Node) line: 39	
		ReferenceVO myVO = new ReferenceVO();
		Node childNode = aNode.getFirstChild();
		while (childNode != null) {
childNode.name	"mtccore:VALUE" (id=14419)	
				if (VALUE_TAG.equals(tag)) {
					myVO.setValue(StringUtils.filterNullValue(childNode.getTextContent()));
childNode.name	"mtccore:QUALIFIER" (id=14419)	
				} else if (QUALIFIER_TAG.equals(tag)) {
					myVO.setQualifier(StringUtils.filterNullValue(childNode.getTextContent()));
/t
PartyProcessor.processPartyReference(Party, Node) line: 463	
		ReferenceVO myReference = new ReferenceProcessor(this).process(aNode);
/d
myReference	ReferenceVO  (id=14412)	
	theQualifier	"COPY FROM MASTER DATA" (id=14433)	
	theValue	"COPY FROM MASTER DATA" (id=14434)	
			if (myQualifier.equals(REFERENCE1_QUALIFIER)) {
...
/ NEE	, 
/ Allemaal NEE	,

/t
PartyProcessor.process(Node) line: 429	
			while (childNode != null) {
/d
			return myVO;
/t
LocationProcessor.process(Node) line: 118	
			Party myPartyVO = new PartyProcessor(this).process(aNode);
/d
aNode.name	"mtccore:FROM_LOCATION" (id=14419)	
/ Nu de overige velden	, 
			Party myLocationVO = new PartyVO(myPartyVO);
			// Pick up the identification of the location
			String value = parseNodeValue(aNode, LOCATION_ID_TAG);
/s
LocationProcessor(XMLProcessor).parseNodeValue(Node, String...) line: 203	
/=
	protected String parseNodeValue(Node aNode, String... aPath) throws TransformerException {
aNode.name	"mtccore:FROM_LOCATION" (id=14419)	
aPath	String[1]  (id=14473)	
	[0]	"LOCATION_ID" (id=14501)	
			aNode = selectSingleNode(aNode, aPath);
aNode.name	"mtccore:_LOCATION_ID" (id=14419)	
				return getNodeTextContent(aNode, false, false);
/t
LocationProcessor.process(Node) line: 121	
			String value = parseNodeValue(aNode, LOCATION_ID_TAG);
/d
value	"SEMHC" (id=14524)	
				myLocationVO.setPartyId(value);

//////////////////////////////////////////////
/	LOCATION_ID-> partyVO.partyId

			value = parseNodeValue(aNode, ORGANIZATION_ID_TAG);
value	"DSV-MHC" (id=14531)	
			if (value != null) {
				Organization myOrganizationVO = MpoBeanFactory.getBean(OrganizationService.class).getOrganization(value);
SystemId:3001	Id:DSV-MHC	Description:DSV Molnlycke Health Care

/ Intermezzo

/ ERICJ TODO
$ vi Organization.standard.hbm.xml
	<class name="Organization" lazy="false" table="ORGANIZATION">
/ Waarom lazy="false"	?
/ TODO

[eric@localhost Firebird]$ isql-fb -user sysdba -password masterkey dsvcts.fdb
SQL>  select*from organization;
   SYSTEM_ID ORGANIZATION_ID      DESCRIPTION                                                                                          AUTOM_RATE_CALC IS_DELETED ORGANIZATION_GROUP     SEQUENCE 
============ ==================== =============================================================================== =============== ========== ================== ============ 
        3001 DSV-MHC              DSV Molnlycke Health Care                                                                                          0          0             <null>           10 

/ Einde Intermezzo

				if (myOrganizationVO != null) {
					myLocationVO.setOrganizationVO(myOrganizationVO);

			value = parseNodeValue(aNode, LOCATION_TYPE_TAG);
value	"MOLNLYCKE_SITE" (id=14586)	
					PartyType myPartyType = new BeanWrapper<PartyTypeDAO>(PartyTypeDAO.class).getBean().getByCode(value);
com.mpobjects.oms.model.entity.partytype.PartyType@25dfab56[MOLNLYCKE_SITE,MOLNLYCKE_SITE]


/////////////////////////////////////////////////////
/ ORGANIZATION_ID-> partyVO.organization

/ Intermezzo

$ vi PartyType.standard.hbm.xml
	<class name="com.mpobjects.oms.model.entity.partytype.PartyType" table="PARTY_TYPE">

SQL>  select*from party_type;

   SYSTEM_ID IS_DELETED PARTY_TYPE                DESCRIPTION                                        
============ ========== ========================= ================================================== 
    27041199          0 MOLNLYCKE_SITE            MOLNLYCKE_SITE                                     

/ Einde Intermezzo

					myLocationVO.setPartyType(myPartyType);
///////////////////////////////////////
/ LOCATION_TYPE -> partyVO.party_type

			return myLocationVO;
/t
LogisticsOrderBodyProcessor.process(Node, LogisticsOrderVO) line: 195	
						Party myLocation = new LocationProcessor(this).process(myNode);
/d
						Party myParty = PartyProcessor.storeParty(aLogisticsOrderVO, PartyProcessor.FROM_PARTY_QUALIFIER, myLocation);
aLogisticsOrderVO	ShipmentOrderVO  (id=13859)	
myLocation	PartyVO  (id=14448)	
/s
PartyProcessor.storeParty(EntityDetailSupport, String, Party) line: 203	
		return storeParty(aVO, aPartyQualifier, aPartyVO, PartyInterfaceMode.CREATE_UPDATE);
aVO	ShipmentOrderVO  (id=13859)	
aPartyVO PartyVO  (id=14448)	
/s
PartyProcessor.storeParty(EntityDetailSupport, String, Party, PartyInterfaceMode) line: 224	
/=
	public static Party storeParty(EntityDetailSupport aVO, String aPartyQualifier, Party aPartyVO, PartyInterfaceMode aDefaultMode) throws PartyException {
aVO	ShipmentOrderVO  (id=13859)	
aPartyQualifier	"from" (id=14617)	
aPartyVO	PartyVO  (id=14448)	
aDefaultMode	PartyInterfaceMode  (id=14681)	

		PartyInterfaceMode myPartyMode = getPartyMode(aVO, aPartyQualifier, aDefaultMode);
/s
	public static PartyInterfaceMode getPartyMode(EntityDetailSupport aVO, String aPartyQualifier, PartyInterfaceMode aDefaultMode) {
		String myEntityName = aVO.getFormattedEntity();
"shipmentorder"
		String myPropertyName = "module.oms.interface." + myEntityName + ".party." + aPartyQualifier + ".mode";
myPropertyName	"module.oms.interface.shipmentorder.party.from.mode" (id=14728)	
		String myValue = ApplicationPropertyManager.getInstance().getOrganizationProperty(aVO.getOrganizationVO(), myPropertyName, aDefaultMode.name());
/s
	public String getOrganizationProperty(Organization anOrganization, String aKey, String aDefaultValue) {
anOrganization	Organization  (id=14560)	
	automRateCalc	Boolean  (id=14760)	
	code	"DSV-MHC" (id=14761)	
	dateTimeZone	null	
	deleted	false	
	description	"DSV Molnlycke Health Care" (id=14766)	
	isNewRecord	false	
	mappedProperties	HashMap  (id=14767)	
	organizationGroup	null	
	performanceMonitorService	null	
	propertiesValues	PersistentSet  (id=14768)	
	sequence	10	
	systemId	3001	
aKey	"module.oms.interface.shipmentorder.party.from.mode" (id=14728)	
aDefaultValue	"CREATE_UPDATE" (id=14698)	

			return getProperty(anOrganization.getSystemId(), aKey, aDefaultValue);
/s
ApplicationPropertyManager.getProperty(int, String, String) line: 447	
/=
	public String getProperty(int aPreferedOrganizationSystemid, String aPropertyKey, String aDefaultValue) {
aPreferedOrganizationSystemid	3001											/ DSV-MHC
aPropertyKey	"module.oms.interface.shipmentorder.party.from.mode" (id=14728)	
aDefaultValue	"CREATE_UPDATE" (id=14698)	

/ Intermezzo

ApplicationPropertyManager.getProperty(int, String, String) line: 454	
			myRet = myActiveResource.getUserProperty(aPropertyKey, NOTSET);
		if (NOTSET.equals(myRet)) {
			myRet = getOrganizationProperty(aPreferedOrganizationSystemid, aPropertyKey, NOTSET, true);
		if (NOTSET.equals(myRet)) {
			myRet = getDatabaseProperty(aPropertyKey, NOTSET);
		if (NOTSET.equals(myRet)) {
			myRet = getApplicationProperty(aPropertyKey, aDefaultValue);

/ Einde Intermezzo

		Resource myActiveResource = AuthenticationUtils.getResource();
all-admin
/ Klopt messageListener's user is all-admin	,

		if (myActiveResource != null) {
			myRet = myActiveResource.getUserProperty(aPropertyKey, NOTSET);
"notset"
		if (NOTSET.equals(myRet)) {
			myRet = getOrganizationProperty(aPreferedOrganizationSystemid, aPropertyKey, NOTSET, true);
"optional_lookup"

/ Intermezzo

/ Deze kunnen we zien in de GUI bij Configuration, Administration, Properties values	,

$ vi PropertiesValue.standard.hbm.xml
	<class name="com.mpobjects.oms.model.propertiesvalue.vo.PropertiesValueVO" table="PROPERTIES_VALUE">

$ vi Organization.standard.hbm.xml
	<set name="propertiesValues" inverse="true" fetch="select" lazy="false">
			<key column="ORGANIZATION_SYSTEM_ID" />
			<one-to-many class="com.mpobjects.oms.model.propertiesvalue.vo.PropertiesValueVO" />
			<filter name="userFilter" condition="USER_SYSTEM_ID is null" />
		</set>
	</class>

/ TODO ( How de join)


SQL>  select*from properties where system_id=24828;
   SYSTEM_ID IS_DELETED PROPERTY_NAME      PROPERTY_TYPE    MANDATORY IS_VISIBLE DESCRIPTION 
   ============ ========== =============================================================================== 
       24828          0 		module.oms.interface.shipmentorder.party.from.mode          STRING   0          1 <null>                                                                                                                    
SQL>  select*from properties_value v where organization_system_id=3001 and USER_SYSTEM_ID is null and PROPERTIES_SYSTEM_ID=24828;
 SYSTEM_ID 	PROPERTIES_SYSTEM_ID 	PROPERTY_VALUE 	USER_SYSTEM_ID 	ORGANIZATION_SYSTEM_ID
   ============ ========== =============================================================================== 
27041979                24828 		optional_lookup		<null>                   3001 

/ In GUI Configuration, administration, properties values	, 
/ zoiets als	,
SQL> select*from properties p 
join properties_value v on p.system_id=v.properties_system_id 
join organization o on v.organization_system_id=o.system_id 
where p.property_name='module.oms.interface.shipmentorder.party.from.mode';

=============================== =============== ========== ================== ============ 
       24828          0 module.oms.interface.shipmentorder.party.from.mode     STRING   0          1 <null>   27041979                24828 optional_lookup  
  <null>                   3001         3001 DSV-MHC              DSV Molnlycke Health Care     0          0             <null>           10 

SQL> show table properties;
SYSTEM_ID                       INTEGER Nullable 
IS_DELETED                      SMALLINT Nullable DEFAULT 0
PROPERTY_NAME                   VARCHAR(250) Nullable 
PROPERTY_TYPE                   VARCHAR(100) Nullable 
MANDATORY                       SMALLINT Nullable DEFAULT 0
IS_VISIBLE                      SMALLINT Nullable DEFAULT 1
DESCRIPTION                     VARCHAR(255) Nullable 
CONSTRAINT PROPERTIES_PK:
  Primary key (SYSTEM_ID)

SQL> show table properties_value;
SYSTEM_ID                       INTEGER Nullable 
PROPERTIES_SYSTEM_ID            INTEGER Nullable 
PROPERTY_VALUE                  VARCHAR(16000) Nullable 
USER_SYSTEM_ID                  INTEGER Nullable 
ORGANIZATION_SYSTEM_ID          INTEGER Nullable 
CONSTRAINT PV_ORGANIZATION_FK:
  Foreign key (ORGANIZATION_SYSTEM_ID)    References ORGANIZATION (SYSTEM_ID)
CONSTRAINT PV_USER_FK:
  Foreign key (USER_SYSTEM_ID)    References TMS_USER (SYSTEM_ID)
CONSTRAINT PROPERTIES_VALUE_PK:
  Primary key (SYSTEM_ID)

SQL> show table organization;
SYSTEM_ID                       INTEGER Nullable 
ORGANIZATION_ID                 VARCHAR(20) Nullable 
DESCRIPTION                     VARCHAR(100) Nullable 
AUTOM_RATE_CALC                 SMALLINT Nullable DEFAULT 0
IS_DELETED                      SMALLINT Nullable DEFAULT 0
ORGANIZATION_GROUP              INTEGER Nullable 
SEQUENCE                        INTEGER Nullable DEFAULT 0
CONSTRAINT FK_ORGANIZATION_ORG_GROUP:
  Foreign key (ORGANIZATION_GROUP)    References ORGANIZATION (SYSTEM_ID)
CONSTRAINT ORGANIZATION_PK:
  Primary key (SYSTEM_ID)
CONSTRAINT ORGANIZATION_UK:
  Unique key (ORGANIZATION_ID)

propertiesValues	PersistentSet  (id=14865)	
/=
com.mpobjects.oms.model.propertiesvalue.vo.PropertiesValueVO@3c6b2617[systemId=27041979,property=module.oms.interface.shipmentorder.party.from.mode - null/true,value=optional_lookup], 
[com.mpobjects.oms.model.propertiesvalue.vo.PropertiesValueVO@1e91cefe[systemId=27041981,property=module.oms.tablefilter.greater.shipment-order.system_entry_date - module.oms.tablefilter.greater.shipment-order.system_entry_date/false,value=W4], 
com.mpobjects.oms.model.propertiesvalue.vo.PropertiesValueVO@3074ae7b[systemId=27041710,property=module.oms.serviceorder.emission.hidden - module.oms.serviceorder.emission.hidden/false,value=false], 
com.mpobjects.oms.model.propertiesvalue.vo.PropertiesValueVO@8441f92[systemId=27041709,property=module.oms.serviceorder.planneddistance.hidden - module.oms.serviceorder.planneddistance.hidden/false,value=false], 
com.mpobjects.oms.model.propertiesvalue.vo.PropertiesValueVO@16103db[systemId=27041708,property=module.oms.shipmentordertemplate.incotermsreference.hidden - module.oms.shipmentordertemplate.incotermsreference.hidden/false,value=true], 
com.mpobjects.oms.model.propertiesvalue.vo.PropertiesValueVO@13850268[systemId=27041707,property=module.oms.incoterm.version.enabled - module.oms.incoterm.version.enabled/false,value=true], 
com.mpobjects.oms.model.propertiesvalue.vo.PropertiesValueVO@291e8847[systemId=27041706,property=module.oms.serviceorder.copy.from.shipmentorder.reference2 - module.oms.serviceorder.copy.from.shipmentorder.reference2/false,value=true]]

/ Einde Intermezzo

		if (NOTSET.equals(myRet)) {
/ NEE
			myRet = getDatabaseProperty(aPropertyKey, NOTSET);
		}

		if (NOTSET.equals(myRet)) {
/ NEE
			myRet = getApplicationProperty(aPropertyKey, aDefaultValue);

/t
PartyProcessor.getPartyMode(EntityDetailSupport, String, PartyInterfaceMode) line: 199	
		String myValue = ApplicationPropertyManager.getInstance().getOrganizationProperty(aVO.getOrganizationVO(), myPropertyName, aDefaultMode.name());
myValue	"optional_lookup" (id=14825)	
		return PartyInterfaceMode.valueOf(myValue.toUpperCase().trim());
PartyInterfaceMode OPTIONAL_VALUE 5
/ een enum	,

/t
	public static Party storeParty(EntityDetailSupport aVO, String aPartyQualifier, Party aPartyVO, PartyInterfaceMode aDefaultMode) throws PartyException {
		PartyInterfaceMode myPartyMode = getPartyMode(aVO, aPartyQualifier, aDefaultMode);
/d

/ Intermezzo


/ we keken naar	,
module.oms.interface.shipmentorder.party.from.mode
/ storeParty gaat nu doen	,
		switch (myPartyMode) {
			case LOOKUP_CREATE:
			case CREATE_UPDATE:			
			case UNCHECKED:
			case MERGE_FROM_MASTERDATA:
			case LOOKUP:
			case OPTIONAL_LOOKUP:
			default:

/ Einde Intermezzo

			case OPTIONAL_LOOKUP:
				myBAO = PartyUtil.getPartyFacadeLocal();
/ $Proxy258 naar	,
com.mpobjects.oms.model.service.PartyServiceImpl@36550728

				if (myBAO.existWithPartyId(aPartyVO.getPartyId())) {
/s
PartyServiceImpl.existWithPartyId(String) line: 156	
/=
	public boolean existWithPartyId(String aPartyId) {
		return partyDAO.getPartyByPartyId(aPartyId) != null;
/s
PartyDAOImpl.getPartyByPartyId(String) line: 193	
/=
	public PartyVO getPartyByPartyId(String aPartyId) {
		return getPartyByPartyId(aPartyId, false);
/s
PartyDAOImpl.getPartyByPartyId(String, boolean) line: 199	
	@Override
	public PartyVO getPartyByPartyId(String aPartyId, boolean aDeleted) {
		DetachedCriteria myCriteria = DetachedCriteria.forClass(PartyVO.class);
		myCriteria.add(Property.forName("partyId").eq(aPartyId));
"SEMHC"
		myCriteria.add(Property.forName("deleted").eq(aDeleted));
false

/ Intermezzo

/ In Party.standard.hbm.xml
	<class name="PartyVO" table="PARTY">





/ Einde Intermezzo































					} else if (SHIPMENT_ORDER_PARTY_TAG.equals(myTag)) {
						processShipmentOrderParty(myShipmentOrderVO, childNode);
/s
ShipmentOrderBodyProcessor.processShipmentOrderParty(ShipmentOrderVO, Node) line: 706	
		} else {
			Party myParty = new PartyProcessor(this).process(partyNode);
			myParty = PartyProcessor.storeParty(aShipmentOrderVO, myPartyRole, myParty, PartyInterfaceMode.UNCHECKED);
			// check if the party role is a party type in TMS with showOnSho = true
			PartyTypeGroupVO myPartyTypeGroup = null;
			try {
				myPartyTypeGroup = MpoBeanFactory.getBean(PartyTypeGroupDAO.class).getByCode(myPartyRole);
			} catch (Exception e) {
				LOG.error("Error when retrieving partytypegroup [" + myPartyRole + "]", e);
			}

			if (myPartyTypeGroup != null && myPartyTypeGroup.isShowOnSho()) {
				// store party as ShipmentOrderParty
				ShipmentOrderParty myShipmentOrderParty = new ShipmentOrderParty();
				myShipmentOrderParty.setSyncFlag(PartySyncFlag.parse(getSyncFlag(myPartyTypeGroup.getCode())));
				myShipmentOrderParty.copyValuesFrom(myParty);
				myShipmentOrderParty.setPartyTypeGroup(myPartyTypeGroup);
				myShipmentOrderParty.setShipmentOrder(aShipmentOrderVO);
->				aShipmentOrderVO.addShipmentOrderParty(myShipmentOrderParty);
myPartyRole	"CONSIGNEE" (id=15932)	






/ Intermezzo

/ een TreeSet is een binary tree, met left en right	,

myShipmentOrder	ParsedShipmentOrder  (id=14066)	
	customerOrders	ArrayList  (id=14068)	
	productItems	TreeSet  (id=14069)	
	shipmentItems	TreeSet  (id=14070)	
	shipmentOrder	ShipmentOrderVO  (id=14057)	

/ In een ShipmentOrderVO is er een prop theShipmentItemList	, maar deze is nu []	,
/ De shipment items uit XML zitten in shipmentItems	,
/ In een ShipmentOrderVO is er een prop theProductItemList	, maar deze is nu []	,

public class ShipmentOrderVO extends LogisticsOrderVO implements CustomerStatusSupport, ReferenceSupport, Authorizable {
	private Party theBillToParty;
null
/ TODO
	private Party theEmployeeResponsibleParty;
null
/ TODO
	private Party thePreferedPartyVO;
/ OK
	private List<ShipmentOrderParty> theShipmentOrderPartyList;

public abstract class LogisticsOrderVO extends EntityDetailSupport {
	private Party theFromPartyVO;
/ OK
	private Party theToPartyVO;
/ OK

/ Waar is de CONSIGNEE party	?
/ TODO


/ In meer detail	,

 
	customerOrders	ArrayList  (id=14068)	
{}
	productItems	TreeSet  (id=14069)	
		m	TreeMap  (id=14238)	
			root	TreeMap$Entry  (id=14246)	
				key	ProductItemVO  (id=14251)	
					theQuantity	BigDecimal  (id=14305)	
1.20

	shipmentItems	TreeSet  (id=14070)	
						386
				445				481
			468		449		492		611
										614

/ In XML	,
           <mtccore:SHIPMENT_ITEM>
               <mtccore:SHIPMENT_ITEM_ID/>
               <mtccore:PACKAGE_CODE>EP</mtccore:PACKAGE_CODE>
             	<mtccore:VOLUME>
                  <mtccore:MEASUREMENT_VALUE>1.451125</mtccore:MEASUREMENT_VALUE>
                  <mtccore:UNIT_OF_MEASUREMENT>MTQ</mtccore:UNIT_OF_MEASUREMENT>
               </mtccore:VOLUME>
               <mtccore:WEIGHT>
                  <mtccore:MEASUREMENT_VALUE>142.8125</mtccore:MEASUREMENT_VALUE>
                  <mtccore:UNIT_OF_MEASUREMENT>KGM</mtccore:UNIT_OF_MEASUREMENT>
               </mtccore:WEIGHT>
               <mtccore:SHIPMENT_ITEM_REFERENCE>
                  <mtccore:VALUE>373324303661133417</mtccore:VALUE>
                  <mtccore:QUALIFIER>REFERENCE1</mtccore:QUALIFIER>
               </mtccore:SHIPMENT_ITEM_REFERENCE>
               <mtccore:SHIPMENT_ITEM_REFERENCE>
                  <mtccore:VALUE>PAL-healthcare produ cts</mtccore:VALUE>
                  <mtccore:QUALIFIER>REFERENCE2</mtccore:QUALIFIER>
               </mtccore:SHIPMENT_ITEM_REFERENCE>
            </mtccore:SHIPMENT_ITEM>	

/ In Java obj	,
key	ShipmentItemVO  (id=14611)	
	theDimensions	Dimensions  (id=14740)	
		theVolumeM3	BigDecimal  (id=14796)	
1.451125
		theWeightKg	BigDecimal  (id=14797)	
142.8125
	theReference1	"373324303661133417" (id=14750)	
	theReference2	"PAL-healthcare produ cts" (id=14751)	

/ Einde Intermezzo

/ Intermezzo

$ vi dsvcts/dsvcts.properties
module.oms.interface.shipmentorder.party.from.mode = create_update
module.oms.interface.shipmentorder.party.to.mode = create_update
module.oms.interface.shipmentorder.party.bill_to.mode = lookup
module.oms.interface.shipmentorder.party.prefered_execution.mode = merge_from_masterdata
/ TODO

/ Einde Intermezzo

/ Intermezzo


/ De shipment items komen NIET shipment_order table, 

pnloms=# select*from information_schema.columns where table_name='shipment_order' and column_name like '%item%';
 table_catalog | table_schema |   table_name   |       column_name        | ordinal_position | column_default | is_nullable | data_type | character_maximum_length | character_octet_length | numeric_precision | numeric_precision_radix | numeric_scale | datetime_precision | interval_type | interval_precision | character_set_catalog | character_set_schema | character_set_name | collation_catalog | collation_schema | collation_name | domain_catalog | domain_schema | domain_name | udt_catalog | udt_schema | udt_name | scope_catalog | scope_schema | scope_name | maximum_cardinality | dtd_identifier | is_self_referencing | is_identity | identity_generation | identity_start | identity_increment | identity_maximum | identity_minimum | identity_cycle | is_generated | generation_expression | is_updatable 
----+------------------+------------------+----------------+--------------+-----------------------+--------------
 pnloms        | public       | shipment_order | shipment_item_line_count |               67 |                | YES         | numeric   |                          |         |                18 |                      10 |             5 |                    |               |                    |                       |             |                    |                   |                  |                |                |               |             | pnloms      | pg_catalog | numeric  | |              |            |                     | 67             | NO                  | NO          |                     |                |                |                  |                  |                | NEVER        |                       | YES
 pnloms        | public       | shipment_order | total_nr_of_items        |              160 |                | YES         | numeric   |                          |         |                18 |                      10 |             5 |                    |               |                    |                       |             
         |                    |                   |                  |                |                |               |             | pnloms      | pg_catalog | numeric  | |              |            |                     | 160            | NO                  | NO          |                     |                |                |                  |                  |                | NEVER        |                       | YES
(2 rows)


/ Einde Intermezzo

/ we zijn nog in	,
DsvCtsShipmentOrderMsgProcessor(AbstractShipmentOrderMsgProcessor).process(Node) line: 266	

					ShipmentOrderProcessor myProcessor = new ShipmentOrderProcessor();
					myProcessor.setProcessingContext(getProcessingContext());
					myShipmentOrder = myProcessor.process(myNode);
/d
					} else if (myPurposeCode.isUpdate() || updateCode != null && updateCode.matcher(myPurposeCode.getPurposeCode()).matches()) {
/ JA
myPurposeCode	PurposeCodeVO  (id=14034)	
/ Dit is update	,
						resolveCustomerOrderLines(myShipmentOrder);
/ TODO
						processUpdate(myShipmentOrder);
/s
DsvCtsShipmentOrderMsgProcessor.processUpdate(ParsedShipmentOrder) line: 97	
		String nonDowOrgs = ApplicationPropertyManager.getInstance().getModuleProperty("dsvcts", "non.dow.orgs", "DSV-DK-BRB-3M,DSV-DK-BRB-LOREAL");
		boolean isDow = !StringUtils.matchesSeparatedList(nonDowOrgs, aParsedShipmentOrder.getShipmentOrder().getOrganizationVO().getCode());
/ true
aParsedShipmentOrder.getShipmentOrder().getOrganizationVO().getCode()="DSV-MHC"	,

		if (isDow) {
			boolean myOrderExists = getShipmentOrderDao().checkForExistence(aParsedShipmentOrder.getShipmentOrder().getShipmentOrderId(),
					aParsedShipmentOrder.getShipmentOrder().getOrganizationVO());
			if (!myOrderExists) {
				validateADR(aParsedShipmentOrder);
				processOriginal(aParsedShipmentOrder);
/s
DsvCtsShipmentOrderMsgProcessor.processOriginal(ParsedShipmentOrder) line: 71	
		ShipmentOrderVO myVO = myOrderService.createShipmentOrder(aParsedShipmentOrder);
//////////
/tx
/s
ShipmentOrderServiceImpl.createShipmentOrder(ParsedShipmentOrder) line: 868	
/=
	public ShipmentOrderVO createShipmentOrder(ParsedShipmentOrder aShipmentOrder) {
		try {
			ShipmentOrderVO myVO;
			myVO = createShipmentOrder(aShipmentOrder.getShipmentOrder());
/s
ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderVO) line: 883	
/=
	public ShipmentOrderVO createShipmentOrder(ShipmentOrderVO aShipmentOrder) throws ShipmentOrderException {
		return createShipmentOrder(aShipmentOrder, new TMSEventContext());
/s
ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderVO, TMSEventContext) line: 891	
/=
	public ShipmentOrderVO createShipmentOrder(ShipmentOrderVO aShipmentOrder, TMSEventContext anEventContext) throws ShipmentOrderException {
			ShipmentOrderVO myVO = null;
			if (StringUtils.isEmptyAfterTrim(aShipmentOrder.getShipmentOrderId())) {
				String myOrderId = KeyUtil.getKeyService().getShipmentOrderId();
SH001289468
				aShipmentOrder.setShipmentOrderId(myOrderId);

			Date myNow = timeService.getPresentDate(aShipmentOrder.getOrganizationVO());
/ nu	,
			aShipmentOrder.setSystemEntryDate(myNow);
			aShipmentOrder.setOriginalSystemEntryDate(myNow);
			aShipmentOrder.setLastUpdate(myNow);
			aShipmentOrder.setCreatedBy(ResourceUtil.getResource());

/ 7	. 

/ Later inpassen	,



/ 7	.

/ check in test db van dsvcts of shipment order is binnengekomen	,

eric@mposerv11:/local/apps/jboss-4.0.5.GA/server/dsvcts$  vi deploy/firebird-ds.xml 
        <connection-url>jdbc:firebirdsql://192.168.1.8//local/apps/firebird/dsvcts.fdb?no_result_set_tracking&amp;defaultResultSetHoldable=true</connection-url>

eric@mposerv8:/local/apps/firebird$ isql-fb
connect 'mposerv8:/local/apps/firebird/dsvcts.fdb'  user 'SYSDBA' password 'masterkey';
QL> select*from shipment_order where shipment_order_id='SH001289458';


/ 7	.

	
	

 



/ Einde DEBUG DSVMHC-34

/ DEBUG APPLICATION FOR PNL-378

/ 7	.

/ planning, shipment order, search

/ we zien onderin de link	,
/ oms/shipment-order_list

/ we moeten 3 dingen doen	,
/ shipment-order_list opzoeken	in oms-sitemap.xmap	,
/ dan shipmentOrderList opzoeken in oms-sitemap.xmap	,
/ dan xsp/shipment-order_list.xml in module/oms/war/oms

$ vi oms-sitemap.xmap	,

			<map:match pattern="shipment-order_list">
				<map:act type="shipmentOrderList"/>			
				<map:call resource="dynatablePage">
					<map:parameter name="xsp" value="xsp/shipment-order_list.xml"/>
				</map:call>
			</map:match>

			<map:action logger="shipmentorder" name="shipmentOrderList" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderListAction"/>			

/ In  module/oms zien we ook src	, maar cocoon in war/ 	, logisch	,
[eric@localhost trunk]$ ls module/oms/war/oms/xsp
customer-order_list.xml                          resource_selection-list.xml
dashboard-inbound-shipmentorder-list.xml         service-action-template-list.xml
dashboard-party-list.xml                         service-order_list-inbound.xml
...
product-item_list.xml

/ Een xsp defs het scherm	,
/ in oms module	,
$ vi xsp/shipment-order_list.xml 

  <page>
    <dynatable:initialize name="shipment-order">
        <xsp:logic>
...
           myTable.addHiddenColumn("SYSTEMID");
            myTable.addDatabaseJoinColumn("organization","organization_id", 11);
            
            if (!myTable.isFieldHidden("orderprocessonlistpage")) {
	            myTable.addDatabaseJoinColumn("shipment_order_process", "code", 15); 
            }
...
   <dynatable:populate>
        <xsp:logic>
            ShipmentOrderView myView = new ShipmentOrderView();
            Collection myList = myView.executeDynaQuery(myTable.getDynaQuery());


/ We zien de columns inderdaad	,

/ 7	 

////////////////////////////////////////////////

/ we kiezen straks SH000000122	,

/ we zien in de GUI 	
product items
010
020
Shipment items  	Products
010			010 1
020 			010 3

/ Dus WH zit er in si 020 3 pi 010 items	,

pnloms=# select count(pi.*)from tms_product_item pi join shipment_order so on pi.shipment_order_systemid=so.system_id where so.shipment_order_id='SH000000122';
 count 
-------
     2
(1 row)
pnloms=# select pi.product_item_id from tms_product_item pi join shipment_order so on pi.shipment_order_systemid=so.system_id where so.shipment_order_id='SH000000122';
 product_item_id 
-----------------
 020
 010
(2 rows)

pnloms=# select count(si.*)from shipment_item si join shipment_order so on si.shipment_order_systemid=so.system_id where so.shipment_order_id='SH000000122';
 count 
-------
     2
(1 row)

pnloms=# select si.shipment_item_id from shipment_item si join shipment_order so on si.shipment_order_systemid=so.system_id where so.shipment_order_id='SH000000122'; shipment_item_id 
------------------
 010
 020
(2 rows)

pnloms=# select pi.quantity,pi.product_item_systemid, pi.shipment_item_systemid   from tms_packed_item pi join shipment_item si on pi.shipment_item_systemid=si.system_id join shipment_order so on si.shipment_order_systemid=so.system_id where so.shipment_order_id='SH000000122';
 quantity | product_item_systemid | shipment_item_systemid 
----------+-----------------------+------------------------
  1.00000 |              26680266 |               26680268
  3.00000 |              26680266 |               26680271
(2 rows)

pnloms=# select pi.quantity,pi.product_item_systemid, si.shipment_item_id   from tms_packed_item pi join shipment_item si on pi.shipment_item_systemid=si.system_id join shipment_order so on si.shipment_order_systemid=so.system_id where so.shipment_order_id='SH000000122';
 quantity | product_item_systemid | shipment_item_id 
----------+-----------------------+------------------
  1.00000 |              26680266 | 010
  3.00000 |              26680266 | 020
(2 rows)

pnloms=# select pi.quantity,tpi.product_item_id, si.shipment_item_id   from tms_packed_item pi join shipment_item si on pi.shipment_item_systemid=si.system_id join shipment_order so on si.shipment_order_systemid=so.system_id join tms_product_item tpi on pi.product_item_systemid=tpi.system_id where so.shipment_order_id='SH000000122';
 quantity | product_item_id | shipment_item_id 
----------+-----------------+------------------
  1.00000 | 010             | 010
  3.00000 | 010             | 020
(2 rows)

/////////////////////////////////////////////////` 


/ 7	.

/ SHIPMENT-ORDER_LIST

/ we geven	,
/ planning, shipment order, search

/ we set b in 
ShipmentOrderListAction.act	,
ShipmentOrderView.executeDynaQuery	,

/ de 1ste keer als een datum fout staat	, valt hij NIET in ShipmentOrderView.executeDynaQuery 
/ Maar als we deze: all maken	, en geven Enter, valt hij WEL in  ShipmentOrderView.executeDynaQuery	,

	ShipmentOrderView.executeDynaQuery(DynaQuery) line: 51	
	shipment_order_list_xml.generate() line: 639	
	ServerPagesGenerator.generate() line: 228	
	CachingProcessingPipeline(AbstractProcessingPipeline).processXMLPipeline(Environment) line: 579	
	CachingProcessingPipeline(AbstractCachingProcessingPipeline).processXMLPipeline(Environment) line: 279	
	CachingProcessingPipeline(AbstractProcessingPipeline).process(Environment) line: 481	
	SerializeNode.invoke(Environment, InvokeContext) line: 121	
	NamedContainerNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	NamedContainerNode(ContainerNode).invoke(Environment, InvokeContext) line: 32	
	CallNode.invoke(Environment, InvokeContext) line: 94	
	NamedContainerNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	NamedContainerNode(ContainerNode).invoke(Environment, InvokeContext) line: 32	
	CallNode.invoke(Environment, InvokeContext) line: 94	
	MatchNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext, String, Map) line: 47	
	MatchNode.invoke(Environment, InvokeContext) line: 108	
	PipelineNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	PipelineNode.invoke(Environment, InvokeContext) line: 143	
	PipelinesNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	PipelinesNode.invoke(Environment, InvokeContext) line: 93	
	ConcreteTreeProcessor.process(Environment, InvokeContext) line: 235	
	ConcreteTreeProcessor.process(Environment) line: 177	
	TreeProcessor.process(Environment) line: 253	
	MountNode.invoke(Environment, InvokeContext) line: 118	
	MatchNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext, String, Map) line: 47	
	MatchNode.invoke(Environment, InvokeContext) line: 108	
	PipelineNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	PipelineNode.invoke(Environment, InvokeContext) line: 143	
	PipelinesNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	PipelinesNode.invoke(Environment, InvokeContext) line: 93	
	ConcreteTreeProcessor.process(Environment, InvokeContext) line: 235	
	ConcreteTreeProcessor.process(Environment) line: 177	
	TreeProcessor.process(Environment) line: 253	
	MountNode.invoke(Environment, InvokeContext) line: 118	
	PipelineNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	PipelineNode.invoke(Environment, InvokeContext) line: 143	
	PipelinesNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	PipelinesNode.invoke(Environment, InvokeContext) line: 93	
	ConcreteTreeProcessor.process(Environment, InvokeContext) line: 235	
	ConcreteTreeProcessor.process(Environment) line: 177	
	TreeProcessor.process(Environment) line: 253	
	Cocoon.process(Environment) line: 699	
	CocoonServlet.service(HttpServletRequest, HttpServletResponse) line: 1154	
	CocoonServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	
	ApplicationFilterChain.internalDoFilter(ServletRequest, ServletResponse) line: 252	
...

	public Collection executeDynaQuery(DynaQuery aQuery) throws AbstractException {
		LOG.debug("in executeDynaQuery");
		try {
			return getDao().executeDynaQuery(aQuery);
/s
			dao = MpoBeanFactory.getBean(ShipmentOrderDao.class);
/t
/s
ShipmentOrderDaoImpl.executeDynaQuery(DynaQuery) line: 248	
this	ShipmentOrderDaoImpl  (id=16891)	
aQuery	DynaQuery  (id=16896)	
	maxResultCount	2000	
	orderByColumn	null	
	orderByDirection	"ASC" (id=16988)	
	theFilterList	ArrayList  (id=17059)	
	theQuery	"SELECT SHO.* FROM SHIPMENT_ORDER SHO WHERE IS_TEMPLATE = 0 AND ORGANIZATION_SYSTEMID IN {USER_ORGANIZATIONS} -#1 AND FROM_COUNTRY_SYSTEMID IN (SELECT SYSTEM_ID FROM COUNTRY WHERE ?)#--#2 AND TO_COUNTRY_SYSTEMID IN (SELECT SYSTEM_ID FROM COUNTRY WHERE ?)#--#3 AND STATUS_CODE_SYSTEMID IN (SELECT SYSTEM_ID FROM ORDER_STATUS WHERE ?)#--#4 AND HOLD_STATUS_SYSTEMID IN (SELECT SYSTEM_ID FROM HOLD_STATUS WHERE ?)#--#5 AND STATUS_CODE_SYSTEMID IN (SELECT SYSTEM_ID FROM ORDER_STATUS WHERE ?)#--#6 AND SYSTEM_ID IN (SELECT SHIPMENT_ORDER_SYSTEMID FROM SHIPMENT_ITEM WHERE ?)#--#7 AND ACT_SERVICE_LEVEL_SYSTEMID IN (SELECT SYSTEM_ID FROM SHIPMENT_SERVICE_LEVEL WHERE ?)#--#8 AND INCO_TERM_SYSTEMID IN (SELECT SYSTEM_ID FROM INCO_TERM WHERE ?)#--#9 AND SYSTEM_ID IN (SELECT SHIPMENT_ORDER_SYSTEMID FROM SHIPMENT_ITEM WHERE ?)#--#10 AND SHIPM_TYPE_SYSTEMID IN (SELECT SYSTEM_ID FROM SHIPMENT_ORDER_TYPE WHERE ?)#--#11 AND ORGANIZATION_SYSTEMID IN (SELECT SYSTEM_ID FROM ORGANIZATION WHERE ?)#--#12 AND CUSTOMER_STATUS_SYSTEMID IN (SELECT SYSTEM_ID FROM CUSTOMER_STATUS WHERE ?)#--#13 AND PREFERED_PARTY_SYSTEMID IN (SELECT SYSTEM_ID FROM PARTY WHERE ?)#--#14 AND ASSIGNEE_SYSTEMID IN (SELECT SYSTEM_ID FROM TMS_USER WHERE ?)#--#15 AND ORDER_PROCESS_SYSTEMID IN (SELECT SYSTEM_ID FROM ORDER_PROCESS WHERE ?)#-" (id=17060)	

/ Deze query staat in de xsp xml	,

$ vi shipment-order_list.xml
...
           myTable.setQuery(
            "SELECT SHO.* FROM SHIPMENT_ORDER SHO " +
            "WHERE IS_TEMPLATE = 0 AND ORGANIZATION_SYSTEMID IN {USER_ORGANIZATIONS} " +
            "-#1 AND FROM_COUNTRY_SYSTEMID IN (SELECT SYSTEM_ID FROM COUNTRY WHERE ?)#-" +
            "-#2 AND TO_COUNTRY_SYSTEMID IN (SELECT SYSTEM_ID FROM COUNTRY WHERE ?)#-"+
            "-#3 AND STATUS_CODE_SYSTEMID IN (SELECT SYSTEM_ID FROM ORDER_STATUS WHERE ?)#-" +
            "-#4 AND HOLD_STATUS_SYSTEMID IN (SELECT SYSTEM_ID FROM HOLD_STATUS WHERE ?)#-" +
            "-#5 AND STATUS_CODE_SYSTEMID IN (SELECT SYSTEM_ID FROM ORDER_STATUS WHERE ?)#-" +
            "-#6 AND SYSTEM_ID IN (SELECT SHIPMENT_ORDER_SYSTEMID FROM SHIPMENT_ITEM WHERE ?)#-" + 
            "-#7 AND ACT_SERVICE_LEVEL_SYSTEMID IN (SELECT SYSTEM_ID FROM SHIPMENT_SERVICE_LEVEL WHERE ?)#-" +
            "-#8 AND INCO_TERM_SYSTEMID IN (SELECT SYSTEM_ID FROM INCO_TERM WHERE ?)#-"  +
            "-#9 AND SYSTEM_ID IN (SELECT SHIPMENT_ORDER_SYSTEMID FROM SHIPMENT_ITEM WHERE ?)#-" +
            "-#10 AND SHIPM_TYPE_SYSTEMID IN (SELECT SYSTEM_ID FROM SHIPMENT_ORDER_TYPE WHERE ?)#-" +
            "-#11 AND ORGANIZATION_SYSTEMID IN (SELECT SYSTEM_ID FROM ORGANIZATION WHERE ?)#-" + 
            "-#12 AND CUSTOMER_STATUS_SYSTEMID IN (SELECT SYSTEM_ID FROM CUSTOMER_STATUS WHERE ?)#-" +
            "-#13 AND PREFERED_PARTY_SYSTEMID IN (SELECT SYSTEM_ID FROM PARTY WHERE ?)#-" +
            "-#14 AND ASSIGNEE_SYSTEMID IN (SELECT SYSTEM_ID FROM TMS_USER WHERE ?)#-" +
            "-#15 AND ORDER_PROCESS_SYSTEMID IN (SELECT SYSTEM_ID FROM ORDER_PROCESS WHERE ?)#-",
           	myMaxResult
            );
 
		return executeSqlSelect(mySql, "SHO", aQuery.getMaxResultCount());
/s
ShipmentOrderDaoImpl(BaseHibernateDAO).executeSqlSelect(String, String, int) line: 240	

/ we komen in BaseHibernateDAO 	, GenericHibernateDAO is een subclass van deze	,

		String mySql = aQuery.toSQL();
aSql	"SELECT SHO.* FROM SHIPMENT_ORDER SHO WHERE IS_TEMPLATE = 0 AND ORGANIZATION_SYSTEMID IN (0,1010,1000,1) " (id=17587)	

...
/s
ShipmentOrderDaoImpl(BaseHibernateDAO).executeSqlSelect(String, String, Collection<QueryParameter>, int, int) line: 211	
aSql	"SELECT SHO.* FROM SHIPMENT_ORDER SHO WHERE IS_TEMPLATE = 0 AND ORGANIZATION_SYSTEMID IN (0,1010,1000,1) " (id=17587)	

			return getHibernateTemplate().executeFind(new HibernateCallback() {
getHibernateTemplate()=org.springframework.orm.hibernate3.HibernateTemplate@5bd84c08

				@Override
				public Object doInHibernate(Session aSession) throws HibernateException, SQLException {
					SQLQuery query = aSession.createSQLQuery(aSql);
					for (QueryParameter parameter : aParameters) {
						parameter.setValue(query);
					}
					query.addEntity(anAlias, type);
					if (aMaxResult > 0) {
						query.setMaxResults(aMaxResult);
					}
					if (aFirstResult > 0) {
						query.setFirstResult(aFirstResult);
					}
					return query.list();

/ 7	. 

/ SHIPMENT-ORDER_EDIT

/ we click edit op sho	, SH000000122

/ Intermezzo

$ vi oms-sitemap.xmap

		<map:match pattern="shipment-order_edit">
				<map:act type="shipmentOrderEdit">
					<map:select type="session-attribute">
						<map:parameter name="attribute-name" value="builder"/>
						<map:when test="jsp">
							<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order_edit.jsp"/>
						</map:when>
						<map:otherwise>
							<map:redirect-to uri="../wicket?module=oms&amp;wicketpage=shipmentorder.edit.ShipmentOrderEditSelectionPage"/>
						</map:otherwise>			
					</map:select>
				</map:act>
			</map:match>
 
/ Voor isb is het een wicket page, voor de rest een jsp,
/ shipmentorder_list is geen jsp, maar een door xsp generated ... (TODO)

$ vi ShipmentOrderEditAction.java
	@Override
	public Map act() throws java.lang.Exception {
			myVO = MpoBeanFactory.getBean(ShipmentOrderDao.class).getBySystemId(mySystemId);
/ initilized proxy naar een ShipmentOrderVO	, we zien geen query in hibernate.log	, dus deze proxy was al in de cache	,

			getSession().setAttribute("builder", ShipmentOrderUtil.getBuilder(myVO));

$ vi ShipmentOrderUtil.java

	public static String getBuilder(ShipmentOrderVO aShipmentOrder) {
		String myClass = "jsp";
		String myProperty = ApplicationPropertyManager.getInstance().getOrganizationProperty(aShipmentOrder.getOrganization(),
				"module.oms.shipmentorder.edit.screen.builder", myClass);
		if (!StringUtils.isEmpty(myProperty)) {
			myClass = myProperty;
		}
		return myClass;

/ In db	,
pnloms=# select*From properties_value where organization_system_id is not null;
 system_id | properties_system_id | property_value | user_system_id | organization_system_id 
-----------+----------------------+----------------+----------------+------------------------
  26680240 |             26680239 | 72             |                |                   1010
pnloms=# select*from properties where system_id= 26680239;
 system_id | is_deleted |                       property_name                       | property_type | mandatory | is_visible |                  description              
-----------+------------+-----------------------------------------------------------+---------------+-----------+------------+------------------------------------------- -----
  26680239 |          0 | module.oms.recurring.shipmentorder.schedule.horizon.hours | INTEGER       |         0 |          0 | recurring.shipmentorder.schedule.horizon.hours
(1 row)

/ Een andere dus	

/ Einde Intermezzo

/s
ShipmentOrderEditAction.act() line: 69	
			myVO = MpoBeanFactory.getBean(ShipmentOrderDao.class).getBySystemId(mySystemId);
/ initialized proxy naar een ShipmentOrderVO	, 
/ we zien geen query in de hibernate log	,
/ TODO

			if (myVO.getFromPartyVO() == null) {
				myVO.setFromPartyVO(new VirtualParty());
			}
			if (myVO.getToPartyVO() == null) {
				myVO.setToPartyVO(new VirtualParty());
			}
			if (myVO.getBillToPartyVO() == null) {
				myVO.setBillToPartyVO(new VirtualParty());
			}

			ShipmentItemFormBean myShipmentItem = prepareNewShipmentItem(myVO);
/s
		return new ShipmentItemFormBean(new ShipmentItemVO(), aShipmentOrder.getProductItemList());
/s
ShipmentItemFormBean.<init>(ShipmentItemVO, Collection<ProductItemVO>) line: 40	
/=
	public ShipmentItemFormBean(ShipmentItemVO aShipmentItem, Collection<ProductItemVO> aProductItemList) {
aShipmentItem	ShipmentItemVO  (id=21075)	
shipmentItem: null(systemId:0, labelInfo:null)
/ is met new create	,

		setShipmentItem(aShipmentItem);
		initPackedItemList(aProductItemList);
/s
ShipmentItemFormBean.initPackedItemList(Collection<ProductItemVO>) line: 95	
		ArrayList<ProductItemVO> myProductItemList = new ArrayList<ProductItemVO>(aProductItemList);
/ de 2 product items	,
		packedItemList.addAll(shipmentItem.getPackedItemList());
[]	, want shipmentItem is  de new shipment item	,

		// clear all product items which have already a packed item line with this shipment item
		for (PackedItemVO myPackedItem : packedItemList) {
/ NEE

		for (ProductItemVO myProductItem : myProductItemList) {

			PackedItemVO myPackedItem = new PackedItemVO();
			myPackedItem.setSystemId(myPackedItemSystemId--);
			myPackedItem.setProductItemVO(myProductItem);
			myPackedItem.setShipmentItemVO(shipmentItem);
			packedItemList.add(myPackedItem);

/t
ShipmentOrderEditAction.act() line: 86	
			ShipmentItemFormBean myShipmentItem = prepareNewShipmentItem(myVO);
this	ShipmentOrderEditAction  (id=24564)	
mySystemId	26680261	
myVO	ShipmentOrderVO_$$_javassist_133  (id=24566)	
myShipmentItem	ShipmentItemFormBean  (id=25487)	
	packedItemList	ArrayList  (id=25492)	
		elementData	Object[10]  (id=25517)	
			[0]	PackedItemVO  (id=25525)	
				actualQuantity	BigDecimal  (id=5636)	
				parsedShipmentOrderId	null	
				performanceMonitorService	null	
				systemId	0	
				theProductItemVO	ProductItemVO  (id=25523)	
PRODUCT_ITEM id:(systemId:26680266)
				theQuantity	BigDecimal  (id=5636)	
				theShipmentItemVO	ShipmentItemVO  (id=25467)	
			[1]	PackedItemVO  (id=25540)	
				actualQuantity	BigDecimal  (id=5636)	
				parsedShipmentOrderId	null	
				performanceMonitorService	null	
				systemId	-1	
				theProductItemVO	ProductItemVO  (id=25552)	
PRODUCT_ITEM id:(systemId:26680274)
				theQuantity	BigDecimal  (id=5636)	
				theShipmentItemVO	ShipmentItemVO  (id=25467)	
		modCount	4	
		size	2	
	shipmentItem	ShipmentItemVO  (id=25467)	
	systemId	0	

/ Heeft nieuwe si create	,  en create 2 nieuwe packed items en copies de 2 product item's en steeds deze si er in	,

			if (!ShipmentOrderShared.isPackagingDisabled()) {
				// It should only be possible to edit individual products when
				// packaging is enabled.
				ProductItemVO myProductItem = (ProductItemVO) VOFactory.getValueObject(ProductItemVO.class);
/ new	,
				// myVO.addProductItem(myProductItem);
				MpoBeanFactory.getBean(EntityDetailService.class).initialize(myProductItem);
/s
EntityDetailServiceImpl.initialize(EntityDetailSupport) line: 125	
		List<EntityDetailType> myList = getDAO().getByEntity(anEntityDetailSupport.getEntity());
 





/ Intermezzo

@HbmFilterDef(filterName = "filterOrganization")
public class Product extends EntityDetailSupport implements SoftDeletable, DescribedUniqueFieldValueObject, BinaryContainer {


/**
 * This class represents a product item.
 * 
 * Note:
 * <ul>
 * <li>The product does not have dimensions. These are only at the shipment level.</li>
 * <li>The product does have a value</li>
 * </ul>
 */
public class ProductItemVO extends LogisticsOrderVO implements StringSequencedEntity {
	public ProductItemVO(Product aProduct) {
		this();
		setProductVO(aProduct);


/**
 * Packed item. Represents a part of a shipment for a single type of product. It describes the quantity of the product
 * as well as the product itself.
 */
public class PackedItemVO extends ValueObject {
	public PackedItemVO(ProductItemVO aProduct, BigDecimal aQuantity) {
		setProductItemVO(aProduct);
		setQuantity(aQuantity);

/ Einde Intermezzo


/ Intermezzo

public enum EntityType {
	CONSIGNMENT,
	CONTAINER,
	CTP_RESOURCE,
	CUSTOMER_CONTRACT,
	CUSTOMER_ORDER,
	CUSTOMER_ORDER_LINE,
	PARTY,
	PRODUCT,
	PRODUCT_ITEM,
	RECEIPT,
	SERVICE_ACTION,
	SERVICE_ORDER,
	SHIPMENT_ITEM,
	SHIPMENT_ORDER,
	SUPPLIER_CONTRACT
}


/ Einde Intermezzo

/ Intermezzo

/ op een shipmentorder zien we 
Extra fields = entity details

/ beneden	,
onder tab shipmentitem 	,
Shipment Item Packed Items
/ packed item=verdeling van de product items(producten) over de shipment items(=dozen)

/ Einde Intermezzo

/s
/ tx
EntityDetailServiceImpl.initialize(EntityDetailSupport) line: 125	
		List<EntityDetailType> myList = getDAO().getByEntity(anEntityDetailSupport.getEntity());
/s
EntityDetailServiceImpl.getDAO() line: 153	
		return MpoBeanFactory.getBean(EntityDetailTypeDAO.class);
/t
/s
ProductItemVO.getEntity() line: 702	
/ TODO
		return EntityType.PRODUCT_ITEM;

/s
EntityDetailTypeDAOImpl.getByEntity(EntityType) line: 35	
	public List<EntityDetailType> getByEntity(EntityType anEntity) {
anEntity	EntityType  (id=23786)	

		List<EntityDetailType> myTypeList = getHibernateTemplate().findByCriteria(
				DetachedCriteria.forClass(EntityDetailType.class).add(Property.forName("entity").eq(anEntity)).add(Property.forName("deleted").eq(false)));
[]
/ want	,
pnloms=# select distinct( entity )from entity_detail_type;
     entity     
----------------
 SHIPMENT_ORDER
 SHIPMENT_ITEM
(2 rows)

/t
EntityDetailServiceImpl.initialize(EntityDetailSupport) line: 127	
		if (myList.isEmpty()) {
			return;

/t
ShipmentOrderEditAction.act() line: 94	
				MpoBeanFactory.getBean(EntityDetailService.class).initialize(myProductItem);
myProductItem	ProductItemVO  (id=27083)	
	entityDetails	HashMap  (id=27086)	
{}

			String showCustomerOrderId = ApplicationPropertyManager.getInstance().getModuleProperty("oms", "productitem.showcustomerorderid", null);
/s
ApplicationPropertyManager.getModuleProperty(String, String, String) line: 367	
aModule	"oms" (id=27131)	
aKey	"productitem.showcustomerorderid" (id=27134)	
aDefaultValue	null	
		return getProperty(getPropertyKey(aModule, aKey), aDefaultValue);
getPropertyKey(aModule, aKey)=module.oms.productitem.showcustomerorderid
/s
ApplicationPropertyManager.getProperty(String, String) line: 520	
		String myReturnValue = null;
		Resource myResource = AuthenticationUtils.getResource();
Resource:eric(systemId:26681004)
		if (myResource != null) {
			myReturnValue = myResource.getProperty(aKey);
null
			if (myReturnValue == null) {
				myReturnValue = getDatabaseProperty(aKey, null);
/s
ApplicationPropertyManager.getDatabaseProperty(String, String) line: 641	
			if (dbProperties == null) {
/ NEE
				loadDatabaseProperties();
			}
			return dbProperties.getProperty(aKey, aDefaultValue);
			}
		}
/t
ApplicationPropertyManager.getProperty(String, String) line: 520	
				myReturnValue = getDatabaseProperty(aKey, null);
/d
		if (myReturnValue == null) {
/ JA
			myReturnValue = getApplicationProperty(aKey, aDefaultValue);
/s
ApplicationPropertyManager.getApplicationProperty(String, String) line: 205	
		return theProperties.getProperty(aKey, aDefaultValue);

/ Intermezzo

this	ApplicationPropertyManager  (id=27098)	
/ .theProperties=
{module.inventory.shipmentorderconsolidationrequest.concurrentConsumers=1,
 module.login.nonloggable.users=all-admin,
 module.oms.userreferences.visible=true,
 module.oms.shipmentorder.requestedEndAfter.required=true,
 module.oms.serviceorder.sealnumber.hidden=true,
 module.ratecalc.startend.default.date=,
 module.ratecalc.serviceorder.ratecalculation.execution=auto,
 module.oms.customerorder.show.serviceorder=true,
 module.login.number.attempt=3,
 module.dashboard.business.hours=9-17,
 module.oms.recalculate.shipmentorder.interval=10,
 module.oms.interface.shipmentorder.party.from.mode=optional_lookup, release.number=00,
 module.oms.dashboard.serviceorder.totalRequestedColli.hidden=true,
 module.customerinvoice.jms.queue=CUSTOMER_INVOICE.QUEUE,
 module.oms.serviceorder.reference2.hidden=true,
 module.core.listinput.calschedule.selector.onclick=return mpobjects.ui.selectors.schedule('[name]');,
 module.oms.tablefilter.greater.shipment-order-booking-search.shipment-item-list-track.system_entry_date=W3,
 module.inventory.shipmentorderconsolidationupdate.maxConcurrentConsumers=1,
 module.core.dynatable.shipment-status-overview-in-warehouse.crossdock-dashboard-serviceaction-list.filter.cache=none,
 module.oms.shipmentitemsearch.reference2.hidden=true,
 test.local-mode=false,
 module.login.fallback.enabled=false,
 module.oms.shipmentorder.match.requested.adr.code=true,
 module.core.importexport.version=0,
 module.interfacing-activemq.jms.redelivery.backoff.multiplier=5,
 module.oms.productitem.reference12.hidden=true,
 module.oms.customerorderline.id.format=COL%08d,
 module.core.httpclient.conn.maxtotal=200,
 module.oms.shipmentorder.recalculate.requested.volume=true,
 module.core.listinput.reasoncode.selector.onclick=return mpobjects.ui.selectors.reasoncode('[name]');,
 module.oms.massupdate.maxConcurrentConsumers=1,
 module.bizzdec.consolidation.relaxEndDate=false,
 module.oms.serviceorder.query.maxresults=2000,
 module.login.password.notification.days=14,
 module.oms.serviceorder.tab.documents.enabled=true,
 module.oms.productitemsearch.reference10.hidden=true,
 module.core.dynatable.service-order.service-order.filter.cache=none,
 report.email.zip.threshold=5242880, application.id=pnloms,
 module.oms.carrierevent.event.inducer.visible=false,
 module.oms.shipmentitem.weightmode=COMPUTED_OVER_WEIGHT,
 module.interfacing.localpeer.username=all-admin,
 module.core.listinput.invoiceheaderstatus.selector.onclick=javascript:var mySelector = new GenericSelector('[type]', 'invoice'); mySelector.addFieldMapping('[name]', 'code');mySelector.show();return false;,
 module.core.listinput.organization.selector.view.size=11,
 module.core.proxy.host=,
 module.oms.shipmentitem.casenumber.hidden=true,
 module.oms.shipmentorder.replanbutton.enabled=true,
 ant.home=/usr/share/ant,
 module.oms.shipmentorder.purposecode.pattern.original=,
 module.login.password.complexity.specialchars.users=true ,
 module.oms.container.containerid.format=CO%03d,
 module.core.model.volumefield.unit.from.expression=${volume},
 module.core.listinput.paymentaccount.selector.onclick=javascript:var mySelector = new GenericSelector('[type]', 'invoice'); mySelector.addFieldMapping('[name]', 'account_name');mySelector.show();return false;,
 module.oms.shipmentorder.packaging.mode=nested,
 module.core.listinput.shippingunit.selector.onclick=return mpobjects.ui.selectors.shippingunit('[name]');,
 module.oms.inbound.shipmentorder.setholdstatus.default=true,
 module.oms.inbound.shipmentorder.columndefinition=incoTerm.code, preferredParty.partyId, invoicePartyId, invoiceParty, toLocationId, toParty, fromLocationId, fromParty, reference2, shipmentOrderId, productId, partNumber, firstProductItemReference2, firstProductItemQuantity, , shipmentItemList, requestedDepartureAfter, requestedDepartureBefore, requestedArrivalAfter, billToParty, executedByParty.code, serviceOrderId, orderStatus.code, customerStatus.name, incoTerm.code, confirmedCollectionDate, pickupRequestTimestamp, supplierRequestedCollectionDate, holdStatus.code, description, remarks,
 module.oms.serviceorder.planneddistance.hidden=true,
 module.core.listinput.instructiongroup.selector.onclick=return mpobjects.ui.selectors.instructiongroup('[name]');,
 module.core.listinput.serviceordertype.selector.onclick=return mpobjects.ui.selectors.serviceordertype('[name]');,
 module.core.model.volumefield.unit.code=M3,
 module.oms.productitemsearch.reference9.hidden=true,
 module.oms.interface.default.shipping.organisation=3000,
 module.oms.party.query.errorresultcount=79999,
 module.invoice.message.sending_application=PNLOMS.SEND,
 module.core.listinput.financialparty.selector.onclick=javascript:var mySelector = new GenericSelector('[type]',
 'invoice'); mySelector.addFieldMapping('[name]',
 'financial_party_id');mySelector.show();return false;,
 module.oms.schedule.entry.included.day_in_week.hidden=false,
 module.interfacing.jms.jmsConnectionFactory.maxConnections=30,
 module.core.dynatable.anomalies.shipment-order.filter.cache=none,
 module.oms.shippingunits.usetranslationkey=false,
 module.oms.carrierevent.event.reasoncode.visible=false,
 module.interfacing.jms.server.url=tcp://localhost:61616,
 module.inventory.shipmentorderconsolidationupdate.concurrentConsumers=1,
 module.oms.entitydetails.space.as.initial.value=false,
 module.oms.export.shipment.order.with.payweight=false,
 module.oms.shipmentorder.reference7.hidden=false,
 application.info=PNL OMS is a world wide web system for Supply Chain Execution Optimization. Shippers and LSPs value the benefits from higher levels of Agility, Velocity, Efficiency and Compliancy. The system optimizes Inbound, Outbound, Return and Fulfillment processes for dynamic supply chain services. PNL OMS has unique features for Order Planning, Execution Monitoring, Financial Control and Performance Reporting.,
 module.interfacing.directoryproc.concurrency=1,
 module.oms.massupdate.shipmentorder.remarks.hidden=false,
 module.carconclient.carconserver.baseurl.test=http://localhost:8480/carcon,
 module.omscarcon.event.fetcher.organisation.filter=cancel,
 module.dashboard.column.threshold.tooltip=Can include <, <=, >, >=,
 module.core.listinput.customerorderline.selector.view.size=19 ,
 module.oms.carrierinvoice.copy.invoiceorganization.to.organization=true,
 module.core.listinput.country.uppercase=true,
 module.invoice.lookup.logisticsorderreference.serviceordertype=DELIVERY,
 module.bizzdec.serviceorder.ratebased.selection=true,
 module.oms.should.check.for.update=true,
 module.oms.productitemsearch.reference4.hidden=true,
 module.mpo.main.page.development=/tms/core/index_frameset,
 module.oms.recalculate.batch.maxsize=0,
 module.oms.shipmentorder.requestedendbefore.hidden=false,
 module.oms.shipmentordercostpart.create.factorbasetype=KG,
 module.oms.export.service.order.with.events=false,
 module.oms.serviceorder.tab.event.delete.hidden=true,
 module.core.export.report.config.2012.02=Report_2012.02.xml,
 module.core.export.role.config.2012.02=Role_2012.02.xml,
 module.oms.dashboard.serviceorder.totalRequestedVolume.hidden=true,
 module.invoice.matching.surcharge.calculate=true,
 module.ratecalc.skiprecalc.serviceorder.types=MRN,
 module.oms.shipmentorder.recalculate.requested.custom.enabled=false,
 test.serverid=default,
 module.oms.serviceorder.plannedstartbefore.hidden=false,
 type.mapping=Postgres,
 module.core.listinput.partytype.selector.onclick=javascript:var mySelector = new GenericSelector('[type]', 'oms'); mySelector.addFieldMapping('[name]',
 'code'); mySelector.show();return false;,
 module.core.listinput.shipmenttype.selector.onclick=return mpobjects.ui.selectors.shipmenttype('[name]');,
 pnloms.welcome_first_paragraph=Welcome to PostNL Order Management System,
 module.invoice.lookup.logisticsorderreference.enabled=true,
 module.oms.productitem.tab.planinfo.disabled=true,
 module.invoice.invoiceheader.marknumber.numeric=true,
 module.core.listinput.party.uppercase=false,
 module.oms.serviceorder.tab.event.carrierremarks.hidden=true,
 module.oms.massupdate.shipmentorder.columndefinition=productModel, productSeries, holdStatus.code, remarks, toLocationId, serviceOrderId, preferredParty.partyId, incoTerm.code, actServiceLevel.code, fromParty, toParty, orderStatus.code, reference4, reference7, reference9, shipmentOrderId, productId, firstProductItemQuantity, firstProductItemReference2, requestedDepartureAfter, requestedDepartureBefore, requestedArrivalAfter, module.scannerinterface.logisticsevent.type.linehaul=LINEHAUL,
 module.oms.shipmentorder.timewindowbutton.enabled=false,
 module.core.export.pathtemplate.exportversion=2013.03,
 module.interfacing-activemq.jms.server.url=${module.interfacing.jms.server.url},
 module.oms.shipmentorder.payweight.hidden=true,
 module.login.fallback.default.passthrough.users=all-admin, jnj-admin,
 module.ratecalc.calculation.debug.log=true,
 module.oms.shipmentorder.reference10.hidden=false,
 module.mpo.main.page.acceptance=/mpo/core/index_frameset,
 module.login.password.minimumage=1,
 module.interfacing.jmsdirectoryprocessor.transaction.timeout=1800,
 module.invoice.invoiceheader.vat.check=true,
 module.oms.sms.port.acceptance=3128,
 module.invoice.lookup.logisticsorderreference.mustexist=false,
 module.mpo.main.page.production=/mpo/core/index_frameset,
 module.oms.massupdate.shipmentorder.setholdstatus.default=true,
 module.emailnot.export.service.order.pickup.end=WSL-FI-VA, WSL-GEN, WSL-GEN, WSL-NL-ZW, WSL-FI-VA, WSL-NL-MO, WSL-NL-DR, WSL-SE-GO, WSL-NO-RU, WSL-FR-MU, WSL-FR-SU, WSL-CH-WI, WSL-IT-TR,
 module.core.listinput.currency.uppercase=true,
 module.oms.sms.port.production=3128,
 module.oms.shipmentorder.cashondelivery.hidden=true,
 module.oms.interfacetriggerevent.plan_service_action.maxmessages=300,
 module.oms.applicationfilter.list=service-order.service-order.status,
 module.oms.massupdate.shipmentorder.preferredparty.hidden=false,
 module.interfacing-activemq.jms.server.username=${module.interfacing.jms.server.username},
 helpdesk.number=+31 10 2900306,
 module.oms.shipmentitemsearch.reference6.hidden=true,
 module.event.dashboard.columndefinition=reportingLevel, serviceOrderVO.serviceOrderId, serviceAction.shipmentOrderVO.refe...


/ Einde Intermezzo

			myReturnValue = getApplicationProperty(aKey, aDefaultValue);
false
		return StringUtils.trimIfNotEmpty(myReturnValue);


/ Intermezzo

	private void loadDatabaseProperties() {
			dbProperties = new Properties();
			List<PropertiesValueVO> myList = MpoBeanFactory.getBean(PropertiesValueDAO.class).getAllWithoutOrgAndUser();
			for (PropertiesValueVO myProp : myList) {
				String myCode = myProp.getProperty().getCode();
				String myValue = myProp.getPropertiesValueValue();
				if (myValue == null) {
					myValue = "";
				}
				if (myCode != null) {
					dbProperties.put(myCode, myValue);
				}

hibernate-mapping>
	<class name="com.mpobjects.oms.model.propertiesvalue.vo.PropertiesValueVO" table="PROPERTIES_VALUE">

dbProperties=
{module.oms.instructions.enabled=true,
 module.oms.dashboardshipmentorderlist.price.hidden=true,
 module.event.serviceorderlist.serviceactiontypes=DELIVERY,
 module.oms.productitem.reference5.hidden=false,
 module.optimize.ratingrequest.billto.hidden=true,
 module.oms.serviceorder.releasedates.hidden=false,
 module.oms.customerorderline.id.format=COL%08d,
 module.login.sessiontimeout.user=30,
 module.oms.shipmentorder.margin.hidden=true,
 module.optimize.ratingrequest.startdate.hidden=false,
 module.oms.shipmentorder.requestedtotalvalue.readonly=false,
 module.oms.recurring.shipmentorder.id.pattern=-yyyyMMdd,
 module.oms.dashboardshipmentorderlist.margin.hidden=true,
 module.optimize.ratingrequest.enddate.hidden=false,
 module.optimize.ratingrequest.leadtime.enabled=true,
 module.optimize.ratingrequest.toparty.required=false,
 module.optimize.ratingrequest.disclaimer=This quotation can only be used as a guideline based on information entered and that due to additional restrictions and unforeseen circumstances the actual costs might vary from the costs indicated in the quotation tool. Rates will be general cargo rates based on weight and packaging dimensions that fall within the carrier's restrictions. *** WARNING ***,
 module.oms.shipmentorder.remarks2.hidden=false,
 module.oms.customerorder.id.format=CO%09d,
 module.oms.customerorder.lookup.fields.hidden=false,
 module.oms.shipmentorder.orderprocess.readonly=false,
 module.optimize.ratingrequest.costgroups=Freight, Fuel,
 module.oms.shipmentorder.orderprocess.hidden=false,
 module.optimize.ratingrequest.default.preferred.partyid=ALL,
 module.oms.serviceorder.freecapacityvolume.hidden=true,
 module.interface.should.interface.serviceorder.costs=true,
 module.oms.serviceorder.capacitymanagement.hidden=true,
 module.oms.serviceorder.release.prevent.holdstatus=REVIEW_HOLD,
 module.oms.serviceorder.freecapacityweight.hidden=true,
 module.oms.schedule.entry.included.difference.hidden=false,
 module.optimize.ratingrequest.shippingunit.default=RC,
 module.emailnot.shipping.report.delay=0,
 module.oms.serviceorder.remarks2.hidden=false,
 module.login.sessiontimeout.admin=30,
 module.optimize.ratingrequest.pricegroups=Freight, Fuel,
 module.optimize.ratingrequest.incoterm.excludefilter=2000,
 module.optimize.ratingrequest.fromparty.required=false,
 searchlist.shipment-order-template.start.empty=false,
 module.event.export.original=true,
 module.optimize.ratingrequest.markup.percentage=0,
 module.oms.shipmentorder.customerstatus.hidden=false,
 module.oms.productitem.recalculate.requested.weight=true,
 module.oms.shipmentorder.airport.hidden=true,
 module.oms.serviceorder.freecapacityldm.hidden=true,
 module.oms.shipmentorder.incotermsreference.hidden=true,
 module.optimize.ratingrequest.startdate.exclude.days=SATURDAY, SUNDAY,
 module.oms.shipmentorder.incoterm.default=DDU,
 module.oms.shipmentorder.salesorganization.hidden=true,
 module.oms.incoterm.version.enabled=false,
 module.optimize.ratingrequest.carrierinfo.enabled=true,
 module.oms.dashboard.releaseServiceOrder.show=true}

/ Einde Intermezzo


/ Intermezzo

/ welke shipment orders hebben shipment items?

pnloms=# select distinct(si.shipment_order_systemid),so.shipment_order_id from shipment_item si join shipment_order so  on si.shipment_order_systemid=so.system_id;
 shipment_order_systemid | shipment_order_id 
-------------------------+-------------------
                26680404 | S040317361
                26680316 | SH000000124
                26680327 | 0040317361
                26680288 | SH000000123
                26674249 | POSTNL0001
                26680370 | 3040317361
                26674287 | POSTNL0002
                26673492 | SH000000108
                26674303 | POSTNL0003
                26680353 | 2040317361
                26673469 | SH000000107
                26674365 | POSTNL0004
                26680261 | SH000000122
                26678886 | TEST-JVM1
                26680090 | POSTNL0005
(15 rows)

/ Deze is OK	,
                26680261 | SH000000122

/ we zien 2 shipment items	,
pnloms=# select count(*)from shipment_item si join shipment_order so on si.shipment_order_systemid=so.system_id where so.shipment_order_id='SH000000122';
 count 
-------
     2
(1 row)
pnloms=# select si.shipment_item_id from shipment_item si join shipment_order so on si.shipment_order_systemid=so.system_id where so.shipment_order_id='SH000000122';
 shipment_item_id 
------------------
 010
 020
(2 rows)



/ Einde Intermezzo

/t
ShipmentOrderEditAction.act() line: 99	
			String showCustomerOrderId = ApplicationPropertyManager.getInstance().getModuleProperty("oms", "productitem.showcustomerorderid", null);
/d
"false"
			getRequest().setAttribute("hasCustomerOrderId", BooleanUtils.isTrue(showCustomerOrderId));

			// a hack to get the save and close button working correctly
			Object myHack = getSession().getAttribute(com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderSaveAction.GO_BACK_ON_SAVE_AND_CLOSE);
null
			if (myHack != null) {

			// another hack
			Collection<String> myRoleNames = new ArrayList<String>();
			for (RoleVO myRoleVO : ResourceUtil.getResource().getRoles()) {
SystemId:10100	Name:ADMINISTRATOR	Description:Administrator
				myRoleNames.add(myRoleVO.getCode());
ADMINISTRATOR

			boolean hasSavePermission = myRoleNames.contains("INVOICING") || myRoleNames.contains("FINANCE");
false
			getRequest().setAttribute("hasSavePermission", hasSavePermission);

			if (ApplicationPropertyManager.getInstance().getModuleProperty("oms", "tracing.enabled", false)) {
/ JA
				logs = MpoBeanFactory.getBean(Tracer.class).getEntries(TracerSubject.SHIPMENT_ORDER, myVO.getSystemId());
[com.mpobjects.core.tracing.TraceEntry@2324c2f0,
 com.mpobjects.core.tracing.TraceEntry@427a2c96,
 com.mpobjects.core.tracing.TraceEntry@63054df2,
 com.mpobjects.core.tracing.TraceEntry@71407da7,
 com.mpobjects.core.tracing.TraceEntry@40f99907,
 com.mpobjects.core.tracing.TraceEntry@42adbbe4,
 com.mpobjects.core.tracing.TraceEntry@1c0a97ef]
/ TODO

			getRequest().setAttribute("tracingLogs", logs);
			getSession().setAttribute("builder", ShipmentOrderUtil.getBuilder(myVO));
/s
ShipmentOrderUtil.getBuilder(ShipmentOrderVO) line: 26	
		String myClass = "jsp";
		// Select the screen
		String myProperty = ApplicationPropertyManager.getInstance().getOrganizationProperty(aShipmentOrder.getOrganization(),
				"module.oms.shipmentorder.edit.screen.builder", myClass);
/ aShipmentOrder=ShipmentOrder: SH000000122(SystemId:26680261; Org:PNL-OMS-DEM)
/ aShipmentOrder.getOrganization()=SystemId:1010	Id:PNL-OMS-DEM	Description:Post NL Demand
SystemId:1010	Id:PNL-OMS-DEM	Description:Post NL Demand
/s
ApplicationPropertyManager.getOrganizationProperty(Organization, String, String) line: 429	
			return getProperty(anOrganization.getSystemId(), aKey, aDefaultValue);
/s
ApplicationPropertyManager.getProperty(int, String, String) line: 447	
aPreferedOrganizationSystemid	1010	
aPropertyKey	"module.oms.shipmentorder.edit.screen.builder" (id=28301)	
aDefaultValue	"jsp" (id=28140)	

		String myRet = NOTSET;
		Resource myActiveResource = AuthenticationUtils.getResource();
Resource:eric(systemId:26681004)
		if (myActiveResource != null) {
			myRet = myActiveResource.getUserProperty(aPropertyKey, NOTSET);
"notset"
		if (NOTSET.equals(myRet)) {
			myRet = getOrganizationProperty(aPreferedOrganizationSystemid, aPropertyKey, NOTSET, true);
aPropertyKey	"module.oms.shipmentorder.edit.screen.builder" (id=28301)	
/s
ApplicationPropertyManager.getOrganizationProperty(int, String, String, boolean) line: 385	
		String myRet = myOrganization.getProperty(aPropertyKey, aDefaultValue);
aPropertyKey	"module.oms.shipmentorder.edit.screen.builder" (id=21039)	
/s
Organization.getProperty(String, String) line: 112	
mappedProperties	HashMap  (id=21282)	
{module.oms.recurring.shipmentorder.schedule.horizon.hours=com.mpobjects.oms.model.propertiesvalue.vo.PropertiesValueVO@3a681a0a[systemId=26680240,property=module.oms.recurring.shipmentorder.schedule.horizon.hours - recurring.shipmentorder.schedule.horizon.hours/false,value=72]}

		return aDefaultValue;
/t
ApplicationPropertyManager.getOrganizationProperty(int, String, String, boolean) line: 409	
		String myRet = myOrganization.getProperty(aPropertyKey, aDefaultValue);
/d
		return myRet;
/t
ApplicationPropertyManager.getProperty(int, String, String) line: 456	
		if (NOTSET.equals(myRet)) {
			myRet = getOrganizationProperty(aPreferedOrganizationSystemid, aPropertyKey, NOTSET, true);
/d
"notset"
/ TODO

		if (NOTSET.equals(myRet)) {
			myRet = getDatabaseProperty(aPropertyKey, NOTSET);
"notset"
		if (NOTSET.equals(myRet)) {
			myRet = getApplicationProperty(aPropertyKey, aDefaultValue);
aPropertyKey	"module.oms.shipmentorder.edit.screen.builder" (id=21039)	
"jsp"

/t
ShipmentOrderUtil.getBuilder(ShipmentOrderVO) line: 33	
		if (!StringUtils.isEmpty(myProperty)) {
			myClass = myProperty;
		}
		return myClass;
"jsp"

/t
ShipmentOrderEditAction.act() line: 126	
			getSession().setAttribute("builder", ShipmentOrderUtil.getBuilder(myVO));
/d
ShipmentOrderUtil.getBuilder(myVO)="jsp"

			getSession().setAttribute("systemId", myVO.getSystemId());


/ Intermezzo



/ Einde Intermezzo









/ Einde DEBUG APPLICATION FOR PNL-378

/ MPO-73

/ N0003039 	, we zien onder service actions meerdere sho's , en in alle sho zien we rechts de consignment , 
/ we zien dat multiple sho's in een consignment zitten 	, 

/ Einde MPO-73

/ POSTGRES FIREBIRD

SQL> insert into y values('foo and ''bar''');
SQL> select*from y;
foo and 'bar' 

/ Lees	,
http://stackoverflow.com/questions/12316953/insert-varchar-with-single-quotes-in-postgresql
/ refs	,
http://www.postgresql.org/docs/current/interactive/sql-syntax-lexical.html#SQL-SYNTAX-DOLLAR-QUOTING
foo=> create table q(s text);
foo=> insert into q values($$'''''''''$$);
/ of	,
foo=> insert into q values($foo$'''''''''$foo$);





/ Einde POSTGRES FIREBIRD

/ PNL-314 WICKET

/ 7	.

/ index_framset.jsp

/ er is ook menu.jsp	,

/ we geven normaal	,
http://localhost:8080/tms/core/index_frameset
/ maar ook kan	,
http://localhost:8080/tms/core/menu
/ en 	,
http://localhost:8080/tms/core/welcome

/ 7	.

/ ga naar Support, Edit profile	,
/ Daar kunnen we de locale van mij (de logged in user) set,
/ Save and close,
/ click F5 = reload de page	,
/ we zien de menu updated	,

/ als we de locale veranderen in 	,
configuration, administration, admin users
/ dan moeten we eerst uitloggen en weer inloggen	, dan zien we e menu updated	, 

/ bij wicket: WicketLanguageManager	, 
/ we zouden itt bij menu na locale set bij Support, Edit profile, moeten uitloggen, inloggen	, dan zouden de labels goed moeten staan	,
/ TODO

/ 7	. 

/ Zoek in mail naar WicketLanguageManager.

/ In email over ISB-778 ( 28 Jan) tantely explained me	,

I also have another question. About ResourceModel. The key/values are in language_en.properties (on my machine). How is this file found? Because in my wicket book the properties files are where the java and html file are.
Maybe in the wicket application file you can set this. But I see multiple of this files. I see ExtendedWicketWebApplication.java and WicketWebApplication.java. Which one is taken and why?

You can look at WicketLanguageManager and where it's used.
It's our custom implementation to override Wicket's default behaviour (where indeed we are using the files located next to the Java files).

In WicketWebApplication I see ApplicationUtils, in whiich I see WicketLanguageManage. Thanks. 
I still have one question: is WicketWebApplication or ExtendedWicketWebApplication used? And how do you say which one when there are multiple of these files?


/ In andere email (20 nov)	,

I usually use StringResourceModel as this will use the WicketLanguageManager.
ResourceModel doesn't, as far as I remember, (and therefore will use the .properties files which are located next to the .java ones).

It's actually easier to use com.mpobjects.view.wicket.util.LocalizationUtil which is a shortcut.

Then you simply need to use a translation.key and put the translation in one of the main .properties files.



/ Einde PNL-314 WICKET

/ DEBUG PNL-314 WICKET

/ 7	. 

/ we set b in ApplicationUtils.init	,

/ we start de appl, 	
/ stacktrace	, 
	ApplicationUtils.init(WebApplication) line: 51	
	ExtendedWicketWebApplication.init() line: 85	
	WicketFilter.init(FilterConfig) line: 726	
	WicketServlet.init() line: 219	
	WicketServlet(GenericServlet).init(ServletConfig) line: 211	
	StandardWrapper.loadServlet() line: 1105	
	...
/s
ExtendedWicketWebApplication.init() line: 85	
	protected void init() {
		super.init();
		ApplicationUtils.init(this);
/s
ApplicationUtils.init(WebApplication) line: 54	
/=
	public static void init(WebApplication anApplication) {

		ApplicationServerType serverType = ApplicationPropertyManager.getInstance().getApplicationServerType();
/s
ApplicationPropertyManager.getApplicationServerType() line: 216	
		if (applicationServerType == null) {
/ JA
			String env = getSystemProperty(SCS_SERVER_TYPE_ENV_PARAMETER, null);
			if (env == null) {
/ JA
				env = getSystemProperty(TMS_SERVER_TYPE_ENV_PARAMETER, null);
development

/ Intermezzo

ApplicationPropertyManager
	public static final String TMS_SERVER_TYPE_ENV_PARAMETER = "TMS_SERVER_TYPE";

[eric@localhost 2014.01_mpo]$ env | grep TMS_SERVER_TYPE
TMS_SERVER_TYPE=development
/ set in ~/.bashrc	,

/ Einde Intermezzo

			}
			if (env != null) {
				applicationServerType = ApplicationServerType.parse(env);
/ pakt de juiste enum	,

serverType	ApplicationServerType$2  (id=864)	
development

/ Intermezzo

public enum ApplicationServerType {
	DEVELOPMENT {
		@Override
		public String toString() {
			return "development";
		}
	},

/ Einde Intermezzo

		IResourceSettings myResourceSettings = anApplication.getResourceSettings();
/ calls org.apache.wicket.Application.getResourceSettings()	,
/ Dit doe je om ze aan te passen	,

		// Add new
		myResourceSettings.addStringResourceLoader(4, new LanguageManagerStringResourceLoader());
/s

/ er zijn 
LanguageManager.java
LanguageManagerStringResourceLoader.java

/ 7		. 

/ Daarna	, 
WicketWebApplication.init
	ApplicationUtils.init	,

/ we geven continue	, 
/ de applicatie is started	,

/ 7	. 

/ CUSTOM TAG

/ we geven de url http://localhost:8080/tms/core/index_frameset	,  
/ dan wordt LanguageManager called	,

login_form.jsp line: 41	

<%@taglib uri="http://www.mp-objects.com/taglibs/mpo" prefix="mpo" %>

			<form id="loginForm" action="../j_spring_security_check" method="post">
				<dl>
->					<dt><mpo:label name="userId" /></dt>

/ Intermezzo

$ vi mpo.tld
<taglib>
	<tag>
		<name>label</name>
		<tagclass>com.mpobjects.view.taglib.LabelTag</tagclass>
		...

/ Einde Intermezzo

/s
LabelTag.doStartTag() line: 41	
		String myString = getLanguageManager().getByJavaName(theEntity, theName);

/s
LabelTag(TagBase).getLanguageManager() line: 45	
		if (theLanguageManager == null) {
			theLanguageManager = new LanguageManager(getRequest());
/s
LanguageManager.<init>(HttpServletRequest) line: 75	
/=
	public LanguageManager(HttpServletRequest aRequest) {
aRequest	JSPEngineServletRequest  (id=15482)	
		setLocale(LocaleUtils.getActiveLocale());
/s
	/**
	 * @return The active user locale. This could be a user defined locale, or otherwise the system's default locale.
	 */
LocaleUtils.getActiveLocale() line: 59	
		ScsUserDetails ud = AuthenticationUtils.getUserDetails();
/s
AuthenticationUtils.getUserDetails() line: 44	
		Authentication auth = SecurityContextHolder.getContext().getAuthentication();
/ org.springframework.security.core.context.SecurityContextHolder
auth	AnonymousAuthenticationToken  (id=16793)	
org.springframework.security.authentication.AnonymousAuthenticationToken@90514580: Principal: anonymousUser; Credentials: [PROTECTED]; Authenticated: true; Details: org.springframework.security.web.authentication.WebAuthenticationDetails@43458: RemoteIpAddress: 0:0:0:0:0:0:0:1; SessionId: 1llua8yc8hq0d14hmf8vs3f621; Granted Authorities: ROLE_ANONYMOUS
		if (!isAuthenticated(auth)) {
/ JA
			return null;

/t
LocaleUtils.getActiveLocale() line: 60	
		ScsUserDetails ud = AuthenticationUtils.getUserDetails();
/d
null
		return getSystemLocale();
/s
LocaleUtils.getSystemLocale() line: 110	
		if (systemLocale == null) {
/ JA
			try {
				ApplicationPropertyManager props = ApplicationPropertyManager.getInstance();
				String language = props.getApplicationProperty("locale.language", "");
""
				String country = props.getApplicationProperty("locale.country", "");
""
				String variant = props.getApplicationProperty("locale.variant", "");
""
				if (StringUtils.isNotEmpty(language)) {
/ NEE
			if (systemLocale == null) {
/ JA
				systemLocale = Locale.UK;
/ java.util.Locale.UK
		return systemLocale;

/t
LanguageManager.<init>(HttpServletRequest) line: 75	
		setLocale(LocaleUtils.getActiveLocale());
/s
	public void setLocale(Locale aLocale) {
		theLocale = aLocale;
		makeDirty();

/t
LanguageManager.<init>(HttpServletRequest) line: 75	
		setLocale(LocaleUtils.getActiveLocale());
/d
		getPropertiesFile();
////////////////////
/ writes this.propertiesFiles=HashMap{"en_GB":language_en.properties}

/ Intermezzo

/ Samenvatting LanguageManager.getPropertiesFile voor de login	, 

/ aLocale=Locale.UK	, =en_GB	,

////////////////
/ belangrijk is getPropertiesFilename(Locale.UK)=language_en.properties	,  

	protected Properties getPropertiesFile(Locale aLocale) {
		Map<Locale, Properties> myPropertiesFiles = getPropertiesFiles();
{}
		if (myPropertiesFiles.containsKey(aLocale)) {
/ NEE
		} else {
			File myFile = getPropertiesFilename(getLocale());
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms/conf/language_en.properties

			if (myFile.isFile()) {
				if (propertiesFiles.containsKey(DEFAULT_LOCALE)) {
/ NEE
				} else {
					myRet = PropertiesUtil.loadProperties(myFile);
				}

			getPropertiesFiles().put(getLocale(), myRet);
/ en_GB:language_en.properties

	protected File getPropertiesFilename(Locale aForLocale) {
		File result = new File(String.format("%s%s.properties", getLanguageFilePrefix(), aForLocale.toString()));
		if (result.exists()) {
/ NEE
		if (!org.apache.commons.lang3.StringUtils.isBlank(aForLocale.getVariant())) {
			alt = new File(String.format("%s%s.properties", getLanguageFilePrefix(), aForLocale.getVariant()));
			if (alt.exists()) {
/ NEE
		alt = new File(String.format("%s%s.properties", getLanguageFilePrefix(), aForLocale.getLanguage()));
		if (alt.exists()) {
			return alt;

/ bijv en_GB_pnloms: pnloms is een variant	,

/ Einde Intermezzo

/ Intermezzo

/ Geef in Display view	,
System.out.println(myRet)	, 
/ see Console view	, cp naar LOG_getPropertiesFile.txt	,
/ we zien	,
shipmentorder.to.party.city=To City,
shipmentorder.to.party.postalcode=To Postal Code,
shipmentorder.to.party.name=To Party,


/ Einde Intermezzo



/s
LanguageManager.getPropertiesFile() line: 469	
		Map<Locale, Properties> myPropertiesFiles = getPropertiesFiles();
/= propertiesFiles
{}
		if (myPropertiesFiles.containsKey(getLocale())) {
/ NEE
		} else {
			File myFile = getPropertiesFilename(getLocale());
/s
LanguageManager.getPropertiesFilename(Locale) line: 503	
/=
	protected File getPropertiesFilename(Locale aForLocale) {
		File result = new File(String.format("%s%s.properties", getLanguageFilePrefix(), aForLocale.toString()));
/s
	public String getLanguageFilePrefix() {
		return theLanguageFilePrefix;
theLanguageFilePrefix	"/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms/conf/language_" (id=16896)	
/t
aForLocale	Locale  (id=16876)	
en_GB

/ Intermezzo

LanguageManager
	private String theLanguageFilePrefix = JBossEnvironment.getConfigurationRoot() + "/conf/language_";

/ Einde Intermezzo

/t
LanguageManager.getPropertiesFilename(Locale) line: 503	
		File result = new File(String.format("%s%s.properties", getLanguageFilePrefix(), aForLocale.toString()));
/d
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms/conf/language_en_GB.properties

		if (result.exists()) {
			return result;
/ NEE
		if (!org.apache.commons.lang3.StringUtils.isBlank(aForLocale.getVariant())) {
/ NEE

		alt = new File(String.format("%s%s.properties", getLanguageFilePrefix(), aForLocale.getLanguage()));
aForLocale.getLanguage()="en"
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms/conf/language_en.properties
		if (alt.exists()) {
			return alt;

/t
LanguageManager.getPropertiesFile() line: 475	
		} else {
			File myFile = getPropertiesFilename(getLocale());
/d
			if (myFile.isFile()) {
				if (propertiesFiles.containsKey(DEFAULT_LOCALE)) {
/ DEFAULT_LOCALE=en
/NEE
/ want propertiesFiles={}

				} else {
					myRet = PropertiesUtil.loadProperties(myFile);
myRet	NaturalSortedProperties  (id=16947)	


			getPropertiesFiles().put(getLocale(), myRet);
en_GB:{alle en properties}

/t
LanguageManager.<init>(HttpServletRequest) line: 77	
		getPropertiesFile();
/d
/ Heeft this.propertiesFiles=HashMap{"en_GB":language_en.properties} set	,

		if (aRequest != null) {
			if (!AuthenticationUtils.isAuthenticated()) {
/ TODO
/ JA
				// User not logged in. check user browser pref language
				String myLang = aRequest.getHeader("Accept-Language");
myLang	"en-US,en;q=0.8" (id=16997)	
					setLocale(new Locale(myLang.substring(0, 2)));
en
/ WAS en_GB

/t
LabelTag.doStartTag() line: 41	
		String myString = getLanguageManager().getByJavaName(theEntity, theName);
theEntity	"" (id=16875)	
theName	"userId" (id=17006)	
/s
LanguageManager.getByJavaName(String, String) line: 265	
/=
	public String getByJavaName(String anEntityName, String aFieldName) {
		String myTableName = StringUtils.formatJavaToSql(anEntityName).toString();
"
		String myFieldName = StringUtils.formatJavaToSql(aFieldName).toString();
"user_id"
		String myRet;
		if (StringUtils.isNotEmpty(myTableName)) {
/NEE
		} else {
			myRet = get(StringUtils.formatJavaToSql(myFieldName).toString(), false);
/s
LanguageManager.get(String, boolean) line: 146	
		return get(aFullCode, StringUtils.EMPTY_STRING_MAP, aThrowExceptionIfNotFound);
/s
	/**
	 * get a global code
	 * 
LanguageManager.get(String, Map<String,String>, boolean) line: 542	
/=
	private String get(String aFullCode, Map<String, String> aFieldMap, boolean aThrowExceptionIfNotFound) throws IndexOutOfBoundsException {
myFullCode="user_id"
		String myProductSpecificCode = getProduct() + "." + myFullCode;
/s
LanguageManager.getProduct() line: 118	
		if (theProduct == null) {
			setProduct(ApplicationPropertyManager.getInstance().getApplicationProperty("base.product"));
"pnloms"
/ sets theProduct	,

/t
LanguageManager.get(String, Map<String,String>, boolean) line: 548	
		String myProductSpecificCode = getProduct() + "." + myFullCode;
myProductSpecificCode	"pnloms.user_id" (id=17073)	

		if (getPropertiesFile().containsKey(myProductSpecificCode)) {
/s
LanguageManager.getPropertiesFile(Locale) line: 494	
/=
	protected Properties getPropertiesFile(Locale aLocale) {
alLocale=en
///////
/ dus we krijgen een 2de entry in de  propertiesFiles HashMap	, 
/ we hadden {"en_GB"=languaga_en.properties}	, 
/ {"en"=languaga_en.properties}	, 

"pnloms.user_id"
/ NEE
		} else if (getPropertiesFile().containsKey(myFullCode)) {
"user_id"
/NEE
		} else {
			myRet = myFullCode.replaceAll("_", " ");
"user id"
			return myRet;

/t
LabelTag.doStartTag() line: 42	
		String myString = getLanguageManager().getByJavaName(theEntity, theName);
"user id"
		return EVAL_BODY_INCLUDE;
/ WH uit javax.servlet.jsp.tagext.Tag	,

/t
login_form.jsp line: 41	
					<dt><mpo:label name="userId" /></dt>
/d

/ Nog bij een paar regels in login_form.jsp	,
/ we zien het login form	,

/ 7	.

/ we login 	, 

/ we vallen in	,
MenuGenerateAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	
				Map myMap = act();
/s
MenuGenerateAction.act() line: 58	

/ Dit is ook een act fct	, maar deze heeft geen args	,

		tmsServerType = ApplicationPropertyManager.getInstance().getApplicationServerType();
"development"

		String myMenuLocation = ObjectModelHelper.getContext(getObjectModel()).getRealPath("menu.xml");
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms/./deploy/tms.war/menu.xml

/ Intermezzo

/ Geef in eclipse *menu*xml	, 
/ we zien veel files	,
pnloms-menu.xml

/ Einde Intermezzo

		MenuService myMenuService = MpoBeanFactory.getBean(MenuService.class);
myMenuService	MenuServiceImpl  (id=17144)	
		myMenuService.setUrlPrefix(getParameters().getParameter(URL_PREFIX, ""));
"../"
		myMenuService.setLanguageManager(new LanguageManager(new RequestAdaptor(getRequest())));

/ Intermezzo

/ Later bij StringResourceModel	, new WebLanguageManager	,


/ Einde Intermezzo



/s
LanguageManager.<init>(HttpServletRequest) line: 75	
		setLocale(LocaleUtils.getActiveLocale());
/ sets locale "en_GB_plnen" van de user, in de language manager	,

/s
LocaleUtils.getActiveLocale() line: 59	
		ScsUserDetails ud = AuthenticationUtils.getUserDetails();
/s
AuthenticationUtils.getUserDetails() line: 44	
		Authentication auth = SecurityContextHolder.getContext().getAuthentication();
auth	UsernamePasswordAuthenticationToken  (id=17660)	
org.springframework.security.authentication.UsernamePasswordAuthenticationToken@5f76d251: Principal: com.mpobjects.auth.model.ScsUserDetails@2d06edd7; Credentials: [PROTECTED]; Authenticated: true; Details: org.springframework.security.web.authentication.WebAuthenticationDetails@b364: RemoteIpAddress: 0:0:0:0:0:0:0:1; SessionId: null; Granted Authorities: ADMINISTRATOR, ORG:PNL-OMS-DEM, ORG:PNL-OMS-GEN, ORG:SYSTEM

		if (auth.getPrincipal() instanceof ScsUserDetails) {
			return (ScsUserDetails) auth.getPrincipal();

/t
LocaleUtils.getActiveLocale() line: 60	
		ScsUserDetails ud = AuthenticationUtils.getUserDetails();
/d
systemLocale	Locale  (id=16876)	
en_GB
ud	ScsUserDetails  (id=17671)	
	accountNonExpired	true	
	accountNonLocked	true	
	activeOrganizationAuthority	OrganizationGrantedAuthority  (id=17774)	
ORG:PNL-OMS-GEN
	authorities	ArrayList  (id=17775)	
[ADMINISTRATOR, ORG:PNL-OMS-DEM, ORG:PNL-OMS-GEN, ORG:SYSTEM]
	credentialsNonExpired	true	
	enabled	true	
	locale	Locale  (id=17256)	
nl
	password	null	
	systemId	26681004	
	username	"eric" (id=17791)	

		if (ud != null) {
			return ud.getLocale();

/t
LanguageManager.<init>(HttpServletRequest) line: 76	
		setLocale(LocaleUtils.getActiveLocale());
/d
/ nl dus	, komt uit de login 	,
/ en_GB_pnloms dus	, komt uit de login 	,

		getPropertiesFile();
/s
LanguageManager.getPropertiesFile() line: 471	

		Map<Locale, Properties> myPropertiesFiles = getPropertiesFiles();
{en=language_en.properties,
{en_GB=language_en.properties}
/ TODO (Waar en= set?)

		if (myPropertiesFiles.containsKey(getLocale())) {
/NEE
		} else {
			File myFile = getPropertiesFilename(getLocale());
/s
LanguageManager.getPropertiesFilename(Locale) line: 503	
		File result = new File(String.format("%s%s.properties", getLanguageFilePrefix(), aForLocale.toString()));
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms/conf/language_nl.properties
/ of
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms/conf/language_en_GB_plnen.properties
		if (result.exists()) {
			return result;

/ Intermezzo

/ Als en_GB_pnlen is niet is dan 	,
		if (!org.apache.commons.lang3.StringUtils.isBlank(aForLocale.getVariant())) {
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms/conf/language_pnlen.properties

/ Als deze er ook niet is	,
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms/conf/language_en.properties

/ Einde Intermezzo

/ HIER HIER HIER

/t
LanguageManager.getPropertiesFile() line: 475	
		} else {
			File myFile = getPropertiesFilename(getLocale());
/d
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms/conf/language_nl.properties
				if (propertiesFiles.containsKey(DEFAULT_LOCALE)) {
/ JA	, en
					myRet = PropertiesUtil.loadProperties(myFile);
/ nl	,
					Properties myDefaultProperties = new Properties(propertiesFiles.get(DEFAULT_LOCALE));
/ en_GB
					PropertiesUtil.merge(myDefaultProperties, myRet);
					myRet = myDefaultProperties;

/t
MenuGenerateAction.act() line: 58	
		myMenuService.setLanguageManager(new LanguageManager(new RequestAdaptor(getRequest())));
/d
/ De lang mgr heeft 3 properties files	, en, nl, en_GB	,

		myMenuService.setResource(getActiveResource());
eric
		myMenuService.setOpeningMenuProperty(getActiveResource().getProperty(PPTY_OPENING_MENU));
null
		myMenuService.setCssClass(getParameters().getParameter("cssClass", ""));
getParameters()=Parameters[r/w]:{sessionAttribute=userMenu, urlPrefix=../, cssClass=xMenu}

		String myContent = myMenuService.generateMenu(myMenuLocation);
/s
MenuServiceImpl.generateMenu(String) line: 109	
/=
	public String generateMenu(String aMenuLocation) throws Exception {
aMenuLocation	"/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms/./deploy/tms.war/menu.xml" (id=17129)	
		Reader myReader = new FileReader(aMenuLocation);
		String myGeneratedMenu = generateMenu(myReader, MenuConfig.SCS);
/ enum MenuConfig	,
/s
MenuServiceImpl.generateMenu(Reader, MenuConfig) line: 63	

		XStream myStream = new XStream(new DomDriver());
/ third party XStream	,
/ takes menu.xml	, maakt een boom, het menu	, en serializes to another xml	,

		MenuItemXStreamConfig.configure(myStream);
		MenuItem myRootMenu = (MenuItem) myStream.fromXML(aReader);

this	MenuServiceImpl  (id=17144)	
aReader	FileReader  (id=18453)	
aConfig	MenuConfig$2  (id=18454)	
myStream	XStream  (id=18499)	
myRootMenu	MenuItem  (id=18511)	
	children	ArrayList  (id=18705)	
		elementData	Object[10]  (id=18733)	
			[0]	MenuItem  (id=18735)	
				children	ArrayList  (id=19079)	
					elementData	Object[15]  (id=19082)	
						[0]	MenuItem  (id=19084)	
							children	ArrayList  (id=19100)	
								elementData	Object[10]  (id=19102)	
									[0]	MenuItem  (id=19107)	
									[1]	MenuItem  (id=19108)	
										children	ArrayList  (id=19123)	
											elementData	Object[10]  (id=19125)	
												[0]	MenuItem  (id=19131)	
													children	null	
													description	null	
													index	1200	
													labelId	"actions" (id=19240)	
													module	"oms" (id=19205)	
													parent	MenuItem  (id=19108)	
													path	String[4]  (id=19241)	
													privilege	ActionPrivilege  (id=19242)	
													target	null	
													type	MenuItemType  (id=18715)	
													url	"wicket?module=oms&wicketpage=triggeraction.TriggerActionListPage&emptySession=true" (id=19243)	
													visibilityExpr	"" (id=18731)	
												[1]	MenuItem  (id=19132)	
												[2]	MenuItem  (id=19133)	
													children	null	
													description	null	
													index	1220	
													labelId	"shipmentOrderTrigger" (id=19204)	
													module	"oms" (id=19205)	
													parent	MenuItem  (id=19108)	
													path	String[4]  (id=19206)	
													privilege	ActionPrivilege  (id=19207)	
													target	null	
													type	MenuItemType  (id=18715)	
													url	"wicket?module=oms&wicketpage=shipmentordertrigger.ShipmentOrderTriggerListPage&emptySession=true" (id=19218)	
													visibilityExpr	"" (id=18731)	
												[3]	MenuItem  (id=19137)	
												[4]	MenuItem  (id=19139)	
												[5]	MenuItem  (id=19165)	
											modCount	6	
											size	6	
										description	null	
										index	-1	
										labelId	"triggers" (id=19163)	
										module	null	
										parent	MenuItem  (id=19084)	
										path	String[3]  (id=19164)	
										privilege	null	
										target	null	
										type	MenuItemType  (id=18715)	
										url	null	
										visibilityExpr	"" (id=18731)	
									[2]	MenuItem  (id=19109)	
									[3]	MenuItem  (id=19116)	
									[4]	MenuItem  (id=19117)	
								modCount	5	
								size	5	
							description	null	
							index	-1	
							labelId	"execution" (id=19059)	
							module	null	
							parent	MenuItem  (id=18735)	
							path	String[2]  (id=19162)	
							privilege	null	
							target	null	
							type	MenuItemType  (id=18715)	
							url	null	
							visibilityExpr	"" (id=18731)	
						[1]	MenuItem  (id=19085)	
						[2]	MenuItem  (id=19086)	
						[3]	MenuItem  (id=19087)	
						[4]	MenuItem  (id=19155)	
						[5]	MenuItem  (id=19156)	
						[6]	MenuItem  (id=19157)	
						[7]	MenuItem  (id=19158)	
						[8]	MenuItem  (id=19159)	
						[9]	MenuItem  (id=19160)	
						[10]	MenuItem  (id=19161)	
					modCount	11	
					size	11	
				description	null	
				index	1000	
				labelId	"configuration" (id=19080)				/ part of the key , key will be: menu_configuration	, 
				module	"core" (id=19060)	
				parent	MenuItem  (id=18511)	
				path	String[1]  (id=19154)	
				privilege	null	
				target	null	
				type	MenuItemType  (id=18715)	
				url	null	
				visibilityExpr	"" (id=18731)	
			[1]	MenuItem  (id=18736)	
			[2]	MenuItem  (id=18738)	
			[3]	MenuItem  (id=18739)	
			[4]	MenuItem  (id=18741)	
			[5]	MenuItem  (id=18743)	
			[6]	MenuItem  (id=18745)	
			[7]	MenuItem  (id=18747)	
		modCount	8	
		size	8	
	description	null	
	index	0	
	labelId	null	
	module	null	
	parent	null	
	path	String[0]  (id=18711)	
	privilege	null	
	target	null	
	type	MenuItemType  (id=18715)	
	url	null	
	visibilityExpr	"" (id=18731)	

/ Dit is het hele menu	, de root #0 null zien we niet	, de directe children zien we op de horizontale balk: configuration, ... en daaronder weer menu items, deze zien we op een verticale balk eronder	, ...

/ we zien nog steeds engels	,
/ TODO

		// Get the menu items from the resource service
		Collection<MenuItem> myReportItems = getReportService().getMenuItems(getResource(), aConfig.name());
[report.shipmentorderScreen#9999 (shipment_order Screen)]
		for (MenuItem myItem : myReportItems) {
			myRootMenu.addChild(myItem);
/ 1 extra menu item : Report	,

		switch (aConfig) {
			default:
				return generateScsMenu(myRootMenu);
/s
MenuServiceImpl.generateScsMenu(MenuItem) line: 286	
		StringBuilder sb = new StringBuilder();
		sb.append("<ul class=\"");
		sb.append(StringEscapeUtils.escapeHtml(getCssClass()));
		sb.append("\">");
<ul class="xMenu">
		for (MenuItem mi : aRootMenu.getChildren()) {
			sb.append(generateScsMenuInner(mi));
/s
MenuServiceImpl.generateScsMenuInner(MenuItem) line: 373	
/=
	protected String generateScsMenuInner(MenuItem aMenuItem) {
configuration#1000 (configuration)

		ActionPrivilege priv = aMenuItem.getPrivilege();
null
		StringBuilder aOutput = new StringBuilder();

		if (aMenuItem.isSeparator()) {
/ NEE
		} else if (aMenuItem.isHeader() && !aMenuItem.getChildren().isEmpty()) {
/ NEE
/ configuration#1000 (configuration)'s type="ITEM"	,
		} else {
			String myToolTip = "";
			if ((ApplicationServerType.DEVELOPMENT.equals(serverType) || ApplicationServerType.TEST.equals(serverType)) 
/ JA
				&& priv != null) {
/ NEE
				myToolTip = " title=\"" + priv.getBusinessObjectName() + "." + priv.getPrivilegeType() + "\"";
/ NIET	,
			}
			aOutput.append("<li" + myToolTip + "><a href=\"");
			boolean hasUrlAction = true;
			String url = aMenuItem.getUrl();
""
			if (url.length() > 0) {
/ NEE
			} else {
				aOutput.append("#\" onclick=\"return false;");
				hasUrlAction = false;
			}
			if (hasUrlAction && aMenuItem.getTarget().length() > 0) {
/ NEE
			}
			aOutput.append("\" class=\"");
			if (aMenuItem.getParent().getParent() == null) {
/ JA
				aOutput.append("rootMenu");

			if (aMenuItem.getParent() != null && aMenuItem.getParent().isHeader()) {
/ NEE
			if (aMenuItem.getDescription().length() > 0) {
/ NEE
			aOutput.append("\">");
<li><a href="#" onclick="return false;" class="rootMenu">

			String label = getLanguageManager().getMenuLabel(aMenuItem.getLabelId());

/ Intermezzo

			String label = getLanguageManager().getMenuLabel(aMenuItem.getLabelId());
			if (StringUtils.isEmpty(label)) {
				label = StringUtils.prettyPrintIdentifier(aMenuItem.getLabelId());

/ Einde Intermezzo
/s
LanguageManager.getMenuLabel(String) line: 368	
/=
	public String getMenuLabel(String aKey) {
aKey	"configuration" (id=19080)	
		String myKey = "menu_" + StringUtils.formatJavaToSql(aKey).toString();
menu_configuration
			myRet = get(myKey, true);
/s
		return get(aFullCode, StringUtils.EMPTY_STRING_MAP, aThrowExceptionIfNotFound);
/s
LanguageManager.get(String, Map<String,String>, boolean) line: 542	
/=
	private String get(String aFullCode, Map<String, String> aFieldMap, boolean aThrowExceptionIfNotFound) throws IndexOutOfBoundsException {
aFullCode	"menu_configuration" (id=19480)	

/ In de menu tree hierboven staan parts of the key	, bijv configuration	,  
/ hier werd de key "menu_configuration" create	,
/ In de language-nl.properties zien we	,
menu_admin_users = Gebruikers

		String myProductSpecificCode = getProduct() + "." + myFullCode;
pnloms.menu_configuration
		if (getPropertiesFile().containsKey(myProductSpecificCode)) {
/s
LanguageManager.getPropertiesFile() line: 471	
		Map<Locale, Properties> myPropertiesFiles = getPropertiesFiles();
/ 3: nl, 
		if (myPropertiesFiles.containsKey(getLocale())) {
			myRet = myPropertiesFiles.get(getLocale());
/ language-nl.properties
		return myRet;

/ Intermezzo

/ als de lcoale=en, dan in language_en.properties is GEEN pnloms.menu_configuration of menu_configuration	, 

/ Dus 	,
LanguageManager.getMenuLabel(String) line: 377	
/=
	public String getMenuLabel(String aKey) {
/ aKey="configuration"
		String myKey = "menu_" + StringUtils.formatJavaToSql(aKey).toString();
		try {
			myRet = get(myKey, true);
		} catch (IndexOutOfBoundsException e) {

/ er zijn GEEN pnloms.menu_configuration of menu_configuration  in language_en.properties	,

		if (StringUtils.isEmpty(myRet)) {
/ JA
""
			myRet = StringUtils.firstCharToUpper(get(StringUtils.formatJavaToSql(aKey).toString(), false));
myRet	"Configuration" (id=13190)	

/ ALS PROPERTY ER NIET IS	, DAN PROPERTY NAME ZELF
/ aKey="configuration"	, in de property file wordt "menu_configuration" lookup	, maar hier weer bij myRet = StringUt... is aKey="configuration"	, dus is myRet="Configuration"

		return myRet;

/ Einde Intermezzo

/t
LanguageManager.getPropertiesFile() line: 471	
		} else if (getPropertiesFile().containsKey(myFullCode)) {
			myRet = getPropertiesFile().getProperty(myFullCode);
Configuratie
/ als in property file menu_configuration=Configuratie
Configuration
/ als NIET property file menu_configuration


/t
MenuServiceImpl.generateScsMenuInner(MenuItem) line: 374	
			String label = getLanguageManager().getMenuLabel(aMenuItem.getLabelId());
			if (StringUtils.isEmpty(label)) {
/ NEE



/ 7	. 

/ Support, Edit profile

/ Dit is een wicket page, user.EditProfilePage	,

$ vi authentication-menu.xml

<?xml version="1.0" encoding="UTF-8"?>
<m:menu xmlns:m="http://www.mp-objects.com/schema/scs/menu">
	<m:add path="support.editProfile" screen-type="all"
		actionUrl="wicket?module=oms&amp;wicketpage=user.EditProfilePage"
		privilege="profile.edit" index="6019" />
	<m:add path="logout" screen-type="all" actionUrl="authentication/logout"
		target="_top" index="65536" />
</m:menu>

/ we click Support, Edit profile	,

BaseHomePage.<init>() line: 27	
		doRedirect();
/s
BaseHomePage.doRedirect() line: 36	
		Map<String, String[]> myParameterMap = getRequest().getParameterMap();
{emptySession=["true"]

		if (LanguageManager.mustClearWicketCache()) {
/s
LanguageManager.mustClearWicketCache() line: 93	
		return clearWicketCache;
false
/t
BaseHomePage.doRedirect() line: 63	

				PageParameters params = new PageParameters();
				myParameterMap.remove("wicketpage");
				myParameterMap.remove("module");
				params.putAll(myParameterMap);
emptySession = ["true"]

				IPageFactory pageFactory = getApplication().getSessionSettings().getPageFactory();

				Page page;
				if (params.isEmpty()) {
/ NEE
				} else {
					page = pageFactory.newPage(pageClass, params);
/s
EditProfilePage.<init>() line: 20	
			...
			Resource myUser = myDao.getBean().getBySystemId(AuthenticationUtils.getUserSystemId());
Resource:eric(systemId:26681004)
			UserCrudEditPanel myEditPanel = new UserCrudEditPanel(new Model<Resource>(myUser), true);

/ Intermezzo

$ vi EditProfilePage.html
<wicket:extend>
	<div wicket:id="dynamicPanel">userEdit</div>	
</wicket:extend>

/ see	,
$ vi AbstractGenericEditPanel.<init> 	,
		super("dynamicPanel");


$ vi UserCrudEditPanel.java

<wicket:extend>
	<input type="text" wicket:id="code" size="50"  />
	<input type="text" wicket:id="description" size="50"  />
	<input type="password" wicket:id="newPassword" size="50"  />
	<input type="password" wicket:id="confirmPassword" size="50"  />
	<input type="text" wicket:id="emailAddress" size="50" />
	<input type="text" wicket:id="userReference1" size="50" />
	<input type="text" wicket:id="userReference2" size="50" />
	<select wicket:id="activatableOrganization"></select>
	<wicket:child/>

<tr><td colspan="2"><h2><wicket:message key="properties"/></h2></td></tr>
<tr>
	<td colspan="2">
		<div wicket:id="propertySelection">
			<table class="grid">
				<thead>
					<tr class="headers">
						<th>&nbsp;</th>
						<th><wicket:message key="code">code</wicket:message></th>
						<th><wicket:message key="description">Description</wicket:message></th>
						<th><wicket:message key="value">value</wicket:message></th>
					</tr>
				</thead>
				<tbody>
					<tr wicket:id="propertiesValues">
						<td><input type="checkbox" wicket:id="selection" /></td>
						<td wicket:id="code"></td>
						<td wicket:id="description"></td>
						<td><input type="text" wicket:id="value" /></td>

					</tr>
				</tbody>
				<tfoot>
					<tr>
						<td><input type="checkbox" wicket:id="selectAllProperties" /></td>
						<td colspan="2"><label><wicket:message key="selectAllProperties">Select/deselect all properties</wicket:message> </label></td>
					</tr>
				</tfoot>
			</table>


$ vi AbstractGenericEditPanel.html 

<wicket:panel>
	<h2><div wicket:id="formTitle"/></h2>
	<div wicket:id="status" class="status">[[status messages]]</div>
	<div id="veil" class="veil" style="display:none;"><wicket:message key="processing">Processing...</wicket:message></div>
	<form class="genericForm" name="genericForm" id="genericForm" wicket:id="genericForm">
		<table cellspacing="0" cellpadding="2">
			<tbody>
		<wicket:child/>
			</tbody>
		</table>
		<div wicket:id="actionPanel"></div>
	</form>
</wicket:panel>

/ Einde Intermezzo

/ we waren in	,
UserCrudEditPanel.<init>(IModel<Resource>, boolean, String...) line: 123	
		super(PREFIX, aResource, aFieldList);
/s
UserCrudEditPanel(AbstractGenericEditPanel).<init>(String, IModel<T>, String...) line: 130	
		super(PREFIX, aResource, aFieldList);
/s
	public AbstractGenericEditPanel(String aPrefix, final IModel<T> aModel, String... aFieldList) {
/ aPrefix="resource."
		super("dynamicPanel");
		CompoundPropertyModel myModel = new CompoundPropertyModel(object.getObject());
/ object=Model:classname=[org.apache.wicket.model.Model]:object=[Resource:eric(systemId:26681004)]
/ myModel=Model:classname=[org.apache.wicket.model.CompoundPropertyModel]:nestedModel=[Resource:eric(systemId:26681004)]

		Label myTitleLable = new Label("formTitle", new Model(getTitle()));
/s
UserCrudEditPanel(AbstractGenericEditPanel).getTitle() line: 218	
		StringResourceModel myResourceModel = new StringResourceModel(prefix + "edit.title", this, null);
"resource.edit.title"
		return myResourceModel.getObject();
/ SPUM
/ Er is geen AbstractGenericEditPanel.properties
/ Maar WEL	,
./base-framework/core/conf/language_en.properties:resource.edit.title = User edit
/ TODO

/s
LanguageManagerStringResourceLoader.loadStringResource(Component, String) line: 50	
/=
	public String loadStringResource(Component aComponent, String aKey) {
aComponent	UserCrudEditPanel  (id=19901)	
aKey	"resource.edit.title" (id=20060)	
		try{
			if (aComponent != null) {
				return getLanguageManager().getTranslation(aKey, aComponent.getLocale(), aComponent.getStyle(), true);
/s
LanguageManagerStringResourceLoader.getLanguageManager() line: 69	
		if (languageManager == null || ...
/ JA
			languageManager = new WicketLanguageManager();

/ Intermezzo

/ MenuServiceImpl deed new LanguageManager	,

/ Einde Intermezzo

/s
WicketLanguageManager.<init>() line: 33	
/s
WicketLanguageManager(LanguageManager).<init>() line: 67	
		setLocale(LocaleUtils.getActiveLocale());
/s
LocaleUtils.getActiveLocale() line: 61	
		ScsUserDetails ud = AuthenticationUtils.getUserDetails();
		if (ud != null) {
			return ud.getLocale();
/////////////////////////////////
/ Dus asks login	,

/t
LanguageManagerStringResourceLoader.loadStringResource(Component, String) line: 51	
				return getLanguageManager().getTranslation(aKey, aComponent.getLocale(), aComponent.getStyle(), true);
aComponent	UserCrudEditPanel  (id=19901)	
 aComponent.getLocale()=en_US
 aComponent.getStyle()=nl

/ Intermezzo

$ vi BaseWebSession.java	

	public BaseWebSession(final Request request) {
		super(request);

		if (AuthenticationUtils.isAuthenticated()) {
			setStyle(LocaleUtils.getActiveLocale().getLanguage());
	}

	public Locale getLocale() {
		if (locale == null) {
			// Default locale. "style" is the actual language file
			locale = Locale.US;
		}
		return locale;


/ Einde Intermezzo

/s
WicketLanguageManager.getTranslation(String, Locale, String, boolean) line: 37	
		return get(aKey, aLocale, aStyle, aThrowExceptionIfNotFound);
/ aKey="resource.edit.title"
/s
WicketLanguageManager.get(String, Locale, String, boolean) line: 75	
		if (StringUtils.isNotEmpty(aStyle) && getPropertiesFile(aStyle).containsKey(myFullCode)) {
/ NEE
/ language_nl.properties heeft "resource.edit.title" niet als key	,
		} else if (getPropertiesFile(aLocale.getLanguage()).containsKey(myFullCode)) {
/ aLocale.getLanguage()="en"	, aLocale=en_US	, en in language_en.propperties zit "resource.edit.title" WEL	,

/ .containsKey is NIET OK	, want is Hashtable fct en kjkt alleen in de has table van de Properties inst	, niet in die van defaults	,
/ TODO PETER/PAUL





/ Einde DEBUG PNL-314 WICKET

/ WRONG CHECKINS

$ vi preload.properties

# Delay (in ms) before the first batch update is performed (after application start)
module.preload.update.service.delay=15000
# Interval (in ms) between updates, WAS 120000
module.preload.update.service.interval=12000000

$ vi ServiceOrderEditAction.java

	public Map act() throws java.lang.Exception {

		getLogger().debug("In ServiceOrderEditAction");
		try {
			getPerformanceMonitorManager().startMonitor(EDITACT);
			if (!"false".equals(getRequest().getParameter(SYNC_DB_ATTRIBUTE)) || getSession().getAttribute(ServiceOrderView.ACTIVE_SERVICEORDER) == null) {
				ServiceOrderVO myVO = getServiceOrderBAO().getServiceOrder(getSystemIdFromRequest());
				LOG.debug("Active service order system id: [" + myVO.getSystemId() + "]");
->				CacheManager.getInstance().clearAll();

/ Einde WRONG CHECKINS

/ SHIPMENT ORDER FROM XML SHO READ 
/ See STACKTRACE SHIPMENT ORDER CREATE FROM INTERFACE 


/ NIP-45 SCS-4759

/ project/branch 2015.01
/ server 2015.01_mpo	, 
/ jboss: mpo	, 
/ database 
# \c mpo_2015_01 
You are now connected to database "mpo_2015_01" as user "mpopostgres".

[eric@localhost apache-activemq-5.10.1]$ bin/activemq console


[eric@localhost SHO.xml]$ pwd
/home/eric/Devel/Interfaces/2015.01_mpo/SHO.xml
/ de pakken de 1ste	,
O91T50555.CMP.xml

/ see LOG_NIP_45.xml	,

/ Intermezzo

/ MINIMAL BREAKPOINTS IN READ SHO FROM XML
/ See STACKTRACE SHIPMENTORDERCREATE FROM INTERFACE 
/ See SHIPMENT ORDER FROM XML SHO READ 

ShipmentOrderProcessor.process(Node)	,


/ In de log zien we deze stack trace	, dus dit gaan we debuggen	,

[eric@localhost server]$ stacktrace.sh 2144 2194 ~/LOGS/LOG_NIP_45.txt  
	at com.mpobjects.mpo.integration.jms.JmsMpoListener.onMessage(JmsMpoListener.java:65)
	at com.mpobjects.util.sap.link.IncomingLink.handle(IncomingLink.java:89)
	at com.mpobjects.util.sap.link.IncomingXmlMessageLink.unMarshalFrom(IncomingXmlMessageLink.java:158)
	at com.mpobjects.util.sap.link.IncomingLink.postMessage(IncomingLink.java:143)
	at com.mpobjects.util.sap.control.MessageSwitch.handleMessage(MessageSwitch.java:306)
	at com.mpobjects.util.sap.control.MessageSwitch.forwardDataMessage(MessageSwitch.java:1198)
	at com.mpobjects.util.sap.control.MessageConsumer.handle(MessageConsumer.java:108)
	at com.mpobjects.util.sap.control.IncomingMessageDemultiplexer.process(IncomingMessageDemultiplexer.java:123)
	at com.mpobjects.oms.model.shipmentorder.util.ShipmentOrderMsgConsumer.process(ShipmentOrderMsgConsumer.java:56)
	at com.mpobjects.oms.model.shipmentorder.xml.AbstractShipmentOrderMsgProcessor.process(AbstractShipmentOrderMsgProcessor.java:266)
	at com.mpobjects.mpo.model.shipmentorder.xml.MpoShipmentOrderMsgProcessor.processUpdate(MpoShipmentOrderMsgProcessor.java:68)
	at com.mpobjects.mpo.model.shipmentorder.xml.MpoShipmentOrderMsgProcessor.processOriginal(MpoShipmentOrderMsgProcessor.java:56)
	at com.mpobjects.oms.model.service.ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderServiceImpl.java:878)

$ vi ~/bin/stacktrace.sh

#!/usr/bin/bash

start_line="$1"
end_line="$2"
file="$3"

awk  "$start_line<=NR && NR<=$end_line"' && $0~"at com.mpobjects"' $file | awk '{l[n++]=$0}END{while(n--)print l[n]}'



/ Einde Intermezzo

/ we vallen in 	,
Thread [MpoQueueContainer-2] (Suspended (breakpoint at line 45 in JmsMpoListener))	
	JmsMpoListener.onMessage(Message) line: 45	
	DefaultMessageListenerContainer(AbstractMessageListenerContainer).doInvokeListener(MessageListener, Message) line: 562	
	DefaultMessageListenerContainer(AbstractMessageListenerContainer).invokeListener(Session, Message) line: 500	
	DefaultMessageListenerContainer(AbstractMessageListenerContainer).doExecuteListener(Session, Message) line: 468	
	DefaultMessageListenerContainer(AbstractPollingMessageListenerContainer).doReceiveAndExecute(Object, Session, MessageConsumer, TransactionStatus) line: 325	
	DefaultMessageListenerContainer(AbstractPollingMessageListenerContainer).receiveAndExecute(Object, Session, MessageConsumer) line: 263	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener() line: 1101	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop() line: 1093	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run() line: 990	
	Thread.run() line: 745	

	public void onMessage(Message aMessage) {
aMessage	ActiveMQTextMessage  (id=18456)	
	text	"<?xml version="1.0" encoding="utf-8"?>\r\n<mtc:SHIPMENT_ORDER_MSG xmlns:mtccore="http://system.mp-objects.com/schemas/MTC/MTCCore/V1/MTCCore.xsd"\r\n                        xmlns:mtc...

			TextMessage myTextMessage = (TextMessage) aMessage;
			myMarshalledMessageText = myTextMessage.getText();
			theIncomingLink.handle(myMarshalledMessageText);
/s
IncomingXmlMessageLink(IncomingLink).handle(String) line: 89	
		if (getCompleted()) {
/ NEE
			// When completed the octets belong to an entirely new protocol data unit
			initialise();
		} else {
			// The incoming octet sequence has been used for assembly of the incoming protocol data unit
			unMarshalFrom(octets);
/s
IncomingXmlMessageLink.unMarshalFrom(String) line: 110	
		try {
			myDocumentStream = new ByteArrayInputStream(aMarshalledXMLMessage.getBytes("UTF-8"));
		try {
			myDocument = DocumentBuilderFactory.newInstance().newDocumentBuilder().parse(myDocumentStream);
			myDocument.normalize();
		if (getParseOk()) {
			myNewMessage = new SapXMessage(myDocument);
		}

		// When archiving, send the message into the archival link
		if (myNewMessage != null && isArchiving()) {
			theArchiveLink.send(myNewMessage);

		try {
			// When compilation went fine, the document can be embedded in a sap message
			if (getParseOk()) {
				postMessage(myNewMessage);
/s
IncomingXmlMessageLink(IncomingLink).postMessage(Message) line: 137	
		// post to all subscribers
		for (Iterator it = theSubscribers.iterator(); it.hasNext();) {
			((IncomingMessageSubscriber) it.next()).handleMessage(aMessage);
/s
MessageSwitch.handleMessage(Message) line: 279	
/ this=MPO<->MPOBJECTS

		myMSH = aMessage.getMessageHeader();
myMSH	SapXMessageHeader  (id=19273)	
	headerValues	HashMap  (id=19279)	

		} else {
			// No sequence number mismatch, so the data message can be forwarded for further processing
			forwardDataMessage(aMessage);
/s
MessageSwitch.forwardDataMessage(Message) line: 1111	
/=
	/**
	 * Forward the data message to the message consumer and provide an acknowledgement when requested
	 * 
	 * @param aDataMessage
	 *            - the data message to forward and acknowledge
	 */
	private void forwardDataMessage(Message aDataMessage) {

		String myDefaultOrganizations = ApplicationPropertyManager.getInstance().getModuleApplicationProperty("interface",
				"message.receiving_application.default", "NACCOEPO");
/ TODO
		boolean shouldSentAck = matchesAcknowledgementApplication(myDefaultOrganizations, myMSH.getSendingApplication());
/ false
/ want args= "NACCOEPO","NIPPONEXPRESS"

		// Initialise record from message header segment
		String msgId = myMSH.getMessageIdentifier();
		if (org.apache.commons.lang.StringUtils.isBlank(msgId)) {
			// Just create a message id if it was missing. Note, this is a dirty fix
			msgId = UUID.randomUUID().toString();
187d82a9-e163-450b-babb-818d5ed1b49a

		if (theProtocol.isUsingSequenceNumbering() && shouldSentAck) {
/ NEE
		} else {
			myRecord = new AcknowledgementRecordOutgoing(SAP_ARBITRARY_SEQUENCE_NUMBER, msgId, new Date());
{id=187d82a9-e163-450b-babb-818d5ed1b49a,seq=4999,time=Fri Apr 03 14:20:59 CEST 2015}
	theSequenceNumber	4999	

		// Check the production mode of the message is that of the message switch
		if (incompatibleMode(myMSH.getMode())) {
/ NEE	, 
/ myMSH.getMode()="P"

		if (myRecord.getStatus() == MC_STATUS_OK && !retransmissionAfterLostAcknowledgement) {
			if (theInterfaceCheck.hasCheckForInbound(myMSH.getType())) {
/ JA
/ myMSH.getType()="SHIPMENT_ORDER_MSG"
				myMessageCheck.applyTo(aDataMessage);
aDataMessage	SapXMessage  (id=19045)	
	theDocument	DeferredDocumentImpl  (id=19038)	

		// Let consumer process the message, if sequence numbers were ok.
		if (!retransmissionAfterLostAcknowledgement) {
			if (myRecord.getStatus() == MC_STATUS_OK) {
				LOG.info("Message posted to the consumer");
				theMessageConsumer.handle(aDataMessage);
/s
IncomingMessageDemultiplexer(MessageConsumer).handle(Message) line: 90	
incomingMessage	SapXMessage  (id=19045)	

		if (!isMinimallyWellFormed(incomingMessage)) {
/ NEE
		} else {
				process(incomingMessage);
/s
IncomingMessageDemultiplexer.process(Message) line: 118	

		MessageConsumerInterface myMessageConsumer = getConsumer(aIncomingMessage.getMessageHeader().getType());
/ aIncomingMessage.getMessageHeader().getType()=SHIPMENT_ORDER_MSG
/ proxy to
com.mpobjects.oms.model.shipmentorder.util.ShipmentOrderMsgConsumer@2f16740d

		try {
			myMessageConsumer.process(aIncomingMessage);
/s
ShipmentOrderMsgConsumer.process(Message) line: 45	
				AbstractShipmentOrderMsgProcessor myProcessor = Factory.getFactory().getInstance(
						com.mpobjects.oms.model.shipmentorder.xml.AbstractShipmentOrderMsgProcessor.class);
myProcessor	MpoShipmentOrderMsgProcessor  (id=20263)	
				...
				myProcessor.processHeader(aIncomingMessage.getMessageHeader());
/ NIETS
				Node msgNode = XMLUtil.selectSingleNode(((SapXMessage) aIncomingMessage).getDocument(), "SHIPMENT_ORDER_MSG");
/ Dit is de top 	,
<mtc:SHIPMENT_ORDER_MSG ...>
   <mtc:header>	...
   <mtc:body>	...
					myProcessor.process(((SapXMessage) aIncomingMessage).getBody());
/s
SapXMessage.getBody() line: 99	
		if (bodyNode == null) {
			bodyNode = XMLUtil.selectSingleNode(getDocument().getDocumentElement(), "body");
/t
/s
MpoShipmentOrderMsgProcessor(AbstractShipmentOrderMsgProcessor).process(Node) line: 213	
		String regex = ApplicationPropertyManager.getInstance().getModuleProperty("oms", "shipmentorder.purposecode.pattern.original", null);
""
/ we zien in application.properties 	,
module.oms.shipmentorder.purposecode.pattern.original=

		regex = ApplicationPropertyManager.getInstance().getModuleProperty("oms", "shipmentorder.purposecode.pattern.update", null);
""
/ we zien in application.properties 	,
module.oms.shipmentorder.purposecode.pattern.update=

		String messageId = org.apache.commons.lang.StringUtils.defaultIfEmpty(findMessageId(node), "?MessageId?");
?MessageId?

		try {
			for (Node myNode : selectNodeIterable(aNode, "SHIPMENT_ORDER")) {

/ Klopt, in de XML	,
  <mtc:body>
      <mtc:SHIPMENT_ORDER>

				monitorMeta[1] = selectText(myNode, PROCESSING_DETAILS_TAG, PurposeCodeProcessor.PURPOSE_CODE_TAG);
"05"
/ we zien	,
  <mtc:body>
      <mtc:SHIPMENT_ORDER>
         <mtc:PROCESSING_DETAILS>
            <mtccore:PURPOSE_CODE>05</mtccore:PURPOSE_CODE>

				monitorMeta[2] = selectText(myNode, ShipmentOrderProcessor.SHIPMENT_ORDER_BODY_TAG, ShipmentOrderBodyProcessor.SHIPMENT_ORDER_ID_TAG);
null
/ Is er NIET in de XML	,
				monitorMeta[3] = selectText(myNode, ShipmentOrderProcessor.SHIPMENT_ORDER_BODY_TAG, ShipmentOrderBodyProcessor.ORGANIZATION_ID_TAG);
"NEEC-NL"
/ we zien	,
   <mtc:body>
      <mtc:SHIPMENT_ORDER>
         <mtc:SHIPMENT_ORDER_BODY> 
            <mtccore:ORGANIZATION_ID>NEEC-NL</mtccore:ORGANIZATION_ID>

				monitorMeta[4] = Boolean.FALSE.toString();
"false"
				try {
					long start = System.currentTimeMillis();
					PurposeCodeVO myPurposeCode = new PurposeCodeProcessor(this).process(selectSingleNode(myNode, PROCESSING_DETAILS_TAG));
myPurposeCode	PurposeCodeVO  (id=21029)	
	thePurposeCode	"05" (id=21032)	

   <mtc:body>
      <mtc:SHIPMENT_ORDER>
         <mtc:PROCESSING_DETAILS>
            <mtccore:PURPOSE_CODE>05</mtccore:PURPOSE_CODE>

					ShipmentOrderProcessor myProcessor = new ShipmentOrderProcessor();
					myProcessor.setProcessingContext(getProcessingContext());
					myShipmentOrder = myProcessor.process(myNode);
/s
ShipmentOrderProcessor.process(Node) line: 199	
/=
	public ParsedShipmentOrder process(Node aNode) throws ShipmentOrderException {

aNode	DeferredElementImpl  (id=20788)	
	name	"mtc:SHIPMENT_ORDER" (id=21849)	

		try {
			myProcessor.setProcessingContext(getProcessingContext());
			myProcessor.setParent(this);
			myShipmentOrderVO = myProcessor.process(selectSingleNode(aNode, SHIPMENT_ORDER_BODY_TAG));
/s
XMLUtil.selectSingleNode(Node, String...) line: 511	
/=
	public static final Node selectSingleNode(Node aNode, String... aPath) {
/ aNode=[mtc:SHIPMENT_ORDER: null]
/ aPath=["SHIPMENT_ORDER_BODY"]

/ we zien	,
  <mtc:body>
      <mtc:SHIPMENT_ORDER>
         <mtc:SHIPMENT_ORDER_BODY>

		traversePath: for (String pathElement : aPath) {
/ we hebben maar 1 path element, want aPath=["SHIPMENT_ORDER_BODY"]	,

/ we gaan op zoek naar deze	,
/ hij leest vanaf de top	, SHIPMENT_ORDER,

			// find the first child with a matching name
			Node childNode = aNode.getFirstChild();
			while (childNode != null) {
[#text: ...]
"PROCESSING_DETAILS"
[#text: ...]
[mtc:SHIPMENT_ORDER_BODY: null]
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String elementName = getElementName(childNode);
					if (pathElement.equals(elementName)) {
/ JA
						// found a child
						aNode = childNode;
						// find the next element in the path
						continue traversePath;
					}
				}
				childNode = childNode.getNextSibling();
			}
	}
	return aNode; 
[mtc:SHIPMENT_ORDER_BODY: null]

/t
ShipmentOrderProcessor.process(Node) line: 208	
			myShipmentOrderVO = myProcessor.process(selectSingleNode(aNode, SHIPMENT_ORDER_BODY_TAG));
/s
ShipmentOrderBodyProcessor.process(Node) line: 437	
/=
	public ShipmentOrderVO process(Node aNode) throws ShipmentOrderException {
aNode	DeferredElementImpl  (id=21972)	
	name	"mtc:SHIPMENT_ORDER_BODY" (id=22249)	

		try {
			ShipmentOrderVO myShipmentOrderVO = ShipmentOrderVOFactory.getShipmentOrderVO();
/ new
			myShipmentOrderVO.setSyncToFlag(getSyncFlag("to"));
/s
ShipmentOrderBodyProcessor.getSyncFlag(String) line: 183	
		String myKey = "interface.shipmentorder.sync." + aType + ".flag".toLowerCase();
interface.shipmentorder.sync.to.flag
		return ApplicationPropertyManager.getInstance().getModuleProperty("oms", myKey, PartySyncFlag.DISABLED_CODE);
/ is er niet	, dus PartySyncFlag.DISABLED_CODE="D"

/t
ShipmentOrderBodyProcessor.process(Node) line: 445	
			myShipmentOrderVO.setSyncToFlag(getSyncFlag("to"));
/d
			myShipmentOrderVO.setSyncFromFlag(getSyncFlag("from"));
			myShipmentOrderVO.setSyncBillToFlag(getSyncFlag("billto"));
			myShipmentOrderVO.setSyncEmployeeResponsibleFlag(getSyncFlag("employeeresponsible"));

myShipmentOrderVO	ShipmentOrderVO  (id=22275)	
	theActualTotalLoadingMeters	null	
	theSyncBillToFlag	"D" (id=22299)	
	theSyncEmployeeResponsibleFlag	"D" (id=22299)	
	theSyncFromFlag	"D" (id=22299)	
	theSyncToFlag	"D" (id=22299)	

			// Defaults for the object, must be set before node processing
			myShipmentOrderVO.setShipmentOrderProcess(OrderProcess.OUTBOUND);
/s
ShipmentOrderVO.setShipmentOrderProcess(String) line: 2537	
		setOrderProcess(OrderProcessUtils.getByCode(aShipmentOrderProcess));
aShipmentOrderProcess	"OUTBOUND" (id=22360)	
/s
OrderProcessUtils.getByCode(String) line: 33	
		OrderProcess myProcess = MpoBeanFactory.getBean(OrderProcessDAO.class).getByCode(aCode);

/ Intermezzo

$ vi OrderProcess.standard.hbm.xml

	<class name="OrderProcess" table="ORDER_PROCESS">

mpo_2015_01=# select*from order_process;
 system_id |         code          |      description      | organization_systemid | is_deleted 
-----------+-----------------------+-----------------------+-----------------------+------------
  26594670 | OUTBOUND              | Outbound              |                       |          0
...

/ Einde Intermezzo

/ Intermezzo

/ SHIPMENTORDERCREATE FROM INTERFACE
/ Lees: LOG_6_OCT:22052

/ 7	.


/ STACKTRACE SHIPMENTORDERCREATE FROM INTERFACE 
/ See SHIPMENT ORDER FROM XML SHO READ 

/ centrum method
    com.mpobjects.oms.model.shipmentorder.util.ShipmentOrderMsgConsumer.process(ShipmentOrderMsgConsumer.java:56)
		MpoShipmentOrderMsgProcessor(AbstractShipmentOrderMsgProcessor).process(Node) line: 256	
    	com.mpobjects.oms.model.shipmentorder.xml.AbstractShipmentOrderMsgProcessor.process(AbstractShipmentOrderMsgProcessor.java:266)

/ meer detail	,
[eric@localhost server]$ stacktrace.sh 2144 2194 ~/LOGS/LOG_NIP_45.txt
    at com.mpobjects.mpo.integration.jms.JmsMpoListener.onMessage(JmsMpoListener.java:65)
    at com.mpobjects.util.sap.link.IncomingLink.handle(IncomingLink.java:89)
    at com.mpobjects.util.sap.link.IncomingXmlMessageLink.unMarshalFrom(IncomingXmlMessageLink.java:158)
    at com.mpobjects.util.sap.link.IncomingLink.postMessage(IncomingLink.java:143)
    at com.mpobjects.util.sap.control.MessageSwitch.handleMessage(MessageSwitch.java:306)
    at com.mpobjects.util.sap.control.MessageSwitch.forwardDataMessage(MessageSwitch.java:1198)
    at com.mpobjects.util.sap.control.MessageConsumer.handle(MessageConsumer.java:108)
    at com.mpobjects.util.sap.control.IncomingMessageDemultiplexer.process(IncomingMessageDemultiplexer.java:123)

    at com.mpobjects.oms.model.shipmentorder.util.ShipmentOrderMsgConsumer.process(ShipmentOrderMsgConsumer.java:56)
/ eerst	,
	MpoShipmentOrderMsgProcessor(AbstractShipmentOrderMsgProcessor).process(Node) line: 256	
	ShipmentOrderProcessor.process(Node) line: 208	
	ShipmentOrderBodyProcessor.process(Node) line: 484	
	LogisticsOrderBodyProcessor.process(Node, LogisticsOrderVO) line: 190	
/ ddarna	,
    at com.mpobjects.oms.model.shipmentorder.xml.AbstractShipmentOrderMsgProcessor.process(AbstractShipmentOrderMsgProcessor.java:266)
    at com.mpobjects.mpo.model.shipmentorder.xml.MpoShipmentOrderMsgProcessor.processUpdate(MpoShipmentOrderMsgProcessor.java:68)
    at com.mpobjects.mpo.model.shipmentorder.xml.MpoShipmentOrderMsgProcessor.processOriginal(MpoShipmentOrderMsgProcessor.java:56)
    at com.mpobjects.oms.model.service.ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderServiceImpl.java:878)

/ 7	.

/ er zijn virtual party's, shipmentorderparty's  en party's	, De virtual party's zitten in de shipment_order rij, ide shipmentorderparty's in de shipmentorderparty table	, eig moeten virtual party's shipmentroderparty's moeten zijn	,

/ de party's zitten in de party table (master data). 

/ WH zijn de shipmentorderparty zoals de virtual party's	, tijdelijke party's 	, itt party's die masterdata zijn, en vast zijn	, bijv een warehouse	, of een carrier	,

/ de party's uit de party table worden lookup met een id	,
/ als een from of to party zo wordt lookup uit master data, wordt dat gedaan	, en er wordt een virtual party create van deze party	,
/ een warehouse is ook masterdata	, als dit de to party is	, dan als de regel hierboven	, 

/ preferred_party=carrier is master data
/ supplier is de leverancier	, buyer bestaat ook	, : meer customer order 


/ See	,
ShipmentOrderBodyProcessor.java
	protected void processShipmentOrderParty(ShipmentOrderVO aShipmentOrderVO, Node aNode) throws TransformerException, PartyException, ShipmentOrderException {


/ Einde Intermezzo

/ Intermezzo

/ we zien	,

select ... 
from ORDER_PROCESS this_ 
left outer join ORGANIZATION organizati2_ on this_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID 
left outer join ORGANIZATION organizati3_ on organizati2_.ORGANIZATION_GROUP=organizati3_.SYSTEM_ID 
where this_.IS_DELETED=? 
and this_.CODE=?; 
parameters: false, OUTBOUND, 

/ we doen zelf	,
select * 
from ORDER_PROCESS this_ 
left outer join ORGANIZATION organizati2_ on this_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID 
left outer join ORGANIZATION organizati3_ on organizati2_.ORGANIZATION_GROUP=organizati3_.SYSTEM_ID 
where this_.IS_DELETED=false
and this_.CODE='OUTBOUND'

/ Einde Intermezzo

/t
ShipmentOrderVO.setShipmentOrderProcess(String) line: 2538	
			// Defaults for the object, must be set before node processing
			myShipmentOrderVO.setShipmentOrderProcess(OrderProcess.OUTBOUND);
/d
/ heeft myShipmentOrderVO.orderProcess set	,

			// Must be first because the organization is needed in the LogisticsOrderBodyProcessor
			// (party creation for ETMS)
			// Pick up the organisation identification from the document and initialise the VO with it

			Node myNode = selectSingleNode(aNode, ORGANIZATION_ID_TAG);
[mtccore:ORGANIZATION_ID: null]
/ in XML,
<mtccore:ORGANIZATION_ID>NEEC-NL</mtccore:ORGANIZATION_ID>
				Organization myOrganizationVO = OrganizationUtil.getOrganizationFacadeLocal().getOrganization(myNode.getTextContent());
SystemId:5001	Id:NEEC-NL	Description:Nippon Express Euro Cargo-NL
/ want,	
/s
$ vi OrganizationServiceImpl.java
	public Organization getOrganization(String aOrganization) {
		try {
			return organizationDAO.getOrganization(aOrganization);
/s
$ vi OrganizationDAOImpl.java
	public Organization getOrganization(String aOrganizationCode) {
		return getByCode(aOrganizationCode);
/s
$ vi OrganizationDAOImpl.java
	public Organization getByCode(String anOrganizationCode) {
		List myOrgList = getHibernateTemplate().findByCriteria(
				DetachedCriteria.forClass(Organization.class).add(Property.forName("organizationId").eq(anOrganizationCode)));
/ anOrganizationCode="NEEC-NL"

/ Intermezzo

/ we zien	,

select ... 
from ORGANIZATION this_ 
left outer join ORGANIZATION organizati2_ on this_.ORGANIZATION_GROUP=organizati2_.SYSTEM_ID 
where this_.ORGANIZATION_ID=?
1165056 2015-04-07 11:53:11,117 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (MpoQueueContainer-1:) binding parameter [1] as [VARCHAR] - NEEC-NL
11

/ Einde Intermezzo

/t
ShipmentOrderBodyProcessor.process(Node) line: 454	
				Organization myOrganizationVO = OrganizationUtil.getOrganizationFacadeLocal().getOrganization(myNode.getTextContent());
/d
SystemId:5001	Id:NEEC-NL	Description:Nippon Express Euro Cargo-NL

				if (myOrganizationVO != null) {
					myShipmentOrderVO.setOrganizationVO(myOrganizationVO);

			Node childNode = aNode.getFirstChild();
			while (childNode != null) {
[#text: ]
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
/ JA
[mtccore:COMMON: null]
/ hier zitten from ,to in	,
					} else if (COMMON_TAG.equals(myTag)) {
						new LogisticsOrderBodyProcessor(this).process(childNode, myShipmentOrderVO);
/s
LogisticsOrderBodyProcessor.process(Node, LogisticsOrderVO) line: 190	
			Node myNode = aNode.getFirstChild();
			while (myNode != null) {
[#text: ...] 
				if (myNode.getNodeType() == Node.ELEMENT_NODE) {
[mtccore:FROM_LOCATION: null]
					String myElementName = getElementName(myNode);
					if (myElementName.equals(FROM_LOCATION_TAG)) {
						Party myLocation = new LocationProcessor(this).process(myNode);
/s
LocationProcessor.process(Node) line: 117	
		try {
			Party myPartyVO = new PartyProcessor(this).process(aNode);
/s
PartyProcessor.process(Node) line: 375	
aNode=[mtccore:FROM_LOCATION: null]

			Party myVO = new PartyVO();
			Node childNode = aNode.getFirstChild();
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
[mtccore:LOCATION_ID: null]
[mtccore:LOCATION_TYPE: null]
[mtccore:NAME: null]
[mtccore:ADDRESS: null]
[mtccore:ADDRESS2: null]
[mtccore:CITY: null]
[mtccore:POSTAL_CODE: null]
[mtccore:COUNTRY: null]
[mtccore:PHONE_NUMBER: null]
[mtccore:EMAIL_ADDRESS: null]
[mtccore:CONTACT_NAME: null]
					String tag = getElementName(childNode);
"LOCATION_ID"
/ GEEN case voor "LOCATION_ID"	,
"LOCATION_TYPE"
/ GEEN case voor "LOCATION_TYPE"	,

					} else if (NAME_TAG.equals(tag)) {
						myVO.setName(childNode.getTextContent());
"FEI ELECTRON OPTICS B.V."
					} else if (ADDRESS_TAG.equals(tag)) {
						myVO.setAddress(childNode.getTextContent());
"ACHTSEWEG NOORD 5"
					} else if (ADDRESS2_TAG.equals(tag)) {
						myVO.setAddress2(childNode.getTextContent());
"5601 GG EINDHOVEN"
					} else if (CITY_TAG.equals(tag)) {
						myVO.setCity(childNode.getTextContent());
"EINDHOVEN"
					} else if (POSTAL_CODE_TAG.equals(tag)) {
						myVO.setPostalCode(childNode.getTextContent());
5600 MD
					} else if (COUNTRY_TAG.equals(tag)) {
						myVO.setCountryVO(new CountryProcessor(this).process(childNode));
/s
CountryProcessor.process(Node) line: 36	
			Country myVO = new Country();

			Node myNode = selectSingleNode(aNode, COUNTRY_CODE_TAG);
                 <mtccore:COUNTRY>
                     <mtccore:COUNTRY_CODE>NL</mtccore:COUNTRY_CODE>
			if (myNode != null) {
/ JA
				myVO = MpoBeanFactory.getBean(CountryDAO.class).getByCode(myNode.getTextContent());

/ Intermezzo

/ we zien	,
select ... 
from COUNTRY this_ 
where this_.IS_DELETED=? a
nd this_.COUNTRY_CODE=?
parameters: false, NL, 

/ Einde Intermezzo

/t
PartyProcessor.process(Node) line: 426	
					} else if (COUNTRY_TAG.equals(tag)) {
						myVO.setCountryVO(new CountryProcessor(this).process(childNode));
/d
					} else if (PHONE_NUMBER_TAG.equals(tag)) {
						myVO.setPhoneNumber(childNode.getTextContent());
040-2356305
					} else if (EMAIL_ADDRESS_TAG.equals(tag)) {
						myVO.setEmailAddress(childNode.getTextContent());
""
/ myVO=PartyVO	,
					} else if (CONTACT_NAME_TAG.equals(tag)) {
						myVO.setContactName(childNode.getTextContent());

/t
LocationProcessor.process(Node) line: 117	
			Party myPartyVO = new PartyProcessor(this).process(aNode);
/d
myPartyVO	PartyVO  (id=13889)	
	address	"ACHTSEWEG NOORD 5" (id=13891)	
	address2	"5601 GG EINDHOVEN" (id=13892)	
	attachments	HashSet  (id=13893)	
	city	"EINDHOVEN" (id=13895)	
	contactName	"PO.NR. AYO15028" (id=13896)	
	countryVO	Country  (id=13898)	
	currencyDAO	null	
	dao	null	
	deleted	false	
	description	null	
	emailAddress	"" (id=13904)	
	entityDetails	HashMap  (id=13906)	
	faxNumber	"" (id=13904)	
	latitude	null	
	longitude	null	
	manifestReport	null	
	manifestReport	"" (id=13904)	
	name	"FEI ELECTRON OPTICS B.V." (id=13914)	
	name2	"" (id=13904)	
	organization	null	
	partyGroups	HashSet  (id=13918)	
	partyGroupsAsString	null	
	partyId	"" (id=13904)	
	partyPrenotificationRuleList	null	
	partyType	null	
	performanceMonitorService	null	
	phoneNumber	"040-2356305" (id=13925)	
	postalCode	"5600 MD" (id=13927)	
	prenotifyCarcon	false	
	prenotifyCarcon	false	
	qualifier	"" (id=13904)	
	qualifier	"" (id=13904)	
	reference1	"" (id=13904)	
	reference2	"" (id=13904)	
	reference3	"" (id=13904)	
	reference4	"" (id=13904)	
	reference5	"" (id=13904)	
	regionState	"" (id=13904)	
	scheduleVo	null	
	scheduleVo	null	
	serviceOrderUrlExpression	"" (id=13904)	
	serviceOrderUrlExpression	"" (id=13904)	
	serviceRemarks	null	
	serviceRemarks	"" (id=13904)	
	systemId	0	
	theFormattedEntity	null	
	timeZone	null	
	TimeZone	null	
	tntZone	"" (id=13904)	


/ we gaan verder met aNode	, we moeten nog 2 fields	,
/ aNode=[mtccore:FROM_LOCATION: null]
			String value = parseNodeValue(aNode, LOCATION_ID_TAG);
NEG913FEI
			if (value != null) {
				myLocationVO.setPartyId(value);

			value = parseNodeValue(aNode, ORGANIZATION_ID_TAG);
null
/ is ook niet verplicht	,
			if (value != null) {
/ NEE
			} else {
				// By default the organization is not required. If an organization is missing and the location should be
				// created, the active organization
				// is used.
				String myValue = ApplicationPropertyManager.getInstance().getModuleProperty("oms", "interface.location.organization.mandatory", "false");
fals
				if ("true".equalsIgnoreCase(myValue)) {
/ NEE

			value = parseNodeValue(aNode, LOCATION_TYPE_TAG);
COLLECT
					PartyType myPartyType = new BeanWrapper<PartyTypeDAO>(PartyTypeDAO.class).getBean().getByCode(value);
					myLocationVO.setPartyType(myPartyType);

			return myLocationVO;

/t
LogisticsOrderBodyProcessor.process(Node, LogisticsOrderVO) line: 199	
					if (myElementName.equals(FROM_LOCATION_TAG)) {
						Party myLocation = new LocationProcessor(this).process(myNode);
/d
myLocation	PartyVO  (id=13961)	
SystemId:0-Party:NEG913FEI-PartyType:com.mpobjects.oms.model.entity.partytype.PartyType@63855d93[COLLECT,Collection address]

						Party myParty = PartyProcessor.storeParty(aLogisticsOrderVO, PartyProcessor.FROM_PARTY_QUALIFIER, myLocation);
/s
PartyProcessor.storeParty(EntityDetailSupport, String, Party) line: 203	
		return storeParty(aVO, aPartyQualifier, aPartyVO, PartyInterfaceMode.CREATE_UPDATE);
/s
PartyProcessor.storeParty(EntityDetailSupport, String, Party, PartyInterfaceMode) line: 224	
/=
	public static Party storeParty(EntityDetailSupport aVO, String aPartyQualifier, Party aPartyVO, PartyInterfaceMode aDefaultMode) throws PartyException {
		PartyInterfaceMode myPartyMode = getPartyMode(aVO, aPartyQualifier, aDefaultMode);
/s
PartyProcessor.getPartyMode(EntityDetailSupport, String, PartyInterfaceMode) line: 196	
		String myEntityName = aVO.getFormattedEntity();
"shipmentorder"
		String myPropertyName = "module.oms.interface." + myEntityName + ".party." + aPartyQualifier + ".mode";
module.oms.interface.shipmentorder.party.from.mode
		String myValue = ApplicationPropertyManager.getInstance().getOrganizationProperty(aVO.getOrganizationVO(), myPropertyName, aDefaultMode.name());
"optional_lookup"
/ want	,
$ vi 2015.01/mpo/mpo.properties
module.oms.interface.shipmentorder.party.from.mode = optional_lookup

		return PartyInterfaceMode.valueOf(myValue.toUpperCase().trim());

/t
PartyProcessor.storeParty(EntityDetailSupport, String, Party, PartyInterfaceMode) line: 225	
		PartyInterfaceMode myPartyMode = getPartyMode(aVO, aPartyQualifier, aDefaultMode);
myPartyMode	PartyInterfaceMode  (id=14016)	
OPTIONAL_LOOKUP
		switch (myPartyMode) {
			case OPTIONAL_LOOKUP:
				myBAO = PartyUtil.getPartyFacadeLocal();
/ proxy naar com.mpobjects.oms.model.service.PartyServiceImpl@4402bc8

				if (myBAO.existWithPartyId(aPartyVO.getPartyId())) {
/ NEE	, 
/ want	,
/ aPartyVO.getPartyId()="NEG913FEI"
/s
PartyServiceImpl.existWithPartyId
		return partyDAO.getPartyByPartyId(aPartyId) != null;
/s
PartyDAOImpl.
	public PartyVO getPartyByPartyId(String aPartyId, boolean aDeleted) {
/ query party met party_id='NEG913FEI' and deleted=false
/ is er niet	,

/t
				if (myBAO.existWithPartyId(aPartyVO.getPartyId())) {
/d
				return aPartyVO;

/ Dus OPTIONAL_LOOKUP returns uit party uit XML	, 
/ Als er een db entry was geweest, had hij die uit de db returned	,	

/ Intermezzo

/ PARTY MODE

	 unchecked: remove the location id and  don't look at the Masterdata 
	- merge: take the data from the interface, create VO, populate missing fields (null, "") with masterdata - If no masterdata is found, just the data from interface is taken (no ecxeption!) -
	 * create_update: create or update the masterdata using the location id (DEFAULT, current behaviour) 
	- lookup: populate the PartyVO with the masterdata using location id, null when nothing found 
	- optional_lookup: populate the PartyVO with the masterdata using location id, use the provided data if no masterdata is found 
	FUTURE: update: check if location is known and update the masterdata, exception when nothing found

lookup:					uit db, anders null 
optional_lookup:		uit db, anders xml
unchecked:				xml
marge_from_masterdata:	
create_update:			

/ Einde Intermezzo

/t
LogisticsOrderBodyProcessor.process(Node, LogisticsOrderVO) line: 199	
						Party myParty = PartyProcessor.storeParty(aLogisticsOrderVO, PartyProcessor.FROM_PARTY_QUALIFIER, myLocation);
/d
						if (myParty != null) {
							aLogisticsOrderVO.setFromPartyVO(new VirtualParty(myParty));
//////////////////////////////////////////////////////////////
/ from wordt dus een virtual party	,

/ volgende	,
			while (myNode != null) {
				if (myNode.getNodeType() == Node.ELEMENT_NODE) {
[mtccore:TO_LOCATION: null]
					} else if (myElementName.equals(TO_LOCATION_TAG)) {

					} else if (myElementName.equals(TO_LOCATION_TAG)) {

						Party myLocation = new LocationProcessor(this).process(myNode);
						Party myParty = PartyProcessor.storeParty(aLogisticsOrderVO, PartyProcessor.TO_PARTY_QUALIFIER, myLocation);
						if (myParty != null) {
							aLogisticsOrderVO.setToPartyVO(new VirtualParty(myParty));
///////////////////////////////////////////////////////////////
/ to is ook een virtual party	,

/ Hetzelfde	, 
/ Alleen in 2015.01/mpo/mpo.properties
module.oms.interface.shipmentorder.party.to.mode = unchecked

/ we hebben nu	,
aLogisticsOrderVO	ShipmentOrderVO  (id=13989)	
	theFromPartyVO	VirtualParty  (id=14262)	
	theToPartyVO	VirtualParty  (id=14274)	

/////////////////////////////////////////

/ volgende	,
LogisticsOrderBodyProcessor.process(Node, LogisticsOrderVO) line: 215	
			while (myNode != null) {
[mtccore:DATE_SET: null]


/ we zien in XML	,
              <mtccore:DATE_SET>
                  <mtccore:REQUESTED_START_AFTER>2015-03-11T14:00:00</mtccore:REQUESTED_START_AFTER>
                  <mtccore:REQUESTED_START_BEFORE>2015-03-11T14:00:00</mtccore:REQUESTED_START_BEFORE>
                  <mtccore:REQUESTED_END_AFTER>2015-03-11T00:00:00</mtccore:REQUESTED_END_AFTER>
                  <mtccore:REQUESTED_END_BEFORE>2015-03-11T00:00:00</mtccore:REQUESTED_END_BEFORE>
               </mtccore:DATE_SET>

					} else if (myElementName.equals(DATE_SET_TAG)) {
/ JA
						DateSetVO myDateSet = new DateSetProcessor(this).process(myNode);
/s
DateSetProcessor.process(Node) line: 122	
/ aNdoe=[mtccore:DATE_SET: null]
			DateSetVO myDateSetVO = new DateSetVO();

			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
REQUESTED_START_AFTER
REQUESTED_START_BEFORE
REQUESTED_END_AFTER
REQUESTED_END_BEFORE
					if (REQUESTED_START_AFTER_TAG.equals(tag)) {
						myDateSetVO.setRequestedStartAfter(parse(childNode.getTextContent()));
					} else if (REQUESTED_START_BEFORE_TAG.equals(tag)) {
						myDateSetVO.setRequestedStartBefore(parse(childNode.getTextContent()));
					} else if (REQUESTED_END_AFTER_TAG.equals(tag)) {
						myDateSetVO.setRequestedEndAfter(parse(childNode.getTextContent()));
					} else if (REQUESTED_END_BEFORE_TAG.equals(tag)) {
						myDateSetVO.setRequestedEndBefore(parse(childNode.getTextContent()));
			return myDateSetVO;

/t
LogisticsOrderBodyProcessor.process(Node, LogisticsOrderVO) line: 217	
					} else if (myElementName.equals(DATE_SET_TAG)) {
						DateSetVO myDateSet = new DateSetProcessor(this).process(myNode);
/d
						aLogisticsOrderVO.setDateSetVO(myDateSet);
/ sets theDateSetVO	,

/ volgende	,
			while (myNode != null) {
				if (myNode.getNodeType() == Node.ELEMENT_NODE) {

/ we zien	,
               <mtccore:TOTAL_WEIGHT>
                  <mtccore:MEASUREMENT_VALUE>5692.0</mtccore:MEASUREMENT_VALUE>
                  <mtccore:UNIT_OF_MEASUREMENT>KG</mtccore:UNIT_OF_MEASUREMENT>
               </mtccore:TOTAL_WEIGHT>

					} else if (myElementName.equals(TOTAL_WEIGHT_TAG)) {
						MeasurementVO myMeasurement = new MeasurementProcessor(this).process(myNode);
/s
MeasurementProcessor.process(Node) line: 51	
		MeasurementVO myVO = new MeasurementVO();

		while (childNode != null) {
			if (childNode.getNodeType() == Node.ELEMENT_NODE) {
				String tag = getElementName(childNode);
MEASUREMENT_VALUE
UNIT_OF_MEASUREMENT
				if (MEASUREMENT_VALUE_TAG.equals(tag)) {
					String value = childNode.getTextContent().trim();
"5692.0"
							myVO.setValue(new BigDecimal(value));
/ sets MeasurementVO.theValue	,
				} else if (UNIT_OF_MEASUREMENT_TAG.equals(tag)) {
					myVO.setUnitOfMeasurement(childNode.getTextContent());
"KG"
/ sets MeasurementVO.theUnitOfMeasurement
		return myVO;

/t
LogisticsOrderBodyProcessor.process(Node, LogisticsOrderVO) line: 219	
					} else if (myElementName.equals(TOTAL_WEIGHT_TAG)) {
						MeasurementVO myMeasurement = new MeasurementProcessor(this).process(myNode);
/d
						aLogisticsOrderVO.setRequestedTotalWeightKg(myMeasurement.getValue());
/ sets	,
		theRequestedTotalWeightKg = aRequestedTotalWeightKg;

/ volgende	,
			while (myNode != null) {
				if (myNode.getNodeType() == Node.ELEMENT_NODE) {
[mtccore:TOTAL_VOLUME: null]

/ we zien	,
              <mtccore:TOTAL_VOLUME>
                  <mtccore:MEASUREMENT_VALUE>30.235</mtccore:MEASUREMENT_VALUE>
                  <mtccore:UNIT_OF_MEASUREMENT>M3</mtccore:UNIT_OF_MEASUREMENT>
               </mtccore:TOTAL_VOLUME>

					} else if (myElementName.equals(TOTAL_VOLUME_TAG)) {
						MeasurementVO myMeasurement = new MeasurementProcessor(this).process(myNode);
						aLogisticsOrderVO.setRequestedTotalVolumeM3(myMeasurement.getValue());
/sets	,
		theRequestedTotalVolumeM3 = aRequestedTotalVolumeM3;

/ t
LogisticsOrderBodyProcessor.process(Node, LogisticsOrderVO) line: 248	
			while (myNode != null) {
/ NIET meer	,
/t
ShipmentOrderBodyProcessor.process(Node) line: 484	
					} else if (COMMON_TAG.equals(myTag)) {
						new LogisticsOrderBodyProcessor(this).process(childNode, myShipmentOrderVO);
/d

/ volgende	,
					} else if (SHIPMENT_ORDER_ID_TAG.equals(myTag)) {
						String nodeText = childNode.getTextContent();
						myShipmentOrderVO.setShipmentOrderId(nodeText);
						if (getProcessingContext() != null) {
							getProcessingContext().addToProcessingContext(SHIPMENT_ORDER_ID_TAG, nodeText);


/ volgende	,
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
[mtccore:ORGANIZATION_ID: null]
NEEC-NL
/ wordt NIET processed	, er is geen case voor	, maar deze is al set in ShipmentOrderBodyProcessor.process	, voor al deze while loops	,

[mtccore:SHIPMENT_ORDER_PROCESS: null]
[mtccore:SHIPMENT_TYPE: null]
[mtccore:ACTUAL_SHIPMENT_SERVICE_LEVEL: null]
[mtccore:INCO_TERM: null]
[mtccore:DANGEROUS_GOODS_YN: null]
[mtccore:SHIPMENT_ORDER_REFERENCE: null]


					} else if (SHIPMENT_ORDER_PROCESS_TAG.equals(myTag)) {
						myShipmentOrderVO.setShipmentOrderProcess(childNode.getTextContent());
AIR
/ sets myShipmentOrderVO.orderProcess	,
/ WAS OUTBOUND	, set in ShipmentOrderBodyProcessor.process , voor al deze while loops 	,

/ volgende	,

					} else if (SHIPMENT_TYPE_TAG.equals(myTag)) {
						String myType = childNode.getTextContent();
"C"
						ShipmentType myShipmentType = new BeanWrapper<ShipmentTypeDAO>(ShipmentTypeDAO.class).getBean().getByCode(myType);
						myShipmentOrderVO.setShipmentType(myShipmentType);
/ sets myShipmentOrderVO.theShipmentType	,
theShipmentType	ShipmentType  (id=14742)	
	code "C"
	organization SystemId:7500	Id:NEEC	Description:Nippon Express Euro Cargo
	...
/ want	,

/ Intermezzo

$ vi ShipmentType.standard.hbm.xml
	<class name="com.mpobjects.oms.model.entity.shipmenttype.ShipmentType" table="SHIPMENT_ORDER_TYPE">

po_2015_01=# select*from shipment_order_type shot join organization o on shot.organization_id=o.system_id where shot.shipment_order_type='C';
 system_id | is_deleted | organization_id | shipment_order_type | description | system_id | organization_id |        description        | autom_rate_calc | is_de
leted | organization_group | sequence | edi_identifier 
-----------+------------+-----------------+---------------------+-------------+-----------+-----------------+---------------------------+-----------------+------
------+--------------------+----------+----------------
  26748243 |          0 |            7500 | C                   | Collect     |      7500 | NEEC            | Nippon Express Euro Cargo |               0 |      
    0 |                    |        0 | NIPPON
(1 row)

/ Einde Intermezzo

/ volgende	,
					} else if (ACTUAL_SHIPMENT_SERVICE_LEVEL_TAG.equals(myTag)) {
						ShipmentServiceLevelVO myServiceLevelVO = checkServiceLevel(childNode.getTextContent());
006
						myShipmentOrderVO.setActualServiceLevelVO(myServiceLevelVO);
/ sets myShipmentOrderVO.actualServiceLevelVO
/s
ShipmentOrderBodyProcessor.checkServiceLevel(String) line: 795	
				myServiceLevelVO = MpoBeanFactory.getBean(ShipmentServiceLevelDAO.class).getByCode(aCode);
		return myServiceLevelVO;

/ Intermezzo

$ vi ShipmentServiceLevelVO.standard.hbm.xml
	<class name="ShipmentServiceLevelVO" table="SHIPMENT_SERVICE_LEVEL">

/ we zien	,
select ... 
from SHIPMENT_SERVICE_LEVEL this_ 
where this_.IS_DELETED=? 
and this_.SERVICE_LEVEL=?
parameters: false, 006 

mpo_2015_01=#  select*from  shipment_service_level;
 system_id | is_deleted | service_level |           description           | hierarchy_level | schedule_systemid 
-----------+------------+---------------+---------------------------------+-----------------+-------------------
  26744787 |          0 | 006           | LTL (Economy) 2.000 – 20.000kgs |               0 |          26639073

/ Einde Intermezzo

/ volgende	,
					} else if (INCO_TERM_TAG.equals(myTag)) {
						incoTermCode = childNode.getTextContent();
DDP
/ een local	,  NIET in myShipmentOrderVO	, (*)
/ TODO
					} else if (DANGEROUS_GOODS_TAG.equals(myTag)) {
						myShipmentOrderVO.setDangerousGoodsYn(childNode.getTextContent().trim().equalsIgnoreCase("Y"));
""
/ sets myShipmentOrderVO.dangerousGoodsYn

/ volgende	,
					if (SHIPMENT_ORDER_REFERENCE_TAG.equals(myTag)) {
						processShipmentOrderReference(myShipmentOrderVO, childNode);
/ Intermezzo
/ we zien	,

           <mtccore:SHIPMENT_ORDER_REFERENCE>
               <mtccore:VALUE>91T50555</mtccore:VALUE>
               <mtccore:QUALIFIER>REFERENCE1</mtccore:QUALIFIER>
            </mtccore:SHIPMENT_ORDER_REFERENCE>
            <mtccore:SHIPMENT_ORDER_REFERENCE>
               <mtccore:VALUE>3114548401</mtccore:VALUE>
               <mtccore:QUALIFIER>REFERENCE2</mtccore:QUALIFIER>
            </mtccore:SHIPMENT_ORDER_REFERENCE>
            <mtccore:SHIPMENT_ORDER_REFERENCE>
               <mtccore:VALUE/>
               <mtccore:QUALIFIER>REFERENCE3</mtccore:QUALIFIER>
            </mtccore:SHIPMENT_ORDER_REFERENCE>
            <mtccore:SHIPMENT_ORDER_REFERENCE>
               <mtccore:VALUE/>
               <mtccore:QUALIFIER>REFERENCE4</mtccore:QUALIFIER>
            </mtccore:SHIPMENT_ORDER_REFERENCE>
            <mtccore:SHIPMENT_ORDER_REFERENCE>
               <mtccore:VALUE>N</mtccore:VALUE>
               <mtccore:QUALIFIER>TemperatureControlled</mtccore:QUALIFIER>
            </mtccore:SHIPMENT_ORDER_REFERENCE>
            <mtccore:SHIPMENT_ORDER_REFERENCE>
               <mtccore:VALUE/>
               <mtccore:QUALIFIER>MinTemperature</mtccore:QUALIFIER>
            </mtccore:SHIPMENT_ORDER_REFERENCE>
            <mtccore:SHIPMENT_ORDER_REFERENCE>
               <mtccore:VALUE/>
               <mtccore:QUALIFIER>MaxTemperature</mtccore:QUALIFIER>
            </mtccore:SHIPMENT_ORDER_REFERENCE>

/ we krijgen dus een aantal keer in ShipmentOrderBodyProcessor.process een while loop	, wat we steeds met / volgende aangeven	,

/ Einde Intermezzo

/s
ShipmentOrderBodyProcessor.processShipmentOrderReference(ShipmentOrderVO, Node) line: 726	
		ReferenceVO myReference = new ReferenceProcessor(this).process(aNode);
/s
ReferenceProcessor.process(Node) line: 39	
		ReferenceVO myVO = new ReferenceVO();

		Node childNode = aNode.getFirstChild();
		while (childNode != null) {
			if (childNode.getNodeType() == Node.ELEMENT_NODE) {
[mtccore:VALUE: null]
[mtccore:QUALIFIER: null]
				if (VALUE_TAG.equals(tag)) {
					myVO.setValue(StringUtils.filterNullValue(childNode.getTextContent()));
Reference(qualifier:, value:91T50555)
				} else if (QUALIFIER_TAG.equals(tag)) {
					myVO.setQualifier(StringUtils.filterNullValue(childNode.getTextContent()));
Reference(qualifier:REFERENCE1, value:91T50555)

		return myVO;
/t
ShipmentOrderBodyProcessor.processShipmentOrderReference(ShipmentOrderVO, Node) line: 728	
		ReferenceVO myReference = new ReferenceProcessor(this).process(aNode);
		String myQualifier = myReference.getQualifier();
		if (myQualifier != null) {
			myQualifier = myQualifier.trim();
			if (myQualifier.equals(REFERENCE1_QUALIFIER)) {
/ JA
				aShipmentOrderVO.setReference1(myReference.getValue());
/ sets aShipmentOrderVO.theReference1	,

aShipmentOrderVO	ShipmentOrderVO  (id=15148)	
	theReference1	"91T55707" (id=16204)	


/t
ShipmentOrderBodyProcessor.process(Node) line: 471	

/ volgende	, (idd weer een reference)	,

		while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
[mtccore:SHIPMENT_ORDER_REFERENCE: null]

					if (SHIPMENT_ORDER_REFERENCE_TAG.equals(myTag)) {
						processShipmentOrderReference(myShipmentOrderVO, childNode);
/s
ShipmentOrderBodyProcessor.processShipmentOrderReference(ShipmentOrderVO, Node) line: 726	
		ReferenceVO myReference = new ReferenceProcessor(this).process(aNode);
/s
ReferenceProcessor.process(Node) line: 39	
		ReferenceVO myVO = new ReferenceVO();

		Node childNode = aNode.getFirstChild();
		while (childNode != null) {
			if (childNode.getNodeType() == Node.ELEMENT_NODE) {
[mtccore:VALUE: null]
				if (VALUE_TAG.equals(tag)) {
					myVO.setValue(StringUtils.filterNullValue(childNode.getTextContent()));
Reference(qualifier:, value:3114548401)

				} else if (QUALIFIER_TAG.equals(tag)) {
					myVO.setQualifier(StringUtils.filterNullValue(childNode.getTextContent()));
Reference(qualifier:REFERENCE2, value:3114548401)

/t
ShipmentOrderBodyProcessor.processShipmentOrderReference(ShipmentOrderVO, Node) line: 728	
		String myQualifier = myReference.getQualifier();
		if (myQualifier != null) {
			myQualifier = myQualifier.trim();
			} else if (myQualifier.equals(REFERENCE2_QUALIFIER)) {
				aShipmentOrderVO.setReference2(myReference.getValue());

/t
ShipmentOrderBodyProcessor.process(Node) line: 470	

/ volgende	,
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					if (SHIPMENT_ORDER_REFERENCE_TAG.equals(myTag)) {
						processShipmentOrderReference(myShipmentOrderVO, childNode);
/ Zo gaan ze allemaal	, 

/ Dan	,
ShipmentOrderBodyProcessor.process(Node) line: 470	

/ volgende	,
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
[mtccore:SHIPMENT_ORDER_PARTY: null]
					} else if (SHIPMENT_ORDER_PARTY_TAG.equals(myTag)) {
						processShipmentOrderParty(myShipmentOrderVO, childNode);

/ we zien, er is weer meerdere SHIPMENT_ORDER_PARTY tags	, net als bij references	,

           <mtccore:SHIPMENT_ORDER_PARTY>
               <mtccore:PARTY_ROLE>BILL_TO</mtccore:PARTY_ROLE>
               <mtccore:PARTY>
                  <mtccore:PARTY_ID>N/A</mtccore:PARTY_ID>
                  <mtccore:PARTY_TYPE>BILL_TO</mtccore:PARTY_TYPE>
                  <mtccore:NAME>FEI ELECTRON OPTICS B.V. H.O.</mtccore:NAME>
                  <mtccore:ADDRESS>ACHTSEWEG NOORD 5</mtccore:ADDRESS>
                  <mtccore:ADDRESS2>5601 GG EINDHOVEN</mtccore:ADDRESS2>
                  <mtccore:CITY>EINDHOVEN</mtccore:CITY>
                  <mtccore:POSTAL_CODE>5600 MD</mtccore:POSTAL_CODE>
                  <mtccore:COUNTRY>
                     <mtccore:COUNTRY_CODE>NL</mtccore:COUNTRY_CODE>
                  </mtccore:COUNTRY>
                  <mtccore:PHONE_NUMBER>040-2356305</mtccore:PHONE_NUMBER>
                  <mtccore:EMAIL_ADDRESS/>
                  <mtccore:CONTACT_NAME/>
               </mtccore:PARTY>
            </mtccore:SHIPMENT_ORDER_PARTY>

            <mtccore:SHIPMENT_ORDER_PARTY>
               <mtccore:PARTY_ROLE>SUPPLIER</mtccore:PARTY_ROLE>
               <mtccore:PARTY>
                  <mtccore:PARTY_ID>N/A</mtccore:PARTY_ID>
                  <mtccore:PARTY_TYPE>CONSIGNEE</mtccore:PARTY_TYPE>
                  <mtccore:NAME>UNIVERSITY OF ADELAIDE</mtccore:NAME>
                  <mtccore:ADDRESS>AUSTRALIA</mtccore:ADDRESS>
                  <mtccore:ADDRESS2/>
                  <mtccore:CITY>ADELAIDE</mtccore:CITY>
                  <mtccore:POSTAL_CODE/>
                  <mtccore:COUNTRY>
                     <mtccore:COUNTRY_CODE>AU</mtccore:COUNTRY_CODE>
                  </mtccore:COUNTRY>
                  <mtccore:PHONE_NUMBER/>
                  <mtccore:EMAIL_ADDRESS/>
                  <mtccore:CONTACT_NAME/>
               </mtccore:PARTY>
            </mtccore:SHIPMENT_ORDER_PARTY>

           <mtccore:SHIPMENT_ORDER_PARTY>
               <mtccore:PARTY_ROLE>PREFERED_EXECUTION</mtccore:PARTY_ROLE>
               <mtccore:PARTY>
                  <mtccore:PARTY_ID>NEEC</mtccore:PARTY_ID>
               </mtccore:PARTY>
            </mtccore:SHIPMENT_ORDER_PARTY>

/ Dit is dan het einde van 
         </mtc:SHIPMENT_ORDER_BODY>

/ Intermezzo

public class ShipmentOrderBodyProcessor extends XMLProcessor {
	public static final String PARTY_ROLE_ULTIMATE_DESTINATION_QUALIFIER = "ULTIMATE_DESTINATION"
	public static final String PARTY_ROLE_BILL_TO_QUALIFIER = "BILL_TO";
	public static final String PARTY_ROLE_EMPLOYEE_RESPONSIBLE_QUALIFIER = "EMPLOYEE_RESPONSIBLE";
	public static final String PARTY_ROLE_PREFERED_EXECUTION_PARTY = "PREFERED_EXECUTION";

	protected void processShipmentOrderParty(ShipmentOrderVO aShipmentOrderVO, Node aNode) throws TransformerException, PartyException, ShipmentOrderException {
		if (myPartyRole.equals(PARTY_ROLE_ULTIMATE_DESTINATION_QUALIFIER) || myPartyRole.equals(PARTY_ROLE_BILL_TO_QUALIFIER)) {
		} else if (myPartyRole.equals(PARTY_ROLE_EMPLOYEE_RESPONSIBLE_QUALIFIER)) {
		} else if (myPartyRole.equals(PARTY_ROLE_PREFERED_EXECUTION_PARTY)) {
		} else {



/ Einde Intermezzo

/ Intermezzo

/ VirtualParty's verschijnen in de shipment_order rows	,
/ dit zijn to, from , bill_to

/ VirtualParty's hoeven geen systemId te hebben (voor Hibernate), want worden onderdeel van de ShipmentOrderVO, en deze heeft een systemId	,

/ ShipmentOrderParty's en PartyVO's moeten een systemId hebben als ze in eeh ShiomentOrderVO, voor Hibernate	, want als we save een ShipmentOrderVO, dan moet hij of null hebben als preferedPartyVO, of een bestaande, NIET een met systemId=0	, 

/ shipment_order_parties: op mpo test  zien we 'Return depo', op mpo acceptance zien we 'Return depo', 'CONSIGNEE'  
/ shipment_order_parties: op pnl test  zien we 'NOTIFY', 'V|A'	,  

/ partyVO: preferred_party in de sho	,

	protected void processShipmentOrderParty(ShipmentOrderVO aShipmentOrderVO, Node aNode) throws TransformerException, PartyException, ShipmentOrderException {

		if (myPartyRole.equals(PARTY_ROLE_ULTIMATE_DESTINATION_QUALIFIER) || myPartyRole.equals(PARTY_ROLE_BILL_TO_QUALIFIER)) {
			Party myParty = new PartyProcessor(this).process(partyNode);
			myParty = PartyProcessor.storeParty(aShipmentOrderVO, "bill_to", myParty);
			if (myParty != null) {
				myParty = new VirtualParty(myParty);
////////////////////////////////////////////////
/ bill_to is virtual party	,

			}
			aShipmentOrderVO.setBillToPartyVO(myParty);

		} else if (myPartyRole.equals(PARTY_ROLE_EMPLOYEE_RESPONSIBLE_QUALIFIER)) {
			Party myParty = new PartyProcessor(this).process(partyNode);
			myParty = PartyProcessor.storeParty(aShipmentOrderVO, "employee_responsible", myParty);
			if (myParty != null) {
				myParty = new VirtualParty(myParty);
//////////////////////////////////////////////
/ employeeResponsiblePartyVO is een virtual party	,
			}
			aShipmentOrderVO.setEmployeeResponsiblePartyVO(myParty);

		} else if (myPartyRole.equals(PARTY_ROLE_PREFERED_EXECUTION_PARTY)) {
			Party myParty = new PartyProcessor(this).process(partyNode);
			if (myParty != null) {
				PreferedPartyTranslationPojo myPreferedPartyTranslationPojo;

				myPreferedPartyTranslationPojo = MpoBeanFactory.getBean(PreferedPartyTranslationDao.class).findByPartyId(
						aShipmentOrderVO.getOrganizationSystemid(), myParty.getPartyId());

				if (myPreferedPartyTranslationPojo != null) {
					myParty = myPreferedPartyTranslationPojo.getParty();
				} else {
					myParty = PartyProcessor.storeParty(aShipmentOrderVO, "prefered_execution", myParty);
				}
			} else {
				myParty = PartyProcessor.storeParty(aShipmentOrderVO, "prefered_execution", myParty);
			}
			aShipmentOrderVO.setPreferedPartyVO(myParty);
//////////////////////////////////////////////
/ preferedPartyVO is een PartyVO,

		} else {
			Party myParty = new PartyProcessor(this).process(partyNode);
			myParty = PartyProcessor.storeParty(aShipmentOrderVO, myPartyRole, myParty, PartyInterfaceMode.UNCHECKED);
			// check if the party role is a party type in TMS with showOnSho = true
			PartyTypeGroupVO myPartyTypeGroup = null;
			try {
				myPartyTypeGroup = MpoBeanFactory.getBean(PartyTypeGroupDAO.class).getByCode(myPartyRole);
			} catch (Exception e) {
				LOG.error("Error when retrieving partytypegroup [" + myPartyRole + "]", e);
			}

			if (myPartyTypeGroup != null && myPartyTypeGroup.isShowOnSho()) {
				// store party as ShipmentOrderParty
				ShipmentOrderParty myShipmentOrderParty = new ShipmentOrderParty();
				myShipmentOrderParty.setSyncFlag(PartySyncFlag.parse(getSyncFlag(myPartyTypeGroup.getCode())));
				myShipmentOrderParty.copyValuesFrom(myParty);
				myShipmentOrderParty.setPartyTypeGroup(myPartyTypeGroup);
				myShipmentOrderParty.setShipmentOrder(aShipmentOrderVO);
 				aShipmentOrderVO.addShipmentOrderParty(myShipmentOrderParty);
////////////////////////////////////////////////////////////////
/ shipmentOrderParties is een list van ShipmentOrderPartyVO	,
			} else {
				LOG.error("Skipping, unknown Shipment order party qualifier: " + myPartyRole);
	


/ Einde Intermezzo

/s
ShipmentOrderBodyProcessor.processShipmentOrderParty(ShipmentOrderVO, Node) line: 634	

		while (childNode != null) {
			if (childNode.getNodeType() == Node.ELEMENT_NODE) {
[mtccore:PARTY_ROLE: null]
[mtccore:PARTY: null]
				if (PARTY_ROLE_TAG.equals(tag)) {
					partyRoleNode = childNode;
				} else if (PARTY_TAG.equals(tag)) {
					partyNode = childNode;

			if (partyRoleNode != null && partyNode != null) {
				break;

		String myPartyRole = partyRoleNode.getTextContent();
BILL_TO
		if (myPartyRole.equals(... || myPartyRole.equals(PARTY_ROLE_BILL_TO_QUALIFIER)) {
			Party myParty = new PartyProcessor(this).process(partyNode);
/s
PartyProcessor.process(Node) line: 375	

			Party myVO = new PartyVO();

			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
[mtccore:PARTY_ID: null]
[mtccore:PARTY_TYPE: null]
[mtccore:NAME: null]
[mtccore:ADDRESS: null]
[mtccore:ADDRESS2: null]
[mtccore:CITY: null]
[mtccore:POSTAL_CODE: null]
[mtccore:COUNTRY: null]
[mtccore:PHONE_NUMBER: null]
[mtccore:EMAIL_ADDRESS: null]
[mtccore:CONTACT_NAME: null]

					} else if (PARTY_ID_TAG.equals(tag)) {
						myVO.setPartyId(childNode.getTextContent());
N/A
					} else if (PARTY_TYPE_TAG.equals(tag)) {
						String myPartyTypeCode = childNode.getTextContent();
BILL_TO
						if (!myPartyTypeCode.equals(UNSPECIFIED_PARTY_TYPE)) {
/ JA
							PartyType myPartyType = new BeanWrapper<PartyTypeDAO>(PartyTypeDAO.class).getBean().getByCode(childNode.getTextContent());
/ we zien	,
mpo_2015_01=# select*from party_type;
 system_id | is_deleted |      party_type      |       description       
-----------+------------+----------------------+-------------------------
  26748167 |          0 | BILL_TO              | Bill to party

							myVO.setPartyType(myPartyType);
						}
					} else if (NAME_TAG.equals(tag)) {
						myVO.setName(childNode.getTextContent());
FEI ELECTRON OPTICS B.V. H.O.
					} else if (ADDRESS_TAG.equals(tag)) {
						myVO.setAddress(childNode.getTextContent());
ACHTSEWEG NOORD 5
					} else if (ADDRESS2_TAG.equals(tag)) {
						myVO.setAddress2(childNode.getTextContent());
5601 GG EINDHOVEN
					} else if (CITY_TAG.equals(tag)) {
						myVO.setCity(childNode.getTextContent());
EINDHOVEN
					} else if (POSTAL_CODE_TAG.equals(tag)) {
						myVO.setPostalCode(childNode.getTextContent());
5600 MD
					} else if (COUNTRY_TAG.equals(tag)) {
						myVO.setCountryVO(new CountryProcessor(this).process(childNode));
<mtccore:COUNTRY_CODE>NL</mtccore:COUNTRY_CODE>
					} else if (PHONE_NUMBER_TAG.equals(tag)) {
						myVO.setPhoneNumber(childNode.getTextContent());
040-2356305
					} else if (EMAIL_ADDRESS_TAG.equals(tag)) {
						myVO.setEmailAddress(childNode.getTextContent());
""
					} else if (CONTACT_NAME_TAG.equals(tag)) {
						myVO.setContactName(childNode.getTextContent());
""

/t
ShipmentOrderBodyProcessor.processShipmentOrderParty(ShipmentOrderVO, Node) line: 661	
			Party myParty = new PartyProcessor(this).process(partyNode);
/d
/ myParty.systemId=0

			myParty = PartyProcessor.storeParty(aShipmentOrderVO, "bill_to", myParty);
/s
PartyProcessor.storeParty(EntityDetailSupport, String, Party) line: 203	
		return storeParty(aVO, aPartyQualifier, aPartyVO, PartyInterfaceMode.CREATE_UPDATE);
/s
PartyProcessor.storeParty(EntityDetailSupport, String, Party, PartyInterfaceMode) line: 224	
		PartyInterfaceMode myPartyMode = getPartyMode(aVO, aPartyQualifier, aDefaultMode);
/s
PartyProcessor.getPartyMode(EntityDetailSupport, String, PartyInterfaceMode) line: 196	
		String myEntityName = aVO.getFormattedEntity();
myEntityName	"shipmentorder" (id=15407)	
/ WH
EntityType.SHIPMENT_ORDER	, en to lower case	,
		String myPropertyName = "module.oms.interface." + myEntityName + ".party." + aPartyQualifier + ".mode";
module.oms.interface.shipmentorder.party.bill_to.mode
		String myValue = ApplicationPropertyManager.getInstance().getOrganizationProperty(aVO.getOrganizationVO(), myPropertyName, aDefaultMode.name());
"unchecked"
/ In JBoss's conf/application.properties	, omdat in 2015.01/mpo/mpo.properties	,
module.oms.interface.shipmentorder.party.bill_to.mode=unchecked
		return PartyInterfaceMode.valueOf(myValue.toUpperCase().trim());
PartyInterfaceMode
	name:"UNCHECKED"

/t
PartyProcessor.storeParty(EntityDetailSupport, String, Party, PartyInterfaceMode) line: 225	
		PartyInterfaceMode myPartyMode = getPartyMode(aVO, aPartyQualifier, aDefaultMode);
/d
		switch (myPartyMode) {
			case UNCHECKED:
				return aPartyVO;

/t
ShipmentOrderBodyProcessor.processShipmentOrderParty(ShipmentOrderVO, Node) line: 662	
			if (myParty != null) {
				myParty = new VirtualParty(myParty);
			aShipmentOrderVO.setBillToPartyVO(myParty);
/ sets aShipmentOrderVO.theBillToParty	,

/ myParty.systemId=0

/ we zien dat de theFromParty, theToParty	, theBillToParty zijn VirtualParty's	,

/t
ShipmentOrderBodyProcessor.process(Node) line: 468	

/ volgende	,
            while (childNode != null) {
[mtccore:SHIPMENT_ORDER_PARTY: null]
                if (childNode.getNodeType() == Node.ELEMENT_NODE) {
                    } else if (SHIPMENT_ORDER_PARTY_TAG.equals(myTag)) {
                        processShipmentOrderParty(myShipmentOrderVO, childNode);
/s
ShipmentOrderBodyProcessor.processShipmentOrderParty(ShipmentOrderVO, Node) line: 634
		while (childNode != null) {
			if (childNode.getNodeType() == Node.ELEMENT_NODE) {
				String tag = getElementName(childNode);
PARTY_ROLE
PARTY
				if (PARTY_ROLE_TAG.equals(tag)) {
					partyRoleNode = childNode;
childNode	DeferredElementImpl  (id=15065)	
	firstChild	DeferredTextImpl  (id=15081)	
[#text: SUPPLIER]
				} else if (PARTY_TAG.equals(tag)) {
					partyNode = childNode;
[mtccore:PARTY: null]
              <mtccore:PARTY>
                  <mtccore:PARTY_ID>N/A</mtccore:PARTY_ID>
                  <mtccore:PARTY_TYPE>CONSIGNEE</mtccore:PARTY_TYPE>
                  <mtccore:NAME>UNIVERSITY OF ADELAIDE</mtccore:NAME>
                  <mtccore:ADDRESS>AUSTRALIA</mtccore:ADDRESS>
                  <mtccore:ADDRESS2/>
                  <mtccore:CITY>ADELAIDE</mtccore:CITY>
                  <mtccore:POSTAL_CODE/>
                  <mtccore:COUNTRY>
                     <mtccore:COUNTRY_CODE>AU</mtccore:COUNTRY_CODE>
                  </mtccore:COUNTRY>
                  <mtccore:PHONE_NUMBER/>
                  <mtccore:EMAIL_ADDRESS/>
                  <mtccore:CONTACT_NAME/>
               </mtccore:PARTY>

			if (partyRoleNode != null && partyNode != null) {

				break;
		String myPartyRole = partyRoleNode.getTextContent();
SUPPLIER
		if (myPartyRole.equals(PARTY_ROLE_ULTIMATE_DESTINATION_QUALIFIER) || myPartyRole.equals(PARTY_ROLE_BILL_TO_QUALIFIER)) {
/ NEE
		} else {
			Party myParty = new PartyProcessor(this).process(partyNode);
/s
PartyProcessor.process(Node) line: 385	

			Party myVO = new PartyVO();

			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
"PARTY_ID"
"PARTY_TYPE"
/ Hieronder verder met 
NAME
ADDRESS
...
					} else if (PARTY_ID_TAG.equals(tag)) {
						myVO.setPartyId(childNode.getTextContent());
/ sets  PartyVO.partyId	,
					} else if (PARTY_TYPE_TAG.equals(tag)) {
						String myPartyTypeCode = childNode.getTextContent();
CONSIGNEE
						if (!myPartyTypeCode.equals(UNSPECIFIED_PARTY_TYPE)) {
							PartyType myPartyType = new BeanWrapper<PartyTypeDAO>(PartyTypeDAO.class).getBean().getByCode(childNode.getTextContent());
/s
PartyTypeDAOImpl(EnumeratedValueObjectHibernateDAO).getByCode(String, boolean) line: 63	
this	PartyTypeDAOImpl  (id=15383)	
		map.put(CODE_FIELD, aCode);
code='CONSIGNEE'
			map.put(DELETED, false);
deleted=false 
		Collection<T> result = findEqualsWithQueryMap(map);
/s
PartyTypeDAOImpl(GenericHibernateDAO).findEqualsWithQueryMap(Map<String,Object>) line: 223	
		DetachedCriteria myDetachedCriteria = DetachedCriteria.forClass(type);
this	PartyTypeDAOImpl  (id=15383)	
	type	Class (com.mpobjects.oms.model.entity.partytype.PartyType) (id=10309)	

		for (String myAttribute : aCriteriaQueryMap.keySet()) {
			myDetachedCriteria.add(Property.forName(myAttribute).eq(aCriteriaQueryMap.get(myAttribute)));

/ Intermezzo

$ vi PartyType.standard.hbm.xml
	<class name="com.mpobjects.oms.model.entity.partytype.PartyType" table="PARTY_TYPE">
		<property name="code" column="PARTY_TYPE" length="20" />

/ we zien dat de prop "code" wordt mapped op 'party_type' column	,

mpo_2015_01=# select*from party_type;
 system_id | is_deleted |      party_type      |       description       
-----------+------------+----------------------+-------------------------
  26676822 |          0 | CONSIGNEE            | Consignee


/ we zien  in de log	,

select ... 
from PARTY_TYPE this_ 
where this_.IS_DELETED=? 
and this_.PARTY_TYPE=?
1949194 2015-04-08 13:33:43,512 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (MpoQueueContainer-1:) binding parameter [1] as [BIT] - false
1949196 2015-04-08 13:33:43,513 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (MpoQueueContainer-1:) binding parameter [2] as [VARCHAR] - CONSIGNEE

/ Einde Intermezzo

/t
PartyProcessor.process(Node) line: 390	
							PartyType myPartyType = new BeanWrapper<PartyTypeDAO>(PartyTypeDAO.class).getBean().getByCode(childNode.getTextContent());
/d
myPartyType	PartyType  (id=15800)	
	code	"CONSIGNEE" (id=15802)	
	deleted	false	
	...
							myVO.setPartyType(myPartyType);
/ sets AbstractParty.partyType

/ de party's partyType=CONSIGNEE	,

/ we zijn nog in	,
PartyProcessor.process(Node) line: 390	

/ volgende	,
			while (childNode != null) {
NAME
ADDRESS
ADDRESS2
CITY
POSTAL_CODE
COUNTRY
PHONE_NUMBER
EMAIL_ADDRESS
CONTACT_NAME
					} else if (NAME_TAG.equals(tag)) {
						myVO.setName(childNode.getTextContent());
/ sets AbstractParty.name
					} else if (ADDRESS_TAG.equals(tag)) {
						myVO.setAddress(childNode.getTextContent());
/ sets AbstractParty.address
					} else if (ADDRESS2_TAG.equals(tag)) {
						myVO.setAddress2(childNode.getTextContent());
					} else if (CITY_TAG.equals(tag)) {
						myVO.setCity(childNode.getTextContent());
					} else if (POSTAL_CODE_TAG.equals(tag)) {
						myVO.setPostalCode(childNode.getTextContent());
/ sets AbstractParty.postalCode
					} else if (COUNTRY_TAG.equals(tag)) {
						myVO.setCountryVO(new CountryProcessor(this).process(childNode));
					} else if (PHONE_NUMBER_TAG.equals(tag)) {
						myVO.setPhoneNumber(childNode.getTextContent());
					} else if (EMAIL_ADDRESS_TAG.equals(tag)) {
						myVO.setEmailAddress(childNode.getTextContent());
					} else if (CONTACT_NAME_TAG.equals(tag)) {
						myVO.setContactName(childNode.getTextContent());
			return myVO;

/t
ShipmentOrderBodyProcessor.processShipmentOrderParty(ShipmentOrderVO, Node) line: 696	
		} else {
			Party myParty = new PartyProcessor(this).process(partyNode);
/d
			myParty = PartyProcessor.storeParty(aShipmentOrderVO, myPartyRole, myParty, PartyInterfaceMode.UNCHECKED);

/ gaat direct naar 	, met unchecked	,
/s
PartyProcessor.storeParty(EntityDetailSupport, String, Party, PartyInterfaceMode) line: 224	
		PartyInterfaceMode myPartyMode = getPartyMode(aVO, aPartyQualifier, aDefaultMode);
/s
PartyProcessor.getPartyMode(EntityDetailSupport, String, PartyInterfaceMode) line: 196	
/=
	public static PartyInterfaceMode getPartyMode(EntityDetailSupport aVO, String aPartyQualifier, PartyInterfaceMode aDefaultMode) {
		String myEntityName = aVO.getFormattedEntity();
"shipmentorder"
		String myPropertyName = "module.oms.interface." + myEntityName + ".party." + aPartyQualifier + ".mode";
module.oms.interface.shipmentorder.party.SUPPLIER.mode
		String myValue = ApplicationPropertyManager.getInstance().getOrganizationProperty(aVO.getOrganizationVO(), myPropertyName, aDefaultMode.name());
UNCHECKED
/ De property is er NIET, dus de default UNCHECKED	,
		return PartyInterfaceMode.valueOf(myValue.toUpperCase().trim());

/t
PartyProcessor.storeParty(EntityDetailSupport, String, Party, PartyInterfaceMode) line: 225	
		PartyInterfaceMode myPartyMode = getPartyMode(aVO, aPartyQualifier, aDefaultMode);
UNCHECKED
		switch (myPartyMode) {
			case UNCHECKED:
				return aPartyVO;

/t
ShipmentOrderBodyProcessor.processShipmentOrderParty(ShipmentOrderVO, Node) line: 699	
		} else {
			Party myParty = new PartyProcessor(this).process(partyNode);
			myParty = PartyProcessor.storeParty(aShipmentOrderVO, myPartyRole, myParty, PartyInterfaceMode.UNCHECKED);
/d
			PartyTypeGroupVO myPartyTypeGroup = null;
			try {
				myPartyTypeGroup = MpoBeanFactory.getBean(PartyTypeGroupDAO.class).getByCode(myPartyRole);
null
/ myPartyRole='SUPPLIER'
/want	,


/ Intermezzo

$ vi PartyTypeGroupVO.standard.hbm.xml

<hibernate-mapping package="com.mpobjects.oms.model.partytypegroup.vo">
	<class name="PartyTypeGroupVO" table="PARTY_TYPE_GROUP">
		<property name="code" column="PARTY_TYPE_GROUP"/>

/ we zien	,
po_2015_01=# select*from party_type_group;
 system_id | party_type_group |       description       | is_deleted | show_on_sho | show_on_so | is_system | show_on_co | show_on_col 
-----------+------------------+-------------------------+------------+-------------+------------+-----------+------------+-------------
/ GEEN row met party_type_group='SUPPLIER'	,
/ Dat komt door mijn db	, 
/ 

/ Einde Intermezzo 

/t
ShipmentOrderBodyProcessor.process(Node) line: 482	
			if (myPartyTypeGroup != null && myPartyTypeGroup.isShowOnSho()) {
/ NEE
				...
				aShipmentOrderVO.addShipmentOrderParty(myShipmentOrderParty);
/s
					theShipmentOrderPartyList.add(aShipmentOrderParty);
/ NIET 	, 
/ Intermezzo

/ Dit komt door mijn locale db	, daar is SUPPLIER niet in de party_type_group table,	 

/ een sho heeft vaste fields: theToPartyVO	, ...
/ een sho heeft ook voor custom party's theShipmentOrderPartyList	, inderdaad een list	, deze supplier-sho party zou in deze party list gaan	, 

/ Einde Intermezzo
			} else {
				LOG.error("Skipping, unknown Shipment order party qualifier: " + myPartyRole);
/ myPartyRole='SUPPLIER'
/ TODO (SUPPLIER)

/ dus de SUPPLIER party is NIET saved	, wordt overgeslagen	,


/ volgende	,
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					} else if (SHIPMENT_ORDER_PARTY_TAG.equals(myTag)) {
						processShipmentOrderParty(myShipmentOrderVO, childNode);
/s
ShipmentOrderBodyProcessor.processShipmentOrderParty(ShipmentOrderVO, Node) line: 634	

		while (childNode != null) {
				String tag = getElementName(childNode);
				if (PARTY_ROLE_TAG.equals(tag)) {
					partyRoleNode = childNode;
partyRoleNode DeferredElementImpl  (id=19674)	
	firstChild	DeferredTextImpl  (id=19691)	
[#text: PREFERED_EXECUTION]

				} else if (PARTY_TAG.equals(tag)) {
					partyNode = childNode;
partyNode	DeferredElementImpl  (id=16157)	
	firstChild	DeferredTextImpl  (id=16168)	
		nextSibling	DeferredElementImpl  (id=16188)	
			firstChild	DeferredTextImpl  (id=16194)	
[#text: NEEC]

/ Intermezzo

              <mtccore:PARTY>
                  <mtccore:PARTY_ID>NEEC</mtccore:PARTY_ID>
               </mtccore:PARTY>

/ Einde Intermezzo

			if (partyRoleNode != null && partyNode != null) {
				break;

		String myPartyRole = partyRoleNode.getTextContent();
PREFERED_EXECUTION
		if (myPartyRole.equals(PARTY_ROLE_ULTIMATE_DESTINATION_QUALIFIER) || myPartyRole.equals(PARTY_ROLE_BILL_TO_QUALIFIER)) {
/ NEE
		} else if (myPartyRole.equals(PARTY_ROLE_PREFERED_EXECUTION_PARTY)) {
/ JA
			Party myParty = new PartyProcessor(this).process(partyNode);

/ partyNode is hierboven	,
              <mtccore:PARTY>
                  <mtccore:PARTY_ID>NEEC</mtccore:PARTY_ID>
               </mtccore:PARTY>
/s
PartyProcessor.process(Node) line: 375	

			Party myVO = new PartyVO();

				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
"PARTY_ID"
					} else if (PARTY_ID_TAG.equals(tag)) {
						myVO.setPartyId(childNode.getTextContent());
NEEC
			return myVO;

/t
ShipmentOrderBodyProcessor.processShipmentOrderParty(ShipmentOrderVO, Node) line: 679	
		} else if (myPartyRole.equals(PARTY_ROLE_PREFERED_EXECUTION_PARTY)) {
			Party myParty = new PartyProcessor(this).process(partyNode);
/d
/ Alleen partyId	,

/ Uit db, of anders uit XML?
				myPreferedPartyTranslationPojo = MpoBeanFactory.getBean(PreferedPartyTranslationDao.class).findByPartyId(
						aShipmentOrderVO.getOrganizationSystemid(), myParty.getPartyId());
/ aShipmentOrderVO.getOrganizationSystemid()=5001
/ dit is NEEC-NL
/ myParty.getPartyId()="NEEC"

/ Intermezzo

$ vi PreferedPartyTranslation.standard.hbm.xml

	<class name="com.mpobjects.oms.model.party.vo.PreferedPartyTranslationPojo"
		lazy="false" table="PREFERED_PARTY_TRANSLATION">

mpo_2015_01=# select*from prefered_party_translation;
 system_id | party_from | party_to_systemid | organization_systemid 
-----------+------------+-------------------+-----------------------
(0 rows)

/ Einde Intermezzo

				if (myPreferedPartyTranslationPojo != null) {
/ NEE
/ pak niet de pref party uit db, maar uit XML	,
				} else {
					myParty = PartyProcessor.storeParty(aShipmentOrderVO, "prefered_execution", myParty);
/s
PartyProcessor.storeParty(EntityDetailSupport, String, Party, PartyInterfaceMode) line: 224	
		PartyInterfaceMode myPartyMode = getPartyMode(aVO, aPartyQualifier, aDefaultMode);
/s
PartyProcessor.getPartyMode(EntityDetailSupport, String, PartyInterfaceMode) line: 196	
		String myEntityName = aVO.getFormattedEntity();
myEntityName	"shipmentorder" (id=15407)	
		String myPropertyName = "module.oms.interface." + myEntityName + ".party." + aPartyQualifier + ".mode";
myPropertyName	"module.oms.interface.shipmentorder.party.prefered_execution.mode" (id=20045)	
		String myValue = ApplicationPropertyManager.getInstance().getOrganizationProperty(aVO.getOrganizationVO(), myPropertyName, aDefaultMode.name());
myValue	"merge_from_masterdata" (id=20046)	

/ want	,
$ vi 2015.01/mpo/mpo.properties
module.oms.interface.shipmentorder.party.prefered_execution.mode = merge_from_masterdata

/t
PartyProcessor.storeParty(EntityDetailSupport, String, Party, PartyInterfaceMode) line: 225	
		PartyInterfaceMode myPartyMode = getPartyMode(aVO, aPartyQualifier, aDefaultMode);
/d
MERGE_FROM_MASTERDATA
		switch (myPartyMode) {
			case MERGE_FROM_MASTERDATA:
				myBAO = PartyUtil.getPartyFacadeLocal();
/ proxy to com.mpobjects.oms.model.service.PartyServiceImpl@19b7baaa

				if (myBAO.existWithPartyId(aPartyVO.getPartyId())) {
/ NEE
/ want	,
/s
PartyServiceImpl.existWithPartyId(String) line: 149	
		return partyDAO.getPartyByPartyId(aPartyId) != null;
/s
PartyDAOImpl.getPartyByPartyId(String) line: 193	
		return getPartyByPartyId(aPartyId, false);
/s
PartyDAOImpl.getPartyByPartyId(String, boolean) line: 199	
		myCriteria.add(Property.forName("partyId").eq(aPartyId));
NEEC
		myCriteria.add(Property.forName("deleted").eq(aDeleted));
false
		List<PartyVO> myList = findByCriteria(myCriteria);

		if (myList == null || myList.isEmpty()) {
/ JA
			return null;

/ Intermezzo

/ we zien	,

select ... 
from PARTY this_ 
left outer join ORGANIZATION organizati2_ on this_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID 
left outer join ORGANIZATION organizati3_ on organizati2_.ORGANIZATION_GROUP=organizati3_.SYSTEM_ID 
where this_.PARTY_ID=? and this_.IS_DELETED=?
2015-04-07 17:20:13,049 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (MpoQueueContainer-1:) binding parameter [1] as [VARCHAR] - NEEC
2015-04-07 17:20:13,050 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (MpoQueueContainer-1:) binding parameter [2] as [BIT] - false

mpo_2015_01=# select*from party where party_id='NEEC';
 system_id | is_deleted | party_id | party_type_systemid | organization_systemid | name | name2 | address | address2 | city | zipcode | country_systemid | contac
t_name | emailaddress | faxnumber | phonenumber | region_state | tnt_zone | reference1 | reference2 | reference3 | reference4 | reference5 | service_order_url_ex
pression | manifest_report | time_zone | longitude | latitude | schedule_systemid | prenotify_carcon | service_remarks 
-----------+------------+----------+---------------------+-----------------------+------+-------+---------+----------+------+---------+------------------+-------
-------+--------------+-----------+-------------+--------------+----------+------------+------------+------------+------------+------------+---------------------
---------+-----------------+-----------+-----------+----------+-------------------+------------------+-----------------
(0 rows)

/ Einde Intermezzo

				return aPartyVO;
/ Dus net als UNCHECKED	,

/t
ShipmentOrderBodyProcessor.processShipmentOrderParty(ShipmentOrderVO, Node) line: 690	
				} else {
					myParty = PartyProcessor.storeParty(aShipmentOrderVO, "prefered_execution", myParty);
/d
SystemId:0-Party:NEEC-PartyType:null
/ Die uit de XML

			aShipmentOrderVO.setPreferedPartyVO(myParty);
/ sets ShipmentOrderVO.thePreferedPartyVO	,

/t
ShipmentOrderBodyProcessor.process(Node) line: 468	
			while (childNode != null) {
/ NEE
/ </mtc:SHIPMENT_ORDER_BODY> heeft geen  children meer	,

/ Dit was die local bij (*)	,
			if (incoTermCode != null) {
"DDP"
				IncoTermVO myIncoTermVO = null;
				try {
					if (incoTermVersion == null || incoTermVersion.isEmpty()) {
						Collection<IncoTermVO> incotermCollection = IncoTermUtil.getIncoTermDAO().findByCode(incoTermCode);

/ Intermezzo

$ vi IncoTerm.standard.hbm.xml

	<class name="com.mpobjects.oms.model.incoterm.vo.IncoTermVO" table="INCO_TERM">

mpo_2015_01=# select*from inco_term where  inco_term_code='DDP';
 system_id | is_deleted | inco_term_code | inco_term_description | version 
-----------+------------+----------------+-----------------------+---------
      6002 |          0 | DDP            | Delivered Duty Paid   | 2000
  26594658 |          0 | DDP            | Delivered Duty Paid   | 2010
(2 rows)

/ Einde Intermezzo

						if (incotermCollection != null && !incotermCollection.isEmpty()) {
							myIncoTermVO = incotermCollection.iterator().next();
SystemId:6002	isDeleted:false	Code:DDP	Description:Delivered Duty PaidVersion:2000
/ Pakt de 1ste
/ TODO
				myShipmentOrderVO.setIncoTermVO(myIncoTermVO);
/ sets ShipmentOrderVO.theIncoTermVO

			myShipmentOrderVO.setChargeTimeWindowYn(false);
/ sets ShipmentOrderVO.chargeTimeWindowYn

			myShipmentOrderVO.setSystemEntryDate(MpoBeanFactory.getBean(TimeService.class).getPresentDate());
/ sets ShipmentOrderVO.theSystemEntryDate

			myShipmentOrderVO.resolveShipmentType();
/s
ShipmentOrderVO.resolveShipmentType() line: 2070	
		if (getShipmentType() != null) {
/ JA
			return;
/ Is al set met "C"	hierboven	,

/t
ShipmentOrderBodyProcessor.process(Node) line: 603	
			return myShipmentOrderVO;
/t
ShipmentOrderProcessor.process(Node) line: 209	
		ShipmentOrderBodyProcessor myProcessor = Factory.getFactory().getInstance(ShipmentOrderBodyProcessor.class);
			myShipmentOrderVO = myProcessor.process(selectSingleNode(aNode, SHIPMENT_ORDER_BODY_TAG));
/d
			List<ProductItemVO> myProductList = parseProductItems(aNode, myShipmentOrderVO);
/ aNode=[mtc:SHIPMENT_ORDER: null]
/s
ShipmentOrderProcessor.parseProductItems(Node, ShipmentOrderVO) line: 140	
		Node myItemsNode = selectSingleNode(aNode, PRODUCT_ITEMS_TAG);
[mtc:PRODUCT_ITEMS: null]

/ Intermezzo
			...
         </mtc:SHIPMENT_ORDER_BODY>

         <mtc:PRODUCT_ITEMS>
            <mtccore:PRODUCT_ITEM>
               <mtccore:PRODUCT_ITEM_ID>001</mtccore:PRODUCT_ITEM_ID>
               <mtccore:DESCRIPTION>GENERAL TRADING GOODS</mtccore:DESCRIPTION>
               <mtccore:QUANTITY>1</mtccore:QUANTITY>
               <mtccore:HAZGOODS_REQUESTED_ADR_CODE>ADR</mtccore:HAZGOODS_REQUESTED_ADR_CODE>
               <mtccore:HAZGOODS_REQUESTED_UN_NUMBER/>
            </mtccore:PRODUCT_ITEM>
         </mtc:PRODUCT_ITEMS>

/ Einde Intermezzo

		List<ProductItemVO> myProductList = new ArrayList<ProductItemVO>();
		ProductItemProcessor productItemProcessor = new ProductItemProcessor(this);
		...
		while (myNode != null) {
			if (myNode.getNodeType() == Node.ELEMENT_NODE) {
					ProductItemVO myProductItem = productItemProcessor.process(myNode, myShipmentOrderVO);
/s
ProductItemProcessor.process(Node, ShipmentOrderVO) line: 301	

			ProductItemVO myItemVO = new ProductItemVO();

			while (childNode != null) {
					String tag = getElementName(childNode);
PRODUCT_ITEM_ID
DESCRIPTION
QUANTITY
HAZGOODS_REQUESTED_ADR_CODE
HAZGOODS_REQUESTED_UN_NUMBER
					if (PRODUCT_ITEM_ID_TAG.equals(tag)) {
						myItemVO.setProductItemId(childNode.getTextContent());
/ sets ProductItemVO.theProductItemId 
					} else if (DESCRIPTION_TAG.equals(tag)) {
						myItemVO.setDescription(childNode.getTextContent());
/ sets ProductItemVO.theDescription
					} else if (QUANTITY_TAG.equals(tag)) {
						myItemVO.setQuantity(new BigDecimal(childNode.getTextContent()));
/s
	public void setQuantity(BigDecimal aQuantity) {
		theQuantity = aQuantity;
		if (theQuantity != null) {
			theQuantity = theQuantity.divide(new BigDecimal(1), LogisticsOrderVO.ITEM_PRECISION, BigDecimal.ROUND_HALF_UP);
1.00
/  LogisticsOrderVO.ITEM_PRECISION==2
/ BigDecimal.ROUND_HALF_UP==4
/ TODO
/t
					} else if (REQUESTED_ADR_CODE_TAG.equals(tag)) {
						myItemVO.setRequestedAdrCode(childNode.getTextContent());
/ sets ProductItemVO.requestedAdrCode
					} else if (REQUESTED_UN_NUMEBR_TAG.equals(tag)) {
						myItemVO.setRequestedUnNumber(childNode.getTextContent());
/ sets ProductItemVO.requestedUnNumber
			return myItemVO;

/t
ShipmentOrderProcessor.parseProductItems(Node, ShipmentOrderVO) line: 153	
					ProductItemVO myProductItem = productItemProcessor.process(myNode, myShipmentOrderVO);
/d
					myProductList.add(myProductItem);
		return myProductList;
/t
ShipmentOrderProcessor.process(Node) line: 215	
			List<ProductItemVO> myProductList = parseProductItems(aNode, myShipmentOrderVO);
/d
			List<ShipmentItemVO> myShipmentItems = parseShipmentItems(aNode, myProductList, myShipmentOrderVO.getOrganizationSystemid());
/s
ShipmentOrderProcessor.parseShipmentItems(Node, List<ProductItemVO>, int) line: 164	
/=
	public List<ShipmentItemVO> parseShipmentItems(Node aNode, List<ProductItemVO> aProductList, int anOrganizationSystemId) throws TransformerException,
/ aNode=[mtc:SHIPMENT_ORDER: null]
/ aProductList=[PRODUCT_ITEM id:null(systemId:0)]
/ anOrganizationSystemId=5001
/ dit is NEEC-NL

		List<ShipmentItemVO> myShipmentItems = new ArrayList<ShipmentItemVO>();

		Node shipmentItemsNode = selectSingleNode(aNode, SHIPMENT_ITEMS_TAG);
[mtc:SHIPMENT_ITEMS: null]
/ Klopt, hier is er maar 1 van	,

/ Intermezzo

        <mtc:SHIPMENT_ITEMS>

            <mtccore:SHIPMENT_ITEM>
               <mtccore:SHIPMENT_ITEM_ID>017</mtccore:SHIPMENT_ITEM_ID>
               <mtccore:PACKAGE_CODE/>
               <mtccore:WEIGHT>
                  <mtccore:MEASUREMENT_VALUE>000000000 000000000 000000000 000000000 000000000 000000000 000000000 000000000 000000000 000000000 000000000 000000000 000000000 000000000 000000000 000000000 000000000</mtccore:MEASUREMENT_VALUE>
                  <mtccore:UNIT_OF_MEASUREMENT>KGM KGM KGM KGM KGM KGM KGM KGM KGM KGM KGM KGM KGM KGM KGM KGM KGM</mtccore:UNIT_OF_MEASUREMENT>
               </mtccore:WEIGHT>
               <mtccore:TOTAL_LDM>
                  <mtccore:MEASUREMENT_VALUE>.000 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000 .000</mtccore:MEASUREMENT_VALUE>
                  <mtccore:UNIT_OF_MEASUREMENT>LDM LDM LDM LDM LDM LDM LDM LDM LDM LDM LDM LDM LDM LDM LDM LDM LDM</mtccore:UNIT_OF_MEASUREMENT>
               </mtccore:TOTAL_LDM>
               <mtccore:STACKABLE>false</mtccore:STACKABLE>
               <mtccore:SHIPMENT_ITEM_REFERENCE>
                  <mtccore:VALUE>NEEC</mtccore:VALUE>
                  <mtccore:QUALIFIER>REFERENCE1</mtccore:QUALIFIER>
               </mtccore:SHIPMENT_ITEM_REFERENCE>
            </mtccore:SHIPMENT_ITEM>

            <mtccore:SHIPMENT_ITEM>
				...
            </mtccore:SHIPMENT_ITEM>
			...
            <mtccore:SHIPMENT_ITEM>
				...
           </mtccore:SHIPMENT_ITEM>
         </mtc:SHIPMENT_ITEMS>
      </mtc:SHIPMENT_ORDER>

/ Einde Intermezzo

		Map<String, ProductItemVO> myProductMap = new HashMap<String, ProductItemVO>();
		for (ProductItemVO myProductItem : aProductList) {
			if (StringUtils.isNotBlank(myProductItem.getProductItemId())) {
/ JA
				if (StringUtils.isNotBlank(myProductItem.getParsedShipmentOrderId())) {
/ NEE
				} else {
					myProductMap.put(myProductItem.getProductItemId(), myProductItem);
{001=PRODUCT_ITEM id:null(systemId:0)}

		ShipmentItemProcessor myProcessor = Factory.getFactory().getInstance(ShipmentItemProcessor.class);
		myProcessor.setParent(this);
/ this=ShipmentOrderProcessor	,

		Node myNode = shipmentItemsNode.getFirstChild();
		while (myNode != null) {
					ShipmentItemVO myItemVO = myProcessor.process(myNode, myProductMap, anOrganizationSystemId);
/s
ShipmentItemProcessor.process(Node, Map<String,ProductItemVO>, int) line: 334	

/ Intermezzo

/ myProductList wordt used in cases	,

					} else if (PACKED_ITEMS_TAG.equals(tag)) {
						for (PackedItemVO item : parsePackedItems(childNode, aProducts)) {
							myItemVO.addPackedItem(item);
						}
					} else if (SHIPMENT_ITEMS_TAG.equals(tag)) {
						for (Node myShipmentItemNode : selectNodeIterable(childNode, SHIPMENT_ITEM_TAG)) {
							ShipmentItemVO shipmentItem = process(myShipmentItemNode, aProducts, anOrganizationSystemid);
							myItemVO.addChild(shipmentItem);
						}

/ Maar deze cases hebben we niet	,

/ Einde Intermezzo

			ShipmentItemVO myItemVO = ShipmentItemVOFactory.getShipmentItemVO();

			MeasurementProcessor measurementProcessor = new MeasurementProcessor(this);

			while (childNode != null) {
					String tag = getElementName(childNode);
SHIPMENT_ITEM_ID
PACKAGE_CODE
/ wordt niet processed	, is geen case voor	, see (**)
/ TODO PROCESS SHO
WEIGHT
TOTAL_LDM

					} else if (SHIPMENT_ITEM_ID_TAG.equals(tag)) {
						myItemVO.setShipmentItemId(childNode.getTextContent());
/ ShipmentItemVO.theShipmentItemId
					} else if (WEIGHT_TAG.equals(tag)) {
						myItemVO.setWeightKg(measurementProcessor.process(childNode).getValue());
/s
MeasurementProcessor.process(Node) line: 51	

		MeasurementVO myVO = new MeasurementVO();

		while (childNode != null) {
			String tag = getElementName(childNode);
MEASUREMENT_VALUE


				if (MEASUREMENT_VALUE_TAG.equals(tag)) {
					String value = childNode.getTextContent().trim();
						try {
							myVO.setValue(new BigDecimal(value));
/ value="00000000 ..."
						} catch (NumberFormatException e) {
							LOG.error(MEASUREMENT_VALUE_TAG + " did not contain a number: " + value, e);
						}
					}
				} else if (UNIT_OF_MEASUREMENT_TAG.equals(tag)) {
					myVO.setUnitOfMeasurement(childNode.getTextContent());
				}
	return myVO;
myVO	MeasurementVO  (id=17599)	
	theUnitOfMeasurement	"KGM KGM KGM KGM KGM KGM KGM KGM KGM KGM KGM KGM KGM KGM KGM KGM KGM" (id=17637)	
	theValue	null	

/t
ShipmentItemProcessor.process(Node, Map<String,ProductItemVO>, int) line: 371	
					} else if (WEIGHT_TAG.equals(tag)) {
						myItemVO.setWeightKg(measurementProcessor.process(childNode).getValue());
/ .getValue()==null 
/s
		theDimensions.setWeightKg(aWeightKg);
/s
			this.theWeightKg = theWeightKg;
/d

this	ShipmentItemVO  (id=16762)	
	theDimensions	Dimensions  (id=17679)	
		performanceMonitorService	null	
		systemId	0	
		theHeightM	null	
		theLengthM	null	
		theVolumeM3	null	
		theWeightKg	null	
		theWidthM	null	
	theTotalLdm	null	

					} else if (TOTAL_LDM_TAG.equals(tag)) {
						myItemVO.setTotalLoadingMeters(measurementProcessor.process(childNode).getValue());
/s
MeasurementProcessor.process(Node) line: 51	

	MeasurementVO myVO = new MeasurementVO();

		while (childNode != null) {
				String tag = getElementName(childNode);
MEASUREMENT_VALUE
UNIT_OF_MEASUREMENT
STACKABLE
SHIPMENT_ITEM_REFERENCE
				if (MEASUREMENT_VALUE_TAG.equals(tag)) {
					String value = childNode.getTextContent().trim();
".000 ..."
					if (value == null) {
					} else {
						try {
							myVO.setValue(new BigDecimal(value));
						} catch (NumberFormatException e) {
							LOG.error(MEASUREMENT_VALUE_TAG + " did not contain a number: " + value, e);
						}
					}
				} else if (UNIT_OF_MEASUREMENT_TAG.equals(tag)) {
					myVO.setUnitOfMeasurement(childNode.getTextContent());
"LDM LDM ..."
		return myVO;
/t
ShipmentItemProcessor.process(Node, Map<String,ProductItemVO>, int) line: 378	
						myItemVO.setTotalLoadingMeters(measurementProcessor.process(childNode).getValue());
/ .getValue()==null
/s
ShipmentItemVO.setTotalLoadingMeters(BigDecimal) line: 1123	
		setRequestedTotalLoadingMeters(aLoadingMeterItem);
/s
ShipmentItemVO.setRequestedTotalLoadingMeters(BigDecimal) line: 1059	
		setTotalLdm(aRequestedTotalLoadingMeters);
/s
ShipmentItemVO.setTotalLdm(BigDecimal) line: 1116	
		theTotalLdm = aTotalLdm;
/ apart	, naast theDimensions	,

/t
ShipmentItemProcessor.process(Node, Map<String,ProductItemVO>, int) line: 404	

/ volgende,	
					} else if (MTCCoreNames.STACKABLE.equals(tag)) {
						myItemVO.setStackable(XMLSchemaUtils.parseBoolean(childNode.getTextContent()));
/ sets ShipmentOrderVO.stackable=false
					if (SHIPMENT_ITEM_REFERENCE_TAG.equals(tag)) {
						processReference(childNode, myItemVO);
/s
ShipmentItemProcessor.processReference(Node, ShipmentItemVO) line: 564	

             <mtccore:SHIPMENT_ITEM_REFERENCE>
                  <mtccore:VALUE>NEEC</mtccore:VALUE>
                  <mtccore:QUALIFIER>REFERENCE1</mtccore:QUALIFIER>
               </mtccore:SHIPMENT_ITEM_REFERENCE>
  
		ReferenceVO myReference = new ReferenceProcessor(this).process(aNode);
/s
ReferenceProcessor.process(Node) line: 39	

		ReferenceVO myVO = new ReferenceVO();

		while (childNode != null) {
				String tag = getElementName(childNode);
VALUE
QUALIFIER
				if (VALUE_TAG.equals(tag)) {
					myVO.setValue(StringUtils.filterNullValue(childNode.getTextContent()));
"NEEC"
				} else if (QUALIFIER_TAG.equals(tag)) {
					myVO.setQualifier(StringUtils.filterNullValue(childNode.getTextContent()));
		return myVO;
Reference(qualifier:REFERENCE1, value:NEEC)

/t
ShipmentItemProcessor.processReference(Node, ShipmentItemVO) line: 566	
		ReferenceVO myReference = new ReferenceProcessor(this).process(aNode);
/d
	if (myQualifier != null) {
			myQualifier = myQualifier.trim();
			if (myQualifier.equals(REFERENCE1_QUALIFIER)) {
				aItemVO.setReference1(myReference.getValue());
aItemVO	ShipmentItemVO  (id=16762)	
/ sets ShipmentItemVO.theReference1

/t
ShipmentItemProcessor.process(Node, Map<String,ProductItemVO>, int) line: 344	
					if (SHIPMENT_ITEM_REFERENCE_TAG.equals(tag)) {
						processReference(childNode, myItemVO);
/d
/ GEEN volgende while loop	,

			parsePackageCode(aNode, myItemVO, anOrganizationSystemid);
/s
ShipmentItemProcessor.parsePackageCode(Node, ShipmentItemVO, int) line: 448	
/=
	private void parsePackageCode(Node aNode, ShipmentItemVO myItemVO, int anOrganizationSystemid) throws TransformerException, AbstractException,
aNode	DeferredElementImpl  (id=16591)	
[mtccore:SHIPMENT_ITEM: null]
myItemVO	ShipmentItemVO  (id=16762)	
shipmentItem: 017(systemId:0, labelInfo:null)
anOrganizationSystemid	5001	

/ In XML	, 
               <mtccore:SHIPMENT_ITEM_ID>017</mtccore:SHIPMENT_ITEM_ID>

		String myPackageCode = parseNodeValue(aNode, PACKAGE_CODE_TAG);
""
		if (myUseTranslationKey = ApplicationPropertyManager.getInstance().getModuleProperty("oms", "shippingunits.usetranslationkey", false)) {
/ In 2015.01/mpo/mpo.properties	,
module.oms.shippingunits.usetranslationkey =false

		if (StringUtils.isNotEmpty(myPackageCode)) {
/ NEE

/t
ShipmentItemProcessor.process(Node, Map<String,ProductItemVO>, int) line: 412	
			parsePackageCode(aNode, myItemVO, anOrganizationSystemid);
/d
			return myItemVO;

/t
ShipmentOrderProcessor.parseShipmentItems(Node, List<ProductItemVO>, int) line: 190	
					ShipmentItemVO myItemVO = myProcessor.process(myNode, myProductMap, anOrganizationSystemId);
/d
					myShipmentItems.add(myItemVO);

/ volgende	,
/ we geven Enter, we debug ze NIET	,
		while (myNode != null) {
					ShipmentItemVO myItemVO = myProcessor.process(myNode, myProductMap, anOrganizationSystemId);
					myShipmentItems.add(myItemVO);
/ myShipmentItems=
[shipmentItem: 017(systemId:0, labelInfo:null), shipmentItem: 016(systemId:0, labelInfo:null), shipmentItem: 015(systemId:0, labelInfo:null), shipmentItem: 014(systemId:0, labelInfo:null), shipmentItem: 013(systemId:0, labelInfo:null), shipmentItem: 012(systemId:0, labelInfo:null), shipmentItem: 011(systemId:0, labelInfo:null), shipmentItem: 010(systemId:0, labelInfo:null), shipmentItem: 009(systemId:0, labelInfo:null), shipmentItem: 008(systemId:0, labelInfo:null), shipmentItem: 007(systemId:0, labelInfo:null), shipmentItem: 006(systemId:0, labelInfo:null), shipmentItem: 005(systemId:0, labelInfo:null), shipmentItem: 004(systemId:0, labelInfo:null), shipmentItem: 003(systemId:0, labelInfo:null), shipmentItem: 002(systemId:0, labelInfo:null), shipmentItem: 001(systemId:0, labelInfo:null), shipmentItem: 000(systemId:0, labelInfo:null)]

/t
ShipmentOrderProcessor.process(Node) line: 217	
			List<ShipmentItemVO> myShipmentItems = parseShipmentItems(aNode, myProductList, myShipmentOrderVO.getOrganizationSystemid());
/d

			ArrayList<CustomerOrder> customerOrders = parseCustomerOrders(aNode);
/ Zijn er NIET bij ons	,
			ParsedShipmentOrder myRet = new ParsedShipmentOrder(myShipmentOrderVO, myProductList, myShipmentItems);
/s
	public ParsedShipmentOrder(ShipmentOrderVO aShipmentOrder, Collection<ProductItemVO> aProductItems, Collection<ShipmentItemVO> aShipmentItems) {
		shipmentOrder = aShipmentOrder;
		productItems = new TreeSet<ProductItemVO>(new StringSequencedEntityComparator());
		productItems.addAll(aProductItems);
		shipmentItems = new TreeSet<ShipmentItemVO>(new StringSequencedEntityComparator());
		shipmentItems.addAll(aShipmentItems);
		customerOrders = new ArrayList<CustomerOrder>();
/ 1 product item	, 18 shipment items	,
/t
			myRet.setCustomerOrders(customerOrders);

			return myRet;

/t
MpoShipmentOrderMsgProcessor(AbstractShipmentOrderMsgProcessor).process(Node) line: 256	

					ShipmentOrderProcessor myProcessor = new ShipmentOrderProcessor();
256:			myShipmentOrder = myProcessor.process(myNode);
/d
///////////////////////////////////////
/ Dit was het parse	,
/ Nu hieronder 266: 
 
					} else if (myPurposeCode.isUpdate() || ...){
/ 05 is update	,
						resolveCustomerOrderLines(myShipmentOrder);
/s
	protected void resolveCustomerOrderLines(ParsedShipmentOrder aMyShipmentOrder) {

		if (!ApplicationPropertyManager.getInstance().getModuleProperty("oms", "shipmentorder.resolve.customerorderlines", false)) {
/ JA
			return;
/ want	,
$ vi 2015.01/module/oms/oms.properties
# If true, resolve customer order lines for the product items when a shipment order message is processed
module.oms.shipmentorder.resolve.customerorderlines=false

/t
MpoShipmentOrderMsgProcessor(AbstractShipmentOrderMsgProcessor).process(Node) line: 266	
						resolveCustomerOrderLines(myShipmentOrder);
/d
266:					processUpdate(myShipmentOrder);
///////////////////////////////////////////////////


/s
MpoShipmentOrderMsgProcessor.processUpdate(ParsedShipmentOrder) line: 64	
		boolean myOrderExists =
				getShipmentOrderDao().checkForExistence(aParsedShipmentOrder
						.getShipmentOrder().getShipmentOrderId(), aParsedShipmentOrder.getShipmentOrder().getOrganizationVO());
/s
/ aParsedShipmentOrder.getShipmentOrder().getShipmentOrderId()==ShipmentOrderVO.theShipmentOrderId=""
/ aParsedShipmentOrder.getShipmentOrder().getOrganizationVO()==ShipmentOrderVO.organization=Organization SystemId:5001	Id:NEEC-NL	Description:Nippon Express Euro Cargo-NL
/ Klopt	, in deze XML is er GEEN <mtccore:SHIPMENT_ORDER_ID>3114659501</mtccore:SHIPMENT_ORDER_ID>
/s
ShipmentOrderDaoImpl.checkForExistence(String, Organization) line: 109	
/=
	public boolean checkForExistence(String aShipmentOrderId, Organization anOrganization) {
/ aShipmentOrderId=""
/ anOrganization=Organization SystemId:5001  Id:NEEC-NL  Description:Nippon Express Euro Cargo-NL
		List<ShipmentOrderVO> myOrderList = getHibernateTemplate().findByCriteria(
				DetachedCriteria.forClass(ShipmentOrderVO.class).add(Property.forName("shipmentOrderId").eq(aShipmentOrderId))
						.add(Property.forName("organizationVO").eq(anOrganization)));
		return !myOrderList.isEmpty();
false

/ Intermezzo

/ we zien	,

select ... 
from SHIPMENT_ORDER this_ 
left outer join TMS_USER resource2_ on this_.CREATED_BY_SYSTEMID=resource2_.SYSTEM_ID 
left outer join TMS_USER resource3_ on resource2_.CREATED_BY=resource3_.SYSTEM_ID 
left outer join TMS_USER resource4_ on this_.ASSIGNEE_SYSTEMID=resource4_.SYSTEM_ID 
left outer join TMS_USER resource5_ on this_.APPROVEDBY_SYSTEMID=resource5_.SYSTEM_ID 
left outer join TMS_USER resource6_ on this_.POSTCALC_APPROVEDBY_SYSTEMID=resource6_.SYSTEM_ID 
left outer join REASON_CODE reasoncode7_ on this_.REASON_CODE_SYSTEMID=reasoncode7_.SYSTEM_ID 
left outer join INSTRUCTION_GROUP instructio8_ on this_.INSTRUCTION_GROUP_SYSTEMID=instructio8_.SYSTEM_ID 
where this_.SHIPMENT_ORDER_ID=? and this_.ORGANIZATION_SYSTEMID=?
2015-04-09 08:13:15,574 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (MpoQueueContainer-1:) binding parameter [1] as [VARCHAR] - 
2015-04-09 08:13:15,575 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (MpoQueueContainer-1:) binding parameter [2] as [INTEGER] - 5001

select * 
from SHIPMENT_ORDER this_ 
left outer join TMS_USER resource2_ on this_.CREATED_BY_SYSTEMID=resource2_.SYSTEM_ID 
left outer join TMS_USER resource3_ on resource2_.CREATED_BY=resource3_.SYSTEM_ID 
left outer join TMS_USER resource4_ on this_.ASSIGNEE_SYSTEMID=resource4_.SYSTEM_ID 
left outer join TMS_USER resource5_ on this_.APPROVEDBY_SYSTEMID=resource5_.SYSTEM_ID 
left outer join TMS_USER resource6_ on this_.POSTCALC_APPROVEDBY_SYSTEMID=resource6_.SYSTEM_ID 
left outer join REASON_CODE reasoncode7_ on this_.REASON_CODE_SYSTEMID=reasoncode7_.SYSTEM_ID 
left outer join INSTRUCTION_GROUP instructio8_ on this_.INSTRUCTION_GROUP_SYSTEMID=instructio8_.SYSTEM_ID 
where this_.SHIPMENT_ORDER_ID='' and this_.ORGANIZATION_SYSTEMID=5001
/ 0 rows	,

/ Einde Intermezzo

/t
MpoShipmentOrderMsgProcessor.processUpdate(ParsedShipmentOrder) line: 67	
		boolean myOrderExists =
				getShipmentOrderDao().checkForExistence(aParsedShipmentOrder
						.getShipmentOrder().getShipmentOrderId(), aParsedShipmentOrder.getShipmentOrder().getOrganizationVO());
/d
false
		if (!myOrderExists) {
			processOriginal(aParsedShipmentOrder);
/s
MpoShipmentOrderMsgProcessor.processOriginal(ParsedShipmentOrder) line: 51	

		ShipmentOrderService myOrderService = MpoBeanFactory.getBean(ShipmentOrderService.class);
/ proxy naar com.mpobjects.oms.model.service.ShipmentOrderServiceImpl@44924606
/ TODO SPRING
		if (StringUtils.isEmptyAfterTrim(aParsedShipmentOrder.getShipmentOrder().getShipmentOrderId())) {
/ JA
			String myOrderId = KeyUtil.getKeyService().getShipmentOrderId();
/s
	public static KeyGenService getKeyService() {
		return MpoBeanFactory.getBean(KeyGenService.class);
/ TODO SPRING
/t
/s
KeyGenServiceImpl.getShipmentOrderId() line: 159	
		int shipmentOrderId = generateNewKey(SHIPMENT_ORDER_ID_DISPENSER_NAME);
/ SHIPMENT_ORDER_ID_DISPENSER_NAME=="shipmentorder"
901
		return systematicIdentificationCode(SHIPMENT_ORDER_ID_PREFIX, shipmentOrderId, SHIPMENT_ORDER_ID_WIDTH);
/s
KeyGenServiceImpl.systematicIdentificationCode(String, int, int) line: 189	
/=
	public String systematicIdentificationCode(String prefix, int sequenceNumber, int width) {
/ prefix="SH"
/ sequenceNumber=901
/ width=9
	...
		return prefix + myFormat.format(sequenceNumber);
/t
MpoShipmentOrderMsgProcessor.processOriginal(ParsedShipmentOrder) line: 54	
			String myOrderId = KeyUtil.getKeyService().getShipmentOrderId();
SH000000901
			aParsedShipmentOrder.getShipmentOrder().setShipmentOrderId(myOrderId);

//////////////////////////////////
		myOrderService.createShipmentOrder(aParsedShipmentOrder);
/s
ShipmentOrderServiceImpl.createShipmentOrder(ParsedShipmentOrder) line: 871	
/=
	public ShipmentOrderVO createShipmentOrder(ParsedShipmentOrder aShipmentOrder) {

			ShipmentOrderVO myVO;
			myVO = createShipmentOrder(aShipmentOrder.getShipmentOrder());
/s
		return createShipmentOrder(aShipmentOrder, new TMSEventContext());
/s
ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderVO, TMSEventContext) line: 894	
			Date myNow = timeService.getPresentDate(aShipmentOrder.getOrganization());
Thu Apr 09 08:47:28 CEST 2015
/ TODO
			aShipmentOrder.setSystemEntryDate(myNow);
			aShipmentOrder.setOriginalSystemEntryDate(myNow);
			aShipmentOrder.setLastUpdate(myNow);

			aShipmentOrder.setCreatedBy(AuthenticationUtils.getResource());
Resource:all-admin(systemId:10100)
/ sets aShipmentOrder.theCreatedBy	,
/ TODO
			if (aShipmentOrder.isTemplate()) {
/ NEE
			} else {
				setDatesAndStatus(aShipmentOrder);
/s
ShipmentOrderServiceImpl.setDatesAndStatus(ShipmentOrderVO) line: 2316	
			if (aShipmentOrderVO.getOrderStatusVO() == null || ...){
/ JA
				DateSetVO myDateSet = aShipmentOrderVO.getDateSetVO();
/ Is er al	,
				Collection myServiceActionList = aShipmentOrderVO.getServiceActionList();
/= theServiceActionList
[]
				if (CollectionUtils.isEmpty(myServiceActionList)) {
					myAllEndedOrClosed = false;
					myAllClosed = false;

				if (myFirstPlanned != null) {
/ NEE
				} else {
					myDateSet.setPlannedStartAfter(null);
					myDateSet.setPlannedStartBefore(null);

				if (myLastPlanned != null) {
/ NEE
				} else {
					myDateSet.setPlannedEndAfter(null);
					myDateSet.setPlannedEndBefore(null);

				if (myFirstShipped != null) {
/ NEE
				} else {
					myDateSet.setActualStart(null);

				if (myLast != null && myAllEndedOrClosed) {
/ NEE
				} else {
					myDateSet.setActualEnd(null);

				if (myLast != null && myAllClosed) {
/ NEE
				} else {
					myDateSet.setCloseDate(null);

				// Set the statusses
/ 1450, 9000, ...
				ShipmentOrderValidationService myValidator = Factory.getFactory().getInstance(ShipmentOrderValidationService.class);
/ TODO SPRING
				} else {
					aShipmentOrderVO.setOrderStatusVO(MpoBeanFactory.getBean(OrderStatusDAO.class).getByCode(OrderStatusVO.STATUS_UNPLANNED));
/ TODO SPRING
/ set de status van deze sho als unplanned	,
/ we zien	,
select ... 
from ORDER_STATUS this_ 
where this_.IS_DELETED=? 
and this_.STATUS_CODE=?
parameters: false, 1404, 

/ Intermezzo

/ in 2014.01_mpo	,

$ vi ./module/oms/src/java/oms-service.sb.xml

    <bean id="-com.mpobjects.oms.model.service.ConsignmentServiceImpl" class="com.mpobjects.oms.model.service.ConsignmentServiceImpl">
        <!-- DO NOT USE THIS BEAN. This construction exists only to solve the circular dependency problem with ProxyFactoryBeans -->
        <property name="serviceActionService" ref="com.mpobjects.oms.model.service.ServiceActionService" />
        <property name="serviceOrderService" ref="com.mpobjects.oms.model.service.ServiceOrderService" />
        <property name="consignmentDAO" ref="com.mpobjects.oms.dao.ConsignmentDAO" />
        <property name="eventHandlerService" ref="com.mpobjects.oms.service.event.EventHandlerService" />
        <property name="orderStatusDAO" ref="com.mpobjects.oms.model.orderstatus.dao.OrderStatusDAO" />
    </bean>

    <bean id="com.mpobjects.oms.model.service.ConsignmentService" parent="transactionRequiredTemplate">
        <property name="target" ref="-com.mpobjects.oms.model.service.ConsignmentServiceImpl" />
    </bean>

[eric@localhost workspace]$ vi 2014.01_mpo/module/oms/src/java/com/mpobjects/oms/model/service/ConsignmentServiceImpl.java

   	public void setConsignmentDAO(ConsignmentDAO aConsignmentDAO) {
        consignmentDAO = aConsignmentDAO;
    }
    @Override
    public void swapConsignmentsBySequence(int aConsignmentId, String aDirection) throws ConsignmentException {
        try {
            ConsignmentVO mySwapVO = consignmentDAO.getConsignmentBySequence(aConsignmentId, aDirection);

[eric@localhost workspace]$ vi 2014.01_mpo/module/oms/src/java/com/mpobjects/oms/control/consignment/action/ConsignmentSequenceAction.java

   	@Override
    public synchronized Map act() throws Exception {
        ConsignmentService myService = MpoBeanFactory.getBean(ConsignmentService.class);
        myService.swapConsignmentsBySequence(myConsignmentId, myDirection);

/ Einde Intermezzo

				// Set the customer status after the order status as the CS may depend on the order status
				MpoBeanFactory.getBean(CustomerStatusService.class).updateStatusNoUpdate(aShipmentOrderVO);
/ TODO SPRING
/s
CustomerStatusServiceImpl.updateStatusNoUpdate(ShipmentOrderVO) line: 156	
		updateStatusNoUpdate(aShipmentOrderVO, CustomerStatusEntity.SHIPMENT_ORDER, "shipmentOrder");
/s
CustomerStatusServiceImpl.updateStatusNoUpdate(CustomerStatusSupport, CustomerStatusEntity, String) line: 177	

		List<CustomerStatusVo> myList = getInDescendingHierarchy(aType);
aType	CustomerStatusEntity  (id=14912)	
	name	"SHIPMENT_ORDER" (id=15106)	
	ordinal	1	
/s
CustomerStatusServiceImpl.getInDescendingHierarchy(CustomerStatusEntity) line: 164	

this	CustomerStatusServiceImpl  (id=14902)	
	messageService	$Proxy234  (id=15141)	
com.mpobjects.oms.service.MessageServiceImpl@582a8f42
	theDAO	$Proxy115  (id=15142)	
com.mpobjects.oms.model.customerstatus.dao.CustomerStatusDaoImpl@584a0fef
/s
CustomerStatusDaoImpl.getInDescendingHierarchy(CustomerStatusEntity) line: 46	

/ Intermezzo

/ we zien 
select ... 
from CUSTOMER_STATUS this_ 
where this_.ENTITY=? 
order by this_.HIERARCHY desc
2015-04-09 10:15:11,459 DEBUG [org.hibernate.type.EnumType] (MpoQueueContainer-1:) Binding 'SHIPMENT_ORDER' to parameter: 1

mpo_2015_01=# select*from customer_status where entity='SHIPMENT_ORDER';
 system_id |      name       |                                                                       expression                                                  
                     | hierarchy | next_step_sat_systemid | next_step_status_systemid | visible | days_back_used | next_step_name | poll_status | process_type | 
assignable |     entity     
-----------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------
---------------------+-----------+------------------------+---------------------------+---------+----------------+----------------+-------------+--------------+-
-----------+----------------
       700 | Delivered       | ${shipmentOrder.orderStatusVO.code == 9000}                                                                                       
                     |         7 |                      0 |                         0 |       0 |              1 |                |           0 | OUTBOUND     | 
         0 | SHIPMENT_ORDER
       105 | Planned         | ${shipmentOrder.orderStatusVO.code == 1450}                                                                                       
                     |         2 |                      0 |                         0 |       1 |              0 |                |           0 | OUTBOUND     | 
         0 | SHIPMENT_ORDER
       104 | Open            | ${shipmentOrder.orderStatusVO.code == 1404}                                                                                       
                     |         1 |                      0 |                         0 |       1 |              0 |                |           0 | OUTBOUND     | 
         0 | SHIPMENT_ORDER
       500 | Label printed   | ${shipmentOrder.serviceActionMap['PRINT_LABEL'].orderStatusVO.code == 9000}                                                       
                     |         5 |                      0 |                         0 |       0 |              0 |                |           0 | OUTBOUND     | 
         0 | SHIPMENT_ORDER
       150 | Inbound         | ${shipmentOrder.reference4 == 'Inbound'}                                                                                          
                     |         8 |                      0 |                         0 |       0 |              0 |                |           0 | INBOUND      | 
         0 | SHIPMENT_ORDER
       100 | No status       | true                                                                                                                              
                     |         1 |                      0 |                         0 |       0 |              0 |                |           0 | OUTBOUND     | 
         0 | SHIPMENT_ORDER
       600 | Loaded          | ${shipmentOrder.serviceActionMap['DELIVERY'].orderStatusVO.code == 8000}                                                          
                     |         6 |                      0 |                         0 |       1 |              1 |                |           0 | OUTBOUND     | 
         0 | SHIPMENT_ORDER
       110 | Released to LSP | ${shipmentOrder.orderProcess.code == 'OUTBOUND' && shipmentOrder.serviceActionMap['DELIVERY'].consignmentVO.serviceOrderVO.orderSt
atusVO.code == 1500} |         5 |                      0 |                         0 |       1 |              0 |                |           0 | OUTBOUND     | 
         0 | SHIPMENT_ORDER
(8 rows)

/ Einde Intermezzo

/t
CustomerStatusServiceImpl.updateStatusNoUpdate(CustomerStatusSupport, CustomerStatusEntity, String) line: 179	
/=
	private void updateStatusNoUpdate(CustomerStatusSupport anEntity, CustomerStatusEntity aType, String aVariable) {

anEntity	ShipmentOrderVO  (id=13183)	
aType	CustomerStatusEntity  (id=14912)	
	name	"SHIPMENT_ORDER"
	ordinal	1
aVariable	"shipmentOrder" (id=14913)	

		List<CustomerStatusVo> myList = getInDescendingHierarchy(aType);
/d
[com.mpobjects.oms.model.customerstatus.vo.CustomerStatusVo/id:150, com.mpobjects.oms.model.customerstatus.vo.CustomerStatusVo/id:700, com.mpobjects.oms.model.customerstatus.vo.CustomerStatusVo/id:600, com.mpobjects.oms.model.customerstatus.vo.CustomerStatusVo/id:500, com.mpobjects.oms.model.customerstatus.vo.CustomerStatusVo/id:110, com.mpobjects.oms.model.customerstatus.vo.CustomerStatusVo/id:105, com.mpobjects.oms.model.customerstatus.vo.CustomerStatusVo/id:104, com.mpobjects.oms.model.customerstatus.vo.CustomerStatusVo/id:100]

		if (!myList.isEmpty()) {
			ExpressionEvaluator myEvaluator = new ExpressionEvaluator();
			myEvaluator.setVariable(aVariable, anEntity);
/c
				theVariables.put(aKey, aValue);

			for (CustomerStatusVo myCustomerStatus : myList) {

				// Get the EL expression; if it is matched the shipment order customer status is set
				String myMatchExpression = myCustomerStatus.getExpression();
${shipmentOrder.reference4 == 'Inbound'}

				if (BooleanUtils.isTrue(myEvaluator.evaluate(myMatchExpression).toString())) {
/ NEE
/ want  anEntity.reference4==""
/ anEntity==ShipmentOrderVO

/ volgende	,
			for (CustomerStatusVo myCustomerStatus : myList) {
				String myMatchExpression = myCustomerStatus.getExpression();
${shipmentOrder.orderStatusVO.code == 1404}
				if (BooleanUtils.isTrue(myEvaluator.evaluate(myMatchExpression).toString())) {
/ JA
					myStatusFound = true;
					if (anEntity.getCustomerStatus() == null || ...) {
						anEntity.setCustomerStatus(myCustomerStatus);
myCustomerStatus	CustomerStatusVo  (id=15123)	
	assignable	false	
	daysBackUsed	false	
	entity	CustomerStatusEntity  (id=14912)	
	expression	"${shipmentOrder.orderStatusVO.code == 1404}" (id=15261)	
	hierarchy	1	
	messageList	PersistentSet  (id=15276)	
	name	"Open" (id=15278)	
	nextStepSatSystemid	0	
	nextStepStatusSystemid	0	
	performanceMonitorService	null	
	pollStatus	false	
	systemId	104	
	theNextStepName	null	
	theNextStepSatLoaded	false	
	theNextStepSatVO	null	
	theNextStepStatusLoaded	false	
	theNextStepStatusVO	null	
	theProcessType	"OUTBOUND" (id=15290)	
	visible	true	

/t
ShipmentOrderServiceImpl.setDatesAndStatus(ShipmentOrderVO) line: 2443	
				// Set the customer status after the order status as the CS may depend on the order status
				MpoBeanFactory.getBean(CustomerStatusService.class).updateStatusNoUpdate(aShipmentOrderVO);
/ TODO PETER/PAUL
/t
ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderVO, TMSEventContext) line: 915	
			} else {
				setDatesAndStatus(aShipmentOrder);
/d
				applySyncFlags(aShipmentOrder);
/s
ShipmentOrderServiceImpl.applySyncFlags(ShipmentOrderVO) line: 2044	
		String myFromPartyCode = aShipmentOrder.getFromPartyVO().getCode();
NEG913FEI
		String myToPartyCode = aShipmentOrder.getToPartyVO().getCode();
N/A
		String myBillToPartyCode = "";
		String myEmployeeResponsiblePartyCode = "";

		if (aShipmentOrder.getBillToPartyVO() != null) {
			myBillToPartyCode = aShipmentOrder.getBillToPartyVO().getCode();
N/A

		if (PartySyncFlag.PARTY_ID_CODE.equals(aShipmentOrder.getSyncFromFlag()) && StringUtils.isNotEmpty(myFromPartyCode)) {
/ TODO PETER/PAUL
/ NEE
PartySyncFlag.PARTY_ID_CODE=="P"
aShipmentOrder.getSyncFromFlag()=="D"

		if (PartySyncFlag.PARTY_ID_CODE.equals(aShipmentOrder.getSyncToFlag()) && StringUtils.isNotEmpty(myToPartyCode)) {
/ NEE

		if (PartySyncFlag.PARTY_ID_CODE.equals(aShipmentOrder.getSyncBillToFlag()) && StringUtils.isNotEmpty(myBillToPartyCode)) {
/ NEE

		if (PartySyncFlag.PARTY_ID_CODE.equals(aShipmentOrder.getSyncEmployeeResponsibleFlag()) && StringUtils.isNotEmpty(myEmployeeResponsiblePartyCode)) {
/ NEE

		for (ShipmentOrderParty party : aShipmentOrder.getShipmentOrderParties()) {
/ NEE
/ = theShipmentOrderPartyList	, []

/t
ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderVO, TMSEventContext) line: 916	
				applySyncFlags(aShipmentOrder);
/d
				handleTimeWindow(aShipmentOrder);
/s
ShipmentOrderServiceImpl.handleTimeWindow(ShipmentOrderVO) line: 2117	
		DateSetVO myShipmentOrderDateSet = aShipmentOrderVO.getDateSetVO();
RSAFTER: Wed Mar 11 14:00:00 CET 2015, RSBEFORE: Wed Mar 11 14:00:00 CET 2015, REAFTER: Wed Mar 11 00:00:00 CET 2015, REBEFORE: Wed Mar 11 00:00:00 CET 2015, PSAFTER: null, PSBEFORE: null, PEAFTER: null, PEBEFORE: null, AS: null, AE: null, RELEASE:null, PRELEASE:null, CLOSE:null

		// need to set time window?
		if (myRequestedEndBefore == null || myRequestedEndAfter == null) {
/ NEE

/t
ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderVO, TMSEventContext) line: 918	
				handleTimeWindow(aShipmentOrder);
/d
				myVO = shipmentOrderDao.save(aShipmentOrder);
/ nu is nog aShipmentOrder.systemId==0
/s
ShipmentOrderDaoImpl(GenericHibernateDAO).save(Type) line: 470	
		if (anEntity.getSystemId() == 0) {
			getHibernateTemplate().persist(anEntity);

/ Intermezzo

/ Na getHibernateTemplate().persist(anEntity) heeft anEntity=ShipmentOrderVO inst een systemId	, 
/ Dit is omdat	,
$ vi ShipmentOrder.standard.hbm.xml

	<class name="com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO" table="SHIPMENT_ORDER">
		<cache usage="read-write" />
		<id name="systemId" type="int">
			<column name="SYSTEM_ID" />
			<generator class="com.mpobjects.core.model.HibernateIdGenerator" />
		</id> 

$ vi HibernateIdGenerator.java

	public Serializable generate(SessionImplementor session, Object object) throws HibernateException {
		return new Integer(DbUtil.getNextId());
	}
/ TODO

/ Einde Intermezzo

/t
ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderVO, TMSEventContext) line: 918	
				myVO = shipmentOrderDao.save(aShipmentOrder);
/d
				MpoBeanFactory.getBean(EntityDetailService.class).initialize(myVO);
/ TODO SPRING
/ Doet NIETS bij ons	,
/s
EntityDetailServiceImpl.initialize(EntityDetailSupport) line: 131	
/=
	public void initialize(EntityDetailSupport anEntityDetailSupport) {
anEntityDetailSupport	ShipmentOrderVO  (id=13183)	

		List<EntityDetailType> myList = getDAO().getByEntity(anEntityDetailSupport.getEntity());
/ getDAO()=com.mpobjects.oms.dao.entitydetailtype.EntityDetailTypeDAOImpl@445adb1a
/ anEntityDetailSupport.getEntity()=EntityType.SHIPMENT_ORDER
/s
	private EntityDetailTypeDAO getDAO() {
		return MpoBeanFactory.getBean(EntityDetailTypeDAO.class);
/ TODO SPRING
/t
/s
ShipmentOrderVO.getEntity() line: 806	
		return EntityType.SHIPMENT_ORDER;
/ EntityType
	name: "SHIPMENT_ORDER"
	ordinal: 13
/t
/s
EntityDetailTypeDAOImpl.getByEntity(EntityType) line: 35	
		List<EntityDetailType> myTypeList = getHibernateTemplate().findByCriteria(
				DetachedCriteria.forClass(EntityDetailType.class).add(Property.forName("entity").eq(anEntity)).add(Property.forName("deleted").eq(false)));

/ Intermezzo

$ vi EntityDetailType.standard.hbm.xml

	<class name="com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailType" table="ENTITY_DETAIL_TYPE" >
		<property name="deleted" column="IS_DELETED" />
		<property name="code" column="NAME" />
		<property name="entity" column="ENTITY" not-null="true">
			<type name="org.hibernate.type.EnumType">
				<param name="enumClass">com.mpobjects.oms.model.entity.entitydetailtype.EntityType</param>
				<param name="type">12</param>
			</type>
		</property>
/ TODO HIBERNATE

/ we zien	,

select ... 
from ENTITY_DETAIL_TYPE this_ 
where this_.ENTITY=? 
and this_.IS_DELETED=?
2015-04-09 11:56:37,728 DEBUG [org.hibernate.type.EnumType] (MpoQueueContainer-1:) Binding 'SHIPMENT_ORDER' to parameter: 1
2015-04-09 11:56:37,729 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (MpoQueueContainer-1:) binding parameter [2] as [BIT] - false

mpo_2015_01=#  select*from entity_detail_type where entity='SHIPMENT_ORDER' and is_deleted=false;
 system_id | is_deleted |             name             | value_type |     entity     | organization_systemid | read_only | config | rank | required |            
    visibility                 | allowed_values | group_systemid 
-----------+------------+------------------------------+------------+----------------+-----------------------+-----------+--------+------+----------+------------
-------------------------------+----------------+----------------
  26747546 |          0 | TempControl                  | BOOLEAN    | SHIPMENT_ORDER |                  5001 | FALSE     | 1      |   10 |        0 | true       
                               |                |       26747545
  26680416 |          0 | Empty staging required       | BOOLEAN    | SHIPMENT_ORDER |                    11 | FALSE     | 30     |   30 |        0 |            
                               |                |               
  26680417 |          0 | Empty repositioning required | BOOLEAN    | SHIPMENT_ORDER |                    11 | FALSE     | 40     |   40 |        0 |            
                               |                |               
  26680795 |          0 | IMCO                         | REMARKS    | SHIPMENT_ORDER |                    11 | FALSE     | 5      |    5 |        0 |            
                               |                |               
  26680415 |          0 | Full repositioning required  | BOOLEAN    | SHIPMENT_ORDER |                    11 | FALSE     | 20     |   20 |        0 | entity.ship
mentTypeVO.code == 'LTL'       |                |               
  26679611 |          0 | Full staging required        | BOOLEAN    | SHIPMENT_ORDER |                    11 | FALSE     | 500    |   10 |        0 | entity.ship
mentTypeVO.code == 'FTL'       |                |               
  26680794 |          0 | Un Number                    | REMARKS    | SHIPMENT_ORDER |                    11 | FALSE     | 1      |    2 |        0 |            
                               |                |               
  26708749 |          0 | Distance                     | STRING     | SHIPMENT_ORDER |                    11 | FALSE     | 10     |    1 |        0 |            
                               |                |               
  26718467 |          0 | Empty Depot                  | STRING     | SHIPMENT_ORDER |                    11 | FALSE     | 10     |    1 |        0 |            
                               |                |               
  26715545 |          0 | TravelDistance               | STRING     | SHIPMENT_ORDER |                    11 | FALSE     | 10     |    2 |        0 | entity.orga
nizationVO.code == 'ICSZA DBN' |                |               
  26722539 |          0 | ToDistance                   | STRING     | SHIPMENT_ORDER |                    11 | FALSE     | 10     |    3 |        0 |            
                               |                |               
  26738219 |          0 | Documentation                | BOOLEAN    | SHIPMENT_ORDER |                    11 | EDIT      | 1      |  400 |        0 | true       
                               |                |               
  26738221 |          0 | DeliveryAppointment          | BOOLEAN    | SHIPMENT_ORDER |                    11 | EDIT      | 1      |  420 |        0 | true       
                               |                |               
  26740568 |          0 | Labelling                    | BOOLEAN    | SHIPMENT_ORDER |                    11 | EDIT      | 1      |  430 |        0 | true       
                               |                |               
  26741094 |          0 | Loading                      | BOOLEAN    | SHIPMENT_ORDER |                    11 | EDIT      | 1      |  440 |        0 | true       
                               |                |               
  26741095 |          0 | Offloading                   | BOOLEAN    | SHIPMENT_ORDER |                    11 | EDIT      | 1      |  450 |        0 | true       
                               |                |               
  26742423 |          0 | TerminalAppointment          | BOOLEAN    | SHIPMENT_ORDER |                    11 | EDIT      | 1      |  470 |        0 | true       
                               |                |               
  26742424 |          0 | EmptyReturn                  | BOOLEAN    | SHIPMENT_ORDER |                    11 | EDIT      | 1      |  480 |        0 | true       
                               |                |               
  26743966 |          0 | EmptyCollect                 | BOOLEAN    | SHIPMENT_ORDER |                    11 | EDIT      | 1      |  490 |        0 | true       
                               |                |               
  26738220 |          0 | CollectionAppointment        | BOOLEAN    | SHIPMENT_ORDER |                    11 | EDIT      | 1      |  410 |        0 | true       
                               |                |               
  26742422 |          0 | CTODocumentation             | BOOLEAN    | SHIPMENT_ORDER |                    11 | EDIT      | 1      |  460 |        0 | true       
                               |                |               
  26747667 |          0 | MaxTemp                      | STRING     | SHIPMENT_ORDER |                  5001 | FALSE     | 10     |   30 |        0 | true       
                               |                |       26747545
  26747666 |          0 | MinTemp                      | STRING     | SHIPMENT_ORDER |                  5001 | FALSE     | 10     |   20 |        0 | true       
                               |                |       26747545
(23 rows)


/ Einde Intermezzo

/t
EntityDetailServiceImpl.initialize(EntityDetailSupport) line: 132	
		List<EntityDetailType> myList = getDAO().getByEntity(anEntityDetailSupport.getEntity());
/d
[SystemId:26684151	IsDeleted:false	Detail Type:Checked	ValueType:BOOLEAN	, 
SystemId:26684152	IsDeleted:false	Detail Type:Goedgekeurd	ValueType:BOOLEAN	, 
SystemId:26772526	IsDeleted:false	Detail Type:BarcodeHold	ValueType:BOOLEAN	, 
SystemId:26772528	IsDeleted:false	Detail Type:DuplicateHold	ValueType:BOOLEAN	, 
SystemId:26684153	IsDeleted:false	Detail Type:ProductKenmerkSoort	ValueType:LIST	, 
SystemId:26774119	IsDeleted:false	Detail Type:DefaultWeight	ValueType:NUMBER	, 
SystemId:26780756	IsDeleted:false	Detail Type:KlantSpecifiek	ValueType:REMARKS	, 
SystemId:26684154	IsDeleted:false	Detail Type:OptieSoort	ValueType:LIST	, 
SystemId:26780826	IsDeleted:false	Detail Type:ShipmentReferentieNo	ValueType:REMARKS	, 
SystemId:26827907	IsDeleted:false	Detail Type:ManualPricing	ValueType:BOOLEAN	, 
SystemId:26772527	IsDeleted:false	Detail Type:ColloHoldChecked	ValueType:BOOLEAN	, 
SystemId:26777671	IsDeleted:false	Detail Type:ShipToOpmerkingen	ValueType:REMARKS	, 
SystemId:26684149	IsDeleted:false	Detail Type:OntvangenBedragCash	ValueType:AMOUNT	, 
SystemId:26774375	IsDeleted:false	Detail Type:TotaalADRPuntenAantal	ValueType:STRING	, 
SystemId:26684150	IsDeleted:false	Detail Type:OntvangenBedragPin	ValueType:AMOUNT	, 
SystemId:26734011	IsDeleted:false	Detail Type:EilandToeslag	ValueType:BOOLEAN	, 
SystemId:26780816	IsDeleted:false	Detail Type:Klantreferentie	ValueType:REMARKS	, 
SystemId:26786350	IsDeleted:false	Detail Type:LabelNodig	ValueType:BOOLEAN	, 
SystemId:26822867	IsDeleted:false	Detail Type:CashOnDeliveryRemarks	ValueType:REMARKS	, 
SystemId:26777672	IsDeleted:false	Detail Type:ShipFromOpmerkingen	ValueType:REMARKS	, 
SystemId:26820283	IsDeleted:false	Detail Type:TijdsVenster	ValueType:LIST	]

		if (anEntityDetailSupport.getEntityDetails() != null) {
/ anEntityDetailSupport=ShipmentOrderVO	,
/= ShipmentOrderVO.entityDetails
/ JA
/ Dezelfde list , van 21	,
			myList.removeAll(anEntityDetailSupport.getEntityDetails().keySet());
{}
/ TODO 
/ Is een PersistentSet	,

		for (EntityDetailType myEntityDetailType : myList) {
/ NEE, is {}

/t
ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderVO, TMSEventContext) line: 925	
				MpoBeanFactory.getBean(EntityDetailService.class).initialize(myVO);
/d
/ Deed NIETS	,
				getTriggerHandler().handleCreate(myVO);
/s
ShipmentOrderServiceImpl.getTriggerHandler() line: 2267	
		if (triggerHandler == null) {
			triggerHandler = MpoBeanFactory.getBean(ShipmentOrderTriggerHandler.class);
com.mpobjects.oms.service.trigger.ShipmentOrderTriggerHandlerImpl@1d4c41fa
/ TODO SPRING
/t
/s
ShipmentOrderTriggerHandlerImpl.handleCreate(ShipmentOrderVO) line: 34	

		Collection<ShipmentOrderTrigger> myList = MpoBeanFactory.getBean(ShipmentOrderTriggerDAO.class).getAll();
/s
ShipmentOrderTriggerDAOImpl(GenericHibernateDAO).getAll() line: 244	
		return getAll(false);
/s
ShipmentOrderTriggerDAOImpl(GenericHibernateDAO).getAll(boolean) line: 249	
/=
	public List<Type> getAll(boolean aShowDeleted) {
aShowDeleted==false
		if (aShowDeleted || !isDeletable()) {
/ JA
isDeletable()==false
			return (List<Type>) getHibernateTemplate().loadAll(type);
this
	type	Class (com.mpobjects.oms.model.trigger.ShipmentOrderTrigger) (id=4013)	

/t
ShipmentOrderTriggerHandlerImpl.handleCreate(ShipmentOrderVO) line: 35	
		Collection<ShipmentOrderTrigger> myList = MpoBeanFactory.getBean(ShipmentOrderTriggerDAO.class).getAll();
/d
[com.mpobjects.oms.model.trigger.ShipmentOrderTrigger/id:26734700]

/ Intermezzo

mpo_2015_01=# select*from shipment_order_trigger;
 system_id |    name     | on_create | on_plan | on_start | on_end | on_planned_start_change | on_planned_end_change | filter_expression | organization_systemid 
-----------+-------------+-----------+---------+----------+--------+-------------------------+-----------------------+-------------------+-----------------------
  26734700 | ACKNOWLEDGE |         1 |       0 |        0 |      0 |                       0 |                     0 |                   |                  4000
(1 row)


/ Einde Intermezzo

		for (ShipmentOrderTrigger myTrigger : myList) {
			if (myTrigger.getOnCreate()) {
/ JA
				if (checkTrigger(myTrigger, aShipmentOrderVO)) {
/s
ShipmentOrderTriggerHandlerImpl.checkTrigger(ShipmentOrderTrigger, ShipmentOrderVO) line: 78	

		Rule myRule = aTrigger.getFilterExpressionRule();
/s
ShipmentOrderTrigger(AbstractTrigger).getFilterExpressionRule() line: 76	
		if (filterExpressionRule == null && filterExpression != null) {
/ NEE	,
/ want filterExpression==null
/ filterExpressionRule==null
		return filterExpressionRule;

/ Intermezzo

/ 7	.

customer status/ order status
/ order status=1404
/ customer status wordt berekend ahv bijv reference3	, deze status kan zijn 'packed'	, 

/ 7	. 

party sync flags
/ Op de GUI in een party , bijv de shipto party, zien we rechtsboven 'Copy from '	,
/ deze kan "D" zijn = disabled, of "P" = party id	, 
/ als "P", dan wordt bij save wat er in de GUI staat , copied in de sho row in de db	,

/ 7	. 

tmscontext	, 
/ hierin kun je set dat er geen rate calc moet gebeuren als je de seo save	, normaal gebeurt er wel een rate calc	,

/ Einde Intermezzo

/t
ShipmentOrderTriggerHandlerImpl.checkTrigger(ShipmentOrderTrigger, ShipmentOrderVO) line: 80	
		Rule myRule = aTrigger.getFilterExpressionRule();

		if (myRule == null) {
			return true;

/t
ShipmentOrderTriggerHandlerImpl.handleCreate(ShipmentOrderVO) line: 38	
			if (myTrigger.getOnCreate()) {
				if (checkTrigger(myTrigger, aShipmentOrderVO)) {
/ JA
					TriggerExecutionRequest<ShipmentOrderTrigger> myRequest = new TriggerExecutionRequest<ShipmentOrderTrigger>(myTrigger);
					myRequest.addObject(TriggerConstants.SHIPMENT_ORDER_SYSTEM_ID, aShipmentOrderVO.getSystemId());
/ TriggerConstants.SHIPMENT_ORDER_SYSTEM_ID="shipmentOrderSystemId"
/ aShipmentOrderVO.getSystemId()=26751534
/ TODO HIBERNATE (in db is GEEN row met deze system_id, wanneer is deze set?)
/s
						objectMap.put(aName, anObject);

myRequest	TriggerExecutionRequest  (id=16367)	
	objectMap	HashMap  (id=16369)	
{shipmentOrderSystemId=26751534}
	resource	null	
	triggerSystemId	26734700	
	type	"com.mpobjects.oms.model.trigger.ShipmentOrderTrigger" (id=16371)	

					getExecutionService().processRequest(myRequest);
/s
TriggerActionExecutionServiceImpl.processRequest(TriggerExecutionRequest<?>) line: 102	

			myTransaction = transactionManager.getTransactionManager().getTransaction();
TransactionImpl:XidImpl[FormatId=257, GlobalId=localhost.localdomain/6489, BranchQual=, localId=6489]

				final TriggerExecutionRequest<?> myRequest = aRequest;
				myTransaction.enlistResource(new XAResource() {
					...
		} catch (Exception anException) {
			LOG.error("Exception when processing request [" + aRequest + "]", anException);

/s
ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderVO, TMSEventContext) line: 926	
				getTriggerHandler().handleCreate(myVO);
/d
				triggerEventHandler(null, myVO, new TMSEventContext());
/s
ShipmentOrderServiceImpl.triggerEventHandler(ShipmentOrderVO, ShipmentOrderVO, TMSEventContext) line: 2469	
/=
	private void triggerEventHandler(ShipmentOrderVO anOldVO, ShipmentOrderVO aNewVO, TMSEventContext anEventContext) throws AbstractException {

		if (anOldVO == null) {
/ JA
			myEvent = new ShipmentOrderEvent(anOldVO, aNewVO, ShipmentOrderEvent.CREATED, anEventContext);

		eventHandlerService.handleEvent(myEvent);
/s
EventHandlerServiceImpl.handleEvent(Event) line: 52	
/=
	public void handleEvent(Event anEvent) throws ChangeManagementException {

		String myEventType = anEvent.getEventType();
shipmentorder.created

			String myLevelPrefix = com.mpobjects.common.util.StringUtils.repeat("...", myLevel);
""
/ myLevel=0
			Date myStartDate = new Date();
			boolean info = LOG.isInfoEnabled();
true
			if (info) {
				if (... || anEvent.getNewVO() != null && LogisticsOrderVO.class.isAssignableFrom(anEvent.getNewVO().getClass())) {
/ JA
/ anEvent.getNewVO()==onze ShipmentOrderVO inst	,

			listenerList.fireEvent(anEvent);
/s
ListenerList.fireEvent(Event<?>) line: 80	

this	ListenerList  (id=17985)	
	theListenerList	ArrayList  (id=18028)	
		elementData	Object[22]  (id=18033)	
			[0]	DocumentEventListener  (id=18035)	
			[1]	CustomerOrderEventListener  (id=18036)	
			[2]	ShoCostAllocationEventListener  (id=18037)	
			[3]	TMSCarConServiceOrderEventListener  (id=18039)	
			[4]	SupplierInvoiceUpdateEventListener  (id=18040)	
			[5]	StockTransactionEventListener  (id=18042)	
			[6]	ShipmentOrderConsolidationEventListener  (id=18044)	
			[7]	$Proxy384  (id=18046)	
com.mpobjects.event.service.DeferredEventServiceImpl@7238f26d
			[8]	EventEventListener  (id=18048)	
			[9]	AllocationEventListener  (id=18050)	
			[10]	CustomerInvoiceUpdateEventListener  (id=18052)	
			[11]	CapableToPromiseEventListener  (id=18054)	
			[12]	MpoEventListener  (id=18056)	
			[13]	AutomaticMailEventListener  (id=18058)	
			[14]	EmailReportEventListener  (id=18060)	
			[15]	InvoiceServiceOrderEventHandler  (id=18062)	
			[16]	RateCalcEventListener  (id=18064)	


/ Intermezzo

public class ShipmentOrderEvent extends Event<ShipmentOrderVO> {

	public static final String CREATED = "shipmentorder.created";
	public static final String DELETED = "shipmentorder.deleted";
	public static final String PRICE_UPDATED = "shipmentorder.price_updated";
	public static final String STATUS_UPDATED = "shipmentorder.status_updated";
	public static final String DATES_UPDATED = "shipmentorder.dates_updated";
	public static final String UPDATED = "shipmentorder.updated";

public class ServiceActionEvent extends Event<ServiceActionVO> {

	public static final String CREATED = "serviceaction.created";
	public static final String DELETED = "serviceaction.deleted";
	public static final String UPDATED = "serviceaction.updated";

public class LogisticsOrderEventEvent extends Event<LogisticsOrderEventVO> {

	public static enum SpecificPurposeCode {
		DOCUMENT_EVENT, RESOURCE_EVENT, SUPPLIER_INVOICE_EVENT, CUSTOMER_INVOICE_EVENT
	}

/ we kunnen SpecificPurposeCode.SUPPLIER_INVOICE_EVENT.name()

public class ProductItemEvent extends Event<ProductItemVO> {

	public static final String CREATED = "productitem.created";
	public static final String DELETED = "productitem.deleted";
	public static final String UPDATED = "productitem.updated";

/ Einde Intermezzo

/ anEvent.getEventType()="shipmentorder.created"
/ Nu	,

		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);
/s
DocumentEventListener.handleEvent(Event) line: 48	
		if (anEvent.getEventType().equals(LogisticsOrderEventEvent.SpecificPurposeCode.DOCUMENT_EVENT.name())) {
/ NEE
/ anEvent.getEventType()="shipmentorder.created"

/t
/s
CustomerOrderEventListener.handleEvent(Event) line: 28	
		if (anEvent.getEventType().equals(ShipmentOrderEvent.STATUS_UPDATED)) {
/ NEE


/t
/s
ShoCostAllocationEventListener.handleEvent(Event) line: 27	
		if (myType.equals(ShipmentOrderEvent.UPDATED)) {
/ NEE
		} else if (myType.equals(ServiceActionEvent.UPDATED)) {
/ NEE

/t
/s
TMSCarConServiceOrderEventListener.handleEvent(Event) line: 70	
		if (myEventType.equals(ServiceOrderEvent.UPDATED)) {
/ NEE

/t
/s
SupplierInvoiceUpdateEventListener.handleEvent(Event) line: 38	
		if (anEvent.getEventType().equals(LogisticsOrderEventEvent.SpecificPurposeCode.SUPPLIER_INVOICE_EVENT.name())) {
/ NEE

/t
/s
StockTransactionEventListener.handleEvent(Event<?>) line: 31	
		if (anEvent.getEventType().equals(ShipmentOrderEvent.UPDATED) || anEvent.getEventType().equals(ShipmentOrderEvent.DATES_UPDATED)) {
/ NEE
		} else if (anEvent.getEventType().equals(ProductItemEvent.CREATED)) {
/ NEE
		} else if (anEvent.getEventType().equals(ProductItemEvent.UPDATED)) {
/ NEE
		} else if (anEvent.getEventType().equals(ProductItemEvent.DELETED)) {
/ NEE

/ t
/s
ShipmentOrderConsolidationEventListener.handleEvent(Event<?>) line: 33	
		if (anEvent.getEventType().equals(ShipmentOrderEvent.UPDATED) || anEvent.getEventType().equals(ShipmentOrderEvent.DATES_UPDATED)
				|| anEvent.getEventType().equals(ShipmentOrderEvent.CREATED)) {
/ JA
			transactionHelper.executeAfterCommit(new Runnable() {
				@Override
				public void run() {
->					shipmentOrderConsolidationUpdateProducer.produce(((ShipmentOrderVO) anEvent.getNewVO()).getSystemId());
				}
/ TODO (transactionHelper)

/t
/s

/ Intermezzo

/ we hebben NIP-45 cloned naar SCS-4759	,
/ Kies in ticket NIP-45  More, clone
/ Kies in nieuwe ticket Move	, en kies rechtsboven bij New Project : MPO Objects - MPO Supply Chain	,

/ Einde Intermezzo

/ Einde NIP-45 SCS-4759

/ NIP-45 SCS-4759

/ 7	. 

/ Ander bericht	, 

   <mtc:body>
      <mtc:SHIPMENT_ORDER>
            <mtccore:SHIPMENT_ORDER_ID>3114659501</mtccore:SHIPMENT_ORDER_ID>
/ de klant geeft deze	, 
/ OK
/ Anders gens SCS deze zoals SH00000000019

MpoShipmentOrderMsgProcessor(AbstractShipmentOrderMsgProcessor).process(Node) line: 266	
					ShipmentOrderProcessor myProcessor = new ShipmentOrderProcessor();
256:				myShipmentOrder = myProcessor.process(myNode);
/d
					} else if (myPurposeCode.isUpdate() || updateCode != null && updateCode.matcher(myPurposeCode.getPurposeCode()).matches()) {
266:						processUpdate(myShipmentOrder);
/s
MpoShipmentOrderMsgProcessor(AbstractShipmentOrderMsgProcessor).process(Node) line: 266	
		boolean myOrderExists =
				getShipmentOrderDao().checkForExistence(aParsedShipmentOrder
						.getShipmentOrder().getShipmentOrderId(), aParsedShipmentOrder.getShipmentOrder().getOrganizationVO());
true

/ Nieuw bericht (is Ander berict, aangepast : niet bestaande shipmentOrderId)	, 

/ Om processUpdate te vergl met ons bericht dat fout ging, veranderen of remove we de shipment order id	, 

[eric@localhost My]$ pwd
/home/eric/Devel/Interfaces/2015.01_mpo/My
[eric@localhost My]$ vi O91T55707.CMP.xml 
            <mtccore:SHIPMENT_ORDER_ID>1234567890</mtccore:SHIPMENT_ORDER_ID>

/s
MpoShipmentOrderMsgProcessor(AbstractShipmentOrderMsgProcessor).process(Node) line: 266	
					ShipmentOrderProcessor myProcessor = new ShipmentOrderProcessor();
256:				myShipmentOrder = myProcessor.process(myNode);
/d
					} else if (myPurposeCode.isUpdate() || updateCode != null && updateCode.matcher(myPurposeCode.getPurposeCode()).matches()) {
266:						processUpdate(myShipmentOrder);
/s
MpoShipmentOrderMsgProcessor(AbstractShipmentOrderMsgProcessor).process(Node) line: 266	
		boolean myOrderExists =
				getShipmentOrderDao().checkForExistence(aParsedShipmentOrder
						.getShipmentOrder().getShipmentOrderId(), aParsedShipmentOrder.getShipmentOrder().getOrganizationVO());
false
		if (!myOrderExists) {
			processOriginal(aParsedShipmentOrder);
/s
MpoShipmentOrderMsgProcessor.processOriginal(ParsedShipmentOrder) line: 51	
		ShipmentOrderService myOrderService = MpoBeanFactory.getBean(ShipmentOrderService.class);
/ TODO SPRING
		if (StringUtils.isEmptyAfterTrim(aParsedShipmentOrder.getShipmentOrder().getShipmentOrderId())) {
/ NEE
/ GEEN gen SH00000019	,
		myOrderService.createShipmentOrder(aParsedShipmentOrder);
...
/s
ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderVO, TMSEventContext) line: 894	
				...
				shipmentOrderDao.setEventContext((TMSEventContext) anEventContext.clone());
				myVO = shipmentOrderDao.save(aShipmentOrder);
/ myVO heeft een theBillToParty, een VirtualParty met systemId=0	, maar dat is OK	,

				MpoBeanFactory.getBean(EntityDetailService.class).initialize(myVO);
/s
EntityDetailServiceImpl.initialize(EntityDetailSupport) line: 131	
		List<EntityDetailType> myList = getDAO().getByEntity(anEntityDetailSupport.getEntity());
/s
EntityDetailTypeDAOImpl.getByEntity(EntityType) line: 35	

/ Intermezzo

/ Nu gaat het OK	, 

/ Maar als in de sho een preferedparty met systemId=0	, dan 	,

2015-04-03 12:21:53,186 ERROR [com.mpobjects.oms.model.service.ShipmentOrderServiceImpl] (MpoQueueContainer-2:) Could not create shipmentorder:object references an unsaved transient instance - save the transient instance before flushing: com.mpobjects.oms.model.party.vo.PartyVO; nested exception is org.hibernate.TransientObjectException: object references an unsaved transient instance - save the transient instance before flushing: com.mpobjects.oms.model.party.vo.PartyVO
org.springframework.dao.InvalidDataAccessApiUsageException: object references an unsaved transient instance - save the transient instance before flushing: com.mpobjects.oms.model.party.vo.PartyVO; nested exception is org.hibernate.TransientObjectException: object references an unsaved transient instance - save the transient instance before flushing: com.mpobjects.oms.model.party.vo.PartyVO
    at org.springframework.orm.hibernate3.SessionFactoryUtils.convertHibernateAccessException(SessionFactoryUtils.java:673)
    at org.springframework.orm.hibernate3.HibernateAccessor.convertHibernateAccessException(HibernateAccessor.java:412)
    at org.springframework.orm.hibernate3.HibernateTemplate.doExecute(HibernateTemplate.java:412)
    at org.springframework.orm.hibernate3.HibernateTemplate.executeWithNativeSession(HibernateTemplate.java:375)
    at org.springframework.orm.hibernate3.HibernateTemplate.findByCriteria(HibernateTemplate.java:1047)
    at org.springframework.orm.hibernate3.HibernateTemplate.findByCriteria(HibernateTemplate.java:1040)
    at com.mpobjects.oms.dao.entitydetailtype.EntityDetailTypeDAOImpl.getByEntity(EntityDetailTypeDAOImpl.java:35)


/ WH wordt Session.flush , of in ieder geval de ShipmentOrderVO	inst, dan worden er de queries gen, 
/ behalve als het niet kan : als er een transient field is	, deze ERR wordt dus gen tijdens de flush , NIET tijdens de commit	,
/ Later wordt pas commit, dus worden de gen queries exec	, 
/ Dus als er een transient field is , wordt de ERR gen tijdens flush, en zien we de ERR direct	, als het OK is wordt de query gen tijdens flush, maar zien we de query pas bij commit
/ TODO HIBERNATE

 we zien in de EntityDetailType mapping geen ShipmentOrder	, 
/ Maar in de ShipmentOrderVO mapoing zien we	,
		<map name="entityDetails" table="SHIPMENT_ORDER_DETAIL" cascade="all">
			<cache usage="read-write" />
			<key column="ENTITY_SYSTEMID" not-null="true" />
			<map-key-many-to-many column="EDT_SYSTEMID" class="com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailType" />
			<element column="FIELD_VALUE" type="string" />
		</map>
/ Misschien dat hierdoor de flush van de ShipmentOrderVO wordt triggered	, 
/TODO


/ we kunnen als we in 	, 
EntityDetailTypeDAOImpl.getByEntity(EntityType) line: 35	
/ in expressions geven	,
	this.getCurrentSession()
/ daarin kunnen we	,
persistentContext
	entitiesByKey
		table	
			[27]
				key=EntityKey[com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO#26751642]=ShipmentOrder...
				value=...

/ Door dat eerder de ShipmentOrderVO is .save	, is de sho in de 1c	, 

/ Einde Intermezzo

/t
EntityDetailServiceImpl.initialize(EntityDetailSupport) line: 141	
		for (EntityDetailType myEntityDetailType : myList) {
			anEntityDetailSupport.setEntityDetail(myEntityDetailType, spaceAsInitialValue ? " " : "");
/ anEntityDetailSupport=ShipmentOrderVO inst	,
/s
ShipmentOrderVO(EntityDetailSupport).setEntityDetail(EntityDetailType, String) line: 191	
		getEntityDetails().put(aType, aValue);
/= PersistentMap entityDetails (in de ShipmentOrderVO)	,

/t
ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderVO, TMSEventContext) line: 925	
				MpoBeanFactory.getBean(EntityDetailService.class).initialize(myVO);
/d
/ Sets de entity details in de sho	,
/ de value van allen is ""	,
{SystemId:26680795	IsDeleted:false	Detail Type:IMCO	ValueType:REMARKS	=, 
SystemId:26742424	IsDeleted:false	Detail Type:EmptyReturn	ValueType:BOOLEAN	=, 
SystemId:26742423	IsDeleted:false	Detail Type:TerminalAppointment	ValueType:BOOLEAN	=, SystemId:26718467	IsDeleted:false	Detail Type:Empty Depot	ValueType:STRING	=, SystemId:26722539	IsDeleted:false	Detail Type:ToDistance	ValueType:STRING	=, SystemId:26742422	IsDeleted:false	Detail Type:CTODocumentation	ValueType:BOOLEAN	=, SystemId:26708749	IsDeleted:false	Detail Type:Distance	ValueType:STRING	=, SystemId:26738220	IsDeleted:false	Detail Type:CollectionAppointment	ValueType:BOOLEAN	=, SystemId:26741095	IsDeleted:false	Detail Type:Offloading	ValueType:BOOLEAN	=, SystemId:26715545	IsDeleted:false	Detail Type:TravelDistance	ValueType:STRING	=, SystemId:26680417	IsDeleted:false	Detail Type:Empty repositioning required	ValueType:BOOLEAN	=, SystemId:26679611	IsDeleted:false	Detail Type:Full staging required	ValueType:BOOLEAN	=, SystemId:26680415	IsDeleted:false	Detail Type:Full repositioning required	ValueType:BOOLEAN	=, SystemId:26747666	IsDeleted:false	Detail Type:MinTemp	ValueType:STRING	=, SystemId:26743966	IsDeleted:false	Detail Type:EmptyCollect	ValueType:BOOLEAN	=, SystemId:26747667	IsDeleted:false	Detail Type:MaxTemp	ValueType:STRING	=, SystemId:26740568	IsDeleted:false	Detail Type:Labelling	ValueType:BOOLEAN	=, SystemId:26680794	IsDeleted:false	Detail Type:Un Number	ValueType:REMARKS	=, SystemId:26741094	IsDeleted:false	Detail Type:Loading	ValueType:BOOLEAN	=, SystemId:26738221	IsDeleted:false	Detail Type:DeliveryAppointment	ValueType:BOOLEAN	=, SystemId:26747546	IsDeleted:false	Detail Type:TempControl	ValueType:BOOLEAN	=, SystemId:26680416	IsDeleted:false	Detail Type:Empty staging required	ValueType:BOOLEAN	=, SystemId:26738219	IsDeleted:false	Detail Type:Documentation	ValueType:BOOLEAN	=}

				triggerEventHandler(null, myVO, new TMSEventContext());
/s
	private void triggerEventHandler(ShipmentOrderVO anOldVO, ShipmentOrderVO aNewVO, TMSEventContext anEventContext) throws AbstractException {
		if (anOldVO == null) {
			myEvent = new ShipmentOrderEvent(anOldVO, aNewVO, ShipmentOrderEvent.CREATED, anEventContext);
		eventHandlerService.handleEvent(myEvent);
/s
EventHandlerServiceImpl.handleEvent(Event) line: 52	
/=
	public void handleEvent(Event anEvent) throws ChangeManagementException {

		String myEventType = anEvent.getEventType();
shipmentorder.created

			String myLevelPrefix = com.mpobjects.common.util.StringUtils.repeat("...", myLevel);
""
/ myLevel=0
			Date myStartDate = new Date();
			boolean info = LOG.isInfoEnabled();
true
			if (info) {
				if (... || anEvent.getNewVO() != null && LogisticsOrderVO.class.isAssignableFrom(anEvent.getNewVO().getClass())) {
/ JA
/ anEvent.getNewVO()==onze ShipmentOrderVO inst	,

			listenerList.fireEvent(anEvent);
/s
ListenerList.fireEvent(Event<?>) line: 80	

this	ListenerList  (id=17985)	
	theListenerList	ArrayList  (id=18028)	
		elementData	Object[22]  (id=18033)	
			[0]	DocumentEventListener  (id=18035)	
			[1]	CustomerOrderEventListener  (id=18036)	
			[2]	ShoCostAllocationEventListener  (id=18037)	
			[3]	TMSCarConServiceOrderEventListener  (id=18039)	
			[4]	SupplierInvoiceUpdateEventListener  (id=18040)	
			[5]	StockTransactionEventListener  (id=18042)	
			[6]	ShipmentOrderConsolidationEventListener  (id=18044)	
			[7]	$Proxy384  (id=18046)	
com.mpobjects.event.service.DeferredEventServiceImpl@7238f26d
			[8]	EventEventListener  (id=18048)	
			[9]	AllocationEventListener  (id=18050)	
			[10]	CustomerInvoiceUpdateEventListener  (id=18052)	
			[11]	CapableToPromiseEventListener  (id=18054)	
			[12]	MpoEventListener  (id=18056)	
			[13]	AutomaticMailEventListener  (id=18058)	
			[14]	EmailReportEventListener  (id=18060)	
			[15]	InvoiceServiceOrderEventHandler  (id=18062)	
			[16]	RateCalcEventListener  (id=18064)	

/ Intermezzo

public class ShipmentOrderEvent extends Event<ShipmentOrderVO> {

	public static final String CREATED = "shipmentorder.created";
	public static final String DELETED = "shipmentorder.deleted";
	public static final String PRICE_UPDATED = "shipmentorder.price_updated";
	public static final String STATUS_UPDATED = "shipmentorder.status_updated";
	public static final String DATES_UPDATED = "shipmentorder.dates_updated";
	public static final String UPDATED = "shipmentorder.updated";

public class ServiceActionEvent extends Event<ServiceActionVO> {

	public static final String CREATED = "serviceaction.created";
	public static final String DELETED = "serviceaction.deleted";
	public static final String UPDATED = "serviceaction.updated";

public class LogisticsOrderEventEvent extends Event<LogisticsOrderEventVO> {

	public static enum SpecificPurposeCode {
		DOCUMENT_EVENT, RESOURCE_EVENT, SUPPLIER_INVOICE_EVENT, CUSTOMER_INVOICE_EVENT
	}

/ we kunnen SpecificPurposeCode.SUPPLIER_INVOICE_EVENT.name()

public class ProductItemEvent extends Event<ProductItemVO> {

	public static final String CREATED = "productitem.created";
	public static final String DELETED = "productitem.deleted";
	public static final String UPDATED = "productitem.updated";

/ Einde Intermezzo

/ anEvent.getEventType()="shipmentorder.created"
/ Nu	,

		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);
/s
DocumentEventListener.handleEvent(Event) line: 48	
		if (anEvent.getEventType().equals(LogisticsOrderEventEvent.SpecificPurposeCode.DOCUMENT_EVENT.name())) {
/ NEE
/ anEvent.getEventType()="shipmentorder.created"

/t
/s
CustomerOrderEventListener.handleEvent(Event) line: 28	
		if (anEvent.getEventType().equals(ShipmentOrderEvent.STATUS_UPDATED)) {
/ NEE


/t
/s
ShoCostAllocationEventListener.handleEvent(Event) line: 27	
		if (myType.equals(ShipmentOrderEvent.UPDATED)) {
/ NEE
		} else if (myType.equals(ServiceActionEvent.UPDATED)) {
/ NEE

/t
/s
TMSCarConServiceOrderEventListener.handleEvent(Event) line: 70	
		if (myEventType.equals(ServiceOrderEvent.UPDATED)) {
/ NEE

/t
/s
SupplierInvoiceUpdateEventListener.handleEvent(Event) line: 38	
		if (anEvent.getEventType().equals(LogisticsOrderEventEvent.SpecificPurposeCode.SUPPLIER_INVOICE_EVENT.name())) {
/ NEE

/t
/s
StockTransactionEventListener.handleEvent(Event<?>) line: 31	
		if (anEvent.getEventType().equals(ShipmentOrderEvent.UPDATED) || anEvent.getEventType().equals(ShipmentOrderEvent.DATES_UPDATED)) {
/ NEE
		} else if (anEvent.getEventType().equals(ProductItemEvent.CREATED)) {
/ NEE
		} else if (anEvent.getEventType().equals(ProductItemEvent.UPDATED)) {
/ NEE
		} else if (anEvent.getEventType().equals(ProductItemEvent.DELETED)) {
/ NEE

/ t
/s
ShipmentOrderConsolidationEventListener.handleEvent(Event<?>) line: 33	
		if (anEvent.getEventType().equals(ShipmentOrderEvent.UPDATED) || anEvent.getEventType().equals(ShipmentOrderEvent.DATES_UPDATED)
				|| anEvent.getEventType().equals(ShipmentOrderEvent.CREATED)) {
/ JA
			transactionHelper.executeAfterCommit(new Runnable() {
				@Override
				public void run() {
->					shipmentOrderConsolidationUpdateProducer.produce(((ShipmentOrderVO) anEvent.getNewVO()).getSystemId());
				}
/ TODO (transactionHelper)

/t
/s
DeferredEventServiceImpl.handleEvent(Event) line: 223	
	} else if (anEvent.getEventType().equals(ShipmentOrderEvent.CREATED)) {
			handleShipmentOrderUpdate((ShipmentOrderEvent) anEvent);
/s
DeferredEventServiceImpl.handleShipmentOrderUpdate(ShipmentOrderEvent) line: 904	
		Map<String, Object> myMap = getEventMappingService().getBaseEventIdentifiers(myNew);
/s
EventMappingServiceImpl.getBaseEventIdentifiers(ShipmentOrderVO) line: 47	
		return getBaseEventIdentifiers(aShipmentOrderVO, ShipmentOrderQualifierMatcher.SHIPMENT_ORDER_QUALIFIERS);

/ Intermezzo

	static {
		Map<String, String> myMap = new HashMap<String, String>();
		myMap.put("shipmentOrderId", "shipmentOrderId");
		myMap.put("shipmentOrderReferenceReference1", "reference1");
		myMap.put("shipmentOrderReferenceReference2", "reference2");
		myMap.put("shipmentOrderReferenceReference3", "reference3");
		SHIPMENT_ORDER_QUALIFIERS = Collections.unmodifiableMap(myMap);
	}


/ Einde Intermezzo
/s
EventMappingServiceImpl.getBaseEventIdentifiers(LogisticsOrderVO, Map<String,String>) line: 83	

		for (Map.Entry<String, String> myQualifier : aQualifierList.entrySet()) {
			String myProperty = myQualifier.getValue();
			myResult.put(myQualifier.getKey(), myContext.getValue(myProperty));
/ myQualifier.getKey()="reference1"
/ myContext.getValue(myProperty))="91T55707"
/ myQualifier.getKey()="reference3"
/ myContext.getValue(myProperty))=""
/ myQualifier.getKey()="reference"
/ myContext.getValue(myProperty))="3114659501"
/ myQualifier.getKey()="shipmentOrderId"
/ myContext.getValue(myProperty))="1234567891"

/t
DeferredEventServiceImpl.handleShipmentOrderUpdate(ShipmentOrderEvent) line: 909	
		Map<String, Object> myMap = getEventMappingService().getBaseEventIdentifiers(myNew);
/ gets some properties out of the ShipmentOrderVO	, and puts them in the map	,

		for (DeferredEvent myEvent : findMatchingEvents(myMap)) {
/ findMatchingEvents(myMap)=[] 
/ NEE

		handleShipmentItemUpdate(anEvent);
/s
DeferredEventServiceImpl.handleShipmentItemUpdate(ShipmentOrderEvent) line: 861	
			ShipmentOrderVO myNew = anEvent.getNewShipmentOrderVO();
/ onze sho	,
			Collection<ShipmentItemVO> myNewList = myNew.getShipmentItemList();
[]
			for (ShipmentItemVO myNewItem : myNewList) {
/ NEE

/t
	public void fireEvent(Event<?> anEvent) throws AbstractException {
		for (EventListener myListener : theListenerList) {
/ volgende	,
			myListener.handleEvent(anEvent);
/s
EventEventListener.handleEvent(Event) line: 109	
/ GEEN event type == "shipmentorder.created"

/ volgende	,
AllocationEventListener.handleEvent(Event) line: 36	

		if (myType.equals(ServiceOrderCostEvent.CREATED)) {
/ NEE
		} else if (myType.equals(ServiceOrderCostBatchEvent.BATCH_CREATED)) {
/ NEE
		} else if (myType.equals(ServiceOrderCostEvent.REALLOCATE)) {
/ NEE
		} else if (myType.equals(ServiceOrderCostEvent.UPDATED)) {
/ NEE
		} else if (myType.equals(ServiceOrderEvent.UPDATED)) {
/ NEE
		} else if (myType.equals(ShipmentOrderEvent.UPDATED)) {
/ NEE
		} else if (myType.equals(ShipmentOrderPriceEvent.UPDATED)) {
/ NEE
		} else if (myType.equals(ServiceActionEvent.UPDATED)) {
/ NEE
		} else {
/ JA
			LOG.debug("Event not handled: " + myType);


/ volgende	,
CustomerInvoiceUpdateEventListener.handleEvent(Event) line: 36	
		if (anEvent.getEventType().equals(LogisticsOrderEventEvent.SpecificPurposeCode.CUSTOMER_INVOICE_EVENT.name())) {
/ NEE

/ volgende	,
		if (anEvent.getEventType().equals(LogisticsOrderEventEvent.SpecificPurposeCode.CUSTOMER_INVOICE_EVENT.name())) {
/ NEE
		} else if (CTPUtil.isServiceOrderEnabled()) {
/ JA
/ want	,
CTPUtil.java
	public static boolean isServiceOrderEnabled() {
		return "true".equalsIgnoreCase(ApplicationPropertyManager.getInstance().getModuleProperty("capabletopromise", "plan.serviceorder", "false"));
/ we zien in mpo.properties	,
module.capabletopromise.plan.serviceorder=true

			if (anEvent.getEventType().equalsIgnoreCase(ServiceOrderEvent.UPDATED) || anEvent.getEventType().equalsIgnoreCase(ServiceOrderEvent.CREATED)
					|| anEvent.getEventType().equalsIgnoreCase(ServiceOrderEvent.DELETED)) {
/ NEE

/ volgende	,
MpoEventListener.handleEvent(Event) line: 21	
		String myEventType = anEvent.getEventType();
		if (myEventType.equals(ShipmentOrderEvent.UPDATED)) {
/ NEE

/ volgende	,
AutomaticMailEventListener.handleEvent(Event) line: 68	
		if (anEvent.getEventType().equals(ServiceOrderEvent.UPDATED)) {
/ NEE

/ volgende	,
EmailReportEventListener(ReportEventListener).handleEvent(Event) line: 43	
		List myNotificationsList = new ArrayList();
		addReportNotificationEventProducers(myNotificationsList);
/s
		aList.add(new ShipmentNotificationProducer());
		aList.add(new ManifestNotificationEventProducer());
		aList.add(new PreAlertNotificationProducer());

/ myNotificationsList=[com.mpobjects.emailnot.notification.model.impl.ShipmentNotificationProducer@293c2a99, com.mpobjects.emailnot.notification.model.impl.ManifestNotificationEventProducer@2d10b7f5, com.mpobjects.emailnot.notification.model.impl.PreAlertNotificationProducer@249d4cf0]

		for (int i = 0; i < myNotificationsList.size(); i++) {
			ReportNotificationEventProducer myReportNotification = (ReportNotificationEventProducer) myNotificationsList.get(i);
			synchronized (this) {
				if (myReportNotification.shouldBeSent(anEvent)) {
/ NEE
/ want	,
/s
PreAlertNotificationProducer.shouldBeSend(Event) line: 261	
		if (anEvent.getEventType().equals(ServiceOrderEvent.UPDATED)) {
/ NEE

/ volgende	,
InvoiceServiceOrderEventHandler.handleEvent(Event) line: 45	
		if (myEventType.equals(ServiceOrderEvent.UPDATED)) {
/ NEE

/ volgende	,
RateCalcEventListener.handleEvent(Event) line: 66	
		if (anEvent.getEventContext().hasFlag(TMSEventContext.FLAG_MAY_RATE_CALC)) {
/ JA
			String myRecalcExecution = ApplicationPropertyManager.getInstance().getModuleProperty("ratecalc", "serviceorder.ratecalculation.execution");
auto
/ want	,
$ vi 2015.01/mpo/mpo.properties
module.ratecalc.serviceorder.ratecalculation.execution=auto

			if (myRecalcExecution.equalsIgnoreCase("auto")) {
				recalcServiceOrderCost(anEvent);
/s
RateCalcEventListener.recalcServiceOrderCost(Event) line: 191	
		if (myType.equals(ConsignmentEvent.UPDATED) || myType.equals(ConsignmentEvent.CREATED)) {
/ NEE
		} else if (myType.equals(ServiceOrderEvent.UPDATED) || myType.equals(ServiceOrderEvent.CREATED)) {
/ NEE
		} else if (myType.equals(ShipmentOrderEvent.UPDATED)) {
/ NEE
		} else {

/t
RateCalcEventListener.handleEvent(Event) line: 74	
				recalcServiceOrderCost(anEvent);
/d
/ NIETS
			String myPriceExecution = ApplicationPropertyManager.getInstance().getModuleProperty("ratecalc", "shipmentorderprice.ratecalculation.execution");
auto
			if (myPriceExecution.equalsIgnoreCase("auto")) {
				recalcShipOrderPrice(anEvent);
/s
RateCalcEventListener.recalcShipOrderPrice(Event) line: 86	
			if (myType.equals(ShipmentOrderEvent.CREATED)) {
				ShipmentOrderVO myNewShipmentOrderVO = ((ShipmentOrderEvent) anEvent).getNewShipmentOrderVO();
				recalculate(myNewShipmentOrderVO, AgreementType.SHIPMENT_ORDER, anEvent.getEventContext());
/s
RateCalcEventListener.recalculate(ShipmentOrderVO, AgreementType, TMSEventContext) line: 311	
		boolean myCalcOffline = ApplicationPropertyManager.getInstance().getModuleOrganizationProperty(anOrder.getOrganization(), "ratecalc",
				"shipmentorder.recalculate.offline", false);
false
/ de property zien we niet, 
module....shipmentorder.recalculate.offline
/ TODO

		if (myCalcOffline) {
/ NEE
		} else {
			LOG.debug("Shipment order [" + anOrder + "] is calculated in line (immediately)");
			getCalculationService().recalculate(anOrder, aRateType, anEventContext);
/s
CalculationServiceImpl.recalculate(LogisticsOrderVO, AgreementType, TMSEventContext) line: 443	
			List<RateAgreementVO> mySelectedRateAgreement = getMatchingRateAgreement(anOrder, aRateType);
anOrder	ShipmentOrderVO  (id=15148)	
ShipmentOrder: 1234567892(SystemId:26751662; Org:NEEC-NL)
aRateType	AgreementType  (id=16664)	
SHIPMENT_ORDER
/s
CalculationServiceImpl.getMatchingRateAgreement(LogisticsOrderVO, AgreementType) line: 652	

		JXPathContext myContext = JXPathContext.newContext(aLogisticsOrder);

			/* First we need to check if there are contracts attached and if these contracts have rate agreements */
			if (ApplicationPropertyManager.getInstance().getModuleProperty("contract", "enabled", false)) {
/ NEE

			if (myPreselectedList.isEmpty()) {
				/* First try if the previous match is still valid */
				if (aLogisticsOrder.isPersistent()) {
					if (aLogisticsOrder instanceof ServiceOrderVO) {
					} else {
						myKey = "SHO-" + aRateType + aLogisticsOrder.getSystemId();
SHO-SHIPMENT_ORDER26751662

					Integer[] myInt = (Integer[]) matching_cache.getObject(myKey);
					if (myInt != null) {
/ NEE

				myPreselectedList = getRateAgreementList(aRateType);
/s
CalculationServiceImpl.getRateAgreementList(AgreementType) line: 755	
		return rateAgreementDao.getByType(aRateType);
/s
	public List<RateAgreementVO> getByType(AgreementType aRateType) {
		DetachedCriteria myCriteria = DetachedCriteria.forClass(RateAgreementVO.class);
		myCriteria.add(Property.forName("agreementType").eq(aRateType)).add(Property.forName("template").eq(false))
				.add(Property.forName("quotation").eq(false));
		return findNonDeleted(myCriteria);

/ Intermezzo

	<class name="com.mpobjects.oms.ratecalc.model.rateagreement.vo.RateAgreementVO" lazy="false" table="RATE_AGREEMENT">
		<property name="template" column="IS_TEMPLATE" />
		<property name="quotation" column="IS_QUOTATION" />
		<property name="agreementType" column="RATE_TYPE" not-null="true">

mpo_2015_01=# select * from rate_agreement where rate_type='SHIPMENT_ORDER' and is_template=false and is_quotation=false and is_deleted=false;
 system_id |                   name                    |                  description                  | organization_systemid | unit_systemid | is_deleted |   r
ate_type    | is_quotation | is_template | reference1 | reference2 | reference3 | reference4 | reference5 | reference6 | reference7 | reference8 | reference9 | r
eference10 
-----------+-------------------------------------------+-----------------------------------------------+-----------------------+---------------+------------+----
------------+--------------+-------------+------------+------------+------------+------------+------------+------------+------------+------------+------------+--
-----------
  26738950 | Test Copy                                 | Thrutainers International DBN Price Agreement |                    11 |      26677443 |          0 | SHI
PMENT_ORDER |            0 |           0 |            |            |            |            |            |            |            |            |            | 
  26731828 | test Price Agreement_Q14B25AE6F11         | Thrutainers International DBN Price Agreement |                    11 |      26677443 |          0 | SHI
PMENT_ORDER |            0 |           0 |            |            |            |            |            |            |            |            |            | 
  26746250 | NIPPON_FLEET                              |                                               |                  7500 |       1000072 |          0 | SHI
PMENT_ORDER |            0 |           0 |            |            |            |            |            |            |            |            |            | 
  26710250 | Thrutainers International Price Agreement | Thrutainers International DBN Price Agreement |                    11 |      26677443 |          0 | SHI
PMENT_ORDER |            0 |           0 |            |            |            |            |            |            |            |            |            | 
  26710419 | Non Preferential Customer Price Agreement | Price Agreement for non preferential customer |                    11 |      26677443 |          0 | SHI
PMENT_ORDER |            0 |           0 |            |            |            |            |            |            |            |            |            | 
  26707935 | ICS Fuel Surcharge Master table           | ICS Fuel surcharge master table               |                    11 |      26677443 |          0 | SHI
PMENT_ORDER |            0 |           0 |            |            |            |            |            |            |            |            |            | 
(6 rows)

/ Einde Intermezzo

/t
CalculationServiceImpl.getMatchingRateAgreement(LogisticsOrderVO, AgreementType) line: 702	
				myPreselectedList = getRateAgreementList(aRateType);
/d
/ 7 rate agreements	,

			for (RateAgreementVO myRateAgreementVO : myPreselectedList) {

/ volgende (1ste nu ) rate agreement

				if (myResultList.isEmpty() || ...){ 
/ JA
					if (myRateAgreementVO.matches(myContext)) {
/ NEE

/ want	,
/s
RateAgreementVO.matches(JXPathContext aContext) throws RateException {

		Collection<RAgreementSelCriterion> myRagreementSelCriteriumList = getRateAgreementSelCriterionList();
/=RateAgreementVO.rateAgreementSelCriterionList
		for (RAgreementSelCriterion myRagreementSelCriteriumVO : myRagreementSelCriteriumList) {
			if (!myRagreementSelCriteriumVO.matches(aContext)) {
/ NEE
/ (voor 2 crit's in 1ste rate agreement)	,
/want	,

/ Intermezzo

/ rate agreement	,
mpo_2015_01=# select *from rate_agreement where system_id=26710250 ;
 system_id |                   name                    |                  description                  | organization_systemid | unit_systemid | is_deleted |   r
ate_type    | is_quotation | is_template | reference1 | reference2 | reference3 | reference4 | reference5 | reference6 | reference7 | reference8 | reference9 | r
eference10 
-----------
  26710250 | Thrutainers International Price Agreement | Thrutainers International DBN Price Agreement |                    11 |      26677443 |          0 | SHI
PMENT_ORDER |            0 |           0 |            |            |            |            |            |            |            |            |            | 

/ heeft 2 rate agreement criterions	,

mpo_2015_01=# select*from ragreement_sel_criterium rasc join order_detail od on rasc.order_detail_systemid=od.system_id where   rate_agreement_systemid =26710250;
 system_id | rate_agreement_systemid | unit_systemid |          value_from           |  value_to   | match_type_systemid | order_detail_systemid | is_date | syst
em_id |          path_or_class          |     name      | unit_systemid | parameter_type_systemid |  entity_type   
-----------+-------------------------+---------------+-------------------------------+-------------+---------------------+-----------------------+---------+-----
------+---------------------------------+---------------+---------------+-------------------------+----------------
  26710251 |                26710250 |               | Thrutainers International DBN |             |             3800001 |                 21955 |       0 |     
21955 | ./billToPartyVO/partyId         | BILL_TO_PARTY |               |                 3700001 | SHIPMENT_ORDER
  26710252 |                26710250 |               | 01-Jan-2014                   | 31-Dec-2015 |             3800005 |              41000528 |       0 |  410
00528 | ./dateSetVO/requestedStartAfter | REQ START     |       1000536 |                 3700005 | SHIPMENT_ORDER
(2 rows)


/ In de appl zien we de rate agreement criterions ook	,

theSystemId: 26710251
RateAgreementSystemid: 26710250
Unit: null
ValueFrom: Thrutainers International DBN
ValueTo: null
MatchType: SystemId [3800001], Name [REGEX]
OrderDetail: SystemId: 21955, Name :BILL_TO_PARTY, PathOrClass :./billToPartyVO/partyId

theSystemId: 26710252
RateAgreementSystemid: 26710250
Unit: null
ValueFrom: 01-Jan-2014
ValueTo: 31-Dec-2015
MatchType: SystemId [3800005], Name [DATE_RANGE]
OrderDetail: SystemId: 41000528, Name :REQ START, PathOrClass :./dateSetVO/requestedStartAfter

/ Einde Intermezzo

/t
CalculationServiceImpl.getMatchingRateAgreement(LogisticsOrderVO, AgreementType) line: 708	
/ volgende	 rate agreement	,

			for (RateAgreementVO myRateAgreementVO : myPreselectedList) {
				if (myResultList.isEmpty() || !myResultList.contains(myRateAgreementVO)) {
					if (myRateAgreementVO.matches(myContext)) {
/ NEE
/ want	,
/s
RateAgreementVO.matches(JXPathContext aContext) throws RateException {
		Collection<RAgreementSelCriterion> myRagreementSelCriteriumList = getRateAgreementSelCriterionList();
		for (RAgreementSelCriterion myRagreementSelCriteriumVO : myRagreementSelCriteriumList) {
			if (!myRagreementSelCriteriumVO.matches(aContext)) {
/ NEE
/ want	,

/ Intermezzo

mpo_2015_01=# select *from rate_agreement where system_id=26731828;
 system_id |               name                |                  description                  | organization_systemid | unit_systemid | is_deleted |   rate_type
    | is_quotation | is_template | reference1 | reference2 | reference3 | reference4 | reference5 | reference6 | reference7 | reference8 | reference9 | reference
10 
---
  26731828 | test Price Agreement_Q14B25AE6F11 | Thrutainers International DBN Price Agreement |                    11 |      26677443 |          0 | SHIPMENT_OR
DER |            0 |           0 |            |            |            |            |            |            |            |            |            | 
(1 row)

mpo_2015_01=# select*from ragreement_sel_criterium rasc join order_detail od on rasc.order_detail_systemid=od.system_id where   rate_agreement_systemid =26731828;
 system_id | rate_agreement_systemid | unit_systemid | value_from  |  value_to   | match_type_systemid | order_detail_systemid | is_date | system_id |          p
ath_or_class          |     name      | unit_systemid | parameter_type_systemid |  entity_type   
-----------+-------------------------+---------------+-------------+-------------+---------------------+-----------------------+---------+-----------+-----------
----------------------+---------------+---------------+-------------------------+----------------
  26732915 |                26731828 |               | XXX         |             |             3800001 |                 21955 |       0 |     21955 | ./billToPa
rtyVO/partyId         | BILL_TO_PARTY |               |                 3700001 | SHIPMENT_ORDER
  26732916 |                26731828 |               | 01-Jan-2014 | 31-Dec-2014 |             3800005 |              41000528 |       0 |  41000528 | ./dateSetV
O/requestedStartAfter | REQ START     |       1000536 |                 3700005 | SHIPMENT_ORDER
(2 rows)

/ Einde Intermezzo

/ t
CalculationServiceImpl.getMatchingRateAgreement(LogisticsOrderVO, AgreementType) line: 708	

/ Volgende rate agreement	,

			for (RateAgreementVO myRateAgreementVO : myPreselectedList) {
				if (myResultList.isEmpty() || !myResultList.contains(myRateAgreementVO)) {
					if (myRateAgreementVO.matches(myContext)) {
/s
RateAgreementVO.matches(JXPathContext aContext) throws RateException {
		Collection<RAgreementSelCriterion> myRagreementSelCriteriumList = getRateAgreementSelCriterionList();
		for (RAgreementSelCriterion myRagreementSelCriteriumVO : myRagreementSelCriteriumList) {
			if (!myRagreementSelCriteriumVO.matches(aContext)) {
/t
					if (myRateAgreementVO.matches(myContext)) {
/d
						myResultList.add(myRateAgreementVO);
/ JA

/ Intermezzo

mpo_2015_01=# select *from rate_agreement where system_id=26746250;
 system_id |     name     | description | organization_systemid | unit_systemid | is_deleted |   rate_type    | is_quotation | is_template | reference1 | referen
ce2 | reference3 | reference4 | reference5 | reference6 | reference7 | reference8 | reference9 | reference10 
-----------+--------------+-------------+-----------------------+---------------+------------+----------------+--------------+-------------+------------+--------
  26746250 | NIPPON_FLEET |             |                  7500 |       1000072 |          0 | SHIPMENT_ORDER |            0 |           0 |            |        
    |            |            |            |            |            |            |            | 
(1 row)


 system_id | rate_agreement_systemid | unit_systemid | value_from | value_to | match_type_systemid | order_detail_systemid | is_date | system_id |     path_or_cl
ass     |     name     | unit_systemid | parameter_type_systemid |  entity_type   
-----------+-------------------------+---------------+------------+----------+---------------------+-----------------------+---------+-----------+---------------
--------+--------------+---------------+-------------------------+----------------
  26746251 |                26746250 |               | NEEC.*     |          |             3800001 |                554185 |       0 |    554185 | ./organization
VO/code | ORGANIZATION |               |                 3700001 | SHIPMENT_ORDER
(1 row)

/ In de shipmentOrderVO is er een organizationVO property (de field heet organization) , daarbinnen in een code property (ook een field code), en de value is "NEEC-NL"	,

/ Einde Intermezzo

/t 
CalculationServiceImpl.getMatchingRateAgreement(LogisticsOrderVO, AgreementType) line: 703	

/ volgende rate agreement	,

			for (RateAgreementVO myRateAgreementVO : myPreselectedList) {
				if (myResultList.isEmpty() || !myResultList.contains(myRateAgreementVO)) {
					if (myRateAgreementVO.matches(myContext)) {
/ NEE

/ Intermezzo

mpo_2015_01=# select *from rate_agreement where system_id=26710250;
 system_id |                   name                    |                  description                  | organization_systemid | unit_systemid | is_deleted |   r
ate_type    | is_quotation | is_template | reference1 | reference2 | reference3 | reference4 | reference5 | reference6 | reference7 | reference8 | reference9 | r
eference10 
-----------+-------------------------------------------+-----------------------------------------------+-----------------------+---------------+------------+----
  26710250 | Thrutainers International Price Agreement | Thrutainers International DBN Price Agreement |                    11 |      26677443 |          0 | SHI
PMENT_ORDER |            0 |           0 |            |            |            |            |            |            |            |            |            | 
(1 row)

 system_id | rate_agreement_systemid | unit_systemid |          value_from           |  value_to   | match_type_systemid | order_detail_systemid | is_date | syst
em_id |          path_or_class          |     name      | unit_systemid | parameter_type_systemid |  entity_type   
-----------+-------------------------+---------------+-------------------------------+-------------+---------------------+-----------------------+---------+-----
------+---------------------------------+---------------+---------------+-------------------------+----------------
  26710251 |                26710250 |               | Thrutainers International DBN |             |             3800001 |                 21955 |       0 |     
21955 | ./billToPartyVO/partyId         | BILL_TO_PARTY |               |                 3700001 | SHIPMENT_ORDER
  26710252 |                26710250 |               | 01-Jan-2014                   | 31-Dec-2015 |             3800005 |              41000528 |       0 |  410
00528 | ./dateSetVO/requestedStartAfter | REQ START     |       1000536 |                 3700005 | SHIPMENT_ORDER
(2 rows)

/ volgende	,
CalculationServiceImpl.getMatchingRateAgreement(LogisticsOrderVO, AgreementType) line: 702	

/ volgende	,
CalculationServiceImpl.getMatchingRateAgreement(LogisticsOrderVO, AgreementType) line: 702	

			for (RateAgreementVO myRateAgreementVO : myPreselectedList) {
					if (myRateAgreementVO.matches(myContext)) {
/ JA
						myResultList.add(myRateAgreementVO);

/ Intermezzo

mpo_2015_01=# select *from rate_agreement where system_id=26707935
mpo_2015_01-# ;
 system_id |              name               |           description           | organization_systemid | unit_systemid | is_deleted |   rate_type    | is_quotati
on | is_template | reference1 | reference2 | reference3 | reference4 | reference5 | reference6 | reference7 | reference8 | reference9 | reference10 
-----------+---------------------------------+---------------------------------+-----------------------+---------------+------------+----------------+-----------
---+-------------+------------+------------+------------+------------+------------+------------+------------+------------+------------+-------------
  26707935 | ICS Fuel Surcharge Master table | ICS Fuel surcharge master table |                    11 |      26677443 |          0 | SHIPMENT_ORDER |           
 0 |           0 |            |            |            |            |            |            |            |            |            | 
(1 row)

mpo_2015_01=# select*from ragreement_sel_criterium rasc join order_detail od on rasc.order_detail_systemid=od.system_id where   rate_agreement_systemid =26707935;
 system_id | rate_agreement_systemid | unit_systemid |   value_from    | value_to | match_type_systemid | order_detail_systemid | is_date | system_id |     path_
or_class     |     name     | unit_systemid | parameter_type_systemid |  entity_type   
-----------+-------------------------+---------------+-----------------+----------+---------------------+-----------------------+---------+-----------+----------
-------------+--------------+---------------+-------------------------+----------------
  26707936 |                26707935 |               | !ICS.*|!HAAL-ZW |          |             3800001 |                554185 |       0 |    554185 | ./organiz
ationVO/code | ORGANIZATION |               |                 3700001 | SHIPMENT_ORDER
(1 row)

/ Einde Intermezzo



/ JA
theSystemId: 26746250Name :NIPPON_FLEET
theSystemId: 26707935Name :ICS Fuel Surcharge Master table
/ 26746250 omdat organizationVO/code="NEEC*"
/ 26707935 omdat organizationVO/code="!ICS.*|!HAAL-ZW"


			if (myResultList.isEmpty()) {
			} else {
				if (aLogisticsOrder.isPersistent() && !AgreementType.SHIPMENT_ORDER_PROPERTIES.equals(aRateType) && !StringUtils.isEmpty(myKey)) {
/ JA
aRateType="SHIPMENT_ORDER"
					int i = 0;
					for (RateAgreementVO myRateAgreementVO : myResultList) {
						myEntry[i] = myRateAgreementVO.getSystemId();
						i++;
					}
					matching_cache.addObject(myKey, myEntry);
myKey	"SHO-SHIPMENT_ORDER26751662" (id=17080)	
myEntry	Integer[2]  (id=17646)	
[26746250, 26707935]
/ Dit zijn 2 rateagreement's	,

/t
CalculationServiceImpl.recalculate(LogisticsOrderVO, AgreementType, TMSEventContext) line: 448	
			List<RateAgreementVO> mySelectedRateAgreement = getMatchingRateAgreement(anOrder, aRateType);
/d
			// Now calculate the rates
			RateCalculationVO myRateCalculationVO = new RateCalculationVO();

			if (anOrder instanceof ServiceOrderVO) {
			} else if (anOrder instanceof ShipmentOrderVO) {
				myRateCalculationVO.setShipmentOrder((ShipmentOrderVO) anOrder);

			if (mySelectedRateAgreement.isEmpty()) {
			} else {
				myRateCalculationVO.setRateAgreementVO(mySelectedRateAgreement);
/ een list	,

				// do not recalculate when values have not changed
				if (anOrder instanceof ServiceOrderVO) {
				} else if (anOrder instanceof ShipmentOrderVO) {
					ShipmentOrderVO myShipmentOrder = (ShipmentOrderVO) anOrder;

					if (!myRateCalculationVO.rateCalculationRequired()) {
/s
RateCalculationVO.rateCalculationRequired() line: 739	
		// First check if we need to calculate
		LogisticsOrderVO myOrder = getOrder();
		if (myOrder != null && !StringUtils.isEmpty(myOrder.getRatecalcMd5Hash())) {
/ NEE
myOrder.ratecalcMd5Hash==null

		return true;

/t
CalculationServiceImpl.recalculate(LogisticsOrderVO, AgreementType, TMSEventContext) line: 507	
					if (!myRateCalculationVO.rateCalculationRequired()) {
/ NEE
					} else {
						anEventContext.removeFlag(TMSEventContext.FLAG_MAY_RATE_CALC);

				// Now calculate the rates
				myRateCalculationVO.runFor(mySelectedRateAgreement);
/s
RateCalculationVO.runFor(List<RateAgreementVO>) line: 760	
		setRateAgreementVO(aRateAgreementVO);
/ een list van 2 rate agreements	,

			// In case of multiple rate agreement, iterate over first list only!
			Set<Variable> myList = aRateAgreementVO.iterator().next().getVariableList();
/ TODO PETER/PAUL
			if (myList.size() == 0) {
/ JA
				/* No variables (iteration) involved */
				addToLog("Calculating rate agreement, no variables defined");
				calculateWithoutVariables();
/s
RateCalculationVO.calculateWithoutVariables() line: 1298	
			RateCalculationAlternative myAlterNative = new RateCalculationAlternative(this);
			alternativeList.add(myAlterNative);
			for (RateAgreementVO myAgreement : getRateAgreementVO()) {
/ 1ste	,
theSystemId: 26746250Name :NIPPON_FLEET

				runFor(myAgreement, myAlterNative);
/s
RateCalculationVO.runFor(RateAgreementVO, RateCalculationAlternative) line: 1048	

			for (CostComponentSpecificationVO myCostComponent : aRateAgreementVO.getCostComponentSpecificationList()) {
CostComponentSpecification:26746274/RC_FREIGHT/Freight Prices
/ TODO 
/ In de GUI heten ze Rate Components,	 je ziet ze onder de Tab	,

				if (!myAgreementType.equals(myCostComponent.getEntityType())) {
/ NEE
/ Ze zijn gelijk: SHIPMENT_ORDER
				} else {
					myCostComponentSpecificationList.add(myCostComponent);

				componentLoop: for (CostComponentSpecificationVO myCostComp : myCostComponentSpecificationList) {
					for (RateResult myResult : myCostComp.run(this)) {
/s
	/**
	 * starts the evaluation of this cost component.
	 */
CostComponentSpecificationVO.run(RateCalculationVO) line: 195	

		List<RateResult> myResultList = new ArrayList<RateResult>();
		if (ratePlusMode != RatePlusMode.NONE && ratePlusMode != null) {
/ NEE
		} else {
			RateParameterVO myParameter = getRateParameter();
theSystemId: 26746273Name :RP_FREIGHT_MAX
			RateResult myResult = myParameter.calculate(aRateCalculation);
/ antwoord	,
myResult	RateResult  (id=15779)	
	DATE_FORMAT	"yyyy-MM-dd" (id=15781)	
	DATE_TIME_FORMAT	"yyyy-MM-dd HH:mm:ss" (id=15782)	
	costPartList	ArrayList  (id=15783)	
	isManuallyModified	false	
	theFunctionName	"MAX" (id=15784)	
	theResultName	"RP_FREIGHT_MAX" (id=15785)	
	theSubResultList	ArrayList  (id=15786)	
	theUnitVO	Unit  (id=15787)	
	theValue	"100" (id=15788)	
/= (string)	,
[Unit: theSystemId: 1000072	Symbol :EUR	Description :Euro	UnitType :CURRENCY	IsDeleted :0	; Value: 100]

/ Verder bij (****) als we willen overslaan	,

/ Intermezzo

$ vi CostComponentSpecification.standard.hbm.xml

	<class name="com.mpobjects.oms.ratecalc.model.costcomponentspecification.vo.CostComponentSpecificationVO" table="COST_COMPONENT_SPECIFICATION">
		<many-to-one name="rateAgreement" class="com.mpobjects.oms.ratecalc.model.rateagreement.vo.RateAgreementVO" column="RATE_AGREEMENT_SYSTEMID" />
		<many-to-one name="rateParameter" class="com.mpobjects.oms.ratecalc.model.rateparameter.vo.RateParameterVO" column="PARAMETER_SYSTEMID" not-null="false" />
		<many-to-one name="rateComponentType" class="com.mpobjects.oms.model.ratecomponenttype.RateComponentType" column="ORDER_RATE_PART_SYSTEMID" not-null="false" />


mpo_2015_01=# select*from rate_parameter where system_id=26746273;
 system_id |      name      | description | outputfrom_function_systemid | rate_agreement_systemid | is_persistent | sequence_nr | parameter_type_systemid | is_u
ser_editable | iteration_entity | iteration_action 
-----------+----------------+-------------+------------------------------+-------------------------+---------------+-------------+-------------------------+-----
-------------+------------------+------------------
  26746273 | RP_FREIGHT_MAX |             |                     26746270 |                26746250 |             0 |           0 |                         |     
           0 |                  | 
(1 row)

/ Einde Intermezzo


/s
RateParameterVO.calculate(RateCalculationVO) line: 66	

			// First check if the rate result for this parameter was modified/supplied manually
			RateResult myResult = aRateCalculation.getManuallyModifiedResult(this);
			if (myResult == null) {
/ JA
				// Note, the RateCalculation cache is cleared after each alternative
				if (!aRateCalculation.hasCachedResult(this)) {
/ JA
					try {
						if (aRateCalculation.shouldCalculate(this)) {
/s
RateCalculationVO.shouldCalculate(RateParameterVO) line: 954	
this	RateCalculationVO  (id=17161)	
		AbstractRateFunction myFunction = getRateFunction(aParameter);
/s
RateCalculationVO.getRateFunction(RateParameterVO) line: 619	
		String myKey = aRateParameterVO.getName();
RP_FREIGHT_MAX
		AbstractRateFunction myFunction = rateFunctionCache.get(myKey);
		if (myFunction == null) {
/ JA
			RateFunctionVO myOutputfromFunction = aRateParameterVO.getOutputfromFunctionVO();
com.mpobjects.oms.ratecalc.model.ratefunction.vo.RateFunctionVO/id:26746270

			FunctionDefinitionVO myFunctionDefinition = myOutputfromFunction.getFunctionDefinitionVO();
theSystemId: 3500002
Definition :com.mpobjects.oms.ratecalc.model.process.function.MaxFunction,Name :MAX

			String myClassName = myFunctionDefinition.getDefinition();

/ Intermezzo

$ vi RateFunction.standard.hbm.xml

	<class name="com.mpobjects.oms.ratecalc.model.ratefunction.vo.RateFunctionVO" table="RATE_FUNCTION">
		<many-to-one name="functionDefinitionVO" class="com.mpobjects.oms.ratecalc.model.functiondefinition.vo.FunctionDefinitionVO" column="FUNCTION_DEFINITION_SYSTEMID" />
		<one-to-one name="rateParameter" class="com.mpobjects.oms.ratecalc.model.rateparameter.vo.RateParameterVO" property-ref="outputfromFunctionVO" />
		<many-to-one name="rateTableVO" unique="true" class="com.mpobjects.oms.ratecalc.model.ratetable.vo.RateTableVO" column="RATE_TABLE_SYSTEMID"/>
		<set name="inputParameterList" cascade="all,delete-orphan" lazy="false" inverse="true">
 

$ vi FunctionDefinitionVO.standard.hbm.xml
	<class name="FunctionDefinitionVO" table="FUNCTION_DEFINITION" lazy="false">


mpo_2015_01=# select*from rate_parameter where system_id=26746273;
 system_id |      name      | description | outputfrom_function_systemid | rate_agreement_systemid | is_persistent | sequence_nr | parameter_type_systemid | is_u
ser_editable | iteration_entity | iteration_action 
-----------+----------------+-------------+------------------------------+-------------------------+---------------+-------------+-------------------------+-----
-------------+------------------+------------------
  26746273 | RP_FREIGHT_MAX |             |                     26746270 |                26746250 |             0 |           0 |                         |     
           0 |                  | 
(1 row)

mpo_2015_01=# select*from rate_function where system_id=26746270;
 system_id | function_definition_systemid | is_user_defined | user_func_def | rate_table_systemid | unit_systemid 
-----------+------------------------------+-----------------+---------------+---------------------+---------------
  26746270 |                      3500002 |               0 |               |                     |       1000072
(1 row)

mpo_2015_01=# select*from function_definition where system_id= 3500002;
 system_id |                          definition                           | name 
-----------+---------------------------------------------------------------+------
   3500002 | com.mpobjects.oms.ratecalc.model.process.function.MaxFunction | MAX
(1 row)




/ Einde Intermezzo

			try {
				Class<?> myClass = Class.forName(myClassName);
				myFunction = (AbstractRateFunction) myClass.newInstance();
				myFunction.setRateFunctionVO(myOutputfromFunction);
myFunction	MaxFunction  (id=18183)	
/ myOutputfromFunction=com.mpobjects.oms.ratecalc.model.ratefunction.vo.RateFunctionVO/id:26746270
				myFunction.setRateContext(this);
this	RateCalculationVO  (id=17161)	

			rateFunctionCache.put(myKey, myFunction);
		return myFunction;

/t
RateCalculationVO.shouldCalculate(RateParameterVO) line: 955	
		AbstractRateFunction myFunction = getRateFunction(aParameter);
/d
myFunction	MaxFunction  (id=18183)	

		String myKey = aParameter.getName();
myKey	"RP_FREIGHT_MAX" (id=18087)	

		Boolean myResult = shouldCalculateCache.get(myKey);
null
		if (myResult == null) {
			try {
				myResult = myFunction.shouldCalculate(this);
true
/ hardcoded 
			shouldCalculateCache.put(myKey, myResult);
		return myResult.booleanValue();

/t
RateParameterVO.calculate(RateCalculationVO) line: 77	
						if (aRateCalculation.shouldCalculate(this)) {
/d
							AbstractRateFunction myAbstractRateFunction = aRateCalculation.getRateFunction(this);
com.mpobjects.oms.ratecalc.model.process.function.MaxFunction@7aa00302
	theRateFunctionVO
com.mpobjects.oms.ratecalc.model.ratefunction.vo.RateFunctionVO/id:26746270

							RateFunctionVO myRateFunction = getOutputfromFunctionVO();
com.mpobjects.oms.ratecalc.model.ratefunction.vo.RateFunctionVO/id:26746270
/ TODO PETER/PAUL (We hebben hem al)	,

							Collection<InputParameterVO> myInputParameterList = myRateFunction.getInputParameterList();
[SystemId: 26746366, SystemId: 26746365]

							Collection<RateResult> mySubResults = new ArrayList<RateResult>();

							if (getIterationEntity() != null) {
/ NEE
							} else if (myAbstractRateFunction instanceof AbstractShipmentItemFunction) {
/ NEE
							} else {
								// First, make sure all input parameters are calculated
								for (InputParameterVO myInputParameter : myInputParameterList) {
									RateResult mySub = myInputParameter.calculate(aRateCalculation);
/ this=RateParameterVO
aRateCalculation	RateCalculationVO  (id=17161)	
/s
	/**
	 * calculates this rate parameter. In case it's a service order detail, the service order detail is evaluated. In
	 * case of a free value input parameter, this is the evaluation value.
	 * 
InputParameterVO.calculate(RateCalculationVO) line: 71	
this	InputParameterVO  (id=18339)	
SystemId: 26746366

/ TODO AFMAKEN RATE CALCULATION

/ Intermezzo 

mpo_2015_01=# select*from input_parameter where system_id in (26746365,26746366);
 system_id | parameter_systemid | func_par_def_systemid | rate_func_systemid | dimension_systemid | configuration_value | order_detail_systemid | free_value 
-----------+--------------------+-----------------------+--------------------+--------------------+---------------------+-----------------------+------------
  26746365 |           26746269 |                       |           26746270 |                    |                     |                       |           
  26746366 |           26746264 |                       |           26746270 |                    |                     |                       |           
(2 rows)

mpo_2015_01=# select*from rate_function rf join function_definition fd on rf.function_definition_systemid=fd.system_id where rf.system_id=26746270;
 system_id | function_definition_systemid | is_user_defined | user_func_def | rate_table_systemid | unit_systemid | system_id |                          definiti
on                           | name 
-----------+------------------------------+-----------------+---------------+---------------------+---------------+-----------+----------------------------------
  26746270 |                      3500002 |               0 |               |                     |       1000072 |   3500002 | com.mpobjects.oms.ratecalc.model.
process.function.MaxFunction | MAX
(1 row)

mpo_2015_01=# select*from rate_parameter where system_id in (26746269,26746264);
 system_id |       name       | description | outputfrom_function_systemid | rate_agreement_systemid | is_persistent | sequence_nr | parameter_type_systemid | is
_user_editable | iteration_entity | iteration_action 
-----------+------------------+-------------+------------------------------+-------------------------+---------------+-------------+-------------------------+---
---------------+------------------+------------------
  26746264 | RT_NL_OUTPUT     |             |                     26746263 |                26746250 |             0 |           0 |                         |   
             0 |                  | 
  26746269 | RT_NL_MIN_OUTPUT |             |                     26746268 |                26746250 |             0 |           0 |                         |   
             0 |                  | 
(2 rows)


$ vi InputParameter.standard.hbm.xml

	<class name="InputParameterVO" table="INPUT_PARAMETER" lazy="false">
		<many-to-one name="parameterVO"
			class="com.mpobjects.oms.ratecalc.model.rateparameter.vo.RateParameterVO"
			column="PARAMETER_SYSTEMID" not-null="false" />
		<many-to-one name="orderDetailVO"
			class="com.mpobjects.oms.ratecalc.model.orderdetail.vo.OrderDetail"
			column="ORDER_DETAIL_SYSTEMID" not-null="false" />
		<many-to-one name="funcParDefVO" 
			class="com.mpobjects.oms.ratecalc.model.funcparameterdef.vo.FuncParameterDefVO" 
			column="FUNC_PAR_DEF_SYSTEMID" />
		<many-to-one name="rateFuncVO" 
			class="com.mpobjects.oms.ratecalc.model.ratefunction.vo.RateFunctionVO" 
			column="RATE_FUNC_SYSTEMID" />


mpo_2015_01=# select*from rate_function where system_id=26746268;
 system_id | function_definition_systemid | is_user_defined | user_func_def | rate_table_systemid | unit_systemid 
-----------+------------------------------+-----------------+---------------+---------------------+---------------
  26746268 |                      3500001 |               0 |               |            26746265 |              
(1 row)

mpo_2015_01=# select*from function_definition where system_id= 3500001;
 system_id |                             definition                              |    name    
-----------+---------------------------------------------------------------------+------------
   3500001 | com.mpobjects.oms.ratecalc.model.process.function.RateTableFunction | RATE TABLE
(1 row)

mpo_2015_01=# select*from rate_table where system_id=26746265 ;
 rate_agreement_systemid | system_id |   name    | description | unit_systemid | rate_table_xml | min_charge | max_charge | rounding | excel_formatted | default_
value | rate_table_content | is_user_editable | is_shared | linked_rate_table_systemid | linked_multiplication | linked_addition |      last_update       
-------------------------+-----------+-----------+-------------+---------------+----------------+------------+------------+----------+-----------------+---------
------+--------------------+------------------+-----------+----------------------------+-----------------------+-----------------+------------------------
                26746250 |  26746265 | RT_NL_MIN |             |       1000072 |                |            |            |        0 |               0 |         
      | NL      19.32      |                0 |         0 |                            |                       |                 | 2015-02-25 16:02:26.33
(1 row)

mpo_2015_01=# select*from rate_function where system_id= 26746263;
 system_id | function_definition_systemid | is_user_defined | user_func_def | rate_table_systemid | unit_systemid 
-----------+------------------------------+-----------------+---------------+---------------------+---------------
  26746263 |                      3500001 |               0 |               |            26746258 |              
(1 row)

mpo_2015_01=# select*from function_definition where system_id= 3500001;
 system_id |                             definition                              |    name    
-----------+---------------------------------------------------------------------+------------
   3500001 | com.mpobjects.oms.ratecalc.model.process.function.RateTableFunction | RATE TABLE
(1 row)

mpo_2015_01=# select rate_table_content from rate_table where system_id= 26746258 ;
     rate_table_content      
-----------------------------
         1       2       3  +
 0       1       2       3  +
 100     10      20      30 +
 1000    100     200     300+
 2000    200     300     400+
 5000    500     600     700
(1 row)




/ Einde Intermezzo 


/ Intermezzo

/ een cost component spec is een rate parameter + wat daar mee moet gebeuren in de so	,
/ see  ShipmentOrderCalculationServiceImpl.java
	public boolean applyPropertyResult(ShipmentOrderVO shipmentOrder, CostComponentSpecificationVO aComponent, RateResult rateResult, List<String> aLog) {
			case PREFERRED_PARTY:
				shipmentOrderChanged = setPreferredParty(correctionType, rateResult, shipmentOrder);

/ see op	,
https://acceptance.scs.mp-objects.com/mpo/core/index_frameset

/ kies een so	,
/ click Price/Cost link	,
/ we komen op Shipment Order Finance	,
/ Kies tab Post-calculated	,

/ click detailed log	,
 [16:42:03.114] Calculating rate agreement [NIPPON_FLEET,NEEC DATA ENRICHMENT]

/ we zien dus 2 cost componennt specifications	, 
NIPPON_FLEET
NEEC DATA ENRICHMENT

/ we kunnen deze bekijken	,
configuration, finance, service management, service agreements(admin)
/ open NIPPON_FLEET

/ we zien tabs Rate components, en Parameters	,
/ open een rate component, 
/ we komen op Component Specification	,
/ we zien parameter: rp-freight	, deze kunnen we lookup bij Parameters	,
/ bij Paramaters zien we de input parameters	, dat kan een rate parameter zijn, een order detail, of een fixed value	,

/ we click op een so	, en op Price Cost link	,
/ we click post-calculated	, 
/ we click Calculated log en detailed log	,

Calculation Log

 RC_FREIGHT : RP_FREIGHT_MAX ( MAX ) = 19.32 EUR
	 RT_NL_OUTPUT ( RATE TABLE ) = 1.00 EUR
		 ZONE_OUTPUT ( RATE TABLE ) = 1
		 	TO POSTALCODE ( ) = 1118 EA
		 RP_PAYWEIGHT ( MAX ) = 0.00 KG
		 	SHIP WEIGHT ( ) = 0.00 KG
		 	RP_VOL_WEIGHT ( MULTIPLY ) = 0.00000000 KG
		 		SHIP VOLUME ( ) = 0.000 M3
		 		FreeValue ( ) = 167.00000
	 RT_NL_MIN_OUTPUT ( RATE TABLE ) = 19.32 EUR
	 	TO COUNTRY ( ) = NL

Detailed log

 [14:21:45.093] Calculating rate agreement [NIPPON_FLEET,ICS Fuel Surcharge Master table]
 [14:21:45.093] Calculating rate agreement, no variables defined
 [14:21:45.093] Starting evaluation of component [RC_FREIGHT]
 [14:21:45.093] FUNCTION TYPE: Max
 [14:21:45.093] PARAMETER: RT_NL_OUTPUT start evaluation of parameter
 [14:21:45.093] Evaluating criteria for rate table [RT_NL]
 [14:21:45.093] FUNCTION TYPE: RateTable
 [14:21:45.093] PARAMETER: ZONE_OUTPUT start evaluation of parameter
 [14:21:45.093] Evaluating criteria for rate table [ZONE]
 [14:21:45.093] - Comparing [TO COUNTRY] with value [NL] (No conversion) with from-value [NL] and to-value [null] result [true]
 [14:21:45.094] FUNCTION TYPE: RateTable
 [14:21:45.094] Order detail [TO POSTALCODE] results in:1118 EA
 [14:21:45.094] LOOKUP in table : ZONE results in: 1
 [14:21:45.094] PARAMETER: ZONE_OUTPUT evaluates to: 1
 [14:21:45.094] PARAMETER: RP_PAYWEIGHT start evaluation of parameter
 [14:21:45.094] FUNCTION TYPE: Max
 [14:21:45.094] Order detail [SHIP WEIGHT] results in:0.00 KG
 [14:21:45.094] PARAMETER: RP_VOL_WEIGHT start evaluation of parameter
 [14:21:45.095] FUNCTION TYPE: Multiply
 [14:21:45.095] Order detail [SHIP VOLUME] results in:0.000 M3
 [14:21:45.095] FREE VALUE: 167.00000
 [14:21:45.095] Function: MULTIPLY, input: SHIP VOLUME: conversion from 0.000 Cubic Meter to 0.000 Kilogram
 [14:21:45.095] DEBUG [RP_VOL_WEIGHT] Function: MULTIPLY, input: FREE_VALUE: input has no unit defined, no conversion performed
 [14:21:45.095] PARAMETER: RP_VOL_WEIGHT evaluates to: 0.00000000
 [14:21:45.096] DEBUG [RP_PAYWEIGHT] Mode = NUMBER
 [14:21:45.096] PARAMETER: RP_PAYWEIGHT evaluates to: 0.00
 [14:21:45.096] LOOKUP in table : RT_NL results in: 1
 [14:21:45.096] PARAMETER: RT_NL_OUTPUT evaluates to: 1
 [14:21:45.096] PARAMETER: RT_NL_MIN_OUTPUT start evaluation of parameter
 [14:21:45.096] Evaluating criteria for rate table [RT_NL_MIN]
 [14:21:45.096] FUNCTION TYPE: RateTable
 [14:21:45.096] Order detail [TO COUNTRY] results in:NL
 [14:21:45.097] LOOKUP in table : RT_NL_MIN results in: 19.32
 [14:21:45.097] PARAMETER: RT_NL_MIN_OUTPUT evaluates to: 19.32
 [14:21:45.097] DEBUG [RP_FREIGHT_MAX] Mode = NUMBER
 [14:21:45.097] COST COMPONENT : Freight Prices with correction type: ADD evaluates to [19.32]
 [14:21:45.104] Added to total. New total: 19.32 EUR
 [14:21:45.114] WARNING: Rate agreement has no rate components
 [14:21:45.155] Cost component specification RC_FREIGHT adds value 19.32 (ADD) to price type FREIGHT1
 [14:21:45.155] Calculated price for FREIGHT1 is 19.32: 19.32 (ADD)
 [14:21:45.170] Executed on: Fri Apr 10 14:21:45 CEST 2015	



/ Einde Intermezzo 

/ (****)
CostComponentSpecificationVO.run(RateCalculationVO) line: 208	
		} else {
			RateParameterVO myParameter = getRateParameter();
			RateResult myResult = myParameter.calculate(aRateCalculation);
[Unit: theSystemId: 1000072	Symbol :EUR	Description :Euro	UnitType :CURRENCY	IsDeleted :0	; Value: 100]
			if (myResult != null) {
				...
				myResultList.add(myResult);
		return myResultList;

/t
RateCalculationVO.runFor(RateAgreementVO, RateCalculationAlternative) line: 1090	

			CurrencyGroup myTotal = new CurrencyGroup();

				componentLoop: for (CostComponentSpecificationVO myCostComp : myCostComponentSpecificationList) {
					for (RateResult myResult : myCostComp.run(this)) {
/d
/ myResult=[Unit: theSystemId: 1000072	Symbol :EUR	Description :Euro	UnitType :CURRENCY	IsDeleted :0	; Value: 100]

						switch (myCostComp.getCorrectionType()) {
							case ADD:
									myTotal.add(myResult.getCurrency(), RateResultUtils.getBigDecimalValue(myResult, BigDecimal.ZERO));
/s
RateResult.java
	public CurrencyVO getCurrency() {
		} else {
			if (getUnitVO().isCurrency()) {
				return getUnitVO().getAsCurrency();
/ TODO (waar ?)
/t
/s
CurrencyGroup.add(CurrencyVO, BigDecimal) line: 51	
aCurrency	CurrencyVO  (id=16324)	
SystemId:7001	isDeleted:false	Code:EUR	Name:Euro
aValue	BigDecimal  (id=16325)	
100
this	CurrencyGroup  (id=15749)	

		int myScale = aCurrency.getPrecision();
2
		if (aValue.scale() != myScale) {
/ JA
			aValue = aValue.setScale(myScale, RoundingMode.HALF_UP);
		}
		BigDecimal myAmount = amountMap.get(aCurrency);
null
		if (myAmount == null) {
			amountMap.put(aCurrency, aValue);
			if (amountMap.size() == 1) {
				method = TotalAmountCalculationMethod.SINGLE;

/t
RateCalculationVO.runFor(RateAgreementVO, RateCalculationAlternative) line: 1185	
							case ADD:
									myTotal.add(myResult.getCurrency(), RateResultUtils.getBigDecimalValue(myResult, BigDecimal.ZERO));
/d
						anAlternative.addResult(getCurrentEntityType(), getCurrentEntitySystemId(), myCostComp, myResult);

anAlternative	RateCalculationAlternative  (id=15742)	
	rateCalculation	RateCalculationVO  (id=15737)	
rateCalculationVO (RA: NIPPON_FLEET,ICS Fuel Surcharge Master table, orderSystemid:ShipmentOrder: 1234567897(SystemId:26751763; Org:NEEC-NL))
	resultSetList	HashMap  (id=13434)	
{SHIPMENT_ORDER#26751722=[RC_FREIGHT = 100] }={key:AlternativeResultSet}
/ alvast het antwoord: .addResult sets resultSetList	,
/ want	,
/s
RateCalculationAlternative.addResult(EntityType, int, CostComponentSpecificationVO, RateResult) line: 73	
/=
	public void addResult(EntityType aCurrentEntityType, int aCurrentEntitySystemId, CostComponentSpecificationVO aCostComp, RateResult aResult) {


aCurrentEntityType	EntityType  (id=13444)	
SHIPMENT_ORDER

aCurrentEntitySystemId	26751763	
/ system_id van de ShipmentOrderVO

aCostComp	CostComponentSpecificationVO  (id=13452)	
CostComponentSpecification:26746274/RC_FREIGHT/Freight Prices

aResult	RateResult  (id=13469)	
[Unit: theSystemId: 1000072	Symbol :EUR	Description :Euro	UnitType :CURRENCY	IsDeleted :0	; Value: 100]

		String myKey = aCurrentEntityType.name() + "#" + aCurrentEntitySystemId;
SHIPMENT_ORDER#26751763
		AlternativeResultSet myResultSet = resultSetList.get(myKey);
		if (myResultSet == null) {
/ JA
			myResultSet = new AlternativeResultSet(this, aCurrentEntityType, aCurrentEntitySystemId);
			resultSetList.put(myKey, myResultSet);
		}
		myResultSet.addResult(aCostComp, aResult);

/ Dus deze AlternativeResultSet komt in de RateCalculationAlternative.resultSetList	,

/ Intermezzo

/ STRUCTURE ALTERNATIVE

this	RateCalculationVO  (id=13417)	
	activeAlternative	RateCalculationAlternative  (id=13427)	
		rateCalculation	RateCalculationVO  (id=13417)	
		resultSetList	HashMap  (id=13434)	
			size	1	
			table	HashMap$Entry[16]  (id=14156)	
				[5]	HashMap$Entry  (id=14158)	
					key	"SHIPMENT_ORDER#26751763" (id=13534)	
					value	AlternativeResultSet  (id=13577)	
						alternative	RateCalculationAlternative  (id=13427)	 		/ pointer back	,	
						costMap	HashMap  (id=14923)									/ {}
						entitySystemId	26751763	
						entityType	EntityType  (id=13444)	
						priceMap	HashMap  (id=14927)	
							size	1	
							table	HashMap$Entry[16]  (id=14995)	
								[4]	HashMap$Entry  (id=14999)	
									key	CostComponentSpecificationVO  (id=13452)	
									value	ArrayList  (id=15003)	
										elementData	Object[10]  (id=15007)	
											[0]	RateResult  (id=13469)	
												DATE_FORMAT	"yyyy-MM-dd" (id=13509)	
												DATE_TIME_FORMAT	"yyyy-MM-dd HH:mm:ss" (id=13511)	
												costPartList	ArrayList  (id=13512)	
												isManuallyModified	false	
												theFunctionName	"MAX" (id=15011)	
												theResultName	"RP_FREIGHT_MAX" (id=15013)	
												theSubResultList	ArrayList  (id=15015)	
												theUnitVO	Unit  (id=15017)	
												theValue	"100" (id=15019)	
										size	1	
							threshold	12	
							values	null	
						propertyMap	HashMap  (id=14932)								/ {}
						resultMap	HashMap  (id=14934)								/ = priceMap , bij ons	,	

/ Dus	, 

this	RateCalculationVO  (id=13417)	
	activeAlternative	RateCalculationAlternative  (id=13427)	
					value	AlternativeResultSet  (id=13577)	
											[0]	RateResult  (id=13469)	

/ Einde Intermezzo



/ volgende	,
				componentLoop: for (CostComponentSpecificationVO myCostComp : myCostComponentSpecificationList) {
					addToLog("Starting evaluation of component [" + myCostComp.getName() + "]");
					for (RateResult myResult : myCostComp.run(this)) {
/ Is er niet	,
				// Now check if there are subEntities which are not calculated yet.
				if (subEntityComponentMap.size() > calculatedComponents.size()) {
/ NEE
				anAlternative.setSuccess(true);

/t
RateCalculationVO.calculateWithoutVariables() line: 1303	
			for (RateAgreementVO myAgreement : getRateAgreementVO()) {
				runFor(myAgreement, myAlterNative);
/ volgende	,
theSystemId: 26707935Name :ICS Fuel Surcharge Master table
/s
RateCalculationVO.runFor(RateAgreementVO, RateCalculationAlternative) line: 1084	
			for (CostComponentSpecificationVO myCostComponent : aRateAgreementVO.getCostComponentSpecificationList()) {
/ NEE

/t
RateCalculationVO.calculateWithoutVariables() line: 1303	
			for (RateAgreementVO myAgreement : getRateAgreementVO()) {
				runFor(myAgreement, myAlterNative);
/d
/ Doet NIETS	,

/ VERDER MET SHIPMENTORDERCREATE FROM XML

/t
RateCalculationVO.runFor(List<RateAgreementVO>) line: 811	
			Set<Variable> myList = aRateAgreementVO.iterator().next().getVariableList();
			if (myList.size() == 0) {
				calculateWithoutVariables();
/d
			} else {
				try {
					if (serviceOrder != null || shipmentOrder != null || customerOrderLine != null) {
						RateCalculationAlternative firstAlt = alternativeList.iterator().next();
						for (AlternativeResultSet mySet : firstAlt.getResultSetList().values()) {
							switch (mySet.getEntityType()) {
									ShipmentOrderVO myShipmentOrder = MpoBeanFactory.getBean(ShipmentOrderDao.class).getBySystemId(mySet.getEntitySystemId());
/ TODO SPRING
ShipmentOrder: 1234567896(SystemId:26751742; Org:NEEC-NL)
mySet	AlternativeResultSet  (id=15442)	
	entitySystemId	26751742	

									if (agreementType.equals(AgreementType.SHIPMENT_ORDER_PROPERTIES)) {
/ NEE
/ want =SHIPMENT_ORDER
									} else {
										MpoBeanFactory.getBean(ShipmentOrderCalculationService.class).updateShipmentOrder(myShipmentOrder, mySet, myLog);
/ TODO SPRING
/s
ShipmentOrderCalculationServiceImpl.updateShipmentOrder(ShipmentOrderVO, AlternativeResultSet, List<String>) line: 309	

anAlternative	AlternativeResultSet  (id=15442)	
	alternative	RateCalculationAlternative  (id=15406)	
[RC_FREIGHT = 100] 
	entityType	EntityType  (id=15412)	
SHIPMENT_ORDER
	priceMap	HashMap  (id=15449)	
{CostComponentSpecification:26746274/RC_FREIGHT/Freight Prices=[[Unit: theSystemId: 1000072	Symbol :EUR	Description :Euro	UnitType :CURRENCY	IsDeleted :0	; Value: 100]]}
	propertyMap	HashMap  (id=15451)	
{}
	resultMap	HashMap  (id=15453)	
{CostComponentSpecification:26746274/RC_FREIGHT/Freight Prices=[[Unit: theSystemId: 1000072	Symbol :EUR	Description :Euro	UnitType :CURRENCY	IsDeleted :0	; Value: 100]]}

		// Update the shipment order for the non-monetary stuff.
		boolean shipmentOrderChanged = setPropertyResults(anAlternative.getPropertyResults(), shipmentOrder, aLog);
/ anAlternative.getPropertyResults()=
AlternativeResultSet.java
	public Set<Entry<CostComponentSpecificationVO, List<RateResult>>> getPropertyResults() {
		return propertyMap.entrySet();
[]
/s
	/**
	 * Execute the non-cost corrections on a shipment order.
	 * 
ShipmentOrderCalculationServiceImpl.setPropertyResults(Collection<Entry<CostComponentSpecificationVO,List<RateResult>>>, ShipmentOrderVO, List<String>) line: 1122	
		for (Entry<CostComponentSpecificationVO, List<RateResult>> entry : aEntries) {
/ NEE
		return shoUpdated;
false

/t
ShipmentOrderCalculationServiceImpl.updateShipmentOrder(ShipmentOrderVO, AlternativeResultSet, List<String>) line: 318	
		// Update the shipment order for the non-monetary stuff.
		boolean shipmentOrderChanged = setPropertyResults(anAlternative.getPropertyResults(), shipmentOrder, aLog);
false
		// Update the price parts
		try {
			if (updateShipmentOrderPricePartList(anAlternative, shipmentOrder, aLog)) {
/s
ShipmentOrderCalculationServiceImpl.updateShipmentOrderPricePartList(AlternativeResultSet, ShipmentOrderVO, List<String>) line: 686	

		// Generate the current state for price types
		Map<RateComponentKey, RateTypeState> priceTypeState = RateTypeUtils.createPriceTypeState(aShipmentOrder, true);
/s
ShipmentOrderVO.getShipmentOrderPricePartList() line: 1752	
		return createRateTypeState(aShipmentOrder, aShipmentOrder.getShipmentOrderPricePartList(), excludeAllocation);
/s
		return theShipmentOrderPricePartList;
[]
/t
/s
RateTypeUtils.createRateTypeState(LogisticsOrderVO, Collection<LogisticsOrderRatePart>, boolean) line: 95	
		Map<RateComponentKey, RateTypeState> result = new HashMap<RateComponentKey, RateTypeState>();
		try {
			for (LogisticsOrderRatePart part : aSortedSet) {
/ NEE

/t
ShipmentOrderCalculationServiceImpl.updateShipmentOrderPricePartList(AlternativeResultSet, ShipmentOrderVO, List<String>) line: 686	
		Map<RateComponentKey, RateTypeState> priceTypeState = RateTypeUtils.createPriceTypeState(aShipmentOrder, true);
/d
{}
		// Calculate the new values for a price type according to the rate calculation
		Map<RateComponentKey, CostValue> newValues = getCalculatedRateTypeValues(anAlternative.getPriceResults(), aShipmentOrder, aLog);
/s
	public Set<Entry<CostComponentSpecificationVO, List<RateResult>>> getPriceResults() {
		return priceMap.entrySet();

/ = {key:value}={cost comp spec=[RateResult]}


/ Intermezzo

/ In javadocs	,

Set<Map.Entry<K,V>>	entrySet()
Returns a Set view of the mappings contained in this map.

/ Voorbeeld uit stackoverflow	,

public static void printMap(Map mp) {
    Iterator it = mp.entrySet().iterator();
    while (it.hasNext()) {
        Map.Entry pair = (Map.Entry)it.next();
        System.out.println(pair.getKey() + " = " + pair.getValue());
        it.remove(); // avoids a ConcurrentModificationException
    }
}

/ Einde Intermezzo

/s
ShipmentOrderCalculationServiceImpl(AbstractCalculationServiceImpl).getCalculatedRateTypeValues(Collection<Entry<CostComponentSpecificationVO,List<RateResult>>>, LogisticsOrderVO, List<String>) line: 158	

aEntries	HashMap$EntrySet  (id=16049)	
[CostComponentSpecification:26746274/RC_FREIGHT/Freight Prices=[[Unit: theSystemId: 1000072	Symbol :EUR	Description :Euro	UnitType :CURRENCY	IsDeleted :0	; Value: 100]]]
anOrder	ShipmentOrderVO  (id=15427)	

		Map<RateComponentKey, CostValue> newValues = new HashMap<RateComponentKey, CostValue>();

		for (Entry<CostComponentSpecificationVO, List<RateResult>> entry : aEntries) {
			CostComponentSpecificationVO component = entry.getKey();
CostComponentSpecification:26746274/RC_FREIGHT/Freight Prices
			List<RateResult> rateResultList = entry.getValue();
[[Unit: theSystemId: 1000072	Symbol :EUR	Description :Euro	UnitType :CURRENCY	IsDeleted :0	; Value: 100]]

/ Waarom een list van values bij een cost component? 
/ TODO PETER/PAUL 

			for (RateResult rateResult : rateResultList) {
				CorrectionType correctionType = component.getCorrectionType();
ADD
				if (!correctionType.isCostPart()) {
/ NEE
					// not a cost part, skip it
					continue;
/ NIET

				RateComponentType priceType = component.getRateComponentType();
com.mpobjects.oms.model.ratecomponenttype.RateComponentType@3fa61231[systemId=26679739,code=FREIGHT1,description=Freight,group=PRICE,reasonMandatory=false,deleted=false,sequenceNr=1121]
/ Klopt, dit is freight, price

				BigDecimal price = RateResultUtils.getBigDecimalValue(rateResult);
100

				CurrencyVO myCurrencyVO = rateResult.getCurrency();
SystemId:7001	isDeleted:false	Code:EUR	Name:Euro

				RateComponentKey myKey = new RateComponentKey(priceType, myCurrencyVO, RateCalculationUtil.getStatus(component, anOrder));
FREIGHT1-EUR-ESTIMATED
/ want	,
/s
getStatus()=
		switch (aComponent.getCalculationType()) {
			case POSTCALCULATED:
				return RatePartStatus.ESTIMATED;
/t

				CostValue currentValue = newValues.get(myKey);
				if (currentValue == null) {
					currentValue = new CostValue();
					newValues.put(myKey, currentValue);
/ myKey=FREIGHT1-EUR-ESTIMATED
/ currentValue=CostValue{}

				try {
					price = price.setScale(2, RoundingMode.HALF_UP);
					currentValue.append(price, correctionType.name(), rateResult.getCostPartList());
/ appends to currentValue.parts=ArrayList	,
rateResult.getCostPartList()=[]
currentValue=CostValue 100.00 (ADD)

		for (Entry<CostComponentSpecificationVO, List<RateResult>> entry : aEntries) {
/ Dan: volgende 
/ GEEN
			for (RateResult rateResult : rateResultList) {
/ Eerst: volgende 
/ GEEN

		return newValues;
{FREIGHT1-EUR-ESTIMATED=100.00 (ADD)}

/t
ShipmentOrderCalculationServiceImpl.updateShipmentOrderPricePartList(AlternativeResultSet, ShipmentOrderVO, List<String>) line: 696	

		// Calculate the new values for a price type according to the rate calculation
		Map<RateComponentKey, CostValue> newValues = getCalculatedRateTypeValues(anAlternative.getPriceResults(), aShipmentOrder, aLog);
/d
{FREIGHT1-EUR-ESTIMATED=100.00 (ADD)}

		Set<ShipmentOrderPricePartVO> aResultingPriceParts = new HashSet<ShipmentOrderPricePartVO>();

/////////////////////////////
		// Go through the new prices and update the shipment order price parts accordingly
		for (Entry<RateComponentKey, CostValue> entry : newValues.entrySet()) {
/ entry=FREIGHT1-EUR-ESTIMATED=100.00 (ADD)

			RateComponentType priceType = entry.getKey().getRateComponentType();
com.mpobjects.oms.model.ratecomponenttype.RateComponentType@3fa61231[systemId=26679739,code=FREIGHT1,description=Freight,group=PRICE,reasonMandatory=false,deleted=false,sequenceNr=1121]
			CurrencyVO myCurrency = entry.getKey().getCurrency();
SystemId:7001	isDeleted:false	Code:EUR	Name:Euro
			RatePartStatus myStatus = entry.getKey().getStatus();
myStatus	RatePartStatus  (id=16285)	
ESTIMATED

			CostValue costValue = entry.getValue();
100.00 (ADD)
/ TODO PETER/PAUL CostValue?

			RateTypeState<ShipmentOrderPricePartVO> state = priceTypeState.get(entry.getKey());
null
/ want priceTypeState={}

/////////////////////////////
				ShipmentOrderPricePartVO pricePart = new ShipmentOrderPricePartVO();
				pricePart.setStatus(myStatus);
ESTIMATED

				CorrectionType correctionType = CorrectionType.ADD;
				BigDecimal value = costValue.getValue();

				pricePart.setAmount(value);
100.00
				pricePart.setCurrency(myCurrency);
SystemId:7001	isDeleted:false	Code:EUR	Name:Euro
				pricePart.setCorrectionType(correctionType);
ADD
				pricePart.setReason("Calc.: " + costValue.toString());
reason	"Calc.: 100.00 (ADD)" (id=16472)	

				pricePart.setPriceTypeVO(priceType);
priceType	RateComponentType  (id=16188)	
com.mpobjects.oms.model.ratecomponenttype.RateComponentType@3fa61231[systemId=26679739,code=FREIGHT1,description=Freight,group=PRICE,reasonMandatory=false,deleted=false,sequenceNr=1121]

/ Intermezzo

mpo_2015_01=# select*from rate_component_type;
 system_id |         code         |            description             | is_deleted | reason_mandatory | sequence_nr | rct_group 
-----------+----------------------+------------------------------------+------------+------------------+-------------+-----------
...
  26600544 | FREIGHT              | Freight                            |          0 |                0 |           1 | COST
...
  26679739 | FREIGHT1             | Freight                            |          0 |                0 |        1121 | PRICE
... 

/ Einde Intermezzo
				pricePart.setEntryType(EntryType.AUTOMATIC);
				pricePart.setSourceRef(monetaryValuePartService.getSourceReference(anAlternative.getRateCalculation().getRateAgreementVO()));
sourceRef	"RateAgreement:26746250;RateAgreement:26707935" (id=16535)	
				pricePart.getCostPartSet().addAll(costValue.getSourceParts());
[]

/ Intermezzo

costValue	CostValue  (id=15690)	
	parts	ArrayList  (id=15695)	
		elementData	Object[10]  (id=15880)	
			[0]	CostValue$CostValuePart  (id=15883)	
				modifier	CostValue$ValueModifier  (id=15886)	
ADD
				value	BigDecimal  (id=15888)	
		size	1	
	sourceParts	HashSet  (id=15698)	
[]

/ Einde Intermezzo

				pricePart.setSequence(sequence);
0
				sequence = sequence + 10;
10
				pricePart.setShipmentOrderVO(aShipmentOrder);
////////////////////////////
				shipmentOrderPricePartDAO.saveShipmentOrderPricePart(pricePart);
				aShipmentOrder.addShipmentOrderPricePart(pricePart);
/ see (*****)
				aShipmentOrderChanged = true;
				aResultingPriceParts.add(pricePart);

/ (*****)
/s
ShipmentOrderPricePartDAOImpl.saveShipmentOrderPricePart(ShipmentOrderPricePartVO) line: 133	
/s
			aShipmentOrderPricePart = merge(aShipmentOrderPricePart);
/s
		if (anObject.getSystemId() == 0) {
			getHibernateTemplate().persist(anObject);
/t
ShipmentOrderPricePartDAOImpl.saveShipmentOrderPricePart(ShipmentOrderPricePartVO) line: 133	
			aShipmentOrderPricePart = merge(aShipmentOrderPricePart);
/d
			if (ShipmentOrderCostPartUtil.isCostAllocationEnabled()) {
				FactorBaseTypeVO factorBaseType = ShipmentOrderCostPartUtil.getShipmentOrderCostPartService().getFactorBaseTypeVO();
/s
ShipmentOrderCostPartServiceImpl.getFactorBaseTypeVO() line: 131	
		if (factorBaseType == null) {
/ NEE
		return factorBaseType;
factorBaseType	FactorBaseTypeVO  (id=16708)	
SystemId:2	

/ Intermezzo

mpo_2015_01=# select*from factor_base_type;
 system_id |         code          |     description     | is_deleted 
-----------+-----------------------+---------------------+------------
         2 | LDM                   | Loading meters      |          0

/ Einde Intermezzo

/t
ShipmentOrderPricePartDAOImpl.saveShipmentOrderPricePart(ShipmentOrderPricePartVO) line: 137	
				FactorBaseTypeVO factorBaseType = ShipmentOrderCostPartUtil.getShipmentOrderCostPartService().getFactorBaseTypeVO();
SystemId:2	
				myMustRaiseEvent = factorBaseType.isTypePricePart()
false
						&& factorBaseType.getPriceType().equalsIgnoreCase(aShipmentOrderPricePart.getPriceTypeVO().getCode());
/ NEE

		return aShipmentOrderPricePart;
theSystemId: 26751743, Amount :100.00

/t
ShipmentOrderCalculationServiceImpl.updateShipmentOrderPricePartList(AlternativeResultSet, ShipmentOrderVO, List<String>) line: 758	
				shipmentOrderPricePartDAO.saveShipmentOrderPricePart(pricePart);
/d
				aShipmentOrder.addShipmentOrderPricePart(pricePart);
/s
		aShipmentOrderPricePart.setShipmentOrderVO(this);
		theShipmentOrderPricePartList.add(aShipmentOrderPricePart);

				aShipmentOrderChanged = true;
				aResultingPriceParts.add(pricePart);

/t
ShipmentOrderCalculationServiceImpl.updateShipmentOrderPricePartList(AlternativeResultSet, ShipmentOrderVO, List<String>) line: 702	
		// Go through the new prices and update the shipment order price parts accordingly
		for (Entry<RateComponentKey, CostValue> entry : newValues.entrySet()) {
/ GEEN volgende	,

		return aShipmentOrderChanged;

/t
ShipmentOrderCalculationServiceImpl.updateShipmentOrder(ShipmentOrderVO, AlternativeResultSet, List<String>) line: 322	
			if (updateShipmentOrderPricePartList(anAlternative, shipmentOrder, aLog)) {
/d
				shipmentOrder.calculatePrice();
/s
ShipmentOrderVO.calculatePrice() line: 374	
		CurrencyGroup myGroup = RatePartUtil.getTotalByStatusAndPriority(getShipmentOrderPricePartList());
/ getShipmentOrderPricePartList()= [theSystemId: 26751743, Amount :100.00]
/s
	/**
	 * Calculate the total based on the parts grouped by status (PRECALCULATED, ESTIMATED, ACTUAL) and return ACTUAL if
	 * there are actuals, else ESTIMATED, else PRECALCULATED. It always returns a group.
	 * 
RatePartUtil.getTotalByStatusAndPriority(Collection<LogisticsOrderRatePart>) line: 132	
		Map<RatePartStatus, CurrencyGroup> myResult = calculateTotalByStatus(aParts);
/s
		return calculateTotalByStatus(aParts, null);
/s
RatePartUtil.calculateTotalByStatus(Collection<LogisticsOrderRatePart>, Collection<String>) line: 70	

		HashMap<RatePartStatus, CurrencyGroup> myResult = new HashMap<RatePartStatus, CurrencyGroup>();

		for (LogisticsOrderRatePart part : aParts) {
part	ShipmentOrderPricePartVO  (id=16441)	
theSystemId: 26751743, Amount :100.00

			CurrencyGroup myGroup = myResult.get(part.getStatus());
part.getStatus()=ESTIMATED
null
			if (myGroup == null) {
				myGroup = new CurrencyGroup();
				myResult.put(part.getStatus(), myGroup);

			if (part.getCorrectionType().equals(CorrectionType.ADD)) {
				myAmount = part.getAmount();
myAmount	BigDecimal  (id=16452)	
100.00
			myGroup.add(part.getCurrency(), myAmount);

		return myResult;
{ESTIMATED=100.00 EUR}
myResult	HashMap  (id=16881)	
	table	HashMap$Entry[16]  (id=16948)	
		[3]	HashMap$Entry  (id=16960)	
			key	RatePartStatus  (id=16285)	
			value	CurrencyGroup  (id=16911)	
				amountMap	TreeMap  (id=16970)	
{SystemId:7001	isDeleted:false	Code:EUR	Name:Euro=100.00}
/ = {key=value}

/t
RatePartUtil.getTotalByStatusAndPriority(Collection<LogisticsOrderRatePart>) line: 133	
		Map<RatePartStatus, CurrencyGroup> myResult = calculateTotalByStatus(aParts);
/d
{ESTIMATED=100.00 EUR}
		CurrencyGroup myGroup = myResult.get(RatePartStatus.ACTUAL);
		if (myGroup == null) {
/ JA
			myGroup = myResult.get(RatePartStatus.ESTIMATED);
			if (myGroup == null) {
/ NEE

		return myGroup;
/t
ShipmentOrderVO.calculatePrice() line: 374	
		CurrencyGroup myGroup = RatePartUtil.getTotalByStatusAndPriority(getShipmentOrderPricePartList());
/d

/ RATE CALCULATION -> SETS IN SHIPMENT_ORDER: PRICE, ...

		setPrice(myGroup.getAmount());
/s
			price = aPrice;
BigDecimal 100.00
/ want	,

this	ShipmentOrderVO  (id=15427)	
myGroup	CurrencyGroup  (id=16911)	
	amountMap	TreeMap  (id=16970)	
{SystemId:7001	isDeleted:false	Code:EUR	Name:Euro=100.00}
/s
	public BigDecimal getAmount() {
		} else if (amountMap.size() == 1) {
			CurrencyVO myCurrency = amountMap.keySet().iterator().next();
			BigDecimal myAmount = amountMap.get(myCurrency);
			if (myAmount.scale() != myCurrency.getPrecision()) {
				myAmount = myAmount.setScale(myCurrency.getPrecision(), RoundingMode.HALF_UP);
			}
			return myAmount;
/t
		setPriceCurrencyVO(myGroup.getCurrency());
SystemId:7001	isDeleted:false	Code:EUR	Name:Euro
/s
			thePriceCurrencyVO = aCurrencyVO;
/t
		setPriceMethod(myGroup.getMethod());
SINGLE
/s
			priceMethod = aPriceMethod;

/t
ShipmentOrderCalculationServiceImpl.updateShipmentOrder(ShipmentOrderVO, AlternativeResultSet, List<String>) line: 324	
				shipmentOrder.calculatePrice();
/d
				shipmentOrderChanged = true;

		// Update the cost parts
		try {
			if (updateShipmentOrderCostPartList(anAlternative, shipmentOrder, aLog)) {
/ NEE
/ want	,
/s
ShipmentOrderCalculationServiceImpl.updateShipmentOrderCostPartList(AlternativeResultSet, ShipmentOrderVO, List<String>) line: 427	

		// Generate the current state for cost types, this excludes the cost parts which were created based on
		// allocation
		Map<RateComponentKey, RateTypeState> costTypeState = RateTypeUtils.createCostTypeState(aShipmentOrder, true);
{}
		// Calculate the new values for a cost type according to the rate calculation
		Map<RateComponentKey, CostValue> newValues = getCalculatedRateTypeValues(anAlternative.getCostResults(), aShipmentOrder, aLog);
{}
		return aShipmentOrderChanged;
false

/t
        // Update the cost parts
        try {
            if (updateShipmentOrderCostPartList(anAlternative, shipmentOrder, aLog)) {
/d
/ NEE

			try {
				if (anAlternative != null) {
					// TODO: check if this is still ok?
					shipmentOrder.setPriceCurrencyVO(anAlternative.getRateCalculation().getRateAgreementVO().iterator().next().getUnit().getAsCurrency());
/ TODO PETER/PAUL
				shipmentOrder.setRatecalcMd5Hash(RateCalcHashCalculator.calculate(anAlternative.getRateCalculation().getRateAgreementVO(), shipmentOrder));
/s
anAlternative
[RC_FREIGHT = 100] 

anAlternative.getRateCalculation()
/=return alternative.getRateCalculation();
anAlternative	AlternativeResultSet  (id=15442)	
	alternative	RateCalculationAlternative  (id=15406)	
		rateCalculation	RateCalculationVO  (id=15138)	
rateCalculationVO (RA: NIPPON_FLEET,ICS Fuel Surcharge Master table, orderSystemid:ShipmentOrder: 1234567896(SystemId:26751742; Org:NEEC-NL))

anAlternative.getRateCalculation().getRateAgreementVO()
[theSystemId: 26746250Name :NIPPON_FLEET ...  , theSystemId: 26707935Name :ICS Fuel Surcharge Master table]
/ de list van rate agreements	,
/s
RateCalcHashCalculator.calculate(List<RateAgreementVO>, LogisticsOrderVO) line: 29	

		Collection<RateParameterVO> myRateParameterList = getRateParameterList();
[theSystemId: 26746288Name :RP_VOL_WEIGHT
, theSystemId: 26746292Name :RP_PAYWEIGHT
, theSystemId: 26746269Name :RT_NL_MIN_OUTPUT
, theSystemId: 26746264Name :RT_NL_OUTPUT
, theSystemId: 26746273Name :RP_FREIGHT_MAX
, theSystemId: 26746257Name :ZONE_OUTPUT
]
		Collection<InputParameterVO> myInputParameterList;
		for (RateParameterVO myParameter : myRateParameterList) {
/ volgende (eerste)	,

theSystemId: 26746288Name :RP_VOL_WEIGHT
			if (myParameter.getOutputfromFunctionVO() != null) {
				myInputParameterList = myParameter.getOutputfromFunctionVO().getInputParameterList();
[SystemId: 26746369, SystemId: 26746370]

				for (InputParameterVO element : myInputParameterList) {
/ volgende	(eerste),

SystemId: 26746369
					OrderDetail myOrderDetailVO = element.getOrderDetailVO();
SystemId: 4200505, Name :SHIP VOLUME, PathOrClass :./requestedTotalVolumeM3
					if (myOrderDetailVO != null) {
						myRet.add(myOrderDetailVO.retrieveValueFromOrder(myContext));
[0.648]

				for (InputParameterVO element : myInputParameterList) {
/ volgende	,

SystemId: 26746370
					OrderDetail myOrderDetailVO = element.getOrderDetailVO();
null
					if (myOrderDetailVO != null) {
/ NEE

		for (RateParameterVO myParameter : myRateParameterList) {
/ volgende	,
/ myParamater=theSystemId: 26746292Name :RP_PAYWEIGHT

			if (myParameter.getOutputfromFunctionVO() != null) {
				myInputParameterList = myParameter.getOutputfromFunctionVO().getInputParameterList();
[SystemId: 26746367, SystemId: 26746368]
				for (InputParameterVO element : myInputParameterList) {
/ volgende (eerste)	,
SystemId: 26746367
					OrderDetail myOrderDetailVO = element.getOrderDetailVO();
SystemId: 4200504, Name :SHIP WEIGHT, PathOrClass :./requestedTotalWeightKg
					if (myOrderDetailVO != null) {
						myRet.add(myOrderDetailVO.retrieveValueFromOrder(myContext));
[0.648, 88.00]

				for (InputParameterVO element : myInputParameterList) {
/ volgende	,
SystemId: 26746368
					OrderDetail myOrderDetailVO = element.getOrderDetailVO();
null
					if (myOrderDetailVO != null) {
/ NEE

		for (RateParameterVO myParameter : myRateParameterList) {
/ volgende	,
theSystemId: 26746269Name :RT_NL_MIN_OUTPUT
			if (myParameter.getOutputfromFunctionVO() != null) {
				myInputParameterList = myParameter.getOutputfromFunctionVO().getInputParameterList();
[SystemId: 26746267]
				for (InputParameterVO element : myInputParameterList) {
					OrderDetail myOrderDetailVO = element.getOrderDetailVO();
SystemId: 4200506, Name :TO COUNTRY, PathOrClass :./toPartyVO/countryVO/code
					if (myOrderDetailVO != null) {
						myRet.add(myOrderDetailVO.retrieveValueFromOrder(myContext));
[0.648, 88.00, NL]

		for (RateParameterVO myParameter : myRateParameterList) {
/ volgende	,
			if (myParameter.getOutputfromFunctionVO() != null) {
				myInputParameterList = myParameter.getOutputfromFunctionVO().getInputParameterList();
[SystemId: 26746262, SystemId: 26746261]

				for (InputParameterVO element : myInputParameterList) {
/ volgende (eerste)	,
theSystemId: 26746264Name :RT_NL_OUTPUT
					OrderDetail myOrderDetailVO = element.getOrderDetailVO();
null
					if (myOrderDetailVO != null) {
/ NEE

				for (InputParameterVO element : myInputParameterList) {
/ volgende	,
SystemId: 26746261
					OrderDetail myOrderDetailVO = element.getOrderDetailVO();
null
					if (myOrderDetailVO != null) {
/ NEE

		for (RateParameterVO myParameter : myRateParameterList) {
/ volgende	,
theSystemId: 26746273Name :RP_FREIGHT_MAX
			if (myParameter.getOutputfromFunctionVO() != null) {
				myInputParameterList = myParameter.getOutputfromFunctionVO().getInputParameterList();
[SystemId: 26746365, SystemId: 26746366]
				for (InputParameterVO element : myInputParameterList) {
/ volgende (eerste)	,
SystemId: 26746365
					OrderDetail myOrderDetailVO = element.getOrderDetailVO();
null
					if (myOrderDetailVO != null) {
/ NEE

				for (InputParameterVO element : myInputParameterList) {
/ volgende	, 
SystemId: 26746366
					OrderDetail myOrderDetailVO = element.getOrderDetailVO();
null
					if (myOrderDetailVO != null) {
/ NEE

		for (RateParameterVO myParameter : myRateParameterList) {
/ volgende	,
theSystemId: 26746257Name :ZONE_OUTPUT
			if (myParameter.getOutputfromFunctionVO() != null) {
				myInputParameterList = myParameter.getOutputfromFunctionVO().getInputParameterList();
[SystemId: 26746255]
				for (InputParameterVO element : myInputParameterList) {
					OrderDetail myOrderDetailVO = element.getOrderDetailVO();
SystemId: 4200507, Name :TO POSTALCODE, PathOrClass :./toPartyVO/postalCode
					if (myOrderDetailVO != null) {
						myRet.add(myOrderDetailVO.retrieveValueFromOrder(myContext));
[0.648, 88.00, NL, 1118 EA]

		return myRet;

/t
RateCalcHashCalculator.calculate(List<RateAgreementVO>, LogisticsOrderVO) line: 34	
			for (RateAgreementVO myAgreement : aRateAgreement) {
theSystemId: 26746250Name :NIPPON_FLEET
				Collection<Object> myValues = myAgreement.getOrderDetailValues(anOrder);
/d
[0.648, 88.00, NL, 1118 EA]

				myValues.add(myAgreement.getName());
[0.648, 88.00, NL, 1118 EA, NIPPON_FLEET]
				addAllAsStrings(sortedset, myValues);
[0.648, 1118 EA, 88.00, NIPPON_FLEET, NL]

			for (RateAgreementVO myAgreement : aRateAgreement) {
/ volgende	,
theSystemId: 26707935Name :ICS Fuel Surcharge Master table
/ TODO PETER/PAUL
				Collection<Object> myValues = myAgreement.getOrderDetailValues(anOrder);
				if (myValues.isEmpty()) {
					// If there are no order details used, always recalculate.
					myValues.add(System.currentTimeMillis());
				}
				myValues.add(myAgreement.getName());
				addAllAsStrings(sortedset, myValues);
[0.648, 1118 EA, 88.00, ICS Fuel Surcharge Master table, NIPPON_FLEET, NL, Tue Mar 31 13:00:00 CEST 2015]

			String myValuesAsString = StringUtils.implode(sortedset.toArray(), "-");
			return StringUtils.encriptSha(myValuesAsString);
/t
ShipmentOrderCalculationServiceImpl.updateShipmentOrder(ShipmentOrderVO, AlternativeResultSet, List<String>) line: 347	
				shipmentOrder.setRatecalcMd5Hash(RateCalcHashCalculator.calculate(anAlternative.getRateCalculation().getRateAgreementVO(), shipmentOrder));
/s
		ratecalcMd5Hash = aRatecalcMd5Hash;
DF87A366497467F0E6BBD0396FCD03550B1D61C2

/t
ShipmentOrderCalculationServiceImpl.updateShipmentOrder(ShipmentOrderVO, AlternativeResultSet, List<String>) line: 348	
				shipmentOrder.setRatecalcMd5Hash(RateCalcHashCalculator.calculate(anAlternative.getRateCalculation().getRateAgreementVO(), shipmentOrder));
/d
				shipmentOrderService.updateShipmentOrder(shipmentOrder, false);
/s
ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderVO, boolean) line: 1894	
		return updateShipmentOrder(aShipmentOrder, new TMSEventContext(), propagateChange);
/s
ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 1941	
/=
	public ShipmentOrderVO updateShipmentOrder(ShipmentOrderVO aShipmentOrder, TMSEventContext anEventContext, boolean propagateChange) {


/ Herinner	, we zijn nog in 	,
ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderVO, TMSEventContext) line: 926	


			ShipmentOrderVO myOldVO = getOld(aShipmentOrder);
myOldVO
	price null

aShipmentOrder
	price	BigDecimal  (id=16452)	
100.00

			} else {
				myNew = shipmentOrderDao.merge(aShipmentOrder);
/s
GenericHibernateDAO.merge
		if (anObject.getSystemId() == 0) {
/ NEE
		} else {
			anObject = type.cast(getHibernateTemplate().merge(anObject));
/t
ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 1941	
				myNew = shipmentOrderDao.merge(aShipmentOrder);
/d
				myNew.performCustomRecalculation(myOldVO);
/ Doet NIETS	,

				addShipmentOrderParties(myNew);
/s
ShipmentOrderServiceImpl.addShipmentOrderParties(ShipmentOrderVO) line: 269	
			if (aShipmentOrder.getBillToPartyVO() == null) {
/ NEE
				aShipmentOrder.setBillToPartyVO(new VirtualParty());
/ NIET

			if (aShipmentOrder.getEmployeeResponsiblePartyVO() == null) {
/ JA
				aShipmentOrder.setEmployeeResponsiblePartyVO(new VirtualParty());

			List<PartyTypeGroupVO> myPartyGroupsToCreate = new ArrayList<PartyTypeGroupVO>();
			myPartyGroupsToCreate.addAll(MpoBeanFactory.getBean(PartyTypeGroupDAO.class).getShowOnShipmentOrder());
/s
PartyTypeGroupDAOHibernate.getShowOnShipmentOrder() line: 59	

		DetachedCriteria myDetachedCriteria = DetachedCriteria.forClass(PartyTypeGroupVO.class).add(Property.forName("showOnSho").eq(true))
				.add(Property.forName("system").eq(false)).add(Property.forName("deleted").eq(false));
		HibernateTemplate myTemplate = getHibernateTemplate();
		myTemplate.setCacheQueries(true);
		return myTemplate.findByCriteria(myDetachedCriteria);

/ Intermezzo

$ vi PartyTypeGroup.standard.hbm.xml

	<class name="PartyTypeGroupVO" table="PARTY_TYPE_GROUP">
		<property name="showOnSho" column="SHOW_ON_SHO" />
		<set name="partyTypes" table="PARTY_TYPE_IN_GROUP" inverse="false" lazy="false">
			<key column="PARTY_TYPE_GROUP_SYSTEMID" />
			<many-to-many column="PARTY_TYPE_SYSTEMID" class="com.mpobjects.oms.model.entity.partytype.PartyType" />
		</set>

mpo_2015_01=# select*from party_type_group;
 system_id | party_type_group |       description       | is_deleted | show_on_sho | show_on_so | is_system | show_on_co | show_on_col 
-----------+------------------+-------------------------+------------+-------------+------------+-----------+------------+-------------
  26677281 | SERVICE_PROVIDER |                         |          0 |           0 |          0 |         0 |          0 |           0
  26677277 | COLLECTION       | Collection              |          0 |           0 |          0 |         0 |          0 |           0
  26677278 | DELIVERY         | Ship to                 |          0 |           0 |          0 |         0 |          0 |           0
  26677280 | Executed by      | Executed by             |          0 |           0 |          0 |         0 |          0 |           0
  26664945 | PREFERRED_PARTY  |                         |          0 |           0 |          0 |         0 |          0 |           0

  26707076 | Return Depot     | Return Depot            |          0 |           1 |          1 |         0 |          0 |           0
  26747528 | CONSIGNEE        | Final delivery customer |          0 |           1 |          0 |         0 |          0 |           0

  26677279 | BILL_TO          | Bill to                 |          0 |           0 |          0 |         0 |          0 |           0
  26632057 | BILL_TOX         | Bill to party           |          1 |           0 |          0 |         0 |          0 |           0

/ we zien 2 party_type_group's met show_on_so=1	,


/we zien in hibernate.log	,

select ... 
from PARTY_TYPE_GROUP this_ 
where this_.SHOW_ON_SHO=? and this_.IS_SYSTEM=? and this_.IS_DELETED=?
2878097 2015-04-14 15:52:24,053 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (MpoQueueContainer-1:) binding parameter [1] as [BIT] - true
2878099 2015-04-14 15:52:24,054 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (MpoQueueContainer-1:) binding parameter [2] as [BIT] - false
2878101 2015-04-14 15:52:24,054 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (MpoQueueContainer-1:) binding parameter [3] as [BIT] - false

select ... 
from PARTY_TYPE_IN_GROUP partytypes0_ 
inner join PARTY_TYPE partytype1_ on partytypes0_.PARTY_TYPE_SYSTEMID=partytype1_.SYSTEM_ID 
where partytypes0_.PARTY_TYPE_GROUP_SYSTEMID in (?, ?)
2878160 2015-04-14 15:52:24,076 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (MpoQueueContainer-1:) binding parameter [1] as [INTEGER] - 26747528
2878162 2015-04-14 15:52:24,077 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (MpoQueueContainer-1:) binding parameter [2] as [INTEGER] - 26707076

/ Onnodige query , omdat deze set lazy=false is	,
/ TODO HIBERNATE

/ Einde Intermezzo

/t
			myPartyGroupsToCreate.addAll(MpoBeanFactory.getBean(PartyTypeGroupDAO.class).getShowOnShipmentOrder());
/d
[theSystemId: 26707076PartyTypeGroup :Return Depot, theSystemId: 26747528PartyTypeGroup :CONSIGNEE]

			for (ShipmentOrderParty myParty : aShipmentOrder.getShipmentOrderParties()) {
/ NEE	,
/ Klopt: leeg bij ons	,

			for (PartyTypeGroupVO myGroup : myPartyGroupsToCreate) {
				ShipmentOrderParty myShipmentOrderParty = new ShipmentOrderParty();
				myShipmentOrderParty.setPartyTypeGroup(myGroup);
/ 1ste	,
theSystemId: 26707076PartyTypeGroup :Return Depot
/ 2de	,
theSystemId: 26747528PartyTypeGroup :CONSIGNEE
				aShipmentOrder.addShipmentOrderParty(myShipmentOrderParty);

/t
ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 1965	
				addShipmentOrderParties(myNew);
/d
				myNew.recalculate();
/s
ShipmentOrderVO(LogisticsOrderVO).recalculate() line: 798	
			LogisticsOrderTotalsCalculator<? extends LogisticsOrderVO> calc = getLogisticsOrderTotalsCalculator(false);
/s
ShipmentOrderVO.getLogisticsOrderTotalsCalculator(boolean) line: 2661	
		return new ShipmentOrderTotalsCalculator(this, aForcedRecal);

/t
ShipmentOrderVO(LogisticsOrderVO).recalculate() line: 798	
			LogisticsOrderTotalsCalculator<? extends LogisticsOrderVO> calc = getLogisticsOrderTotalsCalculator(false);
/d
			Collection items = getCustomerLogisticsOrderList();
/s
ShipmentOrderVO.getCustomerLogisticsOrderList() line: 2633	
/this is de new ShipmentOrderVO	,

		ArrayList<LogisticsOrderVO> myList = new ArrayList<LogisticsOrderVO>();

		myList.addAll(getShipmentItemList());
/=theShipmentItemList
[]
		myList.addAll(getProductItemList());
/=theProductItemList
[]

		String myVolumeCalc = ApplicationPropertyManager.getInstance().getModuleProperty("oms", "shipmentorder.volumecalc", "gross");
$ vi 2015.01/mpo/mpo.properties
module.oms.shipmentorder.volumecalc=tare

		if (myVolumeCalc.equals("gross")) {
/ NEE
		} else if (myVolumeCalc.equals("gross_strict")) {
/ NEE
		} else if (myVolumeCalc.equals("nett")) {
/ NEE
		return myList;

/t
ShipmentOrderVO(LogisticsOrderVO).recalculate() line: 800	
			Collection items = getCustomerLogisticsOrderList();
/d
			if (items == null || items.isEmpty()) {
				calc.zeroValues();
/s
ShipmentOrderTotalsCalculator(LogisticsOrderTotalsCalculator).zeroValues() line: 289	
		if (calculateRequestedTotalColli) {
/ JA
			requestedTotalColli = BigDecimal.ZERO;
		}
		if (calculateRequestedTotalItems) {
/ JA
			requestedTotalItems = BigDecimal.ZERO;
		}
		if (calculateRequestedTotalWeight) {
/ JA
			requestedTotalWeight = BigDecimal.ZERO;
		}
		if (calculateRequestedTotalVolume) {
/ JA
			requestedTotalVolume = BigDecimal.ZERO;
		}
		if (calculateRequestedTotalLDM) {
/ NEE
			requestedTotalLDM = BigDecimal.ZERO;
null
		}
		if (calculateRequestedTotalValue) {
/ JA
			requestedTotalValue = BigDecimal.ZERO;
		}
		if (calculateRequestedTotalAltValue) {
/ JA
			requestedTotalAltValue = BigDecimal.ZERO;

/t
ShipmentOrderVO(LogisticsOrderVO).recalculate() line: 820	
				calc.zeroValues();
/d
			calc.applyChanges();
/s
ShipmentOrderTotalsCalculator(LogisticsOrderTotalsCalculator).applyChanges() line: 129	
this	ShipmentOrderTotalsCalculator  (id=19047)	
this.entity=ShipmentOrderVO	,
		if (calculateRequestedTotalColli && requestedTotalColli != null) {
			entity.setRequestedTotalColli(requestedTotalColli);
0
		if (calculateRequestedTotalItems && requestedTotalItems != null) {
			entity.setRequestedTotalItems(requestedTotalItems);
0
		if (calculateRequestedTotalWeight && requestedTotalWeight != null) {
			entity.setRequestedTotalWeightKg(requestedTotalWeight);
0
		if (calculateRequestedTotalVolume && requestedTotalVolume != null) {
			entity.setRequestedTotalVolumeM3(requestedTotalVolume);
0
		if (calculateRequestedTotalLDM && requestedTotalLDM != null) {
/ NEE

		if (valueCurrencyVO != null) {
/ NEE

		if (calculateRequestedTotalValue && requestedTotalValue != null) {
			entity.setRequestedTotalValue(requestedTotalValue);
0

		if (altValueCurrencyVO != null) {
/ NEE

		if (calculateRequestedTotalAltValue && requestedTotalAltValue != null) {
			entity.setRequestedAltTotalValue(requestedTotalAltValue);
0
			entity.setAltValueCurrencyVO(myAltValueCurrency);
null
		return true;
/t
ShipmentOrderVO(LogisticsOrderVO).recalculate() line: 821	
			calc.applyChanges();
/d
			theRecalculateFlag = false;
/t

/ LATER AFMAKEN

/ BREAKPOINTS INLEZEN SHIPMENTORDER

/ Lees in	,
[eric@localhost My]$ pwd
/home/eric/Devel/Interfaces/2015.01_mpo/My
$ vi O91T55707.CMP.xml
...

JmsMpoListener.onMessage(Message) line: 45	

MpoShipmentOrderMsgProcessor(AbstractShipmentOrderMsgProcessor).process(Node) line: 256	
					myShipmentOrder = myProcessor.process(myNode);
/ Later 266	,

ShipmentOrderProcessor.process(Node) line: 202	

ShipmentOrderBodyProcessor.processShipmentOrderParty(ShipmentOrderVO, Node) line: 634	

MpoShipmentOrderMsgProcessor.processUpdate(ParsedShipmentOrder) line: 64	
			processOriginal(aParsedShipmentOrder);

ShipmentOrderServiceImpl.createShipmentOrder(ParsedShipmentOrder) line: 871	

ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderVO, TMSEventContext) line: 894	

ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderVO, TMSEventContext) line: 924	
				MpoBeanFactory.getBean(EntityDetailService.class).initialize(myVO);

EntityDetailServiceImpl.initialize(EntityDetailSupport) line: 131	
		List<EntityDetailType> myList = getDAO().getByEntity(anEntityDetailSupport.getEntity());

EntityDetailTypeDAOImpl.getByEntity(EntityType) line: 35	
		List<EntityDetailType> myTypeList = getHibernateTemplate().findByCriteria(
				DetachedCriteria.forClass(EntityDetailType.class).add(Property.forName("entity").eq(anEntity)).add(Property.forName("deleted").eq(false)));

RateCalcEventListener.handleEvent(Event) line: 66	

CalculationServiceImpl.recalculate(LogisticsOrderVO, AgreementType, TMSEventContext) line: 443	

RateCalculationVO.calculateWithoutVariables() line: 1298	

ShipmentOrderCalculationServiceImpl.updateShipmentOrder(ShipmentOrderVO, AlternativeResultSet, List<String>) line: 309	

ShipmentOrderCalculationServiceImpl.setPropertyResults(Collection<Entry<CostComponentSpecificationVO,List<RateResult>>>, ShipmentOrderVO, List<String>) line: 1117	

RateCalcHashCalculator.calculate(List<RateAgreementVO>, LogisticsOrderVO) line: 29	

ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderVO, boolean) line: 1894	

ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 1941	

ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 1958	
				myNew.performCustomRecalculation(myOldVO);

RateCalcEventListener.handleEvent(Event) line: 66	

ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 1941	

ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 1958	
				myNew.performCustomRecalculation(myOldVO);

ShipmentOrderServiceImpl.getPerformanceMonitorManager() line: 2262	

RateCalcEventListener.handleEvent(Event) line: 66	

RateCalculationVO.calculateWithoutVariables() line: 1298	

ShipmentOrderCalculationServiceImpl.applyPropertyResult(ShipmentOrderVO, CostComponentSpecificationVO, RateResult, List<String>) line: 79	

ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderVO, boolean) line: 1894	

ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 1941	

ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 1958	
				myNew.performCustomRecalculation(myOldVO);










ShipmentOrderServiceImpl.createShipmentOrder(ParsedShipmentOrder) line: 871	

ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderVO, TMSEventContext) line: 894	

ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderVO, TMSEventContext) line: 924	
				MpoBeanFactory.getBean(EntityDetailService.class).initialize(myVO);

EntityDetailServiceImpl.initialize(EntityDetailSupport) line: 131	
		List<EntityDetailType> myList = getDAO().getByEntity(anEntityDetailSupport.getEntity());

EntityDetailTypeDAOImpl.getByEntity(EntityType) line: 35	
		List<EntityDetailType> myTypeList = getHibernateTemplate().findByCriteria(
				DetachedCriteria.forClass(EntityDetailType.class).add(Property.forName("entity").eq(anEntity)).add(Property.forName("deleted").eq(false)));
/ ERR (als er een preferred party in XML, en niet in db is)	,

RateCalcEventListener.handleEvent(Event) line: 66	


/ Einde BREAKPOINTS INLEZEN SHIPMENTORDER

/ INLEZEN SHIPMENTORDER DB

/ See LOG_INLEZEN_SO.txt

/ Einde INLEZEN SHIPMENTORDER DB


/ Einde NIP-45 SCS-4759

/ NIP-64

/ 7	.

/ config, finance, service agreement, service agreements (admin)
/ open rate agreement nippon_fleet 

/ Nieuw wachtwoord: Eric123@MPO
/ Niet nodig bij forticlient	, 
/ Wel bij svn in eclipse, ssh mposerv11	, ...

/ 7	.

/ Zorg dat we een forticlient conn hebben	,
/ dan	,
[eric@localhost Backup]$ PGPASSWORD=mpopostgres@mpo pg_dump -U mpopostgres -Fc -h database-a.intermax.mp-objects.com mpo -f mpo_2015.01_v2.dump
/ dan	,
/ create database	,
# create database mpo_2015_01_v2;
/ dan	,
[eric@localhost Backup]$ PGPASSWORD=mpopostgres@mpo pg_restore -U mpopostgres -d mpo_2015_01_v2 mpo_2015.01_v2.dump 

[eric@localhost mpo]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/mpo
[eric@localhost mpo]$ vi deploy/postgres-ds.xml
<datasources>
    <xa-datasource>
		...
        <xa-datasource-property name="DatabaseName">mpo_2015_01_v2</xa-datasource-property>

    <local-tx-datasource>
		...
        <connection-url>jdbc:postgresql://127.0.0.1:5432/mpo_2015_01_v2</connection-url>




/ Einde NIP-64

/ PNL-313

/ we hebben mpo user eric password Eric123@MPO
/ we hebben intermax user vanderveldene password h^Zgcyr&Q

/local/apps/jboss-4.0.5.GA/server/pnloms/conf/language_en_GB_pnlen.properties 

[eric@localhost mpo]$ scp mposerv11:/local/apps/jboss-4.0.5.GA/server/pnloms/conf/language_en_GB_pnlen.properties /tmp
password: Eric123@MPO

[eric@localhost mpo]$ scp /tmp/language_en_GB_pnlen.properties vanderveldene@pnl-app-a.intermax.mp-objects.com:/tmp
vanderveldene@pnl-app-a.intermax.mp-objects.com's password: h^Zgcyr&Q

/ Ga naar,	
Planning, Shipment order, Laadscherm (=Departure item entry)	,

/ op acceptance is NIET OK	,
<span wicketpath="query_header_3_link_label">[Warning: Property for 'shipmentorder.reference3' not found]</span>
<span wicketpath="query_header_4_link_label">[Warning: Property for 'shipmentorder.from.party.name' not found]</span>
<span wicketpath="query_header_5_link_label">[Warning: Property for 'shipmentorder.to.party.name' not found]</span>
<span wicketpath="query_header_6_link_label">[Warning: Property for 'shipmentorder.to.party.postalcode' not found]</span>
<span wicketpath="query_header_7_link_label">[Warning: Property for 'shipmentorder.to.party.city' not found]</span>
<span wicketpath="query_header_8_link_label">[Warning: Property for 'shipmentorder.to.party.country' not found]</span>
<span wicketpath="query_header_9_link_label">[Warning: Property for 'shipmentorder.reference6' not found]</span>
<span wicketpath="query_header_10_link_label">[Warning: Property for 'shipmentorder.shipmentType' not found]</span>
...



/ we zien op acceptance NIET	,

/ 7	. 

/ we log op acceptance	,

$ vi jboss-4.0.5.GA\server\pnloms\conf\log4j.xml

 <category name="com.mpobjects.util.multilang.LanguageManager">
    <priority value="DEBUG" />
  </category>

/ Kijk 	,
https://system.mp-objects.com/fisheye/viewrep/SCS/patches/2013.04.01/terex/terex/terex/src/java/com/mpobjects/terex/model/eventhandler/util/TerexEventListener.java?r1&r2=17782

                if (LOG.isDebugEnabled()) {
/ true als <priority value="DEBUG">
/ Deze test doe je omdat als priority="INFO", hij niet LOG.debug zal doen, maar wel myOldServiceOrder.getDateSetVO() zal exec, en dit laatste wil je vermijden	,
 	 	 	 	49	                        if (myOldServiceOrder == null) {
 	 	 	 	50	                                LOG.debug("Old Service Order : null");
 	 	 	 	51	                        } else {
 	 	 	 	52	                                LOG.debug("Old ServiceOrder DateSet: " + myOldServiceOrder.getDateSetVO());
 	 	 	 	53	                                LOG.debug("Old ServiceOrder ExecutedByParty: " + myOldServiceOrder.getExecutedByPartyVO());
 	 	 	 	54	                                LOG.debug("Old ServiceOrder Organization: " + myOldServiceOrder.getOrganizationVO());
 	 	 	 	55	                                LOG.debug("Old ServiceOrder Reference4: " + myOldServiceOrder.getReference4());
 	 	 	 	56	                                LOG.debug("Old ServiceOrder ServiceOrderType: " + myOldServiceOrder.getServiceOrderType());
 	 	 	 	57	                                LOG.debug("Old ServiceOrder ServiceType: " + myOldServiceOrder.getServiceType());
 	 	 	 	58	                                LOG.debug("Old ServiceOrder StatusCode: " + myOldServiceOrder.getOrderStatusCode());
 	 	 	 	59	                                LOG.debug("Old ServiceOrder TotalCost: " + myOldServiceOrder.getTotalCost());
 	 	 	 	60	                        }
 	 	 	 	61	                        if (myNewServiceOrder == null) {
 	 	 	 	62	                                LOG.debug("New Service Order : null");
 	 	 	 	63	                        } else {
 	 	 	 	64	                                LOG.debug("New ServiceOrder DateSet: " + myNewServiceOrder.getDateSetVO());
 	 	 	 	65	                                LOG.debug("New ServiceOrder ExecutedByParty: " + myNewServiceOrder.getExecutedByPartyVO());
 	 	 	 	66	                                LOG.debug("New ServiceOrder Organization: " + myNewServiceOrder.getOrganizationVO());
 	 	 	 	67	                                LOG.debug("New ServiceOrder Reference4: " + myNewServiceOrder.getReference4());
 	 	 	 	68	                                LOG.debug("New ServiceOrder ServiceOrderType: " + myNewServiceOrder.getServiceOrderType());
 	 	 	 	69	                                LOG.debug("New ServiceOrder ServiceType: " + myNewServiceOrder.getServiceType());
 	 	 	 	70	                                LOG.debug("New ServiceOrder StatusCode: " + myNewServiceOrder.getOrderStatusCode());
 	 	 	 	71	                                LOG.debug("New ServiceOrder TotalCost: " + myNewServiceOrder.getTotalCost());
 	 	 	 	72	                        }
 	 	 	 	73	                }
 	 	 	 	74	

/ Einde Intermezzo

/ 7	. 

[eric@localhost pnloms]$ scp mposerv11:/local/apps/jboss-4.0.5.GA/server/pnloms/conf/language_en_GB_pnlen.properties .
[eric@localhost pnloms]$ scp vanderveldene@pnl-app-a.intermax.mp-objects.com:/local/apps/jboss-4.0.5.GA/server/pnloms/conf/language_en_GB_pnlen.properties .


/ 7	.

[vanderveldene@pnl-app-a deploy]$ pwd
/local/apps/jboss-4.0.5.GA/server/pnloms/deploy
$ vi postgres-ds.xml 
               <xa-datasource-property name="DatabaseName">pnloms</xa-datasource-property>
                <xa-datasource-property name="User">pnloms</xa-datasource-property>
                <xa-datasource-property name="Password">yJAmkt_RxiglNPPnNuXUAnuJg-JRypaB</xa-datasource-property>

[vanderveldene@pnl-app-a deploy]$ psql -U pnloms  -h localhost
Password for user pnloms: yJAmkt_RxiglNPPnNuXUAnuJg-JRypaB
> select*from tms_user
vervoordeldonks
Post@2603

/ we zien in appl dat zijn locale OK	,
en_GB_pnlen

/ 7		.

/ Op test	,

/ planning, shipment order, laadscherm
/ dat is	,
	DepartureItemEntryListPage

$ vi DepartureItemEntryListPage.java

		QueryColumn<String> myShipmentOrderId = new QueryColumn<String>("shipmentorder.shipmentorderid", "s.shipmentOrderId");
		QueryColumn<String> myReference3 = new QueryColumn<String>("shipmentorder.reference3", "s.reference3");
		QueryColumn<String> myFromPartyName = new QueryColumn<String>("shipmentorder.from.party.name", "s.fromPartyVO.name");
		QueryColumn<String> myToPartyName = new QueryColumn<String>("shipmentorder.to.party.name", "s.toPartyVO.name");

/ local	,
$ vi language_en.properties
#shipmentorder.to.party.name=Los Naam 
$ vi language_en_GB_pnlen.properties
/ Geen shipmentorder.to.party.name

/ doe system, reload config	,
/ we zien op	,
/ planning, shipment order, laadscherm
Warning: property for shipmentorder.to.party.name not found	,

/ 7	.

[eric@localhost Wicket]$ pwd
/home/eric/Devel/Java/Wicket
[eric@localhost Wicket]$ tar -xvzf ~/Downloads/apache-wicket-1.4.23-source.tgz 

/ 7	.

/ eric heeft local en_GB_pnlen

$ vi language_en.properties
$ vi language_en_GB_pnlen.properties

/ als we property niet in en_GB_pnlen, maar wel in en	, dan toch ERR	,
Warning: Property for 'shipmentorder.reference3' not found

/ 7	.

/ UPDATE LOCALE, RELOAD CONFIG  

/ we zien veranderingen	,

$ QueryViewPanel.java
...

$ vi LanguageManager.java

	public static void resetLanguageCache() {
		clearWicketCache();
		propertiesFiles.clear();
->		new LanguageManager().getPropertiesFile(DEFAULT_LOCALE);
	}
/ -> is new	,

	protected Properties getPropertiesFile(Locale aLocale) {
		Map<Locale, Properties> myPropertiesFiles = getPropertiesFiles();
		Properties myRet;
		if (myPropertiesFiles.containsKey(aLocale)) {
			myRet = myPropertiesFiles.get(aLocale);
		} else {
			File myFile = getPropertiesFilename(aLocale);
			if (myFile.isFile()) {
				if (propertiesFiles.containsKey(DEFAULT_LOCALE)) {
					myRet = PropertiesUtil.loadProperties(myFile);

/ WAS
					Properties myDefaultProperties = new Properties(propertiesFiles.get(DEFAULT_LOCALE));
/ IS
					Properties myDefaultProperties = new Properties();
					myDefaultProperties.putAll(propertiesFiles.get(DEFAULT_LOCALE));

					PropertiesUtil.merge(myDefaultProperties, myRet);
					myRet = myDefaultProperties;
				} else {
					myRet = PropertiesUtil.loadProperties(myFile);
				}
			} else {
				LOG.warn("Language file" + myFile.getAbsolutePath()
						+ " does not exists, returning empty properties list. You must perform a config-reload to force a new check");
				myRet = new Properties();
			}

			getPropertiesFiles().put(aLocale, myRet);
		}

		return myRet;
	}

///////////////////////////////////////
/ Deze 	,
					PropertiesUtil.merge(myDefaultProperties, myRet);
/ kunnen we ook vervangen door	, 
	myDefaultProperties.putAll(myRet);

/ Intermezzo

/ In WAS	,

					myRet = PropertiesUtil.loadProperties(myFile);
/ nl
					Properties myDefaultProperties = new Properties(propertiesFiles.get(DEFAULT_LOCALE));
{{},default=en}
					PropertiesUtil.merge(myDefaultProperties, myRet);
/ {nl, default=en}
					myRet = myDefaultProperties;
/ we zien	,

myDefaultProperties	Properties  (id=13384)	
	count	764	
	entrySet
	defaults	NaturalSortedProperties  (id=13070)	
		count	2172	
		entrySet

$ vi LanguageManager.java

	private String get(String aFullCode, Map<String, String> aFieldMap, boolean aThrowExceptionIfNotFound) throws IndexOutOfBoundsException {
		if (getPropertiesFile().containsKey(myProductSpecificCode)) {
///////////
/ Probleem: .containsKey kijkt NIET naar defaults	, en daar zitten de engelse codes in	,

/ In language_nl file is NIET configuration	, in language_en file is configuration	,
/ In language_nl file is shipfrom, in language_en file is shipfrom 	,
/ Doe in Display	,
getPropertiesFile().containsKey("shipfrom")
true
getPropertiesFile().containsKey("configuration")
false
/ dus de key in de language_en file wordt NIET gezien	,

//////////////////////////////////////////////

/ SAMENVATTING PROPERTIES HASHTABLE

/ .contains=.containsValue en .containsKey zijn Hashtable-functies	, .getProperty is een Properties fct	, 
/ .contains kijkt in de hashtable, dus getPropertiesFile().containsKey("configuration") kijkt in de nl properties hash table, en daar zit de key configuration niet in 	, 
/ .getProperty is een Properties fct, en die kijkt in beide hashtables	,
$ vi Properties.java
   public String getProperty(String key) {
        Object oval = super.get(key);
        String sval = (oval instanceof String) ? (String)oval : null;
        return ((sval == null) && (defaults != null)) ? defaults.getProperty(key) : sval;


/ Einde Intermezzo



/ Einde PNL-313

/ SVN

[eric@localhost mpo]$ svn log --limit 10 https://system.mp-objects.com/svn/tms
...
r19317 | eric | 2015-04-17 15:42:32 +0200 (Fri, 17 Apr 2015) | 3 lines

Catch case in log message that an shipment order can be null.
Issue: NIP-64

[eric@localhost mpo]$  svn log --verbose -r 19317  https://system.mp-objects.com/svn/tms
------------------------------------------------------------------------
r19317 | eric | 2015-04-17 15:42:32 +0200 (Fri, 17 Apr 2015) | 3 lines
Changed paths:
   M /branches/2015.01/module/ratecalc/src/java/com/mpobjects/oms/ratecalc/model/ratecalculation/vo/RateCalculationVO.java

Catch case in log message that an shipment order can be null.
Issue: NIP-64



/ Einde SVN


/ DEBUG PNL-313

/ Kies planning, shipment order, departure item entry	,

/ we komen in 	,
DepartureItemEntryListPage.createPageComponents() line: 132	

		QueryColumn<String> myShipmentOrderId = new QueryColumn<String>("shipmentorder.shipmentorderid", "s.shipmentOrderId");
		myQuery.getColumns().add(myShipmentOrderId);
...
		add(new QueryViewPanel("query", Model.of(myQuery), myRowActions, null));
/s
QueryViewPanel.<init>(String, IModel<QueryDefinition>, List<RowAction>, List<GroupAction>, Set<Serializable>) line: 85	

<wicket:panel>
	<div class="query-list">
		<div class="data-panel">
			<table class="grid">
				<tr class="headers">
					<th wicket:id="header"></th>
				</tr>
				<tr wicket:id="rows">
					<td wicket:id="cell"><span wicket:id="cellvalue"></span></td>
				</tr>
			</table>
		</div>

		queryDefinition = aModel.getObject();
/ aModel = Model.of(myQuery)	,
queryDefinition	QueryDefinition  (id=14099)	
	columns	ArrayList  (id=14175)	
[com.mpobjects.oms.view.wicket.entityview.column.IdQueryColumn@53839321, com.mpobjects.oms.view.wicket.entityview.QueryColumn@6330865c, com.mpobjects.oms.view.wicket.entityview.QueryColumn@6c534e4, com.mpobjects.oms.view.wicket.entityview.QueryColumn@9225340, com.mpobjects.oms.view.wicket.entityview.QueryColumn@7d136834, com.mpobjects.oms.view.wicket.entityview.QueryColumn@51e6e13, com.mpobjects.oms.view.wicket.entityview.QueryColumn@10cca405, com.mpobjects.oms.view.wicket.entityview.QueryColumn@6b244ce0, com.mpobjects.oms.view.wicket.entityview.QueryColumn@1c333d14, com.mpobjects.oms.view.wicket.entityview.QueryColumn@67eefa82, com.mpobjects.oms.view.wicket.entityview.QueryColumn@7a80a21c, com.mpobjects.oms.view.wicket.entityview.column.DateTimeQueryColumn@13131b19, com.mpobjects.oms.view.wicket.entityview.column.DateTimeQueryColumn@4b581017, com.mpobjects.oms.view.wicket.entityview.column.DateTimeQueryColumn@2887ca6, com.mpobjects.oms.view.wicket.entityview.column.DateTimeQueryColumn@4eaf7796, com.mpobjects.oms.view.wicket.entityview.column.NumberQueryColumn@61d44135, com.mpobjects.oms.view.wicket.entityview.QueryColumn@360530c0, com.mpobjects.oms.view.wicket.entityview.QueryColumn@ec3a8f5, com.mpobjects.oms.view.wicket.entityview.column.DateTimeQueryColumn@4f897465, com.mpobjects.oms.view.wicket.entityview.column.DateTimeQueryColumn@4938bbae]

		createComponents();
/s
QueryViewPanel.createComponents() line: 303	
/t
		addHeaderRow();
/s
QueryViewPanel.addHeaderRow() line: 222	

		RepeatingView myHeader = new RepeatingView("header");
		for (QueryColumn<Object> myColumn : queryDefinition.getColumns()) {
			if (!myColumn.isHidden()) {
				if (myColumn.isId()) {
/ JA, 1ste	,
					if (groupActionList.size() > 0) {
/ NEE
					} else {
						myHeader.add(new Label(myHeader.newChildId(), ""));

		for (QueryColumn<Object> myColumn : queryDefinition.getColumns()) {
			if (!myColumn.isHidden()) {
				if (myColumn.isId()) {
/ NEE, 2de	,
				} else if (myColumn.isSort()) {
					myHeader.add(new SortableColumnHeader(myHeader.newChildId(), myColumn, QueryViewPanel.this));

/ continue	,

Localizer.getStringIgnoreSettings(String, Component, IModel<?>, String) line: 241	
/=
	public String loadStringResource(Component aComponent, String aKey) {

aComponent	FilterBarPanel  (id=14627)	
aKey	"shipmentorder.shipmentorderid" (id=14110)	

			if (aComponent != null) {
				return getLanguageManager().getTranslation(aKey, aComponent.getLocale(), aComponent.getStyle(), true);
aKey	"shipmentorder.shipmentorderid" (id=14110)	
aComponent.getLocale()="en_US"
aComponent.getStyle()="en"
/s
LanguageManagerStringResourceLoader.getLanguageManager() line: 69	
		return languageManager;
com.mpobjects.util.multilang.WicketLanguageManager@6eb508bf
/t
/s
WicketLanguageManager.getTranslation(String, Locale, String, boolean) line: 18	
		return get(aKey, aLocale, aStyle, aThrowExceptionIfNotFound);
/s
WicketLanguageManager.get(String, Locale, String, boolean) line: 23	
/=
	private String get(String aFullCode, Locale aLocale, String aStyle, boolean aThrowExceptionIfNotFound) throws IndexOutOfBoundsException {
		String myFullCode = aFullCode.toLowerCase();
myFullCode	"shipmentorder.shipmentorderid" (id=14110)	

		Properties props = getPropertiesFile(aLocale);
/s
WicketLanguageManager(LanguageManager).getPropertiesFile(Locale) line: 473	
/=
	protected Properties getPropertiesFile(Locale aLocale) {
aLocale=en_US

		if (myPropertiesFiles.containsKey(aLocale)) {
/ NEE
		} else {
			File myFile = getPropertiesFilename(getLocale());
/ JA	, is er	,
getLocale()=en
/////////////////////////
/ TODO
/ language_en.properties

				if (propertiesFiles.containsKey(DEFAULT_LOCALE)) {
DEFAULT_LOCALE=en
					myRet = PropertiesUtil.loadProperties(myFile);
					Properties myDefaultProperties = new Properties(propertiesFiles.get(DEFAULT_LOCALE));
					PropertiesUtil.merge(myDefaultProperties, myRet);
					myRet = myDefaultProperties;

/t
WicketLanguageManager.get(String, Locale, String, boolean) line: 27	
		Properties props = getPropertiesFile(aLocale);
		if (props.containsKey(myFullCode)) {
			return getPropertiesFile(aLocale).getProperty(myFullCode);
"Shipment Order ID"







/ Einde DEBUG PNL-313

/ DEBUG PNL-313 GENERIC WICKET SCREENS 

/ 7	. 

/ we nemen eerst een ander scherm, 
/ Ga naar configuratie, master data, entity detail value set

/ we hadden eerst	,
/ Kies planning, shipment order, departure item entry	,

/ eric heeft locale nl	,

/ Ga naar configuratie, master data, entity detail value set
/ TODO (entity detail value set)
/ we zien in de header: Warning: Property for 'filter' not found

$ vi EntityDetailValueSetTypeListPage.java
...

$ vi EntityDetailValueSetType.standard.hbm.xml

 <class name="com.mpobjects.oms.model.entitydetailvalueset.EntityDetailValueSetType" table="EDVSET_TYPE">

pnloms=# select*from edvset_type;
 system_id | code | description | is_deleted 
-----------+------+-------------+------------
(0 rows)


/ 	7. 

/ Deze geven: property filter not found	, 
/ en de andere fields vertaalt hij letterlijk	,

/ Ga naar configuratie, master data, entity detail value set
EntityDetailValueSetTypeListPage

/ configuration, master data, officeof exit
OfficeOfExitPage

/ configuration, master data, address violation excl
AddressViolationExclusionPage

/ Deze werken OK	,

/ configuratie, master data, schedules 
calendar.ScheduleListPage

/ configuratie, master data, messages
messagereport.MessagePage

/ configuratie, master data, Verv. cond
IncoTermPage 

/ configuratie, master data, service levels
ShipmentServiceLevelPage

/ 7	. 

/ Herhaal schedules	,

/ header	,
header, label

/ row	,
/ links	,
entity-actions : panel met 3 buttons	,			/ in GenericListPanel$ActionPanel.html
	actions: panel met 1 button	,
/ ernaast
cells, cell

ScheduleSearchListPanel(GenericListPanel).initialize() line: 236	
$ vi GenericListPanel.html
	<form class="genericListPanelForm" wicket:id="filterForm" name="genericListPanelForm" id="genericListPanelForm">
/ Dit is het hele form	, 

		IModel<String> filterColTitle = new IModel<String>() {
			protected IModel<String> filterOn = new ResourceModel("filter", "filter").wrapOnAssignment(GenericListPanel.this);

/ Hierdoor staat er WH "filter" op de header als de property niet wordt gevonden in de language file	,
/ TODO ERICJ 

/ linker column	,
		myColumnsList.add(new FilteredAbstractColumn(filterColTitle) {
			@Override
			public Component getFilter(final String componentId, final FilterForm form) {
				ResetableGoAndClearFilter resetableGoAndClearFilter = new ResetableGoAndClearFilter(componentId, form, dataProvider, GenericListPanel.this);
				return resetableGoAndClearFilter;
			}
			@Override
			public void populateItem(final Item cellItem, final String componentId, final IModel model) {
				Collection<Component> myList = new ArrayList<Component>();
				if (entityGroupActions != null && entityGroupActions.size() > 0) {
					myList.add(new GenericListPanel.CheckPanel(componentId + "-check", new Check("checkbox", model, group)));
				}
				myList.add(GenericListPanel.this.createNewListPanel(componentId + "-actions", model));
				Panel myActionPanel = new GenericListPanel.ActionPanel(componentId, myList);
				cellItem.add(myActionPanel);
				extraItemActions(cellItem);
			}
		});

/ de overige 3 columns	,
		addFilterColumns(myColumnsList);
/s
ScheduleSearchListPanel.addFilterColumns(List<IColumn>) line: 74	
	protected void addFilterColumns(@SuppressWarnings("rawtypes") List<IColumn> columnList) {
		columnList.add(new ConfigurableTextFilteredPropertyColumn<String>(getModel(NAME), NAME, NAME,
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<String>(30)));
		columnList.add(new ConfigurableTextFilteredPropertyColumn<String>(getModel("organization"), "organization.code", "organization.code",
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<String>(10)));
		columnList.add(new ConfigurableTextFilteredPropertyColumn<String>(getModel("description"), "description", "description",
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<String>(30)));
/s
ScheduleSearchListPanel.getModel(String) line: 93	
		return new StringResourceModel(aString, this, getDefaultModel());


		makeTable(myColumnsList);
/s
ScheduleSearchListPanel(GenericListPanel).makeTable(List<IColumn>) line: 445	
		objectDataTable = getDefaultDataTable(aColumnsList);
/s
ScheduleSearchListPanel(GenericListPanel).getDefaultDataTable(List<IColumn>) line: 411	
		return new DefaultDataTable("objectTable", aColumnsList, dataProvider, getListLength());

/ Dit is een wicket type	, met html , dus we maken geen html met columns, deze is er al	,

/ 13	. 

/ DefaultDataTable is een wicket type, heeft ook de html	,

[eric@localhost wicket]$ pwd
/home/eric/Devel/Java/Wicket/wicket
[eric@localhost wicket]$ vi ./wicket-extensions/src/main/java/org/apache/wicket/extensions/markup/html/repeater/data/table/DataTable.html
...

/ 7	.

/ Ga naar configuratie, master data, entity detail value set
EntityDetailValueSetTypeListPage

EntityDetailValueSetTypeListPage.<init>() line: 29	
		super("entitydetailvalueset", new BeanWrapper(EntityDetailValueSetTypeDAO.class));
/s
EntityDetailValueSetTypeListPage(EvoParentListPage).<init>(String, BeanWrapper<BaseDAOInterface<T>>) line: 108	

		ArrayList myColumns = new ArrayList();
		myColumns.add(new FilteredAbstractColumn(new ResourceModel("filter")) {
			@Override
			public Component getFilter(final String aComponentId, final FilterForm aForm) {
				return new MpoGoAndClearFilter(aComponentId, aForm, getDataProvider());
			}

			@Override
			public void populateItem(final Item aCellItem, final String aComponentId, final IModel aModel) {
				aCellItem.add(new ActionsPanel(aComponentId, aModel) {
					@Override
					protected BasePage getChildPage(IModel aModel) {
						return EvoParentListPage.this.getChildPage(aModel);
					}
				});
			}
		});
		myColumns.addAll(1, processColumns());

/ Intermezzo

/ Doe	,


		myColumns.add(new FilteredAbstractColumn(new ResourceModel("filter","filter")) {

/ Dan zien we ook "filter" op de header als er in de language file geen property is	,

/ TODO ERICJ

/ Einde Intermezzo
/s
EntityDetailValueSetTypeListPage(AbstractObjectListPage).processColumns() line: 160	
		String myColumnDefinition = getColumnDefinition();
/s
			return "code,description";
		ArrayList myColumns = new ArrayList();
		String[] myHeaders = myColumnDefinition.split(",");
		HashMap<String, AbstractColumn> myAvailableColumns = getAllColumns();
/s
EntityDetailValueSetTypeListPage(EvoParentListPage).getAllColumns() line: 124	
		HashMap myColumns = new HashMap();

/ prefix is een String, "entitydetailvalueset."	,
		myColumns.put("code", new ExtendedConfigurableTextFilteredPropertyColumn(prefix, "code", true,
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder(DEFAULT_COLUMN_SIZE)));
		myColumns.put("description", new ExtendedConfigurableTextFilteredPropertyColumn(prefix, "description", true,
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder(DEFAULT_COLUMN_SIZE)));
		return myColumns;

/ bij schedules 
		columnList.add(new ConfigurableTextFilteredPropertyColumn<String>(getModel("organization"), "organization.code", "organization.code", ...)

/ bij details value types	, 
        myColumns.put("code", new ExtendedConfigurableTextFilteredPropertyColumn(prefix, "code", true,
/s
	public ExtendedConfigurableTextFilteredPropertyColumn(String aPrefix, String aPropertyExpression, boolean aSortable, FilterComponentBuilder aComponentBuilder) {
		super(null, aSortable ? aPropertyExpression : null, aPropertyExpression, aComponentBuilder);

/ Dus de model is null	,

/t
		HashMap<String, AbstractColumn> myAvailableColumns = getAllColumns();
/d
		for (String myHeader : myHeaders) {
			AbstractColumn myColumn = myAvailableColumns.get(myHeader.trim());

			if (myColumn != null) {
				myColumns.add(myColumn);
			} else {
				getLog().warn("No column defined for [" + myHeader.trim() + "]");
			}
		}
		return myColumns;


/ Einde DEBUG PNL-313 GENERIC WICKET SCREENS 

/ RELOAD CONFIG 

/ click op support, System, reload config	,
/ open in new tab	, 
http://localhost:8080/tms/core/config-reload?emptySession=true

/ web.xml wordt gen	, we vinden in trunk/ geen web.xml
/ TODO  

[eric@localhost pnloms]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms
[eric@localhost pnloms]$ vi deploy/tms.war/WEB-INF/web.xml

<filter-mapping>
    <filter-name>Config reload</filter-name>
    <url-pattern>/core/config-reload</url-pattern>
</filter-mapping>

<filter>
    <filter-name>Config reload</filter-name>
    <filter-class>com.mpobjects.control.filter.ConfigReloadFilter</filter-class>
</filter>

/ 7	. 

/ Debug	,

ConfigReloadFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 47	
		ApplicationPropertyManager myPropertyManager = ApplicationPropertyManager.getInstance();
		// TODO this is already done in the JarService?
		myPropertyManager.reconfigure();
/s
ApplicationPropertyManager.reconfigure() line: 599	
		init();
/s
ApplicationPropertyManager.init() line: 672	
		loadProperties();
/s
ApplicationPropertyManager.loadProperties() line: 738	
		File myFile = new File(CONF_DIRECTORY, APPLICATION_PROPERTIES_FILE);
/ CONF_DIRECTORY=/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms/conf
/ APPLICATION_PROPERTIES_FILE=application.properties

		if (myFile.exists()) {
			theProperties = PropertiesUtil.loadProperties(myFile);
/s
PropertiesUtil.loadProperties(File) line: 38	
/=
	public static NaturalSortedProperties loadProperties(File aFileLocation) {
			fis = new FileInputStream(aFileLocation);
			bis = new BufferedInputStream(fis);
			myProperties = new NaturalSortedProperties();
			myProperties.load(new InputStreamReader(bis, "UTF-8"));
/t
ApplicationPropertyManager.loadProperties() line: 753	
			theProperties = PropertiesUtil.loadProperties(myFile);
/d
this	ApplicationPropertyManager  (id=13502)	
	theApplicationPropertyManager	ApplicationPropertyManager  (id=13502)	
	applicationServerType	ApplicationServerType$2  (id=13557)	
	dbProperties	Properties  (id=13558)	
	listeners	Collections$SetFromMap  (id=13559)	
	performanceMonitorService	PerformanceMonitorServiceImpl  (id=13560)	
	theEnvironmentProperties	Properties  (id=13561)	
	theProperties	NaturalSortedProperties  (id=13552)	
/ application.properties

		loadFixedProperties(PROPERTIES_FOLDER);
/ PROPERTIES_FOLDER=/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms/properties/
/s
ApplicationPropertyManager.loadFixedProperties(String) line: 702	
		String[] myList = new File(aDirectory).list(new FixedPropertiesFilenameFilter());
		if (myList == null) {
			myList = new String[0];

/ Intermezzo

/ 13	. 

new File("/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms").list()
[tmp, deploy, language_en_GB_pnlen.properties, conf, work, lib, data, language_en_GB_pnlen.properties.bak, log]
/ 'n String[]	,

$ vi FixedPropertiesFilenameFilter.java
public class FixedPropertiesFilenameFilter implements FilenameFilter {
	@Override
	public boolean accept(File aDir, String aName) {
		return aName.endsWith(".properties") && aName.startsWith("fixed.");
	}

/ een filenamefilter restricts de filenames die worden gegeven door File.list()	, 

/ Einde Intermezzo

/t
ApplicationPropertyManager.loadProperties() line: 754	
		loadFixedProperties(PROPERTIES_FOLDER);
/d
		loadLocalProperties(CONF_DIRECTORY);
CONF_DIRECTORY=/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms/conf
/s
ApplicationPropertyManager.loadLocalProperties(String) line: 717	
		String[] myList = new File(aDirectory).list(new FilenameFilter() {
			@Override
			public boolean accept(File aDirectory, String aFileName) {
				return aFileName.startsWith("local_") && aFileName.endsWith(".properties");
			}

		});
/ myList=local_application.properties]

		for (String myFileName : myList) {
myFileName	"local_application.properties" (id=13705)	
			File myFile = new File(aDirectory, myFileName);
			if (myFile.exists()) {
				Properties myProperties = PropertiesUtil.loadProperties(myFile);
{user.event.alert=off, module.omscarcon.carconfetcher.delay=999999999999, module.interfacing.jms.listener.autostartup=false}
				PropertiesUtil.merge(theProperties, myProperties);
/ theProperties hadden we zojuist loaded	, = application.properties	,

/t
ApplicationPropertyManager.init() line: 674	
		loadProperties();
/d
		// Don't load the DB ppties there
		dbProperties = null;
		loadEnvironmentVars();
/s
	protected void loadEnvironmentVars() {
		theEnvironmentProperties = new Properties();
		Map<String, String> myEnvVariables = System.getenv();
		theEnvironmentProperties.putAll(myEnvVariables);

/t
ApplicationPropertyManager.reconfigure() line: 600	
		init();
/d
		for (ApplicationPropertyManagerListener listener : listeners) {
/ NEE

/t
ConfigReloadFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 52	
		myPropertyManager.reconfigure();
/d
		LanguageManager.resetLanguageCache();
/s
LanguageManager.resetLanguageCache() line: 100	
		clearWicketCache();
/s
	public static void clearWicketCache() {
		clearWicketCache = true;

/ Intermezzo

$ vi LanguageManager.java
	public static boolean mustClearWicketCache() {
		return clearWicketCache;
	}
	public static void wicketCacheCleared() {
		clearWicketCache = false;
	}

$ vi BaseHomePage.java

	protected void doRedirect() {
		if (LanguageManager.mustClearWicketCache()) {
			getApplication().getResourceSettings().getLocalizer().clearCache();
			LanguageManager.wicketCacheCleared();
		}


/ Einde Intermezzo

/t
	public static void resetLanguageCache() {
		clearWicketCache();
/d

/ WAS
propertiesFiles	HashMap  (id=13743)	
	size	3	
	table	HashMap$Entry[16]  (id=13758)	
		[5]	HashMap$Entry  (id=13762)	
en
		[7]	HashMap$Entry  (id=13763)	
nl
		[11]	HashMap$Entry  (id=13764)	
en_GB

		propertiesFiles.clear();

/t
ConfigReloadFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 54	
		MpoBeanFactory.getBean(JarService.class).configReload();
/s
JarServiceImpl.configReload() line: 49	
		ApplicationPropertyManager.getInstance().reconfigure();
/ al	, see boven	,
/ opnieuw: maakt een (NaturalSorted)Properties obj	, met application.propperties en daaroverheen local_application.properties	,
		reconfigureLog();
/s
JarServiceImpl.reconfigureLog() line: 77	
			MBeanServer myServer = MBeanServerLocator.locateJBoss();
org.jboss.mx.server.MBeanServerImpl@ebaa6ba[ defaultDomain='jboss' ]
			ObjectName objectName = new ObjectName("jboss.system:type=Log4jService,service=Logging");
jboss.system:type=Log4jService,service=Logging
			Log4jServiceMBean mbean = MBeanServerInvocationHandler.newProxyInstance(myServer, objectName, Log4jServiceMBean.class, false);
MBeanProxy(org.jboss.mx.server.MBeanServerImpl@ebaa6ba[ defaultDomain='jboss' ][jboss.system:type=Log4jService,service=Logging])
			mbean.reconfigure();
/ TODO
/ See Log4jServiceMBean.reconfigure	,
/ Is dit ook in widlfly?
/ TODO

/t
JarServiceImpl.configReload() line: 51	
		reconfigureLog();
/d
		clearAllCaches();
/s
JarServiceImpl.clearAllCaches() line: 39	
		sessionFactory.evictQueries();
/ @deprecated
/ TODO 
		SharedCachePool.getInstance().clearAllCaches(false);
/s
	/**
	 * Flush all caches
	 * 
SharedCachePool.clearAllCaches(boolean) line: 228	
		CacheManager cm = getLocalCacheManager(false);
null
		synchronized (globalCache) {
			globalCache.flushCache(aSoftFlush);
/s
CacheManager.flushCache(boolean) line: 198	
	...
/ TODO
/t
		synchronized (threadCaches) {
			for (CacheManager lcm : threadCaches.values()) {
				lcm.flushCache(aSoftFlush);
/ TODO

/t
JarServiceImpl.clearAllCaches() line: 41	
		SharedCachePool.getInstance().clearAllCaches(false);
/d
		Map<String, ClassMetadata> myMap = sessionFactory.getAllClassMetadata();
{com.mpobjects.oms.model.trigger.TriggerAction=SingleTableEntityPersister(com.mpobjects.oms.model.trigger.TriggerAction),
 com.mpobjects.massupdate.model.action.EntityAction=SingleTableEntityPersister(com.mpobjects.massupdate.model.action.EntityAction),
 com.mpobjects.oms.model.entity.Address=SingleTableEntityPersister(com.mpobjects.oms.model.entity.Address),
 com.mpobjects.oms.model.productitemcostpart.ProductItemCostPart=SingleTableEntityPersister(com.mpobjects.oms.model.productitemcostpart.ProductItemCostPart),
 com.mpobjects.oms.model.entity.businessobject.BusinessObject=SingleTableEntityPersister(com.mpobjects.oms.model.entity.businessobject.BusinessObject),
 com.mpobjects.oms.model.addressvalidationexclusion.entity.AddressValidationExclusion=SingleTableEntityPersister(com.mpobjects.oms.model.addressvalidationexclusion.entity.AddressValidationExclusion),
 com.mpobjects.inventory.model.entity.gridmatchcriterion.GridMatchCriterion=SingleTableEntityPersister(com.mpobjects.inventory.model.entity.gridmatchcriterion.GridMatchCriterion),
 com.mpobjects.oms.ratecalc.model.costcomponentspecification.vo.CostComponentSpecificationVO=SingleTableEntityPersister(com.mpobjects.oms.ratecalc.model.costcomponentspecification.vo.CostComponentSpecificationVO),
 com.mpobjects.oms.model.incoterm.vo.IncoTermVO=SingleTableEntityPersister(com.mpobjects.oms.model.incoterm.vo.IncoTermVO),
 com.mpobjects.ratecalc.entity.ParameterType=SingleTableEntityPersister(com.mpobjects.ratecalc.entity.ParameterType),
 com.mpobjects.oms.model.filter.Filter=SingleTableEntityPersister(com.mpobjects.oms.model.filter.Filter),
 com.mpobjects.oms.model.serviceaction.vo.ServiceActionVO=SingleTableEntityPersister(com.mpobjects.oms.model.serviceaction.vo.ServiceActionVO),
 com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailType=SingleTableEntityPersister(com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailType),
 com.mpobjects.oms.entity.billofmaterials.BillOfMaterialsVO=SingleTableEntityPersister(com.mpobjects.oms.entity.billofmaterials.BillOfMaterialsVO),
 com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO=SingleTableEntityPersister(com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO),
 com.mpobjects.event.event.model.EventVOValue=SingleTableEntityPersister(com.mpobjects.event.event.model.EventVOValue),
 com.mpobjects.oms.model.dashboard.vo.DashboardQueryVO=SingleTableEntityPersister(com.mpobjects.oms.model.dashboard.vo.DashboardQueryVO),
 com.mpobjects.capabletopromise.model.entity.resource.CapacitySchedule=SingleTableEntityPersister(com.mpobjects.capabletopromise.model.entity.resource.CapacitySchedule),
 com.mpobjects.oms.model.entity.permission.PermissionGroup=SingleTableEntityPersister(com.mpobjects.oms.model.entity.permission.PermissionGroup),
 com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate=SingleTableEntityPersister(com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate),
 com.mpobjects.oms.model.entity.Product=SingleTableEntityPersister(com.mpobjects.oms.model.entity.Product),
 com.mpobjects.oms.model.entity.property.Property=SingleTableEntityPersister(com.mpobjects.oms.model.entity.property.Property),
 com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailTypeGroup=SingleTableEntityPersister(com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailTypeGroup),
 com.mpobjects.interfacing.model.IFaceMsgTrace=SingleTableEntityPersister(com.mpobjects.interfacing.model.IFaceMsgTrace),
 com.mpobjects.invoice.model.entity.CostTypeTranslation=SingleTableEntityPersister(com.mpobjects.invoice.model.entity.CostTypeTranslation),
 com.mpobjects.inventory.model.entity.stockkeepingunit.StockKeepingUnit=SingleTableEntityPersister(com.mpobjects.inventory.model.entity.stockkeepingunit.StockKeepingUnit),
 com.mpobjects.oms.model.party.vo.PartyVO=SingleTableEntityPersister(com.mpobjects.oms.model.party.vo.PartyVO),
 com.mpobjects.oms.xml.documentid.XmlDocumentID=SingleTableEntityPersister(com.mpobjects.oms.xml.documentid.XmlDocumentID),
 com.mpobjects.oms.model.shipitementry.vo.ShipmentItemEntryField=SingleTableEntityPersister(com.mpobjects.oms.model.shipitementry.vo.ShipmentItemEntryField),
 com.mpobjects.authorization.model.AuthorizationCode=SingleTableEntityPersister(com.mpobjects.authorization.model.AuthorizationCode),
 com.mpobjects.oms.model.matchtype.vo.MatchTypeVO=SingleTableEntityPersister(com.mpobjects.oms.model.matchtype.vo.MatchTypeVO),
 com.mpobjects.oms.model.entitydetailvalueset.EntityDetailValueSetLookupField=UnionSubclassEntityPersister(com.mpobjects.oms.model.entitydetailvalueset.EntityDetailValueSetLookupField),
 com.mpobjects.oms.model.entity.holdstatus.HoldStatus=SingleTableEntityPersister(com.mpobjects.oms.model.entity.holdstatus.HoldStatus),
 com.mpobjects.authorization.model.ResourceAuthorizationCode=SingleTableEntityPersister(com.mpobjects.authorization.model.ResourceAuthorizationCode),
 com.mpobjects.oms.model.entity.ScheduleLineVo=SingleTableEntityPersister(com.mpobjects.oms.model.entity.ScheduleLineVo),
 com.mpobjects.event.model.DeferredEventValue=SingleTableEntityPersister(com.mpobjects.event.model.DeferredEventValue),
 com.mpobjects.massupdate.model.actiontemplate.EntityActionTemplate=SingleTableEntityPersister(com.mpobjects.massupdate.model.actiontemplate.EntityActionTemplate),
 com.mpobjects.oms.model.entity.instruction.Instruction=SingleTableEntityPersister(com.mpobjects.oms.model.entity.instruction.Instruction),
 com.mpobjects.oms.model.entitydetailvalueset.EntityDetailValueSetType=SingleTableEntityPersister(com.mpobjects.oms.model.entitydetailvalueset.EntityDetailValueSetType),
 com.mpobjects.oms.model.serviceorderprice.vo.ServiceOrderPricePartVO=SingleTableEntityPersister(com.mpobjects.oms.model.serviceorderprice.vo.ServiceOrderPricePartVO),
 com.mpobjects.omscarcon.model.CarConResponseXRule=SingleTableEntityPersister(com.mpobjects.omscarcon.model.CarConResponseXRule),
 com.mpobjects.invoice.model.costtypeinvoicematch.CostTypeInvoiceMatchVO=SingleTableEntityPersister(com.mpobjects.invoice.model.costtypeinvoicematch.CostTypeInvoiceMatchVO),
 com.mpobjects.oms.model.dangerousgoods.adn.AdnDangerousGoodsTankVesselInstance=SingleTableEntityPersister(com.mpobjects.oms.model.dangerousgoods.adn.AdnDangerousGoodsTankVesselInstance),
 com.mpobjects.document.entity.FileData=SingleTableEntityPersister(com.mpobjects.document.entity.FileData),
 com.mpobjects.oms.model.serviceordercost.vo.ServiceOrderCostVO=SingleTableEntityPersister(com.mpobjects.oms.model.serviceordercost.vo.ServiceOrderCostVO),
 com.mpobjects.oms.model.privilegeentity.vo.PrivilegeVO=SingleTableEntityPersister(com.mpobjects.oms.model.privilegeentity.vo.PrivilegeVO),
 com.mpobjects.oms.model.shipmentordercostpart.vo.ShipmentOrderCostPartVO=SingleTableEntityPersister(com.mpobjects.oms.model.shipmentordercostpart.vo.ShipmentOrderCostPartVO),
 com.mpobjects.oms.model.leggen.vo.PathTemplateVO=SingleTableEntityPersister(com.mpobjects.oms.model.leggen.vo.PathTemplateVO),
 com.mpobjects.oms.model.entitylog.ServiceOrderEntityLog=SingleTableEntityPersister(com.mpobjects.oms.model.entitylog.ServiceOrderEntityLog),
 com.mpobjects.oms.model.entity.MonitoringDashboard=SingleTableEntityPersister(com.mpobjects.oms.model.entity.MonitoringDashboard),
 com.mpobjects.event.model.entity.eventcustomquery.EventCustomQuery=SingleTableEntityPersister(com.mpobjects.event.model.entity.eventcustomquery.EventCustomQuery),
 com.mpobjects.oms.model.container.ContainerType=SingleTableEntityPersister(com.mpobjects.oms.model.container.ContainerType),
 com.mpobjects.oms.model.entity.shipmentorderparty.ShipmentOrderParty=SingleTableEntityPersister(com.mpobjects.oms.model.entity.shipmentorderparty.ShipmentOrderParty),
 com.mpobjects.oms.model.entity.permission.PermissionRule=SingleTableEntityPersister(com.mpobjects.oms.model.entity.permission.PermissionRule),
 com.mpobjects.capabletopromise.model.entity.capacitytype.CapacityType=SingleTableEntityPersister(com.mpobjects.capabletopromise.model.entity.capacitytype.CapacityType),
 com.mpobjects.ratecalc.entity.UnitConversion=SingleTableEntityPersister(com.mpobjects.ratecalc.entity.UnitConversion),
 com.mpobjects.oms.model.container.Container=SingleTableEntityPersister(com.mpobjects.oms.model.container.Container),
 com.mpobjects.oms.model.entitylog.EntityLogMigrationObject=SingleTableEntityPersister(com.mpobjects.oms.model.entitylog.EntityLogMigrationObject),
 com.mpobjects.customerinvoice.model.entity.CustomerInvoiceHeaderStatus=SingleTableEntityPersister(com.mpobjects.customerinvoice.model.entity.CustomerInvoiceHeaderStatus),
 com.mpobjects.oms.model.bundle.Bundle=SingleTableEntityPersister(com.mpobjects.oms.model.bundle.Bundle),
 com.mpobjects.core.tracing.TraceEntry=SingleTableEntityPersister(com.mpobjects.core.tracing.TraceEntry),
 com.mpobjects.oms.model.report.vo.ReportInputParameter=SingleTableEntityPersister(com.mpobjects.oms.model.report.vo.ReportInputParameter),
 com.mpobjects.oms.model.entity.instructiongroup.InstructionGroup=SingleTableEntityPersister(com.mpobjects.oms.model.entity.instructiongroup.InstructionGroup),
 com.mpobjects.oms.model.container.AbstractContainerAssociation=UnionSubclassEntityPersister(com.mpobjects.oms.model.container.AbstractContainerAssociation),
 com.mpobjects.oms.model.report.vo.ReportContextVO=SingleTableEntityPersister(com.mpobjects.oms.model.report.vo.ReportContextVO),
 com.mpobjects.oms.ratecalc.model.orderdetail.vo.OrderDetail=SingleTableEntityPersister(com.mpobjects.oms.ratecalc.model.orderdetail.vo.OrderDetail),
 com.mpobjects.oms.model.shipmentorderpricepart.vo.ShipmentOrderPricePartVO=SingleTableEntityPersister(com.mpobjects.oms.model.shipmentorderpricepart.vo.ShipmentOrderPricePartVO),
 com.mpobjects.capabletopromise.model.entity.resourcetype.ResourceType=SingleTableEntityPersister(com.mpobjects.capabletopromise.model.entity.resourcetype.ResourceType),
 com.mpobjects.oms.ratecalc.model.ragreementtestvalue.vo.RagreementTestvalueVO=SingleTableEntityPersister(com.mpobjects.oms.ratecalc.model.ragreementtestvalue.vo.Ragree...

		for (ClassMetadata myMetaData : myMap.values()) {
...
SingleTableEntityPersister(com.mpobjects.massupdate.model.action.EntityAction)
SingleTableEntityPersister(com.mpobjects.oms.model.entity.Address)
...
			sessionFactory.evictEntity(myMetaData.getEntityName());
		}
/ Intermezzo

/ we komen op de een of andere manier in	,

GenericJbossLoginModule.loginViaSpringSec(String, String) line: 242	
			theResourceVO = MpoBeanFactory.getBean(ResourceDAOInterface.class).systemGetByCode(AuthenticationUtils.getUserId());
/s
ResourceDAOHibernate.systemGetByCode(String) line: 188	
				SharedCachePool.getInstance().putEntity(TMS_USER, aCode, myResource);
/s
SharedCachePool.putEntity(String, Object, EntityInterface) line: 468	
		CacheManager cm = getLocalCacheManager(true);
/s
SharedCachePool.getLocalCacheManager(boolean) line: 625	
				cm = tryCreateLocalCacheManager(cm);
/s
SharedCachePool.getLocalCacheManager(boolean) line: 625	
				cm = tryCreateLocalCacheManager(cm);
/s
	/**
	 * Creates a local cache manager if the current environment deems is feasible (i.e. there is a transaction in
	 * read/write mode)
	 * 
SharedCachePool.tryCreateLocalCacheManager(CacheManager) line: 677	
				localCm.flushCache(true);
/s
CacheManager.flushCache(boolean) line: 198	
		synchronized (caches) {


/ Einde Intermezzo

/t
ConfigReloadFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 56	
		MpoBeanFactory.getBean(JarService.class).configReload();
/d
		debugProperties();

		// remove dynatable tables
		if (aRequest instanceof HttpServletRequest) {
			HttpSession mySession = ((HttpServletRequest) aRequest).getSession();
			@SuppressWarnings("unchecked") Enumeration<String> names = mySession.getAttributeNames();
[base_sessionMap, userMenu, base_sessionList, base_sessionLevel, wicket:WicketServlet:session, resource, SPRING_SECURITY_CONTEXT, Wicket:SessionUnbindingListener-WicketServlet]
			while (names.hasMoreElements()) {
				String name = names.nextElement();
				if (name.contains(TableManager.TABLE_SUFFIX)) {
/ NEE

		// initialize dao test mode
		if (ApplicationPropertyManager.TMS_SERVER_TYPE_DEVELOPMENT_SERVER.equals(myPropertyManager.getTmsServerType())) {
/ JA
			AbstractDAO.testModeOn();
/c
				theTestMode = true;

		HttpServletResponse myResponse = (HttpServletResponse) aResponse;
		myResponse.sendRedirect("../");

/ Geef cont	, 

MenuGenerateAction.act() line: 46	
/ TODO
	...
		myMenuService.setLanguageManager(new LanguageManager(new RequestAdaptor(getRequest())));
/s
LanguageManager.<init>(HttpServletRequest) line: 75	
		setLocale(LocaleUtils.getActiveLocale());
nl
		getPropertiesFile();
/s
LanguageManager.getPropertiesFile(Locale) line: 473	
		Map<Locale, Properties> myPropertiesFiles = getPropertiesFiles();
{}
		} else {
			File myFile = getPropertiesFilename(aLocale);
			if (myFile.isFile()) {
				if (propertiesFiles.containsKey(DEFAULT_LOCALE)) {
/ NEE
					myRet = PropertiesUtil.loadProperties(myFile);
					Properties myDefaultProperties = new Properties(propertiesFiles.get(DEFAULT_LOCALE));
					PropertiesUtil.merge(myDefaultProperties, myRet);
					myRet = myDefaultProperties;
/ NIET
				} else {
					myRet = PropertiesUtil.loadProperties(myFile);

/ WAS
					Properties myDefaultProperties = new Properties(propertiesFiles.get(DEFAULT_LOCALE));
/ IS
					Properties myDefaultProperties = new Properties();
					myDefaultProperties.putAll(propertiesFiles.get(DEFAULT_LOCALE));


////////////////////
					PropertiesUtil.merge(myDefaultProperties, myRet);
/ kunnen we ook vervangen door	,
					myDefaultProperties.putAll(myRet)

/ Einde RELOAD CONFIG 

/ PNL-313

/ 7	.

ScheduleSearchListPanel(GenericListPanel).initialize() line: 236	
$ vi GenericListPanel.html
	<form class="genericListPanelForm" wicket:id="filterForm" name="genericListPanelForm" id="genericListPanelForm">
/ Dit is het hele form	, 

		IModel<String> filterColTitle = new IModel<String>() {
			protected IModel<String> filterOn = new ResourceModel("filter", "filter").wrapOnAssignment(GenericListPanel.this);

/ Hierdoor staat er WH "filter" op de header als de property niet wordt gevonden in de language file	,
/ TODO ERICJ 

EntityDetailValueSetTypeListPage(EvoParentListPage).<init>(String, BeanWrapper<BaseDAOInterface<T>>) line: 108	
$ vi EvoParentListPage.java
		ArrayList myColumns = new ArrayList();
		myColumns.add(new FilteredAbstractColumn(new ResourceModel("filter")) {
			@Override
			public Component getFilter(final String aComponentId, final FilterForm aForm) {
				return new MpoGoAndClearFilter(aComponentId, aForm, getDataProvider());
			}
...

/ Doe	,
		myColumns.add(new FilteredAbstractColumn(new ResourceModel("filter","filter")) {

/ Dan zien we ook "filter" op de header als er in de language file geen property is	,

/ 7	.

/ 13	. 

/ create menu	,

LanguageManager.getMenuLabel(String) line: 368	
			myRet = get(myKey, true);
/s
LanguageManager.get(String, Map<String,String>, boolean) line: 546	

		if (getPropertiesFile().containsKey(myProductSpecificCode)) {
			myRet = getPropertiesFile().getProperty(myProductSpecificCode);
		} else if (getPropertiesFile().containsKey(myFullCode)) {
			myRet = getPropertiesFile().getProperty(myFullCode);

/ getPropertiesFile() is een Properties	, en .containsKey is fout 	,

/ 13	. 

/ render headers op schedules page	,

LanguageManagerStringResourceLoader.loadStringResource(Component, String) line: 51	
				return getLanguageManager().getTranslation(aKey, aComponent.getLocale(), aComponent.getStyle(), true);
/s
WicketLanguageManager.getTranslation(String, Locale, String, boolean) line: 37	
		return get(aKey, aLocale, aStyle, aThrowExceptionIfNotFound);
/ aKey="resource.edit.title"
/s
WicketLanguageManager.get(String, Locale, String, boolean) line: 75	
		if (StringUtils.isNotEmpty(aStyle) && getPropertiesFile(aStyle).containsKey(myFullCode)) {

/ .containsKey is NIET OK	, want is Hashtable fct en kjkt alleen in de has table van de Properties inst	, niet in die van defaults	,

/ 7	. 

/ er is nu een workaround	,

$ vi LanguageManager.java

	public static void resetLanguageCache() {
		clearWicketCache();
		propertiesFiles.clear();

		new LanguageManager().getPropertiesFile(DEFAULT_LOCALE);
/ NEW
	}

	protected Properties getPropertiesFile(Locale aLocale) {
		Map<Locale, Properties> myPropertiesFiles = getPropertiesFiles();
		Properties myRet;
		if (myPropertiesFiles.containsKey(aLocale)) {
			myRet = myPropertiesFiles.get(aLocale);
		} else {
			File myFile = getPropertiesFilename(aLocale);
			if (myFile.isFile()) {
				if (propertiesFiles.containsKey(DEFAULT_LOCALE)) {
					myRet = PropertiesUtil.loadProperties(myFile);

/ WAS
					Properties myDefaultProperties = new Properties(propertiesFiles.get(DEFAULT_LOCALE));
/ IS
					Properties myDefaultProperties = new Properties();
					myDefaultProperties.putAll(propertiesFiles.get(DEFAULT_LOCALE));

/ Einde PNL-313

/ PNL-313

/ we edit een schedule	,
/s
FilterForm(Form).delegateSubmit(IFormSubmittingComponent) line: 1591	
...
/ TODO
/s
AbstractEntityActionButton$1.onSubmit() line: 246	
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new Button(aId) {
			@Override
			public boolean isEnabled() {
				return AbstractEntityActionButton.this.isEnabled(aModel);
			}

			@Override
			public void onSubmit() {
				AbstractEntityActionButton.this.onSubmit(this, aModel);
/s
ScheduleListPage$2.onSubmit(Button, IModel<Schedule>) line: 92	
	@SuppressWarnings("serial")
	private Collection<EntityAction<Schedule>> getPanelAction() {
		ArrayList<EntityAction<Schedule>> actionList = new ArrayList<EntityAction<Schedule>>();

		EntityActionButton<Schedule> editButton = new EntityActionButton<Schedule>("edit", new ResourceModel("edit").wrapOnAssignment(ScheduleListPage.this)) {
			@Override
			protected void onSubmit(Button aButton, IModel<Schedule> aSelection) {
				ScheduleEditPage editPage = getEditPage();
/s
ScheduleListPage.getEditPage() line: 79	
		if (editPage == null) {
			editPage = new ScheduleEditPage(daoWrapper, this);
/ daoWrapper=com.mpobjects.view.wicket.util.BeanWrapper@5c375e71[type=interface com.mpobjects.oms.dao.calendar.ScheduleDAO,beanName=<null>]
/s
ScheduleEditPage.<init>(BeanWrapper<BaseDAOInterface<Schedule>>, BaseContextPage) line: 25	
/=
	public ScheduleEditPage(BeanWrapper<? extends BaseDAOInterface<Schedule>> aDaoWrapper, BaseContextPage basePage) {
		daoWrapper = aDaoWrapper;
		this.basePage = basePage;
		createPage();
/s
	private void createPage() {
		editPanel = new ScheduleEditPanel("editPanel", null, daoWrapper, basePage);
/s
ScheduleEditPanel.<init>(String, Schedule, BeanWrapper<BaseDAOInterface<Schedule>>, Page) line: 65	

/ Einde PNL-313

/ PNL-509

/ we moeten title toevoegen aan laad/losscherm	,

planning, shipment, arrival item entry	 /= laadscherm
planning, shipment, departure item entry	/ = losscherm

ArrivalItemEntryListPage	,
DepartureItemEntryListPage	,


/ Einde PNL-509

/ DEBUG PNL-509

/s
ArrivalItemEntryListPage(AbstractPage).onInitialize() line: 86	
	@Override
	protected void onInitialize() {
		super.onInitialize();
		processPageParameters();
		initializePage();
/s
ArrivalItemEntryListPage(AbstractMainPage).initializePage() line: 44	
		pageTitle = new Label("pageTitle", getPageTitle());
/s
ArrivalItemEntryListPage.getPageTitle() line: 142	
		return super.getPageTitle();
/s
ArrivalItemEntryListPage(AbstractPage).getPageTitle() line: 56	


/t
ArrivalItemEntryListPage(AbstractMainPage).initializePage() line: 51	
		pageTitle = new Label("pageTitle", getPageTitle());
/d
...
		super.initializePage();
/s
ArrivalItemEntryListPage(AbstractPage).initializePage() line: 71	
		pageTitleModel = getPageTitle();

/ 7	.

/ we add entry in 

$ vi language_nl.properties
...
pagetitle=Mijn titel

$ vi  AbstractMainPage.java

	private static final Log LOG = LogFactory.getLog(AbstractMainPage.class);

	protected void initializePage() {
		pageTitle = new Label("pageTitle", getPageTitle());
		LOG.info(">>>>>>>>>>>>Label >>>>>>>>>>>>>>" + pageTitle.getDefaultModelObjectAsString());
/s
$ vi AbstractPage.java
	protected IModel<String> getPageTitle() {
		if (pageTitleModel != null) {
			return pageTitleModel;
		}
		return new ResourceModel("pageTitle").wrapOnAssignment(this);
	}

/ ResourceModel queries language_nl.properties	,
$ vi ApplicationUtils.java
		myResourceSettings.addStringResourceLoader(4, new LanguageManagerStringResourceLoader());

$ vi conf/log4j.xml
	...
  <root>
      <priority value="INFO" /> <!-- INFO -->
      <appender-ref ref="CONSOLE"/>
      <appender-ref ref="FILE"/>
   </root>

/ Geef LOG.info in AbstractMainPage.java	,


/ we zien in Eclipse's console	,
2015-04-22 12:47:30,790 INFO  [com.mpobjects.view.wicket.pages.AbstractMainPage] (http-0.0.0.0-8080-3:) >>>>>>>>>>>>Label >>>>>>>>>>>>>>Mijn titel

/ 7	.





/ Einde DEBUG PNL-509

/ DEBUG PNL-509

/s
	protected void initializePage() {
		pageTitle = new Label("pageTitle", getPageTitle());
->		LOG.info(">>>>>>>>>>>>Label >>>>>>>>>>>>>>" + pageTitle.getDefaultModelObjectAsString());

/s
$ vi AbstractPage.java
	protected IModel<String> getPageTitle() {
		return new ResourceModel("pageTitle").wrapOnAssignment(this);
	}

/////////////////////////////////////////////////////////////////////////////
/ Pas bij -> wordt de lookup gedaan: getPageTitle()=een model	, dus in de 1ste line niet	, pas in de 2de	, 

/ we komen in 	,

Daemon Thread [http-0.0.0.0-8080-3] (Suspended (breakpoint at line 50 in LanguageManagerStringResourceLoader))	
	LanguageManagerStringResourceLoader.loadStringResource(Component, String) line: 50	
	Localizer.getStringIgnoreSettings(String, Component, IModel<?>, String) line: 241	
	Localizer.getString(String, Component, IModel<?>, String) line: 313	
	Localizer.getString(String, Component, String) line: 138	
	ResourceModel$AssignmentWrapper.getObject() line: 125	
	ResourceModel$AssignmentWrapper.getObject() line: 92	
	Label(Component).getDefaultModelObject() line: 1729	
	Label(Component).getDefaultModelObjectAsString() line: 1748	
	ArrivalItemEntryListPage(AbstractMainPage).initializePage() line: 50	
	ArrivalItemEntryListPage(AbstractPage).onInitialize() line: 86	
	ArrivalItemEntryListPage(Component).fireInitialize() line: 4105	
	ArrivalItemEntryListPage(MarkupContainer).initialize() line: 433	
	ArrivalItemEntryListPage(Page).prepareForRender(boolean) line: 1543	
	ArrivalItemEntryListPage(Component).prepareForRender() line: 2329	
	ArrivalItemEntryListPage(Page).renderPage() line: 912	
	MpoWebRequestCycle(WebRequestCycle).redirectTo(Page) line: 201	
	PageRequestTarget.respond(RequestCycle) line: 58	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
...

LanguageManagerStringResourceLoader.loadStringResource(Component, String) line: 50	
				return getLanguageManager().getTranslation(aKey, aComponent.getLocale(), aComponent.getStyle(), true);
/s
WicketLanguageManager.get(String, Locale, String, boolean) line: 23	
		Properties props = getPropertiesFile(aLocale);
		String result = props.getProperty(myFullCode, null);
Mijn titel




/ Einde DEBUG PNL-509

/ PNL-313

/ vertalen fields op JSP page, 

/ we kijken op de shipment order edit screen	,

			<map:match pattern="shipment-order_edit">
				<map:act type="shipmentOrderEdit">
					<map:select type="session-attribute">
						<map:parameter name="attribute-name" value="builder"/>
						<map:when test="jsp">
							<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order_edit.jsp"/>
						</map:when>
						<map:otherwise>
							<map:redirect-to uri="../wicket?module=oms&amp;wicketpage=shipmentorder.edit.ShipmentOrderEditSelectionPage"/>
						</map:otherwise>			
					</map:select>
				</map:act>
			</map:match>

		<!-- SHIPMENT ORDERS -->
			<map:action logger="shipmentorder" name="shipmentOrderEdit" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderEditAction"/>

/ 	7	.

$ vi shipment-order_edit.jsp

			<mpo:label name="shipmentOrder" />
<td class="label"><mpo:label name="estimatedCost"/></td>

							<mpo:field name="actionApprovalStatus" readOnly="true" />
						<mpo:listField name="organization" type="organization" required="true" />


/ we maken het b conditional	,
LabelTag [line: 41] [conditional] - doStartTag()	
this.theName.equals("estimatedCost")
||
this.theName.equals("shipmentOrder")

/ TODO (afmaken)

/ 7	.

/ set b in	,
FieldTag.getLabel(String) line: 1148	
FieldTag.getInfoValue() line: 442	

/ 13	. 

/ we vallen in	,

FieldTag.getLabel(String) line: 1148	
/=
	protected String getLabel(String aName) {
->		return getLanguageManager().getByJavaName(getFieldOwner().getEntity(), aName);

/ we vallen er in	, we gaan iets terug de stacktrace op	,

shipment-order_edit.jsp line: 195	
	<mpo:form name="shipmentorder" action="shipment-order_save" entity="shipmentOrder" readOnly="${readOnly}">
							<mpo:field name="actionApprovalStatus" readOnly="true" />
/s
FieldTag.doStartTag() line: 345	
					appendLabelPart(myRet);
/s
FieldTag.appendLabelPart(StringBuffer) line: 979	
		aBuffer.append(getLabel());
/s
FieldTag.getLabel() line: 1138	
		return getLabel(StringUtils.isEmpty(getLanguageKey()) ? getName() : getLanguageKey());
/ languageKey==null	, 
/ getName()=="actionApprovalStatus"
/s
FieldTag.getLabel(String) line: 1148	
		return getLanguageManager().getByJavaName(getFieldOwner().getEntity(), aName);
/ getFieldOwner()==com.mpobjects.view.taglib.form.FormTag@55e21f0c
/ getFieldOwner().getEntity()=="shipmentorder"
/ aName=="actionApprovalStatus"
/s
LanguageManager.getByJavaName(String, String) line: 370	
		String myTableName = StringUtils.formatJavaToSql(anEntityName).toString();
		String myFieldName = StringUtils.formatJavaToSql(aFieldName).toString();

/ anEntityName="shipmentOrder" 
myTableName	"shipment_order" (id=17993)	
aFieldName	"actionApprovalStatus" (id=17966)	
myFieldName	"action_approval_status" (id=18165)	

//////////////////
/ Dus "shipmentOrder" -> "shipment_order"
/ en "actionApprovalStatus" -> "action_approval_status"

/ "action_approval_status" hebben we later evt. ook nodig, want als er geen key wordt gevonden maakt hij er van "Action Approval Status"	, 
//////////////////


		String myRet;
		if (StringUtils.isNotEmpty(myTableName)) {

			myRet = get(myTableName, myFieldName);
/s
LanguageManager.get(String, String) line: 270	
/=
	public String get(String aTableName, String aField) {

			aTableName = StringUtils.formatJavaToSql(aTableName).toString();
"shipment_order"
			aTableName = aTableName.replaceAll("-", "_");
			myFullCode = "table_" + aTableName + "_" + aField;
myFullCode	"table_shipment_order_action_approval_status" (id=17999)	

			myRet = get(myFullCode, true);
/s
LanguageManager.get(String, boolean) line: 247	
		return get(aFullCode, StringUtils.EMPTY_STRING_MAP, aThrowExceptionIfNotFound);
/s
LanguageManager.get(String, Map<String,String>, boolean) line: 576	
		String myFullCode = aFullCode.toLowerCase();
		myFullCode = myFullCode.replaceAll(" ", "_");

		String myProductSpecificCode = getProduct() + "." + myFullCode;
myProductSpecificCode	"pnloms.table_shipment_order_action_approval_status" (id=18046)	

		Properties lang = getPropertiesFile();
		myRet = lang.getProperty(myProductSpecificCode, null);
null
		if (myRet == null) {
			myRet = lang.getProperty(myFullCode, null);
null
		if (myRet == null) {
			if (aThrowExceptionIfNotFound) {
				throw new IndexOutOfBoundsException(myFullCode + " Not found in language file.");
/t
LanguageManager.get(String, String) line: 271	
			myRet = get(myFullCode, true);
/d
null
		} catch (IndexOutOfBoundsException e) {
		}
		if (myRet == null) {
			try {
				myRet = get(aField, true);
/ aField	"action_approval_status" (id=17994)	
/s
LanguageManager.get(String, boolean) line: 247	
		String myFullCode = aFullCode.toLowerCase();
		myFullCode = myFullCode.replaceAll(" ", "_");

		String myProductSpecificCode = getProduct() + "." + myFullCode;
myProductSpecificCode	"pnloms.action_approval_status" (id=18048)	

		Properties lang = getPropertiesFile();
		myRet = lang.getProperty(myProductSpecificCode, null);
null
		if (myRet == null) {
			myRet = lang.getProperty(myFullCode, null);
null
		}

		if (myRet == null) {
			if (aThrowExceptionIfNotFound) {
				throw new IndexOutOfBoundsException(myFullCode + " Not found in language file.");
/t
LanguageManager.get(String, String) line: 277	
				myRet = get(aField, true);
null
			} catch (IndexOutOfBoundsException e) {
				int myPos = aField.lastIndexOf('.');
-1
			if (myPos > 0) {
/ NEE
					aField = aField.substring(myPos + 1);
/ NIET
				}

				myRet = aField.replaceAll("_", " ");
"action approval status"
				if (StringUtils.isNotEmpty(myRet)) {
					myRet = myRet.substring(0, 1).toUpperCase() + myRet.substring(1);
myRet	"Action approval status" (id=18052)	

		return myRet;

/////////////////////////////
/ SAMENVATTING LANGUAGE KEYS in JSP

/ in JSP	,
	<mpo:form name="shipmentorder" action="shipment-order_save" entity="shipmentOrder" readOnly="${readOnly}">
							<mpo:field name="actionApprovalStatus" readOnly="true" />

/ product="pnloms"
/ entity="shipmentOrder" -> shipment_order"
/ name="actionApprovalStatus" -> "action_approval_status"

/ Dus geprobeerd zijn de keys	,
myProductSpecificCode	"pnloms.table_shipment_order_action_approval_status" (id=14421)	
myFullCode	"table_shipment_order_action_approval_status" (id=14419)	
myProductSpecificCode	"pnloms.action_approval_status" (id=14427)	
myFullCode	"action_approval_status" (id=14416)	
/ Wordt er niets gevonden, dan geeft hij "Action approval status"	,

///////////////////////////////

/ we hebben edit	, 

$ vi language_en.properties

table_shipment_order_action_approval_status=[Action Approval Status] 
table_shipment_order_schedule_description=[Schedule Description]
table_shipment_order_approval_status=[Approval Sttaus]
table_shipment_order_authorization_codes=[Authorization Codes]

/ 7. 	

/ Schedules scherm	,



/ 7	. 

/ we gaan shipment order search scherm 	,

/ planning	, service order list, search

$ vi oms-sitemap.xml
			<map:match pattern="shipment-order_list">
				<map:act type="shipmentOrderList"/>			
				<map:call resource="dynatablePage">
					<map:parameter name="xsp" value="xsp/shipment-order_list.xml"/>
				</map:call>
			</map:match>


/ 13	. 

/ Daarna, we vallen in	,

FieldTag.getInfoValue() line: 442	

/ we gaan iets hoger de stack in	,

shipment-order_edit.jsp line: 195	
							<mpo:field name="actionApprovalStatus" readOnly="true" />
/s
FieldTag.doStartTag() line: 356	
					appendLabelPart(myRet);
...
		if (isFieldContextForm()) {
			addFieldToOwner(this);
/s
FieldTag.addFieldToOwner(FieldTag) line: 865	
		getFieldOwner().addField(aTag);
/s
FormTag.addField(FieldTag) line: 157	
		try {
			FieldTag myClonedField = (FieldTag) aField.clone();
/s
FieldTag.clone() line: 245	
		FieldTag aTargetObj = new FieldTag();
		clone(aTargetObj);
/s
FieldTag.clone(FieldTag) line: 262	
		aTargetObj.setInfoValue(getInfoValue());
/s
FieldTag.getInfoValue() line: 442	
		myRet = getLanguageManager().getInfoValue(getModule() + "." + getFieldOwner().getEntity().toLowerCase() + "." + getName() + ".info", theInfoValueMap);
/s
	public String getModule() {
		return EntityActionUtil.getModule(getRequest());
/t
/s
LanguageManager.getInfoValue(String, Map<String,String>) line: 410	
/=
	public String getInfoValue(String aFullCode, Map<String, String> aValueMap) {
/ aFullCode	"oms.shipmentorder.actionApprovalStatus.info" (id=18080)	
/ aValueMap {}

/ TODO

/ 7	. 

/ we vallen nu in 

ListFieldTag(FieldTag).getLabel(String) line: 1148	
aName	"organization" (id=18083)	
		return getLanguageManager().getByJavaName(getFieldOwner().getEntity(), aName);
/s
LanguageManager.getByJavaName(String, String) line: 366	
		String myTableName = StringUtils.formatJavaToSql(anEntityName).toString();
		String myFieldName = StringUtils.formatJavaToSql(aFieldName).toString();
myTableName	"shipment_order" (id=18088)	
myFieldName	"organization" (id=18089)	

		String myRet;
		if (StringUtils.isNotEmpty(myTableName)) {
			myRet = get(myTableName, myFieldName);
LanguageManager.get(String, String) line: 258	

			aTableName = StringUtils.formatJavaToSql(aTableName).toString();
			aTableName = aTableName.replaceAll("-", "_");
			myFullCode = "table_" + aTableName + "_" + aField;
aTableName	"shipment_order" (id=18092)	
myFullCode	"table_shipment_order_organization" (id=18093)	

			myRet = get(myFullCode, true);
/s
LanguageManager.get(String, boolean) line: 247	
		return get(aFullCode, StringUtils.EMPTY_STRING_MAP, aThrowExceptionIfNotFound);
/s
LanguageManager.get(String, Map<String,String>, boolean) line: 576	
		String myFullCode = aFullCode.toLowerCase();
		myFullCode = myFullCode.replaceAll(" ", "_");

		String myProductSpecificCode = getProduct() + "." + myFullCode;
myProductSpecificCode	"pnloms.table_shipment_order_organization" (id=18095)	

		Properties lang = getPropertiesFile();
		myRet = lang.getProperty(myProductSpecificCode, null);
null
		if (myRet == null) {
			myRet = lang.getProperty(myFullCode, null);
null
		}

		if (myRet == null) {
			if (aThrowExceptionIfNotFound) {
				throw new IndexOutOfBoundsException(myFullCode + " Not found in language file.");
/t
LanguageManager.get(String, String) line: 271	
			myRet = get(myFullCode, true);
/d
null
		} catch (IndexOutOfBoundsException e) {
		}
		if (myRet == null) {
			try {
				myRet = get(aField, true);
aField	"organization" (id=18089)	
/s
LanguageManager.get(String, boolean) line: 247	
		return get(aFullCode, StringUtils.EMPTY_STRING_MAP, aThrowExceptionIfNotFound);
/s
LanguageManager.get(String, Map<String,String>, boolean) line: 582	

		String myFullCode = aFullCode.toLowerCase();
		myFullCode = myFullCode.replaceAll(" ", "_");
		String myProductSpecificCode = getProduct() + "." + myFullCode;
myFullCode	"organization" (id=18089)	
myProductSpecificCode	"pnloms.organization" (id=18099)	

		Properties lang = getPropertiesFile();
		myRet = lang.getProperty(myProductSpecificCode, null);
null
		if (myRet == null) {
			myRet = lang.getProperty(myFullCode, null);
"Organisatie"
		myRet = StringUtils.replaceVars(myRet, aFieldMap);
		return myRet;










myProductSpecificCode	"pnloms.table_shipment_order_organization" (id=18095)	
myFullCode	"table_shipment_order_organization" (id=18093)	



 


 




myFullCode	"table_shipment_order_action_approval_status" (id=17999)	


/ Einde PNL-313

/ PNL-546

/ Open een rate agreement	,
configuration, finance, service management, service agreements (admin)
/ click edit SHIPMENT-CHECK-AND-COMPLETE
/ click tab parameters
/ we zien alle rate parameters	, 

/ wij hebben nodig: RP_REQ_START_AFTER_D en RP_REQ_END_BEFORE_D	,
/ in de lange lijst, we kunnen ze edit, bekijken	, 
/ we zien de Function: date-time to date	, die ze berekent.

/ ga terug naar de service agreement, en kies onderin, weer bij parameters	,
With function: COMPARE 
/ click Create new rate parameter

/ Geef een naam: testeric
Left hand: RP_REQ_START_AFTER_D 
Right hand: RP_REQ_END_BEFORE_D
Type: Date
/ We zien  NullPointerException	,

		java.lang.NullPointerException
	at com.mpobjects.oms.ratecalc.control.function.action.CompareFunctionSaveAction.handleSave(CompareFunctionSaveAction.java:32)
	at com.mpobjects.control.action.AbstractSaveAction.act(AbstractSaveAction.java:69)
	at com.mpobjects.control.action.AbstractAction.act(AbstractAction.java:171)
	at org.apache.cocoon.components.treeprocessor.sitemap.ActTypeNode.invoke(ActTypeNode.java:125)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:47)
	at org.apache.cocoon.components.treeprocessor.sitemap.MatchNode.invoke(MatchNode.java:108)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177)
	at org.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:253)
	at org.apache.cocoon.components.treeprocessor.sitemap.MountNode.invoke(MountNode.java:118)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:47)
	at org.apache.cocoon.components.treeprocessor.sitemap.MatchNode.invoke(MatchNode.java:108)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177)
	at org.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:253)
	at org.apache.cocoon.components.treeprocessor.sitemap.MountNode.invoke(MountNode.java:118)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177)
	at org.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:253)
	at org.apache.cocoon.Cocoon.process(Cocoon.java:699)
	at org.apache.cocoon.servlet.CocoonServlet.service(CocoonServlet.java:1154)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:810)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at com.mpobjects.control.filter.FirstLoginFilter.doFilter(FirstLoginFilter.java:76)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:330)
	at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:118)
	at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:84)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:113)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:103)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:113)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:154)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:45)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:199)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:110)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at com.mpobjects.auth.springsec.RunAsLogoutFilter.doFilter(RunAsLogoutFilter.java:41)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.context.SecurityContextPersistenceFilter.doFilter(SecurityContextPersistenceFilter.java:87)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:192)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:160)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:343)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:260)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at filters.SetCharacterEncodingFilter.doFilter(SetCharacterEncodingFilter.java:111)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:230)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at org.jboss.web.tomcat.filters.ReplyHeaderFilter.doFilter(ReplyHeaderFilter.java:96)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)
	at org.jboss.web.tomcat.security.SecurityAssociationValve.invoke(SecurityAssociationValve.java:175)
	at org.jboss.web.tomcat.security.JaccContextValve.invoke(JaccContextValve.java:74)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)
	at org.jboss.web.tomcat.tc5.jca.CachedConnectionValve.invoke(CachedConnectionValve.java:156)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)
	at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)
	at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)
	at org.apache.tomcat.util.net.MasterSlaveWorkerThread.run(MasterSlaveWorkerThread.java:112)
	at java.lang.Thread.run(Thread.java:745)

/ 7	.

/ pnloms op test	,

/ 13	. 

/ we copy database van mposerv8 ,

[eric@localhost Backup]$  pwd
/home/eric/Devel/Postgres/Backup
[eric@localhost Backup]$ PGPASSWORD="Eric123@MPO" pg_dump -U eric -Fc -h mposerv8 pnloms -f  pnloms.4.dump
[eric@localhost Backup]$ PGPASSWORD=mpopostgres@mpo pg_restore -U mpopostgres -d pnloms4 --no-acl --no-owner  pnloms.4.dump 
/ OK

/ 7	. 

/ Lees	,
https://system.mp-objects.com/xwiki/bin/view/Technology/PostgreSQL#HBackup2FRestore

/ 13	. 

/ we backup eerst onze pnloms database	,
/ en kijken of als we deze restore in pnloms4 db, het OK is	,

[eric@localhost Backup]$ PGPASSWORD="Eric123@MPO" pg_dump -U eric -Fc -h mposerv8 -n public pnloms | gzip > pnloms-$(date +%Y-%m-%d).backup.gz

# create database pnloms4;
[eric@localhost Backup]$ PGPASSWORD=mpopostgres@mpo pg_restore -U mpopostgres -d pnloms4 pnloms.localhost.dump 
/ OK
/ In deploy/postgres-ds.xml
       <xa-datasource-property name="DatabaseName">pnloms4</xa-datasource-property>
                <connection-url>jdbc:postgresql://127.0.0.1:5432/pnloms4</connection-url>
/ OK

/ 13	. 

[eric@localhost pnloms]$  PGPASSWORD=mpopostgres@mpo psql -U mpopostgres -d pnloms

/ TODO

/   7   .

[eric@localhost pnloms]$ vi deploy/postgres-ds.xml
<datasources>
    <xa-datasource>
        ...
        <xa-datasource-property name="DatabaseName">pnloms4</xa-datasource-property>
    </xa-datasource>
    <local-tx-datasource>
                ...
                <connection-url>jdbc:postgresql://127.0.0.1:5432/pnloms4</connection-url>
                ...
    </local-tx-datasource>
</datasources>

/ start pnloms  ,

/ 7	.

/ pnloms uit acceptance	,

[eric@localhost Backup]$ PGPASSWORD='h^Zgcyr&Q'  pg_dump -U vanderveldene -h pnl-app-a.intermax.mp-objects.com pnloms > pnloms.7.dump
pnloms4=# create database pnloms7;
[eric@localhost Backup]$ PGPASSWORD=mpopostgres@mpo pg_restore -U mpopostgres -d pnloms7 pnloms.7.dump 
/ OK

/ 7	. 

/ we moeten eerst in 2015.01 doen	,

/ Intermezzo

/ we hebben db's	,
pnloms7
mpo_2015_01

/ Einde Intermezzo

mpo_2015_01=# select count(*)from rate_parameter ;
 count 
-------
   734
(1 row)

/ Maar bij een rate agreement  zien we maar een paar rate parameters	,

/ Maar we moeten query hoeveel rate_parameters er zijn per rate agreement	,

mpo_2015_01=# select count(*)from rate_parameter p join rate_agreement a on p.rate_agreement_systemid=a.system_id and a.name='REENEN';
 count 
-------
    33
(1 row)

/ Nog te veel	,

mpo_2015_01=# select p.* from rate_parameter p join rate_agreement a on p.rate_agreement_systemid=a.system_id and a.name='REENEN';
 system_id |              name              | description  | outputfrom_function_systemid | rate_agreement_systemid | is_persistent | sequence_nr | parameter_typ
e_systemid | is_user_editable | iteration_entity | iteration_action 
-----------+--------------------------------+--------------+------------------------------+-------------------------+---------------+-------------+--------------
-----------+------------------+------------------+------------------
  26631697 | LT_RELEASE_CARRIER_OUTPUT      |              |                     26631696 |                26631689 |             0 |           0 |              
           |                0 |                  | 
  26631704 | LT_RELEASE_SUPPLIER_OUTPUT     |              |                     26631703 |                26631689 |             0 |           0 |              
           |                0 |                  | 
  26631729 | RP_FREIGHT                     |              |                     26631727 |                26631689 |             0 |           0 |              
           |                0 |                  | 
  26631739 | RP_FUEL                        |              |                     26631736 |                26631689 |             0 |           0 |              
           |                0 |                  | 

/ Hoe onderscheiden RP_...?
/ TODO

/ 7	.

/ In 2015.01 kunnen we rate agreement REENEN kiezen	,

/ click Parameters tab	,

name: test7
left hand: PR_RELEASE_DATE
right hand: PR_START_DATE
type: Date

/ De 1ste keer NullPointerException	, 
/ we zien toch entry in rate_parameter tbl	, 

/ we rm deze row	, manually in db,	
/ als we nog een keer met name: test7 deze rp maken	, dan 	,

com.mpobjects.oms.ratecalc.model.process.function.RateException: [Cannot Save a Rate Parameter with the name test7. A parameter with the name you specified already exists.] Cannot Save a Rate Parameter with the name test7. A parameter with the name you specified already exists. at
com.mpobjects.oms.ratecalc.control.function.action.AbstractFunctionSaveAction.checkForExisting(AbstractFunctionSaveAction.java:43) at 
com.mpobjects.oms.ratecalc.control.function.action.CompareFunctionSaveAction.handleSave(CompareFunctionSaveAction.java:37) at 
com.mpobjects.control.action.AbstractSaveAction.act(AbstractSaveAction.java:69) at 
com.mpobjects.control.action.AbstractAction.act(AbstractAction.java:171) at 

/ Zit de entry nog in een (hibernate) cache	?
/ TODO

/ Het gaat fout op 	,
$ vi CompareFunctionSaveAction.java
	public void handleSave() throws Exception {
		...
		checkForExisting(myRateAgreementVO, myParameterVO);

/ 

/ 7	. 

/ fix	, 
$ vi CompareFunctionSaveAction.java

		if (myParameterVO.getSystemId() != ValueObject.VOLATILE_SYSTEM_ID) {
			myParameterVO = MpoBeanFactory.getBean(RateParameterDAO.class).getBySystemId(myParameterVO.getSystemId());
		}


/ Maar nu een nieuwe fout	,

java.lang.NullPointerException at 
com.mpobjects.oms.ratecalc.model.process.form.AbstractFunctionModelVO.getName(AbstractFunctionModelVO.java:47) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:606) at 
com.mpobjects.core.vo.VOReflectionInvoker.getValueAsObject(VOReflectionInvoker.java:871) at 
com.mpobjects.core.vo.VOReflectionInvoker.getValueAsString(VOReflectionInvoker.java:495) at 
com.mpobjects.view.taglib.form.FieldTag.getDisplayValueAsString(FieldTag.java:1087) at 
com.mpobjects.view.taglib.form.FieldTag.appendInputPart(FieldTag.java:921) at 
com.mpobjects.view.taglib.form.FieldTag.doStartTag(FieldTag.java:347) at org.apache.jsp.ratecalc.jsp.compare_002dfunction_005fedit_jsp._jspx_meth_mpo_field_0(compare_002dfunction_005fedit_jsp.java:251) at 
org.apache.jsp.ratecalc.jsp.compare_002dfunction_005fedit_jsp._jspx_meth_mpo_setFormVO_0(compare_002dfunction_005fedit_jsp.java:212) at 
org.apache.jsp.ratecalc.jsp.compare_002dfunction_005fedit_jsp._jspx_meth_mpo_form_0(compare_002dfunction_005fedit_jsp.java:163) at 
org.apache.jsp.ratecalc.jsp.compare_002dfunction_005fedit_jsp.access$2(compare_002dfunction_005fedit_jsp.java:149) at 
org.apache.jsp.ratecalc.jsp.compare_002dfunction_005fedit_jsp$compare_002dfunction_005fedit_jspHelper.invoke2(compare_002dfunction_005fedit_jsp.java:583) at 
org.apache.jsp.ratecalc.jsp.compare_002dfunction_005fedit_jsp$compare_002dfunction_005fedit_jspHelper.invoke(compare_002dfunction_005fedit_jsp.java:608) at 
org.apache.jsp.tag.web.core.pageBody_tag.doTag(pageBody_tag.java:69) at 
org.apache.jsp.ratecalc.jsp.compare_002dfunction_005fedit_jsp._jspx_meth_ctf_pageBody_0(compare_002dfunction_005fedit_jsp.java:145) at 
org.apache.jsp.ratecalc.jsp.compare_002dfunction_005fedit_jsp.access$1(compare_002dfunction_005fedit_jsp.java:136) at 
org.apache.jsp.ratecalc.jsp.compare_002dfunction_005fedit_jsp$compare_002dfunction_005fedit_jspHelper.invoke0(compare_002dfunction_005fedit_jsp.java:563) at 
org.apache.jsp.ratecalc.jsp.compare_002dfunction_005fedit_jsp$compare_002dfunction_005fedit_jspHelper.invoke(compare_002dfunction_005fedit_jsp.java:602) at 
org.apache.jsp.tag.web.core.page_tag.doTag(page_tag.java:92) at 
org.apache.jsp.ratecalc.jsp.compare_002dfunction_005fedit_jsp._jspx_meth_ctf_page_0(compare_002dfunction_005fedit_jsp.java:119) at 
org.apache.jsp.ratecalc.jsp.compare_002dfunction_005fedit_jsp._jspService(compare_002dfunction_005fedit_jsp.java:95) at 
...


/ 13	. 

/ TOch zien we de rate param in de list, 
/ we kunnen hem edit, en dan de delete button click	, 
/ Wat doet de delete button meer dan manually delete entry in rate_parameter tbl?
/ TODO

/ we set b in 
$ vi AbstractFunctionModelVO ...
	public String getName() {
		return rateFunction.getRateParameter().getName();
	}
/ we zien dat  rateFunction.getRateParameter()==null
/ Dit is ERR

/ MORGEN: we kozen COMPARE , en clicked 'create new parameter',  kijk wat er dan gebeurt	.






/ Einde PNL-546

/ PNL-546

/ 7	. 

/ we copy database van mposerv8	,

[eric@localhost Backup]$  pwd
/home/eric/Devel/Postgres/Backup
[eric@localhost Backup]$ PGPASSWORD="Eric123@MPO" pg_dump -U eric -Fc -h mposerv8 pnloms -f  pnloms.4.dump
[eric@localhost Backup]$ PGPASSWORD=mpopostgres@mpo pg_restore -U mpopostgres -d pnloms4 pnloms.4.dump 

/ we zien bij laatste, ERRs	,

pg_restore: [archiver (db)] Error from TOC entry 416; 1259 48411 VIEW chargeable_user pnloms
pg_restore: [archiver (db)] could not execute query: ERROR:  role "pnloms" does not exist
    Command was: ALTER TABLE public_before_20150319.chargeable_user OWNER TO pnloms;

pg_restore: [archiver (db)] Error from TOC entry 8679; 0 0 ACL rate_parameter pnloms
pg_restore: [archiver (db)] could not execute query: ERROR:  role "pnloms" does not exist
    Command was: REVOKE ALL ON TABLE rate_parameter FROM PUBLIC;
REVOKE ALL ON TABLE rate_parameter FROM pnloms;
GRANT ALL ON TABLE rate_para...

pg_restore: [archiver (db)] Error from TOC entry 4107; 826 49299 DEFAULT ACL DEFAULT PRIVILEGES FOR TABLES admin
pg_restore: [archiver (db)] could not execute query: ERROR:  role "admin" does not exist
    Command was: ALTER DEFAULT PRIVILEGES FOR ROLE admin REVOKE ALL ON TABLES  FROM PUBLIC;
ALTER DEFAULT PRIVILEGES FOR ROLE admin GRANT SEL...

/ TODO

/ 	7	.

[eric@localhost pnloms]$ vi deploy/postgres-ds.xml
<datasources>
    <xa-datasource>
		...
        <xa-datasource-property name="DatabaseName">pnloms4</xa-datasource-property>
    </xa-datasource>
    <local-tx-datasource>
				...
                <connection-url>jdbc:postgresql://127.0.0.1:5432/pnloms4</connection-url>
				...
    </local-tx-datasource>
</datasources>

/ start pnloms	,

		java.lang.NullPointerException
	at com.mpobjects.oms.ratecalc.control.function.action.CompareFunctionSaveAction.handleSave(CompareFunctionSaveAction.java:32)
	at com.mpobjects.control.action.AbstractSaveAction.act(AbstractSaveAction.java:69)
	at com.mpobjects.control.action.AbstractAction.act(AbstractAction.java:171)
	at org.apache.cocoon.components.treeprocessor.sitemap.ActTypeNode.invoke(ActTypeNode.java:125)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:47)
	at org.apache.cocoon.components.treeprocessor.sitemap.MatchNode.invoke(MatchNode.java:108)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177)
	at org.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:253)
	at org.apache.cocoon.components.treeprocessor.sitemap.MountNode.invoke(MountNode.java:118)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:47)
	at org.apache.cocoon.components.treeprocessor.sitemap.MatchNode.invoke(MatchNode.java:108)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177)
	at org.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:253)
	at org.apache.cocoon.components.treeprocessor.sitemap.MountNode.invoke(MountNode.java:118)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177)
	at org.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:253)
	at org.apache.cocoon.Cocoon.process(Cocoon.java:699)
	at org.apache.cocoon.servlet.CocoonServlet.service(CocoonServlet.java:1154)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:810)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at com.mpobjects.control.filter.FirstLoginFilter.doFilter(FirstLoginFilter.java:76)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:330)
	at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:118)
	at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:84)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:113)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:103)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:113)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:154)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:45)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:199)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:110)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at com.mpobjects.auth.springsec.RunAsLogoutFilter.doFilter(RunAsLogoutFilter.java:41)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.context.SecurityContextPersistenceFilter.doFilter(SecurityContextPersistenceFilter.java:87)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:192)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:160)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:343)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:260)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at filters.SetCharacterEncodingFilter.doFilter(SetCharacterEncodingFilter.java:111)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:230)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at org.jboss.web.tomcat.filters.ReplyHeaderFilter.doFilter(ReplyHeaderFilter.java:96)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)
	at org.jboss.web.tomcat.security.SecurityAssociationValve.invoke(SecurityAssociationValve.java:175)
	at org.jboss.web.tomcat.security.JaccContextValve.invoke(JaccContextValve.java:74)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)
	at org.jboss.web.tomcat.tc5.jca.CachedConnectionValve.invoke(CachedConnectionValve.java:156)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)
	at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)
	at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)
	at org.apache.tomcat.util.net.MasterSlaveWorkerThread.run(MasterSlaveWorkerThread.java:112)
	at java.lang.Thread.run(Thread.java:745)

	





/ Einde PNL-546

/ PNL-546 COCOON

/ 7	. 

/ Open een rate agreement	,
configuration, finance, service management, service agreements (admin)

/ we zien rate_agreement_list

$ vi ratecalc-menu.xml

<m:menu xmlns:m="http://www.mp-objects.com/schema/scs/menu">
	<m:add path="configuration.finance.serviceManagement.serviceAgreements(admin)" actionUrl="ratecalc/rate_agreement_list" privilege="rate-agreement.list" index="1210"/>


$ vi ratecalc-sitemap.xmap

	<map:pipelines>
		<map:pipeline>
			<map:match pattern="rate_agreement_list">			
				<map:act type="rateAgreementList"/>
					<map:generate label="xmlContent" type="serverpages" src="xsp/rate-agreement-list.xml">
				<map:parameter value="true" name="parameters"/>
			</map:generate>
				<map:call resource="dynatable-styler"/>
			</map:match>

$ vi rate-agreement-list.xml

				myTable.addHiddenColumn("system_id");			 
				myTable.addColumn("name");
				myTable.addColumn("description");
				myTable.addColumn("organization");
				myTable.addColumn("currency");
				myTable.addColumn("type");
				
				myTable.addAction("edit", "rate_agreement_edit");			
				myTable.addAction("create", "rate_agreement_edit");				/ zien we niet (TODO)
				myTable.addAction("delete", "rate_agreement_delete");

$ vi rate-agreement-list.xsl
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">
    <xsl:import href="../../core/xsl/generic-dynatablepage.xsl"/>
</xsl:stylesheet>

$ vi generic-dynatablepage.xsl
...
/ TODO

pnloms7=# select count(*) from rate_agreement where is_deleted=0;
 count 
-------
     5
(1 row)
/ we zien er ook 5 in de GUI	,

/ 7	.

/ Kies SHIPMENT-CHECK-AND-COMPLETE	, en click edit	,
/ in 2015.01 kies REENEN	,

/ dit is rate_agreement_edit	,

$ vi ratecalc-sitemap.xmap

			<map:match pattern="rate_agreement_edit">
				<map:act type="rateAgreementEdit"/>
				<map:call function="handleForm">
					<map:parameter name="function" value="rateagreement_edit"/>
					<map:parameter name="form-definition" value="cforms/rateagreement/rate-agreement-form.xml"/>
					<map:parameter name="bindingURI" value="cforms/rateagreement/rate-agreement-binding.xml"/>
				</map:call>
			</map:match>

$ vi rate-agreement-fs.js
...
function rateagreement_edit(form) {
	...
	cocoon.redirectTo("rate_agreement_save");
/ TODO (we zien deze fct niet in chrome devtools)


/ We zien het form boven, en de Selection Criteria tab + panel, maar de rest zoals de Parameters tab+panel NIET	,

/ right click de button 'Create new rate parameter' en kies 'Inspect Element'	, 

<button onclick="javascript:submitAndShowRateParameter(document.rateagreementForm.function_def_systemid.value,'CreateRateParameter');">Create New Rate Parameter</button>

/ ga naar console , en kies het juiste frame, main_frame(rate_agreement_edit)	, en geef submitAndShowRateParameter	,
/ we zien de fct def, en rechtsonder een link, rate_agreement_edit?base_sessionLevelOffset=1&systemid=26631689&systemId=26631689:59, dit is de url van de page, met de js er in	,
/ we zien	,
...
<button onclick="javascript:submitAndShowRateParameter(document.rateagreementForm.function_def_systemid.value,'CreateRateParameter');">Create New Rate Parameter</button>
</p>
<script language="javascript">
								  function submitAndShowRateParameter(aSystemId,aTargetScreen){
										 if(aSystemId!=null && aSystemId!=''){
												document.rateagreementForm.ratetableSuffix.value =  '?systemId=' + aSystemId;
										 }
										 document.rateagreementForm.target_screen.value=aTargetScreen;
									     document.rateagreementForm.submit();		
									}
             </script>

/ De def staat er rechts onder	,

/ Intermezzo

/ De truc is om in devtools in chrome naar de page te kijken	,

/ zoek de tab op	, of met inspect , 

/ we zien het button, maar ook de table, met alle entries	,

/ Kies 'RP_START_DATE' entry	, we zien de edit button, de name, de description	,

<tr class="list0">
<td width="20" class="list">
	<a href="#" onclick="javascript:submitAndShowRateParameter(26631807,'EditRateParameter');">
		<img src="../lookandfeel/styles/images/icons/check24.gif" border="0">
	</a>
</td>
<td class="list">RP_START_DATE</td>
<td class="list"></td>
</tr>

/ Einde Intermezzo

/ we hadden de 'create rate parameter' button	,
<button onclick="javascript:submitAndShowRateParameter(document.rateagreementForm.function_def_systemid.value,'CreateRateParameter');">Create New Rate Parameter</button>

/ Dus er zijn 1 js functie	, submitAndShowRateParameter	,

/ 13	. 

/ Zoek CreateRateParameter  in 

$ vi ratecalc-sitemap.xmap	,

<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">
  <map:pipelines>
	<map:pipeline>
		<map:match pattern="rate_agreement_save">
				<map:act type="rateAgreementSave"/>
				<map:select type="session-attribute">
					<map:parameter value="target_screen" name="attribute-name"/>
					...
					<map:when test="CreateRateParameter">
						<map:redirect-to uri="rate_function_init_and_switch{session-attr:ratetableSuffix}"/>
					</map:when>
					<map:when test="EditRateParameter">
						<map:redirect-to uri="rate_function_init_and_switch{session-attr:ratetableSuffix}"/>
					</map:when>

		</map:pipeline>
        <map:pipeline>
          <map:match pattern="rate_function_init_and_switch">
                <map:act type="rateFunctionInitAndSwitch"/>
            </map:match>
		...
  	<map:pipelines>
	<map:components>
		<map:actions>
			<map:action name="rateAgreementSave" src="com.mpobjects.oms.ratecalc.control.rateagreement.action.RateAgreementSaveAction" logger="ratecalc"/>
/ Als je een rate agreement save	, maar dat doen we niet	,

/ ga dan in eclipse naar

$ vi RateFunctionInitAndSwitch.java

public class RateFunctionInitAndSwitchAction extends AbstractRateFunctionAction {

	@Override
	public Map act() throws Exception {
/ set hier b	,

/ Hier moeten we invallen als we een paramenter edit, door op edit button click in een row	, of op de create button	,

/ 13	. 

$ vi rate-parameter-form.xml
/ TODO 

/ 13	. 

$ vi RateAgreementEditAction.java
/ dit is als je bijv 'REENEN' clickt in de list van rate agreements om deze te edit/ open	,
/ 

/ 13	.

/ we zien 2 files	,

/ WH parameter panel, met de list van rate params	,

$ vi rate-parameter-list-without-rateparameters.xml

	  myTable.addHiddenColumn("system_id");			 		 
	  myTable.addColumn("NAME".toLowerCase());
      myTable.addColumn("DESCRIPTION".toLowerCase());

/ Hier in de source code de edit/create rate parameter 

$ vi rate-parameter-list-without-ratetableparameters.xsl

	<xsl:template match="dynatable">
		<table class="list">
			<xsl:apply-templates/>
		</table>
            <p> With Function <cinclude:include src="cocoon:/functiondefinition_selection_list_without_ratetablefunction"/> 
                &#160;<button 
                onclick="javascript:submitAndShowRateParameter(document.rateagreementForm.function_def_systemid.value,'CreateRateParameter');"> 
                <i18n:text i18n:key="rateagreement.button.createnewrateparameter">Create New Rate Parameter</i18n:text> </button> </p>
        <script language="javascript"><![CDATA[
								  function submitAndShowRateParameter(aSystemId,aTargetScreen){
										 if(aSystemId!=null && aSystemId!=''){
												document.rateagreementForm.ratetableSuffix.value =  '?systemId=' + aSystemId;
										 }
										 document.rateagreementForm.target_screen.value=aTargetScreen;
									     document.rateagreementForm.submit();		
									}]]>
             </script>
	</xsl:template>
	<xsl:template match="row">
		<tr class="list{(position()-1) mod 2}">
			<td class="list" width="20">
					<a href="#">
						<xsl:attribute name="onclick">javascript:submitAndShowRateParameter(<xsl:value-of select="./column[1]/text()"/>,'EditRateParameter');</xsl:attribute>
						<img border="0" src="../lookandfeel/styles/images/icons/check24.gif">
									</img>
					</a>
				</td>
			<xsl:apply-templates/>
		</tr>
	</xsl:template>

/ TODO

/ 13	. 

/ Op het compare function scherm	,

/ we zien save , save close	, cancel	,

<input type="button" name="saveBtn" id="saveBtn" value="Save" onclick=" theEditFormFormManager.submit('../ratecalc/compare-function_save', false, 0);">
<input type="button" id="saveAndCloseBtn" value="Save and Close" onclick=" theEditFormFormManager.submit('../ratecalc/compare-function_save', true, '-1'); return false;">
<input type="button" id="cancelBtn" value="Cancel" onclick=" theEditFormFormManager.cancelAndRedirect('Cancel creation of new record', '../ratecalc/rate_agreement_edit?systemid=26631689&amp;systemId=26631689');">


/ 13	. 

/ we zien in	,
RateFunctionInitAndSwitchAction.act() line: 56	
			myRedirector.redirect(true, "rate_function_no_func_param_defs_init");


$ vi ratecalc-sitemap.xmap

           <map:match pattern="rate_function_no_func_param_defs_init">
                <map:call function="handleForm">
                    <map:parameter name="function" value="ratefunction_no_func_param_defs_init"/>
                    <map:parameter name="form-definition" value="cforms/ratefunction/forms/rate-function-no-func-param-defs-form.xml"/>
                    <map:parameter name="bindingURI" value="cforms/ratefunction/forms/rate-function-no-func-param-defs-binding.xml"/>
                </map:call>
            </map:match>
/ TODO

/ 13	. 

$ vi ratecalc-sitemap.xml

            <!-- CompareFunction -->
			<map:match type="regexp" pattern="^compare-function_(edit|create)">
                <map:act type="compareFunctionEdit"/>
                <map:read type="jsp" src="jsp/compare-function_edit.jsp"/>
            </map:match>
            <map:match pattern="compare-function_save">
                <map:act type="compareFunctionSave"/>
				<map:read type="jsp" src="jsp/compare-function_edit.jsp"/>
            </map:match>

$ vi compare-function_edit.jsp
		<mpo:form>
				<mpo:setFormVO fetchFrom="session" fetchVar="formvo">
					<mpo:field name="name" required="true" />
					...
				</mpo:setFormVO>
				<tr>
					<td colspan="2">	
						<mpo:button type="save" /> 
						<mpo:button type="saveAndClose" /> 
						<mpo:button type="cancelAndRedirect" url="../ratecalc/rate_agreement_edit?systemid=${sessionScope['active_rateagreement'].systemId}&systemId=${sessionScope['active_rateagreement'].systemId}" /> 
						<mpo:button type="delete" /></td>

		</mpo:form>

/ we zien in HTML voor de save button		 ,
<input type="button" name="saveBtn" id="saveBtn" value="Save" onclick=" theEditFormFormManager.submit('../ratecalc/compare-function_save', false, 0);">
/ Hoe met compare-function_edit.jsp	?
/ TODO

/ theEditFormManager is een 'function FormManager', deze is def in class.formmanager.js	,

/ Geef in devtools	,
frame: main_frame(compare_function_create)
theEditFormFormManager
>FormManager{...}
/ Dit obj heeft een submit fct	, 
/ geef in console	,
theEditFormFormManager.submit
/ we zien de def. en deze komt uit class.formmanager.js	,

$ vi mpo.tld
	<tag>
		<name>form</name>
		<tagclass>com.mpobjects.view.taglib.form.FormTag</tagclass>


/ we zien in devtools dat class.formmanager.js wordt include	,
/ Dit gebeurt in pageHeader.tag	,

$ vi FormTag.java
	public String getJsFormManager() {
		return "the" + StringUtils.firstCharToUpper(theName) + "FormManager";
	}

/ 7	.

///////////////////////////////
/ MAANDAG

public class CompareFunctionSaveAction extends AbstractFunctionSaveAction {
	public void handleSave() throws Exception {
		myNewFunction.setLeftHand(myFunction.getLeftHand());
////////////////////
/ Hier wordt de input par set in de fct 	,

public class CompareFunctionVO extends AbstractFunctionModelVO {
	public void setLeftHand(String aValue) {
		setInputParamaterSource(CompareFunction.LEFT_HAND, aValue);
/s

$ vi AbstractFunctionModelVO.java

		if (myParameter == null) {
			myParameter = new InputParameterVO();
			myParameter.setFuncParDefVO(MpoBeanFactory.getBean(FuncParameterDefDAO.class).getByName(aParam));
			rateFunction.addInputParameter(myParameter);

/ waar wordt de rate par set in de fct	?

/ Kijk MAANDAG naar	,


public class CompareFunctionSaveAction extends AbstractFunctionSaveAction {
	public void handleSave() throws Exception {

/ en 	,
public class RateFunctionInitAndSwitchAction extends AbstractRateFunctionAction {
		} else if (myDefinition.equals(CompareFunction.class.getName())) {
			getSession().setAttribute("formvo", new CompareFunctionVO(myRateFunctionVO));
			myRedirector.redirect(true, "compare-function_create");

/ de formvo wordt used in de jsp	, maar WH is deze dus fout	,

/ Einde MAANDAG
//////////////////////////////////

/ Einde Intermezzo





/ Einde PNL-546 COCOON


/ PNL-546 COCOON

/ 7	. 

/ we create een nieuwe rate param	,

RateFunctionInitAndSwitchAction.act() line: 73	

		int mySystemId = getSystemIdFromRequest();
100
		String myTargetScreen = (String) getSession().getAttribute("target_screen");
COMPARE fct 
		if (myTargetScreen.equals("CreateRateParameter")) {
			myFunctionDefinition = MpoBeanFactory.getBean(FunctionDefinitionDAO.class).getBySystemId(mySystemId);
			getSession().setAttribute(ACTIVE_FUNCTION_DEFINITION, myFunctionDefinition);
			myRateFunctionVO = new RateFunctionVO();
			RateParameterVO myRateParameterVO = new RateParameterVO();
			RateAgreementVO myRateAgreementVO = (RateAgreementVO) getSession().getAttribute(RateAgreementAbstractEditAction.ACTIVE_RATE_AGREEMENT);
			myRateParameterVO.setRateAgreementVO(myRateAgreementVO);
			myRateFunctionVO.setRateParameter(myRateParameterVO);
			myRateFunctionVO.setFunctionDefinitionVO(myFunctionDefinition);

		Redirector myRedirector = getRedirector();
		String myDefinition = myFunctionDefinition.getDefinition();
		} else if (myDefinition.equals(CompareFunction.class.getName())) {
			getSession().setAttribute("formvo", new CompareFunctionVO(myRateFunctionVO));
/ (*) 
			myRedirector.redirect(true, "compare-function_create");

$ vi recalc-sitemap.xmap
			<map:match type="regexp" pattern="^compare-function_(edit|create)">
                <map:act type="compareFunctionEdit"/>
                <map:read type="jsp" src="jsp/compare-function_edit.jsp"/>
            </map:match>
 / Hij komt inderdaad langs compareFunctionEdit.act	, 


/ Daarna jsp calls	, 

SetFormVOTag.setFetchFrom(String) line: 183	
/=
	public void setFetchFrom(String aFetchFrom) {
/ aFetchFrom="session"
		setValueObject(null);
/s
SetFormVOTag.setValueObject(EntityInterface) line: 201	
		theValueObject = aVO;
null

/t
/s
SetFormVOTag.doStartTag() line: 103	
		if (getValueObject() == null) {
			if (StringUtils.isEmpty(getFetchFrom())) {
/ NEE
/ "session"
			if (getFetchFrom().equals("request")) {
/ NEE
			} else {
				if (getSession().getAttribute(theFetchVar) != null) {
/ thFetchVar="formvo"
					setValueObject((ValueObject) getSession().getAttribute(theFetchVar));
/s
SetFormVOTag.setValueObject(EntityInterface) line: 201	
/=
	public void setValueObject(EntityInterface aVO) {
		theValueObject = aVO;
this	SetFormVOTag  (id=18287)	
aVO	CompareFunctionVO  (id=18300)	
	performanceMonitorService	null	
	rateFunction	RateFunctionVO  (id=18306)	
	systemId	0	
/ Deze was create hierboven bij (*)

/t
/s

CompareFunctionVO.getLeftHand() line: 35	
		return getInputParameterSource(CompareFunction.LEFT_HAND, false);
/s
	public String getInputParameterSource(String paramName, boolean mandatory) {
/ "LEFT_HAND"
		InputParameterVO myArgumentInputParameter = rateFunction.getInputParameterOfType(paramName, mandatory);
null
/ de input param list = []	,
		return InputParameterSource.getInputParamaterSourceId(myArgumentInputParameter);
null

/ en	,
CompareFunctionVO.getRightHand() line: 35	

/ en 
CompareFunctionVO.getType() line: 35	
		return getConfigurationValue(CompareFunction.TYPE, false, CompareFunction.Type.NUMBER.toString());
/s
CompareFunctionVO(AbstractFunctionModelVO).getConfigurationValue(String, boolean, String) line: 29	
		InputParameterVO myParameter = rateFunction.getInputParameterOfType(aParamName, false);
null
/ de input param list = []	,
		if (myParameter == null) {
			return defaultValue;
"NUMBER"

/ Dus de rate fct en rate param worden WH alleen create om het form te tonen	,
/ TODO

/ 7	.

/we fill in COMPARE form	,
Name : testcompare7
Left hand: RP_RELEASE DATE
Right hand: RP_START DATE
Type: Date

/ click Save
/s
CompareFunctionSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	
				Map myMap = act();
/s
CompareFunctionSaveAction(AbstractSaveAction).act() line: 69	
			handleSave();
/s
CompareFunctionSaveAction.handleSave() line: 29	
		CompareFunctionVO myFunction = (CompareFunctionVO) getValueObject();
/s
CompareFunctionSaveAction(BoundSaveAction).getValueObject() line: 197	
		return getFetchedData().iterator().next();
/s
CompareFunctionSaveAction(BoundSaveAction).getFetchedData() line: 119	
			if (theFetchedData == null) {
JA
				theFetchedData = (Collection<EntityInterface>) getRequest().getAttribute(TAGLIB_FETCHED_DATA);
null
/ TAGLIB_FETCHED_DATA = "taglibFetchedData"

			if (theFetchedData == null) {
/ JA
				Collection<DataFetchable> myFetchFields = getForm().getDataFetchableFields();
/s
CompareFunctionSaveAction(BoundSaveAction).getForm() line: 167	
		return theFormTag;
/t
/s
FormTag.getDataFetchableFields() line: 341	
		ArrayList<DataFetchable> myList = new ArrayList<DataFetchable>();
		for (Object myField : fieldList) {
FormTag.getDataFetchableFields() line: 341	
this	FormTag  (id=18005)	
	fieldList	ArrayList  (id=18007)	
		elementData	Object[10]  (id=18011)	
			[0]	FieldTag  (id=18013)	
			[1]	DropDownFieldTag  (id=18014)	
			[2]	DropDownFieldTag  (id=18015)	
			[3]	DropDownFieldTag  (id=18016)	
		modCount	4	
		size	4	
			if (myField instanceof DataFetchable) {
/ JA
				myList.add((DataFetchable) myField);

		return myList;

/t
CompareFunctionSaveAction(BoundSaveAction).getFetchedData() line: 128	
			if (theFetchedData == null) {
				Collection<DataFetchable> myFetchFields = getForm().getDataFetchableFields();
/d
				FieldTag myField = null;

/ 1ste	, name

				for (DataFetchable myDataFetchable : myFetchFields) {
name
					shouldHandle = true;
					if (myDataFetchable instanceof FieldTag) {
						myField = (FieldTag) myDataFetchable;
						shouldHandle = shouldHandleFieldPrefix(myField.getPrefix());
true
					}
					if (shouldHandle) {
						myDataFetchable.fetchData();
/s
FieldTag.fetchData() line: 376	
this	FieldTag  (id=18013)	
name
		if (!isCurrentlyReadOnly()) {
/ JA
			VOReflectionInvoker.setValue(getActiveValueObject(), getName(), getValueFromRequest(getFormFieldName()));
/s
FieldTag.getActiveValueObject() line: 385	
this	FieldTag  (id=18013)	
		EntityInterface myRet = null;
 		if (theActiveValueObject != null) {
/ NEE
		} else {
			myRet = getActiveValueObjectHolder().getActiveValueObject();
/s
FieldTag.getActiveValueObjectHolder() line: 396	
this	FieldTag  (id=18013)	
		return activeValueObjectHolder;
/=
activeValueObjectHolder	SetFormVOTag  (id=18233)	
/t
/s
SetFormVOTag.getActiveValueObject() line: 123	
s	SetFormVOTag  (id=18233)	
	theValueObject	CompareFunctionVO  (id=18250)	
		return getValueObject();
/=
theValueObject
/ See hierboven bij de form create (*), en later toen we invulden TODO 
this	SetFormVOTag  (id=18318)	
	theValueObject	CompareFunctionVO  (id=18300)	
		rateFunction	RateFunctionVO  (id=18306)	
			performanceMonitorService	null	
			systemId	0	
			theFunctionDefinition	FunctionDefinitionVO  (id=18321)	
theSystemId: 100
Definition :com.mpobjects.oms.ratecalc.model.process.function.CompareFunction,Name :COMPARE
			theInputParameterList	HashSet  (id=18357)	
[]
			theIsUserDefined	false	
			theRateParameter	RateParameterVO  (id=18375)	
theSystemId: 0Name :null
Description :null
			theRateTable	null	
			theUnit	null	
			theUserFuncDef	null	
		systemId	0	

/t
FieldTag.fetchData() line: 377	
			VOReflectionInvoker.setValue(getActiveValueObject(), getName(), getValueFromRequest(getFormFieldName()));
/t
/s
FieldTag.getName() line: 475	
"name"
/t
/s
FieldTag.getFormFieldName() line: 1115	
this	FieldTag  (id=18324)	
name
		String myRet;
		String myPrefix = getPrefix();
""
		if (StringUtils.isEmpty(myPrefix)) {
/ JA
			myRet = getName();
"name"
		return myRet;
/t
/s
FieldTag.getValueFromRequest(String) line: 1176	
		return getRequest().getParameter(aName);
/ = theRequest in de FormTag	,

this	FieldTag  (id=18324)	
	parent	SetFormVOTag  (id=18323)	
		parent	FormTag  (id=18334)	
		theFetchFrom	"session" (id=18253)	
		theFetchVar	"formvo" (id=18254)	
		theFormTag	FormTag  (id=18334)	
			theRequest	RequestAdaptor  (id=18472)	
				theRequestCocoon	HttpRequest  (id=18848)	
/ Hier kwam de value uit	,
/ TODO

/ Intermezzo

$ vi compare-function_edit.jsp

		<mpo:form>
				<mpo:setFormVO fetchFrom="session" fetchVar="formvo">
					<mpo:field name="name" required="true" />
					<mpo:dropDownField name="leftHand" dataType="string" required="true">
					...

/ Einde Intermezzo

/t
FieldTag.fetchData() line: 377	
			VOReflectionInvoker.setValue(getActiveValueObject(), getName(), getValueFromRequest(getFormFieldName()));
/s
VOReflectionInvoker.setValue(EntityInterface, String, Object) line: 805	
		ValueObjectMethod myValueObjectMethod = findMethod(aVO, TYPE_SET, aFieldName, 1);
aVO	CompareFunctionVO  (id=18300)	
aFieldName	"name" (id=18457)	
aValue	"testcompare77" (id=18462)	
TYPE_SET="set"
		Method myMethod = myValueObjectMethod.getMethod();
		EntityInterface myVO = myValueObjectMethod.getValueObject();
		try {
			myMethod.invoke(myVO, new Object[] { aValue });
/s
CompareFunctionVO(AbstractFunctionModelVO).setName(String) line: 95	
this	CompareFunctionVO  (id=18300)	
aName	"testcompare77" (id=18462)	

		rateFunction.getRateParameter().setName(aName);

this	CompareFunctionVO  (id=18300)	
	rateFunction	RateFunctionVO  (id=18306)	
		systemId	0	
		theFunctionDefinition	FunctionDefinitionVO  (id=18321)	
		theInputParameterList	HashSet  (id=18357)	
[]
		theRateParameter	RateParameterVO  (id=18375)	
			systemId	0	
			theDescription	null	
			theName	"testcompare77" (id=18462)	
			theOutputfromFunction	null	
			theParameterType	null	
			theRateAgreement	RateAgreementVO_$$_javassist_91  (id=18980)	
			theSequenceNr	0	
		theRateTable	null	
		theUnit	null	
		theUserFuncDef	null	
	systemId	0	
aName	"testcompare77" (id=18462)	

/ we geven continue	,

/ volgende	, leftHand	,
/ TODO

	public void setLeftHand(String aValue) {
		setInputParamaterSource(CompareFunction.LEFT_HAND, aValue);
/d

/ volgende	, rightHand	,

CompareFunctionSaveAction(BoundSaveAction).getFetchedData() line: 136	
				for (DataFetchable myDataFetchable : myFetchFields) {
rightHand
					if (myDataFetchable instanceof FieldTag) {
						myField = (FieldTag) myDataFetchable;
						shouldHandle = shouldHandleFieldPrefix(myField.getPrefix());
true
					if (shouldHandle) {
						myDataFetchable.fetchData();
/s
DropDownFieldTag.fetchData() line: 192	
/ getDataType()=="string"
			if (getDataType().equals(DATA_TYPE_NUMBER)) {
"number"
/ NEE
			} else if (getDataType().equals(DATA_TYPE_ENUM)) {
"enum"
/ NEE
			} else {
				VOReflectionInvoker.setValue(getActiveValueObject(), getName(), getValueFromRequest(getFormFieldName()));
/s
VOReflectionInvoker.setValue(EntityInterface, String, Object) line: 809	
			myMethod.invoke(myVO, new Object[] { aValue });
/s
CompareFunctionVO.setRightHand(String) line: 45	
		setInputParamaterSource(CompareFunction.RIGHT_HAND, aValue);
this	CompareFunctionVO  (id=18300)	
aValue	"PA26631807" (id=18999)	
/s
CompareFunctionVO(AbstractFunctionModelVO).setInputParamaterSource(String, String) line: 80	
		InputParameterVO myParameter = rateFunction.getInputParameterOfType(aParam, false);
aParam	"RIGHT_HAND" (id=17770)	
/s
RateFunctionVO.getInputParameterOfType(String, boolean) line: 175	
/=	public InputParameterVO getInputParameterOfType(String aParamName, boolean mustExist) {

aParamName	"RIGHT_HAND" (id=17770)	

/ "LEFT_HAND" staat er al in	,

this	RateFunctionVO  (id=18306)	
myInputParameterList	HashSet  (id=18357)	
	map	HashMap  (id=19025)	
		size	1	
		table	HashMap$Entry[1]  (id=19027)	
			[0]	HashMap$Entry  (id=19028)	
				key	InputParameterVO  (id=19029)	
					systemId	0	
					theConfigurationValue	null	
					theFreeValue	null	
					theFuncParDef	FuncParameterDefVO  (id=19033)	
theSystemId: 10010Name :LEFT_HAND
FuncDefSystemid :100
ParameterTypeSystemid :3700001
					theOrderDetail	null	
					theParameter	RateParameterVO_$$_javassist_136  (id=19034)	
theSystemId: 26631774Name :RP_RELEASE_DATE
Description :null

		for (Iterator myIt = myInputParameterList.iterator(); myIt.hasNext();) {
			InputParameterVO myInputParameterVO = (InputParameterVO) myIt.next();
			if (myInputParameterVO.getFuncParDefVO() != null && myInputParameterVO.getFuncParDefVO().getName().equals(aParamName)) {
/ NEE
/ myInputParameterVO.getFuncParDefVO().getName()=="LEFT_HAND"

		return null;

/t
CompareFunctionVO(AbstractFunctionModelVO).setInputParamaterSource(String, String) line: 81	
		InputParameterVO myParameter = rateFunction.getInputParameterOfType(aParam, false);
null
		if (myParameter == null) {
/ JA
			myParameter = new InputParameterVO();
			myParameter.setFuncParDefVO(MpoBeanFactory.getBean(FuncParameterDefDAO.class).getByName(aParam));

mpo_2015_01=# select*from func_parameter_def;
 system_id |          name          | func_def_systemid | parameter_type_systemid 
     10010 | LEFT_HAND              |               100 |                 3700001
     10020 | RIGHT_HAND             |               100 |                 3700001
     10030 | TYPE                   |               100 |                 3700001
 
			rateFunction.addInputParameter(myParameter);

this	CompareFunctionVO  (id=18300)	
	rateFunction	RateFunctionVO  (id=18306)	
		systemId	0	
		theFunctionDefinition	FunctionDefinitionVO  (id=18321)	
		theInputParameterList	HashSet  (id=18357)	
			map	HashMap  (id=19025)	
				size	2	
				table	HashMap$Entry[2]  (id=19162)	
					[0]	HashMap$Entry  (id=19166)	
						key	InputParameterVO  (id=19154)	
							performanceMonitorService	null	
							systemId	0	
							theConfigurationValue	null	
							theFreeValue	null	
							theFuncParDef	FuncParameterDefVO  (id=19195)	
theSystemId: 10020Name :RIGHT_HAND
FuncDefSystemid :100
ParameterTypeSystemid :3700001
							theOrderDetail	null	
							theParameter	null	
/ Moet nog	hieronder	,
							theRateFunc	RateFunctionVO  (id=18306)	
							theRateResult	null	
						next	HashMap$Entry  (id=19028)	
							key	InputParameterVO  (id=19029)	
								performanceMonitorService	null	
								systemId	0	
								theConfigurationValue	null	
								theFreeValue	null	
								theFuncParDef	FuncParameterDefVO  (id=19033)	
heSystemId: 10010Name :LEFT_HAND
FuncDefSystemid :100
ParameterTypeSystemid :3700001
								theOrderDetail	null	
								theParameter	RateParameterVO_$$_javassist_136  (id=19034)	
theSystemId: 26631774Name :RP_RELEASE_DATE
Description :null
/ is dus al	,
								theRateFunc	RateFunctionVO  (id=18306)	
/ pointer back	,
								theRateResult	null	

		InputParameterSource.setInputParamaterSource(myParameter, aValue);
/s
InputParameterSource.setInputParamaterSource(InputParameterVO, String) line: 67	
		if (aSourceId.startsWith(InputParameterSource.ORDER_DETAIL_PREFIX)) {
/ "OD"
/ NEE
		} else if (aSourceId.startsWith(InputParameterSource.PARAMETER_PREFIX)) {
"PA"
				RateParameterVO myRateParameter = MpoBeanFactory.getBean(RateParameterDAO.class).getBySystemId(
						new Integer(aSourceId.substring(InputParameterSource.PARAMETER_PREFIX.length())));
myRateParameter	RateParameterVO_$$_javassist_136  (id=19254)	
theSystemId: 26631807Name :RP_START_DATE
Description :null
				aInputParameterVO.setOrderDetailVO(null);
				aInputParameterVO.setParameterVO(myRateParameter);

/t
CompareFunctionVO.setRightHand(String) line: 46	
		setInputParamaterSource(CompareFunction.RIGHT_HAND, aValue);
/d

/ we geven continue	,

/ volgende	,

CompareFunctionSaveAction(BoundSaveAction).getFetchedData() line: 130	
				for (DataFetchable myDataFetchable : myFetchFields) {
					if (myDataFetchable instanceof FieldTag) {
type
						myField = (FieldTag) myDataFetchable;
						shouldHandle = shouldHandleFieldPrefix(myField.getPrefix());
					}
					if (shouldHandle) {
						myDataFetchable.fetchData();
/s
DropDownFieldTag.fetchData() line: 181	
			} else {
				VOReflectionInvoker.setValue(getActiveValueObject(), getName(), getValueFromRequest(getFormFieldName()));
/s
DropDownFieldTag(FieldTag).getActiveValueObject() line: 385	
		if (theActiveValueObject != null) {
/ NEE
		} else {
			myRet = getActiveValueObjectHolder().getActiveValueObject();
/s
DropDownFieldTag(FieldTag).getActiveValueObjectHolder() line: 396	
		return activeValueObjectHolder;
/t
/s
SetFormVOTag.getActiveValueObject() line: 123	
this	SetFormVOTag  (id=18336)	

		return getValueObject();
/= theValueObject
com.mpobjects.oms.ratecalc.model.process.form.CompareFunctionVO/id:0

/ Intermezzo

/ de 1ste keer was de SetFormVOTag's theValueObject = null, (TODO) 

/ Einde Intermezzo

/t
DropDownFieldTag.fetchData() line: 192	
				VOReflectionInvoker.setValue(getActiveValueObject(), getName(), getValueFromRequest(getFormFieldName()));
/s
/ getName()="type"
getFormFieldName()==getName()
/t
/s
DropDownFieldTag(FieldTag).getValueFromRequest(String) line: 1176	
		return getRequest().getParameter(aName);
/s
DropDownFieldTag(FieldTag).getRequest() line: 526	
		return getFieldOwner().getRequest();
/s
DropDownFieldTag(FieldTag).getFieldOwner() line: 1095	
		return getActiveValueObjectHolder().getFieldOwner();
/s
DropDownFieldTag(FieldTag).getActiveValueObjectHolder() line: 396	
		return activeValueObjectHolder;
/ activeValueObjectHolder	SetFormVOTag  (id=18336)	
/t
/s
SetFormVOTag.getFieldOwner() line: 142	
		return getForm();
/s
SetFormVOTag.getForm() line: 146	
		return theFormTag;
/t
DropDownFieldTag(FieldTag).getRequest() line: 526	
		return getFieldOwner().getRequest();
/s
FormTag.getRequest() line: 426	
		return theRequest;
/t
DropDownFieldTag(FieldTag).getValueFromRequest(String) line: 1176	
		return getRequest().getParameter(aName);
/s
RequestAdaptor.getParameter(String) line: 320	
			myObject = theRequestCocoon.getParameter(aName);
myObject	"DATE" (id=19296)	
/t
DropDownFieldTag.fetchData() line: 192	
				VOReflectionInvoker.setValue(getActiveValueObject(), getName(), getValueFromRequest(getFormFieldName()));
/s
VOReflectionInvoker.setValue(EntityInterface, String, Object) line: 805	
		ValueObjectMethod myValueObjectMethod = findMethod(aVO, TYPE_SET, aFieldName, 1);
		Method myMethod = myValueObjectMethod.getMethod();
public void com.mpobjects.oms.ratecalc.model.process.form.CompareFunctionVO.setType(java.lang.String)
		EntityInterface myVO = myValueObjectMethod.getValueObject();
		try {
			myMethod.invoke(myVO, new Object[] { aValue });
/s
CompareFunctionVO.setType(String) line: 51	
		setConfigurationValue(CompareFunction.TYPE, aValue);
/s
CompareFunctionVO(AbstractFunctionModelVO).setConfigurationValue(String, String) line: 66	
/=
	public void setConfigurationValue(String aParam, String aValue) {
this	CompareFunctionVO  (id=18300)	
aParam	"TYPE" (id=17775)	
aValue	"DATE" (id=19296)	

		InputParameterVO myArgumentInputParameter = rateFunction.getInputParameterOfType(aParam, false);
null

this	CompareFunctionVO  (id=18300)	
	rateFunction	RateFunctionVO  (id=18306)	
		systemId	0	
		theFunctionDefinition	FunctionDefinitionVO  (id=18321)	
		theInputParameterList	HashSet  (id=18357)	
[SystemId: 0, SystemId: 0]								/ leftHand:RP_RELEASE_DATE	, rightHand:RP_START_DATE
		theIsUserDefined	false	
		theRateParameter	RateParameterVO  (id=18375)	
theSystemId: 0Name :testcompare77
		theRateTable	null	
		theUnit	null	
		theUserFuncDef	null	
	systemId	0	
aParam	"TYPE" (id=17775)	
aValue	"DATE" (id=19296)	

/ we zien 3 rp's	: die we willen maken: theRateParameter	, 2 input params die zelf ook rp's zijn: RP_RELEASE_DATE, RP_START_DATE	,

		if (myArgumentInputParameter == null) {
/ JA
			myArgumentInputParameter = new InputParameterVO();
			myArgumentInputParameter.setFuncParDefVO(MpoBeanFactory.getBean(FuncParameterDefDAO.class).getByName(aParam));
			rateFunction.addInputParameter(myArgumentInputParameter);
		}

		myArgumentInputParameter.setConfigurationValue(aValue);
/ sets theConfigurationValue van de InputParameterVO

/t
CompareFunctionSaveAction(BoundSaveAction).getFetchedData() line: 140	
				for (DataFetchable myDataFetchable : myFetchFields) {
/ d
/ geen volgende	,
				theFetchedData = getForm().getValueObjects();
this	CompareFunctionSaveAction  (id=18339)	
/ getForm()=theFormTag
/ .getValueObjects()=theValueObjects van de FormTag	,
/=
this	FormTag  (id=18334)	
	theValueObjects	ArrayList  (id=18894)	
/=
this	CompareFunctionSaveAction  (id=18339)	
	theFetchedData	ArrayList  (id=18894)	

		elementData	Object[10]  (id=19366)	
			[0]	CompareFunctionVO  (id=18300)	
				performanceMonitorService	null	
				rateFunction	RateFunctionVO  (id=18306)	
					performanceMonitorService	null	
					systemId	0	
					theFunctionDefinition	FunctionDefinitionVO  (id=18321)	
Definition :com.mpobjects.oms.ratecalc.model.process.function.CompareFunction,Name :COMPARE
					theInputParameterList	HashSet  (id=18357)	
[SystemId: 0, SystemId: 0, SystemId: 0]
					theIsUserDefined	false	
					theRateParameter	RateParameterVO  (id=18375)	
theSystemId: 0Name :testcompare77
					theRateTable	null	
					theUnit	null	
					theUserFuncDef	null	

			getRequest().setAttribute(TAGLIB_FETCHED_DATA, theFetchedData);
/s
/= de CompareFunctionSaveAction.theRequest=org.apache.cocoon.environment.http.HttpRequest@5ee298cc

/ Intermezzo

/ Deze cocoon request zagen we eerder, maar dan in FormVO	,
/ TODO

/ Einde Intermezzo

			return theFetchedData;
/t
CompareFunctionSaveAction(BoundSaveAction).getValueObject() line: 197	
		return getFetchedData().iterator().next();
/t
CompareFunctionSaveAction.handleSave() line: 29	
		CompareFunctionVO myFunction = (CompareFunctionVO) getValueObject();
///////////////////////////////////////////////////////////////////////////////////////
/d / Dus de originele CompareFunctionVO, create toen we 'create rate parameter' click, en het form werd create	,

////////////////////////////////////////////////////////////////////////////////////////////

/ 7	. 

/ we gaan verder	,

		RateParameterVO myParameterVO = myFunction.getRateFunction().getRateParameter();
theSystemId: 0Name :testcompare77

		RateAgreementVO myRateAgreementVO = MpoBeanFactory.getBean(RateAgreementDAO.class).getBySystemId(myParameterVO.getRateAgreementVO().getSystemId());
/ WH onnodig
/ Deze is toch	,
myFunction.rateFunction.theRateParameter.theRateAgreement
/ TODO PETER/PAUL
/ OVERCOPY

		for (RateParameterVO rateParameterVO : myRateAgreementVO.getRateParameterList()) {
/ allemaal	,
			if (myParameterVO.equals(rateParameterVO)) {
/ NEE
/ onze nieuwe 'testcompare77" zit niet bij de bestaande, hij is nieuw	,

		if (myExistingParameter == null) {
/ JA
			myExistingParameter = myParameterVO;
/ RateParameterVO,  theSystemId: 0Name :testcompare77 

			myRateAgreementVO.getParameterList().add(myExistingParameter);
/ zet 'm bij de grote lijst	,

			myExistingFunction = new RateFunctionVO();
/ Waarom, is er al	,
/ TODO PETER/PAUL
			myExistingFunction.setFunctionDefinitionVO(myFunction.getRateFunction().getFunctionDefinitionVO());

			MpoBeanFactory.getBean(RateFunctionDAO.class).save(myExistingFunction);

			myExistingParameter.setOutputfromFunctionVO(myExistingFunction);
/ sets theOutputFromFunction in de RateParameterVO testcompare77  (die we hadden create toen we 'create rate parameter' hadden click)	,

			MpoBeanFactory.getBean(RateParameterDAO.class).save(myExistingParameter);
			MpoBeanFactory.getBean(RateAgreementDAO.class).save(myRateAgreementVO);
/ TODO ERIC
/ (Waarom MpoBeanFactory.getBean(RateParameterDAO.class), en MpoBeanFactory.getBean(RateAgreementDAO.class), we doen toch altijd session.save	,

/ We hebben nu	,

this	CompareFunctionSaveAction  (id=18339)	

myFunction	CompareFunctionVO  (id=18300)	
	rateFunction	RateFunctionVO  (id=18306)	 							// orig. rate function	, 
		systemId	0	
		theFunctionDefinition	FunctionDefinitionVO  (id=18321)			// Definition :com.mpobjects.oms.ratecalc.model.process.function.CompareFunction
																			// 	,Name :COMPARE
		theInputParameterList	HashSet  (id=18357)							// [SystemId: 0, SystemId: 0, SystemId: 0]
		theRateParameter	RateParameterVO  (id=18375)						// orig rate param	,
			systemId	26752128	
			theName	"testcompare77" (id=18462)	
			theOutputfromFunction	RateFunctionVO  (id=19634)				// WAS null, is nieuwe rate function , != waar we in zijn	,  dus NIET pointer back
				systemId	26752127	
				theFunctionDefinition	FunctionDefinitionVO  (id=18321)	// Definition :com.mpobjects.oms.ratecalc.model.process.function.CompareFunction
																			// 	,Name :COMPARE
				theInputParameterList	PersistentSet  (id=19772)	
				theRateParameter	null	
				theRateTable	null	
				theUnit	null	
				theUserFuncDef	null	
			theRateAgreement	RateAgreementVO_$$_javassist_91  (id=19624)	
		theRateTable	null	
		theUnit	null	
		theUserFuncDef	null	
	systemId	0	

myExistingParameter	RateParameterVO  (id=18375)	
myExistingFunction	RateFunctionVO  (id=19634)	

/ Einde We hebben nu	,

		CompareFunctionVO myNewFunction = new CompareFunctionVO(myExistingFunction);
		myNewFunction.setLeftHand(myFunction.getLeftHand());
/ OVERCOPY
/s
CompareFunctionVO.getLeftHand() line: 23	
		return getInputParameterSource(CompareFunction.LEFT_HAND, false);
/ this = orig CompareFunctionVO	, 
/ CompareFunction.LEFT_HAND="LEFT_HAND"
/s
CompareFunctionVO(AbstractFunctionModelVO).getInputParameterSource(String, boolean) line: 39	
		InputParameterVO myArgumentInputParameter = rateFunction.getInputParameterOfType(paramName, mandatory);
/s
RateFunctionVO.getInputParameterOfType(String, boolean) line: 175	
/ paramName="LEFT_HAND"
/ this= orig RateFunctionVO
		Collection myInputParameterList = getInputParameterList();
[SystemId: 0, SystemId: 0, SystemId: 0]
		for (Iterator myIt = myInputParameterList.iterator(); myIt.hasNext();) {
			InputParameterVO myInputParameterVO = (InputParameterVO) myIt.next();
			if (myInputParameterVO.getFuncParDefVO() != null && myInputParameterVO.getFuncParDefVO().getName().equals(aParamName)) {
theSystemId: 10010Name :LEFT_HAND
				return myInputParameterVO;
/t
CompareFunctionVO(AbstractFunctionModelVO).getInputParameterSource(String, boolean) line: 40	
		InputParameterVO myArgumentInputParameter = rateFunction.getInputParameterOfType(paramName, mandatory);
/d
		return InputParameterSource.getInputParamaterSourceId(myArgumentInputParameter);
/s
InputParameterSource.getInputParamaterSourceId(InputParameterVO) line: 41	
			} else if (aInputParameterVO.getParameterVO() != null) {
				myId = InputParameterSource.PARAMETER_PREFIX + aInputParameterVO.getParameterVO().getSystemId();
/ systemId van de rp RP_RELEASE_DATE , 
PA26631774

/t
CompareFunctionSaveAction.handleSave() line: 65	
		myNewFunction.setLeftHand(myFunction.getLeftHand());
/s
CompareFunctionVO.setLeftHand(String) line: 41	
/=
	public void setLeftHand(String aValue) {
aValue	"PA26631774" (id=20722)	
		setInputParamaterSource(CompareFunction.LEFT_HAND, aValue);
/s
CompareFunctionVO(AbstractFunctionModelVO).setInputParamaterSource(String, String) line: 80	
		InputParameterVO myParameter = rateFunction.getInputParameterOfType(aParam, false);
null
/ rateFunction is de nieuwe	,
		if (myParameter == null) {
			myParameter = new InputParameterVO();
			myParameter.setFuncParDefVO(MpoBeanFactory.getBean(FuncParameterDefDAO.class).getByName(aParam));
			rateFunction.addInputParameter(myParameter);

		InputParameterSource.setInputParamaterSource(myParameter, aValue);
"PA26631774"
/s
InputParameterSource.setInputParamaterSource(InputParameterVO, String) line: 60	
		} else if (aSourceId.startsWith(InputParameterSource.PARAMETER_PREFIX)) {
				RateParameterVO myRateParameter = MpoBeanFactory.getBean(RateParameterDAO.class).getBySystemId( new Integer(aSourceId.substring(InputParameterSource.PARAMETER_PREFIX.length())));
myRateParameter	RateParameterVO_$$_javassist_136  (id=19034)	
theSystemId: 26631774Name :RP_RELEASE_DATE
				aInputParameterVO.setOrderDetailVO(null);
				aInputParameterVO.setParameterVO(myRateParameter);
/t
CompareFunctionSaveAction.handleSave() line: 66	
		myNewFunction.setLeftHand(myFunction.getLeftHand());
/d

		myNewFunction.setRightHand(myFunction.getRightHand());
		myNewFunction.setType(myFunction.getType());

myExistingParameter	RateParameterVO  (id=18375)						/ orig rp	, bij create 	
	theOutputfromFunction	RateFunctionVO  (id=19634)				/ nieuwe rf
		theFunctionDefinition	FunctionDefinitionVO  (id=18321)	/ COMPARE 
		theInputParameterList	PersistentSet  (id=19772)			/ [SystemId: 0, SystemId: 26752129, SystemId: 26752130]	
		theRateParameter	null	

/ Intermezzo

/ deze orig rp zit ook in een fct	, waarvan ik dacht dat dat de theOutputFromFunction was	,

compareFct				18300
	rf					18306
		rp 				18375
			theOutputFromFunction 19634	 / != 18306

/ Doet dit er toe	?



/ Einde Intermezzo

		myExistingParameter.setName(myParameterVO.getName());
/ orig rp met nieuwe rf ( de rf waar rp inzit is de oude rf)	,

		myExistingParameter.setName(myParameterVO.getName());
/ Onnodig , want  myExistingParameter==myParameterVO
/ TODO PETER/PAUL

		getRequest().setAttribute("systemid", new Integer(myExistingFunction.getSystemId()));

		getRequest().setAttribute("systemid", new Integer(myExistingFunction.getSystemId()));
		getSession().setAttribute("formvo", myNewFunction);
/ De orig CompareFunctionVO wordt vervangen door de nieuwe	,

/ we doen in 	,
public class CompareFunctionSaveAction extends AbstractFunctionSaveAction {
	public void handleSave() throws Exception {
		MpoBeanFactory.getBean(RateAgreementDAO.class).getCurrentSession().flush();
/ TODO

/ 7	. 

/ we kijken in de hibernate.log wat er gebeurt	,

/ create

701075 2015-05-06 11:02:26,596 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-7:) insert into RATE_FUNCTION (FUNCTION_DEFINITION_SYSTEMID, IS_USER_DEFINED, USER_FUNC_DEF, RATE_TABLE_SYSTEMID, UNIT_SYSTEMID, SYSTEM_ID) values (?, ?, ?, ?, ?, ?)
701076 2015-05-06 11:02:26,597 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [1] as [INTEGER] - 100
701087 2015-05-06 11:02:26,597 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [6] as [INTEGER] - 26752137

701116 2015-05-06 11:02:26,612 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-7:) insert into RATE_PARAMETER (NAME, DESCRIPTION, RATE_AGREEMENT_SYSTEMID, OUTPUTFROM_FUNCTION_SYSTEMID, PARAMETER_TYPE_SYSTEMID, IS_PERSISTENT, SEQUENCE_NR, IS_USER_EDITABLE, ITERATION_ENTITY, ITERATION_ACTION, SYSTEM_ID) values (?, ?, ?, ?,        ?, ?, ?, ?, ?, ?, ?)
701117 2015-05-06 11:02:26,613 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [1] as [VARCHAR] - testcompare13
701121 2015-05-06 11:02:26,614 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [3] as [INTEGER] - 26631689
701123 2015-05-06 11:02:26,614 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [4] as [INTEGER] - 26752137
701137 2015-05-06 11:02:26,614 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [11] as [INTEGER] - 26752138

701162 2015-05-06 11:02:26,634 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-7:) insert into INPUT_PARAMETER (PARAMETER_SYSTEMID, ORDER_DETAIL_SYSTEMID, FUNC_PAR_DEF_SYSTEMID, RATE_FUNC_SYSTEMID, CONFIGURATION_VALUE, FREE_VALUE, SYSTEM_ID) values (?, ?, ?, ?, ?, ?, ?)
701167 2015-05-06 11:02:26,636 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [3] as [INTEGER] - 10010
701169 2015-05-06 11:02:26,637 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [4] as [INTEGER] - 26752137
701175 2015-05-06 11:02:26,641 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [7] as [INTEGER] - 26752139

701235 2015-05-06 11:02:26,663 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-7:) insert into INPUT_PARAMETER (PARAMETER_SYSTEMID, ORDER_DETAIL_SYSTEMID, FUNC_PAR_DEF_SYSTEMID, RATE_FUNC_SYSTEMID, CONFIGURATION_VALUE, FREE_VALUE, SYSTEM_ID) values (?, ?, ?, ?, ?, ?, ?)
701240 2015-05-06 11:02:26,664 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [3] as [INTEGER] - 10020
701243 2015-05-06 11:02:26,664 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [4] as [INTEGER] - 26752137
701249 2015-05-06 11:02:26,664 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [7] as [INTEGER] - 26752140

701306 2015-05-06 11:02:26,709 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-7:) insert into INPUT_PARAMETER (PARAMETER_SYSTEMID, ORDER_DETAIL_SYSTEMID, FUNC_PAR_DEF_SYSTEMID, RATE_FUNC_SYSTEMID, CONFIGURATION_VALUE, FREE_VALUE, SYSTEM_ID) values (?, ?, ?, ?, ?, ?, ?)
701311 2015-05-06 11:02:26,711 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [3] as [INTEGER] - 10030
701314 2015-05-06 11:02:26,711 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [4] as [INTEGER] - 26752137
701315 2015-05-06 11:02:26,711 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [5] as [VARCHAR] - DATE
701319 2015-05-06 11:02:26,711 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [7] as [INTEGER] - 26752141

mpo_2015_01=# select*from rate_function where system_id=26752137;
 system_id | function_definition_systemid | is_user_defined | user_func_def | rate_table_systemid | unit_systemid 
-----------+------------------------------+-----------------+---------------+---------------------+---------------
  26752137 |                          100 |               0 |               |                     |              

mpo_2015_01=#  select*from rate_parameter where system_id=26752138;
 system_id |     name      | description | outputfrom_function_systemid | rate_agreement_systemid | is_persistent | sequence_nr | parameter_type_systemid | is_user_editable | iteration_entity | iteration_action 
------------+------------------+------------------
  26752138 | testcompare13 |             |                     26752137 |                26631689 |             0 |           0 |                         |      0 |                  | 
(1 row)

mpo_2015_01=# select*from input_parameter where system_id= 26752139;
 system_id | parameter_systemid | func_par_def_systemid | rate_func_systemid | dimension_systemid | configuration_value | order_detail_systemid | free_value 
-----------+--------------------+-----------------------+--------------------+--------------------+---------------------+-----------------------+------------
  26752139 |           26631774 |                 10010 |           26752137 |                    |                     |                       |           
(1 row)
/ 26631774 is een bestaande rp	, RP_RELEASE_DATE

mpo_2015_01=# select*from input_parameter where system_id= 26752140;
 system_id | parameter_systemid | func_par_def_systemid | rate_func_systemid | dimension_systemid | configuration_value | order_detail_systemid | free_value 
-----------+--------------------+-----------------------+--------------------+--------------------+---------------------+-----------------------+------------
  26752140 |           26631807 |                 10020 |           26752137 |                    |                     |                       |           
(1 row)
/ 26631807 is een bestaande rp	, RP_START_DATE

mpo_2015_01=# select*from input_parameter where system_id= 26752141;
 system_id | parameter_systemid | func_par_def_systemid | rate_func_systemid | dimension_systemid | configuration_value | order_detail_systemid | free_value 
-----------+--------------------+-----------------------+--------------------+--------------------+---------------------+-----------------------+------------
  26752141 |                    |                 10030 |           26752137 |                    | DATE                |                       |           
(1 row)

/ delete

1091842 2015-05-06 11:28:27,121 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-2:) delete from RATE_PARAMETER where SYSTEM_ID=?
1091843 2015-05-06 11:28:27,122 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:) binding parameter [1] as [INTEGER] - 26752138

1091851 2015-05-06 11:28:27,123 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-2:) delete from INPUT_PARAMETER where SYSTEM_ID=?
1091852 2015-05-06 11:28:27,123 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:) binding parameter [1] as [INTEGER] - 26752139

1091860 2015-05-06 11:28:27,123 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-2:) delete from INPUT_PARAMETER where SYSTEM_ID=?
1091861 2015-05-06 11:28:27,123 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:) binding parameter [1] as [INTEGER] - 26752140

1091869 2015-05-06 11:28:27,123 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-2:) delete from INPUT_PARAMETER where SYSTEM_ID=?
1091870 2015-05-06 11:28:27,123 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:) binding parameter [1] as [INTEGER] - 26752141

1091878 2015-05-06 11:28:27,124 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-2:) delete from RATE_FUNCTION where SYSTEM_ID=?
1091879 2015-05-06 11:28:27,124 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-2:) binding parameter [1] as [INTEGER] - 26752137

/ 7	. 

/ we hebben de FIX PNL-456 gedaan	,

public class CompareFunctionSaveAction extends AbstractFunctionSaveAction {
	public void handleSave() throws Exception {
		if (myExistingParameter == null) {
			...
->			myExistingFunction.setRateParameter(myExistingParameter);

/ Is er een verschil in de db?

$ vi RateFunction.standard.hbm.xml

	<class name="com.mpobjects.oms.ratecalc.model.ratefunction.vo.RateFunctionVO" table="RATE_FUNCTION">
		<one-to-one name="rateParameter" class="com.mpobjects.oms.ratecalc.model.rateparameter.vo.RateParameterVO" property-ref="outputfromFunctionVO" />


mpo_2015_01=# select*from rate_function where system_id=26752147;
 system_id | function_definition_systemid | is_user_defined | user_func_def | rate_table_systemid | unit_systemid 
-----------+------------------------------+-----------------+---------------+---------------------+---------------
  26752147 |                          100 |               0 |               |                     |              
(1 row)


mpo_2015_01=#  select*from rate_parameter where system_id=26752148;
 system_id |     name     | description | outputfrom_function_systemid | rate_agreement_systemid | is_persistent | sequence_nr | parameter_type_systemid | is_user_editable | iteration_entity | iteration_action 
-----------+------------------+------------------
  26752148 | testcompare7 |             |                     26752147 |                26631689 |             0 |           0 |                         |       
         0 |                  | 
(1 row)


/ we zien geen verschil in de tables, of we 	, 
->			myExistingFunction.setRateParameter(myExistingParameter);
/ of niet

/ TODO ERIC (one-to-one	)

/ als we zelf een service willen maken 	, doe dan zoals	,
/ kies ServiceOrderService.java	, kies een method	, click ctrl+alt+h	, en we zien	,
/ TODO ERIC 


/ Einde PNL-546 COCOON

/ FIX PNL-546

public class CompareFunctionSaveAction extends AbstractFunctionSaveAction {
	public void handleSave() throws Exception {
		if (myExistingParameter == null) {
			myExistingParameter = myParameterVO;
			myRateAgreementVO.getParameterList().add(myExistingParameter);
			myExistingParameter.setRateAgreementVO(myRateAgreementVO);
			myExistingFunction = new RateFunctionVO();
			myExistingFunction.setFunctionDefinitionVO(myFunction.getRateFunction().getFunctionDefinitionVO());
->			myExistingFunction.setRateParameter(myExistingParameter);
			MpoBeanFactory.getBean(RateFunctionDAO.class).save(myExistingFunction);
			myExistingParameter.setOutputfromFunctionVO(myExistingFunction);
			MpoBeanFactory.getBean(RateParameterDAO.class).save(myExistingParameter);
			MpoBeanFactory.getBean(RateAgreementDAO.class).save(myRateAgreementVO);
		}

/ -> erbij	,

	public void handleSave() throws Exception {
		RateParameterVO myParameterVO = myFunction.getRateFunction().getRateParameter();
		RateAgreementVO myRateAgreementVO = MpoBeanFactory.getBean(RateAgreementDAO.class).getBySystemId(myParameterVO.getRateAgreementVO().getSystemId());
/ TODO PETER/PAUL (onnodige query, zit al in myParamaterVO)

		myExistingParameter.setName(myParameterVO.getName());
/ TODO PETER/PAUL (onnodgi, myExistingParameter==myParameterVO)

/ Wat er gebeurt is	,

myFunction 17754
	rate fct 	17769
		input param list	17794
		rate param		17797					/ = myExistingParameter
			theOutputfromFunction	17836		/ was null, wordt hier set (was al) door myExistingParameter.setOutputfromFunctionVO(myExistingFunction)
->				rate param 17797				/ hebben we hier set bij -> (nieuw)	,		 

/ 7	. 

/ public class ScheduleFunctionSaveAction extends AbstractFunctionSaveAction {
/ was al OK	, daar wordt geen copy van de rate fct create, zoals in CompareFunctionSaveAction	, 
/ maar wel worden left hand, ... opnieuw gedaan , ONNODIG WH	,
/ TODO ERIC 

/ Einde FIX PNL-546

/ PNL-546

/ 13	. 

/ we zijn op test, pnloms	,

/van Jan	,

/ we zien rate parameter	,
END_DATE_COMP
Left hand: RP_REQ_START_AFTER_D 
Right hand: RP_REQ_END_BEFORE_D
Type: Date

/ we zien rate component	,
RC_END_DATE_COMP
Parameter: END_DATE_COMP
Objective: COST
Entity type: SHIPMENT_ORDER
Correction type: ADD
Rete component type: NONE (COST)
Calculation type: Post calculated (Estimated)
Rate Plus: NONE

/ we maken zelf	de rp op test, pnl	,

TEST_COMP
Left hand: RP_REQ_START_AFTER_D 
Right hand: RP_REQ_END_BEFORE_D
Type: Date

/ we maken zelf	de rc	,

RC_TEST_COMP
Parameter: TEST_COMP
Objective: COST
Entity type: SHIPMENT_ORDER
Correction type: ADD
Rete component type: NONE (COST)
Calculation type: Post calculated (Estimated)
Rate Plus: NONE

/ Open een sho	, click op Recalculate rate	, en click op kosten	, 
/ nu staat hij erbij	,RC_TEST_COMP	,

/ 13	. 

/ Nu local, 2015.01, 

/ er zijn rc voor shipment order, en voor service order	,

/ er is rate agreement, die 'REENEN' heet	, 
Type: Service order

/ dit is dus een rate agreement voor service orders	,
/ we moeten straks dus een service order select, en geen shipment order	,

/ we maken een rate param 	,
testcompare
Left hand: RP_RELEASE_DATE
Right hand: RP_START_DATE
Type: Date

/ we maken een rate component	,
rc_test_comp
Rate agreement: REENEN
Name: rc_test_comp
Description: test compare
RC_TEST_COMP
Parameter: testcompare 
Objective: COST
Entity type: SERVICE_ORDER
Correction type: ADD
Rete component type: NONE (COST)
Calculation type: Post calculated (Estimated)
Rate Plus: NONE

/ we zoeken een seo	, die vervoerder 'van Reenen' heeft	, (4de kolom van achter)	,
N0001780
/ we click opnieuw berekenen, en click cost	,
/ we zien rc_test_comp erbij	,

/TODO Selection criteria	,

/ we kunnen op service order
Gepl. Datum Vertr.
Gepl. Datum Aank.
/ kiezen	, 

/ we zien als we een compare rate component create, bij left hand een dropdownlist	,
/ hierin zien we rate components, zoals RP_START_DATE, en order details zoals REQ_START_DATE	, en rate tables, en ...



/ Einde PNL-546

/ DEBUG PNL-546

/ 7	.

/ fix	, 
$ vi CompareFunctionSaveAction.java

		if (myParameterVO.getSystemId() != ValueObject.VOLATILE_SYSTEM_ID) {
			myParameterVO = MpoBeanFactory.getBean(RateParameterDAO.class).getBySystemId(myParameterVO.getSystemId());
		}

/ 7	.

/ Maar dan nieuwe fout	,

public abstract class AbstractFunctionModelVO extends ValueObject {
	public String getName() {
		return rateFunction.getRateParameter().getName();

/ rateFunction.getRateParameter()==null	,
/ ERR

/ we gaan eerst de parameter create debug	,

/ we set b in 

public class RateFunctionInitAndSwitchAction extends AbstractRateFunctionAction {
	@Override
	public Map act() throws Exception {
->

/ 7	. 

/ we kiezen rate agreement 'REENEN',

/ we edit eerst een bestaande par	, we kiezen RP_START_DATE

/ we vallen in 	,
RateFunctionInitAndSwitchAction.act() line: 56	

		int mySystemId = getSystemIdFromRequest();
26631807

/ Intermezzo

/ klopt	,

mpo_2015_01=# select*from rate_parameter where system_id=26631807;
 system_id |     name      | description | outputfrom_function_systemid | rate_agreement_systemid | is_persistent | sequence_nr | parameter_type_systemid | is_user_editable | iteration_entity | iteration_action 
------------+------------------+------------------
  26631807 | RP_START_DATE |             |                     26631804 |                26631689 |             0 |           0 |                         |      
          0 |                  | 
(1 row)

/ Einde Intermezzo


		String myTargetScreen = (String) getSession().getAttribute("target_screen");
EditRateParameter

		FunctionDefinitionVO myFunctionDefinition = null;
		RateFunctionVO myRateFunctionVO = null;
		} else if (myTargetScreen.equals("EditRateParameter") || myTargetScreen.equals("Edit")) {
			if (mySystemId != ValueObject.VOLATILE_SYSTEM_ID) {
/ JA
				myRateFunctionVO = MpoBeanFactory.getBean(RateParameterDAO.class).getBySystemId(mySystemId).getOutputfromFunctionVO();// PVD:FIX
myRateFunctionVO	RateFunctionVO_$$_javassist_72  (id=17813)	
handler	JavassistLazyInitializer  (id=17820)	
	target	RateFunctionVO  (id=18209)	
		performanceMonitorService	null	
		systemId	26631804	
26631804
		theFunctionDefinition	FunctionDefinitionVO  (id=18210)	
theSystemId: 3500014
Definition :com.mpobjects.oms.ratecalc.model.process.function.StartDateFunction,Name :STARTDATE
		theInputParameterList	PersistentSet  (id=18211)	
[SystemId: 26673702, SystemId: 26673703]
		theIsUserDefined	false	
		theRateParameter	RateParameterVO  (id=18213)	
theSystemId: 26631807Name :RP_START_DATE
Description :null
		theRateTable	null	
		theUnit	Unit  (id=18218)	
theSystemId: 1000536	Symbol :DATE	Description :Datum	UnitType :DATE	IsDeleted :0	
		theUserFuncDef	null	

/ de 1ste arg is een order detail, de 2de ook een rate parameter	,

/ Intermezzo

/ De input params bij een rate param zijn te vinden via de function	, logisch eigenlijk	,

mpo_2015_01=# select*from rate_parameter where system_id=26631807;
 system_id |     name      | description | outputfrom_function_systemid | rate_agreement_systemid | is_persistent | sequence_nr | parameter_type_systemid | is_user_editable | iteration_entity | iteration_action 
------------+------------------+------------------
  26631807 | RP_START_DATE |             |                     26631804 |                26631689 |             0 |           0 |                         |      0 |                  | 
(1 row)

///////////////////////////////
mpo_2015_01=# select*from input_parameter where rate_func_systemid=26631804
mpo_2015_01-# ;
 system_id | parameter_systemid | func_par_def_systemid | rate_func_systemid | dimension_systemid | configuration_value | order_detail_systemid | free_value 
-----------+--------------------+-----------------------+--------------------+--------------------+---------------------+-----------------------+------------
  26673702 |                    |                       |           26631804 |                    |                     |               4200529 |           
  26673703 |           26659412 |                       |           26631804 |                    |                     |                       |           
(2 rows)

/ we zien al dat de 2de input param ook een rate param is	, de 1ste blijkt een order_detail	,


mpo_2015_01=# select*from input_parameter  where system_id=26673702;
 system_id | parameter_systemid | func_par_def_systemid | rate_func_systemid | dimension_systemid | configuration_value | order_detail_systemid | free_value 
-----------+--------------------+-----------------------+--------------------+--------------------+---------------------+-----------------------+------------
  26673702 |                    |                       |           26631804 |                    |                     |               4200529 |           
(1 row)

mpo_2015_01=# select*from order_detail where system_id=4200529;
 system_id |        path_or_class        |      name       | unit_systemid | parameter_type_systemid |  entity_type  
-----------+-----------------------------+-----------------+---------------+-------------------------+---------------
   4200529 | ./dateSetVO/plannedEndAfter | PLANNED_END_DTM |       1000536 |                 3700005 | SERVICE_ORDER
(1 row)

mpo_2015_01=# select*from input_parameter  where system_id=26673703;
 system_id | parameter_systemid | func_par_def_systemid | rate_func_systemid | dimension_systemid | configuration_value | order_detail_systemid | free_value 
-----------+--------------------+-----------------------+--------------------+--------------------+---------------------+-----------------------+------------
  26673703 |           26659412 |                       |           26631804 |                    |                     |                       |           
(1 row)

mpo_2015_01=# select*from rate_parameter  where system_id=26659412 ;
 system_id |    name     | description | outputfrom_function_systemid | rate_agreement_systemid | is_persistent | sequence_nr | parameter_type_systemid | is_user_editable | iteration_entity | iteration_action 
----------+------------------+------------------
  26659412 | RP_LEADTIME |             |                     26659409 |                26631689 |             0 |           0 |                         |        0 |                  | 
(1 row)

/ we zien dan ook de hibernate mapping	,

	<class name="com.mpobjects.oms.ratecalc.model.ratefunction.vo.RateFunctionVO" table="RATE_FUNCTION">
		<set name="inputParameterList" cascade="all,delete-orphan" lazy="false" inverse="true">
			<cache usage="read-write"/>
			<key column="RATE_FUNC_SYSTEMID"/>
			<one-to-many class="com.mpobjects.oms.ratecalc.model.inputparameter.vo.InputParameterVO" not-found="ignore" />
		</set>

	<class name="InputParameterVO" table="INPUT_PARAMETER" lazy="false">
		<many-to-one name="rateFuncVO" 
			class="com.mpobjects.oms.ratecalc.model.ratefunction.vo.RateFunctionVO" 
			column="RATE_FUNC_SYSTEMID" />

/ dan moet de input_parameter table wel een fk hebben naar de rate_function table	, 
/ en dat is zo		,

mpo_2015_01=# \d+ input_parameter;
        Column         |          Type           | Modifiers | Storage  | Stats target | Description 
-----------------------+-------------------------+-----------+----------+--------------+-------------
 system_id             | integer                 | not null  | plain    |              | 
 rate_func_systemid    | integer                 |           | plain    |              | 
Foreign-key constraints:
    "inp_function_fk" FOREIGN KEY (rate_func_systemid) REFERENCES rate_function(system_id)

/ In de rate function in Java is de set	, deze is niet in de rate_function table	,

/ Einde Intermezzo

/ Intermezzo

/ we maken zelf ook een rate parameter	, 'testcompare'	,

myRateFunctionVO	RateFunctionVO_$$_javassist_72  (id=18145)	
	handler	JavassistLazyInitializer  (id=18149)	
		target	RateFunctionVO  (id=18153)	
			systemId	26752089	
			theFunctionDefinition	FunctionDefinitionVO  (id=18146)	
				definition	"com.mpobjects.oms.ratecalc.model.process.function.CompareFunction" (id=18147)	
				name	"COMPARE" (id=18148)	
				systemId	100	
			theInputParameterList	PersistentSet  (id=18154)	
				key	Integer  (id=18185)	
				role	"com.mpobjects.oms.ratecalc.model.ratefunction.vo.RateFunctionVO.inputParameterList" (id=17635)	
				set	HashSet  (id=18194)	
					map	HashMap  (id=18208)	
						table	HashMap$Entry[8]  (id=18235)	
							[4]	HashMap$Entry  (id=18256)	
								key	InputParameterVO  (id=18266)	
									systemId	26752092	
									theFreeValue	null	
									theFuncParDef	FuncParameterDefVO  (id=18278)	
theSystemId: 10020Name :RIGHT_HAND
FuncDefSystemid :100
ParameterTypeSystemid :3700001
									theOrderDetail	null	
									theParameter	RateParameterVO_$$_javassist_136  (id=18281)	
theSystemId: 26631774Name :RP_RELEASE_DATE
Description :null
									theRateFunc	RateFunctionVO_$$_javassist_72  (id=18145)	
com.mpobjects.oms.ratecalc.model.ratefunction.vo.RateFunctionVO/id:26752089
/ poinnter back	,
								next	HashMap$Entry  (id=18267)	
									key	InputParameterVO  (id=18430)	
										systemId	26752091	
										theConfigurationValue	null	
										theFreeValue	null	
										theFuncParDef	FuncParameterDefVO  (id=18435)	
theSystemId: 10010Name :LEFT_HAND
FuncDefSystemid :100
ParameterTypeSystemid :3700001
										theOrderDetail	null	
										theParameter	RateParameterVO_$$_javassist_136  (id=18438)	
theSystemId: 26631807Name :RP_START_DATE
Description :null
/ deze heeft ook een output_fromfunction	,
										theRateFunc	RateFunctionVO_$$_javassist_72  (id=18145)	
com.mpobjects.oms.ratecalc.model.ratefunction.vo.RateFunctionVO/id:26752089
/ pointer back	,
							[6]	HashMap$Entry  (id=18257)	
								key	InputParameterVO  (id=18285)	
									systemId	26752093	
									theConfigurationValue	"DATE" (id=19343)	
									theFreeValue	null	
									theFuncParDef	FuncParameterDefVO  (id=19344)	
theSystemId: 10030Name :TYPE
FuncDefSystemid :100
ParameterTypeSystemid :3700001
									theOrderDetail	null	
									theParameter	null	
									theRateFunc	RateFunctionVO_$$_javassist_72  (id=18145)	
com.mpobjects.oms.ratecalc.model.ratefunction.vo.RateFunctionVO/id:26752089
/ pointer back	,
									theRateResult	null	
			theRateParameter	RateParameterVO_$$_javassist_136  (id=18155)	
				handler	JavassistLazyInitializer  (id=18290)	
					target	RateParameterVO  (id=18311)	
						systemId	26752090	
						theName	"testcompare" (id=18319)	
						theOutputfromFunction	RateFunctionVO_$$_javassist_72  (id=18145)	
com.mpobjects.oms.ratecalc.model.ratefunction.vo.RateFunctionVO/id:26752089
/ pointer back	,
						theParameterType	null	
						theRateAgreement	RateAgreementVO_$$_javassist_91  (id=18323)	
theSystemId: 26631689Name :REENEN
Description :null
Organization :SystemId:4000	Id:HAAL-ZW	Description:HAAL
Unit :theSystemId: 1000072	Symbol :EUR	Description :Euro	UnitType :CURRENCY	IsDeleted :0	
IsDeleted :false
Type :SERVICE_ORDER
						theSequenceNr	0	

/ Einde Intermezzo

			myFunctionDefinition = myRateFunctionVO.getFunctionDefinitionVO();
theSystemId: 3500014
Definition :com.mpobjects.oms.ratecalc.model.process.function.StartDateFunction,Name :STARTDATE

		Redirector myRedirector = getRedirector();
org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor$TreeProcessorRedirector@54c144dc

		String myDefinition = myFunctionDefinition.getDefinition();
com.mpobjects.oms.ratecalc.model.process.function.StartDateFunction

		if (myDefinition.equals(RoundingFunction.class.getName())) {
/ NEE
		} else {
			RateFunctionNoParamDefsFormBean myRateFunctionNoParamDefsFormBean = new RateFunctionNoParamDefsFormBean(myRateFunctionVO);
			myRateFunctionNoParamDefsFormBean.convertFormDataFromRateFunction();
/s
RateFunctionNoParamDefsFormBean.convertFormDataFromRateFunction() line: 49	
		myRateAgreementName = theRateFunction.getRateParameter().getRateAgreementVO().getName();
"REENEN"
		Collection<InputParameterVO> myInputParams = theRateFunction.getInputParameterList();

		for (InputParameterVO element : myInputParams) {
			BigDecimal myFreeValue = element.getFreeValue();
			if (myFreeValue != null) {
/ NEE
			} else if (element.getOrderDetailVO() != null) {
/ JA 1ste	,
				theSoDetailList.add(new Integer(element.getOrderDetailVO().getSystemId()));
			} else {
/ JA, 2de	,
				theInputParameterList.add(new Integer(element.getParameterVO().getSystemId()));
			}
this	RateFunctionNoParamDefsFormBean  (id=18322)	
	myRateAgreementName	"REENEN" (id=18328)	
	theFreeValue	null	
	theFuncDef	null	
	theInputParameterList	ArrayList  (id=18325)	
[26659412]
	theRateFunction	RateFunctionVO_$$_javassist_72  (id=17813)	
	theSoDetailList	ArrayList  (id=18326)	
[4200529]

/t
RateFunctionInitAndSwitchAction.act() line: 122	
			myRateFunctionNoParamDefsFormBean.convertFormDataFromRateFunction();
/d
myRateFunctionNoParamDefsFormBean	RateFunctionNoParamDefsFormBean  (id=18322)	
	myRateAgreementName	"REENEN" (id=18328)	
	theFreeValue	null	
	theFuncDef	null	
	theInputParameterList	ArrayList  (id=18325)	
[26659412]
	theRateFunction	RateFunctionVO_$$_javassist_72  (id=17813)	
	theSoDetailList	ArrayList  (id=18326)	
[4200529]

			getSession().setAttribute(ACTIVE_RATEFUNCTION_FORMBEAN, myRateFunctionNoParamDefsFormBean);
			myRedirector.redirect(true, "rate_function_no_func_param_defs_init");

/ Intermezzo

$ vi ratecalc-sitemap.xml

            <map:match pattern="rate_function_no_func_param_defs_init">
                <map:call function="handleForm">
                    <map:parameter name="function" value="ratefunction_no_func_param_defs_init"/>
                    <map:parameter name="form-definition" value="cforms/ratefunction/forms/rate-function-no-func-param-defs-form.xml"/>
                    <map:parameter name="bindingURI" value="cforms/ratefunction/forms/rate-function-no-func-param-defs-binding.xml"/>
                </map:call>
            </map:match>

/ Einde Intermezzo

/ we geven continue	,

CompareFunctionVO(AbstractFunctionModelVO).getName() line: 47	
		return rateFunction.getRateParameter().getName();
"testcompare"

/ we geven continue	,
/t
/s
$ vi compare-function_edit.jsp
					<mpo:dropDownField name="leftHand" dataType="string" required="true">
/s
DropDownFieldTag.doEndTag() line: 121	
				myCurrentValue = VOReflectionInvoker.getValueAsString(getActiveValueObject(), getName());
/ getActiveValueObject()=com.mpobjects.oms.ratecalc.model.process.form.CompareFunctionVO/id:26752089
/ getName()="leftHand"
/s
CompareFunctionVO.getLeftHand() line: 23	
		return getInputParameterSource(CompareFunction.LEFT_HAND, false);
/s
CompareFunctionVO(AbstractFunctionModelVO).getInputParameterSource(String, boolean) line: 40	
->		InputParameterVO myArgumentInputParameter = rateFunction.getInputParameterOfType(paramName, mandatory);
/ paramName="LEFT_HAND"
/s
RateFunctionVO.getInputParameterOfType(String, boolean) line: 175	
this	RateFunctionVO  (id=18074)	
com.mpobjects.oms.ratecalc.model.ratefunction.vo.RateFunctionVO/id:26752089
		Collection myInputParameterList = getInputParameterList();
[SystemId: 26752092, SystemId: 26752091, SystemId: 26752093]
/ Klopt	,
/ Intermezzo

mpo_2015_01=# select*from input_parameter where rate_func_systemid=26752089;
 system_id | parameter_systemid | func_par_def_systemid | rate_func_systemid | dimension_systemid | configuration_value | order_detail_systemid | free_value 
-----------+--------------------+-----------------------+--------------------+--------------------+---------------------+-----------------------+------------
  26752093 |                    |                 10030 |           26752089 |                    | DATE                |                       |           
  26752091 |           26631807 |                 10010 |           26752089 |                    |                     |                       |           
  26752092 |           26631774 |                 10020 |           26752089 |                    |                     |                       |           
(3 rows)

/ de middelste is LEFT_HAND	, (eig. heeft  func_par_def_systemid='LEFT_HAND'	,

/ 2 zijn er ook een rate param	,

/ Einde Intermezzo

/ we zijn nog in	,
RateFunctionVO.getInputParameterOfType(String, boolean) line: 178	
/ aParamNeme="LEFT_HAND"
		Collection myInputParameterList = getInputParameterList();
/d
		for (Iterator myIt = myInputParameterList.iterator(); myIt.hasNext();) {
			InputParameterVO myInputParameterVO = (InputParameterVO) myIt.next();
			if (myInputParameterVO.getFuncParDefVO() != null && myInputParameterVO.getFuncParDefVO().getName().equals(aParamName)) {
				return myInputParameterVO;
/t
CompareFunctionVO(AbstractFunctionModelVO).getInputParameterSource(String, boolean) line: 40	
		InputParameterVO myArgumentInputParameter = rateFunction.getInputParameterOfType(paramName, mandatory);
/d
SystemId: 26752091
		return InputParameterSource.getInputParamaterSourceId(myArgumentInputParameter);
/s
InputParameterSource.getInputParamaterSourceId(InputParameterVO) line: 41	
			if (aInputParameterVO.getOrderDetailVO() != null) {
/ NEE
			} else if (aInputParameterVO.getParameterVO() != null) {
				myId = InputParameterSource.PARAMETER_PREFIX + aInputParameterVO.getParameterVO().getSystemId();

/ Intermezzo

aInputParameterVO	InputParameterVO  (id=18430)	
SystemId: 26752091
	theParameter	RateParameterVO_$$_javassist_136  (id=18438)	
theSystemId: 26631807Name :RP_START_DATE
/ Klopt	,

/ Intermezzo

mpo_2015_01=# select*from input_parameter where system_id=26752091;
 system_id | parameter_systemid | func_par_def_systemid | rate_func_systemid | dimension_systemid | configuration_value | order_detail_systemid | free_value 
-----------+--------------------+-----------------------+--------------------+--------------------+---------------------+-----------------------+------------
  26752091 |           26631807 |                 10010 |           26752089 |                    |                     |                       |           
(1 row)

mpo_2015_01=# select rp.*from input_parameter ip join rate_parameter rp on ip.parameter_systemid=rp.system_id where ip.system_id=26752091;
 system_id |     name      | description | outputfrom_function_systemid | rate_agreement_systemid | is_persistent | sequence_nr | parameter_type_systemid | is_user_editable | iteration_entity | iteration_action 
------------+------------------+------------------
  26631807 | RP_START_DATE |             |                     26631804 |                26631689 |             0 |           0 |                         |      0 |                  | 
(1 row)

/ deze heeft system_id=26631807	,

/ Einde Intermezzo

				myId = InputParameterSource.PARAMETER_PREFIX + aInputParameterVO.getParameterVO().getSystemId();
"PA26631807"

/t
DropDownFieldTag.doEndTag() line: 124	
				myCurrentValue = VOReflectionInvoker.getValueAsString(getActiveValueObject(), getName());
"PA26631807"

 7	. 

/ create zelf een rate parameter	,

/ HIER HIER HIER HIER

/ we kiezen rate agreement 'REENEN',

/ op rate parameter panel, onderin, kies COMPARE	, en click de 'create new rate parameter' button	,

/s
RateFunctionInitAndSwitchAction.act() line: 56	

		int mySystemId = getSystemIdFromRequest();
		String myTargetScreen = (String) getSession().getAttribute("target_screen");
mySystemId 100	
myTargetScreen	"CreateRateParameter" (id=18376)	

/ Intermezzo

/ 100 is de compare fct	,

mpo_2015_01=# select*from function_definition where system_id=100;
 system_id |                            definition                             |  name   
-----------+-------------------------------------------------------------------+---------
       100 | com.mpobjects.oms.ratecalc.model.process.function.CompareFunction | COMPARE
(1 row)

/ Einde Intermezzo

		FunctionDefinitionVO myFunctionDefinition = null;
		RateFunctionVO myRateFunctionVO = null;
		if (myTargetScreen.equals("CreateRateParameter")) {

			myFunctionDefinition = MpoBeanFactory.getBean(FunctionDefinitionDAO.class).getBySystemId(mySystemId);
theSystemId: 100
Definition :com.mpobjects.oms.ratecalc.model.process.function.CompareFunction,Name :COMPARE

/ Intermezzo

/ Dit zien we in de hibernate.log	,

2510490 2015-04-29 12:16:34,762 DEBUG [org.hibernate.cache.ReadWriteCache] (http-0.0.0.0-8080-5:) Cache lookup: com.mpobjects.oms.ratecalc.model.functiondefinition.        vo.FunctionDefinitionVO#100
2510492 2015-04-29 12:16:34,762 DEBUG [org.hibernate.cache.EhCache] (http-0.0.0.0-8080-5:) key: com.mpobjects.oms.ratecalc.model.functiondefinition.vo.FunctionDefintionVO#100
2510494 2015-04-29 12:16:34,763 DEBUG [org.hibernate.cache.ReadWriteCache] (http-0.0.0.0-8080-5:) Cache hit: com.mpobjects.oms.ratecalc.model.functiondefinition.vo.FunctionDefinitionVO#100

/ Einde Intermezzo

			getSession().setAttribute(ACTIVE_FUNCTION_DEFINITION, myFunctionDefinition);
			myRateFunctionVO = new RateFunctionVO();
com.mpobjects.oms.ratecalc.model.ratefunction.vo.RateFunctionVO/id:0
			RateParameterVO myRateParameterVO = new RateParameterVO();
com.mpobjects.oms.ratecalc.model.ratefunction.vo.RateFunctionVO/id:0
			RateAgreementVO myRateAgreementVO = (RateAgreementVO) getSession().getAttribute(RateAgreementAbstractEditAction.ACTIVE_RATE_AGREEMENT);
myRateAgreementVO	RateAgreementVO_$$_javassist_91  (id=18528)	
theSystemId: 26631689Name :REENEN
Description :null
Organization :SystemId:4000	Id:HAAL-ZW	Description:HAAL
Unit :theSystemId: 1000072	Symbol :EUR	Description :Euro	UnitType :CURRENCY	IsDeleted :0	
IsDeleted :false
Type :SERVICE_ORDER
			myRateParameterVO.setRateAgreementVO(myRateAgreementVO);
			myRateFunctionVO.setRateParameter(myRateParameterVO);
			myRateFunctionVO.setFunctionDefinitionVO(myFunctionDefinition);
/ 3 pointers back	,

rate agreement <- rate param	<- rate function	<- function def	,

		Redirector myRedirector = getRedirector();
		String myDefinition = myFunctionDefinition.getDefinition();
		} else if (myDefinition.equals(CompareFunction.class.getName())) {
/ JA
			getSession().setAttribute("formvo", new CompareFunctionVO(myRateFunctionVO));
			myRedirector.redirect(true, "compare-function_create");

/ Intermezzo

$ vi ratecalc-sitemap.xml

            <!-- CompareFunction -->
			<map:match type="regexp" pattern="^compare-function_(edit|create)">
                <map:act type="compareFunctionEdit"/>
                <map:read type="jsp" src="jsp/compare-function_edit.jsp"/>
            </map:match>
            <map:match pattern="compare-function_save">
                <map:act type="compareFunctionSave"/>
				<map:read type="jsp" src="jsp/compare-function_edit.jsp"/>
            </map:match>

$ vi compare-function_edit.jsp
		<mpo:form>
				<mpo:setFormVO fetchFrom="session" fetchVar="formvo">
					<mpo:field name="name" required="true" />
					...
				</mpo:setFormVO>
				<tr>
					<td colspan="2">	
						<mpo:button type="save" /> 
						<mpo:button type="saveAndClose" /> 
						<mpo:button type="cancelAndRedirect" url="../ratecalc/rate_agreement_edit?systemid=${sessionScope['active_rateagreement'].systemId}&systemId=${sessionScope['active_rateagreement'].systemId}" /> 
						<mpo:button type="delete" /></td>

		</mpo:form>

/ we zien in HTML voor de save button		 ,
<input type="button" name="saveBtn" id="saveBtn" value="Save" onclick=" theEditFormFormManager.submit('../ratecalc/compare-function_save', false, 0);">
/ Hoe met compare-function_edit.jsp	?
/ TODO

/ theEditFormManager is een 'function FormManager', deze is def in class.formmanager.js	,



/ Einde Intermezzo

/ Intermezzo

public class CompareFunctionVO extends AbstractFunctionModelVO {

public abstract class AbstractFunctionModelVO extends ValueObject {

/ we set in al deze methods een b	, 

/ in 1 ervan hadden we een ERR	,
	public String getName() {
		return rateFunction.getRateParameter().getName();
/ omdat rateFunction.getRateParameter()==null was na save	,

/ Einde Intermezzo 


/ we geven continue	,

/ we vallen in 	,
CompareFunctionVO(AbstractFunctionModelVO).getSystemId() line: 59	
		return rateFunction.getSystemId();
0
/ een aantal keer	,

/ we vallen in 	,
	public String getName() {
		return rateFunction.getRateParameter().getName();
null
/ Maar OK	,

/ we vallen in	,
CompareFunctionVO(AbstractFunctionModelVO).getInputParameterSource(String, boolean) line: 39	
		InputParameterVO myArgumentInputParameter = rateFunction.getInputParameterOfType(paramName, mandatory);
null
paramName	"LEFT_HAND" (id=15243) / "RIGHT_HAND" / "TYPE"	
mandatory	false	
		return InputParameterSource.getInputParamaterSourceId(myArgumentInputParameter);
null

/ we zien ons form	, Compare Function	,
/ we fill in	,
Left hand: RP_RELEASE_DATE
Right hand: RP_START_DATE
Type: Date

/ Save 

/ Intermezzo

/ we zien in HTML voor de save button		 ,
<input type="button" name="saveBtn" id="saveBtn" value="Save" onclick=" theEditFormFormManager.submit('../ratecalc/compare-function_save', false, 0);">
/ Hoe met compare-function_edit.jsp	?
/ TODO

$ vi ratecalc-sitemap.xmap

           <map:match pattern="compare-function_save">
                <map:act type="compareFunctionSave"/>
				<map:read type="jsp" src="jsp/compare-function_edit.jsp"/>
            </map:match>

			<map:action name="compareFunctionSave" src="com.mpobjects.oms.ratecalc.control.function.action.CompareFunctionSaveAction" logger="ratecalc"/>

/ Einde Intermezzo

/ we vallen in	,
CompareFunctionSaveAction.handleSave() line: 29	
		CompareFunctionVO myFunction = (CompareFunctionVO) getValueObject();
/s
CompareFunctionSaveAction(BoundSaveAction).getValueObject() line: 197	
		return getFetchedData().iterator().next();
/s
CompareFunctionSaveAction(BoundSaveAction).getFetchedData() line: 136	
			if (theFetchedData == null) {
/ JA
				Collection<DataFetchable> myFetchFields = getForm().getDataFetchableFields();
[ name,  leftHand,  rightHand,  type]
				boolean shouldHandle;
				FieldTag myField = null;
				for (DataFetchable myDataFetchable : myFetchFields) {
name
					shouldHandle = true;
					if (myDataFetchable instanceof FieldTag) {
true
						myField = (FieldTag) myDataFetchable;
myField	FieldTag  (id=17928)	
						shouldHandle = shouldHandleFieldPrefix(myField.getPrefix());
true
					}
					if (shouldHandle) {
						myDataFetchable.fetchData();
/s
FieldTag.fetchData() line: 377	
		if (!isCurrentlyReadOnly()) {
/ JA
			VOReflectionInvoker.setValue(getActiveValueObject(), getName(), getValueFromRequest(getFormFieldName()));
/s
VOReflectionInvoker.setValue(EntityInterface, String, Object) line: 809	
/=
	public static void setValue(EntityInterface aVO, String aFieldName, Object aValue) {
aVO	CompareFunctionVO  (id=17916)	
aFieldName	"name" (id=17966)	
aValue	"test12" (id=17917)	

		ValueObjectMethod myValueObjectMethod = findMethod(aVO, TYPE_SET, aFieldName, 1);
myValueObjectMethod	ValueObjectMethod  (id=17967)	
	theMethod	Method  (id=17927)	
	theValueObject	CompareFunctionVO  (id=17916)	
		Method myMethod = myValueObjectMethod.getMethod();
public void com.mpobjects.oms.ratecalc.model.process.form.AbstractFunctionModelVO.setName(java.lang.String)
		EntityInterface myVO = myValueObjectMethod.getValueObject();
		try {
			myMethod.invoke(myVO, new Object[] { aValue });
/s
CompareFunctionVO(AbstractFunctionModelVO).setName(String) line: 95	
		rateFunction.getRateParameter().setName(aName);

this	CompareFunctionVO  (id=17916)	
	rateFunction	RateFunctionVO  (id=17918)	
		systemId	0	
		theRateParameter	RateParameterVO  (id=17922)	
			theName	null	
			theRateAgreement	RateAgreementVO_$$_javassist_91  (id=17932)	
...
name "test12"

/t
CompareFunctionSaveAction(BoundSaveAction).getFetchedData() line: 130	

/ volgende	,
				for (DataFetchable myDataFetchable : myFetchFields) {
					shouldHandle = true;
					if (myDataFetchable instanceof FieldTag) {
myDataFetchable	DropDownFieldTag  (id=18008)	
						myField = (FieldTag) myDataFetchable;
 leftHand
						shouldHandle = shouldHandleFieldPrefix(myField.getPrefix());
					}
					if (shouldHandle) {
						myDataFetchable.fetchData();
/s
CompareFunctionVO(AbstractFunctionModelVO).setInputParamaterSource(String, String) line: 80	
/ Naast .setName van zonet	,
/=
	public void setInputParamaterSource(String aParam, String aValue) {
aParam	"LEFT_HAND" (id=18013)	
aValue	"PA26631774" (id=18014)	

/ we zien in HTML, in de dropdownlist	,
<option value="PA26631774">RP_RELEASE_DATE</option>
/ TODO

		InputParameterVO myParameter = rateFunction.getInputParameterOfType(aParam, false);
		if (myParameter == null) {
/ JA
			myParameter = new InputParameterVO();
			myParameter.setFuncParDefVO(MpoBeanFactory.getBean(FuncParameterDefDAO.class).getByName(aParam));
/ uit EhCache	,
this	CompareFunctionVO  (id=17916)	
aParam	"LEFT_HAND" (id=18013)	
aValue	"PA26631774" (id=18014)	
myParameter	InputParameterVO  (id=18027)	
	performanceMonitorService	null	
	systemId	0	
	theConfigurationValue	null	
	theFreeValue	null	
	theFuncParDef	FuncParameterDefVO  (id=18029)	
		funcDefSystemid	100	
		name	"LEFT_HAND" (id=18045)	
		parameterType	null	
		parameterTypeSystemid	3700001	
		performanceMonitorService	null	
		systemId	10010	
		theFuncDef	null	
	theOrderDetail	null	
	theParameter	null	
	theRateFunc	null	
	theRateResult	null	

/ Intermezzo

$ vi FuncParameterDefVO.standard.hbm.xml
	<class name="com.mpobjects.oms.ratecalc.model.funcparameterdef.vo.FuncParameterDefVO" table="FUNC_PARAMETER_DEF" lazy="false">

mpo_2015_01=# select*from func_parameter_def;
 system_id |          name          | func_def_systemid | parameter_type_systemid 
-----------+------------------------+-------------------+-------------------------
     10010 | LEFT_HAND              |               100 |                 3700001
     10020 | RIGHT_HAND             |               100 |                 3700001
     10030 | TYPE                   |               100 |                 3700001

mpo_2015_01=# \d+ func_parameter_def
                                  Table "public.func_parameter_def"
         Column          |         Type          | Modifiers | Storage  | Stats target | Description 
-------------------------+-----------------------+-----------+----------+--------------+-------------
...
 func_def_systemid       | integer               |           | plain    |              | 
 parameter_type_systemid | integer               |           | plain    |              | 
Foreign-key constraints:
    "fdp_func_def_fk" FOREIGN KEY (func_def_systemid) REFERENCES function_definition(system_id)
    "fdp_func_def_par_fk" FOREIGN KEY (parameter_type_systemid) REFERENCES parameter_type(system_id)

mpo_2015_01=# select*from function_definition where system_id=100;
 system_id |                            definition                             |  name   
-----------+-------------------------------------------------------------------+---------
       100 | com.mpobjects.oms.ratecalc.model.process.function.CompareFunction | COMPARE
(1 row)

mpo_2015_01=# select*from parameter_type where system_id= 3700001;
 system_id |  name  | description | is_deleted 
-----------+--------+-------------+------------
   3700001 | STRING |             |          0
(1 row)

/ Einde Intermezzo

			rateFunction.addInputParameter(myParameter);
		InputParameterSource.setInputParamaterSource(myParameter, aValue);
/s
InputParameterSource.setInputParamaterSource(InputParameterVO, String) line: 60	
/=
aInputParameterVO	InputParameterVO  (id=18027)	
aSourceId	"PA26631774" (id=18014)	

/ Intermezzo

mpo_2015_01=# select*from rate_parameter where system_id=26631774;
-[ RECORD 1 ]----------------+----------------
system_id                    | 26631774
name                         | RP_RELEASE_DATE
description                  | 
outputfrom_function_systemid | 26631772
rate_agreement_systemid      | 26631689
is_persistent                | 0
sequence_nr                  | 0
parameter_type_systemid      | 
is_user_editable             | 0
iteration_entity             | 
iteration_action             | 

/ Einde Intermezzo


		} else if (aSourceId.startsWith(InputParameterSource.PARAMETER_PREFIX)) {
			try {
				RateParameterVO myRateParameter = MpoBeanFactory.getBean(RateParameterDAO.class).getBySystemId(
						new Integer(aSourceId.substring(InputParameterSource.PARAMETER_PREFIX.length())));
				aInputParameterVO.setOrderDetailVO(null);
				aInputParameterVO.setParameterVO(myRateParameter);

/t
CompareFunctionSaveAction(BoundSaveAction).getFetchedData() line: 130	

/ volgende	,
				for (DataFetchable myDataFetchable : myFetchFields) {
					shouldHandle = true;
					if (myDataFetchable instanceof FieldTag) {
						myField = (FieldTag) myDataFetchable;
myField	DropDownFieldTag  (id=18091)	
right hand
						shouldHandle = shouldHandleFieldPrefix(myField.getPrefix());
					}
					if (shouldHandle) {
						myDataFetchable.fetchData();
					}
				}

				theFetchedData = getForm().getValueObjects();

/ volgende	,
				for (DataFetchable myDataFetchable : myFetchFields) {
					shouldHandle = true;
					if (myDataFetchable instanceof FieldTag) {
						myField = (FieldTag) myDataFetchable;
myField	DropDownFieldTag  (id=18106)	
type
						shouldHandle = shouldHandleFieldPrefix(myField.getPrefix());
					}
					if (shouldHandle) {
						myDataFetchable.fetchData();
					}
				}

				theFetchedData = getForm().getValueObjects();
this	CompareFunctionSaveAction  (id=17897)	
	theFetchedData	ArrayList  (id=18206)	
		elementData	Object[10]  (id=18209)	
			[0]	CompareFunctionVO  (id=17916)	
				performanceMonitorService	null	
				rateFunction	RateFunctionVO  (id=17918)	
					systemId	0	
					theFunctionDefinition	FunctionDefinitionVO  (id=17920)	
					theInputParameterList	HashSet  (id=17921)	
					theRateParameter	RateParameterVO  (id=17922)	
				systemId	0	
		modCount	1	
		size	1	

///////////////////////////////////
/ Dus ze redeneren vanuit de function 	,  de de rate param heeft die hij moet uitrekenen	, en de input params van hem	,

			getRequest().setAttribute(TAGLIB_FETCHED_DATA, theFetchedData);
			return theFetchedData;

/ Samenvatting	,

CompareFunctionSaveAction(BoundSaveAction).getFetchedData() line: 140	

			if (theFetchedData == null) {
				Collection<DataFetchable> myFetchFields = getForm().getDataFetchableFields();
/s
CompareFunctionSaveAction(BoundSaveAction).getForm() line: 167	
		if (theFormTag == null) {
			theFormTag = (FormTag) getRequest().getAttribute("form");
/ WH
			...
				for (DataFetchable myDataFetchable : myFetchFields) {
						myDataFetchable.fetchData();

this	CompareFunctionSaveAction  (id=17897)	
	theFormTag	FormTag  (id=17902)	
		fieldList	ArrayList  (id=18185)	
/= getForm().getDataFetchableFields()

		theValueObjects	ArrayList  (id=18206)	
			elementData	Object[10]  (id=18209)	
				[0]	CompareFunctionVO  (id=17916)	
					performanceMonitorService	null	
					rateFunction	RateFunctionVO  (id=17918)	
						systemId	0	
						theFunctionDefinition	FunctionDefinitionVO  (id=17920)	
						theInputParameterList	HashSet  (id=17921)	
							map	HashMap  (id=18305)	
{SystemId: 0=java.lang.Object@71253271, SystemId: 0=java.lang.Object@71253271, SystemId: 0=java.lang.Object@71253271}
						theRateParameter	RateParameterVO  (id=17922)	
theSystemId: 0Name :test12
Description :null
						theRateTable	null	
						theUnit	null	
						theUserFuncDef	null	
					systemId	0	

/ theRateParamater is die we willen maken	, "test12"	, 
/ theInputParameterList zijn die 3 args	, left-, righthand	, type	,

/ Einde Samenvatting	,

/t
CompareFunctionSaveAction(BoundSaveAction).getValueObject() line: 197	
		return getFetchedData().iterator().next();
/d
/t
CompareFunctionSaveAction.handleSave() line: 31	
		CompareFunctionVO myFunction = (CompareFunctionVO) getValueObject();

myFunction	CompareFunctionVO  (id=17916)	
	rateFunction	RateFunctionVO  (id=17918)	
		systemId	0	
		theFunctionDefinition	FunctionDefinitionVO  (id=17920)	
theSystemId: 100
Definition :com.mpobjects.oms.ratecalc.model.process.function.CompareFunction,Name :COMPARE
		theInputParameterList	HashSet  (id=17921)	
			map	HashMap  (id=18305)	
{SystemId: 0=java.lang.Object@71253271, SystemId: 0=java.lang.Object@71253271, SystemId: 0=java.lang.Object@71253271}
		theRateParameter	RateParameterVO  (id=17922)	
theSystemId: 0Name :test12
Description :null

		RateParameterVO myParameterVO = myFunction.getRateFunction().getRateParameter();
theSystemId: 0Name :test12
Description :null
		if (myParameterVO.getSystemId() != ValueObject.VOLATILE_SYSTEM_ID) {
/ NEE
			myParameterVO = MpoBeanFactory.getBean(RateParameterDAO.class).getBySystemId(myParameterVO.getSystemId());
/ NIET

		RateAgreementVO myRateAgreementVO = MpoBeanFactory.getBean(RateAgreementDAO.class).getBySystemId(myParameterVO.getRateAgreementVO().getSystemId());
myRateAgreementVO	RateAgreementVO_$$_javassist_91  (id=18486)	
theSystemId: 26631689Name :REENEN
Description :null
Organization :SystemId:4000	Id:HAAL-ZW	Description:HAAL
Unit :theSystemId: 1000072	Symbol :EUR	Description :Euro	UnitType :CURRENCY	IsDeleted :0	
IsDeleted :false
Type :SERVICE_ORDER

		checkForExisting(myRateAgreementVO, myParameterVO);
/ ERR als er myParameterVO er al is	,
/s
CompareFunctionSaveAction(AbstractFunctionSaveAction).checkForExisting(RateAgreementVO, RateParameterVO) line: 37	
		Collection<RateParameterVO> myRateParameterVOList = aRateAgreement.getRateParameterList();
/ de list van RateParameterVO's die we ook in de GUI zien (boven de 'create new rate parameter' button)
/ aantal=36

			if (rateParameterVO.getName() != null && rateParameterVO.getName().equals(aRateParameter.getName())
					&& rateParameterVO.getSystemId() != aRateParameter.getSystemId()) {
/ NEE
/ En dat is de bedoeling	,

/t
CompareFunctionSaveAction.handleSave() line: 41	
		checkForExisting(myRateAgreementVO, myParameterVO);
/d
		RateParameterVO myExistingParameter = null;
		RateFunctionVO myExistingFunction = null;
		for (RateParameterVO rateParameterVO : myRateAgreementVO.getRateParameterList()) {
/ NEE

		if (myExistingParameter == null) {
/ JA
			myExistingParameter = myParameterVO;
			myRateAgreementVO.getParameterList().add(myExistingParameter);
			myExistingParameter.setRateAgreementVO(myRateAgreementVO);
			myExistingFunction = new RateFunctionVO();
			myExistingFunction.setFunctionDefinitionVO(myFunction.getRateFunction().getFunctionDefinitionVO());

			myExistingFunction.setInputParameterList(myFunction.getRateFunction().getInputParameterList());
			myExistingFunction.setRateParameter(myFunction.getRateFunction().getRateParameter());


			MpoBeanFactory.getBean(RateFunctionDAO.class).save(myExistingFunction);
			myExistingParameter.setOutputfromFunctionVO(myExistingFunction);
			MpoBeanFactory.getBean(RateParameterDAO.class).save(myExistingParameter);
			MpoBeanFactory.getBean(RateAgreementDAO.class).save(myRateAgreementVO);

/ myExistingFunction heeft theInputParameterList en theRateParameter, die myFunction.getRateFunction() wel heeft	,

myFunction	CompareFunctionVO  (id=17916)	
	rateFunction	RateFunctionVO  (id=17918)	
		theFunctionDefinition	FunctionDefinitionVO  (id=17920)	
		theInputParameterList	HashSet  (id=17921)	
			map	HashMap  (id=18305)	
		theRateParameter	RateParameterVO  (id=17922)	

		CompareFunctionVO myNewFunction = new CompareFunctionVO(myExistingFunction);
		myNewFunction.setLeftHand(myFunction.getLeftHand());
		myNewFunction.setRightHand(myFunction.getRightHand());
		myNewFunction.setType(myFunction.getType());
		myExistingParameter.setName(myParameterVO.getName());

		MpoBeanFactory.getBean(RateParameterDAO.class).save(myExistingParameter);
		MpoBeanFactory.getBean(RateFunctionDAO.class).save(myExistingFunction);
		getRequest().setAttribute("systemid", new Integer(myExistingFunction.getSystemId()));

/ we geven continue	,
CompareFunctionVO(AbstractFunctionModelVO).getName() line: 47	
		return rateFunction.getRateParameter().getName();
/ ERR, want rateFunction.getRateParameter()==null
/ dit is de newFunction	, 
/ Klopt	,


/ Einde Intermezzo

/ 7	. 

/ we rm b's

SetFormVOTag [line: 201] - setValueObject(EntityInterface)	






/ Einde DEBUG PNL-546

/ DSVROAD-610

/ 7	. 

/ op productie kijken	,

[eric@localhost bin]$ dsvcts-p.bash 
/ calls	,
isql-fb -u sysdba -p masterkey "scs-application-p.intermax.mp-objects.com:/local/apps/firebird/dsvcts.fdb" "$@"

/ we lezen djansen, Italia72	, 
/ we hebben eric, rtdMpo45 create, maar kan niet login	, 
/ TODO

/ login	,
/ copy van JoostU	,
ericvanvelden, tms123

/ we kiezen shipment_order 25171981 , 
/ kies de delivery seo	, N1719803
/ verander de Pnl. start date van 7 mei naar 8 mei	,

Back to previous screen Sorry, an error occurred
javax.transaction.RollbackException
javax.transaction.RollbackException: Already marked for rollback TransactionImpl:XidImpl[FormatId=257, GlobalId=scs-application-p/3683541, BranchQual=, localId=3683541]
Show / Hide Details
javax.transaction.RollbackException: Already marked for rollback TransactionImpl:XidImpl[FormatId=257, GlobalId=scs-application-p/3683541, BranchQual=, localId=3683541] at
org.jboss.tm.TransactionImpl.checkBeforeStatus(TransactionImpl.java:1182) at
org.jboss.tm.TransactionImpl.checkIntegrity(TransactionImpl.java:1125) at
org.jboss.tm.TransactionImpl.beforePrepare(TransactionImpl.java:1108) at
org.jboss.tm.TransactionImpl.commit(TransactionImpl.java:324) at
org.jboss.tm.TxManager.commit(TxManager.java:240) at
org.jboss.tm.usertx.client.ServerVMClientUserTransaction.commit(ServerVMClientUserTransaction.java:140) at
org.springframework.transaction.jta.JtaTransactionManager.doCommit(JtaTransactionManager.java:1011) at
org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:755) at
org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:724) at
org.springframework.transaction.interceptor.TransactionAspectSupport.commitTransactionAfterReturning(TransactionAspectSupport.java:475) at
org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:270) at
org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94) at
org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172) at
org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204) at
com.sun.proxy.$Proxy249.updateServiceOrder(Unknown Source) at
com.mpobjects.oms.control.serviceorder.action.ServiceOrderSaveAction.handleSave(ServiceOrderSaveAction.java:184) at
com.mpobjects.oms.ratecalc.control.serviceorder.action.ServiceOrderSaveAction.handleSave(ServiceOrderSaveAction.java:21) at
com.mpobjects.control.action.AbstractSaveAction.act(AbstractSaveAction.java:69) at
com.mpobjects.control.action.AbstractAction.act(AbstractAction.java:171) at
org.apache.cocoon.components.treeprocessor.sitemap.ActTypeNode.invoke(ActTypeNode.java:125) at
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:47) at
org.apache.cocoon.components.treeprocessor.sitemap.MatchNode.invoke(MatchNode.java:108) at
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69) at
org.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143) at
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69) at
org.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93) at
org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235) at
org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177) at
org.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:253) at
org.apache.cocoon.components.treeprocessor.sitemap.MountNode.invoke(MountNode.java:118) at
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69) at
org.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143) at
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69) at
org.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93) at
org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235) at
org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177) at
org.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:253) at
org.apache.cocoon.Cocoon.process(Cocoon.java:699) at
org.apache.cocoon.servlet.CocoonServlet.service(CocoonServlet.java:1154) at
javax.servlet.http.HttpServlet.service(HttpServlet.java:810) at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252) at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at
com.mpobjects.control.filter.FirstLoginFilter.doFilter(FirstLoginFilter.java:76) at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202) at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:330) at
org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:118) at
org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:84) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:113) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:103) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:113) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:154) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:45) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:199) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:110) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
com.mpobjects.auth.springsec.RunAsLogoutFilter.doFilter(RunAsLogoutFilter.java:41) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
org.springframework.security.web.context.SecurityContextPersistenceFilter.doFilter(SecurityContextPersistenceFilter.java:87) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:192) at
org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:160) at
org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:343) at
org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:260) at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202) at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at
filters.SetCharacterEncodingFilter.doFilter(SetCharacterEncodingFilter.java:111) at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202) at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at
org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:230) at
org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202) at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at
org.jboss.web.tomcat.filters.ReplyHeaderFilter.doFilter(ReplyHeaderFilter.java:96) at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202) at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213) at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178) at
org.jboss.web.tomcat.security.SecurityAssociationValve.invoke(SecurityAssociationValve.java:175) at
org.jboss.web.tomcat.security.JaccContextValve.invoke(JaccContextValve.java:74) at
org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126) at
org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105) at
org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:541) at
org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107) at
org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148) at
org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:199) at
org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:282) at
org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:767) at
org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:697) at
org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:889) at
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684) at
java.lang.Thread.run(Thread.java:701)

/ 7	. 

/ we lezen server.log op productie	,

2015-05-06 14:55:44,876 ERROR [com.mpobjects.oms.model.service.ConsignmentServiceImpl] (TP-Processor5) updateConsignmentAfterServiceOrderChange
java.lang.RuntimeException: In runFor([theSystemId: 27647746Name :DCT_DE_1JAN2015-current
Description :Rates ex Germany from period 01 Jan 2015
Organization :SystemId:3000     Id:DSV-DOW      Description:Dow Control Tower
Unit :theSystemId: 1000072      Symbol :EUR     Description :EUR        UnitType :CURRENCY      IsDeleted :0    
IsDeleted :false
Type :SERVICE_ORDER
]), save ratecalc failed:java.lang.RuntimeException: In updateServiceOrder(N1719803/28839972):Something is wrong, maximum number of nested events has been reached [15], throwing exception to prevent stack overflow
        at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.runFor(RateCalculationVO.java:862)
        at com.mpobjects.oms.ratecalc.model.service.CalculationServiceImpl.recalculate(CalculationServiceImpl.java:520)
        at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalculate(RateCalcEventListener.java:272)
        at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalcServiceOrderCost(RateCalcEventListener.java:177)
        at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.handleEvent(RateCalcEventListener.java:71)
        at com.mpobjects.oms.model.eventhandler.util.ListenerList.fireEvent(ListenerList.java:82)
        at com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:89)
        at com.mpobjects.oms.model.service.ConsignmentServiceImpl.triggerEventHandler(ConsignmentServiceImpl.java:1078)
        at com.mpobjects.oms.model.service.ConsignmentServiceImpl.updateConsignmentAfterServiceOrderChange(ConsignmentServiceImpl.java:1104)
        at com.mpobjects.oms.model.service.ConsignmentServiceImpl.handleServiceOrderPlannedDateChange(ConsignmentServiceImpl.java:579)
        at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderServiceImpl.java:1496)
        at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.recalculateCostsForServiceOrder(ServiceOrderCostServiceImpl.java:202)
        at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.saveServiceOrderCost(ServiceOrderCostServiceImpl.java:234)

       	at com.mpobjects.ratecalc.service.ServiceOrderCalculationServiceImpl.updateServiceOrderCostPartList(ServiceOrderCalculationServiceImpl.java:464)
        at com.mpobjects.ratecalc.service.ServiceOrderCalculationServiceImpl.updateServiceOrder(ServiceOrderCalculationServiceImpl.java:113)
        at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.runFor(RateCalculationVO.java:826)
        at com.mpobjects.oms.ratecalc.model.service.CalculationServiceImpl.recalculate(CalculationServiceImpl.java:520)
        at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalculate(RateCalcEventListener.java:272)
        at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalcServiceOrderCost(RateCalcEventListener.java:177)
        at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.handleEvent(RateCalcEventListener.java:71)
        at com.mpobjects.oms.model.eventhandler.util.ListenerList.fireEvent(ListenerList.java:82)
        at com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:89)
        at com.mpobjects.oms.model.service.ConsignmentServiceImpl.triggerEventHandler(ConsignmentServiceImpl.java:1078)
        at com.mpobjects.oms.model.service.ConsignmentServiceImpl.updateConsignmentAfterServiceOrderChange(ConsignmentServiceImpl.java:1104)
        at com.mpobjects.oms.model.service.ConsignmentServiceImpl.handleServiceOrderPlannedDateChange(ConsignmentServiceImpl.java:579)
       	at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderServiceImpl.java:1496)
        at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.recalculateCostsForServiceOrder(ServiceOrderCostServiceImpl.java:202)
        at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.saveServiceOrderCost(ServiceOrderCostServiceImpl.java:234)

        at com.mpobjects.ratecalc.service.ServiceOrderCalculationServiceImpl.updateServiceOrderCostPartList(ServiceOrderCalculationServiceImpl.java:464)
        at com.mpobjects.ratecalc.service.ServiceOrderCalculationServiceImpl.updateServiceOrder(ServiceOrderCalculationServiceImpl.java:113)
        at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.runFor(RateCalculationVO.java:826)
        at com.mpobjects.oms.ratecalc.model.service.CalculationServiceImpl.recalculate(CalculationServiceImpl.java:520)
        at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalculate(RateCalcEventListener.java:272)
        at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalcServiceOrderCost(RateCalcEventListener.java:177)
        at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.handleEvent(RateCalcEventListener.java:71)
        at com.mpobjects.oms.model.eventhandler.util.ListenerList.fireEvent(ListenerList.java:82)
        at com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:89)
        at com.mpobjects.oms.model.service.ConsignmentServiceImpl.triggerEventHandler(ConsignmentServiceImpl.java:1078)
        at com.mpobjects.oms.model.service.ConsignmentServiceImpl.updateConsignmentAfterServiceOrderChange(ConsignmentServiceImpl.java:1104)
        at com.mpobjects.oms.model.service.ConsignmentServiceImpl.handleServiceOrderPlannedDateChange(ConsignmentServiceImpl.java:579)
        at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderServiceImpl.java:1496)
       	at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.recalculateCostsForServiceOrder(ServiceOrderCostServiceImpl.java:202)
        at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.saveServiceOrderCost(ServiceOrderCostServiceImpl.java:234)

        at com.mpobjects.ratecalc.service.ServiceOrderCalculationServiceImpl.updateServiceOrderCostPartList(ServiceOrderCalculationServiceImpl.java:464)
        at com.mpobjects.ratecalc.service.ServiceOrderCalculationServiceImpl.updateServiceOrder(ServiceOrderCalculationServiceImpl.java:113)
       	at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.runFor(RateCalculationVO.java:826)
        at com.mpobjects.oms.ratecalc.model.service.CalculationServiceImpl.recalculate(CalculationServiceImpl.java:520)
        at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalculate(RateCalcEventListener.java:272)
        at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalcServiceOrderCost(RateCalcEventListener.java:177)
        at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.handleEvent(RateCalcEventListener.java:71)
        at com.mpobjects.oms.model.eventhandler.util.ListenerList.fireEvent(ListenerList.java:82)
        at com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:89)
        at com.mpobjects.oms.model.service.ConsignmentServiceImpl.triggerEventHandler(ConsignmentServiceImpl.java:1078)
        at com.mpobjects.oms.model.service.ConsignmentServiceImpl.updateConsignmentAfterServiceOrderChange(ConsignmentServiceImpl.java:1104)
        at com.mpobjects.oms.model.service.ConsignmentServiceImpl.handleServiceOrderPlannedDateChange(ConsignmentServiceImpl.java:579)


		...
        at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.recalculateCostsForServiceOrder(ServiceOrderCostServiceImpl.java:202)
        at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.saveServiceOrderCost(ServiceOrderCostServiceImpl.java:234)

        at com.mpobjects.ratecalc.service.ServiceOrderCalculationServiceImpl.updateServiceOrderCostPartList(ServiceOrderCalculationServiceImpl.java:464)
        at com.mpobjects.ratecalc.service.ServiceOrderCalculationServiceImpl.updateServiceOrder(ServiceOrderCalculationServiceImpl.java:113)
       	at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.runFor(RateCalculationVO.java:826)
        at com.mpobjects.oms.ratecalc.model.service.CalculationServiceImpl.recalculate(CalculationServiceImpl.java:520)
       	at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalculate(RateCalcEventListener.java:272)
        at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalcServiceOrderCost(RateCalcEventListener.java:177)
        at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.handleEvent(RateCalcEventListener.java:71)
        at com.mpobjects.oms.model.eventhandler.util.ListenerList.fireEvent(ListenerList.java:82)
        at com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:89)
        at com.mpobjects.oms.model.service.ConsignmentServiceImpl.triggerEventHandler(ConsignmentServiceImpl.java:1078)
        at com.mpobjects.oms.model.service.ConsignmentServiceImpl.updateConsignmentAfterServiceOrderChange(ConsignmentServiceImpl.java:1104)
        at com.mpobjects.oms.model.service.ConsignmentServiceImpl.handleServiceOrderPlannedDateChange(ConsignmentServiceImpl.java:579)
        at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderServiceImpl.java:1496)
        at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.recalculateCostsForServiceOrder(ServiceOrderCostServiceImpl.java:202)
        at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.saveServiceOrderCost(ServiceOrderCostServiceImpl.java:234)


/ Zoek op '2015-05-06 14:55:44,881 ERROR' in server.log.2015-05-05	, 

2015-05-06 14:55:44,881 ERROR [STDERR] (TP-Processor5) com.mpobjects.oms.model.consignment.ConsignmentException: [updateConsignmentAfterServiceOrderChange] In runFor([theSystemId: 27647746Name :DCT_DE_1JAN2015-current
Description :Rates ex Germany from period 01 Jan 2015
Organization :SystemId:3000     Id:DSV-DOW      Description:Dow Control Tower
Unit :theSystemId: 1000072      Symbol :EUR     Description :EUR        UnitType :CURRENCY      IsDeleted :0    
IsDeleted :false
Type :SERVICE_ORDER
]), save ratecalc failed:java.lang.RuntimeException: In updateServiceOrder(N1719803/28839972):Something is wrong, maximum number
 of nested events has been reached [15], throwing exception to prevent stack overflow
2015-05-06 14:55:44,883 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.model.service.ConsignmentServiceImpl.updateConsignmentAfterServiceOrderChange(ConsignmentServiceImpl.java:1108)
2015-05-06 14:55:44,883 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.recalculateCostsForServiceOrder(ServiceOrderCostServiceImpl.java:202)
2015-05-06 14:55:44,883 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.saveServiceOrderCost(ServiceOrderCostServiceImpl.java:234)
2015-05-06 14:55:44,883 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.ratecalc.service.ServiceOrderCalculationServiceImpl.updateServiceOrderCostPartList(ServiceOrderCalculationServiceImpl.java:464)
2015-05-06 14:55:44,883 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.ratecalc.service.ServiceOrderCalculationServiceImpl.updateServiceOrder(ServiceOrderCalculationServiceImpl.java:113)
2015-05-06 14:55:44,883 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalculate(RateCalcEventListener.java:272)
2015-05-06 14:55:44,883 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalcServiceOrderCost(RateCalcEventListener.java:177)
2015-05-06 14:55:44,883 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.handleEvent(RateCalcEventListener.java:71)
2015-05-06 14:55:44,883 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.model.eventhandler.util.ListenerList.fireEvent(ListenerList.java:82)
2015-05-06 14:55:44,883 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:89)
2015-05-06 14:55:44,883 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.model.service.ConsignmentServiceImpl.triggerEventHandler(ConsignmentServiceImpl.java:1078)
2015-05-06 14:55:44,883 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.model.service.ConsignmentServiceImpl.updateConsignmentAfterServiceOrderChange(ConsignmentServiceImpl.java:1104)
2015-05-06 14:55:44,883 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.model.service.ConsignmentServiceImpl.handleServiceOrderPlannedDateChange(ConsignmentServiceImpl.java:579)
2015-05-06 14:55:44,884 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderServiceImpl.java:1496)
2015-05-06 14:55:44,884 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.recalculateCostsForServiceOrder(ServiceOrderCostServiceImpl.java:202)
2015-05-06 14:55:44,884 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.saveServiceOrderCost(ServiceOrderCostServiceImpl.java:234)
2015-05-06 14:55:44,884 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.ratecalc.service.ServiceOrderCalculationServiceImpl.updateServiceOrderCostPartList(ServiceOrderCalculationServiceImpl.java:464)
2015-05-06 14:55:44,884 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.ratecalc.service.ServiceOrderCalculationServiceImpl.updateServiceOrder(ServiceOrderCalculationServiceImpl.java:113)
...
2015-05-06 14:55:44,911 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.recalculateCostsForServiceOrder(ServiceOrderCostServiceImpl.java:202)
2015-05-06 14:55:44,911 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.saveServiceOrderCost(ServiceOrderCostServiceImpl.java:234)
/ herhaling	,
2015-05-06 14:55:44,911 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.ratecalc.service.ServiceOrderCalculationServiceImpl.updateServiceOrderCostPartList(ServiceOrderCalculationServiceImpl.java:464)
2015-05-06 14:55:44,911 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.ratecalc.service.ServiceOrderCalculationServiceImpl.updateServiceOrder(ServiceOrderCalculationServiceImpl.java:113)
2015-05-06 14:55:44,911 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.runFor(RateCalculationVO.java:826)
2015-05-06 14:55:44,911 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.ratecalc.model.service.CalculationServiceImpl.recalculate(CalculationServiceImpl.java:520)
2015-05-06 14:55:44,911 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalculate(RateCalcEventListener.java:272)
2015-05-06 14:55:44,911 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalcServiceOrderCost(RateCalcEventListener.java:177)
2015-05-06 14:55:44,911 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.handleEvent(RateCalcEventListener.java:71)
2015-05-06 14:55:44,911 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.model.eventhandler.util.ListenerList.fireEvent(ListenerList.java:82)
2015-05-06 14:55:44,911 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:89)
2015-05-06 14:55:44,911 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.model.service.ConsignmentServiceImpl.triggerEventHandler(ConsignmentServiceImpl.java:1078)
2015-05-06 14:55:44,911 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.model.service.ConsignmentServiceImpl.updateConsignmentAfterServiceOrderChange(ConsignmentServiceImpl.java:1104)
2015-05-06 14:55:44,911 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.model.service.ConsignmentServiceImpl.handleServiceOrderPlannedDateChange(ConsignmentServiceImpl.java:579)
2015-05-06 14:55:44,911 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderServiceImpl.java:1496)
2015-05-06 14:55:44,911 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.recalculateCostsForServiceOrder(ServiceOrderCostServiceImpl.java:202)
2015-05-06 14:55:44,911 ERROR [STDERR] (TP-Processor5)  at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.saveServiceOrderCost(ServiceOrderCostServiceImpl.java:234)

/ 7	.

/ we halen de productie db naar de laptop	,

 1017  cp-db-p.sh dsvcts.fdb_20150507-024121.fbk.gz
h^Zgcyr&Q
 1022  sudo chown firebird.firebird dsvcts.fdb_20150507-024121.fbk.gz 
 1023  sudo -u firebird gzip -d dsvcts.fdb_20150507-024121.fbk.gz 
[eric@localhost Firebird]$ sudo -u firebird gbak  -v -c -user sysdba -password masterkey dsvcts.fdb_20150507-024121.fbk dsvcts.fdb

/ 7	. 

/ we hadden dsvcts NIET opnieuw build	,  

/ Als we een shipment_order select	,

org.firebirdsql.jdbc.FBSQLException: GDS Exception. 335544569. Dynamic SQL Error SQL error code = -206 Column unknown SHIPMENTOR0_.SEQUENCE_NR At line 1, column 487 at
com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO.getShipmentOrderPricePartByStatus(ShipmentOrderVO.java:1743) at
com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO.getFinancialState(ShipmentOrderVO.java:948) at

/ Dus de code verwacht een column	, maar die is er niet	,

SQL>  select*from mpo_scs_patch where status in ('NOT_APPLIED');
/ NEE
/ Dus patches gedraaid	,

/ we zoeken in de patches , in eclipse	,
text: SEQUENCE_NR
file: *.sql

/ we zien	,

module
	oms
		src
			sql
				dml
patch-478-drop_sequenceNr-priceandcostpart$firebird.sql (2 matches) 19333 (4/20/15 Anil)
1: ALTER TABLE SHIPMENT_ORDER_PRICE_PART DROP SEQUENCE_NR;  
3: ALTER TABLE SERVICE_ORDER_COST DROP SEQUENCE_NR;  

/ de productie is 19512	, dus daarop hebben deze patches al run	,

/ 7	. 

/ we moeten dsvcts opnieuw build	,
$ vi application.properties
base.product = dsvcts

/ en build	,

/ Neem sho	,
0025169619
/ of	,
0025171981
/ ERR	,

SQL> select first 10 system_id, shipment_order_id from shipment_order where shipment_order_id in ('0025169619','0025171981') order by system_id asc;
   SYSTEM_ID SHIPMENT_ORDER_ID                                                                
============ =============================================================================== 
    28444705 0025169619                                                                       
    28465242 0025171981  

SQL> select first 10 system_id, shipment_order_id from shipment_order order by system_id desc;

   SYSTEM_ID SHIPMENT_ORDER_ID                                                                
============ =============================================================================== 
    28898781 SH001318627                                                                      
    28898762 SH001318626                                                                      
    28898752 SH001318625                                                                      
    28898746 SH001318624                                                                      
    28898741 SH001318623                                                                      
    28898731 SH001318622                                                                      
    28898704 SH001318621                                                                      
    28898697 SH001318620                                                                      
    28898691 SH001318619                                                                      
    28898686 SH001318618                                                                      

/ sho	,
0025123816
/ doet het OK	,

/ 7	.

/ Neem sho	,
0025169619
/ ERR
/ Neem sho	,
0025123816
 OK	,

/ Einde DSVROAD-610

/ DSVROAD-610

/ 7	. 

/ shipment order list

$ vi oms-sitemap.xmap

<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">
	<map:components>
		<map:actions>
			<map:action logger="shipmentorder" name="shipmentOrderList" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderListAction"/>			
	<map:pipelines>
		<map:pipeline>
			<map:match pattern="shipment-order_list">
				<map:act type="shipmentOrderList"/>			
				<map:call resource="dynatablePage">
					<map:parameter name="xsp" value="xsp/shipment-order_list.xml"/>
				</map:call>
			</map:match>

$ vi shipment-order_list.xml
...
/ we zien myTable.addDatabaseJoinColumn	,

$ vi file:///home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/2015.01/base-framework/core/src/java/com/mpobjects/view/util/table/Table.java 
...
/ we set b in de ctor	, 
/ we Planning, shipment order search	, 
 /we vallen in	,

Daemon Thread [http-0.0.0.0-8080-1] (Suspended (breakpoint at line 112 in Table))	
	Table.<init>(String, FilterCache, Request) line: 112	
	TableManager.getTable(String, Request) line: 84	
	shipment_order_list_xml.generate() line: 393	
/ TODO
	ServerPagesGenerator.generate() line: 228	
	CachingProcessingPipeline(AbstractProcessingPipeline).processXMLPipeline(Environment) line: 579	
	CachingProcessingPipeline(AbstractCachingProcessingPipeline).processXMLPipeline(Environment) line: 279	
	CachingProcessingPipeline(AbstractProcessingPipeline).process(Environment) line: 481	
	SerializeNode.invoke(Environment, InvokeContext) line: 121	
	NamedContainerNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	NamedContainerNode(ContainerNode).invoke(Environment, InvokeContext) line: 32	
	CallNode.invoke(Environment, InvokeContext) line: 94	
	NamedContainerNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	NamedContainerNode(ContainerNode).invoke(Environment, InvokeContext) line: 32	
	CallNode.invoke(Environment, InvokeContext) line: 94	
	MatchNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext, String, Map) line: 47	
	MatchNode.invoke(Environment, InvokeContext) line: 108	
	PipelineNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	PipelineNode.invoke(Environment, InvokeContext) line: 143	
	PipelinesNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	PipelinesNode.invoke(Environment, InvokeContext) line: 93	
	ConcreteTreeProcessor.process(Environment, InvokeContext) line: 235	
	ConcreteTreeProcessor.process(Environment) line: 177	
	TreeProcessor.process(Environment) line: 253	
	MountNode.invoke(Environment, InvokeContext) line: 118	
	MatchNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext, String, Map) line: 47	
	MatchNode.invoke(Environment, InvokeContext) line: 108	
	PipelineNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	PipelineNode.invoke(Environment, InvokeContext) line: 143	
	PipelinesNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	PipelinesNode.invoke(Environment, InvokeContext) line: 93	
	ConcreteTreeProcessor.process(Environment, InvokeContext) line: 235	
	ConcreteTreeProcessor.process(Environment) line: 177	
	TreeProcessor.process(Environment) line: 253	
	MountNode.invoke(Environment, InvokeContext) line: 118	
	PipelineNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	PipelineNode.invoke(Environment, InvokeContext) line: 143	
	PipelinesNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	PipelinesNode.invoke(Environment, InvokeContext) line: 93	
	ConcreteTreeProcessor.process(Environment, InvokeContext) line: 235	
	ConcreteTreeProcessor.process(Environment) line: 177	
	TreeProcessor.process(Environment) line: 253	
	Cocoon.process(Environment) line: 699	
	CocoonServlet.service(HttpServletRequest, HttpServletResponse) line: 1154	
	CocoonServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	
	ApplicationFilterChain.internalDoFilter(ServletRequest, ServletResponse) line: 252	
	ApplicationFilterChain.doFilter(ServletRequest, ServletResponse) line: 173	
	FirstLoginFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 76	
	ApplicationFilterChain.internalDoFilter(ServletRequest, ServletResponse) line: 202	
	ApplicationFilterChain.doFilter(ServletRequest, ServletResponse) line: 173	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 330	
	FilterSecurityInterceptor.invoke(FilterInvocation) line: 118	
	FilterSecurityInterceptor.doFilter(ServletRequest, ServletResponse, FilterChain) line: 84	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	ExceptionTranslationFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 113	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	SessionManagementFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 103	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	AnonymousAuthenticationFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 113	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	SecurityContextHolderAwareRequestFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 154	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	RequestCacheAwareFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 45	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	UsernamePasswordAuthenticationFilter(AbstractAuthenticationProcessingFilter).doFilter(ServletRequest, ServletResponse, FilterChain) line: 199	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	LogoutFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 110	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	RunAsLogoutFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 41	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	SecurityContextPersistenceFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 87	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	FilterChainProxy.doFilterInternal(ServletRequest, ServletResponse, FilterChain) line: 192	
	FilterChainProxy.doFilter(ServletRequest, ServletResponse, FilterChain) line: 160	
	DelegatingFilterProxy.invokeDelegate(Filter, ServletRequest, ServletResponse, FilterChain) line: 343	
	DelegatingFilterProxy.doFilter(ServletRequest, ServletResponse, FilterChain) line: 260	
	ApplicationFilterChain.internalDoFilter(ServletRequest, ServletResponse) line: 202	
	ApplicationFilterChain.doFilter(ServletRequest, ServletResponse) line: 173	
	SetCharacterEncodingFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 111	
	ApplicationFilterChain.internalDoFilter(ServletRequest, ServletResponse) line: 202	
	ApplicationFilterChain.doFilter(ServletRequest, ServletResponse) line: 173	
	CoreOpenSessionInViewFilter(OpenSessionInViewFilter).doFilterInternal(HttpServletRequest, HttpServletResponse, FilterChain) line: 230	
	CoreOpenSessionInViewFilter(OncePerRequestFilter).doFilter(ServletRequest, ServletResponse, FilterChain) line: 107	
	ApplicationFilterChain.internalDoFilter(ServletRequest, ServletResponse) line: 202	
	ApplicationFilterChain.doFilter(ServletRequest, ServletResponse) line: 173	
	ReplyHeaderFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 96	
	ApplicationFilterChain.internalDoFilter(ServletRequest, ServletResponse) line: 202	
	ApplicationFilterChain.doFilter(ServletRequest, ServletResponse) line: 173	
	StandardWrapperValve.invoke(Request, Response) line: 213	
	StandardContextValve.invoke(Request, Response) line: 178	
	SecurityAssociationValve.invoke(Request, Response) line: 175	
	JaccContextValve.invoke(Request, Response) line: 74	
	StandardHostValve.invoke(Request, Response) line: 126	
	ErrorReportValve.invoke(Request, Response) line: 105	
	CachedConnectionValve.invoke(Request, Response) line: 156	
	StandardEngineValve.invoke(Request, Response) line: 107	
	CoyoteAdapter.service(Request, Response) line: 148	
	Http11Processor.process(InputStream, OutputStream) line: 869	
	Http11Protocol$JmxHttp11ConnectionHandler(Http11BaseProtocol$Http11ConnectionHandler).processConnection(TcpConnection, Object[]) line: 664	
	PoolTcpEndpoint.processSocket(Socket, TcpConnection, Object[]) line: 527	
	MasterSlaveWorkerThread.run() line: 112	
	ThreadWithAttributes(Thread).run() line: 745	

/ we gaan 1 stap hoger	,
/s
TableManager.getTable(String, Request) line: 84	
/=
	public Table getTable(String aTableName, Request aRequest) {
this	TableManager  (id=17677)	
aTableName	"shipment-order" (id=17686)	
aRequest	HttpRequest  (id=17687)	
	container_encoding	"utf-8" (id=17994)	
	env	HttpEnvironment  (id=17995)	
	form_encoding	"utf-8" (id=17996)	
	req	SecurityContextHolderAwareRequestWrapper  (id=17998)	
	reqURI	"/tms/oms/shipment-order_list" (id=18000)	
	wrappedCookieMap	null	
	wrappedCookies	null	
mySession	HttpSession  (id=17688)	

		LOG.debug("Getting table for: " + aTableName);
		Session mySession = aRequest.getSession();
		Table myTable = null;
		String myStartEmptyString = aRequest.getParameter("startempty");
		boolean myStartEmpty = myStartEmptyString != null && TRUE.equals(myStartEmptyString);
		if (!myStartEmpty) {
			myTable = getFromCache(mySession, aTableName);
		}
		if (myTable == null) {
			LOG.debug("Creating new table: " + aTableName);
			myTable = new Table(aTableName, new FilterManager().getFilterCache(mySession), aRequest);
/ TODO (filter manager)
/s
Table.<init>(String, FilterCache, Request) line: 112	
...

/ we geven continue	,

/ we vallen  in	,

Daemon Thread [http-0.0.0.0-8080-1] (Suspended (breakpoint at line 129 in Table))	
	Table.addAction(String, String) line: 129	
	Table.addAction(String) line: 119	
	shipment_order_list_xml.generate() line: 600	
	...
/=
	public void addAction(String aCode) {
aCode	"edit" (id=17634)	
		addAction(aCode, EntityActionUtil.getActionUrl(getRequest(), aCode));
/s
EntityActionUtil.getActionUrl(Request, String) line: 44	
		return getActionUrl(aRequest.getRequestURI(), aTargetAction);
/ aRequest.getRequestURI()=/tms/oms/shipment-order_list
/s
EntityActionUtil.getActionUrl(String, String) line: 55	
/=
	public static String getActionUrl(String aFullUrl, String aTargetAction) {
		String myUrlParts[] = aFullUrl.split("/");
myUrlParts	String[4]  (id=18078)	
	[0]	"" (id=18080)	
	[1]	"tms" (id=18081)	
	[2]	"oms" (id=18082)	
	[3]	"shipment-order_list" (id=18083)	

		aTargetAction = StringUtils.formatJavaToFile(aTargetAction).toString();
edit
		String myCurrentEntityAction = myUrlParts[myUrlParts.length - 1];
shipment-order_list
		String myCurrentModule = myUrlParts[myUrlParts.length - 2];
oms

		String[] myCurrentEntityActionParts = myCurrentEntityAction.split("_");
[shipment-order, list]
		myCurrentEntityActionParts[1] = aTargetAction;
[shipment-order, edit]
		return buildActionUrl(myCurrentModule, myCurrentEntityActionParts);

/t
Table.addAction(String) line: 119	
		addAction(aCode, EntityActionUtil.getActionUrl(getRequest(), aCode));
/s
Table.addAction(String, String) line: 129	
/=
	public void addAction(String aCode, String aLink) {
aCode	"edit" (id=17634)	
aLink	"../oms/shipment-order_edit" (id=18177)	
...
		myAction.setLink(aLink);
...
		addAction(myAction);
/s
Table.addAction(TableAction) line: 159	
...
			actionMap.put(anAction.getName(), anAction);
this	Table  (id=17676)	
	actionMap	Collections$SynchronizedMap  (id=18208)	
{edit=com.mpobjects.view.util.table.TableAction@65c8790e}

/ we zoeken naar de sho die OK gaat	,
0025123816


/ We zien in HTML	,

<a class="action" href="../oms/shipment-order_edit?base_sessionLevelOffset=1&amp;systemid=28393888&amp;systemId=28393888"><img src="../lookandfeel/styles/images/icons/check24.gif" border="0" alt="Edit" title="Edit"></a>

/ 28393888 	, de seo id 	, 

/ 7	.

/ we zoeken naar de sho die OK gaat	,
0025123816
/ Neem sho  die ERR gaat ,
0025169619

28413901 N1637038.1 zijn de consignment's system_id, consignment_number	,

/ de Pln. start date is calculated, we moeten hem dus niet update	, 
/ op een seo	, we click 'Edit cost'	,
/ als we kijken naar de calculation log	,
 RC_PLN_START : RP_PLN_START_DATE ( STARTDATE ) = 2015-05-05 23:59:00 DATE
 	RP_LEADTIME_INCL ( SUM ) = 3.0 WORKDAY
 	PLANNED_END_DTM ( ) = 2015-05-08 23:59:00 DATE



/ Einde DSVROAD-610

/ DEBUG DSVROAD-610 JSP


/ 7	.

$ vi oms-sitemap.xmap

<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">
	<map:components>
		<map:actions>
			<map:action logger="shipmentorder" name="shipmentOrderEdit" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderEditAction"/>

	<map:pipelines>
		<map:pipeline>
			<map:match pattern="shipment-order_edit">
				<map:act type="shipmentOrderEdit">
					<map:select type="session-attribute">
						<map:parameter name="attribute-name" value="builder"/>
						<map:when test="jsp">
							<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order_edit.jsp"/>
						</map:when>
						<map:otherwise>
							<map:redirect-to uri="../wicket?module=oms&amp;wicketpage=shipmentorder.edit.ShipmentOrderEditSelectionPage"/>
						</map:otherwise>			
					</map:select>
				</map:act>
			</map:match>

/ we zien in HTML	,

<form class=...>
	<div id="shipmentOrderDetails">
/ = linker column order details	, met Organization, Req. Pickup (After)
	<div id="shipmentOrderDetailsSecond">
/ = 2de column order details	, met Total lines, reference7	, 
	<div id="locationTabCollection">
/ = 3de column , met ship from, ship to	, ...
	<div id="buttonSet">
/ = rij onder deze 3 columns met Save, Save and Close buttons,	
	<div id="shipmentOrderChilds">
/ = vak daaronder met Product Items, Shipment items, Events, Log	, 
	<div id="serviceActions">
/ = vak met bij ons 2 service actions onder elkaar	,

/ we kijken hoe is create	,
	<div id="serviceActions">

$ vi shipment-order_edit.jsp

	<script type="text/javascript" src="../m_script/oms/class.shipment-order_edit.js"></script>


							<%
								if (myConsignmentVO == null) {
							%>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<%
								} else {
							%>
							<td><a href="#" onclick="javascript:gotoServiceOrder('<%=myConsignmentVO.getServiceOrderVO().getSystemId()%>');return false"><%=myConsignmentVO.getConsignmentNr()%></a></td>
							<td>
...
							<%
								}
							%>

$ vi class.shipment_order_edit.js

function gotoServiceOrder(aSystemId){
aSystemId="28413889"
	var myUrl = "../oms/service-order_edit?base_sessionLevelOffset=1&systemId=" + aSystemId;
	if (autoSave()) {
		theShipmentorderFormManager.setRedirectUrl(myUrl);
		theShipmentorderFormManager.submit(null, true, '1');
	return false;
	} else {
		document.location = myUrl+"&base_sessionLevelOffset=1";
}
}


/ 7	. 

$ vi oms-sitemap.xmap

<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">
	<map:components>
		<map:actions>
			<map:action logger="serviceorder" name="serviceOrderEdit" src="com.mpobjects.oms.control.serviceorder.action.ServiceOrderEditAction"/>

	<map:pipelines>
		<map:pipeline>
			<map:match pattern="service-order_edit">
				<map:act type="serviceOrderEdit">
				<map:select type="session-attribute">
					<map:parameter name="attribute-name" value="builder"/>
					<map:when test="jsp">
						<map:read mime-type="text/html" type="jsp" src="jsp/service-order_edit.jsp"/>
					</map:when>
					<map:otherwise>
						<map:redirect-to uri="../wicket?module=oms&amp;wicketpage=serviceorder.edit.ServiceOrderEditSelectionPage"/>
					</map:otherwise>			
				</map:select>
				</map:act>
			</map:match>


/ we zien in HTML	,

<tr>
	<td class="label">Pln. Start date</td>
	<td nowrap="nowrap" class="input">
		<span id="plannedStartAfter_div">
			<input type="text" name="plannedStartAfterDate" onmouseover="userTimeZoneDateTime(this ,'plannedStartAfterDate','Europe/Amsterdam','Europe/Amsterdam');" id="plannedStartAfterDate" size="12" value="07-May-2015" class="dateField required " readonly="readonly" title="7-May-2015 23:59">
			<a href="#" onclick="NewCal('plannedStartAfterDate','ddmmmyyyy',true,'Europe/Amsterdam','Europe/Amsterdam',24); return false;">
				<img src="../lookandfeel/styles/images/icons/calendar16.gif" border="0" alt="Pick a date">
			</a>
			<input type="text" name="plannedStartAfterDateTime" id="plannedStartAfterDateTime" size="5" value="23:59" class="dateField required " readonly="readonly">
			<a href="#" class="hintanchor" onmouseover="showhint('The original start (after) date was:<br>
				<b> 05-May-2015 23:59</b><br><br>The planning-reason description:<br><b></b>', this, event,'')">
				<img src="../lookandfeel/styles/images/icons/info.gif" border="0">
			</a>
		</span>
	</td>
</tr>
/ Pln. Start Date


<div id="buttonSet">
    <input type="button" name="saveBtn" id="saveBtn" value="Save" onclick=" theMpoFormFormManager.submit('../oms/service-order_save', false, 0);">
/ Save Button	,

/ Geef in console van devtools	,
/ Kies: main_frame(shipment-order_edit)
> theMpoFormFormManager
FormManager {theFormName: "mpoForm", lastAction: "", beingProcessed: false, lastDoRedirect: "", getLastAction: function…}
> theMpoFormFormManager.submit
function (anAction, aBoolDoRedirect, aRedirectionLevelOffset) {
...
/ we zien rechtsonder class.formmanager.js

/we zien in HTML de totale page`	 ,

<div id="serviceorderDetails/>
/ 1ste column Booking	,
<div id="serviceorderDetailsSecond/>
/ 2de column Booking	,
<div style>
	<div id="locationTabCollection"/>
/ 3de column met ship to, bill to	, ...
<div id="buttonSet">
    <input type="button" name="saveBtn" id="saveBtn" value="Save" onclick=" theMpoFormFormManager.submit('../oms/service-order_save', false, 0);">
<div id="serviceActionTabCollection"/>
/ vak met tabs serviceactions, event, ...

$ vi ServiceOrderEditAction.java
	@Override
	public Map act() throws java.lang.Exception {
				ServiceOrderVO myVO = getServiceOrderBAO().getServiceOrder(getSystemIdFromRequest());
				DateSetVO myDateSetVO = myVO.getDateSetVO();
				getRequest().setAttribute("formVO", myVO);
				getRequest().setAttribute("dateSetVO", myDateSetVO);

/ formVO wordt used in 	de jsp	,
/ we zien ook ${formVO.dateSetVO}	, maar ${dateSetVO} had ook gekund?
/ TODO ERICJ 


$ vi service-order_edit.jsp


		<mpo:form name="mpoForm" action="service-order_save" entity="serviceOrder" readOnly="${readOnly}">
    <div id="serviceOrderDetails">
    			<mpo:setFormVO valueObject="${formVO.dateSetVO}">
  					<mpo:dateField name="plannedStartAfter" required="true"	type="DATE_TIME" overRideable="true"
						infoVisible="${formVO.dateSetVO.origPlannedStartAfter!=null}"
						infoValue=" ${cf:formatDateTime(formVO.dateSetVO.origPlannedStartAfter)}|${formVO.planningReasonCode.description}" />
/ Dit is Pnl Start Date	,

    <div id="serviceOrderDetailsSecond"/>

   <mpo:tabCollection name="location" defaultTab="${formVO.serviceOrderProcess=='INBOUND'?'shipFrom':'shipTo'}">
    	<mpo:tabList>
    		<mpo:defineTab name="shipFrom" />
 			...

<div id="buttonSet">
    <mpo:button type="save" />
	...

   <mpo:tabCollection name="serviceAction"  defaultTab="${param.base_routeAction=='consignmentEdit'||param.base_routeAction=='moveConsignment'?'route':'serviceActions'}" >
		<mpo:tabList>
		...


<div id="buttonSet">
    <mpo:button type="save" />`

/ 13	. 

/ Wat doet	,
    <mpo:button type="save" />`

/ Hoe komen we aan	,
    <input type="button" name="saveBtn" id="saveBtn" value="Save" onclick=" theMpoFormFormManager.submit('../oms/service-order_save', false, 0);">

$ vi mpo.tld

<taglib>
	<uri>http://www.mp-objects.com/taglibs/mpo</uri>
	<tag>
		<name>button</name>
		<tagclass>com.mpobjects.view.taglib.form.ButtonTag</tagclass>

$ vi ButtonTag.java
	@Override
	public int doStartTag() throws JspTagException {

			} else if (getType().equals(TYPE_SUBMIT_AND_CLOSE) || getType().equals(TYPE_SAVE_AND_CLOSE)) {
				myPrint.append("<input type=\"button\"");
				myPrint.append(" id=\"" + getType() + "Btn\"");
				myPrint.append(" value=\"" + getLabel("save_and_close") + "\"");
				myPrint.append(" onclick=\" " + getForm().getJsFormManager() + ".submit('" + getSaveUrl() + "', true, '-1'); return false;\"");
				...
/ TODO
/ of	,
			} else if (getType().startsWith(TYPE_ACTION)) {
				String myAction = getType().substring(7, getType().length()).trim();
				myPrint.append("<input type=\"button\"");
				myPrint.append(" name=\"" + getType() + "Btn\"");
				myPrint.append(" id=\"" + getType() + "Btn\"");
				myPrint.append(" value=\"" + myAction + "\"");
				myPrint.append(" onclick=\" " + getForm().getJsFormManager() + ".submit('"
						+ EntityActionUtil.getActionUrl(getRequest(), myAction.toLowerCase()) + "', " + getDoRedirect() + ", " + getRedirectLevelOffset()
						+ ");\"");

				myPrint.append("/>");
/ TODO

/ 13	. 

$ vi service-order_edit.jsp

<%@taglib prefix="ctf" tagdir="/WEB-INF/tags/core/"%>
<ctf:page title="serviceOrderEdit" type="form">
	<ctf:pageHeader>

[eric@localhost dsvcts]$ vi deploy/tms.war/WEB-INF/tags/core/
/ of	, 
$ vi ./base-framework/core/war/WEB-INF/tags/core/pageHeader.tag
pageBody.tag       pageHeader.tag     page.tag           userLoginBody.tag  

/ dit is dus geen custom tag	, zoals <mpo:form/>

$ vi service-order_edit.jsp

<%@taglib uri="http://www.mp-objects.com/taglibs/mpo" prefix="mpo"%>
   <mpo:form ... 

/ Hoe van deze uri naar mpo.tld?
$ vi mpo.tld
<taglib>
	<uri>http://www.mp-objects.com/taglibs/mpo</uri>
	<tag>
		<name>button</name>
		<tagclass>com.mpobjects.view.taglib.form.ButtonTag</tagclass>

/ see LOG_8_sep_2014.txt	,
$ vi web.xml

<web-app>
    <jsp-config>
        <taglib>
                <taglib-uri>http://localhost/custom</taglib-uri>
                <taglib-location>/custom.tld</taglib-location>
        </taglib>
    </jsp-config>
</web-app>
/ Wanneer zo , en wanneer zo?
/ TODO 

/ 7	.

/ we gaan verder met	,

    <input type="button" name="saveBtn" id="saveBtn" value="Save" onclick=" theMpoFormFormManager.submit('../oms/service-order_save', false, 0);">

$ vi class.formmanager.js

/ we vallen in de js debugger	,

    this.submit = function(anAction, aBoolDoRedirect, aRedirectionLevelOffset) {
anAction: "../oms/service-order_save"
aBoolDoRedirect:false
aRedirectionLevelOffset:0

        document.getElementById("base_sessionLevelOffset").value=aRedirectionLevelOffset;
		document.getElementById("doRedirect").value=aBoolDoRedirect;

/ in console
> doument.getElementById("base_sessionLevelOffset")
<input type="hidden" name="base_sessionLevelOffset" id="base_sessionLevelOffset" value="0" size="20">
> document.getElementById("doRedirect")
<input type="hidden" name="doRedirect" id="doRedirect" value="false">

        var myForm = document.getElementById(this.theFormName);
/ this.theFormName="mpoForm"
        if(anAction){
/ anAction: "../oms/service-order_save"
        	myForm.action=anAction;

            myForm.submit();

$ vi oms-sitemap.xmap

<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">
	<map:components>
		<map:actions>
			<map:action logger="serviceorder" name="serviceOrderSave" src="com.mpobjects.oms.control.serviceorder.action.ServiceOrderSaveAction"/>

	<map:pipelines>
		<map:pipeline>
			<map:match pattern="service-order_save">
				<map:act type="serviceOrderSave"/>
				<map:act type="debugAction"/>
			</map:match>


/ Einde DEBUG DSVROAD-610 JSP

/ DEBUG DSVROAD-610 BACKEND

/ 7	.

/ dsvcts	, 

/ sho 0025123816	, 
/ deze gaat OK	,

/ we veranderen start date after op de seo	, 
/ we click Save 

/ we gaan	,
	ServiceOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	
/s
	ServiceOrderSaveAction(AbstractSaveAction).act() line: 69	
/s
	ServiceOrderSaveAction.handleSave() line: 21	
/s
	ServiceOrderSaveAction(ServiceOrderSaveAction).handleSave() line: 184	
/s
	ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderVO, TMSEventContext, boolean, boolean) line: 1495	
/s
	ConsignmentServiceImpl.handleServiceOrderActualDateChange(ServiceOrderVO, ServiceOrderVO) line: 415	

/ Meer detail	,
/s
ServiceOrderSaveAction(ServiceOrderSaveAction).handleSave() line: 88	

			theVO = (ServiceOrderVO) getValueObject();
/s
ServiceOrderSaveAction(BoundSaveAction).getValueObject() line: 197	
		return getFetchedData().iterator().next();
/ getFetchedData()=ArrayList
[N1637038/28413889,
 RSAFTER: 2015-05-05 00:00:00.0, RSBEFORE: 2015-05-05 00:00:00.0, REAFTER: 2015-05-08 23:59:00.0, REBEFORE: 2015-05-08 23:59:00.0, PSAFTER: Tue May 05 23:59:00 CEST 2015, PSBEFORE: Tue May 05 23:59:00 CEST 2015, PEAFTER: Fri May 08 23:59:00 CEST 2015, PEBEFORE: Fri May 08 23:59:00 CEST 2015, AS: Tue May 05 00:00:00 CEST 2015, AE: null, RELEASE:Mon May 04 12:00:00 CEST 2015, PRELEASE:Mon May 04 12:00:00 CEST 2015, CLOSE:null,
 N1637038/28413889,
 N1637038/28413889,
 N1637038/28413889,
 N1637038/28413889,
 PARTY id:F280(systemId:0),
 PARTY id:F280(systemId:0),
 N1637038/28413889,
 N1637038/28413889,
 PARTY id:0000824325(systemId:0),
 PARTY id:0000824325(systemId:0),
 N1637038/28413889,
 N1637038/28413889,
 N1637038/28413889,
 RSAFTER: 2015-05-05 00:00:00.0, RSBEFORE: 2015-05-05 00:00:00.0, REAFTER: 2015-05-08 23:59:00.0, REBEFORE: 2015-05-08 23:59:00.0, PSAFTER: 2015-05-04 23:59:00.0, PSBEFORE: 2015-05-04 23:59:00.0, PEAFTER: 2015-05-08 23:59:00.0, PEBEFORE: 2015-05-08 23:59:00.0, AS: 2015-05-05 00:00:00.0, AE: null, RELEASE:null, PRELEASE:null, CLOSE:null,
 N1637038/28413889,
 Event id: [28413903], event type: [IOC], status: [CLOSED_NORMAL],
 Event id: [28413904], event type: [IOD], status: [OPEN_DEFAULT],
 Event id: [28413889], event type: [], status: [OPEN_DEFAULT]]

theVO	ServiceOrderVO_$$_javassist_100  (id=16338)	
/ initialized proxy	,
/ TODO ERICJ

			int mySystemId = getSystemIdFromRequest();
28413889
			} else {
				theVO = MpoBeanFactory.getBean(ServiceOrderService.class).updateServiceOrder(theVO, myEventContext, true, true);
/s
ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderVO, TMSEventContext, boolean, boolean) line: 1495	
/=
	public ServiceOrderVO updateServiceOrder(ServiceOrderVO aServiceOrder, TMSEventContext aContext, boolean propagate, boolean replan) {
this	ServiceOrderServiceImpl  (id=16392)	
aServiceOrder	ServiceOrderVO  (id=16399)	
aContext	TMSEventContext  (id=16373)	
	theFlags	57	
	updateConsignmentCount	0	
propagate	true	
replan	true	

myOldServiceOrderVO	ServiceOrderVO  (id=16197)	
	theDateSetVO	DateSetVO  (id=16467)	
		thePlannedStartAfter	Date  (id=16485)	
Mon May 04 23:59:00 CEST 2015
/ Pln. Start Date WAS 4 may	, we hebben 5 may gegeven	, en Save	,

				if (propagate) {
					consignmentService.handleServiceOrderPlannedDateChange(aServiceOrder, myOldServiceOrderVO);
/s
ConsignmentServiceImpl.handleServiceOrderPlannedDateChange(ServiceOrderVO, ServiceOrderVO) line: 579	

		if (!DateUtils.equals(myOldPlannedStartAfter, myNewPlannedStartAfter) || !DateUtils.equals(myOldPlannedEndAfter, myNewPlannedEndAfter)
				|| !DateUtils.equals(myOldPlannedEndBefore, myNewPlannedEndBefore)) {
/ JA
myOldPlannedStartAfter	Date  (id=16885)	
Mon May 04 23:59:00 CEST 2015
myNewPlannedStartAfter	Date  (id=16882)	
Tue May 05 23:59:00 CEST 2015

				if (myCoStart == null || mySoStart == null || mySoStart.before(myCoStart) || !keepRestrictions
						&& !DateUtils.equals(myOldPlannedStartAfter, myNewPlannedStartAfter)) {
					myConsignmentVO.getDateSetVO().setPlannedStartAfter(mySoStart);
					myConsignmentVO.getDateSetVO().setPlannedStartBefore(mySoStart);
					isChanged = true;


			for (Object myElement : myConsignmentList) {
N1637038.1/28413901
/ dit is de consignment	,
/ select*from service_order where service_order_id='N1637038';
/ 28413889 is de system_id	,

				if (isChanged) {
					try {
						updateConsignmentAfterServiceOrderChange(myOld, myConsignmentVO);
/s
ConsignmentServiceImpl.updateConsignmentAfterServiceOrderChange(ConsignmentVO, ConsignmentVO) line: 1104	
			triggerEventHandler(anOld, aConsignment, true, new TMSEventContext());
/s
ConsignmentServiceImpl.triggerEventHandler(ConsignmentVO, ConsignmentVO, boolean, TMSEventContext) line: 1078	
		} else {
			myEvent = new ConsignmentEvent(anOldVO, aNewVO, ConsignmentEvent.UPDATED, myContext);
		}
		if (myEvent != null) {
			myEvent.setInitiatedByServiceOrderChange(anIsInitiatedByServiceOrderChange);
			eventHandlerService.handleEvent(myEvent);
/s
EventHandlerServiceImpl.handleEvent(Event) line: 89	
			listenerList.fireEvent(anEvent);
/s
ListenerList.fireEvent(Event<?>) line: 82	
		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);
/s
RateCalcEventListener.handleEvent(Event) line: 66	
			String myRecalcExecution = ApplicationPropertyManager.getInstance().getModuleProperty("ratecalc", "serviceorder.ratecalculation.execution");
auto
			if (myRecalcExecution.equalsIgnoreCase("auto")) {
				recalcServiceOrderCost(anEvent);
/s
		if (myType.equals(ConsignmentEvent.UPDATED) || myType.equals(ConsignmentEvent.CREATED)) {
/ JA
					// make sure we have the newest - TR: since the 2011.04 this is not the newest any more?
					ServiceOrderVO myOrderVO = getServiceOrderBAO().getServiceOrder(myNewVO.getServiceOrderVO().getSystemId());
/ TODO PETER/PAUL
					anEvent.debug("handled by RateCalcEventListener - recalculating cost for new consignment [" + myOrderVO.getServiceOrderId() + "]");
					recalculate(myOrderVO, AgreementType.SERVICE_ORDER, anEvent.getEventContext());
/s
RateCalcEventListener.recalculate(ServiceOrderVO, AgreementType, TMSEventContext) line: 229	
		if (doRecalculate) {
			boolean calculateServiceOrderCostsImmediately = Boolean.parseBoolean(ApplicationPropertyManager.getInstance().getModuleProperty("ratecalc",
					"serviceorder.calculaterightafterplanning", "false"));
			// calculate in batch or immediately
			if (calculateServiceOrderCostsImmediately) {
/ JA
				getCalculationService().recalculate(myOrder, AgreementType.SERVICE_ORDER, anEventContext);
/s
CalculationServiceImpl.recalculate(LogisticsOrderVO, AgreementType, TMSEventContext) line: 443	
			List<RateAgreementVO> mySelectedRateAgreement = getMatchingRateAgreement(anOrder, aRateType);
[theSystemId: 26865342Name :DCT_BE_1AUG2014-Current
Description :Rates ex Belgium from period 1 aug 2014
Organization :SystemId:3000	Id:DSV-DOW	Description:Dow Control Tower
Unit :theSystemId: 1000072	Symbol :EUR	Description :EUR	UnitType :CURRENCY	IsDeleted :0	
IsDeleted :false
Type :SERVICE_ORDER
]
			// Now calculate the rates
			RateCalculationVO myRateCalculationVO = new RateCalculationVO();
			if (anOrder instanceof ServiceOrderVO) {
				myRateCalculationVO.setServiceOrder((ServiceOrderVO) anOrder);

			if (mySelectedRateAgreement.isEmpty()) {
			} else {
				myRateCalculationVO.setRateAgreementVO(mySelectedRateAgreement);

				if (anOrder instanceof ServiceOrderVO) {
/ JA
					ServiceOrderVO myServiceOrder = (ServiceOrderVO) anOrder;

					if (!myRateCalculationVO.rateCalculationRequired()) {
/ NEE
/ is dus wel required	,

				// Now calculate the rates
				myRateCalculationVO.runFor(mySelectedRateAgreement);
/s
RateCalculationVO.runFor(List<RateAgreementVO>) line: 760	
		setRateAgreementVO(aRateAgreementVO);
		LogisticsOrderVO myOrder = getOrder();
N1637038/28413889
			if (myList.size() == 0) {
				/* No variables (iteration) involved */
				addToLog("Calculating rate agreement, no variables defined");
				calculateWithoutVariables();
/ Duurt lang	,
/ TODO

				try {
					if (serviceOrder != null || shipmentOrder != null || customerOrderLine != null) {
/ JA
						RateCalculationAlternative firstAlt = alternativeList.iterator().next();
firstAlt	RateCalculationAlternative  (id=17272)	
	LOG	Log4JLogger  (id=17292)	
	logLines	ArrayList  (id=17294)	
	missedOrderDetail	HashSet  (id=17295)	
	rateCalculation	RateCalculationVO  (id=17076)	
	resultSetList	HashMap  (id=17317)	
	score	AlternativeScore  (id=17319)	
	success	true	
	usedOrderDetail	HashSet  (id=17325)	
	variables	HashMap  (id=17327)	

						for (AlternativeResultSet mySet : firstAlt.getResultSetList().values()) {
							switch (mySet.getEntityType()) {
								case SERVICE_ORDER:
									// Update the service order cost records
									ServiceOrderVO myServiceOrder = MpoBeanFactory.getBean(ServiceOrderDao.class).getBySystemId(mySet.getEntitySystemId());
									MpoBeanFactory.getBean(ServiceOrderCalculationService.class).updateServiceOrder(myServiceOrder, mySet, myLog);
/s
ServiceOrderCalculationServiceImpl.updateServiceOrder(ServiceOrderVO, AlternativeResultSet, List<String>) line: 88	
		// Generate the current state for cost types
		Map<RateComponentKey, RateTypeState> costTypeState = RateTypeUtils.createCostTypeState(aServiceOrder, false);
{FREIGHT-EUR-ESTIMATED=com.mpobjects.oms.util.serviceordercost.RateTypeState@20910557}
/ Klopt	, als we op de seo click op 'Edit Cost'	, dan zien we onder Post-calculated	,
Freight 54.75 ...

		// Iterate through the cost components to update the SHO and to calculate the new values of the price types
		if (anAlternative != null) {
			// Calculate the new values for a price type according to the rate calculation
			newValues = getCalculatedRateTypeValues(anAlternative.getCostResults(), aServiceOrder, aLog);
/ Duurt lang	,
/ TODO
{FREIGHT-EUR-ESTIMATED=0.00 (FREE); 54.75 (ADD), Temperature-EUR-ESTIMATED=0.00 (ADD); 0.00 (FREE), Hazardous-EUR-ESTIMATED=0.00 (FREE); 0.00 (ADD)}

			// Iterate through the cost components to update the SHO and to calculate the new values of the price types
			orderChanged |= correctServiceOrder(anAlternative.entrySet(), aServiceOrder, aLog);

		try {
			orderChanged |= updateServiceOrderCostPartList(anAlternative, aServiceOrder, costTypeState, newValues, resultingParts, aLog);
/s
ServiceOrderCalculationServiceImpl.updateServiceOrderCostPartList(AlternativeResultSet, ServiceOrderVO, Map<RateComponentKey,RateTypeState>, Map<RateComponentKey,CostValue>, Set<ServiceOrderCostVO>, List<String>) line: 256	

		// Go through the new costs and update the service order cost parts accordingly
		for (Entry<RateComponentKey, CostValue> entry : aNewValues.entrySet()) {
FREIGHT-EUR-ESTIMATED=0.00 (FREE); 54.75 (ADD)

///////////////////
/ we zien onder Post-calculated Cost	, maar ook Calculation Log	, hieronder zien we WH entries	,

			RateComponentType rateType = entry.getKey().getRateComponentType();
com.mpobjects.oms.model.ratecomponenttype.RateComponentType@33034d8[systemId=9703918,code=FREIGHT,description=Freight,group=COST,reasonMandatory=false,deleted=false,sequenceNr=1]
			CurrencyVO myCurrency = entry.getKey().getCurrency();
SystemId:7001	isDeleted:false	Code:EUR	Name:Euro

			CostValue costValue = entry.getValue();
0.00 (FREE); 54.75 (ADD)
			RateTypeState<ServiceOrderCostVO> state = aCostTypeState.get(entry.getKey());
			} else {
				// check if there is a correction needed on the value of the existing price type

				BigDecimal oldValue = state.getCostValue().getValue();
54.75
				BigDecimal newValue = costValue.getValue();
54.75
				if (oldValue.compareTo(newValue) == 0) {
					aResultingParts.addAll(state.getRateParts());
[28413902        54.75]
					continue;
/ Naar volgende entry-for loop	,

		// Go through the new costs and update the service order cost parts accordingly
		for (Entry<RateComponentKey, CostValue> entry : aNewValues.entrySet()) {
Temperature-EUR-ESTIMATED=0.00 (ADD); 0.00 (FREE)

/ deze entry zien we ook onder Calculation Log op 'Service Order Finance'	,

			RateComponentType rateType = entry.getKey().getRateComponentType();
com.mpobjects.oms.model.ratecomponenttype.RateComponentType@59d06cb6[systemId=9712823,code=Temperature,description=KFF/Temp Control,group=COST,reasonMandatory=false,deleted=false,sequenceNr=14]
			CurrencyVO myCurrency = entry.getKey().getCurrency();
SystemId:7001	isDeleted:false	Code:EUR	Name:Euro

			CostValue costValue = entry.getValue();
0.00 (ADD); 0.00 (FREE)
			RateTypeState<ServiceOrderCostVO> state = aCostTypeState.get(entry.getKey());
null
			if (state == null) {
				// No previous state, add the cost type in a new cost part
				ServiceOrderCostVO costPart = new ServiceOrderCostVO();

				CorrectionType correctionType = CorrectionType.ADD;
				BigDecimal value = costValue.getValue();
				if (NumberUtils.isZero(value)) {
					if (costValue.isFreeOnly()) {
/ NEE
					} else {
						continue;

/ volgende entry	,

		for (Entry<RateComponentKey, CostValue> entry : aNewValues.entrySet()) {
Hazardous-EUR-ESTIMATED=0.00 (FREE); 0.00 (ADD)

			RateComponentType rateType = entry.getKey().getRateComponentType();
com.mpobjects.oms.model.ratecomponenttype.RateComponentType@371742e5[systemId=9708023,code=Hazardous,description=Hazardous surcharge,group=COST,reasonMandatory=false,deleted=false,sequenceNr=2]
			CurrencyVO myCurrency = entry.getKey().getCurrency();

			CostValue costValue = entry.getValue();
0.00 (FREE); 0.00 (ADD)
			RateTypeState<ServiceOrderCostVO> state = aCostTypeState.get(entry.getKey());
null
/ Zie vorige entry	,

/ volgende entry	,
		for (Entry<RateComponentKey, CostValue> entry : aNewValues.entrySet()) {


/ Einde DEBUG DSVROAD-610 BACKEND

/ PNL-544


/ 7	. 

/ Lees	,
https://system.mp-objects.com/xwiki/bin/view/Technology/FindPrivileges

/ we hebben een log4j.xml checkout	, maar dat is een model, template	, wordt niet used	,

/ in conf/ , in jboss is de log4j.xml die wordt used	,

$ vi conf/log4j.xml

 <appender name="privs" class="org.jboss.logging.appender.DailyRollingFileAppender">
      <param name="File" value="${jboss.server.log.dir}/privileges.log"/>
      <!-- Rollover at midnight each day -->
      <param name="DatePattern" value="'.'yyyy-MM-dd"/>
      <layout class="org.apache.log4j.PatternLayout">
         <!-- The default pattern: Date Priority [Category] Message\n -->
         <param name="ConversionPattern" value="%d %-5r %-5p [%c] (%t:%x) %m%n"/>
      </layout>
   </appender>

    <category name="privileges" additivity="false">
      <appender-ref ref="privs"/>
      <priority value="DEBUG" />
   </category>

/ we zien inderdaad log/privileges.xml

/ 7	. 

/ update eric's row in user_role	, set 'm op ADMINISTRATOR	,


pnloms7=# select r.* from user_role ur join tms_user u on u.system_id=ur.user_systemid join tms_role r on r.system_id=ur.role_systemid and r.name='ADMINISTRATOR';
pnloms7=# select ur.* from user_role ur join tms_user u on u.system_id=ur.user_systemid join tms_role r on r.system_id=ur.role_systemid where u.user_id='eric';

pnloms7=# update ur set ur.role_systemid=(select system_id from tms_role where name='ADMINISTRATOR') from user_role ur join tms_user u on u.system_id=ur.user_systemid join tms_role r on r.system_id=ur.role_systemid where u.user_id='eric';

/ TODO

/ 7	.

/ we geven eric de SuperUser role	, en add privileges	,

/ 7	. 

/ eric als SUperUser moet menu item : planning, shipment order, create

$ vi oms-menu.xml
	<m:add path="planning.shipmentOrder.create" actionUrl="oms/shipment-order-template_list?refresh=false" privilege="shipment-order-fast.create" index="2042" />

/ deze privilege bestaat niet	,
/ we maken hem	, 
/ eerst de business object: shipment-order-fast
/ dan de privilege : create bij deze business object	,

configuration, administration, business object
create new entry
/ we zien een nieuw window: 
code: shipment-order-fast
description: .
Save

configuration, administration, privilege
create new entry 
/ we zien een nieuw window: 
business object: click icon naast het text field, select die we zojuist hebben create	: geef 'fast' onder code en lookup	, we zien shipment-order-fast	,
privilege type: click icon naast het text field, select create	, 
Save

/ 7	. 

/ we kunnen ook zelf een role create	,  PNL	, maar deze gaan we niet use	,

configuration, administration, role
create new role
Name : PNL
role weight : 8				/ net als SuperUser
charge type :full				/ net als SuperUser
session timeout: 30 / net als SuperUser
Save
/ Als we eerst privileges add, dan ERR
/ TODO HIBERATE

/ edit nu deze role, en voeg bijv alle privileges toe	.

/ 7	. 

	<m:add path="planning.shipmentOrder.fastCreate" privilege="user-shipment-order-template.list" actionUrl="wicket?module=oms&amp;wicketpage=entitygroup.UserShipmentOrderListPage" index="2100"/>  

/ de privilege "user-shipment-order-template.list"  bestaat al	,

/ voeg deze privilege toe aan de SuperUser role	,

/ 7	.

/ van SuperUser rm role shipment-order.create , add shipment-order-fast.create
/ kan eric een shipment order bewerken	?

/ SuperUser NIET role shipment-order.create , WEL shipment-order-fast.create

/ 7	. 

/ we oef	, 

/ we willen een join table update	,

foo=> select*from u;
 id | name 
----+------
 11 | eric
(1 row)

foo=> select*from r;
 id |  name   
----+---------
  1 | ADMIN
  2 | MANAGER
(2 rows)

foo=> select*from ur;
 user_id | role_id 
---------+---------
      11 |       1
(1 row)

foo=> update ur set role_id=(select id from r where name='MANAGER') where user_id=(select id from u where name='eric');
UPDATE 1
foo=> select*from ur;
 user_id | role_id 
---------+---------
      11 |       2
(1 row)

/ Einde PNL-544

/ APPL

planning, shipment order, fast create	,
/ we zien shipment order templates in de groups waar de login aan linked is	,

configuration, planning, shipment order
all templates							/ all shipment order templates
template group							/ groups van temolates
user template							/ links user aan groups	,

/ Einde APPL

/ GEODIS

/ Open SVN Repository Exploring view	,
/ browse in SVN Repositories naar 2015.02/geodis
/ right click, Checkout...


/ Einde EODIS

/ SVN COMMAND LINE

[eric@localhost workspace]$ svn list https://system.mp-objects.com/svn/scs
branches/
infra/
patches/
tags/
trunk/
[eric@localhost workspace]$ svn list https://system.mp-objects.com/svn/scs/branches
/ NIET	,
[eric@localhost workspace]$ svn list https://system.mp-objects.com/svn/tms/branches
2012.03/
2013.01/
2013.01.dsvoms/
2013.02/
2013.03.02/
2013.04/
2013.04.01/
2014.01/
2014.01.cevaoms/
2014.01.ux/
2015.01/
2015.02/
2015.02.isbscs/
2015.03/
2015.04/

[eric@localhost 2015.04]$ svn list https://system.mp-objects.com/svn/scs/trunk
/ of	,
[eric@localhost 2015.04]$ svn co https://system.mp-objects.com/svn/tms/branches/2015.04

[eric@localhost 2015.04]$ cp 2015.03/.classpath 2015.04
/ en verander 2015.03 -> 2015.04
[eric@localhost 2015.04]$ cp 2015.03/.project 2015.04
/ en verander 2015.03 -> 2015.04

/ en 	,
[eric@localhost 2015.04]$ cp 2015.03/application.properties 2015.04 
/ want dit is een locale file	,





/ Einde SVN COMMAND LINE

/ REST

[eric@localhost REST]$ pwd
/home/eric/Devel/REST

/ we hadden eerder	,
svn co https://system.mp-objects.com/svn/tms/trunk

/ wat is scs/trunk (in vergl met tms/trunk, wat onze appl is)?
/ TODO

/ nu	,
[eric@localhost REST]$ svn co https://system.mp-objects.com/svn/scs/trunk/smix

[eric@localhost pb-event-ws]$ pwd
/home/eric/Devel/REST/smix/pb-event-ws
/ Dit is SOAP	, 
/ REST frameworks zijn Restlet, 

/ Lees over SOAP	,
http://www.mkyong.com/webservices/jax-ws/jax-ws-hello-world-example/




/ Einde REST

/ SCS-...

/ 7	. 

/ Intermezzo

/ Behavior's	,

package com.mpobjects.view.wicket.util.multi;
public abstract class AbstractGenericEditPanel<T extends EntityInterface> extends Panel implements IAjaxIndicatorAware {
	protected final void addComponent(Component aComponent) {
		aComponent.add(new AddHeaderBehavior(prefix));
		editForm.add(aComponent);
	}
	protected final void addComponent(FormComponent aComponent) {
		aComponent.setOutputMarkupId(true);
		aComponent.add(new GenericFormComponentBehavior()).add(new AddHeaderBehavior(prefix));
		editForm.add(aComponent);
	}

package com.mpobjects.capabletopromise.view.wicket.resource;
public class ResourceEditPanel extends GenericFormPanel<Resource> {
	protected void setForm(final GenericForm<Resource> aForm) {
		...
		codeField.add(StringValidator.maximumLength(50)).add(new GenericFormComponentBehavior());
		...
		descField.add(StringValidator.maximumLength(100)).add(new GenericFormComponentBehavior());

/ Einde Intermezzo

/ 13	. 

public class PrivilegeEditPage extends PrivilegeSelectPage implements PrivilegeEditFormCallback {
		button = new EntityActionAjaxButton<PrivilegeVO>("delete", new ResourceModel("delete")) {
			@Override
			protected Button createButton(final IModel<PrivilegeVO> aModel, String aId) {
				Button btn = super.createButton(aModel, aId);
				String jsCode = "if (!confirm('"
						+ JavascriptUtils.escapeQuotes(new StringResourceModel("deleteConfirm", PrivilegeEditPage.this, aModel,
								"Are you sure you want to delete ${code}?").getObject()) + "')) return false;";
				btn.add(new AttributePrepender("onclick", true, new Model<String>(jsCode), ";"));
/ AttributePrepender is een Behavior	,

/ 13	. 










/ Einde SCS-...

/ PNL-313

/ planning, shipment order, mass update
ShipmentOrderMassUpdatePage	,

/ check allen	, click update	,
/ we komen op 	,

Entity Action Group Edit Page


/ er zijn 	,

$ vi ShipmentOrderMassUpdatePage.html
<wicket:extend>
	<h1><wicket:message key="shipmentordermassupdatepage.title"></wicket:message></h1>
	<div wicket:id="query"></div>
</wicket:extend>

$ vi ShipmentOrderMassUpdatePage.java
	myGroupActions.add(new GroupAction("update", "edit") {
			@Override
			public void execute(Set<? extends Serializable> aSelectedRowSet) {
				...
			}
	}
	...
	add(new QueryViewPanel("query", Model.of(myQuery), null, myGroupActions, selection) {
/ Hier wordt myQuery used	,
myQuery	QueryDefinition  (id=19746)	
	columns	ArrayList  (id=19818)	
		elementData	Object[15]  (id=19824)	
			[0]	IdQueryColumn  (id=19776)	
			[1]	QueryColumn  (id=19805)	
			[2]	QueryColumn  (id=19806)	
			[3]	QueryColumn  (id=19807)	
			[4]	QueryColumn  (id=19808)	
			[5]	QueryColumn  (id=19809)	
			[6]	QueryColumn  (id=19810)	
			[7]	QueryColumn  (id=19811)	
			[8]	QueryColumn  (id=19812)	
			[9]	QueryColumn  (id=19813)	
			[10]	QueryColumn  (id=19814)	
			[11]	QueryColumn  (id=19815)	


/ Deze group actions gaan naar ActionPanel, die for loops create voor iedere action	, en een GroupActionPanel create	,


$ vi QueryViewPanel.java
	private void addActionBar() {
		ActionPanel myActionPanel = new ActionPanel("action-panel", groupActionList, Model.ofSet(selectedRows));
		add(myActionPanel);

	}
$ vi QueryViewPanel.html
		<div class="navigation-bar">
			<div class="rowcount" wicket:id="rowcounttop"></div>
			<div class="action-panel" wicket:id="action-panel"></div>
		</div>
/ De Update button zit in action-panel	,

/ Intermezzo

/ als we click op 'Update'	, dan vallen we in 	,
ShipmentOrderMassUpdatePage$1.execute(Set<Serializable>) line: 109	

			myGroupActions.add(new GroupAction("update", "edit") {

				@Override
				public void execute(Set<? extends Serializable> aSelectedRowSet) {
aSelectedRowSet=[26737371, 26716463, 26716371, 26770147, 26737381, 26716475, 26716306]

/ Einde Intermezzo

$ vi ActionPanel.java
		RepeatingView myActionList = new RepeatingView("action");
		for (GroupAction myAction : anActionList) {
			myActionList.add(new GroupActionPanel(myActionList.newChildId(), myAction, aSelection));
		}
		add(myActionList);

$ vi ActionPanel.html
<wicket:panel>
	<div class="group-action" wicket:id="action"/>

$ vi GroupActionPanel.java
	public GroupActionPanel(String aId, final GroupAction anAction, final IModel<Set<? extends Serializable>> aSelection) {
		AjaxLink myLink = new AjaxLink("button") {
			@Override
			public void onClick(AjaxRequestTarget aArg0) {
				anAction.execute(aSelection.getObject());
			}

$ vi GroupActionPanel.html
<wicket:panel>
	<button class="icon" wicket:id="button" type="button"><span wicket:id="label"></span></button>
</wicket:panel>

/ Samenvatting	,
/ Om te weten wat er gebeurt als we Update click moeten we dus in de action kijken	, in ShipmentOrderMassUpdatePage.java	,
			myGroupActions.add(new GroupAction("update", "edit") {
				@Override
				public void execute(Set<? extends Serializable> aSelectedRowSet) {
						page = new EntityActionGroupEditPage(Model.of(myEntityActionGroup), ShipmentOrderMassUpdatePage.this);

$ vi EntityActionGroupEditPage.java
	protected void createPage(IModel<EntityActionGroup> anActionGroupModel, Page basePage, int aShipmentOrderId) {
		add(new EntityActionGroupPanel("editPanel", anActionGroupModel, basePage, aShipmentOrderId) {

$ vi EntityActionGroupEditPage.hmtl
	<div wicket:id="editPanel"></div>


$ vi EntityActionGroupPanel.java
...

$ vi EntityActionGroupPanel.hmtl
						<wicket:message key="description">Description</wicket:message>

/ Intermezzo

planning, shipment order, mass update	,
select all (OPEN)
/ click Update
/ we komen op Entity Action Group Edit Page
/ geef 
Omschrijving: test
/ click Opdrachten
/ Kies HOLD ( dit is een veld op de sho) ,en value CREDIT_HOLD
Save
/ Je kunt nu naar
planning, shipment order, mass update dashboard	,
/ daar zien we bij My actions de nieuwe test als INITIAL	, je kunt deze open/edit	,  we komen weer op de Entity Action Group Edit Page pagina	,
/ click Start bij Authorization	, we zien 
Noord-PI PENDING 
/ hover hier over heen	, hij wordt geel, en click , er verschijnt een nieuw window	,
/ type een text, en Approve	,
/ OK
/ Ga naar dashboard	 door click : Close	,
/ we zien dat hij EXECUTED is	,



/ Einde Intermezzo


/ 7	. 
language_nl_NL_pnlnl.properties
/ we hebben een script create	,
$ vi ~/bin/cp-from-test.sh
scp "mposerv11:/local/apps/jboss-4.0.5.GA/server/$@" .
/ doe	,
[eric@localhost conf]$ cp-from-test.sh pnloms/conf/language_nl_NL_pnlnl.properties


/ 7	. 

/ In nl_NL_pnlnl 	,
actions = [Actions]
status = [Status]
requestedby=[Requested By]
startdate=[Start date]
executiondate=[Execution date]
authorization=[Authorization]

/ In EntityActionGroupPanel.html
				<label class="inline-block label-width va-top"><wicket:message key="authorization">Authorization</wicket:message></label>

/ 7	. 

/ als we in planning, shipment order, mass update een PENDING sho op OPEN willen , dan kunnen we 	,
/ zoek tab [mass update]
/ we zien een list met 1 sho	, de sho zelf	, die op STARTED staat	,  click op open/edit button	,
/ TODO (STARTED IPV PENDING)
/ we komen op 'Actie Pagina'	, waar we altijd komen	,
/ we kunnen bij Authorization de acties (TODO) reject/approve, in het modal window	dat dan opkomt	, dan zal de sho weer OPEN zijn	,

/ we kunnen ook in de shipment_order table	,
locked_by_process              | 1
action_approval_status         | PENDING
->
locked_by_process              | 0
action_approval_status         | OPEN

/ 7	.

$ vi  EntityActionGroupPanel..html
			<div id="AuthorizationPanel" class="inline-block va-top">

$ vi EntityActionGroupPanel.java

	protected void createPanel(Form<EntityActionGroup> form) {
/ dit panel	,


		final ModalWindow approveRejectPanel = new ModalWindow("lookupPanel");
132:	final AuthorizationCommentFragment authorizationFragment = new AuthorizationCommentFragment(approveRejectPanel.getContentId(), this, approveRejectPanel);
			...

/ 'Authorization' op de page, waar je op een PENDING actie (TODO) click	 uit de list, zodat het modal window verschijnt	,
		final MarkupContainer authorizationPanel = new MarkupContainer("authorizationPanel") {
		};
		final ModalWindow approveRejectPanel = new ModalWindow("lookupPanel");
		authorizationPanel.add(new ListView<EntityActionGroupAuthorization>("authorization", new PropertyModel<List<EntityActionGroupAuthorization>>( actionGroupModel, "authorizations")) {
			@Override
			protected void populateItem(final ListItem<EntityActionGroupAuthorization> item) {
				...

/ de language was nl_NL_pnlnl	, 
/ is nu weer nl	,

/ FIX PNL-313

$ vi EntityActionGroupPanel.java

		authorizationPanel.add(new ListView<EntityActionGroupAuthorization>("authorization", new PropertyModel<List<EntityActionGroupAuthorization>>( actionGroupModel, "authorizations")) {
			@Override
			protected void populateItem(final ListItem<EntityActionGroupAuthorization> item) {
					item.add(new AjaxEventBehavior("onclick") {
						@Override
						protected void onEvent(AjaxRequestTarget aTarget) {
->							approveRejectPanel.setTitle(new StringResourceModel("authorizationcomment.title", null));
	
/ JRebel pakt dit op	,

$ vi EntityActionGroupPanel.html

		<button wicket:id="approveButton" class="icon icon_ok" title="Save" type="submit"><wicket:message key="approve">Approve</wicket:message></button>
		<button wicket:id="rejectButton" class="icon icon_cancel" title="Reject" type="submit"><wicket:message key="reject">Reject</wicket:message></button>

/ Veranderingen in HTML worden meteen opgepakt,	 hoeven niet opnieuw te build	,

$ vi language_nl_NL_pnlnl

actions = [Actions]
status = [Status]
requestedby=[Requested By]
startdate=[Start date]
executiondate=[Execution date]
authorization=[Authorization]
authorizationcomment.title=[Authorize]
approve=[Approve]
reject=[Reject]

/ 7	. 


/ user edit scherm	,

/ 13	. 

/ prefix	,

$ vi  UserCrudEditPanel.java
	private static final String PREFIX = "resource.";

	public UserCrudEditPanel(IModel<Resource> aResource, boolean myEdit, String... aFieldList) {
		super(PREFIX, aResource, aFieldList);

$ vi AbstractGenericEditPanel.java
	public AbstractGenericEditPanel(String aPrefix, final IModel<T> aModel, String... aFieldList) {
		super("dynamicPanel");
		prefix = aPrefix;

/ resource. is de prefix voor user edit	, 
/ logisch	,

/ 13	.

/ properties	,

$ vi EditProfilePage.java
public class UserCrudEditPanel extends AbstractGenericEditPanel<Resource> {
			UserCrudEditPanel myEditPanel = new UserCrudEditPanel(new Model<Resource>(myUser), true);

$ vi UserCrudEditPanel.java
		userIdField = new RequiredTextField("code");
		userIdField.setEnabled(false);
		addComponent(userIdField);

$ vi AbstractGenericEditPanel.java
	protected final void addComponent(FormComponent aComponent) {
		aComponent.setOutputMarkupId(true);
		aComponent.add(new GenericFormComponentBehavior()).add(new AddHeaderBehavior(prefix));

$ vi AddHeaderBehavior.java
	public void beforeRender(Component aComponent) {
aComponent	RequiredTextField  (id=21098)	

		super.beforeRender(aComponent);
		StringResourceModel myResourceModel = new StringResourceModel(prefix + aComponent.getId(), aComponent, null, StringUtils.prettyPrintIdentifier(aComponent.getId()));
this	AddHeaderBehavior  (id=21091)	
	prefix	"resource." (id=22007)	
prefix + aComponent.getId()=="resource.code"
StringUtils.prettyPrintIdentifier(aComponent.getId())=="Code"

		String myText = myResourceModel.getObject();
myText	"User id" (id=22508)	
/ TODO
		String myCssClass = "";
		String myTitle = "";
		// Check the status of the component
		if (aComponent instanceof FormComponent) {
			if (((FormComponent<?>) aComponent).isRequired()) {
/ JA
				myCssClass += "required ";
				// TODO localization
				myTitle = "title=\"This field is required\"";
/ Deze zien we als we hover over de label	,
			}
			if (!((FormComponent<?>) aComponent).isValid()) {
				myCssClass += "error ";
			}
		}
		if (!aComponent.isEnabledInHierarchy()) {
			myCssClass += "disabled ";
		}
		myCssClass = StringUtils.isEmpty(myCssClass) ? "" : "class=\"" + myCssClass + "\"";
myCssClass	"class="required "" (id=22539)	
		String myHeader = "<tr><th align=\"left\" " + myTitle + " " + myCssClass + ">" + myText + "</th>\n<td>";
myHeader	"<tr><th align="left" title="This field is required" class="required ">User id</th>\n<td>" (id=22540)	

		aComponent.getResponse().write(myHeader);
	}

/ we kijken in UserCrudEditPanel.html (of .java)	, en we zien de id's 	, en we set er resource. voor	,

/ 13	. 
  
/ title	,

/ UserCrudEditPanel extends AbstractGenericEditPanel

$ vi AbstractGenericEditPanel.java

	public AbstractGenericEditPanel(String aPrefix, final IModel<T> aModel, String... aFieldList) {
		Label myTitleLable = new Label("formTitle", new Model(getTitle()));
		add(myTitleLable);

	protected String getTitle() {
		StringResourceModel myResourceModel = new StringResourceModel(prefix + "edit.title", this, null);
		return myResourceModel.getObject();
	}
/ OK

/ 13	.

/ buttons	,

$ vi UserCrudEditPanel.java

public class UserCrudEditPanel extends AbstractGenericEditPanel<Resource> {
	class UserActionPanel extends DefaultActionPanel {
		public UserActionPanel(GenericForm aForm) {
			super(aForm);
			AjaxFallbackButton myAddProperty = new AjaxFallbackButton("add", aForm) {
				...
			AjaxFallbackButton myDeleteProperty = new AjaxFallbackButton("delete", aForm) {
				...

$ vi AbstractGenericEditPanel.java
	public class DefaultActionPanel extends AbstractGenericActionPanel {
		public DefaultActionPanel(GenericForm aForm) {
			super("actionPanel", aForm);

$ vi AbstractGenericActionPanel.java
		saveButton = new AjaxFallbackButton("save", editForm) {
			...
		saveAndCloseButton = new AjaxFallbackButton("saveAndClose", editForm) {
			...
		cancelButton = new AjaxFallbackButton("cancel", editForm) {
			...

$ vi UserCrudEditPanel$UserActionPanel.html
	<wicket:child/>
	<button wicket:id="add" class="icon icon_add" wicket:message="title:addProperties"><span><wicket:message key="addProperties">add</wicket:message></span></button>
	<button wicket:id="delete" class="icon icon_delete" wicket:message="title:deleteProperties"><span><wicket:message key="deleteProperties">delete</wicket:message></span></button>

 
$ vi AbstractGenericEditPanel.html
<wicket:panel>
		<div wicket:id="actionPanel"></div>

$ vi AbstractGenericActionPanel.html
		<button wicket:id="save" class="icon icon_ok" wicket:message="title:save"><span><wicket:message key="save">save</wicket:message></span></button>
		<button wicket:id="saveAndClose" class="icon icon_ok" wicket:message="title:saveAndClose"><span><wicket:message key="saveAndClose">saveAndClose</wicket:message></span></button>
		<button wicket:id="cancel" class="icon icon_cancel" wicket:message="title:cancel"><span><wicket:message key="cancel">cancel</wicket:message></span></button>
		<wicket:child/>










/ Einde PNL-313

/ 7	.

/ FITNESSE

/ we rm b 	,
LanguageManagerStringResourceLoader.loadStringResource(Class<?>, String, Locale, String) line: 31	
LanguageManagerStringResourceLoader.loadStringResource(Component, String) line: 46	
LanguageManagerStringResourceLoader.loadStringResource(Component, String) line: 46	

/ 7	. 

/ How is spring init	?

StartupWebAppContextListener.contextInitialized(ServletContextEvent) line: 31	
		MpoBeanFactory.init(WebApplicationContextUtils.getWebApplicationContext(myServletContextEVent.getServletContext()));

/ myServletContextEVent.getServletContext()=org.apache.catalina.core.ApplicationContextFacade@69aaccdf
/ WebApplicationContextUtils.getWebApplicationContext(myServletContextEVent.getServletContext())=Root WebApplicationContext: startup date [Tue May 12 13:46:33 CEST 2015]; root of context hierarchy

/s
MpoBeanFactory.init(ApplicationContext) line: 125	
/=
	public static void init(ApplicationContext aContext) {
aContext.getClass()=org.springframework.web.context.XmlWebApplicationContext

		applicationContext = aContext;
		initialized.set(true);

Thread [main] (Suspended)	
	owns: StandardContext  (id=765)	
	owns: HashMap  (id=766)	
	owns: TomcatDeployer  (id=767)	
	owns: WebModule  (id=768)	
	owns: ServiceController  (id=769)	
	owns: Tomcat5  (id=770)	
	owns: URLDeploymentScanner  (id=771)	
	owns: AbstractDeploymentScanner$ScannerThread  (id=390)	
	MpoBeanFactory.init(ApplicationContext) line: 125	
	StartupWebAppContextListener.contextInitialized(ServletContextEvent) line: 31	
	StandardContext.listenerStart() line: 3763	
	StandardContext.start() line: 4211	
	StandardHost(ContainerBase).addChildInternal(Container) line: 759	
	StandardHost(ContainerBase).addChild(Container) line: 739	
	StandardHost.addChild(Container) line: 524	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	BaseModelMBean.invoke(String, Object[], String[]) line: 503	
	RawDynamicInvoker.invoke(String, Object[], String[]) line: 164	
	MBeanServerImpl.invoke(ObjectName, String, Object[], String[]) line: 659	
	StandardContext.init() line: 5052	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	BaseModelMBean.invoke(String, Object[], String[]) line: 503	
	RawDynamicInvoker.invoke(String, Object[], String[]) line: 164	
	MBeanServerImpl.invoke(ObjectName, String, Object[], String[]) line: 659	
	TomcatDeployer.performDeployInternal(String, WebApplication, String, AbstractWebContainer$WebDescriptorParser) line: 297	
	TomcatDeployer.performDeploy(WebApplication, String, AbstractWebContainer$WebDescriptorParser) line: 103	
	TomcatDeployer(AbstractWebDeployer).start(DeploymentInfo) line: 371	
	WebModule.startModule() line: 83	
	WebModule.startService() line: 61	
	WebModule(ServiceMBeanSupport).jbossInternalStart() line: 289	
	WebModule(ServiceMBeanSupport).jbossInternalLifecycle(String) line: 245	
	GeneratedMethodAccessor9.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	ReflectedDispatcher.invoke(Invocation) line: 155	
	Invocation.dispatch() line: 94	
	Invocation.invoke() line: 86	
	XMBean(AbstractMBeanInvoker).invoke(String, Object[], String[]) line: 264	
	MBeanServerImpl.invoke(ObjectName, String, Object[], String[]) line: 659	
	ServiceController$ServiceProxy.invoke(Object, Method, Object[]) line: 978	
	$Proxy0.start() line: not available	
	ServiceController.start(ObjectName) line: 417	
	GeneratedMethodAccessor15.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	ReflectedDispatcher.invoke(Invocation) line: 155	
	Invocation.dispatch() line: 94	
	Invocation.invoke() line: 86	
	XMBean(AbstractMBeanInvoker).invoke(String, Object[], String[]) line: 264	
	MBeanServerImpl.invoke(ObjectName, String, Object[], String[]) line: 659	
	MBeanProxyExt.invoke(Object, Method, Object[]) line: 210	
	$Proxy41.start(ObjectName) line: not available	
	Tomcat5(AbstractWebContainer).start(DeploymentInfo) line: 466	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	ReflectedDispatcher.invoke(Invocation) line: 155	
	Invocation.dispatch() line: 94	
	NullInterceptor(AbstractInterceptor).invoke(Invocation) line: 133	
	Invocation.invoke() line: 88	
	ModelMBeanOperationInterceptor.invoke(Invocation) line: 142	
	DynamicInterceptor.invoke(Invocation) line: 97	
	DeployerInterceptorJSE(InterceptorServiceMBeanSupport).invokeNext(Invocation) line: 238	
	DeployerInterceptorJSE(DeployerInterceptor).start(Invocation, DeploymentInfo) line: 92	
	SubDeployerInterceptorSupport$XMBeanInterceptor.start(Invocation, DeploymentInfo) line: 188	
	SubDeployerInterceptorSupport$XMBeanInterceptor(SubDeployerInterceptor).invoke(Invocation) line: 95	
	Invocation.invoke() line: 88	
	XMBean(AbstractMBeanInvoker).invoke(String, Object[], String[]) line: 264	
	MBeanServerImpl.invoke(ObjectName, String, Object[], String[]) line: 659	
	MBeanProxyExt.invoke(Object, Method, Object[]) line: 210	
	$Proxy42.start(DeploymentInfo) line: not available	
	MainDeployer.start(DeploymentInfo) line: 1025	
	MainDeployer.deploy(DeploymentInfo) line: 819	
	MainDeployer.deploy(URL) line: 782	
	GeneratedMethodAccessor55.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	ReflectedDispatcher.invoke(Invocation) line: 155	
	Invocation.dispatch() line: 94	
	NullInterceptor(AbstractInterceptor).invoke(Invocation) line: 133	
	Invocation.invoke() line: 88	
	ModelMBeanOperationInterceptor.invoke(Invocation) line: 142	
	Invocation.invoke() line: 88	
	XMBean(AbstractMBeanInvoker).invoke(String, Object[], String[]) line: 264	
	MBeanServerImpl.invoke(ObjectName, String, Object[], String[]) line: 659	
	MBeanProxyExt.invoke(Object, Method, Object[]) line: 210	
	$Proxy9.deploy(URL) line: not available	
	URLDeploymentScanner.deploy(URLDeploymentScanner$DeployedURL) line: 421	
	URLDeploymentScanner.scan() line: 634	
	AbstractDeploymentScanner$ScannerThread.doScan() line: 263	
	URLDeploymentScanner(AbstractDeploymentScanner).startService() line: 336	
	URLDeploymentScanner(ServiceMBeanSupport).jbossInternalStart() line: 289	
	URLDeploymentScanner(ServiceMBeanSupport).jbossInternalLifecycle(String) line: 245	
	GeneratedMethodAccessor9.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	ReflectedDispatcher.invoke(Invocation) line: 155	
	Invocation.dispatch() line: 94	
	Invocation.invoke() line: 86	
	XMBean(AbstractMBeanInvoker).invoke(String, Object[], String[]) line: 264	
	MBeanServerImpl.invoke(ObjectName, String, Object[], String[]) line: 659	
	ServiceController$ServiceProxy.invoke(Object, Method, Object[]) line: 978	
	$Proxy0.start() line: not available	
	ServiceController.start(ObjectName) line: 417	
	GeneratedMethodAccessor15.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	ReflectedDispatcher.invoke(Invocation) line: 155	
	Invocation.dispatch() line: 94	
	Invocation.invoke() line: 86	
	XMBean(AbstractMBeanInvoker).invoke(String, Object[], String[]) line: 264	
	MBeanServerImpl.invoke(ObjectName, String, Object[], String[]) line: 659	
	MBeanProxyExt.invoke(Object, Method, Object[]) line: 210	
	$Proxy4.start(ObjectName) line: not available	
	SARDeployer.start(DeploymentInfo) line: 302	
	MainDeployer.start(DeploymentInfo) line: 1025	
	MainDeployer.deploy(DeploymentInfo) line: 819	
	MainDeployer.deploy(URL) line: 782	
	MainDeployer.deploy(String) line: 766	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	ReflectedDispatcher.invoke(Invocation) line: 155	
	Invocation.dispatch() line: 94	
	NullInterceptor(AbstractInterceptor).invoke(Invocation) line: 133	
	Invocation.invoke() line: 88	
	ModelMBeanOperationInterceptor.invoke(Invocation) line: 142	
	Invocation.invoke() line: 88	
	XMBean(AbstractMBeanInvoker).invoke(String, Object[], String[]) line: 264	
	MBeanServerImpl.invoke(ObjectName, String, Object[], String[]) line: 659	
	MBeanProxyExt.invoke(Object, Method, Object[]) line: 210	
	$Proxy5.deploy(String) line: not available	
	ServerImpl.doStart() line: 482	
	ServerImpl.start() line: 362	
	Main.boot(String[]) line: 200	
	Main$1.run() line: 490	
	Thread.run() line: 745	


/ Einde FITNESSE

/ PNL-570

/ osscherm: ArrivalItemEntryListPage

/ planning, shipment order, losscherm 
/ we komen op 'Arrival Item Entities'	,
/ geef in Search: Start Laden	, 
/ de search balk verandert wat: we zien dat ertussen is set: 'Start Laden: all

ArrivalItemEntryListPage.java/.html			
/ hierin hadden we de arrivalitementitylistpage.title set	,
FilterBarPanel.java/.html
DateTimeFilterFieldFieldPanel.java/.html
/ date.from , date.to 

/ Einde PNL-570

/ PNL-579

select * 
from SHIPMENT_ORDER shipmentor0_ 
left outer join HOLD_STATUS holdstatus1_ on shipmentor0_.HOLD_STATUS_SYSTEMID=holdstatus1_.SYSTEM_ID 
left outer join CUSTOMER_STATUS customerst2_ on shipmentor0_.CUSTOMER_STATUS_SYSTEMID=customerst2_.SYSTEM_ID 
left outer join SHIPMENT_ORDER_DETAIL entitydeta3_ on shipmentor0_.SYSTEM_ID=entitydeta3_.ENTITY_SYSTEMID 
,COUNTRY country9_ 
,SHIPMENT_ORDER_TYPE shipmentty10_
,SHIPMENT_SERVICE_LEVEL shipmentse11_ 
cross join ENTITY_DETAIL_TYPE entitydeta4_ 
cross join OMS_USER_PARTY userparty5_ 
cross join SERVICE_ORDER serviceord6_ 
inner join CONSIGNMENT consignmen7_ on serviceord6_.SYSTEM_ID=consignmen7_.SERVICE_ORDER_SYSTEMID 
inner join SERVICE_ACTION serviceact8_ on consignmen7_.SYSTEM_ID=serviceact8_.CONSIGNMENT_SYSTEMID 
,PARTY partyvo12_ 
cross join PARTY partyvo13_ 
where shipmentor0_.organization_Systemid in (
	select uo.organization_systemid 
	from user_organization uo 
	where uo.user_systemid = 26708181) 
and shipmentor0_.FROM_COUNTRY_SYSTEMID=country9_.SYSTEM_ID 
and shipmentor0_.SHIPM_TYPE_SYSTEMID=shipmentty10_.SYSTEM_ID 
and shipmentor0_.ACT_SERVICE_LEVEL_SYSTEMID=shipmentse11_.SYSTEM_ID 
and serviceord6_.EXECUTED_BY_PARTY_SYSTEMID=partyvo12_.SYSTEM_ID 
and userparty5_.PARTY_SYSTEMID=partyvo13_.SYSTEM_ID 
and shipmentor0_.IS_TEMPLATE=0 and holdstatus1_.HOLD_STATUS_CODE='VALID' 
and (customerst2_.NAME like '%VDO%') 
and shipmentor0_.TO_LOCATION_ID=partyvo13_.PARTY_ID 
and userparty5_.USER_SYSTEMID=26708181 
and entitydeta3_.EDT_SYSTEMID=entitydeta4_.SYSTEM_ID 
and entitydeta4_.NAME='CmrRequired' 
and serviceact8_.SHIPMENT_ORDER_SYSTEMID=shipmentor0_.SYSTEM_ID 
and shipmentor0_.REQUESTED_DEPARTURE_AFTER>='2015-05-11' 
and shipmentor0_.REQUESTED_DEPARTURE_AFTER<='2015-05-14' 
order by serviceord6_.ESTIMATED_END_BEFORE, shipmentor0_.REQUESTED_ARRIVAL_AFTER limit 15 

/ 7	. 

/ tables	,

shipment_order

pnloms7=# select*from hold_status;
 system_id |  hold_status_code   |             hold_status_description             | hold_status_color | is_deleted 
-----------+---------------------+-------------------------------------------------+-------------------+------------
      3081 | REVIEW_HOLD         | REVIEW_HOLD                                     |                   |          0
  26673344 | CREDIT_HOLD         | CREDIT_HOLD                                     |                   |          0
  26673765 | VALID               | VALID                                           | #FFFFFF           |          0
  26680617 | OVERLOAD_HOLD       | Load exceeds maximum                            |                   |          0
  26753435 | ORDERSOORT_ONGELDIG | Ordersoort not in use                           |                   |          0
  26673684 | ORDERSOORT_HOLD     | Ordersoort- location type combination not valid |                   |          0
  26680012 | RIJTIJD_HOLD        | Rijtijd does not fit in the timewiindows        |                   |          0
  26680616 | TRAILER_HOLD        | Weight requires trailer access to location      |                   |          0
  26853401 | RITNUMMER_HOLD      | Ritnummer Hold, Ritnummer is niet ingevuld      |                   |          0
(9 rows)

pnloms7=# select*from customer_status;
-[ RECORD 1 ]-------------+---------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------
system_id                 | 700
name                      | Delivered
expression                | ${shipmentOrder.orderStatusVO.code == 9000}
hierarchy                 | 7
next_step_sat_systemid    | 0
next_step_status_systemid | 0
visible                   | 0
days_back_used            | 1
next_step_name            | 
poll_status               | 0
process_type              | OUTBOUND
assignable                | 0
entity                    | SHIPMENT_ORDER
...

pnloms7=# select*from SHIPMENT_ORDER_DETAIL;
 entity_systemid | edt_systemid |               field_value                
-----------------+--------------+------------------------------------------
        26673492 |     26673491 | 2 uur
        26673794 |     26673491 | 
/ TODO

pnloms7=# select*from SHIPMENT_ORDER_TYPE;
 system_id | is_deleted | organization_id | shipment_order_type |              description               
-----------+------------+-----------------+---------------------+----------------------------------------
  26673733 |          0 |            1000 | 601                 | Auto met chauffeur
  26673734 |          0 |            1000 | 600                 | Autobestelling
  26673736 |          0 |            1000 | 580                 | Postbusfront breng
...

pnloms7=# select*from SHIPMENT_SERVICE_LEVEL;
 system_id | is_deleted | service_level | description | hierarchy_level | schedule_systemid 
-----------+------------+---------------+-------------+-----------------+-------------------
  26673465 |          0 | NORMAL        | Normal      |               0 |          26691981
  26673463 |          0 | SPEEDY        | Spoed       |               0 |          26691981
  26673464 |          0 | INCIDENTAL    | Incidenteel |               0 |          26691981
(3 rows)

/ 7	. 

$ vi pnloms-build-config.properties
module.devtools.component=module

/ 7	. 

[eric@localhost scripts]$ pwd
/home/eric/Devel/Postgres/scripts

/ De orig query 	,

$ vi pnl-579.sh

time PGPASSWORD=mpopostgres@mpo psql -U mpopostgres pnloms7 <<MY_SQL
select *
from SHIPMENT_ORDER shipmentor0_
left outer join HOLD_STATUS holdstatus1_ on shipmentor0_.HOLD_STATUS_SYSTEMID=holdstatus1_.SYSTEM_ID
left outer join CUSTOMER_STATUS customerst2_ on shipmentor0_.CUSTOMER_STATUS_SYSTEMID=customerst2_.SYSTEM_ID
left outer join SHIPMENT_ORDER_DETAIL entitydeta3_ on shipmentor0_.SYSTEM_ID=entitydeta3_.ENTITY_SYSTEMID
,COUNTRY country9_
,SHIPMENT_ORDER_TYPE shipmentty10_
,SHIPMENT_SERVICE_LEVEL shipmentse11_
cross join ENTITY_DETAIL_TYPE entitydeta4_
cross join OMS_USER_PARTY userparty5_
cross join SERVICE_ORDER serviceord6_
inner join CONSIGNMENT consignmen7_ on serviceord6_.SYSTEM_ID=consignmen7_.SERVICE_ORDER_SYSTEMID
inner join SERVICE_ACTION serviceact8_ on consignmen7_.SYSTEM_ID=serviceact8_.CONSIGNMENT_SYSTEMID
,PARTY partyvo12_
cross join PARTY partyvo13_
where shipmentor0_.organization_Systemid in (
    select uo.organization_systemid
    from user_organization uo
    where uo.user_systemid = 26708181)
and shipmentor0_.FROM_COUNTRY_SYSTEMID=country9_.SYSTEM_ID
and shipmentor0_.SHIPM_TYPE_SYSTEMID=shipmentty10_.SYSTEM_ID
and shipmentor0_.ACT_SERVICE_LEVEL_SYSTEMID=shipmentse11_.SYSTEM_ID
and serviceord6_.EXECUTED_BY_PARTY_SYSTEMID=partyvo12_.SYSTEM_ID
and userparty5_.PARTY_SYSTEMID=partyvo13_.SYSTEM_ID
and shipmentor0_.IS_TEMPLATE=0 and holdstatus1_.HOLD_STATUS_CODE='VALID'
and (customerst2_.NAME like '%VDO%')
and shipmentor0_.TO_LOCATION_ID=partyvo13_.PARTY_ID
and userparty5_.USER_SYSTEMID=26708181
and entitydeta3_.EDT_SYSTEMID=entitydeta4_.SYSTEM_ID
and entitydeta4_.NAME='CmrRequired'
and serviceact8_.SHIPMENT_ORDER_SYSTEMID=shipmentor0_.SYSTEM_ID
and shipmentor0_.REQUESTED_DEPARTURE_AFTER>='2015-05-11'
and shipmentor0_.REQUESTED_DEPARTURE_AFTER<='2015-05-14'
order by serviceord6_.ESTIMATED_END_BEFORE, shipmentor0_.REQUESTED_ARRIVAL_AFTER limit 15
MY_SQL

/ Deze query duurt 1 min	, en de cpu staat op 100%	, 

/ Als we	,
,PARTY partyvo12_
cross join PARTY partyvo13_
/ verwisselen	,
$ vi pnl-579_2.sh
cross join PARTY partyvo13_
,PARTY partyvo12_
/ , dan in real	0m0.410s

/ Als we 	,
,PARTY partyvo12_
/ veranderen in 	,
cross join PARTY partyvo12_
$ vi pnl-597_2a.sh
cross join PARTY partyvo12_
cross join PARTY partyvo13_
/ dan 0m0.410s	, 

/ 7	.

/ we maken de query zo klein mogelijk	,

/ 13	. 

$ vi pnl579_2b.sh

time PGPASSWORD=mpopostgres@mpo psql -U mpopostgres pnloms7 <<MY_SQL

select count(*)
from SHIPMENT_ORDER shipmentor0_

cross join OMS_USER_PARTY userparty5_
cross join SERVICE_ORDER serviceord6_

cross join PARTY partyvo13_
,PARTY partyvo12_

where 
serviceord6_.EXECUTED_BY_PARTY_SYSTEMID=partyvo12_.SYSTEM_ID
and userparty5_.PARTY_SYSTEMID=partyvo13_.SYSTEM_ID

and userparty5_.USER_SYSTEMID=26708181
MY_SQL

/ we zien	,
[eric@localhost scripts]$ ./pnl-579_2b.sh 
   count   
-----------
 317084544
(1 row)
real	0m17.246s
/ dus 300.000.000

/ als we select * ipv select count(*)	, dan te lang	, ^c gedaan	,

/ we zien een join van 3 groepen	,

seo				party2				party3		oms_user_type		sho
|				^					^				|
| 				|					|				|
----------------					----------------
executed_by_	system_id						party_systemid	
party_systemid

/ 13	. 

/ als we de sho rm, dan snel	,


time PGPASSWORD=mpopostgres@mpo psql -U mpopostgres pnloms7 <<MY_SQL
select *

from OMS_USER_PARTY userparty5_
cross join SERVICE_ORDER serviceord6_

cross join PARTY partyvo13_
,PARTY partyvo12_

where 
serviceord6_.EXECUTED_BY_PARTY_SYSTEMID=partyvo12_.SYSTEM_ID
and userparty5_.PARTY_SYSTEMID=partyvo13_.SYSTEM_ID

and userparty5_.USER_SYSTEMID=26708181
MY_SQL

/ 7	.

/ we connect sho	, maar nog veel rows	,

$ vi pnl-579_2b.sh

time PGPASSWORD=mpopostgres@mpo psql -U mpopostgres pnloms7 <<MY_SQL
select count(*)
from SHIPMENT_ORDER shipmentor0_

cross join OMS_USER_PARTY userparty5_
cross join SERVICE_ORDER serviceord6_

cross join PARTY partyvo13_
,PARTY partyvo12_

where 
serviceord6_.EXECUTED_BY_PARTY_SYSTEMID=partyvo12_.SYSTEM_ID
and userparty5_.PARTY_SYSTEMID=partyvo13_.SYSTEM_ID
and shipmentor0_.TO_LOCATION_ID=partyvo13_.PARTY_ID


and userparty5_.USER_SYSTEMID=26708181
MY_SQL

[eric@localhost scripts]$ ./pnl-579_2b.sh 
  count   
----------
 14976932
(1 row)
real	0m2.793s

/ De laptop kan dit niet aan	, 

/ 7	. 

/ De hele query	,
/ met verwisseld tot	,
cross join PARTY partyvo13_
,PARTY partyvo12_

$ vi pnl-579.sh

time PGPASSWORD=mpopostgres@mpo psql -U mpopostgres pnloms7 <<MY_SQL
explain select * 
from SHIPMENT_ORDER shipmentor0_
left outer join HOLD_STATUS holdstatus1_ on shipmentor0_.HOLD_STATUS_SYSTEMID=holdstatus1_.SYSTEM_ID
left outer join CUSTOMER_STATUS customerst2_ on shipmentor0_.CUSTOMER_STATUS_SYSTEMID=customerst2_.SYSTEM_ID
left outer join SHIPMENT_ORDER_DETAIL entitydeta3_ on shipmentor0_.SYSTEM_ID=entitydeta3_.ENTITY_SYSTEMID
,COUNTRY country9_
,SHIPMENT_ORDER_TYPE shipmentty10_
,SHIPMENT_SERVICE_LEVEL shipmentse11_
cross join ENTITY_DETAIL_TYPE entitydeta4_
cross join OMS_USER_PARTY userparty5_
cross join SERVICE_ORDER serviceord6_
inner join CONSIGNMENT consignmen7_ on serviceord6_.SYSTEM_ID=consignmen7_.SERVICE_ORDER_SYSTEMID
inner join SERVICE_ACTION serviceact8_ on consignmen7_.SYSTEM_ID=serviceact8_.CONSIGNMENT_SYSTEMID
cross join PARTY partyvo13_
,PARTY partyvo12_
where shipmentor0_.organization_Systemid in (
    select uo.organization_systemid
    from user_organization uo
    where uo.user_systemid = 26708181)
and shipmentor0_.FROM_COUNTRY_SYSTEMID=country9_.SYSTEM_ID
and shipmentor0_.SHIPM_TYPE_SYSTEMID=shipmentty10_.SYSTEM_ID
and shipmentor0_.ACT_SERVICE_LEVEL_SYSTEMID=shipmentse11_.SYSTEM_ID
and serviceord6_.EXECUTED_BY_PARTY_SYSTEMID=partyvo12_.SYSTEM_ID
and userparty5_.PARTY_SYSTEMID=partyvo13_.SYSTEM_ID
and shipmentor0_.IS_TEMPLATE=0 and holdstatus1_.HOLD_STATUS_CODE='VALID'
and (customerst2_.NAME like '%VDO%')
and shipmentor0_.TO_LOCATION_ID=partyvo13_.PARTY_ID
and userparty5_.USER_SYSTEMID=26708181
and entitydeta3_.EDT_SYSTEMID=entitydeta4_.SYSTEM_ID
and entitydeta4_.NAME='CmrRequired'
and serviceact8_.SHIPMENT_ORDER_SYSTEMID=shipmentor0_.SYSTEM_ID
and shipmentor0_.REQUESTED_DEPARTURE_AFTER>='2015-05-11'
and shipmentor0_.REQUESTED_DEPARTURE_AFTER<='2015-05-14'
MY_SQL

/ doet het heel snel	, maar explain zegt van niet	,

Nested Loop Semi Join  (cost=7858.94..10773.40 rows=1 width=9819)
   Join Filter: (shipmentor0_.organization_systemid = uo.organization_systemid)
   ->  Nested Loop  (cost=7858.94..10768.58 rows=1 width=9819)
         ->  Nested Loop  (cost=7858.66..10768.18 rows=1 width=9608)
               Join Filter: (shipmentor0_.system_id = entitydeta3_.entity_systemid)
               ->  Nested Loop  (cost=7858.24..10766.75 rows=1 width=9596)
                     Join Filter: (shipmentor0_.customer_status_systemid = customerst2_.system_id)
                     ->  Nested Loop  (cost=7858.24..10765.55 rows=1 width=9268)
                           Join Filter: (shipmentor0_.hold_status_systemid = holdstatus1_.system_id)
                           ->  Hash Join  (cost=7858.24..10764.42 rows=1 width=8954)
                                 Hash Cond: ((serviceact8_.shipment_order_systemid = shipmentor0_.system_id) AND (shipmentse11_.system_id = shipmentor0_.act_service_level_systemid) AND ((partyvo13_.party_id)::text = (shipmentor0_.to_location_id)::text))
                                 ->  Nested Loop  (cost=7842.27..10447.33 rows=26766 width=5432)
                                       ->  Nested Loop  (cost=7842.27..10111.72 rows=8922 width=5242)
                                             ->  Index Scan using lo_detail_type_pk on entity_detail_type entitydeta4_  (cost=0.14..12.64 rows=1 width=2080)
                                                   Filter: ((name)::text = 'CmrRequired'::text)
                                             ->  Merge Join  (cost=7842.13..10009.85 rows=8922 width=3162)
                                                   Merge Cond: (userparty5_.party_systemid = partyvo13_.system_id)
                                                   ->  Nested Loop  (cost=7836.74..9340.83 rows=8922 width=2951)
                                                         ->  Index Only Scan using user_party_pk on oms_user_party userparty5_  (cost=0.14..8.16 rows=1 width=8)
                                                               Index Cond: (user_systemid = 26708181)
                                                         ->  Merge Join  (cost=7836.60..9243.45 rows=8922 width=2943)
                                                               Merge Cond: (serviceord6_.system_id = consignmen7_.service_order_systemid)
                                                               ->  Index Scan using service_order_pk on service_order serviceord6_  (cost=0.29..1240.53 rows=8893 width=2015)
                                                               ->  Materialize  (cost=7836.31..7881.79 rows=9096 width=928)
                                                                     ->  Sort  (cost=7836.31..7859.05 rows=9096 width=928)
                                                                           Sort Key: consignmen7_.service_order_systemid
                                                                           ->  Hash Join  (cost=1279.99..3535.20 rows=9096 width=928)
                                                                                 Hash Cond: (serviceact8_.consignment_systemid = consignmen7_.system_id)
                                                                                 ->  Seq Scan on service_action serviceact8_  (cost=0.00..560.55 rows=9255 width=385)
                                                                                 ->  Hash  (cost=537.66..537.66 rows=9066 width=543)
                                                                                       ->  Seq Scan on consignment consignmen7_  (cost=0.00..537.66 rows=9066 width=543)
                                                   ->  Index Scan using party_pk on party partyvo13_  (cost=0.29..517.63 rows=8565 width=211)
                                       ->  Materialize  (cost=0.00..1.04 rows=3 width=190)
                                             ->  Seq Scan on shipment_service_level shipmentse11_  (cost=0.00..1.03 rows=3 width=190)
                                 ->  Hash  (cost=15.95..15.95 rows=1 width=3522)
                                       ->  Hash Join  (cost=10.44..15.95 rows=1 width=3522)
                                             Hash Cond: (country9_.system_id = shipmentor0_.from_country_systemid)
                                             ->  Seq Scan on country country9_  (cost=0.00..4.54 rows=254 width=207)
                                             ->  Hash  (cost=10.43..10.43 rows=1 width=3315)
                                                   ->  Hash Join  (cost=8.32..10.43 rows=1 width=3315)
                                                         Hash Cond: (shipmentty10_.system_id = shipmentor0_.shipm_type_systemid)
                                                         ->  Seq Scan on shipment_order_type shipmentty10_  (cost=0.00..1.80 rows=80 width=34)
                                                         ->  Hash  (cost=8.31..8.31 rows=1 width=3281)
                                                               ->  Index Scan using sho_req_departure_after on shipment_order shipmentor0_  (cost=0.29..8.31 rows=1 width=3281)
                                                                     Index Cond: ((requested_departure_after >= '2015-05-11 00:00:00'::timestamp without time zone) AND (requested_departure_after <= '2015-05-14 00:00:00'::timestamp without time zone))
                                                                     Filter: (is_template = 0)
                           ->  Seq Scan on hold_status holdstatus1_  (cost=0.00..1.11 rows=1 width=314)
                                 Filter: ((hold_status_code)::text = 'VALID'::text)
                     ->  Seq Scan on customer_status customerst2_  (cost=0.00..1.19 rows=1 width=328)
                           Filter: ((name)::text ~~ '%VDO%'::text)
               ->  Index Scan using pk_shipment_order_detail on shipment_order_detail entitydeta3_  (cost=0.42..1.42 rows=1 width=12)
                     Index Cond: ((entity_systemid = serviceact8_.shipment_order_systemid) AND (edt_systemid = entitydeta4_.system_id))
         ->  Index Scan using party_pk on party partyvo12_  (cost=0.29..0.38 rows=1 width=211)
               Index Cond: (system_id = serviceord6_.executed_by_party_systemid)
   ->  Seq Scan on user_organization uo  (cost=0.00..4.79 rows=4 width=4)
         Filter: (user_systemid = 26708181)
(56 rows)

/  TODO


/ 7	. 

/ 13	. 

/ we voegen data reductie toe	,

$ vi pnl-579_2b.sh

time PGPASSWORD=mpopostgres@mpo psql -U mpopostgres pnloms7 <<MY_SQL
select * 
from SHIPMENT_ORDER shipmentor0_

cross join OMS_USER_PARTY userparty5_
cross join SERVICE_ORDER serviceord6_

cross join PARTY partyvo13_
,PARTY partyvo12_

where 
serviceord6_.EXECUTED_BY_PARTY_SYSTEMID=partyvo12_.SYSTEM_ID
and userparty5_.PARTY_SYSTEMID=partyvo13_.SYSTEM_ID
and shipmentor0_.TO_LOCATION_ID=partyvo13_.PARTY_ID


and userparty5_.USER_SYSTEMID=26708181
and shipmentor0_.REQUESTED_DEPARTURE_AFTER>='2015-05-11'
and shipmentor0_.REQUESTED_DEPARTURE_AFTER<='2015-05-14'

MY_SQL

/ Met count(*) zien we	,
[eric@localhost scripts]$ ./pnl-579_2b.sh 
 count  
--------
 174880
(1 row)

real	0m0.095s
user	0m0.001s
sys	0m0.003s


/ we kunnen select *	, en de output ctrl^c	,
...
cross join PARTY partyvo13_
,PARTY partyvo12_
...

/ we zien 	,
real	0m17.615s
user	0m8.987s
sys	0m1.565s

/ 13	. 

/ we doen explain	,

time PGPASSWORD=mpopostgres@mpo psql -U mpopostgres pnloms7 <<MY_SQL
explain select * 
from SHIPMENT_ORDER shipmentor0_

cross join OMS_USER_PARTY userparty5_
cross join SERVICE_ORDER serviceord6_

cross join PARTY partyvo13_
,PARTY partyvo12_

where 
serviceord6_.EXECUTED_BY_PARTY_SYSTEMID=partyvo12_.SYSTEM_ID
and userparty5_.PARTY_SYSTEMID=partyvo13_.SYSTEM_ID
and shipmentor0_.TO_LOCATION_ID=partyvo13_.PARTY_ID


and userparty5_.USER_SYSTEMID=26708181
and shipmentor0_.REQUESTED_DEPARTURE_AFTER>='2015-05-11'
and shipmentor0_.REQUESTED_DEPARTURE_AFTER<='2015-05-14'

MY_SQL

/ we zien	,

 Nested Loop  (cost=1.00..4493.96 rows=8879 width=5726)
   ->  Nested Loop  (cost=0.72..1020.66 rows=8893 width=5515)
         ->  Nested Loop  (cost=0.72..16.80 rows=1 width=3500)
               ->  Nested Loop  (cost=0.57..16.62 rows=1 width=3492)
                     ->  Index Scan using sho_req_departure_after on shipment_order shipmentor0_  (cost=0.29..8.31 rows=1 width=3281)
                           Index Cond: ((requested_departure_after >= '2015-05-11 00:00:00'::timestamp without time zone) AND (requested_departure_after <= '2015-05-14 00:00:00'::timestamp without time zone))
                     ->  Index Scan using party_uk on party partyvo13_  (cost=0.29..8.30 rows=1 width=211)
                           Index Cond: ((party_id)::text = (shipmentor0_.to_location_id)::text)
               ->  Index Only Scan using user_party_pk on oms_user_party userparty5_  (cost=0.14..0.17 rows=1 width=8)
                     Index Cond: ((user_systemid = 26708181) AND (party_systemid = partyvo13_.system_id))
         ->  Seq Scan on service_order serviceord6_  (cost=0.00..914.93 rows=8893 width=2015)
   ->  Index Scan using party_pk on party partyvo12_  (cost=0.29..0.38 rows=1 width=211)
         Index Cond: (system_id = serviceord6_.executed_by_party_systemid)

pnloms7=# \o /tmp/sho.txt
pnloms7=# \d+ shipment_order
pnloms7=# \o
$ vi /tmp/sho.txt
Indexes:
    "sho_req_departure_after" btree (requested_departure_after)

$ vi /tmp/party.txt
Indexes:
   "party_pk" PRIMARY KEY, btree (system_id)
    "party_uk" UNIQUE, btree (party_id, organization_systemid)

$ vi /tmp/oms_user_party.txt
Indexes:
    "user_party_pk" PRIMARY KEY, btree (user_systemid, party_systemid)

/ 7	. 

time PGPASSWORD=mpopostgres@mpo psql -U mpopostgres pnloms7 <<MY_SQL
explain select *
from SHIPMENT_ORDER shipmentor0_
left outer join HOLD_STATUS holdstatus1_ on shipmentor0_.HOLD_STATUS_SYSTEMID=holdstatus1_.SYSTEM_ID
,COUNTRY country9_						/ *
,SHIPMENT_ORDER_TYPE shipmentty10_
,SHIPMENT_SERVICE_LEVEL shipmentse11_
cross join OMS_USER_PARTY userparty5_
cross join SERVICE_ORDER serviceord6_
,PARTY partyvo12_
cross join PARTY partyvo13_

where 
shipmentor0_.FROM_COUNTRY_SYSTEMID=country9_.SYSTEM_ID				/ *
and shipmentor0_.SHIPM_TYPE_SYSTEMID=shipmentty10_.SYSTEM_ID
and shipmentor0_.ACT_SERVICE_LEVEL_SYSTEMID=shipmentse11_.SYSTEM_ID
and serviceord6_.EXECUTED_BY_PARTY_SYSTEMID=partyvo12_.SYSTEM_ID
and userparty5_.PARTY_SYSTEMID=partyvo13_.SYSTEM_ID
and shipmentor0_.IS_TEMPLATE=0 and holdstatus1_.HOLD_STATUS_CODE='VALID'
and shipmentor0_.TO_LOCATION_ID=partyvo13_.PARTY_ID
and userparty5_.USER_SYSTEMID=26708181
and shipmentor0_.REQUESTED_DEPARTURE_AFTER>='2015-05-11'
and shipmentor0_.REQUESTED_DEPARTURE_AFTER<='2015-05-14'
MY_SQL

/ we hebben net 2 regels bij * enter	, 
/ select count(*) komt helemaal niet mer een antwoord	,

/ we kijken naar explain zonder de 2 * lines	 (country)	,

 Nested Loop  (cost=9.04..4498.27 rows=8879 width=6264)
   ->  Nested Loop  (cost=8.75..1024.98 rows=8893 width=6053)
         ->  Nested Loop  (cost=8.75..21.12 rows=1 width=4038)
               ->  Nested Loop  (cost=8.61..20.94 rows=1 width=4030)
                     ->  Nested Loop  (cost=8.32..12.62 rows=1 width=3819)
                           Join Filter: (shipmentor0_.act_service_level_systemid = shipmentse11_.system_id)
                           ->  Nested Loop  (cost=8.32..11.56 rows=1 width=3629)
                                 Join Filter: (shipmentor0_.hold_status_systemid = holdstatus1_.system_id)
                                 ->  Hash Join  (cost=8.32..10.43 rows=1 width=3315)
                                       Hash Cond: (shipmentty10_.system_id = shipmentor0_.shipm_type_systemid)
                                       ->  Seq Scan on shipment_order_type shipmentty10_  (cost=0.00..1.80 rows=80 width=34)
                                       ->  Hash  (cost=8.31..8.31 rows=1 width=3281)
                                             ->  Index Scan using sho_req_departure_after on shipment_order shipmentor0_  (cost=0.29..8.31 rows=1 width=3281)
                                                   Index Cond: ((requested_departure_after >= '2015-05-11 00:00:00'::timestamp without time zone) AND (requested_departure_after <= '2015-05-14 00:00:00'::timestamp without time zone))
                                                   Filter: (is_template = 0)
                                 ->  Seq Scan on hold_status holdstatus1_  (cost=0.00..1.11 rows=1 width=314)
                                       Filter: ((hold_status_code)::text = 'VALID'::text)
                           ->  Seq Scan on shipment_service_level shipmentse11_  (cost=0.00..1.03 rows=3 width=190)
                     ->  Index Scan using party_uk on party partyvo13_  (cost=0.29..8.30 rows=1 width=211)
                           Index Cond: ((party_id)::text = (shipmentor0_.to_location_id)::text)
               ->  Index Only Scan using user_party_pk on oms_user_party userparty5_  (cost=0.14..0.17 rows=1 width=8)
                     Index Cond: ((user_systemid = 26708181) AND (party_systemid = partyvo13_.system_id))
         ->  Seq Scan on service_order serviceord6_  (cost=0.00..914.93 rows=8893 width=2015)
   ->  Index Scan using party_pk on party partyvo12_  (cost=0.29..0.38 rows=1 width=211)
         Index Cond: (system_id = serviceord6_.executed_by_party_systemid)
(25 rows)

/ Met de 2 * lines	 (met country)	,

 Nested Loop  (cost=8.60..2863980.49 rows=1 width=6471)
   Join Filter: (partyvo12_.system_id = serviceord6_.executed_by_party_systemid)
   ->  Nested Loop  (cost=8.60..2862954.40 rows=1 width=4456)
         Join Filter: (shipmentor0_.act_service_level_systemid = shipmentse11_.system_id)
         ->  Nested Loop  (cost=8.60..2862953.33 rows=1 width=4266)
               Join Filter: (shipmentor0_.shipm_type_systemid = shipmentty10_.system_id)
               ->  Nested Loop  (cost=8.60..2862950.53 rows=1 width=4232)
                     Join Filter: (shipmentor0_.from_country_systemid = country9_.system_id)
                     ->  Nested Loop  (cost=8.60..2862942.82 rows=1 width=4025)
                           Join Filter: (shipmentor0_.hold_status_systemid = holdstatus1_.system_id)
                           ->  Nested Loop  (cost=8.60..2862941.69 rows=1 width=3711)
                                 Join Filter: (partyvo13_.system_id = userparty5_.party_systemid)
                                 ->  Seq Scan on oms_user_party userparty5_  (cost=0.00..2.98 rows=1 width=8)
                                       Filter: (user_systemid = 26708181)
                                 ->  Merge Join  (cost=8.60..2862831.64 rows=8566 width=3703)
                                       Merge Cond: ((partyvo13_.party_id)::text = (shipmentor0_.to_location_id)::text)
                                       ->  Nested Loop  (cost=0.29..2684175.68 rows=73359225 width=422)
                                             ->  Index Scan using idx_party1 on party partyvo13_  (cost=0.29..761.18 rows=8565 width=211)
                                             ->  Seq Scan on party partyvo12_  (cost=0.00..227.65 rows=8565 width=211)
                                       ->  Materialize  (cost=8.32..8.33 rows=1 width=3281)
                                             ->  Sort  (cost=8.32..8.32 rows=1 width=3281)
                                                   Sort Key: shipmentor0_.to_location_id
                                                   ->  Index Scan using sho_req_departure_after on shipment_order shipmentor0_  (cost=0.29..8.31 rows=1 width=3281)
                                                         Index Cond: ((requested_departure_after >= '2015-05-11 00:00:00'::timestamp without time zone) AND (requested_departure_after <= '2015-05-14 00:00:00'::timestamp without time zone))
                                                         Filter: (is_template = 0)
                           ->  Seq Scan on hold_status holdstatus1_  (cost=0.00..1.11 rows=1 width=314)
                                 Filter: ((hold_status_code)::text = 'VALID'::text)
                     ->  Seq Scan on country country9_  (cost=0.00..4.54 rows=254 width=207)
               ->  Seq Scan on shipment_order_type shipmentty10_  (cost=0.00..1.80 rows=80 width=34)
         ->  Seq Scan on shipment_service_level shipmentse11_  (cost=0.00..1.03 rows=3 width=190)
   ->  Seq Scan on service_order serviceord6_  (cost=0.00..914.93 rows=8893 width=2015)
(31 rows)

/ Maar 	de count(*) gaat helemaal mis	,

time PGPASSWORD=mpopostgres@mpo psql -U mpopostgres pnloms7 <<MY_SQL
explain select count(*)
from SHIPMENT_ORDER shipmentor0_
left outer join HOLD_STATUS holdstatus1_ on shipmentor0_.HOLD_STATUS_SYSTEMID=holdstatus1_.SYSTEM_ID
,COUNTRY country9_
,SHIPMENT_ORDER_TYPE shipmentty10_
,SHIPMENT_SERVICE_LEVEL shipmentse11_
cross join OMS_USER_PARTY userparty5_
cross join SERVICE_ORDER serviceord6_
,PARTY partyvo12_
cross join PARTY partyvo13_

where 
shipmentor0_.FROM_COUNTRY_SYSTEMID=country9_.SYSTEM_ID
and shipmentor0_.SHIPM_TYPE_SYSTEMID=shipmentty10_.SYSTEM_ID
and shipmentor0_.ACT_SERVICE_LEVEL_SYSTEMID=shipmentse11_.SYSTEM_ID
and serviceord6_.EXECUTED_BY_PARTY_SYSTEMID=partyvo12_.SYSTEM_ID
and userparty5_.PARTY_SYSTEMID=partyvo13_.SYSTEM_ID
and shipmentor0_.IS_TEMPLATE=0 and holdstatus1_.HOLD_STATUS_CODE='VALID'
and shipmentor0_.TO_LOCATION_ID=partyvo13_.PARTY_ID
and userparty5_.USER_SYSTEMID=26708181
and shipmentor0_.REQUESTED_DEPARTURE_AFTER>='2015-05-11'
and shipmentor0_.REQUESTED_DEPARTURE_AFTER<='2015-05-14'

MY_SQL

/ we zien	,

 Aggregate  (cost=1100810.36..1100810.37 rows=1 width=0)
   ->  Nested Loop  (cost=8.60..1100810.35 rows=1 width=0)
         Join Filter: (partyvo12_.system_id = serviceord6_.executed_by_party_systemid)
         ->  Nested Loop  (cost=8.60..1099784.26 rows=1 width=4)
               Join Filter: (shipmentor0_.act_service_level_systemid = shipmentse11_.system_id)
               ->  Nested Loop  (cost=8.60..1099783.19 rows=1 width=8)
                     Join Filter: (shipmentor0_.shipm_type_systemid = shipmentty10_.system_id)
                     ->  Nested Loop  (cost=8.60..1099780.39 rows=1 width=12)
                           Join Filter: (shipmentor0_.from_country_systemid = country9_.system_id)
                           ->  Nested Loop  (cost=8.60..1099772.68 rows=1 width=16)
                                 Join Filter: (shipmentor0_.hold_status_systemid = holdstatus1_.system_id)
                                 ->  Nested Loop  (cost=8.60..1099771.55 rows=1 width=20)
                                       Join Filter: (partyvo13_.system_id = userparty5_.party_systemid)
                                       ->  Seq Scan on oms_user_party userparty5_  (cost=0.00..2.98 rows=1 width=4)
                                             Filter: (user_systemid = 26708181)
                                       ->  Merge Join  (cost=8.60..1099661.50 rows=8566 width=24)
                                             Merge Cond: ((partyvo13_.party_id)::text = (shipmentor0_.to_location_id)::text)
                                             ->  Nested Loop  (cost=0.29..918000.55 rows=73359225 width=13)
                                                   ->  Index Scan using idx_party1 on party partyvo13_  (cost=0.29..761.18 rows=8565 width=9)
                                                   ->  Materialize  (cost=0.00..270.48 rows=8565 width=4)
                                                         ->  Seq Scan on party partyvo12_  (cost=0.00..227.65 rows=8565 width=4)
                                             ->  Materialize  (cost=8.32..8.33 rows=1 width=21)
                                                   ->  Sort  (cost=8.32..8.32 rows=1 width=21)
                                                         Sort Key: shipmentor0_.to_location_id
                                                         ->  Index Scan using sho_req_departure_after on shipment_order shipmentor0_  (cost=0.29..8.31 rows=1 width=21)
                                                               Index Cond: ((requested_departure_after >= '2015-05-11 00:00:00'::timestamp without time zone) AND (requested_departure_after <= '2015-05-14 00:00:00'::timestamp without time zone))
                                                               Filter: (is_template = 0)
                                 ->  Seq Scan on hold_status holdstatus1_  (cost=0.00..1.11 rows=1 width=4)
                                       Filter: ((hold_status_code)::text = 'VALID'::text)
                           ->  Seq Scan on country country9_  (cost=0.00..4.54 rows=254 width=4)
                     ->  Seq Scan on shipment_order_type shipmentty10_  (cost=0.00..1.80 rows=80 width=4)
               ->  Seq Scan on shipment_service_level shipmentse11_  (cost=0.00..1.03 rows=3 width=4)
         ->  Seq Scan on service_order serviceord6_  (cost=0.00..914.93 rows=8893 width=4)
(33 rows)

real	0m18.014s
user	0m8.980s
sys	0m1.423s

/ TODO

/ 7	.  

/ customer status verdubbelt de tijd	,

time PGPASSWORD=mpopostgres@mpo psql -U mpopostgres pnloms7 <<MY_SQL
explain select * 
from SHIPMENT_ORDER shipmentor0_
left outer join HOLD_STATUS holdstatus1_ on shipmentor0_.HOLD_STATUS_SYSTEMID=holdstatus1_.SYSTEM_ID
left outer join CUSTOMER_STATUS customerst2_ on shipmentor0_.CUSTOMER_STATUS_SYSTEMID=customerst2_.SYSTEM_ID
,COUNTRY country9_
,SHIPMENT_ORDER_TYPE shipmentty10_
,SHIPMENT_SERVICE_LEVEL shipmentse11_
cross join OMS_USER_PARTY userparty5_
cross join SERVICE_ORDER serviceord6_
,PARTY partyvo12_
cross join PARTY partyvo13_

where 
shipmentor0_.organization_Systemid in (
    select uo.organization_systemid
    from user_organization uo
    where uo.user_systemid = 26708181)
and shipmentor0_.SHIPM_TYPE_SYSTEMID=shipmentty10_.SYSTEM_ID
and shipmentor0_.ACT_SERVICE_LEVEL_SYSTEMID=shipmentse11_.SYSTEM_ID
and serviceord6_.EXECUTED_BY_PARTY_SYSTEMID=partyvo12_.SYSTEM_ID
and userparty5_.PARTY_SYSTEMID=partyvo13_.SYSTEM_ID
and shipmentor0_.IS_TEMPLATE=0 and holdstatus1_.HOLD_STATUS_CODE='VALID'
and (customerst2_.NAME like '%VDO%')
and shipmentor0_.TO_LOCATION_ID=partyvo13_.PARTY_ID
and userparty5_.USER_SYSTEMID=26708181
and shipmentor0_.REQUESTED_DEPARTURE_AFTER>='2015-05-11'
and shipmentor0_.REQUESTED_DEPARTURE_AFTER<='2015-05-14'

MY_SQL


/ we zien	,
 Nested Loop Semi Join  (cost=17.07..1450.58 rows=2 width=6799)
   Join Filter: (shipmentor0_.organization_systemid = uo.organization_systemid)
   ->  Nested Loop  (cost=17.07..1445.70 rows=2 width=6799)
         Join Filter: (holdstatus1_.system_id = shipmentor0_.hold_status_systemid)
         ->  Nested Loop  (cost=17.07..1434.33 rows=1 width=6278)
               ->  Nested Loop  (cost=16.78..1433.94 rows=1 width=6067)
                     Join Filter: (shipmentor0_.shipm_type_systemid = shipmentty10_.system_id)
                     ->  Nested Loop  (cost=16.78..1431.14 rows=1 width=6033)
                           Join Filter: (shipmentor0_.customer_status_systemid = customerst2_.system_id)
                           ->  Merge Join  (cost=16.78..1429.94 rows=1 width=5705)
                                 Merge Cond: (userparty5_.party_systemid = partyvo13_.system_id)
                                 Join Filter: (shipmentor0_.act_service_level_systemid = shipmentse11_.system_id)
                                 ->  Nested Loop  (cost=0.14..1346.55 rows=26679 width=2213)
                                       ->  Nested Loop  (cost=0.14..1012.02 rows=8893 width=2023)
                                             ->  Index Only Scan using user_party_pk on oms_user_party userparty5_  (cost=0.14..8.16 rows=1 width=8)
                                                   Index Cond: (user_systemid = 26708181)
                                             ->  Seq Scan on service_order serviceord6_  (cost=0.00..914.93 rows=8893 width=2015)
                                       ->  Materialize  (cost=0.00..1.04 rows=3 width=190)
                                             ->  Seq Scan on shipment_service_level shipmentse11_  (cost=0.00..1.03 rows=3 width=190)
                                 ->  Materialize  (cost=16.64..16.64 rows=1 width=3492)
                                       ->  Sort  (cost=16.64..16.64 rows=1 width=3492)
                                             Sort Key: partyvo13_.system_id
                                             ->  Nested Loop  (cost=0.57..16.62 rows=1 width=3492)
                                                   ->  Index Scan using sho_req_departure_after on shipment_order shipmentor0_  (cost=0.29..8.31 rows=1 width=3281)
                                                         Index Cond: ((requested_departure_after >= '2015-05-11 00:00:00'::timestamp without time zone) AND (requested_departure_after <= '2015-05-14 00:00:00'::timestamp without time zone))
                                                         Filter: (is_template = 0)
                                                   ->  Index Scan using party_uk on party partyvo13_  (cost=0.29..8.30 rows=1 width=211)
                                                         Index Cond: ((party_id)::text = (shipmentor0_.to_location_id)::text)
                           ->  Seq Scan on customer_status customerst2_  (cost=0.00..1.19 rows=1 width=328)
                                 Filter: ((name)::text ~~ '%VDO%'::text)
                     ->  Seq Scan on shipment_order_type shipmentty10_  (cost=0.00..1.80 rows=80 width=34)
               ->  Index Scan using party_pk on party partyvo12_  (cost=0.29..0.38 rows=1 width=211)
                     Index Cond: (system_id = serviceord6_.executed_by_party_systemid)
         ->  Nested Loop  (cost=0.00..8.19 rows=254 width=521)
               ->  Seq Scan on hold_status holdstatus1_  (cost=0.00..1.11 rows=1 width=314)
                     Filter: ((hold_status_code)::text = 'VALID'::text)
               ->  Seq Scan on country country9_  (cost=0.00..4.54 rows=254 width=207)
   ->  Materialize  (cost=0.00..4.81 rows=4 width=4)
         ->  Seq Scan on user_organization uo  (cost=0.00..4.79 rows=4 width=4)
               Filter: (user_systemid = 26708181)
(40 rows)

/ we hebben zonder explain run	, maar we hebben killed	, want we zagen front-end freeze	,
/ TODO

/ 7	.






/ 7	. 

/ Tool hql -> sql
https://system.mp-objects.com/xwiki/bin/view/Blog/HQL+to+SQL+Translation

/ we hebben	, 
$ vi pnloms-build-config.oroperties
module.devtools.component=module


/ 7	. 

/ HQL

$ vi  ArrivalItemEntryListPage.java

from ShipmentOrderVO s 
left join s.holdStatus hs 
left join  s.customerStatus cs 
left join s.entityDetails ed 
, EntityDetailType edt
, UserParty up
, ServiceOrderVO so
oin so.consignmentList as c 
join c.serviceActionList as sa
where s.template = 0 
and hs.code='VALID' 
and cs.name like '%VDO%'  
and s.toPartyVO.code = up.party.partyId 
and up.resource.systemId = 26708181
and index(ed)=edt.systemId
and edt.code ='CmrRequired' 
and sa.shipmentOrderVO = s 
and (s.dateSetVO.requestedStartAfter >= '2015-05-11' 
	and s.dateSetVO.requestedStartAfter <= '2015-05-14') 

/ 	7.

/ Lees	,
http://stackoverflow.com/questions/117262/what-is-postgresql-explain-telling-me-exactly
/ die refs naar	,
https://wiki.postgresql.org/images/4/45/Explaining_EXPLAIN.pdf
/ Lees	,
http://postgresguide.com/performance/explain.html

$ vi pnl-579_2b.sh
explain analyze select * 
...
cross join PARTY partyvo13_
,PARTY partyvo12_
...

/ we zien	,
Nested Loop Semi Join  (cost=7858.94..10773.40 rows=1 width=9819) (actual time=157.868..236.325 rows=20 loops=1)

/ startup time=7858.94
/ max time=10773.40


$ vi pnl-579_2b.sh
explain analyze select * 
...
,PARTY partyvo12_
cross join PARTY partyvo13_
...

/ we zien	,
 Nested Loop Semi Join  (cost=9995.74..2872869.77 rows=1 width=9819) (actual time=28713.665..42404.089 rows=20 loops=1)

/ startup time=9995.74
/ max time=2872869.77

/ Maar als we doen	, 

$ vi pnl-579_2b.sh
explain analyze select * 
...
cross join PARTY partyvo13_
,PARTY partyvo12_
...

/ we zien	,
real	0m0.600s
user	0m0.011s
sys	0m0.005s

/ TODO

/ 13	. 

/ Deze query , pnl-579_smallest_fast.sh	, is WH de korste	, 

#!/usr/bin/bash

time PGPASSWORD=mpopostgres@mpo psql -U mpopostgres pnloms7 <<MY_SQL
select * 
from SHIPMENT_ORDER shipmentor0_
cross join OMS_USER_PARTY userparty5_
cross join SERVICE_ORDER serviceord6_
inner join CONSIGNMENT consignmen7_ on serviceord6_.SYSTEM_ID=consignmen7_.SERVICE_ORDER_SYSTEMID
inner join SERVICE_ACTION serviceact8_ on consignmen7_.SYSTEM_ID=serviceact8_.CONSIGNMENT_SYSTEMID
,PARTY partyvo12_
cross join PARTY partyvo13_

where 
serviceord6_.EXECUTED_BY_PARTY_SYSTEMID=partyvo12_.SYSTEM_ID
and userparty5_.PARTY_SYSTEMID=partyvo13_.SYSTEM_ID
and shipmentor0_.TO_LOCATION_ID=partyvo13_.PARTY_ID
and userparty5_.USER_SYSTEMID=26708181

and serviceact8_.SHIPMENT_ORDER_SYSTEMID=shipmentor0_.SYSTEM_ID

and shipmentor0_.REQUESTED_DEPARTURE_AFTER>='2015-05-11'
and shipmentor0_.REQUESTED_DEPARTURE_AFTER<='2015-05-14'

MY_SQL
 
/ Maar nu mag	ook	,
,PARTY partyvo12_
cross join PARTY partyvo13_
/ TODO

/ 7	. 

/ Michel heeft veranderd	,

		myQuery.setFromClause("from ShipmentOrderVO s left join s.holdStatus hs left join  s.customerStatus cs left join s.entityDetails ed , EntityDetailType edt, UserParty up, ServiceOrderVO so " + "join so.consignmentList as c join c.serviceActionList as sa ");
->
		myQuery.setFromClause("from ShipmentOrderVO s left join s.holdStatus hs left join  s.customerStatus cs left join s.entityDetails ed, ServiceOrderVO so " + "join so.consignmentList as c join c.serviceActionList as sa, EntityDetailType edt, UserParty up ");

/ hql ,

from ShipmentOrderVO s 
left join s.holdStatus hs 
left join  s.customerStatus cs 
left join s.entityDetails ed
, ServiceOrderVO so 
join so.consignmentList as c 
join c.serviceActionList as sa
, EntityDetailType edt
, UserParty up 
 where
s.template = 0 
and hs.code='VALID' 
and cs.name like '%VDO%'  
and s.toPartyVO.code = up.party.partyId 
and up.resource.systemId = + AuthenticationUtils.getResource().getSystemId()
and (index(ed)=edt.systemId) 
and edt.code ='CmrRequired' 
and sa.shipmentOrderVO = s 
and (s.dateSetVO.requestedStartAfter >= 'yesterdaysDate' and s.dateSetVO.requestedStartAfter <= 'tomorrowsDate')

/ sql,

select * 
from SHIPMENT_ORDER shipmentor0_ 
left outer join HOLD_STATUS holdstatus1_ on shipmentor0_.HOLD_STATUS_SYSTEMID=holdstatus1_.SYSTEM_ID 
left outer join CUSTOMER_STATUS customerst2_ on shipmentor0_.CUSTOMER_STATUS_SYSTEMID=customerst2_.SYSTEM_ID 
left outer join SHIPMENT_ORDER_DETAIL entitydeta3_ on shipmentor0_.SYSTEM_ID=entitydeta3_.ENTITY_SYSTEMID
, COUNTRY country9_
, SHIPMENT_ORDER_TYPE shipmentty10_
, SHIPMENT_SERVICE_LEVEL shipmentse11_ 
cross join SERVICE_ORDER serviceord4_ 
inner join CONSIGNMENT consignmen5_ on serviceord4_.SYSTEM_ID=consignmen5_.SERVICE_ORDER_SYSTEMID 
inner join SERVICE_ACTION serviceact6_ on consignmen5_.SYSTEM_ID=serviceact6_.CONSIGNMENT_SYSTEMID
cross join ENTITY_DETAIL_TYPE entitydeta7_ 
cross join OMS_USER_PARTY userparty8_ 
cross join PARTY partyvo13_ 
, PARTY partyvo12_ 
where shipmentor0_.organization_Systemid in 
    (select uo.organization_systemid from user_organization uo where uo.user_systemid = 26708181) 
and shipmentor0_.FROM_COUNTRY_SYSTEMID=country9_.SYSTEM_ID 
and shipmentor0_.SHIPM_TYPE_SYSTEMID=shipmentty10_.SYSTEM_ID 
and shipmentor0_.ACT_SERVICE_LEVEL_SYSTEMID=shipmentse11_.SYSTEM_ID 
and serviceord4_.EXECUTED_BY_PARTY_SYSTEMID=partyvo12_.SYSTEM_ID 
and userparty8_.PARTY_SYSTEMID=partyvo13_.SYSTEM_ID 
and shipmentor0_.IS_TEMPLATE=0 
and holdstatus1_.HOLD_STATUS_CODE='VALID' 
and (customerst2_.NAME like '%VDO%') 
and shipmentor0_.TO_LOCATION_ID=partyvo13_.PARTY_ID 
and userparty8_.USER_SYSTEMID=26708181 
and entitydeta3_.EDT_SYSTEMID=entitydeta7_.SYSTEM_ID 
and entitydeta7_.NAME='CmrRequired' 
and serviceact6_.SHIPMENT_ORDER_SYSTEMID=shipmentor0_.SYSTEM_ID 
and shipmentor0_.REQUESTED_DEPARTURE_AFTER>='2015-05-20' 
and shipmentor0_.REQUESTED_DEPARTURE_AFTER<='2015-05-23' 
order by serviceord4_.ESTIMATED_END_BEFORE, shipmentor0_.REQUESTED_ARRIVAL_AFTER

/ 13	. 

from ShipmentOrderVO s
, UserParty up
and s.toPartyVO.code = up.party.partyId 
/ ->
from SHIPMENT_ORDER shipmentor0_
cross join OMS_USER_PARTY userparty8_ 
cross join PARTY partyvo13_ 
and userparty8_.PARTY_SYSTEMID=partyvo13_.SYSTEM_ID 
and shipmentor0_.TO_LOCATION_ID=partyvo13_.PARTY_ID 


/ 13	. 

public class PartyVO extends AbstractParty implements BinaryContainer, MasterDataParty {
/ en	,
public class VirtualParty extends AbstractParty implements HibernateComponent {








/ Einde PNL-579

/ PNL-579

/ 7.	 

/ we zagen	,

from ShipmentOrderVO s
, UserParty up
and s.toPartyVO.code = up.party.partyId 
/ ->
from SHIPMENT_ORDER shipmentor0_
cross join OMS_USER_PARTY userparty8_ 
cross join PARTY partyvo13_ 
and userparty8_.PARTY_SYSTEMID=partyvo13_.SYSTEM_ID 
and shipmentor0_.TO_LOCATION_ID=partyvo13_.PARTY_ID 

/ we proberen dit op eclipse-jee-test	,

/ we make proj	.
hibernate_

/ Einde PNL-579

/ PNL-586

/ 7	. 

/ oef met import 

/ ga naar pnloms, test	,
config, rapportage, reports
/ open/edit 'ShipmentorderExtract'	,
/ click 'Export report'	,
/ we download 	,
report-ShipmentorderExtract.zip
/ Er zit een xml in	,
/ Deze zip is ERR	, er had de xls zelf in moeten staan	, zoals we die ook zien in de db	, 
> select*from report;

/ ga naar pnloms, local	,
config, rapportage, import report
/ click 'Choose File' : report-ShipmentorderExtract.zip
/ click 'Import'	,
/ WH daarna click 'Upload'	, maar dit werkt niet, omdat de zip file NIET OK is	,

/ ga naar pnloms, local	,
config, rapportage, reports
/ open/edit 'ShipmentorderExtract'	,
/ click 'Test report'	,
/ er komt een .xls file uit	,

/ 7	.

/ ga naar pnloms, test	,
config, rapportage, reports
/ open/edit 'ShipmentorderExtract'	,
/ click op de link naast 'Download report source'	,
shipment_order_screenExtractV9.jrxml

[eric@localhost Rapport]$ pwd
/home/eric/Devel/Postgres/Applicatie/Rapport
shipment_order_screenExtractV9.jrxml
/ Dit is dus het orig	,

[eric@localhost Rapport]$ cp shipment_order_screenExtractV9.jrxml my-shipment_order_screenExtractV9.sql

/ 7	. 

pnloms7=# \d shipment_order
 requested_departure_after      | timestamp without time zone | 

foo=> select*from y;
          t          
---------------------
 2015-05-15 01:02:03
 2015-05-16 07:08:09
 2015-06-16 07:08:09
(3 rows)

/ 7. 	

/ vervang subselect door joins	,

/ we moeten	,
from shipment_order sh
left join shipment_order_detail shod7 
	join entity_detail_type edt7 on shod7.edt_systemid = edt7.system_id and edt7.name='evraLos'
on shod7.entity_systemid = sh.system_id


/ 13	. 


$ vi my-shipment_order_screenExtractV9_edt2.sql

select
sh.system_id,
sh.SHIPMENT_ORDER_ID,
shod5.*,
edt5.*,
shod6.*,
edt6.*,
shod7.*,
edt7.*

from shipment_order sh
left join shipment_order_detail shod7 on shod7.entity_systemid = sh.system_id
left join entity_detail_type edt7 on shod7.edt_systemid = edt7.system_id and edt7.name='evraLos'

where sh.system_id=26875783;

/ Dit geeft 21 rows	,   en 1 ervan is 'evraLos'	,
/ Deze moeten we dus NIET doen	,

/ 13	.


from shipment_order sh
left join shipment_order_detail shod7 on shod7.entity_systemid = sh.system_id
join entity_detail_type edt7 on shod7.edt_systemid = edt7.system_id and edt7.name='evraLos'

/ dit geeft 1 row	,
/ dit is OK, maar als 'evraLos' er niet is , is er geen row	, maar we willen een lege row	,

/ 13	.  

from shipment_order sh
left join shipment_order_detail shod7 
	join entity_detail_type edt7 on shod7.edt_systemid = edt7.system_id and edt7.name='evraLos'
on shod7.entity_systemid = sh.system_id

/ Als 'evraLost' er niet is	, geeft de inner join geen row, maar door de buitenste left join, krijgen we dus een lege row	,

/ 7	.

/ we doen uiteindelijk	,

$ vi my-shipment_order_screenExtractV9_edt2.sql

select
edt.*,
edt2.*,
edt3.*,
edt4.*,
edt5.*,
edt6.*,
edt7.*

from shipment_order sh

left join shipment_order_detail shod
    join entity_detail_type edt on shod.edt_systemid = edt.system_id  and edt.name='laadvenstertype'
on shod.entity_systemid = sh.system_id

left join shipment_order_detail shod2 
    join entity_detail_type edt2 on shod2.edt_systemid = edt2.system_id and edt2.name='trailerBereikbaar'
on shod2.entity_systemid = sh.system_id

left join shipment_order_detail shod3
    join entity_detail_type edt3 on shod3.edt_systemid = edt3.system_id and edt3.name='procuratiehouder'
on shod3.entity_systemid = sh.system_id

left join shipment_order_detail shod4
    join entity_detail_type edt4 on shod4.edt_systemid = edt4.system_id and edt4.name='noValidationRequired'
on shod4.entity_systemid = sh.system_id

left join shipment_order_detail shod5
    join entity_detail_type edt5 on shod5.edt_systemid = edt5.system_id and edt5.name='handlingTijd'
on shod5.entity_systemid = sh.system_id

left join shipment_order_detail shod6
    join entity_detail_type edt6 on shod6.edt_systemid = edt6.system_id and edt6.name='evraLaad'
on shod6.entity_systemid = sh.system_id

left join shipment_order_detail shod7
    join entity_detail_type edt7 on shod7.edt_systemid = edt7.system_id and edt7.name='evraLos'
on shod7.entity_systemid = sh.system_id

where sh.system_id in (26875783,26875664);

/ we zien dan 2 rijen	,

[eric@localhost Rapport]$ ./my-shipment_order_screenExtractV9_edt.sh 2
 system_id | is_deleted |      name       | value_type |     entity     | organization_systemid | read_only | config | rank | required | visibility | allowed_values | group_systemid | system_id | is_deleted |       name        | value_type |     entity     | organization_systemid | read_only | config | rank | required | visibility | allowed_values | group_systemid | system_id | is_deleted |       name       | value_type |     entity     | organization_systemid | read_only | config | rank | required | visibility | allowed_values | group_systemid | system_id | is_deleted |         name         | value_type |     entity     | organization_systemid | read_only | config | rank | required | visibility | allowed_values | group_systemid | system_id | is_deleted | name | value_type | entity | organization_systemid | read_only | config | rank | required | visibility | allowed_values | group_systemid | system_id | is_deleted |   name   | value_type |     entity     | organization_systemid | read_only | config | rank | required | visibility | allowed_values | group_systemid | system_id | is_deleted |  name   | value_type |     entity     | organization_systemid | read_only | config | rank | required | visibility | allowed_values | group_systemid 
-----------+------------+-----------------+------------+----------------+-----------------------+-----------+--------+------+----------+------------+----------------+----------------+-----------+------------+-------------------+------------+----------------+-----------------------+-----------+--------+------+----------+------------+----------------+----------------+-----------+------------+------------------+------------+----------------+-----------------------+-----------+--------+------+----------+------------+----------------+----------------+-----------+------------+----------------------+------------+----------------+-----------------------+-----------+--------+------+----------+------------+----------------+----------------+-----------+------------+------+------------+--------+-----------------------+-----------+--------+------+----------+------------+----------------+----------------+-----------+------------+----------+------------+----------------+-----------------------+-----------+--------+------+----------+------------+----------------+----------------+-----------+------------+---------+------------+----------------+-----------------------+-----------+--------+------+----------+------------+----------------+----------------
  26673491 |          0 | laadvenstertype | LIST       | SHIPMENT_ORDER |                  1000 | FALSE     | 20     |   40 |        0 |            | B,C            |       26682105 |  26674124 |          0 | trailerBereikbaar | BOOLEAN    | SHIPMENT_ORDER |                  1000 | TRUE      | 0      |   50 |        0 |            |                |       26682105 |  26673820 |          0 | procuratiehouder | STRING     | SHIPMENT_ORDER |                  1000 | FALSE     | 20     |    1 |        0 |            |                |                |  26674127 |          0 | noValidationRequired | BOOLEAN    | SHIPMENT_ORDER |                  1000 | FALSE     | 0      |   60 |        0 |            |                |                |           |            |      |            |        |                       |           |        |      |          |            |                |                |  26684117 |          0 | evraLaad | STRING     | SHIPMENT_ORDER |                  1000 | TRUE      | 20     |  222 |        0 |            |                |       26682105 |  26684145 |          0 | evraLos | STRING     | SHIPMENT_ORDER |                  1000 | TRUE      | 20     |  223 |        0 |            |                |       26682105
  26673491 |          0 | laadvenstertype | LIST       | SHIPMENT_ORDER |                  1000 | FALSE     | 20     |   40 |        0 |            | B,C            |       26682105 |  26674124 |          0 | trailerBereikbaar | BOOLEAN    | SHIPMENT_ORDER |                  1000 | TRUE      | 0      |   50 |        0 |            |                |       26682105 |  26673820 |          0 | procuratiehouder | STRING     | SHIPMENT_ORDER |                  1000 | FALSE     | 20     |    1 |        0 |            |                |                |  26674127 |          0 | noValidationRequired | BOOLEAN    | SHIPMENT_ORDER |                  1000 | FALSE     | 0      |   60 |        0 |            |                |                |           |            |      |            |        |                       |           |        |      |          |            |                |                |  26684117 |          0 | evraLaad | STRING     | SHIPMENT_ORDER |                  1000 | TRUE      | 20     |  222 |        0 |            |                |       26682105 |  26684145 |          0 | evraLos | STRING     | SHIPMENT_ORDER |                  1000 | TRUE      | 20     |  223 |        0 |            |                |       26682105
(2 rows)


real	0m0.085s
user	0m0.000s
sys	0m0.003s

 


/ Einde PNL-586

/ PNL-410

shipment-order_edit.jsp

					onclick="theActiveFormManager.setRedirectUrl('../wicket?module=massupdate&amp;wicketpage=actiongroup.EntityActionGroupEditPage&amp;shipmentOrderSystemId=${formVO.systemId}');
							theActiveFormManager.submit(null,true,1);
							return false;" />

/ JSP->Wicket->JSP


$ vi shipment-order_edit.jsp

				<c:if test="${formVO.systemId>0 && cf:property('oms', 'shipmentorder.replanbutton.enabled', 'false') && cf:hasPrivilege('shipment-order','plan',formVO, null)}">
					<input type="button" id="replanBtn" value="<mpo:label name="Interactive Planning"/>"
						onclick="theActiveFormManager.setRedirectUrl('../wicket?module=optimize&amp;wicketpage=assistplan.AssistPlanPage&amp;systemId=${formVO.systemId}');theActiveFormManager.submit(null,true,1);return false;" />
				</c:if>


$ vi AssistPlanPage.java
	protected void createPage() {
		add(new Label("planShipmentOrderLabel", new StringResourceModel("planShipmentOrderLabel", this, new Model<ShipmentOrderVO>(activeShipmentOrder))));
		add(new AjaxLink<Object>("cancelButton") {
			@Override
			public void onClick(AjaxRequestTarget aArg0) {
				getRequestCycle().setRequestTarget(
						new RedirectRequestTarget("/oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=" + activeShipmentOrder.getSystemId()
								+ "&systemId=" + activeShipmentOrder.getSystemId()));
			}
		});

/ 13	. 

/ in sho edit screen (jsp), click massupate tab	, of request approval  (wicket)	, close (naar jsp)	.

/ 13	. 

/ click Request Approval	,
/ click close	, 
/ click nu my mass update	,
/ we zien een entry	,
/ / click close


/ planning, shipment order search
/ Wicket scherm, 
/ open een sho	, 
/ click back
/ je komt NIET terug op planning, shipment order search 

/ geef in google	,
cancel button return to previous page
/ Lees	,
http://stackoverflow.com/questions/8067510/onclick-javascript-to-make-browser-go-back-to-previous-page
/ of	,
http://stackoverflow.com/questions/12719906/cancel-button-to-previous-page
/of	,
http://www.w3schools.com/jsref/met_his_back.asp
/ of	,
http://www.computerhope.com/issues/ch000317.htm

/ Einde PNL-410

/ DEBUG PNL-410

/ Kies	, 
SH000013410-20150608
/ of	,
SH000010186

/ 7	.

$ vi shipment-order_edit.jsp

				<c:if test="${cf:property('oms', 'shipmentorder.massupdate.enabled', 'false')=='true'}">
					<mpo:tab name="massupdate">
						<massupdatetags:sho-massupdate-actions />
					</mpo:tab>

$ vi sho-massupdate-actions.tag

	<td>
		<button class="icon icon_edit small" title="Edit" 
			onclick="theActiveFormManager.setRedirectUrl('../wicket?module=massupdate&amp;wicketpage=actiongroup.EntityActionGroupEditPage&amp;shipmentOrderSystemId=${formVO.systemId}&amp;actionGroupSystemId=${actionGroup.systemId}');
					theActiveFormManager.submit(null,true,1);return false;"></button>
	</td>


/ theActiveFormManager.setRedirectUrl is in 
$ vi class.formmanager.js
   this.setRedirectUrl = function(anUrl) {
        document.getElementById("redirectTo").value=anUrl;
}
///////////////////////
/ Dit is een field in het form	, en wordt in de server process	,

/ theActiveFormManager.submit is in 	,
$ vi smartsave.js

jQuery(document).ready(initSmartSave);

function initSmartSave() {
		theActiveFormManager._smartSaveSubmit = theActiveFormManager.submit;
		theActiveFormManager.submit = function(anAction, aBoolDoRedirect, aRedirectionLevelOffset) {
			smartSaveResetDirtyFlag();
			return this._smartSaveSubmit(anAction, aBoolDoRedirect, aRedirectionLevelOffset);
		};
/s
/ in class.formmanager.js

    this.submit = function(anAction, aBoolDoRedirect, aRedirectionLevelOffset) {
		...
        myForm.submit();

/ we zien in HTML	,
<form action="shipment-order_save">
	...

/////////////////////
/ we zien wel ajax calls	, maar de submit is gewoon een ouderwetse submit	,
        myForm.submit();

/ 13	.

/ wat doet Save button op de sho?

/ Hetzelfde	, want	,

<input type="button" value="Save" onclick="
	document.getElementById('selectPath').value='yes'; 
	theShipmentorderFormManager.submit('../oms/shipment-order_save', false, 0);">

$ vi oms-sitemap.xmap

			<map:action logger="shipmentorder" name="shipmentOrderSave" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderSaveAction"/>

            <map:match pattern="shipment-order_save">
                <!-- The shipment order is saved and via redirection send to the correct page -->
				<map:act type="shipmentOrderSave">
                    <map:parameter name="isSave" value="true"/>
                </map:act>
                <!-- This part is only reached when the path selection is manual (see ShipmentOrderSave.shouldTakeControl()-->
                <map:act type="pathMatchAction"/>
                <map:act type="redirectAfterSave">
					<map:parameter name="redirectTo" value="path-template_list-for-shipment-order?refresh=true&amp;manuallyAssign={request-param:manuallyAssign}&amp;base_sessionLevelOffset=1"/>
				</map:act>
            </map:match>


$ vi AbstractSaveAction.java

	@Override
	public final Map act() throws Exception {
			handleSave();
			afterSave();

$ vi ShipmentOrderSaveAction.java
	public void handleSave() throws java.lang.Exception {
	...

/ 7	.

$ vi sho-massupdate-actions.tag
...
/ TODO

$ vi AbstractSaveAction.java

	protected void afterSave() throws Exception {

		getSession().setAttribute(LIST_MESSAGE_ATTRIBUTE, getSaveMessage());

		if (shouldTakeControl()) {
			String myRedirectUrl = getRedirectUrl();
/s
					myRet = (String) getRequest().getAttribute(REDIRECT_TO_ATTR);
/ REDIRECT_TO_ATTR="redirectTo"
myRet	"../wicket?module=massupdate&wicketpage=actiongroup.EntityActionGroupEditPage&shipmentOrderSystemId=26879305&actionGroupSystemId=26879596&base_sessionLevelOffset=1" (id=19633)	
/t
			getRequest().setAttribute("redirectTo", myRedirectUrl);
/ TODO

			RedirectSaveAction.redirect(getRedirector(), getRequest(), myRedirectUrl);

/ In class.formmanager.js deden we	, 
        document.getElementById("redirectTo").value=anUrl;
/ Deze wordt nu process	,

/s
RedirectSaveAction.redirect(Redirector, Request, String) line: 38	
		redirect(aRedirector, aRequest, anUrl, 0);
/s
RedirectSaveAction.redirect(Redirector, Request, String, int) line: 43	

		aRequest.setAttribute("redirectTo", anUrl);
anUrl	"../wicket?module=massupdate&wicketpage=actiongroup.EntityActionGroupEditPage&shipmentOrderSystemId=26879305&actionGroupSystemId=26879596&base_sessionLevelOffset=1&base_sessionLevelOffset=1&base_sessionLevelOffset=1" (id=21054)	
/ &base_sessionLevelOffset=1 is erbij set	,

			String myRedirectPage = "../core/generic_save_redirect?redirectTo=" + URLEncoder.encode(anUrl, "UTF-8");
myRedirectPage	"../core/generic_save_redirect?redirectTo=..%2Fwicket%3Fmodule%3Dmassupdate%26wicketpage%3Dactiongroup.EntityActionGroupEditPage%26shipmentOrderSystemId%3D26879305%26actionGroupSystemId%3D26879596%26base_sessionLevelOffset%3D1%26base_sessionLevelOffset%3D1%26base_sessionLevelOffset%3D1" (id=21058)	

			aRedirector.redirect(true, myRedirectPage);
/ aRedirector is een Cocoon obj	,

/ 7	.

/ Hoe werkt de close button op de Entity Action Group Edit Page	?

$ vi EntityActionGroupPanel.java

		Button closePageButton = new Button("closePageButton") {

			@Override
			public void onSubmit() {
				if (page != null) {
null
					setResponsePage(page);
				} else if (shipmentOrderId != 0) {
/ JA
					getRequestCycle().setRequestTarget(
							new RedirectRequestTarget("/oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=" + shipmentOrderId + "&systemId=" + shipmentOrderId));
				}
			}
		};

/ 7	. 

/ Save en Cancel button op sho edit	, 

<input type="hidden" id="selectPath" name="selectPath" value="no">
<input type="button" value="Save" onclick="document.getElementById('selectPath').value='yes'; theShipmentorderFormManager.submit('../oms/shipment-order_save', false, 0);">

<input type="button" id="cancelBtn" name="cancelBtn" value="Cancel" onclick=" theShipmentorderFormManager.cancel('Loose changes made after last save');">

/ 13	. 

/ we click Cancel



		theActiveFormManager.cancel = function(aMessage) {
			this.performRedirect(this.getRedirectUrl());
/ this.getRedirectUrl()="../core/back?levelOffset=-1"
/s
    this.getRedirectUrl = function() {
        return document.getElementById("redirectTo").value;

/ console	,
>  document.getElementById("redirectTo")
<input type="hidden" name="redirectTo" id="redirectTo" value="../core/back?levelOffset=-1">

/ Intermezzo

$ vi core-sitemap.xmap

           <map:match pattern="back">
               <map:act type="redirectByFlow">
				    <map:parameter name="levelOffset" value="{request-param:levelOffset}"/>
				</map:act>
            </map:match>
 
$ vi generic-actions.xmap
<map:action name="redirectByFlow" src="com.mpobjects.control.action.RedirectByFlowAction"/>

$ vi RedirectByFlowAction.java

	@Override
	public Map act() throws Exception {
		String myRequestUrl = getRequestUrl(myRequest.getUrl(), myParams);
		RedirectSaveAction.redirect(getRedirector(), getRequest(), myRequestUrl);

/ Dus we komen weer in RedirectSaveAction.redirect uit	, net als de edit button onder in de massupdate tab	,


/ Einde Intermezzo

/ Intermezzo

$ vi FormTag.java

	@Override
	public int doStartTag() throws JspTagException {

/////////////////////////////////// 
/ Called als we het shipment-order_edit.jsp vragen	, dus als we een sho 'openen'	,

		myPrintString.append("<script type=\"text/javascript\">\n");
		myPrintString.append("var " + getJsFormManager() + "= new FormManager('" + theName + "');");
		myPrintString.append("var theActiveFormManager=" + getJsFormManager() + ";");
		myPrintString.append("document.theActiveFormManager=theActiveFormManager");
		myPrintString.append("</script>\n");

		myPrintString.append("<input type=\"hidden\"");
		myPrintString.append(" name=\"redirectTo\"");
		myPrintString.append(" id=\"redirectTo\"");
		myPrintString.append(" value=\"" + getRedirectUrl() + "\"");
		myPrintString.append("/>");
/s
	private String getRedirectUrl() {
		String myRedirectTo = "";
		if (getRequest().getAttribute("redirectTo") != null) {
/ NEE
			myRedirectTo = (String) getRequest().getAttribute("redirectTo");
		} else if (getRequest().getParameter("redirectTo") != null) {
/ NEE
			myRedirectTo = getRequest().getParameter("redirectTo");
		} else {
/ JA
			myRedirectTo = "../core/back?levelOffset=-1";// EntityActionUtil.getActionUrl(getRequest(), "list") +
															// "?refresh=true";
		}
		return myRedirectTo;
	}

/ we geven cont	, 

$ vi ButtonTag.java

		if (TYPE_REFRESH.equals(getType())) {
this	ButtonTag  (id=19047)	
	theType	"cancel" (id=19148)	

		} else if (!readOnly) {
			if (getType().equals(TYPE_CANCEL)) {
				myPrint.append("<input type=\"button\" ");
				myPrint.append(" id=\"cancelBtn\"  name=\"cancelBtn\" ");
				myPrint.append(" value=\"" + getLabel("cancel") + "\"");
				myPrint.append(" onclick=\" " + getForm().getJsFormManager() + ".cancel('" + getCancelMessage() + "');\"");
				if (!myCanGoBack) {
/ NEE

				myPrint.append("/>");

/ Einde Intermezzo

/ 7	.

/ we click op Cancel	,

$ vi smartsave.js

		theActiveFormManager.cancel = function(aMessage) {
			this.performRedirect(this.getRedirectUrl());
		};
/s
$ vi class.formmanager.js
    this.getRedirectUrl = function() {
        return document.getElementById("redirectTo").value;
    }
"../core/back?levelOffset=-1"

/t
/s
    this.performRedirect = function(newUrl) {
    	 document.location.replace(newUrl);
     }


/ Intermezzo

$ vi core-sitemap.xmap

           <map:match pattern="back">
               <map:act type="redirectByFlow">
				    <map:parameter name="levelOffset" value="{request-param:levelOffset}"/>
				</map:act>
            </map:match>
 
$ vi generic-actions.xmap
<map:action name="redirectByFlow" src="com.mpobjects.control.action.RedirectByFlowAction"/>

/ Einde Intermezzo

/////////////////////////////////////////////////////////////////////////////////////////
/ Omdat de url ../core/back is	, komen we in deze action	, en die haalt de daadwerkelijke url uit de base_sessionMap

/s
$ vi RedirectByFlowAction.java

	@Override
	public Map act() throws Exception {
		int myLevel = Math.abs(getParameters().getParameterAsInteger(LEVEL_OFFSET)) * -1;
-1
		int myTargetLevel = getRequestManager().getLevel() + myLevel;
0
		BaseRequest myRequest = getRequestManager().getRequestForLevel(myTargetLevel);

/ we zijn nu in level 1	, en we moeten naar level 1-1=0	, 
/ de url wordt gevonden in de list 

this	RequestManager  (id=20326)	
	session	SessionAdaptor  (id=20357)	
		theSessionCocoon	HttpSession  (id=20312)	
			wrappedSession	StandardSessionFacade  (id=20376)	
				session	StandardSession  (id=20377)	
					attributes	Hashtable  (id=20381)	
						table	Hashtable$Entry[47]  (id=20396)	
							[40]	Hashtable$Entry  (id=20413)	
								key		"base_sessionMap"
								value	HashMap  (id=20456)	
									table	HashMap$Entry[16]  (id=20676)	
										[6]	HashMap$Entry  (id=20677)	
											key	"1435588753236" (id=20338)	
											next	null	
											value	BaseRequest  (id=20661)	
												params	HashMap  (id=20663)	
												requestId	"1435588753236" (id=20338)	
												url	"../oms/shipment-order_list" (id=20664)	
										[7]	HashMap$Entry  (id=20678)	
											hash	-568318985	
											key	"1435588762448" (id=20339)	
											next	null	
											value	BaseRequest  (id=21506)	
												params	HashMap  (id=26982)	
												requestId	"1435588762448" (id=20339)	
												url	"../oms/shipment-order_edit" (id=26983)	

		String myRequestUrl = getRequestUrl(myRequest.getUrl(), myParams);
../oms/shipment-order_list?usePaginator=true&is_search_header_request=true&filter_2=&filter_1=&filter_4=&filter_3=SH000013410-20150608&filter_6=&selectBox=null;&filter_5=&filter_7=&screenId=shipment-order&filter_8=&filter_9=&filter_10=&filter_11=&filter_16=&filter_17=&do=filter&filter_18=&filter_19=&filter_31=&filter_12=&filter_30=&filter_13=&filter_33=>01-Jun-2015&filter_14=&filter_32=&filter_15=&randomizingurl=1435587597661&base_sessionLevelOffset=0&filter_21=&filter_22=&filter_20=&column=&filter_29=&filter_27=&filter_28=&filter_25=&filter_26=&filter_23=&filter_24=

		RedirectSaveAction.redirect(getRedirector(), getRequest(), myRequestUrl);
/ Dus we komen weer in RedirectSaveAction.redirect uit	, net als de edit button onder in de massupdate tab	,

/ 7	.

$ vi ButtonTag.java

	public static final String TYPE_CANCEL_REDIRECT = "cancelAndRedirect";

			} else if (getType().equals(TYPE_CANCEL_REDIRECT)) {


$ vi invoice-detail_edit.jsp
				<mpo:button type="cancelAndRedirect" url="${backUrl}"/>
/ TODO (Waar is deze?)

/ Ga op acceptance, dsvfms	,
finance, carrier invoice , search, 
/ edit er een	,
/ we zien invoice-header_edit	, dus kijk  in invoice-sitemap	, voor de action en jsp	,
/ We komen op 'Invoice Header', 
invoice-header_edit.jsp 

/ we zien onder Invoice line 2 links	, 
'Create mode: add a new page' 
'Edit mode'	,



Create mode: add a new page	,
/=
<a href="invoice-multiline_create?invoiceheadersystemid=106758430&amp;systemid=106758430&amp;refresh=true&amp;screenId=invoice-multiline_create&amp;base_controlFlow=false">Create mode: add a new page</a>
/ we zien de Cancel button	,
/=
<input type="button" id="cancelBtn" value="Cancel" onclick=" theEditFormFormManager.cancelAndRedirect('Cancel creation of new record', 'invoice-multiline_edit?headersystemid=106758430&amp;base_controlFlow=false');">


/ Kies onder invoice line	,
edit mode	,
/=
<a href="invoice-multiline_edit?invoiceheadersystemid=106758715&amp;systemid=106758715&amp;refresh=true&amp;screenId=invoice-multiline_edit&amp;base_controlFlow=false">Edit mode</a> 
/ we zien Cancel button	,
/=
<input type="button" id="cancelBtn" value="Cancel" onclick=" theEditFormFormManager.cancelAndRedirect('Loose changes made after last save', 'invoice-line_view?headersystemid=106758430&amp;base_controlFlow=false');">

/ invoice-multiline_(create|edit) komen beide op 	,
InvoiceMultiLineFormAction.act	,
/ en daarna op	,
$ vi invoice-multiline_edit.jsp
			<mpo:button type="cancelAndRedirect" url="${redirectUrlML}"/>

/ 13	. 

$ vi invoice-sitemap.xmap
			<map:action logger="invoice" name="invoiceHeaderForm"   src="com.mpobjects.invoice.control.invoiceheader.action.InvoiceHeaderFormAction"/>
			<map:action logger="invoice" name="invoiceMultiLineForm"   src="com.mpobjects.invoice.control.invoiceline.action.InvoiceMultiLineFormAction"/>
			<map:action logger="invoice" name="invoiceLine"   	    src="com.mpobjects.invoice.control.invoiceline.action.InvoiceLineAction"/>			


			<map:match type="regexp" pattern="^invoice-header_(edit|create)$">
				<map:act type="invoiceHeaderForm"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/invoice-header_edit.jsp"/>
			</map:match>

			<map:match type="regexp" pattern="^invoice-multiline_(edit|create)$">
				<map:act type="setAttributes" >
					<map:parameter name="attributesType" value="request"/>
     				<map:parameter name="edit-type" value="{1}"/>
     				<map:parameter name="base_controlFlow" value="false" />
                </map:act>
				<map:act type="invoiceMultiLineForm"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/invoice-multiline_edit.jsp"/>
			</map:match>

			<map:match pattern="invoice-line_view">
				<map:act type="invoiceLine"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/invoice-line.jsp"/>
			</map:match>	




/ we zien de 2 links 'Create mode: add a new page'	 en 'Edit mode' 	,
$ vi invoice-line.jsp
			 <c:if test="${invoiceHeaderVO.modifiedEditModeType == 'edit'}">
				<a href="invoice-multiline_create?invoiceheadersystemid=${invoiceHeaderVO.systemId}&amp;systemid=${invoiceHeaderVO.systemId}&amp;refresh=true&amp;screenId=invoice-multiline_create&amp;base_controlFlow=false">Create mode: add a new page</a>
				<br />
			</c:if> 
				<a href="invoice-multiline_edit?invoiceheadersystemid=${invoiceHeaderVO.systemId}&amp;systemid=${invoiceHeaderVO.systemId}&amp;refresh=true&amp;screenId=invoice-multiline_edit&amp;base_controlFlow=false">Edit mode</a></p>


$ vi InvoiceMultilineFormAction.java

public class InvoiceMultiLineFormAction extends AbstractAction implements NonScreenAction {
	public static String REDIRECT_ATT_NAME = "redirectUrlML";

		getSession().setAttribute(REDIRECT_ATT_NAME,
				"invoice-line_view" + "?" + HEADER_ID_ATT_NAME + "=" + theInvoiceHeaderSystemId + "&amp;base_controlFlow=false");
		if (StringUtils.isNotEmpty(editType) && editType.equals("edit")) {
			// edit
			...
		else{
			// create
			getSession().setAttribute(REDIRECT_ATT_NAME,
					"invoice-multiline_edit" + "?" + HEADER_ID_ATT_NAME + "=" + theInvoiceHeaderSystemId + "&amp;base_controlFlow=false");

/ 13	. 

/ 1313

/ we zijn op ,	
Invoice Line
/ link 'Create mode: add a new page'	,
<a href="invoice-multiline_create?invoiceheadersystemid=106758430&amp;systemid=106758430&amp;refresh=true&amp;screenId=invoice-multiline_create&amp;base_controlFlow=false">Create mode: add a new page</a>
/ Hoe is create?
/ In invoice-sitemap.xmap, zien we
InvoiceLineAction
invoice-line.jsp
				<a href="invoice-multiline_create?invoiceheadersystemid=${invoiceHeaderVO.systemId}&amp;systemid=${invoiceHeaderVO.systemId}&amp;refresh=true&amp;screenId=invoice-multiline_create&amp;base_controlFlow=false">Create mode: add a new page</a>
				<a href="invoice-multiline_edit?invoiceheadersystemid=${invoiceHeaderVO.systemId}&amp;systemid=${invoiceHeaderVO.systemId}&amp;refresh=true&amp;screenId=invoice-multiline_edit&amp;base_controlFlow=false">Edit mode</a></p>
/ De links staan hard in de jsp	, static	,

/ click 'Create mode: add a new page'	,

/ 1313	.

/ we komen op	,
Invoice Multiline
Create Mode
/ we zien Cancel button	,
<input type="button" id="cancelBtn" value="Cancel" onclick=" theEditFormFormManager.cancelAndRedirect('Cancel creation of new record', 'invoice-multiline_edit?headersystemid=106758430&amp;base_controlFlow=false');">

/ Hoe is deze gemaakt?
/ via invoice-sitemap.xml

InvoiceMultiLineFormAction
	public static String HEADER_ID_ATT_NAME = "headersystemid";
	public static String REDIRECT_ATT_NAME = "redirectUrlML";
		} else {
			// create
			getSession().setAttribute(REDIRECT_ATT_NAME, "invoice-multiline_edit" + "?" + HEADER_ID_ATT_NAME + "=" + theInvoiceHeaderSystemId + "&amp;base_controlFlow=false");

jsp/invoice-multiline_edit.jsp
			<mpo:button type="cancelAndRedirect" url="${redirectUrlML}"/>

/ 1313	.





 











/ Eihde DEBUG PNL-410

/ DEBUG PNL-410

/ op 2015.01-mpo	, want we kunnen debug	, 

/ 7	. 

/ 13	. 

/ we edit/openen een invoice header	, 
/ we zijn op de list van invoice headers (finance, carrier invoice, search)	, en we edit de 1ste	,
<a class="action" href="../invoice/invoice-header_edit?base_sessionLevelOffset=1&amp;systemid=26711893&amp;systemId=26711893">
	<img src="../lookandfeel/styles/images/icons/check24.gif" border="0" alt="Edit" title="Edit">
</a>

/ we vallen in 	,
InvoiceHeaderFormAction.act() line: 102	
		int mySystemId = getSystemIdFromRequest();
mySystemId	26711893	
/s
			String mySystemString = getRequest().getParameter("systemid");
/t
		getSession().setAttribute(InvoiceMultiLineFormAction.HEADER_ID_ATT_NAME, mySystemId);
/ InvoiceMultiLineFormAction.HEADER_ID_ATT_NAME = headersystemid
		getSession().setAttribute(InvoiceLineAction.HEADER_ID_ATT_NAME, mySystemId);
/ InvoiceLineAction.HEADER_ID_ATT_NAME=invoiceheadersystemidattr
		getSession().removeAttribute("invoicelinesystemidattr");

////////////////////////////////////////
/ Dus bij bezoek invoiceheader wordt de headersystemidinvoiceheadersystemidattr in session set	,  WH totdat de volgende invoice header wordt bezocht: dan wordt de value overwrite	,

/ we zien dat invoiceheadersystemidattr wordt asked in de InvoiceLineAction	, en dat headersystemid wordt asked in InvoiceMultiLineFormAction	, 

/ Daarna, we vallen vanzelf in	,
/ TODO
InvoiceLineAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
				Map myMap = act();
/s
InvoiceLineAction.act() line: 34	
		if (getSession().getAttribute("invoicelinesystemidattr") != null) {
/ Klopt, was removed hierboven	,
/ NEE

		myInvoiceHeaderVO = InvoiceHeaderUtil.getDAO().getBySystemId(getInvoiceHeaderSystemIdFromRequest());
/s
InvoiceLineAction.getInvoiceHeaderSystemIdFromRequest() line: 67	
			if (getSession().getAttribute(HEADER_ID_ATT_NAME) != null) {
/ JA
				myInvoiceHeaderSystemIdAttr = ((Integer) getSession().getAttribute(HEADER_ID_ATT_NAME)).intValue();
26711893
/ Was hierboven set	,
			String myInvoiceHeaderSystemString = getRequest().getParameter("invoiceheadersystemid");
"26711893"
			if (myInvoiceHeaderSystemString != null) {
				myInvoiceHeaderSystemId = theFormat.parse(getRequest().getParameter("invoiceheadersystemid")).intValue();
26711893
		return myInvoiceHeaderSystemId;

/ 13	

/ op invoice-line.jsp zien we 2 links	,
				<a href="invoice-multiline_create?invoiceheadersystemid=${invoiceHeaderVO.systemId}&amp;systemid=${invoiceHeaderVO.systemId}&amp;refresh=true&amp;screenId=invoice-multiline_create&amp;base_controlFlow=false">Create mode: add a new page</a>
				<a href="invoice-multiline_edit?invoiceheadersystemid=${invoiceHeaderVO.systemId}&amp;systemid=${invoiceHeaderVO.systemId}&amp;refresh=true&amp;screenId=invoice-multiline_edit&amp;base_controlFlow=false">Edit mode</a></p>

/we click de edit link	,
/s
InvoiceMultiLineFormAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
				Map myMap = act();
/s
InvoiceMultiLineFormAction.act() line: 47	
		if (getSession().getAttribute(HEADER_ID_ATT_NAME) != null) {
/ JA
			theInvoiceHeaderSystemId = (Integer) getSession().getAttribute(HEADER_ID_ATT_NAME);
/ HEADER_ID_ATT_NAME="headersystemid"	,
/ set door InvoiceHeaderFormAction
/ de param in de request invoiceheadersystemid is WH overbodig	,

/ In InvoiceMultiLineFormAction	,
	public static String HEADER_ID_ATT_NAME = "headersystemid";
	public static String REDIRECT_ATT_NAME = "redirectUrlML";

		String editType = (String) getRequest().getAttribute("edit-type");
"edit"
/ TODO
		getSession().setAttribute(REDIRECT_ATT_NAME,
				"invoice-line_view" + "?" + HEADER_ID_ATT_NAME + "=" + theInvoiceHeaderSystemId + "&amp;base_controlFlow=false");
////////////////////////////////////
/ Zodirect used in de jsp	,invoice-multiline_edit.jsp	, op de Cancel	,
		if (StringUtils.isNotEmpty(editType) && editType.equals("edit")) {
			// edit
				myVO.setInvoiceHeaderSystemId(theInvoiceHeaderSystemId);
...
		myVO.setInvoiceHeaderSystemId(theInvoiceHeaderSystemId);

/ we geven continue	,

/ 13	. 

/ we zien de invoice-multiline_edit.jsp	,
Invoice Multiline
Edit Mode
/ we zien Cancel button	,
<input type="button" id="cancelBtn" value="Cancel" onclick=" theEditFormFormManager.cancelAndRedirect('Cancel creation of new record', 'invoice-line_view?headersystemid=26711893&amp;base_controlFlow=false');">
/ omdat	,
$ vi invoice-multiline_edit.jsp
			<mpo:button type="cancelAndRedirect" url="${redirectUrlML}"/>

/ we click Cancel	,
$ vi class.formmanager.js
    this.cancelAndRedirect = function(aMessage, anUrl) {
aMessage: "Cancel creation of new record"
anUrl: "invoice-line_view?headersystemid=26711893&base_controlFlow=false"
/ Dit staat in de onclick="..."	,
        if (confirm(aMessage)) {
/ We zien het window	, waar we OK moeten geven	,
        	this.performRedirect(anUrl);
/s
    	 document.location.replace(newUrl);

$ vi invoice-sitemap.xmap	,
			<map:match pattern="invoice-line_view">
				<map:act type="invoiceLine"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/invoice-line.jsp"/>
			</map:match>	


/ we vallen in InvoiceLineAction	,
InvoiceLineAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
				Map myMap = act();
/s
InvoiceLineAction.act() line: 29	
		if (getSession().getAttribute("invoicelinesystemidattr") != null) {
/ NEE,	 zit niet in de url,
		myInvoiceHeaderVO = InvoiceHeaderUtil.getDAO().getBySystemId(getInvoiceHeaderSystemIdFromRequest());
/s
InvoiceLineAction.getInvoiceHeaderSystemIdFromRequest() line: 70	
			if (getSession().getAttribute(HEADER_ID_ATT_NAME) != null) {
/ HEADER_ID_ATT_NAME="invoiceheadersystemidattr"
/ JA
				myInvoiceHeaderSystemIdAttr = ((Integer) getSession().getAttribute(HEADER_ID_ATT_NAME)).intValue();
			String myInvoiceHeaderSystemString = getRequest().getParameter("invoiceheadersystemid");
/ null
			} else {
				myInvoiceHeaderSystemId = myInvoiceHeaderSystemIdAttr;
26711893
...

/ we geven continue	,
/ we zien de invoice-line.jsp	, met de 2 hardcoded links	,

/ 13	. 

/ we click de create link	,

/s
InvoiceMultiLineFormAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
				Map myMap = act();
/s
InvoiceMultiLineFormAction.act() line: 47	
		if (getSession().getAttribute(HEADER_ID_ATT_NAME) != null) {
			theInvoiceHeaderSystemId = (Integer) getSession().getAttribute(HEADER_ID_ATT_NAME);
/ HEADER_ID_ATT_NAME="headersystemid"
		String editType = (String) getRequest().getAttribute("edit-type");
"create"
		getSession().setAttribute(REDIRECT_ATT_NAME, "invoice-line_view" + "?" + HEADER_ID_ATT_NAME + "=" + theInvoiceHeaderSystemId + "&amp;base_controlFlow=false");
/ Maar gaan we straks overwrite	,
		} else {
			// create
			InvoiceDetailVO lastInvoiceDetail = new InvoiceDetailVO();
			getSession().setAttribute(REDIRECT_ATT_NAME,
					"invoice-multiline_edit" + "?" + HEADER_ID_ATT_NAME + "=" + theInvoiceHeaderSystemId + "&amp;base_controlFlow=false");
/ Deze wordt zo used in de invoice-multiline_edit.jsp	,

	public static String HEADER_ID_ATT_NAME = "headersystemid";
	public static String REDIRECT_ATT_NAME = "redirectUrlML";

/ we zien de invoice-multiline_edit.jsp	,
Invoice Multiline
Create Mode

/ we zien op de jsp	 de Cancel button	,
<input type="button" id="cancelBtn" value="Cancel" onclick=" theEditFormFormManager.cancelAndRedirect('Cancel creation of new record', 'invoice-multiline_edit?headersystemid=26711893&amp;base_controlFlow=false');">

/ we vallen in	,
InvoiceMultiLineFormAction.act() line: 47	
		if (getSession().getAttribute(HEADER_ID_ATT_NAME) != null) {
/ JA
/ HEADER_ID_ATT_NAME="headersystemid"
			theInvoiceHeaderSystemId = (Integer) getSession().getAttribute(HEADER_ID_ATT_NAME);



/ Einde DEBUG PNL-410

/ PNL-410

/ kies	,
planning, shipment order, shipment order search
$ vi pnloms-menu.xml
	<m:add path="planning.shipmentOrder.shipmentOrderSearch" privilege="shipment-order.list" actionUrl="wicket?module=oms&amp;wicketpage=shipmentorder.ShipmentOrderListPage" index="5002" />
/ we zien	,
localhost:8080/tms/wicket?module=oms&wicketpage=shipmentorder.ShipmentOrderListPage?emptySession=true
/ TODO

$ vi ShipmentOrderListPage.java
		myRowActions.add(new RowAction() {
			@Override
			public boolean execute(Object aObject) {
				getRequestCycle().setRequestTarget(
						new RedirectRequestTarget("../oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=" + aObject + "&systemId=" + aObject));
				return false;
			}
		});

/ Dit is de URL die naar scs gaat als je de edit button click op de row van een shipment order	, in de list van 'shipment order search'	,


$ vi shipment-order_edit.jsp
			<mpo:button type="cancel" />
/ IS ER AL			
			<mpo:button type="cancelAndRedirect" url="${redirectUrlML}"/>
/ NEW

$ vi oms-sitemap.xmap

			<map:action logger="shipmentorder" name="customerOrderEdit" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderEditAction"/>

			<map:match pattern="shipment-order_edit">
				<map:act type="shipmentOrderEdit">
							<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order_edit.jsp"/>

$ vi ShipmentOrderEditAction.java
	@Override
	public Map act() throws java.lang.Exception {
			getSession().setAttribute("redirectUrlSHO", "shipmentorder.ShipmentOrderListPage");

/ 7	. 

/ op list van shipment order search 	,
<button id="link8b" wicketpath="query_rows_0_cell_0_cellvalue_2_link" onclick="var wcall=wicketAjaxGet('?wicket:interface=:3:query:rows:0:cell:0:cellvalue:2:link::IBehaviorListener:0:-1',function() { }.bind(this),function() { }.bind(this), function() {return Wicket.$('link8b') != null;}.bind(this));return !wcall;" class="icon icon_edit small"></button>

/ 7	.

/ planning, shipment order, shipment order search

http://localhost:8080/tms/wicket?module=oms&wicketpage=shipmentorder.ShipmentOrderListPage&emptySession=true
/ wordt:
http://localhost:8080/tms/wicket/?wicket:interface=:5::::

/ 7	. 

/ Meegeven wicket page	,

$ vi EntityActionGroupListPage.java

	@SuppressWarnings("serial")
	private EntityListActionBuilder<EntityActionGroup> getPanelAction() {
		Collection<EntityAction<EntityActionGroup>> actions = new ArrayList<EntityAction<EntityActionGroup>>();
		EntityActionButton<EntityActionGroup> editAction = new EntityActionButton<EntityActionGroup>("edit",
				new ResourceModel("edit").wrapOnAssignment(EntityActionGroupListPage.this)) {

			@Override
			protected void onSubmit(Button aButton, IModel<EntityActionGroup> aSelection) {
				setResponsePage(new EntityActionGroupEditPage(daoWrapper, Model.of(aSelection.getObject()), EntityActionGroupListPage.this));

$ vi EntityActionGroupEditPage.java
	add(new EntityActionGroupPanel("editPanel", anActionGroupModel, basePage, aShipmentOrderId) {

$ vi EntityActionGrouoPanel.java
		Button closePageButton = new Button("closePageButton") {

			@Override
			public void onSubmit() {
				if (page != null) {
					setResponsePage(page);
/ we keren terug	,

/ 7	. 

/ als we op een row op een edit button click om de shipment order te open	, waar click we dan op?

$ vi ShipmentOrderListPage.java
	@Override
	protected void createPageComponents() {
		myRowActions.add(new RowAction() {
			@Override
			public boolean execute(Object aObject) {
/ (*)
				getRequestCycle().setRequestTarget(
						new RedirectRequestTarget("../oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=" + aObject + "&systemId=" + aObject));
				return false;
			}

		});
		add(new QueryViewPanel("query", Model.of(myQuery), myRowActions, null));

4 vi QueryViewPanel.java

	private void addDataRows() {
		dataView = new ListView<List<Object>>("rows", new PropertyModel<List<List<Object>>>(QueryViewPanel.this, "rowsOnPage")) {
			...
							for (final RowAction myAction : rowActionList) {
								myActions.add(new RowActionPanel(myActions.newChildId(), myAction, aCell.getModelObject(), myAction.getCssClass(), myAction .getTitle()) {
									@Override
									protected void refresh(AjaxRequestTarget aTarget) {
										aTarget.addComponent(QueryViewPanel.this);
/ TODO

$ vi RowActionPanel.java

	public RowActionPanel(String aId, final RowAction anAction, final Object anObject, String cssClass, String aTitle) {
		...
		AjaxLink myLink = new AjaxLink("link") {
			@Override
			public void onClick(AjaxRequestTarget aTarget) {
				if (anAction.execute(anObject)) {
/ we komen bij (*)	, hierboven	,


/ 7	. 


$ vi ShipmentOrderListPage.java

		myRowActions.add(new RowAction() {
			@Override
			public boolean execute(Object aObject) {
				getRequestCycle().setRequestTarget(
						new RedirectRequestTarget("../oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=" + aObject + "&systemId=" + aObject));
				return false;
aObject	Integer  (id=19908)	
26879305

/ 7	. 

/ in rowaction.execute	,
?wicket:bookmarkablePage=:com.mpobjects.oms.view.wicket.shipmentorder.ShipmentOrderListPage&pageId=1

returnUrl	"?wicket:bookmarkablePage=:com.mpobjects.oms.view.wicket.shipmentorder.ShipmentOrderListPage" (id=23278)	
returnUrl2	null	
returnUrl3	"?wicket:bookmarkablePage=:com.mpobjects.oms.view.wicket.shipmentorder.ShipmentOrderListPage" (id=23278)	
?wicket:bookmarkablePage=:com.mpobjects.oms.view.wicket.shipmentorder.ShipmentOrderListPage

http://localhost:8080/tms/wicket?module=oms&wicketpage=shipmentorder.ShipmentOrderListPage&emptySession=true
http://localhost:8080/tms/wicket/?wicket:interface=:3::::
/ Dit gebeurt in BaseHomePage.doRedirect, calls redirectToInterceptPage	,

/ 7	. 

/ in rowaction.execute	,
				String returnUrl2 = getPage().urlFor(ShipmentOrderListPage.class, pageParameters).toString();
returnUrl2	"?wicket:bookmarkablePage=:com.mpobjects.oms.view.wicket.shipmentorder.ShipmentOrderListPage&returnUrl=?wicket:interface%3D:1::::" (id=17674)	
returnUrl	"?wicket:interface=:1::::" (id=17675)	


				String returnUrl = getRequestCycle().urlFor(ShipmentOrderListPage.this).toString();

http://localhost:8080/tms/oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=26716374&systemId=26716374&returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:5::::


SH000013410-20150608

/ Einde PNL-410

/ DEBUG PNL-410


$ vi shipment-order_edit.jsp

			<c:if test="${!formVO.lockedByProcess && formVO.orderStatusVO.code == '1450' && formVO.approvalStatus != 'APPROVED' && cf:property('oms', 'shipmentorder.approvalbtn.hidden', 'true')=='false'}">
				<input type="button" id="requestApproval" value="<mpo:label name="requestApproval"/>"
					onclick="theActiveFormManager.setRedirectUrl('../wicket?module=massupdate&amp;wicketpage=actiongroup.EntityActionGroupEditPage&amp;shipmentOrderSystemId=${formVO.systemId}');
						theActiveFormManager.submit(null,true,1);
						return false;" />
			</c:if>

/ we moeten een sho hebben die 1450 is (planned)	,
/ local, we openen sho SH000013410-20150608
/ we set in de 2de col 'Goedkeuring status' op 'OPEN'	, click Save	,
/ dan verschijnt het button 'Request Approval'	,
/ click	'Request Approval', we komen op wicket scherm	,
/ click Close	, we komen weer op edit sho jsp	, 
/ nu click op massupdate tab	, 
/ we zien hieronder nu een entry	,
/ click op edit button	, we komen op [Action Page] wicket page	,
/ click Close	, we komen weer op edit sho jsp	,

/ Kies sho SH000005102-20150608	, 
/ we set in de 2de col 'Goedkeuring status' op 'OPEN'	, click Save	,
/ dan verschijnt het button 'Request Approval'	,
/ click	'Request Approval', we komen op wicket scherm	,
/ click Close	, we komen weer op edit sho jsp	, 
/ nu click op massupdate tab	, 
/ we zien hieronder nu een entry	,
/ click op edit button	, we komen op [Action Page] wicket page	,
/ click Close	, we komen weer op edit sho jsp	,


/ 7	. 

/ locale nl_NL_pnlnl -> en	,

/ 7	. 

$ vi shipment-order_edit.jsp

<%@taglib prefix="mpo" uri="http://www.mp-objects.com/taglibs/mpo"%>
<%@taglib prefix="massupdatetags" tagdir="/WEB-INF/tags/massupdate/"%>

				<c:if test="${cf:property('oms', 'shipmentorder.massupdate.enabled', 'false')=='true'}">
					<mpo:tab name="massupdate">
						<massupdatetags:sho-massupdate-actions />
					</mpo:tab>
				</c:if>

/ mpo.tab gaat via de mpo.tld: daar staan de mappings , hier: tab-> TabTag.class
/ massupdatetags:sho-massupdate-actions gaat direct	, er is de sho-massupdate-actions.tag, dat is een .jsp	,  

 

/ Dit is de mapping file	,
$ vi mpo.tld
<taglib>
	<uri>http://www.mp-objects.com/taglibs/mpo</uri>
	<tag>
		<name>tab</name>
		<tagclass>com.mpobjects.view.taglib.tab.TabTag</tagclass>
		<bodycontent>JSP</bodycontent>
		<attribute>
			<name>name</name>
			<required>true</required>
			<rtexprvalue>true</rtexprvalue> 
		</attribute>
	</tag>

$ vi sho-massupdate-actions.tag
...
	<button 
		class="icon icon_edit small" 
		title="Edit" 
		onclick="
			theActiveFormManager.setRedirectUrl('../wicket?module=massupdate&amp;wicketpage=actiongroup.EntityActionGroupEditPage&amp;shipmentOrderSystemId=${formVO.systemId}&amp;actionGroupSystemId=${actionGroup.systemId}');
			theActiveFormManager.submit(null,true,1);return false;"></button>

/ we click de massupdate tab	, we zien een button	, we vallen in FormManager.
    this.submit = function(anAction, aBoolDoRedirect, aRedirectionLevelOffset) {
/ Hier wordt een ajax call gedaan	, 
/ Waar gaat hij heen	?
/ TODO

$ vi FormTag.java

	@Override
	public int doStartTag() throws JspTagException {

		// add the script
		myPrintString.append("<script type=\"text/javascript\">\n");
		myPrintString.append("var " + getJsFormManager() + "= new FormManager('" + theName + "');");
		myPrintString.append("var theActiveFormManager=" + getJsFormManager() + ";");
		myPrintString.append("document.theActiveFormManager=theActiveFormManager");
		...

	public String getJsFormManager() {
		return "the" + StringUtils.firstCharToUpper(theName) + "FormManager";
	}

/ we zien in devtools	,
http://localhost:8080/tms/oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=26879305&systemId=26879305
/ dus WH gewoon result shipment-order_edit.jsp	, 

	<iframe class="invisible" name="submitframe" id="submitframe" src="../blank.html"></iframe>
	<div id="formMessage" class="hideAfter">
		<input type="hidden" name="offset" value="seconds 3"/>
		<h3>Shipment order saved</h3>
	</div>
	<form class="jspForm" method="post" name="shipmentorder" id="shipmentorder" target="submitframe" action="shipment-order_save">
		<input type="hidden" name="continuationId" id="continuationId" value="1434551440873"/>
		<input type="hidden" name="flowDefinition" id="flowDefinition" value="reload" size="20"/>
		<script type="text/javascript">
			var theShipmentorderFormManager= new FormManager('shipmentorder');
			var theActiveFormManager=theShipmentorderFormManager;
			document.theActiveFormManager=theActiveFormManager
		</script>
		<input type="hidden" name="redirectTo" id="redirectTo" value="../core/back?levelOffset=-1"/>
		<input type="hidden" name="doRedirect" id="doRedirect"/>
		<input type="hidden" name="base_sessionLevelOffset" id="base_sessionLevelOffset" value="0" size="20"/>


/ click op button in massupdatepanel	,
/ we vallen in chrome devtools in class.formmanager.js	,

	<button 
		class="icon 
		icon_edit small" 
		title="Edit" 
		onclick="
			theActiveFormManager.setRedirectUrl('../wicket?module=massupdate&amp;wicketpage=actiongroup.EntityActionGroupEditPage&amp; shipmentOrderSystemId=26879305&amp;actionGroupSystemId=26879596');
			theActiveFormManager.submit(null,true,1);
			return false;"
	></button>
/s
    this.setRedirectUrl = function(anUrl) {
        document.getElementById("redirectTo").value=anUrl;

/ we zien in console van devtools	,
> document.getElementById("redirectTo")
<input type="hidden" name="redirectTo" id="redirectTo" value="../wicket?module=massupdate&wicketpage=actiongroup.EntityActionGroupEditPage&shipmentOrderSystemId=26879305&actionGroupSystemId=26879596">
    }

/ <200b> 's UTF-8 = e2  80  8b

/ geef cont	,
/t
/s
$ vi smartsave.js

		theActiveFormManager.submit = function(anAction, aBoolDoRedirect, aRedirectionLevelOffset) {
			smartSaveResetDirtyFlag();
->			return this._smartSaveSubmit(anAction, aBoolDoRedirect, aRedirectionLevelOffset);
/s
$ vi class.formmanager.js

45:    this.submit = function(anAction, aBoolDoRedirect, aRedirectionLevelOffset) {
/ anAction=null
/ aBoolDoRedirect=true
/ aRedirectionLevelOffset=1
        var myForm = document.getElementById(this.theFormName);
/ this.theFormName="shipmentorder"

myForm: form#shipmentorder.jspForm
0: input#continuationId
1: input#flowDefinition
2: input#redirectTo
3: input#doRedirect
4: input#base_sessionLevelOffset
5: input#base_windowToOpenUrl
...
54: input#CashOnDeliveryDone
55: input#incoTerm
56: input#incoTermVersion
57: input#incotermsReference
...
282: input#bookingServiceActionId
283: input#serverUnavailableMessage
284: input#processingFormMessage
285: input#deleteMessage

            myForm.submit();
/ TODO
       		ajaxRequest.sendRequest();

/ dan komen in 	,
$ vi class.formmanager.js

    this.submit = function(anAction, aBoolDoRedirect, aRedirectionLevelOffset) {
		if (mySubmit) {
           submitframe.onload = function() {
->            	submitframe.onload = null;

/ we geven continue	, 
/ TODO

/ we zien het wicket scherm, 
Entity Action Group Ecit Page	,

/ De close button is in het panel	,

$ vi EntityActionGroupPanel.java

		Button closePageButton = new Button("closePageButton") {

			@Override
			public void onSubmit() {
				if (page != null) {
					setResponsePage(page);
				} else if (shipmentOrderId != 0) {
					getRequestCycle().setRequestTarget(
							new RedirectRequestTarget("/oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=" + shipmentOrderId + "&systemId="
									+ shipmentOrderId));
				}
			}
		};
		closePageButton.setDefaultFormProcessing(false);
		form.add(closePageButton);

/ 7	.

/ Nu JSP -> Wicket	,

/ 13	. 

/ Waar zijn de 2 menu items config	? 
planning, shipment order, search
planning, shipment order, Shipment order search  

$ vi oms-menu.xml

<m:menu xmlns:m="http://www.mp-objects.com/schema/scs/menu">
	<m:add path="planning.shipmentOrder.search" screen-type="all" actionUrl="oms/shipment-order_list?refresh=false&amp;screenId=shipment-order" privilege="shipment-order.list" index="2041" />

$ vi pnloms-menu.xml

<m:menu xmlns:m="http://www.mp-objects.com/schema/scs/menu">
	<m:add path="planning.shipmentOrder.shipmentOrderSearch" privilege="shipment-order.list" actionUrl="wicket?module=oms&amp;wicketpage=shipmentorder.ShipmentOrderListPage" index="5002" />

/ 13	. 

$ vi ShipmentOrderListPage.java

		List<RowAction> myRowActions = new ArrayList<RowAction>();
		myRowActions.add(new RowAction() {

			@Override
			public boolean execute(Object aObject) {
				getRequestCycle().setRequestTarget(
						new RedirectRequestTarget("../oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=" + aObject + "&systemId=" + aObject));
				return false;
			}

		});

		add(new QueryViewPanel("query", Model.of(myQuery), myRowActions, null));

/ Hier staat dat als we op edit icon click in een row	, we gaan naar	,
		../oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=" + aObject + "&systemId=" + aObject

/ Intermezzo



/ Einde Intermezzo

/ 13	. 

/ de back button op de shipment-order_edit.jsp	,

		<div id="buttonSet">
			<mpo:button type="cancel" />

$ vi mpo.tld
	<tag>
		<name>button</name>
		<tagclass>com.mpobjects.view.taglib.form.ButtonTag</tagclass>
		...

$ vi ButtonTag.java

		} else if (readOnly) {
			if (TYPE_BACK.equals(getType()) || TYPE_CANCEL.equals(getType())) {
				myPrint.append("<input type=\"button\" ");
				myPrint.append(" id=\"backBtn\"");
				myPrint.append(" value=\"" + getLabel("back") + "\"");
				myPrint.append(" onclick=\" " + getForm().getJsFormManager() + ".goBack();\"");
				if (!myCanGoBack) {
					myPrint.append(" disabled=\"disabled\" ");
					myPrint.append(" title=\"" + myCanGoBackMessage + "\"");
				}
				myPrint.append("/>");
			}

/we zien in devtools	, 
<input type="button" id="backBtn" value="Back" onclick=" theShipmentorderFormManager.goBack();">

/ we click op Back	,

function FormManager(aFormName) {
   this.goBack = function() {
    	this.performRedirect("../core/back?levelOffset=-1");
    }
/s
    this.performRedirect = function(newUrl) {
    	 document.location.replace(newUrl);
     }
newUrl: "../core/back?levelOffset=-1"

$ vi core-sitemap.xmap
           <map:match pattern="back">
               <map:act type="redirectByFlow">
				    <map:parameter name="levelOffset" value="{request-param:levelOffset}"/>
				</map:act>
            </map:match>

$ vi generic-actions.xmap
<map:action name="redirectByFlow" src="com.mpobjects.control.action.RedirectByFlowAction"/>

/ we zijn op shipment-order_edit.jsp	, en click op Back	, 
 /we vallen in 	,
public class RedirectByFlowAction extends AbstractAction implements NonScreenAction {
	@Override
	public Map act() throws Exception {
		int myLevel = Math.abs(getParameters().getParameterAsInteger(LEVEL_OFFSET)) * -1;
-1
		int myTargetLevel = getRequestManager().getLevel() + myLevel;
1/2
		BaseRequest myRequest = getRequestManager().getRequestForLevel(myTargetLevel);
/s
RequestManager.getRequestForLevel(int) line: 193	
		List levelList = (List) getSession().getAttribute(SESSION_LIST);
[1434709433327, 1434709663015, 1434709717992, 1434710733840]
		String mykey = (String) levelList.get(aLevel);
mykey	"1434709717992" (id=21061)	
		return (BaseRequest) ((Map) getSession().getAttribute(SESSION_MAP)).get(mykey);

/ Intermezzo

"current.get()"	 <error(s)_during_the_evaluation>	
"getSession()"	 (id=20787)	
	theSessionCocoon	HttpSession  (id=20881)	
		wrappedSession	StandardSessionFacade  (id=20893)	
			session	StandardSession  (id=20895)	
				accessCount	2	
				attributes	Hashtable  (id=21009)	
					count	24	
					entrySet	Collections$SynchronizedSet  (id=21100)	
					hashSeed	0	
					keySet	Collections$SynchronizedSet  (id=21101)	
					loadFactor	0.75	
					modCount	42	
					table	Hashtable$Entry[47]  (id=21102)	
						[0]	Hashtable$Entry  (id=21109)	
							hash	-2072234110	
							key	"SPRING_SECURITY_CONTEXT" (id=21125)	
							next	null	
							value	ResourceSecurityContextImpl  (id=21126)	
						[6]	Hashtable$Entry  (id=21110)	
							hash	1426761287	
							key	"wicket:WicketServlet:session" (id=21186)	
							next	null	
							value	BaseWebSession  (id=21187)	
						[8]	Hashtable$Entry  (id=21111)	
							hash	-50621786	
							key	"1434709510665_form" (id=21212)	
							next	null	
							value	FormTag  (id=21213)	
						[10]	Hashtable$Entry  (id=21112)	
							hash	743190189	
							key	"FROM_SUBMIT_LISTENERS" (id=21368)	
							next	null	
							value	ArrayList  (id=21369)	
						[12]	Hashtable$Entry  (id=21113)	
							hash	-1097462182	
							key	"locale" (id=21372)	
							next	null	
							value	"en" (id=21373)	
						[13]	Hashtable$Entry  (id=21114)	
							hash	493388482	
							key	"active_shipment_order" (id=21374)	
							next	null	
							value	ShipmentOrderVO_$$_javassist_138  (id=21375)	
						[15]	Hashtable$Entry  (id=21178)	
							hash	230944667	
							key	"builder" (id=21915)	
							next	null	
							value	"jsp" (id=21916)	
						[17]	Hashtable$Entry  (id=21179)	
							hash	756684507	
							key	"productItemVO" (id=21917)	
							next	null	
							value	ProductItemVO  (id=21918)	
						[23]	Hashtable$Entry  (id=21180)	
							hash	-266692662	
							key	"userMenu" (id=23265)	
							next	Hashtable$Entry  (id=23266)	
							value	"<ul class="xMenu"><li><a href="#" onclick="return false;" class="rootMenu">Configuration</a><ul><li><a href="#" onclick="return false;" class="subMenu">Execution</a><ul><li title="file.list"><a href="../document/file-meta_list?refresh=true&amp;emptySession=true" class="menuItem">Files</a></li>\n<li><a href="#" onclick="return false;" class="subMenu">Triggers</a><ul><li title="trigger.list"><a href="../wicket?module=oms&amp;wicketpage=triggeraction.TriggerActionListPage&amp;emptySession=true" class="menuItem">Actions</a></li>\n<li title="serviceordertypetrigger.list"><a href="../wicket?module=oms&amp;wicketpage=serviceordertypetrigger.SotTriggerListPage&amp;emptySession=true" class="menuItem">Service order type trigger</a></li>\n<li title="shipmentordertrigger.list"><a href="../wicket?module=oms&amp;wicketpage=shipmentordertrigger.ShipmentOrderTriggerListPage&amp;emptySession=true" class="menuItem">Shipment order trigger</a></li>\n<li title="eventtrigger.list"><a href="../wicket?module=oms&amp;wicketpage=eventtrigger.EventTriggerListPage&amp;emptySession=true" class="menuItem">Event trigger</a></li>\n<li title="customerordertrigger.list"><a href="../wicket?module=oms&amp;wicketpage=customerordertrigger.CustomerOrderTriggerListPage&amp;emptySession=true" class="menuItem">Customer order trigger</a></li>\n<li title="interface-message-trigger.list"><a href="../wicket?module=oms&amp;wicketpage=interfacemessagetrigger.InterfaceMessageTriggerListPage&amp;emptySession=true" class="menuItem">Interface message trigger</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="subMenu">Events</a><ul><li title="event-template.list"><a href="../wicket?module=event&amp;wicketpage=eventtemplate.EventTemplatePage&amp;emptySession=true" class="menuItem">Event templates</a></li>\n<li title="event-type.list"><a href="../wicket?module=event&amp;wicketpage=eventtype.EventTypePage&amp;emptySession=true" class="menuItem">Event types</a></li>\n<li title="event-action.list"><a href="../wicket?module=event&amp;wicketpage=eventaction.EventActionPage&amp;emptySession=true" class="menuItem">Event actions</a></li>\n<li title="event-custom-query.list"><a href="../wicket?module=event&amp;wicketpage=eventcustomquery.EventCustomQueryPage&amp;emptySession=true" class="menuItem">Event custom queries</a></li>\n</ul></li>\n<li title="instruction.list"><a href="../wicket?module=oms&amp;wicketpage=instructioncode.InstructionCodePage&amp;emptySession=true" class="menuItem">Instruction code</a></li>\n<li title="instructioncode.list"><a href="../wicket?module=oms&amp;wicketpage=instructiongroup.InstructionGroupPage&amp;emptySession=true" class="menuItem">Instruction groups</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="subMenu">Permission</a><ul><li title="permission-group.list"><a href="../wicket?module=oms&amp;wicketpage=permission.PermissionGroupPage&amp;emptySession=true" class="menuItem">Group</a></li>\n<li title="permission-rule.list"><a href="../wicket?module=oms&amp;wicketpage=permission.PermissionRulePage&amp;emptySession=true" class="menuItem">Rule</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="subMenu">Resources</a><ul><li title="capacitytype.edit"><a href="../wicket/?module=capabletopromise&amp;wicketpage=capacitytype.CapacityTypePage&amp;emptySession=true" class="menuItem">Capacity type</a></li>\n<li title="resourcetype.edit"><a href="../wicket/?module=capabletopromise&amp;wicketpage=resourcetype.ResourceTypeListPage&amp;emptySession=true" class="menuItem">Resource type</a></li>\n<li title="ctp-resource.list"><a href="../wicket/?module=capabletopromise&amp;wicketpage=resource.ResourcePage&amp;emptySession=true" class="menuItem">Resource</a></li>\n<li title="resourcegroup.edit"><a href="../wicket/?module=capabletopromise&amp;wicketpage=resourcegroup.ResourceGroupListPage&amp;emptySession=true" class="menuItem">Resource group</a></li>\n<li title="capacityprofile.edit"><a href="../wicket/?module=capabletopromise&amp;wicketpage=capacityprofile.CapacityProfilePage&amp;emptySession=true" class="menuItem">Capacity profile</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="subMenu">Planning</a><ul><li title="unit-translation.list"><a href="../wicket?module=oms&amp;wicketpage=unittranslation.UnitTranslationPage&amp;emptySession=true" class="menuItem">Unit translation</a></li>\n<li title="party.list"><a href="../oms/party-type_preselect_list?emptySession=true" class="menuItem">Parties</a></li>\n<li title="party-type.list"><a href="../wicket?module=oms&amp;wicketpage=partytype.PartyTypePage&amp;emptySession=true" class="menuItem">Party types</a></li>\n<li title="party-type-group.list"><a href="../wicket?module=oms&amp;wicketpage=partytypegroup.PartyTypeGroupPage&amp;emptySession=true" class="menuItem">Party type groups</a></li>\n<li title="party-group.list"><a href="../wicket?module=oms&amp;wicketpage=partygroup.PartyGroupPage&amp;emptySession=true" class="menuItem">Party groups</a></li>\n<li title="preferred-party-translation.list"><a href="../wicket?module=oms&amp;wicketpage=preferedpartytranslation.PreferedPartyTranslationPage&amp;emptySession=true" class="menuItem">Prefered party translations</a></li>\n<li><a href="#" onclick="return false;" class="subMenu">Shipment Order</a><ul><li title="shipment-order-template.list"><a href="../oms/shipment-order-template_list?refresh=true&amp;emptySession=true" class="menuItem">All templates</a></li>\n<li title="entitygroup.list"><a href="../wicket?module=oms&amp;wicketpage=entitygroup.EntityGroupListPage&amp;emptySession=true" class="menuItem">Template group</a></li>\n<li title="user-entitygroup.list"><a href="../wicket?module=oms&amp;wicketpage=entitygroup.UserEntityGroupListPage&amp;emptySession=true" class="menuItem">User template</a></li>\n</ul></li>\n<li title="shipment-order-template-import.edit"><a href="../wicket/?module=oms&amp;wicketpage=exportimport.ShipmentOrderTemplateImportPage&amp;emptySession=true" class="menuItem">Ship ordr templates import</a></li>\n<li title="service-order-template.list"><a href="../oms/service-order-template_list?refresh=true&amp;emptySession=true" class="menuItem">Service order templates</a></li>\n<li title="service-action-type.list"><a href="../wicket?module=oms&amp;wicketpage=serviceactiontype.ServiceActionTypePage&amp;emptySession=true" class="menuItem">Service action types</a></li>\n<li title="criterium-type.list"><a href="../wicket/?module=oms&amp;wicketpage=criteriumtype.CriteriumTypePage&amp;emptySession=true" class="menuItem">Criterium types</a></li>\n<li title="service-action-template.list"><a href="../oms/service_action_template_list?emptySession=true" class="menuItem">Service action templates</a></li>\n<li title="path-template.list"><a href="../oms/path_template_list?emptySession=true" class="menuItem">Path templates</a></li>\n<li title="path-template.list"><a href="../wicket/?module=oms&amp;wicketpage=exportimport.PathTemplateImportPage&amp;emptySession=true" class="menuItem">Path templates import</a></li>\n<li title="order-process.list"><a href="../wicket/?module=oms&amp;wicketpage=orderprocess.OrderProcessPage&amp;emptySession=true" class="menuItem">Order process</a></li>\n<li title="optimize-carrier-info.update"><a href="../wicket/?module=optimize&amp;wicketpage=configuration.CarrierInfoPage&amp;emptySession=true" class="menuItem">Carrier info</a></li>\n<li title="nonsimultaneousplanningcriterion.list"><a href="../wicket?module=oms&amp;wicketpage=nonsimultaneousplanningcriterion.NonSimultaneousPlanningCriterionPage&amp;emptySession=true" class="menuItem">Nonsimultaneous planning</a></li>\n<li title="shipmentitem-entry-screen.list"><a href="../wicket?module=oms&amp;wicketpage=shipitementry.ShipmentItemEntryScreenListPage&amp;emptySession=true" class="menuItem">Shipment item entry</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="subMenu">Administration</a><ul><li title="user.list"><a href="../wicket?module=oms&amp;wicketpage=user.ResourcePage&amp;emptySession=true" class="menuItem">Admin users</a></li>\n<li title="organization.list"><a href="../wicket?module=oms&amp;wicketpage=organisationmasterdata.OrganizationPage&amp;emptySession=true" class="menuItem">Organization</a></li>\n<li title="role.list"><a href="../wicket?module=oms&amp;wicketpage=role.RolePage&amp;emptySession=true" class="menuItem">Role</a></li>\n<li title="role.list"><a href="../wicket?module=oms&amp;wicketpage=exportimport.RoleImportPage&amp;emptySession=true" class="menuItem">Role import</a></li>\n<li title="privilege.list"><a href="../wicket?module=oms&amp;wicketpage=privilege.PrivilegeEditPage&amp;emptySession=true" class="menuItem">Privilege</a></li>\n<li title="business-object.list"><a href="../wicket?module=oms&amp;wicketpage=businessobject.BusinessObjectPage&amp;emptySession=true" class="menuItem">Business object</a></li>\n<li title="privilege-type.list"><a href="../wicket?module=oms&amp;wicketpage=privilegetype.PrivilegeTypePage&amp;emptySession=true" class="menuItem">Privilege type</a></li>\n<li title="property-login.edit"><a href="../wicket?module=oms&amp;wicketpage=propertyeditor.PropertyEditorPage&amp;propertyfile=login&amp;emptySession=true" class="menuItem">User management properties</a></li>\n<li title="range.list"><a href="../wicket?module=oms&amp;wicketpage=range.RangePage&amp;emptySession=true" class="menuItem">Range</a></li>\n<li title="welcome-banner.update"><a href="../wicket?module=oms&amp;wicketpage=welcomebanner.WelcomeBannerPage&amp;emptySession=true" class="menuItem">Welcome banner</a></li>\n<li title="properties.list"><a href="../wicket?module=oms&amp;wicketpage=property.PropertyPage&amp;emptySession=true" class="menuItem">Properties</a></li>\n<li title="properties-value.list"><a href="../wicket?module=oms&amp;wicketpage=propertiesvalue.PropertiesValuePage&amp;emptySession=true" class="menuItem">Properties values</a></li>\n<li title="cron-job-line.list"><a href="../wicket?module=oms&amp;wicketpage=cronjoblines.CronJobLinesPage&amp;emptySession=true" class="menuItem">Scheduled tasks</a></li>\n<li title="dashboardquery.list"><a href="../wicket?module=oms&amp;wicketpage=dashboardqueries.DashboardQueryPage&amp;emptySession=true" class="menuItem">Dashboard queries</a></li>\n<li title="expression-test.view"><a href="../wicket?module=oms&amp;wicketpage=expressiontest.ExpressionTestPage&amp;emptySession=true" class="menuItem">Expression tester</a></li>\n<li title="emailnot.edit"><a href="../wicket?module=emailnot&amp;wicketpage=configuration.ConfigurationPage&amp;emptySession=true" class="menuItem">Prenotification config</a></li>\n<li title="user-party.list"><a href="../wicket?module=oms&amp;wicketpage=userparty.UserPartyListPage&amp;emptySession=true" class="menuItem">User party</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="subMenu">Finance</a><ul><li><a href="#" onclick="return false;" class="subMenu">Service management</a><ul><li title="rate-agreement.list"><a href="../ratecalc/rate_agreement_list?emptySession=true" class="menuItem">Service agreements(admin)</a></li>\n<li title="rate-agreement.create"><a href="../wicket/?module=ratecalc&amp;wicketpage=rateagreement.RateAgreementCopyPage&amp;emptySession=true" class="menuItem">Copy service agreement</a></li>\n<li title="rate-agreement-user.list"><a href="../wicket/?module=ratecalc&amp;wicketpage=rateagreement.RateAgreementListPage&amp;emptySession=true" class="menuItem">Service agreements(user)</a></li>\n<li title="rate-agreement.list"><a href="../wicket?module=ratecalc&amp;wicketpage=exportimport.RateAgreementImportPage&amp;emptySession=true" class="menuItem">Service agreements import</a></li>\n<li title="shared-rate-table-report.view"><a href="../ratecalc/report_shared_ratetable_input?emptySession=true" class="menuItem">Shared table report</a></li>\n<li title="unit.list"><a href="../wicket?module=ratecalc&amp;wicketpage=unit.UnitPage&amp;emptySession=true" class="menuItem">Units</a></li>\n<li title="unitconversion.list"><a href="../wicket?module=ratecalc&amp;wicketpage=unitconversion.UnitConversionListPage&amp;emptySession=true" class="menuItem">Unit conversions</a></li>\n<li title="orderdetail.list"><a href="../wicket?module=ratecalc&amp;wicketpage=orderdetail.OrderDetailListPage&amp;emptySession=true" class="menuItem">Order details</a></li>\n</ul></li>\n<li title="rate-component-type.list"><a href="../wicket/?module=oms&amp;wicketpage=ratecomponenttype.RateComponentTypePage&amp;emptySession=true" class="menuItem">Price and cost types</a></li>\n<li title="financial-party.list"><a href="../invoice/financial-party_list?refresh=true&amp;emptySession=true" class="menuItem">Financial party</a></li>\n<li title="vat-number.list"><a href="../wicket?module=invoice&amp;wicketpage=vatnumber.VatNumberPage&amp;emptySession=true" class="menuItem">Vat number</a></li>\n<li title="customerinvoiceheaderstatus.edit"><a href="../wicket/?module=customerinvoice&amp;wicketpage=CustomerInvoiceHeaderStatusEditPage&amp;emptySession=true" class="menuItem">Header status</a></li>\n<li title="vat-policy.list"><a href="../wicket/?module=invoice&amp;wicketpage=vatpolicy.VatPolicyPage&amp;emptySession=true" class="menuItem">Vat policy</a></li>\n<li title="price-type-translation.list"><a href="../wicket/?module=invoice&amp;wicketpage=financialparty.pricetype.FinancialPartyListPage&amp;emptySession=true" class="menuItem">Price type translation</a></li>\n<li title="cost-type-translation.list"><a href="../wicket/?module=invoice&amp;wicketpage=financialparty.costtype.FinancialPartyListPage&amp;emptySession=true" class="menuItem">Cost type translation</a></li>\n<li title="invoicetemplate.list"><a href="../wicket?module=invoice&amp;wicketpage=template.InvoiceTemplatePage&amp;emptySession=true" class="menuItem">Invoice templates</a></li>\n<li title="invoicetemplate.list"><a href="../wicket?module=invoice&amp;wicketpage=template.mapping.InvoiceTemplateMappingsPage&amp;emptySession=true" class="menuItem">Invoice templates mappings</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="subMenu">Report</a><ul><li title="report.list"><a href="../wicket?module=oms&amp;wicketpage=report.ReportListPage&amp;emptySession=true" class="menuItem">Reports</a></li>\n<li title="report.list"><a href="../wicket?module=oms&amp;wicketpage=report.exportimport.ReportImportPage&amp;emptySession=true" class="menuItem">Import report</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="subMenu">Inventory</a><ul><li title="location-type.list"><a href="../wicket?module=inventory&amp;wicketpage=stocklocationtype.StockLocationTypePage&amp;emptySession=true" class="menuItem">Location type</a></li>\n<li title="location.list"><a href="../wicket?module=inventory&amp;wicketpage=stocklocation.StockLocationPage&amp;emptySession=true" class="menuItem">Location</a></li>\n<li title="location.list"><a href="../wicket?module=inventory&amp;wicketpage=stockkeepingunit.StockKeepingUnitPage&amp;emptySession=true" class="menuItem">Stock keeping unit</a></li>\n<li title="grid-template.list"><a href="../wicket?module=inventory&amp;wicketpage=gridtemplate.GridTemplatePage&amp;emptySession=true" class="menuItem">Grid templates</a></li>\n<li title="consolidation-rule.list"><a href="../wicket?module=inventory&amp;wicketpage=consolidation.ConsolidationRulePage&amp;emptySession=true" class="menuItem">Consolidation rules</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="subMenu">Master data</a><ul class="columnPosition"><li title="inco-term.list"><a href="../wicket?module=oms&amp;wicketpage=incoterm.IncoTermPage&amp;emptySession=true" class="menuItem">Inco terms</a></li>\n<li title="shipping-unit.list"><a href="../wicket?module=oms&amp;wicketpage=shippingunit.ShippingUnitPage&amp;emptySession=true" class="menuItem">Shipping units</a></li>\n<li title="service-level.list"><a href="../wicket?module=oms&amp;wicketpage=shipmentservicelevel.ShipmentServiceLevelPage&amp;emptySession=true" class="menuItem">Service levels</a></li>\n<li title="document-type.list"><a href="../wicket?module=oms&amp;wicketpage=documenttype.DocumentTypePage&amp;emptySession=true" class="menuItem">Document types</a></li>\n<li title="planning-reason-code.list"><a href="../wicket?module=oms&amp;wicketpage=planningreasoncode.PlanningReasonCodePage&amp;emptySession=true" class="menuItem">Planning reason codes</a></li>\n<li title="airport.list"><a href="../wicket?module=oms&amp;wicketpage=airport.AirportPage&amp;emptySession=true" class="menuItem">Airports</a></li>\n<li title="inco-term-ref-trans.list"><a href="../wicket?module=oms&amp;wicketpage=incotermreftrans.IncoTermRefTransPage&amp;emptySession=true" class="menuItem">Inco term ref trans</a></li>\n<li title="schedule.list"><a href="../wicket?module=oms&amp;wicketpage=schedule.SchedulePage&amp;emptySession=true" class="menuItem">Cut off schedules</a></li>\n<li title="shipment-type.list"><a href="../wicket?module=oms&amp;wicketpage=shipmenttype.ShipmentTypePage&amp;emptySession=true" class="menuItem">Shipment types</a></li>\n<li title="reason-code.list"><a href="../wicket?module=oms&amp;wicketpage=reasoncode.ReasonCodePage&amp;emptySession=true" class="menuItem">Reason codes</a></li>\n<li title="service-type.list"><a href="../wicket/?module=oms&amp;wicketpage=servicetype.ServiceTypePage&amp;emptySession=true" class="menuItem">Service types</a></li>\n<li title="service-order-type.list"><a href="../wicket?module=oms&amp;wicketpage=serviceordertype.ServiceOrderTypePage&amp;emptySession=true" class="menuItem">Service order types</a></li>\n<li title="status.list"><a href="../wicket?module=oms&amp;wicketpage=goodsstatus.GoodsStatusPage&amp;emptySession=true" class="menuItem">Goods statuses</a></li>\n<li title="hold-status.list"><a href="../wicket?module=oms&amp;wicketpage=holdstatus.HoldStatusPage&amp;emptySession=true" class="menuItem">Hold statuses</a></li>\n<li title="country.list"><a href="../wicket?module=oms&amp;wicketpage=country.CountryPage&amp;emptySession=true" class="menuItem">Countries</a></li>\n<li title="country.list"><a href="../wicket?module=oms&amp;wicketpage=countrygroup.CountryGroupPage&amp;emptySession=true" class="menuItem">Country groups</a></li>\n<li title="currency.list"><a href="../wicket/?module=oms&amp;wicketpage=currency.CurrencyPage&amp;emptySession=true" class="menuItem">Currencies</a></li>\n<li title="adrcode.list"><a href="../wicket/?module=oms&amp;wicketpage=adrcode.AdrCodePage&amp;emptySession=true" class="menuItem">Adr codes</a></li>\n<li title="timewindow.list"><a href="../wicket?module=oms&amp;wicketpage=timewindow.TimeWindowPage&amp;emptySession=true" class="menuItem">Time window</a></li>\n<li title="unnumber.list"><a href="../wicket/?module=oms&amp;wicketpage=unnumber.UnNumberPage&amp;emptySession=true" class="menuItem">Un numbers</a></li>\n<li title="inducer-code.list"><a href="../wicket?module=oms&amp;wicketpage=inducercode.InducerCodePage&amp;emptySession=true" class="menuItem">Inducer code</a></li>\n<li title="inducer-type.list"><a href="../wicket?module=oms&amp;wicketpage=inducertype.InducerTypePage&amp;emptySession=true" class="menuItem">Inducer type</a></li>\n<li title="ordervalidation-rule.list"><a href="../wicket?module=oms&amp;wicketpage=ordervalidationrule.OrderValidationRulePage&amp;emptySession=true" class="menuItem">Order validation rule</a></li>\n<li title="entity-detail-type.list"><a href="../wicket?module=oms&amp;wicketpage=entitydetailtype.EntityDetailTypePage&amp;emptySession=true" class="menuItem">Entity detail types</a></li>\n<li title="entity-detail-type-group.list"><a href="../wicket?module=oms&amp;wicketpage=entitydetailtypegroup.EntityDetailTypeGroupPage&amp;emptySession=true" class="menuItem">Entity detail type group</a></li>\n<li title="adndangerousgoods.list"><a href="../wicket?module=oms&amp;wicketpage=adndangerousgoods.AdnDangerousGoodsPage&amp;emptySession=true" class="menuItem">A d n dangerous goods</a></li>\n<li title="time-zone.list"><a href="../oms/timezone_list?refresh=true&amp;emptySession=true" class="menuItem">Time zone</a></li>\n<li title="addressvalidationexclusion.enable"><a href="../wicket/?module=oms&amp;wicketpage=addressvalidationexclusion.AddressValidationExclusionPage&amp;emptySession=true" class="menuItem">Address validation excl</a></li>\n<li title="container-type.enable"><a href="../wicket?module=oms&amp;wicketpage=containertype.ContainerTypePage&amp;emptySession=true" class="menuItem">Container type</a></li>\n<li title="office-of-exit.list"><a href="../wicket?module=oms&amp;wicketpage=officeofexit.OfficeOfExitPage&amp;emptySession=true" class="menuItem">Office of exit</a></li>\n<li title="entitydetailvalueset.list"><a href="../wicket/?module=oms&amp;wicketpage=entitydetail.EntityDetailValueSetTypeListPage&amp;emptySession=true" class="menuItem">Entity detail value set</a></li>\n<li title="product.list"><a href="../wicket?module=oms&amp;wicketpage=product.ProductPage&amp;emptySession=true" class="menuItem">Products</a></li>\n<li title="schedule.list"><a href="../wicket?module=oms&amp;wicketpage=calendar.ScheduleListPage&amp;emptySession=true" class="menuItem">Schedules</a></li>\n<li title="alert-messaging.list"><a href="../wicket?module=oms&amp;wicketpage=messagereport.MessagePage&amp;emptySession=true" class="menuItem">Messages</a></li>\n<li title="customer-order-type.list"><a href="../wicket?module=oms&amp;wicketpage=customerordertype.CustomerOrderTypePage&amp;emptySession=true" class="menuItem">Customer order type</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="subMenu">Authorization</a><ul><li title="authorization.list"><a href="../wicket?module=authorization&amp;wicketpage=authorizationlevel.AuthorizationLevelListPage&amp;emptySession=true" class="menuItem">Authorization level</a></li>\n<li title="authorization.list"><a href="../wicket?module=authorization&amp;wicketpage=authorizationcode.AuthorizationCodeListPage&amp;emptySession=true" class="menuItem">Authorization code</a></li>\n<li title="authorization.list"><a href="../wicket?module=authorization&amp;wicketpage=userauthorization.ResourceAuthorizationListPage&amp;emptySession=true" class="menuItem">User authorization</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="subMenu">[my massupdate]</a><ul><li title="massupdate.list"><a href="../wicket?module=massupdate&amp;wicketpage=actiontype.EntityActionTypeListPage&amp;emptySession=true" class="menuItem">[entity_action_types]</a></li>\n<li title="massupdate.template-list"><a href="../wicket?module=massupdate&amp;wicketpage=actiongrouptemplate.EntityActionGroupTemplateListPage&amp;emptySession=true" class="menuItem">[entity_action_group_templates]</a></li>\n</ul></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="rootMenu">Planning</a><ul><li title="dashboard.view"><a href="../oms/dashboard_view?screen=default&amp;emptySession=true" class="menuItem">Planning dashboard</a></li>\n<li><a href="#" onclick="return false;" class="subMenu">Resources</a><ul><li title="resource.list"><a href="../wicket/?module=capabletopromise&amp;wicketpage=operations.ResourceListPage&amp;emptySession=true" class="menuItem">Resource dashboard</a></li>\n<li title="resource.plan"><a href="../wicket/?module=capabletopromise&amp;wicketpage=operations.resourcetype.ResourceTypeScheduleListPage&amp;emptySession=true" class="menuItem">Schedule resources</a></li>\n</ul></li>\n<li title="rating-request.view"><a href="../wicket/?module=optimize&amp;wicketpage=RatingRequestPage&amp;emptySession=true" class="menuItem">Quotation request</a></li>\n<li><a href="#" onclick="return false;" class="subMenu">Shipment Order</a><ul><li title="shipment-order.list"><a href="../oms/shipment-order_list?refresh=false&amp;screenId=shipment-order&amp;emptySession=true" class="menuItem">Search</a></li>\n<li title="shipment-order-fast.create"><a href="../oms/shipment-order-template_list?refresh=false&amp;emptySession=true" class="menuItem">Create</a></li>\n<li title="shipment-order.list"><a href="../oms/shipment-item_list?refresh=false&amp;screenId=shipment-order&amp;emptySession=true" class="menuItem">Search by item</a></li>\n<li title="shipment-order.list"><a href="../oms/product-item_list?refresh=false&amp;screenId=shipment-order&amp;emptySession=true" class="menuItem">Search by product</a></li>\n<li title="arrival-item-entry.list"><a href="../wicket?module=oms&amp;wicketpage=shipmentorder.itementry.ArrivalItemEntryListPage&amp;emptySession=true" class="menuItem">Arrival item entry</a></li>\n<li title="arrival-item-entry-scan.list"><a href="../wicket?module=oms&amp;wicketpage=shipmentorder.itementry.ArrivalItemEntryScanPage&amp;emptySession=true" class="menuItem">Arrival item entry scan</a></li>\n<li title="departure-item-entry.list"><a href="../wicket?module=oms&amp;wicketpage=shipmentorder.itementry.DepartureItemEntryListPage&amp;emptySession=true" class="menuItem">Departure item entry</a></li>\n<li title="user-shipment-order-template.list"><a href="../wicket?module=oms&amp;wicketpage=entitygroup.UserShipmentOrderListPage&amp;emptySession=true" class="menuItem">[Fast create]</a></li>\n<li title="shipment-order.list"><a href="../wicket?module=oms&amp;wicketpage=shipmentorder.ShipmentOrderListPage&amp;emptySession=true" class="menuItem">Shipment order search</a></li>\n<li title="mass-update-shipment-order.edit"><a href="../wicket?module=massupdate&amp;wicketpage=shipmentorder.ShipmentOrderMassUpdatePage&amp;emptySession=true" class="menuItem">[mass_update]</a></li>\n<li title="mass-update-dashboard.list"><a href="../wicket?module=massupdate&amp;wicketpage=actiongroup.EntityActionGroupListPage&amp;emptySession=true" class="menuItem">[mass_update_dashboard]</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="subMenu">Service Order</a><ul><li title="service-order.list"><a href="../oms/service-order_list?refresh=false&amp;emptySession=true" class="menuItem">Search</a></li>\n<li title="service-order.create"><a href="../oms/service-order-template_list?refresh=true&amp;emptySession=true" class="menuItem">Create</a></li>\n<li title="serviceorder-fast.create"><a href="../wicket?module=oms&amp;wicketpage=serviceorder.fastcreate.ServiceOrderFastPage&amp;emptySession=true" class="menuItem">[Fast create]</a></li>\n</ul></li>\n<li title="container.enable"><a href="../wicket?module=oms&amp;wicketpage=container.ContainerPage&amp;emptySession=true" class="menuItem">Container</a></li>\n<li title="inbound-shipment-order.list"><a href="../wicket?module=oms&amp;wicketpage=shipmentorder.InboundShipmentOrderListPage&amp;emptySession=true" class="menuItem">Shipment order inbound</a></li>\n<li><a href="#" onclick="return false;" class="subMenu">Inventory</a><ul><li title="inventory.list"><a href="../wicket?module=inventory&amp;wicketpage=visibility.StockKeepingUnitListPage&amp;emptySession=true" class="menuItem">Visibility by sku</a></li>\n<li title="inventory.list"><a href="../wicket?module=inventory&amp;wicketpage=replenishment.ReplenishmentDashboard&amp;emptySession=true" class="menuItem">Replenishment dashboard</a></li>\n<li title="stock-transaction.list"><a href="../wicket?module=inventory&amp;wicketpage=stocktransaction.StockTransactionListPage&amp;emptySession=true" class="menuItem">Stock transaction</a></li>\n<li title="inventory.list"><a href="../wicket?module=inventory&amp;wicketpage=stockcount.StockCountListPage&amp;emptySession=true" class="menuItem">Stock count</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="subMenu">Customer order</a><ul><li title="customer-order.list"><a href="../wicket?module=oms&amp;wicketpage=customerorder.CustomerOrderPage&amp;emptySession=true" class="menuItem">Search</a></li>\n<li title="customer-order-line.list"><a href="../wicket?module=oms&amp;wicketpage=customerorderline.CustomerOrderLineSearchPage&amp;emptySession=true" class="menuItem">Search by line</a></li>\n</ul></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="rootMenu">Execution</a><ul><li title="label.print"><a href="../omscarcon/print-label_applet?emptySession=true" class="menuItem">Print labels</a></li>\n<li title="order-dashboard.view"><a href="../oms/order-dashboard_view?emptySession=true" class="menuItem">Execution dashboard</a></li>\n<li title="event.list"><a href="../wicket?module=event&amp;wicketpage=event.EventDashboardPage&amp;emptySession=true" class="menuItem">Events dashboard</a></li>\n<li title="deferred-event-dashboard.list"><a href="../wicket?module=event&amp;wicketpage=deferredevent.DeferredEventDashboardPage&amp;emptySession=true" class="menuItem">Deferred events dashboard</a></li>\n<li><a href="#" onclick="return false;" class="subMenu">Status update</a><ul><li title="service-order.set-ended"><a href="../wicket?module=invoice&amp;wicketpage=invoiceline.PodNeverRegistrationPage&amp;emptySession=true" class="menuItem">Status pod never</a></li>\n<li title="service-order.set-started"><a href="../oms/service-order_list-status-update_shipped?emptySession=true" class="menuItem">Status shipped</a></li>\n<li title="service-order.set-ended"><a href="../oms/service-order_list-status-update_delivered?emptySession=true" class="menuItem">Status delivered</a></li>\n<li title="service-order.set-ended"><a href="../oms/consignment_list_status_update?refresh=false&amp;emptySession=true" class="menuItem">Consignment</a></li>\n<li title="service-order.set-closed"><a href="../oms/service-order_close-in-batch-form?emptySession=true" class="menuItem">Close in batch</a></li>\n<li title="service-order.batch-release"><a href="../wicket?module=oms&amp;wicketpage=serviceorder.ServiceOrderReleasePage&amp;emptySession=true" class="menuItem">Release in batch</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="subMenu">Track and trace</a><ul><li title="shipment-order.track-trace"><a href="../tracking/shipment-order_list-track?refresh=false&amp;emptySession=true" class="menuItem">Shipment Order</a></li>\n<li title="shipment-order.track-trace"><a href="../tracking/shipment-item_list-track?refresh=false&amp;emptySession=true" class="menuItem">Parcels</a></li>\n</ul></li>\n<li title="monitoring-dashboard.list"><a href="../wicket?module=oms&amp;wicketpage=dashboard.MonitoringDashboardListPage&amp;emptySession=true" class="menuItem">Process monitor</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="rootMenu">Report</a><ul><li><a href="#" onclick="return false;" class="subMenu">Events</a><ul><li title="event.report"><a href="../event/report_received_events_by_shipment_order_input?emptySession=true" class="menuItem">Shipment order events</a></li>\n<li title="event.report"><a href="../event/report_last_received_event_by_shipment_order_input?emptySession=true" class="menuItem">Last shipment order events</a></li>\n</ul></li>\n<li title="ceva-report.list"><a href="../oms/report_service_order_dashboard_input?emptySession=true" class="menuItem">Service order dashboard</a></li>\n<li title="report-postnl.list"><a href="../wicket?module=oms&amp;wicketpage=report.ReportInputFormPage&amp;reportSystemId=26680272&amp;screentype=SCS&amp;emptySession=true" class="menuItem">Shipment order  screen</a></li>\n<li title="report.list"><a href="../wicket?module=oms&amp;wicketpage=report.ReportInputFormPage&amp;reportSystemId=26876467&amp;screentype=SCS&amp;emptySession=true" class="menuItem">Shipmentorder extract</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="rootMenu">Finance</a><ul><li class="menu-header"><span>Cost</span></li>\n<li><a href="#" onclick="return false;" class="subMenu menuHeaderChild">Cost overview</a><ul><li title="invoice-recharge.report"><a href="../invoice/report_estimated_cost_report_input?emptySession=true" class="menuItem">Estimated cost report</a></li>\n<li title="rca-service-order-cost.report"><a href="../oms/report_service_order_cost_input?emptySession=true" class="menuItem">Service order cost</a></li>\n<li title="invoice-recharge.report"><a href="../invoice/report_actual_cost_report_input?emptySession=true" class="menuItem">Actual cost report</a></li>\n<li title="ceva-report.list"><a href="../invoice/report_invoices_sent_to_jde_input?emptySession=true" class="menuItem">Invoices sent to jde</a></li>\n</ul></li>\n<li title="rca-service-order-cost.recalculate"><a href="../wicket/?module=ratecalc&amp;wicketpage=batchrecalc.ServiceOrderBatchRecalc&amp;emptySession=true" class="menuItem menuHeaderChild">Service order recalc</a></li>\n<li><a href="#" onclick="return false;" class="subMenu menuHeaderChild">Carrier invoice</a><ul><li title="invoice.list"><a href="../wicket/?module=invoice&amp;wicketpage=dashboard.InvoiceDashboardPage&amp;emptySession=true" class="menuItem">Dashboard</a></li>\n<li title="invoice.create"><a href="../invoice/invoice-header_create?base_sessionLevelOffset=1&amp;emptySession=true" class="menuItem">Create</a></li>\n<li title="invoice.list"><a href="../invoice/invoice-header_list?refresh=false&amp;emptySession=true" class="menuItem">Search</a></li>\n<li title="invoice.list"><a href="../invoice/invoice-line_all-list?refresh=false&amp;emptySession=true" class="menuItem">Line search</a></li>\n<li title="invoice.approve"><a href="../invoice/invoice-header-batch-approve_list?refresh=false&amp;emptySession=true" class="menuItem">Approve</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="subMenu menuHeaderChild">Match</a><ul><li title="invoice.match"><a href="../invoice/invoice-match_edit?refresh=true&amp;base_sessionLevelOffset=0&amp;emptySession=true" class="menuItem">Start</a></li>\n<li title="invoice.list"><a href="../invoice/invoice-header-mismatch_list?refresh=true&amp;screenId=invoice-header-mismatch-list&amp;emptySession=true" class="menuItem">Mismatch</a></li>\n<li title="invoice.report"><a href="../invoice/report_mismatch_report_input?emptySession=true" class="menuItem">Mismatch report</a></li>\n<li title="invoice.report"><a href="../invoice/report_mismatch_details_report_input?emptySession=true" class="menuItem">Mismatch details report</a></li>\n<li title="invoice.report"><a href="../invoice/report_pod_report_input?emptySession=true" class="menuItem">Pod report</a></li>\n<li title="invoice-match-status.list"><a href="../wicket?module=invoice&amp;wicketpage=invoicematchstatus.InvoiceMatchStatusPage&amp;emptySession=true" class="menuItem">Status</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="subMenu menuHeaderChild">Recharge</a><ul><li title="invoice-recharge.create"><a href="../invoice/recharge-batch_init?refresh=true&amp;emptySession=true" class="menuItem">Create recharge batch</a></li>\n<li title="invoice-recharge.report"><a href="../invoice/report_recharge_report_input?emptySession=true" class="menuItem">Recharge report</a></li>\n<li title="invoice-recharge.report"><a href="../invoice/report_recharge_summary_report_input?emptySession=true" class="menuItem">Recharge summary report</a></li>\n<li title="invoice-recharge.report"><a href="../invoice/report_recharge_overall_report_input?emptySession=true" class="menuItem">Recharge overall report</a></li>\n</ul></li>\n<li class="menu-separator"><span>&nbsp;</span></li>\n<li class="menu-header"><span>Revenue</span></li>\n<li><a href="#" onclick="return false;" class="subMenu menuHeaderChild">Customer invoice</a><ul><li title="customerinvoiceheader.edit"><a href="../wicket/?module=customerinvoice&amp;wicketpage=GenerateInvoices&amp;emptySession=true" class="menuItem">Generate invoices</a></li>\n<li title="customerinvoiceheader.list"><a href="../wicket/?module=customerinvoice&amp;wicketpage=header.CIHListPage&amp;emptySession=true" class="menuItem">Search invoice</a></li>\n<li title="customerinvoiceheader.list"><a href="../wicket/?module=customerinvoice&amp;wicketpage=header.CIHApproveListPage&amp;emptySession=true" class="menuItem">Approve invoices</a></li>\n<li title="customerinvoiceheader.list"><a href="../wicket/?module=customerinvoice&amp;wicketpage=header.CIHFinalizeListPage&amp;emptySession=true" class="menuItem">Finalize invoices</a></li>\n</ul></li>\n<li title="shipment-order-price.recalculate"><a href="../wicket/?module=ratecalc&amp;wicketpage=batchrecalc.ShipmentOrderBatchRecalc&amp;emptySession=true" class="menuItem menuHeaderChild">Shipment order recalc</a></li>\n<li title="invoice.report"><a href="../oms/report_shipment_order_price_input?emptySession=true" class="menuItem menuHeaderChild">Shipment order price</a></li>\n<li title="invoice.report"><a href="../oms/report_shipment_order_margin_input?emptySession=true" class="menuItem menuHeaderChild">Shipment order margin</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="rootMenu">Support</a><ul><li><a href=".././?emptySession=true" target="_top" class="menuItem">Welcome</a></li>\n<li title="profile.edit"><a href="../wicket?module=oms&amp;wicketpage=user.EditProfilePage&amp;emptySession=true" class="menuItem">Edit profile</a></li>\n<li><a href="../oms/about?emptySession=true" class="menuItem">About</a></li>\n<li title="release-notes.view"><a href="../wicket?module=oms&amp;wicketpage=releasenotes.ViewReleaseNotesPage&amp;emptySession=true" class="menuItem">Release notes</a></li>\n<li title="manual.view"><a href="../wicket?module=oms&amp;wicketpage=manual.ViewManualPage&amp;emptySession=true" class="menuItem">System manual</a></li>\n<li><a href="#" onclick="return false;" class="subMenu">System</a><ul><li><a href="#" onclick="return false;" class="subMenu">Usage</a><ul><li title="ceva-report.list"><a href="../oms/report_role_privilege_input?emptySession=true" class="menuItem">Role privilege</a></li>\n<li title="active-user-report.list"><a href="../oms/report_active_users_input?emptySession=true" class="menuItem">Active users</a></li>\n<li title="system-report.list"><a href="../oms/report_chargeable_users_input?emptySession=true" class="menuItem">Chargeable users</a></li>\n<li title="system-report.list"><a href="../oms/report_chargeable_users_by_org_input?emptySession=true" class="menuItem">Chargeable users by org</a></li>\n<li title="system-report.list"><a href="../oms/report_chargeable_transactions_input?emptySession=true" class="menuItem">Chargeable transactions</a></li>\n<li title="system-report.list"><a href="../oms/report_chargeable_transactions_by_org_input?emptySession=true" class="menuItem">Chargeable trans by org</a></li>\n</ul></li>\n<li title="release-notes.update"><a href="../wicket?module=oms&amp;wicketpage=releasenotes.ReleaseNotesPage&amp;emptySession=true" class="menuItem">Edit release notes</a></li>\n<li title="manual.update"><a href="../wicket?module=oms&amp;wicketpage=manual.ManualPage&amp;emptySession=true" class="menuItem">Edit system manual</a></li>\n<li title="jms-message.entry"><a href="../interfacing/jms-message_entry?emptySession=true" class="menuItem">Jms message entry</a></li>\n<li title="jms-directory-processor.entry"><a href="../interfacing/jms-directory-processor_entry?emptySession=true" class="menuItem">Jms directory processor</a></li>\n<li title="message.reprocess"><a href="../wicket/?module=interfacing&amp;wicketpage=process.ReprocessPage&amp;emptySession=true" class="menuItem">Message reprocess</a></li>\n<li title="application.config-reload"><a href="../core/config-reload?emptySession=true" class="menuItem">Reload config</a></li>\n</ul></li>\n<li><a href="#" onclick="return false;" class="subMenu">Performance</a><ul><li title="application.list"><a href="../wicket?module=performance&amp;wicketpage=general.PerformanceMeasurementPage&amp;emptySession=true" class="menuItem">General</a></li>\n<li title="application.list"><a href="../wicket?module=performance&amp;wicketpage=methodlist.PerformanceMeasurementMethodListPage&amp;emptySession=true" class="menuItem">Method list</a></li>\n<li title="application.list"><a href="../wicket?module=performance&amp;wicketpage=callhierarchy.PerformanceMeasurementCallTreePage&amp;emptySession=true" class="menuItem">Call tree</a></li>\n</ul></li>\n</ul></li>\n<li><a href="../authentication/logout?emptySession=true" target="_top" class="rootMenu">Logout</a></li>\n</ul>" (id=23267)	
						[24]	Hashtable$Entry  (id=21181)	
							hash	-807460890	
							key	"base_sessionList" (id=20814)	
							next	null	
							value	ArrayList  (id=21029)	
						[28]	Hashtable$Entry  (id=21182)	
							hash	-962520654	
							key	"1434709718168_form" (id=23275)	
							next	Hashtable$Entry  (id=23276)	
							value	FormTag  (id=23277)	
						[32]	Hashtable$Entry  (id=21183)	
							hash	738399548	
							key	"base_sessionLevel" (id=23280)	
							next	null	
							value	"3" (id=23281)	
						[33]	Hashtable$Entry  (id=21184)	
							hash	-1134285110	
							key	"Wicket:SessionUnbindingListener-WicketServlet" (id=23283)	
							next	null	
							value	AbstractHttpSessionStore$SessionBindingListener  (id=23284)	
						[34]	Hashtable$Entry  (id=21185)	
							hash	-1761206030	
							key	"1434710734018_form" (id=23286)	
							next	Hashtable$Entry  (id=23287)	
							value	FormTag  (id=23288)	
						[40]	Hashtable$Entry  (id=22087)	
							hash	-857330412	
							key	"base_sessionMap" (id=21065)	
							next	null	
							value	HashMap  (id=23290)	
								entrySet	HashMap$EntrySet  (id=26958)	
								hashSeed	0	
								keySet	null	
								loadFactor	0.75	
								modCount	30	
								size	4	
								table	HashMap$Entry[16]  (id=26961)	
									[3]	HashMap$Entry  (id=26964)	
										hash	-2117897725	
										key	"1434710733840" (id=26969)	
										next	null	
										value	BaseRequest  (id=26970)	
											params	HashMap  (id=26982)	
											requestId	"1434710733840" (id=26969)	
											url	"../oms/shipment-order_edit" (id=26983)	
									[4]	HashMap$Entry  (id=26965)	
										hash	-229983500	
->										key	"1434709717992" (id=21061)	
										next	HashMap$Entry  (id=27019)	
											hash	-180119212	
											key	"1434709663015" (id=27036)	
											next	null	
											value	BaseRequest  (id=27037)	
												params	HashMap  (id=27039)	
												requestId	"1434709663015" (id=27036)	
												url	"../core/opening_page" (id=27040)	
										value	BaseRequest  (id=27020)	
											params	HashMap  (id=27022)	
											requestId	"1434709717992" (id=21061)	
											url	"../oms/shipment-order_edit" (id=27034)	
									[9]	HashMap$Entry  (id=26966)	
										hash	-102723383	
										key	"1434709433327" (id=27042)	
										next	null	
										value	BaseRequest  (id=27043)	
											params	HashMap  (id=27045)	
											requestId	"1434709433327" (id=27042)	
											url	"../core/opening_page" (id=27047)	
								threshold	12	
								values	null	
						[41]	Hashtable$Entry  (id=23269)	
							hash	-1822197171	
							key	"myShipmentOrderView" (id=23292)	
							next	null	
							value	ShipmentOrderView  (id=23293)	
						[43]	Hashtable$Entry  (id=23271)	
							hash	-341064690	
							key	"resource" (id=23331)	
							next	null	
							value	ResourceView  (id=23332)	
					threshold	35	
					values	null	
				authType	null	
				containerEventMethod	Method  (id=21010)	
				creationTime	1434709035724	
				expiring	false	
				facade	StandardSessionFacade  (id=20893)	
				id	"1llua8yc8hq0d14hmf8vs3f621" (id=21011)	
				isNew	false	
				isValid	true	
				lastAccessedTime	1434710735448	
				listeners	ArrayList  (id=21012)	
				manager	StandardManager  (id=21013)	
				maxInactiveInterval	1800	
				notes	Hashtable  (id=21026)	
				principal	null	
				support	PropertyChangeSupport  (id=21027)	
				thisAccessedTime	1434710755124	
	theSessionHttp	null	
Add new expression	

/ Einde Intermezzo

/ Onze key is	,
mykey	"1434709717992" (id=21061) ->	url	"../core/opening_page" (id=27040)	

/t
RedirectByFlowAction.act() line: 20	
		BaseRequest myRequest = getRequestManager().getRequestForLevel(myTargetLevel);
/d
myRequest	BaseRequest  (id=27020)	
	params	HashMap  (id=27022)	
{systemid=26716374, base_sessionLevelOffset=1, systemId=26716374}
	requestId	"1434709717992" (id=21061)	
	url	"../oms/shipment-order_edit" (id=27034)	
/ TODO (systemId=26716374

		getRequestManager().setLevel(myTargetLevel);
0
		Map<String, String> myParams = myRequest.getParams();
{}
		myParams.put(RequestManager.SESSION_LEVEL_OFFSET, "0");
		String myRequestUrl = getRequestUrl(myRequest.getUrl(), myParams);
../core/opening_page?base_sessionLevelOffset=0
		RedirectSaveAction.redirect(getRedirector(), getRequest(), myRequestUrl);
		return EMPTY_MAP;

/ 13	. 

/ Na back op sho	, we komen in	
../core/opening_page?base_sessionLevelOffset=0

/ en we komen in	,
OpeningPageAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
/s
RequestManager.<init>(Session, Request, boolean) line: 97	
		this(new SessionAdaptor(aSession), new RequestAdaptor(aRequest), isFlowControlEnabled);
/s
RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 109	
		setSession(aSession);
/ this.session=aSession;
		setRequest(aRequest);

		if (getSession().getAttribute(SESSION_MAP) != null) {
			mySessionMap = (Map<String, BaseRequest>) getSession().getAttribute(SESSION_MAP);
		if (getSession().getAttribute(SESSION_LIST) != null) {
			mySessionList = (ArrayList<String>) getSession().getAttribute(SESSION_LIST);
		if (getSession().getAttribute(SESSION_LEVEL) != null) {
			setLevel(Math.max(0, Integer.parseInt((String) getSession().getAttribute(SESSION_LEVEL))));

/ in de session	,
						[24]	Hashtable$Entry  (id=21181)	
							hash	-807460890	
							key	"base_sessionList" (id=20814)	
							next	null	
							value	ArrayList  (id=21029)	
[1434710733840,1434709717992,1434709433327]
						[32]	Hashtable$Entry  (id=21183)	
							hash	738399548	
							key	"base_sessionLevel" (id=23280)	
							next	null	
							value	"3" (id=23281)	
						[40]	Hashtable$Entry  (id=22087)	
							hash	-857330412	
							key	"base_sessionMap" (id=21065)	
							next	null	
							value	HashMap  (id=23290)	
								entrySet	HashMap$EntrySet  (id=26958)	
								hashSeed	0	
								keySet	null	
								loadFactor	0.75	
								modCount	30	
								size	4	
								table	HashMap$Entry[16]  (id=26961)	
									[3]	HashMap$Entry  (id=26964)	
										hash	-2117897725	
										key	"1434710733840" (id=26969)	
										next	null	
										value	BaseRequest  (id=26970)	
											params	HashMap  (id=26982)	
											requestId	"1434710733840" (id=26969)	
											url	"../oms/shipment-order_edit" (id=26983)	
									[4]	HashMap$Entry  (id=26965)	
										hash	-229983500	
->										key	"1434709717992" (id=21061)	
										next	HashMap$Entry  (id=27019)	
											hash	-180119212	
											key	"1434709663015" (id=27036)	
											next	null	
											value	BaseRequest  (id=27037)	
												params	HashMap  (id=27039)	
												requestId	"1434709663015" (id=27036)	
												url	"../core/opening_page" (id=27040)	
										value	BaseRequest  (id=27020)	
											params	HashMap  (id=27022)	
											requestId	"1434709717992" (id=21061)	
											url	"../oms/shipment-order_edit" (id=27034)	
									[9]	HashMap$Entry  (id=26966)	
										hash	-102723383	
										key	"1434709433327" (id=27042)	
										next	null	
										value	BaseRequest  (id=27043)	
											params	HashMap  (id=27045)	
											requestId	"1434709433327" (id=27042)	
											url	"../core/opening_page" (id=27047)	
								threshold	12	
								values	null	
						[41]	Hashtable$Entry  (id=23269)	
							hash	-1822197171	
							key	"myShipmentOrderView" (id=23292)	
							next	null	
							value	ShipmentOrderView  (id=23293)	
						[43]	Hashtable$Entry  (id=23271)	
							hash	-341064690	
							key	"resource" (id=23331)	
							next	null	
							value	ResourceView  (id=23332)	
					threshold	35	
					values	null	
				authType	null	
				containerEventMethod	Method  (id=21010)	
				creationTime	1434709035724	
				expiring	false	
				facade	StandardSessionFacade  (id=20893)	
				id	"1llua8yc8hq0d14hmf8vs3f621" (id=21011)	
				isNew	false	
				isValid	true	

		if (isFlowControlEnabled) {
			BaseRequest myRequest = new BaseRequest(aRequest);
/s
BaseRequest.<init>(RequestAdaptor) line: 35	
		setUrl(EntityActionUtil.getRelativeUrl(aRequest));
/s
EntityActionUtil.getRelativeUrl(RequestAdaptor) line: 105	
		String myRet = "";
		String myUrlParts[] = aRequest.getRequestURI().split("/");
[, tms, core, opening_page]
		String myCurrentEntityAction = myUrlParts[myUrlParts.length - 1];
opening_page
		String myCurrentModule = myUrlParts[myUrlParts.length - 2];
core
		myRet = "../" + myCurrentModule + "/" + myCurrentEntityAction;
../core/opening_page
		return myRet;
/t
	public BaseRequest(RequestAdaptor aRequest) {
		setUrl(EntityActionUtil.getRelativeUrl(aRequest));
/d
		setParams(new HashMap<String, String>());
/s
	public BaseRequest(RequestAdaptor aRequest) {
		for (Enumeration myEnum = aRequest.getParameterNames(); myEnum.hasMoreElements();) {
			myParameter = (String) myEnum.nextElement();
base_sessionLevelOffset
			addParameter(myParameter, aRequest.getParameter(myParameter));
0
/ dus	,
base_sessionLevelOffset: 0
/ volgende	,
randomizingurl: 1434720559443

		setRequestId("" + new java.util.Date().getTime());
/t
RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 138	

		if (getSession().getAttribute(SESSION_LEVEL) != null) {
			setLevel(Math.max(0, Integer.parseInt((String) getSession().getAttribute(SESSION_LEVEL))));

		if (isFlowControlEnabled) {
			BaseRequest myRequest = new BaseRequest(aRequest);
/d
			int myLevelOffset = parseLevel(getRequest().getParameter(SESSION_LEVEL_OFFSET));
/ SESSION_LEVEL_OFFSET="base_sessionLevelOffset":0
0
			setLevel(Math.max(0, getLevel() + myLevelOffset));
/ getLevel() komt uit de session	, myLevelOffset komt uit de url, base_sessionLevelOffset	, 

			mySessionMap.put(myRequest.getRequestId(), myRequest);

/ TODO

/ 7	. 

/ we beginnen opnieuw	, in de rij op het wicket scherm : planning, shipment order, Shipment order search	,

/ we edit een sho	,
ShipmentOrderEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
/s
RequestManager.<init>(Session, Request, boolean) line: 97	
		this(new SessionAdaptor(aSession), new RequestAdaptor(aRequest), isFlowControlEnabled);
/s
RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 108	
key	"base_sessionMap" (id=20901)	
	table	HashMap$Entry[16]  (id=22580)	
		[13]	HashMap$Entry  (id=22581)	
			key	"1434724925456" (id=22582)	
			value	BaseRequest  (id=22583)	
				url	"../core/opening_page" (id=22585)	
next	Hashtable$Entry  (id=22682)	
	key	"base_sessionList" (id=20942)	
	value	ArrayList  (id=22893)	
		elementData	Object[10]  (id=22895)	
			[0]	"1434724925456" (id=22582)	
next	Hashtable$Entry  (id=22675)	
	key	"base_sessionLevel" (id=21119)	
	value	"0" (id=22980)	

	if (getSession().getAttribute(SESSION_LEVEL) != null) {
			setLevel(Math.max(0, Integer.parseInt((String) getSession().getAttribute(SESSION_LEVEL))));
0
		if (isFlowControlEnabled) {
			BaseRequest myRequest = new BaseRequest(aRequest);
			int myLevelOffset = parseLevel(getRequest().getParameter(SESSION_LEVEL_OFFSET));
1
/ Klopt	, 
/ In ShipmentOrderListPage.java
		myRowActions.add(new RowAction() {
			@Override
			public boolean execute(Object aObject) {
				getRequestCycle().setRequestTarget(
						new RedirectRequestTarget("../oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=" + aObject + "&systemId=" + aObject));
/ Het staat er dus gewoon	,

			setLevel(Math.max(0, getLevel() + myLevelOffset));
1
			mySessionMap.put(myRequest.getRequestId(), myRequest);
{1434726094915=com.mpobjects.control.action.BaseRequest@569dba8e, 1434724925456=com.mpobjects.control.action.BaseRequest@7beb6b0e}
/ WAS {1434726094915=com.mpobjects.control.action.BaseRequest@569dba8e}	,
			try {
				mySessionList.add(getLevel(), myRequest.getRequestId());
[1434724925456, 1434726094915]
/ De index in deze list is dus de level	,

		getRequest().setAttribute("requestManager", this);

/ t
ShipmentOrderEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	
this	ShipmentOrderEditAction  (id=22488)	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
/d
/s
	protected void setRequestManager(RequestManager aRequestManager) {
		theRequestManager = aRequestManager;

/ MAANDAG	,
/ edit sho vantuit wicket screen	,
	public final Map act(Redirector aRedirector, SourceResolver aSourceResolver, Map anObjectModel, String aSource, Parameters aParameterList) throws Exception {





/ 7	. 

/ we beginnen opnieuw	,

/ we login	,

/ we zijn dan in het form	,
<form id="loginForm" action="../j_spring_security_check" method="post">
	...
/form>

$ vi core-sitemap.xml
           <map:match pattern="index_frameset">
				<map:act type="setLocale"/>
				<map:act type="generateMenu">
					<map:parameter name="cssClass" value="xMenu"/>
					<map:parameter name="sessionAttribute" value="userMenu"/>
					<map:parameter name="urlPrefix" value="../"/>
				</map:act>				
                <map:generate type="jsp" src="jsp/index_frameset.jsp"/>
                <map:serialize type="html"/>
            </map:match>

$ vi generic-actions.xmap
<map:action name="setLocale" src="com.mpobjects.control.action.SetLocaleAction"/>
<map:action name="generateMenu" src="com.mpobjects.control.action.MenuGenerateAction"/>

$ vi index_frameset.jsp

<frameset rows="0, *" frameborder="NO" border="0" framespacing="0">
	<frame src="menu" id="menu_frame" name="menu_frame" noresize="noresize" scrolling="auto" />
	<!-- also modify class.screencontainer.js when modifying name="main_frame" -->
	<frame src="opening_page" name="main_frame" scrolling="none" />
</frameset>
<noframes>

/ "opening_page" zien we in core-sitemap.xmap

/ we komen in de 1ste Cocoon action	,

Daemon Thread [http-0.0.0.0-8080-7] (Suspended)	
	RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 156	
	RequestManager.<init>(Session, Request, boolean) line: 97	
	SetLocaleAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	

/ we zien een SecurityContextHolderAwareRequestWrapper request	,


SetLocaleAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));

this	RequestManager  (id=21324)	
aRequest	RequestAdaptor  (id=21326)	
	theRequestCocoon	HttpRequest  (id=21346)	
		req	SecurityContextHolderAwareRequestWrapper  (id=21350)	
			request	RequestWrapper  (id=21351)	
				request	RequestFacade  (id=4033)	
				stripPaths	false	
				strippedPathInfo	"/core/index_frameset" (id=21352)	
				strippedServletPath	"" (id=4036)	


/s
		this(new SessionAdaptor(aSession), new RequestAdaptor(aRequest), isFlowControlEnabled);
/s
RequestManager.<init>(Session, Request, boolean) line: 97	

		if (getSession().getAttribute(SESSION_LEVEL) != null) {
/ SESSION_LEVEL="base_sessionLevel"
/ NEE
		} else {
			setLevel(0);


		if (isFlowControlEnabled) {
			BaseRequest myRequest = new BaseRequest(aRequest);
aRequest	RequestAdaptor  (id=19822)	
	theRequestCocoon	HttpRequest  (id=19830)	
		req	SecurityContextHolderAwareRequestWrapper  (id=19832)	
		reqURI	"/tms/core/index_frameset" (id=19861)	
/s
	public BaseRequest(RequestAdaptor aRequest) {
		setUrl(EntityActionUtil.getRelativeUrl(aRequest));
		...
		setRequestId("" + new java.util.Date().getTime());
/t
RequestManager.<init>(Session, Request, boolean) line: 97	
		if (isFlowControlEnabled) {
			BaseRequest myRequest = new BaseRequest(aRequest);
/d
myRequest	BaseRequest  (id=19834)	
	params	HashMap  (id=19896)	
{}
	requestId	"1434962441887" (id=19897)	
	url	"../core/index_frameset" (id=19898)	

			int myLevelOffset = parseLevel(getRequest().getParameter(SESSION_LEVEL_OFFSET));
/ SESSION_LEVEL_OFFSET="base_sessionLevelOffset"	,

/ Dus SESSION_LEVEL zit in de session, SESSION_LEVEL_OFFSET in de request	,

			setLevel(Math.max(0, getLevel() + myLevelOffset));
/ Tel de offset bij de level op	,
/s
RequestManager.
	public void setLevel(int aLevel) {
		getSession().setAttribute(SESSION_LEVEL, "" + aLevel);
		level = aLevel;

			mySessionMap.put(myRequest.getRequestId(), myRequest);
			try {
				mySessionList.add(getLevel(), myRequest.getRequestId());
[1434960728237]
/ je moet ze samen use	,
		getRequest().setAttribute("requestManager", this);

myRequest	BaseRequest  (id=4181)	
	params	HashMap  (id=19386)	
	requestId	"1434960728237" (id=19387)	
	url	"../core/index_frameset" (id=19388)	
/ Deze onthoud je	, als zijnde de gedane request	,

/ 7	. 

$ vi core-sitemap.xmap

			<map:match pattern="opening_page">
				<map:act type="openingPage">
					<map:redirect-to uri="welcome"/>
				</map:act>
			</map:match>            

$ vi generic-actions.xmap
<map:action name="openingPage" src="com.mpobjects.control.action.OpeningPageAction"/>

		<map:match pattern="welcome">
				<map:generate type="jsp" src="jsp/welcome.jsp"/>
				<map:serialize type="html"/>
			</map:match>            
/ Deze heeft GEEN act zoals opening_page	,, alleen een jsp	,




Daemon Thread [http-0.0.0.0-8080-8] (Suspended (entry into method <init> in RequestManager))	
	RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 108	
	RequestManager.<init>(Session, Request, boolean) line: 97	
	OpeningPageAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	

aSession	SessionAdaptor  (id=21414)	
	theSessionCocoon	HttpSession  (id=21328)	
		wrappedSession	StandardSessionFacade  (id=21329)	
			session	StandardSession  (id=21330)	
				attributes	Hashtable  (id=21331)	
					count	7	
					table	Hashtable$Entry[11]  (id=21338)	
						[9]	Hashtable$Entry  (id=21341)	
							key	"base_sessionMap" (id=20111)	
							value	HashMap  (id=21348)	
								table	HashMap$Entry[16]  (id=21427)	
									[7]	HashMap$Entry  (id=21428)	
										key	"1434967208203" (id=21429)	
										value	BaseRequest  (id=21372)	
											params	HashMap  (id=21441)	
											requestId	"1434967208203" (id=21429)	
											url	"../core/index_frameset" (id=21442)	

/ alles is er al	,
		if (getSession().getAttribute(SESSION_MAP) != null) {
			mySessionMap = (Map<String, BaseRequest>) getSession().getAttribute(SESSION_MAP);
		if (getSession().getAttribute(SESSION_LIST) != null) {
			mySessionList = (ArrayList<String>) getSession().getAttribute(SESSION_LIST);
		if (getSession().getAttribute(SESSION_LEVEL) != null) {
			setLevel(Math.max(0, Integer.parseInt((String) getSession().getAttribute(SESSION_LEVEL))));

		if (isFlowControlEnabled) {
			BaseRequest myRequest = new BaseRequest(aRequest);
/ om te onthouden	,
url	"../core/opening_page" (id=21699)	

			int myLevelOffset = parseLevel(getRequest().getParameter(SESSION_LEVEL_OFFSET));
0
			setLevel(Math.max(0, getLevel() + myLevelOffset));
0

			for (int i = getLevel(); i < mySessionList.size();) {
/ level blijft 0	, dus vervang	,
				myRequestId = mySessionList.get(i);
				mySessionList.remove(i);
				mySessionMap.remove(myRequestId);
/ ../core/index_frameset gaat eraf	,

			mySessionMap.put(myRequest.getRequestId(), myRequest);
				mySessionList.add(getLevel(), myRequest.getRequestId());

/ 7	. 

/ er volgen een groot aantal 

$ vi event-sitemap.xmap 

		<map:match pattern="event_status">
				<map:act type="eventStatus"/>
				<map:read type="jsp" src="jsp/event-status.jsp"/>
			</map:match>

           <map:action name="eventStatus" logger="event" src="com.mpobjects.event.event.control.EventStatusAction"/>

$ vi EventStatusAction.java
public class EventStatusAction extends AbstractAction implements NonScreenAction {

 
Daemon Thread [http-0.0.0.0-8080-6] (Suspended (entry into method <init> in RequestManager))	
	RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 108	
	RequestManager.<init>(Session, Request, boolean) line: 97	
	EventStatusAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	
/s
	public RequestManager(SessionAdaptor aSession, RequestAdaptor aRequest, boolean isFlowControlEnabled) {
/ isFlowControlEnabled==false	, want implements NonScreenAction 	,
		setSession(aSession);
		setRequest(aRequest);

		if (getSession().getAttribute(SESSION_MAP) != null) {
			mySessionMap = (Map<String, BaseRequest>) getSession().getAttribute(SESSION_MAP);
		if (getSession().getAttribute(SESSION_LIST) != null) {
			mySessionList = (ArrayList<String>) getSession().getAttribute(SESSION_LIST);
		if (getSession().getAttribute(SESSION_LEVEL) != null) {
			setLevel(Math.max(0, Integer.parseInt((String) getSession().getAttribute(SESSION_LEVEL))));

		if (isFlowControlEnabled) {
/ NEE
/ dus de base_sessionMap	, base_sessionList wordt niet veranderd	,

/ 7	. 

/ we geven planning, shipment order, search	,

$ vi oms-sitemap.xmap

			<map:match pattern="shipment-order_list">
				<map:act type="shipmentOrderList"/>			
				<map:call resource="dynatablePage">
					<map:parameter name="xsp" value="xsp/shipment-order_list.xml"/>
				</map:call>
			</map:match>

/ shiment-order_list.xml
/ TODO

/ Maar we zien in HTML	,
<a class="action" href="../oms/shipment-order_edit?base_sessionLevelOffset=1&amp;systemid=26879305&amp;systemId=26879305">
	<img src="../lookandfeel/styles/images/icons/check24.png" border="0" alt="Edit" title="Edit">
</a>

/ dus we zien base_sessionLevelOffset=1	,


/s
ShipmentOrderListAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
/s
		this(new SessionAdaptor(aSession), new RequestAdaptor(aRequest), isFlowControlEnabled);
/s
RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 108	
		setSession(aSession);

this	RequestManager  (id=20191)	
aSession	SessionAdaptor  (id=20192)	
	theSessionCocoon	HttpSession  (id=20226)	
		wrappedSession	StandardSessionFacade  (id=20236)	
			session	StandardSession  (id=20237)	
				attributes	Hashtable  (id=20239)	
					table	Hashtable$Entry[23]  (id=20247)	
						[1]	Hashtable$Entry  (id=20248)	
							next	Hashtable$Entry  (id=20457)	
								key	"base_sessionList" (id=19828)	
								value	ArrayList  (id=20469)	
									elementData	Object[10]  (id=20471)	
										[0]	"1434964385341" (id=20281)	
						[4]	Hashtable$Entry  (id=20250)	
							key	"base_sessionLevel" (id=19077)	
							value	"0" (id=20452)	
						[22]	Hashtable$Entry  (id=20255)	
							key	"base_sessionMap" (id=20111)	
							value	HashMap  (id=20263)	
								table	HashMap$Entry[16]  (id=20276)	
									[13]	HashMap$Entry  (id=20279)	
										key	"1434964385341" (id=20281)	
										value	BaseRequest  (id=20282)	
											params	HashMap  (id=20284)	
											requestId	"1434964385341" (id=20281)	
											url	"../core/opening_page" (id=20285)	

/ TODO

aRequest	RequestAdaptor  (id=20193)	
	theRequestCocoon	HttpRequest  (id=20227)	
		req	SecurityContextHolderAwareRequestWrapper  (id=20643)	
			request	RequestWrapper  (id=20646)	
				request	RequestFacade  (id=20647)	
				stripPaths	false	
				strippedPathInfo	"/oms/shipment-order_list" (id=20648)	
				strippedServletPath	"" (id=4036)	
		reqURI	null	
	theRequestHttp	null	

		if (isFlowControlEnabled) {
			BaseRequest myRequest = new BaseRequest(aRequest);

aRequest	RequestAdaptor  (id=20193)	
	theRequestCocoon	HttpRequest  (id=20227)	
		req	SecurityContextHolderAwareRequestWrapper  (id=20643)	
		reqURI	"/tms/oms/shipment-order_list" (id=20812)	

		int myLevelOffset = parseLevel(getRequest().getParameter(SESSION_LEVEL_OFFSET));
0
		setLevel(Math.max(0, getLevel() + myLevelOffset));
0
			String myRequestId;
			for (int i = getLevel(); i < mySessionList.size();) {
				myRequestId = mySessionList.get(i);
				mySessionList.remove(i);
				mySessionMap.remove(myRequestId);
url	"../core/opening_page" (id=20285)	
/ Deze gaat eraf	,

			mySessionMap.put(myRequest.getRequestId(), myRequest);

/ 7	. 

/ Hierna	, 

Daemon Thread [http-0.0.0.0-8080-3] (Suspended (entry into method <init> in RequestManager))	
	RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 108	
	RequestManager.<init>(Session, Request, boolean) line: 97	
	ApplicationMessageAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	

$ vi core-start-sitemap.xmap

		<map:handle-errors>
			<map:act type="applicationMessage"/>
			<map:act type="setAttributes">
				<map:parameter name="attributesType" value="request"/>
				<map:parameter name="valuesAreKeysFrom" value="environment"/>
				<map:parameter name="environmentType" value="TMS_SERVER_TYPE"/>
			</map:act>

/ Dus er is een ERR	,
/ Maar hij toont gewoon de shipment order list	, 

ApplicationMessageAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	
...
/s
RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 137	

/ uiteindelijk	,

this	RequestManager  (id=22751)	
aSession	SessionAdaptor  (id=22752)	
	theSessionCocoon	HttpSession  (id=21328)	
		wrappedSession	StandardSessionFacade  (id=21329)	
			session	StandardSession  (id=21330)	
				attributes	Hashtable  (id=21331)	
					table	Hashtable$Entry[23]  (id=21923)	
						[22]	Hashtable$Entry  (id=21341)	
							key	"base_sessionMap" (id=20111)	
							value	HashMap  (id=21348)	
								table	HashMap$Entry[16]  (id=21427)	
									[9]	HashMap$Entry  (id=22772)	
										hash	-851880679	
										key	"1434973861613" (id=22773)	
										next	null	
										value	BaseRequest  (id=22774)	
											params	HashMap  (id=22776)	
											requestId	"1434973861613" (id=22773)	
											url	"../images/ui-bg_highlight-soft_100_eeeeee_1x100.png" (id=22777)	

/ dus 

/ 7	.

/ we click op edit op een shipment order	,

Daemon Thread [http-0.0.0.0-8080-10] (Suspended (entry into method <init> in RequestManager))	
	RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 108	
	RequestManager.<init>(Session, Request, boolean) line: 97	
	ShipmentOrderEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	

/ Want we zagen in HTML	,
<a class="action" href="../oms/shipment-order_edit?base_sessionLevelOffset=1&amp;systemid=26879305&amp;systemId=26879305">

/ en	,

$ vi oms-sitemap.xmap
		<map:match pattern="shipment-order_edit">
				<map:act type="shipmentOrderEdit">
					<map:select type="session-attribute">
						<map:parameter name="attribute-name" value="builder"/>
						<map:when test="jsp">
							<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order_edit.jsp"/>
						</map:when>
/s
ShipmentOrderEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
...
/s
RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 108	

mySessionMap	HashMap  (id=23388)	
	table	HashMap$Entry[16]  (id=23416)	
		[3]	HashMap$Entry  (id=23700)	
			key	"1434975492011" (id=23701)	
			value	BaseRequest  (id=23702)	
				requestId	"1434975492011" (id=23701)	
				url	"../images/ui-icons_222222_256x240.png" (id=23713)	

		if (isFlowControlEnabled) {
			BaseRequest myRequest = new BaseRequest(aRequest);
/ sets ook params	,
"systemid"
"base_sessionLevelOffset"
			int myLevelOffset = parseLevel(getRequest().getParameter(SESSION_LEVEL_OFFSET));
1
			setLevel(Math.max(0, getLevel() + myLevelOffset));
1
			mySessionMap.put(myRequest.getRequestId(), myRequest);
/ erbij	,
				mySessionList.add(getLevel(), myRequest.getRequestId());
[1434975492011, 1434977918690]

/ Na shipment-order_edit komen er verder geen actions	,  

/ 7	. 

/ we komen op de shipment order,	 
/ click Back	,

/ Intermezzo

/ we zien in trunk/	,
./module/oms/war/oms/script/class.shipment-order_edit.js
./base-framework/core/war/core/script/class.formmanager.js

/ In devtools zien we 
<script type="text/javascript" src="../script/class.formmanager.js"></script>
<script type="text/javascript" src="../m_script/oms/class.shipment-order_edit.js"></script>
/ TODO

/ Einde Intermezzo

/s
FormManager.
    this.goBack = function() {
    	this.performRedirect("../core/back?levelOffset=-1");
    }
/s
    this.performRedirect = function(newUrl) {
    	 document.location.replace(newUrl);



$ vi core-sitemap.xmap
            <map:match pattern="back">
               <map:act type="redirectByFlow">
				    <map:parameter name="levelOffset" value="{request-param:levelOffset}"/>
				</map:act>
            </map:match>

/ we moesten opnieuw inlog	,

/ we komen in	,
Daemon Thread [http-0.0.0.0-8080-8] (Suspended (entry into method <init> in RequestManager))	
	RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 108	
	RequestManager.<init>(Session, Request, boolean) line: 97	
	RedirectByFlowAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	
...
/s
RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 108	

aSession	SessionAdaptor  (id=24845)	
	theSessionCocoon	HttpSession  (id=24850)	
		wrappedSession	StandardSessionFacade  (id=24851)	
			session	StandardSession  (id=24852)	
				attributes	Hashtable  (id=24853)	
					table	Hashtable$Entry[47]  (id=24860)	
						[40]	Hashtable$Entry  (id=24885)	
							hash	-857330412	
							key	"base_sessionMap" (id=20111)	
							value	HashMap  (id=24398)	
								table	HashMap$Entry[16]  (id=24403)	
									[3]	HashMap$Entry  (id=24928)	
										key	"1434981756074" (id=24930)	
										value	BaseRequest  (id=24931)	
											params	HashMap  (id=24932)	
											requestId	"1434981756074" (id=24930)	
											url	"../oms/shipment-order_edit" (id=24933)	
									[12]	HashMap$Entry  (id=24929)	
										key	"1434981740341" (id=24934)	
										value	BaseRequest  (id=24935)	
											params	HashMap  (id=24936)	
											requestId	"1434981740341" (id=24934)	
											url	"../images/ui-icons_222222_256x240.png" (id=24937)	
/ Klopt	,

		if (getSession().getAttribute(SESSION_MAP) != null) {
			mySessionMap = (Map<String, BaseRequest>) getSession().getAttribute(SESSION_MAP);
		if (getSession().getAttribute(SESSION_LIST) != null) {
			mySessionList = (ArrayList<String>) getSession().getAttribute(SESSION_LIST);
		if (getSession().getAttribute(SESSION_LEVEL) != null) {
			setLevel(Math.max(0, Integer.parseInt((String) getSession().getAttribute(SESSION_LEVEL))));
1
		if (isFlowControlEnabled) {
/ NEE



/ TODO
mySessionList	ArrayList  (id=24335)	
[]
mySessionMap	HashMap  (id=24334)	
{}
	setLevel(0)

		if (isFlowControlEnabled) {
/ NEE

/ 7	. 

/ back
/ TODO

/ 7	. 

/ click in een sho	, Attached files	,
<input type="button" value="Attached files" 
	onclick="theActiveFormManager.setRedirectUrl('../document/file-object_list_shipment-order_26879305?refresh=true');
			theActiveFormManager.conditionalSubmit(null,true,1);
			return false;"
>
...
//s
FileObjectListAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
/s
RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 137	
		if (isFlowControlEnabled) {
			BaseRequest myRequest = new BaseRequest(aRequest);
/ myRequest	,
url	"../document/file-object_list_shipment-order_26879305" (id=27285)	
			int myLevelOffset = parseLevel(getRequest().getParameter(SESSION_LEVEL_OFFSET));
1
/ TODO

/ 7		.

/ Neem devtools	,

/ Als we een shipment order open/edit vanaf de list	, dan zien we requested	,

/ als we de sho list page bekijken	,
/ click 'View frame source'	, 
<script src="../script/jquery.min.js" type="text/javascript"></script>
<script src="../script/jquery-ui.min.js" type="text/javascript"></script>
</head>

/click F12	, 

ui-icons_222222_256x240.png /pnloms/lookandfeel/styles/images GET	200 OK text/html	Script 2.1 KB 7.4 KB 13 ms 12 ms

￼ui-bg_highlight-soft_100_eeeeee_1x100.png /pnloms/lookandfeel/styles/images GET	200 OK text/html	Script 2.1 KB 7.4 KB 15 ms 14 ms ￼shipment-order_list?refresh=false&screenId=shipment-order&emptySession=true /pnloms/oms

/ we zien 	,
Request URL:https://test-scs.mp-objects.com/pnloms/lookandfeel/styles/images/ui-icons_222222_256x240.png
Request Headers
Referer:https://test-scs.mp-objects.com/pnloms/lookandfeel/styles/jquery-ui.theme.min.css

Request URL:https://test-scs.mp-objects.com/pnloms/lookandfeel/styles/images/ui-bg_highlight-soft_100_eeeeee_1x100.png
Request Headers
Referer:https://test-scs.mp-objects.com/pnloms/lookandfeel/styles/jquery-ui.theme.min.css


/ 7	. 

/ bij uitloggen	,

/ Bij FlushUserCacheAction.act	,
/s
RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 109	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));

aSession	SessionAdaptor  (id=21018)	
	theSessionCocoon	HttpSession  (id=20226)	
		wrappedSession	StandardSessionFacade  (id=20236)	
			session	StandardSession  (id=20237)	
				attributes	Hashtable  (id=20239)	
					table	Hashtable$Entry[23]  (id=20247)	
						...
						[22]	Hashtable$Entry  (id=20255)	
							key	"base_sessionMap" (id=20111)	
							value	HashMap  (id=20263)	
								table	HashMap$Entry[16]  (id=20276)	
									[7]	HashMap$Entry  (id=21024)	
										key	"1434966774193" (id=21025)	
										value	BaseRequest  (id=21026)	
											params	HashMap  (id=21027)	
											requestId	"1434966774193" (id=21025)	
											url	"../images/ui-icons_222222_256x240.png" (id=21028)	

/ 7	. 

Als we een serial id geven , en Enter, dan weer een ShipmentOrderListAction	, en weer van die	 ...
/ TODO

/ 7	. 

/ click edit op een shipment order in de rij	,

Daemon Thread [http-0.0.0.0-8080-10] (Suspended (entry into method <init> in RequestManager))	
	RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 108	
	RequestManager.<init>(Session, Request, boolean) line: 97	
	ShipmentOrderEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	


/ 	7. 

/ Huidige Back, Cancel	,


$ vi ButtonTag.java

		} else if (readOnly) {
			if (TYPE_BACK.equals(getType()) || TYPE_CANCEL.equals(getType())) {
/ TYPE_BACK wordt NIET used	, TYPE_CANCEL wel	,

				myPrint.append("<input type=\"button\" ");
				myPrint.append(" id=\"backBtn\"");
				myPrint.append(" value=\"" + getLabel("back") + "\"");
				myPrint.append(" onclick=\" " + getForm().getJsFormManager() + ".goBack();\"");
				if (!myCanGoBack) {
					myPrint.append(" disabled=\"disabled\" ");
					myPrint.append(" title=\"" + myCanGoBackMessage + "\"");
				}
				myPrint.append("/>");

		} else if (!readOnly) {
			if (getType().equals(TYPE_CANCEL)) {
				myPrint.append("<input type=\"button\" ");
				myPrint.append(" id=\"cancelBtn\"  name=\"cancelBtn\" ");
				myPrint.append(" value=\"" + getLabel("cancel") + "\"");
				myPrint.append(" onclick=\" " + getForm().getJsFormManager() + ".cancel('" + getCancelMessage() + "');\"");

				if (!myCanGoBack) {
					myPrint.append(" disabled=\"disabled\" ");
					myPrint.append(" title=\"" + myCanGoBackMessage + "\"");
				}

				myPrint.append("/>");
			} else if (!getType().equals(TYPE_BACK)) {
/ NIET used,	
				myPrint.append("<input type=\"button\"");
				myPrint.append(" name=\"" + getType() + "Btn\"");
				myPrint.append(" id=\"" + getType() + "Btn\"");
				myPrint.append(" value=\"" + getLabel(getType()) + "\"");
				myPrint.append(" onclick=\" " + getForm().getJsFormManager() + ".submit('" + getUrlForType(getType()) + "', " + getDoRedirect() + ", "
						+ getRedirectLevelOffset() + ");\"");

				myPrint.append("/>");

			}

/ als de sho readOnly is	, er Back op de button verschijnt als type="cancel"	,

/ 13	. 

$ vi shipment-order_edit.jsp	,
			<mpo:button type="cancel" />

/ we click Cancel op een sho (NIET readOnly)	,
		theActiveFormManager.cancel = function(aMessage) {
			this.performRedirect(this.getRedirectUrl());
/s
    this.getRedirectUrl = function() {
        return document.getElementById("redirectTo").value;
"../core/back?levelOffset=-1"

/ 13	. 

/ we click Back	op een ander sho (WEL readOnly)		,
    this.goBack = function() {
    	this.performRedirect("../core/back?levelOffset=-1");
/s
    this.performRedirect = function(newUrl) {
    	 document.location.replace(newUrl);

/ Dus uiteindelijk toch hetzelfde	,

/ 13.	 

/ we click (op een NIET readOnly sho) Save	,

$ vi shipment-order_edit.jsp	,
			<c:if test="${!readOnly || hasSavePermission}">
				<input type="button" value="<mpo:label name="save"/>" onclick="document.getElementById('selectPath').value='yes'; theShipmentorderFormManager.submit('../oms/shipment-order_save', false, 0);" />

/ we zien in HTML	,
<input type="button" value="Save" onclick="document.getElementById('selectPath').value='yes'; theShipmentorderFormManager.submit('../oms/shipment-order_save', false, 0);">

/ we komen in	,
$ vi smartsave.js

		theActiveFormManager.submit = function(anAction, aBoolDoRedirect, aRedirectionLevelOffset) {
			smartSaveResetDirtyFlag();
			return this._smartSaveSubmit(anAction, aBoolDoRedirect, aRedirectionLevelOffset);
/s
$ vi class.formmanager.js
   this.submit = function(anAction, aBoolDoRedirect, aRedirectionLevelOffset) {
...


/ KLAD

$ vi ShipmentOrderListPage.java

			public boolean execute(Object aObject) {

				PageParameters pageParameters = new PageParameters();
				String pageId = ShipmentOrderListPage.this.getId();
				pageParameters.add("returnUrl", getRequestCycle().urlFor(ShipmentOrderListPage.this).toString());
				String returnUrl2 = getPage().urlFor(ShipmentOrderListPage.class, pageParameters).toString();
/ RM

$ vi shipment-order_edit.jsp

			<button type="button" onclick="mycancel()">MyCancel</button>
			<script type="text/javascript">
				function mycancel(){
					windonw.history.back();
				}
			</script>
			
			<mpo:button type="cancelAndRedirect" url="${returnUrl}"/>
/ RM




/ Einde KLAD


/ we kiezen steeds	,
SH000013410-20150608		/ readOnly==false	,
SH000010186					/ readOnly==true	,

/ Einde DEBUG PNL-410

/ PNL 

/ planning, shipment order, shipment order search	,

http://localhost:8080/tms/wicket?module=oms&wicketpage=shipmentorder.ShipmentOrderListPage&emptySession=true
/ wordt	,
http://localhost:8080/tms/wicket/?wicket:interface=:3::::

/ Dit gebeurt in BaseHomePage.doRedirect, calls redirectToInterceptPage	,
/ TODO

/ Einde PNL

/ PNL-597

/ planning, shipment order, mass update

http://localhost:8080/tms/wicket?module=massupdate&wicketpage=shipmentorder.ShipmentOrderMassUpdatePage&emptySession=true
/ wordt	,
http://localhost:8080/tms/wicket/?wicket:interface=:12::::

/ 7	. 

/ we kiezen 
/ planning, shipment order, mass update
/ we vallen in	,
ShipmentOrderMassUpdatePage$4.createRow(List<Object>, QueryColumn, ListItem<Object>) line: 171	
/=
		add(new QueryViewPanel("query", Model.of(myQuery), null, myGroupActions, selection) {
			@Override
			protected void createRow(List<Object> aRow, QueryColumn myColumn, ListItem<Object> aCell) {

/ shipment order id	,
->				if (myColumn.getProperty().equals("shipmentOrderId")) {
					Integer myId = (Integer) aRow.get(0);
					String shimentOrderLink = "../oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=" + Integer.toString(myId.intValue());
					if (myColumn.getFormatter() == null) {
						aCell.add(new ExternalLink("cellvalue", Model.of(shimentOrderLink), Model.of((String) aRow.get(1))));

/ de overigen	,
				else {
					if (myColumn.getFormatter() == null) {
						aCell.add(new Label("cellvalue", aCell.getModel().getObject().toString()));

/ we hieven ALLEEN	,

		add(new QueryViewPanel("query", Model.of(myQuery), null, myGroupActions, selection) {
			@Override
			protected void createRow(List<Object> aRow, QueryColumn myColumn, ListItem<Object> aCell) {
				if (myColumn.getProperty().equals("shipmentOrderId")) {
					Integer myId = (Integer) aRow.get(0);

////////////////////////
					String returnUrl = getRequestCycle().urlFor(ShipmentOrderMassUpdatePage.this).toString();
					returnUrl = RequestUtils.toAbsolutePath(returnUrl);
					String shimentOrderLink = "../oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=" + Integer.toString(myId.intValue()) + "&returnUrl=	" + returnUrl;
////////////////////////

					if (myColumn.getFormatter() == null) {
						aCell.add(new ExternalLink("cellvalue", Model.of(shimentOrderLink), Model.of((String) aRow.get(1))));

/ Dus we hoeven alleen de returnUrl in de shipment order url als param te set	,

/ In de shipment-order_edit.jsp en in de cocoon action staat alles al OK van PNL-410	,
/ Dat betekent:
$ vi PartyFormAction.java
    public Map act() throws java.lang.Exception {
        String returnUrl = getRequestParameter("returnUrl");
        getSession().setAttribute("returnUrl", returnUrl);

$ vi  party_edit.jsp
                    <mpo:button type="cancel" url="${returnUrl}"/>

/ FIX CANCEL FROM JSP TO WICKET

/ Einde PNL-597

/ PCT-231

https://acceptance-pnl.mp-objects.com/pnllogistics/core/index_frameset

/ 7	. 

/ SAMENVATTING LANGUAGE MANAGER

///////////////////////////////
/ Hij probeert eerst    ,
<product_entity_field>
/ bijv  ,
pnloms.table_shipment_order_shipment_order_details
/ dan   ,
<entity_field>
/ bijv  ,
table_shipment_order_shipment_order_details
/ dan
<field>   ,
/ bijv  ,
shipment_order_details
//////////////////////////////

/ we set b in
LanguageManager.get(String, String) ,

/ en we open een shipment order ,

/ we vallen in  ,

shipment-order_edit.jsp line: 191
                    <mpo:label name="shipmentOrderDetails" />
/s
LabelTag.doStartTag() line: 41
        String myString = getLanguageManager().getByJavaName(theEntity, theName);
this    LabelTag  (id=17609)
    theEntity   "shipmentOrder" (id=19669)
    theName "shipmentOrderDetails" (id=19670)
/s
LanguageManager.getByJavaName(String, String) line: 370
        String myTableName = StringUtils.formatJavaToSql(anEntityName).toString();
"shipment_order"
        String myFieldName = StringUtils.formatJavaToSql(aFieldName).toString();
"shipment_order_details"
            myRet = get(myTableName, myFieldName);
s
LanguageManager.get(String, String) line: 270
            myFullCode = "table_" + aTableName + "_" + aField;
table_shipment_order_shipment_order_details                         / entity_field
            myRet = get(myFullCode, true);
/s
LanguageManager.get(String, boolean) line: 247
        return get(aFullCode, StringUtils.EMPTY_STRING_MAP, aThrowExceptionIfNotFound);
/s
LanguageManager.get(String, Map<String,String>, boolean) line: 582
        String myProductSpecificCode = getProduct() + "." + myFullCode;
pnloms.table_shipment_order_shipment_order_details

/////////////////////////////////////////////////////
/ Dus
product_entity_field

        Properties lang = getPropertiesFile();
        myRet = lang.getProperty(myProductSpecificCode, null);
myProductSpecificCode   "pnloms.table_shipment_order_shipment_order_details" (id=19666)
        if (myRet == null) {
/ JA
            myRet = lang.getProperty(myFullCode, null);
myFullCode  "table_shipment_order_shipment_order_details" (id=17697)
        if (myRet == null) {
            if (aThrowExceptionIfNotFound) {
                throw new IndexOutOfBoundsException(myFullCode + " Not found in language file.");
/t
LanguageManager.get(String, String) line: 275
        try {
            myRet = get(myFullCode, true);
        } catch (IndexOutOfBoundsException e) {
/d
        }
        if (myRet == null) {
/ JA
            try {
                myRet = get(aField, true);
aField  "shipment_order_details" (id=17612)
myRet   "Shipment order details" (id=20288)
/ Deze wordt gevonden   ,

/ Einde SAMENVATTING LANGUAGE MANAGER

/ 7	. 

/ Build cargo local	,

/ workspace	,
$ vi application.properties
base.product = pnllogistics

/ jboss	,
[eric@localhost server]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server
[eric@localhost server]$ cp -a pnloms/ pnllogistics
$ cd pnllogistics/deploy
[eric@localhost deploy]$ mv pnloms-schedule-service.xml pnllogistics-schedule-service.xml 
/ 2 edits	,
[eric@localhost deploy]$ vi pnllogistics-schedule-service.xml 
<server>
    <mbean code="org.jboss.varia.scheduler.Scheduler" name=":service=PnlLogisticsInterfaces">
        <attribute name="SchedulableArguments">ejb/PnlLogisticsInterfaceRunnerFacade,all-admin,admin123@MPO</attribute>

$ vi postgres-ds.xml

    <xa-datasource>
        <xa-datasource-property name="DatabaseName">pnllogistics</xa-datasource-property>

   <local-tx-datasource>
                <connection-url>jdbc:postgresql://127.0.0.1:5432/pnllogistics</connection-url>




/ db	,

[eric@localhost spring-my]$ forticlientsslvpn.sh 
[eric@localhost spring-my]$ pnl-ssh-a.sh 
[vanderveldene@pnl-app-a /]$ sudo su - jboss
[jboss@pnl-app-a ~]$ less pnllogistics/deploy/postgres-ds.xml 
/ we zien dat de db op localhost is	,

[eric@localhost Backup]$ pwd
/home/eric/Devel/Postgres/Backup
[eric@localhost Backup]$ PGPASSWORD='h^Zgcyr&Q'  pg_dump -U vanderveldene -Fc -h pnl-app-a.intermax.mp-objects.com pnllogistics > pnl-app-a_pnllogistics.dump
/ OK

/ login local db	,
[eric@localhost LOGS]$ PGPASSWORD=mpopostgres@mpo psql -U mpopostgres pnloms7
pnloms7=# create database pnllogistics;
CREATE DATABASE

[eric@localhost Backup]$ PGPASSWORD=mpopostgres@mpo pg_restore -U mpopostgres -d  pnllogistics pnl-app-a_pnllogistics.dump 
/ OK

/ 7	. 

			<map:match pattern="shipment-order_list">
				<map:act type="shipmentOrderList"/>			
				<map:call resource="dynatablePage">
					<map:parameter name="xsp" value="xsp/shipment-order_list.xml"/>
				</map:call>
			</map:match>

			<map:action logger="shipmentorder" name="shipmentOrderList" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderListAction"/>			

			<map:match pattern="shipment-item_list">
				<map:act type="shipmentOrderList"/>			
				<map:call resource="dynatablePage">
					<map:parameter name="xsp" value="xsp/shipment-item_list.xml"/>
				</map:call>
			</map:match>


$ vi shipment-order_list.xml

           if (!myTable.isFieldHidden("orderprocessonlistpage")) {
	            myTable.addDatabaseJoinColumn("shipment_order_process", "code", 15); 
            }
...

$ vi com.mpobjects.view.util.table.Table.java
...

/ we vallen in	,
Daemon Thread [http-0.0.0.0-8080-2] (Suspended (entry into method isFieldHidden in Table))	
	Table.isFieldHidden(String) line: 641	
	shipment_order_list_xml.generate() line: 494	
	...
/=
	public boolean isFieldHidden(String aFieldName) {
aFieldName	"orderprocessonlistpage" (id=1406)	
		String myModule = EntityActionUtil.getModule(new RequestAdaptor(getRequest()));
myModule	"oms" (id=1562)	
		String myEntity = StringUtils.formatToPropertiesKey(getName());
/ getName()=="shipment-order"
myEntity	"shipmentorder" (id=1629)	
		String myFieldName = StringUtils.formatToPropertiesKey(aFieldName.toLowerCase());
myFieldName	"orderprocessonlistpage" (id=1630)	
		String myKey = myEntity + "." + myFieldName + ".hidden";
myKey	"shipmentorder.orderprocessonlistpage.hidden" (id=1631)	
		boolean isHidden = ApplicationPropertyManager.getInstance().getModuleProperty(myModule, myKey, false);
/ false will be the default value
/s
ApplicationPropertyManager.getModuleProperty(String, String, boolean) line: 357	
		String val = getModuleProperty(aModule, aKey, Boolean.toString(aDefaultValue));
/s
ApplicationPropertyManager.getModuleProperty(String, String, String) line: 378	
		return getProperty(getPropertyKey(aModule, aKey), aDefaultValue);
aModule	"oms" (id=1562)	
aKey	"shipmentorder.orderprocessonlistpage.hidden" (id=1631)	
aDefaultValue	"false" (id=1719)	
/s
			myRet = "module." + aModule + "." + aKey;
/t
////////////////////////////
/ getPropertyKey(aModule, aKey)=="module.oms.shipmentorder.orderprocessonlistpage.hidden"
/s
ApplicationPropertyManager.getProperty(String, String) line: 531	
		String myReturnValue = null;
		Resource myResource = AuthenticationUtils.getResource();
eric
		if (myResource != null) {
			myReturnValue = myResource.getProperty(aKey);
null
			if (myReturnValue == null) {
				myReturnValue = getDatabaseProperty(aKey, null);
null
/ (*)
			}
		}
		if (myReturnValue == null) {
			myReturnValue = getApplicationProperty(aKey, aDefaultValue);
/ (**)
		}
		return StringUtils.trimIfNotEmpty(myReturnValue);

/ Intermezzo

////////////////////

/ we moeten evt. shipment-order_list.xml edit	, 
$ vi shipment-order_list.xml

/ header
            if(!myTable.isFieldHidden("organization")){
            	myTable.addDatabaseJoinColumn("organization","organization_id", 11);
            }
/ rows
            for (Iterator myIt = myList.iterator();myIt.hasNext();){
				...
                myRow = new  Row();
				...
 				if (!myTable.isFieldHidden("organization")) {
					myRow.addRowValue(new RowValue(myMask.getOrganizationId()));
				}


/ we moesten er een if omheen set	,
/ we moeten ant opnieuw run	,
/ als we NIET shipment-order_list.xml hoeven edit, hoeven we alleen : Reload config	,

/ we moeten de properties in de db set	, 
/ pnllogistics/pnllogistics.properties moet RM, en alle properties moeten in de db	,
/ maar we moeten wel in oms.properties file de hidden value altijd op false set, zodat andere instances de column wel zien	, 

/ ga naar,	
configuration, administration, properties
create new property
code: module.oms.shipmentorder.organization.hidden
type: boolean
description: ...
Save

configuration, administration, properties values
Create
/ Naast property, click 'Lookup'	, in het nieuwe window kunnen we onder Code geven: organization. Blijkbaar lookup in de properties table	,
module.oms.shipmentorder.organization.hidden
/ we zien 	,
property: module.oms.shipmentorder.organization.hidden
organization: <Leeg laten>
Value: true
Save and close	,


$ vi oms.properties
module.oms.shipmentorder.organization.hidden=false

Support, System, Reload config	,
/ als we ook shipment-order_list.xml, moet we opnieuwe ant	,

 
/ Einde Intermezzo

/ Intermezzo

/ (*)

$ vi ApplicationPropertyManager.java
	protected String getDatabaseProperty(String aKey, String aDefaultValue) {
			return dbProperties.getProperty(aKey, aDefaultValue);

/ waar is dbProperties set	?

/ eerder	,
$ vi ApplicationPropertyManager.java
	private void loadDatabaseProperties() {
			dbProperties = new Properties();
			dbProperties.putAll(MpoBeanFactory.getBean(PropertiesValueDAO.class).getAllWithoutOrgAndUserAsMap());

$ vi PropertiesValueDAOImpl.java
public class PropertiesValueDAOImpl extends GenericHibernateDAO<PropertiesValueVO> implements PropertiesValueDAO {
	public List<PropertiesValueVO> getAllWithoutOrgAndUser() {
		Criteria myCriteria = getCurrentSession().createCriteria(PropertiesValueVO.class);
		...

$ vi PropertiesValue.standard.hbm.xml

<hibernate-mapping>
	<class name="com.mpobjects.oms.model.propertiesvalue.vo.PropertiesValueVO" table="PROPERTIES_VALUE">
...

/ Er zijn de tables properties en properties_value	,

/ Eclipse gives	,
/ (*)
this	ApplicationPropertyManager  (id=1705)	
	dbProperties	Properties  (id=20173)	
{module.oms.serviceorder.freecapacityvolume.hidden=true,
 module.oms.shipmentorder.volumecalc=gross_strict,
 module.oms.incoterm.version.enabled=true,
 module.oms.serviceorder.releasedates.hidden=false,
 module.tms.serviceorder.shipfrom.party.reference5.hidden=false,
 module.optimize.ratingrequest.incoterm.excludefilter=2000,
 module.oms.productitem.recalculate.requested.weight=false,
 module.login.sessiontimeout.admin=30,
 module.oms.customerorderline.id.format=COL%08d,
 module.oms.recurring.serviceorder.schedule.horizon.hours=36,
 module.oms.serviceorder.tab.event.delete.hidden=true,
 module.tms.serviceorder.shipto.party.reference1.hidden=false,
 module.postnlcif.password=4dca128971a454461328563789c5ac8ce5ef4248,
 module.tms.serviceorder.shipto.party.reference3.hidden=false,
 module.oms.shipmentorder.margin.hidden=true,
 module.oms.serviceorder.freecapacityweight.hidden=true,
 module.tms.serviceorder.shipfrom.party.reference3.hidden=false,
 module.interface.should.interface.serviceorder.costs=true,
 module.oms.customerorder.lookup.fields.hidden=false,
 module.optimize.ratingrequest.leadtime.enabled=true,
 module.optimize.ratingrequest.enddate.hidden=false,
 module.login.sessiontimeout.user=60,
 module.oms.dashboardshipmentorderlist.price.hidden=true,
 module.tms.serviceorder.shipfrom.party.reference1.hidden=false,
 module.optimize.ratingrequest.default.preferred.partyid=ALL,
 module.postnlcif.username=mpobjects,
 module.optimize.ratingrequest.costgroups=Freight, Fuel,
 module.oms.shipmentorder.orderprocess.readonly=false,
 module.event.export.original=true,
 module.optimize.ratingrequest.carrierinfo.enabled=true,
 module.oms.serviceorder.capacitymanagement.hidden=true,
 module.postnlcif.label.url=https://testservice.postnl.com/CIF_SB/LabellingWebService/1_9/,
 module.event.serviceorderlist.serviceactiontypes=DELIVERY,
 module.emailnot.shipping.report.delay=0,
 module.optimize.ratingrequest.startdate.exclude.days=SATURDAY, SUNDAY,
 module.oms.shipmentorder.recurring.hidden=true,
 module.oms.instructions.enabled=true,
 module.oms.recurring.shipmentorder.id.pattern=-yyyyMMdd,
 module.optimize.ratingrequest.startdate.hidden=false,
 module.tms.serviceorder.shipto.party.reference2.hidden=false,
 module.tms.serviceorder.shipto.party.reference4.hidden=false,
 module.postnlcif.barcode.url=https://testservice.postnl.com/CIF_SB/BarcodeWebService/1_1/,
 module.tms.serviceorder.shipfrom.party.reference4.hidden=false,
 module.oms.shipmentitem.recalculate.requested.volume=false,
 module.oms.shipmentorder.customerstatus.hidden=false,
 module.oms.productitem.reference5.hidden=false,
 module.oms.shipmentorder.incotermsreference.hidden=true,
 module.oms.shipmentorder.authorizationcodes.hidden=true,
 module.tms.serviceorder.shipfrom.party.reference2.hidden=false,
 module.oms.dashboard.releaseServiceOrder.show=true,
 module.oms.shipmentorder.requestedtotalvalue.readonly=false,
 module.oms.serviceorder.freecapacityldm.hidden=true,
 module.oms.recurring.serviceorder.id.pattern=-yyyyMMdd,
 module.oms.dashboardshipmentorderlist.margin.hidden=true,
 module.oms.shipmentorder.incoterm.default=DDU,
 module.optimize.ratingrequest.pricegroups=Freight, Fuel,
 module.oms.serviceorder.remarks2.hidden=false,
 module.optimize.ratingrequest.shippingunit.default=RC,
 module.scannerinterface.logisticsevent.type.expectedEvent3=OLH,
 module.optimize.ratingrequest.disclaimer=This quotation can only be used as a guideline based on information entered and that due to additional restrictions and unforeseen circumstances the actual costs might vary from the costs indicated in the quotation tool. Rates will be general cargo rates based on weight and packaging dimensions that fall within the carrier's restrictions. *** WARNING ***,
 module.oms.customerorder.id.format=CO%09d,
 module.oms.shipmentorder.remarks2.hidden=false,
 module.oms.shipmentorder.airport.hidden=true,
 module.optimize.ratingrequest.fromparty.required=false,
 module.optimize.ratingrequest.toparty.required=false,
 module.pnllogistics.eurodis.report.id=europlate,
 module.oms.serviceorder.release.prevent.holdstatus=REVIEW_HOLD,
 searchlist.shipment-order-template.start.empty=false,
 module.oms.shipmentorder.salesorganization.hidden=true,
 module.optimize.ratingrequest.markup.percentage=0,
 module.oms.shipmentorder.orderprocess.hidden=false,
 module.optimize.ratingrequest.billto.hidden=true,
 module.tms.serviceorder.shipto.party.reference5.hidden=false}

/ Einde Intermezzo

/t
ApplicationPropertyManager.getProperty(String, String) line: 536	
				myReturnValue = getDatabaseProperty(aKey, null);
/d
null
/ 2de arg null is default value	,

		if (myReturnValue == null) {
			myReturnValue = getApplicationProperty(aKey, aDefaultValue);
/ (**)
/s
ApplicationPropertyManager.getApplicationProperty(String, String) line: 216	
		return theProperties.getProperty(aKey, aDefaultValue);

/ Intermezzo

/ (**)

/ wanneer is theProperties set	?

$ vi ApplicationPropertyManager.java

		File myFile = new File(CONF_DIRECTORY, APPLICATION_PROPERTIES_FILE);
/ CONF_DIRECTORY=/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnllogistics/conf
/ APPLICATION_PROPERTIES_FILE=application.properties
		if (myFile.exists()) {
			theProperties = PropertiesUtil.loadProperties(myFile);


/ Hoe wordt de application.properties file create?

$ vi base-framework/base-build-config.properties
...

$ vi pnllogistics/pnllogistics-build-config.properties
module.authentication-saml2.component=base
module.document.component=module
module.oms.component=module
module.carconclient.component=module
module.omscarcon.component=module
module.emailnot.component=module
module.interfacing.component=module
module.interfacing-activemq.component=module
module.tax.component=module
module.invoice.component=module
module.inventory.component=module
module.tracking.component=module
module.extracking.component=module
module.event.component=module
module.ratecalc.component=module
module.optimize.component=module
module.customerinvoice.component=module
module.capabletopromise.component=module
module.mpolookandfeel.component=module
module.authorization.component=module
module.dataexport.component=module
module.massupdate.component=module
module.scannerinterface.component=module
module.postnlcif.component=module
module.clieop.component=module
module.pnllogistics.component=pnllogistics
product.interfaces.username = all-admin
product.interfaces.password = admin123@MPO

/ Iedere module in pnllogistics/pnllogistics-build-config.properties heeft een .properties file	, 
/ pnllogistics is zelf ook een module, dus die heeft er ook een	,

$ vi ratecalc/ratecalc.properties
module.ratecalc.serviceorder.ratecalculation.execution=manual
module.ratecalc.shipmentorderprice.ratecalculation.execution=manual


$ vi pnllogistics/pnllogistics.properties
...
module.oms.shipmentitem.casenumber.hidden=true
module.oms.shipmentitem.goodsstatus.hidden=true


/ we print in Eclipse	,
{module.inventory.shipmentorderconsolidationrequest.concurrentConsumers=1,
 module.login.nonloggable.users=all-admin,
 module.oms.userreferences.visible=true,
...
 module.tms.serviceorder.shipto.party.reference3.hidden=false,
 module.oms.massupdate.shipmentorder.setholdstatus.default=true,
 module.emailnot.export.service.order.pickup...


/ Einde Intermezzo

/ FIX PCT-231

/ 7	.

$ vi shipment-order_list.xml

            if(!myTable.isFieldHidden("organization")){
            	myTable.addDatabaseJoinColumn("organization","organization_id", 11);
            }
/ if eromheen	,

			if (!myTable.isFieldHidden("servicelevel")) {
        	    myTable.addDatabaseJoinColumn("service_level", "service_level", 7); 
            } 
/ if eromheen	,
            if (!myTable.isFieldHidden("incoterms")) {
            	myTable.addDatabaseJoinColumn("inco_terms", "inco_term_code", 8);
            }
/ if eromheen	,
            if (!myTable.isFieldHidden("requestedstartafter")) {
            	myTable.addDatabaseColumn("requested_start_after", "requested_departure_after", Column.TYPE_DATE);
            }
/ if eromheen	,
            if (!myTable.isFieldHidden("requestedendafter")) {
            	myTable.addDatabaseColumn("requested_end_after", "requested_arrival_after", Column.TYPE_DATE);
            }
/ if eromheen	,
            if (!myTable.isFieldHidden("requestedendbefore")) {
            	myTable.addDatabaseColumn("requested_end_before", "requested_arrival_before", Column.TYPE_DATE);    
            }
/ if eromheen	,
            if (!myTable.isFieldHidden("frompostalcode"")) {
            	myTable.addDatabaseColumn("from_postal_code", "from_postal_code");
            }
/ nieuw	,
           	if (!myTable.isFieldHidden("topostalcode"")) {
            	myTable.addDatabaseColumn("to_postal_code", "to_postal_code");
            }
/ nieuw	,

           for (Iterator myIt = myList.iterator();myIt.hasNext();){

 				if (!myTable.isFieldHidden("organization")) {
					myRow.addRowValue(new RowValue(myMask.getOrganizationId()));
				}
/ if eromheen	,
				if (!myTable.isFieldHidden("servicelevel")) {	
					myRow.addRowValue(new RowValue(myMask.getShipmentServiceLevelCode()));
				}
/ if eromheen	,
				if (!myTable.isFieldHidden("incoterms")) {	
					myRow.addRowValue(new RowValue(myMask.getIncoTermCode()));
				}
/ if eromheen	,
				if (!myTable.isFieldHidden("requestedstartafter")) {
					myRow.addRowValue(new RowValue(myVO.getDateSetVO().getRequestedStartAfter()));
				}
/ if eromheen	,
				if (!myTable.isFieldHidden("requestedendafter")) {
					myRow.addRowValue(new RowValue(myVO.getDateSetVO().getRequestedEndAfter()));
				}
/ if eromheen	,
				if (!myTable.isFieldHidden("requestedendbefore")) {
					myRow.addRowValue(new RowValue(myVO.getDateSetVO().getRequestedEndBefore()));
				}
/ if eromheen	,

/ we maken de hidden properties, in de db, value true, in oms.properties, value false	,
module.oms.shipmentorder.organization.hidden
module.oms.shipmentorder.serialnumber.hidden
module.oms.shipmentorder.reference2.hidden

/ deze zijn er al in db properties	, maar NIET In properties_value	, value true; in oms.properties, value false	,
module.oms.shipmentorder.reference4.hidden
module.oms.shipmentorder.reference5.hidden
module.oms.shipmentorder.reference6.hidden
module.oms.shipmentorder.reference8.hidden
module.oms.shipmentorder.reference10.hidden

/ we maken de hidden properties, in de db, value true, in oms.properties, value false	,
#module.oms.shipmentorder.preferedparty.hidden
module.oms.shipmentorder.servicelevel.hidden
module.oms.shipmentorder.incoterms.hidden
module.oms.shipmentorder.requestedstartafter.hidden
module.oms.shipmentorder.requestedendafter.hidden
module.oms.shipmentorder.requestedendbefore.hidden


/ nieuwe columns	,
/ we maken de hidden properties, in de db, value false, in oms.properties, value truefalse	,
module.oms.shipmentorder.frompostalcode.hidden
module.oms.shipmentorder.topostalcode.hidden

$ vi oms.properties

module.oms.shipmentorder.organization.hidden=false
module.oms.shipmentorder.serialnumber.hidden=false
module.oms.shipmentorder.reference2.hidden=false
module.oms.shipmentorder.reference4.hidden=false
module.oms.shipmentorder.reference5.hidden=false
module.oms.shipmentorder.reference6.hidden=false
module.oms.shipmentorder.reference8.hidden=false
module.oms.shipmentorder.reference10.hidden=false
#module.oms.shipmentorder.preferedparty.hidden=false 	/ TOCH gedaan	, OK
module.oms.shipmentorder.servicelevel.hidden=false
module.oms.shipmentorder.incoterms.hidden=false
module.oms.shipmentorder.requestedstartafter.hidden=false
module.oms.shipmentorder.requestedendafter.hidden=false
module.oms.shipmentorder.requestedendbefore.hidden=false
module.oms.shipmentorder.frompostalcode.hidden=true
module.oms.shipmentorder.topostalcode.hidden=true

/ 7	.

$ vi shipment-item_list.xml

            myQuery.append("SELECT ship.system_id as SYSTEM_ID, ship.shipment_order_id,");
/ Herverdeel query, sommige delen komen onder if statements	,

             if (!myTable.isFieldHidden("shipmentitemid")) {
             	myTable.addDatabaseColumn("shipment_item_id", "si.shipment_item_id");
             }
/ if eromheen	,
             if (!myTable.isFieldHidden("description")) {
             	myQuery.append("si.description,");
             	myTable.addDatabaseColumn("description", "si.description"); 
             }  
/ if eromheen	,
             if (!myTable.isFieldHidden("containernumber")) {
             	myQuery.append("si.container_number, ");
            	 myTable.addDatabaseColumn("container_number", "si.container_number"); 
            }            
/ if eromheen	,
             myTable.addDatabaseColumn("from_name", "ship.from_name"); 
             myTable.addDatabaseColumn("from_city", "ship.from_city"); 
             myTable.addDatabaseJoinColumn("from_country", "country_code", 2);  
             myQuery.append("ship.from_name, ship.from_city, (select country_code from country where system_id=ship.from_country_systemid) as from_country,");
/ verplaats	,             
             
             if (!myTable.isFieldHidden("postalcode")) {
             	myQuery.append("ship.from_postal_code,");
             	myTable.addDatabaseColumn("from_postal_code", "ship.from_postal_code");  
             } 
/ nieuw	,

           	 if (!myTable.isFieldHidden("plannedstart")) {
             	myQuery.append("ship.planned_departure_after,");
	         	myTable.addDatabaseColumn("planned_start", "planned_departure_after", Column.TYPE_DATE, false); 
	         } 
/ if eromheen	,
	         if (!myTable.isFieldHidden("plannedend")) {
	         	myQuery.append("ship.planned_arrival_after,");           
             	myTable.addDatabaseColumn("planned_end", "planned_arrival_after", Column.TYPE_DATE, false);
             }
/ if eromheen	,
	         myTable.addDatabaseColumn("system_entry", "system_entry_date", Column.TYPE_DATE, true);  
	         myQuery.append("ship.system_entry_date ");           
/ Herverdeel query, sommige delen komen onder if statements	,


/ voeg toe in db, value true	, 
/ en in oms.properties, value false	,
module.oms.shipmentitemsearch.shipmentitemid.hidden
module.oms.shipmentitemsearch.description.hidden
module.oms.shipmentitemsearch.containernumber.hidden
module.oms.shipmentitemsearch.plannedstart.hidden
module.oms.shipmentitemsearch.plannedend.hidden

/ voeg toe in db, value false, 
/ en in oms.properties, value true,
module.oms.shipmentitemsearch.frompostalcode.hidden
module.oms.shipmentitemsearch.topostalcode.hidden

/ er staan al in db	, 
module.oms.shipmentitemsearch.reference2.hidden=false
module.oms.shipmentitemsearch.reference3.hidden=false
/ en al in oms.properties	,
module.oms.shipmentitemsearch.reference1.hidden=false
module.oms.shipmentitemsearch.reference2.hidden=true
module.oms.shipmentitemsearch.reference3.hidden=true
module.oms.shipmentitemsearch.reference4.hidden=true
module.oms.shipmentitemsearch.reference5.hidden=true
module.oms.shipmentitemsearch.reference6.hidden=true
module.oms.shipmentitemsearch.reference7.hidden=true
module.oms.shipmentitemsearch.reference8.hidden=true
module.oms.shipmentitemsearch.reference9.hidden=true
module.oms.shipmentitemsearch.reference10.hidden=true



/ 7	. 

/ vertalen	,


$ vi shipment-order_list.xml
	            myTable.addDatabaseJoinColumn("shipment_order_process", "code", 15); 
            myTable.addDatabaseColumn("shipment_order_id", "shipment_order_id");

/ In de key in de language file staat het 1ste arg van .addDatabaseColumn 

/ we hoeven NIET pnllogistics. ervoor set	, 
/ see 
	private String get(String aFullCode, Map<String, String> aFieldMap, boolean aThrowExceptionIfNotFound) throws IndexOutOfBoundsException {

/ een java.util.Properties  heeft een default property	, 
/ voor 

/ in jboss	,
$ vi conf/language_en_GB_pnllogistics.properties

pnllogistics.table_shipment_order_shipment_order_process=Order Type
pnllogistics.table_shipment_order_shipment_order_id=Shipment Order
pnllogistics.table_shipment_order_shipmentorder.reference1.pnllogistics.general=Product Code
pnllogistics.table_shipment_order_shipmentorder.reference3.pnllogistics.general=Customer Reference
pnllogistics.table_shipment_order_system_entry_date=Entry Date

pnllogistics.table_shipment_item_search_reference1=PostNL reference
pnllogistics.table_shipment_item_search_reference2=Partner reference
pnllogistics.table_shipment_item_search_reference3=Customer reference
pnllogistics.table_shipment_item_search_system_entry=Entry Date









/ In LanguageManager.get zien we 	,
Name	"shipmentorder.reference1.pnllogistics.general" (id=17318)	


/ Dit kan OOK	 (laat table_shipment_order_ weg)	,
pnllogistics.shipmentorder.reference1.pnllogistics.general=Product Code
pnllogistics.shipmentorder.reference3.pnllogistics.general=Customer Reference
pnllogistics.table_shipment_order_system_entry_date=Entry Date


/ 7	. 

[eric@localhost tmp]$ pnl-scp-a.sh pnllogistics/conf/language_en_GB_pnllogistics.properties
[eric@localhost tmp]$ cp language_en_GB_pnllogistics.properties /home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/base-framework/core/conf
/ refresh trunk in eclipse	,




/ Einde FIX PCT-231

/ 7	. 

/ we maken script	,
[eric@localhost tmp]$ cat ~/bin/pnl-scp-a.sh 
#!/bin/bash
echo 'h^Zgcyr&Q'
scp vanderveldene@pnl-app-a.intermax.mp-objects.com:/local/apps/jboss-4.0.5.GA/server/"$@" .
[eric@localhost tmp]$ pnl-scp-a.sh pnllogistics/conf/language_en_GB_pnllogistics.properties

/ 7	.

/ check	,
pnllogistics=# select p.property_name,v.property_value from properties p join properties_value v on p.system_id=v.properties_system_id where p.property_name like '%shipmentorder%reference%';
...
pnllogistics=# select p.property_name,v.property_value from properties p join properties_value v on p.system_id=v.properties_system_id where p.property_name like '%shipmentorder%requested%hidden%';
...

/ Einde PCT-231

/ DEBUG PCT-231

/ 7	. 

/ planning, shipmentorder, search by item	,

/ we vallen in	,
TableManager.getTable(String, Request) line: 84	
		if (myTable == null) {
			myTable = new Table(aTableName, new FilterManager().getFilterCache(mySession), aRequest);
aTableName	"shipment-item-search" (id=17363)	
/ TODO

/ De #'s worden process in DynaQuery.toSQL


/ 7	.

/ planning, shipmentorder, search by item	,
	public boolean isFieldHidden(String aFieldName) {
		String myModule = EntityActionUtil.getModule(new RequestAdaptor(getRequest()));
		String myEntity = StringUtils.formatToPropertiesKey(getName());
		String myFieldName = StringUtils.formatToPropertiesKey(aFieldName.toLowerCase());
		String myKey = myEntity + "." + myFieldName + ".hidden";
		boolean isHidden = ApplicationPropertyManager.getInstance().getModuleProperty(myModule, myKey, false);
myModule	"oms" (id=17352)	
myEntity	"shipmentitemsearch" (id=17383)	
myFieldName	"reference1" (id=17386)	
myKey	"shipmentitemsearch.reference1.hidden" (id=17349)	
aFieldName	"reference1" (id=17394)	

this
	name	"shipment-item-search"
/ TODO

/Dus de keys moeten zo heten	,
shipmentitemsearch.reference1.hidden

/ 7	. 

/ Is er AL	,
$ vi oms.properties
module.oms.shipmentitemsearch.reference1.hidden=false
module.oms.shipmentitemsearch.reference2.hidden=true
module.oms.shipmentitemsearch.reference3.hidden=true
module.oms.shipmentitemsearch.reference4.hidden=true
module.oms.shipmentitemsearch.reference5.hidden=true
module.oms.shipmentitemsearch.reference6.hidden=true
module.oms.shipmentitemsearch.reference7.hidden=true
module.oms.shipmentitemsearch.reference8.hidden=true
module.oms.shipmentitemsearch.reference9.hidden=true
module.oms.shipmentitemsearch.reference10.hidden=true

/ 7	. 

/ configuration, administration, properties	,
/ we filter op toportalcode	,
/ we click edit button op een	,

<button 
wicket:id="button" 
name="group:objectTable:body:rows:2:cells:1:cell:entity-actions:cell-actions:actions:1:button" 
id="button129" 
wicketpath="evoSearchList_filterForm_group_objectTable_body_rows_2_cells_1_cell_entity-actions_cell-actions_actions_1_button" 
onclick="
var wcall=wicketSubmitFormById(
'filterForm11b', 
'?wicket:interface=:19:evoSearchList:filterForm:group:objectTable:body:rows:2:cells:1:cell:entity-actions:cell-actions:actions:1:button:1:IActivePageBehaviorListener:0:&amp;wicket:ignoreIfNotActive=true', 
'group:objectTable:body:rows:2:cells:1:cell:entity-actions:cell-actions:actions:1:button' ,
function() { }.bind(this),function() { }.bind(this), 
function() {return Wicket.$$(this)&amp;&amp;Wicket.$$('filterForm11b')}.bind(this));;; return false;" class="icon icon_edit small" title="Edit" type="submit"><span wicket:id="label" wicketpath="evoSearchList_filterForm_group_objectTable_body_rows_2_cells_1_cell_entity-actions_cell-actions_actions_1_button_label" class="fallback">Edit</span></button> 

/ we komen in	,
$ vi wicket-ajax.js 

function wicketSubmitFormById(formId, url, submitButton, successHandler, failureHandler, precondition, channel) {
	var call = new Wicket.Ajax.Call(url, successHandler, failureHandler, channel);
url: "?wicket:interface=:19:evoSearchList:filterForm:group:objectTable:body:rows:2:cells:1:cell:entity-actions:cell-actions:actions:1:button:1:IActivePageBehaviorListener:0:&wicket:ignoreIfNotActive=true"
formId: "filterForm11b"
submitButton: "group:objectTable:body:rows:2:cells:1:cell:entity-actions:cell-actions:actions:1:button"
successHandler:
failureHandler:
precondition:
/ TODO

/ INTERESSANTE URL	,
'?wicket:interface=:19:evoSearchList:filterForm:group:objectTable:body:rows:2:cells:1:cell:entity-actions:cell-actions:actions:1:button:1:IActivePageBehaviorListener:0:&amp;wicket:ignoreIfNotActive=true', 
/ TODO

/ Wat is	,
submitButton: "group:objectTable:body:rows:2:cells:1:cell:entity-actions:cell-actions:actions:1:button"
/ TODO

/ we komen in	,
PropertyEditPanel(GenericFormPanel).onBeforeRender() line: 112	
		reloadObject();
/s
PropertyEditPanel(GenericFormPanel).reloadObject() line: 216	
				daoWrapper.getBean().getCurrentSession().update(myObject);

/ daoWrapper=com.mpobjects.view.wicket.util.BeanWrapper@4240cff2[type=interface com.mpobjects.oms.dao.property.PropertyDAO,beanName=<null>]

/ bij 
module.oms.shipmentitemsearch.topostalcode.hidden
/ zien we	,
org.hibernate.NonUniqueObjectException: a different object with the same identifier value was already associated with the session: [com.mpobjects.oms.model.entity.property.Property#26766801]
     at org.hibernate.engine.StatefulPersistenceContext.checkUniqueness(StatefulPersistenceContext.java:638)
     at org.hibernate.event.def.DefaultSaveOrUpdateEventListener.performUpdate(DefaultSaveOrUpdateEventListener.java:305)
     at org.hibernate.event.def.DefaultSaveOrUpdateEventListener.entityIsDetached(DefaultSaveOrUpdateEventListener.java:246)
     at org.hibernate.event.def.DefaultUpdateEventListener.performSaveOrUpdate(DefaultUpdateEventListener.java:57)
     at org.hibernate.event.def.DefaultSaveOrUpdateEventListener.onSaveOrUpdate(DefaultSaveOrUpdateEventListener.java:93)
     at org.hibernate.impl.SessionImpl.fireUpdate(SessionImpl.java:742)
     at org.hibernate.impl.SessionImpl.update(SessionImpl.java:730)
     at org.hibernate.impl.SessionImpl.update(SessionImpl.java:722)
     at com.mpobjects.view.wicket.util.single.GenericFormPanel.reloadObject(GenericFormPanel.java:216)
     at com.mpobjects.view.wicket.util.single.GenericFormPanel.onBeforeRender(GenericFormPanel.java:112)

/ 7	. 

/ Hoe is dit button create	?
configuration, administration, properties	,
/ Dit is PropertyPage	,
protected void createPage(){
		editPage = new PropertyEditFormPage(this, daoWrapper, dataProperties);
/ heeft	,
	protected void createEditPanel() {
		EntityFormActionBuilder<Property> myPanelBuilder = new EntityFormActionBuilder<Property>(getFormActions());
		editPanel = new PropertyEditPanel("editPanel", new WebComponentEventSwitchBoard(), myPanelBuilder, daoWrapper, dataProperties);

/ 13	.
/ Wat zijn deze	? 
/ TODO
$ vi EvoEditFormPage.java

	protected Collection<EntityAction<T>> getFormActions() {
		List<EntityAction<T>> actions = new ArrayList<EntityAction<T>>();

		EntityActionButton<T> saveBtn = new EntityActionAjaxButton<T>("ok", new ResourceModel("save")) {
		...
		actions.add(saveBtn);

		EntityActionButton<T> cancelBtn = new EntityActionAjaxButton<T>("cancel", new ResourceModel("cancel")) {
		};
		actions.add(cancelBtn);

/ 13	. 
/ Wat zijn deze	? 
/ TODO
abstract public class GenericListPanel<T extends EntityInterface> extends BaseWebComponent {

	public enum action {
		delete, edit, select
	}

	private class ActionPanel extends Panel {
		public ActionPanel(String id, Collection<Component> aComponentList) {
			super(id);
			RepeatingView view = new RepeatingView("entity-actions");
			add(view);
			for (Component component : aComponentList) {
				view.add(component);
			}
/s
			@Override
			public void populateItem(final Item cellItem, final String componentId, final IModel model) {
				Collection<Component> myList = new ArrayList<Component>();
				if (entityGroupActions != null && entityGroupActions.size() > 0) {
					myList.add(new GenericListPanel.CheckPanel(componentId + "-check", new Check("checkbox", model, group)));
				}
				myList.add(GenericListPanel.this.createNewListPanel(componentId + "-actions", model));
				Panel myActionPanel = new GenericListPanel.ActionPanel(componentId, myList);
/s
	protected AbstractActionsPanel<T> createNewListPanel(String componentId, IModel<T> model) {
		AbstractActionsPanel<T> myPanel = panelBuilder.build(componentId, webComponentEventSwitchBoard, this, model);
componentId	"cell-actions" (id=18743)	
/s
EntityListActionBuilder.build(String, WebComponentEventSwitchBoard, GenericListPanel<T>, IModel<T>) line: 44	
			createActions(view, aModel);
/s
	protected void createActions(RepeatingView view, IModel<T> aModel) {
		for (EntityAction<T> action : actions) {
			Component component = action.createComponent(view.newChildId(), aModel);
/s
EvoEditPage$4(EntityActionButton).createComponent(String, IModel<T>) line: 49	
		return new EntityABPanel(aComponentId, createButton(aModel, "button"));
aComponentId="1"
/s
EvoEditPage$4(AbstractEntityActionButton).createButton(IModel<T>, String) line: 207	
		button = createButtonInstance(aModel, aId);
/s

EntityActionAjaxButton$1.onSubmit(AjaxRequestTarget, Form<?>) line: 56	
	@Override
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new AjaxFallbackButton(aId, null) {
aId="button"
			@Override
			public boolean isEnabled() {
				return EntityActionAjaxButton.this.isEnabled(aModel);
			}

			@Override
			protected void onError(AjaxRequestTarget aTarget, Form<?> aForm) {
				EntityActionAjaxButton.this.onError(this, aTarget, aModel);
			}

			@Override
			protected void onSubmit(AjaxRequestTarget aTarget, Form<?> aForm) {
->				EntityActionAjaxButton.this.onSubmit(this, aTarget, aModel);
			}
		};
	} 
/ INTERESSANTE URL

/ Einde DEBUG PCT-231


/ NEW ISSUE PCT-231

Configuration, Administration, Properties
/ Geef reference2, filter
/ edit module.oms.shipmentitemsearch.reference2.hidden	,

WicketMessage: Error attaching this container for rendering: [Page class = com.mpobjects.oms.view.wicket.property.PropertyEditFormPage, id = 103, version = 0, ajax = 0]

Root cause:

org.hibernate.NonUniqueObjectException: a different object with the same identifier value was already associated with the session: [com.mpobjects.oms.model.entity.property.Property#26766799]
     at org.hibernate.engine.StatefulPersistenceContext.checkUniqueness(StatefulPersistenceContext.java:638)
     at org.hibernate.event.def.DefaultSaveOrUpdateEventListener.performUpdate(DefaultSaveOrUpdateEventListener.java:305)
     at org.hibernate.event.def.DefaultSaveOrUpdateEventListener.entityIsDetached(DefaultSaveOrUpdateEventListener.java:246)
     at org.hibernate.event.def.DefaultUpdateEventListener.performSaveOrUpdate(DefaultUpdateEventListener.java:57)
     at org.hibernate.event.def.DefaultSaveOrUpdateEventListener.onSaveOrUpdate(DefaultSaveOrUpdateEventListener.java:93)
     at org.hibernate.impl.SessionImpl.fireUpdate(SessionImpl.java:742)
     at org.hibernate.impl.SessionImpl.update(SessionImpl.java:730)
     at org.hibernate.impl.SessionImpl.update(SessionImpl.java:722)
->   at com.mpobjects.view.wicket.util.single.GenericFormPanel.reloadObject(GenericFormPanel.java:216)
     at com.mpobjects.view.wicket.util.single.GenericFormPanel.onBeforeRender(GenericFormPanel.java:112)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Page.onBeforeRender(Page.java:1555)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.Component.prepareForRender(Component.java:2297)
     at org.apache.wicket.Page.prepareForRender(Page.java:1545)
     at org.apache.wicket.Component.prepareForRender(Component.java:2329)
     at org.apache.wicket.Page.renderPage(Page.java:912)
     at org.apache.wicket.request.target.component.PageRequestTarget.respond(PageRequestTarget.java:63)
     at org.apache.wicket.request.AbstractRequestCycleProcessor.respond(AbstractRequestCycleProcessor.java:105)
     at org.apache.wicket.RequestCycle.processEventsAndRespond(RequestCycle.java:1287)
     at org.apache.wicket.RequestCycle.step(RequestCycle.java:1358)
     at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1465)
     at org.apache.wicket.RequestCycle.request(RequestCycle.java:545)
     at org.apache.wicket.protocol.http.WicketFilter.doGet(WicketFilter.java:486)
     at org.apache.wicket.protocol.http.WicketServlet.doGet(WicketServlet.java:138)
     at javax.servlet.http.HttpServlet.service(HttpServlet.java:697)
     at javax.servlet.http.HttpServlet.service(HttpServlet.java:810)
     at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)
     at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
     at com.mpobjects.control.filter.FirstLoginFilter.doFilter(FirstLoginFilter.java:76)
     at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
     at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:330)
     at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:118)
     at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:84)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:113)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:103)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:113)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:154)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:45)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:199)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:110)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at com.mpobjects.auth.springsec.RunAsLogoutFilter.doFilter(RunAsLogoutFilter.java:41)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.context.SecurityContextPersistenceFilter.doFilter(SecurityContextPersistenceFilter.java:87)
     at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
     at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:192)
     at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:160)
     at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:343)
     at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:260)
     at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
     at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
     at filters.SetCharacterEncodingFilter.doFilter(SetCharacterEncodingFilter.java:111)
     at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
     at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
     at org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:230)
     at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
     at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
     at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
     at org.jboss.web.tomcat.filters.ReplyHeaderFilter.doFilter(ReplyHeaderFilter.java:96)
     at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
     at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
     at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)
     at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:178)
     at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java)
     at org.jboss.web.tomcat.security.SecurityAssociationValve.invoke(SecurityAssociationValve.java:175)
     at org.jboss.web.tomcat.security.JaccContextValve.invoke(JaccContextValve.java:74)
     at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)
     at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)
     at org.jboss.web.tomcat.tc5.jca.CachedConnectionValve.invoke(CachedConnectionValve.java:156)
     at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)
     at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)
     at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)
     at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)
     at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)
     at org.apache.tomcat.util.net.MasterSlaveWorkerThread.run(MasterSlaveWorkerThread.java:112)
     at java.lang.Thread.run(Thread.java:745)

/ Het probleem in in de method bij ->

/ Einde NEW ISSUE PCT-231

/ DEBUG PCT-231

/ Wat gebeurt er als we een properties insert met de GUI? Kunnen we dit ook met de hand?

<hibernate-mapping>
	<class name="com.mpobjects.oms.model.propertiesvalue.vo.PropertiesValueVO" table="PROPERTIES_VALUE">
		<id name="systemId" type="int" unsaved-value="0">
			<column name="SYSTEM_ID" />
			<generator class="com.mpobjects.core.model.HibernateIdGenerator" />
		</id>

/ TODO

/ Einde DEBUG PCT-231


/ DEBUG PCT-231

/ 7	. 

/ we doen	,
Planning, Shipment Order, Search	,

/ addDatabaseJoinColumnh	, addDatabaseColumn	,

$ vi shipment-order_list.xml

            if (!myTable.isFieldHidden("orderprocessonlistpage")) {
	            myTable.addDatabaseJoinColumn("shipment_order_process", "code", 15); 

/ we vallen in	, 
.isFieldHidden
/ Daarna	,
/ we vallen in	,
279: Table.addDatabaseJoinColumn(String, String, int) line: 280	
		DatabaseColumn myColumn = new DatabaseJoinColumn(aName, aDBColumn, aPosition);
aName	"shipment_order_process" (id=18522)	
aDBColumn	"code" (id=21454)	
aPosition	15	

/s
DatabaseJoinColumn.<init>(String, String, int) line: 15	
		super(aName, aDBColumn);
/s

/ 7	.

	public void addDatabaseColumn(String aName, String aDBColumn) {
aName	"total_weight_kg" (id=20174)	
aDBColumn	"total_weight_kg" (id=20174)	
		DatabaseColumn myColumn = new DatabaseColumn(aName, aDBColumn);
myColumn	DatabaseColumn  (id=20224)	
	theDBColumn	"total_weight_kg" (id=20174)	
	theName	"total_weight_kg" (id=20174)	

		addColumn(myColumn);
Table.addColumn(Column) line: 999	
		columns.add(aColumn);
[Column:SYSTEMID,
 Column:shipment_order_process,
 Column:shipment_order_id,
 Column:status,
 Column:customer_status,
 Column:description,
 Column:hold_status,
 Column:shipment_type,
 Column:total_weight_kg]




/ Einde DEBUG PCT-231

/ ISB-729

/ 7	. 

[eric@localhost bin]$ cat isb-db-a.sh 
PGPASSWORD=mpopostgres@mpo psql -U mpopostgres -h  interstream-a.intermax.mp-objects.com isbscs 

[eric@localhost Backup]$ pwd
/home/eric/Devel/Postgres/Backup
[eric@localhost Backup]$ PGPASSWORD=mpopostgres@mpo pg_dump -U mpopostgres -Fc -h interstream-a.intermax.mp-objects.com isbscs >isbscs-a-2015-13-07.dump

/ WAS db isbscs2 
[eric@localhost isbscs]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/isbscs
[eric@localhost isbscs]$ cat deploy/postgres-ds.xml
		<xa-datasource-property name="DatabaseName">isbscs2</xa-datasource-property>
	
/ login local db	,
[eric@localhost LOGS]$ PGPASSWORD=mpopostgres@mpo psql -U mpopostgres isbs 
pnloms7=# create database isbscs4; 
CREATE DATABASE

[eric@localhost Backup]$ PGPASSWORD=mpopostgres@mpo pg_restore -Fc -U mpopostgres -d  isbscs4  isbscs-a-2015-13-07.dump
/ OK

/ NU 	,
[eric@localhost isbscs]$ cat deploy/postgres-ds.xml
	<xa-datasource>
		<xa-datasource-property name="DatabaseName">isbscs4</xa-datasource-property>
		...
	<local-tx-datasource>
                <connection-url>jdbc:postgresql://127.0.0.1:5432/isbscs4</connection-url>


/ 7	. 

/ Kies finance, carrier invoice, search
/ kies inv-26	(invoice status: INITIAL)
/ onder invoice line	, click 'Edit mode'	, 
/ rm de onderste	, Freight	,
/ click (Save, en daarna ) Save and close	,
/ click Save and close on the header	, 
/ open inv-26 again	, we zien dat de Freight detail er nog steeds is	,

/ als we de bovenste detail rm, freight commission	, dan verdwijnen BEIDE details	,
/ ERR
/ Als we Save and close, en de header ook Save and close, en weer open , en weer Edit mode	, dan zijn ze er allebei weer	,

  
/ Einde ISB-729

/ DEBUG ISB-729

/ 7		.

finance, carrier invoice, search
/=
invoice-header_list

$ vi invoice-sitemap.xmap 
			<map:match pattern="invoice-header_list">
				<map:act type="invoiceHeaderList"/>
				<map:call resource="dynatablePage" >
					<map:parameter name="xsp" value="xsp/invoice-header_list.xml" />
				</map:call>
			</map:match>

			<map:action logger="invoice" name="invoiceHeaderList"   src="com.mpobjects.invoice.control.invoiceheader.action.InvoiceHeaderListAction"/>

/ 7	. 

/ we remove b's	,
/ BREAKPOINTS LANGUAGEMANAGER
	protected static InputStream getLanguageResource(@Nonnull Locale aLocale) {
	public String get(String aTableName, String aField) {
	public String getByJavaName(String anEntityName, String aFieldName) {

/  7		. 

/ Als we geven finance, carrier-invoce, search, dan komen we in eerst in InvoiceHeaderListAction.act, en dan in invoice-header_list.xml	, en hij bouwt de query/myTable (TODO)  op	, 

				String myQuery = "SELECT * FROM INVOICE_HEADER WHERE ORGANIZATION_SYSTEMID IN {USER_ORGANIZATIONS} " +
				"-#1 AND FINANCIAL_PARTY_SYSTEMID in (SELECT SYSTEM_ID FROM INVOICE_FINANCIAL_PARTY WHERE ?)  #-" +
				"-#2 AND CURRENCY_SYSTEMID in (SELECT SYSTEM_ID FROM CURRENCY WHERE ?)  #-" +
				"-#11 AND INVOICE_ORGANIZATION_ID IN (SELECT SYSTEM_ID FROM ORGANIZATION WHERE ?)#-";
				
				// You need the join column logic otherwise TMS will only filter the create date on screen
				
				myTable.setQuery(myQuery, myMaxResult);

				myTable.addHiddenColumn("SYSTEMID");
				myTable.addDatabaseJoinColumn("Invoice_organization", "organization_id", Column.TYPE_STRING, 11);

/ Hij calls al die Table methods	, .addDatabaseColumn, ...

/ als we het filter click 	, dan komen we ook in InvoiceHeaderListAction.act, en dan in 
/ Dan 	,
InvoiceHeaderView.executeDynaQuery(DynaQuery) line: 28	
			return InvoiceHeaderUtil.getDAO().executeDynaQuery(aQuery);
SELECT * FROM INVOICE_HEADER WHERE ORGANIZATION_SYSTEMID IN {USER_ORGANIZATIONS} -#1 AND FINANCIAL_PARTY_SYSTEMID in (SELECT SYSTEM_ID FROM INVOICE_FINANCIAL_PARTY WHERE ?)  #--#2 AND CURRENCY_SYSTEMID in (SELECT SYSTEM_ID FROM CURRENCY WHERE ?)  #--#11 AND INVOICE_ORGANIZATION_ID IN (SELECT SYSTEM_ID FROM ORGANIZATION WHERE ?)#-
/s
InvoiceHeaderDAOImpl
	@Deprecated
	public List<InvoiceHeaderVO> executeDynaQuery(DynaQuery aQuery) {
		String mySql = aQuery.toSQL();
SELECT * FROM INVOICE_HEADER WHERE ORGANIZATION_SYSTEMID IN (0,500,520,510,550,530,3150,1) 
/ Wat tussen #...#'s staat, wordt verwijderd	, 
		if (StringUtils.isNotEmpty(aQuery.getOrderByColumn())) {
			mySql = mySql + " order by " + aQuery.getOrderByColumn() + " " + aQuery.getOrderByDirection();
		}
		return executeSqlSelect(mySql, "IH");
/ Hibernate 	,

/ Dan Table.addRow's	,

/ Als we in de filter inv-26 geven	, wordt er geen query meer gedaan	,

/ 13	. 

/ we geven eerst inv-26 in het filter, en daarna filter op leeg	,

InvoiceHeaderView.executeDynaQuery(DynaQuery) line: 28	
		try {
			return InvoiceHeaderUtil.getDAO().executeDynaQuery(aQuery);
aQuery=
theFilterList	ArrayList  (id=18341)	
[inv-26]
SELECT * FROM INVOICE_HEADER WHERE ORGANIZATION_SYSTEMID IN {USER_ORGANIZATIONS} -#1 AND FINANCIAL_PARTY_SYSTEMID in (SELECT SYSTEM_ID FROM INVOICE_FINANCIAL_PARTY WHERE ?)  #--#2 AND CURRENCY_SYSTEMID in (SELECT SYSTEM_ID FROM CURRENCY WHERE ?)  #--#11 AND INVOICE_ORGANIZATION_ID IN (SELECT SYSTEM_ID FROM ORGANIZATION WHERE ?)#-
/s
InvoiceHeaderDAOImpl.executeDynaQuery(DynaQuery) line: 50	

/ Intermezzo

/ we komen hier 	, want in invoice-header_list.xml	,
		<dynatable:populate>
			<xsp:logic>
				InvoiceHeaderView myView = new InvoiceHeaderView();
				Collection myList = myView.executeDynaQuery(myTable.getDynaQuery());

		String mySql = aQuery.toSQL();

/ Einde Intermezzo
/s
DynaQuery.toSQL() line: 122	

		if (theFilterList.size() > 0) {
[inv-26]
/ JA
				myFilter = new DatabaseFilter(myFilter.getFilterExpression(), (DatabaseColumn) myFilter.getColumn());
/ myFilter.getFilterExpression()="inv-26"
/ myFilter.getColumn()=Column:Invoice_number
				mySQL = myFilter.toSQL();
upper(Invoice_number) LIKE '%INV-26%'

				if (myColumn instanceof DatabaseJoinColumn) {
/ NEE
				} else {
					if (StringUtils.isNotEmpty(mySQL)) {
						if (myFirst) {
/ NEE
						} else {
							myBuffer.append(" and " + mySQL);
 and upper(Invoice_number) LIKE '%INV-26%'

		if (myQuery.indexOf(USER_ORGANIZATIONS) > -1) {
SELECT * FROM INVOICE_HEADER WHERE ORGANIZATION_SYSTEMID IN {USER_ORGANIZATIONS} -#1 AND FINANCIAL_PARTY_SYSTEMID in (SELECT SYSTEM_ID FROM INVOICE_FINANCIAL_PARTY WHERE ?)  #--#2 AND CURRENCY_SYSTEMID in (SELECT SYSTEM_ID FROM CURRENCY WHERE ?)  #--#11 AND INVOICE_ORGANIZATION_ID IN (SELECT SYSTEM_ID FROM ORGANIZATION WHERE ?)#-
			myQuery = myQuery.replace(USER_ORGANIZATIONS, getUserOrganizations());
SELECT * FROM INVOICE_HEADER WHERE ORGANIZATION_SYSTEMID IN (0,500,520,510,550,530,3150,1) -#1 AND FINANCIAL_PARTY_SYSTEMID in (SELECT SYSTEM_ID FROM INVOICE_FINANCIAL_PARTY WHERE ?)  #--#2 AND CURRENCY_SYSTEMID in (SELECT SYSTEM_ID FROM CURRENCY WHERE ?)  #--#11 AND INVOICE_ORGANIZATION_ID IN (SELECT SYSTEM_ID FROM ORGANIZATION WHERE ?)#-

/ Dan #'s eraf	,
...

		myQuery += myBuffer.toString();
SELECT * FROM INVOICE_HEADER WHERE ORGANIZATION_SYSTEMID IN (0,500,520,510,550,530,3150,1)  and upper(Invoice_number) LIKE '%INV-26%'

/t
InvoiceHeaderDAOImpl.executeDynaQuery(DynaQuery) line: 55	
		return executeSqlSelect(mySql, "IH");

/ INTERMEZZO

/ we zien in de postgres log	,
LOG:  execute <unnamed>: SELECT * FROM INVOICE_HEADER WHERE ORGANIZATION_SYSTEMID IN (0,500,520,510,550,530,3150,1)  and upper(In      0 voice_number) LIKE '%INV-26%'
      0 LOG:  execute <unnamed>: select ... 
from INVOICE_FINANCIAL_PARTY financialp0_ where f      0 inancialp0_.SYSTEM_ID in ($1, $2)
      0 DETAIL:  parameters: $1 = '27071973', $2 = '240093'
      0 LOG:  execute <unnamed>: select ... 
from INVOICE_VAT_POLICY va      0 tpolicy0_ where vatpolicy0_.SYSTEM_ID=$1
      0 DETAIL:  parameters: $1 = '26605695'

/ Einde  INTERMEZZO

/ Dan Table.addRow call	, 1 dit keer	,

/ 7	. 

/ we geven inv-22 in de filter	,

/ we zien de queries	,

  19012 LOG:  execute <unnamed>: SELECT * FROM INVOICE_HEADER WHERE ORGANIZATION_SYSTEMID IN (0,500,520,510,550,530,3150,1)  and upper(In
  19012 voice_number) LIKE '%INV-22%'
  19013 LOG:  execute <unnamed>: select ... 
from INVOICE_FINANCIAL_PARTY financialp0_ where f  19013 inancialp0_.SYSTEM_ID in ($1, $2)
  19014 DETAIL:  parameters: $1 = '27071973', $2 = '240035'

/ en weer 1 addRow	,

/ 13	.

/ we filter met leeg	,

	public List<InvoiceHeaderVO> executeDynaQuery(DynaQuery aQuery) {
		String mySql = aQuery.toSQL();
SELECT * FROM INVOICE_HEADER WHERE ORGANIZATION_SYSTEMID IN (0,500,520,510,550,530,3150,1) 

		return executeSqlSelect(mySql, "IH");

LOG:  execute <unnamed>: SELECT * FROM INVOICE_HEADER WHERE ORGANIZATION_SYSTEMID IN (0,500,520,510,550,530,3150,1) 
  21471 LOG:  execute <unnamed>: select ... 
from INVOICE_FINANCIAL_PARTY financialp0_ where f  21471 inancialp0_.SYSTEM_ID in ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)
  21472 DETAIL:  parameters: $1 = '26605102', $2 = '230002', $3 = '26602885', $4 = '27071973', $5 = '240093', $6 = '240028', $7 = '240004  21472 ', $8 = '240041', $9 = '240059', $10 = '240035'
  21473 LOG:  execute <unnamed>: select ... 
from INVOICE_VAT_POLICY va  21473 tpolicy0_ where vatpolicy0_.SYSTEM_ID=$1
  21474 DETAIL:  parameters: $1 = '26607045'
  21475 LOG:  execute S_1: COMMIT

/ we zien meerdere Table.addRow calls	,


/ 13	. 

/ we zien de tables	,
 public | invoice_detail                  | table | mpopostgres
 public | invoice_f_p_bank_account        | table | mpopostgres
 public | invoice_f_p_range               | table | mpopostgres
 public | invoice_financial_party         | table | mpopostgres
 public | invoice_financial_party_binding | table | mpopostgres
 public | invoice_header                  | table | mpopostgres
 public | invoice_header_status           | table | mpopostgres
 public | invoice_header_surcharge        | table | mpopostgres
 public | invoice_line                    | table | mpopostgres
 public | invoice_match_status            | table | mpopostgres
 public | invoice_payment_account         | table | mpopostgres
 public | invoice_payment_batch           | table | mpopostgres
 public | invoice_vat_policy              | table | mpopostgres

/ 7	. 

/ Hoe de filters via XSP?

$ vi dynatable.js
...

$ vi generic-dynatablepage.xsl
...
/ TODO

/ 7	. 

/ we geven INV-26 en click edit	,

/ we zien in de hibernate log	,
75639 2015-07-14 13:41:34,690 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-1:) 
SELECT * 
FROM INVOICE_HEADER 
WHERE ORGANIZATION_SYSTEMID IN (0,500,520,510,550,530,3150,1)  
and upper(Invoice_number) LIKE '%INV-26%'


/ Dit is invoice-header_edit in sitemap	,

$ vi invoice-sitemap.xmap
			<map:match type="regexp" pattern="^invoice-header_(edit|create)$">
				<map:act type="invoiceHeaderForm"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/invoice-header_edit.jsp"/>
			</map:match>

			<map:action logger="invoice" name="invoiceHeaderForm"   src="com.mpobjects.invoice.control.invoiceheader.action.InvoiceHeaderFormAction"/>

/ we vallen eerst in 	,
InvoiceHeaderFormAction.act() line: 45	
		int mySystemId = getSystemIdFromRequest();
27126553
		if (mySystemId == 0) {
/ NEE
		} else {
			myVO = InvoiceHeaderUtil.getDAO().getBySystemId(mySystemId);
/s
GenericHibernateDAO.java
	@Override
	public Type getBySystemId(int aSystemId) {
		if (aSystemId == ValueObject.VOLATILE_SYSTEM_ID) {
/ NEE
		} else {
				return type.cast(getHibernateTemplate().load(type, aSystemId));

/ we zien NIETS in postgres log	, het is een load, en is al in de cache, WH L1 cache	,

/ 13	. 

/ In de JSP	,

				<div id="invoiceCostType" />
				<mpo:list data="${invoiceHeaderCostTypeList}" name="Match results on cost type">
					...
/ Daarom	,
			List<CostTypeInvoiceMatchVO> myCostTypeInvoiceMatchList = MpoBeanFactory.getBean(CostTypeInvoiceMatchDAO.class).getCostTypesForInvoice(
					myVO.getSystemId());
			getRequest().setAttribute("invoiceHeaderCostTypeList", myCostTypeInvoiceMatchList);

/ we debug	,
			List<CostTypeInvoiceMatchVO> myCostTypeInvoiceMatchList = MpoBeanFactory.getBean(CostTypeInvoiceMatchDAO.class).getCostTypesForInvoice(
					myVO.getSystemId());
/ Alvast antwoord,	
[]
/s
CostTypeInvoiceMatchDAOImpl.getCostTypesForInvoice(int) line: 41	
		DetachedCriteria myCriteria = DetachedCriteria.forClass(CostTypeInvoiceMatchVO.class).add(Restrictions.eq("invoiceHeaderSystemId", aInvoiceId));
		return getHibernateTemplate().findByCriteria(myCriteria);

/ we zien in postgresql log	,
  30209 LOG:  execute <unnamed>: BEGIN
  30210 LOG:  execute <unnamed>: select this_.SYSTEM_ID as SYSTEM1_186_0_, this_.INVOICE_HEADER_SYSTEMID as INVOICE2_186_0_, this_.COST_T
  30210 YPE_SYSTEMID as COST3_186_0_, this_.AMOUNT_MATCHED as AMOUNT4_186_0_, this_.AMOUNT_UNMATCHED as AMOUNT5_186_0_, this_.AMOUNT_UNRE
  30210 FERENCED as AMOUNT6_186_0_ from COST_TYPE_INVOICE_MATCH this_ where this_.INVOICE_HEADER_SYSTEMID=$1
  30211 DETAIL:  parameters: $1 = '27126553'
  30212 LOG:  execute S_1: COMMIT

/t
InvoiceHeaderFormAction.act() line: 89	
/d
			// Check Totals
			myVO.setMustCheckTotals(true);
			InvoiceHeaderUtil.getInvoiceHeaderService().checkTotals(myVO);
/s
SupplierInvoiceServiceImpl.checkTotals(InvoiceHeaderVO) line: 318	
			Collection<InvoiceDetailVO> myInvoiceHeaderDetailList = getInvoiceHeaderDetailList(myVO.getSystemId());
/s
SupplierInvoiceServiceImpl.getInvoiceHeaderDetailList(int) line: 818	
		return invoiceDetailDAO.getInvoiceDetailList(anInvoiceHeaderSystemId);
/s
InvoiceDetailDAOImpl.getInvoiceDetailList(int) line: 115	
		StringBuilder mySQL = new StringBuilder("SELECT ID.* FROM INVOICE_DETAIL ID, INVOICE_LINE IL  WHERE ID.INVOICE_LINE_SYSTEMID"
				+ "= IL.SYSTEM_ID AND IL.INVOICE_HEADER_SYSTEMID = :invoiceHeaderSystemId AND ID.IS_DELETED  =0 AND IL.IS_DELETED =0");
		Collection<QueryParameter> params = new ArrayList<QueryParameter>();
		params.add(new IntNamedQueryParameter("invoiceHeaderSystemId", aInvoiceSystemId));
		return executeSqlSelect(mySQL.toString(), "ID", params);

/t
SupplierInvoiceServiceImpl.checkTotals(InvoiceHeaderVO) line: 326	
			Collection<InvoiceDetailVO> myInvoiceHeaderDetailList = getInvoiceHeaderDetailList(myVO.getSystemId());
/d
/ we zien in de postgres log	,

  32726 LOG:  execute <unnamed>: SET SESSION CHARACTERISTICS AS TRANSACTION ISOLATION LEVEL REPEATABLE READ
  32727 LOG:  execute <unnamed>: BEGIN
  32728 LOG:  execute <unnamed>: SELECT ID.* FROM INVOICE_DETAIL ID, INVOICE_LINE IL  WHERE ID.INVOICE_LINE_SYSTEMID= IL.SYSTEM_ID AND IL  32728 .INVOICE_HEADER_SYSTEMID = $1 AND ID.IS_DELETED  =0 AND IL.IS_DELETED =0
  32729 DETAIL:  parameters: $1 = '27126553'
  32730 LOG:  execute <unnamed>: select ... 
from RATE_COMPONENT_TYPE ratecompon0_ where ratecompon0_.SYSTEM_ID in  32730  ($1, $2)
  32731 DETAIL:  parameters: $1 = '26671397', $2 = '26600544'
  32732 LOG:  execute <unnamed>: select ... 
from RATE_COMPONENT_INV_MAPPING invoicemap0_ where invoicemap0_.TYPE_SYSTEMID in ($1, $2)
  32733 DETAIL:  parameters: $1 = '26671397', $2 = '26600544'
  32737 LOG:  execute S_1: COMMIT

/ myInvoiceHeaderDetailList]=
[SystemId:27126556	Amount:-361.50000	VAT:-75.92000	VATTariff:HIGH	CostType:com.mpobjects.oms.model.ratecomponenttype.RateComponentType@78536fdd[systemId=26671397,code=Freight Commission,description=Freight Commission for ISB,group=COST,reasonMandatory=false,deleted=false,sequenceNr=60]	InvoiceLine:27126554	User 10100	Create date: 2015-06-18 11:39:35.245	, 
SystemId:27126558	Amount:7230.00000	VAT:1518.30000	VATTariff:HIGH	CostType:com.mpobjects.oms.model.ratecomponenttype.RateComponentType@65928cb3[systemId=26600544,code=Freight,description=Freight Cost,group=COST,reasonMandatory=false,deleted=false,sequenceNr=10]	InvoiceLine:27126554	User 10100	Create date: 2015-06-18 11:39:35.293	]

...
/ dan	,
			} else {
				save(myVO);
myVO	InvoiceHeaderVO  (id=20071)	
/s
SupplierInvoiceServiceImpl.save(InvoiceHeaderVO) line: 1136	
		// Save or update
		InvoiceHeaderVO myOldInvoiceHeader = getOld(anInvoiceHeader);
/s
			myOld = invoiceHeaderDAO.getBySystemId(anInvoice.getSystemId());
/d
/ we zien in postgres log	,

  32726 LOG:  execute <unnamed>: SET SESSION CHARACTERISTICS AS TRANSACTION ISOLATION LEVEL REPEATABLE READ
  32727 LOG:  execute <unnamed>: BEGIN
  32728 LOG:  execute <unnamed>: SELECT ID.* FROM INVOICE_DETAIL ID, INVOICE_LINE IL  WHERE ID.INVOICE_LINE_SYSTEMID= IL.SYSTEM_ID AND IL  32728 .INVOICE_HEADER_SYSTEMID = $1 AND ID.IS_DELETED  =0 AND IL.IS_DELETED =0
  32729 DETAIL:  parameters: $1 = '27126553'
  32730 LOG:  execute <unnamed>: select ... 
from RATE_COMPONENT_TYPE ratecompon0_ where ratecompon0_.SYSTEM_ID in  32730  ($1, $2)
  32731 DETAIL:  parameters: $1 = '26671397', $2 = '26600544'
  32732 LOG:  execute <unnamed>: select ... 
from RATE_COMPONENT_INV_MAPPING invoicemap0_ where invoicemap0_.TYPE_SYSTEMID in ($1, $2)
  32733 DETAIL:  parameters: $1 = '26671397', $2 = '26600544'
  32734 LOG:  execute <unnamed>: BEGIN
  32735 LOG:  execute <unnamed>: select ... 
from INTERFACE_TRIGGER_EV  32735 ENT this_ where this_.INTERFACE_ID=$1 and this_.STATUS=$2 and this_.EVENT_DATE between $3 and $4 order by this_.EVENT_DATE asc li  32735 mit $5
  32736 DETAIL:  parameters: $1 = 'ADD_SERVICE_ORDER_PRICE_PART', $2 = '1', $3 = '2015-04-16 11:21:45.549', $4 = '2015-07-15 11:21:45.549  32736 ', $5 = '50'
  32737 LOG:  execute S_1: COMMIT

/ dan	,
		InvoiceHeaderVO myNewInvoiceHeader = invoiceHeaderDAO.merge(anInvoiceHeader);
/s
InvoiceHeaderDAOImpl(GenericHibernateDAO).merge(Type) line: 428	
			anObject = type.cast(getHibernateTemplate().merge(anObject));

/t
InvoiceHeaderFormAction.act() line: 92	
			InvoiceHeaderUtil.getInvoiceHeaderService().checkTotals(myVO);
/d

/ we zien in postgres log	,
  49075 LOG:  execute <unnamed>: update INVOICE_HEADER set LAST_UPDATE=$1, APPROVEMENT_EMPLOYEE=$2, APPROVEMENT_REMARKS=$3, DEBLOCK_EMPLO
  49075 YEE=$4, INVOICE_POD_STATUS=$5, INVOICE_HEADER_STATUS=$6, INVOICE_RECHARGE_STATUS=$7, INVOICE_TYPE=$8, RECHARGE_DATE=$9, RECHARGE_
  49075 MARK_NUMBER=$10, REGISTER_EMPLOYEE=$11, CARRIER_TOTAL_AMOUNT_EXC_VAT=$12, CARRIER_TOTAL_AMOUNT_INC_VAT=$13, CREATE_DATE=$14, INVO
  49075 ICE_DATE=$15, INVOICE_DUE_DATE=$16, INVOICE_NUMBER=$17, RECEIPT_DATE_COPY=$18, RECEIPT_DATE_ORIGINAL=$19, MARK_NUMBER=$20, MATCHI
  49075 NG_ERROR_CODE=$21, MATCH_RUN_NUMBER=$22, REMARK=$23, TOTAL_INVOICE_AMOUNT_EXC_VAT=$24, TOTAL_INVOICE_AMOUNT_FREE_VAT=$25, TOTAL_I
  49075 NVOICE_AMOUNT_HIGH_VAT=$26, TOTAL_INVOICE_AMOUNT_LOW_VAT=$27, TOTAL_INVOICE_AMOUNT_REV_VAT=$28, TOTAL_VAT_AMOUNT_HIGH=$29, TOTAL_
  49075 VAT_AMOUNT_LOW=$30, USER_SYSTEMID=$31, WARNING_CHECK_TOTAL=$32, VAT_NUMBER_RECEIVER=$33, VAT_NUMBER_SENDER=$34, CURRENCY_SYSTEMID
  49075 =$35, COUNTRY_SENDER_SYSTEMID=$36, COUNTRY_RECEIVER_SYSTEMID=$37, FINANCIAL_PARTY_SYSTEMID=$38, RECEIVER_SYSTEMID=$39, INVOICE_PA
  49075 YMENT_BATCH_SYSTEMID=$40, VAT_POLICY_SYSTEMID=$41, INVOICE_ORGANIZATION_ID=$42, ORGANIZATION_SYSTEMID=$43, INVOICE_TEMPLATE_SYSTE
  49075 MID=$44, DOCUMENT_SYSTEMID=$45, REPORT_DATE=$46, TAX_1_BASE_AMOUNT=$47, TAX_1_TAX_AMOUNT=$48, TAX_1_TAX_TARIFF=$49, TAX_1_TAX_TYP
  49075 E=$50, TAX_1_DESCRIPTION=$51, TAX_2_BASE_AMOUNT=$52, TAX_2_TAX_AMOUNT=$53, TAX_2_TAX_TARIFF=$54, TAX_2_TAX_TYPE=$55, TAX_2_DESCRI
  49075 PTION=$56, TAX_3_BASE_AMOUNT=$57, TAX_3_TAX_AMOUNT=$58, TAX_3_TAX_TARIFF=$59, TAX_3_TAX_TYPE=$60, TAX_3_DESCRIPTION=$61, TAX_4_BA
  49075 SE_AMOUNT=$62, TAX_4_TAX_AMOUNT=$63, TAX_4_TAX_TARIFF=$64, TAX_4_TAX_TYPE=$65, TAX_4_DESCRIPTION=$66 where SYSTEM_ID=$67
  49076 DETAIL:  parameters: $1 = '2015-07-15 12:20:22.938', $2 = NULL, $3 = '', $4 = NULL, $5 = 'UNKNOWN', $6 = 'INITIAL', $7 = 'NOT_REC
  49076 HARGED', $8 = 'SELF_BILL', $9 = NULL, $10 = NULL, $11 = NULL, $12 = '0.00000', $13 = '0.00000', $14 = '2015-06-18 11:39:35.183', 
  49076 $15 = '2015-06-18 11:39:00', $16 = '2015-07-18 00:00:00', $17 = 'INV-26', $18 = NULL, $19 = NULL, $20 = 'INV-26', $21 = '', $22 =
  49076  NULL, $23 = '', $24 = '6868.50000', $25 = '0.00000', $26 = '6868.50000', $27 = '0.00000', $28 = '0.00000', $29 = '1442.38000', $
  49076 30 = '0.00000', $31 = '10100', $32 = '', $33 = 'NL800353699B01', $34 = 'NL808413363B02', $35 = '7001', $36 = '4153', $37 = '4153'
  49076 , $38 = '27071973', $39 = '240093', $40 = NULL, $41 = '26605695', $42 = '520', $43 = '520', $44 = '27081416', $45 = '27126960', $
  49076 46 = NULL, $47 = NULL, $48 = NULL, $49 = NULL, $50 = NULL, $51 = NULL, $52 = NULL, $53 = NULL, $54 = NULL, $55 = NULL, $56 = NULL
  49076 , $57 = NULL, $58 = NULL, $59 = NULL, $60 = NULL, $61 = NULL, $62 = NULL, $63 = NULL, $64 = NULL, $65 = NULL, $66 = NULL, $67 = '
  49076 27126553'
  49077 LOG:  execute S_1: COMMIT

/ 13	. 
InvoiceHeaderFormAction.act() line: 110	
			getRequest().setAttribute("invoiceHeaderCostTypeList", myCostTypeInvoiceMatchList);
/d

/ 13	. 

/ In de JSP	,
				<div id="invoiceLineArea">
					<b style="visibility: hidden; font-size: 20px">Hid${formVO.systemId}</b>
					<iframe class="invoiceline" src="invoice-line_view?invoiceheadersystemid=${formVO.systemId}&readOnly=${isReadOnly}" />
					</iframe>
				</div>

//////////////////////////////////////
/ we zien nu invoice-line.jsp in de <iframe/>	, maar als we straks 'Edit' hebben clicked, dan komt daar invoice-multiline.jsp voor in de plaats,	

$ vi invoice-sitemap.xmap
			<map:match pattern="invoice-line_view">
				<map:act type="invoiceLine"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/invoice-line.jsp"/>
			</map:match>	

			<map:action logger="invoice" name="invoiceLine"   	    src="com.mpobjects.invoice.control.invoiceline.action.InvoiceLineAction"/>			

$ vi invoice-line.jsp

/ we zien de 3 links, vergrootglas, en 2 lines	,
      <mpo:form readOnly="${isReadOnly}">
			<div id="invoiceLineInFrame">
				<a href="invoice-line_list?invoiceheadersystemid=${invoiceHeaderVO.systemId}&amp;systemid=${invoiceHeaderVO.systemId}&amp;refresh=false&amp;screenId=invoice-line_list"> <img src="../lookandfeel/styles/images/icons/table_sql_view16.gif" id="currency_icon" class="selector_icon" border="0"></a>
				<p>Multiple input:<br/>
			 	<c:if test="${invoiceHeaderVO.modifiedEditModeType == 'edit'}">
				<a href="invoice-multiline_create?invoiceheadersystemid=${invoiceHeaderVO.systemId}&amp;systemid=${invoiceHeaderVO.systemId}&amp;refresh=true&amp;screenId=invoice-multiline_create&amp;base_controlFlow=false">Create mode: add a new page</a>
				<br />
				</c:if> 
				<a href="invoice-multiline_edit?invoiceheadersystemid=${invoiceHeaderVO.systemId}&amp;systemid=${invoiceHeaderVO.systemId}&amp;refresh=true&amp;screenId=invoice-multiline_edit&amp;base_controlFlow=false">Edit mode</a></p>

				<div id="invoiceDetailInFrame">
				<c:if test="${formVO.systemId > 0 }">
					<mpo:list data="${invoiceDetailList}" name="invoiceDetail">
						<c:if test="${!isReallyReadOnly}">
							<mpo:action name="edit" />
 							  <c:if test="${formVO.invoiceHeaderVO.statusInitial}">
								<mpo:action name="create" context="list" />
							</c:if>	
						</c:if>
						<mpo:numberField type="float" name="amount" />
						<mpo:numberField type="float" name="amountVat" />
						<mpo:field name="vatTarifType" />
						<mpo:field name="costTypeVO.code" />
						<mpo:field name="invoiceDetailMatchStatusVO.code" />
						<mpo:field name="matchingErrorCode" />
						<mpo:booleanField name="surchargeBased" />
					</mpo:list>
			</c:if></div>
		</mpo:form>

/ we vallen in	,
InvoiceLineAction.act() line: 29	

/ we zien de invoice-header_edit.jsp al	, alleen de invoice-line.jsp is er nog niet	,
/ we zien	,
<div id="invoiceLineArea">
					<b style="visibility: hidden; font-size: 20px">Hid27126553</b>
					<iframe class="invoiceline" src="invoice-line_view?invoiceheadersystemid=27126553&amp;readOnly=false">
						<html><head></head><body></body></html>
					</iframe>
				</div>
/ Dat klopt	, de <iframe/> staat in invoice-header_edit.jsp	,

		myInvoiceHeaderVO = InvoiceHeaderUtil.getDAO().getBySystemId(getInvoiceHeaderSystemIdFromRequest());
27126553
/ we zien NIETS in postgres log	, WH uit L1 of L2 cache	,

		if (mySystemId != 0) {
/ NEE

/ we geven continue	,
SetFormVOTag.doStartTag() line: 91	
/ prints	,
<!--/ fields bount to class com.mpobjects.invoice.model.invoiceline.vo.InvoiceLineVO(systemid:0)\-->
<!--\ end of binding toclass com.mpobjects.invoice.model.invoiceline.vo.InvoiceLineVO(systemid:0)/-->


/ 7	. 

/ we click 'Edit mode'	,
/ dat is invoice-multiline_edit	, 

//////////////////////////////////////
/ we zagen zonet invoice-line.jsp in de <iframe/>	, maar omdat we 'Edit' hebben clicked, komt er invoice-multiline.jsp voor in de plaats,	

/ Intermezzo

$ vi invoice-sitemap.xmap
			<!-- multiline -->
			<map:match type="regexp" pattern="^invoice-multiline_(edit|create)$">
				<map:act type="setAttributes" >
					<map:parameter name="attributesType" value="request"/>
     				<map:parameter name="edit-type" value="{1}"/>
     				<map:parameter name="base_controlFlow" value="false" />
                </map:act>
				<map:act type="invoiceMultiLineForm"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/invoice-multiline_edit.jsp"/>
			</map:match>

/ 13	. 

/ Intermezzo

/ Hibernate	,

$ vi ./module/invoice/src/java/com/mpobjects/invoice/model/invoiceheader/dao/InvoiceHeader.standard.hbm.xml

	<class name="com.mpobjects.invoice.model.invoiceheader.vo.InvoiceHeaderVO" table="INVOICE_HEADER" lazy="false">
/ TODO HIBERNATE

		<set name="surcharges" inverse="true" >
			<cache usage="read-write"/>
			<key column="INVOICE_HEADER_SYSTEMID" />
			<one-to-many class="com.mpobjects.invoice.model.invoiceheadersurcharge.vo.InvoiceHeaderSurchargeVO" />
		</set>

$ vi ./module/invoice/src/java/com/mpobjects/invoice/model/invoiceheadersurcharge/dao/InvoiceHeaderSurcharge.standard.hbm.xml

<hibernate-mapping>
    <class name="com.mpobjects.invoice.model.invoiceheadersurcharge.vo.InvoiceHeaderSurchargeVO" table="INVOICE_HEADER_SURCHARGE">
 
		<many-to-one name="invoiceHeaderVO" column="INVOICE_HEADER_SYSTEMID"	
			class="com.mpobjects.invoice.model.invoiceheader.vo.InvoiceHeaderVO" /> 

$ vi ./module/invoice/src/java/com/mpobjects/invoice/model/invoiceline/dao/InvoiceLine.standard.hbm.xml

<hibernate-mapping>
	<class name="com.mpobjects.invoice.model.invoiceline.vo.InvoiceLineVO" table="INVOICE_LINE">

[eric@localhost trunk]$ vi ./module/invoice/src/java/com/mpobjects/invoice/model/invoiceheader/dao/InvoiceHeader.standard.hbm.xml
<hibernate-mapping>
    <class name="com.mpobjects.invoice.model.invoiceheader.vo.InvoiceHeaderVO" table="INVOICE_HEADER" lazy="false">
/ TODO HIBERATE
		...
        <many-to-one name="sender" column="FINANCIAL_PARTY_SYSTEMID" class="com.mpobjects.invoice.model.financialparty.vo.FinancialPartyVO" />
        <many-to-one name="receiver" column="RECEIVER_SYSTEMID" class="com.mpobjects.invoice.model.financialparty.vo.FinancialPartyVO" />

        <many-to-one name="paymentBatchVO" column="INVOICE_PAYMENT_BATCH_SYSTEMID"  class="com.mpobjects.invoice.model.paymentbatch.vo.PaymentBatchVO" />
        <many-to-one name="vatPolicyVO" column="VAT_POLICY_SYSTEMID" class="com.mpobjects.invoice.model.entity.vatpolicy.VatPolicy" />

        <many-to-one name="invoiceOrganizationVO" column="INVOICE_ORGANIZATION_ID" class="com.mpobjects.oms.model.entity.organization.Organization" />
        <many-to-one name="organization" column="ORGANIZATION_SYSTEMID" class="com.mpobjects.oms.model.entity.organization.Organization" />
		...
/ Deze zien we in de query terug	,
/ Maar hier staan er nog meer, waarom zien we die niet terug?
/ TODO
/ In de query staan er ook meer, Waar komen die vandaan?
/ TODO

$ vi FinancialParty.standard.hbm.xml
hibernate-mapping>
	<class lazy="false" name="com.mpobjects.invoice.model.financialparty.vo.FinancialPartyVO" table="INVOICE_FINANCIAL_PARTY">
/ TODO HIBERATE

[eric@localhost trunk]$ vi ./module/invoice/src/java/com/mpobjects/invoice/model/paymentbatch/dao/PaymentBatch.standard.hbm.xml
<hibernate-mapping>
    <class name="com.mpobjects.invoice.model.paymentbatch.vo.PaymentBatchVO" table="INVOICE_PAYMENT_BATCH" lazy="false">
/ TODO HIBERNATE


/ Einde Intermezzo

$ vi ./module/invoice/src/java/com/mpobjects/invoice/control/invoiceline/action/InvoiceMultiLineFormAction.java

		if (getSession().getAttribute(HEADER_ID_ATT_NAME) != null) {
			theInvoiceHeaderSystemId = (Integer) getSession().getAttribute(HEADER_ID_ATT_NAME);
27126553

		InvoiceLineVO lastInvoiceLine = InvoiceLineUtil.getDAO().getLastInvoiceLine(theInvoiceHeaderSystemId);
/s
InvoideLineDAOImpl
	public InvoiceLineVO getLastInvoiceLine(int anInvoiceHeaderSystemId) {
		List myList = getHibernateTemplate().findByCriteria(
				DetachedCriteria.forClass(InvoiceLineVO.class).add(Property.forName("invoiceHeaderVO.systemId").eq(anInvoiceHeaderSystemId)).add(Property.forName("deleted").eq(false)).addOrder(Order.desc("invoiceLineNumber")), 0, 1);

		if (myList.size() > 0) {
			myRet = (InvoiceLineVO) myList.get(0);
		}
/t


/ we zien in de postgres log	,

from INVOICE_LINE this_ 
left outer join TMS_USER resource2_ on this_.USER_SYSTEMID=resource2_.SYSTEM_ID 
left outer join TMS_USER resource3_ on resource2_.CREATED_BY=resource3_.SYSTEM_ID 
left outer join INVOICE_MATCH_STATUS invoicemat4_ on this_.MATCH_STATUS_SYSTEMID=invoicemat4_.SYSTEM_ID 
left outer join INVOICE_HEADER invoicehea5_ on this_.INVOICE_HEADER_SYSTEMID=invoicehea5_.SYSTEM_ID 
left outer join INVOICE_FINANCIAL_PARTY financialp6_ on invoicehea5_.FINANCIAL_PARTY_SYSTEMID=financialp6_.SYSTEM_ID 
left outer join INVOICE_FINANCIAL_PARTY financialp7_ on invoicehea5_.RECEIVER_SYSTEMID=financialp7_.SYSTEM_ID 
left outer join INVOICE_PAYMENT_BATCH paymentbat8_ on invoicehea5_.INVOICE_PAYMENT_BATCH_SYSTEMID=paymentbat8_.SYSTEM_ID 
left outer join ORGANIZATION organizati9_ on paymentbat8_.ORGANIZATION_SYSTEMID=organizati9_.SYSTEM_ID 
left outer join ORGANIZATION organizati10_ on organizati9_.ORGANIZATION_GROUP=organizati10_.SYSTEM_ID 
left outer join TMS_USER resource11_ on paymentbat8_.PAID_BY_USER_SYSTEMID=resource11_.SYSTEM_ID 
left outer join TMS_USER resource12_ on paymentbat8_.CREATED_BY_USER_SYSTEMID=resource12_.SYSTEM_ID 
left outer join TMS_USER resource13_ on paymentbat8_.VALIDATED_BY_USER_SYSTEMID=resource13_.SYSTEM_ID 
left outer join INVOICE_VAT_POLICY vatpolicy14_ on invoicehea5_.VAT_POLICY_SYSTEMID=vatpolicy14_.SYSTEM_ID 
left outer join ORGANIZATION organizati15_ on invoicehea5_.INVOICE_ORGANIZATION_ID=organizati15_.SYSTEM_ID 
left outer join ORGANIZATION organizati16_ on invoicehea5_.ORGANIZATION_SYSTEMID=organizati16_.SYSTEM_ID where this_.INVOICE_HEADER_SYSTEMID=$1 and this_.IS_DELETED=$2 order by this_.LINE_NUMBER desc limit $3
DETAIL:  parameters: $1 = '27126553', $2 = 'f', $3 = '1'
LOG:  execute S_1: COMMIT

/ 13	.

/ we gaan verder 	,
public class InvoiceMultiLineFormAction extends AbstractAction implements NonScreenAction {
		InvoiceLineVO lastInvoiceLine = InvoiceLineUtil.getDAO().getLastInvoiceLine(theInvoiceHeaderSystemId);
/d
		String editType = (String) getRequest().getAttribute("edit-type");
edit
		if (StringUtils.isNotEmpty(editType) && editType.equals("edit")) {
			// totalItem attribute cleaned in save action
			if (getSession().getAttribute("totalItem") == null) {
/ JA
				totalItem = MpoBeanFactory.getBean(InvoiceDetailDAO.class).getInvoiceDetailCount(theInvoiceHeaderSystemId);
2
/ want	,
/s
InvoiceDetailDAOImpl
	public int getInvoiceDetailCount(int aInvoiceSystemId) {
		return getInvoiceDetailList(aInvoiceSystemId).size();
/s
	public List<InvoiceDetailVO> getInvoiceDetailList(int aInvoiceSystemId) {
		StringBuilder mySQL = new StringBuilder("SELECT ID.* FROM INVOICE_DETAIL ID, INVOICE_LINE IL  WHERE ID.INVOICE_LINE_SYSTEMID"
				+ "= IL.SYSTEM_ID AND IL.INVOICE_HEADER_SYSTEMID = :invoiceHeaderSystemId AND ID.IS_DELETED  =0 AND IL.IS_DELETED =0");

		Collection<QueryParameter> params = new ArrayList<QueryParameter>();
		params.add(new IntNamedQueryParameter("invoiceHeaderSystemId", aInvoiceSystemId));
		return executeSqlSelect(mySQL.toString(), "ID", params);
/t
/ we zien in postgres log	,
  85496 LOG:  execute <unnamed>: SELECT ID.* FROM INVOICE_DETAIL ID, INVOICE_LINE IL  WHERE ID.INVOICE_LINE_SYSTEMID= IL.SYSTEM_ID AND IL
  85496 .INVOICE_HEADER_SYSTEMID = $1 AND ID.IS_DELETED  =0 AND IL.IS_DELETED =0
  85497 DETAIL:  parameters: $1 = '27126553'
  85498 LOG:  execute S_1: COMMIT

			Collection myDetailList = MpoBeanFactory.getBean(InvoiceDetailDAO.class).getInvoiceDetailSubset(theInvoiceHeaderSystemId, startLimit, 
				InvoiceMultiLineVO.NB_ITEMPAGE);
/ InvoiceMultiLineVO.NB_ITEMPAGE==20	,
/s
InvoiceDetailDAOImpl
	public List getInvoiceDetailSubset(int anInvoiceHeaderSystemId, int aStartLimit, int aNbItemPage) {
		StringBuilder mySQL = new StringBuilder(
"SELECT ID.* FROM INVOICE_DETAIL ID, INVOICE_LINE IL " + 
"WHERE ID.INVOICE_LINE_SYSTEMID = IL.SYSTEM_ID "+
"AND IL.INVOICE_HEADER_SYSTEMID = :anInvoiceHeaderSystemId AND ID.IS_DELETED =0  AND IL.IS_DELETED = 0 "+
"ORDER BY IL.LINE_NUMBER, ID.SYSTEM_ID");

		Collection<QueryParameter> params = new ArrayList<QueryParameter>();
		params.add(new IntNamedQueryParameter("anInvoiceHeaderSystemId", anInvoiceHeaderSystemId));
		return executeSqlSelect(mySQL.toString(), "ID", params, aNbItemPage, aStartLimit);
/s
BaseHibernateDAO
	protected List<T> executeSqlSelect(final String aSql, final String anAlias, final Collection<QueryParameter> aParameters, final int aMaxResult,
			final int aFirstResult) {
		try {
			return getHibernateTemplate().executeFind(new HibernateCallback() {
				@Override
				public Object doInHibernate(Session aSession) throws HibernateException, SQLException {
					SQLQuery query = aSession.createSQLQuery(aSql);
/ Hibernate type	,
					for (QueryParameter parameter : aParameters) {
						parameter.setValue(query);
					}
					query.addEntity(anAlias, type);
					if (aMaxResult > 0) {
						query.setMaxResults(aMaxResult);
					}
					if (aFirstResult > 0) {
						query.setFirstResult(aFirstResult);
					}
					return query.list();
				}
			});

/ we zien in postgresql	,
  85774 LOG:  execute <unnamed>: SELECT ID.* FROM INVOICE_DETAIL ID, INVOICE_LINE IL WHERE ID.INVOICE_LINE_SYSTEMID = IL.SYSTEM_ID AND IL  85774 .INVOICE_HEADER_SYSTEMID = $1 AND ID.IS_DELETED =0  AND IL.IS_DELETED = 0 ORDER BY IL.LINE_NUMBER, ID.SYSTEM_ID limit $2
  85775 DETAIL:  parameters: $1 = '27126553', $2 = '20'
  85776 LOG:  execute S_1: COMMIT

/ TODO HIBERNATE (dezelfde query als hieboven)	,
/ we deden deze queries,	
				totalItem = MpoBeanFactory.getBean(InvoiceDetailDAO.class).getInvoiceDetailCount(theInvoiceHeaderSystemId);
			Collection myDetailList = MpoBeanFactory.getBean(InvoiceDetailDAO.class).getInvoiceDetailSubset(theInvoiceHeaderSystemId, startLimit, InvoiceMultiLineVO.NB_ITEMPAGE);

/t
InvoiceMultiLineFormAction.act() line: 86	
			Collection myDetailList = MpoBeanFactory.getBean(InvoiceDetailDAO.class).getInvoiceDetailSubset(theInvoiceHeaderSystemId, startLimit, 
				InvoiceMultiLineVO.NB_ITEMPAGE);
/d
[SystemId:27126556	Amount:-361.50000	VAT:-75.92000	VATTariff:HIGH	CostType:com.mpobjects.oms.model.ratecomponenttype.RateComponentType@209fe09f[systemId=26671397,code=Freight Commission,description=Freight Commission for ISB,group=COST,reasonMandatory=false,deleted=false,sequenceNr=60]	InvoiceLine:27126554	User 10100	Create date: 2015-06-18 11:39:35.245	, 
SystemId:27126558	Amount:7230.00000	VAT:1518.30000	VATTariff:HIGH	CostType:com.mpobjects.oms.model.ratecomponenttype.RateComponentType@2692550c[systemId=26600544,code=Freight,description=Freight Cost,group=COST,reasonMandatory=false,deleted=false,sequenceNr=10]	InvoiceLine:27126554	User 10100	Create date: 2015-06-18 11:39:35.293	]

			if (myDetailList.size() > 0) {
				myVO = new InvoiceMultiLineVO(myDetailList);
systemId	1	


		if (lastInvoiceLine != null) {
			if (lastInvoiceLine.getInvoiceHeaderVO().getInvoiceHeaderStatus().equals(InvoiceHeaderStatus.INITIAL)) {
/ JA
				isReadOnly = false;
/ TODO


/ 7	.

[eric@localhost trunk]$ vi ./module/invoice/war/invoice/jsp/invoice-multiline_edit.jsp

		<mpo:form >
			<mpo:setFormVO valueObject="${formVO}">
/ 1
				<table id="invoiceTable" class="list">
					<thead>
						...
					/thead>
					<tbody>
						<c:if test="${lastDB>0 && requestScope['edit-type'] == 'create'}">
/ NEE

						<c:forEach var="entry" begin="1" end="${nbItempage}">
/ 2
							<td><mpo:idxNumberField showFieldContext="false" tabindex="99" type="int" name="invoiceLineNumber" readOnly="true" size="5" index="${entry}"/></td>
							<c:choose>
								<c:when test="${formVO.allocated}">
									<td><mpo:idxField name="logisticsOrderReference" showFieldContext="false" index="${entry}" readOnly="true" /></td>
/3
									<td><mpo:idxField name="carrierReference" showFieldContext="false" index="${entry}"  readOnly="true" /></td>
/ 4
							<c:if test="${requestScope['edit-type'] == 'edit'}"><!-- invoice line remarks -->
/ JA	
								<c:choose>
									<c:when test="${formVO.line[entry] == true}">
/ WH JA TODO
										<td><mpo:idxTextField name="lineRemark" showFieldContext="false" readOnly="false" index="${entry}" /></td>
/5
										<td><mpo:idxTextField name="podRemark" showFieldContext="false" readOnly="false" index="${entry}" /></td>
/6

							<c:choose>
								<c:when test="${requestScope['edit-type'] == 'create'}">
/ NEE
								<c:otherwise>
									<c:choose>
										<c:when test="${formVO.surcharged[entry] == true && formVO.editModeType != 'edit'}">
											<c:set var="readonly" value="true" />


							<td><mpo:idxNumberField showFieldContext="false" type="float" name="amount" readOnly="${readonly}" size="10" index="${entry}"/></td>		
/ 7
							<td><mpo:idxDropDownField showFieldContext="false" name="vatTarifType" dataType="string" required="true" readOnly="${readonly}" index="${entry}">
/ 8

							<td><c:if test="${initialStatus}"><img id="removeLine_${entry}" class="removeButton" onclick="removeAllChildren(this.parentNode.parentNode,this.id);return false" src="../lookandfeel/styles/images/icons/delete24.png" alt="Remove this line"/></c:if>


/ we zien dat het 1ste gedeelte van de rij een invoiceline is, en het 2de gedeelte een invoicedetail	,


/ Intermezzo
	
/ Hoe werkt dit?

/ 1
/ formVO=InvoiceMultiLineVO inst	,

/ 2
/ nbItempage is een session attr, set in InvoiceMultilineAction	,

/ 3	. 
/ logisticsOrderReference is property van InvoiceMultiLineVO	, en valueObject="${formVO} en formVO is een InvoiceMultiLineVO	, en getLogisticsOrderReference heeft index als arg	, en deze staat ook op deze line	, 
/ queries de InvoiceLine bij deze index	,
	public String getLogisticsOrderReference(int anIndex) {
		return getInvoiceLineVO(anIndex).getLogisticsOrderReference();

/4	. 
/ carrierReference is property van InvoiceMultiLineVO	, en valueObject="${formVO} en formVO is een InvoiceMultiLineVO	, en getCarrierReference heeft index als arg	, en deze staat ook op deze line	,
/ queries de InvoiceLine bij deze index	,
	public String getCarrierReference(int anIndex) {
		return getInvoiceLineVO(anIndex).getCarrierReference();

/5
/ lineRemark is property van InvoiceMultiLineVO	, en valueObject="${formVO} en formVO is een InvoiceMultiLineVO	, en getLineRemark heeft index als arg	, en deze staat ook op deze line	,
/ queries de InvoiceLine bij deze index	,
	public String getLineRemark(int anIndex) {
		return getInvoiceLineVO(anIndex).getRemark();

/ 6
/ podRemark is property van InvoiceMultiLineVO	, en valueObject="${formVO} en formVO is een InvoiceMultiLineVO	, en getPodRemark heeft index als arg	, en deze staat ook op deze line	,
/ queries de InvoiceLine bij deze index	,
	public String getPodRemark(int anIndex) {
		return getInvoiceLineVO(anIndex).getPodRemark();

/ 7

/ amount is property van InvoiceMultiLineVO	, en valueObject="${formVO} en formVO is een InvoiceMultiLineVO	, en getAmount heeft index als arg	, en deze staat ook op deze line	,
/ queries de InvoiceDetail bij deze index	,
	public BigDecimal getAmount(int anIndex) {
		return getInvoiceDetailVO(anIndex).getAmount();

/ 8	.
/ vatTarifType is property van InvoiceMultiLineVO	, en valueObject="${formVO} en formVO is een InvoiceMultiLineVO	, en getTarifType heeft index als arg	, en deze staat ook op deze line	,
/ queries de InvoiceDetail bij deze index	,
	public String getVatTarifType(int anIndex) {
		return getInvoiceDetailVO(anIndex).getVatTarifTypeEnum().toString();


/ invoice line	,

$ vi InvoiceMultLineAction.act	, 
			myVO = new InvoiceMultiLineVO(lastInvoiceLine, lastInvoiceDetail);
		getRequest().setAttribute("formVO", myVO);

$ vi InvoiceMultiLineVO.java
	public InvoiceLineVO getLastLineDB() {
		...
		return theLastLineDB;
	}
	public boolean isAllocated() {
		InvoiceLineVO myLine = getInvoiceLineVO(lastIndex);
		if (myLine != null && myLine.getRealRowNumber() > 0) {
			return myLine.isAllocated();
		}
		public String getLogisticsOrderReference(int anIndex) {
			return getInvoiceLineVO(anIndex).getLogisticsOrderReference();


$ vi InvoiceLineVO.java
	public String getLogisticsOrderReference() {
		...
		return theLogisticsOrderReference;
	}
	/** Returns true if actual cost parts were created */
	public boolean isAllocated() {
		...
/ TODO
	public int getRealRowNumber() {
		return theRealRowNumber;


/ invoice detail	,

$ vi InvoiceMultiLineVO.java
	public InvoiceDetailVO getLastDetailDB() {
		return theLastDetailDB;

$ vi InvoiceDetailVO.java
	public BigDecimal getAmount() {
		return amount;
	}
	public String getVatTarifType() {
		...
		return vatTarifTypeEnum.toString();
	}


/ Einde Intermezzo

/ 13	. 

$ vi invoice-multiline_edit.jsp 

		<td>
			<c:if test="${initialStatus}">
				<img id="removeLine_${entry}" class="removeButton" onclick="removeAllChildren(this.parentNode.parentNode,this.id);return false" src="../lookandfeel/styles/images/icons/delete24.png" alt="Remove this line"/>
			</c:if>
			<mpo:idxNumberField showFieldContext="false" type="int" name="parentId" hidden="true" size="5" index="${entry}" />
			<mpo:idxField name="deleted" hidden="true" size="5" readOnly="true" showFieldContext="false" index="${entry}" />
		</td>


/ we zien in HTML de laatste column	, met 2 actions	, 
	<td>
		<img id="removeLine_1" class="removeButton" onclick="removeAllChildren(this.parentNode.parentNode,this.id);return false" src="../lookandfeel/styles/images/icons/delete24.png" alt="Remove this line">
		<input type="hidden" name="parentId_1" id="parentId_1" value="0">
		<input type="hidden" name="deleted_1" id="deleted_1" value="false"></td>
/ Freight Commision

<td>
	<img id="removeLine_2" class="removeButton" onclick="removeAllChildren(this.parentNode.parentNode,this.id);return false" src="../lookandfeel/styles/images/icons/delete24.png" alt="Remove this line">
	<input type="hidden" name="parentId_2" id="parentId_2" value="1">
	<input type="hidden" name="deleted_2" id="deleted_2" value="false"></td>
/ Freight

/ inderdaad	,
$ vi invoice-multiline_edit.jsp
			<script type="text/javascript" src="../script/inv-multiline-edit.js"></script>

$ vi inv-multiline-edit.js
/ inv is van invoice	,

/ 13	. 

////////////////////////////////////////
/ SETS FORMTAG VALUEOBJECT

/ Eerst value object in SetFormVOTag	, daarna in FormTag	,  

/ Na de InvoiceMultiLineFormActin.act komen in we in de invoice-multiline_edit.jsp	, 
/ Hier wordt de formtag create	, en de value object er in set	,

$ vi InvoiceMultiLineFormAction.java
			} else {
				myVO = new InvoiceMultiLineVO(lastInvoiceLine, null);
		getRequest().setAttribute("formVO", myVO);

/ Na deze action komt de jsp	, maar dat is inderdaad in hetzelfde request	,

		<mpo:form >
			<mpo:setFormVO valueObject="${formVO}">
/ WH
/s
SetFormVOTag.setValueObject(EntityInterface) line: 201	
		theValueObject = aVO;

/ in de jsp staat attr	, valueObject	, WH gewoon by name calls setValueObject	,

/ we geven continue	,

SetFormVOTag.doStartTag() line: 109	
		getForm().addValueObject(getValueObject());
/s
SetFormVOTag.doStartTag() line: 109	
		getForm().addValueObject(getValueObject());
/ getForm() is de FormTag	,. 
/= this.theFormTag	, this=setFormVO	,
/s
FormTag.addValueObject(EntityInterface) line: 180	
/=
	public void addValueObject(EntityInterface aEntityInterface) {
/ aEntityInterface=InvoiceMultiLineVO	,
		ValueObject aVO = (ValueObject) aEntityInterface;
		if (StringUtils.isEmpty(theEntity) || !entityUpdatedByTag) {
			entityUpdatedByTag = true;
			setEntity(VOReflectionInvoker.getEntityFromVO(aVO));
"invoiceMultiLine"

		if (theValueObjects.size() == 0 && !modeUpdatedByTag) {
/ JA
			if (aVO.isPersistent()) {
/ JA
				theMode = aVO.getEditModeType();
"edit"
		theValueObjects.add(aVO);

/ 13	. 

/ Dan	,
FormTag.doEndTag() line: 234	
		getRequest().getSession().setAttribute(theContinuationId + "_form", this);
/ sets formtag in de session	,



/////////////////////////////////////



/ 7	. 

/ we vallen in JS in	,
function removeAllChildren(parent, currentChild) {
parent <tr id="line_2" class="list0">
currentChild: "removeChild_2"

	currentChild = parseInt(cleanId("removeLine_", currentChild));
/s
function cleanId(prefix, id) {
id: "removeLine_2"
	if (id.indexOf(prefix) == 0) {
		id = id.substring(prefix.length).toLowerCase();
"2"
	}
	return id;
/t
	currentChild = parseInt(cleanId("removeLine_", currentChild));
/d
2

	myParent = parseInt(getElement('parentId', currentChild).value);
/= index van de rij waar de remove button zit	, 1 , (de 1ste rij heeft index 0)	,
/ Toch vreemd	, want de rij is nummer 2	, waarom index 1	?
/ TODO
/s
function getElement(name, id) {
id: 2
name: "parentId"
	return document.getElementById(createId(name, id));
/s
function createId(field, id) {
	return field + "_" + id;
"parentId_2"
/t
/ Dit is het hidden field achter de <img/>	 waar we op click	,

<td>
	<img id="removeLine_2" class="removeButton" onclick="removeAllChildren(this.parentNode.parentNode,this.id);return false" src="../lookandfeel/styles/images/icons/delete24.png" alt="Remove this line">
	<input type="hidden" name="parentId_2" id="parentId_2" value="1">
	<input type="hidden" name="deleted_2" id="deleted_2" value="false">
</td>

/t
function removeAllChildren(parent, currentChild) {
	myParent = parseInt(getElement('parentId', currentChild).value);
1

document.getElementById(createId("amountVat", 1))

	getElement('deleted', currentChild).value = true;
/ WAS	,
	<input type="hidden" name="deleted_2" id="deleted_2" value="false"></td>
/ NU	,
	<input type="hidden" name="deleted_2" id="deleted_2" value="true">

	getElement('line', currentChild).className = "invisible"; //hide
/ WAS
<tr id="line_2" class="list0">
/ NU
<tr id="line_2" class="">

$ vi oms.css
.hidden, .invisible{
	visibility:hidden;
	display:none;
}

	getElement('amount', currentChild).value = 0;
/ WAS
<input type="text" name="amount_2" id="amount_2" size="10" maxlength="250" value="7,230.00">
/ TODO (We zien NIET value="0" )	,

	getElement('amountVat', currentChild).value = 0;
/ WAS
<input type="text" name="amountVat_2" id="amountVat_2" size="10" maxlength="250" value="1,518.30">
/ TODO (we zien NIET value="0" )	,

/ 13	. 

/ TODO

FormTag
	@Override
	public int doEndTag() throws JspTagException {
		// when renaming this key, also checkout session cleanup in java class RedirectByFlowAction!
		getRequest().getSession().setAttribute(theContinuationId + "_form", this);


/ 13	. 

/ Dan click we Save And Close	op de invoice line	,

$ vi invoice-multiline_edit.jsp

			<c:when test="${multiLineInvoiceDetail=='true'}">
			<input type="button" name="saveAndClose" id="saveAndClose" value="<mpo:label name="saveAndClose"/>" 
				onclick="if(checkLineCost()){theEditFormFormManager.submit('../invoice/invoice-multiline_save', true, -1);}" />
			<input type="button" name="save" id="save" value="<mpo:label name="save"/>" 
				onclick="if(checkLineCost()){theEditFormFormManager.submit('../invoice/invoice-multiline_save', false, 0);}" />
			</c:when>




/ Save and Close is dus type="button"	, NIET type="submit"	,  dus moeten we in js in theEditFormFormManager.submit document.getElementById("editForm").submit() 	, "editForm" is id van de <form/>	,

/ we komen NIET in de <input/>'s onclick fct, Deze wordt vervangen door onderstaande fct, die ook doet wat <input/>'s onclick doet, maar doet meer: ook de redirect	,

$ vi inv-multiline-edit.js
	document.getElementById("saveAndCloseBtn").onclick = function () {


		updateLineNumber();
		theEditFormFormManager.setRedirectUrl(redirectUrlML);
/s
    this.setRedirectUrl = function(anUrl) {
        document.getElementById("redirectTo").value=anUrl;
anUrl: "invoice-multiline_create?base_controlFlow=false"
/ WAS	,
<input type="hidden" name="redirectTo" id="redirectTo" value="../core/back?levelOffset=-1">
/ NU	,
<input type="hidden" name="redirectTo" id="redirectTo" value="invoice-multiline_create?base_controlFlow=false">

////////////////////
/ In Console	,
> document.getElementById("redirectTo")
<input type="hidden" name="redirectTo" id="redirectTo" value="invoice-multiline_create?base_controlFlow=false">
/ right click this answer	,
'Reveals in Elements Panel'	, 
/ we komen dan inderdaad in Elements, 	waar deze <input/> hier	,
////////////////////

		theEditFormFormManager.submit('../invoice/invoice-multiline_save?base_controlFlow=false', true, "1");
/s
    this.submit = function(anAction, aBoolDoRedirect, aRedirectionLevelOffset) {
/ aBoolRedirect=true

       	this.lastAction = anAction;
anAction: "../invoice/invoice-multiline_save?base_controlFlow=false"
        this.lastDoRedirect = aBoolDoRedirect;
true
        document.getElementById("base_sessionLevelOffset").value=aRedirectionLevelOffset;
"1"
		document.getElementById("doRedirect").value=aBoolDoRedirect;
true
      var myForm = document.getElementById(this.theFormName);

        if(anAction){
        	myForm.action=anAction;
/ WAS
<form action="../invoice/invoice-multiline_save"> 
/ NU
<form action="../invoice/invoice-multiline_save?base_controlFlow=false"> 

/ Intermezzo

$ vi invoice-sitemap.xmap

			<map:match pattern="invoice-multiline_save">
				<map:act type="invoiceMultiLineSave"/>
			</map:match>

			<map:action logger="invoice" name="invoiceMultiLineSave"   src="com.mpobjects.invoice.control.invoiceline.action.InvoiceMultiLineSaveAction"/>

/ Einde Intermezzo

/ Intermezzo

/ we hadden click we Save And Close	,

/ we zien in devtools	,

Headers

Request URL:http://localhost:8080/tms/invoice/invoice-multiline_save?base_controlFlow=false

Request Headers
Provisional headers are shown
Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Content-Type:application/x-www-form-urlencoded
Origin:http://localhost:8080
Referer:http://localhost:8080/tms/invoice/invoice-multiline_edit?invoiceheadersystemid=27126553&systemid=27126553&refresh=true&screenId=invoice-multiline_edit&base_controlFlow=false
User-Agent:Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.104 Safari/537.36
X-DevTools-Emulate-Network-Conditions-Client-Id:40A33139-C779-3DBD-F885-1F638C322B8C

Query String Parametersview sourceview URL encoded
base_controlFlow:false

Form Data
continuationId:1437046645981
flowDefinition:reload
redirectTo:invoice-multiline_create?base_controlFlow=false
doRedirect:true
base_sessionLevelOffset:1
base_windowToOpenUrl:
base_windowToOpenHeight:
base_windowToOpenWidth:
base_windowToOpenTitle:
base_windowToOpenScrollbar:
invoiceHeaderSystemId:27126553
systemId:1
invoiceLineNumber_1:10
logisticsOrderReference_1:N0001530
carrierReference_1:
lineRemark_1-display:
lineRemark_1:
podRemark_1-display:
podRemark_1:
amount_1:-361.50
vatTarifType_1:HIGH
amountVat_1:-75.92
costTypeSystemId_1:26671397
parentId_1:0
deleted_1:false
invoiceLineNumber_2:10
logisticsOrderReference_2:
carrierReference_2:
amount_2:0
vatTarifType_2:HIGH
amountVat_2:0
costTypeSystemId_2:26600544
parentId_2:1
deleted_2:true
invoiceLineNumber_3:0
logisticsOrderReference_3:
carrierReference_3:
amount_3:0.00
vatTarifType_3:FREE
amountVat_3:0.00
costTypeSystemId_3:26600544
parentId_3:0
deleted_3:true
invoiceLineNumber_4:0
logisticsOrderReference_4:
carrierReference_4:
amount_4:0.00
vatTarifType_4:FREE
amountVat_4:0.00
costTypeSystemId_4:26600544
parentId_4:0
deleted_4:true
invoiceLineNumber_5:0
logisticsOrderReference_5:
carrierReference_5:
amount_5:0.00
vatTarifType_5:FREE
amountVat_5:0.00
costTypeSystemId_5:26600544
parentId_5:0
deleted_5:true
invoiceLineNumber_6:0
logisticsOrderReference_6:
carrierReference_6:
amount_6:0.00
vatTarifType_6:FREE
amountVat_6:0.00
costTypeSystemId_6:26600544
parentId_6:0
deleted_6:true
invoiceLineNumber_7:0
logisticsOrderReference_7:
carrierReference_7:
amount_7:0.00
vatTarifType_7:FREE
amountVat_7:0.00
costTypeSystemId_7:26600544
parentId_7:0
deleted_7:true
invoiceLineNumber_8:0
logisticsOrderReference_8:
carrierReference_8:
amount_8:0.00
vatTarifType_8:FREE
amountVat_8:0.00
costTypeSystemId_8:26600544
parentId_8:0
deleted_8:true
invoiceLineNumber_9:0
logisticsOrderReference_9:
carrierReference_9:
amount_9:0.00
vatTarifType_9:FREE
amountVat_9:0.00
costTypeSystemId_9:26600544
parentId_9:0
deleted_9:true
invoiceLineNumber_10:0
logisticsOrderReference_10:
carrierReference_10:
amount_10:0.00
vatTarifType_10:FREE
amountVat_10:0.00
costTypeSystemId_10:26600544
parentId_10:0
deleted_10:true
invoiceLineNumber_11:0
logisticsOrderReference_11:
carrierReference_11:
amount_11:0.00
vatTarifType_11:FREE
amountVat_11:0.00
costTypeSystemId_11:26600544
parentId_11:0
deleted_11:true
invoiceLineNumber_12:0
logisticsOrderReference_12:
carrierReference_12:
amount_12:0.00
vatTarifType_12:FREE
amountVat_12:0.00
costTypeSystemId_12:26600544
parentId_12:0
deleted_12:true
invoiceLineNumber_13:0
logisticsOrderReference_13:
carrierReference_13:
amount_13:0.00
vatTarifType_13:FREE
amountVat_13:0.00
costTypeSystemId_13:26600544
parentId_13:0
deleted_13:true
invoiceLineNumber_14:0
logisticsOrderReference_14:
carrierReference_14:
amount_14:0.00
vatTarifType_14:FREE
amountVat_14:0.00
costTypeSystemId_14:26600544
parentId_14:0
deleted_14:true
invoiceLineNumber_15:0
logisticsOrderReference_15:
carrierReference_15:
amount_15:0.00
vatTarifType_15:FREE
amountVat_15:0.00
costTypeSystemId_15:26600544
parentId_15:0
deleted_15:true
invoiceLineNumber_16:0
logisticsOrderReference_16:
carrierReference_16:
amount_16:0.00
vatTarifType_16:FREE
amountVat_16:0.00
costTypeSystemId_16:26600544
parentId_16:0
deleted_16:true
invoiceLineNumber_17:0
logisticsOrderReference_17:
carrierReference_17:
amount_17:0.00
vatTarifType_17:FREE
amountVat_17:0.00
costTypeSystemId_17:26600544
parentId_17:0
deleted_17:true
invoiceLineNumber_18:0
logisticsOrderReference_18:
carrierReference_18:
amount_18:0.00
vatTarifType_18:FREE
amountVat_18:0.00
costTypeSystemId_18:26600544
parentId_18:0
deleted_18:true
invoiceLineNumber_19:0
logisticsOrderReference_19:
carrierReference_19:
amount_19:0.00
vatTarifType_19:FREE
amountVat_19:0.00
costTypeSystemId_19:26600544
parentId_19:0
deleted_19:true
invoiceLineNumber_20:0
logisticsOrderReference_20:
carrierReference_20:
amount_20:0.00
vatTarifType_20:FREE
amountVat_20:0.00
costTypeSystemId_20:26600544
parentId_20:0
deleted_20:true
serverUnavailableMessage:Server busy, please wait
processingFormMessage:Form is being processed...
deleteMessage:Are you sure?
ConsoleSearchEmulationRendering


/ Einde Intermezzo

/ 13	. 

/ we hadden click we Save And Close	,

/ we vallen  op de server in	,

/ stack trace	,
	InvoiceMultiLineSaveAction(BoundSaveAction).getForm() line: 168	
		if (theFormTag == null) {
			theFormTag = (FormTag) getRequest().getAttribute("form");

	InvoiceMultiLineSaveAction(BoundSaveAction).validate() line: 218	
		if (getRequest().getAttribute(TAGLIB_FETCHED_DATA) == null) {
/ JA
			Collection myValidationFields = getForm().getValidateAbleFields();

	InvoiceMultiLineSaveAction.validate() line: 211	
		super.validate();

	InvoiceMultiLineSaveAction(AbstractSaveAction).act() line: 64	
->		validate();
/ NU
			handleSave();
/ STRAKS	,

	InvoiceMultiLineSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	
				Map myMap = act();

/ we debug	,
	InvoiceMultiLineSaveAction(BoundSaveAction).getForm() line: 168	
		if (theFormTag == null) {
			theFormTag = (FormTag) getRequest().getAttribute("form");
null
		if (theFormTag == null) {
			FormTag myTag = (FormTag) getSession().getAttribute(getContinuationId() + "_form");
/s
InvoiceMultiLineSaveAction(BoundSaveAction).getContinuationId() line: 101	
		if (theContinuationId == 0) {
			theContinuationId = new Long(getRequest().getParameter(FormTag.CONTINUATION_FIELD)).longValue();
/ FormTag.CONTINUATION_FIELD="continuationid"
1437117573135
/ Deze staat in de POST parameters	,
continuationId:1437046645981 			/ (uit andere run)	,
/t
			FormTag myTag = (FormTag) getSession().getAttribute(getContinuationId() + "_form");
/d
com.mpobjects.view.taglib.form.FormTag@4e09c7f7

/ Intermezzo

/ Deze is set in FormTag.endTag	,
		getRequest().getSession().setAttribute(theContinuationId + "_form", this);

/ De continuationId is een hidden field in de FormTag	, deze vind je dus niet in de invoice-multiline_edit.jsp	, want daar staat <mpo:form>	,

$ vi FormTag.java
		myPrintString.append("<input type=\"hidden\"");
		myPrintString.append(" name=\"" + CONTINUATION_FIELD + "\"");
		myPrintString.append(" id=\"" + CONTINUATION_FIELD + "\"");
		theContinuationId = new Date().getTime();
		myPrintString.append(" value=\"" + theContinuationId + "\"");
		myPrintString.append("/>");

<form class="jspForm" method="post" name="editForm" id="editForm" target="submitframe" action="../invoice/invoice-multiline_save" _lpchecked="1">
	<input type="hidden" name="continuationId" id="continuationId" value="1437121001453">

/ Dus de continuationId wordt met de request parameters meegegeven	, en daarmee wordt in de session <continuationId>_form opgezocht: dat is de formtag	, want FormTag.endTag schrijft de formtag met de key "<continuationId>_form" in de session	,

/ Einde Intermezzo


com.mpobjects.view.taglib.form.FormTag@5a985afd
/ TODO
			myTag.setRequest(new RequestAdaptor(getRequest()));
			theFormTag = myTag;
			getRequest().setAttribute("form", theFormTag);



/ 13	. 

/ we geven continue	,

Daemon Thread [http-0.0.0.0-8080-3] (Suspended (entry into method handleSave in InvoiceMultiLineSaveAction))	
	InvoiceMultiLineSaveAction.handleSave() line: 52	
	InvoiceMultiLineSaveAction(AbstractSaveAction).act() line: 69	
			handleSave();
	InvoiceMultiLineSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	
				Map myMap = act();

/ we debug	, 
	InvoiceMultiLineSaveAction.handleSave() line: 52	
		int myInvoiceHeaderSystemId = Integer.parseInt(getRequestParameter("invoiceHeaderSystemId"));


/ Terug in	,
InvoiceMultiLineSaveAction.handleSave() line: 57	


/ we zijn in 	,
		int myInvoiceHeaderSystemId = Integer.parseInt(getRequestParameter("invoiceHeaderSystemId"));
/s
		myRet = getRequest().getParameter(aParam);
/t
invoiceHeaderSystemId:27126553
/ Deze is een van de FormData	,

		InvoiceMultiLineVO myVO = (InvoiceMultiLineVO) getValueObject();
/s
InvoiceMultiLineSaveAction(BoundSaveAction).getValueObject() line: 197	
		return getFetchedData().iterator().next();
/s
InvoiceMultiLineSaveAction(BoundSaveAction).getFetchedData() line: 119	
			if (theFetchedData == null) {
				theFetchedData = (Collection<EntityInterface>) getRequest().getAttribute(TAGLIB_FETCHED_DATA);
/ TAGLIB_FETCHED_DATA="taglibFetchedData"
			if (theFetchedData == null) {
				Collection<DataFetchable> myFetchFields = getForm().getDataFetchableFields();

//////////////////////////////////////////////
/ INVOICEMULTILINEVO VALUEOBJECT FROM SESSION
/ de formtag komt uit de session	, ( is set in FormtTag.endTag)	, en in deze formtag zit de value object, de InvoiceMultiLineVO	,

this	InvoiceMultiLineSaveAction  (id=17628)	
	theFormTag	FormTag  (id=18711)	
		theValueObjects	ArrayList  (id=19142)	
			elementData	Object[10]  (id=19145)	
				[0]	InvoiceMultiLineVO  (id=19147)	
					LAST_DB	10	
					NB_ITEMPAGE	20	
					createMode	false	
					defaultVatTarif	VatTariffType  (id=19230)	
					invoicePodStatus	InvoicePodStatus  (id=19252)	
					invoiceRechargeStatus	InvoiceRechargeStatus  (id=19253)	
					isLine	HashMap  (id=19292)	
					lastIndex	20	
					performanceMonitorService	null	
					systemId	1	
					theCreateDate	null	
					theInvoiceDetailList	HashMap  (id=19597)	
					theInvoiceHeaderSystemId	27126553	
					theInvoiceHeaderVO	InvoiceHeaderVO  (id=19599)	
					theInvoiceLineList	HashMap  (id=19785)	
					theLastDetailDB	InvoiceDetailVO  (id=19786)	
					theLastLineDB	InvoiceLineVO  (id=19853)	
					theLineList	ArrayList  (id=19947)	
					theSurchargedList	ArrayList  (id=19948)	
					theUserSystemId	0	


/s
InvoiceMultiLineSaveAction(BoundSaveAction).getForm() line: 167	
			if (theFormTag == null) {
/ NEE
	return theForm;
/t
/s
FormTag.getDataFetchableFields() line: 338	
this=FormTag
		for (Object myField : fieldList) {
[ invoiceHeaderSystemId,  systemId,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  lineRemark,  podRemark,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted,  invoiceLineNumber,  logisticsOrderReference,  carrierReference,  amount,  vatTarifType,  amountVat,  costTypeSystemId,  parentId,  deleted]

/ Dit zijn allemaal tag	, zoals NumberFieldTag	, IndexedFieldTag	, ...

			if (myField instanceof DataFetchable) {
				myList.add((DataFetchable) myField);
	return myList;

/t
InvoiceMultiLineSaveAction(BoundSaveAction).getFetchedData() line: 128	
				Collection<DataFetchable> myFetchFields = getForm().getDataFetchableFields();
/d
				for (DataFetchable myDataFetchable : myFetchFields) {
					if (myDataFetchable instanceof FieldTag) {
						myField = (FieldTag) myDataFetchable;
						shouldHandle = shouldHandleFieldPrefix(myField.getPrefix());
					}
					if (shouldHandle) {
/ JA
						myDataFetchable.fetchData();
/////////////////////////
/ fetches data from request params	, en set in value object,	
/s
NumberFieldTag.fetchData() line: 93	
			String myValue = getValueFromRequest(getFormFieldName());
/ getFormFieldName()="invoiceHeaderSystemId"
/ Deze is in de request params	,
invoiceHeaderSystemId:27126553
			BigDecimal myDecimalValue = parseToNumber(myValue);
			storeValueInVO(getActiveValueObject(), myDecimalValue);
/s
NumberFieldTag(FieldTag).getActiveValueObject() line: 390	
		if (theActiveValueObject != null) {
/ NEE
		} else {
			myRet = getActiveValueObjectHolder().getActiveValueObject();
/s
NumberFieldTag(FieldTag).getActiveValueObjectHolder() line: 406	
		if (activeValueObjectHolder == null) {
/ NEE
			activeValueObjectHolder = (ActiveValueObjectHolder) findAncestorWithClass(this, ActiveValueObjectHolder.class);
/ NIET
/ findAncestorWithClass is een TagSupport method	,

activeValueObjectHolder	SetFormVOTag  (id=22473)	
/t
NumberFieldTag(FieldTag).getActiveValueObject() line: 392	
			myRet = getActiveValueObjectHolder().getActiveValueObject();
/d
myRet	InvoiceMultiLineVO  (id=19147)	
/t
NumberFieldTag.fetchData() line: 100	
			storeValueInVO(getActiveValueObject(), myDecimalValue);
/s
NumberFieldTag.storeValueInVO(EntityInterface, BigDecimal) line: 329	
		VOReflectionInvoker.setNumericValue(aVO, getName(), aValue);
/ Hij reset in de InvoiceMultiLineVO de invoiceHeaderSystemId (opnieuw) tot 27126553
/ Hij zou veranderd kunnen zijn	,

/t
InvoiceMultiLineSaveAction(BoundSaveAction).getFetchedData() line: 130	
/ volgende,	
				for (DataFetchable myDataFetchable : myFetchFields) {
						myDataFetchable.fetchData();
////////////////////////////
/ fetches data from request params	, en set in value object,	
...
/d
				theFetchedData = getForm().getValueObjects();

///////////////////////////////////
/ FETCHED DATA
/ theFetchedData is de value object	, uit de session	, updated met values uit request params	,

			getRequest().setAttribute(TAGLIB_FETCHED_DATA, theFetchedData);
/ "taglibFetchedData"	,

/t
InvoiceMultiLineSaveAction.validate() line: 218	
		InvoiceMultiLineVO myVO = (InvoiceMultiLineVO) getValueObject();
/d
/ validate is net voor handleSave in act	,

myVO	InvoiceMultiLineVO  (id=20969)	
	LAST_DB	10	
	NB_ITEMPAGE	20	
	createMode	false	
	defaultVatTarif	VatTariffType  (id=21051)	
	invoicePodStatus	InvoicePodStatus  (id=21052)	
	invoiceRechargeStatus	InvoiceRechargeStatus  (id=21053)	
	isLine	HashMap  (id=21065)	
	lastIndex	20	
	performanceMonitorService	null	
	systemId	1	
	theCreateDate	null	
	theInvoiceDetailList	HashMap  (id=21113)	
	theInvoiceHeaderSystemId	27126553	
	theInvoiceHeaderVO	null	
	theInvoiceLineList	HashMap  (id=21114)	
	theLastDetailDB	InvoiceDetailVO  (id=21133)	
	theLastLineDB	InvoiceLineVO  (id=21203)	
	theLineList	ArrayList  (id=21205)	
	theSurchargedList	ArrayList  (id=21832)	
	theUserSystemId	0	


/ Intermezzo

/ 13	. 

myVO
	theInvoiceDetailList	HashMap  (id=21113)	
/ size is 21	, maar er zijn maar 3 details met systemId != 0	,	

SystemId:27125925	Amount:-413.44999999999998863131622783839702606201171875	VAT:-86.81999999999999317878973670303821563720703125	VATTariff:HIGH	CostType:com.mpobjects.oms.model.ratecomponenttype.RateComponentType@7c0b8167[systemId=26671397,code=Freight Commission,description=Freight Commission for ISB,group=COST,reasonMandatory=false,deleted=false,sequenceNr=60]	InvoiceLine:27125923	User 27128130	Create date: 2015-07-20 17:34:22.519	

SystemId:27128275	Amount:8269	VAT:1736.490000000000009094947017729282379150390625	VATTariff:HIGH	CostType:com.mpobjects.oms.model.ratecomponenttype.RateComponentType@22ccc555[systemId=26600544,code=Freight,description=Freight Cost,group=COST,reasonMandatory=false,deleted=false,sequenceNr=10]	InvoiceLine:27125923	User 27128130	Create date: 2015-07-20 17:34:22.519	

SystemId:27128277	Amount:0	VAT:0	VATTariff:HIGH	CostType:com.mpobjects.oms.model.ratecomponenttype.RateComponentType@3fa29ad3[systemId=26595322,code=Demurrage,description=Demurrage time,group=COST,reasonMandatory=false,deleted=false,sequenceNr=20]	InvoiceLine:27125923	User 27128130	Create date: 2015-07-20 17:34:22.519	

/ 13	. 

	theInvoiceLineList	HashMap  (id=21114)	
/ size is 21	, maar heeft maar 1 echte line	,

SystemId:27126554	Order: N0001530	Carr: 	InvoiceLineNb 10	Create date: 2015-06-18 11:39:35.219	

/ een InvoiceLineVO in de theInvoiceDetailList heeft een invoiceDetails,	 maar daar zitten niet de 2 invoice details in 	,
/ TODO
/ net als in database	, daar is er een fk van invoice_details naar invoice_line	, in Java (see Hibernate) is er een set aan de andere kant)	,
/ TODO

/ 13	. 

	theLastDetailDB	InvoiceDetailVO  (id=21133)	

SystemId:27126558	Amount:0	VAT:0	VATTariff:HIGH	CostType:com.mpobjects.oms.model.ratecomponenttype.RateComponentType@ba91a20[systemId=26600544,code=Freight,description=Freight Cost,group=COST,reasonMandatory=false,deleted=false,sequenceNr=10]	InvoiceLine:27126554	User 10100	Create date: 2015-06-18 11:39:35.293	

/ 13	.

	theLastLineDB	InvoiceLineVO  (id=21203)	

SystemId:27126554	Order: N0001530	Carr: 	InvoiceLineNb 10	Create date: 2015-06-18 11:39:35.219	

/ Einde Intermezzo

/ Intermezzo

/ Waar komt deze InvoiceMultiLineVO vandaan	?

/ Ga naar een ctor van InvoiceMultiLineVO	,  click ctrl-shift-g , of crtl-alt-h	,
/ we zien dat hij called	, als de page wordt geopend	, door invoice-multiline_edit	,
InvoiceMultiLineFormAction.act() line: 86	
				myVO = new InvoiceMultiLineVO(myDetailList);

/ Waar is de InvoiceMultiLineVO set tot value obj van de FormTag	?

/ Nu zijn we in de InvoiceMultiLineSaveAction	,

/ Einde Intermezzo

		InvoiceHeaderUtil.getInvoiceHeaderService().saveMultiLine(myInvoiceHeaderSystemId, myRepairInvoice, myVO);
//////////
/ spring starts TX	, and calls .saveMultiLine	,
/s
SupplierInvoiceServiceImpl.saveMultiLine(int, String, InvoiceMultiLineVO) line: 1183	
/=
	public void saveMultiLine(int myInvoiceHeaderSystemId, String myRepairInvoice, InvoiceMultiLineVO myVO) throws Exception {
myInvoiceHeaderSystemId	27126553	
myRepairInvoice	null	
myVO	InvoiceMultiLineVO  (id=20969)	

		InvoiceHeaderVO myInvoiceHeaderVO = getInvoiceHeaderDAO().getBySystemId(myInvoiceHeaderSystemId);
/ In postgres log zien we NIETS	, dus uit cache	,

myInvoiceHeaderVO	InvoiceHeaderVO  (id=22432)	
	approvementEmployee	null	
	approvementRemarks	"" (id=20830)	
	countryReceiver	Country_$$_javassist_59  (id=23126)	
	countrySender	Country_$$_javassist_59  (id=23126)	
	deblockEmployee	null	
	deleted	false	
	document	FileMeta_$$_javassist_133  (id=23132)	
	invoiceLines	PersistentSortedSet  (id=23240)	
	invoicePodStatus	InvoicePodStatus  (id=21052)	
	invoiceRechargeStatus	InvoiceHeaderRechargeStatus  (id=23241)	
	invoiceTemplate	InvoiceTemplate_$$_javassist_123  (id=23259)	
	invoiceType	InvoiceType  (id=23260)	
	lastUpdate	Date  (id=23310)	
	mustCheckTotals	true	
	organization	Organization  (id=23312)	
	performanceMonitorService	null	
	receiver	FinancialPartyVO  (id=23346)	
	rechargeDate	null	
	rechargeMarkNumber	null	
	registerEmployee	null	
	reportDate	null	
	runNumberInvoiceMatching	null	
	surcharges	PersistentSet  (id=23516)	
	systemId	27126553	
	taxLine1	null	
	taxLine2	null	
	taxLine3	null	
	taxLine4	null	
	theCarrierTotalInvoiceAmountExcVat	BigDecimal  (id=23521)	
	theCarrierTotalInvoiceAmountIncVat	BigDecimal  (id=23521)	
	theCreateDate	Timestamp  (id=23523)	
	theCurrencyVO	CurrencyVO_$$_javassist_141  (id=23524)	
	theFinancialPartyVO	FinancialPartyVO  (id=23535)	
	theInvoiceDate	Date  (id=23537)	
	theInvoiceDueDate	Date  (id=23538)	
	theInvoiceHeaderStatus	InvoiceHeaderStatus  (id=23540)	
	theInvoiceNumber	"INV-26" (id=23606)	
	theInvoiceOrganizationVO	Organization  (id=23312)	
	theInvoiceReceiptDateCopy	null	
	theInvoiceReceiptDateOriginal	null	
	theMarkNumber	"INV-26" (id=23609)	
	theMatchingErrorCode	"" (id=23611)	
	thePaymentBatchVO	null	
	theRemark	"" (id=20830)	
	theTotalInvoiceAmountExcVat	BigDecimal  (id=23614)	
	theTotalInvoiceAmountFreeVat	BigDecimal  (id=23615)	
	theTotalInvoiceAmountHighVat	BigDecimal  (id=23617)	
	theTotalInvoiceAmountIncVat	BigDecimal  (id=23618)	
	theTotalInvoiceAmountLowVat	BigDecimal  (id=23620)	
	theTotalInvoiceAmountRevVat	BigDecimal  (id=23622)	
	theTotalVatAmountHigh	BigDecimal  (id=23623)	
	theTotalVatAmountLow	BigDecimal  (id=23625)	
	theUserSystemId	10100	
	theVatPolicySystemId	26605695	
	theVatPolicyVO	VatPolicy  (id=23627)	
	theWarningCheckTotal	"" (id=23628)	
	vatNumberReceiver	"NL800353699B01" (id=23653)	
	vatNumberSender	"NL808413363B02" (id=23655)	

		String invoiceNumber = myInvoiceHeaderVO.getInvoiceNumber();
"INV-26"
		} else { // save action
			HashMap<Integer, InvoiceLineVO> myInvoiceLineList = myVO.getInvoiceLineList();
			HashMap<Integer, InvoiceDetailVO> myInvoiceDetailList = myVO.getInvoiceDetailList();
/ de 2 hashmap's van hierboven	, met resp. 2 en 1 echte entries	,

			InvoiceMatchStatus myInvoiceMatchStatus = getInvoiceMatchStatusDAO().getByCode(InvoiceMatchStatus.OPEN);
/s
InvoiceMatchStatusDAOImpl(EnumeratedValueObjectHibernateDAO).getByCode(String) line: 58	
		return getByCode(aCode, false);
/s
	@Override
	public T getByCode(String aCode, boolean aShowDeleted) {
		Map<String, Object> map = new HashMap<String, Object>(1);
		map.put(CODE_FIELD, aCode);
"OPEN"
		if (!aShowDeleted && isDeletable()) {
/ JA
			map.put(DELETED, false);
		}
		Collection<T> result = findEqualsWithQueryMap(map);
/s
InvoiceMatchStatusDAOImpl(GenericHibernateDAO).findEqualsWithQueryMap(Map<String,Object>) line: 238	
{deleted=false, code=OPEN}

		DetachedCriteria myDetachedCriteria = DetachedCriteria.forClass(type);
type	Class (com.mpobjects.invoice.model.entity.invoicematchstatus.InvoiceMatchStatus) (id=10035)	

		for (String myAttribute : aCriteriaQueryMap.keySet()) {
			myDetachedCriteria.add(Property.forName(myAttribute).eq(aCriteriaQueryMap.get(myAttribute)));

		HibernateTemplate myTemplate = getHibernateTemplate();
		myTemplate.setCacheQueries(true);
		return myTemplate.findByCriteria(myDetachedCriteria);
/t
InvoiceMatchStatusDAOImpl(EnumeratedValueObjectHibernateDAO).getByCode(String, boolean) line: 71	
		Collection<T> result = findEqualsWithQueryMap(map);
[InvoiceMatchVO [organisationSystemId=null, runNumberInvoiceMatching=null]]

/ we zien in de postgres log	,
  76659 LOG:  execute <unnamed>: BEGIN
  76660 LOG:  execute <unnamed>: select this_.SYSTEM_ID as SYSTEM1_179_0_, this_.CODE as CODE179_0_, this_.DESCRIPTION as DESCRIPT3_179_0
  76660 _, this_.IS_DELETED as IS4_179_0_ from INVOICE_MATCH_STATUS this_ where this_.IS_DELETED=$1 and this_.CODE=$2
  76661 DETAIL:  parameters: $1 = 'f', $2 = 'OPEN'


/t
SupplierInvoiceServiceImpl.saveMultiLine(int, String, InvoiceMultiLineVO) line: 1206	
			InvoiceMatchStatus myInvoiceMatchStatus = getInvoiceMatchStatusDAO().getByCode(InvoiceMatchStatus.OPEN);
/d
myInvoiceMatchStatus	InvoiceMatchStatus  (id=24712)	
	code	"OPEN" (id=24869)	
	deleted	false	
	description	"The invoice line/detail is open" (id=24873)	
	endTime	null	
	initialToProcess	0	
	lastRunNumber	null	
	message	null	
	openDetails	0	
	openInvoices	0	
	openLines	0	
	organizationCode	null	
	performanceMonitorService	null	
	processed	0	
	projectedEndTime	null	
	startTime	null	
	status	InvoiceMatchStatus$Status  (id=24923)	
	systemId	1	

		for (Entry<Integer, InvoiceLineVO> lineEntry : myInvoiceLineList.entrySet()) {
				InvoiceLineVO myLine = lineEntry.getValue();
				// This number cannot be equal to 0
				if (myLine.getRealRowNumber() > 0) {
/ onze ene line	 in de lijst van 21	,,
					String myCarrierReference = myLine.getCarrierReference();
myCarrierReference	"" (id=20830)	
					String myLogisticsOrderReference = myLine.getLogisticsOrderReference();
myLogisticsOrderReference	"N0001530" (id=27200)	
					if (!(StringUtils.isEmpty(myLogisticsOrderReference) && StringUtils.isEmpty(myCarrierReference))) {
/ JA
						} else {
							ServiceOrderVO myServiceOrder = getServiceOrderService().getServiceOrderByServiceOrderId(myLogisticsOrderReference);
							myLine.setServiceOrderVO(myServiceOrder);

/ Intermezzo

/ we zien in postgres log	,
select ...
from SERVICE_ORDER this_ 
left outer join TMS_USER resource2_ on this_.CREATED_BY_SYSTEMID=resource2_.SYSTEM_ID 
left outer join TMS_USER resource3_ on resource2_.CREATED_BY=resource3_.SYSTEM_ID 
left outer join HOLD_STATUS holdstatus4_ on this_.HOLD_STATUS_SYSTEMID=holdstatus4_.SYSTEM_ID 
left outer join INSTRUCTION_GROUP instructio5_ on this_.INSTRUCTION_GROUP_SYSTEMID=instructio5_.SYSTEM_ID 
left outer join ORGANIZATION organizati6_ on this_.ORGANIZATION_SYSTEMID=organizati6_.SYSTEM_ID 
left outer join ORGANIZATION organizati7_ on organizati6_.ORGANIZATION_GROUP=organizati7_.SYSTEM_ID 
left outer join SERVICE_ORDER_TYPE serviceord8_ on this_.SERVICE_ORDER_TYPE_SYSTEMID=serviceord8_.SYSTEM_ID 
left outer join SERVICE_TYPE servicetyp9_ on this_.SERVICE_TYPE_SYSTEMID=servicetyp9_.SYSTEM_ID 
left outer join TMS_USER resource10_ on this_.APPROVEDBY_SYSTEMID=resource10_.SYSTEM_ID 
left outer join TMS_USER resource11_ on this_.POSTCALC_APPROVEDBY_SYSTEMID=resource11_.SYSTEM_ID 
where this_.organization_systemid in (
	select uo.organization_systemid 
	from user_organization uo 
	where uo.user_systemid = $1) 
	and this_.SERVICE_ORDER_ID=$2 limit $3
DETAIL:  parameters: $1 = '27128130', $2 = 'N0001530', $3 = '1'
/ TODO HIBERNATE

select ... 
from USER_ROLE roles0_ 
inner join TMS_ROLE rolevo1_ on roles0_.ROLE_SYSTEMID=rolevo1_.SYSTEM_ID 
where roles0_.USER_SYSTEMID in ($1, $2, $3, $4)
DETAIL:  parameters: $1 = '26594669', $2 = '26594980', $3 = '26594543', $4 = '26594649'

select ... 
from PROPERTIES_VALUE properties0_ 
left outer join ORGANIZATION organizati1_ on properties0_.ORGANIZATION_SYSTEM_ID=organizati1_.SYSTEM_ID 
left outer join ORGANIZATION organizati2_ on organizati1_.ORGANIZATION_GROUP=organizati2_.SYSTEM_ID 
where properties0_.USER_SYSTEM_ID=$1
DETAIL:  parameters: $1 = '26594980'

select ... 
from USER_ORGANIZATION userorgani0_ 
where userorgani0_.USER_SYSTEMID=$1
DETAIL:  parameters: $1 = '26594980'

LOG:  execute <unnamed>: BEGIN

select ... 
from INTERFACE_TRIGGER_EVENT this_ 
where this_.INTERFACE_ID=$1 
and this_.STATUS=$2 
and this_.EVENT_DATE between $3 and $4 
order by this_.EVENT_DATE asc limit $5
DETAIL:  parameters: $1 = 'ADD_SERVICE_ORDER_PRICE_PART', $2 = '1', $3 = '2015-04-18 15:01:26.117', $4 = '2015-07-17 15:01:26.117', $5 = '50'

LOG:  execute S_1: COMMIT

/ Einde Intermezzo

						myInvoiceHeaderVO.addInvoiceLine(myLine);
						myLine = getInvoiceLineDAO().save(myLine);

/ Herinner dat de service call .saveMultiLine in TX runs, dus deze save zal pas later worden commit	,
/s
InvoiceLineDAOImpl.save(InvoiceLineVO) line: 346	
		...
		return super.merge(aInvoiceLine);
/s
InvoiceLineDAOImpl(GenericHibernateDAO).merge(Type) line: 421	
		} else {
			anObject = type.cast(getHibernateTemplate().merge(anObject));
anObject	InvoiceLineVO  (id=25091)	

/t
InvoiceMultiLineSaveAction.handleSave() line: 61	
		InvoiceHeaderUtil.getInvoiceHeaderService().saveMultiLine(myInvoiceHeaderSystemId, myRepairInvoice, myVO);

/ spring heeft TX commit	,

/ we zien in postgres log	,

LOG:  execute <unnamed>: update INVOICE_LINE set IS_DELETED=$1, CONTAINER_COUNT=$2, INVOICE_POD_STATUS=$3, INVOICE_RECHARGE_STATUS=$4, LOADING_METERS=$5, LOADING_METERS_UOM=$6, PAY_WEIGHT=$7, PAY_WEIGHT_UOM=$8, POD_REMARK=$9, RECHARGE_DATE=$10, RECHARGE_MARK_NUMBER=$11, CARRIER_REFERENCE=$12, CREATE_DATE=$13, LINE_NUMBER=$14, LOGISTICS_ORDER_REFERENCE=$15, MATCHING_ERROR_CODE=$16, REMARK=$17, SHIPMENT_ORDER_SYSTEMID=$18, SERVICE_ORDER_SYSTEMID=$19, VOLUME=$20, VOLUME_UOM=$21, WEIGHT=$22, WEIGHT_UOM=$23, ORDER_PROCESS_SYSTEMID=$24, USER_SYSTEMID=$25, MATCH_STATUS_SYSTEMID=$26 where SYSTEM_ID=$27
DETAIL:  parameters: $1 = 'f', $2 = NULL, $3 = 'UNKNOWN', $4 = 'INITIAL', $5 = NULL, $6 = NULL, $7 = NULL, $8 = NULL, $9 = '', $10 = NULL, $11 = NULL, $12 = '', $13 = '2015-07-21 09:46:40.452', $14 = '10', $15 = 'N0001709', $16 = '', $17 = '', $18 = NULL, $19 = '27125854', $20 = NULL, $21 = NULL, $22 = NULL, $23 = NULL, $24 = NULL, $25 = '27128130', $26 = '1', $27 = '27125923'

LOG:  execute <unnamed>: update INVOICE_DETAIL set USER_SYSTEMID=$1, CREATE_DATE=$2, IS_DELETED=$3, MATCH_STATUS_SYSTEMID=$4, AMOUNT=$5, AMOUNT_VAT=$6, VAT_TARIF_TYPE=$7, COST_TYPE_SYSTEMID=$8, REMARK=$9, MATCHING_ERROR_CODE=$10, SURCHARGE_BASED=$11, SURCHARGE_SYSTEMID=$12, TAX_1_BASE_AMOUNT=$13, TAX_1_TAX_AMOUNT=$14, TAX_1_TAX_TARIFF=$15, TAX_1_TAX_TYPE=$16, TAX_1_DESCRIPTION=$17 where SYSTEM_ID=$18
DETAIL:  parameters: $1 = '27128130', $2 = '2015-07-21 09:46:40.452', $3 = 'f', $4 = '1', $5 = '-413.44999999999998863131622783839702606201171875', $6 = '-86.81999999999999317878973670303821563720703125', $7 = 'HIGH', $8 = '26671397', $9 = '', $10 = '', $11 = 'f', $12 = NULL, $13 = NULL, $14 = NULL, $15 = NULL, $16 = 'HIGH', $17 = NULL, $18 = '27125925'

LOG:  execute <unnamed>: update INVOICE_DETAIL set USER_SYSTEMID=$1, CREATE_DATE=$2, IS_DELETED=$3, MATCH_STATUS_SYSTEMID=$4, AMOUNT=$5, AMOUNT_VAT=$6, VAT_TARIF_TYPE=$7, COST_TYPE_SYSTEMID=$8, REMARK=$9, MATCHING_ERROR_CODE=$10, SURCHARGE_BASED=$11, SURCHARGE_SYSTEMID=$12, TAX_1_BASE_AMOUNT=$13, TAX_1_TAX_AMOUNT=$14, TAX_1_TAX_TARIFF=$15, TAX_1_TAX_TYPE=$16, TAX_1_DESCRIPTION=$17 where SYSTEM_ID=$18
DETAIL:  parameters: $1 = '27128130', $2 = '2015-07-21 09:46:40.452', $3 = 'f', $4 = '1', $5 = '8269', $6 = '1736.490000000000009094947017729282379150390625', $7 = 'HIGH', $8 = '26600544', $9 = NULL, $10 = '', $11 = 'f', $12 = NULL, $13 = NULL, $14 = NULL, $15 = NULL, $16 = 'HIGH', $17 = NULL, $18 = '27128275'

LOG:  execute <unnamed>: update INVOICE_DETAIL set USER_SYSTEMID=$1, CREATE_DATE=$2, IS_DELETED=$3, MATCH_STATUS_SYSTEMID=$4, AMOUNT=$5, AMOUNT_VAT=$6, VAT_TARIF_TYPE=$7, COST_TYPE_SYSTEMID=$8, REMARK=$9, MATCHING_ERROR_CODE=$10, SURCHARGE_BASED=$11, SURCHARGE_SYSTEMID=$12, TAX_1_BASE_AMOUNT=$13, TAX_1_TAX_AMOUNT=$14, TAX_1_TAX_TARIFF=$15, TAX_1_TAX_TYPE=$16, TAX_1_DESCRIPTION=$17 where SYSTEM_ID=$18
DETAIL:  parameters: $1 = '27128130', $2 = '2015-07-20 17:34:22.519', $3 = 't', $4 = '1', $5 = '0', $6 = '0', $7 = 'HIGH', $8 = '26595322', $9 = NULL, $10 = '', $11 = 'f', $12 = NULL, $13 = NULL, $14 = NULL, $15 = NULL, $16 = 'HIGH', $17 = NULL, $18 = '27128277'

LOG:  execute S_1: COMMIT

/ Einde Save and Close invoice line	,


/ 7	. 

/ Hij doet het toch	, maar nu zien we in de header	,

Total cost high not correct! Calculated:-361.5 Check A: total amount exc vat not correct! Calculated:-361.5 Check D: Total exc VAT not correct! Calculated:-361.5 Check E: Total VAT High not correct! Calculated:-75.92



/ 7	. 


/ we hebben een detail added aan inv-22	, en rm hem	,
/ we click op de line Save and Close	,

LOG:  execute <unnamed>: update INVOICE_LINE set IS_DELETED=$1, CONTAINER_COUNT=$2, INVOICE_POD_STATUS=$3, INVOICE_RECHARGE_STATUS=$4, LO
ADING_METERS=$5, LOADING_METERS_UOM=$6, PAY_WEIGHT=$7, PAY_WEIGHT_UOM=$8, POD_REMARK=$9, RECHARGE_DATE=$10, RECHARGE_MARK_NUMBER=$11, CAR
RIER_REFERENCE=$12, CREATE_DATE=$13, LINE_NUMBER=$14, LOGISTICS_ORDER_REFERENCE=$15, MATCHING_ERROR_CODE=$16, REMARK=$17, SHIPMENT_ORDER_
SYSTEMID=$18, SERVICE_ORDER_SYSTEMID=$19, VOLUME=$20, VOLUME_UOM=$21, WEIGHT=$22, WEIGHT_UOM=$23, ORDER_PROCESS_SYSTEMID=$24, USER_SYSTEM
ID=$25, MATCH_STATUS_SYSTEMID=$26 where SYSTEM_ID=$27
DETAIL:  parameters: $1 = 'f', $2 = NULL, $3 = 'UNKNOWN', $4 = 'INITIAL', $5 = NULL, $6 = NULL, $7 = NULL, $8 = NULL, $9 = '', $10 = NULL
, $11 = NULL, $12 = '', $13 = '2015-07-17 17:05:17.792', $14 = '10', $15 = 'N0001709', $16 = '', $17 = '', $18 = NULL, $19 = '27125854', 
$20 = NULL, $21 = NULL, $22 = NULL, $23 = NULL, $24 = NULL, $25 = '27128130', $26 = '1', $27 = '27125923'
LOG:  execute <unnamed>: update INVOICE_DETAIL set USER_SYSTEMID=$1, CREATE_DATE=$2, IS_DELETED=$3, MATCH_STATUS_SYSTEMID=$4, AMOUNT=$5, 
AMOUNT_VAT=$6, VAT_TARIF_TYPE=$7, COST_TYPE_SYSTEMID=$8, REMARK=$9, MATCHING_ERROR_CODE=$10, SURCHARGE_BASED=$11, SURCHARGE_SYSTEMID=$12,
 TAX_1_BASE_AMOUNT=$13, TAX_1_TAX_AMOUNT=$14, TAX_1_TAX_TARIFF=$15, TAX_1_TAX_TYPE=$16, TAX_1_DESCRIPTION=$17 where SYSTEM_ID=$18
DETAIL:  parameters: $1 = '27128130', $2 = '2015-07-17 17:05:17.792', $3 = 'f', $4 = '1', $5 = '-413.44999999999998863131622783839702606201171875', $6 = '-86.81999999999999317878973670303821563720703125', $7 = 'HIGH', $8 = '26671397', $9 = '', $10 = '', $11 = 'f', $12 = NULL, $13 = NULL, $14 = NULL, $15 = NULL, $16 = 'HIGH', $17 = NULL, $18 = '27125925'

LOG:  execute <unnamed>: update INVOICE_DETAIL set USER_SYSTEMID=$1, CREATE_DATE=$2, IS_DELETED=$3, MATCH_STATUS_SYSTEMID=$4, AMOUNT=$5, AMOUNT_VAT=$6, VAT_TARIF_TYPE=$7, COST_TYPE_SYSTEMID=$8, REMARK=$9, MATCHING_ERROR_CODE=$10, SURCHARGE_BASED=$11, SURCHARGE_SYSTEMID=$12, TAX_1_BASE_AMOUNT=$13, TAX_1_TAX_AMOUNT=$14, TAX_1_TAX_TARIFF=$15, TAX_1_TAX_TYPE=$16, TAX_1_DESCRIPTION=$17 where SYSTEM_ID=$18
DETAIL:  parameters: $1 = '27128130', $2 = '2015-07-17 17:05:17.792', $3 = 'f', $4 = '1', $5 = '8269', $6 = '1736.490000000000009094947017729282379150390625', $7 = 'HIGH', $8 = '26600544', $9 = '', $10 = '', $11 = 'f', $12 = NULL, $13 = NULL, $14 = NULL, $15 = NULL, $16 = 'HIGH', $17 = NULL, $18 = '27125927'

LOG:  execute <unnamed>: update INVOICE_DETAIL set USER_SYSTEMID=$1, CREATE_DATE=$2, IS_DELETED=$3, MATCH_STATUS_SYSTEMID=$4, AMOUNT=$5, AMOUNT_VAT=$6, VAT_TARIF_TYPE=$7, COST_TYPE_SYSTEMID=$8, REMARK=$9, MATCHING_ERROR_CODE=$10, SURCHARGE_BASED=$11, SURCHARGE_SYSTEMID=$12, TAX_1_BASE_AMOUNT=$13, TAX_1_TAX_AMOUNT=$14, TAX_1_TAX_TARIFF=$15, TAX_1_TAX_TYPE=$16, TAX_1_DESCRIPTION=$17 where SYSTEM_ID=$18
DETAIL:  parameters: $1 = '27128130', $2 = '2015-07-17 16:57:02.226', $3 = 't', $4 = '1', $5 = '0', $6 = '0', $7 = 'HIGH', $8 = '26595322', $9 = NULL, $10 = '', $11 = 'f', $12 = NULL, $13 = NULL, $14 = NULL, $15 = NULL, $16 = 'HIGH', $17 = NULL, $18 = '27128268'
LOG:  execute S_1: COMMIT

/ we click Save and Close op de header	, 
/ we zien weer	 de oorspronkelijke values,

isbscs4=# select*from invoice_detail where system_id=27128268;
 system_id |       create_date       | user_systemid |  amount   | amount_vat | vat_tarif_type | invoice_line_systemid | cost_typ
e_systemid | match_status_systemid | remark | is_deleted | matching_error_code | surcharge_based | surcharge_systemid | tax_1_bas
e_amount | tax_1_tax_amount | tax_1_tax_tariff | tax_1_tax_type | tax_1_description 
-----------+-------------------------+---------------+-----------+------------+----------------+-----------------------+---------
-----------+-----------------------+--------+------------+---------------------+-----------------+--------------------+----------
---------+------------------+------------------+----------------+-------------------
  27128268 | 2015-07-17 16:24:21.722 |      27128130 | 100.00000 |   21.00000 | HIGH           |              27125923 |         
  26595322 |                     1 |        |          0 |                     |               0 |                    |          
         |                  |                  | HIGH           | 
(1 row)

/ TODO

/ 7	.

/ add een invoice detail	,

/ we add aan inv-26 weer de detail die er al was	,

/ we zien in het 'create mode' scherm op de bovenste regel de laatste invoice detail 	, 

/ we click 'Create mode: new page'	,
/ dit is invoice-multiline_create	,

$ vi invoce-sitemap.xmap

			<!-- multiline -->
			<map:match type="regexp" pattern="^invoice-multiline_(edit|create)$">
				<map:act type="setAttributes" >
					<map:parameter name="attributesType" value="request"/>
     				<map:parameter name="edit-type" value="{1}"/>
     				<map:parameter name="base_controlFlow" value="false" />
                </map:act>
				<map:act type="invoiceMultiLineForm"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/invoice-multiline_edit.jsp"/>
			</map:match>
/s
InvoiceMultiLineFormAction.act() line: 47	

		if (getSession().getAttribute(HEADER_ID_ATT_NAME) != null) {
			theInvoiceHeaderSystemId = (Integer) getSession().getAttribute(HEADER_ID_ATT_NAME);

		InvoiceLineVO lastInvoiceLine = InvoiceLineUtil.getDAO().getLastInvoiceLine(theInvoiceHeaderSystemId);

/ we zien in postgres log	,
select ...
 from INVOICE_LINE this_ 
left outer join TMS_USER resource2_ on this_.USER_SYSTEMID=resource2_.SYSTEM_ID 
left outer join TMS_USER resource3_ on resource2_.CREATED_BY=resource3_.SYSTEM_ID 
left outer join INVOICE_MATCH_STATUS invoicemat4_ on this_.MATCH_STATUS_SYSTEMID=invoicemat4_.SYSTEM_ID 
left outer join INVOICE_HEADER invoicehea5_ on this_.INVOICE_HEADER_SYSTEMID=invoicehea5_.SYSTEM_ID 
left outer join INVOICE_FINANCIAL_PARTY financialp6_ on invoicehea5_.FINANCIAL_PARTY_SYSTEMID=financialp6_.SYSTEM_ID 
left outer join INVOICE_FINANCIAL_PARTY financialp7_ on invoicehea5_.RECEIVER_SYSTEMID=financialp7_.SYSTEM_ID 
left outer join INVOICE_PAYMENT_BATCH paymentbat8_ on invoicehea5_.INVOICE_PAYMENT_BATCH_SYSTEMID=paymentbat8_.SYSTEM_ID 
left outer join ORGANIZATION organizati9_ on paymentbat8_.ORGANIZATION_SYSTEMID=organizati9_.SYSTEM_ID 
left outer join ORGANIZATION organizati10_ on organizati9_.ORGANIZATION_GROUP=organizati10_.SYSTEM_ID 
left outer join TMS_USER resource11_ on paymentbat8_.PAID_BY_USER_SYSTEMID=resource11_.SYSTEM_ID 
left outer join TMS_USER resource12_ on paymentbat8_.CREATED_BY_USER_SYSTEMID=resource12_.SYSTEM_ID 
left outer join TMS_USER resource13_ on paymentbat8_.VALIDATED_BY_USER_SYSTEMID=resource13_.SYSTEM_ID 
left outer join INVOICE_VAT_POLICY vatpolicy14_ on invoicehea5_.VAT_POLICY_SYSTEMID=vatpolicy14_.SYSTEM_ID 
left outer join ORGANIZATION organizati15_ on invoicehea5_.INVOICE_ORGANIZATION_ID=organizati15_.SYSTEM_ID 
left outer join ORGANIZATION organizati16_ on invoicehea5_.ORGANIZATION_SYSTEMID=organizati16_.SYSTEM_ID 
where this_.INVOICE_HEADER_SYSTEMID=$1 
and this_.IS_DELETED=$2 order by this_.LINE_NUMBER desc limit $3
DETAIL:  parameters: $1 = '27126553', $2 = 'f', $3 = '1'
LOG:  execute S_1: COMMIT

		String editType = (String) getRequest().getAttribute("edit-type");
"create"
		} else {
			// create
			InvoiceDetailVO lastInvoiceDetail = new InvoiceDetailVO();
			if (lastInvoiceLine != null && lastInvoiceLine.isPersistent()) {
/ JA
				lastInvoiceDetail = MpoBeanFactory.getBean(InvoiceDetailDAO.class).getLastInvoiceDetail(lastInvoiceLine.getSystemId());
/s
InvoiceDetailDAOImpl.class
		DetachedCriteria myDetachedCriteria = DetachedCriteria.forClass(InvoiceDetailVO.class).add(
				Property.forName("invoiceLineVO.systemId").eq(aInvoiceLineSystemId));
		myDetachedCriteria.addOrder(Order.desc("systemId"));
		List<InvoiceDetailVO> invoiceDetail = getHibernateTemplate().findByCriteria(myDetachedCriteria);

		} else {
			return invoiceDetail.get(0);

/ we zien in postgres log	,
LOG:  execute <unnamed>: BEGIN
LOG:  execute <unnamed>: select ... 
from INVOICE_DETAIL this_ 
left outer join INVOICE_MATCH_STATUS invoicemat2_ on this_.MATCH_STATUS_SYSTEMID=invoicemat2_.SYSTEM_ID 
left outer join RATE_COMPONENT_TYPE ratecompon3_ on this_.COST_TYPE_SYSTEMID=ratecompon3_.SYSTEM_ID 
where this_.INVOICE_LINE_SYSTEMID=$1 
order by this_.SYSTEM_ID desc
DETAIL:  parameters: $1 = '27126554'
LOG:  execute S_1: COMMIT

/t
			myVO = new InvoiceMultiLineVO(lastInvoiceLine, lastInvoiceDetail);
			myVO.setInvoiceHeaderSystemId(theInvoiceHeaderSystemId);
			...

		if (lastInvoiceLine != null) {
			if (lastInvoiceLine.getInvoiceHeaderVO().getInvoiceHeaderStatus().equals(InvoiceHeaderStatus.INITIAL)) {
				isReadOnly = false;

		getRequest().setAttribute("isReadOnly", isReadOnly);
false
		getRequest().setAttribute("isReadOnlyRecharged", isReadOnlyRecharged);
false

		myVO.setInvoiceHeaderSystemId(theInvoiceHeaderSystemId);
/ myVO=InvoiceMultiLineVO
SystemId:0	

		if (lastInvoiceLine != null) {
			getRequest().setAttribute("lastDB", lastInvoiceLine.getInvoiceLineNumber());
		getRequest().setAttribute("formVO", myVO);
		getRequest().setAttribute("vatPolicy", myVO.getInvoiceHeaderVO().getVatPolicy().toCSV());
21.00000;6.00000;0.00000;0.00000

/ 7	. 

/ op inv-22 we remove de laatste detail	,

LOG:  execute <unnamed>: update INVOICE_LINE set IS_DELETED=$1, CONTAINER_COUNT=$2, INVOICE_POD_STATUS=$3, INVOICE_RECHARGE_STATUS=$4, LOADING_METERS=$5, LOADING_METERS_UOM=$6, PAY_WEIGHT=$7, PAY_WEIGHT_UOM=$8, POD_REMARK=$9, RECHARGE_DATE=$10, RECHARGE_MARK_NUMBER=$11, CARRIER_REFERENCE=$12, CREATE_DATE=$13, LINE_NUMBER=$14, LOGISTICS_ORDER_REFERENCE=$15, MATCHING_ERROR_CODE=$16, REMARK=$17, SHIPMENT_ORDER_SYSTEMID=$18, SERVICE_ORDER_SYSTEMID=$19, VOLUME=$20, VOLUME_UOM=$21, WEIGHT=$22, WEIGHT_UOM=$23, ORDER_PROCESS_SYSTEMID=$24, USER_SYSTEMID=$25, MATCH_STATUS_SYSTEMID=$26 where SYSTEM_ID=$27
DETAIL:  parameters: $1 = 'f', $2 = NULL, $3 = 'UNKNOWN', $4 = 'INITIAL', $5 = NULL, $6 = NULL, $7 = NULL, $8 = NULL, $9 = '', $10 = NULL, $11 = NULL, $12 = '', $13 = '2015-07-20 10:56:44.604', $14 = '10', $15 = 'N0001709', $16 = '', $17 = '', $18 = NULL, $19 = '27125854', $20 = NULL, $21 = NULL, $22 = NULL, $23 = NULL, $24 = NULL, $25 = '27128130', $26 = '1', $27 = '27125923'
LOG:  execute <unnamed>: update INVOICE_DETAIL set USER_SYSTEMID=$1, CREATE_DATE=$2, IS_DELETED=$3, MATCH_STATUS_SYSTEMID=$4, AMOUNT=$5, AMOUNT_VAT=$6, VAT_TARIF_TYPE=$7, COST_TYPE_SYSTEMID=$8, REMARK=$9, MATCHING_ERROR_CODE=$10, SURCHARGE_BASED=$11, SURCHARGE_SYSTEMID=$12, TAX_1_BASE_AMOUNT=$13, TAX_1_TAX_AMOUNT=$14, TAX_1_TAX_TARIFF=$15, TAX_1_TAX_TYPE=$16, TAX_1_DESCRIPTION=$17 where SYSTEM_ID=$18
DETAIL:  parameters: $1 = '27128130', $2 = '2015-07-20 10:56:44.604', $3 = 'f', $4 = '1', $5 = '-413.44999999999998863131622783839702606201171875', $6 = '-86.81999999999999317878973670303821563720703125', $7 = 'HIGH', $8 = '26671397', $9 = '', $10 = '', $11 = 'f', $12 = NULL, $13 = NULL, $14 = NULL, $15 = NULL, $16 = 'HIGH', $17 = NULL, $18 = '27125925'
LOG:  execute <unnamed>: update INVOICE_DETAIL set USER_SYSTEMID=$1, CREATE_DATE=$2, IS_DELETED=$3, MATCH_STATUS_SYSTEMID=$4, AMOUNT=$5, AMOUNT_VAT=$6, VAT_TARIF_TYPE=$7, COST_TYPE_SYSTEMID=$8, REMARK=$9, MATCHING_ERROR_CODE=$10, SURCHARGE_BASED=$11, SURCHARGE_SYSTEMID=$12, TAX_1_BASE_AMOUNT=$13, TAX_1_TAX_AMOUNT=$14, TAX_1_TAX_TARIFF=$15, TAX_1_TAX_TYPE=$16, TAX_1_DESCRIPTION=$17 where SYSTEM_ID=$18
DETAIL:  parameters: $1 = '27128130', $2 = '2015-07-20 10:56:44.604', $3 = 'f', $4 = '1', $5 = '8269', $6 = '1736.490000000000009094947017729282379150390625', $7 = 'HIGH', $8 = '26600544', $9 = '', $10 = '', $11 = 'f', $12 = NULL, $13 = NULL, $14 = NULL, $15 = NULL, $16 = 'HIGH', $17 = NULL, $18 = '27125927'
LOG:  execute <unnamed>: update INVOICE_DETAIL set USER_SYSTEMID=$1, CREATE_DATE=$2, IS_DELETED=$3, MATCH_STATUS_SYSTEMID=$4, AMOUNT=$5, AMOUNT_VAT=$6, VAT_TARIF_TYPE=$7, COST_TYPE_SYSTEMID=$8, REMARK=$9, MATCHING_ERROR_CODE=$10, SURCHARGE_BASED=$11, SURCHARGE_SYSTEMID=$12, TAX_1_BASE_AMOUNT=$13, TAX_1_TAX_AMOUNT=$14, TAX_1_TAX_TARIFF=$15, TAX_1_TAX_TYPE=$16, TAX_1_DESCRIPTION=$17 where SYSTEM_ID=$18
DETAIL:  parameters: $1 = '27128130', $2 = '2015-07-17 16:24:21.722', $3 = 't', $4 = '1', $5 = '0', $6 = '0', $7 = 'HIGH', $8 = '26595322', $9 = NULL, $10 = '', $11 = 'f', $12 = NULL, $13 = NULL, $14 = NULL, $15 = NULL, $16 = 'HIGH', $17 = NULL, $18 = '27128268'
LOG:  execute S_1: COMMIT

/ de invoice line is 27125923	,

/ 7	. 

/ save invoice header	,

/ SAVE INVOICE HEADER
j
/ we click Save and close op de invoice header	,

<input type="button" id="saveAndCloseBtn" value="Save and Close" onclick=" theEditFormFormManager.submit('../invoice/invoice-header_save', true, '-1'); return false;">

$ vi invoice-sitemap.xmap

			<map:match pattern="invoice-header_save">
				<map:act type="invoiceHeaderSave"/>
			</map:match>

			<map:action logger="invoice" name="invoiceHeaderSave"   src="com.mpobjects.invoice.control.invoiceheader.action.InvoiceHeaderSaveAction"/>

/s
InvoiceHeaderSaveAction.handleSave() line: 102	
		int mySystemId = getSystemIdFromRequest();
27125922 
/ de invoice line is 27125923	,

			myVO.setOrganization(myVO.getInvoiceOrganizationVO());
SystemId:520	Id:ISB-C&S	Description:Interstream Barging BU Chemicals & Specialties

		myVO.setVatNumberSender(myVO.getSender().getVatNumber());
NL808413363B02
/ getSender()
/= theFinancialPartyVO
/ =SystemId:27071973	FinancialParty:ISB-C&S	

		if (myVO.getReceiver() != null) {
			myVO.setVatNumberReceiver(myVO.getReceiver().getVatNumber());
/ getReceiver()
/= receiver
/= SystemId:240035	FinancialParty:CHARTER0035	

		/* Getting the invoice action */
		Action myAction = Action.parse(getForm().getRequest().getParameter("hiddenActionBtn"));
null
/ want	,
/ getForm().getRequest().getParameter("hiddenActionBtn")=false
/s
	// Later can be used in the jsp
	public enum Action {
		APPROVE("approve"),
		BLOCK("block"),
		BLOCK_RECHARGE("blockRecharge"),
		BOOK("book"),
		CREATE_CREDIT_INVOICE("createCreditInvoice"),
		DEBLOCK("deblock"),
		DEBLOCK_RECHARGE("deblockRecharge"),
		FINALIZE("finalize"),
		GENERATE_SURCHARGES("generateSurcharges"),
		MANUALLY_ACCEPT_POD("manuallyAcceptPod"),
		MATCH_MANUALLY("matchManually"),
		PAID("paid"),
		PARTIALLY_PAID("partiallyPaid"),
		REJECT("reject"),
		SAVE_AND_NEW("saveAndNew");

		public static final Action parse(String aValue) {
			for (Action myAction : EnumSet.allOf(InvoiceHeaderSaveAction.Action.class)) {
				if (myAction.getValue().equalsIgnoreCase(aValue)) {
/ NEE
			return null;

/t
		SupplierInvoiceService myService = InvoiceHeaderUtil.getInvoiceHeaderService();
		InvoiceHeaderDAO myDao = InvoiceHeaderUtil.getDAO();
/ proxy naar InvoiceHeaderDAOImpl

			if (Action.GENERATE_SURCHARGES.equals(myAction)) {
/ NEE
			} else if (Action.CREATE_CREDIT_INVOICE.equals(myAction)) {
/ NEE
			} else {
				myVO.setMustCheckTotals(true);

				if (Action.REJECT.equals(myAction)) {
/ NEE
				} else if (Action.APPROVE.equals(myAction)) {
/ NEE
				} else if (Action.MATCH_MANUALLY.equals(myAction) && !shouldLogisticsOrderReferenceExist) {
/ NEE
				} else if (Action.PAID.equals(myAction)) {
/ NEE
				} else if (Action.PARTIALLY_PAID.equals(myAction)) {
/ NEE
				} else if (Action.BOOK.equals(myAction)) {
/ NEE
				} else if (Action.BLOCK.equals(myAction)) {
/ NEE
				} else if (Action.DEBLOCK.equals(myAction)) {
/ NEE
				} else if (Action.MANUALLY_ACCEPT_POD.equals(myAction)) {
/ NEE
				} else if (Action.BLOCK_RECHARGE.equals(myAction)) {
/ NEE
				} else if (Action.DEBLOCK_RECHARGE.equals(myAction)) {
/ NEE
				} else if (Action.FINALIZE.equals(myAction)) {
/ NEE
				} else {
					myService.checkTotals(myVO);
/ starts TX
/s
			Collection<InvoiceDetailVO> myInvoiceHeaderDetailList = getInvoiceHeaderDetailList(myVO.getSystemId());
/s

	@Override
	public List<InvoiceDetailVO> getInvoiceDetailList(int aInvoiceSystemId) {
		StringBuilder mySQL = new StringBuilder("SELECT ID.* FROM INVOICE_DETAIL ID, INVOICE_LINE IL  WHERE ID.INVOICE_LINE_SYSTEMID"
				+ "= IL.SYSTEM_ID AND IL.INVOICE_HEADER_SYSTEMID = :invoiceHeaderSystemId AND ID.IS_DELETED  =0 AND IL.IS_DELETED =0");

		Collection<QueryParameter> params = new ArrayList<QueryParameter>();
		params.add(new IntNamedQueryParameter("invoiceHeaderSystemId", aInvoiceSystemId));
		return executeSqlSelect(mySQL.toString(), "ID", params);


/t

/ Intermezzo

/ we zien in de postgres log	,

LOG:  execute <unnamed>: BEGIN
LOG:  execute <unnamed>: SELECT ID.* 
FROM INVOICE_DETAIL ID, INVOICE_LINE IL  
WHERE ID.INVOICE_LINE_SYSTEMID= IL.SYSTEM_ID 
AND IL.INVOICE_HEADER_SYSTEMID = $1 
AND ID.IS_DELETED  =0 AND IL.IS_DELETED =0
DETAIL:  parameters: $1 = '27125922'

[SystemId:27125925	Amount:-413.45000	VAT:-86.82000	VATTariff:HIGH	CostType:com.mpobjects.oms.model.ratecomponenttype.RateComponentType@5bb5bc05[systemId=26671397,code=Freight Commission,description=Freight Commission for ISB,group=COST,reasonMandatory=false,deleted=false,sequenceNr=60]	InvoiceLine:27125923	User 27128130	Create date: 2015-07-20 10:56:44.604	, 
SystemId:27125927	Amount:8269.00000	VAT:1736.49000	VATTariff:HIGH	CostType:com.mpobjects.oms.model.ratecomponenttype.RateComponentType@63266c8a[systemId=26600544,code=Freight,description=Freight Cost,group=COST,reasonMandatory=false,deleted=false,sequenceNr=10]	InvoiceLine:27125923	User 27128130	Create date: 2015-07-20 10:56:44.604	]

/ Inderdaad: IS_DELETED=0	,

SELECT ID.* 
FROM INVOICE_DETAIL ID, INVOICE_LINE IL  
WHERE ID.INVOICE_LINE_SYSTEMID= IL.SYSTEM_ID 
AND IL.INVOICE_HEADER_SYSTEMID = 27125922;

 system_id |       create_date       | user_systemid |   amount   | amount_vat | vat_tarif_type | invoice_line_systemid | cost_ty
pe_systemid | match_status_systemid | remark | is_deleted | matching_error_code | surcharge_based | surcharge_systemid | tax_1_ba
se_amount | tax_1_tax_amount | tax_1_tax_tariff | tax_1_tax_type | tax_1_description 
-----------+-------------------------+---------------+------------+------------+----------------+-----------------------+--------
------------+-----------------------+--------+------------+---------------------+-----------------+--------------------+---------
----------+------------------+------------------+----------------+-------------------
  27125925 | 2015-07-20 10:56:44.604 |      27128130 | -413.45000 |  -86.82000 | HIGH           |              27125923 |        
   26671397 |                     1 |        |          0 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
  27125927 | 2015-07-20 10:56:44.604 |      27128130 | 8269.00000 | 1736.49000 | HIGH           |              27125923 |        
   26600544 |                     1 |        |          0 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
  27128268 | 2015-07-17 16:24:21.722 |      27128130 |    0.00000 |    0.00000 | HIGH           |              27125923 |        
   26595322 |                     1 |        |          1 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
(3 rows)

/ Einde Intermezzo

			if (StringUtils.isNotEmpty(theWarning.toString())) {
				setHeaderStatus(myVO, InvoiceHeaderStatus.INITIAL);
/s
SupplierInvoiceServiceImpl.setHeaderStatus(InvoiceHeaderVO, InvoiceHeaderStatus) line: 1302	
		myVO = save(myVO);
/s
SupplierInvoiceServiceImpl.save(InvoiceHeaderVO) line: 1136	
		InvoiceHeaderVO myOldInvoiceHeader = getOld(anInvoiceHeader);
/s
			myOld = invoiceHeaderDAO.getBySystemId(anInvoice.getSystemId());

		if (myOld != null && myOld != myNew) {
/ JA
			invoiceHeaderDAO.evict(myNew);
			invoiceHeaderDAO.evict(myOld);
/t
SupplierInvoiceServiceImpl.save(InvoiceHeaderVO) line: 1137	
		InvoiceHeaderVO myOldInvoiceHeader = getOld(anInvoiceHeader);
/d
		InvoiceHeaderVO myNewInvoiceHeader = invoiceHeaderDAO.merge(anInvoiceHeader);
/s
InvoiceHeaderDAOImpl(GenericHibernateDAO).merge(Type) line: 421	
		} else {
			anObject = type.cast(getHibernateTemplate().merge(anObject));

/t
SupplierInvoiceServiceImpl.setHeaderStatus(InvoiceHeaderVO, InvoiceHeaderStatus) line: 1309	
		myVO = save(myVO);
/d
		// INITIAL
		else if (myRequestedStatusCode.equals(InvoiceHeaderStatus.INITIAL)) {
			myToBeStatusCode = InvoiceHeaderStatus.INITIAL;


		if (myToBeStatusCode != null) {

			myVO.setInvoiceHeaderStatus(myToBeStatusCode);
			save(myVO);

/ we zitten nog steeds in TX started by myService.checkTotals	,

/t
InvoiceHeaderSaveAction.handleSave() line: 193	
				} else {
					myService.checkTotals(myVO);
/d

LOG:  execute S_1: COMMIT
LOG:  execute <unnamed>: update INVOICE_HEADER set LAST_UPDATE=$1, APPROVEMENT_EMPLOYEE=$2, APPROVEMENT_REMARKS=$3, DEBLOCK_EMPLOYEE=$4, INVOICE_POD_STATUS=$5, INVOICE_HEADER_STATUS=$6, INVOICE_RECHARGE_STATUS=$7, INVOICE_TYPE=$8, RECHARGE_DATE=$9, RECHARGE_MARK_NUMBER=$10, REGISTER_EMPLOYEE=$11, CARRIER_TOTAL_AMOUNT_EXC_VAT=$12, CARRIER_TOTAL_AMOUNT_INC_VAT=$13, CREATE_DATE=$14, INVOICE_DATE=$15, INVOICE_DUE_DATE=$16, INVOICE_NUMBER=$17, RECEIPT_DATE_COPY=$18, RECEIPT_DATE_ORIGINAL=$19, MARK_NUMBER=$20, MATCHING_ERROR_CODE=$21, MATCH_RUN_NUMBER=$22, REMARK=$23, TOTAL_INVOICE_AMOUNT_EXC_VAT=$24, TOTAL_INVOICE_AMOUNT_FREE_VAT=$25, TOTAL_INVOICE_AMOUNT_HIGH_VAT=$26, TOTAL_INVOICE_AMOUNT_LOW_VAT=$27, TOTAL_INVOICE_AMOUNT_REV_VAT=$28, TOTAL_VAT_AMOUNT_HIGH=$29, TOTAL_VAT_AMOUNT_LOW=$30, USER_SYSTEMID=$31, WARNING_CHECK_TOTAL=$32, VAT_NUMBER_RECEIVER=$33, VAT_NUMBER_SENDER=$34, CURRENCY_SYSTEMID=$35, COUNTRY_SENDER_SYSTEMID=$36, COUNTRY_RECEIVER_SYSTEMID=$37, FINANCIAL_PARTY_SYSTEMID=$38, RECEIVER_SYSTEMID=$39, INVOICE_PAYMENT_BATCH_SYSTEMID=$40, VAT_POLICY_SYSTEMID=$41, INVOICE_ORGANIZATION_ID=$42, ORGANIZATION_SYSTEMID=$43, INVOICE_TEMPLATE_SYSTEMID=$44, DOCUMENT_SYSTEMID=$45, REPORT_DATE=$46, TAX_1_BASE_AMOUNT=$47, TAX_1_TAX_AMOUNT=$48, TAX_1_TAX_TARIFF=$49, TAX_1_TAX_TYPE=$50, TAX_1_DESCRIPTION=$51, TAX_2_BASE_AMOUNT=$52, TAX_2_TAX_AMOUNT=$53, TAX_2_TAX_TARIFF=$54, TAX_2_TAX_TYPE=$55, TAX_2_DESCRIPTION=$56, TAX_3_BASE_AMOUNT=$57, TAX_3_TAX_AMOUNT=$58, TAX_3_TAX_TARIFF=$59, TAX_3_TAX_TYPE=$60, TAX_3_DESCRIPTION=$61, TAX_4_BASE_AMOUNT=$62, TAX_4_TAX_AMOUNT=$63, TAX_4_TAX_TARIFF=$64, TAX_4_TAX_TYPE=$65, TAX_4_DESCRIPTION=$66 
where SYSTEM_ID=$67
DETAIL:  parameters: $1 = '2015-07-20 13:27:47.861', $2 = NULL, $3 = '', $4 = NULL, $5 = 'UNKNOWN', $6 = 'INITIAL', $7 = 'NOT_RECHARGED', $8 = 'SELF_BILL', $9 = NULL, $10 = NULL, $11 = NULL, $12 = '0.00000', $13 = '0.00000', $14 = '2015-06-17 23:59:18.613', $15 = '2015-06-17 23:59:00', $16 = '2015-07-17 00:00:00', $17 = 'INV-22', $18 = NULL, $19 = NULL, $20 = 'INV-22', $21 = '', $22 = NULL, $23 = '', $24 = '7955.5500000000001818989403545856475830078125', $25 = '0', $26 = '7955.5500000000001818989403545856475830078125', $27 = '0', $28 = '0', $29 = '1670.670000000000072759576141834259033203125', $30 = '0', $31 = '10100', $32 = 'Total cost high not correct! Calculated:7855.55
        Check A: total amount exc vat not correct! Calculated:7855.55
        Check D: Total exc VAT not correct! Calculated:7855.55
        Check E: Total VAT High not correct! Calculated:1649.67
        ', $33 = 'NL006959611B08', $34 = 'NL808413363B02', $35 = '7001', $36 = '4153', $37 = '4153', $38 = '27071973', $39 = '240035', $40 = NULL, $41 = '26605695', $42 = '520', $43 = '520', $44 = '27081416', $45 = '27126203', $46 = NULL, $47 = NULL, $48 = NULL, $49 = NULL, $50 = NULL, $51 = NULL, $52 = NULL, $53 = NULL, $54 = NULL, $55 = NULL, $56 = NULL, $57 = NULL, $58 = NULL, $59 = NULL, $60 = NULL, $61 = NULL, $62 = NULL, $63 = NULL, $64 = NULL, $65 = NULL, $66 = NULL, $67 = '27125922'
LOG:  execute S_1: COMMIT

		// save invoice and propagate status, unless invoice has just been set
		// on booked
		if (!(Action.BOOK.equals(myAction) && InvoiceHeaderStatus.BOOKED.equals(myVO.getInvoiceHeaderStatus()))) {
			myService.saveAndPropagateStatus(myVO);
/s
/ starts TX
SupplierInvoiceServiceImpl.saveAndPropagateStatus(InvoiceHeaderVO) line: 1150	

		InvoiceHeaderVO myVO = save(anInvoiceHeader);
		MpoBeanFactory.getBean(InvoiceService.class).propagateInvoiceHeaderChange(myVO);
/s
InvoiceServiceImpl.propagateInvoiceHeaderChange(InvoiceHeaderVO) line: 136	
		propagateInvoiceHeaderPodStatusChange(newInvoiceHeaderVO);
/ NIETS	,
		propagateInvoiceHeaderRechargeStatusChange(newInvoiceHeaderVO);
/ WH NIETS	,
/s
InvoiceServiceImpl.propagateInvoiceHeaderRechargeStatusChange(InvoiceHeaderVO) line: 466	
		InvoiceHeaderRechargeStatus myNewInvoiceHeaderRechargeStatus = newInvoiceHeaderVO.getInvoiceRechargeStatus();
NOT_RECHARGED
		if (!myNewInvoiceHeaderRechargeStatus.equals(InvoiceHeaderRechargeStatus.BLOCKED)) {
/ JA
			List<InvoiceLineVO> invoiceLineVOs = getInvoiceLines(newInvoiceHeaderVO);
/s
		return new ArrayList<InvoiceLineVO>(InvoiceLineUtil.getDAO().getInvoiceHeaderLineList(invoiceHeaderVO.getSystemId()));
/s
InvoiceLineDAOImpl.class
		if (anInvoiceHeaderSystemId > 0) {
			myRet = getHibernateTemplate().findByCriteria(
					DetachedCriteria.forClass(InvoiceLineVO.class).add(Property.forName("invoiceHeaderVO.systemId").eq(anInvoiceHeaderSystemId))
							.add(Property.forName("deleted").eq(false)));

/ we zien in postgres log	,
select ...
from INVOICE_LINE this_ 
left outer join TMS_USER resource2_ on this_.USER_SYSTEMID=resource2_.SYSTEM_ID 
left outer join TMS_USER resource3_ on resource2_.CREATED_BY=resource3_.SYSTEM_ID 
left outer join INVOICE_MATCH_STATUS invoicemat4_ on this_.MATCH_STATUS_SYSTEMID=invoicemat4_.SYSTEM_ID 
left outer join INVOICE_HEADER invoicehea5_ on this_.INVOICE_HEADER_SYSTEMID=invoicehea5_.SYSTEM_ID 
left outer join INVOICE_FINANCIAL_PARTY financialp6_ on invoicehea5_.FINANCIAL_PARTY_SYSTEMID=financialp6_.SYSTEM_ID 
left outer join INVOICE_FINANCIAL_PARTY financialp7_ on invoicehea5_.RECEIVER_SYSTEMID=financialp7_.SYSTEM_ID 
left outer join INVOICE_PAYMENT_BATCH paymentbat8_ on invoicehea5_.INVOICE_PAYMENT_BATCH_SYSTEMID=paymentbat8_.SYSTEM_ID 
left outer join ORGANIZATION organizati9_ on paymentbat8_.ORGANIZATION_SYSTEMID=organizati9_.SYSTEM_ID 
left outer join ORGANIZATION organizati10_ on organizati9_.ORGANIZATION_GROUP=organizati10_.SYSTEM_ID 
left outer join TMS_USER resource11_ on paymentbat8_.PAID_BY_USER_SYSTEMID=resource11_.SYSTEM_ID 
left outer join TMS_USER resource12_ on paymentbat8_.CREATED_BY_USER_SYSTEMID=resource12_.SYSTEM_ID 
left outer join TMS_USER resource13_ on paymentbat8_.VALIDATED_BY_USER_SYSTEMID=resource13_.SYSTEM_ID 
left outer join INVOICE_VAT_POLICY vatpolicy14_ on invoicehea5_.VAT_POLICY_SYSTEMID=vatpolicy14_.SYSTEM_ID 
left outer join ORGANIZATION organizati15_ on invoicehea5_.INVOICE_ORGANIZATION_ID=organizati15_.SYSTEM_ID 
left outer join ORGANIZATION organizati16_ on invoicehea5_.ORGANIZATION_SYSTEMID=organizati16_.SYSTEM_ID where this_.INVOICE_HEADER_SYSTEMID=$1 and this_.IS_DELETED=$2
DETAIL:  parameters: $1 = '27125922', $2 = 'f'

/t
InvoiceServiceImpl.propagateInvoiceHeaderRechargeStatusChange(InvoiceHeaderVO) line: 467	
			List<InvoiceLineVO> invoiceLineVOs = getInvoiceLines(newInvoiceHeaderVO);
/d
[SystemId:27125923	Order: N0001709	Carr: 	InvoiceLineNb 10	Create date: 2015-07-20 10:56:44.604	]
/ klopt	,
			for (InvoiceLineVO myInvoiceLineVO : invoiceLineVOs) {
				if (InvoiceRechargeStatus.BLOCKED.equals(myInvoiceLineVO.getInvoiceRechargeStatus())) {
/ NEE

/t
[SystemId:27125923	Order: N0001709	Carr: 	InvoiceLineNb 10	Create date: 2015-07-20 10:56:44.604	]
		propagateInvoiceHeaderRechargeStatusChange(newInvoiceHeaderVO);
/d
		propagateInvoiceHeaderMatchStatusChange(newInvoiceHeaderVO);
/ NIETS	,

		// feedback from invoice lines, synchronize to invoice lines, invoice line statuses are leading
		propagateInvoiceLineChange(newInvoiceHeaderVO);
/s
InvoiceServiceImpl.propagateInvoiceLineChange(InvoiceHeaderVO) line: 174	
		List<InvoiceLineVO> invoiceLineVOs = getInvoiceLines(invoiceHeaderVO);
/s
		return new ArrayList<InvoiceLineVO>(InvoiceLineUtil.getDAO().getInvoiceHeaderLineList(invoiceHeaderVO.getSystemId()));
/s
			myRet = getHibernateTemplate().findByCriteria(
					DetachedCriteria.forClass(InvoiceLineVO.class).add(Property.forName("invoiceHeaderVO.systemId").eq(anInvoiceHeaderSystemId))
							.add(Property.forName("deleted").eq(false)));
/t
InvoiceServiceImpl.propagateInvoiceLineChange(InvoiceHeaderVO) line: 175	
		List<InvoiceLineVO> invoiceLineVOs = getInvoiceLines(invoiceHeaderVO);
/d
[SystemId:27125923	Order: N0001709	Carr: 	InvoiceLineNb 10	Create date: 2015-07-20 10:56:44.604	]
/ Klopt	, 1 invoice line	,

		for (InvoiceLineVO myInvoiceLineVO : invoiceLineVOs) {
			/* POD */
			unknown = unknown || InvoicePodStatus.UNKNOWN.equals(myInvoicePodStatus);
true
			/* Recharge */
			InvoiceRechargeStatus myInvoiceRechargeStatus = myInvoiceLineVO.getInvoiceRechargeStatus();
INITIAL
			allNotRecharged = allNotRecharged && !InvoiceRechargeStatus.RECHARGED.equals(myInvoiceRechargeStatus);
true

			/* Match status */
			String myLineStatus = myInvoiceLineVO.getInvoiceLineMatchStatusVO().getCode();
OPEN
			boolean matched = InvoiceMatchStatus.MATCHED.equals(myLineStatus) || InvoiceMatchStatus.MATCHED_AFTER_DISPUTE.equals(myLineStatus);
			allMatched = allMatched && matched;
false
			dispute = dispute || InvoiceMatchStatus.DISPUTE.equals(myLineStatus);
false
			mismatch = mismatch || InvoiceMatchStatus.MISMATCHED.equals(myLineStatus);
false
			boolean matchedMan = InvoiceMatchStatus.MATCHED_MAN.equals(myLineStatus);
			allMatchedManAut = allMatchedManAut && (matchedMan || matched);
false

		/* Recharge status */
		if (allNotRecharged) {
			getInvoiceHeaderFacade().setRechargeStatus(invoiceHeaderVO, InvoiceHeaderRechargeStatus.NOT_RECHARGED);
/s
SupplierInvoiceServiceImpl.setRechargeStatus(InvoiceHeaderVO, InvoiceHeaderRechargeStatus) line: 1619	
		InvoiceHeaderVO myVO = aVO;
		InvoiceHeaderRechargeStatus myRequestedRechargeStatusCode = aStatus;
NOT_RECHARGED
		InvoiceHeaderRechargeStatus myToBeRechargeStatusCode = myRequestedRechargeStatusCode;
		InvoiceHeaderStatus myCurrentHeaderStatusCode = myVO.getInvoiceHeaderStatus();
INITIAL

		switch (myVO.getInvoiceRechargeStatus()) {
			case INITIAL:
			case NOT_RECHARGED:
				if (myRequestedRechargeStatusCode.equals(InvoiceHeaderRechargeStatus.BLOCKED)) {
/ NEE
				} else if (myRequestedRechargeStatusCode.equals(InvoiceHeaderRechargeStatus.NOT_RECHARGED)) {
/ JA
					myToBeRechargeStatusCode = InvoiceHeaderRechargeStatus.NOT_RECHARGED;
		myVO.setInvoiceRechargeStatus(myToBeRechargeStatusCode);
		save(myVO);
/t
InvoiceServiceImpl.propagateInvoiceLineChange(InvoiceHeaderVO) line: 217	
		/* Recharge status */
		if (allNotRecharged) {
			getInvoiceHeaderFacade().setRechargeStatus(invoiceHeaderVO, InvoiceHeaderRechargeStatus.NOT_RECHARGED);
/d
SupplierInvoiceServiceImpl.setRechargeStatus(InvoiceHeaderVO, InvoiceHeaderRechargeStatus) line: 1619	
		myVO.setInvoiceRechargeStatus(myToBeRechargeStatusCode);
		save(myVO);

/ Intermezzo

	SupplierInvoiceServiceImpl.setRechargeStatus(InvoiceHeaderVO, InvoiceHeaderRechargeStatus) line: 1628	
	...
	InvoiceServiceImpl.propagateInvoiceLineChange(InvoiceHeaderVO) line: 216	
	InvoiceServiceImpl.propagateInvoiceHeaderChange(InvoiceHeaderVO) line: 145	
	...
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	...
	SupplierInvoiceServiceImpl.saveAndPropagateStatus(InvoiceHeaderVO) line: 1151	
	...
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	...
	InvoiceHeaderSaveAction.handleSave() line: 194	

/ Einde Intermezzo

/t
SupplierInvoiceServiceImpl.saveAndPropagateStatus(InvoiceHeaderVO) line: 1152	
	public void saveAndPropagateStatus(InvoiceHeaderVO anInvoiceHeader) {
		InvoiceHeaderVO myVO = save(anInvoiceHeader);
		MpoBeanFactory.getBean(InvoiceService.class).propagateInvoiceHeaderChange(myVO);
/d
/t
InvoiceHeaderSaveAction.handleSave() line: 197	
		// save invoice and propagate status, unless invoice has just been set
		// on booked
		if (!(Action.BOOK.equals(myAction) && InvoiceHeaderStatus.BOOKED.equals(myVO.getInvoiceHeaderStatus()))) {
			myService.saveAndPropagateStatus(myVO);
/d

/ Nu pas is de TX commit	, en dus zien we in de postgres log	,

LOG:  execute <unnamed>: update INVOICE_HEADER set LAST_UPDATE=$1, APPROVEMENT_EMPLOYEE=$2, APPROVEMENT_REMARKS=$3, DEBLOCK_EMPLOYEE=$4, INVOICE_POD_STATUS=$5, INVOICE_HEADER_STATUS=$6, INVOICE_RECHARGE_STATUS=$7, INVOICE_TYPE=$8, RECHARGE_DATE=$9, RECHARGE_MARK_NUMBER=$10, REGISTER_EMPLOYEE=$11, CARRIER_TOTAL_AMOUNT_EXC_VAT=$12, CARRIER_TOTAL_AMOUNT_INC_VAT=$13, CREATE_DATE=$14, INVOICE_DATE=$15, INVOICE_DUE_DATE=$16, INVOICE_NUMBER=$17, RECEIPT_DATE_COPY=$18, RECEIPT_DATE_ORIGINAL=$19, MARK_NUMBER=$20, MATCHING_ERROR_CODE=$21, MATCH_RUN_NUMBER=$22, REMARK=$23, TOTAL_INVOICE_AMOUNT_EXC_VAT=$24, TOTAL_INVOICE_AMOUNT_FREE_VAT=$25, TOTAL_INVOICE_AMOUNT_HIGH_VAT=$26, TOTAL_INVOICE_AMOUNT_LOW_VAT=$27, TOTAL_INVOICE_AMOUNT_REV_VAT=$28, TOTAL_VAT_AMOUNT_HIGH=$29, TOTAL_VAT_AMOUNT_LOW=$30, USER_SYSTEMID=$31, WARNING_CHECK_TOTAL=$32, VAT_NUMBER_RECEIVER=$33, VAT_NUMBER_SENDER=$34, CURRENCY_SYSTEMID=$35, COUNTRY_SENDER_SYSTEMID=$36, COUNTRY_RECEIVER_SYSTEMID=$37, FINANCIAL_PARTY_SYSTEMID=$38, RECEIVER_SYSTEMID=$39, INVOICE_PAYMENT_BATCH_SYSTEMID=$40, VAT_POLICY_SYSTEMID=$41, INVOICE_ORGANIZATION_ID=$42, ORGANIZATION_SYSTEMID=$43, INVOICE_TEMPLATE_SYSTEMID=$44, DOCUMENT_SYSTEMID=$45, REPORT_DATE=$46, TAX_1_BASE_AMOUNT=$47, TAX_1_TAX_AMOUNT=$48, TAX_1_TAX_TARIFF=$49, TAX_1_TAX_TYPE=$50, TAX_1_DESCRIPTION=$51, TAX_2_BASE_AMOUNT=$52, TAX_2_TAX_AMOUNT=$53, TAX_2_TAX_TARIFF=$54, TAX_2_TAX_TYPE=$55, TAX_2_DESCRIPTION=$56, TAX_3_BASE_AMOUNT=$57, TAX_3_TAX_AMOUNT=$58, TAX_3_TAX_TARIFF=$59, TAX_3_TAX_TYPE=$60, TAX_3_DESCRIPTION=$61, TAX_4_BASE_AMOUNT=$62, TAX_4_TAX_AMOUNT=$63, TAX_4_TAX_TARIFF=$64, TAX_4_TAX_TYPE=$65, TAX_4_DESCRIPTION=$66 
where SYSTEM_ID=$67
DETAIL:  parameters: $1 = '2015-07-20 15:14:53.029', $2 = NULL, $3 = '', $4 = NULL, $5 = 'UNKNOWN', $6 = 'INITIAL', $7 = 'NOT_RECHARGED', $8 = 'SELF_BILL', $9 = NULL, $10 = NULL, $11 = NULL, $12 = '0.00000', $13 = '0.00000', $14 = '2015-06-17 23:59:18.613', $15 = '2015-06-17 23:59:00', $16 = '2015-07-17 00:00:00', $17 = 'INV-22', $18 = NULL, $19 = NULL, $20 = 'INV-22', $21 = '', $22 = NULL, $23 = '', $24 = '7955.5500000000001818989403545856475830078125', $25 = '0', $26 = '7955.5500000000001818989403545856475830078125', $27 = '0', $28 = '0', $29 = '1670.670000000000072759576141834259033203125', $30 = '0', $31 = '10100', $32 = 'Total cost high not correct! Calculated:7855.55
        Check A: total amount exc vat not correct! Calculated:7855.55
        Check D: Total exc VAT not correct! Calculated:7855.55
        Check E: Total VAT High not correct! Calculated:1649.67
        ', $33 = 'NL006959611B08', $34 = 'NL808413363B02', $35 = '7001', $36 = '4153', $37 = '4153', $38 = '27071973', $39 = '240035', $40 = NULL, $41 = '26605695', $42 = '520', $43 = '520', $44 = '27081416', $45 = '27126203', $46 = NULL, $47 = NULL, $48 = NULL, $49 = NULL, $50 = NULL, $51 = NULL, $52 = NULL, $53 = NULL, $54 = NULL, $55 = NULL, $56 = NULL, $57 = NULL, $58 = NULL, $59 = NULL, $60 = NULL, $61 = NULL, $62 = NULL, $63 = NULL, $64 = NULL, $65 = NULL, $66 = NULL, $67 = '27125922'
LOG:  execute S_1: COMMIT

/ 7	. 

/ we click na Save header	, weer edit edit de inv-22	,

InvoiceHeaderFormAction.act() line: 89	
			InvoiceHeaderUtil.getInvoiceHeaderService().checkTotals(myVO);

/ 7	. 

/ we click Save and Close op de header	, 
<input type="button" id="saveAndCloseBtn" value="Save and Close" onclick=" theEditFormFormManager.submit('../invoice/invoice-header_save', true, '-1'); return false;">

			<map:match pattern="invoice-header_save">
				<map:act type="invoiceHeaderSave"/>
			</map:match>
			<map:action logger="invoice" name="invoiceHeaderSave"   src="com.mpobjects.invoice.control.invoiceheader.action.InvoiceHeaderSaveAction"/>
/s
InvoiceHeaderSaveAction.handleSave() line: 102	
				} else {
					myService.checkTotals(myVO);


/ spring starts TX en calls SupplierInvoiceServiceImpl.checkTotals	,

isbscs4=# SELECT ID.*
FROM INVOICE_DETAIL ID, INVOICE_LINE IL
WHERE ID.INVOICE_LINE_SYSTEMID= IL.SYSTEM_ID
AND IL.INVOICE_HEADER_SYSTEMID = 27125922;
 system_id |       create_date       | user_systemid |   amount   | amount_vat | vat_tarif_type | invoice_line_systemid | cost_ty
pe_systemid | match_status_systemid | remark | is_deleted | matching_error_code | surcharge_based | surcharge_systemid | tax_1_ba
se_amount | tax_1_tax_amount | tax_1_tax_tariff | tax_1_tax_type | tax_1_description 
-----------+-------------------------+---------------+------------+------------+----------------+-----------------------+--------
------------+-----------------------+--------+------------+---------------------+-----------------+--------------------+---------
----------+------------------+------------------+----------------+-------------------
  27125925 | 2015-07-21 09:46:40.452 |      27128130 | -413.45000 |  -86.82000 | HIGH           |              27125923 |        
   26671397 |                     1 |        |          0 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
  27128268 | 2015-07-17 16:24:21.722 |      27128130 |    0.00000 |    0.00000 | HIGH           |              27125923 |        
   26595322 |                     1 |        |          1 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
  27125927 | 2015-07-20 10:56:44.604 |      27128130 |    0.00000 |    0.00000 | HIGH           |              27125923 |        
   26600544 |                     1 |        |          1 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
  27128276 | 2015-07-20 15:44:36.405 |      27128130 |    0.00000 |    0.00000 | HIGH           |              27125923 |        
   26595322 |                     1 |        |          1 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
  27128275 | 2015-07-21 09:46:40.452 |      27128130 | 8269.00000 | 1736.49000 | HIGH           |              27125923 |        
   26600544 |                     1 |        |          0 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
  27128277 | 2015-07-20 17:34:22.519 |      27128130 |    0.00000 |    0.00000 | HIGH           |              27125923 |        
   26595322 |                     1 |        |          1 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
(6 rows)

/ 27128277 : amount=amount_vat=0	, 

/ Maar via fetchData (TODO)	,

this	InvoiceHeaderSaveAction  (id=20611)	
myVO	InvoiceHeaderVO  (id=19670)	
	invoiceLines	PersistentSortedSet  (id=21740)	
		set	TreeSet  (id=22236)	
			m	TreeMap  (id=22238)	
				root	TreeMap$Entry  (id=22240)	
					key	InvoiceLineVO_$$_javassist_94  (id=22241)	
						handler	JavassistLazyInitializer  (id=22254)	
							target	InvoiceLineVO  (id=22287)	
								invoiceDetails	PersistentSet  (id=22289)	
									set	HashSet  (id=22945)	
										map	HashMap  (id=22949)	
											entrySet	null	
											hashSeed	0	
											keySet	HashMap$KeySet  (id=22951)	
											loadFactor	0.75	
											modCount	6	
											size	6	
											table	HashMap$Entry[16]  (id=22952)	
												[0]	HashMap$Entry  (id=22954)	
SystemId:27125927	Amount:0.00000	VAT:0.00000	VATTariff:HIGH	CostType:com.mpobjects.oms.model.ratecomponenttype.RateComponentType@7d3f8b8d[systemId=26600544,code=Freight,description=Freight Cost,group=COST,reasonMandatory=false,deleted=false,sequenceNr=10]	InvoiceLine:27125923	User 27128130	Create date: 2015-07-20 10:56:44.604	=java.lang.Object@60a05ae3
												[2]	HashMap$Entry  (id=22955)	
SystemId:27128277	Amount:100.00000	VAT:21.00000	VATTariff:HIGH	CostType:com.mpobjects.oms.model.ratecomponenttype.RateComponentType@56c7e318[systemId=26595322,code=Demurrage,description=Demurrage time,group=COST,reasonMandatory=false,deleted=false,sequenceNr=20]	InvoiceLine:27125923	User 27128130	Create date: 2015-07-20 17:34:22.519	=java.lang.Object@60a05ae3
												[6]	HashMap$Entry  (id=22956)	
SystemId:27128275	Amount:8269.00000	VAT:1736.49000	VATTariff:HIGH	CostType:com.mpobjects.oms.model.ratecomponenttype.RateComponentType@7d3f8b8d[systemId=26600544,code=Freight,description=Freight Cost,group=COST,reasonMandatory=false,deleted=false,sequenceNr=10]	InvoiceLine:27125923	User 27128130	Create date: 2015-07-20 17:34:22.519	=java.lang.Object@60a05ae3
												[7]	HashMap$Entry  (id=22957)	
SystemId:27128268	Amount:0.00000	VAT:0.00000	VATTariff:HIGH	CostType:com.mpobjects.oms.model.ratecomponenttype.RateComponentType@56c7e318[systemId=26595322,code=Demurrage,description=Demurrage time,group=COST,reasonMandatory=false,deleted=false,sequenceNr=20]	InvoiceLine:27125923	User 27128130	Create date: 2015-07-17 16:24:21.722	=java.lang.Object@60a05ae3
												[8]	HashMap$Entry  (id=22958)	
SystemId:27128276	Amount:0.00000	VAT:0.00000	VATTariff:HIGH	CostType:com.mpobjects.oms.model.ratecomponenttype.RateComponentType@56c7e318[systemId=26595322,code=Demurrage,description=Demurrage time,group=COST,reasonMandatory=false,deleted=false,sequenceNr=20]	InvoiceLine:27125923	User 27128130	Create date: 2015-07-20 15:44:36.405	=java.lang.Object@60a05ae3
												[14]	HashMap$Entry  (id=22959)	
SystemId:27125925	Amount:-413.45000	VAT:-86.82000	VATTariff:HIGH	CostType:com.mpobjects.oms.model.ratecomponenttype.RateComponentType@24edd95a[systemId=26671397,code=Freight Commission,description=Freight Commission for ISB,group=COST,reasonMandatory=false,deleted=false,sequenceNr=60]	InvoiceLine:27125923	User 27128130	Create date: 2015-07-20 17:34:22.519	=java.lang.Object@60a05ae3

/ dus we zien dat invoice detail SystemId:27128277 weer op 100, 21 staat	,
/ TODO
/ ook zien we allemaal oude invoice details	,
/ TODO


/ 7	. 

/ we study de fetchData als we een header save	,

/ In devtools, network	,

Request URL:http://localhost:8080/tms/invoice/invoice-header_save
Request Headers
Provisional headers are shown
Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Content-Type:application/x-www-form-urlencoded
Origin:http://localhost:8080
Referer:http://localhost:8080/tms/invoice/invoice-header_edit?base_sessionLevelOffset=1&systemid=27125922&systemId=27125922
User-Agent:Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.104 Safari/537.36
X-DevTools-Emulate-Network-Conditions-Client-Id:B872DE8F-6F81-849A-5969-491DA7E5E574

Form Dataview sourceview URL encoded
continuationId:1437467241021
flowDefinition:reload
redirectTo:../core/back?levelOffset=-1
doRedirect:true
base_sessionLevelOffset:-1
base_windowToOpenUrl:
base_windowToOpenHeight:
base_windowToOpenWidth:
base_windowToOpenTitle:
base_windowToOpenScrollbar:
systemId:27125922
invoiceOrganization:ISB-C&S
receiver:CHARTER0035
vatNumberReceiver:
markNumber:INV-22
invoiceNumber:INV-22
sender:ISB-C&S
vatNumberSender:NL808413363B02
invoiceType:SELF_BILL
currency:EUR
vatPolicySystemId:26605695
createDateDate:17-Jun-2015
createDateDateTime:23:59
invoiceDateDate:17-Jun-2015
invoiceDateDateTime:23:59
invoiceDueDateDate:17-Jul-2015
reportDateDate:
invoiceReceiptDateOriginalDate:
invoiceReceiptDateCopyDate:
invoiceHeaderStatus:INITIAL
matchingErrorCode:
invoicePodStatus:UNKNOWN
invoiceRechargeStatus:NOT_RECHARGED
registerEmployee:
remark-display:
remark:
runNumberInvoiceMatching:
approvementEmployee:
approvementRemarks-display:
approvementRemarks:
deblockEmployee:
carrierTotalInvoiceAmountIncVat:0.00
carrierTotalInvoiceAmountExcVat:0.00
totalInvoiceAmountIncVat:9,626.22
totalInvoiceAmountExcVat:7,955.55
totalVatAmountHigh:1,670.67
totalVatAmountLow:0.00
totalInvoiceAmountHighVat:7,955.55
totalInvoiceAmountLowVat:0.00
totalInvoiceAmountFreeVat:0.00
totalInvoiceAmountRevVat:0.00
hiddenActionBtn:false
serverUnavailableMessage:Server busy, please wait
processingFormMessage:Form is being processed...
deleteMessage:Are you sure?
ConsoleSearchEmulationRendering

/s
InvoiceHeaderSaveAction(BoundSaveAction).getFetchedData() line: 119	
			if (theFetchedData == null) {
				Collection<DataFetchable> myFetchFields = getForm().getDataFetchableFields();
[ systemId,  invoiceOrganization,  receiver,  vatNumberReceiver,  markNumber,  invoiceNumber,  sender,  vatNumberSender,  invoiceType,  currency,  vatPolicySystemId,  createDate,  invoiceDate,  invoiceDueDate,  reportDate,  invoiceReceiptDateOriginal,  invoiceReceiptDateCopy,  invoiceHeaderStatus,  matchingErrorCode,  invoicePodStatus,  invoiceRechargeStatus,  registerEmployee,  remark,  runNumberInvoiceMatching,  approvementEmployee,  approvementRemarks,  deblockEmployee,  carrierTotalInvoiceAmountIncVat,  carrierTotalInvoiceAmountExcVat,  totalInvoiceAmountIncVat,  totalInvoiceAmountExcVat,  totalVatAmountHigh,  totalVatAmountLow,  totalInvoiceAmountHighVat,  totalInvoiceAmountLowVat,  totalInvoiceAmountFreeVat,  totalInvoiceAmountRevVat]

				for (DataFetchable myDataFetchable : myFetchFields) {
					..
						myDataFetchable.fetchData();
/ Tags	,
				theFetchedData = getForm().getValueObjects();

/ See LOG_23_jul_2015.txt bij ISB-279	,

/ LAATSTE ISB-279	,






/ 7	.

/ we hebben 1 demurrage row delete op het scherm	, dit is invoice detail	27128276  

isbscs4=# SELECT ID.*
FROM INVOICE_DETAIL ID, INVOICE_LINE IL
WHERE ID.INVOICE_LINE_SYSTEMID= IL.SYSTEM_ID
AND IL.INVOICE_HEADER_SYSTEMID = 27125922;
 system_id |       create_date       | user_systemid |   amount   | amount_vat | vat_tarif_type | invoice_line_systemid | cost_ty
pe_systemid | match_status_systemid | remark | is_deleted | matching_error_code | surcharge_based | surcharge_systemid | tax_1_ba
se_amount | tax_1_tax_amount | tax_1_tax_tariff | tax_1_tax_type | tax_1_description 
-----------+-------------------------+---------------+------------+------------+----------------+-----------------------+--------
------------+-----------------------+--------+------------+---------------------+-----------------+--------------------+---------
----------+------------------+------------------+----------------+-------------------
  27125925 | 2015-07-20 15:44:36.405 |      27128130 | -413.45000 |  -86.82000 | HIGH           |              27125923 |        
   26671397 |                     1 |        |          0 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
  27128268 | 2015-07-17 16:24:21.722 |      27128130 |    0.00000 |    0.00000 | HIGH           |              27125923 |        
   26595322 |                     1 |        |          1 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
  27125927 | 2015-07-20 10:56:44.604 |      27128130 |    0.00000 |    0.00000 | HIGH           |              27125923 |        
   26600544 |                     1 |        |          1 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
  27128275 | 2015-07-20 15:44:36.405 |      27128130 | 8269.00000 | 1736.49000 | HIGH           |              27125923 |        
   26600544 |                     1 |        |          0 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
  27128276 | 2015-07-20 15:44:36.405 |      27128130 |  100.00000 |   21.00000 | HIGH           |              27125923 |        
   26595322 |                     1 |        |          0 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
(5 rows)

/ click Save and close	,
----------+------------------+------------------+----------------+-------------------
  27125925 | 2015-07-20 16:04:29.638 |      27128130 | -413.45000 |  -86.82000 | HIGH           |              27125923 |        
   26671397 |                     1 |        |          0 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
  27128268 | 2015-07-17 16:24:21.722 |      27128130 |    0.00000 |    0.00000 | HIGH           |              27125923 |        
   26595322 |                     1 |        |          1 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
  27125927 | 2015-07-20 10:56:44.604 |      27128130 |    0.00000 |    0.00000 | HIGH           |              27125923 |        
   26600544 |                     1 |        |          1 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
  27128275 | 2015-07-20 16:04:29.638 |      27128130 | 8269.00000 | 1736.49000 | HIGH           |              27125923 |        
   26600544 |                     1 |        |          0 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
  27128276 | 2015-07-20 15:44:36.405 |      27128130 |    0.00000 |    0.00000 | HIGH           |              27125923 |        
   26595322 |                     1 |        |          1 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
(5 rows)

/ we save and close de header	,
  27125925 | 2015-07-20 15:44:36.405 |      27128130 | -413.45000 |  -86.82000 | HIGH           |              27125923 |        
   26671397 |                     1 |        |          0 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
  27128268 | 2015-07-17 16:24:21.722 |      27128130 |    0.00000 |    0.00000 | HIGH           |              27125923 |        
   26595322 |                     1 |        |          1 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
  27125927 | 2015-07-20 10:56:44.604 |      27128130 |    0.00000 |    0.00000 | HIGH           |              27125923 |        
   26600544 |                     1 |        |          1 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
  27128275 | 2015-07-20 15:44:36.405 |      27128130 | 8269.00000 | 1736.49000 | HIGH           |              27125923 |        
   26600544 |                     1 |        |          0 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
  27128276 | 2015-07-20 15:44:36.405 |      27128130 |  100.00000 |   21.00000 | HIGH           |              27125923 |        
   26595322 |                     1 |        |          0 |                     |               0 |                    |         
          |                  |                  | HIGH           | 
(5 rows)

/ we zien in de postgres log	,

LOG:  execute <unnamed>: BEGIN
LOG:  execute <unnamed>: select count(*) as y0_ from INVOICE_HEADER this_ where this_.organization_Systemid in (select uo.organization_systemid from user_organization uo where uo.user_systemid = $1) and this_.MARK_NUMBER=$2
DETAIL:  parameters: $1 = '27128130', $2 = 'INV-22'
LOG:  execute S_1: COMMIT
LOG:  execute <unnamed>: BEGIN

select ...
from INVOICE_HEADER this_ left outer join INVOICE_FINANCIAL_PARTY financialp2_ on this_.FINANCIAL_PARTY_SYSTEMID=financialp2_.SYSTEM_ID left outer join INVOICE_FINANCIAL_PARTY financialp3_ on this_.RECEIVER_SYSTEMID=financialp3_.SYSTEM_ID left outer join INVOICE_PAYMENT_BATCH paymentbat4_ on this_.INVOICE_PAYMENT_BATCH_SYSTEMID=paymentbat4_.SYSTEM_ID left outer join ORGANIZATION organizati5_ on paymentbat4_.ORGANIZATION_SYSTEMID=organizati5_.SYSTEM_ID left outer join ORGANIZATION organizati6_ on organizati5_.ORGANIZATION_GROUP=organizati6_.SYSTEM_ID left outer join TMS_USER resource7_ on paymentbat4_.PAID_BY_USER_SYSTEMID=resource7_.SYSTEM_ID left outer join TMS_USER resource8_ on resource7_.CREATED_BY=resource8_.SYSTEM_ID left outer join TMS_USER resource9_ on paymentbat4_.CREATED_BY_USER_SYSTEMID=resource9_.SYSTEM_ID left outer join TMS_USER resource10_ on paymentbat4_.VALIDATED_BY_USER_SYSTEMID=resource10_.SYSTEM_ID left outer join INVOICE_VAT_POLICY vatpolicy11_ on this_.VAT_POLICY_SYSTEMID=vatpolicy11_.SYSTEM_ID left outer join ORGANIZATION organizati12_ on this_.INVOICE_ORGANIZATION_ID=organizati12_.SYSTEM_ID left outer join ORGANIZATION organizati13_ on this_.ORGANIZATION_SYSTEMID=organizati13_.SYSTEM_ID where this_.organization_Systemid in (select uo.organization_systemid 
from user_organization uo where uo.user_systemid = $1) and this_.MARK_NUMBER=$2
DETAIL:  parameters: $1 = '27128130', $2 = 'INV-22'
LOG:  execute S_1: COMMIT

LOG:  execute <unnamed>: BEGIN
LOG:  execute <unnamed>: SELECT ID.* FROM INVOICE_DETAIL ID, INVOICE_LINE IL  WHERE ID.INVOICE_LINE_SYSTEMID= IL.SYSTEM_ID AND IL.INVOICE_HEADER_SYSTEMID = $1 AND ID.IS_DELETED  =0 AND IL.IS_DELETED =0
DETAIL:  parameters: $1 = '27125922'

LOG:  execute <unnamed>: update INVOICE_DETAIL set USER_SYSTEMID=$1, CREATE_DATE=$2, IS_DELETED=$3, MATCH_STATUS_SYSTEMID=$4, AMOUNT=$5, AMOUNT_VAT=$6, VAT_TARIF_TYPE=$7, COST_TYPE_SYSTEMID=$8, REMARK=$9, MATCHING_ERROR_CODE=$10, SURCHARGE_BASED=$11, SURCHARGE_SYSTEMID=$12, TAX_1_BASE_AMOUNT=$13, TAX_1_TAX_AMOUNT=$14, TAX_1_TAX_TARIFF=$15, TAX_1_TAX_TYPE=$16, TAX_1_DESCRIPTION=$17 where SYSTEM_ID=$18
DETAIL:  parameters: $1 = '27128130', $2 = '2015-07-20 15:44:36.405', $3 = 'f', $4 = '1', $5 = '-413.45000', $6 = '-86.82000', $7 = 'HIGH', $8 = '26671397', $9 = '', $10 = '', $11 = 'f', $12 = NULL, $13 = NULL, $14 = NULL, $15 = NULL, $16 = 'HIGH', $17 = NULL, $18 = '27125925'

LOG:  execute <unnamed>: update INVOICE_DETAIL set USER_SYSTEMID=$1, CREATE_DATE=$2, IS_DELETED=$3, MATCH_STATUS_SYSTEMID=$4, AMOUNT=$5, AMOUNT_VAT=$6, VAT_TARIF_TYPE=$7, COST_TYPE_SYSTEMID=$8, REMARK=$9, MATCHING_ERROR_CODE=$10, SURCHARGE_BASED=$11, SURCHARGE_SYSTEMID=$12, TAX_1_BASE_AMOUNT=$13, TAX_1_TAX_AMOUNT=$14, TAX_1_TAX_TARIFF=$15, TAX_1_TAX_TYPE=$16, TAX_1_DESCRIPTION=$17 where SYSTEM_ID=$18
DETAIL:  parameters: $1 = '27128130', $2 = '2015-07-20 15:44:36.405', $3 = 'f', $4 = '1', $5 = '8269.00000', $6 = '1736.49000', $7 = 'HIGH', $8 = '26600544', $9 = NULL, $10 = '', $11 = 'f', $12 = NULL, $13 = NULL, $14 = NULL, $15 = NULL, $16 = 'HIGH', $17 = NULL, $18 = '27128275'

LOG:  execute <unnamed>: update INVOICE_HEADER set LAST_UPDATE=$1, APPROVEMENT_EMPLOYEE=$2, APPROVEMENT_REMARKS=$3, DEBLOCK_EMPLOYEE=$4, INVOICE_POD_STATUS=$5, INVOICE_HEADER_STATUS=$6, INVOICE_RECHARGE_STATUS=$7, INVOICE_TYPE=$8, RECHARGE_DATE=$9, RECHARGE_MARK_NUMBER=$10, REGISTER_EMPLOYEE=$11, CARRIER_TOTAL_AMOUNT_EXC_VAT=$12, CARRIER_TOTAL_AMOUNT_INC_VAT=$13, CREATE_DATE=$14, INVOICE_DATE=$15, INVOICE_DUE_DATE=$16, INVOICE_NUMBER=$17, RECEIPT_DATE_COPY=$18, RECEIPT_DATE_ORIGINAL=$19, MARK_NUMBER=$20, MATCHING_ERROR_CODE=$21, MATCH_RUN_NUMBER=$22, REMARK=$23, TOTAL_INVOICE_AMOUNT_EXC_VAT=$24, TOTAL_INVOICE_AMOUNT_FREE_VAT=$25, TOTAL_INVOICE_AMOUNT_HIGH_VAT=$26, TOTAL_INVOICE_AMOUNT_LOW_VAT=$27, TOTAL_INVOICE_AMOUNT_REV_VAT=$28, TOTAL_VAT_AMOUNT_HIGH=$29, TOTAL_VAT_AMOUNT_LOW=$30, USER_SYSTEMID=$31, WARNING_CHECK_TOTAL=$32, VAT_NUMBER_RECEIVER=$33, VAT_NUMBER_SENDER=$34, CURRENCY_SYSTEMID=$35, COUNTRY_SENDER_SYSTEMID=$36, COUNTRY_RECEIVER_SYSTEMID=$37, FINANCIAL_PARTY_SYSTEMID=$38, RECEIVER_SYSTEMID=$39, INVOICE_PAYMENT_BATCH_SYSTEMID=$40, VAT_POLICY_SYSTEMID=$41, INVOICE_ORGANIZATION_ID=$42, ORGANIZATION_SYSTEMID=$43, INVOICE_TEMPLATE_SYSTEMID=$44, DOCUMENT_SYSTEMID=$45, REPORT_DATE=$46, TAX_1_BASE_AMOUNT=$47, TAX_1_TAX_AMOUNT=$48, TAX_1_TAX_TARIFF=$49, TAX_1_TAX_TYPE=$50, TAX_1_DESCRIPTION=$51, TAX_2_BASE_AMOUNT=$52, TAX_2_TAX_AMOUNT=$53, TAX_2_TAX_TARIFF=$54, TAX_2_TAX_TYPE=$55, TAX_2_DESCRIPTION=$56, TAX_3_BASE_AMOUNT=$57, TAX_3_TAX_AMOUNT=$58, TAX_3_TAX_TARIFF=$59, TAX_3_TAX_TYPE=$60, TAX_3_DESCRIPTION=$61, TAX_4_BASE_AMOUNT=$62, TAX_4_TAX_AMOUNT=$63, TAX_4_TAX_TARIFF=$64, TAX_4_TAX_TYPE=$65, TAX_4_DESCRIPTION=$66 where SYSTEM_ID=$67
DETAIL:  parameters: $1 = '2015-07-20 16:05:15.479', $2 = NULL, $3 = '', $4 = NULL, $5 = 'UNKNOWN', $6 = 'INITIAL', $7 = 'NOT_RECHARGED', $8 = 'SELF_BILL', $9 = NULL, $10 = NULL, $11 = NULL, $12 = '0.00000', $13 = '0.00000', $14 = '2015-06-17 23:59:18.613', $15 = '2015-06-17 23:59:00', $16 = '2015-07-17 00:00:00', $17 = 'INV-22', $18 = NULL, $19 = NULL, $20 = 'INV-22', $21 = '', $22 = NULL, $23 = '', $24 = '7955.5500000000001818989403545856475830078125', $25 = '0', $26 = '7955.5500000000001818989403545856475830078125', $27 = '0', $28 = '0', $29 = '1670.670000000000072759576141834259033203125', $30 = '0', $31 = '10100', $32 = 'Total cost high not correct! Calculated:7855.55
        Check A: total amount exc vat not correct! Calculated:7855.55
        Check D: Total exc VAT not correct! Calculated:7855.55
        Check E: Total VAT High not correct! Calculated:1649.67
        ', $33 = 'NL006959611B08', $34 = 'NL808413363B02', $35 = '7001', $36 = '4153', $37 = '4153', $38 = '27071973', $39 = '240035', $40 = NULL, $41 = '26605695', $42 = '520', $43 = '520', $44 = '27081416', $45 = '27126203', $46 = NULL, $47 = NULL, $48 = NULL, $49 = NULL, $50 = NULL, $51 = NULL, $52 = NULL, $53 = NULL, $54 = NULL, $55 = NULL, $56 = NULL, $57 = NULL, $58 = NULL, $59 = NULL, $60 = NULL, $61 = NULL, $62 = NULL, $63 = NULL, $64 = NULL, $65 = NULL, $66 = NULL, $67 = '27125922'

LOG:  execute <unnamed>: update INVOICE_LINE set IS_DELETED=$1, CONTAINER_COUNT=$2, INVOICE_POD_STATUS=$3, INVOICE_RECHARGE_STATUS=$4, LOADING_METERS=$5, LOADING_METERS_UOM=$6, PAY_WEIGHT=$7, PAY_WEIGHT_UOM=$8, POD_REMARK=$9, RECHARGE_DATE=$10, RECHARGE_MARK_NUMBER=$11, CARRIER_REFERENCE=$12, CREATE_DATE=$13, LINE_NUMBER=$14, LOGISTICS_ORDER_REFERENCE=$15, MATCHING_ERROR_CODE=$16, REMARK=$17, SHIPMENT_ORDER_SYSTEMID=$18, SERVICE_ORDER_SYSTEMID=$19, VOLUME=$20, VOLUME_UOM=$21, WEIGHT=$22, WEIGHT_UOM=$23, ORDER_PROCESS_SYSTEMID=$24, USER_SYSTEMID=$25, MATCH_STATUS_SYSTEMID=$26 where SYSTEM_ID=$27
DETAIL:  parameters: $1 = 'f', $2 = NULL, $3 = 'UNKNOWN', $4 = 'INITIAL', $5 = NULL, $6 = NULL, $7 = NULL, $8 = NULL, $9 = '', $10 = NULL, $11 = NULL, $12 = '', $13 = '2015-07-20 15:44:36.405', $14 = '10', $15 = 'N0001709', $16 = '', $17 = '', $18 = NULL, $19 = '27125854', $20 = NULL, $21 = NULL, $22 = NULL, $23 = NULL, $24 = NULL, $25 = '27128130', $26 = '1', $27 = '27125923'

LOG:  execute <unnamed>: update INVOICE_DETAIL set USER_SYSTEMID=$1, CREATE_DATE=$2, IS_DELETED=$3, MATCH_STATUS_SYSTEMID=$4, AMOUNT=$5, AMOUNT_VAT=$6, VAT_TARIF_TYPE=$7, COST_TYPE_SYSTEMID=$8, REMARK=$9, MATCHING_ERROR_CODE=$10, SURCHARGE_BASED=$11, SURCHARGE_SYSTEMID=$12, TAX_1_BASE_AMOUNT=$13, TAX_1_TAX_AMOUNT=$14, TAX_1_TAX_TARIFF=$15, TAX_1_TAX_TYPE=$16, TAX_1_DESCRIPTION=$17 where SYSTEM_ID=$18
DETAIL:  parameters: $1 = '27128130', $2 = '2015-07-20 15:44:36.405', $3 = 'f', $4 = '1', $5 = '100.00000', $6 = '21.00000', $7 = 'HIGH', $8 = '26595322', $9 = NULL, $10 = '', $11 = 'f', $12 = NULL, $13 = NULL, $14 = NULL, $15 = NULL, $16 = 'HIGH', $17 = NULL, $18 = '27128276'
LOG:  execute S_1: COMMIT












 






/ Einde DEBUG ISB-729

/ XSP IN ISB-729

/ dan in de jsp	,
<ctf:page title="InvoiceHeader" type="form">

[eric@localhost trunk]$ vi ./base-framework/core/war/WEB-INF/tags/core/page.tag 
<c:set var="pageTitle" scope="request" value="${title}"/>
<c:set var="pageType" scope="request" value="${type}"/>
<!DOCTYPE html> 
<html>
    <jsp:doBody/>
</html>

/ lees wat er in de body staat	,
	<ctf:pageHeader>
/ en dan
	<ctf:pageBody>

[eric@localhost trunk]$ vi ./base-framework/core/war/WEB-INF/tags/core/pageBody.tag 
<body>
    <h1><mpo:label name="${pageTitle}"/></h1>
    <jsp:doBody/>
</body>

/ lees wat er in de body van <ctf:pageHeader> staat	,

/ 13	.

/ we kijken naar ctf:pageHeader	, dit is een tag	,

[eric@localhost trunk]$ vi ./base-framework/core/war/WEB-INF/tags/core/pageHeader.tag
<head>
    <title><mpo:label name="${pageTitle}"/></title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <script type="text/javascript" src="../script/class.pagerequest.js"> </script>
    <script type="text/javascript" src="../script/class.tabcollection.js"> </script>
...

/ dat is js: hij gaat ook meteen class.pagerequest.js exec	,

[eric@localhost trunk]$ vi ./base-framework/core/war/core/script/class.pagerequest.js
...
importScript("class.screencontainer.js");
importScript("class.eventutils.js");
importScript("class.stringutils.js");
importScript("class.numberutils.js");
importScript("class.focusonfirstfield.js");
importScript("class.dhtmlutils.js");
importScript("mktree.js");
...

/ Deze zien we ook in HTML tussen class.pagerequest.js en class.tabcollection.js	,

/ 13	. 

/ we zien in HTML 
[eric@localhost trunk]$ less ./base-framework/core/war/WEB-INF/tags/core/pageHeader.tag 
/ met ertussen door	,
./base-framework/core/war/core/script/class.pagerequest.js

/ we set een b in class.pagerequest.js	,
-> importScript("class.screencontainer.js");
	...
/ na deze kijken we in de devtools console	,
document
#document
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<title>invoice header</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<script type="text/javascript" src="../script/class.pagerequest.js"></script>
<script src="../script/class.screencontainer.js"></script>
</head>
</html>

/ 7.	

/ we zijn geinteresseerd in	,
$ vi invoice-header_edit.jsp

				<div id="invoiceLineArea">
					<b style="visibility: hidden; font-size: 20px">Hid${formVO.systemId}</b>
					<iframe class="invoiceline" src="invoice-line_view?invoiceheadersystemid=${formVO.systemId}&readOnly=${isReadOnly}" />
					</iframe>
				</div>

/ we zien in HTML	,

<div id="invoiceLineArea">
	<iframe class="invoiceline" src="invoice-line_view?invoiceheadersystemid=27126553&amp;readOnly=false">
		<form class="jspForm" method="post" name="editForm" id="editForm" target="submitframe" action="../invoice/invoice-line_save"><input type="hidden" name="continuationId" id="continuationId" value="1436861828481">
			<input type="hidden" name="flowDefinition" id="flowDefinition" value="reload" size="20">
			<script type="text/javascript">
				var theEditFormFormManager= new FormManager('editForm');
				var theActiveFormManager=theEditFormFormManager;l
				document.theActiveFormManager=theActiveFormManager
			</script>
/ TODO (Waarom ?)
			<input type="hidden" name="redirectTo" id="redirectTo" value="../core/back?levelOffset=-1"><input type="hidden" name="doRedirect" id="doRedirect">
			<input type="hidden" name="base_sessionLevelOffset" id="base_sessionLevelOffset" value="0" size="20">
			<input type="hidden" name="base_windowToOpenUrl" id="base_windowToOpenUrl" value="" size="20">
			<input type="hidden" name="base_windowToOpenHeight" id="base_windowToOpenHeight" value="" size="20">
			<input type="hidden" name="base_windowToOpenWidth" id="base_windowToOpenWidth" value="" size="20">
			<input type="hidden" name="base_windowToOpenTitle" id="base_windowToOpenTitle" value="" size="20">
			<input type="hidden" name="base_windowToOpenScrollbar" id="base_windowToOpenScrollbar" value="" size="20">
			<div id="invoiceLineInFrame">
				<a href="invoice-line_list?invoiceheadersystemid=27126553&amp;systemid=27126553&amp;refresh=false&amp;screenId=invoice-line_list"> <img src="../lookandfeel/styles/images/icons/table_sql_view16.gif" id="currency_icon" class="selector_icon" border="0"></a>
/ vergrootglas	,
				<p>Multiple input:<br>
				<a href="invoice-multiline_create?invoiceheadersystemid=27126553&amp;systemid=27126553&amp;refresh=true&amp;screenId=invoice-multiline_create&amp;base_controlFlow=false">Create mode: add a new page</a>
				<br>
				<a href="invoice-multiline_edit?invoiceheadersystemid=27126553&amp;systemid=27126553&amp;refresh=true&amp;screenId=invoice-multiline_edit&amp;base_controlFlow=false">Edit mode</a></p>
/ Edit mode
			</div>
		<div style="clear: both;"></div>
		<div id="invoiceDetailInFrame"></div>
		
		<input type="hidden" name="serverUnavailableMessage" id="serverUnavailableMessage" value="Server busy, please wait" size="20">
		<input type="hidden" name="processingFormMessage" id="processingFormMessage" value="Form is being processed..." size="20">
		<input type="hidden" name="deleteMessage" id="deleteMessage" value="Are you sure?" size="20">
	</form>
</iframe>




/ EInde XSP IN ISB-729


/ VIM UNICODE 

http://dabase.com/e/07025/

/ we geven na ctrl+v u
0228	, 1043
/ Dit zijn inderdaad unicode voor wat we zien in de tables,	
http://www.unicode.org/charts/PDF/U0180.pdf
/ we zien dit ook in vim	, 
/ We beginnen opnieuw	, en geven 
ctrl+v u 200b
/ Doe nu	,
[eric@localhost trunk]$ od -t x1 /tmp/space.txt 
0000000 e2 80 8b 0a
/ Dit is de utf-8 voor \u200b	,

/ pi is \u03c0	,
/ due utf-8 is	,
[eric@localhost trunk]$ od -t x1 /tmp/space.txt 
0000000 cf 80 0a
0000003

/ Lees	,
http://superuser.com/questions/207207/how-can-i-delete-u200b-zero-width-space-using-sed
/ we kunnen ook π ook in bash	,
[eric@localhost trunk]$ printf '\u03c0'
π
/ en de unicode	,
[eric@localhost trunk]$ printf '\u03c0' | od -t x1 
0000000 cf 80
0000002
/ of	,
[eric@localhost trunk]$ printf '\u03c0' | hexdump  -C
00000000  cf 80                                             |..|
00000002

/ vim en ctrl+k en digraphs	,
/ TODO

/ 7	.

[eric@localhost tmp]$ vi space.txt 
/ geef ctrl+v u200b
[eric@localhost tmp]$ hexdump -C space.txt 
00000000  e2 80 8b 0a                                       |....|
00000004

$ vi space.txt
:%s/\xe2\x80\x8b//g
/ werkt NIET	,




/ Einde VIM UNICODE 


/ SCS

/ van pnl-t -> pnl-a	,

    9  2015-06-19 17:16:37 scp tms-pnllogistics-20077-trunk_build2775.zip vanderveldene@pnl-app-a.intermax.mpobjects.com:~


/ Einde SCS

/ SCS URLS

http://localhost:8080/tms/authentication/login-form

http://localhost:8080/tms/core/index_frameset
http://localhost:8080/tms/core/welcome

$ vi core-sitemap.xmap
           <map:match pattern="index_frameset">
				<map:act type="setLocale"/>
				<map:act type="generateMenu">
					<map:parameter name="cssClass" value="xMenu"/>
					<map:parameter name="sessionAttribute" value="userMenu"/>
					<map:parameter name="urlPrefix" value="../"/>
				</map:act>				
                <map:generate type="jsp" src="jsp/index_frameset.jsp"/>
                <map:serialize type="html"/>
            </map:match>
          <map:match pattern="back">
               <map:act type="redirectByFlow">
				    <map:parameter name="levelOffset" value="{request-param:levelOffset}"/>
				</map:act>
            </map:match>
			<map:match pattern="welcome">
				<map:generate type="jsp" src="jsp/welcome.jsp"/>
				<map:serialize type="html"/>
			</map:match>            
			<map:match pattern="opening_page">
				<map:act type="openingPage">
					<map:redirect-to uri="welcome"/>
				</map:act>
			</map:match>            


http://localhost:8080/tms/oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=26709551&systemId=26709551

/ Deze is in oms-sitemap.xmap	,

/ rm base_sessionLevelOffset=1	,
http://localhost:8080/tms/oms/shipment-order_edit?systemid=26709551&systemId=26709551
/ lege session	,
/ TODO

/ click 'View documents, JSP	,
http://localhost:8080/tms/oms/reports_for_shipmentorder?systemId=26709551&refresh=true&base_sessionLevelOffset=1
/back	,
http://localhost:8080/tms/oms/shipment-order_edit?systemid=26709551&base_sessionLevelOffset=0&randomizingurl=1434715095331




/ Einde SCS URLS

/ INTERMAX

[eric@localhost trunk]$ PGPASSWORD=h^Zgcyr\&Q psql -U vanderveldene -h  pnl-app-a.intermax.mp-objects.com pnloms
/ connect met cargo db op acceptance	,

/ Einde INTERMAX

/ DEBUG PNL-410

/ we edit shipment order	, dan valt hij voor het eerst in	,

shipment-order_edit.jsp line: 177	
	<c:if test="${!messagePresent}">
		<h1>
->			<mpo:label name="shipmentOrder" />
/s
LabelTag.doStartTag() line: 41	
		String myString = getLanguageManager().getByJavaName(theEntity, theName);
myString	"Shipment Order" (id=1498)	

/ we geven conti	,
/t
/s
shipment-order_edit.jsp line: 181	
	<mpo:form name="shipmentorder" action="shipment-order_save" entity="shipmentOrder" readOnly="${readOnly}">
/s
FormTag.doStartTag() line: 242	
		StringBuffer myPrintString = new StringBuffer();

		myPrintString.append("<script type=\"text/javascript\">\n");
		myPrintString.append("var " + getJsFormManager() + "= new FormManager('" + theName + "');");
/s
FormTag.getJsFormManager() line: 373	
		return "the" + StringUtils.firstCharToUpper(theName) + "FormManager";
theName="shipmentorder"
/t
		myPrintString.append("var theActiveFormManager=" + getJsFormManager() + ";");
/s
FormTag.getJsFormManager() line: 373	
		return "the" + StringUtils.firstCharToUpper(theName) + "FormManager";
/t
		myPrintString.append("document.theActiveFormManager=theActiveFormManager");
		myPrintString.append("</script>\n");

<iframe class="invisible" name="submitframe" id="submitframe" src="../blank.html"></iframe>
<div id="formMessage" class="hidden"><h3></h3></div>
<form class="jspForm" method="post" name="shipmentorder" id="shipmentorder" target="submitframe" action="shipment-order_save">
	<input type="hidden" name="continuationId" id="continuationId" value="1434617731674"/>
	<input type="hidden" name="flowDefinition" id="flowDefinition" value="reload" size="20"/>
	<script type="text/javascript">
		var theShipmentorderFormManager= new FormManager('shipmentorder');
		var theActiveFormManager=theShipmentorderFormManager;
		document.theActiveFormManager=theActiveFormManager
	</script>

/ FormManager is in JS 	,
$ vi class.formmanager.js

function FormManager(aFormName) {
    this.submit = function(anAction, aBoolDoRedirect, aRedirectionLevelOffset) {




/ Einde DEBUG PNL-410

/ GENERICLISTFORM


/ 13	. 

/ planning, shipment order, mass update dashboard	, 

/ click op edit button op een entry in  de list

/ Op EntityActionGroupListPage.java

	@SuppressWarnings("serial")
	private EntityListActionBuilder<EntityActionGroup> getPanelAction() {
		Collection<EntityAction<EntityActionGroup>> actions = new ArrayList<EntityAction<EntityActionGroup>>();
		EntityActionButton<EntityActionGroup> editAction = new EntityActionButton<EntityActionGroup>("edit",
				new ResourceModel("edit").wrapOnAssignment(EntityActionGroupListPage.this)) {

			@Override
			protected void onSubmit(Button aButton, IModel<EntityActionGroup> aSelection) {
->				setResponsePage(new EntityActionGroupEditPage(daoWrapper, Model.of(aSelection.getObject()), EntityActionGroupListPage.this));
			}
		};
/ Michel vervangt aSelection meteen	,
/ TODO MICHEL 


/ Einde GENERICLISTFORM



/ SCS-4772

/ 7	.


/ we zien	,
<div wicket:id="privilegeSearchList" ...>
	<form wicket:id="filterForm" ...>
		<table wicket:id="objectTable" ...>
			<thead>
				<tr class="navigation">
					<td wicket:id="span" ...>
						<span wicket:id="navigator" ...>
							<span wicket:id="first" ...>
							<span wicket:id="prev" ...>
							
$ vi PrivilegeEditPage.html
	<wicket:extend>
		<form wicket:id="createForm">
		<button wicket:id="createButton	 ...
		<wicket:child />				/ er is geen child bij ons	,  
	</wicket:extend>

$ vi PrivilegeEditPage.java
public class PrivilegeEditPage extends PrivilegeSelectPage implements PrivilegeEditFormCallback {

$ vi  PrivilegeSelectPage.html

	<wicket:extend>
		<div wicket:id="feedback"></div>
		<div wicket:id="privilegeSearchList"></div>
		<wicket:child />				/ de child is hierboven	,  met de createForm, createButton	,
	</wicket:extend>

$ vi  PrivilegeSelectPage.java
	protected void createListPanel() {
		searchListPanel = new PrivilegeSearchListPanel("privilegeSearchList", null, webComponentEventSwitchBoard, daoWrapper, new PrivilegeJSCallbackAction( callback));

$ vi  PrivilegeSearchListPanel.java
public class PrivilegeSearchListPanel extends GenericListPanel<PrivilegeVO> {

/ er is geen .html	,

$ vi GenericListPanel.html
<wicket:extend>
	<form class="genericListPanelForm" wicket:id="filterForm" name="genericListPanelForm" id="genericListPanelForm">


$ vi GenericListPanel.java
abstract public class GenericListPanel<T extends EntityInterface> extends BaseWebComponent {
		objectDataTable = getDefaultDataTable(aColumnsList);
		filterForm = new FilterForm("filterForm", dataProvider);
		if (isFilterOn()) {
			objectDataTable.addTopToolbar(new FilterToolbar(objectDataTable, filterForm, dataProvider));
		}
/ FilterForm is een wicket class	,
/ FilterToolbar is een wicket class	,

/ 7	. 

/ See  LOG_8_sep_2014.txt	,
/ WICKET PAGER IN REPEATER

/ we hebben in wicket-1.4.23.jar uit de mvn repo de PagingNavigator.html update	,

/ maar we zien dat in pnloms/lib wicket-1.4.23.jar een andere grootte heeft	, dus moeten we apart opnieuwd doen	,

[eric@localhost tmp]$ mkdir wicket-1.4.23-orig-scs
[eric@localhost tmp]$ mkdir wicket-1.4.23-mod-scs
[eric@localhost tmp]$ mkdir wicket-1.4.23				/ work dir	,

[eric@localhost tmp]$ cp /home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms/lib/wicket-1.4.23.jar wicket-1.4.23-orig-scs/
[eric@localhost tmp]$ cp /home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms/lib/wicket-1.4.23.jar wicket-1.4.23-mod-scs/

[eric@localhost wicket-1.4.23]$ jar xvf ../wicket-1.4.23-orig-scs/wicket-1.4.23.jar 
[eric@localhost wicket-1.4.23]$ vi $(find -name PagingNavigator.html)
   <a wicket:id="first" class="first">&lt;&lt;</a>&nbsp;<a wicket:id="prev" class="prev">&lt;</a>
    <span wicket:id="navigation">
          <a wicket:id="pageLink" href="#"><span wicket:id="pageNumber">5</span></a>
    </span>
    <a wicket:id="next" class="next">&gt;</a>&nbsp;<a wicket:id="last" class="last">&gt;&gt;</a>

[eric@localhost wicket-1.4.23]$ jar uvf ../wicket-1.4.23-mod-scs/wicket-1.4.23.jar $(find -name PagingNavigator.html)
adding: org/apache/wicket/markup/html/navigation/paging/PagingNavigator.html(in = 1237) (out= 657)(deflated 46%)

[eric@localhost tmp]$ mv wicket-1.4.23-mod-scs/wicket-1.4.23.jar  wicket-1.4.23-mod-scs/wicket-1.4.23-mpo.jar 


calhost workspace]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace
[eric@localhost workspace]$ rm ./trunk/base-framework/core/lib/jar/wicket-1.4.23/wicket-1.4.23.jar

[eric@localhost tmp]$ cp wicket-1.4.23-mod-scs/wicket-1.4.23-mpo.jar /home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/./trunk/base-framework/core/lib/jar/wicket-1.4.23

/ Geef in chrome	,
mposerv11:9280
/ click JMX console
/ zoek naar libcheck
/ we zien bij 
mpobjects
service=libcheck.service	,
http://mposerv11:9280/jmx-console/HtmlAdaptor?action=inspectMBean&name=mpobjects%3Aservice%3DLibCheckService
/ onderaan	, we zien 
java.lang.String checkLibraries()
/ click invoke	,
          MISSING : wicket-1.4.23-mpo.jar
   MUST_BE_REMOVED : wicket-1.4.23.jar

/ we moeten dit een keer vervangen	,

[eric@localhost tmp]$ pwd
/home/eric/tmp
[eric@localhost tmp]$ scp wicket-1.4.23-mod-scs/wicket-1.4.23-mpo.jar jboss@mposerv11:/tmp
jboss@mposerv11's password: jboss@mpo


/ 7	.

/ revert wicket-1.4.23.jar -> wicket-1.4.23-mpo.jar	,

/ zoek in eclipse in naar wicket-1.4.23-mpo.jar	,
/ kijk in project explorer	, ga in eclipse naar base-framework/core/lib/jar: niet de source dir , maar stapsgwijs in de tree	,
/ right click	, Team, show history	,
 revert 19842 en 19843 	,


/ 7		.

/ we kunnen ook op de command line	,
[eric@localhost trunk]$ ant -f base-framework/buildscripts/build.xml clean-prepare-and-dev-deploy checkstyle

/ click Window, Preferences, Java, Code style, Code Templates	,
/ kies Code, New Java Files	,
/ we zien	,

/*
 * Copyright 2000-${year}, MP Objects, http://www.mp-objects.com
 */
${filecomment}
${package_declaration}

${typecomment}
${type_declaration}

/ Na $ ant checkStyle	,
/ we zien link naar	,
file:///home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/base-framework/build/checkstyle/report.html

/ 7	. 

/ Ga naar MpoPagingNavigator.html in eclipse	, 
/ click create Class	,
/ de package is nu al ingevuld, daarom gingen we naar MpoPagingNavigator.html	,
/ we moeten alleen de source folder aanpassen	, we moeten eindigen op test/src/java	,
/ NU	,
trunk/base-framework/core/src/java
/ WORDT	,
trunk/base-framework/core/test/src/java

/we zien	,

package com.mpobjects.view.wicket.util.component;

public class MpoPagingNavigatorTest {

}



/ Einde SCS-4772

/ SCS-4772 TEST

/ 7	.

/ we komen in	,

/ we debug de junit test: Debug As: JUnit test (zoals we ook met de hand start)	,

MpoPagingNavigatorTest [JUnit]	
	org.eclipse.jdt.internal.junit.runner.RemoteTestRunner at localhost:41467	
		Thread [main] (Suspended)	
			ApplicationPropertyManager.getApplicationServerType() line: 215	
			ApplicationUtils.getConfigurationType() line: 34	
			WicketWebApplication.getConfigurationType() line: 33	
			WicketWebApplication(Application).configure() line: 391	
			WicketWebApplication(WebApplication).internalInit() line: 574	
			MockWebApplication$1(WicketFilter).init(FilterConfig) line: 723	
			WicketTester(MockWebApplication).<init>(WebApplication, String) line: 169	
			WicketTester(BaseWicketTester).<init>(WebApplication, String) line: 219	
			WicketTester.<init>(WebApplication, String) line: 331	
			WicketTester.<init>(WebApplication) line: 314	
			MpoPagingNavigatorTest.fixture() line: 30	
			NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
			NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
			DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
			Method.invoke(Object, Object...) line: 606	
			FrameworkMethod$1.runReflectiveCall() line: 44	
			FrameworkMethod$1(ReflectiveCallable).run() line: 15	
			FrameworkMethod.invokeExplosively(Object, Object...) line: 41	
			RunBefores.evaluate() line: 27	
			BlockJUnit4ClassRunner.runNotIgnored(FrameworkMethod, EachTestNotifier) line: 79	
			BlockJUnit4ClassRunner.runChild(FrameworkMethod, RunNotifier) line: 71	
			BlockJUnit4ClassRunner.runChild(Object, RunNotifier) line: 49	
			ParentRunner$3.run() line: 193	
			ParentRunner$1.schedule(Runnable) line: 52	
			BlockJUnit4ClassRunner(ParentRunner).runChildren(RunNotifier) line: 191	
			ParentRunner.access$000(ParentRunner, RunNotifier) line: 42	
			ParentRunner$2.evaluate() line: 184	
			BlockJUnit4ClassRunner(ParentRunner).run(RunNotifier) line: 236	
			JUnit4TestClassReference(JUnit4TestReference).run(TestExecution) line: 50	
			TestExecution.run(ITestReference[]) line: 38	
			RemoteTestRunner.runTests(String[], String, TestExecution) line: 467	
			RemoteTestRunner.runTests(TestExecution) line: 683	
			RemoteTestRunner.run() line: 390	
			RemoteTestRunner.main(String[]) line: 197	

	public ApplicationServerType getApplicationServerType() {
		if (applicationServerType == null) {
			String env = getSystemProperty(SCS_SERVER_TYPE_ENV_PARAMETER, null);
(SCS_SERVER_TYPE_ENV_PARAMETER="SCS_SERVER_TYPE"
env="development"
			if (env == null) {
				env = getSystemProperty(TMS_SERVER_TYPE_ENV_PARAMETER, null);
			}

/ er zijn 
oms.properties
pnloms.properties
application.properties
conf/local_application.properties

$ vi ~/.bashrc
# User specific aliases and functions
export TMS_SERVER_TYPE=development
$ env
TMS_SERVER_TYPE=development

			if (env != null) {
				applicationServerType = ApplicationServerType.parse(env);
/s
public enum ApplicationServerType {
	DEVELOPMENT {
		@Override
		public String toString() {
			return "development";
		}
	},
	public static final ApplicationServerType parse(String aValue) {
		for (ApplicationServerType type : EnumSet.allOf(ApplicationServerType.class)) {
			if (type.toString().equalsIgnoreCase(aValue)) {
				return type;

/t
public abstract class ApplicationUtils {
	public static String getConfigurationType() {
		ApplicationServerType serverType = ApplicationPropertyManager.getInstance().getApplicationServerType();
/d
		if (serverType == ApplicationServerType.DEVELOPMENT || serverType == ApplicationServerType.TEST) {
/ JA
			myConfigType = Application.DEVELOPMENT;

/ uiteindelijk hetzelfde als 

/ t
WicketWebApplication(Application).configure() line: 395	
		final String configurationType = getConfigurationType();
"development"

/t
MockWebApplication$1(WicketFilter).init(FilterConfig) line: 726	
			webApplication.internalInit();
/d
			webApplication.init();
...
/s
	protected static BeanFactory getBeanFactory() {
		while (!initialized.get()) {
/ JA
			/* Allow only one waiting thread doing the reconnect logic */
			synchronized (MpoBeanFactory.class) {
				try {
					Thread.sleep(RECONNECT_WAIT);
/ 10s	,
/ 

/ 7	. 

/ we start de app , en kijken wanneer hij de bean factory inits	,

$ vi web.xml
<listener>
    <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
->    <listener-class>com.mpobjects.core.listener.StartupWebAppContextListener</listener-class>
</listener>

public class StartupWebAppContextListener implements ServletContextListener {
	public void contextInitialized(ServletContextEvent myServletContextEVent) {
		MpoBeanFactory.init(WebApplicationContextUtils.getWebApplicationContext(myServletContextEVent.getServletContext()));
/s
	public static void init(ApplicationContext aContext) {
aContext	XmlWebApplicationContext  (id=797)	

		LOG.debug("init()");
		applicationContext = aContext;
		initialized.set(true);


/ 7	. 

/ we set b in MpoBeanFactory	,

/ start pnlom opnieuw	,


	/**
	 * This method needs to be called in order for the bean factory to be unblocked. This method is currently used for
	 * unit testing and integration testing only.
	 */
	public static void init(ApplicationContext aContext) {
		LOG.debug("init()");
		applicationContext = aContext;
		initialized.set(true);
		LOG.debug("init() - return ");
	}
/ TODO

/ $ vi MpoBeanFactoryTest.java

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations = { "classpath:core-performance.sb.xml" })
public class MpoBeanFactoryTest extends AbstractJUnit4SpringContextTests {

	@Test(timeout = 60000)
	public void getBean() {
		try {
			PerformanceMonitorService myBean = MpoBeanFactory.getBean(PerformanceMonitorService.class);
			assertTrue("MpoBeanFactory is working", myBean != null);
		} catch (Exception anException) {
			anException.printStackTrace();
			fail("Exception when initializing MpoBeanFactory: " + anException);
		}
	}

	@Before
	public void setUp() throws Exception {
		MpoBeanFactory.init(applicationContext);
	}

}

/ run MpoBeanFactoryTest	,

/ 7	. 

/ Start scs	,

/ we vallen in 	,

public class StartupWebAppContextListener implements ServletContextListener {

	@Override
	public void contextInitialized(ServletContextEvent myServletContextEVent) {
		MpoBeanFactory.init(WebApplicationContextUtils.getWebApplicationContext(myServletContextEVent.getServletContext()));

Thread [main] (Suspended (breakpoint at line 31 in StartupWebAppContextListener))	
	StartupWebAppContextListener.contextInitialized(ServletContextEvent) line: 31	
	StandardContext.listenerStart() line: 3763	
	StandardContext.start() line: 4211	
	StandardHost(ContainerBase).addChildInternal(Container) line: 759	
	StandardHost(ContainerBase).addChild(Container) line: 739	
	StandardHost.addChild(Container) line: 524	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	BaseModelMBean.invoke(String, Object[], String[]) line: 503	
	RawDynamicInvoker.invoke(String, Object[], String[]) line: 164	
	MBeanServerImpl.invoke(ObjectName, String, Object[], String[]) line: 659	
	StandardContext.init() line: 5052	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	BaseModelMBean.invoke(String, Object[], String[]) line: 503	
	RawDynamicInvoker.invoke(String, Object[], String[]) line: 164	
	MBeanServerImpl.invoke(ObjectName, String, Object[], String[]) line: 659	
	TomcatDeployer.performDeployInternal(String, WebApplication, String, AbstractWebContainer$WebDescriptorParser) line: 297	
	TomcatDeployer.performDeploy(WebApplication, String, AbstractWebContainer$WebDescriptorParser) line: 103	
	TomcatDeployer(AbstractWebDeployer).start(DeploymentInfo) line: 371	
	WebModule.startModule() line: 83	
	WebModule.startService() line: 61	
	WebModule(ServiceMBeanSupport).jbossInternalStart() line: 289	
	WebModule(ServiceMBeanSupport).jbossInternalLifecycle(String) line: 245	
	GeneratedMethodAccessor9.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	ReflectedDispatcher.invoke(Invocation) line: 155	
	Invocation.dispatch() line: 94	
	Invocation.invoke() line: 86	
	XMBean(AbstractMBeanInvoker).invoke(String, Object[], String[]) line: 264	
	MBeanServerImpl.invoke(ObjectName, String, Object[], String[]) line: 659	
	ServiceController$ServiceProxy.invoke(Object, Method, Object[]) line: 978	
	$Proxy0.start() line: not available	
	ServiceController.start(ObjectName) line: 417	
	GeneratedMethodAccessor15.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	ReflectedDispatcher.invoke(Invocation) line: 155	
	Invocation.dispatch() line: 94	
	Invocation.invoke() line: 86	
	XMBean(AbstractMBeanInvoker).invoke(String, Object[], String[]) line: 264	
	MBeanServerImpl.invoke(ObjectName, String, Object[], String[]) line: 659	
	MBeanProxyExt.invoke(Object, Method, Object[]) line: 210	
	$Proxy41.start(ObjectName) line: not available	
	Tomcat5(AbstractWebContainer).start(DeploymentInfo) line: 466	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	ReflectedDispatcher.invoke(Invocation) line: 155	
	Invocation.dispatch() line: 94	
	NullInterceptor(AbstractInterceptor).invoke(Invocation) line: 133	
	Invocation.invoke() line: 88	
	ModelMBeanOperationInterceptor.invoke(Invocation) line: 142	
	DynamicInterceptor.invoke(Invocation) line: 97	
	DeployerInterceptorJSE(InterceptorServiceMBeanSupport).invokeNext(Invocation) line: 238	
	DeployerInterceptorJSE(DeployerInterceptor).start(Invocation, DeploymentInfo) line: 92	
	SubDeployerInterceptorSupport$XMBeanInterceptor.start(Invocation, DeploymentInfo) line: 188	
	SubDeployerInterceptorSupport$XMBeanInterceptor(SubDeployerInterceptor).invoke(Invocation) line: 95	
	Invocation.invoke() line: 88	
	XMBean(AbstractMBeanInvoker).invoke(String, Object[], String[]) line: 264	
	MBeanServerImpl.invoke(ObjectName, String, Object[], String[]) line: 659	
	MBeanProxyExt.invoke(Object, Method, Object[]) line: 210	
	$Proxy42.start(DeploymentInfo) line: not available	
	MainDeployer.start(DeploymentInfo) line: 1025	
	MainDeployer.deploy(DeploymentInfo) line: 819	
	MainDeployer.deploy(URL) line: 782	
	GeneratedMethodAccessor55.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	ReflectedDispatcher.invoke(Invocation) line: 155	
	Invocation.dispatch() line: 94	
	NullInterceptor(AbstractInterceptor).invoke(Invocation) line: 133	
	Invocation.invoke() line: 88	
	ModelMBeanOperationInterceptor.invoke(Invocation) line: 142	
	Invocation.invoke() line: 88	
	XMBean(AbstractMBeanInvoker).invoke(String, Object[], String[]) line: 264	
	MBeanServerImpl.invoke(ObjectName, String, Object[], String[]) line: 659	
	MBeanProxyExt.invoke(Object, Method, Object[]) line: 210	
	$Proxy9.deploy(URL) line: not available	
	URLDeploymentScanner.deploy(URLDeploymentScanner$DeployedURL) line: 421	
	URLDeploymentScanner.scan() line: 634	
	AbstractDeploymentScanner$ScannerThread.doScan() line: 263	
	URLDeploymentScanner(AbstractDeploymentScanner).startService() line: 336	
	URLDeploymentScanner(ServiceMBeanSupport).jbossInternalStart() line: 289	
	URLDeploymentScanner(ServiceMBeanSupport).jbossInternalLifecycle(String) line: 245	
	GeneratedMethodAccessor9.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	ReflectedDispatcher.invoke(Invocation) line: 155	
	Invocation.dispatch() line: 94	
	Invocation.invoke() line: 86	
	XMBean(AbstractMBeanInvoker).invoke(String, Object[], String[]) line: 264	
	MBeanServerImpl.invoke(ObjectName, String, Object[], String[]) line: 659	
	ServiceController$ServiceProxy.invoke(Object, Method, Object[]) line: 978	
	$Proxy0.start() line: not available	
	ServiceController.start(ObjectName) line: 417	
	GeneratedMethodAccessor15.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	ReflectedDispatcher.invoke(Invocation) line: 155	
	Invocation.dispatch() line: 94	
	Invocation.invoke() line: 86	
	XMBean(AbstractMBeanInvoker).invoke(String, Object[], String[]) line: 264	
	MBeanServerImpl.invoke(ObjectName, String, Object[], String[]) line: 659	
	MBeanProxyExt.invoke(Object, Method, Object[]) line: 210	
	$Proxy4.start(ObjectName) line: not available	
	SARDeployer.start(DeploymentInfo) line: 302	
	MainDeployer.start(DeploymentInfo) line: 1025	
	MainDeployer.deploy(DeploymentInfo) line: 819	
	MainDeployer.deploy(URL) line: 782	
	MainDeployer.deploy(String) line: 766	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	ReflectedDispatcher.invoke(Invocation) line: 155	
	Invocation.dispatch() line: 94	
	NullInterceptor(AbstractInterceptor).invoke(Invocation) line: 133	
	Invocation.invoke() line: 88	
	ModelMBeanOperationInterceptor.invoke(Invocation) line: 142	
	Invocation.invoke() line: 88	
	XMBean(AbstractMBeanInvoker).invoke(String, Object[], String[]) line: 264	
	MBeanServerImpl.invoke(ObjectName, String, Object[], String[]) line: 659	
	MBeanProxyExt.invoke(Object, Method, Object[]) line: 210	
	$Proxy5.deploy(String) line: not available	
	ServerImpl.doStart() line: 482	
	ServerImpl.start() line: 362	
	Main.boot(String[]) line: 200	
	Main$1.run() line: 490	
	Thread.run() line: 745	

/ we zijn in	,
		MpoBeanFactory.init(WebApplicationContextUtils.getWebApplicationContext(myServletContextEVent.getServletContext()));
/ myServletContextEVent.getServletContext()=facade om applicationContext	,
org.apache.catalina.core.ApplicationContextFacade@335a8c36
	context=org.apache.catalina.core.ApplicationContext@1b3c861
		context=StandardEngine[jboss.web].StandardHost[localhost].StandardContext[/tms]

/ WebApplicationContextUtils.getWebApplicationContext is in spring-web	,

/ 7	.

/ we HADDEN	,
 
$ vi MpoPagingNavigatorTest.java

public class MpoPagingNavigatorTest {

	private WebApplication webApplication;
	private WicketTester wicketTester;

	@Before
	public void fixture() {
		System.setProperty("jboss.server.home.dir", "/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms");
		/*
		 * webApplication = new WebApplication() {
		 * 
		 * @Override public Class<? extends Page> getHomePage() { return BasePage.class; } };
		 */
		// webApplication = new WicketWebApplication();
		webApplication = new WebApplication() {

			@Override
			public Class<? extends Page> getHomePage() {
				// TODO Auto-generated method stub
				return null;
			}
		};
		wicketTester = new WicketTester(webApplication);
		wicketTester.startPanel(MpoPagingNavigator.class);

	}

	@Test
	public void cssClasses() {
		MockHttpServletResponse mockHttpServletResponse = wicketTester.getServletResponse();
		String markup = mockHttpServletResponse.getDocument();
		System.out.println(markup);
		TagTester tagTester = TagTester.createTagByAttribute(markup, "wicket:id", "first");
		Assert.assertEquals(true, tagTester.getAttributeContains("class", "first"));

	}
}

/ Als je doet,	
	new WebApplication()	, dan komt hij vanzelf met	getHomePage()	,

       webApplication = new WebApplication() {

            @Override
            public Class<? extends Page> getHomePage() {
                // TODO Auto-generated method stub
                return null;
            }
        };

/ Later WEL	,
		System.setProperty("jboss.server.home.dir", "/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnloms");
		WebApplication webApplication = new WicketWebApplication();
/ TODO 

/ 7	.

/ wicket1.4

	public final Page startPage(final ITestPageSource testPageSource)
testPageSource	BaseWicketTester$3  (id=2078)	

/ 
org.apache.wicket.WicketRuntimeException: tester: unexpected
	at org.apache.wicket.util.tester.BaseWicketTester.convertoUnexpect(BaseWicketTester.java:472)
	at org.apache.wicket.util.tester.BaseWicketTester.access$100(BaseWicketTester.java:91)
	at org.apache.wicket.util.tester.BaseWicketTester$3$1.getTestPanel(BaseWicketTester.java:422)
	at org.apache.wicket.util.tester.DummyPanelPage.<init>(DummyPanelPage.java:42)
	at org.apache.wicket.util.tester.BaseWicketTester$3.getTestPage(BaseWicketTester.java:405)
	at org.apache.wicket.util.tester.DummyHomePage$TestLink.onClick(DummyHomePage.java:88)
	at org.apache.wicket.markup.html.link.Link.onLinkClicked(Link.java:225)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.apache.wicket.RequestListenerInterface.invoke(RequestListenerInterface.java:182)
	at org.apache.wicket.request.target.component.listener.ListenerInterfaceRequestTarget.processEvents(ListenerInterfaceRequestTarget.java:73)
	at org.apache.wicket.request.AbstractRequestCycleProcessor.processEvents(AbstractRequestCycleProcessor.java:92)
	at org.apache.wicket.RequestCycle.processEventsAndRespond(RequestCycle.java:1279)
	at org.apache.wicket.RequestCycle.step(RequestCycle.java:1358)
	at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1465)
	at org.apache.wicket.RequestCycle.request(RequestCycle.java:545)
	at org.apache.wicket.protocol.http.MockWebApplication.processRequestCycle(MockWebApplication.java:528)
	at org.apache.wicket.util.tester.BaseWicketTester.executeListener(BaseWicketTester.java:263)
	at org.apache.wicket.util.tester.BaseWicketTester.startPage(BaseWicketTester.java:248)
	at org.apache.wicket.util.tester.BaseWicketTester.startPanel(BaseWicketTester.java:399)
	at com.mpobjects.view.wicket.util.component.MpoPagingNavigatorTest.cssClasses(MpoPagingNavigatorTest.java:23)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
	at org.junit.runners.BlockJUnit4ClassRunner.runNotIgnored(BlockJUnit4ClassRunner.java:79)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:71)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:49)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
	at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:50)
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)
Caused by: java.lang.NoSuchMethodException: com.mpobjects.view.wicket.util.component.MpoPagingNavigator.<init>(java.lang.String)
	at java.lang.Class.getConstructor0(Class.java:2892)
	at java.lang.Class.getConstructor(Class.java:1723)
	at org.apache.wicket.util.tester.BaseWicketTester$3$1.getTestPanel(BaseWicketTester.java:413)
	... 44 more

org.apache.wicket.WicketRuntimeException: Error attaching this container for rendering: [MarkupContainer [Component id = panel]]
	at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1789)
	at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
	at org.apache.wicket.markup.html.navigation.paging.PagingNavigator.onBeforeRender(PagingNavigator.java:107)
	at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
	at org.apache.wicket.Component.beforeRender(Component.java:1103)
	at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
	at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
	at org.apache.wicket.Page.onBeforeRender(Page.java:1555)
	at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
	at org.apache.wicket.Component.beforeRender(Component.java:1103)
	at org.apache.wicket.Component.prepareForRender(Component.java:2297)
	at org.apache.wicket.Page.prepareForRender(Page.java:1545)
	at org.apache.wicket.Component.prepareForRender(Component.java:2329)
	at org.apache.wicket.Page.renderPage(Page.java:912)
	at org.apache.wicket.request.target.component.PageRequestTarget.respond(PageRequestTarget.java:63)
	at org.apache.wicket.request.AbstractRequestCycleProcessor.respond(AbstractRequestCycleProcessor.java:105)
	at org.apache.wicket.RequestCycle.processEventsAndRespond(RequestCycle.java:1287)
	at org.apache.wicket.RequestCycle.step(RequestCycle.java:1358)
	at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1465)
	at org.apache.wicket.RequestCycle.request(RequestCycle.java:545)
	at org.apache.wicket.protocol.http.MockWebApplication.processRequestCycle(MockWebApplication.java:528)
	at org.apache.wicket.util.tester.BaseWicketTester.executeListener(BaseWicketTester.java:263)
	at org.apache.wicket.util.tester.BaseWicketTester.startPage(BaseWicketTester.java:248)
	at org.apache.wicket.util.tester.BaseWicketTester.startPanel(BaseWicketTester.java:399)
	at com.mpobjects.view.wicket.util.component.MpoPagingNavigatorTest.css(MpoPagingNavigatorTest.java:23)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
	at org.junit.runners.BlockJUnit4ClassRunner.runNotIgnored(BlockJUnit4ClassRunner.java:79)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:71)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:49)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
	at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:50)
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)
Caused by: java.lang.NullPointerException
	at org.apache.wicket.markup.html.navigation.paging.PagingNavigation.onBeforeRender(PagingNavigation.java:284)
	at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
	at org.apache.wicket.Component.beforeRender(Component.java:1103)
	at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
	... 48 more

/ 7	.

/ Lees	,
http://stackoverflow.com/questions/7769504/testing-wicket-panels-with-constructor-arguments

private class TestPanelSource implements ITestPanelSource {

    private static final long serialVersionUID = 1L;

    public Panel getTestPanel(String panelId) {
        return new MyPanel(panelId, myArg1, myArg2);
    }

}
	@Test
	public void css(){
		wicketTester.startPanel(new TestPanelSource());

/ 7	. 


/ in MpoPagingNavigator.java

/ 13	. 

/ we hadden	,

public class MpoPagingNavigatorTest {

	private WicketTester wicketTester;

	@Before
	public void fixture() {
		wicketTester = new WicketTester();

	}

	@Test
	public void testCss() {
		wicketTester.startPanel(new TestPanelSource());

		MockHttpServletResponse mockHttpServletResponse = wicketTester.getServletResponse();
		String markup = mockHttpServletResponse.getDocument();

		TagTester tagTester = TagTester.createTagByAttribute(markup, "wicket:id", "first");
		Assert.assertEquals(true, tagTester.getAttributeContains("class", "first"));

	}

	// wicket 1.4 hack
	private class TestPanelSource implements ITestPanelSource {

		private static final long serialVersionUID = 1L;

		@Override
		public Panel getTestPanel(String panelId) {
			return new MpoPagingNavigator(panelId, new MockPageable());
		}
	}

	// by hand created mock	,
	private class MockPageable implements IPageable {

		@Override
		public int getCurrentPage() {
			return 5;
		}

		@Override
		public void setCurrentPage(int page) {
			// TODO Auto-generated method stub

		}

		@Override
		public int getPageCount() {
			return 10;
		}

	}
}

/ Nu hebben we	,

public class MpoPagingNavigatorTest {

	private WicketTester wicketTester;

	@Before
	public void fixture() {
		wicketTester = new WicketTester();

	}

	@Test
	public void testCss() {

		wicketTester.startPanel(new TestPanelSource());
		MockHttpServletResponse mockHttpServletResponse = wicketTester.getServletResponse();
		String markup = mockHttpServletResponse.getDocument();

		TagTester tagTester = TagTester.createTagByAttribute(markup, "wicket:id", "first");
		Assert.assertEquals(true, tagTester.getAttributeIs("class", "first"));
		tagTester = TagTester.createTagByAttribute(markup, "wicket:id", "prev");
		Assert.assertEquals(true, tagTester.getAttributeIs("class", "prev"));
		tagTester = TagTester.createTagByAttribute(markup, "wicket:id", "next");
		Assert.assertEquals(true, tagTester.getAttributeIs("class", "next"));
		tagTester = TagTester.createTagByAttribute(markup, "wicket:id", "last");
		Assert.assertEquals(true, tagTester.getAttributeIs("class", "last"));

	}

	/* wicket 1.4 hack */
	private class TestPanelSource implements ITestPanelSource {

		private static final long serialVersionUID = 1L;

		@Override
		public Panel getTestPanel(String panelId) {
			IPageable mock = Mockito.mock(IPageable.class);
			Mockito.when(mock.getCurrentPage()).thenReturn(5);
			Mockito.when(mock.getPageCount()).thenReturn(10);
			return new MpoPagingNavigator(panelId, mock);
		}
	}

}

/ In de workspace	,
[eric@localhost trunk]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk
[eric@localhost trunk]$ ant -f base-framework/buildscripts/build-continuous.xml unittest 2>&1 | tee /tmp/unittest.txt
/ OK

$ vi build-continuous.xml

	<target name="unittest" depends="compile">
		<echo>Running unit tests...</echo>
		<ant antfile="buildscripts/build-unittest.xml" />
	</target>

$ vi build-unittest.xml
...

/ 7	.




/ Einde SCS-4772 TEST


/ SCS SOURCE CODE

/ Lees wiki page	 'Eclipse plugins'	,
/ en ook de hele Wiki blog	, want 'Eclipse plugins' is daar een voorbeeld van 	, 

/ Onderaan  'Eclipse plugins' zien we Attachments	,
/ we download	,
-rw-r-----. 1 eric eric     13307 May 29 12:36 LibContainer1.1.0.20071021_1-src.jar
-rw-r-----. 1 eric eric     19159 May 29 12:36 LibContainer.jar

/ breng deze in eclipse dir	,
$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee/eclipse/plugins/org.dbpowder.plugins.libcontainer_1.1.0.20071021_1
/ restart eclispe	, 
/ als we een wicket page bijv in editor, dan zien we 
Attach Source...
/ en hij zegt welke	,
/ we set ze ernaast in lib/	,

/ we download ze via search.maven.org	,
$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk/base-framework/core/lib/jar/wicket-1.4.23
$ cp ~/Downloads/wicket-1.4.23-sources.jar ~/Downloads/wicket-extensions-1.4.23-sources.jar .

/ F3 gaat OK	, maar met step NIET	, 
/ we moeten extra	, 
/ op de plaats waar de source file had moeten komen staat  een button 'Edit source lookup path ...' (TODO)
/ Naast trunk/ en Default kiezen we nu met optie 'External archive' de wicket-extensions-1.4.23-sources.jar	, 
/ OK

/ we hebben in eclipse-jee-test/workspace/wicket-1.4, en we hebben proj delete in eclipse-jee-test	,

/ WICKET BREAKPOINTS 
Component.render
Component.getDefaultModel
Component.setModelImpl
Component.detach
Component.internalRenderComponent
Model.detach
Model.setObject
Model.getObject
Model.of
Model.ofMap
Model.ofSet
Model.ofList
PropertyColumn.getDataModel
MarkupContainer.onBeforeRenderChildren
WebComponent.onRender
AttributeModifier.replaceAttributeValue
RequestCycle.onDetach
JavaSerializer.serialize
JavaSerializer.newObjectOutputStream
JavaSerializer.newObjectInputStream
JavaSerializer.writeObjectOverride













/ Einde SCS SOURCE CODE

/ DSVROAD-623 

$ less server.log.2015.05-04.gz	
/ , op p, dsvcts	, 

SQL> select  soc.system_id from service_order_cost soc join service_order so on soc.service_order_systemid=so.system_id join cost_type ct on soc.cost_type_systemid=ct.system_id and so.service_order_id='N1637410' and ct.code='FUEL';
   SYSTEM_ID 
============ 
    28436764 
    28436785 
    28436796 

SQL> select  soc.system_id from service_order_cost soc join service_order so on soc.service_order_systemid=so.system_id join cost_type ct on soc.cost_type_systemid=ct.system_id and so.service_order_id='N1637410' and ct.code='FREIGHT';

   SYSTEM_ID 
============ 
    28436766 
    28436773 
    28436780 
    28436789 
    28436800 


/ we zagen in de log ook een serice_order_cost met system_id=28436763	, 

SQL> select  ct.* from service_order_cost soc join service_order so on soc.service_order_systemid=so.system_id join cost_type ct on soc.cost_type_systemid=ct.system_id and so.service_order_id='N1637410' and soc.system_id=28436763;

   SYSTEM_ID CODE                                               DESCRIPTION                                                                                          IS_DELETED REASON_MANDATORY  SEQUENCE_NR 
============ ================================================== =============================================================================== ========== ================ ============ 
     9715726 HAZ_V                                              Virtual Hazardous costs                                                                                       0                0          101 

/ 7	. 

[eric@localhost pnloms]$ dsvcts-db-p.bash 
Database:  scs-application-p.intermax.mp-objects.com:/local/apps/firebird/dsvcts.fdb, User: sysdba
select so.SERVICE_ORDER_ID, so.system_entry_date, count(soc.system_id) from service_order so, service_order_cost soc 
where so.SYSTEM_ID = soc.SERVICE_ORDER_SYSTEMID 
and so.SYSTEM_ENTRY_DATE > '2015-05-01' 
group by so.SERVICE_ORDER_ID, so.SYSTEM_ENTRY_DATE 
having count(soc.system_id) > 10;

SERVICE_ORDER_ID                                                                         SYSTEM_ENTRY_DATE        COUNT 
=============================================================================== ========================= ============ 
N1637388                                                                         2015-05-04 12:36:22.9260            21 
N1637410                                                                         2015-05-04 13:06:18.2930            21 
N1719737                                                                         2015-05-06 13:03:15.1410            21 
N1719803                                                                         2015-05-06 13:15:00.3030            15 
N1760352                                                                         2015-05-13 13:56:25.6560            21 
N1794889                                                                         2015-05-15 14:18:38.0730            21 
N1795144                                                                         2015-05-15 14:24:39.5030            21 
N1896252                                                                         2015-05-19 09:24:50.3430            21 
N1901727                                                                         2015-05-19 13:55:25.6930            21 
N1901803                                                                         2015-05-19 14:06:23.2480            21 
N1920028                                                                         2015-05-20 09:30:34.3770            21 
N1927550                                                                         2015-05-20 14:10:46.9040            21 
N1953298                                                                         2015-05-21 13:29:08.8710            28 
N1953445                                                                         2015-05-21 14:04:14.2450            21 
N1953447                                                                         2015-05-21 14:07:25.1260            21 
N1977532                                                                         2015-05-22 13:39:56.0580            21 


/ 7	. 

/ query bij Post-calculated	,

select soc.system_id,cost_type_systemid,code 
from SERVICE_ORDER_COST soc 
left outer join RATE_COMPONENT_TYPE rct on soc.COST_TYPE_SYSTEMID=rct.SYSTEM_ID 
left join service_order so on  so.system_id=soc.service_order_systemid 
where so.service_order_id='N1637388';

select soc.system_id,cost_type_systemid,code 
from SERVICE_ORDER_COST soc 
left outer join RATE_COMPONENT_TYPE rct on soc.COST_TYPE_SYSTEMID=rct.SYSTEM_ID 
left join service_order so on  so.system_id=soc.service_order_systemid 
where so.service_order_id='N1760352';
/ ERR 

select soc.system_id,cost_type_systemid,code 
from SERVICE_ORDER_COST soc 
left outer join RATE_COMPONENT_TYPE rct on soc.COST_TYPE_SYSTEMID=rct.SYSTEM_ID 
left join service_order so on  so.system_id=soc.service_order_systemid 
where so.service_order_id='N1991696';
/ ERR

select soc.system_id,cost_type_systemid,code 
from SERVICE_ORDER_COST soc 
left outer join RATE_COMPONENT_TYPE rct on soc.COST_TYPE_SYSTEMID=rct.SYSTEM_ID 
left join service_order so on  so.system_id=soc.service_order_systemid 
where so.service_order_id='N1920028';
/ De join met service_order duurt zeer lang, als je where so.system_id=... dan zeer snel	,
/ TODO DB 

select soc.system_id,cost_type_systemid,code 
from SERVICE_ORDER_COST soc 
left outer join RATE_COMPONENT_TYPE rct on soc.COST_TYPE_SYSTEMID=rct.SYSTEM_ID 
where soc.service_order_systemid=30051891

select  serviceord0_.system_id,cost_type_systemid,code
from SERVICE_ORDER_COST serviceord0_
left outer join RATE_COMPONENT_TYPE ratecompon1_ on serviceord0_.COST_TYPE_SYSTEMID=ratecompon1_.SYSTEM_ID
where serviceord0_.SERVICE_ORDER_SYSTEMID=28436197
   SYSTEM_ID COST_TYPE_SYSTEMID CODE                                               
============ ================== ================================================== 
    28436201            9715727 TEMP_V                                             
    28436202            9715726 HAZ_V                                              
    28436203            9718433 FUEL                                               
    28436204            9715723 FREIGHT_V                                          
    28436205            9703918 FREIGHT                                            
    28436206            9718436 FUEL_V                                             
    28436209            9718436 FUEL_V                                             
    28436212            9703918 FREIGHT                                            
    28436214            9718436 FUEL_V                                             
    28436217            9715723 FREIGHT_V                                          
    28436219            9703918 FREIGHT                                            
    28436221            9718436 FUEL_V                                             
    28436224            9718433 FUEL                                               
    28436226            9715723 FREIGHT_V                                          
    28436228            9703918 FREIGHT                                            
    28436230            9718436 FUEL_V                                             
    28436233            9715726 HAZ_V                                              
    28436235            9718433 FUEL                                               
    28436237            9715723 FREIGHT_V                                          
    28436239            9703918 FREIGHT                                            
    28436241            9718436 FUEL_V                                             

select  serviceord0_.system_id,cost_type_systemid,code
from SERVICE_ORDER_COST serviceord0_
left outer join RATE_COMPONENT_TYPE ratecompon1_ on serviceord0_.COST_TYPE_SYSTEMID=ratecompon1_.SYSTEM_ID
where serviceord0_.SERVICE_ORDER_SYSTEMID=28436197

select  serviceord0_.system_id,cost_type_systemid,code
from SERVICE_ORDER_COST serviceord0_
left outer join RATE_COMPONENT_TYPE ratecompon1_ on serviceord0_.COST_TYPE_SYSTEMID=ratecompon1_.SYSTEM_ID
where serviceord0_.SERVICE_ORDER_SYSTEMID=28436197

/ 7	. 

select * 
from SERVICE_ORDER_COST serviceord0_ 
left outer join RATE_COMPONENT_TYPE ratecompon1_ on serviceord0_.COST_TYPE_SYSTEMID=ratecompon1_.SYSTEM_ID 
where serviceord0_.SERVICE_ORDER_SYSTEMID= 28436197

SQL> select so.SERVICE_ORDER_ID, so.system_entry_date, count(soc.system_id) from service_order so, service_order_cost soc     
CON> where so.SYSTEM_ID = soc.SERVICE_ORDER_SYSTEMID     
CON> and so.SYSTEM_ENTRY_DATE > '2015-05-01'     
CON> group by so.SERVICE_ORDER_ID, so.SYSTEM_ENTRY_DATE     
CON> having count(soc.system_id) > 10;
SERVICE_ORDER_ID                                                                         SYSTEM_ENTRY_DATE        COUNT 
=============================================================================== ========================= ============ 
N1760352                                                                         2015-05-13 13:56:25.6560            21 
N1991696                                                                         2015-05-26 11:30:49.6800            21 





/ 7	. 

/ inlog users in dsvcts	,

select this_.SYSTEM_ID as y0_ 
from TMS_USER this_ 
inner join USER_ROLE roles3_ on this_.SYSTEM_ID=roles3_.USER_SYSTEMID 
inner join TMS_ROLE rolevo1_ on roles3_.ROLE_SYSTEMID=rolevo1_.SYSTEM_ID 
where this_.system_id in (
	select uo.user_systemid 
	from USER_ORGANIZATION cuo
	, USER_ORGANIZATION uo 
	where cuo.USER_SYSTEMID = 28847002 
	and cuo.ORGANIZATION_SYSTEMID = uo.ORGANIZATION_SYSTEMID) 
and this_.IS_DELETED=0
and rolevo1_.ROLE_WEIGHT<=10
and lower(this_.USER_ID) like '%eric%' 
order by this_.USER_ID asc

/ TODO PETER/PAUL onnodige join USER_ORGANIZATTION  met zichzelf	,

/ we moeten  
and this_.IS_DELETED=0
/ maar in de log zien we dat false is bind	, niet 0	,
/ TODO

select this_.SYSTEM_ID as y0_ 
from TMS_USER this_ 
inner join USER_ROLE roles3_ on this_.SYSTEM_ID=roles3_.USER_SYSTEMID 
inner join TMS_ROLE rolevo1_ on roles3_.ROLE_SYSTEMID=rolevo1_.SYSTEM_ID 
where this_.IS_DELETED=0
and rolevo1_.ROLE_WEIGHT<=10
and lower(this_.USER_ID) like '%eric%' 
order by this_.USER_ID asc

/ Waarom kan eric,rtdMpo45 niet inlog	, en ericvanvelden, tms123 wel?

SQL> select system_id,user_id,user_password,is_deleted from tms_user where user_id like '%eric%';

   SYSTEM_ID USER_ID          USER_PASSWORD      IS_DELETED 
============ ================= ============================================================== ========== 
    27042645 eric               rtdMpo45        0 
    28843656 eric               tms123          1 
    28847002 ericvanvelden      tms123          0 

SQL> select*from user_organization where user_systemid=28847002;

USER_SYSTEMID ORGANIZATION_SYSTEMID IS_ACTIVE IS_ACTIVE_ALLOWED 
============= ===================== ========= ================= 
     28847002                  3110         0                 1 
     28847002                  3005         0                 1 
     28847002                  3003         0                 1 
     28847002                  3004         0                 1 
     28847002                  3000         1                 1 
SQL> select*from user_organization where user_systemid=28843656;

USER_SYSTEMID ORGANIZATION_SYSTEMID IS_ACTIVE IS_ACTIVE_ALLOWED 
============= ===================== ========= ================= 
     28843656                  3110         0                 1 
     28843656                  3005         0                 1 
     28843656                  3003         0                 1 
     28843656                  3004         0                 1 
     28843656                  3000         1                 1 
SQL> select*from user_organization where user_systemid=27042645;

USER_SYSTEMID ORGANIZATION_SYSTEMID IS_ACTIVE IS_ACTIVE_ALLOWED 
============= ===================== ========= ================= 
     27042645                  3001         1                 1 


select this_.SYSTEM_ID as y0_ 
from TMS_USER this_ 
inner join USER_ROLE roles3_ on this_.SYSTEM_ID=roles3_.USER_SYSTEMID 
inner join TMS_ROLE rolevo1_ on roles3_.ROLE_SYSTEMID=rolevo1_.SYSTEM_ID 
where this_.system_id in (
	select uo.user_systemid 
	from USER_ORGANIZATION cuo
	, USER_ORGANIZATION uo 
	where cuo.USER_SYSTEMID = 27042645 
	and cuo.ORGANIZATION_SYSTEMID = uo.ORGANIZATION_SYSTEMID) 
and this_.IS_DELETED=0
and rolevo1_.ROLE_WEIGHT<=10
and lower(this_.USER_ID) like '%eric%' 
order by this_.USER_ID asc
         Y0_ 
============ 
    27042645 


select this_.SYSTEM_ID as y0_ 
from TMS_USER this_ 
inner join USER_ROLE roles3_ on this_.SYSTEM_ID=roles3_.USER_SYSTEMID 
inner join TMS_ROLE rolevo1_ on roles3_.ROLE_SYSTEMID=rolevo1_.SYSTEM_ID 
where this_.system_id in (
	select uo.user_systemid 
	from USER_ORGANIZATION cuo
	, USER_ORGANIZATION uo 
	where cuo.USER_SYSTEMID = 28843656 
	and cuo.ORGANIZATION_SYSTEMID = uo.ORGANIZATION_SYSTEMID) 
and this_.IS_DELETED=0
and rolevo1_.ROLE_WEIGHT<=10
and lower(this_.USER_ID) like '%eric%' 
order by this_.USER_ID asc
         Y0_ 
============ 
    28847002 

/ TODO

SQL> select system_id from tms_user where user_id like '%eric%';
   SYSTEM_ID 
============ 
    27042645 
    28843656 
    28847002 

select count(cuo.user_systemid )
from USER_ORGANIZATION cuo
where cuo.USER_SYSTEMID = 28843656 
       COUNT 
============ 
           5 

select count(cuo.user_systemid )
from USER_ORGANIZATION cuo
where cuo.USER_SYSTEMID = 27042645 
       COUNT 
============ 
           1 


select count(cuo.user_systemid )
from USER_ORGANIZATION cuo
where cuo.USER_SYSTEMID = 28847002 
       COUNT 
============ 
           5 

select count(uo.user_systemid )
from USER_ORGANIZATION cuo
, USER_ORGANIZATION uo 
where cuo.USER_SYSTEMID = 28843656 
and cuo.ORGANIZATION_SYSTEMID = uo.ORGANIZATION_SYSTEMID
       COUNT 
============ 
         188 

select count(uo.user_systemid )
from USER_ORGANIZATION cuo
, USER_ORGANIZATION uo 
where cuo.USER_SYSTEMID = 27042645
and cuo.ORGANIZATION_SYSTEMID = uo.ORGANIZATION_SYSTEMID
       COUNT 
============ 
         68 

select count(uo.user_systemid )
from USER_ORGANIZATION cuo
, USER_ORGANIZATION uo 
where cuo.USER_SYSTEMID =  28847002 
and cuo.ORGANIZATION_SYSTEMID = uo.ORGANIZATION_SYSTEMID
       COUNT 
============ 
         188 

select cuo.user_systemid
from USER_ORGANIZATION cuo
where cuo.USER_SYSTEMID = 28847002 
USER_SYSTEMID 
============= 
     28847002 
     28847002 
     28847002 
     28847002 
     28847002 

select uo.user_systemid 
from USER_ORGANIZATION cuo
, USER_ORGANIZATION uo 
where cuo.USER_SYSTEMID = 28847002 
and cuo.ORGANIZATION_SYSTEMID = uo.ORGANIZATION_SYSTEMID 

USER_SYSTEMID 
============= 
      9708373 
        10100 
     22700453 
     23683030 
      8861516 
     18334025 
     19181269 
     23401751 
     15582180 
     20833271 
     23401759 
     23401768 
     23406437 
      9708659 
     23439817 
     23920218 
     23920222 
     23920226 
     23920230 
     23920238 

USER_SYSTEMID 
============= 
     23920242 
     23920246 
     24343873 
     26644149 
     27039884 
     27876029 
     28137712 
     28843656 
     27813444 
     27044130 
     27968498 
     27993203 
     28847002 
     11466795 
     11466846 
        10100 
     11928023 
     11928174 
     11466842 
     11466796 

USER_SYSTEMID 
============= 
     23683030 
     15142349 
      8861516 
     22700455 
     11774506 
     11494197 
     15582180 
     23401751 
     20833271 
     23401759 
     23401768 
     23401772 
     23406437 
     23439817 
     11419580 
     23920218 
     23920226 
     23920230 
     23920238 
     23920242 

USER_SYSTEMID 
============= 
     23920246 
      9708373 
     26644149 
     27039884 
     27876029 
     28843656 
     27044130 
     27968498 
     28847002 
     11928023 
        10100 
     11466795 
     11774506 
     11466842 
     15142349 
      8861516 
     22700455 
     23683030 
     15582180 
     11494197 

USER_SYSTEMID 
============= 
     23401751 
     20833271 
     23401759 
     23401768 
     23401772 
     23406437 
     23439817 
     11419580 
     23920218 
     23920226 
     23920230 
     23920238 
     23920242 
     23920246 
      9708373 
     26644149 
     27039884 
     27876029 
     28843656 
     27044130 

USER_SYSTEMID 
============= 
     27968498 
     28847002 
        10100 
     11466846 
     11928174 
     11466796 
     15142349 
      8861516 
     11774506 
     11494197 
     15582180 
     20833271 
     23401751 
     23401759 
     23401768 
     23406437 
     23439817 
     23683030 
     11419580 
     23920218 

USER_SYSTEMID 
============= 
     23920226 
     23920230 
     23920238 
     23920242 
     23920246 
      9708373 
     26644149 
     27039884 
     27876029 
     28843656 
     27044130 
     27968498 
     28847002 
      4116039 
     21308283 
     19181046 
      9709908 
      9708663 
      4115708 
      9708373 

USER_SYSTEMID 
============= 
      4115707 
      9708660 
      9708664 
      9710612 
      9708659 
      4115706 
     11804089 
      9708661 
     15060535 
        10100 
      9708662 
      9708658 
     19181269 
      9710613 
     18334025 
     22700453 
      8861516 
     11494197 
      9708657 
     15582180 

USER_SYSTEMID 
============= 
     20833271 
     23401751 
     23401759 
     23401768 
     23401772 
     23406437 
     23439817 
     23683030 
     11419580 
     23920218 
     23920226 
     23920230 
     23920238 
     23920242 
     23920246 
     23998606 
     24343873 
     26627650 
     26644149 
     26644315 

USER_SYSTEMID 
============= 
     26644318 
     27039884 
     27876029 
     27044130 
     27968498 
     28053963 
     28843656 
     28847002 

/ TODO

/ 7	.

/ query users	,

/ TODO

/ 7	.








/ Einde DSVROAD-623 

/ PNL-586

/ Einde PNL-586

/ EMAIL TO POSTGRESQL

/ MICHEL
/ SWAP 2 JOINS IN QUERY MAKES QUERY FASTER 

Hello,

I have 2 questions. It is about PNL-579.

This is the query wich is executed when you select the shipment order, arrival item entry list. It it the result of a HQL query and Hibernate mappings,

time PGPASSWORD=mpopostgres@mpo psql -U mpopostgres pnloms7 <<MY_SQL
select *
from SHIPMENT_ORDER shipmentor0_
left outer join HOLD_STATUS holdstatus1_ on shipmentor0_.HOLD_STATUS_SYSTEMID=holdstatus1_.SYSTEM_ID
left outer join CUSTOMER_STATUS customerst2_ on shipmentor0_.CUSTOMER_STATUS_SYSTEMID=customerst2_.SYSTEM_ID
left outer join SHIPMENT_ORDER_DETAIL entitydeta3_ on shipmentor0_.SYSTEM_ID=entitydeta3_.ENTITY_SYSTEMID
,COUNTRY country9_
,SHIPMENT_ORDER_TYPE shipmentty10_
,SHIPMENT_SERVICE_LEVEL shipmentse11_
cross join ENTITY_DETAIL_TYPE entitydeta4_
cross join OMS_USER_PARTY userparty5_
cross join SERVICE_ORDER serviceord6_
inner join CONSIGNMENT consignmen7_ on serviceord6_.SYSTEM_ID=consignmen7_.SERVICE_ORDER_SYSTEMID
inner join SERVICE_ACTION serviceact8_ on consignmen7_.SYSTEM_ID=serviceact8_.CONSIGNMENT_SYSTEMID
,PARTY partyvo12_						/ *								
cross join PARTY partyvo13_				/ **
where shipmentor0_.organization_Systemid in (
    select uo.organization_systemid
    from user_organization uo
    where uo.user_systemid = 26708181)
and shipmentor0_.FROM_COUNTRY_SYSTEMID=country9_.SYSTEM_ID
and shipmentor0_.SHIPM_TYPE_SYSTEMID=shipmentty10_.SYSTEM_ID
and shipmentor0_.ACT_SERVICE_LEVEL_SYSTEMID=shipmentse11_.SYSTEM_ID
and serviceord6_.EXECUTED_BY_PARTY_SYSTEMID=partyvo12_.SYSTEM_ID
and userparty5_.PARTY_SYSTEMID=partyvo13_.SYSTEM_ID
and shipmentor0_.IS_TEMPLATE=0 and holdstatus1_.HOLD_STATUS_CODE='VALID'
and (customerst2_.NAME like '%VDO%')
and shipmentor0_.TO_LOCATION_ID=partyvo13_.PARTY_ID
and userparty5_.USER_SYSTEMID=26708181
and entitydeta3_.EDT_SYSTEMID=entitydeta4_.SYSTEM_ID
and entitydeta4_.NAME='CmrRequired'
and serviceact8_.SHIPMENT_ORDER_SYSTEMID=shipmentor0_.SYSTEM_ID
and shipmentor0_.REQUESTED_DEPARTURE_AFTER>='2015-05-11'
and shipmentor0_.REQUESTED_DEPARTURE_AFTER<='2015-05-14'
order by serviceord6_.ESTIMATED_END_BEFORE, shipmentor0_.REQUESTED_ARRIVAL_AFTER limit 15
MY_SQL

This query takes about 15 seconds (this is the issue). The resultset is only 20 rows. When I exchange row * and **	, the query takes 0.1 second. Why? This is my first question.

To understand what was happening, I thought, let's use explain. The result was too large. So I thought, let's skip some tables. This resulted in the following query	,

time PGPASSWORD=mpopostgres@mpo psql -U mpopostgres pnloms7 <<MY_SQL
select count(*)
from SHIPMENT_ORDER shipmentor0_
cross join OMS_USER_PARTY userparty5_
cross join SERVICE_ORDER serviceord6_
cross join PARTY partyvo13_					/ *
,PARTY partyvo12_							/ **
where 
serviceord6_.EXECUTED_BY_PARTY_SYSTEMID=partyvo12_.SYSTEM_ID
and userparty5_.PARTY_SYSTEMID=partyvo13_.SYSTEM_ID
and shipmentor0_.TO_LOCATION_ID=partyvo13_.PARTY_ID
and userparty5_.USER_SYSTEMID=26708181
MY_SQL

When I executed this query, my computer froze. Later I saw that the resultset consisted of about 14000000 rows. But I could cancel this. But my computer had become too slow. I had to restart it. My second question is if you have experience how to handle such (accidentally happening) large resultsets.

Thanks. 


/ Einde EMAIL TO POSTGRESQL


/ DSVROAD-615

ericvelden
tms123

https://scs.mp-objects.com/dsvcts/core/index_frameset
/ 25217664 is een sho	,
/ 25212336 ook dubbelen in sho	, niet in seo	,




/ Einde DSVROAD-615

/ DYNAMIC DNS

/ Lees	, 
http://lifehacker.com/the-best-free-alternatives-to-dyndns-1561556205
DuckDNS

/ is free alternative voor DynDNS	,

/ Is om mijn computer van buiten te benaderen	,
/ je externe ip address kan veranderen	, 

/ je interne ip address is nat	, = 192.168	, 
/ in router kun je deze vast zetten op het mac address	,



/ Einde DYNAMIC DNS


/ 8 MEI

LOG_8_SEP: 12731
[eric@localhost Firebird]$ isql-fb dsvcts.fdb -user sysdba -pass masterkey
[eric@localhost LOGS]$ psql -U foo
[eric@localhost LOGS]$ PGPASSWORD=mpopostgres@mpo psql -U mpopostgres pnloms

[eric@localhost eclipse-jee]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee

[eric@localhost eclipse-jee-test]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee-test

 [eric@localhost apache-tomcat-7.0.57]$  pwd
/home/eric/Devel/Java/Tomcat/apache-tomcat-7.0.57
[eric@localhost apache-tomcat-7.0.57]$ bin/catalina.sh run

[eric@localhost 2015.01]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/2015.01

[eric@localhost server]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server

[eric@localhost SHO.xml]$ pwd
/home/eric/Devel/Interfaces/2015.01_mpo/SHO.xml
[eric@localhost SHO.xml]$ gedit O91T50555.CMP.xml

[eric@localhost apache-activemq-5.10.1]$ pwd
/home/eric/Devel/Java/ActiveMQ/apache-activemq-5.10.1
[eric@localhost apache-activemq-5.10.1]$ bin/activemq console

[eric@localhost Cocoon]$ pwd
/home/eric/Devel/Java/Cocoon

[eric@localhost Hibernate]$ pwd
/home/eric/Devel/Java/Hibernate

[eric@localhost Firebird]$  pwd
/home/eric/Devel/Firebird
[eric@localhost Firebird]$ sudo -u firebird gbak  -v -c -user sysdba -password masterkey dsvcts.fdb_20150507-024121.fbk dsvcts.fdb




/ Einde 8 MEI



/ PNL-313

/ we kunnen menu items ook vertalen	,

/ we moeten van het path de laatste nemen, en camel case-> _	,

$ vi massupdate-menu.xml

	<m:add path="configuration.massupdate.EntityActionTypes" privilege="massupdate.list" actionUrl="wicket?module=massupdate&amp;wicketpage=actiontype.EntityActionTypeListPage" index="8000" />
	<m:add path="configuration.massupdate.EntityActionGroupTemplates" privilege="massupdate.template-list" actionUrl="wicket?module=massupdate&amp;wicketpage=actiongrouptemplate.EntityActionGroupTemplateListPage" index="8010" />
	<m:add path="planning.shipmentOrder.massUpdate" privilege="shipmentorder.list" actionUrl="wicket?module=massupdate&amp;wicketpage=shipmentorder.ShipmentOrderMassUpdatePage" index="8020" />
	<m:add path="planning.shipmentOrder.massUpdateDashboard" privilege="shipmentorder.list" actionUrl="wicket?module=massupdate&amp;wicketpage=actiongroup.EntityActionGroupListPage"
		index="8030" />

$ vi language_en.properties

massupdate=[massupdate]
entity_action_types=[entity_action_types]
entity_action_group_templates=[entity_action_group_templates]
mass_update=[mass_update]
mass_update_dashboard=[mass_update_dashboard]

/ er is geen apart configuration.massupdate entry	, hij kijkt gewoon naar configuration.massupdate.EntityActionTypes	,

/ Dus we hebben vertaald
configuration, massupdate	,
configuration, massupdate	, entity action types
configuration, massupdate	, entity action group templates
planning, shipment order, massupdate 
planning, shipment order, massupdate  dashboard

/ 7	. 

/ michel had gemaakt	,

config, planning, shipment order, user template		/ nieuw
config, planning, shipment order, template groups 	/ nieuw
config, planning, shipment order, all templates		/ deze was er al

config, planning, shipment order, all templates	 = planning, shipment order, create	,	

/ all templates= alle sho templates	,
/ template groups= alle groups={templates}
/ user template : template groups waar een user gekoppeld aan is= verz templates die een user kan use om sho's te maken	,

/ 7	.

planning - shipment order - laadscherm 

/ eerst moeten we	,
config, admin, user party
/ we komen op 'Edit user party'	, op test	,
/ we zien 2 user party's , dat zijn hier warehouses	,  heeft Sander gedaan	,
/ eric is nu gekoppeld aan deze warehouses	, 

/ local moeten we deze warehouses koppelen	,
/ ga naar config, admin, user party	,
/ geef bij userId eric, search	, edit	, 
/ click add	, 
/ select achtereenvolgens user party (warehouse) 3503, 3507	, click 'save and close'	,


/ daardoor zien we op 
planning - shipment order - laadscherm 	, shipment orders die worden geladen in vrachtwagens,	 de from_party een van de 2 warehouses die we aan eric hadden gekooppeld	, 
/ Op planning -sho-loscherm is to_party een van die 2 warehouses	, 



/ 7	.

planning - voorraad - stock count 
/ we zien list van ... (TODO)
/ open er een ,
/ Wat zien we ? (TODO)

/ 7	.


/ Einde PNL-313

/ DEBUG PNL-313 

/ 7	.

config, admin, user party
/ = UserPartyListPage

$ vi UserParty.standard.hbm.xml

	<class name="com.mpobjects.oms.model.userparty.vo.UserParty" table="OMS_USER_PARTY">
		<composite-id name="id" class="com.mpobjects.oms.model.userparty.vo.UserPartyId">
			<key-property name="resource" >
				<column name="USER_SYSTEMID" />
			</key-property>
			<key-property name="party">
				<column name="PARTY_SYSTEMID" />
			</key-property>
		</composite-id>
		
		<many-to-one name="resource" class="com.mpobjects.oms.model.user.Resource" update="false" insert="false" fetch="select">
            <column name="USER_SYSTEMID" not-null="true" />
        </many-to-one>
        <many-to-one name="party" class="com.mpobjects.oms.model.party.vo.PartyVO" update="false" insert="false" fetch="select">
            <column name="PARTY_SYSTEMID" not-null="true" />

/ TODO



/ Einde DEBUG PNL-313 


/ RESOURCEMODEL	, WICKET:MESSAGE 

/ we kunnen in wicket in Java ResourceModel of in html <wicket:message key="..."/>

/ In beide gevallen vallen we in 	, waar de lookup wordt gedaan	,
LanguageManagerStringResourceLoader.loadStringResource(Component, String) line: 46	
				return getLanguageManager().getTranslation(aKey, aComponent.getLocale(), aComponent.getStyle(), true);


/ 13	. 

/ ResourceModel	,

/ configuratie, master data, schedules

/ we zien een table met schedules	, 
/ de headers zijn ResourceModels	,

$ vi GenericListPanel.java

	public void initialize() {
		IModel<String> filterColTitle = new IModel<String>() {
			protected IModel<String> filterOn = new ResourceModel("filter", "filter").wrapOnAssignment(GenericListPanel.this);
		...
		addFilterColumns(myColumnsList);
/s
$ vi ScheduleSearchListPanel.java
		columnList.add(new ConfigurableTextFilteredPropertyColumn<String>(getModel(NAME), NAME, NAME,
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<String>(30)));
		columnList.add(new ConfigurableTextFilteredPropertyColumn<String>(getModel("organization"), "organization.code", "organization.code",
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<String>(10)));
		columnList.add(new ConfigurableTextFilteredPropertyColumn<String>(getModel("description"), "description", "description",
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<String>(30)));
	
	private IModel<String> getModel(String aString) {
		return new StringResourceModel(aString, this, getDefaultModel());
	}

/ we zien dat de code valt in	,
LanguageManagerStringResourceLoader.loadStringResource(Component, String) line: 46	
/=
	public String loadStringResource(Component aComponent, String aKey) {
this	LanguageManagerStringResourceLoader  (id=15555)	
aComponent	ScheduleSearchListPanel  (id=15638)	
aKey	"filter" (id=15639)	
aKey	"name" (id=16597)	
aKey	"organization" (id=16598)	
aKey	"description" (id=16599)	

		try {
			if (aComponent != null) {
				return getLanguageManager().getTranslation(aKey, aComponent.getLocale(), aComponent.getStyle(), true);

/ 13	. 

/ <wicket:message key="..."/>

$ vi ScheduleEditPanel.html

		<h1><wicket:message key="scheduleedit.title">[Schedule Edit]</wicket:message></h1>
		<p></p>
		<ul>
			<li>
				<label>
					<span class="listLabelField"><wicket:message key="name">Name</wicket:message></span>
...

/ configuration, master data, schedules, edit een schedule uit de list	,

/ we vallen in	,
LanguageManagerStringResourceLoader.loadStringResource(Component, String) line: 46	
	public String loadStringResource(Component aComponent, String aKey) {
aKey	"scheduleEdit" (id=14210)	
aKey	"name" (id=14211)	
...

/ Einde RESOURCEMODEL	, WICKET:MESSAGE 




/ BREAKPOINTS

public class ModalRuleEditPage extends BasePage {

public class SotTriggerEditPanel extends GenericFormPanel<ServiceOrderTypeTrigger> {

AbstractEntityActionButton [line: 246] - onSubmit()	
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new Button(aId) {
			@Override
			public boolean isEnabled() {
				return AbstractEntityActionButton.this.isEnabled(aModel);
			}

			@Override
			public void onSubmit() {
	->			AbstractEntityActionButton.this.onSubmit(this, aModel);
			}
		};
	}

AbstractGenericEditPanel [line: 130] - AbstractGenericEditPanel(String, IModel<T>, String...)	
	public AbstractGenericEditPanel(String aPrefix, final IModel<T> aModel, String... aFieldList) {
		super("dynamicPanel");

AbstractGenericEditPanel [line: 217] - getTitle()	

AbstractGenericEditPanel$DefaultActionPanel [line: 66] - onSave(AjaxRequestTarget, Form)	

AbstractGenericEditPanel$DefaultActionPanel [line: 79] - onSaveAndClose(AjaxRequestTarget, Form)	


public class ArrivalItemEntryListPage extends AbstractMainPage {
	@Override
	protected IModel<String> getPageTitle() {
		// TODO Auto-generated method stub
		return super.getPageTitle();
	}

BaseHomePage [line: 31] - doRedirect()	

BaseHomePage [line: 36] - doRedirect()	

AbstractTrigger [line: 121] - setFilterExpressionRule(Rule)	

BaseWebSession [line: 24] - BaseWebSession(Request)	

ConfigReloadFilter [line: 47] - doFilter(ServletRequest, ServletResponse, FilterChain)	

EditProfilePage [line: 20] - EditProfilePage()	

EntityDetailValueSetTypeListPage [line: 29] - EntityDetailValueSetTypeListPage()	

Expression [line: 50] - evaluate(ExpressionContext)	

Expression [line: 131] - evaluateRegex(ExpressionContext)	

ExpressionPanel [line: 32] - createPage()	

GenericForm [line: 98] - onSubmit()	

GenericFormPanel [line: 163] - createPanel(GenericCompountPropertyModel<T>)	

GenericListPanel [line: 156] - GenericListPanel(String, BaseWebComponent, WebComponentEventSwitchBoard, ListActionsPanelBuilder<T>, BeanWrapper<? extends BaseDAOInterface<T>>, int, TableDataProviderBuilder<T>, List<EntityCollectionAction<T>>, boolean)	

GenericListPanel [line: 236] - initialize()	

GenericListPanel [line: 275] - getFilter(String, FilterForm)	
	myColumnsList.add(new FilteredAbstractColumn(filterColTitle) {

			@Override
			public Component getFilter(final String componentId, final FilterForm form) {
				ResetableGoAndClearFilter resetableGoAndClearFilter = new ResetableGoAndClearFilter(componentId, form, dataProvider, GenericListPanel.this);
				return resetableGoAndClearFilter;
			}

			@Override
			public void populateItem(final Item cellItem, final String componentId, final IModel model) {
				Collection<Component> myList = new ArrayList<Component>();
				if (entityGroupActions != null && entityGroupActions.size() > 0) {
...

GroupExpressionPanel [line: 34] - GroupExpressionPanel(String, IModel<GroupExpression>)	

LanguageManager [line: 75] - LanguageManager(HttpServletRequest)	
	public LanguageManager(HttpServletRequest aRequest) {
		setLocale(LocaleUtils.getActiveLocale());

LanguageManager [line: 100] - resetLanguageCache()	

LanguageManagerStringResourceLoader [line: 31] - loadStringResource(Class<?>, String, Locale, String)	
	@Override
	public String loadStringResource(Class<?> aClazz, String aKey, Locale aLocale, String aStyle) {
		if (LOG.isDebugEnabled()) {
			LOG.debug("key: '" + aKey + "'; class: '" + aClazz.getName() + "'; locale: '" + aLocale + "'; Style: '" + aStyle + "'");
		}
		try {
			return getLanguageManager().getTranslation(aKey, aLocale, aStyle, true);
		} catch (IndexOutOfBoundsException ioobe) {
			return super.loadStringResource(aClazz, aKey, aLocale, aStyle);
		}
	}
	/**
	 * Is checked first
	 */
	@Override
	public String loadStringResource(Component aComponent, String aKey) {
		if (LOG.isDebugEnabled()) {
			LOG.debug("component: '" + aComponent + "'; key: '" + aKey + "'");
		}

MenuGenerateAction [line: 46] - act()	

ModalRuleEditPage [line: 21] - ModalRuleEditPage(ModalWindow, IModel<Rule>)	

OrderDetailEditPanel [line: 67] - setForm(GenericForm<OrderDetail>)	

OrderDetailListPage [line: 71] - createListPanel()	
	protected void createListPanel() {
		searchListPanel = new OrderDetailListPanel("searchList", null, webComponentEventSwitchBoard, daoWrapper);
		searchListPanel.setPanelBuilder(new EntityListActionBuilder<OrderDetail>(getPanelActions()));
		searchListPanel.initialize();
		searchListPanel.setOutputMarkupId(true);
		add(searchListPanel);

RuleEditButton [line: 27] - RuleEditButton(String, IModel<Rule>)	

RulePanel [line: 35] - RulePanel(String, Rule)	

ScheduleListPage [line: 46] - ScheduleListPage()	

ScheduleSearchListPanel [line: 74] - addFilterColumns(List<IColumn>)	
		columnList.add(new ConfigurableTextFilteredPropertyColumn<String>(getModel(NAME), NAME, NAME,
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<String>(30)));
		columnList.add(new ConfigurableTextFilteredPropertyColumn<String>(getModel("organization"), "organization.code", "organization.code",
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<String>(10)));
		columnList.add(new ConfigurableTextFilteredPropertyColumn<String>(getModel("description"), "description", "description",
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<String>(30)));
	}

ScheduleSearchListPanel$Builder [line: 46] - build(BeanWrapper<? extends BaseDAOInterface<Schedule>>, String)	
	public TableDataProviderInterface<Schedule> build(BeanWrapper<? extends BaseDAOInterface<Schedule>> aDaoWrapper, String defaultSortProperty) {
			PrefilteredTableDataProvider<Schedule> myProvider = new PrefilteredTableDataProvider<Schedule>(aDaoWrapper, "");
			myProvider.setPrefilterParameters(parameters);
			myProvider.resetFilterState();
			return myProvider;

ServiceOrderTriggerHandlerImpl [line: 31] - serviceOrderTypeTriggerDAO	

SotTriggerEditPanel [line: 92] - setForm(GenericForm<ServiceOrderTypeTrigger>)	

UserCrudEditPanel [line: 123] - UserCrudEditPanel(IModel<Resource>, boolean, String...)	

Variable [line: 42] - getValue(ExpressionContext)	

WicketLanguageManager [line: 18] - getTranslation(String, Locale, String, boolean)	
	public String getTranslation(String aKey, Locale aLocale, String aStyle, boolean aThrowExceptionIfNotFound) {
		return get(aKey, aLocale, aStyle, aThrowExceptionIfNotFound);
	}

EntityDetailValueSetTypeListPage [entry] - EntityDetailValueSetTypeListPage()	

EvoParentListPage [entry] - getChildPage(IModel)	

MessagePage [entry] - MessagePage()	
		searchListPanel = new MessageSearchListPanel("evoSearchList", null, webComponentEventSwitchBoard, daoWrapper, getListPanelAction());
		final IModel<String> editPageTitle = new StringResourceModel("listTitle", MessagePage.this, new Model<VOListPage<Message>>(MessagePage.this),
				"Search ${entityName}");
		searchListPanel.setTitle(editPageTitle.getObject());
		searchListPanel.setOutputMarkupId(true);
		searchListPanel.setDataProperties(dataProperties);
		add(searchListPanel);

ScheduleListPage [entry] - getEditPage()	
	protected ScheduleEditPage getEditPage() {
		if (editPage == null) {
			editPage = new ScheduleEditPage(daoWrapper, this);

VOEditPage [entry] - onSubmit(Button, AjaxRequestTarget, IModel<T>)	
	@SuppressWarnings("serial")
	protected Collection<EntityAction<T>> getListPanelAction() {
		List<EntityAction<T>> actions = new ArrayList<EntityAction<T>>();

		// Edit the selected entity
		final IModel<String> editPageTitle = new StringResourceModel("editEntity", VOEditPage.this, new Model<VOEditPage<T>>(VOEditPage.this),
				"Update {entityName}");
		EntityActionButton<T> button = new EntityActionAjaxButton<T>("edit", new ResourceModel("edit")) {
			@Override
			protected void onSubmit(Button aButton, AjaxRequestTarget aTarget, IModel<T> aSelection) {
->				VOEditFormPage<T> page = getEditPage();

/ 13	. 

AbstractPage [line: 56] - getPageTitle()	
AbstractPage [line: 66] - initializePage()	
AbstractPage [line: 68] - initializePage()	
ArrivalItemEntryListPage [line: 142] - getPageTitle()	








/ Einde BREAKPOINTS


/ PNL WICKET SCREEN

/ active organization: PNL-OMS-DEM	  : planning, shipment order create , create new order: is NIET wicket scherm
/ active organization: PNL-OMS-GEN	  : planning, shipment order create , create new order: is WEL wicket scherm

Shipment Type :			561	
Actual Service Level: 	NORMAL

party's:
from : From Party: 8089
to: To Party: 3503

Save

/ dan komen we op shipment order edit scherm (WH)
Recurring: check
/ click icon achter Schedule	, dan komt er een wicket scherm	, 
/ het icon achter valid from heeft geen wicket path	, 


/ Kies 


/ Einde PNL WICKET SCREEN


/ INTERFACING

/ 7	. 

/ WinSCP , op linux	,
http://stackoverflow.com/questions/299412/is-there-any-winscp-equivalent-for-linux

/ 13	. 

If you're using Gnome, you can go to: Places -> Connect to Server in nautilus and choose SSH. If you have a SSH agent running and configured, no password will be asked! (This is the same as sftp://root@servername/directory in Nautilus)

In Konqueror, you can simply type: fish://servername.

/ 13	. 

gFTP
Konqueror's fish kio-slave (just write as file path: ssh://user@server/path

/ 7	. 

/ er zijn mposerv13: test server voor interfacing	,
/ mposerv11: test server voor application	,

/ integration-a  - application-a
/ integration-p  - application-p

/ op integration-a	,
local
	apps
		interface
			nippon-express
				from-nippon
					iftmin
						archive
							2015-03
								30
/ tussenvorm, van edifact,	 naar scs	,

				to-scs
					jms
						archive
							2015-04
								01
/ de XML die naar scs gaat	, die we invoeren in Jms Message Entry	,
/ voor NIP-45	,

			ftp
				jms
					archive
						2015-03
/ edifact	, zoals het binnenkomt	,


/ 7	.	
		
local
	apps
		interface
			cts
				molnlycke
					to-cts
						iftmin	
							archive
/ voor DSVMHC-39								

/ 7	. 

[eric@localhost mhc]$ pwd
/home/eric/Devel/Interfaces/mhc
[eric@localhost mhc]$ ls
MHC_MPO_150403_113721_5018.TXT.iftmin.xml_0049_0050.xml.SHIPMENT_ORDER.xml  
/ nieuw	, werkt OK op 3-apr-2015
mhc.xml
/ oud	, werkt ? op 3-apr-2015

[eric@localhost New]$ pwd
/home/eric/Devel/Interfaces/2015.01_mpo/New
[eric@localhost New]$ ls
O91T55707.CMP.xml  O91T55711.CMP.xml
/ 2 nieuwe berichten voor Nippon , 3-apr-2015 OK
	
	



/ Einde INTERFACING

/ OPEN IN CHROME

/ junit & spring
http://www.javacodegeeks.com/2011/10/spring-3-testing-with-junit-4.html

/ wicket testing
https://cwiki.apache.org/confluence/display/WICKET/Selenium+Tips
http://docs.seleniumhq.org/docs/03_webdriver.jsp

http://localhost:9090/wicket-book/

http://camel.apache.org/routes.html

http://www.jfrog.com/open-source/#os-arti

http://camel.apache.org/manual/camel-manual-2.12.0.html

http://docs.oracle.com/javase/tutorial/jmx/remote/custom.html
http://docs.oracle.com/javase/tutorial/jmx/mbeans/mxbeans.html

/ van michel	,
https://docs.google.com/document/d/1ByuXzWRlvFCh4TlxLz8Yitaytgmm1cErTcAAPue3nKA/edit#heading=h.5einwc3adu2w



/ Einde OPEN IN CHROME

/ WICKET DETACHABLE MODEL	

/ 7	. 

/ Oef met models

/ proj. wicket-testing

/ 13	. 

/ Model	,

$ vi Counter2WithModelsPage.java

		long millis=System.currentTimeMillis();
		IModel<Long>model=new Model<Long>(millis);
		Label millisl=new Label("millis",model);
		add(millisl);

$ vi Counter2WithModelsPage.html
<span wicket:id="millis">[Label]</span>

/ we zien in chrome dat de url steeds is	,
http://localhost:9090/wicket-testing

/ als we refresh , zien we een andere current time millis	,


/ 13	. 

/ als we een link add, krijgt de page een page id	, ?2 bijv	, en als we refresh (door refresh click in browser, of op onze refresh button click) , blijft hij deze page tonen, dus verandert de current time millis niet	,


$ vi Counter2WithModelsPage.java

		long millis=System.currentTimeMillis();
		IModel<Long>model=new Model<Long>(millis);
		Label millisl=new Label("millis",model);
		Link<Void>link=new Link<Void>("refresh") {
			@Override
			public void onClick() {
			}
		};
		
		add(millisl);
		add(link);

$ vi Counter2WithModelsPage.html
<span wicket:id="millis">[Label]</span>
<a wicket:id="refresh">Refresh</a>

/ 13	. 

/ Dynamic model	,

$ vi Counter2WithModelsPage.java
		IModel<Long>model=new Model<Long>(){
			public Long getObject() {
				return System.currentTimeMillis();
			};
		};
		Label millisl=new Label("millis",model);
		Link<Void>link=new Link<Void>("refresh") {
			@Override
			public void onClick() {
			}
		};
		
		add(millisl);
		add(link);

$ vi Counter2WithModelsPage.html
<span wicket:id="millis">[Label]</span>
<a wicket:id="refresh">Refresh</a>

/ als we refresh (door refresh click in browser, of op onze refresh button click) , blijft hij deze page tonen, maar verandert de current time milliso WEL	,

/ 13	. 

/ we maken een property model	,
/ als we deze update, wordt de component ook update	,
/ Dit is niet bij een model	(static)	, wel als we hem dynamic maken	,

$ vi Counter2WithModelsPage.java

public class Counter2WithModelsPage extends WebPage{
	
	private int counter=0;
	private String text="Link";
	private String link="Foo Bar";
	
	private long millis2;
	private long millis3;

	
	public Counter2WithModelsPage() {
		
		IModel<Long>model=new Model<Long>(){
			public Long getObject() {
				return System.currentTimeMillis();
			};
		};
		Label millisl=new Label("millis",model);
		
		Link<Void>link=new Link<Void>("refresh") {
			@Override
			public void onClick() {
				Counter2WithModelsPage.this.millis2=System.currentTimeMillis();
				Counter2WithModelsPage.this.millis3=System.currentTimeMillis();
			}
		};
		
		this.millis2=System.currentTimeMillis();
		IModel<Long>model2=new PropertyModel<Long>(this, "millis2");
		Label millisl2=new Label("millis2",model2)	;
		
		this.millis3=System.currentTimeMillis();
		IModel<Long>model3=new Model<Long>(millis3);
		Label millis3=new Label("millis3",model3);

		add(millisl);
		add(link);
		add(millisl2);
		add(millis3);
		
	}
}

$ vi Counter2WithModelsPage.html

<span wicket:id="millis">[Label]</span>
<a wicket:id="refresh">Refresh</a>
<span wicket:id="millis2">[Label]</span>
<span wicket:id="millis3">[Label]</span>


/ als we op de refresh link click, dan wordt millis en millis2 refresh, millis3 niet	, 
/ als we op de browser's refresh click, dan wordt millis refresh	,

/ 13	. 

/ we kunnen ook een compound property model use	, deze werkt net als een property model	, hij refresh de component als de model is refreshed	,
/ als we op de refresh link click, dan wordt millis en millis2, millis4 refresh, millis3 niet	, 
/ als we op de browser's refresh click, dan wordt millis refresh	,


$ vi Counter2WithModelsPage.java

public class Counter2WithModelsPage extends WebPage{
	
	private int counter=0;
	private String text="Link";
	private String link="Foo Bar";
	
	private long millis2;
	private long millis3;
	private long millis4;

	
	public Counter2WithModelsPage() {
		
		IModel<Long>model=new Model<Long>(){
			public Long getObject() {
				return System.currentTimeMillis();
			};
		};
		Label millisl=new Label("millis",model);
		
		Link<Void>link=new Link<Void>("refresh") {
			@Override
			public void onClick() {
				Counter2WithModelsPage.this.millis2=System.currentTimeMillis();
				Counter2WithModelsPage.this.millis3=System.currentTimeMillis();
				Counter2WithModelsPage.this.millis4=System.currentTimeMillis();
			}
		};
		
		this.millis2=System.currentTimeMillis();
		IModel<Long>model2=new PropertyModel<Long>(this, "millis2");
		Label millisl2=new Label("millis2",model2)	;
		
		this.millis3=System.currentTimeMillis();
		IModel<Long>model3=new Model<Long>(millis3);
		Label millis3=new Label("millis3",model3);

		IModel<Counter2WithModelsPage>model4=new CompoundPropertyModel<Counter2WithModelsPage>(this);
		this.setDefaultModel(model4);
		Label millis4=new Label("millis4");
		add(millis4);


		add(millisl);
		add(link);
		add(millisl2);
		add(millis3);
		add(millis4);
		
	}
}

$ vi Counter2WithModelsPage.html

<span wicket:id="millis">[Label]</span>
<a wicket:id="refresh">Refresh</a>
<span wicket:id="millis2">[Label]</span>
<span wicket:id="millis3">[Label]</span>
<span wicket:id="millis4">[Label]</span>

/ 13	. 

/ we lezen in boek(96), dat detach (van model) voor ser (in session). gaat: logisch, eerst detach de model, obj kleiner voor ser (in session)	,
/ we lezen in boek(98), dat datach na rendering komt: als op scherm, 	dan kan hij detach de models	,

/ 13	. 

/ we restart tomcat	, 
$ bin/catalina.sh jpda run
/ we run in eclipse
wicket-book-deploy
tomcat7-or-jetty-remote-on-wicket-book
/ we maken Man11_4d7 to home page	, 
/ we geven	,
http://localhost:9090/wicket-book
/s
	DefaultPageStore.convertToPage(Object) line: 73	
	PageStoreManager$SessionEntry.convertAfterReadObjects() line: 172	
	PageStoreManager$SessionEntry.getPage(int) line: 189	
	PageStoreManager$PersistentRequestAdapter.getPage(int) line: 357	
	PageStoreManager(AbstractPageManager).getPage(int) line: 82	
	PageAccessSynchronizer$2(PageManagerDecorator).getPage(int) line: 50	
	PageAccessSynchronizer$2.getPage(int) line: 246	
	DefaultMapperContext.getPageInstance(int) line: 113	
	PageProvider.getStoredPage(int) line: 296	
	PageProvider.isNewPageInstance() line: 208	
	HomePageMapper(AbstractBookmarkableMapper).processHybrid(PageInfo, Class<IRequestablePage>, PageParameters, Integer) line: 261	
	HomePageMapper(AbstractBookmarkableMapper).mapRequest(Request) line: 365	
	SystemMapper(CompoundRequestMapper).mapRequest(Request) line: 150	
	RequestCycle.resolveRequestHandler() line: 189	
	RequestCycle.processRequest() line: 219	
	RequestCycle.processRequestAndDetach() line: 293	
	WicketFilter.processRequestCycle(RequestCycle, WebResponse, HttpServletRequest, HttpServletResponse, FilterChain) line: 261	
	WicketFilter.processRequest(ServletRequest, ServletResponse, FilterChain) line: 203	
	WicketFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 284	

/ we vallen hier maar 1 keer in	,
/ Als we op een link click 	,
/s
	DefaultPageStore.storePage(String, IManageablePage) line: 61	
	PageStoreManager$PersistentRequestAdapter.storeTouchedPages(List<IManageablePage>) line: 403	
	PageStoreManager$PersistentRequestAdapter(RequestAdapter).commitRequest() line: 172	
	PageStoreManager(AbstractPageManager).commitRequest() line: 76	
	PageAccessSynchronizer$2(PageManagerDecorator).commitRequest() line: 68	
	PageAccessSynchronizer$2.commitRequest() line: 270	
	Application$3.onDetach(RequestCycle) line: 1751	
	RequestCycleListenerCollection$3.notify(IRequestCycleListener) line: 105	
	RequestCycleListenerCollection$3.notify(Object) line: 101	
	ListenerCollection$1.notify(T) line: 120	
	RequestCycleListenerCollection(ListenerCollection<T>).reversedNotify(INotifier<T>) line: 144	
	RequestCycleListenerCollection(ListenerCollection<T>).reversedNotifyIgnoringExceptions(INotifier<T>) line: 113	
	RequestCycleListenerCollection.onDetach(RequestCycle) line: 100	
	RequestCycle.onDetach() line: 645	
	RequestCycle.detach() line: 594	
	RequestCycle.processRequestAndDetach() line: 297	
	WicketFilter.processRequestCycle(RequestCycle, WebResponse, HttpServletRequest, HttpServletResponse, FilterChain) line: 261	
	WicketFilter.processRequest(ServletRequest, ServletResponse, FilterChain) line: 203	
	WicketFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 284	

/ Hier vallen we steeds in	,

/ bij wicket-testing valt hij helemaal niet in 
	DefaultPageStore.convertToPage(Object) line: 73	

/ Lees	,
wicket/wicket-core/src/test/java/org/apache/wicket/core/request/mapper/TestMapperContext.java
wicket/wicket-core/src/test/java/org/apache/wicket/page/PersistentPageManagerTest.java
 

/ See	, 
FrameworkSettings.setDetachListener, /.setSerializer	,

/ Bekijk,
	public DefaultPageStore(final ISerializer pageSerializer, final IDataStore dataStore,
		final int cacheSize)

/ See Application: getFrameworkSettings()	, ...

/ 13	. 

/ we kunnen de detach method override in alle models	,

$ vi Counter2WithModelsPage.java

	private long millis2;
	private long millis3;
	private long millis4;

	public Counter2WithModelsPage() {
		IModel<Long>model=new Model<Long>(){
			public Long getObject() {
				return System.currentTimeMillis();
			};
			@Override
			public void detach() {
				super.detach();
				System.out.println("\nmodel: "+this+".detach"+"\n");
			}
			
		};
		Label millisl=new Label("millis",model);
		
		Link<Void>link=new Link<Void>("refresh") {
			@Override
			public void onClick() {
				Counter2WithModelsPage.this.millis2=System.currentTimeMillis();
				Counter2WithModelsPage.this.millis3=System.currentTimeMillis();
				Counter2WithModelsPage.this.millis4=System.currentTimeMillis();
			}
		};
		
		add(millisl);
		add(link);

		this.millis2=System.currentTimeMillis();
		IModel<Long>model2=new PropertyModel<Long>(this, "millis2"){
			public void detach() {
				super.detach();
				System.out.println("\nmodel2: "+this+".detach"+"\n");

			};
		};
		Label millisl2=new Label("millis2",model2)	;
		add(millisl2);
		
		this.millis3=System.currentTimeMillis();
		IModel<Long>model3=new Model<Long>(millis3){
			public void detach() {
				super.detach();
				System.out.println("\nmodel3:"+this+".detach"+"\n");

			};
		};
		Label millis3=new Label("millis3",model3);
		add(millis3);
		
		this.millis4=System.currentTimeMillis();
		IModel<Counter2WithModelsPage>model4=new CompoundPropertyModel<Counter2WithModelsPage>(this){
			public void detach() {
				super.detach();
				System.out.println("\nmodel4:"+this+".detach"+"\n");

			};
		
		};
		this.setDefaultModel(model4);
		Label millis4=new Label("millis4");
		add(millis4);
	}
}

/ 13	. 

/ we hebben	,
postgres (PostgreSQL) 9.3.5

$ vi pom.xml
		<dependency>
		    <groupId>org.postgresql</groupId>
		    <artifactId>postgresql</artifactId>
		    <version>9.3-1103-jdbc41</version>
		</dependency> 

$ vi Counter2WithDatabasePage.java
public class Counter2WithDatabasePage extends WebPage {
...
		Class.forName("org.postgresql.Driver");
		String url = "jdbc:postgresql://localhost/foo?user=foo&password=foo";
		Connection con = DriverManager.getConnection(url);
		con.setAutoCommit(false);
		final Statement stmt = con.createStatement();

		IModel<Long> model5 = new LoadableDetachableModel<Long>() {
			@Override
			protected Long load() {
				try {
					String sql = "select i from x";
					ResultSet rs = stmt.executeQuery(sql);
					if (rs.next())
						return rs.getLong(1);
				} catch (Exception e) {
					System.out.println(e);
				}
				return null;
			}
		};
		Label i5 = new Label("i5", model5);
		add(i5);

$ vi Counter2WithDatabasePage.html
<span wicket:id="i5">[Label]</span>

/we krijgen ser ERRs	, omdat een final een soort field is en Statement niet ser is	,

/ 13	. 

/ we kunnen een aparte method maken	, 

$ vi Counter2WithDatabasePage.java

	public Counter2WithDatabasePage() throws Exception {
			@Override
			protected Long load() {
				try {
->					Statement stmt=createStatement();
					String sql = "select i from x";
					ResultSet rs = stmt.executeQuery(sql);
					if (rs.next())
						return rs.getLong(1);
				} catch (Exception e) {
					System.out.println(e);
				}
				return null;
			}
			@Override
			public void detach() {
				
				super.detach();
				System.out.println("\nmodel5: detach\n");
			}
		};
		Label i5 = new Label("i5", model5);
		add(i5);

	}
	
	private Statement createStatement()throws Exception{
		Class.forName("org.postgresql.Driver");
		String url = "jdbc:postgresql://localhost/foo?user=foo&password=foo";
		Connection con = DriverManager.getConnection(url);
		con.setAutoCommit(false);
		Statement stmt = con.createStatement();
		return stmt;

	}
}

/ Dan is het OK	,

/ 13	. 

/ Maar we kunnen ook stmt als field maken	,

public class Counter2WithDatabasePage extends WebPage {

	private  transient Statement stmt;

	public Counter2WithDatabasePage() throws Exception {

		this.stmt=createStatement();

		IModel<Long> model5 = new LoadableDetachableModel<Long>() {
			@Override
			protected Long load() {
				try {
//					Statement stmt=createStatement();
					String sql = "select i from x";
					ResultSet rs = stmt.executeQuery(sql);
					if (rs.next())
						return rs.getLong(1);
				} catch (Exception e) {
					System.out.println(e);
				}
				return null;
			}
			@Override
			public void detach() {
				
				super.detach();
				System.out.println("\nmodel5: detach\n");
			}
		};
		Label i5 = new Label("i5", model5);
		add(i5);

	}
	
	private Statement createStatement()throws Exception{
		Class.forName("org.postgresql.Driver");
		String url = "jdbc:postgresql://localhost/foo?user=foo&password=foo";
		Connection con = DriverManager.getConnection(url);
		con.setAutoCommit(false);
		Statement stmt = con.createStatement();
		return stmt;

	}

/ Dit is ook OK	, 
/ want	,
/ Als we in de url van de browser wisselen met wicket-book	, dan zien we dat steeds de ctor van Counter2WithDatabasePage   called	, 
/ niet deser	, 
/ TODO

/ Intermezzo

/ Als we wicket-testing open, en we click refresh, dan valt de debugger NIET in .getPage hieronder	,
/ TODO
/ Als we eerst wicket-testing doen, dan wicket-book, dan weer wicket-testing, en click dan op refresh, dan valt hij wel in .getPage	, 
/ TODO

/ we zien types	,

DefaultPageStore
	DefaultPageStore$SerializedPage
	DefaultPageStore$SerializedPagesCache
|
AbstractCachingPageStore
		protected final SecondLevelPageCache<String, Integer, P> pagesCache;
|
AbstractPageStore
	protected final IDataStore dataStore;
	protected final ISerializer pageSerializer;

/ we komen in	,
DefaultPageStore(AbstractCachingPageStore<P>).getPage(String, int) line: 58	
this	DefaultPageStore  (id=69)	
	dataStore	AsynchronousDataStore  (id=210)	
	pagesCache	DefaultPageStore$SerializedPagesCache  (id=199)	
	pageSerializer	JavaSerializer  (id=213)	
sessionId	"65CA1C3DDBAA6EF1777A9F11A9EFD5C6" (id=178)	
pageId	0	

/ Meer detail	,

this	DefaultPageStore  (id=69)	
	dataStore	AsynchronousDataStore  (id=210)	
		dataStore	DiskDataStore  (id=224)	
			applicationName	"wicket-testing" (id=240)	
			fileStoreFolder	File  (id=250)	
			maxSizePerPageSession	Bytes  (id=252)	
			sessionEntryMap	ConcurrentHashMap<K,V>  (id=254)	
		entries	LinkedBlockingQueue<E>  (id=226)	
		entryMap	ConcurrentHashMap<K,V>  (id=229)	
		pageSavingThread	Thread  (id=6)	
	pagesCache	DefaultPageStore$SerializedPagesCache  (id=199)	
		cache	ConcurrentLinkedDeque<E>  (id=203)	
		maxSize	0	
	pageSerializer	JavaSerializer  (id=213)	
		applicationKey	"wicket-testing" (id=240)	
sessionId	"65CA1C3DDBAA6EF1777A9F11A9EFD5C6" (id=178)	
pageId	0	


/ Einde Intermezzo

/ REFRESH 

/ 7	. 

/ we click op refresh link	,
/ stack trace	,
/s
	DefaultPageStore(AbstractCachingPageStore<P>).getPage(String, int) line: 58	
		P fromCache = pagesCache.getPage(sessionId, pageId);

	PageStoreManager$SessionEntry.getPage(int) line: 203	
			// not found, ask pagestore for the page
			return getPageStore().getPage(sessionId, id);

	PageStoreManager$PersistentRequestAdapter.getPage(int) line: 357	
			if (entry != null)
			{
				return entry.getPage(id);

	PageStoreManager(AbstractPageManager).getPage(int) line: 82	
		IManageablePage page = getRequestAdapter().getPage(id);

	PageAccessSynchronizer$2(PageManagerDecorator).getPage(int) line: 50	
		return delegate.getPage(id);

	PageAccessSynchronizer$2.getPage(int) line: 246	
					page = super.getPage(pageId);

	DefaultMapperContext.getPageInstance(int) line: 113	
		IManageablePage manageablePage = Session.get().getPageManager().getPage(pageId);

	PageAndComponentProvider(PageProvider).getStoredPage(int) line: 296	
		IRequestablePage storedPageInstance = getPageSource().getPageInstance(pageId);

	PageAndComponentProvider(PageProvider).resolvePageInstance(Integer, Class<IRequestablePage>, PageParameters, Integer) line: 261	
			page = getStoredPage(pageId);

	PageAndComponentProvider(PageProvider).getPageInstance() line: 166	
			resolvePageInstance(pageId, pageClass, pageParameters, renderCount);

	ListenerInterfaceRequestHandler.getPage() line: 96	
		return pageComponentProvider.getPageInstance();

	ListenerInterfaceRequestHandler.respond(IRequestCycle) line: 157	
		final IRequestablePage page = getPage();

	RequestCycle$HandlerExecutor.respond(IRequestHandler) line: 837	
				handler.respond(RequestCycle.this);

	RequestCycle$HandlerExecutor(RequestHandlerStack).execute(IRequestHandler) line: 64	
			respond(handler);

	RequestCycle.execute(IRequestHandler) line: 265	
			requestHandlerExecutor.execute(handler);

	RequestCycle.processRequest() line: 222	
	RequestCycle.processRequestAndDetach() line: 293	
			result = processRequest();

	WicketFilter.processRequestCycle(RequestCycle, WebResponse, HttpServletRequest, HttpServletResponse, FilterChain) line: 261	
		if (!requestCycle.processRequestAndDetach())

	WicketFilter.processRequest(ServletRequest, ServletResponse, FilterChain) line: 203	
			if (redirectURL == null)
/ JA
			{
				// No redirect; process the request
				ThreadContext.setApplication(application);

				WebRequest webRequest = application.createWebRequest(httpServletRequest, filterPath);
				WebResponse webResponse = application.createWebResponse(webRequest,
					httpServletResponse);

				RequestCycle requestCycle = application.createRequestCycle(webRequest, webResponse);
				res = processRequestCycle(requestCycle, webResponse, httpServletRequest,
					httpServletResponse, chain);

	WicketFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 284	
		processRequest(request, response, chain);


/ WH centrale method	,
DefaultPageStore(AbstractCachingPageStore<P>).getPage(String, int) line: 69	
		P fromCache = pagesCache.getPage(sessionId, pageId);
		if (fromCache != null)
		{
			return convertToPage(fromCache);
		}

		byte[] data = getPageData(sessionId, pageId);
		if (data != null)
		{
			return deserializePage(data);
		}
		return null;
}

/ we debug	, 
/s
WicketFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 284	
		processRequest(request, response, chain);
/s
WicketFilter.processRequest(ServletRequest, ServletResponse, FilterChain) line: 203	
			if (redirectURL == null)
			{
				// No redirect; process the request
				ThreadContext.setApplication(application);

				WebRequest webRequest = application.createWebRequest(httpServletRequest, filterPath);
				WebResponse webResponse = application.createWebResponse(webRequest,
					httpServletResponse);

				RequestCycle requestCycle = application.createRequestCycle(webRequest, webResponse);
				res = processRequestCycle(requestCycle, webResponse, httpServletRequest,
					httpServletResponse, chain);
/s
WicketFilter.processRequestCycle(RequestCycle, WebResponse, HttpServletRequest, HttpServletResponse, FilterChain) line: 261	
		if (!requestCycle.processRequestAndDetach())
/s
RequestCycle.processRequestAndDetach() line: 293	
			result = processRequest();
/s
RequestCycle.processRequest() line: 216	
			set(this);
/s
		ThreadContext.setRequestCycle(requestCycle);
/t
			listeners.onBeginRequest(this);

listeners	RequestCycleListenerCollection  (id=8073)	
	listeners	CopyOnWriteArrayList<E>  (id=8081)	
		array	Object[2]  (id=8083)	
			[0]	RequestCycleListenerCollection  (id=554)	
			[1]	Application$3  (id=8086)	
/s
	public void onBeginRequest(final RequestCycle cycle)
	{
		notify(new INotifier<IRequestCycleListener>()
		{
			@Override
			public void notify(IRequestCycleListener listener)
			{
->				listener.onBeginRequest(cycle);
/ TODO

			onBeginRequest();
/ LEEG
			IRequestHandler handler = resolveRequestHandler();
handler	ListenerInterfaceRequestHandler  (id=8117)	
/ want	,
/s
		return requestMapper.mapRequest(request);
/t
				execute(handler);
/s
RequestCycle.execute(IRequestHandler) line: 265	
			requestHandlerExecutor.execute(handler);
/s
RequestCycle$HandlerExecutor(RequestHandlerStack).execute(IRequestHandler) line: 58	
this	RequestCycle$HandlerExecutor  (id=8079)	

		requestHandlers.add(handler);
handler	ListenerInterfaceRequestHandler  (id=8117)	

			respond(handler);
/s
RequestCycle$HandlerExecutor.respond(IRequestHandler) line: 834	
			Response originalResponse = getResponse();
			try
			{
				handler.respond(RequestCycle.this);
/s
ListenerInterfaceRequestHandler.respond(IRequestCycle) line: 157	
		final IRequestablePage page = getPage();
/s
ListenerInterfaceRequestHandler.getPage() line: 96	
		return pageComponentProvider.getPageInstance();

this	ListenerInterfaceRequestHandler  (id=8117)	
	listenerInterface	RequestListenerInterface  (id=6527)	
	pageComponentProvider	PageAndComponentProvider  (id=8130)	
PageProvider{renderCount=7, pageId=2, pageInstanceIsFresh=false, pageClass=class my.test.own.Counter2WithDatabasePage, pageParameters=null, pageInstance=null}
/s
PageAndComponentProvider(PageProvider).getPageInstance() line: 164	
	if (pageInstance == null)
/ JA
		{
			resolvePageInstance(pageId, pageClass, pageParameters, renderCount);
/s
PageAndComponentProvider(PageProvider).resolvePageInstance(Integer, Class<IRequestablePage>, PageParameters, Integer) line: 255	
		if (pageId != null)
		{
			page = getStoredPage(pageId);
/s
PageAndComponentProvider(PageProvider).getStoredPage(int) line: 296	
		IRequestablePage storedPageInstance = getPageSource().getPageInstance(pageId);
/s
PageAndComponentProvider(PageProvider).getPageSource() line: 237	
		if (pageSource != null)
		{
			return pageSource;

this	PageAndComponentProvider  (id=8130)	
	component	null	
	componentPath	"refresh" (id=8132)	
	pageClass	Class<T> (my.test.own.Counter2WithDatabasePage) (id=38)	
	pageId	Integer  (id=8142)	
2
	pageInstance	null	
	pageInstanceIsFresh	false	
	pageParameters	null	
	pageSource	DefaultMapperContext  (id=102)	
		application	WicketApplication  (id=331)	
	renderCount	Integer  (id=8147)	
7
/t
PageAndComponentProvider(PageProvider).getStoredPage(int) line: 296	
		IRequestablePage storedPageInstance = getPageSource().getPageInstance(pageId);
/s
DefaultMapperContext.getPageInstance(int) line: 113	
		IManageablePage manageablePage = Session.get().getPageManager().getPage(pageId);
/s
Session.get() line: 165	
		Session session = ThreadContext.getSession();
			return session;
session	WebSession  (id=8170)	
	clientInfo	null	
	dirty	false	
	feedbackMessages	FeedbackMessages  (id=8172)	
	id	"B1150C8000BA8891BD03369887F9F7B1" (id=8173)	
	locale	AtomicReference<V>  (id=8174)	
	metaData	null	
	pageAccessSynchronizer	Session$PageAccessSynchronizerProvider  (id=8175)	
	pageId	AtomicInteger  (id=8176)	
3
/ TODO
	sequence	AtomicInteger  (id=8177)	
	sessionInvalidated	false	
	sessionStore	HttpSessionStore  (id=481)	
	style	AtomicReference<V>  (id=8180)	
	temporarySessionAttributes	null	
/t
/s
WebSession(Session).getPageManager() line: 895	
		IPageManager pageManager = Application.get().internalGetPageManager();
pageManager	PageStoreManager  (id=72)	
	applicationName	"wicket-testing" (id=240)	
	context	DefaultPageManagerContext  (id=309)	
	pageStore	DefaultPageStore  (id=69)	

		return pageAccessSynchronizer.get().adapt(pageManager);
/s
PageAccessSynchronizer.adapt(IPageManager) line: 237	
		return new PageManagerDecorator(pagemanager)
		{
			@Override
			public IManageablePage getPage(int pageId)
			@Override
			public void touchPage(IManageablePage page)
			@Override
			public void commitRequest()
/t
DefaultMapperContext.getPageInstance(int) line: 113	
		IManageablePage manageablePage = Session.get().getPageManager().getPage(pageId);
/s
PageAccessSynchronizer$2.getPage(int) line: 242	
/=
	public IPageManager adapt(IPageManager pagemanager)
	{
		return new PageManagerDecorator(pagemanager)
		{
			@Override
			public IManageablePage getPage(int pageId)
			{
					lockPage(pageId);
2
					page = super.getPage(pageId);
/s
PageAccessSynchronizer$2(PageManagerDecorator).getPage(int) line: 50	
		return delegate.getPage(id);
/s
PageStoreManager(AbstractPageManager).getPage(int) line: 82	
		IManageablePage page = getRequestAdapter().getPage(id);
/s
PageStoreManager(AbstractPageManager).getRequestAdapter() line: 64	
		RequestAdapter adapter = (RequestAdapter)getContext().getRequestData();
null
/ want	,
/s
DefaultPageManagerContext.getRequestData() line: 52	

/ Intermezzo

public class DefaultPageManagerContext implements IPageManagerContext
	private static final MetaDataKey<Object> requestCycleMetaDataKey = new MetaDataKey<Object>()

/ Einde Intermezzo

		if (requestCycle == null)
		return requestCycle.getMetaData(requestCycleMetaDataKey);
/s
RequestCycle.getMetaData(MetaDataKey<T>) line: 416	
		return key.get(metaData);
this RequestCycle
	metaData==null
/t
PageStoreManager(AbstractPageManager).getRequestAdapter() line: 65	
		RequestAdapter adapter = (RequestAdapter)getContext().getRequestData();
null
		if (adapter == null)
		{
			adapter = newRequestAdapter(getContext());
/s
PageStoreManager.newRequestAdapter(IPageManagerContext) line: 412	
		return new PersistentRequestAdapter(context);
context	DefaultPageManagerContext  (id=309)	
/t
PageStoreManager(AbstractPageManager).getRequestAdapter() line: 68	
			adapter = newRequestAdapter(getContext());
/d
this	PageStoreManager  (id=72)	
adapter	PageStoreManager$PersistentRequestAdapter  (id=8226)	
	context	DefaultPageManagerContext  (id=309)	
	this$0	PageStoreManager  (id=72)	
	touchedPages	ArrayList<E>  (id=8227)	

			getContext().setRequestData(adapter);
/s
		requestCycle.setMetaData(requestCycleMetaDataKey, data);

	private static final MetaDataKey<Object> requestCycleMetaDataKey = new MetaDataKey<Object>()
data	PageStoreManager$PersistentRequestAdapter  (id=8226)	
	context	DefaultPageManagerContext  (id=309)	
	this$0	PageStoreManager  (id=72)	
	touchedPages	ArrayList<E>  (id=8227)	

/t
PageStoreManager(AbstractPageManager).getRequestAdapter() line: 70	
			getContext().setRequestData(adapter);
/d
		return adapter;
/t
PageStoreManager(AbstractPageManager).getPage(int) line: 82	
		IManageablePage page = getRequestAdapter().getPage(id);
/s
PageStoreManager$PersistentRequestAdapter.getPage(int) line: 346	
			IManageablePage touchedPage = findPage(id);
id=2
null
/ want touchedPages=[]
/ TODO
			// try to get session entry for this session
			SessionEntry entry = getSessionEntry(false);
/s
PageStoreManager$PersistentRequestAdapter.getSessionEntry(boolean) line: 372	
			String attributeName = getAttributeName();
/s
PageStoreManager.getAttributeName() line: 323	
		return ATTRIBUTE_NAME + " - " + applicationName;
wicket:persistentPageManagerData - wicket-testing
/want	,
this	org.apache.wicket.page.PageStoreManager  (id=72)	
	ATTRIBUTE_NAME	"wicket:persistentPageManagerData" (id=8251)	
	MANAGERS	java.util.concurrent.ConcurrentHashMap<K,V>  (id=8253)	
	applicationName	"wicket-testing" (id=240)	
	context	org.apache.wicket.page.DefaultPageManagerContext  (id=309)	
	pageStore	org.apache.wicket.pageStore.DefaultPageStore  (id=69)	
/t
PageStoreManager$PersistentRequestAdapter.getSessionEntry(boolean) line: 373	
			SessionEntry entry = (SessionEntry)getSessionAttribute(attributeName);
/s
				return getSessionStore().getAttribute(cycle.getRequest(), name);
name	"wicket:persistentPageManagerData - wicket-testing" (id=8269)	
null
/t
			if (entry == null && create)
/ NEE
			return entry;
null
/t
PageStoreManager$PersistentRequestAdapter.getPage(int) line: 361	
			SessionEntry entry = getSessionEntry(false);
null
				return null;
...
/t
DefaultMapperContext.getPageInstance(int) line: 114	
		IManageablePage manageablePage = Session.get().getPageManager().getPage(pageId);
/d
null
/t
PageAndComponentProvider(PageProvider).getStoredPage(int) line: 297	
		IRequestablePage storedPageInstance = getPageSource().getPageInstance(pageId);
null
/s
PageAndComponentProvider(PageProvider).resolvePageInstance(Integer, Class<IRequestablePage>, PageParameters, Integer) line: 264	
		if (pageId != null)
2
		{
			page = getStoredPage(pageId);

...

/ Geef cont	,
	PageStoreManager$PersistentRequestAdapter.getPage(int) line: 355	
	PageStoreManager(AbstractPageManager).getPage(int) line: 82	
	PageAccessSynchronizer$2(PageManagerDecorator).getPage(int) line: 50	
	PageAccessSynchronizer$2.getPage(int) line: 246	
	DefaultMapperContext.getPageInstance(int) line: 113	
	PageProvider.getStoredPage(int) line: 296	
	PageProvider.isNewPageInstance() line: 208	
	HomePageMapper(AbstractBookmarkableMapper).processHybrid(PageInfo, Class<IRequestablePage>, PageParameters, Integer) line: 261	
	HomePageMapper(AbstractBookmarkableMapper).mapRequest(Request) line: 365	
	SystemMapper(CompoundRequestMapper).mapRequest(Request) line: 150	
	RequestCycle.resolveRequestHandler() line: 189	
	RequestCycle.processRequest() line: 219	
	RequestCycle.processRequestAndDetach() line: 293	
	WicketFilter.processRequestCycle(RequestCycle, WebResponse, HttpServletRequest, HttpServletResponse, FilterChain) line: 261	
	WicketFilter.processRequest(ServletRequest, ServletResponse, FilterChain) line: 203	
	WicketFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 284	
/ we zijn in 	,
		protected IManageablePage getPage(int id)
		{
			IManageablePage touchedPage = findPage(id);
null
			// try to get session entry for this session
			SessionEntry entry = getSessionEntry(false);
/ komt uit Tomcat session	, 
key=wicket:persistentPageManagerData - wicket-testing
this	PageStoreManager$PersistentRequestAdapter  (id=8311)	

entry	PageStoreManager$SessionEntry  (id=8314)	
	applicationName	"wicket-testing" (id=240)	
	sessionCache	ArrayList<E>  (id=8321)	
		elementData	Object[1]  (id=8327)	
			[0]	Counter2WithDatabasePage  (id=8279)	
				autoIndex	1	
				children	MarkupContainer$ChildList  (id=8360)	
				counter	0	
				data	CompoundPropertyModel<T>  (id=8287)	
				flags	1075523738	
				generatedMarkupId	-1	
				id	null	
				link	"Foo Bar" (id=6478)	
				markup	null	
				markupSourcingStrategy	DefaultMarkupSourcingStrategy  (id=7224)	
				millis2	1441640988468	
				millis3	1441640988469	
				millis4	1441640988470	
				numericId	3	
				pageParameters	PageParameters  (id=8369)	
				parent	null	
				queue	null	
				renderCount	1	
				renderedComponents	null	
				requestFlags	32	
				stateless	Boolean  (id=6511)	
				stmt	Jdbc4Statement  (id=8375)	
				text	"Link" (id=6481)	
		modCount	0	
		size	1	
	sessionId	"1A69D9BB46A0282DFDB6D4920F6A5E79" (id=8308)	

				return entry.getPage(id);
id=3
/s
PageStoreManager$SessionEntry.getPage(int) line: 195	
			// try to find page with same id
			if (sessionCache != null)
			{
				IManageablePage page = findPage(id);
/s
PageStoreManager$SessionEntry.findPage(int) line: 135	
			for (IManageablePage p : sessionCache)
			{
				if (p.getPageId() == id)
/ .getPageId()=numericId	,
...
/t
PageStoreManager(AbstractPageManager).getPage(int) line: 85	
		IManageablePage page = getRequestAdapter().getPage(id);
		if (page != null)
		{
			touchPage(page);
/s
		getRequestAdapter().touch(page);
...
/s
			touchedPages.add(page);

...
/t
PageProvider.class
	private IRequestablePage getStoredPage(final int pageId)
		IRequestablePage storedPageInstance = getPageSource().getPageInstance(pageId);
/d

/ 7	.

/ we click Refresh button	, 

/ 13	. 

...
/s
RequestCycle.processRequest() line: 219	
			listeners.onBeginRequest(this);
this	org.apache.wicket.request.cycle.RequestCycle  (id=5867)	
	listeners	org.apache.wicket.request.cycle.RequestCycleListenerCollection  (id=5872)	
		listeners	java.util.concurrent.CopyOnWriteArrayList<E>  (id=5878)	
			array	java.lang.Object[2]  (id=5880)	
				[0]	org.apache.wicket.request.cycle.RequestCycleListenerCollection  (id=5883)	
/ [...Logger...]
/ TODO
				[1]	org.apache.wicket.Application$3  (id=5884)	

/ See	,
public abstract class Application implements UnboundListener, IEventSink{
	public final RequestCycle createRequestCycle(final Request request, final Response response){
		requestCycle.getListeners().add(requestCycleListeners);
		requestCycle.getListeners().add(new AbstractRequestCycleListener(){		/ Application$3	,
			@Override
			public void onDetach(final RequestCycle requestCycle)
	}

/ 13	. 
...
/s
RequestCycle.resolveRequestHandler() line: 189	
		return requestMapper.mapRequest(request);

/ Deze call gaat .getPage doen	,

...
/s
PageStoreManager$PersistentRequestAdapter.getSessionEntry(boolean) line: 380	
			SessionEntry entry = (SessionEntry)getSessionAttribute(attributeName);
this	org.apache.wicket.page.PageStoreManager$PersistentRequestAdapter  (id=5937)	
create	false	
attributeName	"wicket:persistentPageManagerData - wicket-testing" (id=5941)	
entry	org.apache.wicket.page.PageStoreManager$SessionEntry  (id=5946)	
	afterReadObject	null	
	applicationName	"wicket-testing" (id=5947)	
	sessionCache	java.util.ArrayList<E>  (id=5948)	
		elementData	java.lang.Object[1]  (id=5950)	
			[0]	my.test.own.Counter2WithDatabasePage  (id=5951)	
				autoIndex	4	
				children	org.apache.wicket.MarkupContainer$ChildList  (id=5952)	
				counter	0	
				data	org.apache.wicket.model.CompoundPropertyModel<T>  (id=5953)	
				flags	1075523738	
				generatedMarkupId	-1	
				id	null	
				link	"Foo Bar" (id=5954)	
				markup	null	
				markupSourcingStrategy	org.apache.wicket.markup.html.panel.DefaultMarkupSourcingStrategy  (id=5955)	
				millis2	1441691910468	
				millis3	1441691910468	
				millis4	1441691910468	
				numericId	2	
				pageParameters	org.apache.wicket.request.mapper.parameter.PageParameters  (id=5956)	
				parent	null	
				queue	null	
				renderCount	4	
				renderedComponents	null	
				requestFlags	32	
				stateless	java.lang.Boolean  (id=6004)	
				stmt	org.postgresql.jdbc4.Jdbc4Statement  (id=6005)	
				text	"Link" (id=6006)	
		modCount	0	
		size	1	
	sessionId	"3B31A5E08DA69B3D40328CC802007B5B" (id=5949)	

/ Deze numericId=2 klopt	, in de url staat	, en we clicked 'Refresh"	,
http://localhost:9090/wicket-testing/?2

/ 13	. 

/ Daarna
...
/s
PageStoreManager(AbstractPageManager).getPage(int) line: 85	
			touchPage(page);

/ HIER HIER HIER



/ 7	. 
 
DefaultPageStore(AbstractCachingPageStore<P>).getPage(String, int) line: 58	
		P fromCache = pagesCache.getPage(sessionId, pageId);

this	DefaultPageStore  (id=154)	
	dataStore	AsynchronousDataStore  (id=2543)	
	pagesCache	DefaultPageStore$SerializedPagesCache  (id=2540)	
	pageSerializer	JavaSerializer  (id=163)	
sessionId	"F0C126CA6364B4C9B20D7F5BEB4CB09B" (id=298)	
pageId	7	

/ we gaan eerst pagesCache proberen	, daarna dataStore	,

/s
DefaultPageStore$SerializedPagesCache.getPage(String, Integer) line: 389	
			IManageablePage result = null;

			if (maxEntriesPerSession > 0)
/ NEE
			return result;
/t
DefaultPageStore(AbstractCachingPageStore<P>).getPage(String, int) line: 64	
		P fromCache = pagesCache.getPage(sessionId, pageId);
null
		byte[] data = getPageData(sessionId, pageId);
/s
DefaultPageStore(AbstractPageStore).getPageData(String, int) line: 83	
		return dataStore.getData(sessionId, pageId);
/s
AsynchronousDataStore.getData(String, int) line: 139	

this	AsynchronousDataStore  (id=2543)	
	dataStore	DiskDataStore  (id=2582)	
	entries	LinkedBlockingQueue<E>  (id=2583)	
	entryMap	ConcurrentHashMap<K,V>  (id=2584)	
	pageSavingThread	Thread  (id=99)	
sessionId	"F0C126CA6364B4C9B20D7F5BEB4CB09B" (id=298)	
id	7	

		Entry entry = getEntry(sessionId, id);
/s
		return entryMap.get(getKey(sessionId, id));
/t
null
		byte[] data = dataStore.getData(sessionId, id);
null
/ want	,
/s
DiskDataStore.getData(String, int) line: 116	
		SessionEntry sessionEntry = getSessionEntry(sessionId, false);
/s
DiskDataStore.getSessionEntry(String, boolean) line: 200	
			return sessionEntryMap.get(sessionId);
/t
null
/t
DefaultPageStore(AbstractCachingPageStore<P>).getPage(String, int) line: 65	
		byte[] data = getPageData(sessionId, pageId);
null
		return data;
null
/t
DefaultPageStore(AbstractCachingPageStore<P>).getPage(String, int) line: 65	
		byte[] data = getPageData(sessionId, pageId);
null
	return null
/t
PageStoreManager$SessionEntry.getPage(int) line: 203	
			// not found, ask pagestore for the page
			return getPageStore().getPage(sessionId, id);
/d
null
/t
PageStoreManager$PersistentRequestAdapter.getPage(int) line: 357	
			// try to get session entry for this session
			SessionEntry entry = getSessionEntry(false);

			if (entry != null)
			{
				return entry.getPage(id);
/d
null
/t
PageStoreManager(AbstractPageManager).getPage(int) line: 83	
		IManageablePage page = getRequestAdapter().getPage(id);
null
		return page;
null
...
/t
PageAndComponentProvider(PageProvider).resolvePageInstance(Integer, Class<IRequestablePage>, PageParameters, Integer) line: 268	
		if (pageId != null)
		{
			page = getStoredPage(pageId);
null
		if (page == null)
		{
			if (pageClass != null)
			{
				page = getPageSource().newPageInstance(pageClass, pageParameters);
this
	pageSource	DefaultMapperContext  (id=102)	
/s
DefaultMapperContext.newPageInstance(Class<IRequestablePage>, PageParameters) line: 102	
		if (pageParameters == null)
		{
			return application.getPageFactory().newPage(pageClass);
this	DefaultMapperContext  (id=102)	
	application	WicketApplication  (id=331)	
/s
DefaultPageFactory.newPage(Class<C>) line: 65	
			Constructor<C> constructor = pageClass.getDeclaredConstructor((Class<?>[]) null);
public my.test.own.Counter2WithDatabasePage() throws java.lang.Exception
			return processPage(newPage(constructor, null), null);
/s
DefaultPageFactory.newPage(Constructor<C>, PageParameters) line: 169	
				return constructor.newInstance();
/t
DefaultPageFactory.newPage(Class<C>) line: 67	
			return processPage(newPage(constructor, null), null);
/s
		((Page)page).setWasCreatedBookmarkable(true);
		return page
...
/t
PageAndComponentProvider(PageProvider).resolvePageInstance(Integer, Class<IRequestablePage>, PageParameters, Integer) line: 269	
				page = getPageSource().newPageInstance(pageClass, pageParameters);
/d
page	Counter2WithDatabasePage  (id=383)	
				freshCreated = true;
this.		pageInstanceIsFresh = freshCreated;
this.		pageInstance = page;
...
/t
ListenerInterfaceRequestHandler.respond(IRequestCycle) line: 158	
		final IRequestablePage page = getPage();
/d
			component = getComponent();
[Link [Component id = refresh]]
		if (page instanceof Page)
		{
			// initialize the page to be able to check whether it is stateless
			((Page)page).internalInitialize();
/s
Counter2WithDatabasePage(MarkupContainer).internalInitialize() line: 981	
		super.fireInitialize();
/s
Counter2WithDatabasePage(Component).fireInitialize() line: 875	
		if (!getFlag(FLAG_INITIALIZED))
/ JA
		{
			setFlag(FLAG_INITIALIZED, true);
			setRequestFlag(RFLAG_INITIALIZE_SUPER_CALL_VERIFIED, false);
/ TODO
			onInitialize();
/s
Counter2WithDatabasePage(Page).onInitialize() line: 299	
...
/s
Counter2WithDatabasePage(Component).onInitialize() line: 845	
		setRequestFlag(RFLAG_INITIALIZE_SUPER_CALL_VERIFIED, true);
/t
Counter2WithDatabasePage(MarkupContainer).onInitialize() line: 1507	
		super.onInitialize();
/d
		dequeueAutoComponents();
/ TODO
/t
ounter2WithDatabasePage(Page).onInitialize() line: 301	
		super.onInitialize();
/d
		final IPageManager pageManager = getSession().getPageManager();
/s
WebSession(Session).getPageManager() line: 895	
		IPageManager pageManager = Application.get().internalGetPageManager();
		return pageAccessSynchronizer.get().adapt(pageManager);
this	WebSession  (id=469)	
	pageAccessSynchronizer	Session$PageAccessSynchronizerProvider  (id=475)	
/s
PageAccessSynchronizer.adapt(IPageManager) line: 237	
		return new PageManagerDecorator(pagemanager)
/t
Counter2WithDatabasePage(Page).onInitialize() line: 302	
		final IPageManager pageManager = getSession().getPageManager();
/d
		pageManager.touchPage(this);
/s
PageAccessSynchronizer$2.touchPage(IManageablePage) line: 261	
/=
	public IPageManager adapt(IPageManager pagemanager) {
		return new PageManagerDecorator(pagemanager) {
			...
			@Override
			public void touchPage(IManageablePage page) {
page	Counter2WithDatabasePage  (id=383)	
				lockPage(page.getPageId());
/s
/ page.getPageId()=return numericId;
3
/t
PageAccessSynchronizer$2.touchPage(IManageablePage) line: 262	
				lockPage(page.getPageId());
/d
				super.touchPage(page);
/s
PageAccessSynchronizer$2(PageManagerDecorator).touchPage(IManageablePage) line: 56	
		delegate.touchPage(page);
/s
PageStoreManager(AbstractPageManager).touchPage(IManageablePage) line: 99	
		getRequestAdapter().touch(page);
/s
PageStoreManager$PersistentRequestAdapter(RequestAdapter).touch(IManageablePage) line: 138	
			touchedPages.add(page);
...
/t
Counter2WithDatabasePage(Component).fireInitialize() line: 878	
			onInitialize();
/d
			setRequestFlag(RFLAG_INITIALIZE_SUPER_CALL_VERIFIED, false);
			getApplication().getComponentInitializationListeners().onInitialize(this);
/ TODO
/t
Counter2WithDatabasePage(MarkupContainer).internalInitialize() line: 982	
		super.fireInitialize();
/d
		visitChildren(new IVisitor<Component, Void>()
		{
			@Override
			public void component(final Component component, final IVisit<Void> visit)
			{
				component.fireInitialize();
			}
		});
/ TODO
/t
ListenerInterfaceRequestHandler.respond(IRequestCycle) line: 186	
			((Page)page).internalInitialize();
/d
		final boolean isStateless = page.isPageStateless();
/s
Counter2WithDatabasePage(Page).isPageStateless() line: 448	
		if (isBookmarkable() == false)
/s
Counter2WithDatabasePage(Page).isBookmarkable() line: 411	
		return getApplication().getPageFactory().isBookmarkable(getClass());
/s
DefaultPageFactory.isBookmarkable(Class<C>) line: 245	
		Boolean bookmarkable = pageToBookmarkableCache.get(pageClass.getName());
true
/ want	,
this	DefaultPageFactory  (id=101)	
	pageToBookmarkableCache	ConcurrentHashMap<K,V>  (id=372)	
{my.test.own.Counter2WithDatabasePage=true}

		return bookmarkable;
/t
Counter2WithDatabasePage(Page).isPageStateless() line: 458	
		if (isBookmarkable() == false)
/ NEE
		if (getStatelessHint() == false)
/ NEE
/ want	,
/=
		return getFlag(FLAG_STATELESS_HINT);
/t
		if (stateless == null)
		{
			internalInitialize();

		if (stateless == null)
		{
			Component statefulComponent = visitChildren(Component.class,
				new IVisitor<Component, Component>()
				{
					@Override
					public void component(final Component component, final IVisit<Component> visit)
					{
						if (!component.isStateless())
						{
							visit.stop(component);
						}
					}
				});
[Link [Component id = refresh]]
/ TODO STATEFULL STATELESS

			stateless = statefulComponent == null;
false
		RedirectPolicy policy = isStateless
			? RedirectPolicy.NEVER_REDIRECT
->			: RedirectPolicy.AUTO_REDIRECT;
		final IPageProvider pageProvider = new PageProvider(page);
/s
PageProvider.<init>(IRequestablePage) line: 155	
		pageInstance = page;
		pageId = page.getPageId();
3
		renderCount = page.getRenderCount();
0
/t
			requestCycle.scheduleRequestHandlerAfterCurrent(new RenderPageRequestHandler(
				pageProvider, policy));
/ TODO
			return;
/t
RequestCycle$HandlerExecutor.respond(IRequestHandler) line: 841	
				handler.respond(RequestCycle.this);
d
			finally
			{
				setResponse(originalResponse);
originalResponse	HeaderBufferingWebResponse  (id=6525)	
/ sets	,
this	RequestCycle  (id=196)	
	activeResponse	HeaderBufferingWebResponse  (id=6525)	
...
		else if (scheduled != null)
		{
			execute(scheduled);
scheduled	RenderPageRequestHandler  (id=6553)	

/ Intermezzo

/ we zijn in	,
/ stacktrace	,

	RequestCycle$HandlerExecutor(RequestHandlerStack).execute(IRequestHandler) line: 58	
/ Zijn we nu	, see hieronder	,

	RequestCycle$HandlerExecutor(RequestHandlerStack).execute(IRequestHandler) line: 97	
			respond(handler);
			...
			execute(scheduled);

	RequestCycle.execute(IRequestHandler) line: 265	
			requestHandlerExecutor.execute(handler);

	RequestCycle.processRequest() line: 222	
			IRequestHandler handler = resolveRequestHandler();
handler	ListenerInterfaceRequestHandler  (id=194)	
				execute(handler);

	RequestCycle.processRequestAndDetach() line: 293	
->			result = processRequest();
		}
		finally
		{
			detach();

	WicketFilter.processRequestCycle(RequestCycle, WebResponse, HttpServletRequest, HttpServletResponse, FilterChain) line: 261	
		if (!requestCycle.processRequestAndDetach())

	WicketFilter.processRequest(ServletRequest, ServletResponse, FilterChain) line: 203	
			if (redirectURL == null)
			{
				ThreadContext.setApplication(application);

				WebRequest webRequest = application.createWebRequest(httpServletRequest, filterPath);
				WebResponse webResponse = application.createWebResponse(webRequest,
					httpServletResponse);

				RequestCycle requestCycle = application.createRequestCycle(webRequest, webResponse);
				res = processRequestCycle(requestCycle, webResponse, httpServletRequest,
					httpServletResponse, chain);

	WicketFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 284	
		processRequest(request, response, chain);

/ Einde Intermezzo

/ we gaan verder debug	,
RequestCycle$HandlerExecutor(RequestHandlerStack).execute(IRequestHandler) line: 59	
		final boolean first = requestHandlers.isEmpty();
		requestHandlers.add(handler);
handler	RenderPageRequestHandler  (id=6553)	
			respond(handler);
/ we geven confinue	,
/ TODO
		if (replacementHandler != null)
/ NEE
		else if (scheduled != null)
/ NEE
...
/t
RequestCycle.processRequestAndDetach() line: 297	
			result = processRequest();
/d
true
		}
		finally
		{
			detach();
/s
RequestCycle.detach() line: 594	
			onDetach();
/s
RequestCycle.onDetach() line: 641	
			requestHandlerExecutor.detach();
/s
RequestCycle$HandlerExecutor(RequestHandlerStack).detach() line: 167	
		for (IRequestHandler handler : inactiveRequestHandlers)
		{
			try
			{
				detach(handler);
/s
RequestCycle$HandlerExecutor.detach(IRequestHandler) line: 848	
/=
public class RequestCycle implements IRequestCycle, IEventSink
	private class HandlerExecutor extends RequestHandlerStack
	{
		@Override
		protected void detach(IRequestHandler handler)
		{
			handler.detach(RequestCycle.this);
/s
ListenerInterfaceRequestHandler.detach(IRequestCycle) line: 123	
		pageComponentProvider.detach();
/s
PageAndComponentProvider(PageProvider).detach() line: 327	
		if (pageInstance != null)
pageInstance	Counter2WithDatabasePage  (id=383)	
		{
			pageInstance.detach();
/s
Counter2WithDatabasePage(Component).detach() line: 1159	
this	Counter2WithDatabasePage  (id=383)	

		setFlag(FLAG_DETACHING, true);
		onDetach();
/s
Counter2WithDatabasePage(Page).onDetach() line: 861	
		setFlag(FLAG_IS_DIRTY, false);
		super.onDetach();
/s
Counter2WithDatabasePage(MarkupContainer).onDetach() line: 1932	
		super.onDetach();
/s
Counter2WithDatabasePage(Component).onDetach() line: 3931	
		setFlag(FLAG_DETACHING, false);
/t
Counter2WithDatabasePage(MarkupContainer).onDetach() line: 1940	
		super.onDetach();
/d
		queue = null;
/t
Counter2WithDatabasePage(Page).onDetach() line: 869	
		super.onDetach();
/d
/t
Counter2WithDatabasePage(Component).detach() line: 1161	
		onDetach();
/d
		detachModels();
/s
Counter2WithDatabasePage(Page).detachModels() line: 228	
		super.detachModels();
/s
Counter2WithDatabasePage(Component).detachModels() line: 1255	
		// Detach any detachable model from this component
		detachModel();
/s
Counter2WithDatabasePage(Component).detachModel() line: 3625	
		IModel<?> model = getModelImpl();
/s
Counter2WithDatabasePage(Component).getModelImpl() line: 3010	
		if (getFlag(FLAG_MODEL_SET))
		{
			return (IModel<?>)data_get(0);
/s
Counter2WithDatabasePage(Component).data_get(int) line: 534	
			return data;
data	CompoundPropertyModel<T>  (id=391)	
	target	Counter2WithDatabasePage  (id=383)	
/t
Counter2WithDatabasePage(Component).detachModel() line: 3628	
		IModel<?> model = getModelImpl();
/d
			model.detach();
/s
CompoundPropertyModel<T>(ChainingModel<T>).detach() line: 63	
this	CompoundPropertyModel<T>  (id=391)	

		// Detach nested object if it's a detachable
		if (target instanceof IDetachable)
/ NEE
		{
			((IDetachable)target).detach();
/ NIET
/ TODO
...
/t
Counter2WithDatabasePage(Component).detach() line: 1175	
		detachModels();
/d
		// detach any behaviors
		new Behaviors(this).detach();
/s
Behaviors.detach() line: 145	
/ NIETS
/t
		// always detach children because components can be attached
		// independently of their parents
		detachChildren();
/s
Counter2WithDatabasePage(MarkupContainer).detachChildren() line: 1645	
		super.detachChildren();
/=Component.detachChildren	, is LEEG	,
		for (int i = children_size(); i-- > 0;)
		{
			Object child = children_get(i, false);
child	HtmlHeaderContainer  (id=7250)	
			if (child instanceof Component)
			{
				Component component = (Component)child;
				component.detach();
/s
HtmlHeaderContainer(Component).detach() line: 1159	

/ recursive call

		setFlag(FLAG_DETACHING, true);
		onDetach();
/s
HtmlHeaderContainer.onDetach() line: 321	
		super.onDetach();
/ sets
		setFlag(FLAG_DETACHING, false);

		renderedComponentsPerScope = null;
		headerResponse = null;
/t
HtmlHeaderContainer(Component).detach() line: 1159	
		onDetach();
/d
		detachModels();
/ model=null, dus NIETS	,
		detachChildren();
/ GEEN children	,
		if (getFlag(FLAG_INHERITABLE_MODEL))
/ NEE
		clearEnabledInHierarchyCache();
/s
			setRequestFlag(RFLAG_ENABLED_IN_HIERARCHY_SET, false);
/t
		clearVisibleInHierarchyCache();
/s
			setRequestFlag(RFLAG_VISIBLE_IN_HIERARCHY_SET, false);
/t
		detachFeedback();
/ NIETS	,
		internalDetach();
/s
HtmlHeaderContainer(Component).internalDetach() line: 1246	
	/**
	 * Removes the cached markup at the end of the request. For the next request it will be get
	 * either from the parent's markup or from {@link MarkupCache}.
	 */
	private void internalDetach()
	{
		markup = null;
...
/t
Counter2WithDatabasePage(MarkupContainer).detachChildren() line: 1649	
this	Counter2WithDatabasePage  (id=383)	

/ volgende child	,

		for (int i = children_size(); i-- > 0;)
		{
			Object child = children_get(i, false);
child	Label  (id=7263)	
			if (child instanceof Component)
			{
				Component component = (Component)child;
				component.detach();
/s
Label(Component).detach() line: 1172	
		...
		detachModels();
/s
Label(Component).detachModels() line: 1255	
		detachModel();
/s
Label(Component).detachModel() line: 3626	

	data	Counter2WithDatabasePage$3  (id=7268)	
		attached	true	
		this$0	Counter2WithDatabasePage  (id=383)	
		transientModelObject	Long  (id=7273)	
	id	"i5" (id=7270)	


		IModel<?> model = getModelImpl();
model	Counter2WithDatabasePage$3  (id=7268)	
			model.detach();
/ model=my.test.own.Counter2WithDatabasePage$3@686722cb:attached=true:tempModelObject=[7]

/ Intermezzo

/ 7	. 

		IModel<Long> model5 = new LoadableDetachableModel<Long>() {
			@Override
			protected Long load() {
				try {
//					Statement stmt=createStatement();
					String sql = "select i from x";
					ResultSet rs = stmt.executeQuery(sql);
					if (rs.next())
						return rs.getLong(1);
				} catch (Exception e) {
					System.out.println(e);
				}
				return null;
			}
			@Override
			public void detach() {
				
				super.detach();
				System.out.println("\nmodel5: detach\n");
			}
		};
		Label i5 = new Label("i5", model5);

/ 7	.

public abstract class LoadableDetachableModel<T> implements IModel<T>
{
	/** keeps track of whether this model is attached or detached */
	private transient boolean attached = false;

	/** temporary, transient object. */
	private transient T transientModelObject;

/ Einde Intermezzo

		IModel<?> model = getModelImpl();
/d
			model.detach();
/s
Counter2WithDatabasePage$3.detach() line: 92	
/=
public class Counter2WithDatabasePage extends WebPage {
	public Counter2WithDatabasePage() throws Exception {
		IModel<Long> model5 = new LoadableDetachableModel<Long>() {
			@Override
			public void detach() {
->				super.detach();
				System.out.println("\nmodel5: detach\n");
			}
		};
/s
Counter2WithDatabasePage$3(LoadableDetachableModel<T>).detach() line: 95	
				onDetach();
/ LEEG
			finally
			{
				attached = false;
				transientModelObject = null;
...
/t
Label(Component).detach() line: 1175	
		detachModels();
/d
		new Behaviors(this).detach();
		detachChildren();
/ s
Component.detachChildren = LEEG
/t
Label(Component).internalDetach() line: 1246	
		detachChildren();
/d
		internalDetach();
/s
Label(Component).internalDetach() line: 1246	
markup=Label(Component).internalDetach() line: 1246	
		markup = null;
null

/ Intermezzo

Component.class
	/** Must only be used by auto components */
	private transient IMarkupFragment markup;


/ Einde Intermezzo

/ we gaven per ongeluk continu	,
/ TODO DETACH PROPERTYMODEL

Label(Component).internalDetach() line: 1246	

markup=<span wicket:id="millis2">[Label]</span>
		markup = null;
null

this	Label  (id=388)	
	data	PropertyModel<T>  (id=387)	
		expression	"millis2" (id=7315)	
		target	Counter2WithDatabasePage  (id=383)	
	id	"millis2" (id=7315)	
	markup	null	

/t
Counter2WithDatabasePage(MarkupContainer).detachChildren() line: 1650	
this	Counter2WithDatabasePage  (id=383)	

/ volgende child	,
		for (int i = children_size(); i-- > 0;)
		{
			Object child = children_get(i, false);
			if (child instanceof Component)
			{
				Component component = (Component)child;
				component.detach();
/s
Counter2WithDatabasePage$2(Component).detach() line: 1159	
		onDetach();
/s
Counter2WithDatabasePage$2(AbstractLink).onDetach() line: 139	
		super.onDetach();

		if (bodyModel != null)
/ NEE
/ TODO
		{
			bodyModel.detach();
/ NIET
/t
		detachModels();
...
/s
Counter2WithDatabasePage$2(Component).detachModel() line: 3626	
		IModel<?> model = getModelImpl();
model	CompoundPropertyModel$AttachedCompoundPropertyModel<C>  (id=7334)	
/ TODO
			model.detach();
/s
CompoundPropertyModel$AttachedCompoundPropertyModel<C>.detach() line: 152	
			super.detach();
/s
CompoundPropertyModel$AttachedCompoundPropertyModel<C>(ChainingModel<T>).detach() line: 63	
		// Detach nested object if it's a detachable
		if (target instanceof IDetachable)
/ JA
		{
			((IDetachable)target).detach();
/s
CompoundPropertyModel<T>(ChainingModel<T>).detach() line: 63	

/ recursive call	,

this	CompoundPropertyModel<T>  (id=391)	
	target	Counter2WithDatabasePage  (id=383)	

 		if (target instanceof IDetachable)
/ NEE
		{
			((IDetachable)target).detach();
/ NIET	,

/t
CompoundPropertyModel$AttachedCompoundPropertyModel<C>.detach() line: 153	

this	CompoundPropertyModel$AttachedCompoundPropertyModel<C>  (id=7334)	
	owner	Counter2WithDatabasePage$2  (id=386)	
	target	CompoundPropertyModel<T>  (id=391)	
	this$0	CompoundPropertyModel<T>  (id=391)	

			super.detach();
/d
			CompoundPropertyModel.this.detach();
/s
CompoundPropertyModel<T>(ChainingModel<T>).detach() line: 67	

this	CompoundPropertyModel<T>  (id=391)	
	target	Counter2WithDatabasePage  (id=383)	

 		if (target instanceof IDetachable)
/ NEE
		{
			((IDetachable)target).detach();
/ NIET
/t
Counter2WithDatabasePage$2(Component).detach() line: 1175	
		detachModels();
/d
		detachChildren();
/ LEEG	, er zijn geen children	,

		// reset the model to null when the current model is a IWrapModel and
		// the model that created it/wrapped in it is a IComponentInheritedModel
		// The model will be created next time.
		if (getFlag(FLAG_INHERITABLE_MODEL))
/ JA
/ BIJ LINK IS TRUE
/ TODO
		{
			setModelImpl(null);
this	Counter2WithDatabasePage$2  (id=386)	
	data	null	

			setFlag(FLAG_INHERITABLE_MODEL, false);
		}

this
	markup <a wicket:id="refresh">Refresh</a>
		internalDetach();
this
	markup null
 
/t
Counter2WithDatabasePage(MarkupContainer).detachChildren() line: 1650	
this	Counter2WithDatabasePage  (id=383)	

/ volgende	,

		for (int i = children_size(); i-- > 0;)
		{
			Object child = children_get(i, false);
			if (child instanceof Component)
			{
				Component component = (Component)child;
				component.detach();
component	Label  (id=385)	
	data	Counter2WithDatabasePage$1  (id=384)	
	id	"millis" (id=7392)	
	markup	MarkupFragment  (id=7393)	
/s
Label(Component).detach() line: 1159	
		detachModels();
...
/s
Label(Component).detachModel() line: 3626	

this	Label  (id=385)	
	data	Counter2WithDatabasePage$1  (id=384)	
	id	"millis" (id=7392)	
	markup	MarkupFragment  (id=7393)	

		IModel<?> model = getModelImpl();

model	Counter2WithDatabasePage$1  (id=384)	
	object null
	this$0	Counter2WithDatabasePage  (id=383)	

			model.detach();
/s
Counter2WithDatabasePage$1(Model<T>).detach() line: 212	
		if (object instanceof IDetachable)
/ NEE
		{
			((IDetachable)object).detach();
/ NIET
/t
Label(Component).detach() line: 1175	
		detachModels();
/d
		detachChildren();
/ LEEG	,

this.markup=-<span wicket:id="millis">[Label]</span>
		internalDetach();
null

/t
Counter2WithDatabasePage(Component).detach() line: 1184	
this	Counter2WithDatabasePage  (id=383)	
detachChildren();
/d
/ Er waren geen children meer	,

this.markup=
file:/home/eric/Devel/Java/Tomcat/apache-tomcat-7.0.57/webapps/wicket-testing/WEB-INF/classes/my/test/own/Counter2WithDatabasePage.html
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<!-- <a wicket:id="link"><span wicket:id="text"></span></a> -->
<span wicket:id="millis">[Label]</span>
<a wicket:id="refresh">Refresh</a>
<span wicket:id="millis2">[Label]</span>
<span wicket:id="millis3">[Label]</span>
<span wicket:id="millis4">[Label]</span>
<span wicket:id="i5">[Label]</span>
</body>
</html>
		internalDetach();
this.markup=null

/t
PageAndComponentProvider(PageProvider).detach() line: 329	
			pageInstance.detach();
/d
/t
ListenerInterfaceRequestHandler.detach(IRequestCycle) line: 129	
		pageComponentProvider.detach();
/d
/t
RequestCycle$HandlerExecutor.detach(IRequestHandler) line: 849	
			handler.detach(RequestCycle.this);
/d
/t
RequestCycle$HandlerExecutor(RequestHandlerStack).detach() line: 185	
		for (IRequestHandler handler : inactiveRequestHandlers)
handler=org.apache.wicket.core.request.handler.ListenerInterfaceRequestHandler@7b3ecf3e
		{
			try
			{
				detach(handler);
/d

/ volgende,	
		for (IRequestHandler handler : inactiveRequestHandlers)
handler	RenderPageRequestHandler  (id=6553)	
		{
			try
			{
				detach(handler);
/s
RequestCycle$HandlerExecutor.detach(IRequestHandler) line: 848	
			handler.detach(RequestCycle.this);
/s
RenderPageRequestHandler.detach(IRequestCycle) line: 156	
		pageProvider.detach();
/s
PageProvider.detach() line: 327	
			pageInstance.detach();
/s
Counter2WithDatabasePage(Component).detach() line: 1159	
		detachModels();
...
/s
Counter2WithDatabasePage(Component).detachModel() line: 3625	
		IModel<?> model = getModelImpl();
model	CompoundPropertyModel<T>  (id=391)	
			model.detach();
/s
CompoundPropertyModel<T>(ChainingModel<T>).detach() line: 67	
		if (target instanceof IDetachable)
target	Counter2WithDatabasePage  (id=383)	
/ NEE
			((IDetachable)target).detach();
/ NIET
/t
Counter2WithDatabasePage(Component).detach() line: 1175	
		detachModels();
/d
		detachChildren();
/ OVERBODIG	, IS AL	,
...
/s
Counter2WithDatabasePage(MarkupContainer).detachChildren() line: 1649	
		for (int i = children_size(); i-- > 0;)
6
		{
			Object child = children_get(i, false);
...
/t
		internalDetach();
/ OVERBODIG	, IS AL	,
/ markup is al null	,

/t
PageProvider.detach() line: 329	
			pageInstance.detach();
/d
/t
RenderPageRequestHandler.detach(IRequestCycle) line: 157	
		pageProvider.detach();
/d
/t
RequestCycle$HandlerExecutor.detach(IRequestHandler) line: 849	
			handler.detach(RequestCycle.this);
handler	RenderPageRequestHandler  (id=6553)	
/d
/t
RequestCycle$HandlerExecutor(RequestHandlerStack).detach() line: 185	
				detach(handler);
/d
/ volgende	,
		for (IRequestHandler handler : inactiveRequestHandlers)
/ NEE	, GEEN meer	,
		{
			try
			{
				detach(handler);
/ NIET	,
/t
RequestCycle.onDetach() line: 645	
			requestHandlerExecutor.detach();
/d
		}
		finally
		{
			listeners.onDetach(this);
/s
RequestCycleListenerCollection.onDetach(RequestCycle) line: 100	
		reversedNotifyIgnoringExceptions(new INotifier<IRequestCycleListener>()
		{
			@Override
			public void notify(IRequestCycleListener listener)
			{
				listener.onDetach(cycle);
/s
RequestCycleListenerCollection(ListenerCollection<T>).reversedNotifyIgnoringExceptions(INotifier<T>) line: 113	
->		reversedNotify(new INotifier<T>()
		{
			@Override
			public void notify(T listener)
			{
				try
				{
					notifier.notify(listener);
/s
RequestCycleListenerCollection(ListenerCollection<T>).reversedNotify(INotifier<T>) line: 144	
		Iterator<T> it = new ReverseListIterator<>(listeners);
[org.apache.wicket.request.cycle.RequestCycleListenerCollection@3c95de7a, org.apache.wicket.Application$3@13413aa9]
		while (it.hasNext())
		{
			T listener = it.next();
			notifier.notify(listener);
/s
RequestCycleListenerCollection(ListenerCollection<T>).reversedNotifyIgnoringExceptions(INotifier<T>) line: 113	
		reversedNotify(new INotifier<T>()
		{
			@Override
			public void notify(T listener)
			{
				try
				{
->					notifier.notify(listener);
/s
RequestCycleListenerCollection$3.notify(IRequestCycleListener) line: 105	
		reversedNotifyIgnoringExceptions(new INotifier<IRequestCycleListener>()
		{
			@Override
			public void notify(IRequestCycleListener listener)
			{
->				listener.onDetach(cycle);
/s
Application$3.onDetach(RequestCycle) line: 1751	
		requestCycle.getListeners().add(new AbstractRequestCycleListener()
		{
			@Override
			public void onDetach(final RequestCycle requestCycle)
			{
				if (Session.exists())
				{
->					Session.get().getPageManager().commitRequest();
/s
PageAccessSynchronizer$2.commitRequest() line: 270	
					super.commitRequest();
/s
PageAccessSynchronizer$2(PageManagerDecorator).commitRequest() line: 68	
this	PageAccessSynchronizer$2  (id=7463)										/ 'n PageManagerDecorator	,	
	delegate	PageStoreManager  (id=72)	

->		delegate.commitRequest();
/s
PageStoreManager(AbstractPageManager).commitRequest() line: 76	
		getRequestAdapter().commitRequest();
/s
PageStoreManager$PersistentRequestAdapter(RequestAdapter).commitRequest() line: 172	

			for (IManageablePage page : touchedPages)
[[Page class = my.test.own.Counter2WithDatabasePage, id = 3, render count = 1]]
			{
				boolean isPageStateless;
				try
				{
					isPageStateless = page.isPageStateless();
false
				}
				catch (Exception x)
				{
					log.warn("An error occurred while checking whether a page is stateless. Assuming it is stateful.", x);
					isPageStateless = false;
				}
				if (isPageStateless == false)
/ JA
				{
					statefulPages.add(page);
[[Page class = my.test.own.Counter2WithDatabasePage, id = 3, render count = 1]]
				}
			}

			if (statefulPages.isEmpty() == false)
/ JA
			{
				storeTouchedPages(statefulPages);
/s
PageStoreManager$PersistentRequestAdapter.storeTouchedPages(List<IManageablePage>) line: 403	
	private static class SessionEntry implements Serializable, HttpSessionBindingListener
		...
	}
	protected class PersistentRequestAdapter extends RequestAdapter
	{
		@Override
		protected void storeTouchedPages(final List<IManageablePage> touchedPages)
		{
			if (!touchedPages.isEmpty())
			{
				SessionEntry entry = getSessionEntry(true);
/(*)
				entry.setSessionCache(touchedPages);

this	PageStoreManager$PersistentRequestAdapter  (id=189)	
page	Counter2WithDatabasePage  (id=383)	
i$	ArrayList$Itr  (id=7494)	
entry	PageStoreManager$SessionEntry  (id=7495)	
	afterReadObject	null	
	applicationName	"wicket-testing" (id=240)	
	sessionCache	ArrayList<E>  (id=7497)	
		elementData	Object[1]  (id=7507)	
			[0]	Counter2WithDatabasePage  (id=383)	
		modCount	0	
		size	1	
	sessionId	"3CEA55CFEC069BC3927541FE41CF2B1F" (id=7462)	
touchedPages	ArrayList<E>  (id=7467)	
[[Page class = my.test.own.Counter2WithDatabasePage, id = 3, render count = 1]]

				for (IManageablePage page : touchedPages)
				{
					// WICKET-5103 use the same sessionId as used in SessionEntry#getPage()
->					pageStore.storePage(entry.sessionId, page);

/ Intermezzo

/ (*)
PageStoreManager$PersistentRequestAdapter.storeTouchedPages(List<IManageablePage>) line: 403	
	private static class SessionEntry implements Serializable, HttpSessionBindingListener
		...
	}
	protected class PersistentRequestAdapter extends RequestAdapter
	{
		private SessionEntry getSessionEntry(boolean create)
		{
			String attributeName = getAttributeName();
			SessionEntry entry = (SessionEntry)getSessionAttribute(attributeName);
			if (entry == null && create)
			{
				bind();
				entry = new SessionEntry(applicationName, getSessionId());
				setSessionAttribute(attributeName, entry);
/ in context
/ TODO
			}
			return entry;
		}

/ TODO SESSIONENTRY

/ Einde Intermezzo

/s
DefaultPageStore.storePage(String, IManageablePage) line: 61	
		SerializedPage serialized = createSerializedPage(sessionId, page);
/s
DefaultPageStore.createSerializedPage(String, IManageablePage) line: 276	
		byte[] data = serializePage(page);
/s
DefaultPageStore(AbstractPageStore).serializePage(IManageablePage) line: 131	
this	DefaultPageStore  (id=69)	
	dataStore	AsynchronousDataStore  (id=210)	
	pagesCache	DefaultPageStore$SerializedPagesCache  (id=199)	
	pageSerializer	JavaSerializer  (id=213)	

		byte[] data = pageSerializer.serialize(page);
/s
JavaSerializer.serialize(Object) line: 72	
			final ByteArrayOutputStream out = new ByteArrayOutputStream();
				oos = newObjectOutputStream(out);
				oos.writeObject(applicationKey);
				oos.writeObject(object);
object	Counter2WithDatabasePage  (id=383)	

/ Intermezzo

/ De obj, de page is zo klein mogelijk gemaakt	,

this	JavaSerializer  (id=213)	
object	Counter2WithDatabasePage  (id=383)	
	autoIndex	1	
	children	MarkupContainer$ChildList  (id=6477)	
		childs	Object[12]  (id=7570)	
			[0]	Label  (id=385)	
				data	Counter2WithDatabasePage$1  (id=384)	
					object null
/ TODO
				flags	1074999450	
				generatedMarkupId	-1	
				id	"millis" (id=7392)	
				markup	null	
				markupSourcingStrategy	DefaultMarkupSourcingStrategy  (id=7224)	
				parent	Counter2WithDatabasePage  (id=383)	
				requestFlags	32	
			[1]	Counter2WithDatabasePage$2  (id=386)	
				anchor	null	
				autoEnable	false	
				bodyModel	null	
				children	null	
				data	null	
				flags	1073950874	
				generatedMarkupId	-1	
				id	"refresh" (id=7336)	
				markup	null	
				markupSourcingStrategy	DefaultMarkupSourcingStrategy  (id=7224)	
				parent	Counter2WithDatabasePage  (id=383)	
				popupSettings	null	
				queue	null	
				requestFlags	32	
				this$0	Counter2WithDatabasePage  (id=383)	
			[2]	Label  (id=388)	
				data	PropertyModel<T>  (id=387)	
					expression	"millis2" (id=7315)	
					target	Counter2WithDatabasePage  (id=383)	
				flags	1074999450	
				generatedMarkupId	-1	
				id	"millis2" (id=7315)	
				markup	null	
				markupSourcingStrategy	DefaultMarkupSourcingStrategy  (id=7224)	
				parent	Counter2WithDatabasePage  (id=383)	
				requestFlags	32	
			[3]	Label  (id=390)	
				data	Model<T>  (id=389)	
					object	Long  (id=7583)	
1441607443075
				flags	1074999450	
				generatedMarkupId	-1	
				id	"millis3" (id=7313)	
				markup	null	
				markupSourcingStrategy	DefaultMarkupSourcingStrategy  (id=7224)	
				parent	Counter2WithDatabasePage  (id=383)	
				requestFlags	32	
			[4]	Label  (id=393)	
				data	null	
/ TODO
				flags	1073950874	
				generatedMarkupId	-1	
				id	"millis4" (id=7311)	
				markup	null	
				markupSourcingStrategy	DefaultMarkupSourcingStrategy  (id=7224)	
				parent	Counter2WithDatabasePage  (id=383)	
				requestFlags	32	
			[5]	Label  (id=7263)	
				data	Counter2WithDatabasePage$3  (id=7268)	
				flags	1074999450	
				generatedMarkupId	-1	
				id	"i5" (id=7270)	
				markup	null	
				markupSourcingStrategy	DefaultMarkupSourcingStrategy  (id=7224)	
				parent	Counter2WithDatabasePage  (id=383)	
				requestFlags	32	
			[6]	HtmlHeaderContainer  (id=7250)	
		modCount	0	
		size	7	
	counter	0	
	data	CompoundPropertyModel<T>  (id=391)	
		target	Counter2WithDatabasePage  (id=383)	
	flags	1075523738	
	generatedMarkupId	-1	
	id	null	
	link	"Foo Bar" (id=6478)	
	markup	null	
	markupSourcingStrategy	DefaultMarkupSourcingStrategy  (id=7224)	
	millis2	1441607443075	
	millis3	1441607443075	
	millis4	1441607443075	
	numericId	3	
	pageParameters	PageParameters  (id=6479)	
	parent	null	
	queue	null	
	renderCount	1	
	renderedComponents	null	
	requestFlags	32	
	stateless	Boolean  (id=6511)	
	stmt	Jdbc4Statement  (id=6480)	
	text	"Link" (id=6481)	

/ Einde Intermezzo

			return out.toByteArray();
/t
DefaultPageStore(AbstractPageStore).serializePage(IManageablePage) line: 135	
		byte[] data = pageSerializer.serialize(page);
/d
[-84, -19, 0, 5, 116, 0, 14, 119, 105, ...

/ Intermezzo

/ stack trace	,
	DefaultPageStore(AbstractPageStore).serializePage(IManageablePage) line: 135	
	DefaultPageStore.createSerializedPage(String, IManageablePage) line: 281	
	DefaultPageStore.storePage(String, IManageablePage) line: 61	
	PageStoreManager$PersistentRequestAdapter.storeTouchedPages(List<IManageablePage>) line: 403	
	PageStoreManager$PersistentRequestAdapter(RequestAdapter).commitRequest() line: 172	
	PageStoreManager(AbstractPageManager).commitRequest() line: 76	
	PageAccessSynchronizer$2(PageManagerDecorator).commitRequest() line: 68	
	PageAccessSynchronizer$2.commitRequest() line: 270	
	Application$3.onDetach(RequestCycle) line: 1751	
	RequestCycleListenerCollection$3.notify(IRequestCycleListener) line: 105	
	RequestCycleListenerCollection$3.notify(Object) line: 101	
	ListenerCollection$1.notify(T) line: 120	
	RequestCycleListenerCollection(ListenerCollection<T>).reversedNotify(INotifier<T>) line: 144	
	RequestCycleListenerCollection(ListenerCollection<T>).reversedNotifyIgnoringExceptions(INotifier<T>) line: 113	
	RequestCycleListenerCollection.onDetach(RequestCycle) line: 100	
	RequestCycle.onDetach() line: 645	
	RequestCycle.detach() line: 594	
	RequestCycle.processRequestAndDetach() line: 297	
	WicketFilter.processRequestCycle(RequestCycle, WebResponse, HttpServletRequest, HttpServletResponse, FilterChain) line: 261	
	WicketFilter.processRequest(ServletRequest, ServletResponse, FilterChain) line: 203	
	WicketFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 284	

/ Dus ser is onderdeel van detach	,

/ Einde Intermezzo

		return data;
/t
DefaultPageStore.createSerializedPage(String, IManageablePage) line: 283	
		byte[] data = serializePage(page);
/d
			serializedPage = new SerializedPage(sessionId, page.getPageId(), data);
/s
			this.pageId = pageId;
			this.sessionId = sessionId;
			this.data = data;
/t
		return serializedPage;
/t
DefaultPageStore.storePage(String, IManageablePage) line: 64	

this	DefaultPageStore  (id=69)	
	dataStore	AsynchronousDataStore  (id=210)	
	pagesCache	DefaultPageStore$SerializedPagesCache  (id=199)	
	pageSerializer	JavaSerializer  (id=213)	

		SerializedPage serialized = createSerializedPage(sessionId, page);
/d
			int pageId = page.getPageId();
3
			pagesCache.storePage(sessionId, pageId, serialized);
/s
DefaultPageStore$SerializedPagesCache.storePage(String, Integer, DefaultPageStore$SerializedPage) line: 427	

/ Intermezzo

public class DefaultPageStore extends AbstractCachingPageStore<DefaultPageStore.SerializedPage>
	protected static class SerializedPage implements Serializable{
		...
	}
	static class SerializedPagesCache implements SecondLevelPageCache<String, Integer, SerializedPage> {

		private final int maxSize;
		private final ConcurrentLinkedDeque<SoftReference<SerializedPage>> cache;

		/**
		 * Constructor.
		 * 
		 * @param maxSize
		 *          The maximum number of entries to cache
		 */
		public SerializedPagesCache(final int maxSize)
		{
			this.maxSize = maxSize;
			cache = new ConcurrentLinkedDeque<>();
		}

		@Override
		public void storePage(String sessionId, Integer pageId, SerializedPage page)
		{
->			if (maxSize > 0)

/ Einde Intermezzo

		if (maxSize > 0)
/ NEE	,
maxSize=0

/t
DefaultPageStore.storePage(String, IManageablePage) line: 66	
			pagesCache.storePage(sessionId, pageId, serialized);
/d
/ NIETS gedaan	,
			storePageData(sessionId, pageId, serialized.getData());
/s
DefaultPageStore(AbstractPageStore).storePageData(String, int, byte[]) line: 119	
		dataStore.storeData(sessionId, pageId, data);
/s
AsynchronousDataStore.storeData(String, int, byte[]) line: 216	
		Entry entry = new Entry(sessionId, id, data);
		String key = getKey(entry);
key	"3:::3CEA55CFEC069BC3927541FE41CF2B1F" (id=7905)	
/ want	,
/s
		return getKey(entry.sessionId, entry.pageId);
/s
		return pageId + ":::" + sessionId;
/t
		entryMap.put(key, entry);

		try
		{
			boolean added = entries.offer(entry, OFFER_WAIT, TimeUnit.MILLISECONDS);

			if (added == false)
			{
				log.debug("Storing synchronously page with id '{}' in session '{}'", id, sessionId);
				entryMap.remove(key);
				dataStore.storeData(sessionId, id, data);
			}
/ TODO
/ we zien dat entryMap={}	, this.entries=[]
/ TODO
...
/t
Application$3.onDetach(RequestCycle) line: 1754	
		requestCycle.getListeners().add(new AbstractRequestCycleListener()
		{
			@Override
			public void onDetach(final RequestCycle requestCycle)
			{
				if (Session.exists())
				{
					Session.get().getPageManager().commitRequest();
/d
...
/t
RequestCycleListenerCollection(ListenerCollection<T>).reversedNotify(INotifier<T>) line: 143	
		while (it.hasNext())

/ volgende	,
		{
			T listener = it.next();
			notifier.notify(listener);
/ TODO
/ WH
			[1]	Application$3  (id=7464)	
/ NIETS	,

/t
RequestCycle.onDetach() line: 646	
			listeners.onDetach(this);
/d
listeners	RequestCycleListenerCollection  (id=6540)	
	listeners	CopyOnWriteArrayList<E>  (id=7207)	
		array	Object[2]  (id=7921)	
			[0]	RequestCycleListenerCollection  (id=554)	
			[1]	Application$3  (id=7464)	

		if (Session.exists())
/ JA
/ TODO
		{
			Session.get().detach();
/s
WebSession(Session).detach() line: 648	
		if (sessionInvalidated)
/ NEE
		else
		{
			// WICKET-5103 container might have changed id
			updateId();
/s
WebSession(Session).updateId() line: 395	
		RequestCycle requestCycle = RequestCycle.get();
		if (requestCycle != null)
		{
			id = getSessionStore().getSessionId(requestCycle.getRequest(), false);
/s
HttpSessionStore.getSessionId(Request, boolean) line: 157	
this	HttpSessionStore  (id=481)	
		HttpSession httpSession = getHttpSession(request, false);
/s
HttpSessionStore.getHttpSession(Request, boolean) line: 95	
		return getHttpServletRequest(request).getSession(create);
/s
HttpSessionStore.getHttpServletRequest(Request) line: 74	
this	HttpSessionStore  (id=481)	
		Object containerRequest = request.getContainerRequest();
org.apache.catalina.connector.RequestFacade@179fb4d
/want	,
/s
		return httpServletRequest;
/t
		return (HttpServletRequest)containerRequest;
/t
		return getHttpServletRequest(request).getSession(create);
/ Dit is een catalina call	,
/t
HttpSessionStore.getSessionId(Request, boolean) line: 160	
		HttpSession httpSession = getHttpSession(request, false);
/d
null
/ TODO 
		if (httpSession != null)
/ NEE
		{
			id = httpSession.getId();
/ NIET
/ Maar er was toch een session id ?
/ TODO
		return id;
null
/t
WebSession(Session).detach() line: 659	
			updateId();
/d
this	WebSession  (id=469)	
	id	null	
pageId	AtomicInteger  (id=478)	
4
/ TODO
/ Was toch 3? Waarom +1?

/t
RequestCycle.detach() line: 600	
			onDetach();
/d
				onInternalDetach();
/s
RequestCycle.onInternalDetach() line: 611	
		if (Session.exists())
/s
		Session session = ThreadContext.getSession();
session	WebSession  (id=469)	
		return session != null;
/t
RequestCycle.onInternalDetach() line: 613	
		if (Session.exists())
/d
		{
			Session.get().internalDetach();
/s
WebSession(Session).internalDetach() line: 683	

this	WebSession  (id=469)	
	id	null	
	sessionStore	HttpSessionStore  (id=481)	

		if (dirty)
/ JA
		{
			Request request = RequestCycle.get().getRequest();
			getSessionStore().flushSession(request, this);
/s
HttpSessionStore.flushSession(Request, Session) line: 131	
	{
		if (getAttribute(request, Session.SESSION_ATTRIBUTE_NAME) != session)
/ JA	,
/ getAttribute(request, Session.SESSION_ATTRIBUTE_NAME)==null
		{
			// this session is not yet bound, bind it
			bind(request, session);
/s
HttpSessionStore.bind(Request, Session) line: 104	
		if (getAttribute(request, Session.SESSION_ATTRIBUTE_NAME) != newSession)
/s
HttpSessionStore.getAttribute(Request, String) line: 266	
		HttpSession httpSession = getHttpSession(request, false);
null
		return null;
/t
HttpSessionStore.bind(Request, Session) line: 107	
		if (getAttribute(request, Session.SESSION_ATTRIBUTE_NAME) != newSession)
/ JA
/ newSession.id=null, .pageId=4	,
		{
			// call template method
			onBind(request, newSession);
/ LEEG

/ Intermezzo

/ we zijn nog steeds in detach	,

	HttpSessionStore.bind(Request, Session) line: 107	
	HttpSessionStore.flushSession(Request, Session) line: 134	
	WebSession(Session).internalDetach() line: 684	
	RequestCycle.onInternalDetach() line: 613	
	RequestCycle.detach() line: 600	
	RequestCycle.processRequestAndDetach() line: 297	
	WicketFilter.processRequestCycle(RequestCycle, WebResponse, HttpServletRequest, HttpServletResponse, FilterChain) line: 261	
	WicketFilter.processRequest(ServletRequest, ServletResponse, FilterChain) line: 203	
	WicketFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 284	


/ Einde Intermezzo

			for (BindListener listener : getBindListeners())
[]
			HttpSession httpSession = getHttpSession(request, false);
null
/ want	,
/s
		return getHttpServletRequest(request).getSession(create);
/t
HttpSessionStore.flushSession(Request, Session) line: 140	
			bind(request, session);
/d
/t
WebSession(Session).internalDetach() line: 686	
			getSessionStore().flushSession(request, this);
/d
		}
		dirty = false;
...
/t
RequestCycle.detach() line: 604	
				onInternalDetach();
/d
			}
			finally
			{
				set(null);
/s
		ThreadContext.setRequestCycle(requestCycle);
/t
RequestCycle.processRequestAndDetach() line: 298	
			detach();
/d
		}
		return result;
true
/t
WicketFilter.processRequestCycle(RequestCycle, WebResponse, HttpServletRequest, HttpServletResponse, FilterChain) line: 261	
		if (!requestCycle.processRequestAndDetach())
/d
/ NEE
		else
		{
			webResponse.flush();

/ HIER HIER HIER



 





/ Einde WICKET DETACHABLE MODEL	

/ SPRING IN SCS

StartupWebAppContextListener	, 
MpoBeanFactory
/ alle spring config files worden WH scanned	,
web.xml
/ Einde `SPRING IN SCS
