/ DSVSOL-2719 

/ 7	. 

[eric@localhost bin]$ cat dsvfms-ssh-a.sh 
#!/bin/bash
echo 'h^Zgcyr&Q'
ssh vanderveldene@application-a.intermax.mp-objects.com

[eric@localhost bin]$ cat dsvfms-ssh-t.sh 
#!/bin/bash
echo 'Eric456@MPO'
ssh mposerv11 

[eric@localhost bin]$ cat dsvfms-ssh-db-a.sh
#!/bin/bash
echo 'h^Zgcyr&Q'
ssh vanderveldene@database-a.intermax.mp-objects.com

[eric@localhost bin]$ cat dsvfms-db-a.sh
#!/bin/bash
isql-fb -u sysdba -p +qjweLrf database-a.intermax.mp-objects.com:/local/apps/firebird/dsvfms.fdb


/ 7	. 

/ backup db on acceptance	,

[vanderveldene@application-a dsvfms]$ pwd
/local/apps/jboss-4.0.5.GA/server/dsvfms
[vanderveldene@application-a dsvfms]$ less deploy/firebird-ds.xml 
<datasources>
   <local-tx-datasource>
     <jndi-name>tmsdevDS</jndi-name>
     <connection-url>jdbc:firebirdsql://192.168.173.20//local/apps/firebird/dsvfms.fdb?defaultResultSetHoldable=true&amp;columnLabelForName=true</connection-url>
     <user-name>SYSDBA</user-name>
     <password>+qjweLrf</password>

/ Dit is database-a.intermax.mp-objects.com	,

/ 7	. 


/ TODO (Kan niet login op database-a)	,
[eric@localhost bin]$ cat dsvfms-scp-from-db-a.sh 
#!/usr/bin/bash
# $@=dsvfms.fdb_20150930-002854.fbk.gz
echo "h^Zgcyr&Q"
scp "vanderveldene@database-a.intermax.mp-objects.com:/backup/mpo-backup/db/$@" /home/eric/DB_TAP/Dsvfms/

[eric@localhost bin]$ dsvfms-scp-from-db-a.sh dsvfms.fdb_20151005-003448.fbk.gz
h^Zgcyr&Q
Password: 
/ OK

[eric@localhost bin]$ cat dsvfms-scp-to-db-t.sh
#!/usr/bin/bash
# $@=dsvfms.fdb_20150930-002854.fbk.gz
scp "/home/eric/DB_TAP/Dsvfms/$@" "eric@mposerv8:"

[eric@localhost bin]$ dsvfms-scp-to-db-t.sh dsvfms.fdb_20150930-002854.fbk.gz

/ Lees onze wiki	, 
Database maintenance

[eric@localhost bin]$ dsvfms-ssh-db-t.sh 
Eric456@MPO
eric@mposerv8:~$ gunzip dsvfms.fdb_20150930-002854.fbk.gz  

/ 13. 

/ Let op	,

/ verschillende passwords op mposerv8 en database-a

jboss@mposerv11:~$ less /local/apps/jboss-4.0.5.GA/server/dsvfms/deploy/firebird-ds.xml 
 <datasources>
   <local-tx-datasource>
     <connection-url>jdbc:firebirdsql://192.168.1.8//local/apps/firebird/dsvfms.fdb?no_result_set_tracking&amp;defaultResultSetHoldable=true</connection-url>
     <user-name>SYSDBA</user-name>
     <password>masterkey</password>

[vanderveldene@application-a ~]$ less /local/apps/jboss-4.0.5.GA/server/dsvfms/deploy/firebird-ds.xml 
 <datasources>
   <local-tx-datasource>
     <connection-url>jdbc:firebirdsql://192.168.173.20//local/apps/firebird/dsvfms.fdb?defaultResultSetHoldable=true&amp;columnLabelForName=true</connection-url>
     <user-name>SYSDBA</user-name>
     <password>+qjweLrf</password>

/ vergeet niet forticlient te start als we 
[eric@localhost bin]$ dsvfms-db-a.sh 


/ we stop dsvfms op test	,

[eric@localhost bin]$ dsvfms-ssh-t.sh 
Eric456@MPO
eric@mposerv11:~$ sudo su - jboss
jboss@mposerv11:~$ dsvfms stop

/ op database server	,
eric@mposerv8:~$ gbak -rep -user sysdba -password masterkey dsvfms.fdb_20150930-002854.fbk localhost://local/apps/firebird/dsvfms.fdb 

/ we krijgen ERR	,
gbak: ERROR:validation error for column FINANCIAL_PARTY_SYSTEMID, value "*** null ***"
gbak: ERROR:warning -- record could not be restored

/ 7	. 

/ Intermezzo

http://www.firebirdfaq.org/faq174/

/ 13	. 

/ show al onze tables	, 

SQL> show table rdb$relations;
RDB$VIEW_BLR                    (RDB$VIEW_BLR) BLOB segment 80, subtype BLR Nullable 
RDB$VIEW_SOURCE                 (RDB$SOURCE) BLOB segment 80, subtype TEXT CHARACTER SET UNICODE_FSS Nullable 
RDB$DESCRIPTION                 (RDB$DESCRIPTION) BLOB segment 80, subtype TEXT CHARACTER SET UNICODE_FSS Nullable 
RDB$RELATION_ID                 (RDB$RELATION_ID) SMALLINT Nullable 
RDB$SYSTEM_FLAG                 (RDB$SYSTEM_FLAG) SMALLINT Nullable 
RDB$DBKEY_LENGTH                (RDB$DBKEY_LENGTH) SMALLINT Nullable 
RDB$FORMAT                      (RDB$FORMAT) SMALLINT Nullable 
RDB$FIELD_ID                    (RDB$FIELD_ID) SMALLINT Nullable 
RDB$RELATION_NAME               (RDB$RELATION_NAME) CHAR(31) CHARACTER SET UNICODE_FSS Nullable 
RDB$SECURITY_CLASS              (RDB$SECURITY_CLASS) CHAR(31) CHARACTER SET UNICODE_FSS Nullable 
RDB$EXTERNAL_FILE               (RDB$FILE_NAME) VARCHAR(255) Nullable 
RDB$RUNTIME                     (RDB$RUNTIME) BLOB segment 80, subtype SUMMARY Nullable 
RDB$EXTERNAL_DESCRIPTION        (RDB$EXTERNAL_DESCRIPTION) BLOB segment 80, subtype EXTERNAL_FILE_DESCRIPTION Nullable 
RDB$OWNER_NAME                  (RDB$USER) CHAR(31) CHARACTER SET UNICODE_FSS Nullable 
RDB$DEFAULT_CLASS               (RDB$SECURITY_CLASS) CHAR(31) CHARACTER SET UNICODE_FSS Nullable 
RDB$FLAGS                       (RDB$SYSTEM_FLAG) SMALLINT Nullable 
RDB$RELATION_TYPE               (RDB$RELATION_TYPE) SMALLINT Nullable 

/ met rdb$system_flag krijgen we alle system tables of niet	, 


/ alle system tables	, 
SQL> select rdb$relation_name from rdb$relations where rdb$system_flag=1;

RDB$RELATION_NAME                                                                             
=============================================================================== 
RDB$PAGES                                                                                     
RDB$DATABASE                                                                                  
RDB$FIELDS                                                                                    
...
MON$CONTEXT_VARIABLES                                                                         
MON$MEMORY_USAGE                                                                              

/ alle tables	, 
SQL> select rdb$relation_name from rdb$relations where rdb$system_flag=0 and rdb$view_blr is null;

RDB$RELATION_NAME                                                                             
=============================================================================== 
KEY_GENERATOR                                                                                 
ORGANIZATION                                                                                  
PRICE_TYPE                                                                                    
TMS_USER                                                                                      
USER_ORGANIZATION                                                                             
TMS_ROLE                                                                                      
USER_ROLE                                                                                     
...

/ alle views	, 
SQL> select rdb$relation_name from rdb$relations where rdb$system_flag=0 and rdb$view_blr is not null;

RDB$RELATION_NAME                                                                             
=============================================================================== 
PRIVILEGE_VIEW                                                                                
RPT_PARTIES                                                                                   
RPT_SERVICE_ACTIONS                                                                           
RPT_PATH_CRITERIUM                                                                            
RPT_CONSIGNMENTS            
...

SQL> select r.rdb$relation_name  from rdb$relations r join rdb$relation_fields f on r.rdb$relation_name=f.rdb$relation_name where f.rdb$field_name='FINANCIAL_PARTY_SYSTEMID';

RDB$RELATION_NAME                                                                             
=============================================================================== 
INVOICE_HEADER                                                                                
FINANCIAL_PARTY_COST_TYPE                                                                     
INVOICE_FINANCIAL_PARTY_BINDING                                                               
PRICE_TYPE_TRANSLATION                                                                        
COST_TYPE_TRANSLATION   

SQL> show table invoice_header;
FINANCIAL_PARTY_SYSTEMID        INTEGER Nullable 
CONSTRAINT FK_COUNTRY_RECEIVER_FK:
CONSTRAINT FK_FINANCIAL_PARTY_SYSTEMID:
  Foreign key (FINANCIAL_PARTY_SYSTEMID)    References INVOICE_FINANCIAL_PARTY (SYSTEM_ID)

SQL> show table financial_party_cost_type;
FINANCIAL_PARTY_SYSTEMID        INTEGER Nullable 
CONSTRAINT UNQ_COST_TYPE_FINANCIAL:
  Unique key (FINANCIAL_PARTY_SYSTEMID, COST_TYPE_SYSTEMID)

SQL> show table invoice_financial_party_binding;
FINANCIAL_PARTY_SYSTEMID        INTEGER Not Null 
CONSTRAINT INVOICE_FPB_FP_FK:
  Foreign key (FINANCIAL_PARTY_SYSTEMID)    References INVOICE_FINANCIAL_PARTY (SYSTEM_ID)

SQL> show table price_type_translation;
FINANCIAL_PARTY_SYSTEMID        INTEGER Not Null 
CONSTRAINT FINANCIAL_PARTY_SYSTEMID_FK:
  Foreign key (FINANCIAL_PARTY_SYSTEMID)    References INVOICE_FINANCIAL_PARTY (SYSTEM_ID)

SQL> show table cost_type_translation;
FINANCIAL_PARTY_SYSTEMID        INTEGER Not Null 
CONSTRAINT FINANCIAL_PARTY_SYSTEMID_CTT_FK:
  Foreign key (FINANCIAL_PARTY_SYSTEMID)    References INVOICE_FINANCIAL_PARTY (SYSTEM_ID)

/ Einde Intermezzo

SQL> select count(*) from invoice_header  where financial_party_systemid is null;

       COUNT 
============ 
           0 
SQL> select count(*) from financial_party_cost_type  where financial_party_systemid is null;

       COUNT 
============ 
           0 
SQL> select count(*) from invoice_financial_party_binding  where financial_party_systemid is null;

       COUNT 
============ 
           0 
SQL> select count(*) from price_type_translation  where financial_party_systemid is null;

       COUNT 
============ 
           0 
SQL> select count(*) from cost_type_translation  where financial_party_systemid is null;

       COUNT 
============ 
           1 

SQL> select * from cost_type_translation  where financial_party_systemid is null;

   SYSTEM_ID TRANSLATION                      COST_TYPE_SYSTEMID FINANCIAL_PARTY_SYSTEMID 
============ ================================ ================== ======================== 
    26195454 B10                                         4125779                        0 

/ Dit is een vertaal tabel	, er verwijst naar	, 

SQL> select*from rate_component_type where system_id=4125779;

   SYSTEM_ID CODE                                               DESCRIPTION                                                                                          IS_DELETED REASON_MANDATORY  SEQUENCE_NR RCT_GROUP        
============ ================================================== =============================================================================== ========== ================ ============ ================ 
     4125779 FREIGHT                                            Freight                                                                                                       0                0            1 COST             

/ we rm deze entry	,

SQL> delete from cost_type_translation where system_id=26195454;
SQL> commit;

/ en we gaan een backup maken	,

 



/ Intermezzo

/ 13	. 

SQL> create table x(i int primary key);
SQL> show table x;
I                               INTEGER Not Null 
CONSTRAINT INTEG_9:
  Primary key (I)

SQL> create table x(i int);
QL> show table x;
I                               INTEGER Nullable 
SQL> alter table x add constraint i_pk primary key(i);
/ of	,
SQL> alter table x add constraint primary key(i);
unsuccessful metadata update
-Column: I not defined as NOT NULL - cannot be used in PRIMARY KEY constraint definition

/ als we constraint use	, dan moeten we ook een naam geven	, dus
SQL> alter table x add constraint primary key(i);
/ ERR

/ 13	. 

/ Lees	, 
http://www.firebirdsql.org/manual/nullguide-alter-pop-tables.html#nullguide-make-column-non-nullable
You cannot add NOT NULL to an existing column, but there's a simple workaround. Suppose the current type is int, then this:

/ Vanaf begin	, 
SQL> create table x (i int not null);
SQL> show table x;
I                               INTEGER Not Null 
SQL> alter table x add constraint i_pk primary key(i);
SQL> show table x;
I                               INTEGER Not Null 
CONSTRAINT I_PK:
  Primary key (I)

/ 13	. 

SQL> create table x(i int ,primary key(i));
SQL> show table x;
I                               INTEGER Not Null 
CONSTRAINT INTEG_14:
  Primary key (I)
SQL> insert into x values(7);
SQL> insert into x values(13);

SQL> create table xref(i int, r int,primary key(i), foreign key(r) references x(i));
/ OK
SQL> show table xref;
I                               INTEGER Not Null 
R                               INTEGER Nullable 
CONSTRAINT INTEG_13:
  Foreign key (R)    References X (I)
CONSTRAINT INTEG_12:
  Primary key (I)

SQL> insert into xref values(1,7);
SQL> insert into xref values(1,6);
Statement failed, SQLSTATE = 23000
violation of PRIMARY or UNIQUE KEY constraint "INTEG_12" on table "XREF"
SQL> insert into xref values(1,null);
Statement failed, SQLSTATE = 23000
violation of PRIMARY or UNIQUE KEY constraint "INTEG_12" on table "XREF"

SQL> drop table xref;
unsuccessful metadata update
-object XREF is in use
SQL> commit;
SQL> drop table xref;
SQL> drop table x;
/ OK

/ 13	. 

QL> create table x(i int ,primary key(i));
SQL> insert into x values(7);
SQL> create table xref(i int, r int,primary key(i));
SQL> show table xref;
I                               INTEGER Not Null 
R                               INTEGER Nullable 
CONSTRAINT INTEG_18:
  Primary key (I)
SQL> insert into xref values (1,7);
SQL> insert into xref values (2,null);
SQL> commit;
SQL> alter table xref add foreign key(r) references x(i);
SQL> select*from xref;

           I            R 
============ ============ 
           1            7 
           2       <null> 

SQL> show table xref;
I                               INTEGER Not Null 
R                               INTEGER Nullable 
CONSTRAINT INTEG_20:
  Foreign key (R)    References X (I)
CONSTRAINT INTEG_18:
  Primary key (I)

SQL> insert into xref values (3,null);
/ OK

/ constraint foreign key staat null toe,	

ALTER TABLE table_name MODIFY column_name datatype NOT NULL;

 
 










/ Einde Intermezzo



/ Einde DSVSOL-2719 

/ DSVSOL-2739

jboss@mposerv11:~$ dsvfms heapdump
jboss@mposerv11:~$ gzip dsvfms.20151016-103825.hprof 
jboss@mposerv11:~$ chmod o+r dsvfms.20151016-103825.hprof.gz 

/ we moeten o+r	, want dan kan eric vanaf laptop scp doen	,
[eric@localhost bin]$ scp eric@mposerv11:/home/jboss/dsvfms.20151016-103825.hprof.gz /home/eric/Downloads/
/ OK

/ we kunnen 	,
[eric@localhost bin]$ dsvfms-ssh-t.sh "sha1sum ~jboss/dsvfms.20151016-103825.hprof.gz"
eric@mposerv11's password: 
27ba19b1a7aea234183be4dbd52ec6e1bd1ad2d4  /home/jboss/dsvfms.20151016-103825.hprof.gz

/ en	,
[eric@localhost 2015.03]$ sha1sum ~/Downloads/dsvfms.20151016-103825.hprof.gz 
27ba19b1a7aea234183be4dbd52ec6e1bd1ad2d4  /home/eric/Downloads/dsvfms.20151016-103825.hprof.gz

/ waar	, 
[eric@localhost bin]$ cat dsvfms-ssh-t.sh 
#!/bin/bash
ssh mposerv11 "$@"

[eric@localhost lib]$ gunzip ~/Downloads/dsvfms.20151016-103825.hprof.gz 

/ we kunnen gunzip overal call	, de unzipped file verschijnt in dezelfde dir als waar hij was	, en vervangt de zip file ook	,

/ 13	. 

[eric@localhost 2015.03]$ sudo yum install visualvm

======================================================================================================================================
 Package                              Arch                 Version                                        Repository             Size
======================================================================================================================================
Installing:
 visualvm                             x86_64               1.3.3-1.3.7.fc20.1                             fedora                4.2 M
Installing for dependencies:
 bea-stax-api                         noarch               1.2.0-8.fc20                                   fedora                 31 k
 felix-bundlerepository               noarch               1.6.6-15.fc20                                  fedora                108 k
 felix-framework                      noarch               4.2.1-4.fc20                                   fedora                482 k
 felix-gogo-command                   noarch               0.12.0-9.fc20                                  fedora                 58 k
 felix-gogo-runtime                   noarch               0.10.0-10.fc20                                 fedora                 73 k
 felix-gogo-shell                     noarch               0.10.0-9.fc20                                  fedora                 56 k
 felix-main                           noarch               4.2.0-4.fc20                                   fedora                493 k
 felix-osgi-compendium                noarch               1.4.0-16.fc20                                  fedora                190 k
 felix-osgi-core                      noarch               1.4.0-14.fc20                                  fedora                 97 k
 felix-osgi-foundation                noarch               1.2.0-14.fc20                                  fedora                216 k
 felix-osgi-obr                       noarch               1.0.2-11.fc20                                  fedora                 23 k
 felix-shell                          noarch               1.4.3-4.fc20                                   fedora                 65 k
 felix-utils                          noarch               1.2.0-3.fc20                                   fedora                 67 k
 isorelax                             noarch               1:0-0.14.release20050331.fc20                  fedora                 75 k
 javahelp2                            noarch               2.0.05-15.fc20                                 fedora                552 k
 jna                                  x86_64               4.1.0-7.fc20                                   updates               199 k
 jna-contrib                          noarch               4.1.0-7.fc20                                   updates               584 k
 kxml                                 noarch               2.3.0-3.fc20                                   fedora                151 k
 msv-xsdlib                           noarch               1:2013.5.1-6.fc20                              fedora                219 k
 netbeans-platform                    x86_64               1:7.0.1-9.fc20                                 fedora                3.7 M
 relaxngDatatype                      noarch               1.0-11.5.fc20                                  fedora                 15 k
 stax2-api                            noarch               3.1.1-8.fc20                                   fedora                165 k
 swing-layout                         noarch               1.0.4-8.fc20                                   fedora                 71 k
 woodstox-core                        noarch               4.2.0-2.fc20                                   fedora                490 k
 xpp3                                 noarch               1.1.3.8-10.fc20                                fedora                336 k

/ Geef	,
[eric@localhost 2015.03]$ jvisualvm 
...

/ 13	. 


/ Lees	,
http://www.vogella.com/tutorials/EclipseMemoryAnalyzer/article.html

https://eclipse.org/mat/
/ click Getting Started	,
http://wiki.eclipse.org/index.php/MemoryAnalyzer
/ Click onder 'Getting Started', download page	,
http://www.eclipse.org/mat/downloads.php
/ we zien Stand-alone Eclipse RCP Applications	,
/ kies x86_64	,
[eric@localhost MemoryAnalyzer]$ pwd
/home/eric/Devel/Java/MemoryAnalyzer
[eric@localhost MemoryAnalyzer]$ unzip  ~/Downloads/MemoryAnalyzer-1.5.0.20150527-linux.gtk.x86_64.zip 

[eric@localhost mat]$ pwd
/home/eric/Devel/Java/MemoryAnalyzer/mat
[eric@localhost mat]$ cat MemoryAnalyzer.ini 
-Xmx4096m
[eric@localhost mat]$ ./MemoryAnalyzer 
/ click 'Open a heap dump'	,
/ Kies in ~/Downloads/ de .hprof file	,
/ Duurt lang de 1ste keer	,
/ check in nieuw window  'Leak Suspects Report'	,
/ we zien onder de chart 'Problem suspect 1'	, 
/ click Details	,
/ we zien 1 entry highlighted	, met Shallow heap 120	, de max WH	, Dubbel click	,
/ Kies Java basics, thread details,	
DeferredEventIdentifierCacheRefreshTaskTimerFactory
  at java.lang.Object.hashCode()I (Native Method)
  at java.util.HashMap.put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object; (HashMap.java:389)
  at java.util.HashSet.add(Ljava/lang/Object;)Z (HashSet.java:217)
  at org.hibernate.util.IdentityMap.entrySet()Ljava/util/Set; (IdentityMap.java:207)
  at org.hibernate.engine.BatchFetchQueue.getCollectionBatch(Lorg/hibernate/persister/collection/CollectionPersister;Ljava/io/Serializable;ILorg/hibernate/EntityMode;)[Ljava/io/Serializable; (BatchFetchQueue.java:178)
  at org.hibernate.loader.collection.BatchingCollectionInitializer.initialize(Ljava/io/Serializable;Lorg/hibernate/engine/SessionImplementor;)V (BatchingCollectionInitializer.java:73)
  at org.hibernate.persister.collection.AbstractCollectionPersister.initialize(Ljava/io/Serializable;Lorg/hibernate/engine/SessionImplementor;)V (AbstractCollectionPersister.java:627)
  at org.hibernate.event.def.DefaultInitializeCollectionEventListener.onInitializeCollection(Lorg/hibernate/event/InitializeCollectionEvent;)V (DefaultInitializeCollectionEventListener.java:83)
  at org.hibernate.impl.SessionImpl.initializeCollection(Lorg/hibernate/collection/PersistentCollection;Z)V (SessionImpl.java:1863)
  at org.hibernate.collection.AbstractPersistentCollection.forceInitialization()V (AbstractPersistentCollection.java:479)
  at org.hibernate.Hibernate.initialize(Ljava/lang/Object;)V (Hibernate.java:417)
  at org.springframework.orm.hibernate3.HibernateTemplate.initialize(Ljava/lang/Object;)V (HibernateTemplate.java:642)
  at com.mpobjects.event.dao.DeferredEventDAOImpl.findEventsByStatus(Lcom/mpobjects/event/model/DeferredEventStatus;)Ljava/util/List; (DeferredEventDAOImpl.java:67)
  at sun.reflect.NativeMethodAccessorImpl.invoke0(Ljava/lang/reflect/Method;Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object; (Native Method)
  at sun.reflect.NativeMethodAccessorImpl.invoke(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object; (NativeMethodAccessorImpl.java:57)
  at sun.reflect.DelegatingMethodAccessorImpl.invoke(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object; (DelegatingMethodAccessorImpl.java:43)
  at java.lang.reflect.Method.invoke(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object; (Method.java:622)
  at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(Ljava/lang/Object;Ljava/lang/reflect/Method;[Ljava/lang/Object;)Ljava/lang/Object; (AopUtils.java:317)
  at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint()Ljava/lang/Object; (ReflectiveMethodInvocation.java:183)
  at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed()Ljava/lang/Object; (ReflectiveMethodInvocation.java:150)
  at org.springframework.aop.framework.adapter.MethodBeforeAdviceInterceptor.invoke(Lorg/aopalliance/intercept/MethodInvocation;)Ljava/lang/Object; (MethodBeforeAdviceInterceptor.java:51)
  at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed()Ljava/lang/Object; (ReflectiveMethodInvocation.java:161)
  at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation()Ljava/lang/Object; (TransactionInterceptor.java:96)
  at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(Ljava/lang/reflect/Method;Ljava/lang/Class;Lorg/springframework/transaction/interceptor/TransactionAspectSupport$InvocationCallback;)Ljava/lang/Object; (TransactionAspectSupport.java:260)
  at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(Lorg/aopalliance/intercept/MethodInvocation;)Ljava/lang/Object; (TransactionInterceptor.java:94)
  at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed()Ljava/lang/Object; (ReflectiveMethodInvocation.java:172)
  at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(Lorg/aopalliance/intercept/MethodInvocation;)Ljava/lang/Object; (ExposeInvocationInterceptor.java:91)
  at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed()Ljava/lang/Object; (ReflectiveMethodInvocation.java:172)
  at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(Ljava/lang/Object;Ljava/lang/reflect/Method;[Ljava/lang/Object;)Ljava/lang/Object; (JdkDynamicAopProxy.java:204)
  at com.sun.proxy.$Proxy369.findEventsByStatus(Lcom/mpobjects/event/model/DeferredEventStatus;)Ljava/util/List; (Unknown Source)
  at com.mpobjects.event.dao.DeferredEventIdentifierCache.initialize()V (DeferredEventIdentifierCache.java:78)
  at com.mpobjects.event.dao.DeferredEventIdentifierCache.<init>()V (DeferredEventIdentifierCache.java:36)
  at com.mpobjects.event.dao.DeferredEventIdentifierCache.getInstance()Lcom/mpobjects/event/dao/DeferredEventIdentifierCache; (DeferredEventIdentifierCache.java:41)
  at com.mpobjects.event.service.DeferredEventIdentifierCacheRefreshTask.run()V (DeferredEventIdentifierCacheRefreshTask.java:28)
  at sun.reflect.NativeMethodAccessorImpl.invoke0(Ljava/lang/reflect/Method;Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object; (Native Method)
  at sun.reflect.NativeMethodAccessorImpl.invoke(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object; (NativeMethodAccessorImpl.java:57)
  at sun.reflect.DelegatingMethodAccessorImpl.invoke(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object; (DelegatingMethodAccessorImpl.java:43)
  at java.lang.reflect.Method.invoke(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object; (Method.java:622)
  at org.springframework.util.MethodInvoker.invoke()Ljava/lang/Object; (MethodInvoker.java:269)
  at org.springframework.scheduling.support.MethodInvokingRunnable.run()V (MethodInvokingRunnable.java:65)
  at org.springframework.scheduling.timer.DelegatingTimerTask.run()V (DelegatingTimerTask.java:70)
  at java.util.TimerThread.mainLoop()V (Timer.java:534)
  at java.util.TimerThread.run()V (Timer.java:484)
 
/ Deze staat ook in ticket dsvsol-2739	,

/ 7	. 

/ we build 2015.03 locally	, 

/ 13	. 

////////////////////
/ Als we willen import in eclipse	, moet het project een .project file hebben	,

//////////////////////////////
/ Het verschil of we .classpath add of niet is 
right click project	, Build path, Configure	, 

[eric@localhost workspace]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace

[eric@localhost workspace]$ cp 2015.01/.project 2015.03/
[eric@localhost workspace]$ cat 2015.03/.project 
<?xml version="1.0" encoding="UTF-8"?>
<projectDescription>
	<name>2015.03</name>
...

[eric@localhost workspace]$ cp 2015.01/.classpath 2015.03
/ TODO (edit?)

[eric@localhost workspace]$ cp 2015.01/application.properties 2015.03
[eric@localhost workspace]$ vi 2015.03/application.properties 
base.product=dsvfms

build.war.dir = /home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/${base.product}/deploy/tms.war/
jboss.configuration = ${base.product}

jboss.home=/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA
ant.home=/usr/share/ant

/ we zien bij build path	,
2015.03/base-framework/build/generate/java (missing)
/ TODO

[eric@localhost server]$ cp -a dsvfms/ dsvfms-2015.03
[eric@localhost server]$ mv dsvfms dsvfms-2014.0x.0x
[eric@localhost server]$ mv dsvfms-2015.03/ dsvfms

[eric@localhost deploy]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/dsvfms/deploy
[eric@localhost deploy]$ cat dsvfms-schedule-service.xml 
<?xml version="1.0" encoding="UTF-8"?>
<server>
        <mbean code="org.jboss.varia.scheduler.Scheduler" name=":service=DsvFmsInterfaces">
...

[eric@localhost deploy]$ cat firebird-ds.xml 
<?xml version="1.0" encoding="UTF-8"?>

 <datasources>
   <local-tx-datasource>
     <jndi-name>tmsdevDS</jndi-name>
	<connection-url>jdbc:firebirdsql://127.0.0.1//home/eric/DB_TAP/Firebird/Dsvfms/dsvfms.fdb_20151019-000019.fdb?no_result_set_tracking&amp;defaultResultSetHoldable=true</connection-url>
     <driver-class>org.firebirdsql.jdbc.FBDriver</driver-class>
     <user-name>SYSDBA</user-name>
     <password>masterkey</password>

/ 13	. 

/ we hebben rm	,
[eric@localhost deploy]$ vi dsvfms-schedule-service.xml 
                <depends>jboss.j2ee:jndiName=ejb/EventHandlerFacade,service=EJB</depends>


/ 7	. 

/ we moesten .classpath aanpassen	,
/ we hadden die van 2015.01 cp 	, 
$ vi .classpath

    <classpathentry kind="src" path="module/dataexport/src/java"/>
/ Add
    <classpathentry kind="src" path="module/tax/src/java"/>
/ Add

   	<classpathentry kind="con" path="org.dbpowder.plugins.LIB_CONTAINER/recurse~project/2015.03/base-framework/core/lib/jar"/>
/ 2015.01-> 2015.03
    <classpathentry kind="con" path="org.dbpowder.plugins.LIB_CONTAINER/recurse~project/2015.03/base-framework/buildscripts/build-lib"/>
/ 2015.01-> 2015.03
    <classpathentry kind="con" path="org.dbpowder.plugins.LIB_CONTAINER/recurse~project/2015.03/module/interfacing/lib"/>
/ 2015.01-> 2015.03

/ Nu Geen problems meer	,



/ 7	. 

/ java reports	,

$ vi dsvfms-menu.xml
	<m:add path="finance.revenue.berekeningsformulier" actionUrl="dsvfms/report_dsv_excel_berekeningsformulier_input" privilege="dsv-report.list" index="5700" />
	<m:add path="finance.revenue.warehouseMatching" actionUrl="dsvfms/report_dsv_excel_warehouse_matching_input" privilege="dsv-report.list" index="5700" />


/ 7	. 

/ we kijken op acc	, dsvfms	,

/ Maar dit is 2013.04	, 
/ een ander menu als 2015.03	,

$ dsvfms-ssh-a.sh
...
[jboss@application-a dsvfms]$ pwd
/local/apps/jboss-4.0.5.GA/server/dsvfms
[jboss@application-a dsvfms]$  grep base\.release conf/application.properties
base.release=2013.04

[jboss@application-a dsvfms]$ vi deploy/dsvfms.war/menu.xml 
            <menuItem index="5605">
              <labelId>shipmentOrderRecalc</labelId>
              <module>invoice</module>
              <parent reference="../../.."/>
              <path>finance.revenue.shipmentOrderRecalc</path>
              <privilege>shipment-order-price.recalculate</privilege>
              <type>ITEM</type>
              <url>wicket/?module=invoice&amp;wicketpage=batchrecalc.ShipmentOrderBatchRecalc&amp;emptySession=true</url>
              <visibilityExpr></visibilityExpr>
            </menuItem>
            <menuItem index="5610">
              <labelId>shipmentOrderPrice</labelId>
              <module>oms</module>
              <parent reference="../../.."/>
              <path>finance.revenue.shipmentOrderPrice</path>
              <privilege>invoice.report</privilege>
              <type>ITEM</type>
              <url>oms/report_shipment_order_price_input?emptySession=true</url>
              <visibilityExpr></visibilityExpr>
            </menuItem>
            <menuItem index="5620">
              <labelId>shipmentOrderMargin</labelId>
              <module>oms</module>
              <parent reference="../../.."/>
              <path>finance.revenue.shipmentOrderMargin</path>
              <privilege>invoice.report</privilege>
              <type>ITEM</type>
              <url>oms/report_shipment_order_margin_input?emptySession=true</url>
              <visibilityExpr></visibilityExpr>
            </menuItem>
            <menuItem index="5700">
              <labelId>berekeningsformulier</labelId>
              <module>dsvfms</module>
              <parent reference="../../.."/>
              <path>finance.revenue.berekeningsformulier</path>
              <privilege>dsv-report.list</privilege>
              <type>ITEM</type>
              <url>dsvfms/report_dsv_excel_berekeningsformulier_input?emptySession=true</url>
              <visibilityExpr></visibilityExpr>
            </menuItem>
            <menuItem index="5700">
              <labelId>berekeningsformulierInv</labelId>
              <module>dsvfms</module>
              <parent reference="../../.."/>
              <path>finance.revenue.berekeningsformulierInv</path>
              <privilege>dsv-report.list</privilege>
              <type>ITEM</type>
              <url>dsvfms/report_dsv_excel_invoice_input?emptySession=true</url>
              <visibilityExpr></visibilityExpr>
            </menuItem>
            <menuItem index="5700">
              <labelId>warehouseMatching</labelId>
              <module>dsvfms</module>
              <parent reference="../../.."/>
              <path>finance.revenue.warehouseMatching</path>
              <privilege>dsv-report.list</privilege>
              <type>ITEM</type>
              <url>dsvfms/report_dsv_excel_warehouse_matching_input?emptySession=true</url>
              <visibilityExpr></visibilityExpr>
            </menuItem>
          </children>

/ Dus we zien	,
              <url>wicket/?module=invoice&amp;wicketpage=batchrecalc.ShipmentOrderBatchRecalc&amp;emptySession=true</url>
              <url>oms/report_shipment_order_price_input?emptySession=true</url>
              <url>oms/report_shipment_order_margin_input?emptySession=true</url>
              <url>dsvfms/report_dsv_excel_berekeningsformulier_input?emptySession=true</url>
              <url>dsvfms/report_dsv_excel_invoice_input?emptySession=true</url>
              <url>dsvfms/report_dsv_excel_warehouse_matching_input?emptySession=true</url>

/ 7	.

/ CHANGE SHIPMENT ITEM ID 

/ Nu local	, 
/ we hebben een deployment gedaan	, 
[eric@localhost dsvfms]$ grep base\.release conf/application.properties 
base.release=2015.03

$ vi deploy/tms.war/menu.xml

           <menuItem index="5610">
              <labelId>shipmentOrderPrice</labelId>
              <module>oms</module>
              <parent reference="../../.."/>
              <path>finance.revenue.shipmentOrderPrice</path>
              <privilege>invoice.report</privilege>
              <type>ITEM</type>
              <url>oms/report_shipment_order_price_input?emptySession=true</url>
              <visibilityExpr></visibilityExpr>
            </menuItem>
            <menuItem index="5620">
              <labelId>shipmentOrderMargin</labelId>
              <module>oms</module>
              <parent reference="../../.."/>
              <path>finance.revenue.shipmentOrderMargin</path>
              <privilege>invoice.report</privilege>
              <type>ITEM</type>
              <url>oms/report_shipment_order_margin_input?emptySession=true</url>
              <visibilityExpr></visibilityExpr>
            </menuItem>
            <menuItem index="5700">
              <labelId>berekeningsformulier</labelId>
              <module>dsvfms</module>
              <parent reference="../../.."/>
              <path>finance.revenue.berekeningsformulier</path>
              <privilege>dsv-report.list</privilege>
              <type>ITEM</type>
              <url>dsvfms/report_dsv_excel_berekeningsformulier_input?emptySession=true</url>
              <visibilityExpr></visibilityExpr>
            </menuItem>
            <menuItem index="5700">
              <labelId>berekeningsformulierInv</labelId>
              <module>dsvfms</module>
              <parent reference="../../.."/>
              <path>finance.revenue.berekeningsformulierInv</path>
              <privilege>dsv-report.list</privilege>
              <type>ITEM</type>
              <url>dsvfms/report_dsv_excel_invoice_input?emptySession=true</url>
              <visibilityExpr></visibilityExpr>
            </menuItem>
           <menuItem index="5700">
              <labelId>warehouseMatching</labelId>
              <module>dsvfms</module>
              <parent reference="../../.."/>
              <path>finance.revenue.warehouseMatching</path>
              <privilege>dsv-report.list</privilege>
              <type>ITEM</type>
              <url>dsvfms/report_dsv_excel_warehouse_matching_input?emptySession=true</url>
              <visibilityExpr></visibilityExpr>
            </menuItem>

/ we zien	,

              <labelId>shipmentOrderPrice</labelId>
              <url>oms/report_shipment_order_price_input?emptySession=true</url>
/ jReport

              <labelId>shipmentOrderMargin</labelId>
              <url>oms/report_shipment_order_margin_input?emptySession=true</url>
/ jReport

              <labelId>berekeningsformulier</labelId>
              <url>dsvfms/report_dsv_excel_berekeningsformulier_input?emptySession=true</url>
        			<custom-class>com.mpobjects.dsvfms.view.report.DsvFmsBerekeningsformulierExcelCreator</custom-class>

              <labelId>berekeningsformulierInv</labelId>
              <url>dsvfms/report_dsv_excel_invoice_input?emptySession=true</url>
        			<custom-class>com.mpobjects.dsvfms.view.report.DsvFmsBerekeningsformulierInvExcelCreator</custom-class>

              <labelId>warehouseMatching</labelId>
              <url>dsvfms/report_dsv_excel_warehouse_matching_input?emptySession=true</url>
        			<custom-class>com.mpobjects.dsvfms.view.report.DsvFmsWareHouseMatchingReportExcelCreator</custom-class>

/ we moeten kijken in files die zonder report_ beginnen	,
./deploy/tms.war/dsvfms/report/dsv_excel_berekeningsformulier-input.xml
./deploy/tms.war/dsvfms/report/dsv_excel_invoice-input.xml
./deploy/tms.war/dsvfms/report/dsv_excel_warehouse_matching-input.xml

/ Let op	, grep werkt op een list van files, of als die er niet is op stdin 
/ dus moeten we $(find ...), die een list van files geeft,	 en <(...) omdat grep dan van stdin moet read	,	
[eric@localhost 2013.04.01]$ grep -i matching <(grep  -i warehouse $(find -name "*menu*.xml" ))
./dsvfms/dsvfms/dsvfms-menu.xml:	<m:add path="finance.revenue.warehouseMatching" actionUrl="dsvfms/report_dsv_excel_warehouse_matching_input" privilege="dsv-report.list" index="5700" />

$ vi 2015.03/dsvfms/dsvfms/src/java/com/mpobjects/dsvfms/view/report/DsvFmsBerekeningsformulierExcelCreator.java 
/ No shipmentItemId	,
$ vi 2015.03/dsvfms/dsvfms/src/java/com/mpobjects/dsvfms/view/report/DsvFmsBerekeningsformulierInvExcelCreator.java 
/ No shipmentItemId	,
$ vi ./dsvfms/dsvfms/src/java/com/mpobjects/dsvfms/view/report/DsvFmsWareHouseMatchingReportExcelCreator.java 
/ No shipmentItemId ,

/ we kijken ook in	,
$ vi shipment_order_price_input.xml
<report name="shipment_order_price.jrxml" caption="Shipment Order Price">

$ vi shipment_order_price.jrxml
/ No shipment_item_id

/ we kijken ook in	,
$ vi shipment_order_margin_input.xml
<report name="shipment_order_margin.jrxml" caption="Shipment Order Margin">

$ vi shipment_order_margin.jrxml
/ No shipment_item_id


$ vi dsvfms-sitemap.xmap

			<map:match pattern="dsvfms/report_**_input">
				<map:aggregate element="total-report">
					<map:part src="cocoon:/generate-report-{1}" />
					<map:part src="cocoon:/userInfo" />
				</map:aggregate>
				<map:transform type="defaultresolver" />
				<map:transform src="../core/xsl/report-input.xsl" />
				<map:serialize type="html" />
			</map:match>
/ TODO

/ we moeten naar de menu item kijken	, en gewoon doen	,

[eric@localhost dsvfms]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/dsvfms
[eric@localhost dsvfms]$ vi deploy/tms.war/menu.xml 
....

$ vi 2015.03/dsvfms/dsvfms/war/dsvfms/report/dsv_excel_berekeningsformulier-input.xml 
        <custom-class>com.mpobjects.dsvfms.view.report.DsvFmsBerekeningsformulierExcelCreator</custom-class>

$ vi ShipmentItem.standard.hbm.xml
	<class name="com.mpobjects.oms.model.shipmentorder.vo.ShipmentItemVO" .. table="SHIPMENT_ITEM">
		<property name="shipmentItemId" type="string" unique="true">
			<column name="SHIPMENT_ITEM_ID" length="80" />
		</property>

/7	. 

/ berekeningsformulier	,

/ Kies 1 dag	, dus Start Date en End Date gelijk	,


/ ga naar	,
http://application-a.intermax.mp-objects.com:8180
/ click JMX console
/ Ga naar 
jboss.system
type=ServerInfo
/ click
java.lang.String listThreadDump()
/ click 
/ Zoek naar Berekeningsformulier	, 
com.mpobjects.dsvfms.view.report.DsvFmsBerekeningsformulierExcelCreator.writeBytes(DsvFmsBerekeningsformulierExcelCreator.java:102)


http://application-a.intermax.mp-objects.com:8180/jmx-console/HtmlAdaptor?action=inspectMBean&name=jboss.system%3Atype%3DServerInfo
/ In JBoss	,

[eric@localhost reports]$ ls
dsv-berekeningsformulier_29-Oct-2015.xls      dsv-warehouse-matching-report_29-Oct-2015.xls
dsv-berekeningsformulier-INV_29-Oct-2015.xls


/ Einde CHANGE SHIPMENT ITEM ID 

/ FIX CHANGE SHIPMENT ITEM ID 

[eric@localhost dsvfms]$ pwd
/home/eric/Devel/Firebird/scripts/dsvfms
$ cp -a local test
$ cd test
[eric@localhost dsvfms]$ for f in $(find -name "*.sh");do awk '/^isql-fb/{$0="isql-fb -u sysdba -p masterkey mposerv8:/local/apps/firebird/dsvfms.fdb <<SQL"}{print}' "$f"  >tmp;mv tmp "$f";done
[eric@localhost dsvfms]$ chmod u+x $(find -name "*.sh")

eric@localhost test]$ cat def_drops2.sh 
#!/usr/bin/bash
isql-fb -u sysdba -p masterkey mposerv8:/local/apps/firebird/dsvfms.fdb
...

/ we doen	,
[eric@localhost test]$ ./def_drops2.sh 

///////////////////
/ de backup voor de shi id unique	, en pro item id's unique	,
eric@mposerv8:/backup/mpo-backup/db$ pwd
/backup/mpo-backup/db
-rw-rw-r-- 1 mpo-backup mpo-backup 7365378907 Oct 29 02:31 dsvfms.fdb_20151029-000016.fbk.gz

[eric@localhost test]$ ./def_rm_dups_shi_fms.sh 

[eric@localhost bin]$ dsvfms-db-t.sh 
SQL> show procedures;
Procedure Name                    Invalid Dependency, Type
================================= ======= =====================================
DROP_PROCEDURE_IF_EXISTS                  RDB$PROCEDURES, Table
DROP_RELATION_IF_EXISTS                   RDB$RELATIONS, Table
RM_SHIPMENT_ITEM_ID_DUPS                  SHIPMENT_ITEM, Table

[eric@localhost test]$ ./exec_rm_dups_shi_fms.sh 
/ OK
[eric@localhost test]$ ./exec_chk_rm_dups_shi_fms_2.sh 
[eric@localhost test]$ ./exec_chk_rm_dups_shi_fms_2.sh 


/ Einde FIX CHANGE SHIPMENT ITEM ID 

/ 7.	 

/ FIX CHANGE PRODUCT ITEM ID 

/ product item id	,

[eric@localhost dsvfms]$ local-db.sh /home/eric/DB_TAP/Firebird/Dsvfms/dsvfms.fdb_20151019-000019.fdb 

$ vi ProductItem.standard.hbm.xml
	<class name="com.mpobjects.oms.model.shipmentorder.vo.ProductItemVO" table="TMS_PRODUCT_ITEM" lazy="false">
		<property name="productItemId" type="string" unique-key="sho_prIt_uk">
			<column name="PRODUCT_ITEM_ID" length="80" />
		</property>

$ vi ProductItemVO.java
	public String getId() {
		return getProductItemId();
	}
	public String getProductItemId() {
		return theProductItemId;
	}
	public String getStringSequence() {
		return getProductItemId();
	}

$ vi 2015.03/dsvfms/dsvfms/src/java/com/mpobjects/dsvfms/view/report/DsvFmsBerekeningsformulierExcelCreator.java 
	private void createRowsForShipmentOrder(HSSFSheet aSheet, ShipmentOrderVO anOrderVO, boolean isFollowUp, ProductItemVO aProductItem, String aFirstProductItemId) throws Exception {
		} else {
			myHssfCell.setCellValue(new HSSFRichTextString("tog with " + aFirstProductItemId));
/ MULTIPLE TIMES

$ vi 2015.03/dsvfms/dsvfms/src/java/com/mpobjects/dsvfms/view/report/DsvFmsBerekeningsformulierInvExcelCreator.java 
	private void createRow(ShipmentOrderVO aShipmentOrder, ProductItemVO aProductItem) {
		if (myCustomerOrderLine == null) {
			String myMessage = "Order has no customer order line attached [" + aShipmentOrder.getShipmentOrderId() + " - " + aProductItem.getProductItemId()
					+ "]";
/ ONE TIME IN LOG STMT

$ vi ./dsvfms/dsvfms/src/java/com/mpobjects/dsvfms/view/report/DsvFmsWareHouseMatchingReportExcelCreator.java 
	private void createRow(DsvFmsWareHouseMatchingReportLine aLine, ProductItemVO aProductItem) {
		if (myCustomerOrderLine == null) {
			String myMessage = "Order has no customer order line attached [" + aLine.getShipmentOrderId() + " - " + aProductItem.getProductItemId() + "]";
/ ONE TIME IN LOG STMT

QL> select count(*) from tms_product_item;

       COUNT 
============ 
     2107753 

/ we doen	, 
select SHIPMENT_ORDER_SYSTEMID, PRODUCT_ITEM_ID,PART_NUMBER,count(PRODUCT_ITEM_ID)from TMS_PRODUCT_ITEM group by SHIPMENT_ORDER_SYSTEMID, PRODUCT_ITEM_ID,PART_NUMBER having count(PRODUCT_ITEM_ID)>1; 
SHIPMENT_ORDER_SYSTEMID PRODUCT_ITEM_ID                                                                  PART_NUMBER                                                                             COUNT 
======================= =============================================================================== =============================================================================== ============ 
               97675042 39355                                                                            39355                                                                                       2 
               99163789 NMA201A010311004                                                                 NMA201A010311004                                                                            3 
...

/ we zien dus dat de product_item_id column niet OK is	, en gelijk is aan de part_number 	,
/ we hebben een Jira create, DSVSOL-2750	, voor integration	, 
/ Dit is voor acc	, op test is er geen integration	, dus kunnen we de database repair	, maar moeten we wel rapporten aanpassen, waar product_item_id staat moeten we part_number set	,

/ 7	. 

$ ls -ltr ~/Downloads
-rw-r-----. 1 eric eric       5634 Oct 28 16:50 dsv-warehouse-matching-report_28-Oct-2015.xls
-rw-r-----. 1 eric eric     293378 Oct 29 07:56 dsv-berekeningsformulier_29-Oct-2015.xls
-rw-r-----. 1 eric eric       5634 Oct 29 07:58 dsv-berekeningsformulier-INV_29-Oct-2015.xls
-rw-r-----. 1 eric eric       5634 Oct 29 07:58 dsv-warehouse-matching-report_29-Oct-2015.xls

/ 7	. 

/ Vervang in de reports product_item_id door part_number	,

$ vi ProductItem.standard.hbm.xml
	<class name="com.mpobjects.oms.model.shipmentorder.vo.ProductItemVO" table="TMS_PRODUCT_ITEM" lazy="false">
		<property name="productItemId" type="string" unique-key="sho_prIt_uk">
			<column name="PRODUCT_ITEM_ID" length="80" />
		</property>

$ vi ProductItemVO.java

	public String getId() {
		return getProductItemId();
	}
	public String getProductItemId() {
		return theProductItemId;
	}
	@Override
	public String getStringSequence() {
		return getProductItemId();
	}

/ we moeten kijken in files die zonder report_ beginnen	,
./deploy/tms.war/dsvfms/report/dsv_excel_berekeningsformulier-input.xml
./deploy/tms.war/dsvfms/report/dsv_excel_invoice-input.xml
./deploy/tms.war/dsvfms/report/dsv_excel_warehouse_matching-input.xml

/ 13	. 

./deploy/tms.war/dsvfms/report/dsv_excel_berekeningsformulier-input.xml
$ vi 2015.03/dsvfms/dsvfms/src/java/com/mpobjects/dsvfms/view/report/DsvFmsBerekeningsformulierExcelCreator.java 

	private void createInvoiceDetails(HSSFSheet mySheet) throws Exception {
					createRowsForShipmentOrder(mySheet, myOrderVO, !isFirst, myProductItem, myFirstProductItem.getReference3());
/s
	private void createRowsForShipmentOrder(HSSFSheet aSheet, ShipmentOrderVO anOrderVO, boolean isFollowUp, ProductItemVO aProductItem, String aFirstProductItemId) throws Exception {
//////////////////
/ Dus aFirstProductItemId= myFirstProductItem.getReference3()
/ en NIET getProdcutItemId()

/ we veranderen alleen	,
	private void createRowsForShipmentOrder(HSSFSheet aSheet, ShipmentOrderVO anOrderVO, boolean isFollowUp, ProductItemVO aProductItem, String aFirstProductItemId) throws Exception {
		if (myCustomerOrderLine == null) {
			String myMessage = "Order has no customer order line attached [" + anOrderVO.getShipmentOrderId() + " - " + aProductItem.getProductItemId() + "]";
/ In	,
		if (myCustomerOrderLine == null) {
			String myMessage = "Order has no customer order line attached [" + aShipmentOrder.getShipmentOrderId() + " - " + aProductItem.getPartNumber() + "]";

/ 13	. 

./deploy/tms.war/dsvfms/report/dsv_excel_invoice-input.xml
        <custom-class>com.mpobjects.dsvfms.view.report.DsvFmsBerekeningsformulierInvExcelCreator</custom-class>
$ vi DsvFmsBerekeningsformulierInvExcelCreator.java

		CustomerOrderLine myCustomerOrderLine = aProductItem.getCustomerOrderLine();
		if (myCustomerOrderLine == null) {
			String myMessage = "Order has no customer order line attached [" + aShipmentOrder.getShipmentOrderId() + " - " + aProductItem.getProductItemId()
					+ "]";
/ in	,
		if (myCustomerOrderLine == null) {
			String myMessage = "Order has no customer order line attached [" + aShipmentOrder.getShipmentOrderId() + " - " + aProductItem.getPartNumber() + "]";

/ 13	. 

./deploy/tms.war/dsvfms/report/dsv_excel_warehouse_matching-input.xml

$ vi DsvFmsWareHouseMatchingReportExcelCreator.java  
		if (myCustomerOrderLine == null) {
			String myMessage = "Order has no customer order line attached [" + aLine.getShipmentOrderId() + " - " + aProductItem.getPartNumber() + "]";


/ we kijken ook in	,
$ vi shipment_order_price_input.xml
<report name="shipment_order_price.jrxml" caption="Shipment Order Price">

$ vi shipment_order_price.jrxml
/ Geen product_item_id

/ we kijken ook in	,
$ vi shipment_order_margin_input.xml
<report name="shipment_order_margin.jrxml" caption="Shipment Order Margin">

$ vi shipment_order_margin.jrxml
/ No product_item_id

/ Deze reports zijn ui dsvfms acc	,
[eric@localhost reports]$ pwd
/home/eric/DB_TAP/Firebird/Dsvfms/reports
[eric@localhost reports]$ ls
dsv-berekeningsformulier_29-Oct-2015.xls      dsv-warehouse-matching-report_29-Oct-2015.xls
dsv-berekeningsformulier-INV_29-Oct-2015.xls

/ 7	. 

/ Eerst local	,

[eric@localhost local]$  pwd
/home/eric/Devel/Firebird/scripts/dsvfms/local

[eric@localhost local]$ cat exec_chk_rm_dups_pri_fms_2.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey /home/eric/DB_TAP/Firebird/Dsvfms/dsvfms.fdb_20151019-000019.fdb <<SQL

select shipment_order_systemid, product_item_id, part_number,count(product_item_id)
from tms_product_item 
group by shipment_order_systemid, product_item_id,part_number
having count(product_item_id)>1 ;

rollback;
SQL

[eric@localhost local]$ cat def_rm_dups_pri_fms.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey /home/eric/DB_TAP/Firebird/Dsvfms/dsvfms.fdb_20151019-000019.fdb <<SQL

execute procedure drop_procedure_if_exists('RM_TMS_PRODUCT_ITEM_ID_DUPS');
commit;

set term ^;
create procedure rm_tms_product_item_id_dups as
declare a int;
begin
    update tms_product_item
    set product_item_id=0;

    for select distinct shipment_order_systemid 
	from tms_product_item 
	into :a do
    begin
        update tms_product_item
        set product_item_id=cast((	
			select max(cast(product_item_id as int))
			from tms_product_item 
			where shipment_order_systemid=:a)
		as int)+1
        where shipment_order_systemid=:a;
    end
end^

set term ;^
commit;
SQL

[eric@localhost local]$ cat  exec_rm_dups_pri_fms.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey /home/eric/DB_TAP/Firebird/Dsvfms/dsvfms.fdb_20151019-000019.fdb <<SQL

execute procedure rm_tms_product_item_id_dups;
commit;
SQL

/ Eerst	,
[eric@localhost local]$ ./exec_chk_rm_dups_pri_fms_2.sh 
SHIPMENT_ORDER_SYSTEMID PRODUCT_ITEM_ID                                                                  PART_NUMBER                                                                             COUNT 
======================= =============================================================================== =============================================================================== ============ 
               97675042 39355                                                                            39355                                                                                       2 
               99069850 HPE1281120312001                                                                 HPE1281120312001       
...

[eric@localhost local]$ ./def_rm_dups_pri_fms.sh 
[eric@localhost local]$ ./exec_rm_dups_pri_fms.sh 
[eric@localhost local]$ ./exec_chk_rm_dups_pri_fms_2.sh 
/ NIETS	, 
/ OK

/ check met de hand	,
select shipment_order_systemid, product_item_id, part_number
from tms_product_item
where shipment_order_systemid=97675042;

SHIPMENT_ORDER_SYSTEMID PRODUCT_ITEM_ID                                                                  PART_NUMBER                                                                      
======================= =============================================================================== =============================================================================== 
               97675042 1                                                                                39355                                                                            
               97675042 2                                                                                39355                  
/ OK

[eric@localhost local]$ cp -a $(find -name "*pri*sh") ../test/

/ Op test	,

[eric@localhost test]$ cat set_db_location_in_all_scripts.sh 
#!/usr/bin/bash

for f in $(find -name "*.sh");do awk '/^isql-fb/{$0="isql-fb -u sysdba -p masterkey mposerv8:/local/apps/firebird/dsvfms.fdb <<SQL"}{print}' "$f"  >tmp;mv tmp "$f";chmod u+x "$f";done

[eric@localhost test]$ ./exec_chk_rm_dups_pri_fms_2.sh 
[eric@localhost test]$ ./def_rm_dups_pri_fms.sh 
[eric@localhost test]$ ./exec_rm_dups_pri_fms.sh 
[eric@localhost test]$ ./exec_chk_rm_dups_pri_fms_2.sh 

/ we doen met de hand,	
[eric@localhost bin]$ dsvfms-db-t.sh 
Database:  mposerv8:/local/apps/firebird/dsvfms.fdb, User: sysdba
SQL> select shipment_order_systemid, product_item_id, part_number
CON> from tms_product_item
CON> where shipment_order_systemid=97675042;

SHIPMENT_ORDER_SYSTEMID PRODUCT_ITEM_ID                                                                  PART_NUMBER                                                                      
======================= =============================================================================== =============================================================================== 
               97675042 1                                                                                39355                                                                            
               97675042 2                                                                                39355                                          

/ Eerst local	,

/ We doen met de hand	,

/ PATCH-396-SHI_SHOID_UK.SQL

[eric@localhost local]$ cat exec_patch-396.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey /home/eric/DB_TAP/Firebird/Dsvfms/dsvfms.fdb_20151019-000019.fdb <<SQL

alter table SHIPMENT_ITEM
add constraint SHI_ID_SHO_UK
unique (SHIPMENT_ORDER_SYSTEMID, SHIPMENT_ITEM_ID);

SQL


/ OK
/ Duurt een tijdje	,
/ Check	,
SQL> show table shipment_item;
CONSTRAINT SI_P_FK:
  Foreign key (PARENT_SYSTEMID)    References SHIPMENT_ITEM (SYSTEM_ID) On Delete Set Null

/ we doen met de hand	,

/ PATCH-397-PI_SHOID_UK.SQL 

[eric@localhost local]$ cat exec_patch-397.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey /home/eric/DB_TAP/Firebird/Dsvfms/dsvfms.fdb_20151019-000019.fdb <<SQL

alter table TMS_PRODUCT_ITEM
add constraint TPI_ID_SHO_UK
unique (SHIPMENT_ORDER_SYSTEMID, PRODUCT_ITEM_ID);

SQL

/ OK
/ Duurt heel kort	, 

/ check	,
SQL> show table TMS_PRODUCT_ITEM;
CONSTRAINT TPI_ID_SHO_UK:
  Unique key (SHIPMENT_ORDER_SYSTEMID, PRODUCT_ITEM_ID)

/ we kunnen ook	,
select rdb$index_name 
from rdb$indices
where rdb$relation_name='SHIPMENT_ITEM';

/ Maar het kan nog beter	,
http://www.alberton.info/firebird_sql_meta_info.html#.VjNINXW9-V4
/ TODO

[eric@localhost local]$ cp -a exec_patch-39* ../test

/ Nu op test	,

[eric@localhost test]$ ./set_db_location_in_all_scripts.sh 

[eric@localhost test]$ ./exec_patch-396.sh 
[eric@localhost test]$ ./exec_patch-397.sh 

/ Check	,
[eric@localhost bin]$ dsvfms-db-t.sh 

SQL> show table shipment_order;
CONSTRAINT SHIPMENT_ORDER_ORG_UK:
  Unique key (SHIPMENT_ORDER_ID, ORGANIZATION_SYSTEMID)

SQL> show table tms_product_item;
CONSTRAINT TPI_ID_SHO_UK:
  Unique key (SHIPMENT_ORDER_SYSTEMID, PRODUCT_ITEM_ID)

/ we moeten ook	, local en op test	,

[eric@localhost local]$ cat exec_update_mpo_scs_patch.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey /home/eric/DB_TAP/Firebird/Dsvfms/dsvfms.fdb_20151019-000019.fdb <<SQL

update mpo_scs_patch
set status='MANUALLY_APPLIED'
where name in ('patch-396-shi_shoid_uk.sql','patch-397-pi_shoid_uk.sql');
commit;

SQL

[eric@localhost local]$ cp -a exec_update_mpo_scs_patch.sh ../test
$ cd ../test
[eric@localhost test]$ ./set_db_location_in_all_scripts.sh 
[eric@localhost test]$ ./exec_update_mpo_scs_patch.sh 

/ check	,
SQL> select status,name from mpo_scs_patch where name similar to  'patch%39(6|7)%';

STATUS                           NAME                                                                                                                             
================================ =============================================================================== 
SKIPPED                          patch-396-entity-log-blob$oracle.sql                                                                                             
SKIPPED                          patch-396-entity-log-blob$postgresql.sql                                                                                         
MANUALLY_APPLIED                 patch-396-shi_shoid_uk.sql                                                                                                       
MANUALLY_APPLIED                 patch-397-pi_shoid_uk.sql                                                                                              
SQL> select status,name from mpo_scs_patch where name similar to  'patch%39(6-shi|7-pi)%';
Invalid SIMILAR TO pattern
SQL> select status,name from mpo_scs_patch where name similar to  'patch%39(6|7)-%';
/ TODO

/ Einde CHANGE PRODUCT ITEM ID 

/ Intermezzo

/ tail werkt met stdin	, niet met een file arg 	, grep kan allebei	,
[eric@localhost trunk]$ less $(tail -1 <(find -name "*396*sql")) 

/ Einde Intermezzo

/ PATCH-422-SOC-CORRECTION-TYPE-REMOVE.SQL

/ 7	. 

/ Er is eerder	,

$ vi patch-422-soc-correction-type-remove.sql

alter table service_order_cost drop correction_type_systemid;

alter table cost_component_specification drop correction_type_systemid;

drop table correction_type;

SQL> select rdb$dependent_name from rdb$dependencies where rdb$field_name ='CORRECTION_TYPE_SYSTEMID';

RDB$DEPENDENT_NAME                                                                            
=============================================================================== 
COSTS_STATUS_PER_SHIPMENT                                                                     
FUEL_DEL_COST_SHIPMENT                                                                        
FUEL_LIN_COST_SHIPMENT                                                                        
FREIGHT_LIN_COST_SHIPMENT                                                                     
OTHER_DEL_COST_SHIPMENT                                                                       
OTHER_LIN_COST_SHIPMENT                                                                       
COSTS_PER_SHIPMENT                                                                            
FREIGHT_DEL_COST_SHIPMENT       

/ LIN is linehaul	, DEL is delivery	,

/ 1. 	

COSTS_STATUS_PER_SHIPMENT                                                                     

/ 13	. 

/ er is	 (eerder), 

$ vi patch-011_report_view-costactualestimated.sql

RECREATE VIEW COSTS_STATUS_PER_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, ACTUAL_COSTS, ESTIMATED_COSTS)
AS SELECT SHO.SYSTEM_ID AS SHIPMENT_ORDER_SYSTEMID,
SUM(CASE WHEN socp.status = 'ACTUAL' THEN 
(CASE CT.NAME WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
 ELSE null END
) AS ACTUAL_COSTS,
SUM (CASE WHEN socp.status = 'ESTIMATED' THEN 
(CASE CT.NAME WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
 ELSE null END
) AS ESTIMATED_COSTS
FROM SHIPMENT_ORDER SHO
JOIN SHIPMENT_ORDER_COST_PART SOCP ON SOCP.SHIPMENT_ORDER_SYSTEMID=SHO.SYSTEM_ID
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN CORRECTION_TYPE CT ON SOC.CORRECTION_TYPE_SYSTEMID = CT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0
GROUP BY SHO.SYSTEM_ID;

/ 13	. 

/ wat laat de view zien	?

/ Met de oude view	,

SQL> select first 5 * from COSTS_STATUS_PER_SHIPMENT;

SHIPMENT_ORDER_SYSTEMID          ACTUAL_COSTS       ESTIMATED_COSTS 
======================= ===================== ===================== 
               11551663                <null>              13.69000 
               11551679                <null>               3.88000 
               11551690                <null>               3.88000 
               11551701                <null>              60.23000 
               11551718                <null>               5.70000 
			   
SQL> select  first 5 * from COSTS_STATUS_PER_SHIPMENT order by SHIPMENT_ORDER_SYSTEMID desc ;

SHIPMENT_ORDER_SYSTEMID          ACTUAL_COSTS       ESTIMATED_COSTS 
======================= ===================== ===================== 
              109355904                <null>              77.00000 
              109351304                <null>             154.00000 
              109175542                <null>             413.00000 
              109116930                <null>             237.00000 
              109059018                <null>             358.00000 

SQL> select  first 5 system_id from SHIPMENT_ORDER order by SYSTEM_ID desc ;

   SYSTEM_ID 
============ 
   110185757 
   110185738 
   110185718 
   110185699 
   110185678 

/ we zien dus dat de nieuwste sho's niet voorkomen in de view		,
/ dit komt omdat de join met SHIPMENT_ORDER_COST_PART leeg is	, als er geen rij is in SHIPMENT_ORDER_COST_PART	, dan heeft de joint ook geen rij	, 
/ wel als we de 1ste join een left join maken	,

/ we maken	,

/ In deploy task DSVFMS - Modify reports for patch-422-soc-correction-type-remove	, 

RECREATE VIEW COSTS_STATUS_PER_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, ACTUAL_COSTS, ESTIMATED_COSTS)
AS SELECT SHO.SYSTEM_ID AS SHIPMENT_ORDER_SYSTEMID,
SUM(CASE WHEN socp.status = 'ACTUAL' THEN 
(CASE soc.correction_type WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
 ELSE null END
) AS ACTUAL_COSTS,
SUM (CASE WHEN socp.status = 'ESTIMATED' THEN 
(CASE soc.correction_type WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
 ELSE null END
) AS ESTIMATED_COSTS
FROM SHIPMENT_ORDER SHO
JOIN SHIPMENT_ORDER_COST_PART SOCP ON SOCP.SHIPMENT_ORDER_SYSTEMID=SHO.SYSTEM_ID
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
WHERE SOCP.IS_DELETED = 0
GROUP BY SHO.SYSTEM_ID;

SELECT * 
FROM SHIPMENT_ORDER SHO
JOIN SHIPMENT_ORDER_COST_PART SOCP ON SOCP.SHIPMENT_ORDER_SYSTEMID=SHO.SYSTEM_ID
-- JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
WHERE sho.system_id=110185678;

2015-11-09 16:32:15,273 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : hibernate3.6.10.mpo.1.jar
2015-11-09 16:32:15,273 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)    MUST_BE_REMOVED : hibernate3.jar


/ 2	. 

FUEL_DEL_COST_SHIPMENT                                                                        

/ 13	. 

$ vi /patch-024_modified_shipment_cost_views.sql

CREATE VIEW FUEL_DEL_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT) AS 
SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE CT.NAME WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
FROM SHIPMENT_ORDER_COST_PART SOCP
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN CORRECTION_TYPE CT ON SOC.CORRECTION_TYPE_SYSTEMID = CT.SYSTEM_ID
JOIN SERVICE_ORDER SO ON SO.SYSTEM_ID=SOC.SERVICE_ORDER_SYSTEMID
JOIN SERVICE_ORDER_TYPE SOT ON SO.SERVICE_ORDER_TYPE_SYSTEMID=SOT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0 
AND SOC.COST_TYPE_SYSTEMID IN (
	SELECT SYSTEM_ID 
	FROM RATE_COMPONENT_TYPE 
	WHERE CODE='FUEL' AND RCT_GROUP='COST') 
AND SOT.SERVICE_ORDER_TYPE='DELIVERY' 
GROUP BY SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS;


SQL>  select first 5 * from  FUEL_DEL_COST_SHIPMENT;

SHIPMENT_ORDER_SYSTEMID STATUS                              AMOUNT 
======================= ==================== ===================== 
               11551663 ESTIMATED                          0.60000 
               11551679 ESTIMATED                          0.16000 
               11551690 ESTIMATED                          0.16000 
               11551701 ESTIMATED                          1.03000 
               11551718 ESTIMATED                          0.16000 


/ In deploy task DSVFMS - Modify reports for patch-422-soc-correction-type-remove	, 

RECREATE VIEW FUEL_DEL_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT) AS 
SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE soc.correction_type WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
FROM SHIPMENT_ORDER_COST_PART SOCP
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN SERVICE_ORDER SO ON SO.SYSTEM_ID=SOC.SERVICE_ORDER_SYSTEMID
JOIN SERVICE_ORDER_TYPE SOT ON SO.SERVICE_ORDER_TYPE_SYSTEMID=SOT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0 
AND SOC.COST_TYPE_SYSTEMID IN (
	SELECT SYSTEM_ID 
	FROM RATE_COMPONENT_TYPE 
	WHERE CODE='FUEL' 
	AND RCT_GROUP='COST') 
AND SOT.SERVICE_ORDER_TYPE='DELIVERY' 
GROUP BY SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS;

/ OK

/ 3	. 

FUEL_LIN_COST_SHIPMENT                                                                        

$ vi ms/dsvfms/src/sql/patch/patch-024_modified_shipment_cost_views.sql

CREATE VIEW FUEL_LIN_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT)
AS SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE CT.NAME WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
FROM SHIPMENT_ORDER_COST_PART SOCP
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN CORRECTION_TYPE CT ON SOC.CORRECTION_TYPE_SYSTEMID = CT.SYSTEM_ID
JOIN SERVICE_ORDER SO ON SO.SYSTEM_ID=SOC.SERVICE_ORDER_SYSTEMID
JOIN SERVICE_ORDER_TYPE SOT ON SO.SERVICE_ORDER_TYPE_SYSTEMID=SOT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0 AND SOC.COST_TYPE_SYSTEMID IN (SELECT SYSTEM_ID FROM RATE_COMPONENT_TYPE WHERE CODE='FUEL' AND RCT_GROUP='COST') AND SOT.SERVICE_ORDER_TYPE='LINEHAUL' GROUP BY SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS;

SQL> select first 5 * from  FUEL_LIN_COST_SHIPMENT;

SHIPMENT_ORDER_SYSTEMID STATUS                              AMOUNT 
======================= ==================== ===================== 
               11551663 ESTIMATED                          0.06000 
               11551679 ESTIMATED                          0.02000 
               11551690 ESTIMATED                          0.02000 
               11551718 ESTIMATED                          0.07000 
               11551733 ESTIMATED                          1.38000 

/ 13	. 

/ In deploy task DSVFMS - Modify reports for patch-422-soc-correction-type-remove	, 

RECREATE VIEW FUEL_LIN_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT) AS 
SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE soc.correction_type WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
FROM SHIPMENT_ORDER_COST_PART SOCP
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN SERVICE_ORDER SO ON SO.SYSTEM_ID=SOC.SERVICE_ORDER_SYSTEMID
JOIN SERVICE_ORDER_TYPE SOT ON SO.SERVICE_ORDER_TYPE_SYSTEMID=SOT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0 
AND SOC.COST_TYPE_SYSTEMID IN (
	SELECT SYSTEM_ID 
	FROM RATE_COMPONENT_TYPE 
	WHERE CODE='FUEL' 
	AND RCT_GROUP='COST') 
AND SOT.SERVICE_ORDER_TYPE='LINEHAUL' 
GROUP BY SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS;



/ 4	. 

FREIGHT_LIN_COST_SHIPMENT                                                                        

/ 13	. 

$ vi ./dsvfms/dsvfms/src/sql/patch/patch-024_modified_shipment_cost_views.sql

DROP VIEW FREIGHT_LIN_COST_SHIPMENT;

CREATE VIEW FREIGHT_LIN_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT) AS 
SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE CT.NAME WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
FROM SHIPMENT_ORDER_COST_PART SOCP
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN CORRECTION_TYPE CT ON SOC.CORRECTION_TYPE_SYSTEMID = CT.SYSTEM_ID
JOIN SERVICE_ORDER SO ON SO.SYSTEM_ID=SOC.SERVICE_ORDER_SYSTEMID
JOIN SERVICE_ORDER_TYPE SOT ON SO.SERVICE_ORDER_TYPE_SYSTEMID=SOT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0 
AND SOC.COST_TYPE_SYSTEMID IN (
	SELECT SYSTEM_ID 
	FROM RATE_COMPONENT_TYPE 
	WHERE CODE='FREIGHT' 
	AND RCT_GROUP='COST') 
AND SOT.SERVICE_ORDER_TYPE='LINEHAUL' 
GROUP BY SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS;

GRANT DELETE, INSERT, REFERENCES, SELECT, UPDATE ON FREIGHT_LIN_COST_SHIPMENT TO  SYSDBA WITH GRANT OPTION;

SQL>  select first 5 * from  FREIGHT_LIN_COST_SHIPMENT;

SHIPMENT_ORDER_SYSTEMID STATUS                              AMOUNT 
======================= ==================== ===================== 
               11551663 ESTIMATED                          2.21000 
               11551679 ESTIMATED                          0.79000 
               11551690 ESTIMATED                          0.79000 
               11551718 ESTIMATED                          2.56000 
               11551733 ESTIMATED                         46.19000 

/ Intermezzo

/ Lees	, 
http://stackoverflow.com/questions/17656406/how-to-display-and-set-user-rights-in-firebird-database
/ grant to sysdba slaat WH nergens op	, sysdba kan alles al	,

http://www.firebirdsql.org/refdocs/langrefupd25-security-grant-revoke.html

/ we kunnen bijv	,

SQL> grant select on g to tester;
SQL> revoke select on g from tester;

/ Einde Intermezzo

/ 13	. 

/ In deploy task DSVFMS - Modify reports for patch-422-soc-correction-type-remove	, 

RECREATE VIEW FREIGHT_LIN_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT) AS 
SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE soc.correction_type WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
FROM SHIPMENT_ORDER_COST_PART SOCP
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN SERVICE_ORDER SO ON SO.SYSTEM_ID=SOC.SERVICE_ORDER_SYSTEMID
JOIN SERVICE_ORDER_TYPE SOT ON SO.SERVICE_ORDER_TYPE_SYSTEMID=SOT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0 
AND SOC.COST_TYPE_SYSTEMID IN (
	SELECT SYSTEM_ID 
	FROM RATE_COMPONENT_TYPE 
	WHERE CODE='FREIGHT' 
	AND RCT_GROUP='COST') 
AND SOT.SERVICE_ORDER_TYPE='LINEHAUL' 
GROUP BY SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS;

/ OK






/ 5	. 

OTHER_DEL_COST_SHIPMENT                                                                       

$ vi ./dsvfms/dsvfms/src/sql/patch/patch-024_modified_shipment_cost_views.sql

CREATE VIEW OTHER_DEL_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT)
AS SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE CT.NAME WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
FROM SHIPMENT_ORDER_COST_PART SOCP
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN CORRECTION_TYPE CT ON SOC.CORRECTION_TYPE_SYSTEMID = CT.SYSTEM_ID
JOIN SERVICE_ORDER SO ON SO.SYSTEM_ID=SOC.SERVICE_ORDER_SYSTEMID
JOIN SERVICE_ORDER_TYPE SOT ON SO.SERVICE_ORDER_TYPE_SYSTEMID=SOT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0 
AND SOC.COST_TYPE_SYSTEMID NOT IN (
	SELECT SYSTEM_ID 
	FROM RATE_COMPONENT_TYPE 
	WHERE CODE='FREIGHT' OR CODE='FUEL' AND RCT_GROUP='COST') 
AND SOT.SERVICE_ORDER_TYPE='DELIVERY' 
GROUP BY SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS;

QL> select first 5 * from  other_del_COST_SHIPMENT;

SHIPMENT_ORDER_SYSTEMID STATUS                              AMOUNT 
======================= ==================== ===================== 
               11552283 ESTIMATED                          3.69000 
               11552339 ESTIMATED                          3.69000 
               11552367 ESTIMATED                          3.69000 
               11552392 ESTIMATED                          4.00000 
               11552618 ESTIMATED                          3.69000 


/ In deploy task DSVFMS - Modify reports for patch-422-soc-correction-type-remove	, 

RECREATE VIEW OTHER_DEL_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT)
AS SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE soc.correction_type WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
FROM SHIPMENT_ORDER_COST_PART SOCP
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN SERVICE_ORDER SO ON SO.SYSTEM_ID=SOC.SERVICE_ORDER_SYSTEMID
JOIN SERVICE_ORDER_TYPE SOT ON SO.SERVICE_ORDER_TYPE_SYSTEMID=SOT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0 
AND SOC.COST_TYPE_SYSTEMID NOT IN (
	SELECT SYSTEM_ID 
	FROM RATE_COMPONENT_TYPE 
	WHERE CODE='FREIGHT' OR CODE='FUEL' AND RCT_GROUP='COST') 
AND SOT.SERVICE_ORDER_TYPE='DELIVERY' 
GROUP BY SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS;


 
/ 6	.

OTHER_LIN_COST_SHIPMENT                                                                       

/ 13	. 

$ vi ./dsvfms/dsvfms/src/sql/patch/patch-024_modified_shipment_cost_views.sql

CREATE VIEW OTHER_LIN_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT)
AS SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE CT.NAME WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
FROM SHIPMENT_ORDER_COST_PART SOCP
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN CORRECTION_TYPE CT ON SOC.CORRECTION_TYPE_SYSTEMID = CT.SYSTEM_ID
JOIN SERVICE_ORDER SO ON SO.SYSTEM_ID=SOC.SERVICE_ORDER_SYSTEMID
JOIN SERVICE_ORDER_TYPE SOT ON SO.SERVICE_ORDER_TYPE_SYSTEMID=SOT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0 
AND SOC.COST_TYPE_SYSTEMID NOT IN (
	SELECT SYSTEM_ID 
	FROM RATE_COMPONENT_TYPE 
	WHERE CODE='FREIGHT' OR CODE='FUEL' AND RCT_GROUP='COST') 
AND SOT.SERVICE_ORDER_TYPE='LINEHAUL' 
GROUP BY SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS;

SQL> select first 5 * from  other_lin_COST_SHIPMENT;

SHIPMENT_ORDER_SYSTEMID STATUS                              AMOUNT 
======================= ==================== ===================== 
               13157061 ESTIMATED                          0.66000 
               13158850 ESTIMATED                          0.00000 
               13162898 ESTIMATED                          1.25000 
               13163928 ESTIMATED                          0.94000 
               13165255 ESTIMATED                          0.62000 

/ 13	. 

/ In deploy task DSVFMS - Modify reports for patch-422-soc-correction-type-remove	, 

RECREATE VIEW OTHER_LIN_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT)
AS SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE soc.correction_type WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
FROM SHIPMENT_ORDER_COST_PART SOCP
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN SERVICE_ORDER SO ON SO.SYSTEM_ID=SOC.SERVICE_ORDER_SYSTEMID
JOIN SERVICE_ORDER_TYPE SOT ON SO.SERVICE_ORDER_TYPE_SYSTEMID=SOT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0 
AND SOC.COST_TYPE_SYSTEMID NOT IN (
	SELECT SYSTEM_ID 
	FROM RATE_COMPONENT_TYPE 
	WHERE CODE='FREIGHT' OR CODE='FUEL' AND RCT_GROUP='COST') 
AND SOT.SERVICE_ORDER_TYPE='LINEHAUL' 
GROUP BY SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS;

/ 7	. 

COSTS_PER_SHIPMENT                                                                            

$ vi ./dsvfms/dsvfms/src/sql/patch/patch-024_modified_shipment_cost_views.sql

CREATE VIEW COSTS_PER_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, COSTS)
AS SELECT SHO.SYSTEM_ID AS SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE CT.NAME WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END) AS COSTS
FROM SHIPMENT_ORDER SHO
JOIN SHIPMENT_ORDER_COST_PART SOCP ON SOCP.SHIPMENT_ORDER_SYSTEMID=SHO.SYSTEM_ID
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN CORRECTION_TYPE CT ON SOC.CORRECTION_TYPE_SYSTEMID = CT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0
GROUP BY SHO.SYSTEM_ID, SOCP.STATUS;

SQL> select first 5 * from  COSTS_PER_SHIPMENT;

SHIPMENT_ORDER_SYSTEMID STATUS                               COSTS 
======================= ==================== ===================== 
               11551663 ESTIMATED                         13.69000 
               11551679 ESTIMATED                          3.88000 
               11551690 ESTIMATED                          3.88000 
               11551701 ESTIMATED                         60.23000 
               11551718 ESTIMATED                          5.70000 

/ 13	. 

/ In deploy task DSVFMS - Modify reports for patch-422-soc-correction-type-remove	, 

RECREATE VIEW COSTS_PER_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, COSTS) AS 
SELECT SHO.SYSTEM_ID AS SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE soc.correction_type WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END) AS COSTS
FROM SHIPMENT_ORDER SHO
JOIN SHIPMENT_ORDER_COST_PART SOCP ON SOCP.SHIPMENT_ORDER_SYSTEMID=SHO.SYSTEM_ID
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
WHERE SOCP.IS_DELETED = 0
GROUP BY SHO.SYSTEM_ID, SOCP.STATUS;

/ 8	. 

FREIGHT_DEL_COST_SHIPMENT       

$ vi ./dsvfms/dsvfms/src/sql/patch/patch-024_modified_shipment_cost_views.sql

CREATE VIEW FREIGHT_DEL_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT) AS 
SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE CT.NAME WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
FROM SHIPMENT_ORDER_COST_PART SOCP
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN CORRECTION_TYPE CT ON SOC.CORRECTION_TYPE_SYSTEMID = CT.SYSTEM_ID
JOIN SERVICE_ORDER SO ON SO.SYSTEM_ID=SOC.SERVICE_ORDER_SYSTEMID
JOIN SERVICE_ORDER_TYPE SOT ON SO.SERVICE_ORDER_TYPE_SYSTEMID=SOT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0 
AND SOC.COST_TYPE_SYSTEMID IN (
	SELECT SYSTEM_ID 
	FROM RATE_COMPONENT_TYPE 
	WHERE CODE='FREIGHT' 
	AND RCT_GROUP='COST') 
AND SOT.SERVICE_ORDER_TYPE='DELIVERY' 
GROUP BY SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS;

SQL> select first 5 * from FREIGHT_DEL_COST_SHIPMENT;

SHIPMENT_ORDER_SYSTEMID STATUS                              AMOUNT 
======================= ==================== ===================== 
               11551663 ESTIMATED                         10.82000 
               11551679 ESTIMATED                          2.91000 
               11551690 ESTIMATED                          2.91000 
               11551701 ESTIMATED                         59.20000 
               11551718 ESTIMATED                          2.91000 


/ In deploy task DSVFMS - Modify reports for patch-422-soc-correction-type-remove	, 

RECREATE VIEW FREIGHT_DEL_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT) AS 
SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE soc.correction_type WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
FROM SHIPMENT_ORDER_COST_PART SOCP
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN SERVICE_ORDER SO ON SO.SYSTEM_ID=SOC.SERVICE_ORDER_SYSTEMID
JOIN SERVICE_ORDER_TYPE SOT ON SO.SERVICE_ORDER_TYPE_SYSTEMID=SOT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0 
AND SOC.COST_TYPE_SYSTEMID IN (
	SELECT SYSTEM_ID 
	FROM RATE_COMPONENT_TYPE 
	WHERE CODE='FREIGHT' 
	AND RCT_GROUP='COST') 
AND SOT.SERVICE_ORDER_TYPE='DELIVERY' 
GROUP BY SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS;

/ OK



 

/ Einde SCS-4891
/ Einde PATCH-422-SOC-CORRECTION-TYPE-REMOVE.SQL

/ FIXES DSVFMS PATCHES ON TEST 

/ FIX SCS-4891
/ FIX PATCH-422-SOC-CORRECTION-TYPE-REMOVE.SQL

/ we maken een deploy task

SCS-4891
DSVFMS - Modify reports for patch-422-soc-correction-type-remove

Type: Iask
Component/s: Deploy
Fix versions/s: 2015.03

/ In de comments	,

RECREATE VIEW COSTS_STATUS_PER_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, ACTUAL_COSTS, ESTIMATED_COSTS)
AS SELECT SHO.SYSTEM_ID AS SHIPMENT_ORDER_SYSTEMID,
SUM(CASE WHEN socp.status = 'ACTUAL' THEN 
(CASE soc.correction_type WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
 ELSE null END
) AS ACTUAL_COSTS,
SUM (CASE WHEN socp.status = 'ESTIMATED' THEN 
(CASE soc.correction_type WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
 ELSE null END
) AS ESTIMATED_COSTS
FROM SHIPMENT_ORDER SHO
JOIN SHIPMENT_ORDER_COST_PART SOCP ON SOCP.SHIPMENT_ORDER_SYSTEMID=SHO.SYSTEM_ID
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
WHERE SOCP.IS_DELETED = 0
GROUP BY SHO.SYSTEM_ID;

RECREATE VIEW FUEL_DEL_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT) AS 
SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE soc.correction_type WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
FROM SHIPMENT_ORDER_COST_PART SOCP
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN SERVICE_ORDER SO ON SO.SYSTEM_ID=SOC.SERVICE_ORDER_SYSTEMID
JOIN SERVICE_ORDER_TYPE SOT ON SO.SERVICE_ORDER_TYPE_SYSTEMID=SOT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0 
AND SOC.COST_TYPE_SYSTEMID IN (
	SELECT SYSTEM_ID 
	FROM RATE_COMPONENT_TYPE 
	WHERE CODE='FUEL' 
	AND RCT_GROUP='COST') 
AND SOT.SERVICE_ORDER_TYPE='DELIVERY' 
GROUP BY SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS;

RECREATE VIEW FUEL_LIN_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT) AS 
SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE soc.correction_type WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
FROM SHIPMENT_ORDER_COST_PART SOCP
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN SERVICE_ORDER SO ON SO.SYSTEM_ID=SOC.SERVICE_ORDER_SYSTEMID
JOIN SERVICE_ORDER_TYPE SOT ON SO.SERVICE_ORDER_TYPE_SYSTEMID=SOT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0 
AND SOC.COST_TYPE_SYSTEMID IN (
	SELECT SYSTEM_ID 
	FROM RATE_COMPONENT_TYPE 
	WHERE CODE='FUEL' 
	AND RCT_GROUP='COST') 
AND SOT.SERVICE_ORDER_TYPE='LINEHAUL' 
GROUP BY SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS;

RECREATE VIEW FREIGHT_LIN_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT) AS 
SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE soc.correction_type WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
FROM SHIPMENT_ORDER_COST_PART SOCP
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN SERVICE_ORDER SO ON SO.SYSTEM_ID=SOC.SERVICE_ORDER_SYSTEMID
JOIN SERVICE_ORDER_TYPE SOT ON SO.SERVICE_ORDER_TYPE_SYSTEMID=SOT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0 
AND SOC.COST_TYPE_SYSTEMID IN (
	SELECT SYSTEM_ID 
	FROM RATE_COMPONENT_TYPE 
	WHERE CODE='FREIGHT' 
	AND RCT_GROUP='COST') 
AND SOT.SERVICE_ORDER_TYPE='LINEHAUL' 
GROUP BY SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS;

RECREATE VIEW OTHER_DEL_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT)
AS SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE soc.correction_type WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
FROM SHIPMENT_ORDER_COST_PART SOCP
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN SERVICE_ORDER SO ON SO.SYSTEM_ID=SOC.SERVICE_ORDER_SYSTEMID
JOIN SERVICE_ORDER_TYPE SOT ON SO.SERVICE_ORDER_TYPE_SYSTEMID=SOT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0 
AND SOC.COST_TYPE_SYSTEMID NOT IN (
	SELECT SYSTEM_ID 
	FROM RATE_COMPONENT_TYPE 
	WHERE CODE='FREIGHT' OR CODE='FUEL' AND RCT_GROUP='COST') 
AND SOT.SERVICE_ORDER_TYPE='DELIVERY' 
GROUP BY SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS;

RECREATE VIEW OTHER_LIN_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT)
AS SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE soc.correction_type WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
FROM SHIPMENT_ORDER_COST_PART SOCP
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN SERVICE_ORDER SO ON SO.SYSTEM_ID=SOC.SERVICE_ORDER_SYSTEMID
JOIN SERVICE_ORDER_TYPE SOT ON SO.SERVICE_ORDER_TYPE_SYSTEMID=SOT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0
AND SOC.COST_TYPE_SYSTEMID NOT IN (
    SELECT SYSTEM_ID
    FROM RATE_COMPONENT_TYPE
    WHERE CODE='FREIGHT' OR CODE='FUEL' AND RCT_GROUP='COST')
AND SOT.SERVICE_ORDER_TYPE='LINEHAUL'
GROUP BY SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS;

RECREATE VIEW COSTS_PER_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, COSTS) AS 
SELECT SHO.SYSTEM_ID AS SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE soc.correction_type WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END) AS COSTS
FROM SHIPMENT_ORDER SHO
JOIN SHIPMENT_ORDER_COST_PART SOCP ON SOCP.SHIPMENT_ORDER_SYSTEMID=SHO.SYSTEM_ID
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
WHERE SOCP.IS_DELETED = 0
GROUP BY SHO.SYSTEM_ID, SOCP.STATUS;

RECREATE VIEW FREIGHT_DEL_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT) AS
SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS, SUM(CASE soc.correction_type WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
FROM SHIPMENT_ORDER_COST_PART SOCP
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN SERVICE_ORDER SO ON SO.SYSTEM_ID=SOC.SERVICE_ORDER_SYSTEMID
JOIN SERVICE_ORDER_TYPE SOT ON SO.SERVICE_ORDER_TYPE_SYSTEMID=SOT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0
AND SOC.COST_TYPE_SYSTEMID IN (
    SELECT SYSTEM_ID
    FROM RATE_COMPONENT_TYPE
    WHERE CODE='FREIGHT'
    AND RCT_GROUP='COST')
AND SOT.SERVICE_ORDER_TYPE='DELIVERY'
GROUP BY SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS;


/ Einde FIX SCS-4891

/ Kunnen we nu patch-422-soc-correction-type-remove.sql	?

[eric@localhost 2015.03]$ find -name "patch*422*sql"
./module/oms/src/sql/patch/patch-422-soc-correction-type-remove.sql
[eric@localhost 2015.03]$ cat $(find -name "patch*422*sql")

alter table service_order_cost drop correction_type_systemid;
/ OK

alter table cost_component_specification drop correction_type_systemid;
/ WAS AL

drop table correction_type;
/ OK

/ update de patch table	,

SQL> select count(*) from mpo_scs_patch where name like '%patch-422%';
       COUNT 
============ 
           1 
SQL> update mpo_scs_patch set status='MANUALLY_APPLIED' where name like '%patch-422%';


/ we doen dit ook op test	,



/ Einde FIX PATCH-422-SOC-CORRECTION-TYPE-REMOVE.SQL


calhost bin]$ dsvfms-db-t.sh 
Database:  mposerv8:/local/apps/firebird/dsvfms.fdb, User: sysdba



/7	 .

/ TOO MANY UNMATCHED DEFERRED EVENTS IN DSVFMS

/ we start/login (TODO)	, en we vallen in	,

[DeferredEventIdentifierCacheRefreshTaskTimerFactory] (Suspended (entry into method findEventsByStatus in DeferredEventDAOImpl))	
	DeferredEventDAOImpl.findEventsByStatus(DeferredEventStatus) line: 59	
	DeferredEventIdentifierCache.initialize() line: 78	
	DeferredEventIdentifierCache.<init>() line: 36	
	DeferredEventIdentifierCache.getInstance() line: 41	
	DeferredEventIdentifierCacheRefreshTask.run() line: 28	
	TimerThread.run() line: 505	

/ In meer detail	,

DeferredEventIdentifierCacheRefreshTask.run() line: 28	
	public void run() {
		loginService.login();
		DeferredEventIdentifierCache.getInstance().initialize();
/s
DeferredEventIdentifierCache.getInstance() line: 41	
		if (instance == null) {
			instance = new DeferredEventIdentifierCache();
/s
DeferredEventIdentifierCache.<init>() line: 36	
		cache = new HashMap<String, Map<String, Set<Integer>>>();
		initialize();
/s
DeferredEventIdentifierCache.initialize() line: 78	
		cache.clear();
		List<DeferredEvent> myList = MpoBeanFactory.getBean(DeferredEventDAO.class).findEventsByStatus(DeferredEventStatus.UNMATCHED);
/s
DeferredEventDAOImpl.findEventsByStatus(DeferredEventStatus) line: 59	
/=
	public List<DeferredEvent> findEventsByStatus(DeferredEventStatus aStatus) {
/ aStatus=UNMATCHED
		DetachedCriteria myCriteria = DetachedCriteria.forClass(DeferredEvent.class);
		myCriteria.add(Property.forName("status").eq(aStatus));
		HibernateTemplate myTemplate = getHibernateTemplate();
		myTemplate.setCacheQueries(true);
		@SuppressWarnings("unchecked")
		List<DeferredEvent> myDeferredEvents = myTemplate.findByCriteria(myCriteria);
/ komt hier niet uit	,

$ vi DeferredEvent.standard.hbm.xml

	<class name="DeferredEvent" table="DEFERRED_EVENT">

$ vi DeferredEventDAOImpl.java

	@Override
	public List<DeferredEvent> findEventsByStatus(DeferredEventStatus aStatus) {
		DetachedCriteria myCriteria = DetachedCriteria.forClass(DeferredEvent.class);
		myCriteria.add(Property.forName("status").eq(aStatus));
		HibernateTemplate myTemplate = getHibernateTemplate();
		myTemplate.setCacheQueries(true);
		@SuppressWarnings("unchecked")
		List<DeferredEvent> myDeferredEvents = myTemplate.findByCriteria(myCriteria);
		for (DeferredEvent myDeferredEvent : myDeferredEvents) {
			myTemplate.initialize(myDeferredEvent);
			myTemplate.initialize(myDeferredEvent.getIdentifiers());
		}
		return myDeferredEvents;
	}

/ 7	.  

./module/event/src/java/com/mpobjects/event/service/DeferredEventPurgeServiceImpl.java

[eric@localhost 2015.03]$ find -name "*Task*java" | grep -i defer
./module/event/src/java/com/mpobjects/event/service/DeferredEventProcessingTask.java
./module/event/src/java/com/mpobjects/event/service/DeferredEventTriggerTask.java
./module/event/src/java/com/mpobjects/event/service/DeferredEventIdentifierCacheRefreshTask.java

/ 7	. 

[eric@localhost 2015.03]$ vi ./module/event/src/java/event-service.sb.xml

    <bean id="DeferredEventIdentifierCacheRefreshTaskTimerFactory" class="org.springframework.scheduling.timer.TimerFactoryBean">
        <property name="scheduledTimerTasks">
            <bean class="org.springframework.scheduling.timer.ScheduledTimerTask">
                <property name="delay" value="15000" />
                <property name="period" value="7200000" />
                <property name="timerTask" ref="deferredEventIdentifierRefreshRun" />
            </bean>
        </property>
    </bean>

/ MORGENOCHTEND
/ Zoek cron job scheduler in spring config file
/ TODO

/ Verschil cronjobs en task
/ TODO





/	7	.

SQL>  select count(*)from deferred_event;

       COUNT 
============ 
      469901 

SQL>  select count(*)from deferred_event where status='UNMATCHED';

       COUNT 
============ 
      458799 


SQL>  select min(cast(created_on_date as date)) from deferred_event where status='UNMATCHED';

        MIN 
=========== 
2014-03-12  

SQL>  select max(cast(created_on_date as date)) from deferred_event where status='UNMATCHED';

        MAX 
=========== 
2015-10-05 


SQL>  select max(cast(created_on_date as date))-min(cast(created_on_date as date)) from deferred_event where status='UNMATCHED'; 

    SUBTRACT 
============ 
         572 
/ TODO

/ 7	.


SQL>  select count(*)from deferred_event where status='UNMATCHED' and created_on_date between '2014-03-12' and '2014-06-12';

       COUNT 
============ 
       39904 

SQL>  select count(*)from deferred_event where status='UNMATCHED' and created_on_date between '2014-06-12' and '2014-09-12';

       COUNT 
============ 
       53766 

SQL>  select count(*)from deferred_event where status='UNMATCHED' and created_on_date between '2014-09-12' and '2014-12-12';

       COUNT 
============ 
       63055 

SQL>  select count(*)from deferred_event where status='UNMATCHED' and created_on_date between '2014-12-12' and '2015-03-12';

       COUNT 
============ 
      101203 

SQL>  select count(*)from deferred_event where status='UNMATCHED' and created_on_date between '2015-03-12' and '2015-06-12';

       COUNT 
============ 
       71178 

SQL>  select count(*)from deferred_event where status='UNMATCHED' and created_on_date between '2015-06-12' and '2015-09-12';

       COUNT 
============ 
       96745 

SQL>  select count(*)from deferred_event where status='UNMATCHED' and created_on_date between '2015-09-12' and '2015-12-12';

       COUNT 
============ 
       32948 



/ Einde TOO MANY UNMATCHED DEFERRED EVENTS IN DSVFMS

/ TOO MANY UNMATCHED DEFERRED EVENTS IN DSVFMS

/ Voor de FIX TOO MANY UNMATCHED DEFERRED EVENTS IN DSVFMS 

select count(*) from deferred_event_value dev 
where dev.DEFERRED_EVENT_SYSTEMID in (
	select SYSTEM_ID 
	from DEFERRED_EVENT 
	where created_on_date < '2015-10-02' and status = 'UNMATCHED');

       COUNT 
============ 
     1812584 

select count(*) from DEFERRED_EVENT_IDENTIFIER dei 
where dei.DEFERRED_EVENT_SYSTEMID in (
	select SYSTEM_ID 
	from DEFERRED_EVENT 
	where created_on_date < '2015-10-02' and status = 'UNMATCHED');

       COUNT 
============ 
     1066458 


select count(*) from deferred_event 
where created_on_date < '2015-10-02' and status = 'UNMATCHED';

       COUNT 
============ 
      455730 

/ Na FIX TOO MANY UNMATCHED DEFERRED EVENTS IN DSVFMS zijn alle count 0.

/ Einde TOO MANY UNMATCHED DEFERRED EVENTS IN DSVFMS

/ FIX TOO MANY UNMATCHED DEFERRED EVENTS IN DSVFMS

/ Peter deed	, lees Jira dsvsol-2739	,

delete from deferred_event_value dev 
where dev.DEFERRED_EVENT_SYSTEMID in (
	select SYSTEM_ID 
	from DEFERRED_EVENT 
	where created_on_date < '2015-10-02' and status = 'UNMATCHED');

delete from DEFERRED_EVENT_IDENTIFIER dei 
where dei.DEFERRED_EVENT_SYSTEMID in (
	select SYSTEM_ID 
	from DEFERRED_EVENT 
	where created_on_date < '2015-10-02' and status = 'UNMATCHED');

delete from deferred_event 
where created_on_date < '2015-10-02' and status = 'UNMATCHED';

/ Ook zijn checked in	,

module.event.deferred.event.purge.statusses=DISCARDED,MATCHED_EXPECTED,MATCHED_UNEXPECTED,UNMATCHED
module.event.deferred.event.purge.offset=P1M
module.event.deferred.event.purge.max=1000
module.event.deferred.event.purge.interval=300000


/ Einde FIX TOO MANY UNMATCHED DEFERRED EVENTS IN DSVFMS


/ 13	. 

/ we halen de patched db over van mposerv8	,

/ ze zijn op mposerv8 in /backup/mpo-backup/db	,

[eric@localhost bin]$ scp eric@mposerv8:/backup/mpo-backup/db/dsvfms.fdb_20151016-000021.fbk.gz /home/eric/DB_TAP/Firebird/

[eric@localhost bin]$ dsvfms-scp-from-db-t.sh dsvfms.fdb_20151016-000021.fbk.gz
Eric789@MPO
/ OK

/ Intermezzo

eric@mposerv8:/backup/mpo-backup/db$ ls -1tr | grep dsvfms | tail -1
dsvfms.fdb_20151019-000019.fbk.gz

eric@mposerv8:/backup/mpo-backup/db$ find $(ls -1tr ) -name "*dsvfms*" | tail -1
dsvfms.fdb_20151019-000019.fbk.gz

/ het 1ste arg van find is een ( list van ) dir of een (list van) file 

eric@mposerv8:/backup/mpo-backup/db$ tail -1 $(find $(ls -1tr ) -name "*dsvfms*" )
tail: option used in invalid context -- 1
eric@mposerv8:/backup/mpo-backup/db$ tail -1 <(find $(ls -1tr ) -name "*dsvfms*" )
dsvfms.fdb_20151019-000019.fbk.gz

/ tail werkt alleen op stdin	, niet op args	,

/ Kijk naar verschil	,

eric@mposerv8:/backup/mpo-backup/db$ cat  <(ls -1tr)
scsdemo.fdb_20130602-000002.fbk.gz
scsdemo.fdb_20130603-000001.fbk.gz
...
eric@mposerv8:/backup/mpo-backup/db$ echo  $(ls -1tr)
scsdemo.fdb_20130602-000002.fbk.gz scsdemo.fdb_20130603-000001.fbk.gz ...

/ find krijgt args	, dus $(ls -1tr)	, 

/ Einde Intermezzo

[eric@localhost bin]$ ssh eric@mposerv8 "cd /backup/mpo-backup/db;ls -1tr | grep dsvfms | tail -1"
/ of	,
[eric@localhost bin]$ ssh eric@mposerv8 'cd /backup/mpo-backup/db;tail -1 <(find $(ls -1tr ) -name "*dsvfms*")'
/ of	,
[eric@localhost bin]$ ssh eric@mposerv8 "cd /backup/mpo-backup/db;tail -1 <(find \$(ls -1tr ) -name \"*dsvfms*\")"
dsvfms.fdb_20151019-000019.fbk.gz

/ we moeten dus ook de $ escape	 tussen ""	, naast de " , maar dat is logisch	,

/ Lees	,
http://www.tldp.org/LDP/abs/html/quotingvar.html
/ we moeten tussen "" escape: $ en  ` en \ 
/ want tussen "" worden special chars niet interpret	, behalve $ en ` en \ 
/ $ wordt wel interpret voor "$var"	,  als we dat niet willen moeten we "\$(ls -ltr)"	, 

/ we maken	, 

$ dsvfms-scp-from-db-t.sh
#!/usr/bin/bash
# $@=dsvfms.fdb_20150930-002854.fbk.gz
echo "Eric789@MPO"
file=$(ssh eric@mposerv8 "cd /backup/mpo-backup/db;ls -1tr | grep dsvfms | tail -1")
scp "eric@mposerv8:/backup/mpo-backup/db/$file" /home/eric/DB_TAP/Dsvfms/
/ OK	,


/ 13	. 

[eric@localhost Dsvfms]$ tr fbk fdb < <(echo "fbk")
fdb
/ tr werkt niet op een file arg	, maar op stdin 	, vandaar de extra <	,

[eric@localhost Dsvfms]$ sed 's/fbk/fdb/g'  < <(echo "fbk")
/ of	,
[eric@localhost Dsvfms]$ sed 's/fbk/fdb/g'  <(echo "fbk")
fdb

/ sed werkt op een file of stdin	,

[eric@localhost Dsvfms]$ awk '{sub(/fbk/,"fdb");print}'  <(echo "fbk")
fdb

/ 13	. 

[eric@localhost Dsvfms]$ if [ -f $(tail -1 < <(ls -1tr)) ] ; then echo OK; fi
OK

/ Intermezzo

/ In sed matching string	, escape . met \

[eric@localhost Dsvfms]$ sed 's/.fbk/Afdb/' <(echo "afbk")
Afdb
/ een . matches alle	,

[eric@localhost Dsvfms]$ sed 's/\.fbk/Afdb/' <(echo "afbk")
/ of	,
[eric@localhost Dsvfms]$ sed 's/\.fbk/\.fdb/' <(echo "afbk")
afbk
/ een \. is inderdaad een .	, "afbk" matches niet	, dus sed geeft deze string onveranderd terug	,

[eric@localhost Dsvfms]$ sed 's/\.fbk/Afdb/' <(echo ".fbk")
Afdb

/ bij awk is hetzelfde	,

[eric@localhost Dsvfms]$ awk '{sub(/.fbk/,"Afdb");print}' <(echo "afbk")
Afdb
[eric@localhost Dsvfms]$ awk '{sub(/\.fbk/,"Afdb");print}' <(echo "afbk")
afbk
[eric@localhost Dsvfms]$ awk '{sub(/\.fbk/,"Afdb");print}' <(echo ".fbk")
Afdb


/ Einde Intermezzo

[eric@localhost Dsvfms]$ awk '{sub(/.fbk/,".fdb");print}' <(echo "afbk")
/ TODO


$ gbak -c -user sysdb -password masterkey 

[eric@localhost Dsvfms]$ sudo chown eric.eric $(tail -1 < <(ls -1tr))

/ Intermezzo

/ grep kijkt altijd in een file	,

[eric@localhost Dsvfms]$ tail -1 < <(grep -e "fbk$" <(ls -1tr))
dsvfms.fdb_20151019-000019.fbk

/ use NIET	,
$ grep $(ls -1tr)	
/ want dan kijkt hij in elk van de files in de list	,

/ we kunnen ook find	, 

[eric@localhost Dsvfms]$ tail -1 <(find $(ls -1tr) -name "*fbk")
dsvfms.fdb_20151019-000019.fbk

/ Einde Intermezzo

[eric@localhost Dsvfms]$ ls -l $(tail -1 <(find $(ls -1tr) -name "*fbk"))
-rw-rw-r--. 1 firebird firebird 18560443392 Oct 19 10:30 dsvfms.fdb_20151019-000019.fbk

[eric@localhost Dsvfms]$ sudo chown eric.eric $(tail -1 <(find $(ls -1tr) -name "*fbk"))

[eric@localhost Dsvfms]$ ls -l $(tail -1 <(find $(ls -1tr) -name "*fbk"))
-rw-rw-r--. 1 eric eric 18560443392 Oct 19 10:30 dsvfms.fdb_20151019-000019.fbk

///////////////////////////////////////////
/ Voor gbak hoeven de de .fbk file NIET naar firebird.firebird te brengen	, 
/ gbak -c kunnen we als eric doen	, de file wordt van firebird	, 
/TODO

/ uiteindelijk 2 nieuwe scripts	,

[eric@localhost bin]$ cat dsvfms-scp-from-db-t.sh
#!/usr/bin/bash
echo "Eric789@MPO"

file=$(ssh eric@mposerv8 "cd /backup/mpo-backup/db;ls -1tr | grep dsvfms | tail -1")
scp "eric@mposerv8:/backup/mpo-backup/db/$file" /home/eric/DB_TAP/Dsvfms/

$ vi dsvfms-gbak-c-local.sh
#!/usr/bin/bash

dir=/home/eric/DB_TAP/Dsvfms
fbk="$(tail -1 < <(grep -e "fbk$" <(ls -1tr $dir)))"
if [ -f "$fbk" ]
then 
    fdb="$(sed 's/\.fbk/\.fdb/' <(echo $fbk))"
fi
if [ -f "$fdb" ]
then
    sudo -u firebird rm "$fdb"
fi
gbak -c -user sysdba -password masterkey "$fbk" "$fdb"

/ we hebben gedaan	, 
[eric@localhost Dsvfms]$ dsvfms-gbak-c-local.sh 
[eric@localhost Dsvfms]$ ls -ltr | tail -2
-rw-rw-r--. 1 eric     eric     18560443392 Oct 19 10:30 dsvfms.fdb_20151019-000019.fbk
-rw-rw----. 1 firebird firebird 26678132736 Oct 19 19:33 dsvfms.fdb_20151019-000019.fdb


/ 	7. 

/ wat moet er in .classpath	?

[eric@localhost 2015.03]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/2015.03
/ TODO




 

/ Einde DSVSOL-2739

/ PCT-749

/ Lees	, 

https://ci.apache.org/projects/wicket/guide/7.x/guide/single.html#keepControl_1

6.4 Creating in-line panels with WebMarkupContainer 

/ FIX PCT-749

$ vi UnitListViewPanel.java

<wicket:panel>
	<table>
		<tbody class="panel-field">
			<tr class="panel-field">
				<td wicket:id="thLabel" class="label"><wicket:message key="shipmentitem.labelinfo">Tracking Number</wicket:message></td>
...
			</tr>
			<tr wicket:id="unitlist" class="panel-field">
				<td class="panel-field" wicket:enclosure="label"><span wicket:id="label" /></td>
...

$ vi UnitListViewPanel.java

	protected void init() {

		final boolean labelInfoIsHidden = ApplicationPropertyManager.getInstance().getProperty("module.oms.customerview.labelinfo.hidden", false);

		WebMarkupContainer thLabelInfo = new WebMarkupContainer("thLabelInfo");
		add(thLabelInfo);
		thLabelInfo.setVisible(labelInfoIsHidden);

		RepeatingView myView = new RepeatingView("unitlist") {
			@Override
			protected void onPopulate() {
				for (ShipmentItemVO myItem : model.getObject().getShipmentItemList()) {
					WebMarkupContainer myParent = new WebMarkupContainer(newChildId());
					myParent.add(new Label("unit", new PropertyModel<String>(myItem, "shippingUnit.code")));
					Label labelinfo = new Label("label", new PropertyModel<String>(myItem, "labelInfo"));
					labelinfo.setVisible(labelInfoIsHidden);
					myParent.add(labelinfo);

/ Doordat we wicket compnent "label" visible false hebben set	, wordt de td dat ook , vanwege de wicket:enclosure attribute	, see book (132)	, 
				<td class="panel-field" wicket:enclosure="label"><span wicket:id="label" /></td>

/ create database property

Name: module.oms.customerview.labelinfo.hidden
Code: hide labelInfo column on Unit tab on Customer View screen

/ Einde FIX PCT-749



/ Einde PCT-749

/ PCT-737

/ 7	. 

/ shipment order search	,
/ party

			<map:action logger="shipmentorder" name="shipmentOrderList" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderListAction"/>			
			<map:action logger="party" name="partyList" src="com.mpobjects.oms.control.party.action.PartyListAction"/>

			<map:match pattern="shipment-order_list">
				<map:act type="shipmentOrderList"/>			
				<map:call resource="dynatablePage">
					<map:parameter name="xsp" value="xsp/shipment-order_list.xml"/>
				</map:call>
			</map:match>

			<map:match pattern="party_list">
				<map:act type="partyList"/>
				<map:call resource="dynatablePage">
					<map:parameter name="xsp" value="xsp/party_list.xml"/>
				</map:call>
			</map:match>


/ In xsp/shipment-order_list.xml zien we niets 	, 

$ vi generic-dynatablepage.xsl

	<xsl:import href="generic-search.xsl" />

$ vi generic-search.xsl

					<xsl:apply-templates select="input"></xsl:apply-templates>
                    <button  type="button" class="icon_filter small" href="#" onclick="javascript:filter();">
                    </button>
                    <button type="button" class="icon_filter_clear small" href="#" onclick="javascript:resetFilter();">
                    </button>
                    <xsl:choose>
                        <xsl:when test="$no-refresh='true'">                   
/ NEE
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:text> </xsl:text>
                            <button type="button" class="icon_refresh small" href="#" onclick="javascript:refresh();">
                            </button>
                        </xsl:otherwise>
                    </xsl:choose>




$ vi dynatable.js

function filter(){
   myAddress = getLocation();
"https://test-pnl.mp-objects.com/pnllogistics/oms/party_list"			/ we filter op de party screen	,
"http://localhost:8080/tms/oms/shipment-order_list"
   var myDoElement = document.getElementById("do");
   
   myDoElement.value="filter";
   
   document.filterform.action=myAddress + '?screenId='+getScreenId();
"https://test-pnl.mp-objects.com/pnllogistics/oms/party_list?screenId=party"
"http://localhost:8080/tms/oms/shipment-order_list?screenId=shipment-order"
   if (maySubmit()) {
       document.filterform.submit();
   }
   alreadySubmitted=true;
}

function refresh(){
   myAddress = getLocation() + '?refresh=true';
"http://localhost:8080/tms/oms/shipment-order_list?refresh=true"
"http://localhost:8080/tms/oms/party_list?refresh=true"
   document.filterform.action=myAddress;
   if (maySubmit()) {
/ JA
       document.filterform.submit();
   }
   alreadySubmitted=true;
}

/ 7	. 

/ Als we filter click 	, zien we 	, 

Query String parameters
screenId: shipment-order

/ Als we refresh click	, dan zien we 	,

Query String parameters
refresh=true


/ Als we filter/refresh click 	, zien we 	,

Form Data

column:
do:filter
base_sessionLevelOffset:0
is_search_header_request:true
usePaginator:true
screenId:shipment-order
selectBox:null;;;;
filter_1:
filter_2:
filter_3:
filter_4:
filter_5:
filter_6:
filter_7:
filter_8:
filter_9:
filter_10:
filter_11:
filter_12:
filter_13:
filter_14:
filter_15:
filter_16:
filter_17:
filter_18:
filter_19:
filter_20:
filter_21:
filter_22:
filter_23:
filter_24:>07-Sep-2015

/ 7	. 

/ Nu bij party's	, 

/ Als we configuration, planning, parties	, 
/ dan Table=party_types

/ click edit button op een van de rows	, 
/ we zien dat refresh=true !

$ vi party-type-preselection-list.xsl

    <xsl:import href="../../core/xsl/generic-dynatablepage.xsl"/>    
    
    <xsl:template name="custom_header">
       <script type="text/javascript">
            function showParties(aSystemId){
              document.location.href="party_list?party_type_systemid=" + aSystemId + "&amp;refresh=true";
            }
        </script>
    </xsl:template>
 
/ we zien in HTML,	
...
<script src="../script/dynatable.js" type="text/javascript"></script>
<script type="text/javascript">
	function showParties(aSystemId){
   		document.location.href="party_list?party_type_systemid=" + aSystemId + "&refresh=true";
    }
</script>

/ de edit button	, 
	<a href="#" onclick="javascript:showParties(26681476)"><img src="../lookandfeel/styles/images/icons/bullet_ball_green16.gif"></a>


/ Einde PCT-737


/ DEBUG PCT-737

/ 7	. 

/ b's

AbstractAction [line: 137] - act(Redirector, SourceResolver, Map, String, Parameters)	
AbstractSaveAction [line: 64] - act()	
AdvancedPathDeterminationServiceImpl [line: 792] - evaluateServiceActionTemplate(int, DateTime, DateTime)	
AutomaticPathAssignmentService [line: 45] - assignPath(ShipmentOrderVO)	
AutomaticPathAssignmentService [line: 61] - assignPath(ShipmentOrderVO)	
DatabaseColumn [line: 106] - setFilter(String)	
DynaQuery [line: 111] - toSQL()	
ListAction [line: 58] - act()	
PartyListAction [line: 30] - getList()	
PartyListByGroupAction [line: 43] - getList()	
PathServiceImpl [line: 338] - getPathsFor(Resource, ShipmentOrderVO, PathSelectionMode, int)	
ServiceActionCache$ServiceActionCacheObject [line: 191] - next(DateTime, DateTime)	
ServiceActionTemplate [line: 821] - setServiceOrderTemplateList(Collection<ServiceOrderVO>)	
Table [line: 112] - Table(String, FilterCache, Request)	
Table [line: 129] - addAction(String, String)	
Table [line: 141] - addAction(TableAction)	
Table [line: 208] - addColumn(String)	
Table [line: 222] - addColumn(String, int)	
Table [line: 233] - addDatabaseColumn(String)	
Table [line: 260] - addDatabaseColumn(String, String, int)	
Table [line: 275] - addDatabaseColumn(String, String, int, boolean)	
Table [line: 280] - addDatabaseJoinColumn(String, String, int)	
Table [line: 301] - addDatabaseJoinColumn(String, String, int, int)	
Table [line: 312] - addHiddenColumn(String)	
Table [line: 327] - addHiddenColumn(String, int)	
Table [line: 339] - addHiddenDatabaseColumn(String, String)	
Table [line: 352] - addHiddenDatabaseColumn(String, String, boolean)	
Table [line: 440] - addRow(Row)	
Table [line: 460] - addRow(RowValue[])	
Table [line: 471] - addRow(String[])	
Table [line: 491] - filter()	
Table [line: 498] - filter()	
Table [line: 679] - mustReload()	
Table [line: 715] - mustReload()	
Table [line: 726] - mustReload()	
Table [line: 741] - reloadFilters()	
Table [line: 777] - resetScreenId()	
Table [line: 805] - setFilter(Map<String, String>)	
Table [line: 812] - setFilter(Map<String, String>)	
Table [line: 883] - setMessage(String, Pair<String, String>...)	
TableManager [line: 39] - flushTableCache(Request)	
TableManager [line: 52] - flushTableCache(Request, String)	
TableManager [line: 63] - getLastUsedTable(Request)	
TableManager [line: 74] - getTable(String, Request)	
TableManager [line: 103] - storeInCache(Session, Table, String)	
DatabaseColumn [access and modification] - theFilter	









/7	. 

/ we click filter op een shipment order	, met alleen system_entry_date filter : > 07-Sep-2015

/ submit form	,
/s
ShipmentOrderListAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
			String myScreenId = theRequest.getParameter(Table.ATTRIBUTE_SCREEN_ID);
shipment-order

				Map myMap = act();
/s
ShipmentOrderListAction.act() line: 16	

/c
SetAttributesAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
/ aParameterList=Parameters[r/w]:{overwriteAttributes=false, attributesType=request, dynatableXsl=../core/xsl/generic-dynatablepage.xsl}

				Map myMap = act();
/s
SetAttributesAction.act() line: 34	
		for (String myMyName : myNames) {
[overwriteAttributes, 
dynatableXsl]
			myKey = myMyName;
			myValue = getParameters().getParameter(myKey);
false
../core/xsl/generic-dynatablepage.xsl
			} else {
				if (myMayOverwrite || !myMayOverwrite && ObjectUtils.isEmpty(getRequest().getAttribute(myKey))) {
					getRequest().setAttribute(myKey, myValue);
dynatableXsl: ../core/xsl/generic-dynatablepage.xsl

/c
shipment_order_list_xml.generate() line: 644	
/s
Table.setFilter(Map<String,String>) line: 805	
/=
	public void setFilter(Map<String, String> aMap) {
aMap= {19=, 17=, 22=, 18=, 23=, 15=, 24=>07-Sep-2015, 16=, 13=, 14=, 11=, 12=, 21=, 3=, 2=, 20=, 10=, 1=, 7=, 6=, 5=, 4=, 9=, 8=}
		for (String myKey : aMap.keySet()) {
19
			if (!"".equals(myKey)) {
				int myIndex = Integer.parseInt(myKey);
19
				Column myColumn = myCols[myIndex];
Column:to_country
				String myValue = aMap.get(myKey);
""

			if (StringUtils.equalsIgnoreCase(ALL, myValue) && (
				StringUtils.equalsIgnoreCase("planned_start_after", myColumn.getName()) && StringUtils.equalsIgnoreCase(getName(), "service-order") || 	
				StringUtils.equalsIgnoreCase("system_entry_date", myColumn.getName()) && StringUtils.equalsIgnoreCase(getName(), "shipment-order")
				)) {
/ NEE
				}
				if (myColumn.isPropertyFiltered() && myValue.isEmpty()) {
/ NEE
				} else {
					setFilter(myColumn, myValue, FilterCache.FILTER_TYPE_USER);
/s
Table.setFilter(Column, String, String) line: 1060	
		aColumn.setFilter(aValue);
		String myFilterKey = "" + getScreenId() + "." + getName() + "." + aColumn.getName();
/s
Table.getScreenId() line: 614	
			myAttr = getRequest().getSession().getAttribute(ATTRIBUTE_SCREEN_ID);
shipment-order
/t
		String myFilterKey = "" + getScreenId() + "." + getName() + "." + aColumn.getName();
/d
shipment-order.shipment-order.to_country
		filterCache.setFilterValue(myFilterKey, aValue, aFilterType);
/ aValue=""
/ aFilterType="user_filter"
/s
FilterCache.setFilterValue(String, String, String) line: 130	
/=
	public void setFilterValue(String aKey, String aFilterValue, String aType) {
Key	"shipment-order.shipment-order.to_country" (id=21664)	

		String myProperty = ApplicationPropertyManager.getInstance().getModuleProperty(MODULE_NAME.toLowerCase(),
				getPropertyKey(aKey) + FILTER_CACHE_KEY.toLowerCase(), "both");
/=
		String myProperty = ApplicationPropertyManager.getInstance().getModuleProperty("core_dynatable",
				"shipment-order.shipment-order.filter.cache", "both");

/ Let op	,
getPropertyKey(aKey)="shipment-order.shipment-order."
/ TODO

/s
ApplicationPropertyManager.getProperty(String, String) line: 531	
/=
	public String getProperty(String aKey, String aDefaultValue) {
/ key	 module.core.dynatable.shipment-order.shipment-order.filter.cache

/ Let op:
/ In de code hier vlakvoor wordt module. ervoor set	, en core_dyhatable wordt core.dynatable	,
/ Deze zien we inderdaad in de properties file	,
"none"
/ TODO
		if (FILTER_TYPE_USER.equals(aType) && StringUtils.equals(myProperty.trim().toUpperCase(), FILTER_CACHE_NONE)) {
			skipFilter = true;

/t
Table.setFilter(Column, String, String) line: 1067	

		filterCache.setFilterValue(myFilterKey, aValue, aFilterType);
/d
/ Doet NIETS	,
/ Door de property	 module.core.dynatable.shipment-order.shipment-order.filter.cache=none doet we geen filter caching	,

		// Update the DynaQuery
		if (dynaQuery != null && (aColumn instanceof DatabaseColumn || aColumn instanceof DatabaseJoinColumn)) {
			Filter myFilter = aColumn.getFilter();
			if (myFilter != null) {
/ NEE
				dynaQuery.add(aColumn.getFilter());
/ NIET

/ Intermezzo

this	Table  (id=21066)	
	dynaQuery	DynaQuery  (id=22127)	
		maxResultCount	2000	
		orderByColumn	null	
		orderByDirection	"ASC" (id=22214)	
		theFilterList	ArrayList  (id=22220)	
		theQuery	"SELECT SHO.* FROM SHIPMENT_ORDER SHO WHERE IS_TEMPLATE = 0 AND ORGANIZATION_SYSTEMID IN {USER_ORGANIZATIONS} -#1 AND FROM_COUNTRY_SYSTEMID IN (SELECT SYSTEM_ID FROM COUNTRY WHERE ?)#--#2 AND TO_COUNTRY_SYSTEMID IN (SELECT SYSTEM_ID FROM COUNTRY WHERE ?)#--#3 AND STATUS_CODE_SYSTEMID IN (SELECT SYSTEM_ID FROM ORDER_STATUS WHERE ?)#--#4 AND HOLD_STATUS_SYSTEMID IN (SELECT SYSTEM_ID FROM HOLD_STATUS WHERE ?)#--#5 AND STATUS_CODE_SYSTEMID IN (SELECT SYSTEM_ID FROM ORDER_STATUS WHERE ?)#--#6 AND SYSTEM_ID IN (SELECT SHIPMENT_ORDER_SYSTEMID FROM SHIPMENT_ITEM WHERE ?)#--#7 AND ACT_SERVICE_LEVEL_SYSTEMID IN (SELECT SYSTEM_ID FROM SHIPMENT_SERVICE_LEVEL WHERE ?)#--#8 AND INCO_TERM_SYSTEMID IN (SELECT SYSTEM_ID FROM INCO_TERM WHERE ?)#--#9 AND SYSTEM_ID IN (SELECT SHIPMENT_ORDER_SYSTEMID FROM SHIPMENT_ITEM WHERE ?)#--#10 AND SHIPM_TYPE_SYSTEMID IN (SELECT SYSTEM_ID FROM SHIPMENT_ORDER_TYPE WHERE ?)#--#11 AND ORGANIZATION_SYSTEMID IN (SELECT SYSTEM_ID FROM ORGANIZATION WHERE ?)#--#12 AND CUSTOMER_STATUS_SYSTEMID IN (SELECT SYSTEM_ID FROM CUSTOMER_STATUS WHERE ?)#--#13 AND PREFERED_PARTY_SYSTEMID IN (SELECT SYSTEM_ID FROM PARTY WHERE ?)#--#14 AND ASSIGNEE_SYSTEMID IN (SELECT SYSTEM_ID FROM TMS_USER WHERE ?)#--#15 AND ORDER_PROCESS_SYSTEMID IN (SELECT SYSTEM_ID FROM ORDER_PROCESS WHERE ?)#-" (id=22221)	

/ Einde Intermezzo

/t
Table.setFilter(Map<String,String>) line: 812	

/ volgende	,
		for (String myKey : aMap.keySet()) {
24
			if (!"".equals(myKey)) {
				int myIndex = Integer.parseInt(myKey);
				Column myColumn = myCols[myIndex];
Column:system_entry_date
				String myValue = aMap.get(myKey);
>07-Sep-2015
				} else {
					setFilter(myColumn, myValue, FilterCache.FILTER_TYPE_USER);
/s
Table.setFilter(Column, String, String) line: 1057	
		aColumn.setFilter(aValue);

		// Also update the cache
		String myFilterKey = "" + getScreenId() + "." + getName() + "." + aColumn.getName();
shipment-order.shipment-order.system_entry_date

		filterCache.setFilterValue(myFilterKey, aValue, aFilterType);
/s
FilterCache.setFilterValue(String, String, String) line: 124	

		String myProperty = ApplicationPropertyManager.getInstance().getModuleProperty(MODULE_NAME.toLowerCase(),
				getPropertyKey(aKey) + FILTER_CACHE_KEY.toLowerCase(), "both");
none

		if (FILTER_TYPE_USER.equals(aType) && StringUtils.equals(myProperty.trim().toUpperCase(), FILTER_CACHE_NONE)) {
/ JA
			skipFilter = true;
		}

/t
Table.setFilter(Column, String, String) line: 1070	

		filterCache.setFilterValue(myFilterKey, aValue, aFilterType);
/d
/ Doet NIETS 
/ Door de property	 module.core.dynatable.shipment-order.shipment-order.filter.cache=none doet we geen filter caching	,

		// Update the DynaQuery
		if (dynaQuery != null && (aColumn instanceof DatabaseColumn || aColumn instanceof DatabaseJoinColumn)) {
			Filter myFilter = aColumn.getFilter();
			if (myFilter != null) {
/ JA
				dynaQuery.add(aColumn.getFilter());
dynaQuery	DynaQuery  (id=22127)	
	filterCache.setFilterValue(myFilterKey, aValue, aFilterType);
[>07-Sep-2015]
	theQuery
/ onveranderd	,

/c
Table.filter() line: 491	
		for (Column myCol : columns) {
			myFilterBuffer.append(myCol.getFilterExpression());
			myFilterBuffer.append("#");
		}
########################>07-Sep-2015#		
/ # is scheidingsteken	, staat achter de column filter	,

		if (!myFilterBuffer.toString().equals(oldFilter)) {
/ NEE
		// If the code is executed,data has been refreshed
		forceRefreshFlag = false;

/c
Table.reloadFilters() line: 761	
		if (!StringUtils.equals(oldScreenId, getScreenId())) {
/ NEE
/ Dus doet NIETS	,

/c
/ we zien de query	,
LOG:  execute <unnamed>: SELECT SHO.* FROM SHIPMENT_ORDER SHO WHERE IS_TEMPLATE = 0 AND ORGANIZATION_SYSTEMID IN (0,500,1020,1010,1) 
 and system_entry_date > '2015-09-07' limit $1
////////////////////////////
/ See DynaQuery.toSQL	, 
		// Remove unused join stuff
		while (true) {
			int myStart = myQuery.indexOf("-#");
...

/ 7	. 

/ we geven 29 in shipment_order_id field filter , en laten system_entry_date filter staan	,

/ we click filter	,
/s
Table.setFilter(Map<String,String>) line: 805	

		for (String myKey : aMap.keySet()) {
/ aMap={19=, 17=, 22=, 18=, 23=, 15=, 24=>07-Sep-2015, 16=, 13=, 14=, 11=, 12=, 21=, 3=, 2=29, 20=, 10=, 1=, 7=, 6=, 5=, 4=, 9=, 8=}
myKey	"2" (id=23279)	
				int myIndex = Integer.parseInt(myKey);
2
				Column myColumn = myCols[myIndex];
Column:shipment_order_id
				String myValue = aMap.get(myKey);
29
				} else {
					setFilter(myColumn, myValue, FilterCache.FILTER_TYPE_USER);
/s
Table.setFilter(Column, String, String) line: 1057	
		// Update the DynaQuery
		if (dynaQuery != null && (aColumn instanceof DatabaseColumn || aColumn instanceof DatabaseJoinColumn)) {
			Filter myFilter = aColumn.getFilter();
myFilter	CacheFilter  (id=23368)	
/ TODO
			if (myFilter != null) {
				dynaQuery.add(aColumn.getFilter());
dynaQuery
	theFilterList	ArrayList  (id=22220)	
[>07-Sep-2015, 29]

/c
Table.mustReload() line: 694	
		boolean myResult = false;

		if (forceRefreshFlag) {
/ NEE
		} else if (forceFilterFlag) {
/ NEE
		} else {
			for (Column myColumn : columns) {
				if (myColumn.mustReload()) {
/ TODO
/ NEE
		if (myResult) {
/ NEE

		return myResult;
false

/c
Table.filter() line: 491	
		for (Column myCol : columns) {
			myFilterBuffer.append(myCol.getFilterExpression());
			myFilterBuffer.append("#");
		}
##29######################>07-Sep-2015#

		if (!myFilterBuffer.toString().equals(oldFilter)) {
/ JA
			rows.clear();

			Column[] myCols = getColumns();
			row: for (Row myRow : originalRows) {
/ aantal=20	,
				int i = 0;
				for (RowValue element : myRow.getValues()) {
					if (!myCols[i++].filter(element)) {
						continue row;
/ Als een rij in de een of andere column niet voldoet aan het filter	,

			reshuffle();
/ sort	,

/ 7	. 

/ we click op refresh	, met de shipment_order_id filter op 29 en de system_entry_date=>05-Sep-2015 	,

/c
Table.mustReload() line: 709	
		boolean myResult = false;

		if (forceRefreshFlag) {
			oldFilter = "";
			myResult = true;

this.columns=
[Column:SYSTEMID,
 Column:shipment_order_process,
 Column:shipment_order_id,
 Column:status,
 Column:description,
 Column:hold_status,
 Column:shipment_type,
 Column:total_weight_kg,
 Column:price,
 Column:cost,
 Column:shipmentorder.reference1.pnllogistics.general,
 Column:shipmentorder.reference2.pnllogistics.general,
 Column:shipmentorder.reference3.pnllogistics.general,
 Column:from_name,
 Column:from_city,
 Column:from_country,
 Column:from_postal_code,
 Column:to_name,
 Column:to_city,
 Column:to_country,
 Column:to_postal_code,
 Column:pref_party,
 Column:requested_end_after,
 Column:requested_end_before,
 Column:system_entry_date]

		if (myResult) {
			// The table will be reloaded from the DB, therefore set the DBFilter
			// in all columns
			for (Column myColumn : columns) {
				if (myColumn instanceof DatabaseColumn) {
					DatabaseColumn myDBCol = (DatabaseColumn) myColumn;
Column:shipment_order_process
					myDBCol.setDBFilter();
/s
DatabaseJoinColumn(DatabaseColumn).setDBFilter() line: 100	
		if (theFilter instanceof CacheFilter) {
/ NEE
		theReloadFlag = true;
/t
Table.mustReload() line: 710	

/volgende	,
			for (Column myColumn : columns) {
				if (myColumn instanceof DatabaseColumn) {
					DatabaseColumn myDBCol = (DatabaseColumn) myColumn;
Column:shipment_order_id
					myDBCol.setDBFilter();
/s
DatabaseColumn.setDBFilter() line: 97	
		if (theFilter instanceof CacheFilter) {
/ JA
			theFilter = new DatabaseFilter(theFilter.getFilterExpression(), this);
		}
		theReloadFlag = true;

/t

Table.mustReload() line: 710	
            for (Column myColumn : columns) {
/d
/ allemaal gedaan	,

		return myResult;
true

/c
DynaQuery.toSQL() line: 111	

		String myQuery = theQuery;
SELECT SHO.* FROM SHIPMENT_ORDER SHO WHERE IS_TEMPLATE = 0 AND ORGANIZATION_SYSTEMID IN {USER_ORGANIZATIONS} -#1 AND FROM_COUNTRY_SYSTEMID IN (SELECT SYSTEM_ID FROM COUNTRY WHERE ?)#--#2 AND TO_COUNTRY_SYSTEMID IN (SELECT SYSTEM_ID FROM COUNTRY WHERE ?)#--#3 AND STATUS_CODE_SYSTEMID IN (SELECT SYSTEM_ID FROM ORDER_STATUS WHERE ?)#--#4 AND HOLD_STATUS_SYSTEMID IN (SELECT SYSTEM_ID FROM HOLD_STATUS WHERE ?)#--#5 AND STATUS_CODE_SYSTEMID IN (SELECT SYSTEM_ID FROM ORDER_STATUS WHERE ?)#--#6 AND SYSTEM_ID IN (SELECT SHIPMENT_ORDER_SYSTEMID FROM SHIPMENT_ITEM WHERE ?)#--#7 AND ACT_SERVICE_LEVEL_SYSTEMID IN (SELECT SYSTEM_ID FROM SHIPMENT_SERVICE_LEVEL WHERE ?)#--#8 AND INCO_TERM_SYSTEMID IN (SELECT SYSTEM_ID FROM INCO_TERM WHERE ?)#--#9 AND SYSTEM_ID IN (SELECT SHIPMENT_ORDER_SYSTEMID FROM SHIPMENT_ITEM WHERE ?)#--#10 AND SHIPM_TYPE_SYSTEMID IN (SELECT SYSTEM_ID FROM SHIPMENT_ORDER_TYPE WHERE ?)#--#11 AND ORGANIZATION_SYSTEMID IN (SELECT SYSTEM_ID FROM ORGANIZATION WHERE ?)#--#12 AND CUSTOMER_STATUS_SYSTEMID IN (SELECT SYSTEM_ID FROM CUSTOMER_STATUS WHERE ?)#--#13 AND PREFERED_PARTY_SYSTEMID IN (SELECT SYSTEM_ID FROM PARTY WHERE ?)#--#14 AND ASSIGNEE_SYSTEMID IN (SELECT SYSTEM_ID FROM TMS_USER WHERE ?)#--#15 AND ORDER_PROCESS_SYSTEMID IN (SELECT SYSTEM_ID FROM ORDER_PROCESS WHERE ?)#-

		if (theFilterList.size() > 0) {
[>07-Sep-2015, 29]
			for (Object myElement : theFilterList) {
				myFilter = (Filter) myElement;
				myFilter = new DatabaseFilter(myFilter.getFilterExpression(), (DatabaseColumn) myFilter.getColumn());
				mySQL = myFilter.toSQL();
system_entry_date > '2015-09-07'

				myColumn = myFilter.getColumn();
				if (myColumn instanceof DatabaseJoinColumn) {
/ NEE
				} else {
...
						} else {
							myBuffer.append(" and " + mySQL);

myBuffer	StringBuffer  (id=23938)	
 and system_entry_date > '2015-09-07' and upper(shipment_order_id) LIKE '%29%'

		if (myQuery.indexOf(USER_ORGANIZATIONS) > -1) {
			myQuery = myQuery.replace(USER_ORGANIZATIONS, getUserOrganizations());

SELECT SHO.* FROM SHIPMENT_ORDER SHO WHERE IS_TEMPLATE = 0 AND ORGANIZATION_SYSTEMID IN (0,500,1020,1010,1) -#1 AND FROM_COUNTRY_SYSTEMID IN (SELECT SYSTEM_ID FROM COUNTRY WHERE ?)#--#2 AND TO_COUNTRY_SYSTEMID IN (SELECT SYSTEM_ID FROM COUNTRY WHERE ?)#--#3 AND STATUS_CODE_SYSTEMID IN (SELECT SYSTEM_ID FROM ORDER_STATUS WHERE ?)#--#4 AND HOLD_STATUS_SYSTEMID IN (SELECT SYSTEM_ID FROM HOLD_STATUS WHERE ?)#--#5 AND STATUS_CODE_SYSTEMID IN (SELECT SYSTEM_ID FROM ORDER_STATUS WHERE ?)#--#6 AND SYSTEM_ID IN (SELECT SHIPMENT_ORDER_SYSTEMID FROM SHIPMENT_ITEM WHERE ?)#--#7 AND ACT_SERVICE_LEVEL_SYSTEMID IN (SELECT SYSTEM_ID FROM SHIPMENT_SERVICE_LEVEL WHERE ?)#--#8 AND INCO_TERM_SYSTEMID IN (SELECT SYSTEM_ID FROM INCO_TERM WHERE ?)#--#9 AND SYSTEM_ID IN (SELECT SHIPMENT_ORDER_SYSTEMID FROM SHIPMENT_ITEM WHERE ?)#--#10 AND SHIPM_TYPE_SYSTEMID IN (SELECT SYSTEM_ID FROM SHIPMENT_ORDER_TYPE WHERE ?)#--#11 AND ORGANIZATION_SYSTEMID IN (SELECT SYSTEM_ID FROM ORGANIZATION WHERE ?)#--#12 AND CUSTOMER_STATUS_SYSTEMID IN (SELECT SYSTEM_ID FROM CUSTOMER_STATUS WHERE ?)#--#13 AND PREFERED_PARTY_SYSTEMID IN (SELECT SYSTEM_ID FROM PARTY WHERE ?)#--#14 AND ASSIGNEE_SYSTEMID IN (SELECT SYSTEM_ID FROM TMS_USER WHERE ?)#--#15 AND ORDER_PROCESS_SYSTEMID IN (SELECT SYSTEM_ID FROM ORDER_PROCESS WHERE ?)#-

		// Remove unused join stuff
		while (true) {
			int myStart = myQuery.indexOf("-#");
108
			int myEnd = myQuery.indexOf("#-", myStart);
			myQuery = myQuery.substring(0, myStart) + myQuery.substring(myEnd + 2);

/ rm alles wat tussen de -# en #-'s staat	,  zolang ze er zijn	,

/ TODO (Wanneer zijn de nodige -# en #-'s weggehaald, zodat we nu nog met een aantal zitten?)

			myQuery += myBuffer.toString();

		return myQuery;
SELECT SHO.* FROM SHIPMENT_ORDER SHO WHERE IS_TEMPLATE = 0 AND ORGANIZATION_SYSTEMID IN (0,500,1020,1010,1)  and system_entry_date > '2015-09-07' and upper(shipment_order_id) LIKE '%29%'


/ 7	.

/ SET TABLE RESFRESH

/ we vragen de list van shipment orders, via het menu, met 2 filters , op shipment_order_id en system_entry_date	,

/ als we het menu use, is dat hetzelfde als het scherm laten staan en click op filter button	,

shipment_order_list_xml.generate() line: 393	
/s
TableManager.getTable(String, Request) line: 90	
/=
	public Table getTable(String aTableName, Request aRequest) {
aTableName="shipment-order"
		Table myTable = null;
		String myStartEmptyString = aRequest.getParameter("startempty");
null
		boolean myStartEmpty = myStartEmptyString != null && TRUE.equals(myStartEmptyString);
false
		if (!myStartEmpty) {
			myTable = getFromCache(mySession, aTableName);
/s
TableManager.getFromCache(Session, String) line: 98	
		Table myTable = (Table) aSession.getAttribute(aTableName + TABLE_SUFFIX);
/ aTableName + TABLE_SUFFIX=shipment-order_Table
myTable	Table  (id=21066)	
		aSession.setAttribute(LAST_USED_TABLE, aTableName);
		return myTable;
/t
TableManager.getTable(String, Request) line: 90	
			myTable = getFromCache(mySession, aTableName);
/d
		if (!myStartEmpty) {
/ JA
//////////////////////////////////////////////////
/ GET TABLE RESFRESH
			String myRefreshParam = aRequest.getParameter("refresh");
false
			myTable.setForceRefresh(myRefreshParam != null && TRUE.equals(myRefreshParam));
/s
Table.setForceRefresh(boolean) line: 875	
		forceRefreshFlag = aFlag;
false
/t
			myTable.setForceFilter(myRefreshParam != null && FALSE.equals(myRefreshParam));
/s
Table.setForceFilter(boolean) line: 865	
		forceFilterFlag = aFlag;
true

/c
Table.mustReload() line: 691	
		if (forceRefreshFlag) {
/ NEE
			myResult = true;
/ NIET
		} else if (forceFilterFlag) {
/ JA
			myResult = false;

/ TODO (Wanneer 3de mog?)

		return myResult;

/c
Table.filter() line: 491	
		for (Column myCol : columns) {
			myFilterBuffer.append(myCol.getFilterExpression());
			myFilterBuffer.append("#");
		}
##29######################>07-Sep-2015#

		if (!myFilterBuffer.toString().equals(oldFilter)) {
			rows.clear();

			Column[] myCols = getColumns();
			row: for (Row myRow : originalRows) {
[]
			reshuffle();
/= Collections.sort

		// If the code is executed,data has been refreshed
		forceRefreshFlag = false;
/ Was al bij ons	, want de hadden niet op refresh click	,

/ Geen DynaQuery.toSQL	,

/ 7	. 

/ we click refresh met op de list van shipment orders, met 2 filters , op shipment_order_id en system_entry_date	,

/s
TableManager.getTable(String, Request) line: 74	
		Table myTable = null;
		String myStartEmptyString = aRequest.getParameter("startempty");
		boolean myStartEmpty = myStartEmptyString != null && TRUE.equals(myStartEmptyString);
false
		if (!myStartEmpty) {
			myTable = getFromCache(mySession, aTableName);
		}
		if (!myStartEmpty) {
			String myRefreshParam = aRequest.getParameter("refresh");
true
			myTable.setForceRefresh(myRefreshParam != null && TRUE.equals(myRefreshParam));
true
			myTable.setForceFilter(myRefreshParam != null && FALSE.equals(myRefreshParam));
false

/c
Table.setFilter(Map<String,String>) line: 849	
/ Hetzelfde voor filter/refresh

/c
Table.mustReload() line: 679	
		if (forceRefreshFlag) {
			oldFilter = "";
			myResult = true;

		if (myResult) {
			// The table will be reloaded from the DB, therefore set the DBFilter
			// in all columns
			for (Column myColumn : columns) {
				if (myColumn instanceof DatabaseColumn) {
					DatabaseColumn myDBCol = (DatabaseColumn) myColumn;
					myDBCol.setDBFilter();

		return myResult;
true

/c
DynaQuery.toSQL() line: 111	


/c
Table.filter() line: 493	
		for (Column myCol : columns) {
			myFilterBuffer.append(myCol.getFilterExpression());
			myFilterBuffer.append("#");
		}
##29######################>07-Sep-2015#

/ 7	. 

/ Als we config, planning, parties	, dan krijgen we een list van party types	, 
/ Als we een party type edit,	 is er een refresh=true param	, 
/ Maar we zien geen DynaQuery.toSQL
/ TODO

/ 7	. 

/ party types	,

$ vi party-type_list.xml

            Collection myList = (Collection) request.getAttribute("dynatable_list");
/ query is gedaan NIET met DynaQuery	,

$ vi party-type-preselection-list.xsl

   <xsl:template name="custom_header">
       <script type="text/javascript">
            function showParties(aSystemId){
              document.location.href="party_list?party_type_systemid=" + aSystemId + "&amp;refresh=true";
            }
        </script>
    </xsl:template>
   
    <xsl:template match="row">
        <tr class="list{(position()-1) mod 2}">
            <td class="list" width="20">
                <a href="#">
                    <xsl:attribute name="onclick">
                        <xsl:text>javascript:showParties(</xsl:text>
                        <xsl:value-of select="./column[@name='SYSTEMID']"/>

/ Dus de js is def in de xsl	, NIET in dynatable.js	, 

/ parties	,

$ vi party_list.xml

            Collection myList =  (Collection) request.getAttribute("dynatable_list");
/ query al gedaan in action	, niet DynaQuery.toSQL	,

/ Maar WH altijd generic-dynatablepage.xsl	,
/ TODO
/ Want de refresh, filter buttons komen hieruit	, 
$ vi generic-dynatablepage.xsl

	<xsl:template match="page">
		<html>
			<head>
				<title>
					<xsl:value-of select="dynatable/@recordlabel" />
					management
				</title>
				<div class="dialog" id="dialog" title="please.wait" i18n:attr="title">
            		<p><i18n:text>already.loading</i18n:text></p>
        		</div>
				<link rel="stylesheet" href="../lookandfeel/styles/style.css" type="text/css" />
				<meta http-equiv="Content-Type" content="tex/html; charset=UTF-8" />
				<meta http-equiv="Pragma" content="NO-CACHE" />
				<script type="text/javascript" src="../script/class.pagerequest.js"></script>
				<script type="text/javascript" src="../script/jquery.min.js" />
				<script type="text/javascript" src="../script/jquery-ui.min.js" />
->				<script type="text/javascript" src="../script/dynatable.js"></script>

/ als we filter click op list van party types, 	

$ vi dynatable.js

function filter(){
   myAddress = getLocation();
"https://test-pnl.mp-objects.com/pnllogistics/oms/party-type_preselect_list"

/ myAddress is dus de page waarop je bent	, (als je filter click)	,

/ 7	. 

/ als we config, planning, parties
/s
PartyTypeListAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	




/ 7	. 

/ Als we config, planning, parties	, dan krijgen we een list van party types	, 

$ vi oms-sitemap.xmap

			<map:action logger="party" name="partyTypeList" src="com.mpobjects.oms.control.partytype.action.PartyTypeListAction"/>

			<map:match pattern="party-type_preselect_list">
				<map:act type="partyTypeList"/>
				<map:call resource="dynatablePage">
				    <map:parameter name="xsp" value="xsp/party-type_list.xml"/>
				    <map:parameter name="xsl" value="xsl/party-type-preselection-list.xsl"/>
				    <map:parameter name="edit" value="false"/>
				</map:call>
			</map:match>

/s
PartyTypeListAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
				Map myMap = act();
/s
PartyTypeListAction(ListAction).act() line: 58	

		String myIdentifier = this.getClass().getPackage().getName() + "." + this.getClass().getName() + "_" + getRequest().getRequestURI();
com.mpobjects.oms.control.partytype.action.com.mpobjects.oms.control.partytype.action.PartyTypeListAction_/tms/oms/party-type_preselect_list


		if (StringUtils.isNotEmpty(getRequest().getParameter("refresh")) 
null
			&& getRequest().getParameter("refresh").equals("true")) {
/ NEE
			resetListLoaded(getSession());
/ NIET
		}
/ Als refresh=true, dan clear attribute LIST_LOADED_ATTRIBUTE	, omdat we opnieuw gaan load	,

		if (!myIdentifier.equals(getSession().getAttribute(LIST_LOADED_ATTRIBUTE))) {
/ JA
/ want !=null	,
/ WH getSession().getAttribute(LIST_LOADED_ATTRIBUTE) betekent: is er nog niet	,
			resetListLoaded(getSession());
/s
		aSession.removeAttribute(LIST_LOADED_ATTRIBUTE);
/t

		if (getSession().getAttribute(LIST_LOADED_ATTRIBUTE) == null) {
LIST_LOADED_ATTRIBUTE=dynatable_list_loaded
			// only load list if refresh=false is NOT added to the url
/ REFRESH
			if (!"false".equals(getRequest().getParameter("refresh"))) {
/ JA	, 
/ false!=null
				Collection myList = getList();
/s
PartyTypeListAction.getList() line: 36	
		return new BeanWrapper<PartyTypeDAO>(PartyTypeDAO.class).getBean().getAll();

/ Dus NIET DynaQuery.toSQL	,
/t
				Collection myList = getList();
/d
[com.mpobjects.oms.model.entity.partytype.PartyType@466c191b[OPDRACHTGEVER,Opdrachtgever (Bill to Party)],
com.mpobjects.oms.model.entity.partytype.PartyType@1d4cf95b[SORTEERHUB,Collectie of Distributiehub (Partner locatie)],
com.mpobjects.oms.model.entity.partytype.PartyType@2886d464[PARTNER,Partner],
com.mpobjects.oms.model.entity.partytype.PartyType@2be20605[RETOURADRES,Retour adres],
com.mpobjects.oms.model.entity.partytype.PartyType@3f948c5[ADRES_VASTE_COLLECT,Adres voor vaste collectie opdracht],
com.mpobjects.oms.model.entity.partytype.PartyType@63187f8c[ADRES,Adres opgeslagen uit Interface]]
/ Dit zijn ze dus allemaal	, 
/ Geen filter hier	,
/ TODO

				getRequest().setAttribute(DYNATABLE_LIST_ATTRIBUTE, myList);
				getSession().setAttribute(LIST_LOADED_ATTRIBUTE, myIdentifier);

		String myDynaListName = getDynatableListName();
/s
			return null;
/t
		String myRecordLabel = getRecordLabelName();
/s
			return null;

		return EMPTY_MAP;

/c
TableManager.getTable(String, Request) line: 74	
/=
	public Table getTable(String aTableName, Request aRequest) {
/ aTableName="party-type"

		boolean myStartEmpty = myStartEmptyString != null && TRUE.equals(myStartEmptyString);
		if (!myStartEmpty) {
			myTable = getFromCache(mySession, aTableName);
null
/ Na reload config	,
/ of, 
myTable	Table  (id=22191)	
	columns	ArrayList  (id=22408)	
[Column:SYSTEMID, Column:code, Column:description]
	dynaQuery	null	
	filterCache	FilterCache  (id=22034)	
	name	"party-type" (id=21974)	
	oldFilter	"###" (id=25347)	
	rowMap	Collections$SynchronizedMap  (id=25380)	
{26820894=com.mpobjects.view.util.table.Row@65b795e3,
 26825641=com.mpobjects.view.util.table.Row@77d19e40,
 26681476=com.mpobjects.view.util.table.Row@62ecb934,
 26681477=com.mpobjects.view.util.table.Row@237337a9,
 26681478=com.mpobjects.view.util.table.Row@614b4a6d,
 26681479=com.mpobjects.view.util.table.Row@16036c02}
	

/ NB
/ Dus het vorige filter	, we hebben nu wel een filter 

		if (myTable == null) {
/ NEE 
		if (myTable == null) {
/ JA
			myTable = new Table(aTableName, new FilterManager().getFilterCache(mySession), aRequest);
/s
new FilterManager().getFilterCache(mySession)=
				FilterCache myCache = (FilterCache) aSession.getAttribute(FILTER_CACHE);
/t
/s
Table.<init>(String, FilterCache, Request) line: 111	
		setRequest(aRequest);
		name = aName;
		filterCache = aFilterCache;
/ de filterCache was er al	,

			storeInCache(mySession, myTable, aTableName);
/s
				aSession.setAttribute(aTableName + TABLE_SUFFIX, aTable);
				aSession.setAttribute(LAST_USED_TABLE, aTableName);
/t
TableManager.getTable(String, Request) line: 88	
		if (myTable == null) {
/ JA
/ of	,
/ NEE
/d
		if (!myStartEmpty) {
/ JA
			String myRefreshParam = aRequest.getParameter("refresh");
null
			myTable.setForceRefresh(myRefreshParam != null && TRUE.equals(myRefreshParam));
false
			myTable.setForceFilter(myRefreshParam != null && FALSE.equals(myRefreshParam));

/c

$ vi party_type_list.xml
           myTable.addHiddenColumn("SYSTEMID");
            myTable.addColumn("code");
            myTable.addColumn("description");
/s
Table.addHiddenColumn(String) line: 312	
		Column myColumn = new CacheColumn(aName);
aName	"SYSTEMID" (id=30020)	
		myColumn.setHidden();
		addColumn(myColumn);
/s
Table.addColumn(Column) line: 999	
		columns.add(aColumn);
		aColumn.setTable(this);

		if (getRequest() != null) {
			// Check if there is a filter in the filter cache.
			String myKey = getScreenId() + "." + getName() + "." + aColumn.getName();
myKey	"party-type.party-type.SYSTEMID" (id=31913)	
			String[] myFilter = filterCache.getFilterValue(myKey);
null
/ want	,
this.filterCache= {
open-crossdock-dashboard-serviceaction-list.dashboard-serviceaction-list.req_start_after.appl_filter=>06-Sep-2015, 
planned-crossdock-dashboard-serviceaction-list.dashboard-serviceaction-list.req_start_after.appl_filter=>06-Sep-2015, 
service_action_template.service_action_template.service_action_type.user_filter=, 
parcel-track-and-trace.parcel-track-and-trace.system_entry_date.appl_filter=>15-Sep-2015, 
shipment-order.shipment-order.system_entry_date.appl_filter=>08-Sep-2015, 
service_action_template.service_action_template.to_city.user_filter=, 
service_action_template.service_action_template.name.user_filter=collect, 
shipment-order-booking-search.shipment-order-booking-search.system_entry_date.appl_filter=>15-Sep-2015, 
shipment-order-list-track.shipment-order-booking-search.system_entry_date.appl_filter=>15-Sep-2015, 
shipment-order-booking-search.shipment-item-list-track.system_entry_date.appl_filter=>15-Sep-2015, 
service_action_template.service_action_template.organization.user_filter=, 
service-order.service-order.status.appl_filter=<9000, 
shipment-item-list-track.shipment-order-booking-search.system_entry_date.appl_filter=>15-Sep-2015, 
file.file.uploaded_date.appl_filter=>29-Sep-2015 09:08, 
shipment-item-list-track.parcel-track-and-trace.system_entry_date.appl_filter=>15-Sep-2015, 
service-order.service-order.planned_start_after.appl_filter=>08-Sep-2015, 
service_action_template.service_action_template.to_country.user_filter=, 
service_action_template.service_action_template.from_country.user_filter=, 
service_action_template.service_action_template.from_city.user_filter=}

/ we zien geen party-type keys	,

			if (myFilter != null) {
/ NEE
				setFilter(aColumn, myFilter[0], myFilter[1]);
/ NIET

/c
Table.addColumn(String) line: 208	
		aName = StringUtils.formatJavaToSql(aName).toString();
code
		Column myColumn = new CacheColumn(aName);
myColumn	CacheColumn  (id=31971)	
	theFilter	null	
	theName	"code" (id=31957)	
	theType	0						/ TYPE_STRING

		addColumn(myColumn);
/s
	private void addColumn(Column aColumn) {
		columns.add(aColumn);
		aColumn.setTable(this);
/ weer geen filter	,



/c
Table.mustReload() line: 693	
		if (forceRefreshFlag) {
/ NEE
		} else if (forceFilterFlag) {
/ NEE
		} else {
			for (Column myColumn : columns) {
Column:SYSTEMID
				if (myColumn.mustReload()) {
/s
CacheColumn.mustReload() line: 60	
		return !theUsedFlag;
!false=true
/t
					myResult = true;
					break;
				}
			}
		}
		if (myResult) {
			// The table will be reloaded from the DB, therefore set the DBFilter
			// in all columns
			for (Column myColumn : columns) {
				if (myColumn instanceof DatabaseColumn) {
/ NEE
					DatabaseColumn myDBCol = (DatabaseColumn) myColumn;
					myDBCol.setDBFilter();
/ NIET

/c
Table.filter() line: 491	

		for (Column myCol : columns) {
			myFilterBuffer.append(myCol.getFilterExpression());
			myFilterBuffer.append("#");
		}

/c
Table.resetScreenId() line: 778	
		oldScreenId = getScreenId();
"party-type"
		getRequest().getSession().setAttribute(ATTRIBUTE_SCREEN_ID, null);


/ 7	. 

/ we zijn op de party types screen, 
/ we fill in party_id "Op",	 
/ we click Filter	,

/s
dynatable.js
function filter(){
   myAddress = getLocation();
"http://localhost:8080/tms/oms/party-type_preselect_list"

   var myDoElement = document.getElementById("do");
   myDoElement.value="filter";
   
   document.filterform.action=myAddress + '?screenId='+getScreenId();
   if (maySubmit()) {
       document.filterform.submit();
   }
   alreadySubmitted=true;

/s
PartyTypeListAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
				Map myMap = act();
/s
PartyTypeListAction(ListAction).act() line: 58	
		String myIdentifier = this.getClass().getPackage().getName() + "." + this.getClass().getName() + "_" + getRequest().getRequestURI();

		if (StringUtils.isNotEmpty(getRequest().getParameter("refresh")) && getRequest().getParameter("refresh").equals("true")) {
/ NEE

		if (!myIdentifier.equals(getSession().getAttribute(LIST_LOADED_ATTRIBUTE))) {
/ NEE

		if (getSession().getAttribute(LIST_LOADED_ATTRIBUTE) == null) {
/ NEE

/c
TableManager.getTable(String, Request) line: 74	
/=
	public Table getTable(String aTableName, Request aRequest) {
aTableName	"party-type" (id=21974)	

		if (!myStartEmpty) {
			myTable = getFromCache(mySession, aTableName);
myTable	Table  (id=22191)	
	columns	ArrayList  (id=22408)	
[Column:SYSTEMID, Column:code, Column:description]
	name	"party-type" (id=21974)	
	oldFilter	"###" (id=25347)	
	rows	ArrayList  (id=25384)	
[com.mpobjects.view.util.table.Row@62ecb934,
 com.mpobjects.view.util.table.Row@614b4a6d,
 com.mpobjects.view.util.table.Row@16036c02,
 com.mpobjects.view.util.table.Row@65b795e3,
 com.mpobjects.view.util.table.Row@237337a9,
 com.mpobjects.view.util.table.Row@77d19e40]:

		if (myTable == null) {
/ NEE
		}
		if (!myStartEmpty) {
			String myRefreshParam = aRequest.getParameter("refresh");
null
			myTable.setForceRefresh(myRefreshParam != null && TRUE.equals(myRefreshParam));
/ -> false
			myTable.setForceFilter(myRefreshParam != null && FALSE.equals(myRefreshParam));
		}

/c
Table.setFilter(Map<String,String>) line: 805	
/=
	public void setFilter(Map<String, String> aMap) {
{2=, 1=op}
		for (String myKey : aMap.keySet()) {
				Column myColumn = myCols[myIndex];
Column:description
				String myValue = aMap.get(myKey);
""
				} else {
					setFilter(myColumn, myValue, FilterCache.FILTER_TYPE_USER);

		for (String myKey : aMap.keySet()) {
				Column myColumn = myCols[myIndex];
Column:code
				String myValue = aMap.get(myKey);
"op"
				} else {
					setFilter(myColumn, myValue, FilterCache.FILTER_TYPE_USER);
/s
		aColumn.setFilter(aValue);

		// Also update the cache
		String myFilterKey = "" + getScreenId() + "." + getName() + "." + aColumn.getName();
		filterCache.setFilterValue(myFilterKey, aValue, aFilterType);
/ Doet NIETS	,
/ TODO

		// Update the DynaQuery
		if (dynaQuery != null && (aColumn instanceof DatabaseColumn || aColumn instanceof DatabaseJoinColumn)) {
/ NEE

/c
Table.mustReload() line: 715	
/ Doet NIETS	, want	,
		} else {
			for (Column myColumn : columns) {
				if (myColumn.mustReload()) {
/s
					return !theUsedFlag;
false
/ theUsedFlag=true


/c
Table.filter() line: 491	
		for (Column myCol : columns) {
			myFilterBuffer.append(myCol.getFilterExpression());
			myFilterBuffer.append("#");
		}
myFilterBuffer	StringBuffer  (id=26304)	
#op##
		if (!myFilterBuffer.toString().equals(oldFilter)) {
/ JA
			oldFilter = myFilterBuffer.toString();
#op##
			rows.clear();

			Column[] myCols = getColumns();
			row: for (Row myRow : originalRows) {
				int i = 0;
				for (RowValue element : myRow.getValues()) {
element	RowValue  (id=26338)	
	theRow	Row  (id=26313)	
		theValues	ArrayList  (id=26451)	
			elementData	Object[10]  (id=26456)	
				[0]	RowValue  (id=26338)	
					theValue	"26681476" (id=26415)	
				[1]	RowValue  (id=26459)	
					theValue	"OPDRACHTGEVER" (id=26465)	
				[2]	RowValue  (id=26460)	
					theValue	"Opdrachtgever (Bill to Party)" (id=26468)	
			size	3	

					if (!myCols[i++].filter(element)) {
/ NEE
/ Op "" metches alles	, deze rij matches ook op column 1	,  
/ JA	, bij 2de row	, want deze rij matches NIET op column 1	, 
						continue row;
					}
				}
				rows.add(myRow);
/ JA	, voor 1ste row	,
			}

			reshuffle();
/ sort	,

/ we houden maar 1 row over	, 

/ 7	. 

/ we click refresh , ook met deze filter	, op party types screen	, 
/ zonet clicked we filter	,

/s
dynatable.js
  myAddress = getLocation() + '?refresh=true';
"http://localhost:8080/tms/oms/party-type_preselect_list?refresh=true"
   document.filterform.action=myAddress;
   if (maySubmit()) {
       document.filterform.submit();

/s
PartyTypeListAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	

		String myIdentifier = this.getClass().getPackage().getName() + "." + this.getClass().getName() + "_" + getRequest().getRequestURI();

		if (StringUtils.isNotEmpty(getRequest().getParameter("refresh")) && getRequest().getParameter("refresh").equals("true")) {
/ JA
			resetListLoaded(getSession());
/ Dit was bij filter NIET	,

		if (!myIdentifier.equals(getSession().getAttribute(LIST_LOADED_ATTRIBUTE))) {
/ JA
/ Zonet geleegd	,
			resetListLoaded(getSession());

		if (getSession().getAttribute(LIST_LOADED_ATTRIBUTE) == null) {
			// only load list if refresh=false is NOT added to the url
			if (!"false".equals(getRequest().getParameter("refresh"))) {
				Collection myList = getList();
/s
					return new BeanWrapper<PartyTypeDAO>(PartyTypeDAO.class).getBean().getAll();
/////////////////////////////////////////////////////
/ REFRESH GIVES RELOAD	,
/ Inderdaad	, hier gaat opnieuw de query doen	,
//////////////////////////////////////////////////////

/ we zien	,
 429342 LOG:  execute <unnamed>: select this_.SYSTEM_ID as SYSTEM1_75_0_, this_.PARTY_TYPE as PARTY2_75_0_, this_.DESCRIPTION as DESC
 429342 RIPT3_75_0_, this_.IS_DELETED as IS4_75_0_ from PARTY_TYPE this_ where this_.IS_DELETED=$1
 429343 DETAIL:  parameters: $1 = 'f'

/ myList
[
com.mpobjects.oms.model.entity.partytype.PartyType@6526ef67[OPDRACHTGEVER,Opdrachtgever (Bill to Party)], 
com.mpobjects.oms.model.entity.partytype.PartyType@5f2f8712[SORTEERHUB,Collectie of Distributiehub (Partner locatie)], 
com.mpobjects.oms.model.entity.partytype.PartyType@294cdf90[PARTNER,Partner], 
com.mpobjects.oms.model.entity.partytype.PartyType@75e97c1e[RETOURADRES,Retour adres], 
com.mpobjects.oms.model.entity.partytype.PartyType@33d3d20c[ADRES_VASTE_COLLECT,Adres voor vaste collectie opdracht], 
com.mpobjects.oms.model.entity.partytype.PartyType@17832c69[ADRES,Adres opgeslagen uit Interface]]

				getRequest().setAttribute(DYNATABLE_LIST_ATTRIBUTE, myList);
/ Dit is voor	, 
$ vi party-type_list.xml
            Collection myList = (Collection) request.getAttribute("dynatable_list");

				getSession().setAttribute(LIST_LOADED_ATTRIBUTE, myIdentifier);
com.mpobjects.oms.control.partytype.action.com.mpobjects.oms.control.partytype.action.PartyTypeListAction_/tms/oms/party-type_preselect_list
/ TODO (Doet scs hier wat mee?) Want Table.filter uses this.originalRows	)

/c
TableManager.getTable(String, Request) line: 74	
		if (!myStartEmpty) {
			myTable = getFromCache(mySession, aTableName);
myTable	Table  (id=22191)	
	rows	ArrayList  (id=25384)	
[com.mpobjects.view.util.table.Row@62ecb934]
/ 1 row 	, van de vorige filter	,

		if (!myStartEmpty) {
			String myRefreshParam = aRequest.getParameter("refresh");
true
			myTable.setForceRefresh(myRefreshParam != null && TRUE.equals(myRefreshParam));
/s
		forceRefreshFlag = aFlag;
/t
			myTable.setForceFilter(myRefreshParam != null && FALSE.equals(myRefreshParam));
/s
		forceFilterFlag = aFlag;
/t

/c
Table.setFilter(Map<String,String>) line: 805	
/=
	public void setFilter(Map<String, String> aMap) {
{2=, 1=op}

/ set filters op de columns	, 

/c
Table.mustReload() line: 704	
		if (forceRefreshFlag) {
			myResult = true;

		if (myResult) {
			// The table will be reloaded from the DB, therefore set the DBFilter
			// in all columns
			for (Column myColumn : columns) {
				if (myColumn instanceof DatabaseColumn) {
/ NEE
					DatabaseColumn myDBCol = (DatabaseColumn) myColumn;
					myDBCol.setDBFilter();
/ NIET
/ in .setFilter	hadden we fiters op de columns set	, wat gebeurt hier	?
/ TODO

/c
Table.filter() line: 507	
		for (Column myCol : columns) {
			myFilterBuffer.append(myCol.getFilterExpression());
			myFilterBuffer.append("#");
		}
#op##

			Column[] myCols = getColumns();
			row: for (Row myRow : originalRows) {
/ Dit zijn de rows de 1ste keer 	, WH als je config, planning, parties geeft,	 
/ TODO
/ Wat als er een party type bijkomt	?
/ TODO
				int i = 0;
				for (RowValue element : myRow.getValues()) {
					if (!myCols[i++].filter(element)) {

/ PAUL

ListAction.class
	public Map act() throws Exception {

		if (getSession().getAttribute(LIST_LOADED_ATTRIBUTE) == null) {
			if (!"false".equals(getRequest().getParameter("refresh"))) {
				Collection myList = getList();
				getRequest().setAttribute(DYNATABLE_LIST_ATTRIBUTE, myList);
/ Voor in party_list.xml
				getSession().setAttribute(LIST_LOADED_ATTRIBUTE, myIdentifier);
/ TODO

$ vi party_list.xml

    Collection myList =  (Collection) request.getAttribute("dynatable_list");
            for (Iterator myIt = myList.iterator();myIt.hasNext();){
	                myTable.addRow(myRow);
/ Zo komen de rows in Table.originalRows	,



/ Einde PAUL


/ 7	. 

/ we click een edit button  op een party type	,   in de party type 

$ vi party-type_preselect_list.xsl

   <xsl:template name="custom_header">
       <script type="text/javascript">
            function showParties(aSystemId){
              document.location.href="party_list?party_type_systemid=" + aSystemId + "&amp;refresh=true";
            }
        </script>
    </xsl:template>



$ vi oms-sitemap.xmap
			<map:action logger="party" name="partyList" src="com.mpobjects.oms.control.party.action.PartyListAction"/>

			<map:match pattern="party_list">
				<map:act type="partyList"/>
				<map:call resource="dynatablePage">
					<map:parameter name="xsp" value="xsp/party_list.xml"/>
				</map:call>
			</map:match>

/s
PartyListAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	
				Map myMap = act();
/s
PartyListAction(ListAction).act() line: 58	
		String myIdentifier = this.getClass().getPackage().getName() + "." + this.getClass().getName() + "_" + getRequest().getRequestURI();
com.mpobjects.oms.control.party.action.com.mpobjects.oms.control.party.action.PartyListAction_/tms/oms/party_list

		if (StringUtils.isNotEmpty(getRequest().getParameter("refresh")) && getRequest().getParameter("refresh").equals("true")) {
/ JA
			resetListLoaded(getSession());
		}
		if (!myIdentifier.equals(getSession().getAttribute(LIST_LOADED_ATTRIBUTE))) {
/ JA	, 
/ !=null
/ TODO (We hadden hierboven deze attr in session set)	, 
			resetListLoaded(getSession());
		}

			if (!"false".equals(getRequest().getParameter("refresh"))) {
/ JA
/ true!=false
				Collection myList = getList();
/s
PartyListAction.getList() line: 30	
		Util.refreshList(getRequest(), getSession());
/s
Util.refreshList(Request, Session) line: 32	
		String refresh = aRequest.getParameter("refresh");
		if (refresh != null && StringUtils.isTrue(refresh)) {
			new FilterManager().getFilterCache(aSession).flushScreen(PARTY_SCREENID);
/s
FilterCache.flushScreen(String) line: 58	
/=
	public void flushScreen(String aScreenId) {
/ aScreenId="party"
		myKeys.addAll(theFilterMap.keySet());

/ Intermezzo

this	FilterCache  (id=22034)	
	theFilterMap	HashMap  (id=22147)	

{open-crossdock-dashboard-serviceaction-list.dashboard-serviceaction-list.req_start_after.appl_filter=>06-Sep-2015,
 planned-crossdock-dashboard-serviceaction-list.dashboard-serviceaction-list.req_start_after.appl_filter=>06-Sep-2015,
 service_action_template.service_action_template.service_action_type.user_filter=,
 parcel-track-and-trace.parcel-track-and-trace.system_entry_date.appl_filter=>15-Sep-2015,
 shipment-order.shipment-order.system_entry_date.appl_filter=>08-Sep-2015,
 service_action_template.service_action_template.to_city.user_filter=,
 service_action_template.service_action_template.name.user_filter=collect,
 shipment-order-booking-search.shipment-order-booking-search.system_entry_date.appl_filter=>15-Sep-2015,
 shipment-order-list-track.shipment-order-booking-search.system_entry_date.appl_filter=>15-Sep-2015,
 shipment-order-booking-search.shipment-item-list-track.system_entry_date.appl_filter=>15-Sep-2015,
 service_action_template.service_action_template.organization.user_filter=,
 service-order.service-order.status.appl_filter=<9000,
 shipment-item-list-track.shipment-order-booking-search.system_entry_date.appl_filter=>15-Sep-2015,
 file.file.uploaded_date.appl_filter=>29-Sep-2015 09:08,
 shipment-item-list-track.parcel-track-and-trace.system_entry_date.appl_filter=>15-Sep-2015,
 service-order.service-order.planned_start_after.appl_filter=>08-Sep-2015,
 service_action_template.service_action_template.to_country.user_filter=,
 service_action_template.service_action_template.from_country.user_filter=,
 service_action_template.service_action_template.from_city.user_filter=}

/ Einde Intermezzo

/ myKeys=
[open-crossdock-dashboard-serviceaction-list.dashboard-serviceaction-list.req_start_after.appl_filter,
 planned-crossdock-dashboard-serviceaction-list.dashboard-serviceaction-list.req_start_after.appl_filter,
 service_action_template.service_action_template.service_action_type.user_filter,
 parcel-track-and-trace.parcel-track-and-trace.system_entry_date.appl_filter,
 shipment-order.shipment-order.system_entry_date.appl_filter,
 service_action_template.service_action_template.to_city.user_filter,
 service_action_template.service_action_template.name.user_filter,
 shipment-order-booking-search.shipment-order-booking-search.system_entry_date.appl_filter,
 shipment-order-list-track.shipment-order-booking-search.system_entry_date.appl_filter,
 shipment-order-booking-search.shipment-item-list-track.system_entry_date.appl_filter,
 service_action_template.service_action_template.organization.user_filter,
 service-order.service-order.status.appl_filter,
 shipment-item-list-track.shipment-order-booking-search.system_entry_date.appl_filter,
 file.file.uploaded_date.appl_filter,
 shipment-item-list-track.parcel-track-and-trace.system_entry_date.appl_filter,
 service-order.service-order.planned_start_after.appl_filter,
 service_action_template.service_action_template.to_country.user_filter,
 service_action_template.service_action_template.from_country.user_filter,
 service_action_template.service_action_template.from_city.user_filter]

		for (String myKey : myKeys) {
			if (myKey.startsWith(aScreenId)) {
/ NEE

				theFilterMap.remove(myKey);
/t

			new TableManager().flushTableCache(aRequest, PARTY_SCREENID);
/s
				mySession.removeAttribute(aTableName + TABLE_SUFFIX);
/ aTableName="party"

/t
PartyListAction.getList() line: 33	
		Util.refreshList(getRequest(), getSession());
/d
		String myPartyType = (String) getRequest().getAttribute("partyType");
null
		String myPartyTypeSystemid = getRequest().getParameter(PARTY_TYPE_SYSTEM_ID);
	private final String PARTY_TYPE_SYSTEM_ID = "party_type_systemid";
26681478
/ Klopt	, de uri staat in js	, dat zagen we aan het begin in .xsl	,

			} else { // override session attribute with request parameter
				getSession().setAttribute(PARTY_TYPE_SYSTEM_ID, myPartyTypeSystemid);

			return MpoBeanFactory.getBean(PartyDAO.class).getPartyListByTypeSystemid(Integer.parseInt(myPartyTypeSystemid));
/ 26681478 is een system_id van een party_type	,

/ Dus GEEN DynaQuery.toSQL	,

/ we zien dat de query wordt gedaan 	, niet ogv refresh=true	, maar ogv party_type_systemid=... attribute	,
/ TODO

/ we zien	,
select ... 
from PARTY this_ 
left outer join ORGANIZATION organizati2_ on this_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID 
left outer join ORGANIZATION organizati3_ on organizati2_.ORGANIZATION_GROUP=organizati3_.SYSTEM_ID 
where this_.organization_Systemid in (select uo.organization_systemid from user_organization uo where uo.user_systemid = $1) 
and this_.PARTY_TYPE_SYSTEMID=$2
DETAIL:  parameters: $1 = '26682479', $2 = '26681478'
LOG:  execute S_1: COMMIT

/t
PartyListAction(ListAction).act() line: 72	
				Collection myList = getList();
/d
[
][SystemId: 26681553; Party: ZWA; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@568e676e[SORTEERHUB,Collectie of Distributiehub (Partner locatie)]], 
][SystemId: 26681529; Party: TBA; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@568e676e[SORTEERHUB,Collectie of Distributiehub (Partner locatie)]], 
][SystemId: 26681525; Party: EHV; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@568e676e[SORTEERHUB,Collectie of Distributiehub (Partner locatie)]], 
][SystemId: 26681543; Party: INT; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@568e676e[SORTEERHUB,Collectie of Distributiehub (Partner locatie)]], 
][SystemId: 26681533; Party: DOR; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@568e676e[SORTEERHUB,Collectie of Distributiehub (Partner locatie)]], 
][SystemId: 26681539; Party: HOA; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@568e676e[SORTEERHUB,Collectie of Distributiehub (Partner locatie)]], 
][SystemId: 26681537; Party: ASA; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@568e676e[SORTEERHUB,Collectie of Distributiehub (Partner locatie)]], 
][SystemId: 26824703; Party: 160213; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@568e676e[SORTEERHUB,Collectie of Distributiehub (Partner locatie)]], 
][SystemId: 26826681; Party: TEST; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@568e676e[SORTEERHUB,Collectie of Distributiehub (Partner locatie)]], 
][SystemId: 26820114; Party: BOS1; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@568e676e[SORTEERHUB,Collectie of Distributiehub (Partner locatie)]], 
][SystemId: 26842295; Party: TBAPR; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@568e676e[SORTEERHUB,Collectie of Distributiehub (Partner locatie)]], 
][SystemId: 26842325; Party: TBAPC; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@568e676e[SORTEERHUB,Collectie of Distributiehub (Partner locatie)]]]
				getRequest().setAttribute(DYNATABLE_LIST_ATTRIBUTE, myList);
				getSession().setAttribute(LIST_LOADED_ATTRIBUTE, myIdentifier);

/c
TableManager.getTable(String, Request) line: 74	
/=
	public Table getTable(String aTableName, Request aRequest) {
aTableName	"party" (id=23593)	

			myTable = getFromCache(mySession, aTableName);
		if (myTable == null) {
/ JA
			myTable = new Table(aTableName, new FilterManager().getFilterCache(mySession), aRequest);
myTable.rows=[]
			myTable.startEmpty(myStartEmpty);
			storeInCache(mySession, myTable, aTableName);
/s
				aSession.setAttribute(aTableName + TABLE_SUFFIX, aTable);
				aSession.setAttribute(LAST_USED_TABLE, aTableName);
/t
TableManager.getTable(String, Request) line: 89	
			storeInCache(mySession, myTable, aTableName);
/d
		}
		if (!myStartEmpty) {
			String myRefreshParam = aRequest.getParameter("refresh");
			myTable.setForceRefresh(myRefreshParam != null && TRUE.equals(myRefreshParam));
/s
				forceRefreshFlag = aFlag;
/t
			myTable.setForceFilter(myRefreshParam != null && FALSE.equals(myRefreshParam));

/c
Table.addHiddenColumn(String) line: 312	
aName	"SYSTEMID" (id=19699)	

/c
Table.addColumn(String) line: 208	
aName	"party_type" (id=21368)	

/c
Table.addDatabaseJoinColumn(String, String, int) line: 280	
/=
	public void addDatabaseJoinColumn(String aName, String aDBColumn, int aPosition) {
aName	"organization" (id=21371)	
aDBColumn	"organization_id" (id=21372)	
aPosition	1	

/c
Table.addDatabaseColumn(String) line: 233	
aName	"party_id" (id=21413)	

...


/c
Table.mustReload() line: 679	
		if (forceRefreshFlag) {
/ JA
			myResult = true;

		if (myResult) {
			// The table will be reloaded from the DB, therefore set the DBFilter
			// in all columns
			for (Column myColumn : columns) {
				if (myColumn instanceof DatabaseColumn) {
organization
party_id
					DatabaseColumn myDBCol = (DatabaseColumn) myColumn;
					myDBCol.setDBFilter();
/s
								theReloadFlag = true;
/ want elke column heeft geen theFilter	,
/ TODO


/ we zijn nu NIET langs .setFilter gekomen	, 
/ vergl met PartyTypeList	, daar in setFilter de 2 columns set	, en hier GEEN	,
/ TODO

/c
party_list_xml.generate() line: 545	
...
              			new RowValue(myMask.getReference4()),
	                    new RowValue(myMask.getReference5()),
	                    new RowValue(myMask.getTimeZoneId())
	                };
	                myTable.addRow(myRow);
/s
Table.addRow(RowValue[]) line: 460	
		addRow(new Row(aList));
/s
Table.addRow(Row) line: 440	
		if (originalRows.size() == 0) {
			setColumnTypes(aRow);
/s
Table.setColumnTypes(Row) line: 1034	
		int i = 0;
		for (RowValue myRowValue : aRow.getValues()) {
			Comparable<?> myValue = myRowValue.getValue();
myValue	"26681513" (id=27838)	
myValue	"Opdrachtgever" (id=27819)	
			if (myValue != null && !columns.get(i).isHidden()) {
/ NEE
/ Voor strings	,
				if (myValue instanceof Integer || myValue instanceof BigInteger) {
					columns.get(i).setType(Column.TYPE_INTEGER);
				} else if (myValue instanceof Number) {
					columns.get(i).setType(Column.TYPE_NUMBER);
				}
			}
			i++;
		}

		}
		originalRows.add(aRow);
		rows.add(aRow);
		if (rowMap != null) {
			Comparable<?> value = aRow.getValues().get(systemIdColumnIndex).getValue();
			rowMap.put(value, aRow);
		}

/ c
Table.filter() line: 491	
		for (Column myCol : columns) {
			myFilterBuffer.append(myCol.getFilterExpression());
			myFilterBuffer.append("#");
		}
######################

			rows.clear();
			Column[] myCols = getColumns();
			row: for (Row myRow : originalRows) {
				int i = 0;
				for (RowValue element : myRow.getValues()) {
					if (!myCols[i++].filter(element)) {
						continue row;
					}
				}
				rows.add(myRow);
/ OK
/ Komen er allemaal weer bij	,


/ 7	. 

/ We zijn op de party screen , we click op de filter button 
/ we geven in Name "TNT" bijv	, 
/s
dynatable.js
  myAddress = getLocation() + '?refresh=true';
"http://localhost:8080/tms/oms/party_list"

/s
PartyListAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
				Map myMap = act();
/s
PartyListAction(ListAction).act() line: 58	
		String myIdentifier = this.getClass().getPackage().getName() + "." + this.getClass().getName() + "_" + getRequest().getRequestURI();
com.mpobjects.oms.control.party.action.com.mpobjects.oms.control.party.action.PartyListAction_/tms/oms/party_list

		if (StringUtils.isNotEmpty(getRequest().getParameter("refresh")) && getRequest().getParameter("refresh").equals("true")) {
/ NEE

		if (!myIdentifier.equals(getSession().getAttribute(LIST_LOADED_ATTRIBUTE))) {
			resetListLoaded(getSession());
		}

		if (getSession().getAttribute(LIST_LOADED_ATTRIBUTE) == null) {
			// only load list if refresh=false is NOT added to the url
			if (!"false".equals(getRequest().getParameter("refresh"))) {
/ JA
/ "false"!=null
/ PAUL
/ Is dit de bedoeling	? 
/ Einde PAUL
				Collection myList = getList();
/s
PartyListAction.getList() line: 44	
		String myPartyType = (String) getRequest().getAttribute("partyType");
null
		String myPartyTypeSystemid = getRequest().getParameter(PARTY_TYPE_SYSTEM_ID);
null
		if (myPartyType != null) { // Not used yet type-TYPENAME_party_selection_list
 /NEE
		} else {
			if (myPartyTypeSystemid == null) {
				myPartyTypeSystemid = (String) getSession().getAttribute(PARTY_TYPE_SYSTEM_ID);
26681476
			} else { // override session attribute with request parameter
		
			return MpoBeanFactory.getBean(PartyDAO.class).getPartyListByTypeSystemid(Integer.parseInt(myPartyTypeSystemid));
select ...
from PARTY this_ 
left outer join ORGANIZATION organizati2_ on this_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID 
left outer join ORGANIZATION organizati3_ on organizati2_.ORGANIZATION_GROUP=organizati3_.SYSTEM_ID 
where this_.organization_Systemid in (select uo.organization_systemid from user_organization uo where uo.user_systemid = $1) 
and this_.PARTY_TYPE_SYSTEMID=$2
DETAIL:  parameters: $1 = '26682479', $2 = '26681476'

/t
				getRequest().setAttribute(DYNATABLE_LIST_ATTRIBUTE, myList);
				getSession().setAttribute(LIST_LOADED_ATTRIBUTE, myIdentifier);

/c
TableManager.getTable(String, Request) line: 82	
			myTable = getFromCache(mySession, aTableName);
myTable
	originalRows	ArrayList  (id=27652)	
[com.mpobjects.view.util.table.Row@21cddf95, com.mpob... ]

		if (!myStartEmpty) {
			String myRefreshParam = aRequest.getParameter("refresh");
null
			myTable.setForceRefresh(myRefreshParam != null && TRUE.equals(myRefreshParam));
/ -> false
			myTable.setForceFilter(myRefreshParam != null && FALSE.equals(myRefreshParam));

/c
Table.setFilter(Map<String,String>) line: 805	

		Column[] myCols = getColumns();
myCols	Column[22]  (id=30084)	
	[0]	CacheColumn  (id=29898)	
	[1]	CacheColumn  (id=29899)	
	[2]	DatabaseJoinColumn  (id=29900)	
	[3]	DatabaseColumn  (id=29902)	
	[4]	DatabaseColumn  (id=29848)	
	[5]	DatabaseColumn  (id=29903)	
	[6]	DatabaseColumn  (id=29904)	
	[7]	DatabaseColumn  (id=29905)	
	[8]	DatabaseColumn  (id=29906)	
	[9]	DatabaseColumn  (id=29907)	
	[10]	DatabaseColumn  (id=29908)	
	[11]	DatabaseJoinColumn  (id=29909)	
	[12]	DatabaseColumn  (id=29910)	
	[13]	DatabaseColumn  (id=28620)	
	[14]	CacheColumn  (id=29911)	
	[15]	CacheColumn  (id=29912)	
	[16]	CacheColumn  (id=29913)	
	[17]	CacheColumn  (id=29914)	
	[18]	CacheColumn  (id=29915)	
	[19]	CacheColumn  (id=29916)	
	[20]	CacheColumn  (id=29917)	
	[21]	CacheColumn  (id=29918)	

		for (String myKey : aMap.keySet()) {
			if (!"".equals(myKey)) {
				int myIndex = Integer.parseInt(myKey);
				Column myColumn = myCols[myIndex];
				String myValue = aMap.get(myKey);

				} else {
					setFilter(myColumn, myValue, FilterCache.FILTER_TYPE_USER);
myColumn	DatabaseColumn  (id=21486)	
myValue	"TNT" (id=21742)	
/s
Table.setFilter(Column, String, String) line: 1057	
		aColumn.setFilter(aValue);
/s
DatabaseColumn.setFilter(String) line: 106	
		} else {
			if (fitsInOldFilter(aFilter)) {
				// Narrowing down current results, we don't need to go to the DB again
				theReloadFlag = !theUsedFlag;
false
				if (!theReloadFlag) {
/ JA
->					theFilter = new CacheFilter(aFilter, this);

/c
Table.reloadFilters() line: 756	
		if (!StringUtils.equals(oldScreenId, getScreenId())) {
/ JA
oldScreenId=""
getScreenId()="party"

			for (Column myColumn : columns) {
				String[] myFilter = filterCache.getFilterValue(getScreenId() + "." + getName() + "." + myColumn.getName());
/ NEE
				} else {
					myColumn.setFilter("");
/ Hier wordt de filter op Column:name weer op "" set	,
/ CAUSE PCT-737


/c
Table.mustReload() line: 693	
		if (forceRefreshFlag) {
/ NEE
			myResult = true;
		} else if (forceFilterFlag) {
/ NEE
		} else {
			for (Column myColumn : columns) {
				if (myColumn.mustReload()) {
/ NEE
		return myResult;
false


/c
Table.filter() line: 491	
		for (Column myCol : columns) {
			myFilterBuffer.append(myCol.getFilterExpression());
			myFilterBuffer.append("#");
		}
####TNT##################

			rows.clear();

			Column[] myCols = getColumns();
			row: for (Row myRow : originalRows) {
				int i = 0;
				for (RowValue element : myRow.getValues()) {
					if (!myCols[i++].filter(element)) {
						continue row;
					}
				}
				rows.add(myRow);
			}
			reshuffle();

/ 7	.

/ Als we op de refresh button click	op de party screen, met de Name "TNT"	,

/s
dynatable.js
   myAddress = getLocation() + '?refresh=true';
"http://localhost:8080/tms/oms/party_list?refresh=true"
/s
PartyListAction(ListAction).act() line: 71	
		String myIdentifier = this.getClass().getPackage().getName() + "." + this.getClass().getName() + "_" + getRequest().getRequestURI();
com.mpobjects.oms.control.party.action.com.mpobjects.oms.control.party.action.PartyListAction_/tms/oms/party_list

		if (StringUtils.isNotEmpty(getRequest().getParameter("refresh")) && getRequest().getParameter("refresh").equals("true")) {
/ JA
			resetListLoaded(getSession());
		}

		if (!myIdentifier.equals(getSession().getAttribute(LIST_LOADED_ATTRIBUTE))) {
/ JA
			resetListLoaded(getSession());
		}
		if (getSession().getAttribute(LIST_LOADED_ATTRIBUTE) == null) {
			if (!"false".equals(getRequest().getParameter("refresh"))) {
				Collection myList = getList();
/s
PartyListAction.getList() line: 32	
		Util.refreshList(getRequest(), getSession());
/s
Util.refreshList(Request, Session) line: 35	
			new TableManager().flushTableCache(aRequest, PARTY_SCREENID);
/s
TableManager.flushTableCache(Request, String) line: 52	
		Session mySession = aRequest.getSession();
		mySession.removeAttribute(aTableName + TABLE_SUFFIX);
/t
PartyListAction.getList() line: 34	
		String myPartyType = (String) getRequest().getAttribute("partyType");
/d
null
		String myPartyTypeSystemid = getRequest().getParameter(PARTY_TYPE_SYSTEM_ID);
null
		} else {
			if (myPartyTypeSystemid == null) {
				myPartyTypeSystemid = (String) getSession().getAttribute(PARTY_TYPE_SYSTEM_ID);
PARTY_TYPE_SYSTEM_ID=party_type_systemid
26681476
			return MpoBeanFactory.getBean(PartyDAO.class).getPartyListByTypeSystemid(Integer.parseInt(myPartyTypeSystemid));

/ we zien	, 
select ...
from PARTY this_ 
left outer join ORGANIZATION organizati2_ on this_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID 
left outer join ORGANIZATION organizati3_ on organizati2_.ORGANIZATION_GROUP=organizati3_.SYSTEM_ID 
where this_.organization_Systemid in (select uo.organization_systemid from user_organization uo where uo.user_systemid = $1) 
and this_.PARTY_TYPE_SYSTEMID=$2
DETAIL:  parameters: $1 = '26682479', $2 = '26681476'

/t
				Collection myList = getList();
/d
				getRequest().setAttribute(DYNATABLE_LIST_ATTRIBUTE, myList);
/ voor party_list.xml
				getSession().setAttribute(LIST_LOADED_ATTRIBUTE, myIdentifier);
/ TODO (used?)

/c
TableManager.getTable(String, Request) line: 74	
aTableName="party"
		if (!myStartEmpty) {
			myTable = getFromCache(mySession, aTableName);
null
/ TODO (VREEMD)
		if (myTable == null) {
/ JA
			myTable = new Table(aTableName, new FilterManager().getFilterCache(mySession), aRequest);

			myTable.startEmpty(myStartEmpty);
			storeInCache(mySession, myTable, aTableName);
/s
				aSession.setAttribute(aTableName + TABLE_SUFFIX, aTable);
				aSession.setAttribute(LAST_USED_TABLE, aTableName);

/t
		if (!myStartEmpty) {
			String myRefreshParam = aRequest.getParameter("refresh");
true
			myTable.setForceRefresh(myRefreshParam != null && TRUE.equals(myRefreshParam));
			myTable.setForceFilter(myRefreshParam != null && FALSE.equals(myRefreshParam));

/c
	public void setFilter(Map<String, String> aMap) {
{13=, 11=, 12=, 3=, 2=, 10=, 1=, 7=, 6=, 5=, 4=TNT, 9=, 8=}
				} else {
					setFilter(myColumn, myValue, FilterCache.FILTER_TYPE_USER);
/s
	private void setFilter(Column aColumn, String aValue, String aFilterType) {
aColumn	DatabaseColumn  (id=29848)	
Column:name
aValue	"TNT" (id=29849)	

		// Update the DynaQuery
		if (dynaQuery != null && (aColumn instanceof DatabaseColumn || aColumn instanceof DatabaseJoinColumn)) {
/ NEE
			Filter myFilter = aColumn.getFilter();
			if (myFilter != null) {
				dynaQuery.add(aColumn.getFilter());
/ NIET
			}

/t
Table.setFilter(Map<String,String>) line: 812	
		for (String myKey : aMap.keySet()) {
/ volgende	, 

/c
Table.mustReload() line: 679	

		if (forceRefreshFlag) {
			myResult = true;

		if (myResult) {
			// The table will be reloaded from the DB, therefore set the DBFilter
			// in all columns
			for (Column myColumn : columns) {
				if (myColumn instanceof DatabaseColumn) {
/ JA, sommige wel	,
/ NEE, sommige niet	,
					DatabaseColumn myDBCol = (DatabaseColumn) myColumn;
					myDBCol.setDBFilter();

/c
Table.addRow(Row) line: 440	
/ De originalRows en rows zijn []
/ Nu allemaal erbij	,
/ WH vanuit party_list.xml

/c
Table.filter() line: 491	
		for (Column myCol : columns) {
			myFilterBuffer.append(myCol.getFilterExpression());
myCol	CacheColumn  (id=29898)	

			myFilterBuffer.append("#");
		}
######################
/ Het filter is weg	,

/ 7	. 

/ we click refresh op party screen, op name filter TNT

PartyListAction(ListAction).act() line: 71	
				Collection myList = getList();
/s
PartyListAction.getList() line: 32	
		Util.refreshList(getRequest(), getSession());
/s
Util.refreshList(Request, Session) line: 35	
			new TableManager().flushTableCache(aRequest, PARTY_SCREENID);
/s
TableManager.flushTableCache(Request, String) line: 53	
		mySession.removeAttribute(aTableName + TABLE_SUFFIX);

/c
TableManager.getTable(String, Request) line: 75	
			myTable = getFromCache(mySession, aTableName);
myTable=null

/ CAUSE PCT-737


























/ Intermezzo

/ Bij deze gaat refresh met filters wel OK	,

$ vi FinancialPartyListAction.java
public class FinancialPartyListAction extends ListAction {
	@Override
	public Collection getList() throws Exception {
		return MpoBeanFactory.getBean(FinancialPartyDAOInterface.class).getAll();
	}

$ vi InvoiceDetailListAction.java
public class InvoiceDetailListAction extends ListAction {

	/**
	 * 
	 * overrides method @see com.mpobjects.control.action.ListAction#getList()
	 * 
	 * @return
	 * @throws Exception
	 */
	@Override
	public Collection getList() throws Exception {
		return MpoBeanFactory.getBean(InvoiceDetailDAO.class).getAll();
	}




$ vi PartyListAction.java

public class PartyListAction extends ListAction {


/ Einde Intermezzo































/ Einde DEBUG PCT-737

/ PCT-737 WICKET

/ 7	. 

/ we kijken eerst nog naar	PCT-749

Execution, Customer shipment order search
CustomerOrderSearchPage

/ 7	. 

/ we gaan in Java EE view naar
com.mpobjects.oms.view.wicket.party
/ en click New class
public class PartyListPage extends BaseContextPage {

/ BaseContextPage is in 
com.mpobjects.oms.view.wicket

$ vi oms-menu.xml
	<m:add path="configuration.planning.partyList" privilege="party.list" actionUrl="wicket?module=oms&amp;wicketpage=partytype.PartyListPage" index="1050" />

/ 7	. 

/ Kijk naar wehkamp's 
package com.mpobjects.rfsdms.asnportal.view.wicket;
public abstract class PartyListPage extends AbstractMainPage {

/ we zien deze op RFSDMS (T5/Internal) 
https://test-scs.mp-objects.com/rfsdms/core/index_frameset
/ Kies	,
Portal, Scan ASN

/ we kunnen ook	, 
BatchCreatePage

/ we kunnen ook	,
BillOfMaterialsEditPage	,
configuration, master data, products
/ edit een product	, 
/ Kies onderin : Add bill of materials	,

/ 7	. 

/ we hebben minimale	,

$ vi PartyListPage.java
package com.mpobjects.oms.view.wicket.party;
@Privilege(object = "party", type = "list")
public class PartyListPage extends BaseContextPage {
}

$ vi PartyListPage.html
<wicket:extend>
</wicket:extend>

$ vi oms-menu.xml
	<m:add path="configuration.planning.partyList" privilege="party.list" actionUrl="wicket?module=oms&amp;wicketpage=party.PartyListPage" index="1050" />


/ 7	. 

/ study parent pages	,


public class BatchCreatePage extends AbstractMainPage {

public abstract class AbstractMainPage extends AbstractPage {
	protected FeedbackPanel feedbackPanel;
	protected Label pageTitle;

public abstract class AbstractPage extends BasePage {
	protected Label pageTitleHead;
	protected IModel<String> pageTitleModel;
	protected abstract void createPageComponents();

public class BasePage extends WebPage implements Serializable {

$ vi AbstractMainPage.html

	<wicket:extend>
		<div id="pageHeader">
			<div class="pageTitle" wicket:enclosure="pageTitle">
				<h1>
					<span wicket:id="pageTitle"></span>
				</h1>
			</div>
		</div>

		<div id="pageContent">
			<div wicket:id="feedback"></div>
			<wicket:child />
		</div>

	</wicket:extend>

$ vi AbstractPage.html

<head>
<wicket:head>
	<title wicket:id="pageTitleHead"></title>
</wicket:head>
</head>
<body>
	<wicket:extend>
		<wicket:child />
	</wicket:extend>
</body>

$ vi BasePage.html

<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html>

/ TODO (Al die extends met wicket:head)	, 

$ vi BatchCreatePage.html


/ 7	. 

/ we maken voorlopig	, 

$ vi PartyListPage.html

<wicket:extend>
		<div wicket:id="query"></div>
</wicket:extend>

$ vi PartyListPage.java

@Privilege(object = "party", type = "list")
public class PartyListPage extends AbstractMainPage {

	@Override
	protected void createPageComponents() {
		QueryDefinition myQuery = new QueryDefinition("coshipmentportal-party");
		myQuery.setFromClause("from PartyVO as p");
		myQuery.setWhereClause("p.deleted = 0");

		RegexModelStringFormatter<String> formatter = new RegexModelStringFormatter<String>("^(\\{[^}]*\\})?(.*)$", "$2");

		myQuery.getColumns().add(new IdQueryColumn("systemId", "p.systemId"));
		myQuery.getColumns().add(new QueryColumn<String>("party.partytype.code", "p.partyType.code"));
		myQuery.getColumns().add(new QueryColumn<String>("party.partyid", "p.partyId", formatter));
		myQuery.getColumns().add(new QueryColumn<String>("party.name", "p.name"));
		myQuery.getColumns().add(new QueryColumn<String>("party.country.code", "p.country.code"));
		myQuery.getColumns().add(new QueryColumn<String>("party.contactName", "p.contactName"));


	}

$ vi language_en_GB_pnllogistics.properties
party.partytype.code=Foo Bar
party.partyid=Foo Bar
party.name=Foo Bar
party.name2=Foo Bar
party.address=Foo Bar
party.address2=Foo Bar
party.postalcode=Foo Bar
party.city=Foo Bar
party.regionstate=Foo Bar
party.country.code=Foo Bar
party.contactname=Foo Bar
...

/ we schrijven 
	p.country.code
	p.contactName

/ we kunnen NIET	, terwijl de method getCountryCode() er wel is	,
	p.countryCode

/ Dat komt omdat in Party.standard.hbm.xml 

		<property column="CONTACT_NAME" name="contactName" />
		<many-to-one name="country" column="COUNTRY_SYSTEMID" class="com.mpobjects.oms.model.entity.country.Country" />

/ 7	. 

/ Kijk naar	, 
public class ShipmentOrderListPage extends AbstractMainPage {

/ menu?

/ 7	. 

/ Kijk naar 	,
planning, shipmentorder, massupdate	,

public class ShipmentOrderMassUpdatePage extends AbstractMainPage {
			protected void createRow(List<Object> aRow, QueryColumn myColumn, ListItem<Object> aCell) {
				if (myColumn.getProperty().equals("shipmentOrderId")) {
					String returnUrl = getRequestCycle().urlFor(ShipmentOrderMassUpdatePage.this).toString();
					returnUrl = RequestUtils.toAbsolutePath(returnUrl);
					Integer myId = (Integer) aRow.get(0);
					String shimentOrderLink = "../oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=" + Integer.toString(myId.intValue()) + "&returnUrl=	" + returnUrl;

/ we maken	,

$ vi PartyListPage.java

		myRowActions.add(new RowAction() {

			@Override
			public boolean execute(Object aObject) {

				String returnUrl = getRequestCycle().urlFor(PartyListPage.this).toString();
				returnUrl = RequestUtils.toAbsolutePath(returnUrl);
				getRequestCycle().setRequestTarget(
						new RedirectRequestTarget("../oms/party_edit?" + "base_sessionLevelOffset=1" + "&systemid=" + aObject + "&systemId=" + aObject + "&returnUrl=" + returnUrl));
				return false;

/ we hebben deze url copy van het oude party list scherm , en de returnUrl erachter gezet	,

/ Als we click op de edit-button	, gaan we party_edit doen, dus komen we eerst in PartyFormAction.act	, daar wordt de returnUrl opgepakt, die we hier hebben add aan de url	, en vervolgens vindt de party_edit.jsp hem dan	, 


/en	, 
$ vi oms-sitemap.xmap

			<map:action logger="party" name="partyForm" src="com.mpobjects.oms.control.party.action.PartyFormAction"/>

			<map:match type="regexp" pattern="^party_(edit|create)$">
				<map:act type="partyForm"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/party_edit.jsp"/>
			</map:match>

$ vi PartyFormAction.java
	public Map act() throws java.lang.Exception {
		String returnUrl = getRequestParameter("returnUrl");
		getSession().setAttribute("returnUrl", returnUrl);

$ vi ButtonTag.java

		String returnUrl = (String) getSession().getAttribute("returnUrl");

		} else if (TYPE_CANCEL.equals(getType()) && returnUrl != null) {
			myPrint.append("<input type=\"button\" ");
			myPrint.append(" id=\"cancelBtn\"");
			myPrint.append(" value=\"" + (!readOnly ? getLabel("cancel") : getLabel("back")) + "\"");
			myPrint.append(" onclick=\" " + getForm().getJsFormManager() + ".cancelAndRedirect('" + getCancelMessage() + "', '" + getUrl() + "');\"");

/ Dubbel, returnUrl==getUrl()
/ TODO

/ getUrl() is de url param in 

$ vi  party_edit.jsp
					<mpo:button type="cancel" url="${returnUrl}"/>

/ 7	. 

/ de redirect van Cancel gebeurt in js	,

$ vi ButtonTag.java

		} else if (TYPE_CANCEL.equals(getType()) && returnUrl != null) {
			myPrint.append("<input type=\"button\" ");
			myPrint.append(" id=\"cancelBtn\"");
			myPrint.append(" value=\"" + (!readOnly ? getLabel("cancel") : getLabel("back")) + "\"");
			myPrint.append(" onclick=\" " + getForm().getJsFormManager() + ".cancelAndRedirect('" + getCancelMessage() + "', '" + getUrl() + "');\"");

/ Daarom zien we in HTML	,
<input type="button" id="cancelBtn" value="Cancel" onclick=" theEditFormFormManager.cancelAndRedirect('Loose changes made after last save', 'https://test-pnl.mp-objects.com/pnllogistics/wicket/?wicket:interface=:4::::');">

$ vi class.formmanager.js
    this.cancelAndRedirect = function(aMessage, anUrl) {
        if (confirm(aMessage)) {
        	this.performRedirect(anUrl);
        }
    }
    this.setRedirectUrl = function(anUrl) {
        document.getElementById("redirectTo").value=anUrl;
    }

/ Intermezzo

/ 7	. 

/ save 


$ vi party_edit.jsp

<mpo:button type="save" />

$ vi ButtonTag.java

			} else if (!getType().equals(TYPE_BACK)) {
				myPrint.append("<input type=\"button\"");
				myPrint.append(" name=\"" + getType() + "Btn\"");
				myPrint.append(" id=\"" + getType() + "Btn\"");
				myPrint.append(" value=\"" + getLabel(getType()) + "\"");
				myPrint.append(" onclick=\" " + getForm().getJsFormManager() + ".submit('" + getUrlForType(getType()) + "', " + getDoRedirect() + ", " + getRedirectLevelOffset() + ");\"");
/s
ButtonTag.getUrlForType(String) line: 305	
/=
	protected String getUrlForType(String aType) {
aType="save"
		String myRet = EntityActionUtil.getActionUrl(getRequest(), aType);
/s
EntityActionUtil.getActionUrl(HttpServletRequest, String) line: 33	
/=
	public static String getActionUrl(HttpServletRequest aRequest, String aTargetAction) {
		return getActionUrl(aRequest.getRequestURI(), aTargetAction);
/s
EntityActionUtil.getActionUrl(String, String) line: 55	
/=
	public static String getActionUrl(String aFullUrl, String aTargetAction) {
aFullUrl	"/tms/oms/party_edit" (id=20264)	
aTargetAction	"save" (id=1251)	
...
		return buildActionUrl(myCurrentModule, myCurrentEntityActionParts);
myCurrentModule	"oms" (id=20271)	
myCurrentEntityActionParts	String[2]  (id=20273)	
[party,save]
/ Antwoord:
../oms/party_save

/t
ButtonTag.doStartTag() line: 219	
				myPrint.append(" onclick=\" " + getForm().getJsFormManager() + ".submit('" + getUrlForType(getType()) + "', " + getDoRedirect() + ", " + getRedirectLevelOffset() + ");\"");
/d
/s
getDoRedirect() =false
getRedirectLevelOffset()=0


/ 7	. 

/ save and close

/ WH ButtonTag is onderdeel van JSP: parses de .jsp file	, 

$ vi party_edit.jsp
	<mpo:button type="saveAndClose" url="${returnUrl}" />

ButtonTag.doStartTag() line: 91	

		String returnUrl = (String) getSession().getAttribute("returnUrl");
http://localhost:8080/tms/wicket/?wicket:interface=:1::::

			} else if (getType().equals(TYPE_SUBMIT_AND_CLOSE) || getType().equals(TYPE_SAVE_AND_CLOSE)) {
				myPrint.append("<input type=\"button\"");
				myPrint.append(" id=\"" + getType() + "Btn\"");
				myPrint.append(" value=\"" + getLabel("save_and_close") + "\"");
				myPrint.append(" onclick=\" " + getForm().getJsFormManager() + ".submit('" + getSaveUrl() + "', true, '-1'); return false;\"");
/s
ButtonTag.getSaveUrl() line: 357	
		String myActionUrl = EntityActionUtil.getActionUrl(getRequest(), "save");
../oms/party_save
/ Net als hierboven bij save	,

/ 7	. 

/ cancel

$ vi party_edut.java
		String returnUrl = (String) getSession().getAttribute("returnUrl");
http://localhost:8080/tms/wicket/?wicket:interface=:1::::

/ Maar 
getUrl()=
http://localhost:8080/tms/wicket/?wicket:interface=:1::::

/ Dus dubbel	,
/ TODO

		} else if (TYPE_CANCEL.equals(getType()) && returnUrl != null) {
			myPrint.append("<input type=\"button\" ");
			myPrint.append(" id=\"cancelBtn\"");
			myPrint.append(" value=\"" + (!readOnly ? getLabel("cancel") : getLabel("back")) + "\"");
			myPrint.append(" onclick=\" " + getForm().getJsFormManager() + ".cancelAndRedirect('" + getCancelMessage() + "', '" + getUrl() + "');\"");

			if (!myCanGoBack) {
				myPrint.append(" disabled=\"disabled\" ");
				myPrint.append(" title=\"" + myCanGoBackMessage + "\"");
			}

			myPrint.append("/>");

/ Einde Intermezzo

/ FIX PCT-737

$ vi AbstractSaveAction.java

	protected void afterSave() throws Exception {

		getSession().setAttribute(LIST_MESSAGE_ATTRIBUTE, getSaveMessage());
		if (shouldTakeControl()) {

->			String myRedirectUrl = (String) getSession().getAttribute("returnUrl");
			if (myRedirectUrl == null) {
				myRedirectUrl = getRedirectUrl();
			}
			getRequest().setAttribute("redirectTo", myRedirectUrl);

			RedirectSaveAction.redirect(getRedirector(), getRequest(), myRedirectUrl);
		}
	}



/ Einde FIX PCT-737

/ SAMENVATTING REDIRECTURL PCT-796 PCT-737

$ vi PartyListPage.java
		myRowActions.add(new RowAction() {
			@Override
			public boolean execute(Object aObject) {
				String returnUrl = getRequestCycle().urlFor(PartyListPage.this).toString();
				returnUrl = RequestUtils.toAbsolutePath(returnUrl);
				getRequestCycle().setRequestTarget(
						new RedirectRequestTarget("../oms/party_edit?" + "base_sessionLevelOffset=1" + "&systemid=" + aObject + "&systemId=" + aObject + "&returnUrl=" + returnUrl));
				return false;
			}

		});
/ Voor als we click op de edit-button in een row	,

/ we hebben deze url copy van het oude party list scherm , en de returnUrl erachter gezet	,



/ Als we click op de edit-button	, gaan we party_edit doen, dus komen we eerst in PartyFormAction.act	, daar wordt de returnUrl opgepakt, die we hier hebben add aan de url	, en vervolgens vindt de party_edit.jsp hem dan	, 


/en	, 
$ vi oms-sitemap.xmap

			<map:action logger="party" name="partyForm" src="com.mpobjects.oms.control.party.action.PartyFormAction"/>

			<map:match type="regexp" pattern="^party_(edit|create)$">
				<map:act type="partyForm"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/party_edit.jsp"/>
			</map:match>

$ vi PartyFormAction.java
	public Map act() throws java.lang.Exception {
		String returnUrl = getRequestParameter("returnUrl");
		getRequest).setAttribute("returnUrl", returnUrl);
////////////////
/ Als we click op de edit-button in een row	,

$ vi ButtonTag.java

		String returnUrl = (String) getRequest().getAttribute("returnUrl");

		} else if (TYPE_CANCEL.equals(getType()) && returnUrl != null) {
			myPrint.append("<input type=\"button\" ");
			myPrint.append(" id=\"cancelBtn\"");
			myPrint.append(" value=\"" + (!readOnly ? getLabel("cancel") : getLabel("back")) + "\"");
			myPrint.append(" onclick=\" " + getForm().getJsFormManager() + ".cancelAndRedirect('" + getCancelMessage() + "', '" + getUrl() + "');\"");

/ Dubbel, returnUrl==getUrl()
/ TODO (we kunnen oon <mpo:button type="cancel/saveAndClose" returnUrl/> doen	, en dan use getRequest().isParameter("returnUrl") )

/ getUrl() is de url param in: 

$ vi  party_edit.jsp
					<mpo:button type="cancel" url="${returnUrl}"/>

$ vi FormTag.java

	@Override
	public int doStartTag() throws JspTagException {

		String returnUrl = (String) getRequest().getAttribute("returnUrl");
		if (StringUtils.isEmpty(returnUrl) == false) {
			myPrintString.append("<input type=\"hidden\"");
			myPrintString.append(" name=\"returnUrl\"");
			myPrintString.append(" id=\"returnUrl\"");
			myPrintString.append(" value=\"" + returnUrl + "\"");
			myPrintString.append("/>");
		}

$ vi AbstractSaveAction.java

	protected void afterSave() throws Exception {

		if (shouldTakeControl()) {

			String myRedirectUrl = getRequest().getParameter("returnUrl");
			if (StringUtils.isEmpty(myRedirectUrl)) {
				myRedirectUrl = getRedirectUrl();
			}

			getRequest().setAttribute("redirectTo", myRedirectUrl);

			RedirectSaveAction.redirect(getRedirector(), getRequest(), myRedirectUrl);
		}
	}

/ als we 
Configuration, planning, service order templates
/ click Edit in a row	, a service order template
/ click Save and Close	, we op de list van parties	, 
/ we zien dat in 
AbstractSaveAction de returnUrl nog steeds deze Wicket pagina is	,

/ 	7	. 

/ we hadden misschien ook kunnen use	,

FormTag.getRedirectUrl() line: 624	

	private String getRedirectUrl() {
		String myRedirectTo = "";
		if (getRequest().getAttribute("redirectTo") != null) {
			myRedirectTo = (String) getRequest().getAttribute("redirectTo");
		} else if (getRequest().getParameter("redirectTo") != null) {
			myRedirectTo = getRequest().getParameter("redirectTo");
		} else {
			myRedirectTo = "../core/back?levelOffset=-1";// EntityActionUtil.getActionUrl(getRequest(), "list") +
															// "?refresh=true";
		}
		return myRedirectTo;
	}

/ Einde SAMENVATTING REDIRECTURL PCT-796 PCT-737

/ 7	. 

/ PCT-796

/ opruimen oude schermen	, 

$ vi oms-menu.xml

	<m:add path="configuration.planning.parties" privilege="party.list" actionUrl="oms/party-type_preselect_list" index="1050" />
	<m:add path="configuration.planning.partyList" privilege="party.list" actionUrl="wicket?module=oms&amp;wicketpage=party.PartyListPage" index="1050" />

$ vi oms-sitemap.xml

			<map:action logger="party" name="partyTypeList" src="com.mpobjects.oms.control.partytype.action.PartyTypeListAction"/>
			<map:match pattern="party-type_list">
				<map:act type="partyTypeList"/>
				<map:generate type="serverpages" src="xsp/party-type_list.xml">
                </map:generate>
				<map:call resource="dynatable-styler"/>
			</map:match>
			<!-- A list for clicking through to the parties -->
			<map:match pattern="party-type_preselect_list">
				<map:act type="partyTypeList"/>
				<map:call resource="dynatablePage">
				    <map:parameter name="xsp" value="xsp/party-type_list.xml"/>
				    <map:parameter name="xsl" value="xsl/party-type-preselection-list.xsl"/>
				    <map:parameter name="edit" value="false"/>
				</map:call>
			</map:match>

			<map:match pattern="party-type_selection-list">
				<map:act type="partyTypeList"/>
				<map:generate type="serverpages" src="xsp/party-type_list.xml"/>
				<map:call resource="dynatable-selection-styler"/>
			</map:match>

/ 7	. 
/ we rm uit oms-sitemap.xmap wat hier staat	,

/ 7	. 

/ we rm 
com.mpobjects.oms.control.partytype.action.PartyTypeListAction

/ 7	. 

/ we rm
module/oms/war/oms/xsp/party-type_list.xml 
./module/oms/war/oms/xsl/party-type-preselection-list.xsl

/ 7	. 

$ vi oms-menu.xml
	<m:add path="configuration.planning.parties" privilege="party.list" actionUrl="wicket?module=oms&amp;wicketpage=party.PartyListPage" index="1050" />






/ Einde PCT-796



/ 7	. 

/ redirect Save and close

/ we zien in HTML	,

/ ons form	, 
<form method="post" ...>
	<input type="hidden" name="redirectTo" id="redirectTo" value="../core/back?levelOffset=-1">
	<input type="hidden" name="doRedirect" id="doRedirect">

	<input type="button" id="saveAndCloseBtn" value="Save and Close" onclick=" theEditFormFormManager.submit('../oms/party_save', true, '-1'); return false;">

$ vi class.formmanager.js

   this.submit = function(anAction, aBoolDoRedirect, aRedirectionLevelOffset) {
/ anAction="../oms/party_save"
/ aBoolDoRedirect=true
/ aRedirectionLevelOffset=-1

       	this.lastAction = anAction;
"../oms/party_save"
        this.lastDoRedirect = aBoolDoRedirect;
true

        document.getElementById("base_sessionLevelOffset").value=aRedirectionLevelOffset;
-1
		document.getElementById("doRedirect").value=aBoolDoRedirect;
true

        var myForm = document.getElementById(this.theFormName);

        if(anAction){
        	myForm.action=anAction;
"../oms/party_save"
 

            myForm.submit();

$ vi oms-sitemap.xmap

			<map:action logger="party" name="partySave" src="com.mpobjects.oms.control.party.action.PartySaveAction"/>

			<map:match pattern="party_save">
				<map:act type="partySave"/>
				<map:redirect-to uri="edit_party?systemid={request-attr:systemid}"/>
			</map:match>
 
public class PartySaveAction extends BoundSaveAction implements Callable<Void> {

public abstract class BoundSaveAction extends AbstractSaveAction implements FlowControlledAction {

public abstract class AbstractSaveAction extends AbstractAction implements NonScreenAction {

/s
PartySaveAction(AbstractSaveAction).afterSave() line: 157	
		if (shouldTakeControl()) {
/s
			return !getParameters().isParameter("noRedirect");

			String myRedirectUrl = getRedirectUrl();
/s
PartySaveAction(AbstractSaveAction).getRedirectUrl() line: 495	

/ Intermezzo

/ In devtools' Network zien we 
FormData

	redirectTo:../core/back?levelOffset=-1
/ Klopt	, dit komt uit een hidden field in het form	,
	doRedirect:true
/ Klopt	, dit komt uit een hidden field in het form	,
	base_sessionLevelOffset:-1
/ Set in JS	,

/ Hier kunnen we doen	,
	getRequest().getParameter("redirectTo") 
../core/back?levelOffset=-1
/ Klopt	, dit komt uit een hidden field in het form	,

/ Maar wat is deze ? Zijn dit de params achter de url?
"getParameters()"	 (pending)	
	location	LocationImpl  (id=21684)	
	m_parameters	HashMap  (id=21685)	
	m_readOnly	false	

/ Achter de url zien we geen params	,  


/ Einde Intermezzo

			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
			int myLevelOffset = getRequestManager().parseLevel(myLevelOffsetStr);
-1
			} else {
				int myTargetLevel = getRequestManager().getLevel() + myLevelOffset;
0
				BaseRequest myTargetRequest = getRequestManager().getRequestForLevel(myTargetLevel);
				myRet = myTargetRequest.getUrl();
../core/opening_page

				for (Enumeration myEnumeration = getRequest().getParameterNames(); myEnumeration.hasMoreElements();) {
/ we zien form data	,
base_sessionLevelOffset:-1
base_windowToOpenUrl:
base_windowToOpenHeight:
base_windowToOpenWidth:
base_windowToOpenTitle:
base_windowToOpenScrollbar:
					myKey = (String) myEnumeration.nextElement();
					if (myKey.startsWith("base_")) {
						myMap.put(myKey, getRequestParameter(myKey));
					}
				}
				myMap.put(RequestManager.SESSION_LEVEL_OFFSET, myLevelOffsetStr);
				myRet = getRequestUrl(myRet, myMap);
/ Dus heeft myMap erachter gezet	,
../core/opening_page?base_windowToOpenUrl=&randomizingurl=1444293407115&base_windowToOpenTitle=&base_sessionLevelOffset=-1&base_windowToOpenScrollbar=&base_windowToOpenWidth=&base_windowToOpenHeight=

/t
PartySaveAction(AbstractSaveAction).afterSave() line: 158	
		if (shouldTakeControl()) {

			String myRedirectUrl = getRedirectUrl();
/d
../core/opening_page?base_windowToOpenUrl=&randomizingurl=1444293407115&base_windowToOpenTitle=&base_sessionLevelOffset=-1&base_windowToOpenScrollbar=&base_windowToOpenWidth=&base_windowToOpenHeight=

			getRequest().setAttribute("redirectTo", myRedirectUrl);
/ TODO
			RedirectSaveAction.redirect(getRedirector(), getRequest(), myRedirectUrl);
/s
RedirectSaveAction.redirect(Redirector, Request, String, int) line: 43	

		for (Enumeration myEnum = aRequest.getParameterNames(); myEnum.hasMoreElements();) {
			myParameterName = (String) myEnum.nextElement();

			if (myParameterName.startsWith("base_") && StringUtils.isNotEmpty(aRequest.getParameter(myParameterName))) {
base_sessionLevelOffset
				myRememberedParamList.add(myParameterName + "=" + aRequest.getParameter(myParameterName));
			}
		}
		if (aLevelOffset != 0) {
/ NEE
		if (myRememberedParamList.size() > 0) {
			String mySeperator;
			if (anUrl.indexOf('?') > 0) {
/ JA
				mySeperator = "&";

			anUrl += mySeperator + StringUtils.implode(myRememberedParamList.toArray(), "&");
../core/opening_page?base_windowToOpenUrl=&randomizingurl=1444293407115&base_windowToOpenTitle=&base_sessionLevelOffset=-1&base_windowToOpenScrollbar=&base_windowToOpenWidth=&base_windowToOpenHeight=&base_sessionLevelOffset=-1

		aRequest.setAttribute("redirectTo", anUrl);
			String myRedirectPage = "../core/generic_save_redirect?redirectTo=" + URLEncoder.encode(anUrl, "UTF-8");
../core/generic_save_redirect?redirectTo=..%2Fcore%2Fopening_page%3Fbase_windowToOpenUrl%3D%26randomizingurl%3D1444293407115%26base_windowToOpenTitle%3D%26base_sessionLevelOffset%3D-1%26base_windowToOpenScrollbar%3D%26base_windowToOpenWidth%3D%26base_windowToOpenHeight%3D%26base_sessionLevelOffset%3D-1

			aRedirector.redirect(true, myRedirectPage);
/ aRedirector is een cocoon obj	,













/ Einde PCT-737 WICKET

/ OPEN IN WINDOWS

 LOG_8_sep_2014.txt
LOG_6_OCT_2014.txt
LOG_23_jul_2015.txt
LOG_10_aug_2015.txt
LOG_8_sep_2015.txt	 / MORGENOCHTEND
LOG_29_sep_2015.txt	/ PCT-796	,

[eric@localhost eclipse-jee]$ eclipse/eclipse 
/home/eric/Devel/Java/Eclipse/eclipse-jee-test
/home/eric/Devel/Java/Tomcat/apache-tomcat-7.0.57
/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/2015.03
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnllogistics/lib
/home/eric/Devel/Java/ActiveMQ/apache-activemq-5.10.1
/home/eric/Devel/Java/Hibernate
/home/eric/Devel/Java/Wicket/wicket/wicket-examples
/home/eric/DB_TAP/Firebird

/home/eric/bin
eric@mposerv8:/backup/mpo-backup/db$ 
[eric@localhost bin]$ dsvfms-db-t.sh 
[eric@localhost bin]$ dsvfms-db2-t.sh 


/home/eric/Devel/Postgres/scripts/w3resource
/var/lib/pgsql/data/pg_log
[eric@localhost LOGS]$ PGPASSWORD=mpopostgres@mpo psql -U mpopostgres pnllogistics3
[eric@localhost Firebird]$ isql-fb -user sysdba -password masterkey first.fdb 
[eric@localhost LOGS]$ psql -U foo 

/ Einde OPEN IN WINDOWS 

/ TABS IN CHROME 

/ firebird

http://www.firebirdsql.org/refdocs/langrefupd25-psql-forselect.html
http://www.firebirdsql.org/file/documentation/reference_manuals/reference_material/html/langrefupd25-ddl-table.html#langrefupd25-alter-table
http://stackoverflow.com/questions/15841167/how-to-input-an-array-parameter-of-values-to-firebird-stored-procedure
http://www.janus-software.com/fbmanual/manual.php?book=psql&topic=37
http://www.pp4s.co.uk/main/tu-db-firebird-demo4.html
http://stackoverflow.com/questions/20844485/firebird-and-stored-procedures-if-exists-then-else
http://stackoverflow.com/questions/30196518/tokene-unknown-creating-a-stored-procedure-with-dynamic-table-name
http://www.ibexpert.net/ibe/index.php?n=Doc.WritingStoredProceduresAndTriggers
http://stackoverflow.com/questions/21115720/insert-select-in-firebird
http://www.ibexpert.net/ibe/index.php?n=Doc.WritingStoredProceduresAndTriggers
http://stackoverflow.com/questions/21115720/insert-select-in-firebird

/ andere 	, 

https://scotch.io/tutorials/submitting-ajax-forms-with-jquery


/ Einde FIREBIRD TABS IN CHROME 


/ WICKET 

/ See	,
http://www.wicket-library.com/wicket-examples-6.0.x

/ Daar kunnen we kiezen	,
http://www.wicket-library.com/wicket-examples-6.0.x/repeater

public abstract class DataView<T> extends DataViewBase<T>
public abstract class DataViewBase<T> extends AbstractPageableView<T>
public abstract class AbstractPageableView<T> extends RefreshingView<T> implements IPageableItems

public class DataTable<T, S> extends Panel implements IPageableItems
	private final DataGridView<T> datagrid;

public class DataGridView<T> extends AbstractDataGridView<T>




/ Einde WICKET

/ CEVA-15059

/ 7	. 

/ cargo test local	,
/ neem sho2991, deze was planned	, 
/ kies een sa	, collect, en click de seo N4907.1
/ geef de actual start date, gisteren, 19 oct	, click save	,
/ deze seo is STARTED, 8000	, 	en de sho2991 dan ook	, (alle sho's waar deze seo de collect van is zijn started)	,
/ ga terug naar de sho2991, en click de linehaul seo	, deze staat nog op planned	,
/ we zien de status van sho2991 STARTED	, 

/ waarom heeft een rc niet de prijs van de sho2991 berekend?
/ TODO

/  op de seo, als we actual end date , vandaag , 20 eoc	, click save	,
/ de seo is nu FINISHED, 9000	, 
/ we zien de status van sho2991 STARTED	, , klopt, de sho2991 is pas FINISHED als alle sa's FINISHED	, 

/ dus als 1 sa STARTED,	 dan is de sho2991 STARTED
/ als ALLE sa FINISHED, is de sho2991 FINISHED


/ maar in de search list is de sho2991 PLANNED
/ TODO

/ we kiezen sho2991	,
/ click in een shipment order, initial/planned/started of niet	, op cost	,
/ click Post-calculated	, create handmatig de prijs van deze sho	, click 'Create'	,

/ 7	. 

/ edit een sho2991	, 
$ vi oms-sitemap.xmap
			<map:match pattern="shipment-order_edit">
				<map:act type="shipmentOrderEdit">
					<map:select type="session-attribute">
						<map:parameter name="attribute-name" value="builder"/>
						<map:when test="jsp">
							<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order_edit.jsp"/>
						</map:when>
						<map:otherwise>
							<map:redirect-to uri="../wicket?module=oms&amp;wicketpage=shipmentorder.edit.ShipmentOrderEditSelectionPage"/>
						</map:otherwise>			
					</map:select>
				</map:act>
			</map:match>

/ we zien de cost button op het scherm	,

		                			<a href="#" target="_self" onclick="return openFinancialDetails();" class="atoButton">
		                				<c:if test="${cf:property('oms', 'shipmentorder.price.hidden', 'false')=='false'}">
		                					<mpo:label name="price" />
		                				</c:if>
		                				<c:if test="${cf:property('oms', 'shipmentorder.cost.hidden', 'false')=='false'}">
		                					<mpo:label name="cost" />
		                				</c:if>
/ In de database staan deze properties  niet	, maar wel in de pnllogistics.properties file	,
$ vi pnllogistics.properties 
module.oms.shipmentorder.price.hidden = true
module.oms.shipmentorder.cost.hidden = false
/ Daarom staat er cost op de button 	, WH	,

/ In devtools doen we een search	, 
$ vi class.shipment-order_edit.js
function openFinancialDetails() {

	var mySystemId =document.getElementById("systemId").value;
	theShipmentorderFormManager.setRedirectUrl("../wicket/?module=oms&wicketpage=shipmentorder.shipmentorderfinancialdetails.ShipmentOrderFinancialPage&shipmentorder_systemid=" 
			+ mySystemId);
	theShipmentorderFormManager.conditionalSubmit(null,true,1);
	return false;
}

/ we komen op een wicket page	, ShipmentOrderFinancialPage	, 

/ 7. 	

/ we zien 4 tabs	, pre-calculated, post-calculated, actual, price	, TDOO
/ op elke tab zien we 4 panels: Cost, Price, Margin, ...
/ we kijken nu naar de Price panel	, dat is een ShipmentOrderPriceListPanel	, 

$ vi ShipmentOrderPriceListPanel.java
...

Daemon Thread [http-0.0.0.0-8080-4] (Suspended)	
	BaseWebSession(Session).getAuthorizationStrategy() line: 543	
		return getApplication().getSecuritySettings().getAuthorizationStrategy();
com.mpobjects.view.wicket.BaseAuthorizationStrategy@173583aa

	ShipmentOrderPriceListPanel$3$1(Component).isActionAuthorized(Action) line: 2097	
		IAuthorizationStrategy authorizationStrategy = getSession().getAuthorizationStrategy();

	ShipmentOrderPriceListPanel$3$1(Component).isEnableAllowed() line: 2124	
		return isActionAuthorized(ENABLE);

	ShipmentOrderPriceListPanel$3$1(Component).isEnabledInHierarchy() line: 4776	
				state = isEnabled() && isEnableAllowed();
/ isEnabled() is is onze code 
/ TODO (ESTIMATED, NOT_INVOICED)

	ShipmentOrderPriceListPanel$3$1(FormComponent).onComponentTag(ComponentTag) line: 1504	
		if (!isEnabledInHierarchy())

	ShipmentOrderPriceListPanel$3$1(Button).onComponentTag(ComponentTag) line: 198	
		super.onComponentTag(tag);

	ShipmentOrderPriceListPanel$3$1(Component).renderComponent(MarkupStream) line: 2696	
	ShipmentOrderPriceListPanel$3$1(MarkupContainer).onRender(MarkupStream) line: 1559	
	ShipmentOrderPriceListPanel$3$1(Component).render(MarkupStream) line: 2525	
	Item(MarkupContainer).renderNext(MarkupStream) line: 1461	
	Item(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	Item(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	Item(Component).renderComponent(MarkupStream) line: 2725	
	Item(MarkupContainer).onRender(MarkupStream) line: 1559	
	Item(Component).render(MarkupStream) line: 2525	
	ShipmentOrderPriceListPanel$3(AbstractRepeater).renderChild(Component) line: 122	
	ShipmentOrderPriceListPanel$3(AbstractRepeater).onRender(MarkupStream) line: 103	
	ShipmentOrderPriceListPanel$3(Component).render(MarkupStream) line: 2525	
	WebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1461	
	WebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	WebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	WebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	WebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	WebMarkupContainer(Component).render(MarkupStream) line: 2525	
	ShipmentOrderPriceListPanel(MarkupContainer).renderNext(MarkupStream) line: 1461	
	ShipmentOrderPriceListPanel(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	ShipmentOrderPriceListPanel(MarkupContainer).renderAssociatedMarkup(String, String) line: 717	
	ShipmentOrderPriceListPanel(Panel).onComponentTagBody(MarkupStream, ComponentTag) line: 114	
	ShipmentOrderPriceListPanel(Component).renderComponent(MarkupStream) line: 2725	
	ShipmentOrderPriceListPanel(MarkupContainer).onRender(MarkupStream) line: 1559	
	ShipmentOrderPriceListPanel(Component).render(MarkupStream) line: 2525	
	ShipmentOrderPriceCostTab(MarkupContainer).renderNext(MarkupStream) line: 1461	
	ShipmentOrderPriceCostTab(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	ShipmentOrderPriceCostTab(MarkupContainer).renderAssociatedMarkup(String, String) line: 717	
	ShipmentOrderPriceCostTab(Panel).onComponentTagBody(MarkupStream, ComponentTag) line: 114	
	ShipmentOrderPriceCostTab(Component).renderComponent(MarkupStream) line: 2725	
	ShipmentOrderPriceCostTab(MarkupContainer).onRender(MarkupStream) line: 1559	
	ShipmentOrderPriceCostTab(Component).render(MarkupStream) line: 2525	
	AjaxTabbedPanel(MarkupContainer).renderNext(MarkupStream) line: 1461	
	AjaxTabbedPanel(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	AjaxTabbedPanel(MarkupContainer).renderAssociatedMarkup(String, String) line: 717	
	AjaxTabbedPanel(Panel).onComponentTagBody(MarkupStream, ComponentTag) line: 114	
	AjaxTabbedPanel(Component).renderComponent(MarkupStream) line: 2725	
	AjaxTabbedPanel(MarkupContainer).onRender(MarkupStream) line: 1559	
	AjaxTabbedPanel(Component).render(MarkupStream) line: 2525	
	AjaxTabbedPanel(Component).renderComponent() line: 2666	
	AjaxRequestTarget.respondComponent(Response, String, Component) line: 876	
	AjaxRequestTarget.respondComponents(WebResponse) line: 680	
	AjaxRequestTarget.respond(RequestCycle) line: 590	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	
	ApplicationFilterChain.internalDoFilter(ServletRequest, ServletResponse) line: 252	
...

/ ShipmentOrderPriceListPanel$3$1 is de edit button	(op een rij),

/ we debug verder	, 
/t
ShipmentOrderPriceListPanel$3$1(Component).isActionAuthorized(Action) line: 2098	
/=
	public final boolean isActionAuthorized(Action action)
action	org.apache.wicket.authorization.Action  (id=32307)	
ENABLE
		IAuthorizationStrategy authorizationStrategy = getSession().getAuthorizationStrategy();
com.mpobjects.view.wicket.BaseAuthorizationStrategy@173583aa
/s
BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 65	
		PermissionType myP = getPermissionManager(component).checkPermission(component, action);
/s
BaseAuthorizationStrategy.getPermissionManager(Component) line: 203	

		HttpServletRequest req = ((WebRequest) RequestCycle.get().getRequest()).getHttpServletRequest();
req	org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestWrapper  (id=33081)	
	request	org.springframework.security.web.firewall.RequestWrapper  (id=33086)	
		request	org.apache.catalina.connector.RequestFacade  (id=33089)	
		stripPaths	false	
		strippedPathInfo	"/" (id=33090)	
		strippedServletPath	"/wicket" (id=33091)	
	rolePrefix	null	
	trustResolver	org.springframework.security.authentication.AuthenticationTrustResolverImpl  (id=33087)	

		WicketPermissionManager myManager = (WicketPermissionManager) req.getAttribute("PM");
myManager	com.mpobjects.oms.service.permission.WicketPermissionManager  (id=33012)	
	checkedComponentClasses	java.util.HashSet  (id=33078)	
	groupCache	java.util.HashMap  (id=33079)	
	permissionGroupDAO	null	
	permissionService	null	
	resource	null	

		return myManager;
/t
BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 66	
		PermissionType myP = getPermissionManager(component).checkPermission(component, action);
/s
WicketPermissionManager.checkPermission(Component, Action) line: 28	
/=
	public PermissionType checkPermission(Component aComponent, Action anAction) {
		if (isCheckedComponent(aComponent)) {
/ NEE
		return null;
/t
BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 88	
		PermissionType myP = getPermissionManager(component).checkPermission(component, action);
null
		if (myP != null) {
/ NEE
		Privilege myPrivilege = component.getClass().getAnnotation(Privilege.class);
null
		if (myPrivilege == null) {
			...
			return true;
...
/t
ShipmentOrderPriceListPanel$3$1(Component).isEnabledInHierarchy() line: 4778	
				state = isEnabled() && isEnableAllowed();
true
/t
ShipmentOrderPriceListPanel$3$1(FormComponent).onComponentTag(ComponentTag) line: 1509	
		if (!isEnabledInHierarchy())
/ NEE
		{
			onDisabled(tag);
/ NIET
		super.onComponentTag(tag);










 

/ Einde CEVA-15059

/ PAT-267

/ 7	. 

/ party types	,

BRENGKLANT	Breng Klant
CONSIGNEE	Consignee of goods
CONSIGNOR	Consignor of goods
CUSTOMER	Bill To customer
hub	Stadslogistiek
KLANT	Klant
PlanOrganization	For order allocation to Quintiq.
SERVICE_PROVIDER	SERVICE_PROVIDER
VIA	Autobestelling/Hub

/ party type group	,

BILL_TO	Bill to
	CUSTOMER			Bill To customer
	SERVICE_PROVIDER	SERVICE_PROVIDER
COLLECTION	
	BRENGKLANT			Breng Klant
	CUSTOMER			Bill To customer
	hub					Stadslogistiek
	KLANT				Klant
DELIVERY	
	BRENGKLANT			Breng Klant
	CUSTOMER			Bill To customer
	hub					Stadslogistiek
	KLANT				Klant
	SERVICE_PROVIDER	SERVICE_PROVIDER
PLANNIG_EXPORT	
PREFERRED_PARTY	
SERVICE_PROVIDER	
VIA	Autobestelling

/ Als we bij een shipment order, ship from via de button de from party kiezen	, dan zien we de list van parties waarvan de types in de COLLECTION  party type group	, dus parties met type BRENGKLANT	, CUSTOMER, hub, KLANT	,
/ bij shipto zien we alle parties in de DELIVERY  ptg	,
/  bij bill to zien we alle parties in de BILL_TO ptg	,

/ 7	. 

/ welke parties zien we bij 	,
Planning, Service order, planning export
/ click bij Hub	 op button	, we zien 36 parties	, maar er zijn er 44	,

/ 7	. 

/ See	,
scs-breakpoints.txt.bkpt

/ 7	. 

/ we maken een party type group	"HUB"	, met daarin de party type
/ TODO 

/ 7	. 

/ hij is steeds ergens mee bezig	,
/ TODO

/ we dachten: er worden steeds nieuwe sho create	,
/ maar is NIET zo	

pnltms=# \d shipment_order
 is_recurring                   | smallint                    | 

/ we kunnen 
pnltms=# update shipment_order set is_recurring=0 where is_recurring=1

/ of	, 

pnltms=# select * from cronjoblines;
-[ RECORD 4 ]-----+------------------------------------------------------------------------------------------
-----------------
system_id         | 84455
description       | Create recurring SHO instances
cminute           | 1,10,20,22,25,30,40,50
chour             | *
cday_of_week      | ?
cday_of_month     | *
cmonth            | *
task_class        | com.mpobjects.oms.service.RecurringShipmentOrderGeneratorTask
parameters        | organization=SYSTEM, scheduleHorizon=240, holdStatus=(VALID,ACCEPTED)
email             | dries.yingjansen@mp-objects.com
enabled           | 1
status            | 0
last_run_result   | 1

/ set enabled=0	, 

/ maar we doen beide NIET	, 
/ want we zien dat aantal sho's gelijk blijft	, 
/ 

/ 7	. 

/ zoek op xwiki naar jstack	,

[eric@localhost Wicket]$ grep 3302 <(sudo netstat -lpn )
tcp6       0      0 :::8009                 :::*                    LISTEN      3302/java           
tcp6       0      0 :::1098                 :::*                    LISTEN      3302/java           
tcp6       0      0 :::1099                 :::*                    LISTEN      3302/java           
tcp6       0      0 :::8080                 :::*                    LISTEN      3302/java           
tcp6       0      0 :::8083                 :::*                    LISTEN      3302/java           
tcp6       0      0 :::4444                 :::*                    LISTEN      3302/java           
tcp6       0      0 :::8093                 :::*                    LISTEN      3302/java           
tcp6       0      0 :::4445                 :::*                    LISTEN      3302/java           
/ TODO

[eric@localhost Wicket]$ jstack 3302
...
/ TODO

/7	. 

/ we voegen de src code van wicket toe, door 
Add
/ external library	,
wicket-1.4.23-sources.jar
wicket-extensions-1.4.23-sources.jar

/ 7	.

/ er werden steeds sho create/update	,

pnltms=# update  cronjoblines set enabled=0;

[eric@localhost pnltms]$ rm -rf tmp/ work/ data/
/ dit stopte enorme activiteit	,

/ JMS GUI
http://localhost:8161/admin/queues.jsp
/ Purge MPOBJECTS.FROM.PNLTMS
/ Maar dit was WH onnodig	,

/ 7	.


/ we hebben b's set in 	, voor wicket	,
QueryViewPanel
PartyListPanel
FilterBarPanel

/ Einde Intermezzo

/ Intermezzo

$ vi PartyFormField.java

public class PartyFormField<T extends Party> extends FormComponentPanel<T> implements WebComponentListener {
	protected PartyField<T> codeField;

		codeField = new PartyField<T>("partyId", lookupContext, getModel()) {
		codeField.setPartyTypeGroup(partyTypeGroup);
		add(codeField);
		codeField.getTextField().add(new AjaxEventBehavior("onblur") {
			...

$ vi PartyFormField.html

<wicket:panel>
	<span class="lookup"><wicket:container wicket:id="partyId"></wicket:container></span>
</wicket:panel>

/ PartyField is een panel, een collectie van een text field en nog een panel	, 

$ vi PartyField.java

	protected MasterDataPartyLookupButton lookupButton;
	protected AltAutoCompleteTextField<String, MasterDataParty> partyIdField;

$ vi PartyField.html

	<wicket:panel>
		<input wicket:id="partyId" type="text" class="partyId" size="15" />
		<wicket:container wicket:id="lookup"></wicket:container>
	</wicket:panel>

$ vi MasterDataPartyLookupButton.java

public class MasterDataPartyLookupButton extends Panel {
	@Override
	protected void onInitialize() {
		...
		Button button = new Button("button");
		...
		add(button);

	public ModalWindow getPopupWindow() {
		if (window != null) {
			return window;
		}
		window = new ModalWindow("window");
		...
		add(window);




$ vi MasterDataPartyLookupButton.html

	<wicket:panel>
		<button wicket:id="button" type="button" class="icon icon_lookup small" wicket:message="title:global-action.lookup">
			<span class="hidden">Look up</span>
		</button>
		<div wicket:id="window"></div>
	</wicket:panel>


/ 13	. 

$ vi AbstractMasterDataPartySelectPage.java

public abstract class AbstractMasterDataPartySelectPage extends AbstractSimplePage {

	protected void createDataTable() {
		MasterDataPartyDataProvider dataProvider = getDataProvider();
		...

	protected List<IColumn<MasterDataParty>> getDataTableColumns(final MasterDataPartyDataProvider aDataProvider) {
		List<IColumn<MasterDataParty>> columns = new ArrayList<IColumn<MasterDataParty>>();
		...
		columns.add(new MappedTextFilteredPropertyColumn<MasterDataParty, String>(new ResourceModel("type"), "partyType.code", "partyType.code"));
		columns.add(new MappedTextFilteredPropertyColumn<MasterDataParty, String>(new ResourceModel("organization"), "organizationVO.code",
			"organizationVO.code"));
		...
/ De table die we zien in de modal window	,


/ 13	. 








/ Einde Intermezzo


/ 7	. 

/ DEBUG	,

Planning, Service order, planning export
/=
ServiceOrderPlanningExportPage
/s
ServiceOrderPlanningExportPage.createPage() line: 110	
		PartyFormField preferedPartyField = new PartyFormField(
			"hub", 
			new PropertyModel<Date>(this, "hub"), 
			"HUB", 
			false, 
			Model.of(new SimplePartyLookupContext(ServiceOrderVO.class, AuthenticationUtils.getResource().getActiveOrganization()))
		);
/s
SimplePartyLookupContext.<init>(Class<?>, Organization) line: 31	
/=
	public SimplePartyLookupContext(Class<?> aEntityType, Organization aOrganization) {
aEntityType	java.lang.Class (com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO) (id=3664)	
/ not used,	
aOrganization	com.mpobjects.oms.model.entity.organization.Organization  (id=1090)	
SystemId:1010	Id:PNL-TMS-AB	Description:Post NL Autobedrijf

		this(aEntityType);
/s
			dateSetVO = new DateSetVO();
/t
		organization = new EntityDetachableModel<Organization>(aOrganization, OrganizationDAO.class);
/t
/s
PartyFormField.<init>(String, IModel<T>, String, boolean, IModel<PartyLookupContext>) line: 39	
/=
	public PartyFormField(String id, IModel<T> aModel, String aPartyTypeGroup, boolean required, IModel<? extends PartyLookupContext> aLookupContext) {
id	"hub" (id=4568)	
aModel	org.apache.wicket.model.PropertyModel  (id=1047)	
aPartyTypeGroup	"HUB" (id=4569)	
required	false	
aLookupContext	org.apache.wicket.model.Model  (id=4574)	

/ meer detail	,
aModel
Model:classname=[org.apache.wicket.model.PropertyModel]:nestedModel=[[Page class = com.mpobjects.exportplan.view.wicket.ServiceOrderPlanningExportPage, id = 3, version = 0]]:expression=[hub]
/ een ServiceOrderPlanningExportPage heeft een property hub	,

aLookupContext
Model:classname=[org.apache.wicket.model.Model]:object=[com.mpobjects.oms.view.wicket.party.SimplePartyLookupContext@5c83e37a]
/ een date (TODO ) en de active organization van de user	,

		super(id, aModel);
/ id="hub"	, aModel is VirtualParty hub property van de wicket page ServiceOrderPlanningExportPage
		setRequired(required);
required=false
/ wicket call	,
		lookupContext = aLookupContext;
		partyTypeGroup = createPartyTypeGroupModel(aPartyTypeGroup);
/s
PartyFormField.createPartyTypeGroupModel(String) line: 68	
/=
	protected IModel<PartyTypeGroupVO> createPartyTypeGroupModel(String aPartyTypeGroup) {
		BeanWrapper<PartyTypeGroupDAO> daoWrapper = new BeanWrapper<PartyTypeGroupDAO>(PartyTypeGroupDAO.class);
		PartyTypeGroupVO group = daoWrapper.getBean().getByCode(aPartyTypeGroup);
		return new EntityDetachableModel<PartyTypeGroupVO>(group, daoWrapper);
/t
PartyFormField.<init>(String, IModel<T>, String, boolean, IModel<PartyLookupContext>) line: 43	
		partyTypeGroup = createPartyTypeGroupModel(aPartyTypeGroup);
/d
partyTypeGroup	com.mpobjects.view.wicket.util.EntityDetachableModel  (id=5104)	
	attached	true	
	attachedVolatile	true	
	dao	com.mpobjects.view.wicket.util.BeanWrapper  (id=4791)	
	entity	com.mpobjects.oms.model.partytypegroup.vo.PartyTypeGroupVO  (id=4801)	
	systemId	27564516	

		init();
/s
PartyFormField.init() line: 81	

		codeField = new PartyField<T>("partyId", lookupContext, getModel()) {
/s
PartyFormField(FormComponent).getModel() line: 1673	
		return (IModel<T>)getDefaultModel();
/s
PartyFormField(Component).getDefaultModel() line: 1714	
		IModel<?> model = getModelImpl();
model	org.apache.wicket.model.PropertyModel  (id=1030)	
	expression	"hub" (id=1036)	
	target	com.mpobjects.exportplan.view.wicket.ServiceOrderPlanningExportPage  (id=962)	
/t
/s
PartyFormField$1(PartyField).<init>(String, IModel<PartyLookupContext>, IModel<T>) line: 148	
/=
	public PartyField(String aId, IModel<? extends PartyLookupContext> aLookupContext, IModel<T> aModel) {
		super(aId, aModel);
aModel=
this.data	org.apache.wicket.model.PropertyModel  (id=1030)	
	expression	"hub" (id=1036)	
	target	com.mpobjects.exportplan.view.wicket.ServiceOrderPlanningExportPage  (id=962)	
/ Dit is een VirtualParty	,

		lookupContext = aLookupContext;
lookupContext	org.apache.wicket.model.Model  (id=1066)	
	object	com.mpobjects.oms.view.wicket.party.SimplePartyLookupContext  (id=1053)	
		dateSetVO	com.mpobjects.oms.model.shipmentorder.vo.DateSetVO  (id=1121)	
		entityType	null	
		organization	com.mpobjects.view.wicket.util.EntityDetachableModel  (id=1126)	

		codeField.setPartyTypeGroup(partyTypeGroup);

/t
PartyFormField.init() line: 89	
		codeField = new PartyField<T>("partyId", lookupContext, getModel()) {
/d
		codeField.setPartyTypeGroup(partyTypeGroup);
	partyTypeGroup	com.mpobjects.view.wicket.util.EntityDetachableModel  (id=4105)	
		attached	true	
		attachedVolatile	true	
		dao	com.mpobjects.view.wicket.util.BeanWrapper  (id=4107)	
		entity	com.mpobjects.oms.model.partytypegroup.vo.PartyTypeGroupVO  (id=4109)	
		systemId	27564516	

		codeField.getTextField().add(new AjaxEventBehavior("onblur") {
/s
PartyFormField$1(PartyField).getTextField() line: 166	
		...
		partyIdField = new AltAutoCompleteTextField<String, MasterDataParty>("partyId", new PropertyModel<String>(this, "modelObject.code"), null, renderer, settings) {
/////////////
/ 1ste wicket comp, een text field,  in PartyField (wat een panel is)	,  wicket:id="partyId"	, = partyIdField	,

		partyIdField.setOutputMarkupId(true);
		partyIdField.add(behavior);
		add(partyIdField);

		return partyIdField;
/t
PartyFormField.init() line: 108	
		codeField.getTextField().add(new AjaxEventBehavior("onblur") {
/d
		codeField.setEnabled(true);

		codeField.setWithLookup(!ApplicationPropertyManager.getInstance().getProperty("module.optimize.ratingrequest.destinationpartylookup.hidden", false));
/s
PartyFormField$1(PartyField).setWithLookup(boolean) line: 216	
		withLookup = aWithLookup;
true
/t
ServiceOrderPlanningExportPage.createPage() line: 112	

		PartyFormField preferedPartyField = new PartyFormField("hub", new PropertyModel<Date>(this, "hub"), "HUB", false, Model.of(new SimplePartyLookupContext(ServiceOrderVO.class, AuthenticationUtils.getResource().getActiveOrganization())));
/d
		form.add(preferedPartyField);
/s
Form(MarkupContainer).add(Component...) line: 142	
			// Add to map
			addedComponent(child);
/s
Form(MarkupContainer).addedComponent(Component) line: 1000	
...
			component.initialize();
/s
PartyFormField(MarkupContainer).initialize() line: 434	
	...
		visitChildren(new IVisitor<Component>()
		{
			public Object component(Component component)
			{
				component.fireInitialize();
/s
PartyFormField$1(Component).fireInitialize() line: 4105	
			onInitialize();
/s
PartyFormField$1(PartyField).onInitialize() line: 245	

/ PartyFormField$1=
		codeField = new PartyField<T>("partyId", lookupContext, getModel()) {
/ 'n panel	,

		partyLookupService = new BeanWrapper<PartyLookupService>(PartyLookupService.class);

		lookupButton = new MasterDataPartyLookupButton("lookup", lookupContext) {
///////////////
/ 2de wicket component, ook een panel	, 

		add(lookupButton);
/s
PartyFormField$1(MarkupContainer).add(Component...) line: 142	
			// Add to map
			addedComponent(child);
/s
PartyFormField$1(MarkupContainer).addedComponent(Component) line: 1000	
...
			component.initialize();
/s
PartyField$2(MarkupContainer).initialize() line: 433	
...
		visitChildren(new IVisitor<Component>()
		{
			public Object component(Component component)
			{
				component.fireInitialize();
/s
PartyField$2(MasterDataPartyLookupButton).onInitialize() line: 204	

PartyField$2=
		lookupButton = new MasterDataPartyLookupButton("lookup", lookupContext) {
/ 'n panel	,

		getPopupWindow();
/s
PartyField$2(MasterDataPartyLookupButton).getPopupWindow() line: 86	
		window = new ModalWindow("window");
		...
		add(window);
		return window;
/t
PartyField$2(MasterDataPartyLookupButton).onInitialize() line: 208	
		getPopupWindow();
/d
		Button button = new Button("button");
		button.add(new AjaxEventBehavior("onclick") {
			...



/t
ServiceOrderPlanningExportPage.createPage() line: 133	
		form.add(preferedPartyField);
/d
		final IndicatingAjaxButton btn = new IndicatingAjaxButton("recalc") {
/ TODO
		form.add(btn);

/ 7	. 

/ we click de button	, 
/s
MasterDataPartyLookupButton$5.onEvent(AjaxRequestTarget) line: 213	
		Button button = new Button("button");
		button.add(new AjaxEventBehavior("onclick") {
			@Override
			protected void onEvent(AjaxRequestTarget aTarget) {
				selectionMade = false;
->				getPopupWindow().show(aTarget);
/s
ModalWindow.show(AjaxRequestTarget) line: 373	
			target.appendJavascript(getWindowOpenJavascript());
/s
ModalWindow.getWindowOpenJavascript() line: 1127	
		if (isCustomComponent() == false)
		{
			Page page = createPage();
/s
MasterDataPartyLookupButton$1.createPage() line: 90	
		window = new ModalWindow("window");
		window.setPageCreator(new PageCreator() {
			@Override
			public Page createPage() {
->				return createSelectionPage();
/s
PartyField$2(MasterDataPartyLookupButton).createSelectionPage() line: 140	
		final List<EntityAction<MasterDataParty>> actions = new ArrayList<EntityAction<MasterDataParty>>();
		actions.add(getSelectAction());
/s
PartyField$2(MasterDataPartyLookupButton).getSelectAction() line: 155	
		EntityActionAjaxButton<MasterDataParty> button = new EntityActionAjaxButton<MasterDataParty>("ok", new ResourceModel("select")) {
/////////////////
/ Deze button zien we op iedere rij	, in de table in het modal window	,
			...
		return button;
/t
PartyField$2(MasterDataPartyLookupButton).createSelectionPage() line: 143	
		actions.add(getSelectAction());
/d
		AbstractMasterDataPartySelectPage page = new AbstractMasterDataPartySelectPage() {
/ de page die we zien in het modal window	,

		page.setLookupContext(lookupContext);
		page.setPartyTypeGroup(partyTypeGroup);


/ FIX PAT-267

/ MICHIEL"S WICKET PAGE
pnltms planning, service order, planning export

$ vi ServiceOrderPlanningExportPage.java

	protected void createPage() {
		...
		String partyTypeGroup = ApplicationPropertyManager.getInstance().getModuleProperty("exportplan", "service_order_planning_export_page.party_type_group");
		PartyFormField preferedPartyField = new PartyFormField("hub", new PropertyModel<Date>(this, "hub"), partyTypeGroup, false, Model.of(new SimplePartyLookupContext(ServiceOrderVO.class, AuthenticationUtils.getResource().getActiveOrganization())));
		...

/ Maak een property	,
module.exportplan.service_order_planning_export_page.party_type_group:"HUB"




$ vi PartyField.java

	@Override
	protected void onInitialize() {
		super.onInitialize();

		partyLookupService = new BeanWrapper<PartyLookupService>(PartyLookupService.class);

		// make sure it is created
		getTextField();

		lookupButton = new MasterDataPartyLookupButton("lookup", lookupContext) {
			@Override
			protected void onAfterLookup(AjaxRequestTarget aTarget, boolean aCancelled) {
				if (!aCancelled) {
					updateModel(aTarget, getModelObject());
				}
			}
		};
->		lookupButton.setPartyTypeGroup(getPartyTypeGroup());
		add(lookupButton);
	}



/ Einde FIX PAT-267
		


 








/ Einde PAT-267





/ DSVSOL-2716

/ See DSVSOL-2719
/ database van acceptance restore op test,	

/ Ga in Jira naar DEV - Support team dashboard
/ Rechtsonder	, deploy tasks	,

/ DEPLOY TASKS

/ 7	. 

/ CSEDO-2829	, overslaan	,
/ CSEDO-3032	, overslaan	,

/ 7	. 

/ DSVSOL-2231	, overslaan	,  wel op productie !

SQL>  select  u.is_enabled from tms_role r join user_role ur on r.system_id=ur.role_systemid join tms_user u on u.system_id=ur.user_systemid where r.name in ('CUSTOMER', 'CARRIER') ;

IS_ENABLED 
========== 
         1 
         0 
         1 
...

/ 7	. 

/ GEOFLOW-214	, overslaan

/ 7	. 
/ SCS-3304	, al gedaan	,

SQL>  select  status from mpo_scs_patch where name ='patch-304-cost-price-type-merge.sql';

STATUS                           
================================ 
APPLIED   

SQL> select code, count(1) from cost_type group by code having count(1) > 1;
SQL> 
/ Inderdaad	,

/ 7	. 

/ SCS-1810	, done	, 

/ Het is juist NIET gedaan	,

eric@mposerv11:/tmp$ jar xvf /local/apps/jboss-4.0.5.GA/lib/endorsed/xercesImpl.jar 
eric@mposerv11:/tmp$ less META-INF/MANIFEST.MF 
Comment: Xerces-J 2.7.1 

eric@mposerv11:/tmp$ jar xvf /local/apps/jboss-4.0.5.GA/server/dsvfms/lib/xercesImpl.jar 
eric@mposerv11:/tmp$ less META-INF/MANIFEST.MF 
Comment: Xerces-J 2.11.0

/ 7	. 

/ SCS-3032, is al	, 

/ Kijk in server/dsvfms/deploy/	, 

/ 7	. 

/ SCS-2698	, is al,

eric@mposerv11:/local/apps/jboss-4.0.5.GA/server/dsvfms$ less conf//local_application.properties 
...
module.interfacing.jms.server.url=tcp\://jms-test\:61616

/ update ticket	, TODO 

/ 7	. 

/ SCS-3975, done

/ updated ticket	, OK done?  TODO

/ 7	. 

/ SCS-4480	,  LATER 

/ table cost_type kan ik niet drop	,
-there are 3 dependencies

/ 7	. 

/ SCS-3874	, overslaan	, CEVA	,

/ 7	. 

/ SCS-4074	, overslaan	, Naccomfg

/ 7	. 

/ SCS-2703	,  is al	, 
tms-listener-subscriber-schedule-service.xml is niet in deploy/	, 

/ 7	. 

/ SCS-3443	, is al	,

jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/dsvfms$ find deploy/ -name omscarcon-fetch-carcon-events-service.xml
/ GEEN

/ 	7  

/ SCS-3172 , is al	,

SQL> SELECT fd1.SYSTEM_ID as KEEP, fd2.SYSTEM_ID as TO_BE_REMOVED, fd1.NAME 
CON>   FROM FUNCTION_DEFINITION fd1 join FUNCTION_DEFINITION fd2 
CON>   ON fd1.SYSTEM_ID < fd2.SYSTEM_ID and fd1.NAME = fd2.NAME ORDER BY fd1.NAME, fd1.SYSTEM_ID;
SQL> 

/ 7	. 

/ SCS-4577	, WH overslaan	, Postgres

/ 7	. 

/ SCS-4418

/ 7	. 

SQL> select shipment_order_systemid, shipment_item_id from shipment_item where SHIPMENT_ORDER_SYSTEMID=11551839;

SHIPMENT_ORDER_SYSTEMID SHIPMENT_ITEM_ID                                                                 
======================= =============================================================================== 
               11551839 1                                                                                
               11551839 2                                                                                
               11551839 3                                                                                
               11551839 4                                                                                
               11551839 5                                                                                
               11551839 1                                                                                

/ Met sho's shipment_order_id	,
SQL> select sho.system_id, sho.shipment_order_id,shi.system_id, shi.shipment_item_id from shipment_item shi join shipment_order sho on shi.shipment_order_systemid=sho.system_id where sho.system_id=11551839

   SYSTEM_ID SHIPMENT_ORDER_ID                                                                   SYSTEM_ID SHIPMENT_ITEM_ID                                                                 
============ =============================================================================== ============ =============================================================================== 
    11551839 SH001051572                                                                          11551843 1                                                                                
    11551839 SH001051572                                                                          11551844 2                                                                                
    11551839 SH001051572                                                                          11551845 3                                                                                
    11551839 SH001051572                                                                          11551846 4                                                                                
    11551839 SH001051572                                                                          11551847 5                                                                                
    11551839 SH001051572                                                                          11552379 1                                    

SQL>  show table shipment_order;
SYSTEM_ID                       INTEGER Nullable 
SHIPMENT_ORDER_ID               VARCHAR(80) Nullable 


SQL> show table shipment_item;
SYSTEM_ID                       INTEGER Nullable 
SHIPMENT_ITEM_ID                VARCHAR(80) Nullable 
SHIPMENT_ORDER_SYSTEMID         INTEGER Nullable 
ONSTRAINT SI_SHIPMENT_ORDER_FK:
  Foreign key (SHIPMENT_ORDER_SYSTEMID)    References SHIPMENT_ORDER (SYSTEM_ID) On Delete Cascade

/ 7	. 

/ we oefenen zelf	,

drop table shi;
drop table sho;
create table sho(sys_id int,sho_id varchar(32),primary key(sys_id));
create table shi(sys_id int,sho_sysid int, shi_id varchar(32),primary key(sys_id),foreign key(sho_sysid)references sho(sys_id));

insert into sho values(11,11);
insert into sho values(12,12);
insert into sho values(13,13);
insert into shi values(1,11,1);
insert into shi values(2,11,1);
insert into shi values(3,11,1);
insert into shi values(4,12,2);
insert into shi values(5,12,2);
insert into shi values(6,12,2);
insert into shi values(7,12,2);
insert into shi values(8,12,3);
insert into shi values(9,12,3);
insert into shi values(10,13,4);
...

/ 7	.

SQL> select*from shi;

      SYS_ID    SHO_SYSID SHI_ID                           
============ ============ ================================ 
           1           11 1                                
           2           11 1                                
           3           11 1                                
           4           12 2                                
           5           12 2                                
           6           12 2                                
           7           12 2                                
           8           12 3                                
           9           12 3                                
          10           13 4      

SQL> select sho_sysid,shi_id,count(shi_id) from shi group by sho_sysid,shi_id ;
/ of	,
SQL> select sho_sysid,shi_id,count(sho_sysid) from shi group by sho_sysid,shi_id ;


   SHO_SYSID SHI_ID                                  COUNT 
============ ================================ ============ 
          11 1                                           3 
          12 2                                           4 
          12 3                                           2 
          13 4                                           1 

/ we willen weten hoeveel verschillende sho's we zien	, hier 2 dus	, 

SQL> select sho_sysid from shi group by sho_sysid,shi_id  having count(shi_id)>1;

   SHO_SYSID 
============ 
          11 
          12 
          12 

SQL> select count(distinct sho_sysid) from shi group by sho_sysid,shi_id  having count(shi_id)>1;

       COUNT 
============ 
           1 
           1 
           1 
/ Deze is dus NIET OK	,

/ 13	. 

SQL> select shi.sho_sysid,shi.shi_id,count(shi.shi_id) 
	from shi 
	group by shi.sho_sysid,shi.shi_id  
	having count(shi.shi_id)>1;

   SHO_SYSID SHI_ID                                  COUNT 
============ ================================ ============ 
          11 1                                           3 
          12 2                                           4 
          12 3                                           2 

SQL> select sho.* from sho join shi on sho.sys_id=shi.sho_sysid group by shi.sho_sysid,shi.shi_id  having count(shi.shi_id)>1;
/ ERR

SQL> select count from (select shi.sho_sysid,shi.shi_id,count(shi.shi_id) as count from shi group by shi.sho_sysid,shi.shi_id  having count(shi.shi_id)>1);
/ ERR

SQL> select count(distinct sho_sysid) from (select shi.sho_sysid from shi group by shi.sho_sysid,shi.shi_id  having count(shi.shi_id)>1);

       COUNT 
============ 
           2 

/ dus we doen	,

SQL> select count(distinct shipment_order_systemid)from ( select shipment_order_systemid from shipment_item group by shipment_order_systemid, shipment_item_id having count(1)>1);

       COUNT 
============ 
       22404 

SQL> select count( shipment_order_systemid)from ( select shipment_order_systemid from shipment_item group by shipment_order_systemid, shipment_item_id having count(1)>1);

       COUNT 
============ 
       65085 



/  7	. 

SQL> update shi set shi_id=0 where sho_sysid=11;
/ OK, TODO (shi_id is varchar )
SQL> select*from shi;

      SYS_ID    SHO_SYSID SHI_ID                           
============ ============ ================================ 
           1           11 0                                
           2           11 0                                
           3           11 0        

/ WH doet hij de where clause 1 keer	, en de set's iedere keer	, iedere keer treft dus een nieuw max aan	,

update shi 
set shi_id=cast((select max(cast(shi_id as int))from shi where sho_sysid=11)as integer)+1
where sys_id in (select sys_id from shi where sho_sysid=11)  
SQL> select*from shi;

      SYS_ID    SHO_SYSID SHI_ID                           
============ ============ ================================ 
           1           11 1                                
           2           11 2                                
           3           11 3                 


update shi 
set shi_id=cast((select max(cast(shi_id as int))from shi where sho_sysid=12)as integer)+1
where sys_id in (select sys_id from shi where sho_sysid=12)  
/ OK



/ 7	.  


update shipment_item 
set shipment_item_id = 0 
where shipment_order_systemid = ?shipment_order_systemid;

update shipment_item 
set shipment_item_id = CAST( (select max(cast(shipment_item_id as int)) from shipment_item where shipment_order_systemid = ?shipment_order_systemid) AS INTEGER) + 1 
where system_id in ( select SYSTEM_ID from shipment_item where shipment_order_systemid = ?shipment_order_systemid);


/ 7	. 

/ we zien bijv	,

SHIPMENT_ORDER_SYSTEMID SHIPMENT_ITEM_ID                                                                        COUNT 
======================= =============================================================================== ============ 
              109910067 10                                                                                          2 
              109910067 11                                                                                          2 
              109910067 12                                                                                          2 
              109910067 13                                                                                          2 
              109910067 2                                                                                           2 
              109910067 3                                                                                           2 
              109910067 4                                                                                           2 
              109910067 5                                                                                           2 
              109910067 6                                                                                           2 
              109910067 7                                                                                           2 
              109910067 8                                                                                           2 
              109910067 9                                                                                           2 

/ we zien	,

SQL> select sho.system_id, sho.shipment_order_id,shi.system_id, shi.shipment_item_id from shipment_item shi join shipment_order sho on shi.shipment_order_systemid=sho.system_id where sho.system_id=109910067;

   SYSTEM_ID SHIPMENT_ORDER_ID                                                                   SYSTEM_ID SHIPMENT_ITEM_ID                                                                 
============ =============================================================================== ============ =============================================================================== 
   109910067 SH003013332                                                                         109910076 1                                                                                
   109910067 SH003013332                                                                         109910077 2                                                                                
   109910067 SH003013332                                                                         109910078 3                                                                                
   109910067 SH003013332                                                                         109910079 4                                                                                
   109910067 SH003013332                                                                         109910080 5                                                                                
   109910067 SH003013332                                                                         109910081 6                                                                                
   109910067 SH003013332                                                                         109910082 7                                                                                
   109910067 SH003013332                                                                         109910083 8                                                                                
   109910067 SH003013332                                                                         109910084 9                                                                                
   109910067 SH003013332                                                                         109910085 10                                                                               
   109910067 SH003013332                                                                         109910086 11                                                                               
   109910067 SH003013332                                                                         109910087 12                                                                               
   109910067 SH003013332                                                                         109910088 13                                                                               
   109910067 SH003013332                                                                         109910089 14                                                                               
   109910067 SH003013332                                                                         109910090 15                                                                               
   109910067 SH003013332                                                                         109914321 1                                                                                
   109910067 SH003013332                                                                         109914322 2                                                                                
   109910067 SH003013332                                                                         109914323 3                                                                                
   109910067 SH003013332                                                                         109914324 4                                                                                
   109910067 SH003013332                                                                         109914325 5                                                                                
   109910067 SH003013332                                                                         109914326 6                                                                                
   109910067 SH003013332                                                                         109914327 7                                                                                
   109910067 SH003013332                                                                         109914328 8                                                                                
   109910067 SH003013332                                                                         109914329 9                                                                                
   109910067 SH003013332                                                                         109914330 10                                                                               
   109910067 SH003013332                                                                         109914331 11                                                                               
   109910067 SH003013332                                                                         109914332 12                                                                               
   109910067 SH003013332                                                                         109914333 13                                                                               
SQL> select shipment_order_systemid, shipment_item_id, count(1) from shipment_item group by shipment_order_systemid, shipment_item_id having count(1)>1 and shipment_order_systemid in (109867716,109902253);

SHIPMENT_ORDER_SYSTEMID SHIPMENT_ITEM_ID                                                                        COUNT 
======================= =============================================================================== ============ 
              109867716 1                                                                                           2 
              109867716 2                                                                                           2 
              109867716 3                                                                                           2 
              109902253 1                                                                                           6 
              109902253 2                                                                                           3 
              109902253 3                                                                                           2 


SQL> select shipment_order_systemid, shipment_item_id from shipment_item where  shipment_order_systemid=109867716;

SHIPMENT_ORDER_SYSTEMID SHIPMENT_ITEM_ID                                                                 
======================= =============================================================================== 
              109867716 1                                                                                
              109867716 2                                                                                
              109867716 3                                                                                
              109867716 1                                                                                
              109867716 2                                                                                
              109867716 3                                                                                
              109867716 4                 

SHIPMENT_ORDER_SYSTEMID SHIPMENT_ITEM_ID                                                                 
======================= =============================================================================== 
              109902253 1                                                                                
              109902253 2                                                                                
              109902253 3                                                                                
              109902253 1                                                                                
              109902253 1                                                                                
              109902253 2                                                                                
              109902253 1                                                                                
              109902253 1                                                                                
              109902253 1                                                                                
              109902253 2                                                                                
              109902253 3                                                                                
              109902253 4                                                                                
/ 7	. 

/ 13	. 

/ Hoe insert line into file	?

eric@localhost scripts]$ cat foo.sh 
#!/usr/bin/bash
echo "$@"

[eric@localhost scripts]$ awk 'NR==2{print "bar"}{print}' foo.sh 
#!/usr/bin/bash
bar
echo "$@"

/ 13	. 

/ grappig	,

eric@localhost scripts]$ awk 'NR==2{print ""}{print}' <(find -name "*.sh")
./local/def_p2.sh

./local/exec_qt3.sh
./local/def_shi_cp.sh
./local/def_p.sh
...

/ 13	. 

[eric@localhost scripts]$ cp foo.sh bar.sh
[eric@localhost scripts]$ awk 'NR==2{print "bar "}{print}' $(find -maxdepth 1 -name "*.sh")
#!/usr/bin/bash
bar 
echo "$@"
#!/usr/bin/bash
echo "$@"

/ De optie is er NIET	, maar, 	

[eric@localhost scripts]$ for i in $(find -maxdepth 1 -name "*.sh");do awk 'NR==2{print "bar "}{print}' $i >tmp;mv tmp $i;done
[eric@localhost scripts]$ cat foo.sh 
#!/usr/bin/bash
bar 
echo "$@"
[eric@localhost scripts]$ cat bar.sh 
#!/usr/bin/bash
bar 
echo "$@"

/ OK 

/ 13	. 

[eric@localhost scripts]$ cat foo.sh 
#!/usr/bin/bash
echo "../../first.db" 

[eric@localhost scripts]$ for f in $(find -maxdepth 1 -name "*.sh");do awk '{sub("\\.\\./\\.\\.","/home/eric/DB_TAP/Firebird/Local")}{print}' $f >tmp;mv tmp $f;done

[eric@localhost scripts]$ cat foo.sh 
#!/usr/bin/bash
echo "/home/eric/DB_TAP/Firebird/Local/first.db" 

/ 13	. 

[eric@localhost local]$ pwd
/home/eric/Devel/Firebird/scripts/local

[eric@localhost local]$ for f in $(find -maxdepth 1 -name "*.sh");do awk '{sub("\\.\\./\\.\\.","/home/eric/DB_TAP/Firebird/Local")}{print}' $f >tmp;mv tmp $f;done

[eric@localhost local]$ chmod u+x $(find -name "*.sh")

[eric@localhost local]$ ./def_drops2.sh 
[eric@localhost local]$ ./def_p4a.sh 
[eric@localhost local]$ ./exec_p4a.sh 
/ OK

/ 13	. 

$ local-db.sh /home/eric/DB_TAP/Firebird/Dsvfms/dsvfms.fdb_20151019-000019_cp.fdb 

/ See FIREBIRD PROCEDURES , SAMENVATTING


/ 7	.

/ SCS-2286, done	,

jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/dsvfms$ sha1sum lib/shiftone-cache-mpo.jar 
e6b2ce4d80ea53f86ee858af2c07a6565d448530  lib/shiftone-cache-mpo.jar

/ 7	.

/ SCS-2272	, overslaan	,

/ 7	. 

/ SCS-4418	, LATER

/ 7	. 

/ SCS-2286, is al	,

jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/dsvfms$ sha1sum ./lib/shiftone-cache-mpo.jar
e6b2ce4d80ea53f86ee858af2c07a6565d448530  ./lib/shiftone-cache-mpo.jar

/ 7	. 

/ SCS-2272	, overslaan , = CEVA

/ 7	. 

/ SCS-2694, done

[eric@localhost bin]$ dsvfms-scp-t.sh ~/Downloads/catalina.jar 

/ eric scp to /tmp, of /home/INTERNAL/eric. The permissions of /tmp/catalina.jar are -rw-------	. 
/ catalina.jar heeft toevallig geen r bij other	, dus -rw-r--r--	 bijv	,
/ de jar's uit lib/  hebben wel -rw-r--r--	, dus kunnen we naar ~eric scp	,  en jboss kan ze cp naar dsvfms/lib	,
eric$ chown o+r catalina.jar
eric$ sudo su - jboss
jboss$ cp /tmp/catalina.jar /local/apps/jboss-4.0.5.GA/server/dsvfms/deploy/jbossweb-tomcat55.sar/
/ OK
/ als eric NIET chown	, dan kan jboss de file niet lezen	, en dan Permission error	,

jboss@mposerv11:~$ sha1sum /local/apps/jboss-4.0.5.GA/server/dsvfms/deploy/jbossweb-tomcat55.sar/catalina.jar 
bf6753ec68008553083e5d023d7f25daa22ceea0  /local/apps/jboss-4.0.5.GA/server/dsvfms/deploy/jbossweb-tomcat55.sar/catalina.jar

/ 7	. 

/ SCS-4534	, done

/ edit deploy/firebird-ds.xml


/ 7	. 

/ SCS-4740	, overslaan (is voor dsvcts)	,

/ 7	. 

/ SCS-4799, overslaan, (is voor pnllogistics)	,

/ 7	. 

/ SCS-4848	, overslaan (is niet voor dsvfms)	,

/ 7	. 

/ Lees	,
https://system.mp-objects.com/xwiki/bin/view/Technology/ReleaseTODOList
/ TODO

/ 7	. 

/ build in Jenkins	,

jboss@mposerv11:~/releases$ curl -u eric -O https://system.mp-objects.com/jenkins/job/SCS-OnDemand/3263/artifact/dist/tms-dsvfms-21224-2015.03_build3263.zip
jboss@mposerv11:~/releases$ deploy-dsvfms.sh /local/apps/releases/tms-dsvfms-21224-2015.03_build3263.zip /local/apps/jboss-4.0.5.GA/server/dsvfms/
$ dsvfms start track

jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/dsvfms$ vi log/server.log
2015-10-13 15:28:51,589 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)    MUST_BE_REMOVED : activeio-core-3.1.2.jar
2015-10-13 15:28:51,589 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : activeio-core-3.1.4.jar
2015-10-13 15:28:51,590 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : activemq-broker-5.10.2.jar
2015-10-13 15:28:51,590 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : activemq-client-5.10.2.jar
2015-10-13 15:28:51,590 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)    MUST_BE_REMOVED : activemq-core-5.3.0.jar
2015-10-13 15:28:51,590 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)            MISSING : activemq-kahadb-store-5.10.2.jar
...

/ HIER HIER HIER

/ we copy server.log naar laotop	,
[eric@localhost bin]$ cat dsvfms-scp-from-t.sh 
#!/bin/bash
echo "Eric789@MPO" 
scp eric@mposerv11:/local/apps/jboss-4.0.5.GA/server/dsvfms/"$@" ~eric/Downloads

/ 13	. 

/ rm jars op mposerv11	,

/ Lees	,
http://www.cyberciti.biz/tips/linux-running-commands-on-a-remote-host.html
/ TODO

[eric@localhost bin]$ dsvfms-exec-t.sh "cd //local/apps/jboss-4.0.5.GA/server/dsvfms;echo $( awk '/MUST_BE_REMOVED/ && /.jar/{print $8}' ~/Downloads/server.log )"
/ server.log locally?
/ TODO

/ op laptop	,
[eric@localhost bin]$ echo $( awk '/MUST_BE_REMOVED/ && /.jar/{print $8}' ~/Downloads/server.log )
activeio-core-3.1.2.jar activemq-core-5.3.0.jar activemq-pool-5.3.0.jar activemq-ra-5.3.0.jar antlr.jar aspectjrt.jar aspectjweaver.jar bcprov-jdk16-139.jar commons-codec-1.4.jar commons-io.jar commons-lang-2.4.jar commons-pool.jar ehcache-1.5.0.jar hibernate-annotations.jar hibernate3.jar javassist.jar joda-time-2.2.jar joda-time-hibernate-1.2.jar postgresql-9.2-1003.jdbc4.jar quartz-1.6.0.jar slf4j-api-1.4.2.jar slf4j-log4j12-1.4.2.jar spring-agent.jar spring-aop.jar spring-aspects.jar spring-beans.jar spring-context-support.jar spring-context.jar spring-core.jar spring-jdbc.jar spring-jms_mpo.jar spring-orm.jar spring-test.jar spring-tomcat-weaver.jar spring-tx.jar spring-web.jar spring-webmvc-portlet.jar spring-webmvc.jar wicket-1.4.19.jar wicket-auth-roles-1.4.19.jar wicket-datetime-1.4.19.jar wicket-devutils-1.4.19.jar wicket-extensions-1.4.19.jar wicket-spring-1.4.19.jar wiquery-1.2.3.jar

/ op mposerv11	,
jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/dsvfms/lib$ rm -f activeio-core-3.1.2.jar activemq-core-5.3.0.jar activemq-pool-5.3.0.jar activemq-ra-5.3.0.jar antlr.jar aspectjrt.jar aspectjweaver.jar bcprov-jdk16-139.jar commons-codec-1.4.jar commons-io.jar commons-lang-2.4.jar commons-pool.jar ehcache-1.5.0.jar hibernate-annotations.jar hibernate3.jar javassist.jar joda-time-2.2.jar joda-time-hibernate-1.2.jar postgresql-9.2-1003.jdbc4.jar quartz-1.6.0.jar slf4j-api-1.4.2.jar slf4j-log4j12-1.4.2.jar spring-agent.jar spring-aop.jar spring-aspects.jar spring-beans.jar spring-context-support.jar spring-context.jar spring-core.jar spring-jdbc.jar spring-jms_mpo.jar spring-orm.jar spring-test.jar spring-tomcat-weaver.jar spring-tx.jar spring-web.jar spring-webmvc-portlet.jar spring-webmvc.jar wicket-1.4.19.jar wicket-auth-roles-1.4.19.jar wicket-datetime-1.4.19.jar wicket-devutils-1.4.19.jar wicket-extensions-1.4.19.jar wicket-spring-1.4.19.jar wiquery-1.2.3.jar

/ 13	. 

/ add jars to mposerv11 ,


[eric@localhost bin]$ dsvfms-scp-from-t.sh log/server.log

eric@mposerv11:~$ rm $(find -maxdepth 1 -name "*.jar")
$ mkdir Downloads
[eric@localhost bin]$ (cd /home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnllogistics/lib;dsvfms-scp-to-t.sh $(awk '/MISSING/ && /.jar/{print $8}' ~/Downloads/server.log )) 
Eric789@MPO

/ we keken in de verkeerde dir	, pnllogistics	, 
/ beter is in de svn checkout te kijken	, in ./base-framework/core/lib/jar	, 
/ in trunk is bijv niet hibernate3.6.10.mpo.1.jar	,

[eric@localhost bin]$ (cd /home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/2015.03/./base-framework/core/lib/jar; awk '/MISSING/ && /.jar/{print $8}' ~/Downloads/server.log) 
...
hibernate3.6.10.mpo.1.jar
...

/ Op mopserv11	,
eric@mposerv11:~$ ls Downloads/
activeio-core-3.1.4.jar                jackson-annotations-2.6.0.jar              spring-core-3.2.14.RELEASE.jar
activemq-broker-5.10.2.jar             jackson-core-2.6.0.jar                     spring-expression-3.2.14.RELEASE.jar
activemq-client-5.10.2.jar             jackson-databind-2.6.0.jar                 spring-jdbc-3.2.14.RELEASE.jar
activemq-kahadb-store-5.10.2.jar       javassist-3.12.0.GA.jar                    spring-jms-3.2.14.RELEASE.jar
activemq-openwire-legacy-5.10.2.jar    joda-time-2.3.jar                          spring-orm-3.2.14.RELEASE.jar
activemq-protobuf-1.1.jar              joda-time-hibernate-1.3.jar                spring-security-config-3.2.8.RELEASE.jar
activemq-spring-5.10.2.jar             jta-1.1.jar                                spring-security-core-3.2.8.RELEASE.jar
antlr-2.7.6.jar                        kahadb-5.3.0.jar                           spring-security-saml2-core-1.0.1.RELEASE.jar
aspectjweaver-1.7.4.jar                not-yet-commons-ssl-0.3.9.jar              spring-security-web-3.2.8.RELEASE.jar
bcprov-jdk15on-1.52.jar                opensaml-2.6.1.jar                         spring-test-3.2.14.RELEASE.jar
commons-codec-1.9.jar                  openws-1.5.1.jar                           spring-tx-3.2.14.RELEASE.jar
commons-csv-1.1.jar                    postgresql-9.4-1200.jdbc4.jar              spring-web-3.2.14.RELEASE.jar
commons-io-2.4.jar                     quartz-1.8.6.jar                           velocity-1.7.jar
commons-lang-2.6.jar                   rtcalltree-0.1.0-SNAPSHOT.jar              wicket-1.4.23.jar
commons-lang3-3.3.2.jar                slf4j-api-1.6.1.jar                        wicket-auth-roles-1.4.23.jar
commons-pool-1.5.7.jar                 slf4j-log4j12-1.6.1.jar                    wicket-datetime-1.4.23.jar
disruptor-3.3.0.jar                    spring-aop-3.2.14.RELEASE.jar              wicket-extensions-1.4.23.jar
ehcache-2.10.0.jar                     spring-aspects-3.2.14.RELEASE.jar          wiquery-1.2.3.2-20150604.122120-1.jar
esapi-2.0.1.jar                        spring-beans-3.2.14.RELEASE.jar            xbean-spring-3.18.jar
hawtbuf-1.10.jar                       spring-context-3.2.14.RELEASE.jar          xmlsec-1.5.6.jar
hibernate-jpa-2.0-api-1.0.0.Final.jar  spring-context-support-3.2.14.RELEASE.jar  xmltooling-1.4.1.jar

jboss@mposerv11:/home/INTERNAL/eric/Downloads$ cp $(find -maxdepth 1 -name "*.jar" ) /local/apps/jboss-4.0.5.GA/server/dsvfms/lib

/we repair,	
/ op laptop	,
[eric@localhost 2015.03]$ dsvfms-scp-to-t.sh $(find -name hibernate3.6.10.mpo.1.jar) 
/ op mposerv11	,
jboss@mposerv11:/home/INTERNAL/eric/Downloads$ cp hibernate3.6.10.mpo.1.jar /local/apps/jboss-4.0.5.GA/server/dsvfms/lib




/ 7	. 

/ we start deploy	, en have patch errors	, 

/ we kunnen ze lezen in de mpo_scs_patch table,	 of in de svn chechout	,

[eric@localhost patch]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/2015.03/module/oms/src/sql/patch

/ 7	.  

/ PATCH-364-FIX-PARTY-ORG-FK.SQL

/ Insert een aantal rijen in organization table	, zodat we een fk kunnen maken in de party table	, 
/ er zijn in party table rijen met organization_systemid , die geen system_id's zijn in de organization table	, 

$ vi patch-364-fix-party-org-fk.sql

insert into organization
select organization_systemid, 'DO_NOT_USE_' || organization_systemid, 'Dummy organization to fix foreign key problem', 0,1,null
from PARTY 
where ORGANIZATION_SYSTEMID not in (
	select SYSTEM_ID 
	from ORGANIZATION) 
group by organization_systemid;

SQL> show table organization;
SYSTEM_ID                       INTEGER Nullable 
ORGANIZATION_ID                 VARCHAR(20) Nullable 
DESCRIPTION                     VARCHAR(100) Nullable 
AUTOM_RATE_CALC                 SMALLINT Nullable DEFAULT 0
IS_DELETED                      SMALLINT Not Null DEFAULT 0
ORGANIZATION_GROUP              INTEGER Nullable 
SEQUENCE                        INTEGER Not Null DEFAULT 0
CONSTRAINT FK_ORGANIZATION_ORG_GROUP:
  Foreign key (ORGANIZATION_GROUP)    References ORGANIZATION (SYSTEM_ID)
CONSTRAINT ORGANIZATION_PK:
  Primary key (SYSTEM_ID)
CONSTRAINT ORGANIZATION_UK:
  Unique key (ORGANIZATION_ID)

jdbc:firebirdsql://192.168.1.8/local/apps/firebird/dsvfms.fdb

jdbc:firebirdsql://127.0.0.1//home/eric/Devel/Dsvfms/dsvfms.fdb

/ we oefenen	,


/ 1313	,

select organization_systemid
from PARTY 
where ORGANIZATION_SYSTEMID not in (
	select SYSTEM_ID 
	from ORGANIZATION) 
group by organization_systemid;
/=
select distinct organization_systemid
from PARTY 
where ORGANIZATION_SYSTEMID not in (
	select SYSTEM_ID 
	from ORGANIZATION) 

ORGANIZATION_SYSTEMID 
===================== 
                  300 
                  400 
                 3000 
                 3010 
                 3020 
                 3050 
                 3060 
                 3070 
                 3080 
                 3160 
                 3170 

/ 1313	.

/ Inderdaad	,

SQL>  select count(*) from organization where system_id=300;

       COUNT 
============ 
           0 
 

/ 1313	. 

select organization_systemid,count(organization_systemid)
from PARTY 
where ORGANIZATION_SYSTEMID not in (
	select SYSTEM_ID 
	from ORGANIZATION) 
group by organization_systemid

ORGANIZATION_SYSTEMID        COUNT 
===================== ============ 
                  300            3 
                  400            1 
                 3000           23 
                 3010          271 
                 3020          108 
                 3050           30 
                 3060           42 
                 3070           28 
                 3080           12 
                 3160           10 
                 3170           12 

/ 1313	.

select organization_systemid, 'DO_NOT_USE_' || organization_systemid, 'Dummy organization to fix foreign key problem', 0,1,null
from PARTY 
where ORGANIZATION_SYSTEMID not in (
	select SYSTEM_ID 
	from ORGANIZATION) 
group by organization_systemid;

ORGANIZATION_SYSTEMID CONCATENATION          CONSTANT                                          CONSTANT     CONSTANT CONSTANT 
===================== ====================== ============================================= ============ ============ ======== 
                  300 DO_NOT_USE_300         Dummy organization to fix foreign key problem            0            1 <null>   
                  400 DO_NOT_USE_400         Dummy organization to fix foreign key problem            0            1 <null>   
                 3000 DO_NOT_USE_3000        Dummy organization to fix foreign key problem            0            1 <null>   
                 3010 DO_NOT_USE_3010        Dummy organization to fix foreign key problem            0            1 <null>   
                 3020 DO_NOT_USE_3020        Dummy organization to fix foreign key problem            0            1 <null>   
                 3050 DO_NOT_USE_3050        Dummy organization to fix foreign key problem            0            1 <null>   
                 3060 DO_NOT_USE_3060        Dummy organization to fix foreign key problem            0            1 <null>   
                 3070 DO_NOT_USE_3070        Dummy organization to fix foreign key problem            0            1 <null>   
                 3080 DO_NOT_USE_3080        Dummy organization to fix foreign key problem            0            1 <null>   
                 3160 DO_NOT_USE_3160        Dummy organization to fix foreign key problem            0            1 <null>   
                 3170 DO_NOT_USE_3170        Dummy organization to fix foreign key problem            0            1 <null>   

/ 1313	. 

SQL> show table sql_script;
There is no table SQL_SCRIPT in this database
SQL> show table  mpo_scs_patch;
SYSTEM_ID                       INTEGER Not Null 
ENTRY_DATE                      TIMESTAMP Not Null 
MODULE                          VARCHAR(128) Not Null 
NAME                            VARCHAR(128) Not Null 
SQL_SCRIPT                      BLOB segment 80, subtype TEXT Not Null 
STATUS                          VARCHAR(32) Not Null 
PATCH_COMMENT                   VARCHAR(255) Nullable 
CONSTRAINT PK_MPO_SCS_PATCHES:
  Primary key (MODULE, NAME)

/ Daarom ziet er het raar uit	,

SQL> select sql_script from mpo_scs_patch where name='patch-364-fix-party-org-fk.sql';

       SQL_SCRIPT 
================= 
         140:db69 
==============================================================================
SQL_SCRIPT:  
/* This patch fixes the missing foreign key on organization for parties */
insert into organization
select organization_systemid, 'DO_NOT_USE_' || organization_systemid, 'Dummy organization to fix foreign key problem', 0,1,null
from PARTY where ORGANIZATION_SYSTEMID not in (select SYSTEM_ID from ORGANIZATION) group by organization_systemid;

ALTER TABLE PARTY ADD CONSTRAINT PARTY_ORG_FK FOREIGN KEY (ORGANIZATION_SYSTEMID) REFERENCES ORGANIZATION (SYSTEM_ID);

/ TODO

/ 1313	. 

/ In source	,
$ vi base-framework/core/src/java/com/mpobjects/dbpatch/PatchStatus.java

    APPLIED,
    FAILED,
    MANUALLY_APPLIED,
    NOT_APPLIED,
    SKIPPED,
    UNKNOWN;


/ AD FIX patch-364-fix-party-org-fk.sql

/ organization heeft extra column sequance	,

SQL> show table organization;
SYSTEM_ID                       INTEGER Nullable 
ORGANIZATION_ID                 VARCHAR(20) Nullable 
DESCRIPTION                     VARCHAR(100) Nullable 
AUTOM_RATE_CALC                 SMALLINT Nullable DEFAULT 0
IS_DELETED                      SMALLINT Not Null DEFAULT 0
ORGANIZATION_GROUP              INTEGER Nullable 
SEQUENCE                        INTEGER Not Null DEFAULT 0
CONSTRAINT FK_ORGANIZATION_ORG_GROUP:
  Foreign key (ORGANIZATION_GROUP)    References ORGANIZATION (SYSTEM_ID)
CONSTRAINT ORGANIZATION_PK:
  Primary key (SYSTEM_ID)
CONSTRAINT ORGANIZATION_UK:
  Unique key (ORGANIZATION_ID)

SQL> select  sequence from organization group by sequence;

    SEQUENCE 
============ 
           0 

/ insert dus een extra column 0	, 

/ we doen	,

insert into organization
select organization_systemid, 'DO_NOT_USE_' || organization_systemid, 'Dummy organization to fix foreign key problem', 0,1,null,0
from PARTY 
where ORGANIZATION_SYSTEMID not in (
	select SYSTEM_ID 
	from ORGANIZATION)
group by organization_systemid;
commit;

ALTER TABLE PARTY ADD CONSTRAINT PARTY_ORG_FK FOREIGN KEY (ORGANIZATION_SYSTEMID) REFERENCES ORGANIZATION (SYSTEM_ID);
commit;
/ TODO



/ Einde AD FIX patch-364-fix-party-org-fk.sql

/ 1313	.

/ we oefenen	, voor commit	,

/ we hebben in laptop's ... x en xref table,	 

SQL> alter table xref drop constraint INTEG_20;
SQL> insert into xref values (4,13);
SQL> alter table xref add constraint fk_r foreign key(r) references x(i);
Statement failed, SQLSTATE = 40001
lock conflict on no wait transaction
-unsuccessful metadata update
-object XREF is in use
SQL>  commit;
SQL> alter table xref add constraint fk_r foreign key(r) references x(i);
/ OK

/ Einde PATCH-364-FIX-PARTY-ORG-FK.SQL

/ AFTER PATCH-364-FIX-PARTY-ORG-FK.SQL

/ 13	. 

/ Eerder (TODO) heeft een patch de column sequence add aan de organization table	,

[eric@localhost 2015.03]$ grep -i "alter table organization" <(grep -i sequence $( find -name "patch*sql"))
./module/oms/src/sql/patch/patch-391-org-sequence.sql:ALTER TABLE ORGANIZATION ADD SEQUENCE integer DEFAULT 0 NOT NULL;

/ 13	. 

/ we edit de patch 	, 
/ we noemen de columns explicit
/ we add een 0 in de sequence column	,

$ vi ./module/oms/src/sql/patch/patch-364-fix-party-org-fk.sql

insert into organization(system_id,organization_id,description,autom_rate_calc,is_deleted,organization_group,sequence)
select organization_systemid, 'DO_NOT_USE_' || organization_systemid, 'Dummy organization to fix foreign key problem', 0,1,null,0
from PARTY 
where ORGANIZATION_SYSTEMID not in ( 
    select SYSTEM_ID  
    from ORGANIZATION)
group by organization_systemid;


/ 13	. 

/ patch-475-org-edi-identifier.sql heeft adds later nog een column aan organization	,

alter table organization add edi_identifier varchar(255);

/ Einde AFTER PATCH-364-FIX-PARTY-ORG-FK.SQL








/ 7	. 

/ we doen opnieuw	,
jboss@mposerv11:/home/INTERNAL/eric/Downloads$ dsvfms start track

/ zoek in de server.log naar 'Executing patch'	,

$ less log/server.log
...
  9555 2015-10-14 12:59:13,506 INFO  [com.mpobjects.dbpatch.DataBasePatcher] (main:) Executing patch [oms/patch-389_productid_unique_constraint_d
   9555 rop.sql] ...
   9556 2015-10-14 12:59:13,538 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) Problem while executing SQL statement in patch [oms/patch-38
   9556 9_productid_unique_constraint_drop.sql]: 
   9557 2015-10-14 12:59:13,538 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) alter table product drop constraint PRODUCTID_UK
   9558 2015-10-14 12:59:13,538 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) org.firebirdsql.jdbc.FBSQLException: GDS Exception. 33554435
   9558 1. unsuccessful metadata update
   9559 CONSTRAINT PRODUCTID_UK does not exist.

/ PATCH-389_PRODUCTID_UNIQUE_CONSTRAINT_DROP.SQL

SQL>  select sql_script,status,name  from mpo_scs_patch where name like '%patch-389_produc%';

       SQL_SCRIPT STATUS                           NAME                                                                                                                             
================= ================================ =============================================================================== 
        140:140ab FAILED                           patch-389_productid_unique_constraint_drop.sql                                                                                   
==============================================================================
SQL_SCRIPT:  
alter table product drop constraint PRODUCTID_UK;

/ Waarom?

SQL> select name, sql_script,module from mpo_scs_patch where sql_script like '%PRODUCTID_UK%';

NAME                                                                                                                                    SQL_SCRIPT MODULE                                                                                                                           
=============================================================================== ================= =============================================================================== 
patch-253-product-uniqueproductid.sql                                                                                                     140:30c6 oms                                                                                                                              
==============================================================================
SQL_SCRIPT:  
--to apply unique constraint, Run the below delete query if there are any duplicate productids
--delete from product where productid in (SELECT PRODUCTID FROM product GROUP BY PRODUCTID HAVING COUNT(PRODUCTID) > 1);
ALTER TABLE PRODUCT ADD CONSTRAINT PRODUCTID_UK  UNIQUE (PRODUCTID);
==============================================================================
patch-012_productid_unique_constraint_drop.sql                                                                                            140:5644 dsvfms                                                                                                                           
==============================================================================
SQL_SCRIPT:  
alter table product drop constraint PRODUCTID_UK;
==============================================================================
patch-389_productid_unique_constraint_drop.sql                                                                                           140:140ab oms                                                                                                                              
==============================================================================
SQL_SCRIPT:  
alter table product drop constraint PRODUCTID_UK;
==============================================================================

/ Ook	, 

SQL>    select system_id,entry_date,module,name,status from mpo_scs_patch where name in ('patch-012_productid_unique_constraint_drop.sql','patch-253-product-uniqueproductid.sql','patch-389_productid_unique_constraint_drop.sql');

   SYSTEM_ID                ENTRY_DATE MODULE                                                                                                                           NAME                                                                                                                             STATUS                           
============ ========================= =============================================================================== =============================================================================== ================================ 
         291 2012-09-08 10:04:51.4960  oms                                                                                                                              patch-253-product-uniqueproductid.sql                                                                                            APPLIED                          
         465 2012-09-08 10:04:52.3810  dsvfms                                                                                                                           patch-012_productid_unique_constraint_drop.sql                                                                                   APPLIED                          
         782 2015-10-14 12:48:04.2870  oms                                                                                                                              patch-389_productid_unique_constraint_drop.sql                                                                                   FAILED       

/ Dus WH is eerst  patch-253 gedaan	, die de constraint add	, en dan patch-012, die de constraint rm	, 

/ en dan patch-389, die hem opnieuw wilt rm	, en dat gaat dan fout	,

SQL> update mpo_scs_patch set status='SKIPPED' where name='patch-389_productid_unique_constraint_drop.sql';
SQL> commit;


/ 13	.

/ Of in fs	,

[eric@localhost 2015.03]$ grep PRODUCTID_UK  $(find $(find -name patch) -name "*sql" )
./dsvfms/dsvfms/src/sql/patch/patch-012_productid_unique_constraint_drop.sql:alter table product drop constraint PRODUCTID_UK;
./module/oms/src/sql/patch/patch-253-product-uniqueproductid.sql:ALTER TABLE PRODUCT ADD CONSTRAINT PRODUCTID_UK  UNIQUE (PRODUCTID);
./module/oms/src/sql/patch/patch-389_productid_unique_constraint_drop.sql:alter table product drop constraint PRODUCTID_UK;
grep: ./module/oms/src/sql/patch/patch-281_Create: No such file or directory
grep: Document_Type.sql: No such file or directory

/ Geef in google	,
linux find how to escape spaces in filenames

/ NB	.

[eric@localhost 2015.03]$ vi module/oms/src/sql/patch/patch-281_Create\ Document_Type.sql 

/ Lees	,
http://askubuntu.com/questions/343727/filenames-with-spaces-breaking-for-loop-find-command

while read -rd $'\0' file; do
    something with "$file"
done < <(find  . -type f -name '*.*' -print0)

This should handle any filenames that are POSIX-compliant - see man find

   -print0
          True; print the full file name on the standard output, followed by a null character (instead of the newline character that  -print  uses).   This  allows  file
          names that contain newlines or other types of white space to be correctly interpreted by programs that process the find output.  This option corresponds to the
          -0 option of xargs.

/ TODO < <(...)

/ TODO -print0

/ Lees	,
http://superuser.com/questions/409818/how-do-i-parse-the-output-of-the-find-command-when-filenames-have-spaces-in-them

/ Lees	,
http://unix.stackexchange.com/questions/81349/how-do-i-use-find-when-the-filename-contains-spaces

You must combine find and xargs:
find . -type f -print0 | xargs -0 <command>

/ Inderdaad	,

[eric@localhost 2015.03]$ find $(find -name patch) -name "*sql" -print0 | xargs -0 grep PRODUCTID_UK
./dsvfms/dsvfms/src/sql/patch/patch-012_productid_unique_constraint_drop.sql:alter table product drop constraint PRODUCTID_UK;
./module/oms/src/sql/patch/patch-253-product-uniqueproductid.sql:ALTER TABLE PRODUCT ADD CONSTRAINT PRODUCTID_UK  UNIQUE (PRODUCTID);
./module/oms/src/sql/patch/patch-389_productid_unique_constraint_drop.sql:alter table product drop constraint PRODUCTID_UK;

/ Einde PATCH-389_PRODUCTID_UNIQUE_CONSTRAINT_DROP.SQL

/ 7	. 

jboss@mposerv11:/home/INTERNAL/eric/Downloads$ dsvfms start track
2015-10-14 14:03:25,588 INFO  [com.mpobjects.dbpatch.DataBasePatcher] (main:) Executing patch [oms/patch-390-customer-order-line-detail.sql] ...
2015-10-14 14:03:25,760 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) Problem while executing SQL statement in patch [oms/patch-390-custome
r-order-line-detail.sql]: 
2015-10-14 14:03:25,760 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) ALTER TABLE CUSTOMER_ORDER_LINE ADD CONSTRAINT CUSTOMER_ORDER_LINE_PK
 PRIMARY KEY (SYSTEM_ID)
2015-10-14 14:03:25,760 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) org.firebirdsql.jdbc.FBSQLException: GDS Exception. 335544351. unsucc
essful metadata update
STORE RDB$RELATION_CONSTRAINTS failed
null
null
action cancelled by trigger (3) to preserve data integrity
Attempt to define a second PRIMARY KEY for the same table

/ 7	. 

/ we hadden 	,
eric@mposerv8:~$ gbak -rep -user sysdba -password masterkey dsvfms.fdb_20151005-003448.fbk localhost://local/apps/firebird/dsvfms2.fdb

/ we connect ook met deze db server	,

[eric@localhost bin]$ cat dsvfms-db2-t.sh 
#!/bin/bash
isql-fb -u sysdba -p masterkey mposerv8:/local/apps/firebird/dsvfms2.fdb



/ PATCH-390-CUSTOMER-ORDER-LINE-DETAIL.SQL

/ De msg uit de log	staat ook in de row in de database	,

SQL>    select *from mpo_scs_patch where name in ('patch-390-customer-order-line-detail.sql');

   SYSTEM_ID                ENTRY_DATE MODULE                                                                                                                           NAME                                                                                                                                    SQL_SCRIPT STATUS                           PATCH_COMMENT                                                                                                                                                                                                                                                   
============ ========================= =============================================================================== =============================================================================== ================= ================================ =============================================================================== 
         783 2015-10-14 14:03:18.0470  oms                                                                                                                              patch-390-customer-order-line-detail.sql                                                                                                 140:17164 FAILED                           org.firebirdsql.jdbc.FBSQLException: GDS Exception. 335544351. unsuccessful metadata update
STORE RDB$RELATION_CONSTRAINTS failed
null
null
action cancelled by trigger (3) to preserve data integrity
Attempt to define a second PRIMARY KEY for the same      
==============================================================================
SQL_SCRIPT:  
CREATE TABLE CUSTOMER_ORDER_LINE_DETAIL
(
   ENTITY_SYSTEMID integer NOT NULL,
   EDT_SYSTEMID integer NOT NULL,
   FIELD_VALUE varchar(255),
   CONSTRAINT PK_CUSTOMER_ORDER_LINE_DETAIL PRIMARY KEY (ENTITY_SYSTEMID, EDT_SYSTEMID)
);

ALTER TABLE CUSTOMER_ORDER_LINE ADD CONSTRAINT CUSTOMER_ORDER_LINE_PK PRIMARY KEY (SYSTEM_ID);

ALTER TABLE CUSTOMER_ORDER_LINE_DETAIL ADD CONSTRAINT COLD_COL_FK FOREIGN KEY (ENTITY_SYSTEMID) REFERENCES CUSTOMER_ORDER_LINE (SYSTEM_ID);
ALTER TABLE CUSTOMER_ORDER_LINE_DETAIL ADD CONSTRAINT COLD_EDT_FK FOREIGN KEY (EDT_SYSTEMID) REFERENCES ENTITY_DETAIL_TYPE (SYSTEM_ID);
==============================================================================

/ we zien in de regulier row: 140:17164	, dit is de blog id	, 
/ de content staat eronder	,

/ 13	. 

/ we doen	,

SQL> select system_id,name, sql_script,module,status from mpo_scs_patch where sql_script like '%CUSTOMER_ORDER_LINE%PRIMARY KEY%';

   SYSTEM_ID NAME                                                                                                                                    SQL_SCRIPT MODULE                                                                                                                           STATUS                           
============ =============================================================================== ================= =============================================================================== ================================ 
         279 patch-244-customerorder.sql                                                                                                               140:2ee7 oms                                                                                                                              APPLIED                          
==============================================================================
SQL_SCRIPT:  
CREATE TABLE CUSTOMER_ORDER(SYSTEM_ID integer PRIMARY KEY NOT NULL,
CUSTOMER_ORDER_NUMBER varchar(100) UNIQUE NOT NULL,
SOLD_TO_PARTY_SYSTEMID INTEGER NOT NULL
);
ALTER TABLE CUSTOMER_ORDER ADD CONSTRAINT CO_PARTY_FK FOREIGN KEY (SOLD_TO_PARTY_SYSTEMID) REFERENCES PARTY(SYSTEM_ID);


CREATE TABLE CUSTOMER_ORDER_LINE (
SYSTEM_ID INTEGER PRIMARY KEY NOT NULL,
QUANTITY FLOAT,
BILL_TO_PARTY_SYSTEMID INTEGER,
FROM_PARTY_SYSTEMID INTEGER,
TO_PARTY_SYSTEMID INTEGER,
PRODUCT_SYSTEMID integer,
REQUESTED_START_AFTER TIMESTAMP,
REQUESTED_START_BEFORE TIMESTAMP,
REQUESTED_END_AFTER TIMESTAMP,
REQUESTED_END_BEFORE TIMESTAMP
);



==============================================================================
         461 patch-008_migration-fms-to-netapp.sql                                                                                                     140:5463 dsvfms                                                                                                                           APPLIED                          
==============================================================================
SQL_SCRIPT:  
/* Script to convert the current customer order data for FMS, which is stored in product items
Organization: 'DSV-NL-MDK'
*/
...
==============================================================================
         783 patch-390-customer-order-line-detail.sql                                                                                                 140:17164 oms                                                                                                                              FAILED                           
==============================================================================
SQL_SCRIPT:  
CREATE TABLE CUSTOMER_ORDER_LINE_DETAIL
(
   ENTITY_SYSTEMID integer NOT NULL,
   EDT_SYSTEMID integer NOT NULL,
   FIELD_VALUE varchar(255),
   CONSTRAINT PK_CUSTOMER_ORDER_LINE_DETAIL PRIMARY KEY (ENTITY_SYSTEMID, EDT_SYSTEMID)
);

ALTER TABLE CUSTOMER_ORDER_LINE ADD CONSTRAINT CUSTOMER_ORDER_LINE_PK PRIMARY KEY (SYSTEM_ID);

ALTER TABLE CUSTOMER_ORDER_LINE_DETAIL ADD CONSTRAINT COLD_COL_FK FOREIGN KEY (ENTITY_SYSTEMID) REFERENCES CUSTOMER_ORDER_LINE (SYSTEM_ID);
ALTER TABLE CUSTOMER_ORDER_LINE_DETAIL ADD CONSTRAINT COLD_EDT_FK FOREIGN KEY (EDT_SYSTEMID) REFERENCES ENTITY_DETAIL_TYPE (SYSTEM_ID);

/ 13	.

/ wat er fout gaat is dat er opnieuw een primary key wordt def op customer_order_line	, 
/ de customer_order_line_datail table is created	, 
/ we doen dus met de hand	,

drop table customer_order_line_detail;
/ Nu even, 

CREATE TABLE CUSTOMER_ORDER_LINE_DETAIL
(
   ENTITY_SYSTEMID integer NOT NULL,
   EDT_SYSTEMID integer NOT NULL,
   FIELD_VALUE varchar(255),
   CONSTRAINT PK_CUSTOMER_ORDER_LINE_DETAIL PRIMARY KEY (ENTITY_SYSTEMID, EDT_SYSTEMID)
);

ALTER TABLE CUSTOMER_ORDER_LINE_DETAIL 
ADD CONSTRAINT COLD_COL_FK FOREIGN KEY (ENTITY_SYSTEMID) REFERENCES CUSTOMER_ORDER_LINE (SYSTEM_ID);
ALTER TABLE CUSTOMER_ORDER_LINE_DETAIL 
ADD CONSTRAINT COLD_EDT_FK FOREIGN KEY (EDT_SYSTEMID) REFERENCES ENTITY_DETAIL_TYPE (SYSTEM_ID);

SQL> update  mpo_scs_patch set status='MANUALLY_APPLIED' where name='patch-390-customer-order-line-detail.sql';
SQL> commit;

/ Einde PATCH-390-CUSTOMER-ORDER-LINE-DETAIL.SQL

/ 7	. 

jboss@mposerv11:/home/INTERNAL/eric/Downloads$ dsvfms start track

2015-10-14 14:55:48,492 INFO  [com.mpobjects.dbpatch.DataBasePatcher] (main:) Executing patch [oms/patch-396-shi_shoid_uk.sql] ...
2015-10-14 14:55:48,558 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) Problem while executing SQL statement in patch [oms/patch-396-shi_sho
id_uk.sql]: 
2015-10-14 14:55:48,558 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) alter table SHIPMENT_ITEM
add constraint SHI_ID_SHO_UK
unique (SHIPMENT_ORDER_SYSTEMID, SHIPMENT_ITEM_ID)
2015-10-14 14:55:48,558 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) org.firebirdsql.jdbc.FBSQLException: GDS Exception. 335544349. attempt to store duplicate value (visible to active transactions) in unique index "SHI_ID_SHO_UK"
Reason: attempt to store duplicate value (visible to active transactions) in unique index "SHI_ID_SHO_UK"
2015-10-14 14:55:48,568 ERROR [com.mpobjects.dbpatch.DatabasePatchService] (main:) Error while patching database

/ PATCH-396-SHI_SHOID_UK.SQL

QL> select*from mpo_scs_patch where name='patch-396-shi_shoid_uk.sql';

   SYSTEM_ID                ENTRY_DATE MODULE                                                                                                                           NAME                                                                                                                                    SQL_SCRIPT STATUS                           PATCH_COMMENT                                                                                                                                                                                                                                                   
============ ========================= =============================================================================== =============================================================================== ================= ================================ =============================================================================== 
         798 2015-10-14 14:03:18.8020  oms                                                                                                                              patch-396-shi_shoid_uk.sql                                                                                                               140:14464 NOT_APPLIED                                                                                                                                                                                                                                                                                      
==============================================================================
SQL_SCRIPT:  
alter table SHIPMENT_ITEM
add constraint SHI_ID_SHO_UK
unique (SHIPMENT_ORDER_SYSTEMID, SHIPMENT_ITEM_ID);
==============================================================================

/ Dit is de 1ste patch bij SCS-4418

SQL> update mpo_scs_patch set status='SKIPPED'  where name='patch-396-shi_shoid_uk.sql';
SQL> commit;

/ Einde PATCH-396-SHI_SHOID_UK.SQL

/ 	7	.

jboss@mposerv11:/home/INTERNAL/eric/Downloads$ dsvfms start track

015-10-14 15:51:33,923 INFO  [com.mpobjects.dbpatch.DataBasePatcher] (main:) Executing patch [oms/patch-397-pi_shoid_uk.sql] ...
2015-10-14 15:51:36,428 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) Problem while executing SQL statement in patch [oms/patch-397-pi_shoi
d_uk.sql]: 
2015-10-14 15:51:36,428 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) alter table TMS_PRODUCT_ITEM
add constraint TPI_ID_SHO_UK
unique (SHIPMENT_ORDER_SYSTEMID, PRODUCT_ITEM_ID)
2015-10-14 15:51:36,428 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) org.firebirdsql.jdbc.FBSQLException: GDS Exception. 335544349. attemp
t to store duplicate value (visible to active transactions) in unique index "TPI_ID_SHO_UK"
Reason: attempt to store duplicate value (visible to active transactions) in unique index "TPI_ID_SHO_UK"

/ PATCH-397-PI_SHOID_UK.SQL 

/ Dit is de 2de patch bij SCS-4418

SQL> update mpo_scs_patch set status='SKIPPED'  where name='patch-397-pi_shoid_uk.sql';
SQL> commit;

/ Einde PATCH-397-PI_SHOID_UK.SQL 

/ 	7	.

jboss@mposerv11:/home/INTERNAL/eric/Downloads$ dsvfms start track

2015-10-14 16:09:37,757 INFO  [com.mpobjects.dbpatch.DataBasePatcher] (main:) Executing patch [oms/patch-411-create_resource_binary.sql] ...
2015-10-14 16:09:37,898 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) Problem while executing SQL statement in patch [oms/patch-411-create_
resource_binary.sql]: 
2015-10-14 16:09:37,898 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) ALTER TABLE RESOURCE_BINARY ADD CONSTRAINT FK_RB_R FOREIGN KEY(RESOUR
CE_SYSTEMID) REFERENCES CTP_RESOURCE(SYSTEM_ID)
2015-10-14 16:09:37,898 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) org.firebirdsql.jdbc.FBSQLException: GDS Exception. 335544351. unsucc
essful metadata update
Table CTP_RESOURCE not found
null
null

/ PATCH-411-CREATE_RESOURCE_BINARY.SQL

SQL> select*from mpo_scs_patch where name='patch-411-create_resource_binary.sql';

   SYSTEM_ID                ENTRY_DATE MODULE                                                                                                                           NAME                                                                                                                                    SQL_SCRIPT STATUS                           PATCH_COMMENT                                                                                                                                                                                                                                                   
============ ========================= =============================================================================== =============================================================================== ================= ================================ =============================================================================== 
         836 2015-10-14 15:54:57.2730  oms                                                                                                                              patch-411-create_resource_binary.sql                                                                                                     140:203b5 FAILED                           org.firebirdsql.jdbc.FBSQLException: GDS Exception. 335544351. unsuccessful metadata update
Table CTP_RESOURCE not found
null
null                                                                                                                              
==============================================================================
SQL_SCRIPT:  
CREATE TABLE RESOURCE_BINARY (
	RESOURCE_SYSTEMID INTEGER NOT NULL,
	BINARY_SYSTEMID INTEGER NOT NULL
);
ALTER TABLE RESOURCE_BINARY ADD CONSTRAINT FK_RB_R FOREIGN KEY(RESOURCE_SYSTEMID) REFERENCES CTP_RESOURCE(SYSTEM_ID);
ALTER TABLE RESOURCE_BINARY ADD CONSTRAINT FK_RB_B FOREIGN KEY(BINARY_SYSTEMID) REFERENCES OMS_BINARY(SYSTEM_ID);

==============================================================================

/ de table ctp_resource is er niet	,

[eric@localhost 2015.03]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/2015.03

[eric@localhost 2015.03]$ find module/capabletopromise/ -name "*.sql" | xargs grep -i "create table" | grep -i ctp_resource
...
module/capabletopromise/src/sql/create-resource-db.sql:CREATE TABLE CTP_RESOURCE

[eric@localhost 2015.03]$ find module/capabletopromise/ -name "*.sql" | xargs grep -i "create table" | grep -i resource_type
module/capabletopromise/src/sql/create-resource_type-db.sql:CREATE TABLE "RESOURCE_TYPE" 

/ Dus geen patches	?
/ TODO

[eric@localhost 2015.03]$ less module/capabletopromise/src/sql/create-resource-db.sql
CREATE TABLE CTP_RESOURCE
(
   SYSTEM_ID integer NOT NULL,
   NAME varchar(50),
   DESCRIPTION varchar(100),
   ORGANIZATION_SYSTEMID integer,
   RESOURCE_TYPE_SYSTEMID integer,
   IS_DELETED SMALLINT DEFAULT 0,
   CONSTRAINT PK_RESOURCE PRIMARY KEY (SYSTEM_ID),
   CONSTRAINT RESOURCE_ORGANIZATION_FK FOREIGN KEY (ORGANIZATION_SYSTEMID) REFERENCES ORGANIZATION(SYSTEM_ID),
   CONSTRAINT RESOURCE_RESOURCETYPE_FK FOREIGN KEY (RESOURCE_TYPE_SYSTEMID) REFERENCES RESOURCE_TYPE(SYSTEM_ID),
   CONSTRAINT UNIQUE_ORANIZATION_RESOURCENAME UNIQUE (ORGANIZATION_SYSTEMID, NAME)
);
ALTER TABLE CTP_RESOURCE
ADD IS_UPDATED smallint;
...

[eric@localhost 2015.03]$ less module/capabletopromise/src/sql/create-resource_type-db.sql

CREATE TABLE "RESOURCE_TYPE" 
(
        "SYSTEM_ID"      INTEGER NOT NULL,
        "NAME"   VARCHAR(100) NOT NULL,
        "DESCRIPTION"    VARCHAR(255),
        "ORGANIZATION_SYSTEMID"  INTEGER NOT NULL,
        "SHORT_TERM_PERIOD"      INTEGER NOT NULL,
        "MEDIUM_TERM_PERIOD"     INTEGER NOT NULL,
        "LONG_TERM_PERIOD"       INTEGER NOT NULL,
        "IS_DELETED" SMALLINT DEFAULT 0, 
        CONSTRAINT PK_RESOURCE_TYPE PRIMARY KEY ("SYSTEM_ID")
);

/ we doen met de hand	,
CREATE TABLE "RESOURCE_TYPE" 
...
CREATE TABLE CTP_RESOURCE
/ en dan de patch-411	,

/ en dan	,
QL> update mpo_scs_patch set status='MANUALLY_APPLIED'  where name='patch-411-create_resource_binary.sql';
SQL> commit;

/ Einde PATCH-411-CREATE_RESOURCE_BINARY.SQL

/ 7	. 

jboss@mposerv11:/home/INTERNAL/eric/Downloads$ dsvfms start track

2015-10-14 17:19:19,751 INFO  [com.mpobjects.dbpatch.DataBasePatcher] (main:) Executing patch [oms/patch-422-soc-correction-type-remove.sql] ...
2015-10-14 17:19:19,801 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) Problem while executing SQL statement in patch [oms/patch-422-soc-cor
rection-type-remove.sql]: 
2015-10-14 17:19:19,801 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) 

alter table cost_component_specification drop correction_type_systemid
2015-10-14 17:19:19,801 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) org.firebirdsql.jdbc.FBSQLException: GDS Exception. 335544351. unsucc
essful metadata update
cannot delete
COLUMN SERVICE_ORDER_COST.CORRECTION_TYPE_SYSTEMID
there are 8 dependencies
Reason: unsuccessful metadata update
cannot delete
COLUMN SERVICE_ORDER_COST.CORRECTION_TYPE_SYSTEMID
there are 8 dependencies

/ PATCH-422-SOC-CORRECTION-TYPE-REMOVE.SQL

SQL> select*from mpo_scs_patch where name='patch-422-soc-correction-type-remove.sql'
CON> ;

   SYSTEM_ID                ENTRY_DATE MODULE                                                                                                                           NAME                                                                                                                                    SQL_SCRIPT STATUS                           PATCH_COMMENT                                                                                                                                                                                                                                                   
============ ========================= =============================================================================== =============================================================================== ================= ================================ =============================================================================== 
         851 2015-10-14 17:14:56.4840  oms                                                                                                                              patch-422-soc-correction-type-remove.sql                                                                                                 140:22b0b FAILED                           org.firebirdsql.jdbc.FBSQLException: GDS Exception. 335544351. unsuccessful metadata update
cannot delete
COLUMN SERVICE_ORDER_COST.CORRECTION_TYPE_SYSTEMID
there are 8 dependencies
Reason: unsuccessful metadata update
cannot delete
COLUMN SERVICE_OR      
==============================================================================
SQL_SCRIPT:  
alter table service_order_cost drop correction_type_systemid;

alter table cost_component_specification drop correction_type_systemid;

drop table correction_type;

==============================================================================


/ we doen met de hand	,

alter table service_order_cost drop correction_type_systemid;
-cannot delete
-COLUMN SERVICE_ORDER_COST.CORRECTION_TYPE_SYSTEMID
-there are 8 dependencies

alter table cost_component_specification drop correction_type_systemid;
/ OK

drop table correction_type;
-ERASE RDB$RELATION_CONSTRAINTS failed
-action cancelled by trigger (1) to preserve data integrity
-Cannot delete PRIMARY KEY being used in FOREIGN KEY definition.

RDB$DEPENDENCIES
RDB$RELATION_CONSTRAINTS                                                                      

SQL>  select * from RDB$DEPENDENCIES where rdb$field_name ='CORRECTION_TYPE_SYSTEMID';

RDB$DEPENDENT_NAME                                                                            RDB$DEPENDED_ON_NAME                                                                          RDB$FIELD_NAME                                                                                RDB$DEPENDENT_TYPE RDB$DEPENDED_ON_TYPE 
=============================================================================== =============================================================================== =============================================================================== ================== ==================== 
FREIGHT_DEL_COST_SHIPMENT                                                                     SERVICE_ORDER_COST                                                                            CORRECTION_TYPE_SYSTEMID                                                                                       1                    0 
FREIGHT_LIN_COST_SHIPMENT                                                                     SERVICE_ORDER_COST                                                                            CORRECTION_TYPE_SYSTEMID                                                                                       1                    0 
OTHER_DEL_COST_SHIPMENT                                                                       SERVICE_ORDER_COST                                                                            CORRECTION_TYPE_SYSTEMID                                                                                       1                    0 
OTHER_LIN_COST_SHIPMENT                                                                       SERVICE_ORDER_COST                                                                            CORRECTION_TYPE_SYSTEMID                                                                                       1                    0 
COSTS_PER_SHIPMENT                                                                            SERVICE_ORDER_COST                                                                            CORRECTION_TYPE_SYSTEMID                                                                                       1                    0 
COSTS_STATUS_PER_SHIPMENT                                                                     SERVICE_ORDER_COST                                                                            CORRECTION_TYPE_SYSTEMID                                                                                       1                    0 
FUEL_DEL_COST_SHIPMENT                                                                        SERVICE_ORDER_COST                                                                            CORRECTION_TYPE_SYSTEMID                                                                                       1                    0 
FUEL_LIN_COST_SHIPMENT                                                                        SERVICE_ORDER_COST                                                                            CORRECTION_TYPE_SYSTEMID                                                                                       1                    0 

/ Dit zijn views	,

/ Intermezzo

select RDB$VIEW_BLR,RDB$VIEW_SOURCE,RDB$RELATION_NAME
from rdb$relations;
select RDB$VIEW_BLR,RDB$RELATION_NAME
from rdb$relations;

select rdb$dependent_name from rdb$dependencies where rdb$field_name ='CORRECTION_TYPE_SYSTEMID';
RDB$DEPENDENT_NAME                                                                            
=============================================================================== 
COSTS_STATUS_PER_SHIPMENT                                                                     
FUEL_DEL_COST_SHIPMENT                                                                        
FUEL_LIN_COST_SHIPMENT                                                                        
FREIGHT_LIN_COST_SHIPMENT                                                                     
OTHER_DEL_COST_SHIPMENT                                                                       
OTHER_LIN_COST_SHIPMENT                                                                       
COSTS_PER_SHIPMENT                                                                            
FREIGHT_DEL_COST_SHIPMENT      

select SHIPMENT_ORDER_SYSTEMID, PRODUCT_ITEM_ID , count(product_item_id) from TMS_PRODUCT_ITEM group by SHIPMENT_ORDER_SYSTEMID, PRODUCT_ITEM_ID having count(product_item_id)>1;


/ Einde Intermezzo

/ we kunnen ook	,
[eric@localhost 2015.03]$ find -name "*patch-*sql" -print0 | xargs -0 grep --color=always FREIGHT_DEL_COST_SHIPMENT
...

/ 13	. 

./dsvfms/dsvfms/src/sql/patch/patch-024_modified_shipment_cost_views.sql:CREATE VIEW FREIGHT_DEL_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT)

/ we zouden kunnen	, 

CREATE VIEW FREIGHT_DEL_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT)
AS SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, ... 										/ rm	,

/ dus 	,

DROP VIEW FREIGHT_DEL_COST_SHIPMENT;

CREATE VIEW FREIGHT_DEL_COST_SHIPMENT (SHIPMENT_ORDER_SYSTEMID, STATUS, AMOUNT)
AS SELECT SOCP.STATUS, SUM(CASE CT.NAME WHEN 'ADD' THEN SOCP.AMOUNT WHEN 'SUBTRACT' THEN (-1*SOCP.AMOUNT) ELSE 0 END)
FROM SHIPMENT_ORDER_COST_PART SOCP
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID
JOIN CORRECTION_TYPE CT ON SOC.CORRECTION_TYPE_SYSTEMID = CT.SYSTEM_ID
JOIN SERVICE_ORDER SO ON SO.SYSTEM_ID=SOC.SERVICE_ORDER_SYSTEMID
JOIN SERVICE_ORDER_TYPE SOT ON SO.SERVICE_ORDER_TYPE_SYSTEMID=SOT.SYSTEM_ID
WHERE SOCP.IS_DELETED = 0 AND SOC.COST_TYPE_SYSTEMID IN (SELECT SYSTEM_ID FROM RATE_COMPONENT_TYPE WHERE CODE='FREIGHT' AND RCT_GROUP='COST') AND SOT.SERVICE_ORDER_TYPE='DELIVERY' GROUP BY SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.STATUS;

GRANT DELETE, INSERT, REFERENCES, SELECT, UPDATE ON FREIGHT_DEL_COST_SHIPMENT TO  SYSDBA WITH GRANT OPTION;

/ Maar we doen het niet	, want reports hangen af van deze view 	,
/ TODO

/ we doen	,
SQL> update mpo_scs_patch set status='SKIPPED'  where name='patch-422-soc-correction-type-remove.sql';
SQL> commit;


/ Einde PATCH-422-SOC-CORRECTION-TYPE-REMOVE.SQL

/ 7	. 

jboss@mposerv11:/home/INTERNAL/eric/Downloads$ dsvfms start track

2015-10-15 11:48:40,841 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) Problem while executing SQL statement in patch [oms/patch-459-price_cost_translation_privileges$firebird.sql]: 
2015-10-15 11:48:40,841 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) INSERT INTO BUSINESS_OBJECT (SYSTEM_ID, NAME, DESCRIPTION, IS_DELETED) VALUES (GEN_ID(SYSID,1), 'price-type-translation', 'Pricetype Translation', 0)
2015-10-15 11:48:40,841 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) org.firebirdsql.jdbc.FBSQLException: GDS Exception. 335544665. violation of PRIMARY or UNIQUE KEY constraint "BUS_OBJ_UK" on table "BUSINESS_OBJECT"

/ PATCH-459-PRICE_COST_TRANSLATION_PRIVILEGES$FIREBIRD.SQL

/ we doen met de hand	,

/ 13	.

INSERT INTO BUSINESS_OBJECT (SYSTEM_ID, NAME, DESCRIPTION, IS_DELETED) VALUES (GEN_ID(SYSID,1), 'price-type-translation', 'Pricetype Translation', 0);
/ Skip, row is er al	,

/ 13	.

INSERT INTO BUSINESS_OBJECT (SYSTEM_ID, NAME, DESCRIPTION, IS_DELETED) VALUES (GEN_ID(SYSID,1), 'cost-type-translation', 'Costtype Translation', 0);
/ Doen we	, 

/ 13	.

INSERT INTO PRIVILEGE (SYSTEM_ID, BUSINESS_OBJECT_SYSTEMID, PRIVILEGE_TYPE_SYSTEMID, DESCRIPTION)
SELECT GEN_ID(SYSID,1), BO.SYSTEM_ID, PT.SYSTEM_ID, 'price-type-translation.list'
FROM BUSINESS_OBJECT BO, PRIVILEGE_TYPE PT
where BO.NAME = 'price-type-translation' AND
PT.NAME = 'list';
/ row is er al	, alleen met description null	, dus we doen deze NIET, 	maar in plaats daarvan een update	,

/ Intermezzo

SQL> SELECT GEN_ID(SYSID,1), BO.SYSTEM_ID, PT.SYSTEM_ID, 'price-type-translation.list'
CON> FROM BUSINESS_OBJECT BO, PRIVILEGE_TYPE PT
CON> where BO.NAME = 'price-type-translation' AND
CON> PT.NAME = 'list';

               GEN_ID    SYSTEM_ID    SYSTEM_ID CONSTANT                    
===================== ============ ============ =========================== 
              1085088     31633650            2 price-type-translation.list 

SQL> select*from privilege where BUSINESS_OBJECT_SYSTEMID=31633650;

   SYSTEM_ID BUSINESS_OBJECT_SYSTEMID PRIVILEGE_TYPE_SYSTEMID DESCRIPTION                                                                                                                                                                                              IS_DELETED 
============ ======================== ======================= =============================================================================== ========== 
    31633651                 31633650                       2 <null>                                                                                                                                                                                                            0 

update PRIVILEGE 
set description='price-type-translation.list' 
where BUSINESS_OBJECT_SYSTEMID=(
	select bo.system_id
	FROM BUSINESS_OBJECT BO
	where BO.NAME = 'price-type-translation') 
and PRIVILEGE_TYPE_SYSTEMID=( 
	select pt.system_id
	from PRIVILEGE_TYPE PT
	where PT.NAME = 'list') 
/ WE doen dus deze 	,

/ 13	. 

INSERT INTO PRIVILEGE (SYSTEM_ID, BUSINESS_OBJECT_SYSTEMID, PRIVILEGE_TYPE_SYSTEMID, DESCRIPTION)
SELECT GEN_ID(SYSID,1), BO.SYSTEM_ID, PT.SYSTEM_ID, 'cost-type-translation.list'
FROM BUSINESS_OBJECT BO, PRIVILEGE_TYPE PT
where BO.NAME = 'cost-type-translation' AND
PT.NAME = 'list';
/ doen 	, zoals het er staat	,	

/ 13	. 

SET TERM ^ ;
CREATE PROCEDURE COST_PRICE_PRIVILEGES
AS
DECLARE VARIABLE TMP integer;
begin
    FOR 
	select role_systemid 
	from role_privilege 
	where privilege_systemid = (
		select system_id 
		from privilege
		where business_object_systemid=(
			select system_id 
			from business_object 
			where name='financial-party')
		and privilege_type_systemid=(
			select system_id 
			from privilege_type 
		where name='list'))

	INTO :TMP DO
  	BEGIN

/*
    	INSERT INTO ROLE_PRIVILEGE (ROLE_SYSTEMID,PRIVILEGE_SYSTEMID)  values (:TMP ,
 			(select p.system_id 
			from privilege p , business_object bo , privilege_type pt
 			where bo.name='price-type-translation' 
			and pt.name='list' 
			and p.business_object_systemid=bo.system_id 
			and p.privilege_type_systemid=pt.system_id) );
*/

 		INSERT INTO ROLE_PRIVILEGE (ROLE_SYSTEMID,PRIVILEGE_SYSTEMID)  values (:TMP ,
 			(select p.system_id from privilege p , business_object bo , privilege_type pt
 			where bo.name='cost-type-translation' 
			and pt.name='list' 
			and p.business_object_systemid=bo.system_id 
			and p.privilege_type_systemid=pt.system_id) );

  END
end^
SET TERM ; ^

/ we zullen zien dat de 1ste insert NIET moet	, want al de 4 roles 10103, 10100, 9808853, 10108 =supersuer, administrator, key user, finance hebben de privilege price-type-translation.list al	,
/ de 2de moet wel	,
/ See na dit Intermezzo	,

GRANT EXECUTE
 ON PROCEDURE COST_PRICE_PRIVILEGES TO  SYSDBA;
/ Gewoon, zoals het er staat	,

////////////////////////////////////
/ Dus de roles die privilege financial-party.list hebben moeten ook privlege price-type-translation.list en cost-type-translation.list krijgen	, 

EXECUTE PROCEDURE COST_PRICE_PRIVILEGES;


/ Intermezzo

/ 1313	. 

/ we doen de FOR select apart	,

/ welke roles hebben de privilege financial-party.list	? 

SQL> select role_systemid
CON>     from role_privilege
CON>     where privilege_systemid = (
CON>         select system_id
CON>         from privilege
CON>         where business_object_systemid=(
CON>             select system_id 
CON>             from business_object 
CON>             where name='financial-party')
CON>         and privilege_type_systemid=(
CON>             select system_id 
CON>             from privilege_type 
CON>         where name='list'));

ROLE_SYSTEMID 
============= 
        10103 
        10100 
      9808853 
        10108 

/ 1313	. 

			select p.system_id
         	from privilege p , business_object bo , privilege_type pt
            where bo.name='price-type-translation'
            and pt.name='list'
            and p.business_object_systemid=bo.system_id
            and p.privilege_type_systemid=pt.system_id; 

   SYSTEM_ID 
============ 
    31633651 

			select p.system_id 
			from privilege p , business_object bo , privilege_type pt
            where bo.name='cost-type-translation'
            and pt.name='list'
            and p.business_object_systemid=bo.system_id
            and p.privilege_type_systemid=pt.system_id

   SYSTEM_ID 
============ 
     1085090 

SQL> select*from role_privilege  where role_systemid=10103 and privilege_systemid in (31633651,1085090);

ROLE_SYSTEMID PRIVILEGE_SYSTEMID 
============= ================== 
        10103           31633651 

SQL> select*from role_privilege  where role_systemid=10100 and privilege_systemid in (31633651,1085090);

ROLE_SYSTEMID PRIVILEGE_SYSTEMID 
============= ================== 
        10100           31633651 

SQL> select*from role_privilege  where role_systemid=9808853 and privilege_systemid=31633651;

ROLE_SYSTEMID PRIVILEGE_SYSTEMID 
============= ================== 
      9808853           31633651 

SQL> select*from role_privilege  where role_systemid=10108 and privilege_systemid in (31633651,1085090);

ROLE_SYSTEMID PRIVILEGE_SYSTEMID 
============= ================== 
        10108           31633651 


/ Einde Intermezzo

/ Einde PATCH-459-PRICE_COST_TRANSLATION_PRIVILEGES$FIREBIRD.SQL

/ 7	.

jboss@mposerv11:/home/INTERNAL/eric/Downloads$ dsvfms start track

/ Intermezzo

/ we zien volgorde patches	,

015-10-15 16:03:49,603 INFO  [com.mpobjects.dbpatch.DataBasePatcher] (main:) Executing patch [oms/patch-519-sottypetriggerOnUnplan.sql] ...
2015-10-15 16:03:49,621 INFO  [com.mpobjects.dbpatch.DataBasePatcher] (main:) Executing patch [interfacing/patch-0002-ifacemsgtrace.sql] ...
...
2015-10-15 16:03:49,792 INFO  [com.mpobjects.dbpatch.DataBasePatcher] (main:) Executing patch [interfacing/patch-0005-idseq2$firebird.sql] ...
2015-10-15 16:03:51,519 INFO  [com.mpobjects.dbpatch.DataBasePatcher] (main:) Executing patch [inventory/patch-005-stock_transaction_type.sql] ...
...
2015-10-15 16:04:40,030 INFO  [com.mpobjects.dbpatch.DataBasePatcher] (main:) Executing patch [invoice/patch-061-invoice-header-status.sql] ...
/ we zien andere modules	, vandaar dat de nummertjes weer 'opnieuw beginnen'	,

/ Einde Intermezzo


2015-10-15 16:36:35,877 INFO  [com.mpobjects.dbpatch.DataBasePatcher] (main:) Executing patch [invoice/patch-061-invoice-header-status.sql] ...
2015-10-15 16:36:35,959 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) Problem while executing SQL statement in patch [invoice/patch-061-inv
oice-header-status.sql]: 
/ WH omdat ikzelf nog geen commit had gedaan	,

/ PATCH-061-INVOICE-HEADER-STATUS.SQL

/ WH gaat OK, deze fix is NIET nodig	,

/ alleen de laatste was niet gedaan	, 
/ we doen met de hand	,
SQL> DROP TABLE INVOICE_HEADER_STATUS;
SQL> commit;

SQL> update mpo_scs_patch set status='APPLIED' where name='patch-061-invoice-header-status.sql';
SQL> commit;

/ Einde PATCH-061-INVOICE-HEADER-STATUS.SQL


/ 7	.

jboss@mposerv11:/home/INTERNAL/eric/Downloads$ dsvfms start track


/ Einde PATCH-061-INVOICE-HEADER-STATUS.SQL


/ FIXES DSVFMS PATCHES ON TEST 

/ HIER HIER HIER

/ we hebben xwiki pagina create	,
https://system.mp-objects.com/xwiki/bin/view/Technology/Deployment+dsvfms+2015.03+to+test

/ Herinner ook	,
https://system.mp-objects.com/xwiki/bin/view/Technology/ReleaseTODOList

/ FIX patch-364-fix-party-org-fk.sql

/ Insert een aantal rijen in organization table	, zodat we een fk kunnen maken in de party table	, 
/ er zijn in party table rijen met organization_systemid , die geen system_id's zijn in de organization table	, 

insert into organization
select organization_systemid, 'DO_NOT_USE_' || organization_systemid, 'Dummy organization to fix foreign key problem', 0,1,null,0
from PARTY 
where ORGANIZATION_SYSTEMID not in (
	select SYSTEM_ID 
	from ORGANIZATION)
group by organization_systemid;
commit;

ALTER TABLE PARTY 
ADD CONSTRAINT PARTY_ORG_FK FOREIGN KEY (ORGANIZATION_SYSTEMID) REFERENCES ORGANIZATION (SYSTEM_ID);

SQL> update mpo_scs_patch set status='MANUALLY_APPLIED' where name='patch-364-fix-party-org-fk.sql';
SQL> commit;

/ Einde FIX patch-364-fix-party-org-fk.sql

/ 

/ FIX PATCH-389_PRODUCTID_UNIQUE_CONSTRAINT_DROP.SQL

SQL> update mpo_scs_patch set status='SKIPPED' where name='patch-389_productid_unique_constraint_drop.sql';
SQL> commit;

/ Einde FIX PATCH-389_PRODUCTID_UNIQUE_CONSTRAINT_DROP.SQL

/ FIX PATCH-390-CUSTOMER-ORDER-LINE-DETAIL.SQL

CREATE TABLE CUSTOMER_ORDER_LINE_DETAIL
(
   ENTITY_SYSTEMID integer NOT NULL,
   EDT_SYSTEMID integer NOT NULL,
   FIELD_VALUE varchar(255),
   CONSTRAINT PK_CUSTOMER_ORDER_LINE_DETAIL PRIMARY KEY (ENTITY_SYSTEMID, EDT_SYSTEMID)
);

ALTER TABLE CUSTOMER_ORDER_LINE_DETAIL 
ADD CONSTRAINT COLD_COL_FK FOREIGN KEY (ENTITY_SYSTEMID) REFERENCES CUSTOMER_ORDER_LINE (SYSTEM_ID);
ALTER TABLE CUSTOMER_ORDER_LINE_DETAIL 
ADD CONSTRAINT COLD_EDT_FK FOREIGN KEY (EDT_SYSTEMID) REFERENCES ENTITY_DETAIL_TYPE (SYSTEM_ID);

SQL> update  mpo_scs_patch set status='MANUALLY_APPLIED' where name='patch-390-customer-order-line-detail.sql';
SQL> commit;

/ Einde FIX PATCH-390-CUSTOMER-ORDER-LINE-DETAIL.SQL

/ FIX PATCH-396-SHI_SHOID_UK.SQL

/ Dit is de 1ste patch bij SCS-4418	,

SQL> update mpo_scs_patch set status='SKIPPED'  where name='patch-396-shi_shoid_uk.sql';
SQL> commit;

/ Einde FIX PATCH-396-SHI_SHOID_UK.SQL

/ FIX PATCH-397-PI_SHOID_UK.SQL 

/ Dit is de 2de patch bij SCS-4418

SQL> update mpo_scs_patch set status='SKIPPED'  where name='patch-397-pi_shoid_uk.sql';
SQL> commit;

/ Einde FIX PATCH-397-PI_SHOID_UK.SQL 

/ FIX PATCH-411-CREATE_RESOURCE_BINARY.SQL

[eric@localhost 2015.03]$ less module/capabletopromise/src/sql/create-resource_type-db.sql
CREATE TABLE "RESOURCE_TYPE" 
(
        "SYSTEM_ID"      INTEGER NOT NULL,
        "NAME"   VARCHAR(100) NOT NULL,
        "DESCRIPTION"    VARCHAR(255),
        "ORGANIZATION_SYSTEMID"  INTEGER NOT NULL,
        "SHORT_TERM_PERIOD"      INTEGER NOT NULL,
        "MEDIUM_TERM_PERIOD"     INTEGER NOT NULL,
        "LONG_TERM_PERIOD"       INTEGER NOT NULL,
        "IS_DELETED" SMALLINT DEFAULT 0, 
        CONSTRAINT PK_RESOURCE_TYPE PRIMARY KEY ("SYSTEM_ID")
);

[eric@localhost 2015.03]$ less module/capabletopromise/src/sql/create-resource-db.sql
CREATE TABLE CTP_RESOURCE
(
   SYSTEM_ID integer NOT NULL,
   NAME varchar(50),
   DESCRIPTION varchar(100),
   ORGANIZATION_SYSTEMID integer,
   RESOURCE_TYPE_SYSTEMID integer,
   IS_DELETED SMALLINT DEFAULT 0,
   CONSTRAINT PK_RESOURCE PRIMARY KEY (SYSTEM_ID),
   CONSTRAINT RESOURCE_ORGANIZATION_FK FOREIGN KEY (ORGANIZATION_SYSTEMID) REFERENCES ORGANIZATION(SYSTEM_ID),
   CONSTRAINT RESOURCE_RESOURCETYPE_FK FOREIGN KEY (RESOURCE_TYPE_SYSTEMID) REFERENCES RESOURCE_TYPE(SYSTEM_ID),
   CONSTRAINT UNIQUE_ORANIZATION_RESOURCENAME UNIQUE (ORGANIZATION_SYSTEMID, NAME)
);
ALTER TABLE CTP_RESOURCE
ADD IS_UPDATED smallint;

$ less ./module/oms/src/sql/patch/patch-411-create_resource_binary.sql
CREATE TABLE RESOURCE_BINARY (
	RESOURCE_SYSTEMID INTEGER NOT NULL,
	BINARY_SYSTEMID INTEGER NOT NULL
);
ALTER TABLE RESOURCE_BINARY ADD CONSTRAINT FK_RB_R FOREIGN KEY(RESOURCE_SYSTEMID) REFERENCES CTP_RESOURCE(SYSTEM_ID);
ALTER TABLE RESOURCE_BINARY ADD CONSTRAINT FK_RB_B FOREIGN KEY(BINARY_SYSTEMID) REFERENCES OMS_BINARY(SYSTEM_ID);

SQL> update mpo_scs_patch set status='MANUALLY_APPLIED'  where name='patch-411-create_resource_binary.sql';
SQL> commit;



/ Einde FIX PATCH-411-CREATE_RESOURCE_BINARY.SQL

/ FIX PATCH-422-SOC-CORRECTION-TYPE-REMOVE.SQL

SQL> update mpo_scs_patch set status='SKIPPED'  where name='patch-422-soc-correction-type-remove.sql';
SQL> commit;

/ Einde FIX PATCH-422-SOC-CORRECTION-TYPE-REMOVE.SQL

/ FIX PATCH-459-PRICE_COST_TRANSLATION_PRIVILEGES$FIREBIRD.SQL


INSERT INTO BUSINESS_OBJECT (SYSTEM_ID, NAME, DESCRIPTION, IS_DELETED) VALUES (GEN_ID(SYSID,1), 'cost-type-translation', 'Costtype Translation', 0);

update PRIVILEGE 
set description='price-type-translation.list' 
where BUSINESS_OBJECT_SYSTEMID=(
	select bo.system_id
	FROM BUSINESS_OBJECT BO
	where BO.NAME = 'price-type-translation') 
and PRIVILEGE_TYPE_SYSTEMID=( 
	select pt.system_id
	from PRIVILEGE_TYPE PT
	where PT.NAME = 'list') 

INSERT INTO PRIVILEGE (SYSTEM_ID, BUSINESS_OBJECT_SYSTEMID, PRIVILEGE_TYPE_SYSTEMID, DESCRIPTION)
SELECT GEN_ID(SYSID,1), BO.SYSTEM_ID, PT.SYSTEM_ID, 'cost-type-translation.list'
FROM BUSINESS_OBJECT BO, PRIVILEGE_TYPE PT
where BO.NAME = 'cost-type-translation' AND
PT.NAME = 'list';

/* give roles which have privileg financial-party.list also the privilege cost-type-translation.list */ 

SET TERM ^ ;
CREATE PROCEDURE COST_PRICE_PRIVILEGES
AS
DECLARE VARIABLE TMP integer;
begin
    FOR 
	select role_systemid 
	from role_privilege 
	where privilege_systemid = (
		select system_id 
		from privilege
		where business_object_systemid=(
			select system_id 
			from business_object 
			where name='financial-party')
		and privilege_type_systemid=(
			select system_id 
			from privilege_type 
		where name='list'))

	INTO :TMP DO
  	BEGIN

 		INSERT INTO ROLE_PRIVILEGE (ROLE_SYSTEMID,PRIVILEGE_SYSTEMID)  values (:TMP ,
 			(select p.system_id from privilege p , business_object bo , privilege_type pt
 			where bo.name='cost-type-translation' 
			and pt.name='list' 
			and p.business_object_systemid=bo.system_id 
			and p.privilege_type_systemid=pt.system_id) );

  END
end^
SET TERM ; ^

GRANT EXECUTE
 ON PROCEDURE COST_PRICE_PRIVILEGES TO  SYSDBA;

EXECUTE PROCEDURE COST_PRICE_PRIVILEGES;


update mpo_scs_patch set status='MANUALLY_APPLIED' where name='patch-459-price_cost_translation_privileges$firebird.sql';
commit;


/ Einde FIX PATCH-459-PRICE_COST_TRANSLATION_PRIVILEGES$FIREBIRD.SQL

/ PATCH-061-INVOICE-HEADER-STATUS.SQL

/ WH gaat OK, deze fix is NIET nodig	,

/ alleen de laatste was niet gedaan	, 
/ we doen met de hand	,
SQL> DROP TABLE INVOICE_HEADER_STATUS;
SQL> commit;

SQL> update mpo_scs_patch set status='APPLIED' where name='patch-061-invoice-header-status.sql';
SQL> commit;

/ Einde PATCH-061-INVOICE-HEADER-STATUS.SQL


/ Einde FIXES DSVFMS PATCHES ON TEST 



/ Einde DSVSOL-2716

/ MPO-199

/ 7	 . 

/ we maken een nieuw script	, 

[eric@localhost bin]$ cat mpo-ssh-p.sh 
#!/bin/bash
echo "h^Zgcyr&Q"
ssh "vanderveldene@scs-application-p.intermax.mp-objects.com"

[vanderveldene@scs-application-p mpo]$ pwd
/local/apps/jboss-4.0.5.GA/server/mpo
$ vi deploy/postgres-ds.xml
<datasources>
        <xa-datasource>
                <jndi-name>tmsdevDS</jndi-name>
                <track-connection-by-tx>true</track-connection-by-tx>
                <xa-datasource-class>org.postgresql.xa.PGXADataSource</xa-datasource-class>
                <xa-datasource-property name="ServerName">127.0.0.1</xa-datasource-property>
                <xa-datasource-property name="PortNumber">5432</xa-datasource-property>
                <xa-datasource-property name="DatabaseName">mpo</xa-datasource-property>
                <xa-datasource-property name="User">mpo</xa-datasource-property>
                <xa-datasource-property name="Password">zwnnCLP0YYVGCdbCDIOp7lS4JrAxEgj4</xa-datasource-property>


/ we hebbn ook 	,
[eric@localhost bin]$ cat mpo-db-p.sh 
PGPASSWORD=h^Zgcyr\&Q psql -U vanderveldene -h  scs-application-p.intermax.mp-objects.com mpo 
psql: FATAL:  password authentication failed for user "vanderveldene"

/ we doen dus met de hand	,
[eric@localhost bin]$ ./mpo-ssh-p.sh 
h^Zgcyr&Q
[vanderveldene@scs-application-p ~]$ psql -U mpo
[vanderveldene@scs-application-p ~]$ psql -U mpo
Password for user mpo: zwnnCLP0YYVGCdbCDIOp7lS4JrAxEgj4
mpo=> 
/ we zoeken 
djansen, Italia72
PDurr,admin123@MPO

/ we kunnen ook	, 

[eric@localhost bin]$ cat mpo-db-p.sh 
#!/usr/bin/bash
#PGPASSWORD=h^Zgcyr\&Q psql -U vanderveldene -h  scs-application-p.intermax.mp-objects.com mpo 
PGPASSWORD=mpopostgres@mpo psql -U mpopostgres -h  scs-application-p.intermax.mp-objects.com mpo 
[eric@localhost bin]$ mpo-db-p.sh 
mpo=# \du
                              List of roles
  Role name  |                   Attributes                   | Member of 
-------------+------------------------------------------------+-----------
 hendriksm   | Superuser, Create role, Create DB              | {}
 mpo         | Password valid until infinity                  | {}
 mpopostgres | Superuser, Create role, Create DB, Replication | {}
 postgres    | Superuser, Create role, Create DB, Replication | {}



/ 7	. 

/ Op production/acceptance	, 
planning, customer functions , order status	,
/ click filter op geen	, we krijgen ze allemaal	,
/ edit er een	, we zien de customer view	,

/ 7	. 

$ mpo-ssh-a.sh

/ we maken	,
[eric@localhost bin]$ cat mpo-db-a.sh 
PGPASSWORD=h^Zgcyr\&Q psql -U vanderveldene -h  database-a.intermax.mp-objects.com mpo 
[eric@localhost bin]$ mpo-db-a.sh 
psql: FATAL:  password authentication failed for user "vanderveldene"

/ we doen	,
[eric@localhost bin]$ cat mpo-db-a.sh 
#PGPASSWORD=h^Zgcyr\&Q psql -U vanderveldene -h  database-a.intermax.mp-objects.com mpo 
PGPASSWORD=mpopostgres@mpo psql -U mpopostgres -h  database-a.intermax.mp-objects.com mpo 
[eric@localhost bin]$ mpo-db-a.sh 
mpo=# \du
                               List of roles
   Role name   |                   Attributes                   | Member of 
---------------+------------------------------------------------+-----------
 hendriksm     | Superuser, Create role, Create DB              | {}
 mpo           | Password valid until infinity                  | {}
 mpopostgres   | Superuser, Replication                         | {}
 postgres      | Superuser, Create role, Create DB, Replication | {}
 vanderveldene | Password valid until infinity                  | {}

/ Ik sta er wel bij	,
/ TODO











/ Einde MPO-199


/ SQUIRREL

eric@localhost ~]$ cd Devel/Java/squirrel-sql-3.5.3/
[eric@localhost squirrel-sql-3.5.3]$ ./squirrel-sql.sh 
...

/ we zien links vertical 'Aliases'	, 
/ we edit met dsvfms-db-t	, 
url: jdbc:firebirdsql://192.168.1.8/local/apps/firebird/dsvfms.fdb

/ als we een aantal queries schrijven in edit window	,  select er een , 
/ bijv	, 
select sql_script from mpo_scs_patch where name='patch-364-fix-party-org-fk.sql';
/ en click run	button (icon = mannetje), 
/ we zien onderin 1 rij	, 
/ right click 'sql_script' column	, kies 'Make editable'	,
/ dubbelclick op de column	, de content is nu geel	, 
/ als we hebben edit,	 click dan 'update data'	, 

/ rechtsboven is ook 'toggle autocommit'	, default true	, als we click , dan verschijnen er commit/rollback buttons	,


/ Einde SQUIRREL

/ AWK

/ 7	. 

[eric@localhost bin]$ awk '1' ~/Downloads/server.log 
/ prints de hele file	, 1 is hier de conditie	, en {print} mag je weglaten	,

[eric@localhost bin]$ awk '/MUST_BE_REMOVED/ || /MISSING/{print}' ~/Downloads/server.log 
/ of	,
[eric@localhost bin]$ awk '/MUST_BE_REMOVED/ || /MISSING/' ~/Downloads/server.log 

/ 7	. 

$ cat ~/tmp/log29.txt
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [1] as [TIMESTAMP] - 2015-12-14 07:28:51.494
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [2] as [INTEGER] - 5045
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [3] as [INTEGER] - 5230
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [4] as [INTEGER] - 5040
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [5] as [INTEGER] - 5050
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [6] as [INTEGER] - 5550
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [7] as [INTEGER] - 5310
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [8] as [INTEGER] - 5400
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [9] as [INTEGER] - 3110
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [10] as [INTEGER] - 5450
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [11] as [INTEGER] - 5280
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [12] as [INTEGER] - 5070
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [13] as [INTEGER] - 5410
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [14] as [INTEGER] - 3100
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [15] as [INTEGER] - 3210
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [16] as [INTEGER] - 5600
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [17] as [INTEGER] - 5610
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [18] as [INTEGER] - 5620
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [19] as [INTEGER] - 3150
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [20] as [INTEGER] - 3200
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [21] as [INTEGER] - 3190
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [22] as [INTEGER] - 200
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [23] as [INTEGER] - 5540
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [24] as [INTEGER] - 5290
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [25] as [INTEGER] - 5080
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [26] as [INTEGER] - 5560
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [27] as [INTEGER] - 5300
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [28] as [INTEGER] - 5090
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [29] as [INTEGER] - 5460
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [30] as [INTEGER] - 5420
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [31] as [INTEGER] - 5100
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [32] as [INTEGER] - 5110
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [33] as [INTEGER] - 5470
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [34] as [INTEGER] - 5520
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [35] as [INTEGER] - 5120
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [36] as [INTEGER] - 5570
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [37] as [INTEGER] - 5020
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [38] as [INTEGER] - 5430
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [39] as [INTEGER] - 5125
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [40] as [INTEGER] - 5130
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [41] as [INTEGER] - 5140
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [42] as [INTEGER] - 5150
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [43] as [INTEGER] - 5160
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [44] as [INTEGER] - 5170
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [45] as [INTEGER] - 5030
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [46] as [INTEGER] - 5190
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [47] as [INTEGER] - 5200
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [48] as [INTEGER] - 5210
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [49] as [INTEGER] - 5500
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [50] as [INTEGER] - 5580
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [51] as [INTEGER] - 5530
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [52] as [INTEGER] - 5220
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [53] as [INTEGER] - 1084719
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [54] as [INTEGER] - 5240
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [55] as [INTEGER] - 5250
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [56] as [INTEGER] - 5320
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [57] as [INTEGER] - 5260
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [58] as [INTEGER] - 5270
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [59] as [INTEGER] - 5390
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [60] as [INTEGER] - 12123
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [61] as [INTEGER] - 5510
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [62] as [INTEGER] - 5440
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [63] as [INTEGER] - 1
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.EnumType] (http-0.0.0.0-8080-6:) Binding 'OPEN_ALERTED' to parameter: 64
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [65] as [INTEGER] - 0


[eric@localhost tmp]$ awk  'BEGIN{FS="-"}{print $NF}' log29.txt 
/ of	,
[eric@localhost tmp]$ awk -F- '{print $NF}' log29.txt 
/ of	,
[eric@localhost tmp]$ awk -F'-' '{print $NF}' log29.txt 
14 07:28:51.494
 5045
 5230
 5040
 5050
 5550
 5310
 5400
 3110
 5450
 5280
 5070
 5410
 3100
 3210
 5600
 5610
 5620
 3150
 3200
 3190
 200
 5540
 5290
 5080
 5560
 5300
 5090
 5460
 5420
 5100
 5110
 5470
 5520
 5120
 5570
 5020
 5430
 5125
 5130
 5140
 5150
 5160
 5170
 5030
 5190
 5200
 5210
 5500
 5580
 5530
 5220
 1084719
 5240
 5250
 5320
 5260
 5270
 5390
 12123
 5510
 5440
 1
6:) Binding 'OPEN_ALERTED' to parameter: 64
 0

/ Let op greedy karakter	,
/ TODO

/ 7	. 

/ Hoeveel ? in een line	,	

$ cat log92_2.txt
and this_.ORGANIZATION_SYSTEMID in (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? , ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)

[eric@localhost tmp]$ awk 'BEGIN{FS=","}{print NF}' log29_2.txt 
61
/ Klopt	,

/ 7	. 

/ we willen in log29.txt 61 numbers tussen haakjes, ipv. ?'s	, niet de 1ste en laatste 3	, 

[eric@localhost tmp]$ awk '{count++}END{print count}' log29.txt 
/ of	,
[eric@localhost tmp]$ awk 'END{print NR}' log29.txt 
65
/ Klopt	,

[eric@localhost tmp]$ awk 'NR>1{c++}END{print c}' log29.txt 
64
[eric@localhost tmp]$ awk 'NR>1 && NR<65-2{c++}END{print c}' log29.txt 
61
/ TODO (Bepaal aantal rows	, ipv 65 hardcoded	,

[eric@localhost tmp]$ awk 'BEGIN{FS="-"}{print $NF}' log29.txt | awk 'BEGIN{printf "("}NR>1 && NR<65-2{printf $0","}END{print ")"}'
( 5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440,)

/ Bijna goed	, de laatste , moet weg	, 
/ TODO
/ Probeer zoiets als	,
awk 'NR > 1{ print prev } { prev = $0 }' log29.txt





/ Einde AWK

/ FIREBIRD PROCEDURES

/ 7	.

/ create tables script	,

[eric@localhost dsvfms]$ pwd
/home/eric/Devel/Firebird/scripts/dsvfms

$ cat ./create_sho_shi.sh
#!/usr/bin/bash

isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

drop table shi;
drop table sho;
create table sho(sys_id int,sho_id varchar(32),primary key(sys_id));
create table shi(sys_id int,sho_sysid int, shi_id varchar(32),primary key(sys_id),foreign key(sho_sysid)references sho(sys_id));

insert into sho values(11,11);
insert into sho values(12,12);
insert into sho values(13,13);
insert into shi values(1,11,1);
insert into shi values(2,11,1);
insert into shi values(3,11,1);
insert into shi values(4,12,2);
insert into shi values(5,12,2);
insert into shi values(6,12,2);
insert into shi values(7,12,2);
insert into shi values(8,12,3);
insert into shi values(9,12,3);
insert into shi values(10,13,4);
commit;
SQL

/ Als we in een ander window interactive	,
[eric@localhost Firebird]$ isql-fb -user sysdba -password masterkey first.fdb 
SQL> select*from shi;
/ dan ERR create_tables.sh
/ we moeten eerst	,
SQL> rollback/commit;

/ Dus	, 
[eric@localhost Firebird]$ isql-fb -user sysdba -password masterkey first.fdb 
SQL> select*from shi;
SQL> rollback/commit;
/ Dan in een ander window,	
[eric@localhost dsvfms]$ ./create_tables.sh 

/ 7	. 

/ update shi_id's

[eric@localhost dsvfms]$ pwd
/home/eric/Devel/Firebird/scripts/dsvfms

[eric@localhost dsvfms]$ cat update_shis.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

update shi
set shi_id=0
where sho_sysid=12;
update shi
set shi_id=cast((select max(cast(shi_id as int))from shi where sho_sysid=12)as integer)+1
where sho_sysid=12;
commit;
SQL

/ comment in isql-fb scripts gaat met /* ... */

//////////////////////
/ als we in een ander window een interactive isql-fb hebben , moeten we eerst een rollback/commit doen, anders zien we niet het result van update_shis.sh	,


/ 7	 

/ Lees	,
http://www.firebirdfaq.org/faq78/

SQL> set term ^;

SQL> create table t(i int)^
SQL> show table t^
I                               INTEGER Nullable 
SQL> create procedure p1
CON> as
CON> begin
CON> insert into t values(7);
CON> end^
SQL>  set term ;^
SQL> execute procedure p1;
SQL> select*from t;

           I 
============ 
           7 

set term ^;
create procedure p2
as
declare i integer;
begin
select*from sho into :i;
end^
set term ;^
/ TODO



/ 7	. 

SQL> select * from shi^

      SYS_ID    SHO_SYSID SHI_ID                           
============ ============ ================================ 
           1           11 1                                
           2           11 2                                
           3           11 3                                
           4           12 5                                
           5           12 6                                
           6           12 7                                
           7           12 8           

SQL> select count(distinct sho_sysid) from shi^

       COUNT 
============ 
           2 

/ 7	. 

/ fct met arg	,

[eric@localhost dsvfms]$ pwd
/home/eric/Devel/Firebird/scripts/dsvfms

[eric@localhost dsvfms]$ cat def_p2.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

drop procedure p2;
set term ^;
create procedure p2(a int)
as
begin
insert into t values(:a);
end^
set term ;^
commit;
SQL


calhost dsvfms]$ cat exec_p2.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

execute procedure p2(13);
commit;
SQL

[eric@localhost dsvfms]$ ./def_p2.sh 
/ zo vaak je wilt	,
[eric@localhost dsvfms]$ ./exec_p2.sh 
/ zo vaak je wilt	,

/ 3	. 

/ Met return value	,

[eric@localhost dsvfms]$ cat def_p3.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

drop procedure p3;
set term ^;
create procedure p3(a int)
returns(b int)
as
begin
insert into t values(:a);
select first 1 i from t into :b;
end^
set term ;^
commit;
SQL

[eric@localhost dsvfms]$ cat exec_p3.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

execute procedure p3(13) ;
commit;
SQL

$ ./def_p3.sh
[eric@localhost dsvfms]$ ./exec_p3.sh 

           B 
============ 
           7 

/ 7	. 


/ execute procedure ... returning_values ...

/ Geef in google	,
firebird loop over result set

/ Lees	,
http://www.firebirdsql.org/refdocs/langrefupd25-psql-forselect.html

/ 7	. 

$ cat def_p4.sh

#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

create procedure p4 as begin end;
drop procedure p4;
set term ^;

create procedure p4
as
declare a int;
begin
for select i from t into :a do
    begin
    insert into t2 values(:a);
    end
end^

set term ;^
commit;
SQL

$ cat exec_p4.sh

#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL
execute procedure p4;
commit;
SQL

[eric@localhost dsvfms]$ ./def_p4.sh 
[eric@localhost dsvfms]$ ./exec_p4.sh 

/ In interactive isql-fb	,

SQL> select*from t2;

           I 
============ 
           7 
          13 
          13 
          13 
          13 
          13 
          13 
          13 
          13 

/ 7	. 

/ sho , shi	,

$ cat def_p4a.sh

#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

create procedure p4a as begin end;
drop procedure p4a;
set term ^;

create procedure p4a
as
declare a int;
begin
update shi set sho_sysid=0;
for select distinct sho_sysid from shi into :a do
    begin
    update shi 
    set shi_id=cast((select max(cast(shi_id as int))from shi where sho_sysid=:a)as int)+1
    where sho_sysid=:a;
    end
end^

set term ;^
commit;
SQL

[eric@localhost dsvfms]$ cat exec_p4a.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

execute procedure p4a;
commit;
SQL

$ ./def_p4a.sh

$ ./exec_p4a.sh

SQL> rollback;
SQL> select*from shi;

      SYS_ID    SHO_SYSID SHI_ID                           
============ ============ ================================ 
           1           11 1                                
           2           11 2                                
           3           11 3                                
           4           12 1                                
           5           12 2                                
           6           12 3                                
           7           12 4                                
           8           12 5                                
           9           12 6                                
          10           13 1               

/ 	7	. 

/ Door ./def_p4a.sh onstaat er een dep op shi.sho_sysid	,

SQL> select*from RDB$DEPENDENCIES;

RDB$DEPENDENT_NAME                                                                            RDB$DEPENDED_ON_NAME                                                                          RDB$FIELD_NAME                                                                                RDB$DEPENDENT_TYPE RDB$DEPENDED_ON_TYPE 
=============================================================================== =============================================================================== =============================================================================== ================== ==================== 
P4A                                                                                           SHI                                                                                           SHI_ID                                                                                                         5                    0 
P4A                                                                                           SHI                                                                                           SHO_SYSID                                                                                                      5                    0 
P4                                                                                            T2                                                                                            I                                                                                                              5                    0 
P4                                                                                            T2                                                                                            <null>                                                                                                         5                    0 
P4                                                                                            T                                                                                             I                                                                                                              5                    0 
P4                                                                                            T                                                                                             <null>                                                                                                         5                    0 
P4A                                                                                           SHI                                                                                           <null>                                                                                                         5                    0 
P1                                                                                            T                                                                                             I                                                                                                              5                    0 
P1                                                                                            T                                                                                             <null>                                                                                                         5                    0 
P2                                                                                            T                                                                                             I                                                                                                              5                    0 
P2                                                                                            T                                                                                             <null>                                                                                                         5                    0 
P3                                                                                            T                                                                                             I                                                                                                              5                    0 
P3                                                                                            T                                                                                             <null>                                                                                                         5                    0 

/ Als we shi willen drop , moeten we eerst p4a drop! 
/ TODO

SQL> select*from RDB$RELATION_CONSTRAINTS;

RDB$CONSTRAINT_NAME                                                                           RDB$CONSTRAINT_TYPE RDB$RELATION_NAME                                                                             RDB$DEFERRABLE RDB$INITIALLY_DEFERRED RDB$INDEX_NAME                                                                                
=============================================================================== =================== =============================================================================== ============== ====================== =============================================================================== 
INTEG_1                                                                                       NOT NULL            YI                                                                                            NO             NO                     <null>                                                                                        
INTEG_2                                                                                       PRIMARY KEY         YI                                                                                            NO             NO                     RDB$PRIMARY1                                                                                  
INTEG_20                                                                                      FOREIGN KEY         XREF                                                                                          NO             NO                     RDB$FOREIGN15                                                                                 
INTEG_17                                                                                      PRIMARY KEY         X                                                                                             NO             NO                     RDB$PRIMARY12                                                                                 
INTEG_18                                                                                      PRIMARY KEY         XREF                                                                                          NO             NO                     RDB$PRIMARY13                                                                                 
INTEG_77                                                                                      NOT NULL            SHI_CP                                                                                        NO             NO                     <null>                                                                                        
INTEG_65_CP                                                                                   FOREIGN KEY         SHI_CP                                                                                        NO             NO                     INTEG_65_CP                                                                                   
INTEG_64_CP                                                                                   PRIMARY KEY         SHI_CP                                                                                        NO             NO                     INTEG_64_CP                                                                                   
INTEG_63                                                                                      PRIMARY KEY         SHO                                                                                           NO             NO                     RDB$PRIMARY58                                                                                 

/ Ook	, 
/ TODO

/ Verschil rdb$dependencies en rdb$relation_constraints
/ TODO


/ 7	.

/ copy table 	,

SQL> show table shi;
SYS_ID                          INTEGER Not Null 
SHO_SYSID                       INTEGER Nullable 
SHI_ID                          VARCHAR(32) Nullable 
CONSTRAINT INTEG_65:
  Foreign key (SHO_SYSID)    References SHO (SYS_ID)
CONSTRAINT INTEG_64:

/ we oef in interactive isql-fb	,

create table shi_cp(
SYS_ID                          INTEGER Not Null, 
SHO_SYSID                       INTEGER,  
SHI_ID                          VARCHAR(32), 
CONSTRAINT INTEG_65_cp
  Foreign key (SHO_SYSID)    References SHO (SYS_ID),
CONSTRAINT INTEG_64_cp
  Primary key (SYS_ID)
)

/ nu in scripts	,

[eric@localhost dsvfms]$ cat def_shi_cp.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

/*
drop procedure p4b;
*/
drop table shi_cp;
create table shi_cp(
SYS_ID                          INTEGER Not Null,
SHO_SYSID                       INTEGER,
SHI_ID                          VARCHAR(32),
CONSTRAINT INTEG_65_cp
  Foreign key (SHO_SYSID)    References SHO (SYS_ID),
CONSTRAINT INTEG_64_cp
  Primary key (SYS_ID)
);

commit;
SQL

[eric@localhost dsvfms]$ cat def_p4b.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

/*
drop procedure p4b;
*/
set term ^;
create procedure p4b as
declare sys_id int;
declare sho_sysid int;
declare shi_id varchar(32);
begin
	for select sys_id,sho_sysid,shi_id from shi into :sys_id,:sho_sysid,:shi_id do begin
 		insert into shi_cp values(:sys_id,:sho_sysid,:shi_id); 
	end
end^

set term ;^
commit;
SQL

[eric@localhost dsvfms]$ cat exec_p4b.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL
execute procedure p4b;
commit;
SQL

/ In interactief isql-fb	, 
SQL> rollback;
SQL> select*from shi_cp;

      SYS_ID    SHO_SYSID SHI_ID                           
============ ============ ================================ 
           1           11 1                                
           2           11 1                                
           3           11 1                                
           4           12 2                                
           5           12 2                                
           6           12 2                                
           7           12 2                                
           8           12 3                                
           9           12 3                                
          10           13 4     

/ 7	. 

/ bestaat sho table?

[eric@localhost dsvfms]$ cat def_proc.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

drop procedure p_proc;
drop procedure p_proc2;
drop procedure p_proc3;
drop procedure p_proc4;

set term ^;

create procedure p_proc as 
begin
	insert into t values(7);
end^

create procedure p_proc2 returns(a int) as
begin
	select first 1 i from t into :a;
end^

create procedure p_proc3 returns(a int) as
begin
	select 1 from rdb\$relations where rdb\$relation_name = 'SHO' into :a;
end^

create procedure p_proc4 as
begin
    if(exists(select 1 from rdb\$relations where rdb\$relation_name = 'SHO')) then 
        insert into t values(6);
end^

set term ;^
commit;
SQL

[eric@localhost dsvfms]$ cat exec_proc.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

execute procedure p_proc;
execute procedure p_proc2;
execute procedure p_proc3;
execute procedure p_proc4;
select * from t;

commit;
SQL

[eric@localhost dsvfms]$ ./exec_proc.sh 

           A 
============ 
           7 


           A 
============ 
           1 

           I 
============ 
...
           7 
           6 
           7 
           6 
           7 
           6 
           7 
           6 

/ 7	. 

/ create table sho als er nog niet is	,

$ cat def_drops.h


#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

drop procedure drop_if_exists_sho;
drop procedure drop_if_exists_shi;
drop procedure drop_if_exists_p4a;
drop procedure drop_if_exists_p4b;

set term ^;

create procedure drop_if_exists_sho as
begin
    if(exists(select 1 from rdb\$relations where rdb\$relation_name = 'SHO')) then 
      execute statement 'drop table sho';   
end^

create procedure drop_if_exists_shi as
begin
    if(exists(select 1 from rdb\$relations where rdb\$relation_name = 'SHI')) then 
        execute statement 'drop table shi';
end^

create procedure drop_if_exists_p4a as 
begin
    if(exists(select 1 from rdb\$procedures where rdb\$procedure_name = 'P4A')) then 
        execute statement 'drop procedure p4a';
end^

create procedure drop_if_exists_p4b as 
begin
    if(exists(select 1 from rdb\$procedures where rdb\$procedure_name = 'P4B')) then 
        execute statement 'drop procedure p4b';
end^

set term ;^
commit;
SQL

/////////////////////////////////
/ we kunnen	, 
    if(exists(select 1 from rdb\$relations where rdb\$relation_name = 'SHO')) then 
    	insert into t values(7);

/ maar NIET	,
    if(exists(select 1 from rdb\$relations where rdb\$relation_name = 'SHO')) then 
     	drop table sho;

/ we moeten WEL	,	
    if(exists(select 1 from rdb\$relations where rdb\$relation_name = 'SHO')) then 
     	execute statement 'drop table sho';
/ TODO

$ cat def_sho.sh

#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

execute procedure drop_if_exists_sho;
commit;

create table sho(sys_id int,sho_id varchar(32),primary key(sys_id));

insert into sho values(11,11);
insert into sho values(12,12);
insert into sho values(13,13);

commit;
SQL

/ we moeten commit in	,
execute procedure drop_if_exists_sho;
commit;
create table sho(sys_id int,sho_id varchar(32),primary key(sys_id));
/ andere deadlock	,
/ TODO

[eric@localhost dsvfms]$ ./def_sho.sh 
[eric@localhost dsvfms]$ ./def_sho.sh 
/ OK


/ 7	.

/ create sho , shi if not exists	,

$ cat def_sho_shi.sh

#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

execute procedure drop_if_exists_shi;
execute procedure drop_if_exists_sho;
commit;

create table sho(sys_id int,sho_id varchar(32),primary key(sys_id));
create table shi(sys_id int,sho_sysid int, shi_id varchar(32),primary key(sys_id),foreign key(sho_sysid)references sho(sys_id));

insert into sho values(11,11);
insert into sho values(12,12);
insert into sho values(13,13);
insert into shi values(1,11,1);
insert into shi values(2,11,1);
insert into shi values(3,11,1);
insert into shi values(4,12,2);
insert into shi values(5,12,2);
insert into shi values(6,12,2);
insert into shi values(7,12,2);
insert into shi values(8,12,3);
insert into shi values(9,12,3);
insert into shi values(10,13,4);
commit;
SQL


[eric@localhost dsvfms]$ ./def_sho_shi.sh 
[eric@localhost dsvfms]$ ./def_sho_shi.sh 
[eric@localhost dsvfms]$ ./def_sho_shi.sh 
[eric@localhost dsvfms]$ ./def_sho_shi.sh 
/ OK

/ 7	. 

/ create p4b	, die shi copies	,

/ we set voorlopig geen  fk op sho_sysid column in shi_cp	,

$ cat def_p4b.sh

#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

execute procedure drop_if_exists_p4b;
commit;

set term ^;
create procedure p4b as
declare sys_id int;
declare sho_sysid int;
declare shi_id varchar(32);
begin
    for select sys_id,sho_sysid,shi_id from shi into :sys_id,:sho_sysid,:shi_id do begin
        insert into shi_cp values(:sys_id,:sho_sysid,:shi_id); 
    end
end^
set term ;^

commit;
SQL

$ cat def_shi_cp.sh

#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

execute procedure drop_if_exists_p4b;
execute procedure drop_if_exists_shi_cp;
commit;

create table shi_cp(
SYS_ID                          INTEGER Not Null,
SHO_SYSID                       INTEGER,
SHI_ID                          VARCHAR(32),
/*CONSTRAINT INTEG_65_cp Foreign key (SHO_SYSID)  References SHO (SYS_ID)*/
CONSTRAINT INTEG_64_cp Primary key (SYS_ID)
);

commit;
SQL

/ we moeten p4b drop voordat we shi_cp drop & create	, want shi_cp.sys_id  heeft dep in p4b	, dus voor drop shi_cp moeten we eerst drop p4b	,

[eric@localhost dsvfms]$ ./def_shi_cp.sh 
[eric@localhost dsvfms]$ ./def_shi_cp.sh 
[eric@localhost dsvfms]$ ./def_p4b.sh 
[eric@localhost dsvfms]$ ./def_p4b.sh 
/ OK

[eric@localhost dsvfms]$ cat exec_p4b.sh
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

execute procedure p4b;
commit;
SQL

//////////////////////////////////////////////////////
[eric@localhost dsvfms]$ ./exec_p4b.sh 
[eric@localhost dsvfms]$ ./exec_p4b.sh 
Statement failed, SQLSTATE = 23000
violation of PRIMARY or UNIQUE KEY constraint "INTEG_64_CP" on table "SHI_CP"
-At procedure 'P4B' line: 7, col: 4
/ OK 
/ logisch
[eric@localhost dsvfms]$ ./def_shi_cp.sh 
[eric@localhost dsvfms]$ ./def_p4b.sh 
[eric@localhost dsvfms]$ ./exec_p4b.sh 
/ OK

/ we moeten p4b drop voordat we shi_cp drop & create	, want shi_cp.sys_id  heeft dep in p4b	, dus voor drop shi_cp moeten we eerst drop p4b	,
//////////////////////////////////////

/ HIER HIER HIER

/ 7	. 

[eric@localhost bin]$ cat local-db.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey "$@"

[eric@localhost bin]$ local-db.sh /home/eric/Devel/Firebird/first.fdb
Database:  /home/eric/Devel/Firebird/first.fdb, User: sysdba


calhost bin]$ local-db.sh /home/eric/DB_TAP/Dsvfms/dsvfms.fdb_20151019-000019.fdb
Database:  /home/eric/DB_TAP/Dsvfms/dsvfms.fdb_20151019-000019.fdb, User: sysdba

/ we hebben	,
[eric@localhost Dsvfms]$ sudo cp -a dsvfms.fdb_20151019-000019.fdb dsvfms.fdb_20151019-000019_cp.fdb 

[eric@localhost bin]$ local-db.sh /home/eric/DB_TAP/Dsvfms/dsvfms.fdb_20151019-000019_cp.fdb
Database:  /home/eric/DB_TAP/Dsvfms/dsvfms.fdb_20151019-000019_cp.fdb, User: sysdba




/ 7	. 

//////////////////////////////////////////
/ Dit is de volgorde	,

[eric@localhost dsvfms]$ ./def_sho_shi.sh 
[eric@localhost dsvfms]$ ./def_p4a.sh 
[eric@localhost dsvfms]$ ./exec_p4a.sh 

#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

execute procedure drop_if_exists_p4a;
execute procedure drop_if_exists_p4b;
execute procedure drop_if_exists_shi;
execute procedure drop_if_exists_sho;
commit;

create table sho(sys_id int,sho_id varchar(32),primary key(sys_id));
create table shi(sys_id int,sho_sysid int, shi_id varchar(32),primary key(sys_id),foreign key(sho_sysid)references sho(sys_id));

insert into sho values(11,11);
insert into sho values(12,12);
insert into sho values(13,13);
insert into shi values(1,11,1);
insert into shi values(2,11,1);
insert into shi values(3,11,1);
insert into shi values(4,12,2);
insert into shi values(5,12,2);
insert into shi values(6,12,2);
insert into shi values(7,12,2);
insert into shi values(8,12,3);
insert into shi values(9,12,3);
insert into shi values(10,13,4);
commit;
SQL

[eric@localhost dsvfms]$ cat def_p4a.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

execute procedure drop_if_exists_p4a;
commit;

set term ^;
create procedure p4a
as
declare a int;
begin
update shi set shi_id=0;
for select distinct sho_sysid from shi into :a do
	begin
 	update shi 
	set shi_id=cast((select max(cast(shi_id as int))from shi where sho_sysid=:a)as int)+1
	where sho_sysid=:a;
	end
end^

set term ;^
commit;
SQL

[eric@localhost dsvfms]$ cat exec_p4a.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL
execute procedure p4a;
commit;
SQL

/ 7	. 

/ algemene conditional drop	,

$ cat def_drops2.sh

#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

drop procedure drop_relation_if_exists;
drop procedure drop_procedure_if_exists;

set term ^;

create procedure drop_relation_if_exists(name varchar(32)) as 
begin
    if(exists(select 1 from rdb\$relations where rdb\$relation_name = :name)) then 
        execute statement 'drop table ' || name ;
end^

create procedure drop_procedure_if_exists(name varchar(32)) as 
begin
    if(exists(select 1 from rdb\$procedures where rdb\$procedure_name = :name)) then 
        execute statement 'drop procedure ' || name ;
end^

set term ;^
commit;
SQL

/ NB	,
    if(exists(select 1 from rdb\$relations where rdb\$relation_name = :name)) then 				/ :name NIET tussen ''	,
        execute statement 'drop table ' || name ;												/ GEEN 'drop table :name'	,

[eric@localhost dsvfms]$ pwd
/home/eric/Devel/Firebird/scripts/dsvfms
[eric@localhost dsvfms]$ ./def_drops2.sh 
[eric@localhost dsvfms]$ ./def_drops2.sh 
/ OK


$ cat def_sho2.sh

#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

execute procedure drop_procedure_if_exists('P4A');
execute procedure drop_procedure_if_exists('P4B');
execute procedure drop_relation_if_exists('SHI');
execute procedure drop_relation_if_exists('SHO');
commit;

create table sho(sys_id int,sho_id varchar(32),primary key(sys_id));

insert into sho values(11,11);
insert into sho values(12,12);
insert into sho values(13,13);

commit;
SQL

/ SAMENVATTING

/ Een keer
[eric@localhost dsvfms]$ ./def_drops2.sh

/ HIER HIER HIER

/ Volgorde	
[eric@localhost dsvfms]$ ./def_sho_shi.sh 
[eric@localhost dsvfms]$ ./def_p4a.sh 
[eric@localhost dsvfms]$ ./exec_p4a.sh 

$ cat def_drop2.sh

#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

drop procedure drop_relation_if_exists;
drop procedure drop_procedure_if_exists;

set term ^;

create procedure drop_relation_if_exists(name varchar(32)) as 
begin
	if(exists(select 1 from rdb\$relations where rdb\$relation_name = :name)) then 
		execute statement 'drop table ' || name ;
end^

create procedure drop_procedure_if_exists(name varchar(32)) as 
begin
	if(exists(select 1 from rdb\$procedures where rdb\$procedure_name = :name)) then 
		execute statement 'drop procedure ' || name ;
end^

set term ;^
commit;
SQL

[eric@localhost dsvfms]$ cat def_sho_shi.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

execute procedure drop_procedure_if_exists('P4A');
execute procedure drop_procedure_if_exists('P4B');
execute procedure drop_relation_if_exists('SHI');
execute procedure drop_relation_if_exists('SHO');
commit;

create table sho(sys_id int,sho_id varchar(32),primary key(sys_id));
create table shi(sys_id int,sho_sysid int, shi_id varchar(32),primary key(sys_id),foreign key(sho_sysid)references sho(sys_id));

insert into sho values(11,11);
insert into sho values(12,12);
insert into sho values(13,13);

insert into shi values(1,11,1);
insert into shi values(2,11,1);
insert into shi values(3,11,1);
insert into shi values(4,12,2);
insert into shi values(5,12,2);
insert into shi values(6,12,2);
insert into shi values(7,12,2);
insert into shi values(8,12,3);
insert into shi values(9,12,3);
insert into shi values(10,12,3);
insert into shi values(11,12,3);
insert into shi values(12,12,3);
insert into shi values(13,12,3);
insert into shi values(14,12,3);
insert into shi values(15,12,3);
insert into shi values(16,13,4);
commit;
SQL

[eric@localhost dsvfms]$ cat def_p4a.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

execute procedure drop_procedure_if_exists('P4A');
commit;

set term ^;
create procedure p4a
as
declare a int;
begin
update shi set shi_id=0;
for select distinct sho_sysid from shi into :a do
	begin
 	update shi 
    set shi_id=cast((select max(cast(shi_id as int))from shi where sho_sysid=:a)as int)+1
	where sho_sysid=:a;
	end
end^

set term ;^
commit;
SQL

$ cat exec_p4a.sh

#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

execute procedure p4a;
commit;
SQL

/ doe	,
[eric@localhost local]$ ./def_sho_shi.sh 
[eric@localhost local]$ ./def_p4a.sh 
[eric@localhost local]$ ./exec_p4a.sh 

/ Einde SAMENVATTING

/ SAMENVATTING 

/ DSVSOL

/ HIER HIER HIER

[eric@localhost dsvfms]$ pwd
/home/eric/Devel/Firebird/scripts/dsvfms

[eric@localhost dsvfms]$ ls
def_drops2.sh  def_rm_dups_fms.sh  exec_rm_dups_fms.sh

[eric@localhost dsvfms]$ cat def_drops2.sh 

#!/usr/bin/bash
isql-fb -user sysdba -password masterkey /home/eric/DB_TAP/Firebird/Dsvfms/dsvfms.fdb_20151019-000019.fdb <<SQL

drop procedure drop_relation_if_exists;
drop procedure drop_procedure_if_exists;

set term ^;

create procedure drop_relation_if_exists(name varchar(32)) as 
begin
	if(exists(select 1 from rdb\$relations where rdb\$relation_name = :name)) then 
		execute statement 'drop table ' || name ;
end^

create procedure drop_procedure_if_exists(name varchar(32)) as 
begin
	if(exists(select 1 from rdb\$procedures where rdb\$procedure_name = :name)) then 
		execute statement 'drop procedure ' || name ;
end^

set term ;^
commit;
SQL

/ FIXES DSVFMS  

$ pwd
/home/eric/Devel/Firebird/scripts/tmp

[eric@localhost dsvfms]$ cat def_rm_dups_fms.sh 

#!/usr/bin/bash
isql-fb -user sysdba -password masterkey /home/eric/DB_TAP/Firebird/Dsvfms/dsvfms.fdb_20151019-000019.fdb <<SQL

execute procedure drop_procedure_if_exists('RM_SHIPMENT_ITEM_ID_DUPS');
commit;

set term ^;
create procedure rm_shipment_item_id_dups as
declare a int;
begin
	update shipment_item 
	set shipment_item_id=0;

	for select distinct shipment_order_systemid from shipment_item into :a do
	begin
 		update shipment_item 
		set shipment_item_id=cast((select max(cast(shipment_item_id as int))from shipment_item where shipment_order_systemid=:a)as int)+1
		where shipment_order_systemid=:a;
	end
end^

set term ;^
commit;
SQL

[eric@localhost dsvfms]$ cat exec_rm_dups_fms.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey /home/eric/DB_TAP/Firebird/Dsvfms/dsvfms.fdb_20151019-000019.fdb <<SQL

execute procedure rm_shipment_item_id_dups;
commit;
SQL

SQL> select shipment_order_systemid, shipment_item_id,count(shipment_item_id) from shipment_item group by shipment_order_systemid, shipment_item_id having  count( shipment_order_systemid)>1;
/ GEEN	,

/ 7	. 

/ we hadden ook	,

[eric@localhost ]$ for f in $(find -maxdepth 1 -name "*.sh");do awk '{sub("\\.\\./\\.\\.","/home/eric/DB_TAP/Firebird/Local")}{print}' $f >tmp;mv tmp $f;done
/ en 	,
[eric@localhost dsvfms]$ for f in $(find -name "*.sh");do awk '{sub("000019_cp","000019")}{print}' $f >tmp;mv tmp $f;done

[eric@localhost ]$ chmod u+x $(find -name "*.sh")

SQL> select shipment_order_systemid, shipment_item_id,count(shipment_item_id) from shipment_item group by shipment_order_systemid, shipment_item_id having  count( shipment_order_systemid)>1;
...
/ Hele lijst	,

[eric@localhost dsvfms]$ ./def_drops2.sh 
Statement failed, SQLSTATE = 42000
unsuccessful metadata update
-Procedure DROP_RELATION_IF_EXISTS not found
[eric@localhost dsvfms]$ ./def_drops2.sh 
[eric@localhost dsvfms]$ ./def_drops2.sh 
[eric@localhost dsvfms]$ ./def_rm_dups_fms.sh 
[eric@localhost dsvfms]$ ./def_rm_dups_fms.sh 
[eric@localhost dsvfms]$ ./exec_rm_dups_fms.sh 

SQL> select shipment_order_systemid, shipment_item_id,count(shipment_item_id) from shipment_item group by shipment_order_systemid, shipment_item_id having  count( shipment_order_systemid)>1;
/ NIETS

/ Einde SAMENVATTING

/ SAMENVATTING 

/ product id's

SQL>  select  shipment_order_systemid,product_item_id,count(product_item_id) from tms_product_item group by shipment_order_systemid,product_item_id having count(product_item_id)>1;
...
/ hele lijst	,
...
SHIPMENT_ORDER_SYSTEMID PRODUCT_ITEM_ID                                                                         COUNT 
======================= =============================================================================== ============ 
               40071258 304475                                                                                      2 
               40137683 350043                                                                                      2 

/ HIER HIER HIER 



/ Einde SAMENVATTING


/ 7	. 

/ suspend

/ def_qt.sh / exec_qt.sh 
/ OK

/ def_rng.sh / exec_rng.sh 
/ TODO

/ def_qt2.sh / exec_qt2.sh 
/ OK

/ 13	. 

SQL> select*from t;

           I 
============ 
           1 
           2 
           3 
           4 
           5 
           6 
           7 


/ we proberen	, 

$ cat def_qt3.sh

#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

execute procedure drop_procedure_if_exists('QT3');
commit;

set term ^;
create procedure qt3 returns(a int) as
begin
    select i from t into :a;
    suspend;
end^
set term ;^

commit;
SQL

$ cat exec_qt3.sh

#!/usr/bin/bash
isql-fb -user sysdba -password masterkey ../../first.fdb <<SQL

execute procedure qt3;
commit;
SQL

[eric@localhost dsvfms]$ ./def_qt3.sh 
[eric@localhost dsvfms]$ ./exec_qt3.sh 
Statement failed, SQLSTATE = 21000
multiple rows in singleton select
-At procedure 'QT3' line: 3, col: 2

/ Lees	,
http://stackoverflow.com/questions/9447114/why-doesnt-this-sql-run-firebird-stored-procedure

/ we veranderen	,

$ cat def_qt3.sh
...
create procedure qt3 returns(a int) as
begin
    for select i from t into :a do
    	suspend;
end^
...

[eric@localhost dsvfms]$ ./def_qt3.sh 
[eric@localhost dsvfms]$ ./exec_qt3.sh 

           A 
============ 
           1 
 
/ call	,
	select*from qt3
/ of	,
	select*from qt3()

/ Lees	, 
http://www.firebirdfaq.org/faq143/

/ 7	. 

/ dates

/  Lees	,
http://edn.embarcadero.com/article/28886

SQL> select current_time from rdb$database;

 CURRENT_TIME 
============= 
16:43:15.0000 





/ Einde FIREBIRD PROCEDURES

/ FIREBIRD PROCEDURES

/ 7	. 

/ select in een procedure	,

/ we kunnen niet gewoon select in een procedure, zoals we ook update doen	, 
/ we moeten for select ... into ...

/ Moet een select in een procedure	?


[eric@localhost local]$ pwd
/home/eric/Devel/Firebird/scripts/dsvfms/local

calhost local]$ cat def_chk_rm_dups_shi_fms.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey /home/eric/DB_TAP/Firebird/Dsvfms/dsvfms.fdb_20151019-000019.fdb <<SQL

execute procedure drop_procedure_if_exists('CHECK_RM_SHIPMENT_ITEM_ID_DUPS');
commit;

set term ^;
create procedure check_rm_shipment_item_id_dups returns(sho_type varchar(30)) as
begin
	for select shipment_order_type 
	from shipment_order_type
	into :sho_type
	do
		suspend;
	end
end^

set term ;^
commit;
SQL

/ of overbodig 	,

create procedure check_rm_shipment_item_id_dups returns(sho_type varchar(30)) as
begin
	for select shipment_order_type 
	from shipment_order_type
	into :sho_type
	do
	begin
		sho_type=sho_type;
		suspend;
	end
end^

/ we zien 2 dingen	,
/ 13	.
/ we moeten varchar(30)	, 30 bijv	, NIET varchar 
create procedure check_rm_shipment_item_id_dups returns(sho_type varchar(30)) as

/ 13	. 
/ we moeten precies zo	, 
	end
end^

/ Doe nu	,
[eric@localhost local]$ ./def_chk_rm_dups_shi_fms.sh 

/ 7		.

/ Call	,
[eric@localhost dsvfms]$ local-db.sh /home/eric/DB_TAP/Firebird/Local/first.fdb
QL> show procedures;
Procedure Name                    Invalid Dependency, Type
================================= ======= =====================================
CHECK_RM_SHIPMENT_ITEM_ID_DUPS            SHIPMENT_ORDER_TYPE, Table

SQL> select * from CHECK_RM_SHIPMENT_ITEM_ID_DUPS;

SHO_TYPE                       
============================== 
GRP-TRUCK                      
INTEGRATOR                     
GRP                            
UPS                            
TNT                            
TEST       

/ NIET 	,
SQL> select * from CHECK_RM_SHIPMENT_ITEM_ID_DUPS();

/ 7	. 

/ we def de procedure die checks of er duplicates zijn	,

$ vi def_chk_rm_dups_shi_fms.sh

#!/usr/bin/bash
isql-fb -user sysdba -password masterkey /home/eric/DB_TAP/Firebird/Dsvfms/dsvfms.fdb_20151019-000019.fdb <<SQL

execute procedure drop_procedure_if_exists('CHECK_RM_SHIPMENT_ITEM_ID_DUPS');
commit;

set term ^;
create procedure check_rm_shipment_item_id_dups returns(sho_sysid int,shi_id varchar(80),count_ int) as
begin
    for select shipment_order_systemid, shipment_item_id, count(shipment_item_id)
    from shipment_item 
    group by shipment_order_systemid, shipment_item_id 
    having count(shipment_item_id)>1 
    into :sho_sysid,:shi_id,:count_
    do
        suspend;
end^

set term ;^
commit;
SQL

/ Doe	,
[eric@localhost local]$ ./def_chk_rm_dups_shi_fms.sh 


/ 13	. 

/ we def de exec script	,

[eric@localhost local]$ cat ./exec_chk_rm_dups_shi_fms.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey /home/eric/DB_TAP/Firebird/Dsvfms/dsvfms.fdb_20151019-000019.fdb <<SQL

select*from check_rm_shipment_item_id_dups;
rollback;
SQL

/ Doe	,
[eric@localhost local]$ ./exec_chk_rm_dups_shi_fms.sh 

/ 7	. 

/ we doen de check niet in een procedure	,

[eric@localhost local]$ cat exec_chk_rm_dups_shi_fms_2.sh 
#!/usr/bin/bash
isql-fb -user sysdba -password masterkey /home/eric/DB_TAP/Firebird/Dsvfms/dsvfms.fdb_20151019-000019.fdb <<SQL

select shipment_order_systemid, shipment_item_id, count(shipment_item_id)
from shipment_item 
group by shipment_order_systemid, shipment_item_id 
having count(shipment_item_id)>1 ;

rollback;
SQL

[eric@localhost local]$ ./exec_chk_rm_dups_shi_fms_2.sh 
/ OK









/ Einde FIREBIRD PROCEDURES



/ FIREBIRD VIEWS

/ 7	. 

/ we kunnen NIET een view maken met 
select*	, 

SQL> create table x2(i int,primary key(i));
SQL> create table x2ref(i int ,r int not null,primary key(i),foreign key(r)references x2(i));
SQL> create view xview as
CON> select x2.i,r2.r from x2 join x2ref r2 on r2.r=x2.i
/ OK
SQL> select*from x2;

           I 
============ 
           7 

SQL> select*from x2ref;

           I            R 
============ ============ 
           1            7 
           2            7 

SQL>  select*from xview;

           I            R 
============ ============ 
           7            7 
           7            7 




/ Einde FIREBIRD VIEWS

/ POSTGRES FUNCTIONS

/ See 
LOG_8_sep_2014.txt


[eric@localhost Manual]$ pwd
/home/eric/Devel/Postgres/scripts/Manual

/ 7	. 

/ 1ste fct	,

/ een block begint altijd met declare	, niet met begin	, 
/ als er wat te declare valt	,   anders begint block wel met begin	,

/ 13	. 

/ zonder declare	,

$ cat 40.2_a.sql

create or replace function fct1() returns int as $$
begin
    return 30;
end
$$
language plpgsql;

/ geef in interactive psql	,
foo=> create or replace function fct1() returns int as $$
foo$> begin
foo$>     return 30;
foo$> end
foo$> $$
foo-> language plpgsql;
CREATE FUNCTION							/ antwoord van postgresql	,
foo=> select fct1();
 fct1 
------
   30
(1 row)

/ 13	. 

/ met declare	,

$ cat 40.2.sql
create or replace function fct1() returns int as $$
declare
    quantity int:=30;
begin
    raise notice 'quantity is %', quantity+13;
    quantity:=50;
    return quantity;
end
$$
language plpgsql;

/ we geven deze eerst direct in interactive psql	,

foo=> create or replace function fct1() returns int as $$
foo$> declare
foo$>     quantity int:=30;
foo$> begin
foo$>     raise notice 'quantity is %', quantity+13;
foo$>     quantity:=50;
foo$>     return quantity;
foo$> end
foo$> $$
foo-> language plpgsql;
CREATE FUNCTION
foo=> select fct1();
NOTICE:  quantity is 43
 fct1 
------
   50
(1 row)

///////////////////////////////////////////////////////////////
/ we zien dus de raise notice wordt exec	, als by-product	, maar dat het result van de query wordt gegeven door de return	,

/ 13	. 

/ drop a function	,

foo=> drop function if exists fct1;
ERROR:  syntax error at or near ";"
foo=> drop function if exists fct1();
DROP FUNCTION
/ we moeten () geven	, of als er een arg is , ook het type van het arg	,

/ 13	. 

/ we laten language plpgsql weg	,

foo=> create or replace function fct1() returns int as $$
foo$> declare
foo$>     quantity int:=30;
foo$> begin
foo$>     raise notice 'quantity is %', quantity; 
foo$>     quantity:=50;
foo$>     return quantity;
foo$> end;
foo$> $$
foo-> ;
ERROR:  no language specified

/ 13	. 

/ moeten $$ of language op een aparte line	? 
/ Nee	, 

create or replace function fct1() returns int as $$
declare
    quantity int:=30;
begin
    raise notice 'Quantity here is %', quantity; -- prints 30
    quantity:=50;
    return quantity;
end; $$ language plpgsql;

/ 13	. 

/ of geen ; achter laatste end	,

create or replace function fct1() returns int as $$
declare
    quantity int:=30;
begin
    raise notice 'Quantity here is %', quantity; -- prints 30
    quantity:=50;
    return quantity;
end; $$ language plpgsql;

/ 13	. 

/ de $$ moeten staan als boven	, hieronder is ERR	, vooraan	, en achteraan	 is ERR	,

create or replace function fct1() returns int $$ as
declare
    quantity int:=30;
begin
    raise notice 'quantity is %', quantity;
    quantity:=50;
    return quantity;
$$
end 
language plpgsql;

/ 7	. 

/ <<outerblock>>

$ cat 40.2_2.sql

create or replace function fct1() returns int as $$
<<outerblock>>
declare
    quantity int:=30;
begin
    raise notice 'quantity is %', quantity;
    quantity:=50;
    -- subblock
    declare
        quantity int:=80;
    begin
        raise notice 'quantity is %', quantity;
        raise notice 'quantity outer is %', outerblock.quantity;
    end;
    raise notice 'quantity is %', quantity;
    return quantity;
end;
$$
language plpgsql;

/ geef in interactive psql	,

foo=> create or replace function fct1() returns int as $$
foo$> <<outerblock>>
foo$> declare
foo$>     quantity int:=30;
foo$> begin
foo$>     raise notice 'quantity is %', quantity;
foo$>     quantity:=50;
foo$>     -- subblock
foo$>     declare
foo$>         quantity int:=80;
foo$>     begin
foo$>         raise notice 'quantity inner is %', quantity;
foo$>         raise notice 'quantity outer is %', outerblock.quantity;
foo$>     end;
foo$>     raise notice 'quantity is %', quantity;
foo$>     return quantity;
foo$> end;
foo$> $$
foo-> language plpgsql;
CREATE FUNCTION

foo=> select fct1();
NOTICE:  quantity is 30
NOTICE:  quantity inner is 80
NOTICE:  quantity outer is 50
NOTICE:  quantity is 50
 fct1 
------
   50
(1 row)

/ 13	. 

/ outer from function	,

/ we kunnen	,

$ vi 40.2_2.sql

create or replace function fct1() returns int as $$
<<outerblock>>
declare
    quantity int:=30;
begin
    raise notice 'quantity is %', quantity;
    raise notice 'outer FOUND is %', fct1.FOUND;
...
foo=> select fct1();
NOTICE:  quantity is 30
NOTICE:  outer FOUND is f
...

/ TODO

/ 7	.

/ Lees	,
http://www.w3resource.com/PostgreSQL/pl-pgsql-declarations.php

/ 13	. 

$ vi my_sum.sql

create or replace function my_sum(m int,n int) returns int as $$ begin
    return m+n;
end $$ language plpgsql;

foo=> select my_sum(5,3);
 my_sum 
--------
      8
(1 row)

/ alles op 1 regel kan ook	,

$ vi my_sum.sql
create or replace function my_sum(m int,n int) returns int as $$ begin return m+n; end $$ language plpgsql;

/ OK

/ 13	. 

/ 1313	,

/ we oef	,

foo=> select now();
              now              
-------------------------------
 2015-10-15 09:28:52.380419-04
(1 row)

foo=> select now()+interval '2 day';
           ?column?            
-------------------------------
 2015-10-17 09:29:26.997369-04
(1 row)

foo=> select now()+3*interval '2 day';
           ?column?            
-------------------------------
 2015-10-21 09:29:36.761914-04
(1 row)

/ 1313	.

foo=> \df now
                              List of functions
   Schema   | Name |     Result data type     | Argument data types |  Type  
------------+------+--------------------------+---------------------+--------
 pg_catalog | now  | timestamp with time zone |                     | normal
(1 row)

/ 1313	,

$ vi my_date.sql

create or replace function my_date(d date,m int) returns date as $$
declare
    d2 alias for d;
    m2 alias for m;
begin
    return d2+m2*interval '2 day';
end;
$$ language plpgsql;

foo=> select my_date(cast(now()as date),2);
  my_date   
------------
 2015-10-19
(1 row)

/ we moeten dus een cast doen	,

/ 1313	, 

/ we geven my_date een andere type	,

foo=> drop function my_date(date,int);
DROP FUNCTION

/ timestamp = timestamp without timezone	, dus we moeten	, 

$ vi my_date.sql

create or replace function my_date(d timestamp with time zone,m int) returns date as $$
declare
    d2 alias for d;
    m2 alias for m;
begin
    return d2+m2*interval '2 day';
end;
$$ language plpgsql;
 
foo=> select my_date(now(),2);
  my_date   
------------
 2015-10-19
(1 row)

/ 1313	. 

/ hij  returns een date	, 

/ we willen	,

foo=> create or replace function my_date(d timestamp with time zone,m int) returns timestamp with time zone as $$
foo$> declare
foo$>     d2 alias for d;
foo$>     m2 alias for m;
foo$> begin
foo$>     return d2+m2*interval '2 day';
foo$> end;
foo$> $$ language plpgsql;
ERROR:  cannot change return type of existing function
HINT:  Use DROP FUNCTION my_date(timestamp with time zone,integer) first.

/ dus we moeten	,
foo=> drop function my_date(timestamp with time zone , int);
DROP FUNCTION

foo=> create or replace function my_date(d timestamp with time zone,m int) returns timestamp with time zone as $$
foo$> declare
foo$>     d2 alias for d;
foo$>     m2 alias for m;
foo$> begin
foo$>     return d2+m2*interval '2 day';
foo$> end;
foo$> $$ language plpgsql;
CREATE FUNCTION

foo=> select my_date(now(),2);
            my_date            
-------------------------------
 2015-10-19 09:57:32.157911-04
(1 row)

/ 13	. 

/ %type	,

foo=> \d y
            Table "public.y"
 Column |       Type        | Modifiers 
--------+-------------------+-----------
 j      | integer           | 
 t      | character varying | 

foo=> delete from y;
DELETE 1
foo=> insert into y values (1,'Eric J.');
INSERT 0 1
foo=> insert into y values (2,'Foo');
INSERT 0 1

/ je kunt in het fct arg alleen de type schrijven	, en dan met alias $1 een var def	,

$ vi my_name.sql

create or replace function my_name(int) returns varchar as $$
declare
    j2 alias for $1;
    t2 y.t%type;
begin
    select into t2 t from y
    where j=j2;

    return j2 || ',' || t2;
end
$$ language plpgsql;

foo=> select my_name(1);
  my_name  
-----------
 1,Eric J.
(1 row)

foo=> select my_name(2);
 my_name 
---------
 2,Foo
(1 row)

/ Als we in de query hierboven de where clause rm	, 
    select into t2 t from y;
/ dan zien we altijd 'Eric J'	, 
/ Wat als multiple rows returned	?
/ TODO

/ 13	. 

/ %rowtype

$ vi my_row.sql

create or replace function my_row(int) returns varchar as $$
declare
    j2 alias for $1;
    y2 y%rowtype;
begin
    select into y2 *from y
    where y.j=j2;

    return j2 || ': ' || y2.j || ', ' || y2.t;
end
$$ language plpgsql;

foo=> select my_row(1);
    my_row     
---------------
 1: 1, Eric J.
(1 row)

foo=> select my_row(2);
  my_row   
-----------
 2: 2, Foo
(1 row)

/ 13	. 

/ autocommit off gaat met \set	, 
/ dit is WH client side, dus in psql	, in iedere psql apart	, 
/ als je wilt weten wat autocommit nu is	, doe je alleen \set	,

foo=> \set
AUTOCOMMIT = 'on'
PROMPT1 = '%/%R%# '
PROMPT2 = '%/%R%# '
PROMPT3 = '>> '
VERBOSITY = 'default'
VERSION = 'PostgreSQL 9.3.5 on x86_64-redhat-linux-gnu, compiled by gcc (GCC) 4.8.3 20140624 (Red Hat 4.8.3-1), 64-bit'
DBNAME = 'foo'
USER = 'foo'
PORT = '5432'
ENCODING = 'UTF8'
LASTOID = '0'

/ we zien dat autocommit op on staat	,

foo=> \set AUTOCOMMIT off
foo=> \set
AUTOCOMMIT = 'off'
...

foo=> \set AUTOCOMMIT on  
foo=> \set
AUTOCOMMIT = 'on'
...

/ 13	. 

/ we gaan verder met	,
http://www.w3resource.com/PostgreSQL/pl-pgsql-declarations.php

/ Lees	,
http://www.postgresql.org/docs/9.4/static/datatype.html

/ bool is een alias voor boolean	,

$ vi my_not_equal.sql

create or replace function my_not_equal(i int,j int)returns bool as $$
begin
    return i <> j;
end
$$ language plpgsql;

foo=> select my_not_equal(i,j)from z;
 my_not_equal 
--------------
 t
 f
 f
 t
 t
 t
 t
(7 rows)
 







/ Einde POSTGRES FUNCTIONS


/ PCT-756

/ Voor 
Exectution, Customer shipment order search	,

/ 13	. 

/ TODO

/ user 'VanBeek'	, 
/ we zagen niet de Execution menu 	, 
/ we moesten aan role R_KLANT een privilige add	: customer-order:list
/ Dan ziet VanBeek de Execution menu	, 

/ user eric heeft role Administrator	, deze heeft NIET privilege customer-order:list	, maar ziet toch Execution menu	, 
/ TODO

/ 13	. 

/ user eric	, 

/ Ga naar een shipment order, bill to party	, en onthoud de party_id , Bill to party op het scherm, heet ook code , '9148459'

/ Ga naar configuration, administration , user party	, 
/ we zien Parties, 
/ click add, zoek op deze party_id en add	, 
Save 
/ we hebben party added aan eric
pnllogistics3=# select*from party where party_id='9148459';
-[ RECORD 1 ]----------------+---------------------
system_id                    | 26683134
is_deleted                   | 0
party_id                     | 9148459
party_type_systemid          | 26681476
organization_systemid        | 500
name                         | Gildewerk B.V.
name2                        | 
address                      | Jan van Geunsweg 10A
address2                     | 
city                         | HAARLEM
zipcode                      | 2031BD
country_systemid             | 4153
contact_name                 | Maarten Theunissen
emailaddress                 |
faxnumber                    | 023-5340965
phonenumber                  | 023-5322255
 
/ eric kan dan op Execution, Customer shipment order search	,  alle sho zien waarvoor deze party de bill to party is	, 
/ TODO

/ Einde PCT-756

/ DEBUG PCT-756

/ 7		.

/ Execution, Customer shipment order search	,

$ vi CustomerOrderSearchPage.java

shipmentorder.reference1.pnllogistics.outbound
shipmentorder.requestedstartafter.pnllogistics.outbound

/ 13	. 

public abstract class AbstractShipmentOrderViewPanel extends Panel {
		add(new Label(aLabel.getId() + ".label", new AbstractReadOnlyModel<String>() {
			@Override
			public String getObject() {
->				return new StringResourceModel("shipmentorder." + aLabel.getId() + "." + baseProduct + "."
						+ model.getObject().getShipmentOrderProcess(), model).getObject();
aLabel.getIdI()="reference1"
this.this$0.baseProduct="pnllogistics"
model.getObject().getShipmentOrderProcess()="OUTBOUND"

/s
StringResourceModel(LoadableDetachableModel).getObject() line: 120	
			transientModelObject = load();
/s
StringResourceModel.load() line: 647	
		return getString();
/s
StringResourceModel.getString() line: 503	
			value = localizer.getString(getResourceKey(), component, model, defaultValue);
/s
Localizer.getString(String, Component, IModel<?>, String) line: 313	
		String value = getStringIgnoreSettings(key, component, model, null);
/s
Localizer.getStringIgnoreSettings(String, Component, IModel<?>, String) line: 241	
				value = loader.loadStringResource(component, key);
/s
LanguageManagerStringResourceLoader.loadStringResource(Component, String) line: 46	
aKey	"shipmentorder.reference1.pnllogistics.OUTBOUND" (id=26121)	
				return getLanguageManager().getTranslation(aKey, Session.get().getLocale(), Session.get().getStyle(), true);
/s
WicketLanguageManager.getTranslation(String, Locale, String, boolean) line: 22	
		return get(aKey, aLocale, aStyle, aThrowExceptionIfNotFound);
/s
WicketLanguageManager.get(String, Locale, String, boolean) line: 71	
		// lang_properties stored in lower case
		String myFullCode = aFullCode.toLowerCase();
myFullCode	"shipmentorder.reference1.pnllogistics.outbound" (id=26284)	
		String result = fetchTranslation(myFullCode, aLocale, aStyle);
/s
WicketLanguageManager.fetchTranslation(String, Locale, String) line: 54	
		Properties props = getPropertiesFile(aLocale);
		return props.getProperty(myFullCode, null);
/t
WicketLanguageManager.get(String, Locale, String, boolean) line: 73	
		String result = fetchTranslation(myFullCode, aLocale, aStyle);
/d
result	"Requested Productcode" (id=26350)	
			return result;



/ 13	. 

/ FIX PCT-756

public class ShoDetailViewPanel extends AbstractShipmentOrderViewPanel {

	private void addRequestedDate(final String aRequestedDate) {
		Label aLabel = new Label(aRequestedDate, new PropertyModel<String>(model, "dateSetVO." + aRequestedDate));
		add(aLabel);
		add(new Label(aRequestedDate + ".label", new AbstractReadOnlyModel<String>() {
			@Override
			public String getObject() {
				return new StringResourceModel("shipmentorder." + aRequestedDate + "." + baseProduct + "." + model.getObject().getShipmentOrderProcess(), model) .getObject(); /  (*)
/ aRequestedDate="requestedStartAfter"
/ baseProduct="pnllogistics"
/ model.getObject().getShipmentOrderProcess()="OUTBOUND"
//////////////////////////
/ Er stond .toString()	, het moet zijn .getObject()	 bij (*)

		Label priceLabel = new Label("price.label", new AbstractReadOnlyModel<String>() {
			@Override
			public String getObject() {
				return new StringResourceModel("shipmentorder.price.label." + baseProduct + "." + model.getObject().getOrderProcessVO(), model).getObject();

			}

/ Nu ook .getObject()	, er stond .toString()	, 

/ Einde FIX PCT-756


/ Einde DEBUG PCT-756

/ MORGENOCHTEND OPEN


[eric@localhost dsvfms]$ local-db.sh /home/eric/DB_TAP/Firebird/Dsvfms/dsvfms.fdb_20151019-000019.fdb 
[eric@localhost dsvfms]$ local-db.sh /home/eric/DB_TAP/Firebird/Local/first.fdb
[eric@localhost ~]$ PGPASSWORD=mpopostgres@mpo psql -E -U mpopostgres pnllogistics3

[eric@localhost test]$ pwd
/home/eric/Devel/Firebird/scripts/dsvfms/test

[eric@localhost bin]$ dsvfms-db-t.sh 

[eric@localhost eclipse-jee]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee
[eric@localhost eclipse-jee-test]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee-test

[eric@localhost apache-tomcat-7.0.57]$ pwd
/home/eric/Devel/Java/Tomcat/apache-tomcat-7.0.57
[eric@localhost apache-tomcat-7.0.57]$ bin/catalina.sh jpda run

[eric@localhost trunk]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk
[eric@localhost server]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server

[eric@localhost apache-activemq-5.10.1]$ pwd
/home/eric/Devel/Java/ActiveMQ/apache-activemq-5.10.1
[eric@localhost apache-activemq-5.10.1]$ bin/activemq console

[eric@localhost wicket]$ pwd
/home/eric/Devel/Java/Wicket/wicket




/ Einde MORGENOCHTEND OPEN

/ DEPLOYMENT PSA

[eric@localhost bin]$ cat geosco-ssh-a.sh 
#!/bin/bash
echo 'h^Zgcyr&Q'
ssh vanderveldene@geosco-app-a.intermax.mp-objects.com

[eric@localhost bin]$ geosco-ssh-a.sh 
vanderveldene@geosco-app-a geosco]$ pwd
/local/apps/jboss-4.0.5.GA/server/geosco
[vanderveldene@geosco-app-a geosco]$ less deploy/postgres-ds.xml 
<datasources>
        <xa-datasource>
                <jndi-name>tmsdevDS</jndi-name>
                <track-connection-by-tx>true</track-connection-by-tx>
                <xa-datasource-class>org.postgresql.xa.PGXADataSource</xa-datasource-class>
                <xa-datasource-property name="ServerName">localhost</xa-datasource-property>
                <xa-datasource-property name="PortNumber">5432</xa-datasource-property>
                <xa-datasource-property name="DatabaseName">geosco</xa-datasource-property>
                <xa-datasource-property name="User">geosco</xa-datasource-property>
                <xa-datasource-property name="Password">de2d45045b493b021bbfa90e4f3848a9</xa-datasource-property>
                <min-pool-size>0</min-pool-size>

[eric@localhost bin]$ cat geosco-psql-a.sh 
PGPASSWORD=h^Zgcyr\&Q psql -U vanderveldene -h  geosco-app-a.intermax.mp-objects.com geosco 

geosco=> update mpo_scs_patch set status='SKIPPED' where name similar to '%570-fix%';
UPDATE 1
geosco=> commit;
WARNING:  there is no transaction in progress
COMMIT
/ Doe	,
foo=> \set AUTOCOMMIT off

/ Einde DEPLOYMENT PSA

/ POSTGRES

/ doe	, 
foo=> \set AUTOCOMMIT off

/ AUTOCOMMIT moet in capitals	,

/ als je 2 psql connecties hebt	, zie je als je een tbl create in 1	, en nog niet commit	, dan zie je hem niet in de andere	,

foo=> create table kj(i int);
CREATE TABLE
foo=> drop table kj;
DROP TABLE
foo=> create table kj(i int);
CREATE TABLE
foo=> insert into kj values(5);
INSERT 0 1
foo=> create table kj(i int);
ERROR:  relation "kj" already exists
foo=> create table lj(i int);
ERROR:  current transaction is aborted, commands ignored until end of transaction block

/ Dit komt omdat we een ERR hadden, en postgres geen nieuwe tx heeft start (zoals hij dat wel doet na een rollback of commit)	, en we dus geen command meer kunnen geven	,

/ we kunnen ook	,
foo=> set autocommit off
/ TODO

/ Einde POSTGRES

/ FIREBIRD

SQL> set transaction;
Commit current transaction (y/n)?n
Rolling back work.
SQL> set;
Print statistics:        OFF
Echo commands:           OFF
List format:             OFF
List Row Count:          OFF
Select rowcount limit:   0
Autocommit DDL:          ON
Access Plan:             OFF
Access Plan only:        OFF
Display BLOB type:       1
Column headings:         ON
Terminator:              ;
Time:                    OFF
Warnings:                ON
Bail on error:           OFF

SQL> set transaction;
Commit current transaction (y/n)?n
Rolling back work.

/ we zien dat isql-fb standaard op autocommit staat	,

/ Hoe set we autocommit on in isql-fb	?
/ TODO

/ Maar toch gaat het anders als met psql	,
/ isql-fb staat NIET op read committed	, maar WH dus op serializable	, 
/ TODO

[eric@localhost wicket]$ local-db.sh /home/eric/DB_TAP/Firebird/Local/first.fdb
/ 1ste	,
[eric@localhost wicket]$ local-db.sh /home/eric/DB_TAP/Firebird/Local/first.fdb
/ 2de 

/ In 1ste	,
SQL> create table kj;
/ In 2de	,
SQL> show table kj
I                               INTEGER Nullable 
/ In 1ste		,
SQL> insert into kj values(7);
SQL> commit;
/ In 2de	,
SQL> select*from kj;
/ NIETS	,
/ Als op read committed	, dan hadden we hem gezien	,

/ 7	. 

/ we kunnen in fb	,

SQL> recreate table kj (i int);

SQL> set term ^;
SQL> recreate procedure p1 as begin 
CON> insert into t values(13);
CON> end^
SQL> set term ;^
SQL> execute procedure p1;

SQL> recreate table kj (i int);
SQL> select*from kj;
SQL> insert into kj values (13);
SQL> insert into kj values (7);
SQL> recreate table kj (i int,s varchar(32));
Statement failed, SQLSTATE = 42000
unsuccessful metadata update
-object KJ is in use
/ TODO
/ Ook als we een select op kj doen ipv een insert	, krijgen we  deze is in use	,
/ we kunnen alleen create/recreate/drop table kj doen,	 als dit er in tx geen select/update/insert/delete op jk vooraf gingen	, 

SQL> commit;
SQL> select*from x;

           I 
============ 
           7 
          13 

SQL> recreate table kj (i int,s varchar(32));
SQL> recreate table kj (i int,s varchar(32));
SQL> recreate table kj (i int,s varchar(32));
/ OK
/ Hetzelfde geldt voor drop table	, 

SQL> rollback;
SQL> select*from kj;
SQL> drop table kj;
Statement failed, SQLSTATE = 42000
unsuccessful metadata update
-object KJ is in use

/ Dit is NIET in postgres	,
/ Daar kun je niet verder gaan in een tx als er een ERR is gebeurd	,

foo=> rollback
foo-> ;
ROLLBACK
foo=> select*from my;
ERROR:  relation "my" does not exist
LINE 1: select*from my;
                    ^
foo=> select*from mj;
ERROR:  current transaction is aborted, commands ignored until end of transaction block







 

/ Einde FIREBIRD

/ BASH

/ 7	. 

/ 13	. 

/ <(find -name "*.sql") : stdout wordt stdin	,
/ $(find -name "*.sql") : stdout wordt string	, 

/ een file toon je met cat	, een string met echo	,

/ cat kan stdin en args , net als grep	, head	,


/ 13	. 

/ cat , head: als geen arg, dan hebben ze eig. 1 argument (file) waarop ze doen wat ze moeten doen: stdin	, als ze 3 args (3 files)	, dan doen ze op elk arg  (file) wat ze moeten doen	,

/ 13.	 

/ head toont 1ste 5 regels van enigste arg (file) : stdin	,
[eric@localhost trunk]$ head -5  <(find -name "*.sql")
./isbscs/isbscs/src/sql/patch/patch-002-datawarehouse-triggers-inclusion.sql
./isbscs/isbscs/src/sql/patch/patch-003-datawarehouse-triggers-inclusion2.sql
./isbscs/isbscs/src/sql/patch/patch-004-datawarehouse-triggers-drop.sql
./isbscs/isbscs/src/sql/patch/patch-006-datawarehouse-triggers-drop.sql
./isbscs/isbscs/src/sql/patch/patch-001-datawarehouse-triggers.sql

/ head toont 1ste 3 regels van elk van de 5 args (files)	,
[eric@localhost trunk]$ head -3 $(head -5  <(find -name "*.sql"))
==> ./isbscs/isbscs/src/sql/patch/patch-002-datawarehouse-triggers-inclusion.sql <==
CREATE TRIGGER invoice_header_log
AFTER INSERT OR UPDATE OR DELETE ON invoice_header
FOR EACH ROW EXECUTE PROCEDURE record_change_trigger();

==> ./isbscs/isbscs/src/sql/patch/patch-003-datawarehouse-triggers-inclusion2.sql <==
CREATE TRIGGER customer_order_line_detail_log
AFTER INSERT OR UPDATE OR DELETE ON customer_order_line_detail
FOR EACH ROW EXECUTE PROCEDURE record_change_trigger();

==> ./isbscs/isbscs/src/sql/patch/patch-004-datawarehouse-triggers-drop.sql <==
DROP TRIGGER customer_order_line_detail_log ON customer_order_line_detail;

DROP TRIGGER service_order_detail_log ON service_order_detail;

==> ./isbscs/isbscs/src/sql/patch/patch-006-datawarehouse-triggers-drop.sql <==
DROP TRIGGER service_order_log ON service_order;

DROP TRIGGER consignment_log ON consignment;

==> ./isbscs/isbscs/src/sql/patch/patch-001-datawarehouse-triggers.sql <==
/* This patchs creates the triggers which will populate the change_log table */
CREATE TRIGGER service_order_log
AFTER INSERT OR UPDATE OR DELETE ON service_order

/ 13	. 

[eric@localhost trunk]$ cat <(find -name "*.sql")
/=
[eric@localhost trunk]$ find -name "*.sql"
./isbscs/isbscs/src/sql/patch/patch-002-datawarehouse-triggers-inclusion.sql
./isbscs/isbscs/src/sql/patch/patch-003-datawarehouse-triggers-inclusion2.sql
./isbscs/isbscs/src/sql/patch/patch-004-datawarehouse-triggers-drop.sql
./isbscs/isbscs/src/sql/patch/patch-006-datawarehouse-triggers-drop.sql
./isbscs/isbscs/src/sql/patch/patch-001-datawarehouse-triggers.sql
...

/ head toont 1ste 5 lines van z'n enigste arg (file)	, stdin	,
[eric@localhost trunk]$ head -5 <(cat <(find -name "*.sql"))
./isbscs/isbscs/src/sql/patch/patch-002-datawarehouse-triggers-inclusion.sql
./isbscs/isbscs/src/sql/patch/patch-003-datawarehouse-triggers-inclusion2.sql
./isbscs/isbscs/src/sql/patch/patch-004-datawarehouse-triggers-drop.sql
./isbscs/isbscs/src/sql/patch/patch-006-datawarehouse-triggers-drop.sql
./isbscs/isbscs/src/sql/patch/patch-001-datawarehouse-triggers.sql

/ maar als we 
[eric@localhost trunk]$ cat $(find -name "*.sql")
/ Dit is een hele lange stdout	,
/ hij gaat van elk arg de file print	, en zet ze achter elkaar: dit wordt stdout	,

[eric@localhost trunk]$ head -5 <(cat $(find -name "*.sql"))
CREATE TRIGGER invoice_header_log
AFTER INSERT OR UPDATE OR DELETE ON invoice_header
FOR EACH ROW EXECUTE PROCEDURE record_change_trigger();


/=
[eric@localhost trunk]$ head -5 <(cat $(head -1 <(find -name "*.sql")))
CREATE TRIGGER invoice_header_log
AFTER INSERT OR UPDATE OR DELETE ON invoice_header
FOR EACH ROW EXECUTE PROCEDURE record_change_trigger();


/=
[eric@localhost trunk]$ 
/ de 1ste 5 lines van de concat van alle sql files = de 1ste 5 lines van de 1ste sql file	, logisch	,

[eric@localhost trunk]$ head -5 $(cat <(find -name "*.sql"))

/ 7	. 

[eric@localhost trunk]$ grep 'patch-281' <(find -name "*.sql")
...
./module/oms/src/sql/patch/patch-281_Create Document_Type.sql

/ spatie in file geeft probleem	,

[eric@localhost trunk]$ grep -i COST_PER_SHIPMENT $(find -name "*.sql")
grep: ./module/oms/src/sql/patch/patch-281_Create: No such file or directory
grep: Document_Type.sql: No such file or directory

[eric@localhost trunk]$ grep patch-281 <(sed 's/ //' <(find -name "*.sql"))
...
./module/oms/src/sql/patch/patch-281_CreateDocument_Type.sql

/ Let op dat we <(find doen	, en geen $(find , want  in laatste geval staan alle files met spaces gescheiden van elkaar	, en die zou sed dan verwijderen	, met <(find werkt sed op elke regel)	,

/ sed kan ook meerdere args (files) hebben 	,

/ we doen		,
[eric@localhost trunk]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/trunk

[eric@localhost trunk]$ grep foo $(tail -1 <(grep patch-281  <(find -name "*.sql")))
grep: ./module/oms/src/sql/patch/patch-281_Create: No such file or directory
grep: Document_Type.sql: No such file or directory

/ Hoe kunnen we dit fix	?

/ we kunnen de file name ''	, of de space \	,

[eric@localhost trunk]$ grep CREATE './module/oms/src/sql/patch/patch-281_Create Document_Type.sql'
CREATE TABLE DOCUMENT_TYPE
CREATE UNIQUE INDEX DOCUMENT_TYPE_UK ON DOCUMENT_TYPE(DOCUMENT_TYPE)
CREATE UNIQUE INDEX RDB$PRIMARY19 ON DOCUMENT_TYPE(SYSTEM_ID)
CREATE UNIQUE INDEX DOCUMENT_TYPE_PK ON DOCUMENT_TYPE(SYSTEM_ID)
[eric@localhost trunk]$ grep CREATE ./module/oms/src/sql/patch/patch-281_Create\ Document_Type.sql
CREATE TABLE DOCUMENT_TYPE
CREATE UNIQUE INDEX DOCUMENT_TYPE_UK ON DOCUMENT_TYPE(DOCUMENT_TYPE)
CREATE UNIQUE INDEX RDB$PRIMARY19 ON DOCUMENT_TYPE(SYSTEM_ID)
CREATE UNIQUE INDEX DOCUMENT_TYPE_PK ON DOCUMENT_TYPE(SYSTEM_ID)

/ TODO




/ Einde BASH

/ OPEN IN CHROME

http://stackoverflow.com/questions/7713797/how-to-get-css-class-name-using-selenium
https://scotch.io/tutorials/submitting-ajax-forms-with-jquery
https://access.redhat.com/documentation/en-US/Fuse_ESB/4.4.1/html/Programing_EIP_Components/files/Component-Architecture-Factory.html
http://stackoverflow.com/questions/9142533/plugin-execution-not-covered-by-lifecycle-configuration-jbossas-7-ear-archetype
http://stackoverflow.com/questions/5800974/redirect-to-external-non-wicket-page-in-wicket-1-5
http://stackoverflow.com/questions/3935791/find-and-replace-words-lines-in-a-file
http://stackoverflow.com/questions/17106396/when-or-not-is-a-property-created-in-an-controllers-scope
/ google: hibernate detached entity passed to persist
http://stackoverflow.com/questions/6378526/org-hibernate-persistentobjectexception-detached-entity-passed-to-persist
http://stackoverflow.com/questions/5862680/whats-the-advantage-of-persist-vs-save-in-hibernate
http://dba.stackexchange.com/questions/23836/how-to-list-all-views-in-sql-in-postgresql
http://stackoverflow.com/questions/21115720/insert-select-in-firebird
http://www.postgresql.org/docs/9.3/static/plpgsql-declarations.html
http://www.w3resource.com/PostgreSQL/pl-pgsql-declarations.php
http://stackoverflow.com/questions/1152260/postgres-sql-to-list-table-foreign-keys
http://www.postgresql.org/docs/current/interactive/ddl-schemas.html#DDL-SCHEMAS-CATALOG
http://www.alberton.info/firebird_sql_meta_info.html#.VkIL2HW9-V7
http://stackoverflow.com/questions/6843692/how-to-get-the-name-of-a-unique-constraint-in-postgresql
http://www.postgresql.org/docs/8.3/static/functions-matching.html
http://blog.eisele.net/2011/02/high-performance-jpa-with-glassfish-and.html



/ Einde OPEN IN CHROME

/ DAO POSTGRESQL



/ Einde DAO POSTGRESQL

/ PCT-881

/ 13	. 

/ we set een b in FieldTag.doStartTag	, en continue totdat we shipfrom.tag zien	,  

Daemon Thread [http-0.0.0.0-8080-5] (Suspended (entry into method doStartTag in FieldTag))	
	DropDownFieldTag(FieldTag).doStartTag() line: 316	
	DropDownFieldTag.doStartTag() line: 174	
	shipfrom.tag line: 32	

$ vi shipfrom.tag

<%@taglib prefix="cf" uri="/WEB-INF/tld/core-functions.tld"%>

				<c:if test="${cf:property('oms', 'shipfrom.party.reference6.hidden', 'true')=='false'}">
					<mpo:field languageKey="shipfrom.reference6" name="reference6" />
				</c:if>

$ vi core-functions.tld

<function>
	<name>property</name>
    <function-class>com.mpobjects.core.ApplicationPropertyManager</function-class>
    <function-signature>
        java.lang.String  taglibGetProperty(java.lang.String,java.lang.String,java.lang.String)
    </function-signature>
</function>

/ we set een b in ApplicationPropertyManager.taglibGetProperty

/ 13	. 

/ we komen eerst in 	,
				<c:if test="${cf:property('oms', 'timezone.enabled', 'true')=='true'}">
					<mpo:timeZoneField name="timeZone" />
				</c:if>	
/s
ApplicationPropertyManager.taglibGetProperty(String, String, String) line: 136	
/=
	public static String taglibGetProperty(String aModule, String aKey, String aDefaultValue) {
aModule="oms"
aKey="timezone.enabled"
aDefaultValue=true
		return getInstance().getModuleProperty(aModule, aKey, aDefaultValue);
/s
ApplicationPropertyManager.getModuleProperty(String, String, String) line: 378	
		return getProperty(getPropertyKey(aModule, aKey), aDefaultValue);
/ getPropertyKey(aModule, aKey)=module.oms.timezone.enabled
/s
ApplicationPropertyManager.getProperty(String, String) line: 531	
		Resource myResource = AuthenticationUtils.getResource();
		if (myResource != null) {
			myReturnValue = myResource.getProperty(aKey);
null
/ (*)
			if (myReturnValue == null) {
				myReturnValue = getDatabaseProperty(aKey, null);
/s
ApplicationPropertyManager.getDatabaseProperty(String, String) line: 657	
/=
	protected String getDatabaseProperty(String aKey, String aDefaultValue) {
aKey=module.oms.timezone.enabled
aDefaultValue=null
			if (dbProperties == null) {
				loadDatabaseProperties();

/ Intermezzo

/ (*) 
			myReturnValue = myResource.getProperty(aKey);
/s
Resource.getProperty(String, String) line: 504	
	public String getProperty(String aPropertyName, String aDefaultValue) {
		String myRet = getUserProperty(aPropertyName, null);
null
		if (myRet == null) {
/ JA
			Organization myActiveOrg = getActiveOrg();
			if (myActiveOrg != null) {
				myRet = myActiveOrg.getProperty(aPropertyName, aDefaultValue);
null
/ of	,
false
/ als we in de appl bij properties_value  een organization geven, pakt hij hem hier	,


/ Einde Intermezzo

/ Intermezzo

/ loadDatabaseProperties() wordt load tijdens start server	,
/s
Thread [DeferredEventPurgeTaskTimerFactory] (Suspended (breakpoint at line 655 in ApplicationPropertyManager))	
ApplicationPropertyManager.getDatabaseProperty(String, String) line: 655	
ApplicationPropertyManager.getProperty(String, String) line: 536	
DeferredEventPurgeServiceImpl.run() line: 69	
	@Override
	@Transactional(propagation = Propagation.REQUIRES_NEW)
	public void run() {

		Authentication myAuthentication = null;
		try {
			myAuthentication = runAsService.runAsRoot();

			String myStatusTypes = ApplicationPropertyManager.getInstance().getProperty("module.event.deferred.event.purge.statusses", DEFAULT_STATUS);
...
	DelegatingTimerTask.run() line: 70	
	TimerThread.mainLoop() line: 555	
	TimerThread.run() line: 505	
/s
	private void loadDatabaseProperties() {
		try {
			dbProperties = new Properties();
			dbProperties.putAll(MpoBeanFactory.getBean(PropertiesValueDAO.class).getAllWithoutOrgAndUserAsMap());
/s
public class PropertiesValueDAOImpl extends GenericHibernateDAO<PropertiesValueVO> implements PropertiesValueDAO {
	@Override
	public HashMap<String, String> getAllWithoutOrgAndUserAsMap() {
		HashMap<String, String> properties = new HashMap<String, String>();
		List<PropertiesValueVO> myList = getAllWithoutOrgAndUser();
/s
	@Override
	public List<PropertiesValueVO> getAllWithoutOrgAndUser() {
		Criteria myCriteria = getCurrentSession().createCriteria(PropertiesValueVO.class);
		myCriteria.add(Property.forName("resource.systemId").isNull()).add(Property.forName("organization.systemId").isNull());
		myCriteria.setCacheable(true);
		return myCriteria.list();

/ we zien in /var/lib/pgsql/data/pg_log/postgresql-Wed.log

select ...
from PROPERTIES_VALUE this_ 
left outer join TMS_USER resource2_ on this_.USER_SYSTEM_ID=resource2_.SYSTEM_ID 
left outer join TMS_USER resource3_ on resource2_.CREATED_BY=resource3_.SYSTEM_ID 
left outer join ORGANIZATION organizati4_ on this_.ORGANIZATION_SYSTEM_ID=organizati4_.SYSTEM_ID 
left outer join ORGANIZATION organizati5_ on organizati4_.ORGANIZATION_GROUP=organizati5_.SYSTEM_ID 
where this_.USER_SYSTEM_ID is null 
and this_.ORGANIZATION_SYSTEM_ID is null


/ Einde Intermezzo

/ we waren in	,
	protected String getDatabaseProperty(String aKey, String aDefaultValue) {
aKey=module.oms.timezone.enabled
		try {
			if (dbProperties == null) {
				loadDatabaseProperties();
/d
			}
			return dbProperties.getProperty(aKey, aDefaultValue);
null

/ Intermezzo

pnllogistics3=# select p.property_name,v.property_value from properties_value v join properties p on v. properties_system_id=p.system_id where p.property_name like '%reference6%';
                property_name                | property_value 
---------------------------------------------+----------------
 module.oms.shipmentorder.reference6.hidden  | true
 module.oms.shipfrom.party.reference6.hidden | false
 module.oms.shipto.party.reference6.hidden   | false
(3 rows)

pnllogistics3=# select p.property_name,v.property_value from properties_value v join properties p on v. properties_system_id=p.system_id where p.property_name like '%timezone%';
 property_name | property_value 
---------------+----------------
(0 rows)

/ Einde Intermezzo

/t
ApplicationPropertyManager.getProperty(String, String) line: 540	
				myReturnValue = getDatabaseProperty(aKey, null);
/d
null
		if (myReturnValue == null) {
			myReturnValue = getApplicationProperty(aKey, aDefaultValue);
aKey=module.oms.timezone.enabled
/s
	public String getApplicationProperty(String aKey, String aDefaultValue) {
		return theProperties.getProperty(aKey, aDefaultValue);

/ Intermezzo

$ vi conf/application.properties
module.oms.timezone.enabled=false

/ we zien 'm in de src  in module/oms/oms.properties	, en bij instances	, 

/ we zien bijv	,

./pnllogistics/pnllogistics/factory/factory.properties
./pnllogistics/pnllogistics.properties
./pnllogistics/pnllogistics-build-config.properties

./geodis/geodis/factory/factory.properties
./geodis/geodis/conf/jmsbrokers/activemq.properties
./geodis/geodis/conf/jmsbrokers/default.properties
./geodis/geodis.properties
./geodis/geodis-build-config.properties

/ en in modules	,

./module/oms/factory/factory.properties
./module/oms/factory/fileobjectparent.properties
./module/oms/factory/authorization.properties
./module/oms/factory/listinput.properties
./module/oms/factory/uniquefielddao.properties
./module/oms/test/src/java/com/mpobjects/oms/dao/properties
./module/oms/oms.properties
./module/interfacing/interfacing.properties

./module/tax/tax.properties

./module/ratecalc/factory/factory.properties
./module/ratecalc/ratecalc.properties

/ er zijn ook properties files in ./module/oms/src/ 	, module/ratecalc/src	, ...

/ Einde Intermezzo

/t
ApplicationPropertyManager.getProperty(String, String) line: 544	
			myReturnValue = getApplicationProperty(aKey, aDefaultValue);
/d
false

/c

/ we komen in
$ vi shipfrom.tag
				<c:if test="${cf:property('oms', 'shipfrom.party.reference1.hidden', 'true')=='false'}">
					<mpo:field languageKey="shipfrom.reference1" name="reference1" />
				</c:if>
/s
ApplicationPropertyManager.taglibGetProperty(String, String, String) line: 136	
/=
	public static String taglibGetProperty(String aModule, String aKey, String aDefaultValue) {
aModule=oms
aKey=shipfrom.party.reference1.hidden
/s
	public String getModuleProperty(String aModule, String aKey, String aDefaultValue) {
		return getProperty(getPropertyKey(aModule, aKey), aDefaultValue);
/s
ApplicationPropertyManager.getProperty(String, String) line: 531	
				myReturnValue = getDatabaseProperty(aKey, null);
false
		if (myReturnValue == null) {
/ NEE
			myReturnValue = getApplicationProperty(aKey, aDefaultValue);
/ NIET
		return StringUtils.trimIfNotEmpty(myReturnValue);
/c
FieldTag.doStartTag() line: 316	
				if (showFieldContext()) {
true
/ TODO
					appendHeaderStart(myRet);
/s
		aBuffer.append("<tr>");
/t
					appendLabelPart(myRet);
/s
	protected void appendLabelPart(StringBuffer aBuffer) {
		aBuffer.append("<td class=\"label\">");
		aBuffer.append(getLabel());
/s
	protected String getLabel() {
		return getLabel(StringUtils.isEmpty(getLanguageKey()) ? getName() : getLanguageKey());
getLanguageKey()="shipfrom.reference1"
/s
	protected String getLabel(String aName) {
		return getLanguageManager().getByJavaName(getFieldOwner().getEntity(), aName);
/s
FieldTag(TagBase).getLanguageManager() line: 45	
		if (theLanguageManager == null) {
			theLanguageManager = new LanguageManager(getRequest());
/t
getFieldOwner().getEntity()="shipmentOrder"
/s
LanguageManager.getByJavaName(String, String) line: 366	
/=
	public String getByJavaName(String anEntityName, String aFieldName) {
anEntityName	"shipmentOrder" (id=22190)	
aFieldName	"shipfrom.reference1" (id=21765)	
		String myTableName = StringUtils.formatJavaToSql(anEntityName).toString();
shipment_order
		String myFieldName = StringUtils.formatJavaToSql(aFieldName).toString();
shipfrom.reference1
		if (StringUtils.isNotEmpty(myTableName)) {
			myRet = get(myTableName, myFieldName);
/s
LanguageManager.get(String, String) line: 258	
		} else {
...
			myFullCode = "table_" + aTableName + "_" + aField;
table_shipment_order_shipfrom.reference1
		try {
			myRet = get(myFullCode, true);
/s
	public String get(String aFullCode, boolean aThrowExceptionIfNotFound) {
		return get(aFullCode, StringUtils.EMPTY_STRING_MAP, aThrowExceptionIfNotFound);
/s
LanguageManager.get(String, Map<String,String>, boolean) line: 576	
/=
	private String get(String aFullCode, Map<String, String> aFieldMap, boolean aThrowExceptionIfNotFound) throws IndexOutOfBoundsException {
		String myFullCode = aFullCode.toLowerCase();
table_shipment_order_shipfrom.reference1

		String myProductSpecificCode = getProduct() + "." + myFullCode;
pnllogistics.table_shipment_order_shipfrom.reference1

		Properties lang = getPropertiesFile();
/s
		return getPropertiesFile(getLocale());
en_GB_pnllogistics
/t
		myRet = lang.getProperty(myProductSpecificCode, null);
Addition
		return myRet;
/t
FieldTag.appendLabelPart(StringBuffer) line: 1007	
		aBuffer.append(getLabel());
Addition
		aBuffer.append("</td>");
/t
				if (showFieldContext()) {
					appendHeaderStart(myRet);
					appendLabelPart(myRet);
/d
					appendInputPartPrefix(myRet);
					appendInputPart(myRet);




					appendInputPartPrefix(myRet);
					appendInputPart(myRet);


		return getInstance().getModuleProperty(aModule, aKey, aDefaultValue);

/ c
/ Dan shipto	,
				<c:if test="${cf:property('oms', 'shipto.party.reference2.hidden', 'true')=='false'}">
					<mpo:field languageKey="shipfrom.reference2" name="reference2" />
				</c:if>
...
ApplicationPropertyManager.getProperty(String, String) line: 531	
/=
	public String getProperty(String aKey, String aDefaultValue) {
aKey=module.oms.shipto.party.reference2.hidden
aDefaultValue=true
		if (myResource != null) {
			myReturnValue = myResource.getProperty(aKey);
null
			if (myReturnValue == null) {
				myReturnValue = getDatabaseProperty(aKey, null);
false
/c
FieldTag.doStartTag() line: 316	
				if (showFieldContext()) {
					appendHeaderStart(myRet);
					appendLabelPart(myRet);
					appendInputPartPrefix(myRet);
					appendInputPart(myRet);

/ FIX PCT-881
				<c:if test="${cf:property('oms', 'shipto.party.reference6.hidden', 'true')=='false'}">
					<mpo:field languageKey="shipfrom.reference6" name="reference6" />
				</c:if>

/ er stond	,
				<c:if test="${cf:property('tms', 'shipto.party.reference6.hidden', 'true')=='false'}">

/ Maak in db of in file property	,
module.oms.shipto.party.reference6.hidden   | false
module.oms.shipfrom.party.reference6.hidden | false

/ Einde FIX PCT-881

/ PCT-887

/ we maken een sho	,
Planning, sho , create	,
Actual product code: 3610
requested product code: 3610
customer ref: a
inco term: NA
Ship from	, From Party: ADRES_VASTE_COLLECT , Collectie-9965765-Dutchwaters
Ship to	, To party: ADRES_VASTE_COLLECT , ollectie-9841253-Nelson Schoenen
Bill to, Bill to party: Thermofischer

Save	, 

java.lang.NullPointerException at
com.mpobjects.oms.model.service.ShipmentOrderServiceImpl.applySyncFlags(ShipmentOrderServiceImpl.java:2152) at
com.mpobjects.oms.model.service.ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderServiceImpl.java:858) at
com.mpobjects.oms.model.service.ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderServiceImpl.java:829) at
...
com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderSaveAction.handleSave(ShipmentOrderSaveAction.java:91) at
com.mpobjects.oms.ratecalc.control.shipmentorder.action.ShipmentOrderSaveAction.handleSave(ShipmentOrderSaveAction.java:19) at
com.mpobjects.control.action.AbstractSaveAction.act(AbstractSaveAction.java:69) at
com.mpobjects.control.action.AbstractAction.act(AbstractAction.java:171) at
...

/ we set b	,
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).applySyncFlags(ShipmentOrderVO) line: 2143	
		String myFromPartyCode = aShipmentOrder.getFromPartyVO().getCode();
/=
			return partyId;
/t
Collectie-9965765-Dutchwaters

		String myToPartyCode = aShipmentOrder.getToPartyVO().getCode();
Collectie-9841253-Nelson Schoenen
		String myBillToPartyCode = "";
		String myEmployeeResponsiblePartyCode = "";

		if (aShipmentOrder.getBillToPartyVO() != null) {
			myBillToPartyCode = aShipmentOrder.getBillToPartyVO().getCode();
10308132
		}

		if (PartySyncFlag.PARTY_ID_CODE.equals(aShipmentOrder.getSyncFromFlag()) && StringUtils.isNotEmpty(myFromPartyCode)) {
/ JA	, "P"	,
			Party myParty = getPartyFacadeLocal().getPartyByPartyId(myFromPartyCode, aShipmentOrder);

/ Einde PCT-887

/ CEVA-15098

/ Ga naar	 wartsila, test	,
https://testservices.nl.cevalogistics.com/tmstest/wartsila/core/index_frameset
durrp
Ceva2010

configuration, finance, rate calculation, rate agreements (admin)
/ select ra met name jetpak
/ click tab rate components	,
/ open RC_PLANNED_START	, see correction type: PLANNED_START 
/ Naar welk velden wordt  wordt deze write als TODO 




/ Einde CEVA-15098kk

/ SCS-4897

/ 7	. 

[eric@localhost bin]$ cat mposcs-ssh-t.sh 
#!/bin/bash
echo 'Eric789@MPO'
ssh mposerv11 "$@"

[eric@localhost bin]$ cat mposcs-ssh-a.sh 
#!/bin/bash
echo "h^Zgcyr&Q"
ssh "vanderveldene@application-a.intermax.mp-objects.com"

/ Let op	,
/ mposcs test is 2015.01
/ mposcs acc is 2015.03

/ 7	. 

/ we build mposcs in jenkins	,
mposcs
/branches/2015.01

/ we deploy	,
eric@mposerv11:~$ sudo su - jboss
jboss@mposerv11:~$ mposcs stop
jboss@mposerv11:~$ deploy-mposcs.sh /local/apps/releases/tms-mposcs-21533-2015.01_build3392.zip /local/apps/jboss-4.0.5.GA/server/mposcs
jboss@mposerv11:~$ mposcs start track

2015-11-17 09:18:36,664 INFO  [com.mpobjects.dbpatch.DatabasePatchService] (main:) Starting patch process for war [/local/apps/jboss-4.0.5.GA/server/mposcs/deploy/mposcs.war]
...
2015-11-17 09:18:44,579 INFO  [com.mpobjects.dbpatch.DataBasePatcher] (main:) Nothing to patch

2015-11-17 09:18:45,575 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)    MUST_BE_REMOVED : bcprov-jdk16-139.jar
2015-11-17 09:18:45,582 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)    MUST_BE_REMOVED : commons-codec-1.4.jar
2015-11-17 09:18:45,584 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)    MUST_BE_REMOVED : commons-io.jar
2015-11-17 09:18:45,585 ERROR [com.mpobjects.libcheck.LibCheckService] (main:)    MUST_BE_REMOVED : commons-lang-2.4.jar
2015-11-17 09:18:45,626 ERROR [com.mpobjects.libcheck.LibCheckService] (main:) Summary: 	CHECKSUM_MISMATCH=0	MISSING=0	MUST_BE_REMOVED=4	OK=270
e

/ Deze lijst vonden we met	,
eric@mposerv11:~$ awk '/MUST_BE_REMOVED/' /local/apps/jboss-4.0.5.GA/server/mposcs/log/server.log

/ we doen	,
jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs/lib$ rm bcprov-jdk16-139.jar 
jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs/lib$ rm commons-codec-1.4.jar 
jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs/lib$ rm commons-lang-2.4.jar 
jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs/lib$ rm commons-io.jar 

/ 13	. 

/ we zien ook	,

/ Maar dit doet er niet toe	, MBeans worden haast niet meer gebruikt	, 

  93643 2015-11-17 09:18:34,909 ERROR [org.jboss.ejb.txtimer.GeneralPurposeDatabasePersistencePlugin] (main:) Cann
  93643 ot create timer table
  93644 org.jboss.deployment.DeploymentException: Error while checking if table aleady exists TIMERS; - nested thr
  93644 owable: (org.jboss.util.NestedSQLException: No matching credentials in Subject!; - nested throwable: (org.
  93644 jboss.resource.JBossResourceException: No matching credentials in Subject!))


  93903 2015-11-17 09:18:34,918 WARN  [org.jboss.system.ServiceController] (main:) Problem starting service jboss:
  93903 service=KeyGeneratorFactory,type=HiLo
  93904 org.jboss.deployment.DeploymentException: Error while checking if table aleady exists HILOSEQUENCES; - nes
  93904 ted throwable: (org.jboss.util.NestedSQLException: No matching credentials in Subject!; - nested throwable
  93904 : (org.jboss.resource.JBossResourceException: No matching credentials in Subject!))
...
  96495 --- MBeans waiting for other MBeans ---
  96496 ObjectName: jboss:service=KeyGeneratorFactory,type=HiLo
  96497   State: FAILED
  96498   Reason: org.jboss.deployment.DeploymentException: Error while checking if table aleady exists HILOSEQUEN
  96498 CES; - nested throwable: (org.jboss.util.NestedSQLException: No matching credentials in Subject!; - nested
  96498  throwable: (org.jboss.resource.JBossResourceException: No matching credentials in Subject!))
  96499   I Depend On:
  96500     jboss:service=TransactionManager
  96501     jboss.jca:service=DataSourceBinding,name=DefaultDS
  96502 


/ 7	. 

/ create user eric 	,

/ we kijken	,
eric@mposerv11:~$ less /local/apps/jboss-4.0.5.GA/server/mposcs/deploy/firebird-ds.xml 
                <connection-url>jdbc:firebirdsql://192.168.1.8//local/apps/firebird/mposcs.fdb?no_result_set_tracking&amp;defaultResultSetHoldable=true</connection-url>
                <driver-class>org.firebirdsql.jdbc.FBDriver</driver-class>
                <user-name>SYSDBA</user-name>
                <password>masterkey</password>

/ we maken	,
[eric@localhost bin]$ cat mposcs-db-t.sh 
#!/bin/bash
isql-fb -u sysdba -p masterkey mposerv8:/local/apps/firebird/mposcs.fdb

/ 7	. 

/ we build met jenkins 
mposcs
/branches/2015.03

/ we deploy op test	,

jboss@mposerv11:~/releases$ curl -u eric -O https://system.mp-objects.com/jenkins/job/SCS-OnDemand/3393/artifact/dist/tms-mposcs-21533-2015.03_build3393.zip

[eric@localhost bin]$ mposcs-db-t.sh 
Database:  mposerv8:/local/apps/firebird/mposcs.fdb, User: sysdba

jboss@mposerv11:~/releases$ mposcs stop
jboss@mposerv11:~/releases$ deploy-mposcs.sh /local/apps/releases/tms-mposcs-21533-2015.03_build3393.zip /local/apps/jboss-4.0.5.GA/server/mposcs

/ 7	. 

/ deploy tasks	,

/ de db is al backup	,
eric@mposerv8:~$ ls /backup/mpo-backup/db/
-rw-rw-r-- 1 mpo-backup mpo-backup   19111730 Nov 17 00:00 mposcs.fdb_20151117-000007.fbk.gz

/ SCS-4480

SQL> select count(*)from cost_type;

       COUNT 
============ 
          63 
SQL> select count(*)from price_type
CON> ;

       COUNT 
============ 
          56 

SQL> select count(*)from rate_component_type;

       COUNT 
============ 
         129 

/ er zijn 3 views die van cost_type afhangen	, 0 views die van price_type afhangen	,

SQL>  show table cost_type
CON> ;
SYSTEM_ID                       INTEGER Nullable 
CODE                            VARCHAR(50) Nullable 
DESCRIPTION                     VARCHAR(100) Nullable 
IS_DELETED                      SMALLINT Nullable DEFAULT 0
REASON_MANDATORY                SMALLINT Nullable 
SEQUENCE_NR                     INTEGER Nullable DEFAULT 0
REASON_MANDATORY_               SMALLINT Nullable DEFAULT 0

/ Intermezzo

/ SCS-4480 DSVFMS

//////////////////////////////////////////
/ Dit is op dsvfms	,

SQL>  select * from rdb$dependencies where rdb$field_name='SYSTEM_ID' and rdb$depended_on_name='COST_TYPE';
/ en	,
SQL>  select * from rdb$dependencies where rdb$field_name='CODE' and rdb$depended_on_name='COST_TYPE';

RDB$DEPENDENT_NAME                                                                            RDB$DEPENDED_ON_NAME                                                                          RDB$FIELD_NAME                                                                                RDB$DEPENDENT_TYPE RDB$DEPENDED_ON_TYPE 
=============================================================================== =============================================================================== =============================================================================== ================== ==================== 
FREIGHT_COST_SHIPMENT                                                                         COST_TYPE                                                                                     CODE                                                                                                           1                    0 
FUEL_COST_SHIPMENT                                                                            COST_TYPE                                                                                     CODE                                                                                                           1                    0 
OTHER_COST_SHIPMENT                                                                           COST_TYPE                                                                                     CODE                                                                                                           1                    0 


SQL> show view FREIGHT_COST_SHIPMENT;
SHIPMENT_ORDER_SYSTEMID         INTEGER Nullable 
AMOUNT                          DECIMAL(12, 5) Nullable 
View Source:
==== ======
SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.AMOUNT 
FROM SHIPMENT_ORDER_COST_PART SOCP 
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID 
WHERE SOC.COST_TYPE_SYSTEMID IN (
	SELECT SYSTEM_ID 
	FROM COST_TYPE 
	WHERE CODE='FREIGHT')

QL> show view FUEL_COST_SHIPMENT;
SHIPMENT_ORDER_SYSTEMID         INTEGER Nullable 
AMOUNT                          DECIMAL(12, 5) Nullable 
View Source:
==== ======
SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, SOCP.AMOUNT 
FROM SHIPMENT_ORDER_COST_PART SOCP 
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID 
WHERE SOC.COST_TYPE_SYSTEMID IN (
	SELECT SYSTEM_ID 
	FROM COST_TYPE 
	WHERE CODE='FUEL')

SQL> show view other_cost_shipment;
SHIPMENT_ORDER_SYSTEMID         INTEGER Expression
AMOUNT                          BIGINT Expression
View Source:
==== ======
SELECT SOCP.SHIPMENT_ORDER_SYSTEMID, sum(SOCP.AMOUNT) 
FROM SHIPMENT_ORDER_COST_PART SOCP 
JOIN SERVICE_ORDER_COST SOC ON SOC.SYSTEM_ID=SOCP.SERVICE_ORDER_COST_SYSTEMID 
WHERE SOC.COST_TYPE_SYSTEMID NOT IN (
	SELECT SYSTEM_ID 
	FROM COST_TYPE 
	WHERE CODE='FREIGHT' OR CODE='FUEL') 
group by SOCP.SHIPMENT_ORDER_SYSTEMID

SQL>  select * from rdb$dependencies where rdb$field_name='DESCRIPTION' and rdb$depended_on_name='COST_TYPE';
SQL>  select * from rdb$dependencies where rdb$field_name='IS_DELETED' and rdb$depended_on_name='COST_TYPE';
SQL>  select * from rdb$dependencies where rdb$field_name='REASON_MANDATORY' and rdb$depended_on_name='COST_TYPE'; 
SQL>  select * from rdb$dependencies where rdb$field_name='SEQUENCE_NR' and rdb$depended_on_name='COST_TYPE'; SQL>  select * from rdb$dependencies where rdb$field_name='REASON_MANDATORY_' and rdb$depended_on_name='COST_TYPE';
SQL>  select * from rdb$dependencies where rdb$field_name='REASON_MANDATORY' and rdb$depended_on_name='COST_TYPE';

SQL> show table price_type;
SYSTEM_ID                       INTEGER Nullable 
CODE                            VARCHAR(50) Nullable 
DESCRIPTION                     VARCHAR(100) Nullable 
IS_DELETED                      SMALLINT Nullable DEFAULT 0
REASON_MANDATORY                SMALLINT Nullable 
SEQUENCE_NR                     INTEGER Nullable DEFAULT 0

SQL>  select * from rdb$dependencies where rdb$field_name='SYSTEM_ID' and rdb$depended_on_name='PRICE_TYPE';
SQL>  select * from rdb$dependencies where rdb$field_name='COST' and rdb$depended_on_name='PRICE_TYPE';
SQL>  select * from rdb$dependencies where rdb$field_name='CODE' and rdb$depended_on_name='PRICE_TYPE';
SQL>  select * from rdb$dependencies where rdb$field_name='DESCRIPTION' and rdb$depended_on_name='PRICE_TYPE';
SQL>  select * from rdb$dependencies where rdb$field_name='IS_DELETED' and rdb$depended_on_name='PRICE_TYPE';
SQL>  select * from rdb$dependencies where rdb$field_name='REASON_MANDATORY' and rdb$depended_on_name='PRICE_TYPE';
SQL>  select * from rdb$dependencies where rdb$field_name='SEQUENCE_NR' and rdb$depended_on_name='PRICE_TYPE'; 

/ we zien dat cost_type en price_type NIET in hibernate mappings voorkomen	, 

/ we passen de views aan	,
/ TODO

/ SCS-4480 DSVFMS


SQL> select * from rdb$dependencies where rdb$field_name='SYSTEM_ID' and rdb$depended_on_name='COST_TYPE';
SQL> select * from rdb$dependencies where rdb$field_name='CODE' and rdb$depended_on_name='COST_TYPE';
SQL> select * from rdb$dependencies where rdb$field_name='DESCRIPTION' and rdb$depended_on_name='COST_TYPE';
SQL> select * from rdb$dependencies where rdb$field_name='IS_DELETED' and rdb$depended_on_name='COST_TYPE';
SQL> select * from rdb$dependencies where rdb$field_name='REASON_MANDATORY' and rdb$depended_on_name='COST_TYPE';
SQL> select * from rdb$dependencies where rdb$field_name='SEQUENCE_NR' and rdb$depended_on_name='COST_TYPE';

SQL> select * from rdb$dependencies where rdb$field_name='SYSTEM_ID' and rdb$depended_on_name='PRICE_TYPE';
SQL> select * from rdb$dependencies where rdb$field_name='CODE' and rdb$depended_on_name='PRICE_TYPE';
SQL> select * from rdb$dependencies where rdb$field_name='DESCRIPTION' and rdb$depended_on_name='PRICE_TYPE';
SQL> select * from rdb$dependencies where rdb$field_name='IS_DELETED' and rdb$depended_on_name='PRICE_TYPE';
SQL> select * from rdb$dependencies where rdb$field_name='REASON_MANDATORY' and rdb$depended_on_name='PRICE_TYPE'; 
SQL> select * from rdb$dependencies where rdb$field_name='SEQUENCE_NR' and rdb$depended_on_name='PRICE_TYPE'; 

/ Nu gaan we de deploy task doen	,

SQL> drop table cost_type;
CREATE VIEW COST_TYPE (SYSTEM_ID, CODE, DESCRIPTION, IS_DELETED, REASON_MANDATORY, SEQUENCE_NR) AS 
select rct.SYSTEM_ID,rct.CODE,rct.DESCRIPTION,rct.IS_DELETED, rct.REASON_MANDATORY, rct.SEQUENCE_NR 
from RATE_COMPONENT_TYPE rct 
where rct.RCT_GROUP = 'COST'; 

drop table price_type; 

CREATE VIEW PRICE_TYPE (SYSTEM_ID, CODE, DESCRIPTION, IS_DELETED, REASON_MANDATORY, SEQUENCE_NR) AS 
select rct.SYSTEM_ID,rct.CODE,rct.DESCRIPTION,rct.IS_DELETED, rct.REASON_MANDATORY, rct.SEQUENCE_NR 
from RATE_COMPONENT_TYPE rct 
where rct.RCT_GROUP = 'PRICE'; 



/ OK


/ SCS-4418

SQL> select shipment_order_systemid, shipment_item_id, count(1) from shipment_item group by shipment_order_systemid, shipment_item_id having count(1)>1; 
/ GEEN	,
SQL> select SHIPMENT_ORDER_SYSTEMID, PRODUCT_ITEM_ID from TMS_PRODUCT_ITEM group by SHIPMENT_ORDER_SYSTEMID, PRODUCT_ITEM_ID having count(1)>1;
/ GEEN	,

/ SCS-3172 

SELECT fd1.SYSTEM_ID as KEEP, fd2.SYSTEM_ID as TO_BE_REMOVED, fd1.NAME 
FROM FUNCTION_DEFINITION fd1 
join FUNCTION_DEFINITION fd2 ON fd1.SYSTEM_ID < fd2.SYSTEM_ID and fd1.NAME = fd2.NAME 
ORDER BY fd1.NAME, fd1.SYSTEM_ID
/ NIETS

/ SCS-2286

jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs$ sha1sum $(find -name "*shiftone-cache*")
e6b2ce4d80ea53f86ee858af2c07a6565d448530  ./lib/shiftone-cache-mpo.jar
/ OK

/ SCS-2694

jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs$ shasum $(find -name catalina.jar)
bf6753ec68008553083e5d023d7f25daa22ceea0  ./deploy/jbossweb-tomcat55.sar/catalina.jar
/ OK

/ SCS-4534

/ NOT done	,
/ we have jaybird-full-2.1.6.jar	, 
/ TODO

/ SCS-4799

/ NIETS	, is er al	,

/ SCS-4891
/ Al deze views zijn er niet	,

/ 7	. 

/ we hadden al deployed	, nu start	,

jboss@mposerv11:~/releases$ mposcs start track
/ Het gaat al fout	,

jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs$ awk 'NR>113670 && /MUST_BE_REMOVED/ && /.jar/{print $8}' log/server.log
activeio-core-3.1.2.jar
activemq-core-5.3.0.jar
activemq-pool-5.3.0.jar
activemq-ra-5.3.0.jar
...
boss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs$ wc <(awk 'NR>113670 && /MUST_BE_REMOVED/ && /.jar/{print $8}' log/server.log )
     36      36     910 /dev/fd/63

jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs$ wc <(awk 'NR>113670 && /MISSING/ && /.jar/{print $8}' log/server.log )
     37      37    1102 /dev/fd/63

/ Intermezzo

/ $ echo "$(awk ...)" verschijnen elk op 1 line	, zonder "" allen op 1 line	,

jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs$ echo $(awk 'NR>113670 && /MUST_BE_REMOVED/ && /.jar/{print $8}' log/server.log)
activeio-core-3.1.2.jar activemq-core-5.3.0.jar activemq-pool-5.3.0.jar activemq-ra-5.3.0.jar aspectjweaver-1.7.2.jar bcprov-jdk16-1.46.jar commons-pool.jar ehcache-1.5.0.jar hibernate3.jar postgresql-9.2-1003.jdbc4.jar quartz-1.6.0.jar spring-agent.jar spring-aop-3.2.7.jar spring-aspects-3.2.7.jar spring-beans-3.2.7.jar spring-context-3.2.7.jar spring-context-support-3.2.7.jar spring-core-3.2.7.jar spring-expression-3.2.7.jar spring-framework-bom-3.2.7.jar spring-instrument-3.2.7.jar spring-instrument-tomcat-3.2.7.jar spring-jdbc-3.2.7.jar spring-jms-3.2.7.jar spring-orm-3.2.7.jar spring-oxm-3.2.7.jar spring-security-config-3.2.5.RELEASE.jar spring-security-core-3.2.5.RELEASE.jar spring-security-saml2-core-1.0.0.RELEASE.jar spring-security-web-3.2.5.RELEASE.jar spring-test-3.2.7.jar spring-tx-3.2.7.jar spring-web-3.2.7.jar spring-webmvc-3.2.7.jar spring-webmvc-portlet-3.2.7.jar wiquery-1.2.3.jar

jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs$ echo "$(awk 'NR>113670 && /MUST_BE_REMOVED/ && /.jar/{print $8}' log/server.log)"
activeio-core-3.1.2.jar
activemq-core-5.3.0.jar
activemq-pool-5.3.0.jar
activemq-ra-5.3.0.jar
aspectjweaver-1.7.2.jar
bcprov-jdk16-1.46.jar
commons-pool.jar
ehcache-1.5.0.jar
...

/ Einde Intermezzo

jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs$ echo "cd lib;rm -f" $(awk 'NR>113670 && /MUST_BE_REMOVED/ && /.jar/{print $8}' log/server.log)
cd lib;rm -f activeio-core-3.1.2.jar activemq-core-5.3.0.jar activemq-pool-5.3.0.jar activemq-ra-5.3.0.jar aspectjweaver-1.7.2.jar bcprov-jdk16-1.46.jar commons-pool.jar ehcache-1.5.0.jar hibernate3.jar postgresql-9.2-1003.jdbc4.jar quartz-1.6.0.jar spring-agent.jar spring-aop-3.2.7.jar spring-aspects-3.2.7.jar spring-beans-3.2.7.jar spring-context-3.2.7.jar spring-context-support-3.2.7.jar spring-core-3.2.7.jar spring-expression-3.2.7.jar spring-framework-bom-3.2.7.jar spring-instrument-3.2.7.jar spring-instrument-tomcat-3.2.7.jar spring-jdbc-3.2.7.jar spring-jms-3.2.7.jar spring-orm-3.2.7.jar spring-oxm-3.2.7.jar spring-security-config-3.2.5.RELEASE.jar spring-security-core-3.2.5.RELEASE.jar spring-security-saml2-core-1.0.0.RELEASE.jar spring-security-web-3.2.5.RELEASE.jar spring-test-3.2.7.jar spring-tx-3.2.7.jar spring-web-3.2.7.jar spring-webmvc-3.2.7.jar spring-webmvc-portlet-3.2.7.jar wiquery-1.2.3.jar


/ Intermezzo

/ TODO BASH

jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs$ awk '{print "rm -f"}{print}' <(awk 'NR>113670 && /MISSING/ && /.jar/{print $8}' log/server.log)
rm -f
activeio-core-3.1.4.jar
rm -f
activemq-broker-5.10.2.jar
rm -f
activemq-client-5.10.2.jar
...

boss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs$ awk '{print "rm -f" $0}' <(awk 'NR>113670 && /MISSING/ && /.jar/{print $8}' log/server.log) 
rm -factiveio-core-3.1.4.jar
rm -factivemq-broker-5.10.2.jar
rm -factivemq-client-5.10.2.jar
rm -factivemq-kahadb-store-5.10.2.jar
...

jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs$ awk 'BEGIN{print "rm -f"}1' <(echo $(awk 'NR>113670 && /MISSING/ && /.jar/{print $8}' log/server.log))
rm -f
activeio-core-3.1.4.jar activemq-broker-5.10.2.jar	...
/ TODO (Bijna)	,

/ Kijk ook naar	,
for f in $(find -maxdepth 1 -name "*.sh");do awk '{sub("\\.\\./\\.\\.","/home/eric/DB_TAP/Firebird/Local")}{print}' $f >tmp;mv tmp $f;done
/ TODO

/ Einde Intermezzo

/ 7	. 

/ uiteindelijk moeten we	,

/ op mposerv11	,
rm -f activeio-core-3.1.2.jar activemq-core-5.3.0.jar activemq-pool-5.3.0.jar activemq-ra-5.3.0.jar aspectjweaver-1.7.2.jar bcprov-jdk16-1.46.jar commons-pool.jar ehcache-1.5.0.jar hibernate3.jar postgresql-9.2-1003.jdbc4.jar quartz-1.6.0.jar spring-agent.jar spring-aop-3.2.7.jar spring-aspects-3.2.7.jar spring-beans-3.2.7.jar spring-context-3.2.7.jar spring-context-support-3.2.7.jar spring-core-3.2.7.jar spring-expression-3.2.7.jar spring-framework-bom-3.2.7.jar spring-instrument-3.2.7.jar spring-instrument-tomcat-3.2.7.jar spring-jdbc-3.2.7.jar spring-jms-3.2.7.jar spring-orm-3.2.7.jar spring-oxm-3.2.7.jar spring-security-config-3.2.5.RELEASE.jar spring-security-core-3.2.5.RELEASE.jar spring-security-saml2-core-1.0.0.RELEASE.jar spring-security-web-3.2.5.RELEASE.jar spring-test-3.2.7.jar spring-tx-3.2.7.jar spring-web-3.2.7.jar spring-webmvc-3.2.7.jar spring-webmvc-portlet-3.2.7.jar wiquery-1.2.3.jar

/ op laptop	,
scp activeio-core-3.1.4.jar activemq-broker-5.10.2.jar activemq-client-5.10.2.jar activemq-kahadb-store-5.10.2.jar activemq-openwire-legacy-5.10.2.jar activemq-protobuf-1.1.jar activemq-spring-5.10.2.jar aspectjweaver-1.7.4.jar bcprov-jdk15on-1.52.jar commons-csv-1.1.jar commons-pool-1.5.7.jar ehcache-2.10.0.jar hawtbuf-1.10.jar hibernate3.6.10.mpo.1.jar jackson-annotations-2.6.0.jar jackson-core-2.6.0.jar jackson-databind-2.6.0.jar postgresql-9.4-1200.jdbc4.jar quartz-1.8.6.jar spring-aop-3.2.14.RELEASE.jar spring-aspects-3.2.14.RELEASE.jar spring-beans-3.2.14.RELEASE.jar spring-context-3.2.14.RELEASE.jar spring-context-support-3.2.14.RELEASE.jar spring-core-3.2.14.RELEASE.jar spring-expression-3.2.14.RELEASE.jar spring-jdbc-3.2.14.RELEASE.jar spring-jms-3.2.14.RELEASE.jar spring-orm-3.2.14.RELEASE.jar spring-security-config-3.2.8.RELEASE.jar spring-security-core-3.2.8.RELEASE.jar spring-security-saml2-core-1.0.1.RELEASE.jar spring-security-web-3.2.8.RELEASE.jar spring-test-3.2.14.RELEASE.jar spring-tx-3.2.14.RELEASE.jar spring-web-3.2.14.RELEASE.jar wiquery-1.2.3.2-20150604.122120-1.jar eric@mposervi11:Downloads/2015.03
/ Naar /local/apps/jboss-4.0.5.GA/server/mposcs/lib/ : Permission denied

/ Op mposerv11	,
eric@mposerv11:~$ wc <(find Downloads/2015.03/ -name "*.jar")
     37      37    1768 /dev/fd/63
jboss@mposerv11:/home/INTERNAL/eric$ rsync -avz Downloads/2015.03/ /local/apps/jboss-4.0.5.GA/server/mposcs/lib/
/ OK

/ 13	. 

/ we hadden per ongeluk in pnloms/lib cp	,

/we doen	.
jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/pnloms/lib$ echo $(awk '/Nov 17/{print $9}' <(ls -ltr))

aspectjweaver-1.7.4.jar activemq-spring-5.10.2.jar activemq-protobuf-1.1.jar activemq-openwire-legacy-5.10.2.jar activemq-kahadb-store-5.10.2.jar activemq-client-5.10.2.jar activemq-broker-5.10.2.jar activeio-core-3.1.4.jar spring-security-core-3.2.8.RELEASE.jar spring-security-config-3.2.8.RELEASE.jar spring-orm-3.2.14.RELEASE.jar spring-jms-3.2.14.RELEASE.jar spring-jdbc-3.2.14.RELEASE.jar spring-expression-3.2.14.RELEASE.jar spring-core-3.2.14.RELEASE.jar spring-context-support-3.2.14.RELEASE.jar spring-context-3.2.14.RELEASE.jar spring-beans-3.2.14.RELEASE.jar spring-aspects-3.2.14.RELEASE.jar spring-aop-3.2.14.RELEASE.jar quartz-1.8.6.jar postgresql-9.4-1200.jdbc4.jar jackson-databind-2.6.0.jar jackson-core-2.6.0.jar jackson-annotations-2.6.0.jar hibernate3.6.10.mpo.1.jar hawtbuf-1.10.jar ehcache-2.10.0.jar commons-pool-1.5.7.jar commons-csv-1.1.jar bcprov-jdk15on-1.52.jar wiquery-1.2.3.2-20150604.122120-1.jar spring-web-3.2.14.RELEASE.jar spring-tx-3.2.14.RELEASE.jar spring-test-3.2.14.RELEASE.jar spring-security-web-3.2.8.RELEASE.jar spring-security-saml2-core-1.0.1.RELEASE.jar

/ en we doen met de hand	, 
$ rm -f ...

/ 13	. 


/ we hadden	,
boss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs$ wc <(awk 'NR>113670 && /MUST_BE_REMOVED/ && /.jar/{print $8}' log/server.log )
     36      36     910 /dev/fd/63

jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs$ wc <(awk 'NR>113670 && /MISSING/ && /.jar/{print $8}' log/server.log )
     37      37    1102 /dev/fd/63

/ Zijn ze allemaal in dsvfms/lib	?

[eric@localhost lib]$ wc  <(ls -ltr activeio-core-3.1.4.jar activemq-broker-5.10.2.jar activemq-client-5.10.2.jar activemq-kahadb-store-5.10.2.jar activemq-openwire-legacy-5.10.2.jar activemq-protobuf-1.1.jar activemq-spring-5.10.2.jar aspectjweaver-1.7.4.jar bcprov-jdk15on-1.52.jar commons-csv-1.1.jar commons-pool-1.5.7.jar ehcache-2.10.0.jar hawtbuf-1.10.jar hibernate3.6.10.mpo.1.jar jackson-annotations-2.6.0.jar jackson-core-2.6.0.jar jackson-databind-2.6.0.jar postgresql-9.4-1200.jdbc4.jar quartz-1.8.6.jar spring-aop-3.2.14.RELEASE.jar spring-aspects-3.2.14.RELEASE.jar spring-beans-3.2.14.RELEASE.jar spring-context-3.2.14.RELEASE.jar spring-context-support-3.2.14.RELEASE.jar spring-core-3.2.14.RELEASE.jar spring-expression-3.2.14.RELEASE.jar spring-jdbc-3.2.14.RELEASE.jar spring-jms-3.2.14.RELEASE.jar spring-orm-3.2.14.RELEASE.jar spring-security-config-3.2.8.RELEASE.jar spring-security-core-3.2.8.RELEASE.jar spring-security-saml2-core-1.0.1.RELEASE.jar spring-security-web-3.2.8.RELEASE.jar spring-test-3.2.14.RELEASE.jar spring-tx-3.2.14.RELEASE.jar spring-web-3.2.14.RELEASE.jar wiquery-1.2.3.2-20150604.122120-1.jar)
     37     333    2767 /dev/fd/63
/ JA



 

/ Intermezzo

/ Lees	, 
http://stackoverflow.com/questions/17984958/what-does-it-mean-in-shell-when-we-put-a-command-inside-dollar-sign-and-parenthe
/ $(echo ...) is command substitution	,
/ == `echo ...`	,

/ Lees	,
http://www.tldp.org/LDP/abs/html/commandsub.html#COMMANDSUBREF
Using echo to output an unquoted variable set with command substitution removes trailing newlines characters from the output of the reassigned command(s). T

/ 13	. 

/ ook	,

/ TODO BASH

[eric@localhost server]$ grep 'local-tx-datasource' $(find -name postgres-ds.xml)
./isbscs/deploy/postgres-ds.xml:	<local-tx-datasource>
./isbscs/deploy/postgres-ds.xml:        </local-tx-datasource>
./geosco/deploy/postgres-ds.xml:	<local-tx-datasource>
./geosco/deploy/postgres-ds.xml:        </local-tx-datasource>
...
/ OK

[eric@localhost server]$ grep 'local-tx-datasource' <(find -name postgres-ds.xml)
/ OK

[eric@localhost server]$ grep 'local-tx-datasource' "$(find -name postgres-ds.xml)"
grep: ./isbscs/deploy/postgres-ds.xml
./geosco/deploy/postgres-ds.xml
./2014.01_mpo/deploy/postgres-ds.xml
./pnllogistics/deploy/postgres-ds.xml
./pnltms/deploy/postgres-ds.xml
./mpo/deploy/postgres-ds.xml
./pnloms/deploy/postgres-ds.xml
./bard/deploy/postgres-ds.xml
./mposcs/deploy/postgres-ds.xml: No such file or directory

/ Dus "$(find ...)" is string met newlines er in	, door "" worden deze bewaard	,

/ echo doet dit ook	, dus echo is net als find	,

[eric@localhost server]$ echo $(find -name postgres-ds.xml)
./isbscs/deploy/postgres-ds.xml ./geosco/deploy/postgres-ds.xml ./2014.01_mpo/deploy/postgres-ds.xml ./pnllogistics/deploy/postgres-ds.xml ./pnltms/deploy/postgres-ds.xml ./mpo/deploy/postgres-ds.xml ./pnloms/deploy/postgres-ds.xml ./bard/deploy/postgres-ds.xml ./mposcs/deploy/postgres-ds.xml

[eric@localhost server]$ echo "$(find -name postgres-ds.xml)"
./isbscs/deploy/postgres-ds.xml
./geosco/deploy/postgres-ds.xml
./2014.01_mpo/deploy/postgres-ds.xml
./pnllogistics/deploy/postgres-ds.xml
./pnltms/deploy/postgres-ds.xml
./mpo/deploy/postgres-ds.xml
./pnloms/deploy/postgres-ds.xml
./bard/deploy/postgres-ds.xml
./mposcs/deploy/postgres-ds.xml

/ we zien dat zonder "" de \n een space wordt	,

[eric@localhost server]$ od -t x1 -t c <(echo "$(find -name postgres-ds.xml)")
0000000  2e  2f  69  73  62  73  63  73  2f  64  65  70  6c  6f  79  2f
          .   /   i   s   b   s   c   s   /   d   e   p   l   o   y   /
0000020  70  6f  73  74  67  72  65  73  2d  64  73  2e  78  6d  6c  0a
          p   o   s   t   g   r   e   s   -   d   s   .   x   m   l  \n
0000040  2e  2f  67  65  6f  73  63  6f  2f  64  65  70  6c  6f  79  2f
          .   /   g   e   o   s   c   o   /   d   e   p   l   o   y   /
0000060  70  6f  73  74  67  72  65  73  2d  64  73  2e  78  6d  6c  0a
          p   o   s   t   g   r   e   s   -   d   s   .   x   m   l  \n
0000100  2e  2f  32  30  31  34  2e  30  31  5f  6d  70  6f  2f  64  65
          .   /   2   0   1   4   .   0   1   _   m   p   o   /   d   e
0000120  70  6c  6f  79  2f  70  6f  73  74  67  72  65  73  2d  64  73
          p   l   o   y   /   p   o   s   t   g   r   e   s   -   d   s
0000140  2e  78  6d  6c  0a  2e  2f  70  6e  6c  6c  6f  67  69  73  74
          .   x   m   l  \n   .   /   p   n   l   l   o   g   i   s   t
0000160  69  63  73  2f  64  65  70  6c  6f  79  2f  70  6f  73  74  67
          i   c   s   /   d   e   p   l   o   y   /   p   o   s   t   g
0000200  72  65  73  2d  64  73  2e  78  6d  6c  0a  2e  2f  70  6e  6c
          r   e   s   -   d   s   .   x   m   l  \n   .   /   p   n   l
0000220  74  6d  73  2f  64  65  70  6c  6f  79  2f  70  6f  73  74  67
          t   m   s   /   d   e   p   l   o   y   /   p   o   s   t   g
0000240  72  65  73  2d  64  73  2e  78  6d  6c  0a  2e  2f  6d  70  6f
          r   e   s   -   d   s   .   x   m   l  \n   .   /   m   p   o
0000260  2f  64  65  70  6c  6f  79  2f  70  6f  73  74  67  72  65  73
          /   d   e   p   l   o   y   /   p   o   s   t   g   r   e   s
0000300  2d  64  73  2e  78  6d  6c  0a  2e  2f  70  6e  6c  6f  6d  73
          -   d   s   .   x   m   l  \n   .   /   p   n   l   o   m   s
0000320  2f  64  65  70  6c  6f  79  2f  70  6f  73  74  67  72  65  73
          /   d   e   p   l   o   y   /   p   o   s   t   g   r   e   s
0000340  2d  64  73  2e  78  6d  6c  0a  2e  2f  62  61  72  64  2f  64
          -   d   s   .   x   m   l  \n   .   /   b   a   r   d   /   d
0000360  65  70  6c  6f  79  2f  70  6f  73  74  67  72  65  73  2d  64
          e   p   l   o   y   /   p   o   s   t   g   r   e   s   -   d
0000400  73  2e  78  6d  6c  0a  2e  2f  6d  70  6f  73  63  73  2f  64
          s   .   x   m   l  \n   .   /   m   p   o   s   c   s   /   d
0000420  65  70  6c  6f  79  2f  70  6f  73  74  67  72  65  73  2d  64
          e   p   l   o   y   /   p   o   s   t   g   r   e   s   -   d
0000440  73  2e  78  6d  6c  0a
          s   .   x   m   l  \n
0000446
[eric@localhost server]$ od -t x1 -t c <(echo $(find -name postgres-ds.xml))
0000000  2e  2f  69  73  62  73  63  73  2f  64  65  70  6c  6f  79  2f
          .   /   i   s   b   s   c   s   /   d   e   p   l   o   y   /
0000020  70  6f  73  74  67  72  65  73  2d  64  73  2e  78  6d  6c  20
          p   o   s   t   g   r   e   s   -   d   s   .   x   m   l    
0000040  2e  2f  67  65  6f  73  63  6f  2f  64  65  70  6c  6f  79  2f
          .   /   g   e   o   s   c   o   /   d   e   p   l   o   y   /
0000060  70  6f  73  74  67  72  65  73  2d  64  73  2e  78  6d  6c  20
          p   o   s   t   g   r   e   s   -   d   s   .   x   m   l    
0000100  2e  2f  32  30  31  34  2e  30  31  5f  6d  70  6f  2f  64  65
          .   /   2   0   1   4   .   0   1   _   m   p   o   /   d   e
0000120  70  6c  6f  79  2f  70  6f  73  74  67  72  65  73  2d  64  73
          p   l   o   y   /   p   o   s   t   g   r   e   s   -   d   s
0000140  2e  78  6d  6c  20  2e  2f  70  6e  6c  6c  6f  67  69  73  74
          .   x   m   l       .   /   p   n   l   l   o   g   i   s   t
0000160  69  63  73  2f  64  65  70  6c  6f  79  2f  70  6f  73  74  67
          i   c   s   /   d   e   p   l   o   y   /   p   o   s   t   g
0000200  72  65  73  2d  64  73  2e  78  6d  6c  20  2e  2f  70  6e  6c
          r   e   s   -   d   s   .   x   m   l       .   /   p   n   l
0000220  74  6d  73  2f  64  65  70  6c  6f  79  2f  70  6f  73  74  67
          t   m   s   /   d   e   p   l   o   y   /   p   o   s   t   g
0000240  72  65  73  2d  64  73  2e  78  6d  6c  20  2e  2f  6d  70  6f
          r   e   s   -   d   s   .   x   m   l       .   /   m   p   o
0000260  2f  64  65  70  6c  6f  79  2f  70  6f  73  74  67  72  65  73
          /   d   e   p   l   o   y   /   p   o   s   t   g   r   e   s
0000300  2d  64  73  2e  78  6d  6c  20  2e  2f  70  6e  6c  6f  6d  73
          -   d   s   .   x   m   l       .   /   p   n   l   o   m   s
0000320  2f  64  65  70  6c  6f  79  2f  70  6f  73  74  67  72  65  73
          /   d   e   p   l   o   y   /   p   o   s   t   g   r   e   s
0000340  2d  64  73  2e  78  6d  6c  20  2e  2f  62  61  72  64  2f  64
          -   d   s   .   x   m   l       .   /   b   a   r   d   /   d
0000360  65  70  6c  6f  79  2f  70  6f  73  74  67  72  65  73  2d  64
          e   p   l   o   y   /   p   o   s   t   g   r   e   s   -   d
0000400  73  2e  78  6d  6c  20  2e  2f  6d  70  6f  73  63  73  2f  64
          s   .   x   m   l       .   /   m   p   o   s   c   s   /   d
0000420  65  70  6c  6f  79  2f  70  6f  73  74  67  72  65  73  2d  64
          e   p   l   o   y   /   p   o   s   t   g   r   e   s   -   d
0000440  73  2e  78  6d  6c  0a
          s   .   x   m   l  \n
0000446

/ 13	. 

/ we kunnen ook	,

[eric@localhost server]$ echo -e "foo\nbar"
foo
bar
/ TODO BASH STRING OR STDIN	?

[eric@localhost server]$ echo "$(echo -e "foo\nbar")"
foo
bar
[eric@localhost server]$ echo $(echo -e "foo\nbar")
foo bar

/ ook,	

[eric@localhost server]$ od -t x1 -t c <(echo -e "foo\nbar")
0000000  66  6f  6f  0a  62  61  72  0a
          f   o   o  \n   b   a   r  \n
0000010
[eric@localhost server]$ od -t x1 -t c <(echo $(echo -e "foo\nbar"))
0000000  66  6f  6f  20  62  61  72  0a
          f   o   o       b   a   r  \n
0000010
[eric@localhost server]$ od -t x1 -t c <(echo "$(echo -e "foo\nbar")")
0000000  66  6f  6f  0a  62  61  72  0a
          f   o   o  \n   b   a   r  \n
0000010

/ ook	,

[eric@localhost server]$ str=$(echo -e "foo\nbar")
/ of	,
[eric@localhost bin]$ str=$'foo\nbar'

[eric@localhost server]$ echo $str
foo bar
[eric@localhost server]$ echo "$str"
foo
bar

[eric@localhost bin]$ od -t x1 -t c <(echo $str)
0000000  66  6f  6f  20  62  61  72  0a
          f   o   o       b   a   r  \n
0000010
[eric@localhost bin]$ od -t x1 -t c <(echo "$str")
0000000  66  6f  6f  0a  62  61  72  0a
          f   o   o  \n   b   a   r  \n
0000010


/ let op	,
[eric@localhost server]$ od -t x1 -t c <(echo $(echo  "foo\nbar"))
0000000  66  6f  6f  5c  6e  62  61  72  0a
          f   o   o   \   n   b   a   r  \n
0000011

/ 13	 .

/ $'...' gaat anders als $str	, 
/ we vervangen $str=$'foo\nbar' door $'foo\nbar'	, dus literal ipv variable	,
[eric@localhost server]$ od -t x1 -t c <(echo $'foo\nbar')
0000000  66  6f  6f  0a  62  61  72  0a
          f   o   o  \n   b   a   r  \n
0000010
[eric@localhost bin]$ od -t x1 -t c <(echo -e $'foo\nbar')
0000000  66  6f  6f  0a  62  61  72  0a
          f   o   o  \n   b   a   r  \n
0000010
/ TODO
[eric@localhost server]$ od -t x1 -t c <(echo "$'foo\nbar'")
0000000  24  27  66  6f  6f  5c  6e  62  61  72  27  0a
          $   '   f   o   o   \   n   b   a   r   '  \n
0000014

/ of wat directer	,
[eric@localhost bin]$ str=$'foo\nbar'
[eric@localhost bin]$ echo "$str"
foo
bar
[eric@localhost bin]$ echo $str
foo bar
[eric@localhost bin]$ echo $'foo\nbar'
foo
bar
[eric@localhost bin]$ echo -e $'foo\nbar'
foo
bar


/ TODO BASH MORGEN
 





/ Einde Intermezzo

/ 7	. 
/ we doen op mposerv11	,

jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs$ bash -c "cd lib;rm -f" $(awk 'NR>113670 && /MUST_BE_REMOVED/ && /.jar/{print $8}' log/server.log)
/ ERR	, hij doet	, 
cd lib;rm -f	, 

/ Hoe te doen	?
/ TODO

/ we doen echt met de hand	, op mposerv11	,

jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs/lib$ rm -f activeio-core-3.1.2.jar activemq-core-5.3.0.jar activemq-pool-5.3.0.jar activemq-ra-5.3.0.jar aspectjweaver-1.7.2.jar bcprov-jdk16-1.46.jar commons-pool.jar ehcache-1.5.0.jar hibernate3.jar postgresql-9.2-1003.jdbc4.jar quartz-1.6.0.jar spring-agent.jar spring-aop-3.2.7.jar spring-aspects-3.2.7.jar spring-beans-3.2.7.jar spring-context-3.2.7.jar spring-context-support-3.2.7.jar spring-core-3.2.7.jar spring-expression-3.2.7.jar spring-framework-bom-3.2.7.jar spring-instrument-3.2.7.jar spring-instrument-tomcat-3.2.7.jar spring-jdbc-3.2.7.jar spring-jms-3.2.7.jar spring-orm-3.2.7.jar spring-oxm-3.2.7.jar spring-security-config-3.2.5.RELEASE.jar spring-security-core-3.2.5.RELEASE.jar spring-security-saml2-core-1.0.0.RELEASE.jar spring-security-web-3.2.5.RELEASE.jar spring-test-3.2.7.jar spring-tx-3.2.7.jar spring-web-3.2.7.jar spring-webmvc-3.2.7.jar spring-webmvc-portlet-3.2.7.jar wiquery-1.2.3.jar

/ we doen met de hand op de laptop	,

/ 7	. 

jboss@mposerv11:~$ mposcs start track

/OK

/ Maar we zien 2 errors	,

jboss@mposerv11:~$ vi /local/apps/jboss-4.0.5.GA/server/mposcs/log/server.log

/ 13	. 
...
--- MBeans waiting for other MBeans ---
ObjectName: jboss:service=KeyGeneratorFactory,type=HiLo
  State: FAILED
  Reason: org.jboss.deployment.DeploymentException: Error while checking if table aleady exists HILOSEQUENCES; - ne
sted throwable: (org.jboss.util.NestedSQLException: No matching credentials in Subject!; - nested throwable: (org.j
boss.resource.JBossResourceException: No matching credentials in Subject!))
  I Depend On:
    jboss:service=TransactionManager
    jboss.jca:service=DataSourceBinding,name=DefaultDS

jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs$ less deploy/uuid-key-generator.sar/META-INF/jboss-service.xml
  <!-- HiLoKeyGeneratorFactory -->
  <mbean code="org.jboss.ejb.plugins.keygenerator.hilo.HiLoKeyGeneratorFactory"
         name="jboss:service=KeyGeneratorFactory,type=HiLo">
...
/ TODO

/ 13	. 

2015-11-17 16:07:36,582 ERROR [com.mpobjects.omscarcon.model.eventhandler.ejb.TmsCarconEventFetcher] (ScsScheduler_
Worker-2:) In act():Unable to connect to carcon server for: http://localhost:8480/carcon//carconserver/invoice_requ
est, reason: Connection refused
 
/ Einde SCS-4897

/ PNL-911

/ Ga naar 
planning , planning dashboard

/ Ga naar beneden	, naar service orders	,
/ we zien: Vaste ophaalopdrachten	, dat zijn de masters	, 
/ sorteer op service order column	, we zien N0001679

/ we zien maar 2 EDTs	, 
/ Dit is de fout	,

/ 7	. 

/ we copy de acceptance database naar hier	,

[eric@localhost bin]$ cat pnl-db-dump-a.sh
#!/usr/bin/bash
if [ "$#" -ne 1 ]
then 
	echo "Give database name on acceptance."
	exit 7
fi
cd ~/DB_TAP/Postgres/Backup
PGPASSWORD=h^Zgcyr\&Q pg_dump -U vanderveldene -Fc -h  pnl-app-a.intermax.mp-objects.com "$@" >"$@-$(date +%F).dump" 

[eric@localhost bin]$ pnl-db-dump-a.sh pnllogistics
[eric@localhost bin]$ tail -1 <(ls -ltr ~/DB_TAP/Postgres/Backup/)
-rw-rw-r--. 1 eric     eric      45001981 Nov 18 09:49 pnllogistics-2015-11-18.dump

pnllogistics3=# create database pnllogistics4;
ERROR:  CREATE DATABASE cannot run inside a transaction block
pnllogistics3=# rollback;
ROLLBACK
pnllogistics3=# create database pnllogistics4;
CREATE DATABASE
pnllogistics3=# commit;
WARNING:  there is no transaction in progress
COMMIT
/ TODO

[eric@localhost bin]$ local-pg_restore.sh pnllogistics4 ~/DB_TAP/Postgres/Backup/pnllogistics-2015-11-18.dump 

/ we edit postgres-ds.xml	,
/ OK

/ we restore ook de test database	,

[eric@localhost bin]$ pnl-db-dump-t.sh pnllogistics
pnllogistics4t=# create database pnllogistics4t;
[eric@localhost bin]$ local-pg_restore.sh pnllogistics4t ~/DB_TAP/Postgres/Backup/pnllogistics-t-2015-11-18.dump 

/ we edit postgres-ds.xml	,
/ OK



/ 7	.



/ Einde PNL-911

/ DEBUG PNL-911

$ vi oms-sitemap.xmap

			<map:action logger="serviceorder" name="serviceOrderEdit" src="com.mpobjects.oms.control.serviceorder.action.ServiceOrderEditAction"/>

			<map:match pattern="service-order_edit">
				<map:act type="serviceOrderEdit">
				<map:select type="session-attribute">
					<map:parameter name="attribute-name" value="builder"/>
					<map:when test="jsp">
						<map:read mime-type="text/html" type="jsp" src="jsp/service-order_edit.jsp"/>
					</map:when>
					<map:otherwise>
						<map:redirect-to uri="../wicket?module=oms&amp;wicketpage=serviceorder.edit.ServiceOrderEditSelectionPage"/>
					</map:otherwise>			
				</map:select>
				</map:act>
			</map:match>

$ vi service-order_edit.jsp

<%@taglib prefix="ttf" tagdir="/WEB-INF/tags/oms/"%>

				<div id="serviceOrderEntityDetails">
					<c:if test="${!empty formVO.entityDetailsForDisplay}">
						<div style="clear: left;"></div>
						<div class="down" id="entityDetails">
							<ttf:entity-detail-list extraFieldList="${formVO.entityDetailsForDisplay}" process="${formVO.serviceOrderProcess}" organization="${formVO.organizationSystemid}" />
						</div>
						<div style="clear: left;"></div>
					</c:if>
				</div>

/ we zien hier vlak onder dat extraFieldList EntityDetailWrapper's zijn	,

/ als we een b set in	,
ServiceOrderVO(EntityDetailSupport).getEntityDetailsForDisplay() line: 186	
/=
	public List<EntityDetailWrapper> getEntityDetailsForDisplay() {

this	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=21388)	
		return MpoBeanFactory.getBean(EntityDetailService.class).getDisplayList(this);
/s
EntityDetailServiceImpl.getDisplayList(EntityDetailSupport) line: 55	
/=
	public List<EntityDetailWrapper> getDisplayList(EntityDetailSupport anEntityDetailSupport) {
anEntityDetailSupport=de seo	,

		EntityType myEntity = anEntityDetailSupport.getEntity();
EntityType.SERVICE_ORDER

		List<EntityDetailType> myByEntity = getEntityDetailTypeDAO().getByEntity(myEntity);
myByEntity	java.util.ArrayList  (id=24363)	
	elementData	java.lang.Object[11]  (id=24365)	
		[0]	com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailType  (id=24367)	
		[1]	com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailType  (id=24368)	
		[2]	com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailType  (id=24417)	
		[3]	com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailType  (id=24418)	
		[4]	com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailType  (id=24419)	
		[5]	com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailType  (id=24421)	
		[6]	com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailType  (id=24423)	
		[7]	com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailType  (id=24424)	
		[8]	com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailType  (id=24426)	
		[9]	com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailType  (id=24604)	
		[10]	com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailType  (id=24605)	

/ Intermezzo

pnllogistics4=# select count(*)from entity_detail_type where entity='SERVICE_ORDER' and is_deleted=false;
 count 
-------
    11
(1 row)


/ Einde Intermezzo

		List<EntityDetailType> myList = new ArrayList<EntityDetailType>(myByEntity);
		Collections.sort(myList, new EntityDetailTypeComparator());
		for (EntityDetailType myType : myList) {
			String myVisibilityExpr = myType.getVisibilityExpr();
entity.serviceOrderTypeVO.code == 'COLLECT'
			} else {
				if (StringUtils.isNotEmpty(myVisibilityExpr)) {
					myVisibilityExpr = "${" + myVisibilityExpr + "}";
${entity.serviceOrderTypeVO.code == 'COLLECT'}
					ExpressionEvaluator myEvaluator = new ExpressionEvaluator();
					myEvaluator.setVariable("entity", anEntityDetailSupport);
					try {
						if (BooleanUtils.isTrue("" + myEvaluator.evaluate(myVisibilityExpr))) {
/s
ExpressionEvaluator.evaluate(String) line: 46	
			return getExpressionEvaluator().evaluate(aString, Object.class, this, getFunctionMapper());
/s
ExpressionEvaluator.getFunctionMapper() line: 78	
			theFunctionMapper = ProtectedFunctionMapper.getInstance();
this	com.mpobjects.core.expression.ExpressionEvaluator  (id=24920)	
	theFunctionMapper	org.apache.jasper.runtime.ProtectedFunctionMapper  (id=24943)	

			initFunctionMapper((ProtectedFunctionMapper) theFunctionMapper);
/s
ExpressionEvaluator.initFunctionMapper(ProtectedFunctionMapper) line: 87	
		aMapper.mapFunction("cf:dateCompareTo", DateUtils.class, "compareTo", new Class[] { java.util.Date.class, java.util.Date.class });
		aMapper.mapFunction("cf:dateAddTo", DateUtils.class, "addTo", new Class[] { java.util.Date.class, String.class, int.class });
		...
/t
		return theFunctionMapper;
/t
			return getExpressionEvaluator().evaluate(aString, Object.class, this, getFunctionMapper());
/t
EntityDetailServiceImpl.getDisplayList(EntityDetailSupport) line: 74	
					try {
						if (BooleanUtils.isTrue("" + myEvaluator.evaluate(myVisibilityExpr))) {
/ JA	, NEE
							myResult.add(new EntityDetailWrapper(myType, anEntityDetailSupport));

/ Intermezzo

pnllogistics4=# select name, visibility from entity_detail_type where entity='SERVICE_ORDER' and is_deleted=false;
           name           |                                                                  visibility      
                                                             
--------------------------+----------------------------------------------------------------------------------
-------------------------------------------------------------
 ColCode                  | entity.serviceOrderTypeVO.code == 'COLLECT' || entity.serviceOrderTypeVO.code == 
'DELIVERY'
 DelCode                  | entity.serviceOrderTypeVO.code == 'COLLECT' || entity.serviceOrderTypeVO.code == 
'DELIVERY'
 ManualInstructions       | NULL
 GenericInstructions      | entity.serviceOrderTypeVO.code == 'PICKUP' || entity.serviceOrderTypeVO.code == 'DELIVERY' || entity.serviceOrderTypeVO.code == 'PICKUP_NOTE'
 nrOfPlannedPallets       | entity.serviceOrderTypeVO.code == 'COLLECT'
 nrOfPlannedColli         | entity.serviceOrderTypeVO.code == 'COLLECT'
 nrOfPlannedRolcontainers | entity.serviceOrderTypeVO.code == 'COLLECT'
 nrOfActualPallets        | entity.serviceOrderTypeVO.code == 'COLLECT'
 nrOfActualColli          | entity.serviceOrderTypeVO.code == 'COLLECT'
 nrOfActualRolcontainers  | entity.serviceOrderTypeVO.code == 'COLLECT'
 OntvangenBedragCash      | entity.serviceOrderType.code == 'DELIVERY'

pnllogistics4=# select name, visibility from entity_detail_type where entity='SERVICE_ORDER' and is_deleted=false and visibility like '%COLLECT%';'
           name           |                                         visibility                                          
--------------------------+---------------------------------------------------------------------------------------------
 ColCode                  | entity.serviceOrderTypeVO.code == 'COLLECT' || entity.serviceOrderTypeVO.code == 'DELIVERY'
 DelCode                  | entity.serviceOrderTypeVO.code == 'COLLECT' || entity.serviceOrderTypeVO.code == 'DELIVERY'
 nrOfPlannedPallets       | entity.serviceOrderTypeVO.code == 'COLLECT'
 nrOfPlannedColli         | entity.serviceOrderTypeVO.code == 'COLLECT'
 nrOfPlannedRolcontainers | entity.serviceOrderTypeVO.code == 'COLLECT'
 nrOfActualPallets        | entity.serviceOrderTypeVO.code == 'COLLECT'
 nrOfActualColli          | entity.serviceOrderTypeVO.code == 'COLLECT'
 nrOfActualRolcontainers  | entity.serviceOrderTypeVO.code == 'COLLECT'
(8 rows)


/ Einde Intermezzo

myResult	java.util.ArrayList  (id=23848)	
	elementData	java.lang.Object[10]  (id=25129)	
		[0]	com.mpobjects.oms.model.entitydetail.vo.EntityDetailWrapper  (id=25131)	
		[1]	com.mpobjects.oms.model.entitydetail.vo.EntityDetailWrapper  (id=25132)	
		[2]	com.mpobjects.oms.model.entitydetail.vo.EntityDetailWrapper  (id=25133)	
		[3]	com.mpobjects.oms.model.entitydetail.vo.EntityDetailWrapper  (id=25134)	
		[4]	com.mpobjects.oms.model.entitydetail.vo.EntityDetailWrapper  (id=25155)	
		[5]	com.mpobjects.oms.model.entitydetail.vo.EntityDetailWrapper  (id=25157)	
		[6]	com.mpobjects.oms.model.entitydetail.vo.EntityDetailWrapper  (id=25158)	
		[7]	com.mpobjects.oms.model.entitydetail.vo.EntityDetailWrapper  (id=25160)	
		[8]	com.mpobjects.oms.model.entitydetail.vo.EntityDetailWrapper  (id=25162)	
/ zoals	,
		[0]	com.mpobjects.oms.model.entitydetail.vo.EntityDetailWrapper  (id=25131)	
			type	com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailType  (id=24423)	
				code	"nrOfPlannedPallets" (id=25072)	
				code	"nrOfPlannedColli" (id=25027)	
				code	"nrOfPlannedRolcontainers" (id=25070)	
				code	"nrOfActualPallets" (id=25068)	
				code	"nrOfActualColli" (id=25066)	
				code	"nrOfActualRolcontainers" (id=25064)	
				code	"ColCode" (id=24710)	
				code	"DelCode" (id=24837)	
				code	"ManualInstructions" (id=24840)	

/ ManualInstructions staan er hier bij, visibility=NULL	,
/ TODO

/ dan vallen we hierin	, omdat de jsp deze calls	, en formVO is inderdaad de seo	,

[eric@localhost trunk]$ find -path \*/WEB-INF/tags/oms
./module/oms/war/WEB-INF/tags/oms
[eric@localhost trunk]$ ls $(find -path \*/WEB-INF/tags/oms)
containers.tag                      shipfrom-readonly.tag        sho-template-party.tag
dashboard-query-type.tag            shipfrom.tag                 sho-tracing.tag
edit-parties.tag                    shipto-readonly.tag          so-party.tag
entity-detail-list.tag              shipto.tag                   tab-sa-consignments.tag
googlemap.tag                       sho-billto.tag               tab-sa-receipts.tag
order-dashboard-query-type.tag      sho-containers.tag           tab-sa-route.tag
order-instructions.tag              sho-customerorders.tag       tab-sa-serviceactions.tag
pagination_util.tag                 sho-employeeresponsible.tag  tab-so-path.tag
party-documents.tag                 sho-party.tag                workload-dashboard-query-type.tag
party-group-query-type.tag          sho-productitems.tag         xmldocuments.tag
party-partyprenotificationrule.tag  sho-shipmentitems.tag
resources.tag                       sho-simpleshipmentitems.tag

$ vi entity-detail-list.tag

<%@taglib prefix="ctf" uri="/WEB-INF/tld/core-functions.tld"%>

<c:forEach var="myEntry" items="${extraFieldList}">
	<!-- master process::${process} detail name: ${myDetailType.name} detailProcess:${detailProcess} -->
	<c:set var="myDetailType" value="${myEntry.type}" />
	<c:set var="myValue" value="${myEntry.value}" />
	<c:set var="detailProcess" value="${ctf:organizationPropertyNoException(myDetailType.organization.systemId, '', 'process.type', 'none',false)}" />
	<c:if test="${myDetailType.valueType!='HIDDEN'}">
	...

/ we zien hierboven dat extraFieldList EntityDetailWrapper's zijn	,

/ we set een b in 
/s
EntityDetailWrapper.getType() line: 62	
		return type;
this	com.mpobjects.oms.model.entitydetail.vo.EntityDetailWrapper  (id=22997)	
	type	com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailType  (id=23667)	
		code	"nrOfPlannedPallets" (id=24498)	

$ vi core-function.tld
<function>
	<name>organizationPropertyNoException</name>
    <function-class>com.mpobjects.core.ApplicationPropertyManager</function-class>
    <function-signature>
        java.lang.String  taglibGetOrganizationProperty(int, java.lang.String,java.lang.String,java.lang.String,boolean)
    </function-signature>
</function>

/ we set 'n b in 	,
/s
EntityDetailWrapper.getValue() line: 66	
		return map.get(type);
4

/we set 'n b in	,
ApplicationPropertyManager.taglibGetOrganizationProperty(int, String, String, String, boolean) line: 129	
		return getInstance().getModuleOrganizationProperty(anOrganizationSystemId, aModule, aKey, aDefaultValue, aThrowException);
anOrganizationSystemId	500	
aModule	"" (id=24937)	
aKey	"process.type" (id=24938)	
aDefaultValue	"none" (id=24939)	
aThrowException	false	
/s
ApplicationPropertyManager.getModuleOrganizationProperty(int, String, String, String, boolean) line: 310	
		return getOrganizationProperty(anOrganizationSystemid, getPropertyKey(aModule, aKey), aDefaultValue, aThrowException);
/s
/ aModule=""	, dus getPropertyKey(aModule, aKey)=aKey="process.type"
/s
ApplicationPropertyManager.getOrganizationProperty(int, String, String, boolean) line: 396	
/=
	public String getOrganizationProperty(int anOrganizationSystemid, String aPropertyKey, String aDefaultValue, boolean aThrowException) {
anOrganizationSystemid	500	
aPropertyKey	"process.type" (id=24938)	
aDefaultValue	"none" (id=24939)	
aThrowException	false	

/ Intermezzo

/ Normaal komen we WH 	,

public class ApplicationPropertyManager {

	public String getProperty(int aPreferedOrganizationSystemid, String aPropertyKey, String aDefaultValue) {

		String myRet = NOTSET;
		Resource myActiveResource = AuthenticationUtils.getResource();
		if (myActiveResource != null) {
			myRet = myActiveResource.getUserProperty(aPropertyKey, NOTSET);
		}

		if (NOTSET.equals(myRet)) {
			myRet = getOrganizationProperty(aPreferedOrganizationSystemid, aPropertyKey, NOTSET, true);
		}
		if (NOTSET.equals(myRet)) {
			myRet = getDatabaseProperty(aPropertyKey, NOTSET);
		}

		if (NOTSET.equals(myRet)) {
			myRet = getApplicationProperty(aPropertyKey, aDefaultValue);

		}

		return myRet;
	}

/ Einde Intermezzo

		Resource myResource = AuthenticationUtils.getResource();
		Organization myOrganization = null;

		if (myResource != null) {
			for (Organization myResourceOrganization : myResource.getOrganizations()) {
myResource	com.mpobjects.oms.model.user.Resource  (id=25043)	
	organizations	java.util.ArrayList  (id=25515)	
		elementData	java.lang.Object[10]  (id=25517)	
			[0]	com.mpobjects.oms.model.entity.organization.Organization  (id=24578)	
SystemId:500	Id:PNL-CARGO	Description:PostNL Cargo
			[1]	com.mpobjects.oms.model.entity.organization.Organization  (id=25518)	
SystemId:1020	Id:PNL-OMS-DOCK	Description:People at the loading and unloading dock
			[2]	com.mpobjects.oms.model.entity.organization.Organization  (id=25519)	
SystemId:1010	Id:PNL-TMS-AB	Description:Post NL Autobedrijf
			[3]	com.mpobjects.oms.model.entity.organization.Organization  (id=25520)	
SystemId:1	Id:SYSTEM	Description:SYSTEM
				if (myResourceOrganization.getSystemId() == anOrganizationSystemid) {
/ anOrganizationSystemid=500 (arg deze fct)
					myOrganization = myResourceOrganization;
					break;

		String myRet = myOrganization.getProperty(aPropertyKey, aDefaultValue);
/ aPropertyKey="process.type"
/ aDefaultValue="none"
"none"

	<c:if test="${myDetailType.valueType!='HIDDEN'}">
/ JA
		<c:if test="${detailProcess == process||detailProcess=='none'}">


/ Intermezzo

pnllogistics=> \d service_order_detail
         Table "public.service_order_detail"
     Column      |          Type          | Modifiers 
-----------------+------------------------+-----------
 entity_systemid | integer                | not null
 edt_systemid    | integer                | not null
 field_value     | character varying(255) | 
Indexes:
    "pk_service_order_detail" PRIMARY KEY, btree (entity_systemid, edt_systemid)
    "service_order_detail_edt_systemid_idx" btree (edt_systemid)
    "service_order_detail_entity_systemid_idx" btree (entity_systemid)
Foreign-key constraints:
    "sod_edt_fk" FOREIGN KEY (edt_systemid) REFERENCES entity_detail_type(system_id)
    "sod_so_fk" FOREIGN KEY (entity_systemid) REFERENCES service_order(system_id)

/ service_order_detail is een koppel table	, tussen service_order en entity_detail_type	,
 

/ Einde Intermezzo

/ Intermezzo


pnllogistics4=# select seo.service_order_id,edt.name,seod.field_value  
	from service_order_detail seod 
	join service_order seo on seod.entity_systemid=seo.system_id 
	join entity_detail_type edt on seod.edt_systemid=edt.system_id 
	where service_order_id='N0001679';
 service_order_id |           name           | field_value 
------------------+--------------------------+-------------
 N0001679         | nrOfPlannedPallets       | 4
 N0001679         | nrOfActualPallets        | 
 N0001679         | nrOfActualColli          | 
 N0001679         | nrOfActualRolcontainers  | 
 N0001679         | nrOfPlannedRolcontainers | 
 N0001679         | nrOfPlannedColli         | Collo
(6 rows)


pnllogistics4=# select seod.* from service_order_detail seod join service_order seo on seod.entity_systemid=seo.system_id join entity_detail_type edt on seod.edt_systemid=edt.system_id where service_order_id='N0001679';
 entity_systemid | edt_systemid | field_value 
-----------------+--------------+-------------
        26782991 |     26682269 | 4
        26782991 |     26858073 | 
        26782991 |     26858074 | 
        26782991 |     26858075 | 
        26782991 |     26858072 | 
        26782991 |     26858071 | Collo









/ Einde DEBUG PCT-911

/ DEPLOY BARD

/ op bard-t	,
[vanderveldene@bard-app-t ~]$ (cd /local/apps/jboss-4.0.5.GA/server/bard/;echo $(awk '/MISSING/ && /.jar/{print $8}' log/server.log))
bcprov-jdk15on-1.53.jar opensaml-2.6.4.jar openws-1.5.4.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar

/ op laptop	,
$ cat bard-scp-to-t.sh

#!/bin/bash
echo 'h^Zgcyr&Q'
DIR=Downloads
ssh vanderveldene@bard-app-t.intermax.mp-objects.com "mkdir $DIR"
scp "$@" vanderveldene@bard-app-a.intermax.mp-objects.com:"$DIR"

[eric@localhost lib]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnllogistics/lib
[eric@localhost lib]$ bard-scp-to-t.sh bcprov-jdk15on-1.53.jar opensaml-2.6.4.jar openws-1.5.4.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar
/ OK

/ op bard-t	,

[vanderveldene@bard-app-t ~]$ (cd /local/apps/jboss-4.0.5.GA/server/bard/;echo $(awk '/MUST_BE_REMOVED/ && /.jar/{print $8}' log/server.log))
bcprov-jdk15on-1.52.jar opensaml-2.6.1.jar openws-1.5.1.jar xmlsec-1.5.6.jar xmltooling-1.4.1.jar


[vanderveldene@bard-app-t ~]$ (cd /local/apps/jboss-4.0.5.GA/server/bard/;echo $(awk '/MUST_BE_REMOVED/ && /.jar/{print "rm -f "$8}' log/server.log))
rm -f bcprov-jdk15on-1.52.jar rm -f opensaml-2.6.1.jar rm -f openws-1.5.1.jar rm -f xmlsec-1.5.6.jar rm -f xmltooling-1.4.1.jar
[vanderveldene@bard-app-t ~]$ (cd /local/apps/jboss-4.0.5.GA/server/bard/;echo $(awk 'BEGIN{print "rm -f "}/MUST_BE_REMOVED/ && /.jar/{print $8}' log/server.log))
rm -f bcprov-jdk15on-1.52.jar opensaml-2.6.1.jar openws-1.5.1.jar xmlsec-1.5.6.jar xmltooling-1.4.1.jar

/ TODO AWK (Hoe met "..." en \n)

/ we doen met de hand	,

[vanderveldene@bard-app-t ~]$ (sudo su - jboss;cd /local/apps/jboss-4.0.5.GA/server/bard/lib;rm -f bcprov-jdk15on-1.52.jar opensaml-2.6.1.jar openws-1.5.1.jar xmlsec-1.5.6.jar xmltooling-1.4.1.jar)
[jboss@bard-app-t ~]$ exit
logout
/ TODO (Waarom nog jboss	? )
/ TODO (werkt niet	,
[jboss@bard-app-t ~]$ (cd /local/apps/jboss-4.0.5.GA/server/bard/lib;ls bcprov-jdk15on-1.52.jar opensaml-2.6.1.jar openws-1.5.1.jar xmlsec-1.5.6.jar xmltooling-1.4.1.jar)
bcprov-jdk15on-1.52.jar  opensaml-2.6.1.jar  openws-1.5.1.jar  xmlsec-1.5.6.jar  xmltooling-1.4.1.jar

/ maar als we eerst inlog van jboss	,
[jboss@bard-app-t ~]$ (cd /local/apps/jboss-4.0.5.GA/server/bard/lib;rm -f bcprov-jdk15on-1.52.jar opensaml-2.6.1.jar openws-1.5.1.jar xmlsec-1.5.6.jar xmltooling-1.4.1.jar)
[jboss@bard-app-t ~]$ (cd /local/apps/jboss-4.0.5.GA/server/bard/lib;ls bcprov-jdk15on-1.52.jar opensaml-2.6.1.jar openws-1.5.1.jar xmlsec-1.5.6.jar xmltooling-1.4.1.jar)
ls: cannot access bcprov-jdk15on-1.52.jar: No such file or directory
ls: cannot access opensaml-2.6.1.jar: No such file or directory
ls: cannot access openws-1.5.1.jar: No such file or directory
ls: cannot access xmlsec-1.5.6.jar: No such file or directory
ls: cannot access xmltooling-1.4.1.jar: No such file or directory
/ OK
/ TODO BASH

[vanderveldene@bard-app-t ~]$ ls /home/ -ltr
[vanderveldene@bard-app-t ~]$ chmod a+rx .
[vanderveldene@bard-app-t ~]$ chmod g+w .

[jboss@bard-app-t ~]$ cp -a ~vanderveldene/Downloads/* /local/apps/jboss-4.0.5.GA/server/bard/lib/
[jboss@bard-app-t ~]$ (cd /local/apps/jboss-4.0.5.GA/server/bard/lib; ls -ltr bcprov-jdk15on-1.53.jar opensaml-2.6.4.jar openws-1.5.4.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar)
-rw-rw-r-- 1 jboss jboss 3259402 Nov 18 15:32 bcprov-jdk15on-1.53.jar
-rw-rw-r-- 1 jboss jboss 1413769 Nov 18 15:32 opensaml-2.6.4.jar
-rw-rw-r-- 1 jboss jboss  574069 Nov 18 15:32 openws-1.5.4.jar
-rw-rw-r-- 1 jboss jboss  655992 Nov 18 15:32 xmlsec-1.5.7.jar
-rw-rw-r-- 1 jboss jboss  672229 Nov 18 15:32 xmltooling-1.4.4.jar






/ Einde DEPLOY BARD

/ DEPLOY MPOSCS ON TEST

jboss@mposerv11:~$ cd /local/apps/jboss-4.0.5.GA/server/mposcs

/ wat zit er in de build file?

jboss@mposerv11:~/tmp$ unzip ../releases/tms-mposcs-21533-2015.03_build3393.zip
jboss@mposerv11:~/tmp$ ls
conf  deploy  lib

jboss@mposerv11:~/tmp$ cd deploy/
jboss@mposerv11:~/tmp/deploy$ ls
firebird-ds.xml   mposcs-activemq-jms-ds.xml  mposcs-schedule-service.xml
mail-service.xml  mposcs.ear                  mposcs-tibco-jms-ds.xml
jboss@mposerv11:~/tmp/deploy$ jar tvf mposcs.ear 
     0 Tue Nov 17 09:49:50 CET 2015 META-INF/
   106 Tue Nov 17 09:49:48 CET 2015 META-INF/MANIFEST.MF
   333 Tue Nov 17 09:49:48 CET 2015 META-INF/application.xml
 28089 Tue Nov 17 09:49:40 CET 2015 mpo-management.sar
12263991 Tue Nov 17 09:49:40 CET 2015 tms.jar
28078008 Tue Nov 17 09:49:48 CET 2015 tms.war

jboss@mposerv11:~/tmp/deploy$ jar xvf mposcs.ear 
jboss@mposerv11:~/tmp/deploy$ rm mposcs.ear 
jboss@mposerv11:~/tmp/deploy$ ls
firebird-ds.xml   META-INF            mposcs-activemq-jms-ds.xml  mposcs-schedule-service.xml  tms.jar
mail-service.xml  mpo-management.sar  mposcs-tibco-jms-ds.xml     tms.war

/ ShipmentOrderVO.class is in tmw.jar	,
/ Alle jsp's, .properties files, .jpg's, html files zijn in tms.war	,

/ Kijk in 	,
jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs$ pwd
/local/apps/jboss-4.0.5.GA/server/mposcs
jboss@mposerv11:/local/apps/jboss-4.0.5.GA/server/mposcs$ less deploy/uuid-key-generator.sar/META-INF/jboss-service.xml

/ locaal in dsvfms 2015.03 zien we ook deze jboss-service.xml	,
/ maar in de svn van 2015.03 zien we een hele andere	,

/ Einde DEPLOYT MPOSCS ON TEST


/ SCS-4423

$ vi EventSat.standard.hbm.xml
<hibernate-mapping>
	<class name="com.mpobjects.event.eventsat.model.EventSatVO" lazy="false" table="EVENT_SAT">

/ event_sat is een join table	, WH tussen event tmpl en sa tmpl	,

pnllogistics4=# \d event_sat
           Table "public.event_sat"
         Column          |  Type   | Modifiers 
-------------------------+---------+-----------
 event_template_systemid | integer | not null
 party_systemid          | integer | 
 system_id               | integer | 
 sat_systemid            | integer | not null
Indexes:
    "pk_event_sat" PRIMARY KEY, btree (event_template_systemid, sat_systemid)
    "event_sat_event_template_systemid_idx" btree (event_template_systemid)
    "event_sat_sat_systemid_idx" btree (sat_systemid)
Foreign-key constraints:
    "fk_event_sat_event_tpl" FOREIGN KEY (event_template_systemid) REFERENCES event_template(system_id)
    "fk_event_sat_sat" FOREIGN KEY (sat_systemid) REFERENCES service_action_template(system_id)

/ we nemen een sat	,
configuration, planning, service action template
/ Kies SAT_COLLECT

/ we zien de tabs

/ event template	,
/ we zien de selected event template J27	,

/ service order templates
/ we zien selected seot COLLECT	,

/ 13	. 

$ vi ServiceActionTemplate.standard.hbm.xml

hibernate-mapping package="com.mpobjects.oms.model.serviceactiontemplate">
	<class name="ServiceActionTemplate" table="SERVICE_ACTION_TEMPLATE">

pnllogistics4t=# select*from service_action_template where service_action_template_id='SAT_COLLECT';
...

/ 13	. 

/ een service order template is een service order	, 

$ vi ServiceActionTemplate.standard.hbm.xml

<hibernate-mapping>
	<class name="com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO" table="SERVICE_ORDER">

pnllogistics4t=# select*from service_order where service_order_id='COLLECT';
...

/ 7	. 

pnllogistics4t=# select*from service_action_template where service_action_template_id='SAT_COLLECT'; 
system_id                     | 26681857
sequence_number               | 5
organization_systemid         | 500
service_action_type_systemid  | 26681851
service_action_template_id    | SAT_COLLECT
...

pnllogistics4t=# select*from event_sat where sat_systemid=26681857;
-[ RECORD 1 ]-----------+---------
event_template_systemid | 26681720
party_systemid          | NULL
system_id               | 26858695
sat_systemid            | 26681857

pnllogistics4t=# select tpl.system_id,typ.name from event_template tpl join event_type typ on tpl.event_type_systemid=typ.system_id  where tpl.system_id=26681720;
 system_id | name 
-----------+------
  26681720 | J27
(1 row)

pnllogistics4t=# select system_id, service_order_id from service_order where is_template=1;
 system_id |         service_order_id         
-----------+----------------------------------
  26682241 | COLLECT

pnllogistics4t=# select*from service_action_order_template where sat_systemid=26681857;
 sat_systemid | sot_systemid 
--------------+--------------
     26681857 |     26682241

pnllogistics4t=# \d service_action_order_template
    Column    |  Type   | Modifiers 
--------------+---------+-----------
 sat_systemid | integer | 
 sot_systemid | integer | 
Foreign-key constraints:
    "sao_sat_fk" FOREIGN KEY (sat_systemid) REFERENCES service_action_template(system_id)
    "sao_sot_fk" FOREIGN KEY (sot_systemid) REFERENCES service_order(system_id)


/ 13	. 

				service_action_template 
				26681857 <----------
				SAT_COLLECT			|
									| 
									|

event_template						|															service_order (is template)
26681720							|															26682241
J27 (join met event_type)			|															COLLECT
^									|																^
|									|																|	
|			event_sat				|					 service_action_order_template				|
|			26858695				|																|
---------	event_tempate_systemid	|							sot_systemid ----------------------	|
			sat_systemid ---------------------------------------sat_systemid					

/ dus er zijn 2 koppel tables	, 
/ event_sat: voor onder de event template tab, om sat en event_templates te koppelen	, we zien de entries bij Actual
/ service_action_order_template: voor onder de service order template tab, om sat en seo (die templates zijn )te koppelen	, we zien de entries onder Actual	,


 

$ vi ServiceActionTemplate.standard.hbm.xml

<hibernate-mapping package="com.mpobjects.oms.model.serviceactiontemplate">
	<class name="ServiceActionTemplate" table="SERVICE_ACTION_TEMPLATE">

		<many-to-one name="serviceActionType" column="SERVICE_ACTION_TYPE_SYSTEMID" class="com.mpobjects.oms.model.entity.serviceactiontype.ServiceActionType" />
/ Betekent: in de table staat een id	, in de obj staat een ref naar het obj	,

		<bag name="serviceOrderTemplateList" inverse="false" table="SERVICE_ACTION_ORDER_TEMPLATE">
			<key column="SAT_SYSTEMID" not-null="true" />
			<many-to-many class="com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO" column="SOT_SYSTEMID"/>
		</bag>
/ we zien dat de koppel tabel wordt used om de list van seo (templates) te maken in een sat	, deze zien we WH in de sat page , onder tab service order templates, bij Actual 

/ 7	. 

$ vi event-overrides-pipelines.xmod
...
/ TODO

/ 7	. 

$ vi oms-sitemap.xmap

			<map:action logger="serviceaction" name="satSave" src="com.mpobjects.oms.control.leggen.action.SatSaveAction"/>
			<map:match pattern="sat_save">
				<map:act type="satSave"/>
			</map:match>


/ 7	. 

/ FIX SCS-4423

/ 7	. 

$ vi ServiceActionTemplate.standard.hbm.xml

		<!-- ERICJ -->
		<bag name="eventTemplateList" inverse="false" table="EVENT_SAT">
			<key column="SAT_SYSTEMID" not-null="true" />
			<many-to-many class="com.mpobjects.event.model.entity.eventtemplate.EventTemplate" column="EVENT_TEMPLATE_SYSTEMID"/>
		</bag>

/ See 8.3 in H manual	, (Uni)directional associations with join tables	,
/ In <key en <many-to-many zien we de column names van de join table EVENT_SAT	,

$ vi ServiceActionTemplate.java

	// ERICJ
	private Collection<EventTemplate>eventTemplateList;

	// ERICJ
	public Collection<EventTemplate> getEventTemplateList() {
		return eventTemplateList;
	}

	// ERICJ
	public void setEventTemplateList(Collection<EventTemplate> eventTemplateList) {
		this.eventTemplateList = eventTemplateList;
	}

$ vi sat_edit.jsp

           <!--  if module event exists -->
			             <mpo:manyToManyRelation 
			            	data="${eventTemplates}" 
			            	selected="${eventTemplatesSelected}" >

$ vi SatFormAction.java

		Collection<Integer> activatableOrganizationSystemids = ResourceUtil.getResource().getActivatableOrganizationSystemids();
		Collection<EventTemplate> allEventTemplates = MpoBeanFactory.getBean(EventTemplateDAO.class).getAllEventTemplatesForActivatableOrganizations(activatableOrganizationSystemids);
		getRequest().setAttribute("eventTemplates", allEventTemplates);
		getRequest().setAttribute("eventTemplatesSelected", myVO.getEventTemplateList());


/ 7	. 

$ vi SatSaveAction.java

	@Override
	protected void handleSave() throws Exception {

		Collection<EventTemplate> eventTemplates = getFetchedData(EventTemplate.class);
		myVO.setEventTemplateList(eventTemplates);

/ 7	. 

/ rm	,

[eric@localhost trunk]$ ls $(awk 'NR==1' <(find -path "*/eventsat/control"))
EventSatFormInitAction.java  SatSaveListener.java
[eric@localhost trunk]$ ls $(awk 'NR==1' <(find -path "*/eventsat/model"))
dao  EventSatVO.java
[eric@localhost trunk]$ ls $(awk 'NR==1' <(find -path "*/eventsat/model/dao"))
EventSatDAOImpl.java  EventSatDAO.java  EventSat.standard.hbm.xml

/ hierdoor ook	,

/ 13	. 

/ rm de method bij ->	,

$ vi ServiceActionTemplate.java

->	public Collection<EventTemplate> getEventTemplates() {
		EventSatDAO dao = MpoBeanFactory.getBean(EventSatDAO.class);
		Collection<EventSatVO> list = dao.getBySatSystemid(getSystemId());
		Collection<EventTemplate> theEventTemplateList = new ArrayList<EventTemplate>();
		for (EventSatVO eventSatVO : list) {
			theEventTemplateList.add(eventSatVO.getEventTemplate());
		}
		return theEventTemplateList;
	}

/ 13	. 

/ rm bij ->	,

$ vi PathTemplateTransferImpl.java

import com.mpobjects.event.eventsat.model.dao.EventSatDAO;

->	private EventSatDAO eventSatDAO;

->	public final void setEventSatDAO(EventSatDAO eventSatDAO) {
->		this.eventSatDAO = eventSatDAO;
->	}

	private void createEventTemplate(Context context) throws FieldAliasException {
		Alias alias = context.createAlias(EventTemplate.class);
		alias.setDAO(new DaoAdapter() {
			@Override
			public EntityInterface save(EntityInterface object) throws Exception {
				EventTemplate eventTemplateVO = (EventTemplate) object;
				if (eventTemplateVO.getSystemId() <= 0) {
					EventTemplateDAO eventTemplateDAO = getDAO();
					eventTemplateDAO.save(eventTemplateVO);
				}
->				// eventSatDAO.associateEventTemplateToSAT(currentServiceActionTemplate, eventTemplateVO);

/ 137	.

/ Test of Import/Export nog werkt bij path templates	,
configuration, planning, path templates  
/ edit er een	,
/ click export

configuration, planning, path template import



/ 13	. 

/ rm bij ->

$ vi PathServiceImpl.java

	@Override
	public void deleteSat(int aSystemId) throws AbstractException {
		try {
			ServiceActionTemplateDAO myDAO = MpoBeanFactory.getBean(ServiceActionTemplateDAO.class);
			myDAO.deleteServiceOrderTemplates(aSystemId);
		->	EventSatDAO myEventSatDAO = MpoBeanFactory.getBean(EventSatDAO.class);
		->	myEventSatDAO.deleteEventTemplatesAssociation(aSystemId);
			myDAO.deleteSat(aSystemId);

/ 137	.

/ Test of Import/Export nog werkt bij path templates	,
configuration, planning, path templates  
/ edit er een	,
/ check een of meerder sat's	,
/click remove selected templates 


/ 7	. 

/ rm bij ->

$ vi event-dao.sb.xml

->	<bean id="com.mpobjects.event.eventsat.model.dao.EventSatDAO" class="com.mpobjects.event.eventsat.model.dao.EventSatDAOImpl"
->		parent="HibernateDAOTemplate" />


/ 7 .

/ rm uit .xmod files	,

$ vi event-overrides-pipelines.xmod

    <map:match pattern="oms/sat_edit">
        <map:act type="eventSatFormInit"/>
    </map:match>

    <map:match pattern="oms/sat_create">
        <map:act type="eventSatFormInit"/>
    </map:match>

$ vi event-actions.xmod

<map:action name="eventSatFormInit" src="com.mpobjects.event.eventsat.control.EventSatFormInitAction"/>

/ 7	. 

$ vi oms-service.sb.xml

	<bean id="com.mpobjects.oms.model.service.PathTemplateTransfer" parent="transactionRequiredTemplate" scope="prototype">
		<property name="target">
			<bean class="com.mpobjects.oms.model.service.PathTemplateTransferImpl">
->				<property name="eventSatDAO" ref="com.mpobjects.event.eventsat.model.dao.EventSatDAO" />


/ 7 . 

/ we check in	,

event-dao.sb.xml
event-actions.xmod
event-overrides-pipelines.xmxl
oms-service.sb.xml
SatSaveAction.java
SatFormAction.java
ServiceActionTemplate.standard.hbm.xml
PathTemplateTransferImpl.java
ServiceActionTemplate.java
sat_edit.jsp
PathServiceImpl.java

/ en - eventsat/
/ Deze rm de classes	,
EventSatFormInitAction.java  SatSaveListener.java
EventSatVO.java
EventSatDAOImpl.java  EventSatDAO.java  EventSat.standard.hbm.xml

/ MAANDAGOCHTEND

/ Einde FIX SCS-4423

/ NOTES SCS-4423

/ 7	. 

/ Als we een class delete	, en we willen hem weer terughalen	?

/ in project explorer, right click class, click delete	,

/ of	,
/ nu terughalen: right click project	, click Restore from local history	, select de class, click Restore	,

/ of	,
/ ga naar team synchronizing	, out mode	, en Revert	,

/ 7	. 

 26681857 | SAT_COLLECT

/ 7	. 

/ Bij edit	 de sat	,

public class EventSatFormInitAction extends AbstractFormInitAction {

	@Override
	public Map act() throws Exception {
		addSubmitListener(SatSaveListener.class);
/ sets SatSaveListener inst in session	,

FormTag.class
	public int doStartTag() throws JspTagException {

		setSubmitListenerList(new ArrayList<Class<? extends SubmitListener>>(AbstractFormInitAction.getSubmitDefinitionList(getSession())));
/ finds SatSaveListener 
		AbstractFormInitAction.getSubmitDefinitionList(getSession()).clear();

/ Bij save de sat	,

SatSaveAction(AbstractSaveAction).act() line: 64	
		validate();
/s
...
	protected void initSubmitListenerList() {
		try {
			Collection<Class<? extends SubmitListener>> myClassList = new HashSet<Class<? extends SubmitListener>>(getForm().getSubmitListenerList());

			theSubmitListenerList = new ArrayList<SubmitListener>(myClassList.size());
			for (Class<? extends SubmitListener> myListenerClass : myClassList) {
				myGlobalListenerClass = myListenerClass;
				myListener = myListenerClass.newInstance();
				initSubmitListener(myListener);
				theSubmitListenerList.add(myListener);

/ 7	. 

$ vi SatSaveListener.java 

public class SatSaveListener extends AbstractSubmitListener implements SubmitListener {

	@Override
	public void postSubmit() {
		Collection<EventTemplate> mySelectedEventTemplates = getAction().getFetchedData(EventTemplate.class);
		ServiceActionTemplate myServiceActionTemplateVO = (ServiceActionTemplate) getAction().getValueObject();
		MpoBeanFactory.getBean(EventSatDAO.class).storeEventTemplatesForSat(myServiceActionTemplateVO, mySelectedEventTemplates);

$ vi EventSatDAOImpl.java

	@Override
	public void storeEventTemplatesForSat(ServiceActionTemplate aServiceActionTemplateVO, Collection<EventTemplate> aSelectedEventTemplates) {
		Collection<EventTemplate> myOldEventTemplates = new ArrayList<EventTemplate>();
		for (EventSatVO myEventSat : getBySatSystemid(aServiceActionTemplateVO.getSystemId())) {
...

/ 7	. 

/ sitemap-actions.xml	,

$ vi sitemap-acctions.xml

<?xml version="1.0" encoding="UTF-8"?>&invoice-actions;
                        &extracking-actions;
                        &event-actions;
                        &ratecalc-actions;
                        &customerinvoice-actions;

/ deze refs naar event-actions.xmod	, 
/ Deze veranderen we in FIX SCS-4423	,

$ vi oms-sitemap.xmap
...
			<map:action name="organizationSelectionList" src="com.mpobjects.oms.control.organization.OrganizationSelectionListAction" logger="ratecalc"/>
			
			&generic-actions;
			&sitemap-actions;
       </map:actions>

$ vi sitemap-actions.xml
<?xml version="1.0" encoding="UTF-8"?>&invoice-actions;
                        &extracking-actions;
                        &event-actions;
                        &ratecalc-actions;
                        &customerinvoice-actions;
/ 7	. 

/ Wat is, uit base-framework	,
$ vi core-start-sitemap.xmap
...
			<map:action logger="sitemap.action.setattributes" name="applicationMessage" src="com.mpobjects.core.feedback.ApplicationMessageAction"/>
            &sitemap-actions;
            &generic-actions;
        </map:actions>

/ Deze refs ook naar sitemap-actions	,
/ TODO

/ 7	. 

/ Als we export een path template	, zien we 

/ rm bij ->

$ vi oms-service.sb.xml

	<bean id="com.mpobjects.oms.model.service.PathTemplateTransfer" parent="transactionRequiredTemplate" scope="prototype">
		<property name="target">
			<bean class="com.mpobjects.oms.model.service.PathTemplateTransferImpl">
->				<property name="eventSatDAO" ref="com.mpobjects.event.eventsat.model.dao.EventSatDAO" />





/ Einde NOTES SCS-4423

/ RM SCS-4423

/ 7	. 

public class EventSatFormInitAction extends AbstractFormInitAction {

	@Override
	public Map act() throws Exception {
->		addSubmitListener(SatSaveListener.class);
/ TODO
/ Moet deze ook in SatFormAction	?


/ 7	. 

SetFormAction

		Collection<ServiceOrderVO> myServiceOrderTemplates = new ArrayList<ServiceOrderVO>();
		if (myVO.getServiceOrderTemplateList() != null && !myVO.getServiceOrderTemplateList().isEmpty()) {
			for (ServiceOrderVO myServiceOrderTemplate : allServiceOrderTemplates) {
				if (myVO.getServiceOrderTemplateList().contains(myServiceOrderTemplate)) {
/ myVO=sat
					myServiceOrderTemplates.add(myServiceOrderTemplate);
				}
			}
		}
/ TODO 
/ Moet deze controle	? myVO.getServiceOrderTemplateList() is toch OK	?

		if (myVO.getSystemId() == ValueObject.VOLATILE_SYSTEM_ID) {
			Resource myResource = AuthenticationUtils.getResource();
			myVO.setOrganization(myResource.getActiveOrganization());
		}
/ TODO
		getRequest().setAttribute("serviceOrderTemplatesSelected", myServiceOrderTemplates);

/ 7	. 

$ vi event-overrides-pipelines.xmod
	<map:match pattern="oms/sat_edit">
		<map:act type="eventSatFormInit"/>
	</map:match>
	
	<map:match pattern="oms/sat_create">
		<map:act type="eventSatFormInit"/>
	</map:match>
/ TODO (voor uitschakelen EventSatFormInitAction)

$ vi service-actions.xmod
<map:action name="eventSatFormInit" src="com.mpobjects.event.eventsat.control.EventSatFormInitAction"/>
/ TODO


/ En EventSotFormInitAction 

$ vi SatSaveAction.java

public class SatSaveAction extends BoundSaveAction {

	@Override
	protected void handleSave() throws Exception {

		Collection<EventTemplate> eventTemplates = getFetchedData(EventTemplate.class);
		myVO.setEventTemplateList(eventTemplates);


/ Einde RM SCS-4423




/ Einde SCS-4423

/ SCS-4423

/ we starten met de database pnllogistics4t2	, 
pnllogistics4t2=# select es.* from event_sat es  where es.sat_systemid = 26764989;
 event_template_systemid | party_systemid | system_id | sat_systemid 
-------------------------+----------------+-----------+--------------
                26681722 |           NULL |  26813666 |     26764989
                26681721 |           NULL |  26813667 |     26764989
(2 rows)
pnllogistics4t2=# select  service_action_template_id from service_action_template where system_id=26764989;
 service_action_template_id 
----------------------------
 SAT_LINEHAUL-BE1
(1 row)






/ Einde SCS-4423

/ SCS-4423

/ 7	.

/ list van sat's	,

/ configuration , planning, service action templates

$ vi oms-sitemap.xmap
			<map:match pattern="service_action_template_list">
				<map:generate type="serverpages" src="xsp/service-action-template-list.xml"/>
				<map:call resource="dynatable-styler"/>
			</map:match>

$ vi service-action-template-list.xml
	...
    ServiceActionTemplatesView myView = new ServiceActionTemplatesView(request);            
/s
ServiceActionTemplatesView.<init>(Request) line: 29	
aRequest	org.apache.cocoon.environment.http.HttpRequest  (id=23461)	
	reqURI	"/tms/oms/service_action_template_list" (id=23474)	
		init(new RequestAdaptor(aRequest), null);
/s
ServiceActionTemplatesView(AbstractView).init(HttpServletRequest, HttpServletResponse) line: 97	
/=
	public void init(HttpServletRequest aRequest, HttpServletResponse aResponse) {
aReponse=null
...

/t
/s
ServiceActionTemplatesView.getSaTemplateList() line: 37	
		PathService myBAO = PathUtil.getPathService();
		return myBAO.getOrgServiceActionTemplates(getActiveResource());
/s
PathServiceImpl.getOrgServiceActionTemplates(Resource) line: 94	
		ServiceActionTemplateDAO myDAO = MpoBeanFactory.getBean(ServiceActionTemplateDAO.class);
		return myDAO.getServiceActionTemplateList();
/s
ServiceActionTemplateDAOImpl.getServiceActionTemplateList() line: 141	
		return getAll();
/s
			return getAll(false);
/s
ServiceActionTemplateDAOImpl(GenericHibernateDAO).getAll(boolean) line: 264	
/=
	public List<Type> getAll(boolean aShowDeleted) {
aShowDeleted=false
		if (aShowDeleted || !isDeletable()) {
			return (List<Type>) getHibernateTemplate().loadAll(type);
/t
/ xsp page	,
    Collection myList = myView.getSaTemplateList();

/ 7	. 

/ edit sat	,


/ we click edit SAT_COLLECT	,
http://localhost:8080/tms/oms/sat_edit?base_sessionLevelOffset=1&systemid=26681857&systemId=26681857

$ vi oms-sitemap.xmap

			<map:action logger="serviceaction" name="satForm" src="com.mpobjects.oms.control.serviceactiontemplate.action.SatFormAction"/>
			<map:match type="regexp" pattern="^sat_(edit|create)$">
				<map:act type="satForm"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/sat_edit.jsp"/>
			</map:match>

/ we click edit SAT_COLLECT	,
/s
SatFormAction.act() line: 33	
		int mySystemId = getSystemIdFromRequest();
26681857
/ Klopt de sa	,
		} else {
			myVO = MpoBeanFactory.getBean(ServiceActionTemplateDAO.class).getServiceActionTemplate(getSystemIdFromRequest());
/s
ServiceActionTemplateDAOImpl.getServiceActionTemplate(int) line: 122	
		ServiceActionTemplate myBySystemId = getBySystemId(aSystemId);
/ proxy, NIET init	, dus handler.initialized=false
		Hibernate.initialize(myBySystemId);
/ proxy, WEL init	, dus handler.initialized=true

/t
SatFormAction.act() line: 49	
		} else {
			myVO = MpoBeanFactory.getBean(ServiceActionTemplateDAO.class).getServiceActionTemplate(getSystemIdFromRequest());
/d
		Collection<ServiceOrderVO> allServiceOrderTemplates = MpoBeanFactory.getBean(ServiceOrderDao.class).getTemplates(null, null);
/s
RcaServiceOrderDAOImpl(ServiceOrderDaoImpl).getTemplates(OrderProcess, ServiceOrderType) line: 1012	
/=
	public List<ServiceOrderVO> getTemplates(OrderProcess anOrderProcess, ServiceOrderType aServiceOrderType) {
this	com.mpobjects.ratecalc.dao.RcaServiceOrderDAOImpl  (id=28550)	
	type	java.lang.Class (com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO) (id=20173)	

		DetachedCriteria myDetachedCriteria = DetachedCriteria.forClass(type);
		myDetachedCriteria.add(Property.forName(TEMPLATE).eq(true));
TEMPLATE="template"
		...
		return findByCriteria(myDetachedCriteria);
/t
SatFormAction.act() line: 50	
		Collection<ServiceOrderVO> allServiceOrderTemplates = MpoBeanFactory.getBean(ServiceOrderDao.class).getTemplates(null, null);
/d
/ het zijn er 35	, 
/ klopt	,
pnllogistics4=# \c pnllogistics4t
You are now connected to database "pnllogistics4t" as user "mpopostgres".
pnllogistics4t=# select count(*) from service_order where is_template=1;
 count 
-------
    35
(1 row)

		getRequest().setAttribute("serviceOrderTemplates", allServiceOrderTemplates);
		Collection<ServiceOrderVO> myServiceOrderTemplates = new ArrayList<ServiceOrderVO>();
		if (myVO.getServiceOrderTemplateList() != null && !myVO.getServiceOrderTemplateList().isEmpty()) {
/ myVO = sat
			for (ServiceOrderVO myServiceOrderTemplate : allServiceOrderTemplates) {
				if (myVO.getServiceOrderTemplateList().contains(myServiceOrderTemplate)) {
/ 1 keer	,
					myServiceOrderTemplates.add(myServiceOrderTemplate);
[COLLECT/26682241]
/  de sat heeft list van seo (templates)	, via de koppel table service_action_order_template	, we zien ze WH in de sat page , onder tab service order templates, bij Actual 

		getRequest().setAttribute("serviceOrderTemplatesSelected", myServiceOrderTemplates);
		getRequest().setAttribute("formvo", myVO);

/ 13	. 

/ sat_edit.jsp	,

<%@taglib uri="http://www.mp-objects.com/taglibs/mpo" prefix="mpo" %>
<%@taglib prefix="cf" uri="/WEB-INF/tld/core-functions.tld"%>

            <!--  if module event exists -->
				<c:if test = "${cf:property('event','enabled', '')}">
			             <mpo:manyToManyRelation data="${eventTempl}" selected="${eventTemplSelected}" >
				            	<mpo:list name="eventTemplate">
				            		<mpo:field name="eventTypeCode"/>

/ 13	. 

/ zoek naar eventTempl	, we vinden	,

$ vi EventSatFormInitAction.java 

	@Override
	public Map act() throws Exception {
		addSubmitListener(SatSaveListener.class);

		getRequest().setAttribute(
				"eventTempl",
				MpoBeanFactory.getBean(EventTemplateDAO.class).getAllEventTemplatesForActivatableOrganisations(
						ResourceUtil.getResource().getActivatableOrganizationSystemids()));
		getRequest().setAttribute("eventTemplSelected", MpoBeanFactory.getBean(EventTemplateDAO.class).getAllEventTemplatesForSat(getSystemIdFromRequest()));

		return EMPTY_MAP;
	}

$ vi EventSotFormInitAction.java 

	@Override
	public Map act() throws Exception {
		addSubmitListener(SotSaveListener.class);

		getRequest().setAttribute(
				"eventTempl",
				MpoBeanFactory.getBean(EventTemplateDAO.class).getAllEventTemplatesForContainersForActivatableOrganizations(
						ResourceUtil.getResource().getActivatableOrganizationSystemids()));
		getRequest().setAttribute("eventTemplSelected", MpoBeanFactory.getBean(EventTemplateDAO.class).getAllEventTemplatesForSot(getSystemIdFromRequest()));

		return EMPTY_MAP;
	}


$ vi event-actions.xmod
<?xml version="1.0" encoding="UTF-8" ?>
<map:action name="serviceOrderEventsFormInit" src="com.mpobjects.event.event.control.ServiceOrderEventsFormInitAction"/>
<map:action name="eventTemplatePartyFormInit" src="com.mpobjects.event.eventtemplateparty.control.EventTemplatePartyFormInitAction"/>
<map:action name="eventSatFormInit" src="com.mpobjects.event.eventsat.control.EventSatFormInitAction"/>
<map:action name="eventSotFormInit" src="com.mpobjects.event.eventsot.control.EventSotFormInitAction"/> 

/ Hoe gaat dit?

$ vi sitemap-actions.xml
<?xml version="1.0" encoding="UTF-8"?>&invoice-actions;
                        &extracking-actions;
                        &event-actions;
                        &ratecalc-actions;
                        &customerinvoice-actions;
/ TODO


/ 1313	.

/ Doe	,
[eric@localhost trunk]$ find -path \*/WEB-INF/tld/core-functions.tld
[eric@localhost trunk]$ find -path "*/WEB-INF/tld/core-functions.tld"
./base-framework/core/war/WEB-INF/tld/core-functions.tld


<function>
	<name>property</name>
    <function-class>com.mpobjects.core.ApplicationPropertyManager</function-class>
    <function-signature>
        java.lang.String  taglibGetProperty(java.lang.String,java.lang.String,java.lang.String)
    </function-signature>
</function>

/ we set b	,
/s
ApplicationPropertyManager.taglibGetProperty(String, String, String) line: 136	
aModule	"event" (id=22203)	
aKey	"enabled" (id=22205)	
aDefaultValue	"" (id=22208)	
/s
		return getProperty(getPropertyKey(aModule, aKey), aDefaultValue);
getPropertyKey(aModule, aKey)=module.event.enabled
/s
ApplicationPropertyManager.getProperty(String, String) line: 531	
		String myReturnValue = null;
		Resource myResource = AuthenticationUtils.getResource();
		if (myResource != null) {
			myReturnValue = myResource.getProperty(aKey);
			if (myReturnValue == null) {
null
				myReturnValue = getDatabaseProperty(aKey, null);
aKey=module.event.enabled
null

		if (myReturnValue == null) {
/ JA
			myReturnValue = getApplicationProperty(aKey, aDefaultValue);
true

/ 1313	.

<%@taglib uri="http://www.mp-objects.com/taglibs/mpo" prefix="mpo" %>
/=
./base-framework/core/war/WEB-INF/tld/mpo.tld

/ In jboss	,
[eric@localhost deploy]$ ls tms.war/WEB-INF/tld/mpo.tld 

/ TODO

/ Intermezzo

/ we kunnen de urls geven	,
https://test-pnl.mp-objects.com/pnllogistics/authentication/login-form
https://test-pnl.mp-objects.com/pnllogistics/core/index_frameset

/ we zien in jboss	,
[eric@localhost deploy]$ ls tms.war/core/jsp/index_frameset.jsp 

[eric@localhost deploy]$ less tms.war/authentication/authentication-sitemap.xmap 
                        <map:match pattern="login-form">
                                <map:act type="authLoggedInCheck">
                                        <map:redirect-to uri="../" />
                                </map:act>
                                <map:read mime-type="text/html" src="jsp/login_form.jsp" type="jsp"/>
                        </map:match>
[eric@localhost deploy]$ less tms.war/authentication/jsp/login_form.jsp 

[eric@localhost deploy]$ less tms.war//core/core-sitemap.xmap 
            <map:match pattern="index_frameset">
                                <map:act type="setLocale"/>
                                <map:act type="generateMenu">
                                        <map:parameter name="cssClass" value="xMenu"/>
                                        <map:parameter name="sessionAttribute" value="userMenu"/>
                                        <map:parameter name="urlPrefix" value="../"/>
                                </map:act>                              
                <map:generate type="jsp" src="jsp/index_frameset.jsp"/>
                <map:serialize type="html"/>
            </map:match>
 
/ Einde Intermezzo

$ vi mpo.tld
<taglib>
	<uri>http://www.mp-objects.com/taglibs/mpo</uri>
	<tag>
		<name>manyToManyRelation</name>
		<tagclass>com.mpobjects.view.taglib.form.ManyToManyRelationTag</tagclass>
		<bodycontent>scriptless</bodycontent>
		<attribute>
			<name>data</name>
			<required>true</required>
			<rtexprvalue>true</rtexprvalue>
		</attribute>
		<attribute>
			<name>selected</name>
			<required>true</required>
			<rtexprvalue>true</rtexprvalue>
		</attribute>
	</tag>

/ 1313	.

/ we zijn nog in	,
			             <mpo:manyToManyRelation data="${eventTempl}" selected="${eventTemplSelected}" >
				            	<mpo:list name="eventTemplate">
				            		<mpo:field name="eventTypeCode"/>

/s
ManyToManyRelationTag.doTag() line: 69	
		if (getData() != null && getData().size() > 0) {
/=
	theData
this	com.mpobjects.view.taglib.form.ManyToManyRelationTag  (id=23856)	
	theData	java.util.ArrayList  (id=23958)	
		elementData	java.lang.Object[15]  (id=23960)	
			[0]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=23978)	
			[1]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=23979)	
			[2]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=23980)	
			[3]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=23981)	
			[4]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=23982)	
			[5]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=23983)	
			[6]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=24074)	
			[7]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=24076)	
			[8]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=24077)	
			[9]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=24078)	
			[10]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=24079)	
			[11]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=24081)	
			[12]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=24082)	
		size	13	

/ 13	. 

/ Waar komt deze vandaan	?

/s
EventSatFormInitAction.act() line: 17	
		addSubmitListener(SatSaveListener.class);
/ TODO
		getRequest().setAttribute(
				"eventTempl",
				MpoBeanFactory.getBean(EventTemplateDAO.class).getAllEventTemplatesForActivatableOrganisations(
						ResourceUtil.getResource().getActivatableOrganizationSystemids()));
ResourceUtil.getResource().getActivatableOrganizationSystemids()= [500, 1020, 1010, 1]
/s
EventTemplateDAOImpl.getAllEventTemplatesForActivatableOrganisations(Collection<Integer>) line: 42	
/=
	public Collection<EventTemplate> getAllEventTemplatesForActivatableOrganisations(Collection<Integer> anOrganisationSystemIdList) {
anOrganisationSystemIdList= [500, 1020, 1010, 1]	,  list van integers	,

		for (Integer anOrganisationSystemid : anOrganisationSystemIdList) {
			myOrganisationListString = myOrganisationListString.concat("," + anOrganisationSystemid);
		}
		myOrganisationListString = myOrganisationListString.replaceFirst(",", "");
500,1020,1010,1
		String myQuery = 
"Select et.* 
from event_template et 
where et.organization_systemid in (" + myOrganisationListString + ") 
and et.is_container_event = 0 and et.is_deleted = 0";

/ Intermezzo

/ we doen met de hand	,

pnllogistics4t=# select count(*)from event_template 
where organization_systemid in (500, 1020, 1010, 1)
-- and is_container_event=0 							-- maakt niet uit	,
and is_deleted=0;
 count 
-------
    13
(1 row)

/ 7	. 

public class EventTemplateDAOImpl extends EnumeratedValueObjectHibernateDAO<EventTemplate> implements EventTemplateDAO {
	public EventTemplateDAOImpl() {
		super(EventTemplate.class);
/s
@Transactional
public abstract class BaseHibernateDAO<T> extends HibernateDaoSupport {
	protected BaseHibernateDAO(Class<? extends T> aType) {
		super();
		type = aType;
	}

/ -> type=EventTemplate.class

/ Dit wordt used hieronder in de query	,


/ Einde Intermezzo

		return executeSqlSelect(myQuery, "et");
...
/s
EventTemplateDAOImpl(BaseHibernateDAO).executeSqlSelect(String, String, Collection<QueryParameter>, int, int) line: 211	
/=
	protected List<T> executeSqlSelect(final String aSql, final String anAlias, final Collection<QueryParameter> aParameters, final int aMaxResult, final int aFirstResult) {
		try {
			return getHibernateTemplate().executeFind(new HibernateCallback() {
				@Override
				public Object doInHibernate(Session aSession) throws HibernateException, SQLException {
					SQLQuery query = aSession.createSQLQuery(aSql);
					for (QueryParameter parameter : aParameters) {
						parameter.setValue(query);
					}
->					query.addEntity(anAlias, type);
/ type=EventTemplate.class

/t
EventSatFormInitAction.act() line: 23	

		getRequest().setAttribute(
				"eventTempl",
				MpoBeanFactory.getBean(EventTemplateDAO.class).getAllEventTemplatesForActivatableOrganisations(
						ResourceUtil.getResource().getActivatableOrganizationSystemids()));
/d
		getRequest().setAttribute("eventTemplSelected", MpoBeanFactory.getBean(EventTemplateDAO.class).getAllEventTemplatesForSat(getSystemIdFromRequest()));
/ getSystemIdFromRequest()=26681857
/ system_id van de sat	,
/s
	@Override
	@RefactorTodo(note = "Turn it around? but don't use sys id", responsible = "tantely")
	public Collection<EventTemplate> getAllEventTemplatesForSat(int aSatId) {
		String myQuery = "
Select et.* 
from event_template et, event_sat es " + "
where es.sat_systemid IN (" + aSatId + ") " + "
and es.event_template_systemid = et.system_id";

		return executeSqlSelect(myQuery, "et");
	}

/ Intermezzo

/ we doen met de hand	,
/ maar we doen ook een extra join	,

pnllogistics4t=# select et.expected_end_expr,typ.name
from event_template et
join event_sat es on es.event_template_systemid = et.system_id
join event_type typ on et.event_type_systemid=typ.system_id
where es.sat_systemid IN (26681857);
 expected_end_expr | name 
-------------------+------
 plannedEnd+0M     | J27
(1 row)


/ Einde Intermezzo

/ SAMENVATTING

/ Nu begrijpen we	,

$ vi sat_edit.jsp
           <!--  if module event exists -->
			             <mpo:manyToManyRelation 
			            	data="${eventTempl}" 
			            	selected="${eventTemplSelected}" >

/ eventTempl	,
pnllogistics4t=# select count(*)from event_template 
where organization_systemid in (500, 1020, 1010, 1)
-- and is_container_event=0 							-- maakt niet uit	,
and is_deleted=0;
 count 
-------
    13
(1 row)

/ eventTemplSelected	,
pnllogistics4t=# select evt.expected_end_expr,typ.name
from event_sat evt_sat
join event_template evt on evt.system_id=evt_sat.event_template_systemid 
join service_action_template sat on  sat.system_id=evt_sat.sat_systemid
join event_type typ on evt.event_type_systemid=typ.system_id
where sat.system_id =26681857;
 expected_end_expr | name 
-------------------+------
 plannedEnd+0M     | J27
(1 row)

/ Einde SAMENVATTING

/ 7	. 

/ nu	,

$ vi sat_edit.jsp

             	<mpo:tab name="serviceOrderTemplates">
		 			  <mpo:manyToManyRelation 
		            	data="${serviceOrderTemplates}" 
		            	selected="${serviceOrderTemplatesSelected}" >

$ vi SatFormAction.java
/ See boven	, 

/ SAMENVATTING

/ serviceOrderTemplates
pnllogistics4t=# select count(*) from service_order where is_template=1;
/ See boven	,



/ Einde SAMENVATTING


/ Einde SCS-4423


/ DEBUG SCS-4423

/ 7	. 

/ Als we edit een sat click 	, 

/ eerst	, 
EventSatFormInitAction.act() line: 17	
/ dan 	,
SatFormAction.java

/ In EventSatFormInitAction.act wordt de SatSaveListener in de session set	,  en daarna in de FormTag	, 
/ als we hieronder save de sat	, dan wordt deze listener uit de FormTag gelezen en in de SatSaveAction set	, zodat de listener getAction kan doen	, 

/s
EventSatFormInitAction.act() line: 17	
		addSubmitListener(SatSaveListener.class);
/s
EventSatFormInitAction(AbstractFormInitAction).addSubmitListener(Class<SubmitListener>) line: 56	
		getSubmitDefinitionList(new SessionAdaptor(getSession())) .add(aClass);
/s
AbstractFormInitAction.getSubmitDefinitionList(HttpSession) line: 37	
		if (aSession.getAttribute(SUBMIT_LISTENER_ATTRIBUTE) == null) {
SUBMIT_LISTENER_ATTRIBUTE="FROM_SUBMIT_LISTENERS"
/ NEE
		return (Collection<Class<? extends SubmitListener>>) aSession.getAttribute(SUBMIT_LISTENER_ATTRIBUTE);
[]
/t
EventSatFormInitAction(AbstractFormInitAction).addSubmitListener(Class<SubmitListener>) line: 56	
		getSubmitDefinitionList(new SessionAdaptor(getSession())).add(aClass);
[class com.mpobjects.event.eventsat.control.SatSaveListener]

/c
FormTag.doStartTag() line: 246	
		setSubmitListenerList(new ArrayList<Class<? extends SubmitListener>>(AbstractFormInitAction.getSubmitDefinitionList(getSession())));
/s
public abstract class AbstractFormInitAction extends AbstractAction {
		return (Collection<Class<? extends SubmitListener>>) aSession.getAttribute(SUBMIT_LISTENER_ATTRIBUTE);
/ Hier waren we net ook	, toen was deze nog []	, en werd er daarna .add op gedaan	,

/t
/s
FormTag.setSubmitListenerList(Collection<Class<SubmitListener>>) line: 619	
		theSubmitListenerList = aSubmitListenerList;

////////////////////
/ dus de submit listener (list) wordt door edit sat in de formtag set	, door hem uit de session te lezen	, 
/ Dit gebeurt dus bij edit de sat	,

/ 	7	. 

/ we click Save	de sat	,
/ voor handleSave	, eerst validate	,

/s
SatSaveAction(AbstractSaveAction).act() line: 64	
		validate();
/s
SatSaveAction(BoundSaveAction).validate() line: 223	
				if (shouldHandleFieldPrefix(myField.getPrefix())) {
myField	com.mpobjects.view.taglib.form.ListFieldTag  (id=27360)	
organization
/s
SatSaveAction(BoundSaveAction).shouldHandleFieldPrefix(String) line: 290	
		// let all listeners validate
		for (SubmitListener myListener : getSubmitListenerList()) {
/s
SatSaveAction(BoundSaveAction).getSubmitListenerList() line: 237	
		if (theSubmitListenerList == null) {
			initSubmitListenerList();
/s
SatSaveAction(BoundSaveAction).initSubmitListenerList() line: 271	
			Collection<Class<? extends SubmitListener>> myClassList = new HashSet<Class<? extends SubmitListener>>(getForm().getSubmitListenerList());
/ In edit de sat	, werd de submit listener list in de formtag set	,

			theSubmitListenerList = new ArrayList<SubmitListener>(myClassList.size());
			for (Class<? extends SubmitListener> myListenerClass : myClassList) {
				myGlobalListenerClass = myListenerClass;
				myListener = myListenerClass.newInstance();
				initSubmitListener(myListener);
/s
SatSaveAction(BoundSaveAction).initSubmitListener(SubmitListener) line: 243	
		aConstructedListener.setAction(this);
this	com.mpobjects.oms.control.leggen.action.SatSaveAction  (id=27716)	

/ Intermezzo

/ Straks 	,
public class SatSaveListener extends AbstractSubmitListener implements SubmitListener {

	@Override
	public void postSubmit() {
		Collection<EventTemplate> mySelectedEventTemplates = getAction().getFetchedData(EventTemplate.class);
 

/ Einde Intermezzo

/ 7	. 

/ Als we
service action template list , via configuration, planning, service action templates 
/ dan vallen we in 	,
ServiceActionTemplatesView.<init>(Request) line: 29	

$ vi oms-sitemap.xmap
			<map:match pattern="service_action_template_list">
				<map:generate type="serverpages" src="xsp/service-action-template-list.xml"/>
				<map:call resource="dynatable-styler"/>
			</map:match>

$ vi service-action-template-list.xml
           ServiceActionTemplatesView myView = new ServiceActionTemplatesView(request);            

/ en daarna in	,
ServiceActionTemplatesView.getSaTemplateList() line: 37	
		PathService myBAO = PathUtil.getPathService();
		return myBAO.getOrgServiceActionTemplates(getActiveResource());
/ rol resource	,
 
/ 7	. 

/ 'Service Action Template'	,
/ we click op Save 

/s
SatSaveAction.handleSave() line: 29	
		ServiceActionTemplate myVO = (ServiceActionTemplate) getValueObject();

/ Intermezzo

/ alvast antwoord	,

/ getValueObject() set alle value objects in deze action's .theFetchedData	, en returns de 1ste, dat is een sat	,

this	com.mpobjects.oms.control.leggen.action.SatSaveAction  (id=21292)	
	theFetchedData	java.util.ArrayList  (id=21685)	
		elementData	java.lang.Object[10]  (id=21849)	
			[0]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=21330)	
			[1]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=21330)	
			[2]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=21330)	
			[3]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=21330)	
			[4]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=21330)	
			[5]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=21330)	
			[6]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=21330)	
			[7]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=21330)	
			[8]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=21850)	
			[9]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=21851)	
		size	10	
/ en 	,
			getRequest().setAttribute(TAGLIB_FETCHED_DATA, theFetchedData);
TAGLIB_FETCHED_DATA="taglibFetchedData"


/ Einde Intermezzo
/s
SatSaveAction(BoundSaveAction).getValueObject() line: 197	
		return getFetchedData().iterator().next();
/s
SatSaveAction(BoundSaveAction).getFetchedData() line: 119	
				Collection<DataFetchable> myFetchFields = getForm().getDataFetchableFields();
this=SatSaveAction
getForm()=theFormTag
/ Dit is een JSP object	,
/s
FormTag.getDataFetchableFields() line: 346	
this	com.mpobjects.view.taglib.form.FormTag  (id=22763)	

		for (Object myField : fieldList) {
			if (myField instanceof DataFetchable) {
/ JA
				myList.add((DataFetchable) myField);
			}
		}
		for (Object myField : manyToManyList) {
			if (myField instanceof DataFetchable) {
/ JA
				myList.add((DataFetchable) myField);
			}
		}
		return myList;

/ Intermezzo

	fieldList	java.util.ArrayList  (id=23167)	
[ organization,  serviceActionTypeSystemid,  ServiceActionTemplateId,  planningMode,  executionMode,  offlinePlanningMode,  replanCriteria,  serviceOrderReplanCriteria,  consolidationCriteria,  consolidationWindowHrs,  avgLeadtimeHrs,  reference1,  reference2,  reference3,  reference4,  reference5,  remarks,  handlingInstructions,  optimizationPossibleFlag,  copyScheduleMode,  containerMode,  consolidationSearchMode,  consolidationHoldStatus,  copyLocationFrom,  fromParty,  fromName,  fromName2,  fromAddress,  fromAddress2,  fromCity,  fromPostalCode,  fromRegionState,  fromCountry,  fromPhoneNumber,  fromFaxNumber,  fromEmailAddress,  fromContactName,  toLocationCopyFlag,  toParty,  toName,  toName2,  toAddress,  toAddress2,  toCity,  toPostalCode,  toRegionState,  toCountry,  toPhoneNumber,  toFaxNumber,  toEmailAddress,  toContactName]

	manyToManyList	java.util.ArrayList  (id=21261)	
[com.mpobjects.view.taglib.form.ManyToManyRelationTag@7db16380, com.mpobjects.view.taglib.form.ManyToManyRelationTag@8fba8f8]
/ De 2 lists met alle event templates en alle seo (templates)	,


$ vi FormTag.java
	@Override
	public FieldTag addField(FieldTag aField) {
		try {
			FieldTag myClonedField = (FieldTag) aField.clone();
			fieldList.add(myClonedField);

/ Deze .addField wordt called in .doStartTag	, bijv	,
$ vi FileFieldTag.java
		getFieldOwner().addField(this);

/ Dus WH field die zichzelf hebben aangemeld zijn  
/ TODO

/Einde Intermezzo

/t
SatSaveAction(BoundSaveAction).getFetchedData() line: 128	
			if (theFetchedData == null) {
				Collection<DataFetchable> myFetchFields = getForm().getDataFetchableFields();
/d
				for (DataFetchable myDataFetchable : myFetchFields) {
					shouldHandle = true;
					if (myDataFetchable instanceof FieldTag) {
						myField = (FieldTag) myDataFetchable;
						shouldHandle = shouldHandleFieldPrefix(myField.getPrefix());
myField.getPrefix()=""
					}
					if (shouldHandle) {
						myDataFetchable.fetchData();
myDataFetchable	com.mpobjects.view.taglib.form.ListFieldTag  (id=23272)	
/s
ListFieldTag.fetchData() line: 117	

//////////////////////////
/ fetchData pakt value uit form, dit is de code van de organization	, hij queries binnen de activatable org.s van de resource (eric) die deze code heeft	, en set deze in de sat onder de organization property	, 
/ fetchData gets ook de organization uit de sat	, maar omdat forceSync()==true	, gaat hij toch wat in de regel hierboven staat doen	,
/////////////////////////////


		if (isFetchData() && !isCurrentlyReadOnly()) {
			String myCode = getValueFromRequest(getFormFieldName());
"PNL-CARGO"
/ want	,
/s
ListFieldTag(FieldTag).getValueFromRequest(String) line: 1206	
///////////////////////////////////////////////////////////////////////
		return getRequest().getParameter(aName);
"PNL-CARGO"
/t
ListFieldTag.fetchData() line: 131	
			String myCode = getValueFromRequest(getFormFieldName());
/d
PNL-CARGO
			if (StringUtils.isEmpty(myCode)) {
/ NEE
			} else {
				String myCurrentCode = "";
				UniqueFieldValueObject myVO = VOReflectionInvoker.getValueAsUniqueVO(getActiveValueObject(), getName());
/s
ListFieldTag(FieldTag).getActiveValueObject() line: 391	
		} else {
			myRet = getActiveValueObjectHolder().getActiveValueObject();
/s
this	com.mpobjects.view.taglib.form.ListFieldTag  (id=23272)	
/ getActiveValueObjectHolder()==this.activeValueHolder=com.mpobjects.view.taglib.form.SetFormVOTag@17fc1d30
/t
/s
SetFormVOTag.getActiveValueObject() line: 123	
		return getValueObject();
/= 		return theValueObject;
theValueObject	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=23926)	

/ Intermezzo

/ Klopt	, in JSP	,
        	 <mpo:setFormVO valueObject="${formvo}">
								  <mpo:listField name="organization" type="organization" />
/ en formvo=sat (proxy)	,

$ vi SatFormVO.java

	public Map act() throws java.lang.Exception {
		} else {
			myVO = MpoBeanFactory.getBean(ServiceActionTemplateDAO.class).getServiceActionTemplate(getSystemIdFromRequest());
		...
		getRequest().setAttribute("formvo", myVO);

/ Einde Intermezzo

/t
ListFieldTag.fetchData() line: 132	
				UniqueFieldValueObject myVO = VOReflectionInvoker.getValueAsUniqueVO(getActiveValueObject(), getName());
/d getActiveValueObject()=proxy naar de sat	,
/ getName()="organization"
/s
VOReflectionInvoker.getValueAsUniqueVO(EntityInterface, String) line: 529	
/=
	public static UniqueFieldValueObject getValueAsUniqueVO(EntityInterface aVO, String aFieldName) {
aVO=proxy naar de sat	,
aFieldName="organization"
		EntityInterface myRet = getValueAsVO(aVO, aFieldName);
/s
VOReflectionInvoker.getValueAsVO(EntityInterface, String) line: 539	
		String myTmpMethodName = "get" + StringUtils.firstCharToUpper(aFieldName) + "Systemid";
myTmpMethodName	"getOrganizationSystemid" (id=26975)	
/ ServiceActionTemplate.getrganizationSystemid() is er	,
		// this check is used to return null, in the case the systemId is null
		if (hasMethod(aVO, myTmpMethodName, 0)) {
			int mySystemId = getValueAsInt(aVO, aFieldName + "Systemid");
mySystemId	500	
			} else {
				myRet = getValueAsObject(aVO, aFieldName + "VO");
/ property organizationVO, method getOrganizationVO()	,
/s
VOReflectionInvoker.getValueAsObject(EntityInterface, String) line: 863	
/=
	public static Object getValueAsObject(EntityInterface aVO, String aFieldName) throws IllegalArgumentException {
aVO	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=23926)	
aFieldName	"organizationVO" (id=27386)	

		ValueObjectMethod myValueObjectMethod = findMethod(aVO, TYPE_GET, StringUtils.firstCharToUpper(aFieldName), 0);
/ get method	,
					myRet = myMethod.invoke(myVO, new Object[] {});
myRet	com.mpobjects.oms.model.entity.organization.Organization  (id=26339)	
/t
ListFieldTag.fetchData() line: 132	
				UniqueFieldValueObject myVO = VOReflectionInvoker.getValueAsUniqueVO(getActiveValueObject(), getName());
/d
				if (myVO != null) {
					myCurrentCode = myVO.getCode();
PNL-CARGO
				}
				if (getForceSync() || !StringUtils.equals(myCode, myCurrentCode)) {
/ JA, getForceSync()==true
					String valueStorageStrategy = getListInputProxy().getValueStorageStrategy();
"LOAD_VO"
					if (valueStorageStrategy.equals(ListInputProxy.VALUE_STORAGE_STRATEGY_SET_CODE)) {
/ NEE
					} else if (!valueStorageStrategy.equals(ListInputProxy.DO_NOTHING)) {
						ListInputProxy proxy = getListInputProxy();
proxy	com.mpobjects.oms.control.organization.OrganizationInputProxy  (id=26193)	
						} else {
							myValue = proxy.getByCode(getType(), getFilter(), myCode);
/ antwoord:
myValue	com.mpobjects.oms.model.entity.organization.Organization  (id=26339)	
SystemId:500	Id:PNL-CARGO	Description:PostNL Cargo
/want	,
this	com.mpobjects.view.taglib.form.ListFieldTag  (id=23272)	
/ getType()=theType="organization"
/ getFilter()=""
myCode="PNL-CARGO"
/s
OrganizationInputProxy.getByCode(String, String, String) line: 88	
			} else {
				myOrganizationList = ResourceUtil.getResource().getActivatableOrganizations();
this	com.mpobjects.oms.control.organization.OrganizationInputProxy  (id=26193)	
aType	"organization" (id=23612)	
aFilter	"" (id=23611)	
aCode	"PNL-CARGO" (id=23855)	
myUnique	null	
myOrganizationList	java.util.ArrayList  (id=26424)	
	elementData	java.lang.Object[10]  (id=26426)	
		[0]	com.mpobjects.oms.model.entity.organization.Organization  (id=26339)	
		[1]	com.mpobjects.oms.model.entity.organization.Organization  (id=26428)	
		[2]	com.mpobjects.oms.model.entity.organization.Organization  (id=26430)	
		[3]	com.mpobjects.oms.model.entity.organization.Organization  (id=26431)	
	size	4	

/ Hij zoekt in activatable organization op code="PNL-CARGO"	,
			for (Iterator myIterator = myOrganizationList.iterator(); myIterator.hasNext();) {
				Organization myOrganizationVO = (Organization) myIterator.next();
				if (myOrganizationVO.getCode().equals(aCode)) {
					myUnique = myOrganizationVO;
					break;
		return myUnique;
/t
ListFieldTag.fetchData() line: 163	
						} else {
							myValue = proxy.getByCode(getType(), getFilter(), myCode);
/d
							VOReflectionInvoker.setUniqueFieldValue(getActiveValueObject(), getName(), myValue);
/ getActiveValueObject()=sat (proxy)	, getName()=property name="organization"	, 
////////////////////////////////////////////////
/ dit is in Wicket PropertyModel	,
////////////////////////////////////////////////
/s
VOReflectionInvoker.setUniqueFieldValue(EntityInterface, String, UniqueFieldValueObject) line: 788	
/=
	public static void setUniqueFieldValue(EntityInterface aVO, String aFieldName, UniqueFieldValueObject aValue) {
aVO	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=23926)	
aFieldName	"organization" (id=23612)	
aValue	com.mpobjects.oms.model.entity.organization.Organization  (id=26339)	

/ Intermezzo

/ .valueObject() geeft WH een sat (proxy naar de sat	, die er ook is=handle.target)	, met alle form data in de sat target (de echte sat)	, 

/ In Wicket: CompoundPropertyModel(customer)	, WH writes naar customer	, dus Wicket model mechanisme dat writes naar de obj	,

/ Einde Intermezzo

		if (aValue instanceof EnumeratedValueObject) {
			setEnumeratedValue(aVO, aFieldName, (EnumeratedValueObject) aValue);
/s
VOReflectionInvoker.setEnumeratedValue(EntityInterface, String, EnumeratedValueObject) line: 679	
		setValue(aVO, aFieldName + "VO", myValue);
/s
VOReflectionInvoker.setValue(EntityInterface, String, Object) line: 805	
/=
	public static void setValue(EntityInterface aVO, String aFieldName, Object aValue) {
aVO	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=23926)	
aFieldName	"organizationVO" (id=26768)	
aValue	com.mpobjects.oms.model.entity.organization.Organization  (id=26339)	

		ValueObjectMethod myValueObjectMethod = findMethod(aVO, TYPE_SET, aFieldName, 1);
TYPE_SET="set"	, dus zoekt de set method	,
			myMethod.invoke(myVO, new Object[] { aValue });
/ myMethod=public final void com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14.setOrganizationVO(com.mpobjects.oms.model.entity.organization.Organization)

/t
						} else {
							myValue = proxy.getByCode(getType(), getFilter(), myCode);
							VOReflectionInvoker.setUniqueFieldValue(getActiveValueObject(), getName(), myValue);
/d
////////////////////////////////////////////////////////////////
/ Heeft organization field in de sat set met de activatable organization   van de resource  die de code heeft die in de form staat 	,

/t
SatSaveAction(BoundSaveAction).getFetchedData() line: 129	
				Collection<DataFetchable> myFetchFields = getForm().getDataFetchableFields();

				for (DataFetchable myDataFetchable : myFetchFields) {
						myDataFetchable.fetchData();
/d
/ volgende	,
/s
DropDownFieldTag.fetchData() line: 181	
this	com.mpobjects.view.taglib.form.DropDownFieldTag  (id=27613)	
 serviceActionTypeSystemid
/ In de dropdown we zien COLLECT, LINEHAUL, ...
			if (getDataType().equals(DATA_TYPE_NUMBER)) {
				String myValue = getValueFromRequest(getFormFieldName());
/s
DropDownFieldTag(FieldTag).getValueFromRequest(String) line: 1206	
this	com.mpobjects.view.taglib.form.DropDownFieldTag  (id=27613)	
aName	"serviceActionTypeSystemid" (id=27754)	
		return getRequest().getParameter(aName);
/s
DropDownFieldTag(FieldTag).getRequest() line: 533	
/=
	public HttpServletRequest getRequest() {
		return getFieldOwner().getRequest();
/s
	protected FieldOwner getFieldOwner() {
this	com.mpobjects.view.taglib.form.DropDownFieldTag  (id=27613)	
		return getActiveValueObjectHolder().getFieldOwner();
/s
			return activeValueObjectHolder;
/t
/s
	public FieldOwner getFieldOwner() {
this	com.mpobjects.view.taglib.form.SetFormVOTag  (id=27995)	
/ Klopt	, in JSP	,
        	 <mpo:setFormVO valueObject="${formvo}">
/ dus de SetFormVOTag is de active value object holder	,

		return getForm();
/=
			return theFormTag;
/t
/s
FormTag.getRequest() line: 432	
this=com.mpobjects.view.taglib.form.FormTag@7ffe7dac
/s
		return theRequest;
/t
DropDownFieldTag(FieldTag).getValueFromRequest(String) line: 1206	
		return getRequest().getParameter(aName);
/d  getRequest()
/s
RequestAdaptor.getParameter(String) line: 320	
		if (theRequestCocoon != null) {
			myObject = theRequestCocoon.getParameter(aName);
/ We slaan over	,
/t
DropDownFieldTag.fetchData() line: 184	
				String myValue = getValueFromRequest(getFormFieldName());
/d
myValue	"26681851" (id=28098)	
				VOReflectionInvoker.setNumericValue(getActiveValueObject(), getName(), new BigDecimal(myValue));

/t
SatSaveAction(BoundSaveAction).getFetchedData() line: 129	
				for (DataFetchable myDataFetchable : myFetchFields) {
						myDataFetchable.fetchData();
/ volgende	,

ServiceActionTemplateId

myDataFetchable	com.mpobjects.view.taglib.form.DropDownFieldTag  (id=28134)	
planningMode

myDataFetchable	com.mpobjects.view.taglib.form.DropDownFieldTag  (id=28152)	
 executionMode

myDataFetchable	com.mpobjects.view.taglib.form.BooleanFieldTag  (id=28154)	
 offlinePlanningMode

myDataFetchable	com.mpobjects.view.taglib.form.TextFieldTag  (id=28173)	
 replanCriteria
/s
TextFieldTag(FieldTag).fetchData() line: 379	
 			VOReflectionInvoker.setValue(getActiveValueObject(), getName(), getValueFromRequest(getFormFieldName()));
/ sets 'm gewoon in de sat	, die uit het request komt	, 

myDataFetchable	com.mpobjects.view.taglib.form.TextFieldTag  (id=28215)	
 serviceOrderReplanCriteria

myDataFetchable	com.mpobjects.view.taglib.form.TextFieldTag  (id=21219)	
consolidationCriteria

myDataFetchable	com.mpobjects.view.taglib.form.NumberFieldTag  (id=21221)	
 consolidationWindowHrs

myDataFetchable	com.mpobjects.view.taglib.form.NumberFieldTag  (id=21458)	
avgLeadtimeHrs

myDataFetchable	com.mpobjects.view.taglib.form.FieldTag  (id=21462)	
 reference1
 reference2
 reference3
 reference4
 reference5

myDataFetchable	com.mpobjects.view.taglib.form.TextFieldTag  (id=21476)	
remarks

myDataFetchable	com.mpobjects.view.taglib.form.TextFieldTag  (id=21494)	
 handlingInstructions

myField	com.mpobjects.view.taglib.form.BooleanFieldTag  (id=21510)	
 optimizationPossibleFlag

myDataFetchable	com.mpobjects.view.taglib.form.DropDownFieldTag  (id=21513)	
 copyScheduleMode

myDataFetchable	com.mpobjects.view.taglib.form.DropDownFieldTag  (id=21517)	
 containerMode

myDataFetchable	com.mpobjects.view.taglib.form.DropDownFieldTag  (id=21519)	
 consolidationSearchMode

myDataFetchable	com.mpobjects.view.taglib.form.ListFieldTag  (id=21539)	
 consolidationHoldStatus

myDataFetchable	com.mpobjects.view.taglib.form.DropDownFieldTag  (id=21717)	
copyLocationFrom

myDataFetchable	com.mpobjects.view.taglib.form.ListFieldTag  (id=21720)	
 fromParty

myDataFetchable	com.mpobjects.view.taglib.form.FieldTag  (id=21722)	
 fromName

...
myDataFetchable	com.mpobjects.view.taglib.form.FieldTag  (id=21765)	
toName
...

/ Intermezzo

/ save de sat	,
/ we zien in devtools bij sat_save	,

Form Data

continuationId:1448363295639
flowDefinition:reload
redirectTo:../core/back?levelOffset=-1
doRedirect:false
base_sessionLevelOffset:0
base_windowToOpenUrl:
base_windowToOpenHeight:
base_windowToOpenWidth:
base_windowToOpenTitle:
base_windowToOpenScrollbar:
systemId:
organization:PNL-CARGO
serviceActionTypeSystemid:26681851
ServiceActionTemplateId:SAT_COLLECT
planningMode:CONSOLIDATE
executionMode:MANUAL
replanCriteria-display:
replanCriteria:
serviceOrderReplanCriteria-display:
serviceOrderReplanCriteria:
consolidationCriteria-display:cf:equa...
consolidationCriteria:cf:equalsIgnoreCase(serviceAction.fromPartyVO.address,serviceOrder.fromPartyVO.address) && cf:equalsIgnoreCase(serviceAction.fromPartyVO.address2,serviceOrder.fromPartyVO.address2) && cf:equalsIgnoreCase(serviceAction.fromPartyVO.city,serviceOrder.fromPartyVO.city) && cf:equalsIgnoreCase(serviceAction.fromPartyVO.postalCode,serviceOrder.fromPartyVO.postalCode) &&  cf:isSameDay(serviceAction.shipmentOrderVO.dateSetVO.requestedStartAfter,serviceOrder.dateSetVO.plannedStartAfter)
consolidationWindowHrs:336
avgLeadtimeHrs:0
reference1:
reference2:
reference3:
reference4:
reference5:
remarks-display:
remarks:
handlingInstructions-display:
handlingInstructions:
copyScheduleMode:NONE
containerMode:OFF
consolidationSearchMode:BACKWARD
consolidationHoldStatus:
copyLocationFrom:PTG:FROM
fromParty:
fromName:
fromName2:
fromAddress:
fromAddress2:
fromCity:
fromPostalCode:
fromRegionState:
fromCountry:XX
fromPhoneNumber:
fromFaxNumber:
fromEmailAddress:
fromContactName:
toLocationCopyFlag:PTG:COLLECTIONDEPOT
toParty:
toName:
toName2:
toAddress:
toAddress2:
toCity:
toPostalCode:
toRegionState:
toCountry:XX
toPhoneNumber:
toFaxNumber:
toEmailAddress:
toContactName:
checkedEventTemplate_26681722:
checkedEventTemplate_26681726:
checkedEventTemplate_26681723:
checkedEventTemplate_26681720:26681720
checkedEventTemplate_26786459:
checkedEventTemplate_26828904:
checkedEventTemplate_26681725:
checkedEventTemplate_26858700:
checkedEventTemplate_26681721:
checkedEventTemplate_26824717:
checkedEventTemplate_26824720:
checkedEventTemplate_26824718:
checkedEventTemplate_26824719:
checkedserviceOrder_26682527:
checkedserviceOrder_26681862:
checkedserviceOrder_26681954:
checkedserviceOrder_26681942:
checkedserviceOrder_26681870:
checkedserviceOrder_26682265:
checkedserviceOrder_26681861:
checkedserviceOrder_26681868:
checkedserviceOrder_26681931:
checkedserviceOrder_26681871:
checkedserviceOrder_26681946:
checkedserviceOrder_26681869:
checkedserviceOrder_26681945:
checkedserviceOrder_26682842:
checkedserviceOrder_26682241:26682241
checkedserviceOrder_26681872:
checkedserviceOrder_26681947:
checkedserviceOrder_26682528:
checkedserviceOrder_26786457:
checkedserviceOrder_26764913:
checkedserviceOrder_26767136:
checkedserviceOrder_26787135:
checkedserviceOrder_26786441:
checkedserviceOrder_26786442:
checkedserviceOrder_26682242:
checkedserviceOrder_26814573:
checkedserviceOrder_26845568:
checkedserviceOrder_26848259:
checkedserviceOrder_26848260:
checkedserviceOrder_26848432:
checkedserviceOrder_26733939:
checkedserviceOrder_26850173:
checkedserviceOrder_26850660:
checkedserviceOrder_26850927:
checkedserviceOrder_26681941:
serverUnavailableMessage:Server busy, please wait
processingFormMessage:Form is being processed...
deleteMessage:Are you sure?

//////////////////////////////////////////////////////////////////////////
/ we zien dus de selected eventtemplate tussen alle andere staan	,


/ Einde Intermezzo


myDataFetchable	com.mpobjects.view.taglib.form.ManyToManyRelationTag  (id=21790)	
/s
ManyToManyRelationTag.fetchData() line: 152	
		String myNameEntity = getEntity();// StringUtils.firstCharToLower(VOReflectionInvoker.getEntityFromVO(getData().iterator().next()));
/s
ManyToManyRelationTag.getEntity() line: 188	
		return VOReflectionInvoker.getEntityFromVO(getData().iterator().next());
/s
/ getData()=theData=
this	com.mpobjects.view.taglib.form.ManyToManyRelationTag  (id=21790)	
	theData	java.util.ArrayList  (id=21858)	
		elementData	java.lang.Object[15]  (id=21860)	
			[0]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22049)	
			[1]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22050)	
			[2]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22051)	
			[3]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22052)	
			[4]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22053)	
			[5]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22183)	
			[6]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22184)	
			[7]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22185)	
			[8]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22186)	
			[9]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22187)	
			[10]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22189)	
			[11]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22191)	
			[12]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22192)	
		size	13	
	theMode	"edit" (id=21934)	
	theSelected	org.hibernate.collection.PersistentBag  (id=22553)	
/s
/ getData()=theData=
this	com.mpobjects.view.taglib.form.ManyToManyRelationTag  (id=21790)	
	class$javax$servlet$jsp$tagext$JspTag	null	
	jspBody	org.apache.jsp.oms.jsp.sat_005fedit_jsp$sat_005fedit_jspHelper  (id=21861)	
	jspContext	org.apache.jasper.runtime.PageContextImpl  (id=21862)	
	parentTag	com.mpobjects.view.taglib.tab.TabTag  (id=21867)	
	theData	java.util.ArrayList  (id=21858)	
		elementData	java.lang.Object[15]  (id=21860)	
			[0]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22049)	
			[1]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22050)	
			[2]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22051)	
			[3]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22052)	
systemId	26681720	
			[4]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22053)	
			[5]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22183)	
			[6]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22184)	
			[7]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22185)	
			[8]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22186)	
			[9]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22187)	
			[10]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22189)	
			[11]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22191)	
			[12]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22192)	
		modCount	13	
		size	13	

/ we zijn in	,
		return VOReflectionInvoker.getEntityFromVO(getData().iterator().next());
/ pakt de 1ste sat in de list	,
/s
VOReflectionInvoker.getEntityFromVO(EntityInterface) line: 188	
/=
	public static String getEntityFromVO(EntityInterface aVO) {
aVO	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22049)	
	closeAction	com.mpobjects.event.model.entity.eventaction.EventAction  (id=23444)	
	code	"ET_FLH" (id=24333)	
	containerActionTrigger	null	
	containerEvent	false	
	deleted	false	
	description	"" (id=23474)	
	eventType	com.mpobjects.event.model.entity.eventtype.EventType  (id=23475)	
J27
	hashCode	28299933	
	isNotClosedByLaterEvents	true	
	isPublic	java.lang.Boolean  (id=23514)	
	isRequired	java.lang.Boolean  (id=23514)	
	messages	org.hibernate.collection.PersistentSet  (id=24354)	
	organization	com.mpobjects.oms.model.entity.organization.Organization  (id=23518)	
	performanceMonitorService	null	
	reportingLevel	com.mpobjects.event.event.model.EventReportingLevel$1  (id=23552)	
	secondLevelItemBased	java.lang.Boolean  (id=23566)	
	shipmentItemActionTrigger	com.mpobjects.event.model.entity.eventtemplate.ActionTrigger  (id=23568)	
	shipmentItemEvent	true	
	systemId	26681722	
	theEmailAddress	null	
	theEndDepender	null	
	theEndQuantity	null	
	theEndTimeType	null	
	theEventTypeSystemid	java.lang.Integer  (id=24355)	
	theExpectedEndExpr	"plannedEnd+0M" (id=24356)	
	theExpectedStartExpr	null	
	theExpectedValue	null	
	theOrganizationSystemid	500	
	thePhoneNumber	null	
	theStartDepender	null	
	theStartQuantity	null	
	theStartTimeType	null	
	timeZoneOption	null	
/ 1ste in de list	,

		Class myClassName = HibernateUtil.unwrap(aVO);
myClassName	java.lang.Class (com.mpobjects.event.model.entity.eventtemplate.EventTemplate) (id=11856)	
		String myRet = myClassName.getSimpleName();
myRet	"EventTemplate" (id=24380)	
		if (myRet.endsWith("VO")) {
/ NEE
		return myRet;
/t
ManyToManyRelationTag.fetchData() line: 154	
		String myNameEntity = getEntity();// StringUtils.firstCharToLower(VOReflectionInvoker.getEntityFromVO(getData().iterator().next()));
/d
EventTemplate
		for (EntityInterface myVO : getData()) {
			String myName = "checked" + myNameEntity + "_" + myVO.getSystemId();
checkedEventTemplate_26681726
			if (StringUtils.isNotEmpty(getRequest().getParameter(myName))) {
/ NEE voor checkedEventTemplate_26681726
/ JA voor checkedEventTemplate_26681720
/ Klopt	, see formData in de request	hierboven	, 
...
checkedEventTemplate_26681723:
checkedEventTemplate_26681720:26681720
checkedEventTemplate_26786459:
...
				myList.add(myVO);
				getForm().addValueObject(myVO);
/s
FormTag.addValueObject(EntityInterface) line: 180	
/=
	public void addValueObject(EntityInterface aEntityInterface) {
aEntityInterface	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22052)	

		if (theValueObjects.size() == 0 && !modeUpdatedByTag) {
this	com.mpobjects.view.taglib.form.FormTag  (id=21874)	
	theValueObjects	java.util.ArrayList  (id=24740)	
		elementData	java.lang.Object[10]  (id=24742)	
			[0]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[1]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[2]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[3]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[4]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[5]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[6]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[7]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
		size	8	
/ 8 keer dezelfde	,
		theValueObjects.add(aVO);
this	com.mpobjects.view.taglib.form.FormTag  (id=21874)	
	theValueObjects	java.util.ArrayList  (id=24740)	
		elementData	java.lang.Object[10]  (id=24742)	
			[0]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[1]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[2]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[3]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[4]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[5]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[6]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[7]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[8]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22052)	
		size	9	

/t
ManyToManyRelationTag.fetchData() line: 169	
this	com.mpobjects.view.taglib.form.ManyToManyRelationTag  (id=21790)	
		for (EntityInterface myVO : getData()) {
			String myName = "checked" + myNameEntity + "_" + myVO.getSystemId();
			if (StringUtils.isNotEmpty(getRequest().getParameter(myName))) {
/ NEE
/ verder geen	,
		getSelected().clear();
		getSelected().addAll(myList);

/ Intermezzo

$ vi sat_edit.jsp

			                            	<mpo:setFormVO valueObject="${formvo}">
			                          			<mpo:dropDownField name="toLocationCopyFlag" languageKey="copyFrom" dataType="string">
    					                    		<mpo:dropDownOptionList fetchClass="com.mpobjects.oms.view.leggen.ServiceActionTemplatesView" 
													fetchMethod="getServiceActionTemplatePartySyncInfoList" labelField="description" valueField="code" />
												</mpo:dropDownField>
				                            </mpo:setFormVO>

				                            <mpo:setFormVO valueObject="${formvo}">
												<mpo:listField name="toParty" type="party" filter="DELIVERY" useEmptyLogic="false" populatePrefix="to" />
											</mpo:setFormVO>

											<mpo:setFormVO valueObject="${formvo}">
			                                	<mpo:field name="toName" />
			                                	<mpo:field name="toName2" overRideable="true" />
			                                	<mpo:field name="toAddress" />

			             <mpo:manyToManyRelation data="${eventTemplates}" selected="${eventTemplatesSelected}" >
				            
				            	<mpo:list name="eventTemplate">
				            		
				            		<mpo:field name="eventTypeCode"/>
				            		<mpo:booleanField name="required"/>
				            		<mpo:booleanField name="public"/>
				            		<mpo:field name="expectedValue"/>
				            		<mpo:field name="expectedStartExpr"/>
				            		<mpo:field name="expectedEndExpr"/>
				            		<mpo:field name="reportingLevel"/>
				            		<mpo:field name="eventAction"/>
				            		<mpo:booleanField name="shipmentItemEvent"/>
				            		<mpo:field name="organization.organizationId"/>
				            		
				            	</mpo:list>
			              </mpo:manyToManyRelation>

/ we zien 3 keer dezelfde value object, de sat	, maar blijkbaar geeft mpo:manyToManyRelation ook een value object	, een event tpl	, ze komen alle 4 in de FormTag.theValueObjects	, in het totaal 9 , 8 keer dezelfde sat	, en 1 keer de chosen event template	, 

/ Een values obj is waar de values (uit form ) in gaan, dus de sat en de event tpl	, 
/ Het mechaniek is in wicket PropertyModel, maar hier tijdens debug doorheen gelopen	, ListFielTag....	, TODO
/ TODO

/ Einde Intermezzo

/t
SatSaveAction(BoundSaveAction).getFetchedData() line: 136	
				for (DataFetchable myDataFetchable : myFetchFields) {
						myDataFetchable.fetchData();
/s
ManyToManyRelationTag.fetchData() line: 152	
		String myNameEntity = getEntity();
"serviceOrder"
/ want	,
/s
ManyToManyRelationTag.getEntity() line: 188	
		return VOReflectionInvoker.getEntityFromVO(getData().iterator().next());
/ Pak 1ste uit this.theData	, en bepaal class name	,

this	com.mpobjects.view.taglib.form.ManyToManyRelationTag  (id=27972)	
	theData	java.util.ArrayList  (id=27984)	
		elementData	java.lang.Object[49]  (id=27986)	
			[0]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=27987)	
			[1]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=27988)	
			[2]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=27989)	
			[3]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=27990)	
			[4]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=27991)	
			[5]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=27992)	
			[6]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28532)	
			[7]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28533)	
			[8]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28534)	
			[9]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28535)	
			[10]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28536)	
			[11]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28537)	
			[12]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28538)	
			[13]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28539)	
			[14]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28540)	
			[15]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28541)	
			[16]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28542)	
			[17]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28543)	
			[18]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28544)	
			[19]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28545)	
			[20]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28546)	
			[21]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28547)	
			[22]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28548)	
			[23]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28549)	
			[24]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28550)	
			[25]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28551)	
			[26]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28579)	
			[27]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28580)	
			[28]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28581)	
			[29]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28582)	
			[30]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28583)	
			[31]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28584)	
			[32]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28585)	
			[33]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28586)	
			[34]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28587)	
		size	35	

		for (EntityInterface myVO : getData()) {
			String myName = "checked" + myNameEntity + "_" + myVO.getSystemId();
			if (StringUtils.isNotEmpty(getRequest().getParameter(myName))) {
/ JA	, 
myName	"checkedserviceOrder_26682241" (id=29761)	
				myList.add(myVO);
				getForm().addValueObject(myVO);
		}
this	com.mpobjects.view.taglib.form.ManyToManyRelationTag  (id=27972)	
	theForm	com.mpobjects.view.taglib.form.FormTag  (id=21874)	
		theValueObjects	java.util.ArrayList  (id=24740)	
			elementData	java.lang.Object[10]  (id=24742)	
				[0]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
				[1]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
				[2]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
				[3]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
				[4]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
				[5]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
				[6]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
				[7]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
				[8]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22052)	
				[9]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28540)	
			size	10	

		getSelected().clear();
		getSelected().addAll(myList);
/t
SatSaveAction(BoundSaveAction).getFetchedData() line: 140	
this	com.mpobjects.oms.control.leggen.action.SatSaveAction  (id=20849)	

				for (DataFetchable myDataFetchable : myFetchFields) {
						myDataFetchable.fetchData();
/d
				theFetchedData = getForm().getValueObjects();
this	com.mpobjects.oms.control.leggen.action.SatSaveAction  (id=20849)	
	theFetchedData	java.util.ArrayList  (id=24740)	
		elementData	java.lang.Object[10]  (id=24742)	
			[0]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[1]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[2]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[3]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[4]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[5]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[6]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[7]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=24921)	
			[8]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=22052)	
			[9]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28540)	
		size	10	

			getRequest().setAttribute(TAGLIB_FETCHED_DATA, theFetchedData);
/ TAGLIB_FETCHED_DATA="taglibFetchedData"
			return theFetchedData;


/ Intermezzo

/ we zien dat de selected event tpl en seo tpl niet in de sat worden set	, zoals alle form data 	,  maar dat  
/ maar ze verschijnen als value object	,  en daar queries SCS ook op	,
		Collection<ServiceOrderVO> mySelectedServiceOrderTemplates = getFetchedData(ServiceOrderVO.class);
/ loopt theFetchedData door	, en zoekt naar inst in de list is ServiceOrderVO.class als class heeft	,

/ HIER HIER HIER correct comment

/ Einde Intermezzo

/t
SatSaveAction(AbstractSaveAction).act() line: 69	
		return getFetchedData().iterator().next();
/t
SatSaveAction.handleSave() line: 29	
		ServiceActionTemplate myVO = (ServiceActionTemplate) getValueObject();
/d
/ sat proxy	,

this	com.mpobjects.oms.control.leggen.action.SatSaveAction  (id=21474)	
	theFetchedData	java.util.ArrayList  (id=23663)	
		elementData	java.lang.Object[10]  (id=23827)	
			[0]	com.mpobjects.oms.model.serviceactiontemplate.ServiceActionTemplate_$$_javassist_14  (id=21647)	
			...
			[8]	com.mpobjects.event.model.entity.eventtemplate.EventTemplate  (id=23941)	
			[9]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=24032)	
		size	10	

/ Dus alle vo's uit de jsp (met alle fields er in) zitten in de SatSaveAction's getFetchedData()	,
/ de (proxy naar de ) sat is de 1ste vo	,

		Collection<ServiceOrderVO> mySelectedServiceOrderTemplates = getFetchedData(ServiceOrderVO.class);
/s
SatSaveAction(BoundSaveAction).getFetchedData(Class<T>) line: 154	
		Collection<EntityInterface> myFetchedData = getFetchedData();
/s
SatSaveAction(BoundSaveAction).getFetchedData() line: 142	
			if (theFetchedData == null) {
/ NEE
			if (theFetchedData == null) {
/ NEE
			getRequest().setAttribute(TAGLIB_FETCHED_DATA, theFetchedData);
			return theFetchedData;

/ dus is gewoon get	,
/t
SatSaveAction(BoundSaveAction).getFetchedData(Class<T>) line: 156	
aClass=class com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO

		Collection<EntityInterface> myFetchedData = getFetchedData();
/d
		for (EntityInterface myVO : myFetchedData) {
			if (aClass.isInstance(myVO)) {
				myRet.add(myVO);
		return myRet;
myRet	java.util.ArrayList  (id=30516)	
	elementData	java.lang.Object[10]  (id=30576)	
		[0]	com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO  (id=28540)	
/t
SatSaveAction.handleSave() line: 34	
		Collection<ServiceOrderVO> mySelectedServiceOrderTemplates = getFetchedData(ServiceOrderVO.class);
/d
		myVO.setServiceOrderTemplateList(mySelectedServiceOrderTemplates);
/ myVO=sat	,
		PathService myBAO = PathUtil.getPathService();
		myBAO.saveServiceActionTemplate(myVO);
/s
PathServiceImpl.saveServiceActionTemplate(ServiceActionTemplate) line: 199	
		ServiceActionTemplateDAO myDAO = MpoBeanFactory.getBean(ServiceActionTemplateDAO.class);
/s
ServiceActionTemplateDAOImpl(GenericHibernateDAO).save(Type) line: 501	
		if (anEntity.getSystemId() == 0) {
 /NEE
			getHibernateTemplate().persist(anEntity);
/ NIET
		} else {
			getHibernateTemplate().update(anEntity);

/c
/ Dit moeten we gaan vervangen	,
/s
SatSaveListener.postSubmit() line: 19	
		Collection<EventTemplate> mySelectedEventTemplates = getAction().getFetchedData(EventTemplate.class);
/ getAction()= theAction	com.mpobjects.oms.control.leggen.action.SatSaveAction  (id=20849)	
[com.mpobjects.event.model.entity.eventtemplate.EventTemplate@1d7462c9[ET_ASC,]]

		ServiceActionTemplate myServiceActionTemplateVO = (ServiceActionTemplate) getAction().getValueObject();
/=
			return getFetchedData().iterator().next();
/ de sat (die 8 keer voorkomt)	,

		MpoBeanFactory.getBean(EventSatDAO.class).storeEventTemplatesForSat(myServiceActionTemplateVO, mySelectedEventTemplates);
/s
EventSatDAOImpl.storeEventTemplatesForSat(ServiceActionTemplate, Collection<EventTemplate>) line: 64	
/=
	public void storeEventTemplatesForSat(ServiceActionTemplate aServiceActionTemplateVO, Collection<EventTemplate> aSelectedEventTemplates) {
		Collection<EventTemplate> myOldEventTemplates = new ArrayList<EventTemplate>();

		for (EventSatVO myEventSat : getBySatSystemid(aServiceActionTemplateVO.getSystemId())) {
/s
EventSatDAOImpl.storeEventTemplatesForSat(ServiceActionTemplate, Collection<EventTemplate>) line: 65	
		String myQuery = "Select {es.*} from event_sat es " + " where es.sat_systemid = :satSystemid ";
		Collection<QueryParameter> params = new ArrayList<QueryParameter>();
		params.add(new IntNamedQueryParameter("satSystemid", aSatSystemid));

		return executeSqlSelect(myQuery, "es", params);
/s
EventSatDAOImpl(BaseHibernateDAO).executeSqlSelect(String, String, Collection<QueryParameter>, int, int) line: 211	
			return getHibernateTemplate().executeFind(new HibernateCallback() {
				@Override
				public Object doInHibernate(Session aSession) throws HibernateException, SQLException {
					SQLQuery query = aSession.createSQLQuery(aSql);
	val$aSql	"Select {es.*} from event_sat es  where es.sat_systemid = :satSystemid " (id=22813)	

					for (QueryParameter parameter : aParameters) {
	val$aParameters	java.util.ArrayList  (id=22812)	
		elementData	java.lang.Object[10]  (id=22986)	
			[0]	com.mpobjects.util.dao.IntNamedQueryParameter  (id=22988)	
				theName	"satSystemid" (id=22999)	
				theValue	26681857	
		size	1	
						parameter.setValue(query);
					}
					query.addEntity(anAlias, type);
this	com.mpobjects.util.dao.BaseHibernateDAO$2  (id=22785)	
	this$0	com.mpobjects.event.eventsat.model.dao.EventSatDAOImpl  (id=21031)	
		type	java.lang.Class (com.mpobjects.event.eventsat.model.EventSatVO) (id=12241)	

					if (aMaxResult > 0) {
/ NEE
					if (aFirstResult > 0) {
/ NEE
					return query.list();
				}
/t
EventSatDAOImpl.storeEventTemplatesForSat(ServiceActionTemplate, Collection<EventTemplate>) line: 66	
		for (EventSatVO myEventSat : getBySatSystemid(aServiceActionTemplateVO.getSystemId())) {

			if (!aSelectedEventTemplates.contains(myEventSat.getEventTemplate())) {



			if (!aSelectedEventTemplates.contains(myEventSat.getEventTemplate())) {
				delete(myEventSat);
			}
			myOldEventTemplates.add(myEventSat.getEventTemplate());
		}

		for (EventTemplate myEventTemplate : aSelectedEventTemplates) {

			if (!myOldEventTemplates.contains(myEventTemplate)) {
				EventSatVO myEventSat = new EventSatVO();
				myEventSat.setEventTemplate(myEventTemplate);
				myEventSat.setSatSystemid(aServiceActionTemplateVO.getSystemId());
				save(myEventSat);
			}

////////////////////////////////////
/ Dit is de 1ste method waar EventSatVO in voorkomt	,

/ NOTES

/ 7	. 

$ vi PartyListPage.java

/ In create button, en in de edit buttons op de rows	,

				getRequestCycle().setRequestTarget(
						new RedirectRequestTarget("../oms/party_create?" + "base_sessionLevelOffset=1" + "&returnUrl=" + returnUrl));

				getRequestCycle().setRequestTarget(
						new RedirectRequestTarget("../oms/party_edit?" + "base_sessionLevelOffset=1" + "&systemid=" + aObject + "&systemId=" + aObject + "&returnUrl=" + returnUrl));

/ als we click	, zien we dus de url	,
http://localhost:8080/tms/oms/party_create?base_sessionLevelOffset=1&returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:26::::

/ 7	. 

$ vi PartyFormAction.java
	public Map act() throws java.lang.Exception {
		String returnUrl = getRequestParameter("returnUrl");
		getRequest().setAttribute("returnUrl", returnUrl);

$ vi ButtonTag.java
		String returnUrl = (String) getRequest().getAttribute("returnUrl");
http://localhost:8080/tms/wicket/?wicket:interface=:26::::

/ we zijn nog in dezelfde request	,

		if (org.apache.commons.lang.StringUtils.isBlank(returnUrl)) {
/ NEE
			returnUrl = getRequest().getParameter("returnUrl");
/ NIET 
/ TODO (Wanneer komt dit in actie?)






/ Einde NOTES
















































/ Einde DEBUG SCS-4423


/ DEPLOY PNLLOGISTICS

/ 7	. 

[jboss@pnl-app-t pnllogistics]$ tr  a A <(echo "ab")
tr: extra operand `/dev/fd/63'
Try `tr --help' for more information.

/ dus <(...) is een file arg	, geen stdin	,
/ TODO

[eric@localhost lib]$ ssh vanderveldene@pnl-app-t.intermax.mp-objects.com "mkdir -p Downloads/pnllogistics"
[eric@localhost lib]$ scp  bcprov-jdk15on-1.53.jar opensaml-2.6.4.jar openws-1.5.4.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar vanderveldene@pnl-app-t.intermax.mp-objects.com:Downloads/pnllogistics

[jboss@pnl-app-a ~]$ cp -a ~vanderveldene/Downloads/pnllogistics/* /local/apps/jboss-4.0.5.GA/server/pnllogistics/lib



/ Einde DEPLOY PNLLOGISTICS

/ DEPLOY GEOSCO 

jboss@geosco-app-a geosco]$ echo $(awk '/MUST_BE_REMOVED/&&/.jar/{print $8}' log/server.log)bcprov-jdk15on-1.52.jar opensaml-2.6.1.jar openws-1.5.1.jar xmlsec-1.5.6.jar xmltooling-1.4.1.jar
[jboss@geosco-app-a geosco]$ (cd lib/;rm -f bcprov-jdk15on-1.52.jar opensaml-2.6.1.jar openws-1.5.1.jar xmlsec-1.5.6.jar xmltooling-1.4.1.jar)
[jboss@geosco-app-a geosco]$ (cd lib/;ls bcprov-jdk15on-1.52.jar opensaml-2.6.1.jar openws-1.5.1.jar xmlsec-1.5.6.jar xmltooling-1.4.1.jar)
/ check

[jboss@geosco-app-a geosco]$ echo $(awk '/MISSING/&&/.jar/{print $8}' log/server.log)bcprov-jdk15on-1.53.jar opensaml-2.6.4.jar openws-1.5.4.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar

[eric@localhost lib]$ ssh vanderveldene@geosco-app-a.intermax.mp-objects.com "mkdir -p Downloads/geosco"
[eric@localhost lib]$ scp  bcprov-jdk15on-1.53.jar opensaml-2.6.4.jar openws-1.5.4.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar vanderveldene@geosco-app-a.intermax.mp-objects.com:Downloads/geosco

[vanderveldene@geosco-app-a ~]$ chmod a+rx /home/vanderveldene/
[vanderveldene@geosco-app-a ~]$ sudo su - jboss
[jboss@geosco-app-a ~]$ cp -a ~vanderveldene/Downloads/geosco/* /local/apps/jboss-4.0.5.GA/server/geosco/lib



/ Einde DEPLOY GEOSCO 

/ SSH PASSWORDLESS LOGIN

/ Lees	,
http://www.linuxproblem.org/art_9.html

[eric@localhost lib]$ ssh-keygen -t rsa
Generating public/private rsa key pair.
Enter file in which to save the key (/home/eric/.ssh/id_rsa): 
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /home/eric/.ssh/id_rsa.
Your public key has been saved in /home/eric/.ssh/id_rsa.pub.
The key fingerprint is:
63:81:24:04:e9:0b:f8:15:89:9f:e2:2e:c8:d5:c6:cb eric@localhost.localdomain
The key's randomart image is:
+--[ RSA 2048]----+
|  .=o..          |
|  o oo .         |
|.. . o. .        |
|o o +    .       |
| + +o   S        |
|  +. + . .       |
|o.. o .          |
|o..  E           |
| .               |
+-----------------+

h^Zgcyr&Q

[eric@localhost lib]$ ssh vanderveldene@pnl-app-t.intermax.mp-objects.com "mkdir .ssh;chmod 700 .ssh" 
/ login met password,	 
[eric@localhost lib]$ cat ~/.ssh/id_rsa.pub  | ssh vanderveldene@pnl-app-t.intermax.mp-objects.com "cat >> .ssh/authorized_keys" 
/ login met password,	 
[eric@localhost lib]$ ssh vanderveldene@pnl-app-t.intermax.mp-objects.com "chmod 640 .ssh/authorized_keys" 
/ login met password,	 


/ we hebben een script create	, 
[eric@localhost bin]$ cat mk_ssh_passwordless.sh 
#!/usr/bin/bash
echo "h^Zgcyr&Q"

if [ "$#" -ne 1 ]
then
	echo "Give server name"
	exit 7
fi

ssh vanderveldene@"$@".intermax.mp-objects.com "mkdir .ssh;chmod 700 .ssh"
cat ~/.ssh/id_rsa.pub  | ssh vanderveldene@"$@".intermax.mp-objects.com "cat >> .ssh/authorized_keys"
ssh vanderveldene@"$@".intermax.mp-objects.com "chmod 640 .ssh/authorized_keys"
ssh vanderveldene@"$@".intermax.mp-objects.com "chmod go+rx ~"


[eric@localhost bin]$ ssh vanderveldene@pnl-app-t.intermax.mp-objects.com
/ OK
[vanderveldene@pnl-app-t ~]$ ls -al
drwx------   2 vanderveldene vanderveldene    4096 Nov 20 13:05 .ssh
/ WAS: drwxrwxr-x
[vanderveldene@pnl-app-t ~l$ ls -l .ssh
-rw-r----- 1 vanderveldene vanderveldene 408 Nov 20 13:01 authorized_keys
/ WAS -rw-rw-r-- 

/ OOK	,
[vanderveldene@pnl-app-t ~]$ ls -l /home
drwxr-xr-x  4 vanderveldene   vanderveldene   4096 Nov 19 14:27 vanderveldene

/ Als 	, dan GEEN passwordless login	,
drwxrwxr-x  4 vanderveldene   vanderveldene   4096 Nov 19 14:27 vanderveldene

/ Deze (oorspronkelijk) is ook OK	, maar willen we niet	,
drwx------  4 vanderveldene   vanderveldene   4096 Nov 19 14:27 vanderveldene


h^Zgcyr&Q
Eric789@MPO

/ we hebben gedaan	, 
pnl-app-t
pnl-app-a
geolog-app-t
geosco-app-t
geosco-app-a
bard-app-t	
bard-app-a
application-a
mposerv11
database-a


/ 	7 	.

$ vi geosco-ssh-a.sh
#!/bin/bash
ssh vanderveldene@geosco-app-a.intermax.mp-objects.com "sudo su - jboss"

/ de login fails 	, we komen terug op laptop	,

sudo: sorry, you must have a tty to run sudo
[eric@localhost bin]$ 

/ 7	. 

/ we willen inlog op geosco-app-a	, en meteen sudo su - jboss	,

/ Lees	,
http://unix.stackexchange.com/questions/122616/why-do-i-need-a-tty-to-run-sudo-if-i-can-sudo-without-a-password
/ en	,
http://www.cyberciti.biz/faq/linux-unix-bsd-sudo-sorry-you-must-haveattytorun/

[eric@localhost bin]$ sudo visudo
#
# Disable "ssh hostname sudo <cmd>", because it will show the password in clear.
#         You have to run "ssh -t hostname sudo <cmd>".
#
Defaults    requiretty

/ 13	. 

/ Dit willen we oef	,

[eric@localhost bin]$ cat >>~/.ssh/authorized_keys < <(cat ~/.ssh/id_rsa.pub )
/ of	,
[eric@localhost bin]$ cat >>~/.ssh/authorized_keys <(cat ~/.ssh/id_rsa.pub )

/ check	,
[eric@localhost bin]$ cat ~/.ssh/authorized_keys 
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDH6jxopt6uKOLNiDLe/+slHyu5lkldMzzR3tgFiyjXnN2yWw+RMyCgYyZUCoBWwt4kzwJmNDuTKhnOFLolRJF8ihG796s8xzufOtvyAoilQ5NP5gjhGYMgUcxWbYekrIAwY5Oe2+b8r91WPjh/DmO2YtSktEeV8SoGgRO7pSMP/fz2FBeOjK8OmV1VAog2Xg3zX23EU55SURAiN0/buvuRvfYSEuNkQqKbrDVUOC1IrEiEj+ylSk7kBXaVuzNyVEYkm/vBlF5ZXs97l3cv9twSTzrxYOh3QaLYPpUZbHrc4TbCiGepE36KyJdg4P7vBijo0+Ctlvn9zdfr01j/gxxt eric@localhost.localdomain

[eric@localhost bin]$ chmod 640 ~/.ssh/authorized_keys 

[eric@localhost bin]$ ssh localhost w
/ OK
[eric@localhost bin]$ ssh localhost sudo w
sudo: sorry, you must have a tty to run sudo
/ INDERDAAD	,

/ we doen	,
[eric@localhost bin]$ sudo visudo
#
# Disable "ssh hostname sudo <cmd>", because it will show the password in clear.
#         You have to run "ssh -t hostname sudo <cmd>".
#
Defaults    requiretty

[eric@localhost bin]$ ssh localhost sudo w 
/ OK
/ Wat bedoelen ze met het password in the clear?
/ TODO

/ we set weer
#Defaults    requiretty
[eric@localhost bin]$ ssh -t localhost sudo w 
...
eric     pts/27    10:05    0.00s  0.03s  0.07s sshd: eric [priv]   
Connection to localhost closed.

/ probeer ook	,
ssh -tt vanderveldene@geosco-app-a.intermax.mp-objects.com "stty raw -echo;sudo w" < <(cat)


/ 13	. 

[eric@localhost bin]$ cat geosco-ssh-a.sh 
#!/bin/bash
ssh -t vanderveldene@geosco-app-a.intermax.mp-objects.com "sudo su - jboss"
/ OK

/ 7	. 

/ we willen snappen	,

[eric@localhost lib]$ cat ~/.ssh/id_rsa.pub  | ssh vanderveldene@pnl-app-t.intermax.mp-objects.com "cat >> .ssh/authorized_keys" 

/ 13	. 

/ op onze laptop	,
/ we maken	,
[eric@localhost tmp]$ cat orig/my.txt 
foo
bar
[eric@localhost tmp]$ cat tgt/my.txt 
gee
hee

/ 13	. 

/ eerst alles op onze laptop	,

/ we doen	,
[eric@localhost tmp]$ cat orig/my.txt | cat >>tgt/my.txt 
[eric@localhost tmp]$ cat tgt/my.txt 
gee
hee
foo
bar

[eric@localhost tmp]$ cat orig/my.txt >>tgt/my.txt 
[eric@localhost tmp]$ cat tgt/my.txt 
gee
hee
foo
bar
foo
bar

[eric@localhost tmp]$ cat <(cat orig/my.txt) >>tgt/my.txt 
[eric@localhost tmp]$ cat tgt/my.txt 
gee
hee
foo
bar
foo
bar
foo
bar

[eric@localhost tmp]$ cat < <(cat orig/my.txt) >>tgt/my.txt 
[eric@localhost tmp]$ cat tgt/my.txt 
gee
hee
foo
bar
foo
bar
foo
bar
foo
bar

/ 13	. 

/ nu van laptop naar pnl-app-t	,

/ we maken op laptop	,

[vanderveldene@pnl-app-t ~]$ cat >> tmp/orig/my.txt
FOO
BAR

/ 13	. 

/ op latop	,
[eric@localhost tmp]$ cat ~/tmp/orig/my.txt | ssh vanderveldene@pnl-app-t.intermax.mp-objects.com "cat >>tgt/my.txt"

/ op pnl-app-t	,
[vanderveldene@pnl-app-t ~]$ cat tgt/my.txt 
foo
bar

/ op laptop	,
[eric@localhost tmp]$ ssh vanderveldene@pnl-app-t.intermax.mp-objects.com "cat < <(cat ~/tmp/orig/my.txt) >>tgt/my.txt"

/ op pnl-ssh-t	,
[vanderveldene@pnl-app-t ~]$ cat tgt/my.txt 
foo
bar
FOO
BAR

/ we kunnen ook	,
[eric@localhost tmp]$ ssh vanderveldene@pnl-app-t.intermax.mp-objects.com "cat >>tgt/my.txt"
/ Hij wacht op ^d	, we moeten stdin geven	,

/ Deze is nu dus anders	, op laptop	,
[eric@localhost tmp]$ cat ~/tmp/orig/my.txt | ssh vanderveldene@pnl-app-t.intermax.mp-objects.com "cat >>tgt/my.txt"
[eric@localhost tmp]$ ssh vanderveldene@pnl-app-t.intermax.mp-objects.com "cat < <(cat ~/tmp/orig/my.txt) >>tgt/my.txt"

/ Einde SSH PASSWORDLESS LOGIN

/ AWK

/ 7	 

/ print alle lines	,

/ OK, 
[eric@localhost bin]$ awk '/geosco/{print $9}' <(ls -ltr /home/eric/DB_TAP/Postgres/Backup/)
geosco-t-2015-09-28.dump
geosco-a-2015-11-23.dump

/ Hoe print last line	?

[eric@localhost bin]$ awk '/geosco/END{print}' <(ls -ltr /home/eric/DB_TAP/Postgres/Backup/)
awk: cmd. line:1: /geosco/END{print}
awk: cmd. line:1:         ^ syntax error
/ Zet daarom {} ertussen	, blijkbaar moet na /.../ een stmt komen	, 

[eric@localhost bin]$ awk '/geosco/{}END{print}' <(ls -ltr /home/eric/DB_TAP/Postgres/Backup/)
geosco-a-2015-11-23.dump

[eric@localhost bin]$ awk '/geosco/{}END{print}' <(ls -ldtr /home/eric/DB_TAP/Postgres/Backup/*)
/ geeft hele path
/home/eric/DB_TAP/Postgres/Backup/geosco-a-2015-11-23.dump






/ Einde AWK

/ DSVSOL-2770

[eric@localhost bin]$ dsvfms-ssh-p.sh 
h^Zgcyr&Q
[vanderveldene@scs-application-p ~]$ cat /local/apps/jboss-4.0.5.GA/server/dsvfms/deploy/firebird-ds.xml 
 <datasources>
     <connection-url>jdbc:firebirdsql://localhost//local/apps/firebird/dsvfms.fdb?defaultResultSetHoldable=true&amp;columnLabelForName=true</connection-url>
     <driver-class>org.firebirdsql.jdbc.FBDriver</driver-class>
     <user-name>SYSDBA</user-name>
     <password>masterkey</password>

[eric@localhost bin]$ dsvfms-db-p.sh 
Database:  scs-application-p.intermax.mp-objects.com:/local/apps/firebird/dsvfms.fdb, User: sysdba

SQL> select system_id from service_order where service_order_id='N2919874';

   SYSTEM_ID 
============ 
   120393135 

SQL> select system_id from service_order where service_order_id='N2920712';

   SYSTEM_ID 
============ 
   120495970 

SQL>   select soc.* from service_order_cost soc join service_order so on soc.SERVICE_ORDER_SYSTEMID =so.system_id where so.service_order_id='N2919874' and status='ACTUAL';

   SYSTEM_ID SERVICE_ORDER_SYSTEMID CORRECTION_TYPE COST_TYPE_SYSTEMID REASON                                                                                                                        CORRECTION_TYPE_SYSTEMID ENTRY_TYPE COST_COMPONENT_SYSTEMID  SEQUENCE_NR                AMOUNT STATUS               COST_DESCRIMINATOR   CURRENCY_SYSTEMID INVOICE_DETAIL_SYSTEMID RATE_AGREEMENT_SYSTEMID 
============ ====================== =============== ================== =============================================================================== ======================== ========== ======================= ============ ===================== ==================== ==================== ================= ======================= ======================= 
   120974661              120393135 POSITIVE                   4125779 Invoice:8865708                                                                                                                               38500001 AUTOMATIC                   <null>            0              17.51000 ACTUAL               RCA                               7001               120973782                  <null> 
   120974662              120393135 POSITIVE                         2 Invoice:8865708                                                                                                                               38500001 AUTOMATIC                   <null>            0               1.16000 ACTUAL               RCA                               7001               120973783                  <null> 
   120979220              120393135 POSITIVE                   4125779 Invoice:8865402                                                                                                                               38500001 AUTOMATIC                   <null>            0             133.60000 ACTUAL               RCA                               7001               120973821                  <null> 
   120979221              120393135 POSITIVE                         2 Invoice:8865402                                                                                                                               38500001 AUTOMATIC                   <null>            0               8.86000 ACTUAL               RCA                               7001               120973822                  <null> 

/ De onderste 2 moeten naar seo 120495970	,  ipv	120393135 

/ Einde DSVSOL-2770


/ ISSUE

/ config, master data , countries
/ config, master data ,  airports
/ click op beide op create	,
/ we zien bij countries een popup	, niet OK bij afspelen selenium	,

/ Einde ISSUE

/ DEPLOY PNLTMS

/ op pnl-app-t	,

[jboss@pnl-app-t pnltms]$ echo $(awk '/MUST_BE_REMOVED/ && /.jar/{print $8 }' log/server.log)
bcprov-jdk15on-1.52.jar opensaml-2.6.1.jar openws-1.5.1.jar xmlsec-1.5.6.jar xmltooling-1.4.1.jar
[jboss@pnl-app-t pnltms]$ (cd lib;rm -f bcprov-jdk15on-1.52.jar opensaml-2.6.1.jar openws-1.5.1.jar xmlsec-1.5.6.jar xmltooling-1.4.1.jar)
[jboss@pnl-app-t pnltms]$ (cd lib;ls  bcprov-jdk15on-1.52.jar opensaml-2.6.1.jar openws-1.5.1.jar xmlsec-1.5.6.jar xmltooling-1.4.1.jar)
ls: cannot access bcprov-jdk15on-1.52.jar: No such file or directory
ls: cannot access opensaml-2.6.1.jar: No such file or directory
ls: cannot access openws-1.5.1.jar: No such file or directory
ls: cannot access xmlsec-1.5.6.jar: No such file or directory
ls: cannot access xmltooling-1.4.1.jar: No such file or directory

[jboss@pnl-app-t pnltms]$ echo $(awk '/MISSING/ && /.jar/{print $8 }' log/server.log)
bcprov-jdk15on-1.53.jar opensaml-2.6.4.jar openws-1.5.4.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar

[vanderveldene@pnl-app-t ~]$ chmod a+rx /home/vanderveldene/

/ op laptop	,

[eric@localhost lib]$ ssh vanderveldene@pnl-app-t.intermax.mp-objects.com "mkdir -p Downloads/pnltms"
[eric@localhost lib]$ scp bcprov-jdk15on-1.53.jar opensaml-2.6.4.jar openws-1.5.4.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar vanderveldene@pnl-app-t.intermax.mp-objects.com:Downloads/pnltms

/ op pnl-app-t

[jboss@pnl-app-t ~]$ cp -a ~vanderveldene/Downloads/pnltms/* /local/apps/jboss-4.0.5.GA/server/pnltms/lib/




/ Einde DEPLOY PNLTMS

/ PSA-267

/ 7	. 

/ Zoek in eclipse naar trigger in *menu*xml

$ vi oms-menu.xml

	<m:add path="configuration.execution.triggers.actions" privilege="trigger.list" actionUrl="wicket?module=oms&amp;wicketpage=triggeraction.TriggerActionListPage" index="1200" />
	<m:add path="configuration.execution.triggers.serviceOrderTypeTrigger" privilege="serviceordertypetrigger.list" actionUrl="wicket?module=oms&amp;wicketpage=serviceordertypetrigger.SotTriggerListPage" index="1210" />
	<m:add path="configuration.execution.triggers.shipmentOrderTrigger" privilege="shipmentordertrigger.list" actionUrl="wicket?module=oms&amp;wicketpage=shipmentordertrigger.ShipmentOrderTriggerListPage" index="1220" />
	<m:add path="configuration.execution.triggers.eventTrigger" privilege="eventtrigger.list" actionUrl="wicket?module=oms&amp;wicketpage=eventtrigger.EventTriggerListPage" index="1230" />
	<m:add path="configuration.execution.triggers.interfaceMessageTrigger" privilege="interface-message-trigger.list" actionUrl="wicket?module=oms&amp;wicketpage=interfacemessagetrigger.InterfaceMessageTriggerListPage" index="1240" />

	<m:add path="configuration.execution.triggers.customerOrderTrigger" privilege="customerordertrigger.list" actionUrl="wicket?module=oms&amp;wicketpage=customerordertrigger.CustomerOrderTriggerListPage" index="1240" />

13	. 

/ configuration, execution	, triggers, actions
/ we komen op 'Trigger Actions'

code='TEST_CONF'
Exection Order: 1 / TODO
Trigger task: SEND_MESSAGE

code='SO_CARRIER_IFCSUM'
description: Sent the IFCSUM to the carriers via EDI
execution order: 1 / TODO
trigger task: EXPORT_SERVICE_ORDER
purpose code: 05-IFCSUM
export once for SO: check

code='EDI_SHP_CARRIER'
description: Sent the IFCSUM to the carriers via EDI
execution order: 1 / TODO
trigger task: EXPORT_SERVICE_ORDER
peer type: TRANSPORT
export once on end: check

/ HIER HIER HIER



/ 13	. 

/ configuration, execution	, triggers, service order type trigger
/ 'Edit Service Order Type Trigger'	,

/ bijv	,
name: ORDER_CARRIER
seo type: DELIVERY
On release: checked	,					/ verzonden naar de carrier	, 
actions: code: SO_CARRIER_IFCSUM

/ 13	.

/ configuration, execution	, triggers, shipment order type trigger
'Edit Shipment Order Trigger'
name; PSA_EDI_TEST
On create: checked
actions: code=EDI_SHP_CARRIER	

/ 13	. 

/ configuration, execution	, triggers, event trigger
'Event Trigger'
...

/ 7	. 

[eric@localhost bin]$ geosco-pg_dump-a.sh 
pnllogistics4t=# create database geosco_a;
CREATE DATABASE

[eric@localhost bin]$ local-pg_restore.sh geosco_a "$(awk '/geosco/{}END{print $9}' <(ls -dtr /home/eric/DB_TAP/Postgres/Backup/*))"

/ 7	. 

[eric@localhost bin]$ pnl-db-dump-a.sh pnllogistics

pnllogistics3=# create database pnllogistics4a2;
CREATE DATABASE

[eric@localhost bin]$ local-pg_restore.sh pnllogistics4a2 /home/eric/DB_TAP/Postgres/Backup/pnllogistics-a-2015-11-26.dump



/ 7	. 

/ planning, inventory, visibility by sku
/ zoek op mpo
/ we zien 2 product	, check MPO_Prod1	, click Show	,
/ we zien links	,
MPO test product 1(GOOD)-
GEODIS_WHS_FR_SOCHAUX
1000/2000/5000/2d/100
/ het min is 1000	,
/ we zien de linker colom 970	, dus had er een email uitgezonden moeten zijn	, 

/ we gaan de stock met de hand tellen	, 
/ planning, inventory, stock count	,
/ zoek op soch	, we zien GEODIS_WHS_FR_SOCHAUX	, open	,
/ zoek row MPO test product 1  , 	set in laatste column 1100 als stock count	, 
/ click Save and close	, 

/ keer terug naar 
/ planning, inventory, visibility by sku
/ zoek op mpo
/ we zien 2 product	, check MPO_Prod1	, click Show	,
/ we zien de linker colom 1100 ,

/ we gaan de stock met de hand tellen	, 
/ planning, inventory, stock count	,
/ zoek op soch	, we zien GEODIS_WHS_FR_SOCHAUX	, open	,
/ zoek row MPO test product 1  , 	set in laatste column 950 als stock count	, 
/ click Save and close	, 

/ keer terug naar 
/ planning, inventory, visibility by sku
/ zoek op mpo
/ we zien 2 product	, check MPO_Prod1	, click Show	,
/ we zien de linker colom 950 , onder het minimum dus	, 
report events	, shipment order events
/ check: Mail this report
/ click : Generate report
/ Nu zou ik een email gehad moeten hebben 	,

/ 7. 	

/ op acc	, 
$ vi local_application.properties

#module.interfacing.jms.server.url=tcp\://geosco-int-a\:61616

module.core.emailservice.server.host=localhost
module.core.emailservice.server.port=-1
module.core.emailservice.server.protocol=smtp
module.core.emailservice.server.user=
module.core.emailservice.server.pass=
module.core.emailservice.default.from=no-reply@geodis.com
module.core.emailservice.destination.override.acceptance=paul.vandongen@mp-objects.com,christophe.vignon@geodis.com,khadija.aghri.ext@geodis.com,jean-christophe.millard@geodis.com,mposcs@mp-objects.com,sander.vervoordeldonk@mp-objects.com
module.core.emailservice.destination.override.test=paul.vandongen@mp-objects.com
module.core.emailservice.destination.override.development=paul.vandongen@mp-objects.com
module.core.emailservice.subject.prefix.acceptance=[${base.product}] [ACCEPTANCE] 
module.core.emailservice.subject.prefix.test=[${base.product}] [TEST]
module.core.emailservice.subject.prefix.development=[${base.product}] [DEVELOPMENT]
module.core.emailservice.enabled=true
module.core.emailservice.smtp.auth= false
module.core.emailservice.smtp.starttls.enable= false

/ local	, 
$ vi local_application.properties

module.omscarcon.carconfetcher.delay=999999999999
module.interfacing.jms.listener.autostartup=false
user.event.alert=off

/ TODO

/ we maken	,
$ vi local_application.properties

#module.interfacing.jms.server.url=tcp\://geosco-int-a\:61616
# So we use the default
# TODO

module.core.emailservice.server.protocol=smtp
module.core.emailservice.server.port=-1
module.core.emailservice.server.user=
module.core.emailservice.server.pass=
module.core.emailservice.default.from=no-reply@geodis.com
module.core.emailservice.destination.override.acceptance=eric.vandervelden@mp-objects.com
module.core.emailservice.destination.override.test=eric.vandervelden@mp-objects.com
module.core.emailservice.destination.override.development=eric.vandervelden@mp-objects.com
module.core.emailservice.subject.prefix.acceptance=[${base.product}] [ACCEPTANCE] 
module.core.emailservice.subject.prefix.test=[${base.product}] [TEST]
module.core.emailservice.subject.prefix.development=[${base.product}] [DEVELOPMENT]
module.core.emailservice.enabled=true
module.core.emailservice.smtp.auth= false
module.core.emailservice.smtp.starttls.enable= false

[eric@localhost Selenium]$ cat /etc/resolv.conf 
# Generated by NetworkManager
domain internal.mp-objects.com
search internal.mp-objects.com
nameserver 192.168.1.5
nameserver 192.168.1.3

/ Dus omdat we smtp geven	, set hij vanzelf internal.mp-objects.com erachter	,
[eric@localhost Selenium]$ host smtp
smtp.internal.mp-objects.com is an alias for mposerv10.internal.mp-objects.com.
mposerv10.internal.mp-objects.com has address 192.168.1.10

/ 7	. 

/ Op planning, inventory, visibility by sku	,

search-bar: text field , search button , ...
navigation -bar: view button	,
data-panel: met table

/ 7	. 

$ vi StockKeepingUnit.standard.hbm.xml

<hibernate-mapping>
	<class
		name="com.mpobjects.inventory.model.entity.stockkeepingunit.StockKeepingUnit"
		table="INV_STOCK_KEEPING_UNIT">

/ inv_stock_keeping_unit is vooral een join table	, tusssen product en stock_location	,
/ hij geeft ook info over min/max stock amounts	,


geosco_a=# select sku.*from inv_stock_keeping_unit sku join product p on sku.product_systemid=p.system_id where p.productid='MPO_Prod1';
 system_id | product_systemid | stock_location_systemid | goods_status_systemid | min_level  | max_level  | lot_size  | lead_
time | target_level | organization_systemid | distribution_strategy | sourcing_strategy | replenishment_strategy 
-----------+------------------+-------------------------+-----------------------+------------+------------+-----------+------
-----+--------------+-----------------------+-----------------------+-------------------+------------------------
  26880723 |         26878483 |                26877283 |              26877284 | 1000.00000 | 5000.00000 | 100.00000 | P2D  
     |   2000.00000 |                 12000 | OVERLOAD_ALLOWED      | TO_TARGET         | TO_TARGET
(1 row)
/ op test zien we  4 rows	, 4 verschillende stock_location's	,

geosco_a=# select sl.name from inv_stock_keeping_unit sku join product p on sku.product_systemid=p.system_id join stock_location sl on sku.stock_location_systemid=sl.system_id where p.productid='MPO_Prod1';
         name          
-----------------------
 GEODIS_WHS_FR_SOCHAUX
(1 row)

/ 7	. 

$ vi StockTransaction.standard.hbm.xml

<hibernate-mapping>
	<class
		name="com.mpobjects.inventory.model.entity.stocktransaction.StockTransaction"
		table="STOCK_TRANSACTION">

/ NOTES

/ stock replanishment = stock aanvullen	,

/ Ga naar	,
configuration, inventory, stock keeping unit	,
/ open er een	,
Edit Stock Keeping Unit

/ we zien product, stocklocation	,
/ we zien  minlevel, target level, maxlevel	,
/ we zien lot size , lead time	,
/ we zien replanishment strategy, sourcing strategy	, distribution strategy	, 

/ als de voorraad te laag, is of te laag wordt	, moet hij aangevuld	, 
/ als de voorraad over 3 dagen te laag wordt, en de leverancier is in China, dan probleem	, dus: lead time : WH de dag die het duurt van leverancier naar de stock location	, 
/ lot size is unit, dus soms worden producten in 8 stuks vervoerd	, dus als er 100 moeten komen, moeten er 104 komen	,



/ Einde NOTES

/ Einde PSA-267

/ DEBUG PSA-267

/ we doen	,
$ kill -9 $(awk '/chromedriver/ && !/awk/{print $2}' <(ps ajx))

/ 7	. 

/ planning, inventory, visibility by sku
StockKeepingUnitListPage

$ vi StockKeepingUnit.standard.hbm.xml
<hibernate-mapping>
	<class
		name="com.mpobjects.inventory.model.entity.stockkeepingunit.StockKeepingUnit"
		table="INV_STOCK_KEEPING_UNIT">

$ vi GoodsStatus.standard.hbm.xml

<hibernate-mapping>
	<class name="com.mpobjects.oms.model.entity.goodsstatus.GoodsStatus" table="GOODS_STATUS">

<hibernate-mapping>
	<class
		name="com.mpobjects.inventory.model.entity.stocklocation.StockLocation"
		table="STOCK_LOCATION">


geosco_a=# select*from inv_stock_keeping_unit;
...

/ 7	. 



$ vi StockKeepingUnitListPage.java
		QueryDefinition myQuery = new QueryDefinition("sku-visibility");
		myQuery.setFromClause("from StockKeepingUnit s left join s.goodsStatus gs");
		myQuery.setOrganizationClause("s.organization");

		myQuery.addColumn(new IdQueryColumn("systemId", "s.systemId"))
				.addColumn(new QueryColumn<String>("productId", "s.product.code"))
				.addColumn(new QueryColumn<String>("product", "s.product.description"))
				.addColumn(new QueryColumn<String>("goodsstatus", "gs.code"))
				.addColumn(new QueryColumn<String>("location", "s.stockLocation.code"));

/ In .addColumn zien we s.product.code, s.stockLocation.code	, gs.code	,
/ de join met goods_status hadden we al set	, 
/ maar die met product en stock_location nog niet	, en die worden dus implicit	,

/ we zien in postgres log	,

select stockkeepi0_.SYSTEM_ID as col_0_0_, product2_.PRODUCTID as col_1_0_, product2_.DESCRIPTION as col_2_0_, goodsstatu1_.CODE as col_3_0_, stocklocat4_.NAME as col_4_0_ 
from INV_STOCK_KEEPING_UNIT stockkeepi0_ 
left outer join GOODS_STATUS goodsstatu1_ on stockkeepi0_.GOODS_STATUS_SYSTEMID=goodsstatu1_.SYSTEM_ID, 
product product2_, 
STOCK_LOCATION stocklocat4_ 
where stockkeepi0_.PRODUCT_SYSTEMID=product2_.SYSTEM_ID  			/ join cond	,
and stockkeepi0_.STOCK_LOCATION_SYSTEMID=stocklocat4_.SYSTEM_ID 	/ join cond	,
and (stockkeepi0_.ORGANIZATION_SYSTEMID in (
	select userorgani5_.ORGANIZATION_SYSTEMID 
	from USER_ORGANIZATION userorgani5_, ORGANIZATION organizati6_ 
	where userorgani5_.ORGANIZATION_SYSTEMID=organizati6_.SYSTEM_ID 
	and userorgani5_.USER_SYSTEMID=$1)
)
parameters: $1 = '26882987'

/ 13	. 

/ op een gegeven moment 	,
/s
QueryViewPanel.getRowsOnPage() line: 206	
				default:
					showAll();
/s
QueryViewPanel.showAll() line: 782	
		rowsOnPage.clear();
		Iterator<? extends List<Object>> myIterator = dataProvider.iterator((currentPage - 1) * rowsPerPage, rowsPerPage);
/s
QueryViewPanel$4.iterator(int, int) line: 727	
				return loadEntriesFromDatabase(first, count).iterator();
/s
QueryViewPanel$4.loadEntriesFromDatabase(int, int) line: 746	
				Query myCount = createSelectQuery();
myCount	org.hibernate.impl.QueryImpl  (id=20327)	

QueryImpl(select s.systemId, s.product.code, s.product.description, gs.code, s.stockLocation.code 
from StockKeepingUnit s left join s.goodsStatus gs 
where (s.organization in (select uo.organization from UserOrganization uo where uo.resource.systemId =:userSystemId)) )

/ we zien	,

elect stockkeepi0_.SYSTEM_ID as col_0_0_, product2_.PRODUCTID as col_1_0_, product2_.DESCRIPTION as col_2_0_, goodsstatu1_.CODE as col_3_0_, stocklocat4_.NAME as col_4_0_ 
from INV_STOCK_KEEPING_UNIT stockkeepi0_ 
left outer join GOODS_STATUS goodsstatu1_ on stockkeepi0_.GOODS_STATUS_SYSTEMID=goodsstatu1_.SYSTEM_ID, 
product product2_, 
STOCK_LOCATION stocklocat4_ 
where stockkeepi0_.PRODUCT_SYSTEMID=product2_.SYSTEM_ID 
and stockkeepi0_.STOCK_LOCATION_SYSTEMID=stocklocat4_.SYSTEM_ID 
and (stockkeepi0_.ORGANIZATION_SYSTEMID in (
	select userorgani5_.ORGANIZATION_SYSTEMID 
	from USER_ORGANIZATION userorgani5_, 
	ORGANIZATION organizati6_ 
	where userorgani5_.ORGANIZATION_SYSTEMID=organizati6_.SYSTEM_ID 
	and userorgani5_.USER_SYSTEMID=$1
)) 
limit $2
DETAIL:  parameters: $1 = '26882987', $2 = '15'

/ 7	. 

/ we check een sku, en click show	,
/s
StockKeepingUnitListPage$1.execute(Set<Serializable>) line: 57	
		myGroupAction.add(new GroupAction("show", "edit") {

			@Override
			public void execute(Set<? extends Serializable> aSelectedRowSet) {
				LOG.debug("Showing stock for [" + aSelectedRowSet.size() + "] items");
				List<StockKeepingUnit> mySet = new ArrayList<StockKeepingUnit>();
				StockKeepingUnitDAO myDAO = MpoBeanFactory.getBean(StockKeepingUnitDAO.class);
				for (Serializable mySystemId : aSelectedRowSet) {
					mySet.add(myDAO.getBySystemId((Integer) mySystemId));
				}

mySet	ArrayList  (id=22058)	
	elementData	Object[10]  (id=22259)	
		[0]	StockKeepingUnit_$$_javassist_18  (id=22260)	
			handler	JavassistLazyInitializer  (id=22326)	
				target	StockKeepingUnit  (id=22353)	
					distributionStrategy	DistributionStrategy  (id=22356)	
					goodsStatus	GoodsStatus_$$_javassist_54  (id=22357)	
					leadTime	Period  (id=22366)	
					lotSize	BigDecimal  (id=22404)	
					maxStockLevel	BigDecimal  (id=22406)	
					minStockLevel	BigDecimal  (id=22408)	
					organization	Organization  (id=22410)	
					performanceMonitorService	null	
					product	Product_$$_javassist_14  (id=22453)	
					replenishmentStrategy	ReplenishmentStrategy  (id=22671)	
					sourcingStrategy	SourcingStrategy  (id=22682)	
					stockLocation	StockLocation_$$_javassist_75  (id=22697)	
					systemId	26880723	
					targetStockLevel	BigDecimal  (id=22719)	
/ 'n sku	,

				StockVisibilityPage myPage = new StockVisibilityPage(StockKeepingUnitListPage.this, mySet);
/s
StockVisibilityPage.<init>(BasePage, List<StockKeepingUnit>) line: 21	
		StockVisibilityPanel myPanel = new StockVisibilityPanel("panel", new ListModel(aList));
/ aList is de list van checked sku's (voordat we op Show clicked)	, bij ons maar 1 sku	,
/s
StockVisibilityPanel.<init>(String, IModel<List<StockKeepingUnit>>) line: 34	

	private IModel<List<StockKeepingUnit>> skuList = null;
	private WebMarkupContainer skuView;
	private BeanWrapper<StockKeepingUnitDAO> stockKeepingUnitDAO = new BeanWrapper<StockKeepingUnitDAO>(StockKeepingUnitDAO.class);
		skuList = aPropertyModel;
/ de list (model ) van checked sku's	,

/c
/s
StockVisibilityPanel.onInitialize() line: 53	
		super.onInitialize();
		projectionProperties = new ProjectionProperties();
		projectionProperties.setStart(DateTime.now());
		projectionProperties.setProjectionInterval(ProjectionInterval.DAYS);
		projectionProperties.setNoOfPeriods(10);
		addTimeLine();
/s
StockVisibilityPanel.addTimeLine() line: 86	
		add(new TimeLinePanel("timeline", projectionProperties) {
			...
/s

/ Intermezzo

$ vi TimeLinePanel.html

wicket:panel>
	<div class="timeline">
		<div class="timeline-action">
			<wicket:enclosure>
				<span><wicket:message key="periods">Periods</wicket:message></span>
				<select wicket:id="periodSize"></select>
			</wicket:enclosure>
			<button type="button" wicket:id="refresh" class="icon small icon_refresh"></button>
			<button type="button" wicket:id="backward" class="icon small icon_previous"></button>
			<button type="button" wicket:id="forward" class="icon small icon_next"></button>
			<button type="button" wicket:id="zoomOut" class="icon small icon_zoom_out"></button>
			<button type="button" wicket:id="zoomIn" class="icon small icon_zoom_in"></button>
		</div>
		<div class="sku-info"><span class="special-message" wicket:id="specialMessage"></span></div>
		<div class="projection-title"></div>
		<div class="period" wicket:id="period">
/ blokje met 18-12, Fri, 00:00 onder elkaar	, 
/ we zien hier in deze pre html maar 1 <div/>	, maar in java een listview	,
			<wicket:container wicket:id="periodPanel" />
		</div>
	</div>	
</wicket:panel>

/ Dus rechtboven de buttons horen bij de time line panel	,

/ Einde Intermezzo

/c
StockVisibilityPanel.addSkuList() line: 64	
			@Override
			protected void populateItem(ListItem<StockKeepingUnit> anItem) {
				final EntityDetachableModel<StockKeepingUnit> myModel = new EntityDetachableModel<StockKeepingUnit>(anItem.getModelObject().getSystemId(), stockKeepingUnitDAO);
				anItem.add(new SkuLinePanel("skuLine", myModel, projectionProperties) {
					...

/ Intermezzo

$ vi SkuLinePanel.java
<wicket:panel>
	<div class="sku-line">
/ hele block
		<div class="sku-info" wicket:id="skuInfo"></div>
/ block links van de timeline's en de ...	, met min/max	 ... 
		<div class="projection-title">
/ 1 block van labels, vertical, met FC In, In, ...
			<div class="projection-label">
				<wicket:message key="forecast-in">FC In</wicket:message>
			</div>
			<div style="clear:both"></div>
			<div class="projection-label">
				<wicket:message key="in">In</wicket:message>
			</div>
			<div style="clear:both"></div>
			<div class="projection-label">
				<wicket:message key="forecast-out">FC Out</wicket:message>
			</div>
			<div style="clear:both"></div>
			<div class="projection-label">
				<wicket:message key="out">Out</wicket:message>
			</div>
			<div style="clear:both"></div>
			<div class="projection-label">
				<wicket:message key="count">Count</wicket:message>
			</div>
			<div style="clear:both"></div>
			<div class="projection-label">
				<wicket:message key="balance">Balance</wicket:message>
			</div>
		</div>
		<div class="projection" wicket:id="projection">
/ WH listview,	 we zien er in deze pre HTML maar 1, maar het worden er meerdere, naast elkaar, voor elke dag 1	,
/ net als periodpanel	, onder elkaar 0,0,....,4800 (balance)	, voor iedere dag zo'n block	, 
			<wicket:container wicket:id="projectionInfo" />
/ die 0,0,...,4800 
		</div>
	</div>
</wicket:panel>

$ vi SkuLinePanel.java

		add(new SkuInfoPanel("skuInfo", sku));
		ListView<ProjectionPeriod> myProjectionView = new ListView<ProjectionPeriod>("projection", new PropertyModel<List<ProjectionPeriod>>(projectionProperties, "periods")) {
			@Override
			protected void populateItem(final ListItem<ProjectionPeriod> aProjectionItem) {
				final IModel<StockProjection> projModel = Model.of(stockProjections.getObject().get(aProjectionItem.getModelObject()));
				aProjectionItem.add(new ProjectionPanel("projectionInfo", projModel, sku.getObject()));

$ vi ProjectionPanel.java
<wicket:panel>
	<div class="stock-in" wicket:id="stock-in-fc"></div>
	<div class="stock-in" wicket:id="stock-in"></div>
	<div class="stock-out" wicket:id="stock-out-fc"></div>
	<div class="stock-out" wicket:id="stock-out"></div>
	<div class="stock-count" wicket:id="stock-count"></div>
	<div class="stock-balance" wicket:id="stock-balance"></div>
</wicket:panel>

$ vi ProjectionPanel.java

	public ProjectionPanel(String aId, IModel<StockProjection> aModel, StockKeepingUnit aSku) {
		super(aId);
		model = aModel;
		sku = aSku;

		NumberLabel myInFc = new NumberLabel("stock-in-fc", "#.##", model.getObject().getTotalInForecast());
		addCssClass(myInFc, model.getObject().isHasIgnoredInForecast(), "ignoredBalance");
		add(myInFc);

		NumberLabel myIn = new NumberLabel("stock-in", "#.##", model.getObject().getTotalIn());
		addCssClass(myIn, model.getObject().isHasIgnoredIn(), "ignoredBalance");
		add(myIn);

		NumberLabel myOutFc = new NumberLabel("stock-out-fc", "#.##", model.getObject().getTotalOutForecast());
		addCssClass(myOutFc, model.getObject().isHasIgnoredOutForecast(), "ignoredBalance");
		add(myOutFc);

		NumberLabel myOut = new NumberLabel("stock-out", "#.##", model.getObject().getTotalOut());
		addCssClass(myOut, model.getObject().isHasIgnoredOut(), "ignoredBalance");
		add(myOut);

		NumberLabel myLastCount = new NumberLabel("stock-count", "#.##", model.getObject().getLastStockCount());
		// addCssClass(myLastCount, model.getObject().isHasIgnoredOut(), "ignoredBalance");
		add(myLastCount);

		NumberLabel myBalance = new NumberLabel("stock-balance", "#.##", model.getObject().getBalance());
		myBalance.add(new AttributeAppender("class", new AbstractReadOnlyModel<String>() {

			@Override
			public String getObject() {
				BigDecimal balance = model.getObject().getBalance();
				if (sku.getMinStockLevel() != null && balance.compareTo(sku.getMinStockLevel()) < 0) {
					return "under";
				} else if (sku.getMaxStockLevel() != null && balance.compareTo(sku.getMaxStockLevel()) > 0) {
					return "over";
				}
				return "";
			}

		}, " "));
		add(myBalance);
	}



/ Einde Intermezzo

/s
SkuLinePanel$1.loadProjections() line: 83	
				List<StockProjection> list = stockProjectionService.get(sku.getObject(), projectionProperties,
						getTemporaryStockTransactions());

this	SkuLinePanel$1  (id=26381)	
	this$0	StockVisibilityPanel$1$1  (id=26361)	
		projectionProperties	ProjectionProperties  (id=25330)	
		sku	EntityDetachableModel  (id=26378)	

this	SkuLinePanel$1  (id=26381)	
	this$0	StockVisibilityPanel$1$1  (id=26361)	
		projectionProperties	ProjectionProperties  (id=25330)	
			end	null	
			noOfPeriods	10	
			originalStart	DateTime  (id=25470)	
			periods	ArrayList  (id=26512)	
			projectionInterval	ProjectionInterval  (id=25897)	
			start	DateTime  (id=25470)	
			zoomEnabled	true	
		sku	EntityDetachableModel  (id=26378)	
			attached	true	
			attachedVolatile	true	
			dao	BeanWrapper  (id=25894)	
			entity	StockKeepingUnit_$$_javassist_18  (id=26531)	
				handler	JavassistLazyInitializer  (id=26536)	
					target	StockKeepingUnit  (id=26554)	
						distributionStrategy	DistributionStrategy  (id=22356)	
						goodsStatus	GoodsStatus_$$_javassist_54  (id=26557)	
						leadTime	Period  (id=26558)	
						lotSize	BigDecimal  (id=26559)	
						maxStockLevel	BigDecimal  (id=26561)	
						minStockLevel	BigDecimal  (id=26563)	
						organization	Organization  (id=26565)	
						performanceMonitorService	null	
						product	Product_$$_javassist_14  (id=26568)	
						replenishmentStrategy	ReplenishmentStrategy  (id=22671)	
						sourcingStrategy	SourcingStrategy  (id=22682)	
						stockLocation	StockLocation_$$_javassist_75  (id=26572)	
						systemId	26880723	
						targetStockLevel	BigDecimal  (id=26575)	
/s
StockProjectionServiceImpl.get(StockKeepingUnit, ProjectionProperties, Collection<StockTransaction>) line: 65	
		DateTime myStart = aProperties.getProjectionStart();
2015-12-18T00:00:00.000+01:00
		DateTime myEnd = aProperties.getProjectionEnd();
2015-12-28T00:00:00.000+01:00
		List<StockTransaction> myTransactionList = stockTransactionDAO.get(aSku, myStart.toDate(), myEnd.toDate());
[]
/ want 	,
/s
StockTransactionDAOImpl.get(StockKeepingUnit, Date, Date) line: 49	
/=
	public List<StockTransaction> get(StockKeepingUnit aSku, Date aStart, Date aEnd) {

		DetachedCriteria myCriteria = DetachedCriteria.forClass(StockTransaction.class);

		myCriteria.add(Property.forName("product").eq(aSku.getProduct()))
			.add(Property.forName("stockLocation").eq(aSku.getStockLocation()));

aSku	StockKeepingUnit_$$_javassist_18  (id=27681)	
	handler	JavassistLazyInitializer  (id=28311)	
		target	StockKeepingUnit  (id=28322)	
			...
			product	Product_$$_javassist_14  (id=28329)	
				handler	JavassistLazyInitializer  (id=28427)	
					target	Product  (id=28499)	
						$SWITCH_TABLE$com$mpobjects$oms$model$entity$entitydetailtype$ValueType	null	
						adnDangerousGoodsTankVesselInstance	null	
						adrCode	null	
						attachments	PersistentSet  (id=28510)	
						billOfMaterialsList	PersistentSet  (id=28511)	
						code	"MPO_Prod1" (id=28517)	
						countryOfOrigin	null	
						createdDate	Timestamp  (id=28528)	
						currencyDAO	null	
						customsNumber	null	
						dao	null	
						deleted	false	
						description	"MPO test product 1" (id=28554)	
						entityDetails	PersistentMap  (id=28560)	
						flashpoint	null	
						height	null	
						lastUpdate	Timestamp  (id=28576)	
						length	null	
						loadingMeters	null	
						model	null	
						organization	Organization  (id=28328)	
						organization	null	
						packagingGroup	null	
						packingDefinitions	PersistentList  (id=28607)	
						partNumber	null	
						performanceMonitorService	null	
						productGroup	null	
						productOwner	null	
						quantityInShippingUnit	null	
						remarks	null	
						series	null	
						shippingUnit	null	
						systemId	26878483	
						theFormattedEntity	null	
						theOriginalCustomerOrderId	null	
						theOriginalCustomerOrderLineId	null	
						theReference1	null	
						theReference10	null	
						theReference2	null	
						theReference3	null	
						theReference4	null	
						theReference5	null	
						theReference6	null	
						theReference7	null	
						theReference8	null	
						theReference9	null	
						unNumber	null	
						value	null	
						valueCurrency	null	
						volume	null	
						weightKg	BigDecimal  (id=28729)	
						width	null	
			stockLocation	StockLocation_$$_javassist_75  (id=28331)	
				handler	JavassistLazyInitializer  (id=28887)	
					target	StockLocation  (id=28960)	
						code	"GEODIS_WHS_FR_SOCHAUX" (id=28975)	
						deleted	false	
						description	"" (id=28881)	
						locationType	StockLocationType_$$_javassist_138  (id=28981)	
						parentLocation	StockLocation_$$_javassist_75  (id=28996)	
						party	PartyVO_$$_javassist_20  (id=29003)	
						performanceMonitorService	null	
						systemId	26877283	

		if (aSku.getGoodsStatus() == null) {
/ NEE
		} else {
			myCriteria.add(Property.forName("goodsStatus").eq(aSku.getGoodsStatus()));

		myCriteria.add(Property.forName("transactionDate").ge(aStart)).add(Property.forName("transactionDate").lt(aEnd)).addOrder(Order.asc("transactionDate"));

/ TODO (de query in de log)	,

/t
StockProjectionServiceImpl.get(StockKeepingUnit, ProjectionProperties, Collection<StockTransaction>) line: 100	
		List<StockTransaction> myTransactionList = stockTransactionDAO.get(aSku, myStart.toDate(), myEnd.toDate());
[]
		StockTransaction myPrevious = stockTransactionDAO.getPrevious(aSku, myStart.toDate());
/s
StockTransactionDAOImpl.getPrevious(StockKeepingUnit, Date) line: 218	

		DetachedCriteria myCriteria = DetachedCriteria.forClass(StockTransaction.class);

		myCriteria.add(Property.forName("product").eq(aSku.getProduct()))
			.add(Property.forName("stockLocation").eq(aSku.getStockLocation()));
		if (aSku.getGoodsStatus() == null) {
/ NEE
		} else {
			myCriteria.add(Property.forName("goodsStatus").eq(aSku.getGoodsStatus()));
		}
		myCriteria.add(Property.forName("transactionDate").lt(aDate))
			.addOrder(Order.desc("transactionDate"))
			.addOrder(Order.desc("systemId"));

		@SuppressWarnings("unchecked")
		List<StockTransaction> myList = getHibernateTemplate().findByCriteria(myCriteria, 0, 1);
		if (myList.isEmpty()) {
/ NEE
		} else {
			return myList.get(0);
/t
StockProjectionServiceImpl.get(StockKeepingUnit, ProjectionProperties, Collection<StockTransaction>) line: 101	
		StockTransaction myPrevious = stockTransactionDAO.getPrevious(aSku, myStart.toDate());
/d
26883323/COUNT/2015-12-11 00:00:00.0/MPO_Prod1 (26878483)/com.mpobjects.inventory.model.entity.stocklocation.StockLocation@25fd79aa[GEODIS_WHS_FR_SOCHAUX,]/1050.00000/1050.00000/false

		if (myPrevious != null) {
			BigDecimal calcStockLevel = null;
			if (myPrevious.getCalculatedStockLevel() == null) {
/ NEE
			} else {
				calcStockLevel = myPrevious.getCalculatedStockLevel();
1050
			myStartBalance = myStartBalance.add(calcStockLevel);
1050.00000
		return createStockProjections(myStartBalance, myTransactionList, aProperties.getPeriods());
/s
StockProjectionServiceImpl.createStockProjections(BigDecimal, List<StockTransaction>, List<ProjectionPeriod>) line: 171	
/=
	protected List<StockProjection> createStockProjections(BigDecimal myStartBalance, List<StockTransaction> aTransactionList, List<ProjectionPeriod> aPeriods) {

/ WH Gaat alle blocks berekenen	, voor elke dag	,

		BigDecimal myBalance = myStartBalance;
1050.00000
		List<StockProjection> myList = new ArrayList<StockProjection>();
		StockProjection myCurrent = new StockProjection(periods.remove());
/ HIER HIER HIER
		myCurrent.setStartBalance(myBalance);
		myCurrent.setBalance(myBalance);

/ TODO DEBUG PSA-267 PAUL WICKET (Afmaken)












/ 7	. 

/ planning, inventory, stock count	,
StockCountListPage

$ vi StockCountListPage.java

		myQuery.setFromClause("from StockLocation sl left join sl.party slparty");
		myQuery.setOrganizationClause("slparty.organizationVO");
		if (AuthenticationUtils.getResource().hasPrivilege("stock-location", "no-party-check")) {
			LOG.info("Not checking parties for user [" + AuthenticationUtils.getUserId() + "]");
		} else {
			myQuery.setUserPartySystemIdField("slparty.systemId");
		}
		myQuery.getColumns().add(new IdQueryColumn("systemId", "sl.systemId"));
		myQuery.getColumns().add(new QueryColumn<String>("code", "sl.code"));
		myQuery.getColumns().add(new QueryColumn<String>("organization", "slparty.organizationVO.code"));
		myQuery.getColumns().add(new QueryColumn<String>("party.partyId", "sl.party.partyId"));

/ we zien 	,

select stocklocat0_.SYSTEM_ID as col_0_0_, stocklocat0_.NAME as col_1_0_, organizati2_.ORGANIZATION_ID as col_2_0_, partyvo3_.PARTY_ID as col_3_0_ 
from STOCK_LOCATION stocklocat0_ 
left outer join PARTY partyvo1_ on stocklocat0_.PARTY_SYSTEMID=partyvo1_.SYSTEM_ID, 
ORGANIZATION organizati2_, 
PARTY partyvo3_ 
where partyvo1_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID  	/ join cond	,
and stocklocat0_.PARTY_SYSTEMID=partyvo3_.SYSTEM_ID 			/ join cond	,
and (partyvo1_.ORGANIZATION_SYSTEMID in (
	select userorgani4_.ORGANIZATION_SYSTEMID 
	from USER_ORGANIZATION userorgani4_, ORGANIZATION organizati5_ 
	where userorgani4_.ORGANIZATION_SYSTEMID=organizati5_.SYSTEM_ID 
	and userorgani4_.USER_SYSTEMID=$1)
)
DETAIL:  parameters: $1 = '26882987'

/ 7	. 

/ geef soch in filter op 'stock count' scherm	, we zien 'GEODIS_WHS_FR_SOCHAUX'	, 

$ vi StockCountListPage.java
		myRowActions.add(new RowAction() {
			@Override
			public boolean execute(Object aObject) {
->				StockCountEditPage myPage = new StockCountEditPage((Integer) aObject, StockCountListPage.this);

/ 7	. 

/ we select een stock keeping unit	, en click Show	,
/s
StockKeepingUnitListPage$1.execute(Set<Serializable>) line: 63	
		...
		myGroupAction.add(new GroupAction("show", "edit") {
			@Override
			public void execute(Set<? extends Serializable> aSelectedRowSet) {
				...
				StockVisibilityPage myPage = new StockVisibilityPage(StockKeepingUnitListPage.this, mySet);
/s




/ Einde DEBUG PSA-267

/ PCT-980

/ 2 andere problemen	, 
/ Als we in list van parties op name filter, bijv foo	, dan pakt hij alle parties waar foo in de name voorkomt	, ipv dat de name foo is	,
/ op geosco kunnen we niet eens een party maken	,

/ configuration, planning, parties
$ vi PartyListPage.java
	protected void createFormButton() {
		Form<CustomerOrderLine> createForm = new Form<CustomerOrderLine>("createForm");
/ TODO
		add(createForm);
		createForm.add(new Button("createButton") {
			@Override
			public void onSubmit() {
				String returnUrl = getRequestCycle().urlFor(PartyListPage.this).toString();
				returnUrl = RequestUtils.toAbsolutePath(returnUrl);
				getRequestCycle().setRequestTarget(
						new RedirectRequestTarget("../oms/party_create?" + "base_sessionLevelOffset=1" + "&returnUrl=" + returnUrl));
			}

$ vi oms-sitemap.xmap

			<map:action logger="party" name="partyDelete" src="com.mpobjects.oms.control.party.action.PartyDeleteAction"/>
			<map:action logger="party" name="partyForm" src="com.mpobjects.oms.control.party.action.PartyFormAction"/>

			<map:match type="regexp" pattern="^party_(edit|create)$">
				<map:act type="partyForm"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/party_edit.jsp"/>
			</map:match>

/ we create een party	,
party id: foo
organistatie: PNL-TMS-AB
party type : HUB
naam: foo
straat: foo
land: NL
Save and close

/ Zoek op party id: foo, 
/ dan weer party_edit.jsp , maar nu met delete button	,
/s
PartyFormAction.act() line: 46	
		int mySystemId = getSystemIdFromRequest();
mySystemId	27575210	
		} else {
			myVO = MpoBeanFactory.getBean(PartyDAO.class).getBySystemId(getSystemIdFromRequest());
myVO	PartyVO_$$_javassist_21  (id=17450)	
[SystemId: 27575210; Party: foo; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@5c4ef80d[HUB,Stadslogistiek]]

		getSession().setAttribute("formVO", myVO);
		getRequest().setAttribute("partySystemId", myVO.getSystemId());

		if (mySystemId != 0) {
			myPartyGroupAddVO = new PartyGroupAddVO(myVO.getPartyGroups());
{}
		getSession().setAttribute("partyAddFormVO", myPartyGroupAddVO);

		String returnUrl = getRequestParameter("returnUrl");
http://localhost:8080/tms/wicket/?wicket:interface=:8::::
		getRequest().setAttribute("returnUrl", returnUrl);

/ 13	. 

$ vi party_edit.jsp

						<mpo:button type="save" />
						<mpo:button type="saveAndClose" url="${returnUrl}" />
						<mpo:button type="cancel" url="${returnUrl}"/>
						<mpo:button type="delete" />

/ WH wordt met getRequest().setAttribute("returnUrl") deze bereikbaar in JSP	,
/ TODO

[eric@localhost trunk]$ find -name pageHeader.tag
./base-framework/core/war/WEB-INF/tags/core/pageHeader.tag
$ vi pageHeader.tag
	<c:choose>
		<c:when test="${pageType=='form'}" >
			<script type="text/javascript" src="../script/class.formmanager.js"> </script>

$ vi party_edit.jsp

<%@taglib prefix="ctf" tagdir="/WEB-INF/tags/core/"%>

<ctf:page title="party" type="form">
	<ctf:pageHeader>

[eric@localhost trunk]$ ls ./base-framework/core/war/WEB-INF/tags/core
pageBody.tag  pageHeader.tag  page.tag  userLoginBody.tag

/ we zien dus page.tag en pageHeader.tag	,
$ vi pageHeader.tag
...
<head>
    <c:choose>
        <c:when test="${pageType=='form'}" >
            <script type="text/javascript" src="../script/class.formmanager.js"> </script>
 
[eric@localhost trunk]$ vi ./base-framework/core/war/WEB-INF/tags/core/page.tag 
...


/ we zien in HTML	,
<input type="button" value="Delete" onclick=" theEditFormFormManager.remove('You really want to delete this record?', '../oms/party_delete?systemId=27575210');">

/ 13	. 

/ we edit een party	,
/s
ButtonTag.doStartTag() line: 91	

		RequestManager myRequestManager = (RequestManager) getRequest().getAttribute("requestManager");
		String returnUrl = (String) getRequest().getAttribute("returnUrl");

			} else if (!getType().equals(TYPE_BACK)) {
				myPrint.append("<input type=\"button\"");
				myPrint.append(" name=\"" + getType() + "Btn\"");
				myPrint.append(" id=\"" + getType() + "Btn\"");
				myPrint.append(" value=\"" + getLabel(getType()) + "\"");
				myPrint.append(" onclick=\" " + getForm().getJsFormManager() + ".submit('" + getUrlForType(getType()) + "', " + getDoRedirect() + ", " + getRedirectLevelOffset() + ");\"");
/s
ButtonTag.getForm() line: 286	
/t
/s
FormTag.getJsFormManager() line: 381	
		return "the" + StringUtils.firstCharToUpper(theName) + "FormManager";
theName="editForm"

$ vi FormTag.java
	private String theName = "editForm";

/t
/s
ButtonTag.getType() line: 246	
		return theType;
"save"
/ TODO
/t
/s
ButtonTag.getUrlForType(String) line: 308	
		String myRet = EntityActionUtil.getActionUrl(getRequest(), aType);
"oms/party_save"
		return myRet;
/t
ButtonTag.doStartTag() line: 225	
				myPrint.append(" onclick=\" " + getForm().getJsFormManager() + ".submit('" + getUrlForType(getType()) + "', " + getDoRedirect() + ", " + getRedirectLevelOffset() + ");\"");
/d
myPrint= <input type="button" name="saveBtn" id="saveBtn" value="Save" onclick=" theEditFormFormManager.submit('../oms/party_save', false, 0);"

/ 7	. 

/ we click cancel	,

<input type="button" id="cancelBtn" value="Cancel" onclick=" theEditFormFormManager.cancelAndRedirect('Loose changes made after last save', 'http://localhost:8080/tms/wicket/?wicket:interface=:19::::');">
<input type="button" value="Delete" onclick=" theEditFormFormManager.remove('You really want to delete this record?', '../oms/party_delete?systemId=27575210');">



/ 7	. 

/ we click delete	,
<input type="button" value="Delete" onclick=" theEditFormFormManager.remove('You really want to delete this record?', '../oms/party_delete?systemId=27575210');">
/s
    this.remove = function(aMessage, anUrl) {
        confirm(aMessage) &&  this.performRedirect(anUrl);
    }
/s
     this.performRedirect = function(newUrl) {
    	 document.location.replace(newUrl);
newUrl: "../oms/party_delete?systemId=26694444"

$ vi oms-sitemap.xmap

			<map:action logger="party" name="partyDelete" src="com.mpobjects.oms.control.party.action.PartyDeleteAction"/>

			<map:match pattern="party_delete">
				<map:act type="partyDelete"/>
			</map:match>

/s
PartyDeleteAction(AbstractDeleteAction).act() line: 39	
		int mySystemId = getSystemIdFromRequest();
26694444
		handleDelete(mySystemId);
/s
PartyDeleteAction.handleDelete(int) line: 21	
		MpoBeanFactory.getBean(PartyDAO.class).delete(aSystemId);
/s
PartyDAOImpl(GenericHibernateDAO).delete(int) line: 131	
		Type myObj = getBySystemId(aSystemId);
/s
PartyDAOImpl(GenericHibernateDAO).getBySystemId(int) line: 300	
			try {
				return type.cast(getHibernateTemplate().load(type, aSystemId));

this	PartyDAOImpl  (id=16356)	
	type	Class (com.mpobjects.oms.model.party.vo.PartyVO) (id=9160)	

/t
PartyDAOImpl(GenericHibernateDAO).delete(int) line: 132	
		Type myObj = getBySystemId(aSystemId);
/d
myObj	PartyVO_$$_javassist_21  (id=16377)	

		delete(myObj);
/s
PartyDAOImpl(GenericHibernateDAO).delete(Type) line: 143	
			if (isDeletable()) {
/ JA
/ want	,
/s
PartyDAOImpl(GenericHibernateDAO).isDeletable() line: 918	
		return SoftDeletable.class.isAssignableFrom(type);
/t
			if (isDeletable()) {
/d
				SoftDeletable myDeletable = (SoftDeletable) anEntity;
				myDeletable.setDeleted(true);
/s
PartyVO.setDeleted(boolean aDeleted){
	deleted=aDeleted;
}
/ Dit is dus niet echt delete	, maar set deleted column=true 

				save(anEntity);
/s
PartyDAOImpl(GenericHibernateDAO).save(Type) line: 501	
		} else {
			getHibernateTemplate().update(anEntity);
/t
PartyDeleteAction(AbstractDeleteAction).act() line: 40	
		handleDelete(mySystemId);
/d

/ Deze keer terug op dezelfde page	,
/ want	,
		RedirectSaveAction.redirect(getRedirector(), getRequest(), getRedirectUrl());
/s
PartyDeleteAction(AbstractDeleteAction).getRedirectUrl() line: 62	
		if (this instanceof FlowControlledAction) {
			myRet = "../core/back?levelOffset=1";
/t
/s
RedirectSaveAction.redirect(Redirector, Request, String) line: 38	
		redirect(aRedirector, aRequest, anUrl, 0);
/s
RedirectSaveAction.redirect(Redirector, Request, String, int) line: 43	

		for (Enumeration myEnum = aRequest.getParameterNames(); myEnum.hasMoreElements();) {
			myParameterName = (String) myEnum.nextElement();
systemId
			if (myParameterName.startsWith("base_") && StringUtils.isNotEmpty(aRequest.getParameter(myParameterName))) {
/ NEE
		aRequest.setAttribute("redirectTo", anUrl);
		try {
			String myRedirectPage = "../core/generic_save_redirect?redirectTo=" + URLEncoder.encode(anUrl, "UTF-8");
../core/generic_save_redirect?redirectTo=..%2Fcore%2Fback%3FlevelOffset%3D1
/=
../core/generic_save_redirect?redirectTo=../core/back?levelOffset=1
			aRedirector.redirect(true, myRedirectPage);

/ Hij komt op dezelfde page terecht		,

/ VOORLOPIGE FIX

$ vi ButtonTag.java

			} else if (getType().equals(TYPE_DELETE)) {
				if (getForm().getSystemId() > 0) {
					...
					myPrint.append(" onclick=\" " + getForm().getJsFormManager() + ".remove('" + getDeleteMessage() + "', '" + getDeleteUrl() + "&returnUrl=" + returnUrl + "');\""); 

$ vi AbstractDeleteAction.java
	public Map act() throws Exception {
		int mySystemId = getSystemIdFromRequest();
		handleDelete(mySystemId);

		// updateDynatable(mySystemId);
		// getSession().setAttribute(LIST_MESSAGE_ATTRIBUTE, getDeleteMessage());

		String returnUrl = getRequest().getParameter("returnUrl");
		RedirectSaveAction.redirect(getRedirector(), getRequest(), returnUrl);

/ De 2 commented out lines hebben we expres commented out	, 

/ we probeerden	, 
		 String returnUrl = "http://localhost/tms/wicket?module=oms&amp;wicketpage=party.PartyListPage&amp;emptySession=true";
/ Dit is NIET OK	, maar toch proberen	,
/ TODO

/ Einde VOORLOPIGE FIX

/ 7	. 

/ we add delete button naast edit button in de list 	, 

/ We proberen StockTransactionListPage	,

/ we set b in AbstractPage.<init>	,

/s
BaseHomePage.<init>() line: 27	
		super();
		doRedirect();
/s
BaseHomePage.doRedirect() line: 63	
				} else {
					page = pageFactory.newPage(pageClass, params);
pageClass=class com.mpobjects.inventory.view.wicket.stocktransaction.StockTransactionListPage
/s
DefaultPageFactory.newPage(Class<C>, PageParameters) line: 97	
			// return new Page()
			return createPage(constructor, null);
/s
DefaultPageFactory.createPage(Constructor<Page>, PageParameters) line: 192	
			else
			{
				return constructor.newInstance();
/s
DefaultPageFactory.createPage(Constructor<Page>, PageParameters) line: 192	
/s
StockTransactionListPage(AbstractMainPage).<init>() line: 34	
...

/c
/ in render fase	,
StockTransactionListPage(MarkupContainer).initialize() line: 433	
		super.fireInitialize();
/s
StockTransactionListPage(Component).fireInitialize() line: 4105	
			onInitialize();
/s
StockTransactionListPage(AbstractPage).onInitialize() line: 91	
		super.onInitialize();
		processPageParameters();
		initializePage();
/s
StockTransactionListPage(AbstractMainPage).initializePage() line: 57	
...
		super.initializePage();
/s
StockTransactionListPage(AbstractPage).initializePage() line: 76	
...
		createPageComponents();
/s
StockTransactionListPage.createPageComponents() line: 70	

/ 7	. 

/ we click op de edit button van een party	,
/s
WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
		if (wicketFilter.doGet(servletRequest, servletResponse) == false)
/s
WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
					// Process request
					cycle.request();
/s
MpoWebRequestCycle(RequestCycle).request() line: 545	
		// set start step
		currentStep = PREPARE_REQUEST;

		// loop through steps
		steps();
/s
MpoWebRequestCycle(RequestCycle).steps() line: 1465	
			for (int totalSteps = 0; currentStep < DONE; totalSteps++)
				...
					step();
/s
MpoWebRequestCycle(RequestCycle).step() line: 1358	
				case PROCESS_EVENTS : {
					processEventsAndRespond();			/ we clicked een button	,
/s
MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
		// let the processor handle/ issue any events, including building the component hierarchy
		processor.processEvents(this);
/s
WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
			((IEventProcessor)target).processEvents(requestCycle);
/s
BehaviorRequestTarget.processEvents(RequestCycle) line: 157	
		// Invoke the interface method
		behaviorListener.onRequest();
/s
AjaxLink$1(AbstractDefaultAjaxBehavior).onRequest() line: 312	

this	AjaxLink$1  (id=24226)	
app	WicketWebApplication  (id=24366)	
target	AjaxRequestTarget  (id=24235)	

		WebApplication app = (WebApplication)getComponent().getApplication();
		AjaxRequestTarget target = app.newAjaxRequestTarget(getComponent().getPage());
		RequestCycle.get().setRequestTarget(target);
		respond(target);
/s
AjaxLink$1(AjaxEventBehavior).respond(AjaxRequestTarget) line: 177	
		onEvent(target);
/s
AjaxLink$1.onEvent(AjaxRequestTarget) line: 68	
/=
	public AjaxLink(final String id, final IModel<T> model)
	{
		super(id, model);

		add(new AjaxEventBehavior("onclick")
		{
			private static final long serialVersionUID = 1L;

			@Override
			protected void onEvent(AjaxRequestTarget target)
			{
				onClick(target);
/s
RowActionPanel$1.onClick(AjaxRequestTarget) line: 36	
/=
	public RowActionPanel(String aId, final RowAction anAction, final Object anObject, String cssClass, String aTitle) {
		super(aId);

		AjaxLink myLink = new AjaxLink("link") {

			@Override
			public void onClick(AjaxRequestTarget aTarget) {
				anAction.setTarget(aTarget);
				if (anAction.execute(anObject)) {
					refresh(aTarget);
				}
			}
		};
		...
		add(myLink);
	}

/ we zien in de debugger	, 
this	RowActionPanel$1  (id=24225)	
	id	"link" (id=24560)	
	val$anAction	PartyListPage$2  (id=24219)	
	val$anObject	Integer  (id=24227)	
/ dus ook in Java : onClick is een closure	, komt door final Object object	, hetzelfde geldt voor fields	,


/s
PartyListPage$2.execute(Object) line: 78	
/=
		myRowActions.add(new RowAction() {

			@Override
			public boolean execute(Object aObject) {

				String returnUrl = getRequestCycle().urlFor(PartyListPage.this).toString();
				...
		myRowActions.add(new RowAction() {

			@Override
			public boolean execute(Object aObject) {
				MpoBeanFactory.getBean(PartyDAO.class).delete((Integer) aObject);
				return true;
			}

/ we moeten return true	, anders geen refresh	,

/ als we hebben click delete	,
/t
RowActionPanel$1.onClick(AjaxRequestTarget) line: 37	
/=
	public RowActionPanel(String aId, final RowAction anAction, final Object anObject, String cssClass, String aTitle) {
		super(aId);

		AjaxLink myLink = new AjaxLink("link") {

			@Override
			public void onClick(AjaxRequestTarget aTarget) {
				anAction.setTarget(aTarget);
				if (anAction.execute(anObject)) {
/ JA
/d
					refresh(aTarget);
/s
QueryViewPanel$3$1$3.refresh(AjaxRequestTarget) line: 639	
							for (final RowAction myAction : rowActionList) {
								myActions.add(new RowActionPanel(myActions.newChildId(), myAction, aCell.getModelObject(), myAction.getCssClass(), myAction.getTitle()) {
									@Override
									public boolean isEnabled() {
										return myAction.isEnabled(aRow.getModelObject());
									}

									@Override
									protected void refresh(AjaxRequestTarget aTarget) {
->										QueryViewPanel.this.setDirty();
										aTarget.addComponent(QueryViewPanel.this);
									};

/ 7	.

/ In oplossing van Paul	,

		RowAction myDelete = new RowAction() {

			@Override
			public boolean execute(Object aObject) {
				MpoBeanFactory.getBean(PartyDAO.class).delete((Integer) aObject);
				// FIXME: make this work, i18n, currently does not show
				PartyListPage.this.info("Party deleted");
				return true;
			}

			@Override
			public IModel<String> getConfirmationMessage(List<Object> aRow) {
->				String myPartyId = aRow.get(myQuery.indexOf("party.partyid")) + " / " + aRow.get(myQuery.indexOf("party.name"));
				IModel<String> deletePrompt = new StringResourceModel("rowaction.confirm.delete", null, new String[] { myPartyId }) .wrapOnAssignment(PartyListPage.this);
				return deletePrompt;
			}

			@Override
			public boolean isEnabled(List<Object> aRow) {
				return mayDelete;
			}

			@Override
			protected String getIconType() {
				return "delete";
			}
		};

		myRowActions.add(myDelete);

/ we kijken naar de confirmation message	,
[eric@localhost server]$ find geosco/conf/ -name "*.properties" | xargs grep "rowaction.confirm.delete"
geosco/conf/language_en.properties:rowaction.confirm.delete=Are you sure you want to delete {0} ?

/ als .getConfirmationMessage returns,
/t
QueryViewPanel$3$1.populateItem(ListItem<Object>) line: 646	
	private void addDataRows() {
		...
							myActions.add(myCheckPanel);

							for (final RowAction myAction : rowActionList) {

								RowActionPanel myPanel = new RowActionPanel(myActions.newChildId(), myAction, aCell.getModelObject(), myAction.getCssClass(), myAction .getTitle()) {
								...
								IModel<String> myModel = myAction.getConfirmationMessage(aRow.getModelObject());
/d
								if (myModel != null) {
									myPanel.setConfirmation(myModel);
								}
								myActions.add(myPanel);
							}

							aCell.add(myActions);






/ 7	. 

/ FIX PCT-980

/ we hebben zelf fixed	, maar Paul heeft het vannacht ook gedaan	,

/ we hadden gedaan	, 

$ vi PartyListPage.java

public class PartyListPage extends AbstractMainPage {

	protected void createPageComponents() {

		myRowActions.add(new RowAction() {

			@Override
			public boolean execute(Object aObject) {
				MpoBeanFactory.getBean(PartyDAO.class).delete((Integer) aObject);
				return true;
			}

			@Override
			public String getCssClass() {
				return "icon icon_delete small";
			}

		});




/ Einde IX PCT-980






/ Einde PCT-980

/ PAT-333

/ configuration, permission, group
PermissionGroupPage
/ we zien 
code: SHIPID
Description: make Shipment Order ID read only

/ planning, shipment order, create
/ we zien 'Create new template'	, 'Create new order'	, 
/ ze willen dat je de shipment order id van een template wel kunt edit	,

/ 7	. 

/ Als editable	,  bijvoorbeeld pnllogistics, test
<input type="text" name="shipmentOrderId" id="shipmentOrderId" size="20" maxlength="250" value="" required="required" class="fieldInput required " style="cursor: auto;">

/ als NIET editable	, bijv pnltms,  acceptance (test geeft ERR)	,
<input type="text" name="shipmentOrderId" id="shipmentOrderId" size="20" maxlength="250" value="" readonly="readonly" class="fieldInput readOnly ">
 


/ 7	. 

/ we create een sho	,

/ planning, sho, create
/ Kies Bleiswijk template	, 
/ we zien form	,
/ click Save
/ we zien de shipment order id gen	, SH000000139 


/ 7	. 

$ vi PermissionGroup.standard.hbm.xml

<hibernate-mapping package="com.mpobjects.oms.model.entity.permission">
    <class name="PermissionGroup" table="OMS_PERMISSION_GROUP">

pnltms=# select*from OMS_PERMISSION_GROUP;
 system_id |   code    |                 description                 |     entity     | member_list_expr | default_permission
_type 
-----------+-----------+---------------------------------------------+----------------+------------------+-------------------
------
  27029286 | Recurring | Recurring order read only on Service order. | SERVICE_ORDER  | recurring        | READONLY
  27030620 | recurrSho | recurring on Shipmennt order                | SHIPMENT_ORDER | recurring        | READONLY
  27305490 | SHIPID    | make Shipment Order ID read only            | SHIPMENT_ORDER | shipmentOrderId  | READONLY
(3 rows)

/ 7	. 

/ planning, shipment order, create	,
/ we  zien in HTML de 2 buttons	,

<button type="button" onclick="location.href='shipment-order-template_create?systemid=0&amp;base_sessionLevelOffset=1'">Create new template</button>
<button type="button" onclick="location.href='shipment-order_create?systemid=0&amp;base_sessionLevelOffset=1'">Create new order</button>

$ vi oms-sitemap.xmap

			<map:action logger="shipmentorder" name="shipmentOrderTemplateCreate" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderTemplateCreateAction"/>
			<map:action logger="shipmentorder" name="shipmentOrderCreate" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderCreateAction"/>

			<map:match pattern="shipment-order-template_create">
				<map:act type="shipmentOrderTemplateCreate"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order-template_edit.jsp"/>
			</map:match>

			<map:match pattern="shipment-order_create">
				<map:act type="shipmentOrderCreate"/>
				<map:select type="session-attribute">
					<map:parameter name="attribute-name" value="builder"/>
					<map:when test="jsp">
						<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order_edit.jsp"/>
					</map:when>
					<map:otherwise>
						<map:redirect-to uri="../wicket?module=oms&amp;wicketpage=shipmentorder.edit.ShipmentOrderEditSelectionPage"/>
					</map:otherwise>			
				</map:select>
			</map:match>

            <map:match pattern="shipment-order_save">
                <!-- The shipment order is saved and via redirection send to the correct page -->
				<map:act type="shipmentOrderSave">
                    <map:parameter name="isSave" value="true"/>
                </map:act>
                <!-- This part is only reached when the path selection is manual (see ShipmentOrderSave.shouldTakeControl()-->
                <map:act type="pathMatchAction"/>
                <map:act type="redirectAfterSave">
					<map:parameter name="redirectTo" value="path-template_list-for-shipment-order?refresh=true&amp;manuallyAssign={request-param:manuallyAssign}&amp;base_sessionLevelOffset=1"/>
				</map:act>
            </map:match>

$ vi shipment-order-template_edit.jsp

					<td class="label"><mpo:label name="templateName" /></td>
					<td class="input"><mpo:field name="shipmentOrderId" required="true" showFieldContext="false" /></td>

$ vi shipment-order_edit.jsp

					<mpo:field name="shipmentOrderId" readOnly="edit" size="25" />

/ we zien een label Template Nmae bij shipmentOrderId  op het template scherm	, op de sho scherm zien we Shipment Order Id	,

/ In beide	,
				<input type="button" value="<mpo:label name="save"/>" onclick="document.getElementById('selectPath').value='yes'; theShipmentorderFormManager.submit('../oms/shipment-order_save', false, 0);" />


/ Einde PAT-333

/ DEBUG PAT-333

/ 7	. 

/ we click Create template	,

/s
ShipmentOrderTemplateCreateAction.act() line: 33	
		ShipmentOrderVO myVO = MpoBeanFactory.getBean(ShipmentOrderService.class).create(myOriginal, true);
myOriginal==null

/ Intermezzo

[eric@localhost trunk]$  less ./module/oms/src/java/oms-service.sb.xml

        <bean id="com.mpobjects.oms.model.service.ShipmentOrderService" parent="transactionRequiredTemplate">
                <property name="target" ref="-com.mpobjects.oms.model.service.ShipmentOrderServiceImpl" />
        </bean>

        <bean id="-com.mpobjects.oms.model.service.ShipmentOrderServiceImpl" class="com.mpobjects.oms.model.service.ShipmentOrderServiceImpl">
                <!-- DO NOT USE THIS BEAN. This construction exists only to solve the circular dependency problem with ProxyFactoryBeans -->
                <property name="customerOrderLineDAO" ref="com.mpobjects.oms.dao.customerorderline.CustomerOrderLineDAO" />
				...
		</bean>

/ Deze komt in WEB-INF/classes	,

/ Lees	,
http://stackoverflow.com/questions/600095/splitting-applicationcontext-to-multiple-files

/ Einde Intermezzo

/s
ShipmentOrderServiceImpl.create(ShipmentOrderVO, boolean) line: 552	
		if (aShipmentOrderTemplate == null) {
			myVO = new ShipmentOrderVO();
/s
	private String theShipmentOrderId = "";
/t
ShipmentOrderServiceImpl.create(ShipmentOrderVO, boolean) line: 552	
			if (isTemplate) {
				myVO.setTemplate(isTemplate);
			myVO.setOrganization(myResource.getActiveOrganization());

		addShipmentOrderParties(myVO);
		MpoBeanFactory.getBean(EntityDetailService.class).initialize(myVO);
/s
EntityDetailServiceImpl.initialize(EntityDetailSupport) line: 126	

/ Haalt de enitty details op uit db, en sets ze in de sho	,
 
		List<EntityDetailType> myList = entityDetailTypeDAO.getByEntity(anEntityDetailSupport.getEntity());
anEntityDetailSupport.getEntity()=SHIPMENT_ORDER
[
SystemId:26948540	IsDeleted:false	Detail Type:createdVia	ValueType:STRING	, 
SystemId:150004	IsDeleted:false	Detail Type:ct001	ValueType:STRING	, 
SystemId:150008	IsDeleted:false	Detail Type:ct002	ValueType:STRING	, 
SystemId:150014	IsDeleted:false	Detail Type:ct003	ValueType:STRING	, 
SystemId:150013	IsDeleted:false	Detail Type:ct004	ValueType:STRING	, 
SystemId:150002	IsDeleted:false	Detail Type:ct005	ValueType:STRING	, 
SystemId:150028	IsDeleted:false	Detail Type:at002-maatwerk	ValueType:STRING	, 
SystemId:150015	IsDeleted:false	Detail Type:at002-portier	ValueType:STRING	, 
SystemId:150018	IsDeleted:false	Detail Type:at002-slagboom	ValueType:STRING	, 
SystemId:150023	IsDeleted:false	Detail Type:at003-100003	ValueType:STRING	, 
SystemId:27028081	IsDeleted:false	Detail Type:at001-aid001-001	ValueType:STRING	, 
SystemId:27028082	IsDeleted:false	Detail Type:at001-aid001-002	ValueType:STRING	, 
SystemId:27028083	IsDeleted:false	Detail Type:at001-aid001-005	ValueType:STRING	, 
SystemId:27028086	IsDeleted:false	Detail Type:at007-aid007-001	ValueType:STRING	, 
SystemId:150025	IsDeleted:false	Detail Type:at007-legitimatie	ValueType:STRING	, 
SystemId:150026	IsDeleted:false	Detail Type:at007-maatwerk	ValueType:STRING	, 
SystemId:150027	IsDeleted:false	Detail Type:at007-pas tonen	ValueType:STRING	, 
SystemId:150022	IsDeleted:false	Detail Type:at007-sleutel	ValueType:STRING	, 
SystemId:150012	IsDeleted:false	Detail Type:at002-pas tonen	ValueType:STRING	, 
SystemId:150005	IsDeleted:false	Detail Type:at002-aanbellen	ValueType:STRING	, 
SystemId:150016	IsDeleted:false	Detail Type:at002-etage	ValueType:STRING	, 
SystemId:150000	IsDeleted:false	Detail Type:at002-sleutel	ValueType:STRING	, 
SystemId:150019	IsDeleted:false	Detail Type:Stadslogistiek	ValueType:BOOLEAN	, 
SystemId:150009	IsDeleted:false	Detail Type:at002-sluis	ValueType:STRING	, 
SystemId:150021	IsDeleted:false	Detail Type:at002-terrein op lopend	ValueType:STRING	, 
SystemId:150006	IsDeleted:false	Detail Type:at002-terrein op rijdend	ValueType:STRING	, 
SystemId:150017	IsDeleted:false	Detail Type:at002-legitimatie	ValueType:STRING	, 
SystemId:150020	IsDeleted:false	Detail Type:at002-afleveren specifiek persoon	ValueType:STRING	, 
SystemId:150001	IsDeleted:false	Detail Type:Accept review	ValueType:BOOLEAN	]

		if (anEntityDetailSupport.getEntityDetails() != null) {
[]
			myList.removeAll(anEntityDetailSupport.getEntityDetails().keySet());
/ GEEN

		for (EntityDetailType myEntityDetailType : myList) {
			anEntityDetailSupport.setEntityDetail(myEntityDetailType, spaceAsInitialValue ? " " : "");
/ anEntityDetailSupport=shipmentOrderVO
/ Dus set de entity details in de sho	,

/t
ShipmentOrderServiceImpl.create(ShipmentOrderVO, boolean) line: 606	
		MpoBeanFactory.getBean(EntityDetailService.class).initialize(myVO);
/d
		myVO.setCreatedBy(myResource);
		myVO.setSystemEntryDate(timeService.getPresentDate());
		myVO.setOriginalSystemEntryDate(myVO.getSystemEntryDate());
		myVO.setOrderStatusVO(orderStatusDAO.getByCode(OrderStatusVO.STATUS_UNPLANNED));

		ScheduleLineService myScheduleLineService = MpoBeanFactory.getBean(ScheduleLineService.class);

		ShipmentServiceLevelVO myServiceLevel = myVO.getActualServiceLevelVO();
null
		if (myServiceLevel != null && myServiceLevel.getScheduleVO() != null) {
/ NEE
		} else {
			String myReqStartDateOffset = ApplicationPropertyManager.getInstance().getModuleProperty("oms", "view.shipmentorder.requested.start.date.after.offset");
0
			String myReqEndDateOffset = ApplicationPropertyManager.getInstance().getModuleProperty("oms", "view.shipmentorder.requested.end.date.after.offset");
1
			if (StringUtils.isNotEmpty(myReqStartDateOffset)) {
				int myOffSet = Integer.parseInt(myReqStartDateOffset);
				Calendar myCalendar = Calendar.getInstance(timeService.getTimeZone(myVO.getOrganization()));
				myCalendar.setTime(timeService.getPresentDate(myVO.getOrganization()));
				myCalendar.add(Calendar.DATE, myOffSet);
				myVO.getDateSetVO().setRequestedStartAfter(myCalendar.getTime());
				myVO.getDateSetVO().setRequestedStartBefore(myCalendar.getTime());
			}
			if (StringUtils.isNotEmpty(myReqEndDateOffset)) {
				int myOffSet = Integer.parseInt(myReqEndDateOffset);
				Calendar myCalendar = Calendar.getInstance(timeService.getTimeZone(myVO.getOrganization()));
				myCalendar.setTime(timeService.getPresentDate(myVO.getOrganization()));
				myCalendar.add(Calendar.DATE, myOffSet);
				myVO.getDateSetVO().setRequestedEndAfter(myCalendar.getTime());
				myVO.getDateSetVO().setRequestedEndBefore(myCalendar.getTime());
			}

		// Setting the order process
		if (myVO.getOrderProcess() == null) {
/ JA
			myVO.setOrderProcess(OrderProcessUtils.getDefault(myVO.getOrganization()));
OUTBOUND

		if (myVO.getSystemId() == ValueObject.VOLATILE_SYSTEM_ID) {
			String defaultIncoTerm = ApplicationPropertyManager.getInstance().getProperty("module.oms.shipmentorder.default.incoterm", "");
DAP
			if (!StringUtils.isEmpty(defaultIncoTerm)) {
				myVO.setIncoTermVO(IncoTermUtil.getIncoTermDAO().getByCode(defaultIncoTerm));
/ sets myVO.theIncoTerm=IncoTermVO
SystemId:9772224	isDeleted:false	Code:DAP	Description:Delivered at placeVersion:2000

		return myVO;

/d
FieldTag.doStartTag() line: 316	
		if (isFieldContextForm()) {
			handleOverridable();
/s
FieldTag.handleOverridable() line: 1216	
		if (isOverRideable()) {
/s
			return isOverRideable;
false
/ je kunt	, maar dat hebben we hier niet	,
<mpo:numberField name="requestedTotalValue" type="float" size="9" showFieldContext="false" overRideable="true" />

/t
FieldTag.doStartTag() line: 335	
		if (isFieldContextForm()) {
/ JA
			handleOverridable();
/ d
/ NIETS

		if (handleShowField) {
			// was:overridable
			if (isFieldContextForm()) {
				findSetFormVOTag();
/s
			setActiveValueObjectHolder((SetFormVOTag) myTag.clone());
/t
			if (isHidden()) {
/s
FieldTag.isHidden() line: 608	
		if (!isHidden && getActiveValueObject() != null) {
/ JA
			String myEntity = getActiveValueObjectHolder().getFieldOwner().getEntity();
"shipmentOrderTemplate"
getActiveValueObjectHolder()=SetFormVOTag
getActiveValueObjectHolder().getFieldOwner()=FormTag	

			HttpServletRequest request = null;
			if (getActiveValueObjectHolder().getFieldOwner() instanceof FormTag) {
				FormTag formTag = (FormTag) getActiveValueObjectHolder().getFieldOwner();
				request = formTag.getFieldUtil().getRequest();

request	JSPEngineServletRequest  (id=16043)	
/ een Cocoon class	, maar extends HttpServletRequest	, een servlet class	,
 
			if (getActiveValueObjectHolder().getFieldOwner() instanceof ListTag) {
/ NEE

			PermissionType myPermission = JspPermissionManager.get(getRequest()).checkPermission(myEntity, activeValueObjectHolder, getActiveValueObject(), request, getName());
getRequest()=JSPEngineServletRequest 	,  see hierboven	,
/s
JspPermissionManager.get(HttpServletRequest) line: 34	
		JspPermissionManager myManager = (JspPermissionManager) aRequest.getAttribute(PM);
	private static final String PM = "PERMISSION_MANAGER";
myManager	JspPermissionManager  (id=16083)	
/t
/s
FieldTag.getActiveValueObject() line: 391	
		if (theActiveValueObject != null) {
null
		} else {
			myRet = getActiveValueObjectHolder().getActiveValueObject();
getActiveValueObjectHolder()=SetFormVOTag
myRet	ShipmentOrderVO  (id=15534)	
		return myRet;
/t
FieldTag.getName() line: 477	
		return name;
"shipmentOrderId"
/t
/s
JspPermissionManager.checkPermission(String, ActiveValueObjectHolder, EntityInterface, HttpServletRequest, String) line: 56	
/=
	public PermissionType checkPermission(String anEntityName, ActiveValueObjectHolder anActiveValueObjectHolder, EntityInterface entityInterface, HttpServletRequest aRequest, String aFieldId) {

		if (aRequest != null) {
			myObject = aRequest.getAttribute("formVO");
myObject	ShipmentOrderVO  (id=15534)	

		if (myObject != null && myObject instanceof EntityInterface) {
			anEntityInterface = (EntityInterface) myObject;

		if ("shipmentOrder".equals(anEntityName)) {
/ NEE
anEntityName="shipmentOrderTemplate"
		} else if ("serviceOrder".equals(anEntityName)) {
/ NEE
		if (anActiveValueObjectHolder != null && !StringUtils.isEmptyAfterTrim(anActiveValueObjectHolder.getPrefix())
				&& !myFieldId.contains(PermissionUtil.SEPARATOR)) {
/ NEE
true && false && true
anActiveValueObjectHolder.getPrefix()=""
		return check(myEntity, anActiveValueObjectHolder, anEntityInterface, myFieldId);
/s
JspPermissionManager.check(PermissionEntityType, ActiveValueObjectHolder, EntityInterface, String) line: 115	
		StringBuilder myKeyBuilder = new StringBuilder();
		myKeyBuilder.append(anActiveValueObjectHolder == null ? 0 : anActiveValueObjectHolder.hashCode()).append("#");
		myKeyBuilder.append(anEntityInterface == null ? 0 : anEntityInterface.getSystemId()).append("#");
		myKeyBuilder.append(aFieldId == null ? "" : aFieldId);
1167353905#0#shipmentOrderId

		String myKey = myKeyBuilder.toString();
		if (cache.containsKey(myKey)) {
/ NEE
cache={1364178039#0#shipmentOrderId=READONLY}
		} else {
			PermissionEntityType myEntityType = anEntityType;
null
			if (myEntityType == null) {
				myEntityType = resolvePermissionEntityType(anEntityInterface);
/s
JspPermissionManager.resolvePermissionEntityType(EntityInterface) line: 93	
/=
	public PermissionEntityType resolvePermissionEntityType(EntityInterface anEntity) {
anEntity=shipmentOrderVO
		Class<? extends EntityInterface> myEntitiyClass = anEntity.getClass();
		if (permissionEntityMap.containsKey(myEntitiyClass)) {
/ JA
			return permissionEntityMap.get(myEntitiyClass);
PermissionEntityType SHIPMENT_ORDER

/t
JspPermissionManager.check(PermissionEntityType, ActiveValueObjectHolder, EntityInterface, String) line: 130	
 			myEntityType = resolvePermissionEntityType(anEntityInterface);
/d
PermissionEntityType SHIPMENT_ORDER
			if (myEntityType != null) {
				myType = getPermissionService().checkPermission(getPermissionGroup(myEntityType), anEntityInterface, aFieldId, getResource());
/s
 getPermissionService()=MpoBeanFactory.getBean(PermissionService.class)=PermissionServiceImpl inst	,
/t
/s
JspPermissionManager(AbstractPermissionManager).getPermissionGroup(PermissionEntityType) line: 40	
		Collection<PermissionGroup> myCollection = groupCache.get(aType);
aType=PermissionEntityType SHIPMENT_ORDER
[
com.mpobjects.oms.model.entity.permission.PermissionGroup@3f9ee14d[code=recurrSho,description=recurring on Shipmennt order,entity=SHIPMENT_ORDER,memberListExpr=recurring], 
com.mpobjects.oms.model.entity.permission.PermissionGroup@57d9a6dc[code=SHIPID,description=make Shipment Order ID read only,entity=SHIPMENT_ORDER,memberListExpr=shipmentOrderId]]
/ want	,
this	JspPermissionManager  (id=16083)	
	cache	HashMap  (id=16161)	
	groupCache	HashMap  (id=16180)	
		size	1	
		table	HashMap$Entry[16]  (id=16216)	
			[1]	HashMap$Entry  (id=16219)	
				hash	798538833	
				key	PermissionEntityType  (id=16192)	
SHIPMENT_ORDER
				value	ArrayList  (id=16221)	
					elementData	Object[10]  (id=16224)	
						[0]	PermissionGroup  (id=16226)	
							code	"recurrSho" (id=16230)	
							defaultPermissionType	PermissionType  (id=16231)	
							description	"recurring on Shipmennt order" (id=16232)	
							entity	PermissionEntityType  (id=16192)	
							memberListExpr	"recurring" (id=16233)	
							permissionRules	PersistentBag  (id=16235)	
							systemId	27030620	
						[1]	PermissionGroup  (id=16227)	
							code	"SHIPID" (id=16237)	
							defaultPermissionType	PermissionType  (id=16231)	
							description	"make Shipment Order ID read only" (id=16238)	
							entity	PermissionEntityType  (id=16192)	
							memberListExpr	"shipmentOrderId" (id=16239)	
							permissionRules	PersistentBag  (id=16241)	
							systemId	27305490	
					size	2	

		return myCollection;
/t
/s
PermissionServiceImpl.checkPermission(Collection<PermissionGroup>, EntityInterface, String, Resource) line: 55	
/=
	public PermissionType checkPermission(Collection<PermissionGroup> myList, EntityInterface anEntity, @Nonnull String aFieldId, Resource aResource) {
myList=list van 2 PermissionGroup's	,
anEntity=ShipmentOrderVO
aField=shipmentOrderId
aResource=eric

		return getPermisionForEntity(myList, anEntity, aFieldId, aResource);
/s
PermissionServiceImpl.getPermisionForEntity(Collection<PermissionGroup>, EntityInterface, String, Resource) line: 239	
		for (PermissionGroup myGroup : myList) {
			if (skipField(myGroup, aFieldId)) {
/s
	public boolean skipField(PermissionGroup aGroup, String aFieldId) {
aGroup={code:"recurrSho",...}
aFieldId	"shipmentOrderId" (id=15561)	

		} else {
			String[] myMemberList = aGroup.getMemberListExpr().split(",");
"recurring"
			for (String myField : myMemberList) {
				try {
					myMatch = aFieldId.matches(myField);
false
			return !myMatch;
/t
PermissionServiceImpl.getPermisionForEntity(Collection<PermissionGroup>, EntityInterface, String, Resource) line: 239	
		for (PermissionGroup myGroup : myList) {
			if (skipField(myGroup, aFieldId)) {
true
				continue;
/ volgende,	
		for (PermissionGroup myGroup : myList) {
			if (skipField(myGroup, aFieldId)) {
/s
PermissionServiceImpl.skipField(PermissionGroup, String) line: 157	
		} else {
			String[] myMemberList = aGroup.getMemberListExpr().split(",");
[shipmentOrderId]
			for (String myField : myMemberList) {
				try {
					myMatch = aFieldId.matches(myField);
					if (myMatch == true) {
						break;
			return !myMatch;
false
/t
PermissionServiceImpl.getPermisionForEntity(Collection<PermissionGroup>, EntityInterface, String, Resource) line: 246	
		for (PermissionGroup myGroup : myList) {
			if (skipField(myGroup, aFieldId)) {
/ NEE
				continue;
/ NIET
			myPermission = myGroup.getDefaultPermissionType();
PermissionType READONLY

/ PERMISSIONTYPE 

if (myGroup.getPermissionRules() == null) { / NEE
[]
				continue;
/ NIET
			for (PermissionRule myRule : myGroup.getPermissionRules()) {
[]
/ GEEN	,
		return myPermission;
PermissionType READONLY

/t
JspPermissionManager.check(PermissionEntityType, ActiveValueObjectHolder, EntityInterface, String) line: 132	
			if (myEntityType != null) {
				myType = getPermissionService().checkPermission(getPermissionGroup(myEntityType), anEntityInterface, aFieldId, getResource());
/d
PermissionType READONLY
			cache.put(myKey, myType);
771516261#0#shipmentOrderId
			return myType;
...
/t
FieldTag.isHidden() line: 621	
			PermissionType myPermission = JspPermissionManager.get(getRequest()).checkPermission(myEntity, activeValueObjectHolder, getActiveValueObject(), request, getName());
PermissionType READONLY

			if (myPermission != null) {
				return PermissionType.NONE == myPermission;
false

/t
FieldTag.doStartTag() line: 345	
			if (isHidden()) {
/ NEE
			} else {
				if (showFieldContext()) {
/s
FieldTag.showFieldContext() line: 1291	
		if (isFieldContextList()) {
/ NEE
/ want	,
/s
			return getFieldOwnerType().equals(FieldOwner.FIELD_CONTEXT_LIST);
false
/ want	,
getFieldOnwerType()="form"
/t
FieldTag.showFieldContext() line: 1291	
		if (isFieldContextList()) {
/ NEE
/d
		if (myRet) {
			myRet = showFieldContext && !(getParent() instanceof FieldTag);
false
/ want	,
 showFieldContext==false
///////////////////////////////////////////////////////////
/ omdat	in shipment-order-template_edit.jsp	,
		<td class="input"><mpo:field name="shipmentOrderId" required="true" showFieldContext="false" /></td>

getParent()=SetFormVOTag
getParent() instanceof FieldTag=false

/t
FieldTag.doStartTag() line: 351	
				if (showFieldContext()) {
/ NEE
				} else {
					appendInputPart(myRet);
/s
FieldTag.appendInputPart(StringBuffer) line: 938	

/ in HTML	,
<input type="text" name="shipmentOrderId" id="shipmentOrderId" size="20" maxlength="250" value="" readonly="readonly" class="fieldInput readOnly ">

		} else {
			aBuffer.append("<input type=\"text\"");
			aBuffer.append(" name=\"" + getFormFieldName() + "\"");
			aBuffer.append(" id=\"" + getFormFieldName() + "\"");
			aBuffer.append(" size=\"" + getSize() + "\"");
			aBuffer.append(" maxLength=\"" + getMaxLength() + "\"");

			if (isBindToVO()) {
/s
FieldTag.isBindToVO() line: 1243	
		return true;
/t
				aBuffer.append(" value=\"" + getDisplayValueAsString().replaceAll("\"", "") + "\"");
getDisplayValueAsString()=""

			if ("true".equals(getDisabled())) {
/ NEE
getDisabled()=""

			String myClasses = "fieldInput";

			if (isCurrentlyReadOnly()) {
/s
FieldTag.isCurrentlyReadOnly() line: 564	
		boolean myReadOnly = BooleanUtils.isTrue(getReadOnly()) || getReadOnly().equals(getMode());
/s
FieldTag.getReadOnly() line: 516	
		if (isReadOnlySet()) {
/s
FieldTag.isReadOnlySet() line: 645	
		return readOnlySet;
false
/ WH omdat er in JSP GEEN readonly attr	,
/t
FieldTag.getReadOnly() line: 521	
		if (isReadOnlySet()) {
/ NEE
		} else {
			myRet = getFieldOwner().getReadOnly();
false
/ getFieldOwner=FormTag

/t
FieldTag.isCurrentlyReadOnly() line: 564	
		boolean myReadOnly = BooleanUtils.isTrue(getReadOnly()) || getReadOnly().equals(getMode());
false	,
/ want getReadOnly()=false en getMode()="create"
/s
FieldTag.getMode() line: 461	
		return getFieldOwner().getMode();
"create"

/t
FieldTag.isCurrentlyReadOnly() line: 564	
		if (!myReadOnly) {
			String myFieldId = getName();
"shipmentOrderId"
			if (!StringUtils.isEmptyAfterTrim(getPrefix())) {
/ NEE
			if (getActiveValueObjectHolder().getFieldOwner() instanceof FormTag) {
/ JA
				FormTag formTag = (FormTag) getActiveValueObjectHolder().getFieldOwner();
				request = formTag.getFieldUtil().getRequest();
request	JSPEngineServletRequest  (id=16461)	

			String myEntity = getActiveValueObjectHolder().getFieldOwner().getEntity();
shipmentOrderTemplate
			PermissionType myPermission = JspPermissionManager.get(getRequest()).checkPermission(myEntity, getActiveValueObjectHolder(), getActiveValueObject(), request, myFieldId);
/s
JspPermissionManager.checkPermission(String, ActiveValueObjectHolder, EntityInterface, HttpServletRequest, String) line: 56	
		if (aRequest != null) {
			myObject = aRequest.getAttribute("formVO");
ShipmentOrderVO inst	,
		if (myObject != null && myObject instanceof EntityInterface) {
			anEntityInterface = (EntityInterface) myObject;

		if ("shipmentOrder".equals(anEntityName)) {
/ NEE
		} else if ("serviceOrder".equals(anEntityName)) {
/ NEE

		String myFieldId = aFieldId;
shipmentOrderId
		return check(myEntity, anActiveValueObjectHolder, anEntityInterface, myFieldId);
/s
JspPermissionManager.check(PermissionEntityType, ActiveValueObjectHolder, EntityInterface, String) line: 115	
		StringBuilder myKeyBuilder = new StringBuilder();
		myKeyBuilder.append(anActiveValueObjectHolder == null ? 0 : anActiveValueObjectHolder.hashCode()).append("#");
		myKeyBuilder.append(anEntityInterface == null ? 0 : anEntityInterface.getSystemId()).append("#");
		myKeyBuilder.append(aFieldId == null ? "" : aFieldId);
771516261#0#shipmentOrderId
		if (cache.containsKey(myKey)) {
			return cache.get(myKey);
/t
FieldTag.isCurrentlyReadOnly() line: 586	
			PermissionType myPermission = JspPermissionManager.get(getRequest()).checkPermission(myEntity, getActiveValueObjectHolder(), getActiveValueObject(), request, myFieldId);
/d
PermissionType READONLY
			if (myPermission != null) {
				return PermissionType.READONLY == myPermission;
/t
FieldTag.appendInputPart(StringBuffer) line: 957	
			if (isCurrentlyReadOnly()) {
/ JA
				myClasses += " readOnly ";
				aBuffer.append(" readonly=\"readonly\" ");

/ 7	. 

FieldTag.doStartTag() line: 341	
			if (isHidden()) {
/s
FieldTag.isHidden() line: 619	
			PermissionType myPermission = JspPermissionManager.get(getRequest()).checkPermission(myEntity, activeValueObjectHolder, getActiveValueObject(), request, getName());
/s
JspPermissionManager.checkPermission(String, ActiveValueObjectHolder, EntityInterface, HttpServletRequest, String) line: 81	
/=
	public PermissionType checkPermission(String anEntityName, ActiveValueObjectHolder anActiveValueObjectHolder, EntityInterface entityInterface, HttpServletRequest aRequest, String aFieldId) {
/ anEntityName="shipmentOrderTemplate"

		if ("shipmentOrder".equals(anEntityName)) {
			myEntity = PermissionEntityType.SHIPMENT_ORDER;
		} else if ("serviceOrder".equals(anEntityName)) {
			myEntity = PermissionEntityType.SERVICE_ORDER;
null
		String myFieldId = aFieldId;
shipmentOrderId
		return check(myEntity, anActiveValueObjectHolder, anEntityInterface, myFieldId);
/ myEntity=null
/s
JspPermissionManager.check(PermissionEntityType, ActiveValueObjectHolder, EntityInterface, String) line: 130	
/=
	private PermissionType check(PermissionEntityType anEntityType, ActiveValueObjectHolder anActiveValueObjectHolder, EntityInterface anEntityInterface, String aFieldId) {
/ anEntityType=null

		} else {
			PermissionEntityType myEntityType = anEntityType;
			if (myEntityType == null) {
				myEntityType = resolvePermissionEntityType(anEntityInterface);
PermissionEntityType SHIPMENT_ORDER
/ Dus toch	,
			if (myEntityType != null) {
				myType = getPermissionService().checkPermission(getPermissionGroup(myEntityType), anEntityInterface, aFieldId, getResource());
/s
PermissionServiceImpl.checkPermission(Collection<PermissionGroup>, EntityInterface, String, Resource) line: 55	
/=
	public PermissionType checkPermission(Collection<PermissionGroup> myList, EntityInterface anEntity, @Nonnull String aFieldId, Resource aResource) {
		return getPermisionForEntity(myList, anEntity, aFieldId, aResource);
/s
PermissionServiceImpl.getPermisionForEntity(Collection<PermissionGroup>, EntityInterface, String, Resource) line: 239	

/ FIX PAT-333

$ vi JspPermissionManager.java

	private PermissionType check(String anEntityName, PermissionEntityType anEntityType, ActiveValueObjectHolder anActiveValueObjectHolder, EntityInterface anEntityInterface, String aFieldId) {
			...
			PermissionType myType = null;
->			if ("shipmentOrderTemplate".equals(anEntityName) && "shipmentOrderId".equals(aFieldId)) {
->				myType = PermissionType.UPDATE;
			} else if (myEntityType != null) {
				myType = getPermissionService().checkPermission(getPermissionGroup(myEntityType), anEntityInterface, aFieldId, getResource());
			}
			cache.put(myKey, myType);
/ de test bij -> is nieuw	,

	public PermissionType checkPermission(String anEntityName, ActiveValueObjectHolder anActiveValueObjectHolder, EntityInterface entityInterface, HttpServletRequest aRequest, String aFieldId) {
		...
->		return check(anEntityName, myEntity, anActiveValueObjectHolder, anEntityInterface, myFieldId);
	}

/ extra 1ste arg	,

	public PermissionType checkPermissionForEntityDetail(EntityInterface anEntity, @Nonnull EntityDetailType aType) {
->		return check(null, null, null, anEntity, PermissionUtil.formatString(aType.getCode()));
	}
/ extra 1ste arg	,

	public PermissionType checkPermissionWithEntityType(PermissionEntityType anEntityType, EntityInterface anEntityInterface, String aFieldId) {
->		return check(null, anEntityType, null, anEntityInterface, aFieldId);
	}
/ extra 1ste arg	,

/ Einde FIX PAT-333

















/ 7	. 

/ we click Save	 (sho)	,
/s
ShipmentOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	
				Map myMap = act();
/s
ShipmentOrderSaveAction(AbstractSaveAction).act() line: 69	
			handleSave();
/s
ShipmentOrderSaveAction.handleSave() line: 19	
		super.handleSave();
/s
ShipmentOrderSaveAction(ShipmentOrderSaveAction).handleSave() line: 87	
			ShipmentOrderVO shipmentOrderVO = (ShipmentOrderVO) getValueObject();
/ TODO
			if (mySystemid == ValueObject.VOLATILE_SYSTEM_ID) {
				if (StringUtils.isEmpty(shipmentOrderVO.getShipmentOrderId())) {
					String myOrderId = KeyUtil.getKeyService().getShipmentOrderId();
/s
KeyGenServiceImpl.getShipmentOrderId() line: 167	
		int shipmentOrderId = generateNewKey(SHIPMENT_ORDER_ID_DISPENSER_NAME);
140
/ want	,
SHIPMENT_ORDER_ID_DISPENSER_NAME="shipmentorder"
/s
KeyGenServiceImpl.generateNewKey(String) line: 74	
...
/t
		int shipmentOrderId = generateNewKey(SHIPMENT_ORDER_ID_DISPENSER_NAME);
140
/d
		return systematicIdentificationCode(SHIPMENT_ORDER_ID_PREFIX, shipmentOrderId, SHIPMENT_ORDER_ID_WIDTH);
SH000000140
/t
ShipmentOrderSaveAction(ShipmentOrderSaveAction).handleSave() line: 88	
				if (StringUtils.isEmpty(shipmentOrderVO.getShipmentOrderId())) {
					String myOrderId = KeyUtil.getKeyService().getShipmentOrderId();
/d
					shipmentOrderVO.setShipmentOrderId(myOrderId);

/ 7	. 

/ we set b in FieldTag.doStart()	, om te zien waarom de shipment order id field readonly is	,

FieldTag.doStartTag() line: 349	
					appendInputPart(myRet);
/s
FieldTag.appendInputPart(StringBuffer) line: 957	
			if (isCurrentlyReadOnly()) {
/s
FieldTag.isCurrentlyReadOnly() line: 564	
		boolean myReadOnly = BooleanUtils.isTrue(getReadOnly()) || getReadOnly().equals(getMode());
/s
FieldTag.getReadOnly() line: 518	
		// If element explicitly set to be editable (through the "privilege"-system) then return readOnly="false"
		if (isReadOnlySet()) {
/s
			return readOnlySet;
true

/t
FieldTag.getReadOnly() line: 518	
		if (isReadOnlySet()) {
/ JA
			myRet = readOnly;
"edit"

/ Intermezzo

/ Klopt	,
$ vi shipment-order_edit.jsp
					<mpo:field name="shipmentOrderId" readOnly="edit" size="25" />

/ Einde Intermezzo

/t
FieldTag.isCurrentlyReadOnly() line: 564	
		boolean myReadOnly = BooleanUtils.isTrue(getReadOnly()) || getReadOnly().equals(getMode());
/d
BooleanUtils.isTrue(getReadOnly())==false	, want het is "edit"	,
/s
	/**
	 * @return Returns the mode. one of 'edit' or 'create'
	 */
	public String getMode() {
		return getFieldOwner().getMode();
/ FormTag's theMode="create"
/t
FieldTag.isCurrentlyReadOnly() line: 564
        boolean myReadOnly = BooleanUtils.isTrue(getReadOnly()) || getReadOnly().equals(getMode());
false
		if (!myReadOnly) {
			String myFieldId = getName();
shipmentOrderId
			HttpServletRequest request = null;
			if (getActiveValueObjectHolder().getFieldOwner() instanceof FormTag) {
/ JA
				FormTag formTag = (FormTag) getActiveValueObjectHolder().getFieldOwner();
				request = formTag.getFieldUtil().getRequest();
			}
request	JSPEngineServletRequest  (id=19017)	 
/ 'n cocoon ding	,

			String myEntity = getActiveValueObjectHolder().getFieldOwner().getEntity();
"shipmentOrder"
			PermissionType myPermission = JspPermissionManager.get(getRequest()).checkPermission(myEntity, getActiveValueObjectHolder(), getActiveValueObject(), request, myFieldId);
/s

JspPermissionManager.get(HttpServletRequest) line: 34	
		JspPermissionManager myManager = (JspPermissionManager) aRequest.getAttribute(PM);
	private static final String PM = "PERMISSION_MANAGER";
myManager	JspPermissionManager  (id=19422)	

/ MAANDAGOCHTEND







/ Einde DEBUG PAT-333

/ PAT-178

			<map:action logger="shipmentorder" name="shipmentOrderEdit" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderEditAction"/>
 p:action logger="shipmentorder" name="shipmentOrderCreate" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderCreateAction"/>
			<map:action logger="shipmentorder" name="shipmentOrderTemplateCreate" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderTemplateCreateAction"/>


			<map:match pattern="shipment-order_edit">
				<map:act type="shipmentOrderEdit">
						<map:when test="jsp">
							<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order_edit.jsp"/>


			<map:match pattern="shipment-order-template_create">
				<map:act type="shipmentOrderTemplateCreate"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order-template_edit.jsp"/>
			</map:match>

			<map:match pattern="shipment-order_create">
				<map:act type="shipmentOrderCreate"/>
					<map:when test="jsp">
						<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order_edit.jsp"/>




$ vi shipment-order_edit.jsp

/ Einde PAT-178

/ PCT-1024

/ configuration, finance, financial party
/ open een financial party uit de list	,
/ click onderin 'Create ...'
/ Welk privilege hoort er bij dit form?

/ we use pnllogistics 	, local	,

/ 13	. 

/ we hebben gezocht naar een user met R_SUPERUSER	,

pnllogistics4t2=# select u.user_id,u.user_password from tms_user u join user_role ur on u.system_id=ur.user_systemid  join tms_role r on ur.role_systemid=r.system_id where r.name='R_SUPERUSER';
...
arjan.aaras@postnl.nl          | Qwerty123&

/ we hebben gezocht naar een user met R_FINANCE	,
  user_id   | user_password 
------------+---------------
 u_finance  | pnlc

/ op test is password u_finance	,



/ Als we inlog met deze credentials	, dan zien we inderdaad, dan het formulier Bank Account Edit niet editable is	,

/13	. 

/ menu item Configuration, Finance, Financial party

$ vi deploy/tms.war/menu.xml

           <menuItem index="1500">
              <labelId>financialParty</labelId>
              <module>invoice</module>
              <parent reference="../../.."/>
              <path>configuration.finance.financialParty</path>
              <privilege>financial-party.list</privilege>
              <type>ITEM</type>
              <url>invoice/financial-party_list?refresh=true&amp;emptySession=true</url>
              <visibilityExpr></visibilityExpr>
            </menuItem>

/ 13	. 

/ menu item Configuration, Finance, Financial party

$ vi invoice-sitemap.xmap

			<map:action logger="invoice" name="financialPartyList" src="com.mpobjects.invoice.control.financialparty.action.FinancialPartyListAction"/>
			<map:match pattern="financial-party_list">
				<map:act type="financialPartyList"/>
				<map:call resource="dynatablePage" >
					<map:parameter name="xsp" value="xsp/financial-party_list.xml" />
				</map:call>
			</map:match>

/ 13	. 

/ click edit op een row	,
financial-party_edit	,

$ vi invoice-sitemap.xmap

			<map:action logger="invoice" name="financialPartyForm" src="com.mpobjects.invoice.control.financialparty.action.FinancialPartyFormAction"/>

			<map:match type="regexp" pattern="^financial-party_(edit|create)$">
				<map:act type="financialPartyForm"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/financial-party_edit.jsp"/>
			</map:match>


$ vi financial-party_edit.jsp
			...
      		<mpo:tabCollection name="financialParty" defaultTab="${active_tab}">
					<mpo:tabList>
						<mpo:defineTab name="financialPartyBankAccount" />
					</mpo:tabList>
					<mpo:tab name="financialPartyBankAccount">
						<invoicetags:financialparty-bankaccount/>
					</mpo:tab>
/ Dit is WH de tab die we zien op financial party edit	, 
/ defineTab is WH de link 'Create new Financial party bank account'	,
/ tab is de list met de bestaande financial party bank accounts	,
/ TODO

$ vi ./module/invoice/war/WEB-INF/tags/invoice/financialparty-bankaccount.tag
/ list met bestaande financial party bank accounts

$ vi mpo.tld
	<tag>
		<name>defineTab</name>
		<tagclass>com.mpobjects.view.taglib.tab.DefineTabTag</tagclass>
		<bodycontent>EMPTY</bodycontent>
		<attribute>
			<name>name</name>
			<required>true</required>
			<rtexprvalue>true</rtexprvalue>
		</attribute>
	</tag>		
	<tag>
		<name>tab</name>
		<tagclass>com.mpobjects.view.taglib.tab.TabTag</tagclass>
		<bodycontent>JSP</bodycontent>
		<attribute>
			<name>name</name>
			<required>true</required>
			<rtexprvalue>true</rtexprvalue> 
		</attribute>
	</tag>

$ vi DefineTabTag.java
...
$ vi TabTag.java
...

/ We zien dat er op de link 'Create ...' staat	,
financial-party-bank-account_create


$ vi invoice-sitemap.xmap
			<map:action logger="invoice" name="financialPartyBankAccountForm"  		src="com.mpobjects.invoice.control.financialpartybankaccount.action.FinancialPartyBankAccountFormAction"/>
			<map:match type="regexp" pattern="^financial-party-bank-account_(edit|create)$">
				<map:act type="financialPartyBankAccountForm"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/financial-party-bank-account_edit.jsp"/>
			</map:match>

$ vi financial-party-bank-account_edit.jsp
...

/ FIX PCT-1024

/ Add privilege financial-party.list to R_FINANCE	, dan ziet u_finance configuration, finance, financial party

/ Voor Bank Account Edit	, 

/ Create Business Object	,
Code: financial-party-bank-account
Description: ...

/ create Privilege
Business object: hierboven
Privilege type: create

/ Ken deze privilege to aan R_FINANCE, R_SUPERUSER.

	code	"financial-party-bank-account" (id=20841)	
	description	"create" (id=19903)	

/ Einde FIX PCT-1024



/ Einde PCT-1024

/ DEBUG PCT-1024

/ we login in pnllogistics , met user u_finance, pnlc	, (role R_FINANCE	),

/ we zijn op financial party edit form	,
/ we click op 'Create new financial bank account' link  in financial party bank account tab	,

/s
$ vi financial-party-bank-account_edit.jsp
		<mpo:form>
			<mpo:setFormVO valueObject="${formVO}">
/s
SetFormVOTag.doStartTag() line: 109	
this	SetFormVOTag  (id=19871)	
	theValueObject	FinancialPartyBankAccountVO  (id=19896)	

		if (getValueObject() == null) {
/ NEE
		getForm().addValueObject(getValueObject());
...
/s
FormTag.addValueObject(EntityInterface) line: 216	
		ValueObject aVO = (ValueObject) aEntityInterface;
aVO	FinancialPartyBankAccountVO  (id=20378)	

		if (StringUtils.isEmpty(theEntity) || !entityUpdatedByTag) {
/ JA	, 
theEntity=""
			entityUpdatedByTag = true;
			setEntity(VOReflectionInvoker.getEntityFromVO(aVO));
/s
VOReflectionInvoker.getEntityFromVO(EntityInterface) line: 188	
		Class myClassName = HibernateUtil.unwrap(aVO);
class com.mpobjects.invoice.model.financialpartybankaccount.vo.FinancialPartyBankAccountVO
		String myRet = myClassName.getSimpleName();
FinancialPartyBankAccountVO
		if (myRet.endsWith("VO")) {
			myRet = StringUtils.firstCharToLower(myRet.substring(0, myRet.length() - 2));
"financialPartyBankAccount"
		return myRet;
/t
FormTag.addValueObject(EntityInterface) line: 183	
			setEntity(VOReflectionInvoker.getEntityFromVO(aVO));
/s
FormTag.setEntity(String) line: 515	
		entityUpdatedByTag = true;
		theEntity = aEntity;
/t
FormTag.addValueObject(EntityInterface) line: 183	
/=
	public void addValueObject(EntityInterface aEntityInterface) {
aEntityInterface	FinancialPartyBankAccountVO  (id=27438)	

			setEntity(VOReflectionInvoker.getEntityFromVO(aVO));
/d
this	FormTag  (id=25328)	
	theEntity	"financialPartyBankAccount" (id=25766)	

/ de FinancialPartyBankAccountVO  inst is arg	, "financialPartyBankAccount" wordt saved in de form tag (voor het gemak misschien)	, en de   FinancialPartyBankAccountVO wordt saved in deze FormTag inst's theValueObjects	, als de resource de financial-party-bank-account:create privilege hebt	,

		if (theValueObjects.size() == 0 && !modeUpdatedByTag) {
/ JA	,
theValueObjects=[]
			if (aVO.isPersistent()) {
/ NEE
			} else {
				theMode = MODE_CREATE;

			if (!isFormReadOnly()) {
/ JA	, 
/want	,
/s
FormTag.isFormReadOnly() line: 475	
		return StringUtils.isTrue(getReadOnly()) || getMode().equals(getReadOnly());
false || false 
/want	,
/ theReadOnly=""	, de default	,
/ theMode=FieldOwner.MODE_CREATE	, de default	,
/t
FormTag.addValueObject(EntityInterface) line: 194	
			if (!isFormReadOnly()) {
/d
JA
				if (aVO instanceof OrganizationValueObjectInterface) {
/ NEE
			// another check, with authorization factory
			if (!isFormReadOnly()) {
/ JA
				String myAction = "edit";
				if (aVO.getSystemId() == 0) {
/ JA
					myAction = "create";

				if (!EntityAuthorizationFactory.getEntityAuthorization(getEntity(), myAction, aVO).hasPrivilege()) {
formTag.theEntity="financialPartyBankAccount"

/ creates van de getEntity()="financialPartyBankAccount"   en de myAction="create" de privilege financial-party-bank-account:create	, en de resource (u_finance) moet deze hebben	,

/s
EntityAuthorizationFactory.getEntityAuthorization(String, String, EntityInterface) line: 41	
					return getEntityAuthorization(anEntity, anAction, aValueObject, null);
/s
EntityAuthorizationFactory.getEntityAuthorization(String, String, EntityInterface, EntityInterface) line: 47	
/=
	public static EntityAuthorizationInterface getEntityAuthorization(String anEntity, String anAction, EntityInterface aValueObject, EntityInterface aParentValueObject) {

anEntity	"financialPartyBankAccount" (id=25766)	
anAction	"create" (id=25819)	
aValueObject	FinancialPartyBankAccountVO  (id=25478)	
aParentValueObject	null	

		if (EDIT_TYPE.equals(anAction)) {
/ NEE
anAction="create"
		EntityAuthorizationInterface myRet = (EntityAuthorizationInterface) Factory.getFactory().getInstanceByKey("authorization", StringUtils.formatFileToProperty(anEntity));
/s
Factory.getInstanceByKey(String, String) line: 149	
/=
	public Object getInstanceByKey(String aPrefix, String aKey) throws IllegalArgumentException {

aPrefix	"authorization" (id=20599)	
aKey	"financialpartybankaccount" (id=20597)	
this	Factory  (id=20546)	
	theInstance	Factory  (id=20546)	
	thePropertyFile	"com.mpobjects.core.factory.factory" (id=20589)	
	theFactoryProperties	Properties  (id=20588)	
{
 listinput.airport.implementation=com.mpobjects.oms.control.airport.AirportInputProxy,
 com.mpobjects.oms.model.xml.CustomerOrderMessageProcessor=com.mpobjects.oms.model.xml.BasicCustomerOrderMsgProcessor,
 listinput.planningreasoncode.implementation=com.mpobjects.oms.control.planningreasoncode.PlanningReasonCodeInputProxy,
 listinput.orderstatus.implementation=com.mpobjects.oms.control.OrderStatusInputProxy,
 listinput.vatpolicy.implementation=com.mpobjects.invoice.control.vatpolicy.VatPolicyInputProxy,
 uniquefielddao.default.interface=com.mpobjects.util.dao.UniqueFieldDAO,
 listinput.product.implementation=com.mpobjects.oms.control.product.ProductInputProxy,
 listinput.report.implementation=com.mpobjects.oms.control.report.ReportInputProxy,
 listinput.shipmenttype.implementation=com.mpobjects.oms.control.shipmenttype.action.ShipmentTypeInputProxy,
 authorization.default.implementation=com.mpobjects.core.entity.control.EntityAuthorization,
 listinput.incoterm.implementation=com.mpobjects.oms.control.incoterm.IncoTermInputProxy,
 authorization.consignment.implementation=com.mpobjects.oms.control.logisticsorder.LogisticsOrderAuthorization,
 listinput.partytype.implementation=com.mpobjects.oms.control.partytype.PartyTypeInputProxy,
 authorization.shipmentitem.implementation=com.mpobjects.oms.control.logisticsorder.LogisticsOrderAuthorization,
 listinput.orderprocess.implementation=com.mpobjects.oms.control.orderprocess.OrderProcessInputProxy,
 listinput.servicetype.implementation=com.mpobjects.oms.control.servicetype.ServiceTypeInputProxy,
 listinput.resource.implementation=com.mpobjects.oms.control.resource.ResourceInputProxy,
 listinput.adrcode.implementation=com.mpobjects.oms.control.adrcode.AdrCodeInputProxy,
 listinput.reasoncode.implementation=com.mpobjects.oms.control.reasoncode.ReasonCodeInputProxy,
 com.mpobjects.oms.model.serviceordercost.ServiceOrderCostVOCreator=com.mpobjects.oms.ratecalc.model.serviceordercost.RcaServiceOrderCostVOCreator,
 fileobjectparent.shipmentorder.implementation=com.mpobjects.oms.control.shipmentorder.ShipmentOrderFileParent,
 listinput.instructiongroup.implementation=com.mpobjects.oms.control.instructiongroup.InstructionGroupInputProxy,
 com.mpobjects.oms.control.serviceorder.ServiceOrderShipmentOrderCopier=com.mpobjects.oms.control.serviceorder.ServiceOrderUtil,
 fileobjectparent.serviceorder.implementation=com.mpobjects.oms.control.serviceorder.ServiceOrderFileParent,
 listinput.paymentaccount.implementation=com.mpobjects.invoice.control.paymentaccount.PaymentAccountInputProxy,
 listinput.party.implementation=com.mpobjects.oms.control.party.PartyInputProxy,
 listinput.partygroup.implementation=com.mpobjects.oms.control.partygroup.PartyGroupInputProxy,
 listinput.serviceactiontype.implementation=com.mpobjects.oms.control.serviceactiontype.ServiceActionTypeInputProxy,
 listinput.holdstatus.implementation=com.mpobjects.oms.control.holdstatus.HoldStatusInputProxy ,
 listinput.customerorderline.implementation=com.mpobjects.oms.control.customerorderline.CustomerOrderLineInputProxy,
 authorization.default.interface=com.mpobjects.core.entity.control.EntityAuthorizationInterface,
 listinput.shippingunit.implementation=com.mpobjects.oms.control.shippingunits.ShippingUnitInputProxy,
 listinput.currency.implementation=com.mpobjects.oms.control.currency.CurrencyInputProxy,
 authorization.shipmentorder.implementation=com.mpobjects.oms.control.logisticsorder.LogisticsOrderAuthorization,
 listinput.goodsstatus.implementation=com.mpobjects.oms.control.goodsstatus.GoodsStatusInputProxy,
 listinput.financialparty.implementation=com.mpobjects.invoice.control.financialparty.FinancialPartyInputProxy,
 listinput.inducercode.implementation=com.mpobjects.oms.control.inducercode.InducerCodeInputProxy,
 listinput.serviceordertype.implementation=com.mpobjects.oms.control.serviceordertype.ServiceOrderTypeInputProxy,
 fileobjectparent.default.interface=com.mpobjects.document.control.fileobject.FileObjectParent,
 listinput.default.interface=com.mpobjects.control.validation.ListInputProxy,
 listinput.shipmentservicelevel.implementation=com.mpobjects.oms.control.shipmentservicelevel.ShipmentServiceLevelInputProxy,
 listinput.serviceorder.implementation=com.mpobjects.oms.control.serviceorder.ServiceOrderInputProxy,
 listinput.calschedule.implementation=com.mpobjects.oms.control.schedule.CalScheduleInputProxy,
 com.mpobjects.oms.model.shipmentorder.service.ShipmentOrderValidationService=com.mpobjects.oms.model.shipmentorder.service.DefaultShipmentOrderValidationServiceImpl,
 listinput.organization.implementation=com.mpobjects.oms.control.organization.OrganizationInputProxy,
 listinput.schedule.implementation=com.mpobjects.oms.control.schedule.ScheduleInputProxy,
 listinput.eventaction.implementation=com.mpobjects.oms.control.eventaction.EventActionInputProxy,
 listinput.unnumber.implementation=com.mpobjects.oms.control.unnumber.UnnumberInputProxy,
 com.mpobjects.oms.model.shipmentorder.xml.AbstractShipmentOrderMsgProcessor=com.mpobjects.pnltms.model.shipmentorder.xml.PnlTmsShipmentOrderMsgProcessor,
 authorization.serviceaction.implementation=com.mpobjects.oms.control.logisticsorder.LogisticsOrderAuthorization,
 listinput.country.implementation=com.mpobjects.oms.control.country.CountryInputProxy
}
/ WH verz van files zoals	,
[eric@localhost trunk]$ vi pnllogistics/pnllogistics/factory/factory.properties 
...
[eric@localhost trunk]$ vi ./base-framework/build/generate/java/com/mpobjects/core/factory/factory.properties
...

		String myCastableSupertype = theFactoryProperties.getProperty(aPrefix + ".interface", "java.lang.Object");
/ zoekt op "authorization.interface"
/ is er niet , dus de default	,
"java.lang.Object"
		String myTargetClassStr = theFactoryProperties.getProperty(aPrefix + "." + aKey + ".implementation");
/ zoekt op "authorization.financialpartybankaccount.implementation"
null
		if (myTargetClassStr == null) {
			myTargetClassStr = theFactoryProperties.getProperty(aPrefix + ".default.implementation");
/ zoekt op "authorization.default.implementation" 
/ deze staat erbij	,
 authorization.default.implementation=com.mpobjects.core.entity.control.EntityAuthorization,

		return getInstance(myTargetClassStr, myCastableSupertype);
/s
Factory.getInstance(String, String) line: 140	
		try {
			myCastableSuperType = Class.forName(aCastableSuperType);
		return constructInstance(aClassRef, myCastableSuperType, new Object[] {});
/s
Factory.constructInstance(String, Class, Object[]) line: 52	

			myRetClass = Class.forName(aClassRef.trim());
			Object myRet = myRetClass.getConstructor(myConstructorTypes).newInstance(aConstructorParamList);
/ aConstructorParamList=[]
			return myRet;
/t
EntityAuthorizationFactory.getEntityAuthorization(String, String, EntityInterface, EntityInterface) line: 53	

		EntityAuthorizationInterface myRet = (EntityAuthorizationInterface) Factory.getFactory().getInstanceByKey("authorization", StringUtils.formatFileToProperty(anEntity));
/d
com.mpobjects.core.entity.control.EntityAuthorization@6ece9c95

		myRet.setEntity(StringUtils.formatFileToJava(anEntity));
anEntity	"financialPartyBankAccount" (id=20457)	
		myRet.setAction(anAction);
"create"
		myRet.setValueObject(aValueObject);
aValueObject	FinancialPartyBankAccountVO  (id=20378)	
		myRet.setParentValueObject(aParentValueObject);
null
		return myRet;

/t
FormTag.addValueObject(EntityInterface) line: 215	
				if (!EntityAuthorizationFactory.getEntityAuthorization(getEntity(), myAction, aVO).hasPrivilege()) {
/d
/s
EntityAuthorization.hasPrivilege() line: 48	
this	EntityAuthorization  (id=26395)	
	theAction	"create" (id=25819)	
	theEntity	"financialPartyBankAccount" (id=26454)	
	theParentValueObject	null	
	theValueObject	FinancialPartyBankAccountVO  (id=25478)	

		String myEntity = StringUtils.formatJavaToFile(getEntity()).toString();
myEntity	"financial-party-bank-account" (id=20841)	
		String myAction = getAction();
"create"
		return ResourceUtil.getResource().hasPrivilege(myEntity, myAction);
/s
ResourceUtil.getResource() line: 25	
		return AuthenticationUtils.getResource();
Resource:u_finance(systemId:26780071)
/t
/s
Resource.hasPrivilege(String, String) line: 624	
		return hasPrivilege(new PrivilegeVO(aBusinessObjectName, aPrivilegeType));
aBusinessObjectName	"financial-party-bank-account" (id=20841)	
aPrivilegeType	"create" (id=19903)	
/s
PrivilegeVO.<init>(String, String) line: 48	
		super(businessObject, privilegeType);
/s
PrivilegeVO(EnumeratedValueObject).<init>(String, String) line: 23	
		code = aCode;
		description = aDescription;
/t
PrivilegeVO.<init>(String, String) line: 48	
		super(businessObject, privilegeType);
/d
		setBusinessObject(businessObject);
financial-party-bank-account
		setPrivilegeType(privilegeType);
create
/t
/s
Resource.hasPrivilege(PrivilegeVO) line: 608	
			Collection<RoleVO> myRoleList = getRoles();
/s
				return roles;
[SystemId:26780070	Name:R_FINANCE	Description:Role for employee Finance]
/t
Resource.hasPrivilege(PrivilegeVO) line: 608	
			Collection<RoleVO> myRoleList = getRoles();
/d
			for (RoleVO myRole : myRoleList) {
				if (myRole.hasPrivilege(aPrivilegeVO)) {
/s
RoleVO.hasPrivilege(PrivilegeVO) line: 130	
/=
	public boolean hasPrivilege(PrivilegeVO aPrivilegeVO) {

PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@694105ab[financial-party-bank-account,] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@2bdb5389[create,]

			boolean myRet = false;

			if ("ADMINISTRATOR".equalsIgnoreCase(getCode())) {
/ NEE
				myRet = true;
/ NIET
			} else {
				for (PrivilegeVO myPrivilege : privileges) {
[PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@1a8d939a[report-cod-postnl,cod reports postnl] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@44d57114[list,],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@3b58eb8c[financialparty,financialparty wicket screen] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@44d57114[list,],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@3b58eb8c[financialparty,financialparty wicket screen] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@21b8d89f[enable,enable (wicket)],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@29717f54[financial-party,Financial party] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@5a5e790d[create,],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@29717f54[financial-party,Financial party] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@71df5ee[update,],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@1ad3b74[report,] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@141a3d88[view,View a record (edit /create form in readonly mode?)],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@29717f54[financial-party,Financial party] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@21b8d89f[enable,enable (wicket)],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@68df7517[serviceordertypetrigger,Service Order Type Trigger] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@690d369d[edit,edit],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@6190cb35[profile,The profile] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@690d369d[edit,edit],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@29717f54[financial-party,Financial party] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@44d57114[list,],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@29717f54[financial-party,Financial party] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@4ad052c4[render,render (wicket)],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@3b58eb8c[financialparty,financialparty wicket screen] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@4ad052c4[render,render (wicket)],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@4a3524de[customer-contract,customer-contract] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@44d57114[list,],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@72d01929[rate-agreement,Rate agreement] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@21b8d89f[enable,enable (wicket)],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@72d01929[rate-agreement,Rate agreement] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@44d57114[list,],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@565cb32e[party,] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@5a5e790d[create,],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@565cb32e[party,] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@71df5ee[update,],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@2ac4c968[shipment-order,] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@44d57114[list,],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@29717f54[financial-party,Financial party] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@690d369d[edit,edit],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@565cb32e[party,] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@44d57114[list,],
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@29717f54[financial-party,Financial party] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@47df94a8[delete,]]

					if (aPrivilegeVO.getPrivilegeType().getCode().equalsIgnoreCase(myPrivilege.getPrivilegeType().getCode())
							&& aPrivilegeVO.getBusinessObject().getCode().equalsIgnoreCase(myPrivilege.getBusinessObject().getCode())) {
/ NEE
/ want	bijvoorbeeld	,

this	RoleVO  (id=21857)	
aPrivilegeVO	PrivilegeVO  (id=21814)	
	businessObject	BusinessObject  (id=21985)	
		code	"financial-party-bank-account" (id=20841)	
		deleted	false	
		description	"" (id=18617)	
		performanceMonitorService	null	
		systemId	0	
	code	"financial-party-bank-account" (id=20841)	
	description	"create" (id=19903)	
	privilegeType	PrivilegeType  (id=21987)	
		code	"create" (id=19903)	
		deleted	false	
		description	"" (id=18617)	
		performanceMonitorService	null	
		systemId	0	

						myRet = true;
/ NIET  
						break;
/ NIET

			return myRet;
false

/t
Resource.hasPrivilege(PrivilegeVO) line: 610	
			for (RoleVO myRole : myRoleList) {
				if (myRole.hasPrivilege(aPrivilegeVO)) {
/ NEE
		return false;

/t
FormTag.addValueObject(EntityInterface) line: 216	
				if (!EntityAuthorizationFactory.getEntityAuthorization(getEntity(), myAction, aVO).hasPrivilege()) {
/ als	,
/ JA
					setReadOnly("true");
/ als	,
/ NEE
		theValueObjects.add(aVO);
/ als 	,
/ JA	
SystemId:0	FinancialPartyAccountNumber:	
/t
SetFormVOTag.doStartTag() line: 110	
		getForm().addValueObject(getValueObject());
/d







/ EInde DEBUG PCT-1024

/ PCT-1046

/ 7	. 

/ we willen zelf een role maken	,

/ we willen de privileges zien van R_FINANCE	,

pnllogistics4t2=# select bo.name, pt.name from role_privilege rp join tms_role r on rp.role_systemid=r.system_id  join privilege p on rp.privilege_systemid=p.system_id join business_object bo on p.business_object_systemid=bo.system_id join privilege_type pt on p.privilege_type_systemid=pt.system_id where r.name='R_FINANCE';
             name             |  name  
------------------------------+--------
 shipment-order               | list
 party                        | list
 party                        | update
 party                        | create
 report                       | view
 profile                      | edit
 rate-agreement               | list
 rate-agreement               | enable
 financial-party              | edit
 financial-party              | delete
 financial-party              | list
 financial-party              | create
 financial-party              | render
 financial-party              | update
 financial-party              | enable
 financialparty               | render
 financialparty               | enable
 financialparty               | list
 serviceordertypetrigger      | edit
 report-cod-postnl            | list
 customer-contract            | list
 financial-party-bank-account | create
(22 rows)

/ we maken role R_PRIVS_PTG
/ we maken een user r_privs_ptg met deze role	, passwd pnlc	,
/ en PNL CARGO active organization	,

/ 7	. 

/ we willen zien configuration, planning, party groups

$ less pnllogistics/deploy/tms.war/menu.xml

           <menuItem index="1051">
              <labelId>partyTypeGroups</labelId>
              <module>oms</module>
              <parent reference="../../.."/>
              <path>configuration.planning.partyTypeGroups</path>
              <privilege>party-type-group.list</privilege>
              <type>ITEM</type>
              <url>wicket?module=oms&amp;wicketpage=partytypegroup.PartyTypeGroupPage&amp;emptySession=true</url>
              <visibilityExpr></visibilityExpr>
            </menuItem>

            <menuItem index="1052">
              <labelId>partyGroups</labelId>
              <module>oms</module>
              <parent reference="../../.."/>
              <path>configuration.planning.partyGroups</path>
              <privilege>party-group.list</privilege>
              <type>ITEM</type>
              <url>wicket?module=oms&amp;wicketpage=partygroup.PartyGroupPage&amp;emptySession=true</url>
              <visibilityExpr></visibilityExpr>
            </menuItem>
 

/ Add privilege party-type-group.list en party-group.list toe aan R_PRIVS_PTG
/ Dan u_privs_ptg zien menu	,
configuration
planning
	parties
	party type groups
	party groups

/ 13	. 

$ vi PartyGroupPage.java

@Privilege(object = "party-group", type = "edit")
public class PartyGroupPage extends EvoEditPage<PartyGroupVO> {

/ dat betekent dat R_PRIVS_PTG de privilege party-group:edit moet hebben, 
/ en dat heeft u_privs_ptg niet	, dus hij ziet dan	
Access Denied
2016-01-06T10:58:05.838+01:00
Access is denied. If you need support, please contact the support service responsible.
User not authorized for privilege: party-group.edit
Return to the home page

/ Maar WH moet de privileg party-group:list zijn,	


/ 7	.

/  op PartyPage 	, 'Select Party Groups'	, click filter	, 
/ we zien ze allemaal 	, 
/ de buttons moeten disabled	, 

public class PartyGroupPage extends EvoEditPage<PartyGroupVO> {

/ we zien inderdaad code:description	,

/ 13	. 

EvoEditPage
		EntityActionButton<T> button = new EntityActionAjaxButton<T>("edit", new ResourceModel("edit")) {
/s
public abstract class EntityActionAjaxButton<T extends EntityInterface> extends EntityActionButton<T> {
	@Override
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new AjaxFallbackButton(aId, null) {
			@Override
			public boolean isEnabled() {
				return EntityActionAjaxButton.this.isEnabled(aModel);
			}

/s
public abstract class EntityActionButton<T extends EntityInterface> extends AbstractEntityActionButton<T> implements EntityAction<T> {
/s
public abstract class AbstractEntityActionButton<T> implements Serializable {
	/**
	 * The real button object.
	 */
	protected Button button; 	/ Wicket class 	,

	protected Button createButton(final IModel<T> aModel, String aId) {
		button = createButtonInstance(aModel, aId);

	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new Button(aId) {
			@Override
			public boolean isEnabled() {
				return AbstractEntityActionButton.this.isEnabled(aModel);
			}
			/ Dus de echte button wordt enabled als de wrapper dat is	,

	protected boolean isEnabled(IModel<T> aSelection) {
		return true;
	}

/ 13	. 

/ verkeerde poging om direct de button te disable	,
/ maar de button is er niet eens	,
/ TODO

$ vi PageGroupPage.java

	@Override
	protected Collection<EntityAction<PartyGroupVO>> getListActions() {
		Collection<EntityAction<PartyGroupVO>> actions = super.getListActions();
		for (EntityAction<PartyGroupVO> action : actions) {
			if (action instanceof EntityActionButton<?>) {
				EntityActionButton<PartyGroupVO> button = (EntityActionButton<PartyGroupVO>) action;
->				button.getButton().setEnabled(false);

			}
		}
		return actions;
	}

/ Bij -> , button.getButton()=null
/ TODO 

/ 13	.

/ we hebben zonder privilege de delete button disabled	,

$ vi EvoEditPage.java

@Privilege(object = "", type = "edit")
public abstract class EvoEditPage<T extends DescribedUniqueFieldValueObject> extends EvoListPage<T> implements EvoEditFormCallback {
	@Override
	protected Collection<EntityAction<T>> getListActions() {
		List<EntityAction<T>> actions = new ArrayList<EntityAction<T>>();
		button = new EntityActionAjaxButton<T>("delete", new ResourceModel("delete")) {
			@Override
			protected boolean isEnabled(IModel<T> aSelection) {
				return EvoEditPage.this.mayDeleteObject(aSelection.getObject());
			}
		actions.add(button);
		return actions;
	}
	protected boolean mayDeleteObject(T aObject) {
		return true;
	}

$ vi PartyGroupPage.java

@Privilege(object = "party-group", type = "edit")
public class PartyGroupPage extends EvoEditPage<PartyGroupVO> {
	@Override
	protected boolean mayDeleteObject(PartyGroupVO aObject) {
		return false;
	}

/ Let op de over write	,
/ omdat EvoEditPage<T> 	, is
	protected boolean mayDeleteObject(T aObject) {
/ en omdat PartyGroupPage EvoEditPage<PartyGroupVO> is	, is
    protected boolean mayDeleteObject(PartyGroupVO aObject) {

/ als we R_PRIVS_PTG NIET de role party-group:edit geven	, en op PartyGroupPage @Privilege(object = "party-group", type = "list") set	, dan zijn alle buttons disabled	,
/ TODO
/ WH omdat ook EvoEditPage @Privilege(object = "", type = "edit") doet	,
/ TODO

/ 7.	

/ b's,

LanguageManagerStringResourceLoader [line: 31] - loadStringResource(Class<?>, String, Locale, String)	
LanguageManagerStringResourceLoader [line: 50] - loadStringResource(Component, String)	
WicketLanguageManager [line: 22] - getTranslation(String, Locale, String, boolean)	
WicketLanguageManager [line: 26] - getTranslation(String, String, Locale, String, boolean)	

/ 7	. 

/ bij debug	, als we een var value willen veranderen, ga naar Expressions, en vul LINKS in 
this.editPage=null
/ en haal hem weer weg	,

/ 7	.

/ we moeten PartyGroupPage net als PartyListPage style	,

/ we maken een privilege	party-group:delete	,


/ 7	.

/ we maken een nieuwe page, (let op List in de name),	

$ vi PartyGroupListPage.java

package com.mpobjects.oms.view.wicket.partygroup;

import com.mpobjects.view.wicket.pages.AbstractMainPage;
import com.mpobjects.view.wicket.util.Privilege;

@Privilege(object = "party-group", type = "list")
public class PartyGroupPage extends AbstractMainPage {
	@Override
	protected void createPageComponents() {
		// TODO Auto-generated method stub

	}
}

$ vi oms-menu.xml
	<m:add path="configuration.planning.partyGroupsList" privilege="party-group.list" actionUrl="wicket?module=oms&amp;wicketpage=partygroup.PartyGroupListPage" index="1052" />


/ OK
/ we zien 
Party Group

$ vi PartyGroupListPage.java

package com.mpobjects.oms.view.wicket.partygroup;

import org.apache.wicket.markup.html.form.Button;
import org.apache.wicket.markup.html.form.Form;
import org.apache.wicket.protocol.http.RequestUtils;

import com.mpobjects.oms.model.partygroup.vo.PartyGroupVO;
import com.mpobjects.view.taglib.form.FormTag;
import com.mpobjects.view.wicket.pages.AbstractMainPage;
import com.mpobjects.view.wicket.util.Privilege;

@Privilege(object = "party-group", type = "list")
public class PartyGroupPage extends AbstractMainPage {

	private boolean mayEdit = false;
	private boolean myDelete = false;

	protected void createFormButton() {
		Form<PartyGroupVO>form=new Form<PartyGroupVO>("createForm");
		add(form);
		Button button=new Button("creaeButton"){
			@Override 
			public void onSubmit() {
				String returnUrl=getRequestCycle().urlFor(PartyGroupPage.this).toString();
				returnUrl=RequestUtils.toAbsolutePath(returnUrl);
				
			}
		}
		
	}

	@Override
	protected void createPageComponents() {
		// TODO Auto-generated method stub

	}
}

/ 7	.

/ In PartyListPage.java

		myQuery.getColumns().add(new QueryColumn<String>("party.partytype.code", "p.partyType.code"));
		myQuery.getColumns().add(new QueryColumn<String>("party.organizationVO.code", "p.organizationVO.code"));
...

/ de rechter zijn de 'echte'	, de properties	. links zijn  de keys in de PartyListPage.properties file	, of de language file	,

/ we moeten de property name , of de name in de hbm file	,
/ In PartyVO is de method getPartyType()	, dus de property heet partyType	, we kunnen niet een kleine t use	, 

/ 7	.

/ we geven confirmation, planning, parties

/ confirmation message	,

/s
QueryViewPanel$3$1.populateItem(ListItem<Object>) line: 665	

	private void addDataRows() {
		dataView = new ListView<List<Object>>("rows", new PropertyModel<List<List<Object>>>(QueryViewPanel.this, "rowsOnPage")) {
			@Override
			protected void populateItem(final ListItem<List<Object>> aRow) {
				final ListView<Object> myRow = new ListView<Object>("cell", aRow.getModel()) {
					@Override
					protected void populateItem(final ListItem<Object> aCell) {
							for (final RowAction myAction : rowActionList) {

								RowActionPanel myPanel = new RowActionPanel(myActions.newChildId(), myAction, aCell.getModelObject(), myAction.getCssClass(), myAction .getTitle()) {
									...
								};

								IModel<String> myModel = myAction.getConfirmationMessage(aRow.getModelObject());
/s

/ In PartyListPage.java

			public IModel<String> getConfirmationMessage(List<Object> aRow) {
aRow=[26869774, ADRES, PNL-CARGO, 00133---IT, UNIVERS TOR VERGATA,  ., VIA DELLA RICERCA SCIENTIFICA 1, , 00133, ROMA, RM, IT, , , , ]
				String myPartyId = aRow.get(myQuery.indexOf("party.partyid")) + " / " + aRow.get(myQuery.indexOf("party.name"));
00133---IT / UNIVERS TOR VERGATA

				IModel<String> deletePrompt = new StringResourceModel("rowaction.confirm.delete", null, new String[] { myPartyId }) .wrapOnAssignment(PartyListPage.this);

$ vi language_en.properties
rowaction.confirm.delete=Are you sure you want to delete {0} ?

/t
QueryViewPanel$3$1.populateItem(ListItem<Object>) line: 665	
								IModel<String> myModel = myAction.getConfirmationMessage(aRow.getModelObject());
/d
/ TODO
								if (myModel != null) {
									myPanel.setConfirmation(myModel);
/s
QueryViewPanel$3$1$3(RowActionPanel).setConfirmation(IModel<String>) line: 56	
		link.add(new ActionConfirmationBehavior(aConfirmationMessage));
/ TODO
/ model van de behavior	, 


/ 7	. 

/ we click edit	(op een row)	,

RowActionPanel$1.onClick(AjaxRequestTarget) line: 41	
	public RowActionPanel(String aId, final RowAction anAction, final Object anObject, String cssClass, String aTitle) {
		super(aId);

		link = new AjaxLink("link") {

			@Override
			public void onClick(AjaxRequestTarget aTarget) {
				anAction.setTarget(aTarget);
				if (anAction.execute(anObject)) {
/s
$ vi PartyListPage.java
		myRowActions.add(new RowAction() {
			@Override
			public boolean execute(Object aObject) {
aObject=26869774
/ closure	, 


/ 7	. 

/ we moeten in PartyGroupListPage.class 
	@Override
	protected EvoEditFormPage<PartyGroupVO> getEditPage() {
		if (editPage == null) {
			editPage = new PartyGroupEditFormPage(this, daoWrapper, dataProperties);

/ Hoe gaat het met dataProperties in PartyGroupPage.class	?

/s
	public PartyGroupPage() {
		super();
/s
	public EvoEditPage() {
		super();
/s
	public EvoListPage() {
		super();
->		daoWrapper = getBeanWrapper();
->		setDataProperties();
		createPage();
	}
/s
		super.setDataProperties();
/s
PartyGroupPage(EvoListPage).setDataProperties() line: 126	
		dataProperties = new EvoDataProperties();
		dataProperties.setEntityNameModel(wrap(new ResourceModel("entityName")));

/ we moeten in de PartyGroupListPage de property "entityName" opnemen	,
/t
PartyGroupPage.setDataProperties() line: 71	
		super.setDataProperties();
/d
		dataProperties.setCancelConfirm(true);
		PartyGroupDataProperties.setDefaults(dataProperties);
/s
PartyGroupDataProperties.setDefaults(EvoDataProperties) line: 22	
		dataProperties.setCodeMaxLength(50);
		dataProperties.setCodeFieldSize(-1);
		dataProperties.setCodeFilterSize(10);
		dataProperties.setDescriptionMaxLength(255);
		dataProperties.setDescriptionRequired(false);

/ Dat is het	,


/ FIX-1046

$ vi PartyGroupListPage.java

package com.mpobjects.oms.view.wicket.partygroup;
...

@Privilege(object = "party-group", type = "list")
public class PartyGroupListPage extends AbstractMainPage implements EvoEditFormCallback {

	private boolean mayDelete = true;
	private boolean mayEdit = true;

	// tmp

	private BeanWrapper<? extends EnumeratedValueObjectDAOInterface<PartyGroupVO>> daoWrapper;
	private EvoDataProperties dataProperties;
	private EvoEditFormPage<PartyGroupVO> editPage;

	public PartyGroupListPage() {
		super();

		daoWrapper = new BeanWrapper<PartyGroupDAO>(PartyGroupDAO.class);

		dataProperties = new EvoDataProperties();
		dataProperties.setEntityNameModel(wrap(new ResourceModel("entityName")));
		dataProperties.setCancelConfirm(true);
		// PartyGroupDataProperties.setDefaults(dataProperties);
		dataProperties.setCodeMaxLength(50);
		dataProperties.setCodeFieldSize(-1);
		dataProperties.setCodeFilterSize(10);
		dataProperties.setDescriptionMaxLength(255);
		dataProperties.setDescriptionRequired(false);

	}

	@Override
	public void onEditFormCallback(boolean aCancelled, AjaxRequestTarget aTarget, IModel<String> aMessage) {
		// callback from the edit page
		if (aMessage != null) {
			getSession().info(aMessage.getObject());
		}
		// if (aTarget != null && editWindow.isShown()) {
		// editWindow.close(aTarget);
		// } else {
		setResponsePage(this);
		// }
	}

	private EvoEditFormPage<PartyGroupVO> getEditPage() {
		if (editPage == null) {
			editPage = new PartyGroupEditFormPage(this, daoWrapper, dataProperties);
		}
		return editPage;
	}

	public String getEntityName() {
		return dataProperties.getEntityNameModel().getObject();
	}

	// End tmp

	protected void createFormButton() {
		Form<PartyGroupVO> form = new Form<PartyGroupVO>("createForm");
		add(form);
		final IModel<String> createPageTitle = new StringResourceModel("createEntity", PartyGroupListPage.this, new Model<PartyGroupListPage>(
				PartyGroupListPage.this), "Create ${entityName}");

		AjaxFallbackButton ajaxFallbackButton = new AjaxFallbackButton("createButton", form) {

			@Override
			protected void onSubmit(AjaxRequestTarget target, Form<?> form) {
				EvoEditFormPage<PartyGroupVO> page = getEditPage();
				page.setPageTitle(createPageTitle.getObject());
				page.setEditRecord(daoWrapper.getBean().createNewObject());
				setResponsePage(page);

			}
		};
		form.add(ajaxFallbackButton);
	}

	@Override
	protected void createPageComponents() {
		mayEdit = AuthenticationUtils.getResource().hasPrivilege("party-group", "edit");
		mayDelete = AuthenticationUtils.getResource().hasPrivilege("party-grou", "delete");

		final QueryDefinition queryDefinition = new QueryDefinition("party-group");
		queryDefinition.setFromClause("from PartyGroupVO as pg");
		queryDefinition.setWhereClause("pg.deleted=0");
		queryDefinition.setOrganizationClause("pg.organization");

		List<QueryColumn<?>> columns = queryDefinition.getColumns();
		columns.add(new IdQueryColumn("pg.systemId", "pg.systemId"));
		columns.add(new QueryColumn<String>("pg.code", "pg.code"));
		columns.add(new QueryColumn<String>("pg.description", "pg.description"));
		columns.add(new QueryColumn<String>("pg.organization.code", "pg.organization.code"));

		queryDefinition.addSort("pg.code");

		List<RowAction> rowActions = new ArrayList<RowAction>();
		List<GroupAction> groupActions = Collections.emptyList();
		RowAction editAction = new RowAction() {

			@Override
			public boolean execute(Object aObject) {
				final IModel<String> editPageTitle = new StringResourceModel("editEntity", PartyGroupListPage.this, new Model<PartyGroupListPage>(PartyGroupListPage.this), "Update ${entityName}");
				EvoEditFormPage<PartyGroupVO> page = getEditPage();
				page.setPageTitle(editPageTitle.getObject());
				page.setEditRecord(daoWrapper.getBean().getBySystemId((Integer) aObject));
				setResponsePage(page);
				return false;
			}

			@Override
			public boolean isEnabled(List<Object> aRow) {
				return mayEdit;
			}

			@Override
			protected String getIconType() {
				return "edit";
			}
		};
		RowAction deleteAction = new RowAction() {

			@Override
			public boolean execute(Object aObject) {
				PartyGroupDAO dao = MpoBeanFactory.getBean(PartyGroupDAO.class);
				dao.delete((Integer) aObject);
				// FIXME: make this work, i18n, currently does not show
				PartyGroupListPage.this.info("Party group deleted");
				return true;
			}

			@Override
			public IModel<String> getConfirmationMessage(List<Object> aRow) {
				String partyGroup = aRow.get(queryDefinition.indexOf("pg.code")) + " / " + aRow.get(queryDefinition.indexOf("pg.description"));
				IModel<String> deletePrompt = new StringResourceModel("rowaction.confirm.delete", null, new String[] { "pg.code" })
						.wrapOnAssignment(PartyGroupListPage.this);
				return deletePrompt;
			}

			@Override
			public boolean isEnabled(List<Object> aRow) {
				return mayDelete;
			}

			@Override
			protected String getIconType() {
				return "delete";
			}
		};
		rowActions.add(editAction);
		rowActions.add(deleteAction);
		Panel panel = new QueryViewPanel("query", Model.<QueryDefinition> of(queryDefinition), rowActions, groupActions);
		add(panel);
		createFormButton();

	}
}

/ 7	.


/ Geef role R_PRIVS_PTG de priv party-group:edit, maar NIET partyp-group:delete




/ Einde FIX-1046









/ Einde PCT-1046

/ PCT-1046

/ Hoe zit het nu	?

/ 13	. 

public class PartyGroupPage extends EvoEditPage<PartyGroupVO> {

public abstract class EvoEditPage<T extends DescribedUniqueFieldValueObject> extends EvoListPage<T> implements EvoEditFormCallback {

$ vi EvoEditPage.html

<wicket:panel>
	<wicket:extend>
		<form wicket:id="createForm">
				<button wicket:id="createButton" class="icon icon_new" wicket:message="title:create">
					<span><wicket:message key="create">Create new</wicket:message></span>
				</button>
		</form>
		<div wicket:id="editWindow"></div>
		<wicket:child />											 / is er niet nu	,	

	</wicket:extend>
</wicket:panel>

public abstract class EvoListPage<T extends DescribedUniqueFieldValueObject> extends BaseContextPage {

$ vi EvoListPage.html

	<wicket:panel>
		<wicket:extend>
			<div wicket:id="feedback"></div>
			<div wicket:id="evoSearchList"></div>

			<wicket:child />

		</wicket:extend>
	</wicket:panel>

/ evoSearchList wordt created in EvoListPage.class, en staat daarom in EvoListPage.html	, maar evoSearchList wordt overwrite in PartyGroupPage.class	, 

/ 13	. 

/ See	,
public class PartyGroupPage extends EvoEditPage<PartyGroupVO> {
	protected void createListPanel() {
		searchListPanel = new EvoSearchListPanel<PartyGroupVO>("evoSearchList", null, webComponentEventSwitchBoard, daoWrapper, getListActions()) {



public class EvoSearchListPanel<T extends DescribedUniqueFieldValueObject> extends GenericListPanel<T> {

abstract public class GenericListPanel<T extends EntityInterface> extends BaseWebComponent {

$ vi GenericListPanel.html

<wicket:extend>
  <div wicket:id="status" class="status">[[status messages]]</div>
  <form class="genericListPanelForm" wicket:id="filterForm" name="genericListPanelForm" id="genericListPanelForm">
	<wicket:enclosure>
		<h2><div wicket:id="tableTitle" /></h2>
	</wicket:enclosure>
	<p><input type="hidden" name="tracker" wicket:id="focus-tracker" /></p>
	<span wicket:id="group">
		<input type="checkbox" wicket:id="groupselector">Check/Uncheck all (displayed)</input>
		<table wicket:id="objectTable" class="grid wicketPagination"></table>
	</span>

	<wicket:child />

	<div class="groupaction">
		<span wicket:id="groupactions"></span>
		<wicket:child />
	</div> 
	<span wicket:id="focus-restore">[call to focus restore script]</span>
  </form>
</wicket:extend>

/ 13	. 

/ edit page	,

/ 2 soorten buttons trigger deze	, de create button 	, en de edit buttons op iedere row	,

$ vi EvoEditPage.class

	protected void createCreateButton() {
		// A simple form for the create button
		Form<T> createForm = new Form<T>("createForm");
		add(createForm);
		final IModel<String> createPageTitle = new StringResourceModel("createEntity", EvoEditPage.this, new Model<EvoEditPage<T>>(EvoEditPage.this), "Create ${entityName}");
		createButton = new AjaxFallbackButton("createButton", createForm) {
			@Override
			protected void onSubmit(AjaxRequestTarget aTarget, Form<?> aForm) {
->				EvoEditFormPage<T> page = getEditPage();

/ en	,

	@Override
	protected Collection<EntityAction<T>> getListActions() {
		List<EntityAction<T>> actions = new ArrayList<EntityAction<T>>();

		// Edit the selected entity
		final IModel<String> editPageTitle = new StringResourceModel("editEntity", EvoEditPage.this, new Model<EvoEditPage<T>>(EvoEditPage.this), "Update ${entityName}");
		EntityActionButton<T> button = new EntityActionAjaxButton<T>("edit", new ResourceModel("edit")) {
			@Override
			protected void onSubmit(Button aButton, AjaxRequestTarget aTarget, IModel<T> aSelection) {
->				EvoEditFormPage<T> page = getEditPage();








/ Einde PCT-1046

/ DEBUG PCT-1046

/ Wat zijn de privs van de buttons op de PartyGroupEditFormPage	?

/ 	7. 

/ delete button	,

/s
	PartyGroupListPage$3.isEnabled(List<Object>) line: 171	
				return mayDelete;

/ Dus een RowAction is enabled	, 

	QueryViewPanel$3$1$3.isEnabled() line: 655	
							for (final RowAction myAction : rowActionList) {
								RowActionPanel myPanel = new RowActionPanel(myActions.newChildId(), myAction, aCell.getModelObject(), myAction.getCssClass(), myAction .getTitle()) {
									@Override
									public boolean isEnabled() {
										return myAction.isEnabled(aRow.getModelObject());

/ Dus QueryViewPanel$3$1$3 is een RowActionPanel	, en deze is enabled	,

	QueryViewPanel$3$1$3(Component).isEnabledInHierarchy() line: 4776	
			else
			{
				state = isEnabled() && isEnableAllowed();

	RowActionPanel$1(Component).isEnabledInHierarchy() line: 4770	
this=new AjaxLink("link")
			if (parent != null && !parent.isEnabledInHierarchy())
/ NEE, als de RowAction "delete"	,
			{
				state = false;
			}
			else
			{
				state = isEnabled() && isEnableAllowed();


	RowActionPanel$1(AbstractLink).isLinkEnabled() line: 144	
	RowActionPanel$1(AjaxLink).onComponentTag(ComponentTag) line: 94	
	RowActionPanel$1(Component).renderComponent(MarkupStream) line: 2696	
	RowActionPanel$1(MarkupContainer).onRender(MarkupStream) line: 1559	
	RowActionPanel$1(Component).render(MarkupStream) line: 2525	
	QueryViewPanel$3$1$3(MarkupContainer).renderNext(MarkupStream) line: 1461	
	QueryViewPanel$3$1$3(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	QueryViewPanel$3$1$3(MarkupContainer).renderAssociatedMarkup(String, String) line: 717	
	QueryViewPanel$3$1$3(Panel).onComponentTagBody(MarkupStream, ComponentTag) line: 114	
	QueryViewPanel$3$1$3(Component).renderComponent(MarkupStream) line: 2725	
	QueryViewPanel$3$1$3(MarkupContainer).onRender(MarkupStream) line: 1559	
	QueryViewPanel$3$1$3(Component).render(MarkupStream) line: 2525	
	RepeatingView(AbstractRepeater).renderChild(Component) line: 122	
	RepeatingView(AbstractRepeater).onRender(MarkupStream) line: 103	
	RepeatingView(Component).render(MarkupStream) line: 2525	
	ListItem(MarkupContainer).renderNext(MarkupStream) line: 1461	
	ListItem(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	ListItem(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	ListItem(Component).renderComponent(MarkupStream) line: 2725	
	ListItem(MarkupContainer).onRender(MarkupStream) line: 1559	
	ListItem(Component).render(MarkupStream) line: 2525	
	QueryViewPanel$3$1(ListView).renderItem(ListItem<?>) line: 624	
	QueryViewPanel$3$1(ListView).renderChild(Component) line: 612	
	QueryViewPanel$3$1(AbstractRepeater).onRender(MarkupStream) line: 103	
	QueryViewPanel$3$1(Component).render(MarkupStream) line: 2525	
	ListItem(MarkupContainer).renderNext(MarkupStream) line: 1461	
	ListItem(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	ListItem(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	ListItem(Component).renderComponent(MarkupStream) line: 2725	
	ListItem(MarkupContainer).onRender(MarkupStream) line: 1559	
	ListItem(Component).render(MarkupStream) line: 2525	
	QueryViewPanel$3(ListView).renderItem(ListItem<?>) line: 624	
	QueryViewPanel$3(ListView).renderChild(Component) line: 612	
	QueryViewPanel$3(AbstractRepeater).onRender(MarkupStream) line: 103	
	QueryViewPanel$3(Component).render(MarkupStream) line: 2525	
	QueryViewPanel(MarkupContainer).renderNext(MarkupStream) line: 1461	
	QueryViewPanel(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	QueryViewPanel(MarkupContainer).renderAssociatedMarkup(String, String) line: 717	
	QueryViewPanel(Panel).onComponentTagBody(MarkupStream, ComponentTag) line: 114	
	QueryViewPanel(Component).renderComponent(MarkupStream) line: 2725	
	QueryViewPanel(MarkupContainer).onRender(MarkupStream) line: 1559	
	QueryViewPanel(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1461	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 66	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1465	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 73	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1465	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 66	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1465	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 73	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1465	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 66	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1465	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	BasePage$2(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 73	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	BasePage$2(MarkupContainer).renderNext(MarkupStream) line: 1465	
	BasePage$2(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	BasePage$2(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	BasePage$2(Component).renderComponent(MarkupStream) line: 2725	
	BasePage$2(MarkupContainer).onRender(MarkupStream) line: 1559	
	BasePage$2(Component).render(MarkupStream) line: 2525	
	BasePage$3(MarkupContainer).renderNext(MarkupStream) line: 1461	
	BasePage$3(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	BasePage$3(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	BasePage$3(Component).renderComponent(MarkupStream) line: 2725	
	BasePage$3(MarkupContainer).onRender(MarkupStream) line: 1559	
	BasePage$3(Component).render(MarkupStream) line: 2525	
	PartyGroupListPage(MarkupContainer).renderNext(MarkupStream) line: 1461	
	PartyGroupListPage(MarkupContainer).renderAll(MarkupStream) line: 1575	
	PartyGroupListPage(Page).onRender(MarkupStream) line: 1599	
	PartyGroupListPage(Component).render(MarkupStream) line: 2525	
	PartyGroupListPage(Page).renderPage() line: 933	
	MpoWebRequestCycle(WebRequestCycle).redirectTo(Page) line: 201	
	PageRequestTarget.respond(RequestCycle) line: 58	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/ 7	. 

/ edit button	,

Daemon Thread [http-0.0.0.0-8080-2] (Suspended (breakpoint at line 142 in PartyGroupListPage$2))	
	PartyGroupListPage$2.isEnabled(List<Object>) line: 142	
				return mayEdit;
/ of	,
				return true; 

	QueryViewPanel$3$1$3.isEnabled() line: 655	
							for (final RowAction myAction : rowActionList) {
								RowActionPanel myPanel = new RowActionPanel(myActions.newChildId(), myAction, aCell.getModelObject(), myAction.getCssClass(), myAction .getTitle()) {
									@Override
									public boolean isEnabled() {
->										return myAction.isEnabled(aRow.getModelObject());

	QueryViewPanel$3$1$3(Component).isEnabledInHierarchy() line: 4776	
this=QueryViewPanel$3$1$3=RowActionPanel	,
parent=RepeatingView	,
			if (parent != null && !parent.isEnabledInHierarchy())
/ NEE
			else
/ JA
			{
				state = isEnabled() && isEnableAllowed();
/ (*)

	RowActionPanel$1(Component).isEnabledInHierarchy() line: 4770	
this=RowActionPanel$1="link"
parent=QueryViewPanel$3$1$3=RowActionPanel	,
			if (parent != null && !parent.isEnabledInHierarchy())

	RowActionPanel$1(AbstractLink).isLinkEnabled() line: 144	
this=RowActionPanel$1="link"
		return isEnabledInHierarchy();

	RowActionPanel$1(AjaxLink).onComponentTag(ComponentTag) line: 94	
		if (isLinkEnabled())

	RowActionPanel$1(Component).renderComponent(MarkupStream) line: 2696	
		// Call any tag handler
		onComponentTag(tag);

	RowActionPanel$1(MarkupContainer).onRender(MarkupStream) line: 1559	
	RowActionPanel$1(Component).render(MarkupStream) line: 2525	
	QueryViewPanel$3$1$3(MarkupContainer).renderNext(MarkupStream) line: 1461	
	QueryViewPanel$3$1$3(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	QueryViewPanel$3$1$3(MarkupContainer).renderAssociatedMarkup(String, String) line: 717	
	QueryViewPanel$3$1$3(Panel).onComponentTagBody(MarkupStream, ComponentTag) line: 114	
	QueryViewPanel$3$1$3(Component).renderComponent(MarkupStream) line: 2725	
	QueryViewPanel$3$1$3(MarkupContainer).onRender(MarkupStream) line: 1559	
	QueryViewPanel$3$1$3(Component).render(MarkupStream) line: 2525	
	RepeatingView(AbstractRepeater).renderChild(Component) line: 122	
	RepeatingView(AbstractRepeater).onRender(MarkupStream) line: 103	
	RepeatingView(Component).render(MarkupStream) line: 2525	
	ListItem(MarkupContainer).renderNext(MarkupStream) line: 1461	
	ListItem(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	ListItem(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	ListItem(Component).renderComponent(MarkupStream) line: 2725	
	ListItem(MarkupContainer).onRender(MarkupStream) line: 1559	
	ListItem(Component).render(MarkupStream) line: 2525	
	QueryViewPanel$3$1(ListView).renderItem(ListItem<?>) line: 624	
	QueryViewPanel$3$1(ListView).renderChild(Component) line: 612	
	QueryViewPanel$3$1(AbstractRepeater).onRender(MarkupStream) line: 103	
	QueryViewPanel$3$1(Component).render(MarkupStream) line: 2525	
	ListItem(MarkupContainer).renderNext(MarkupStream) line: 1461	
	ListItem(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	ListItem(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	ListItem(Component).renderComponent(MarkupStream) line: 2725	
	ListItem(MarkupContainer).onRender(MarkupStream) line: 1559	
	ListItem(Component).render(MarkupStream) line: 2525	
	QueryViewPanel$3(ListView).renderItem(ListItem<?>) line: 624	
	QueryViewPanel$3(ListView).renderChild(Component) line: 612	
	QueryViewPanel$3(AbstractRepeater).onRender(MarkupStream) line: 103	
	QueryViewPanel$3(Component).render(MarkupStream) line: 2525	
	QueryViewPanel(MarkupContainer).renderNext(MarkupStream) line: 1461	
	QueryViewPanel(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	QueryViewPanel(MarkupContainer).renderAssociatedMarkup(String, String) line: 717	
	QueryViewPanel(Panel).onComponentTagBody(MarkupStream, ComponentTag) line: 114	
	QueryViewPanel(Component).renderComponent(MarkupStream) line: 2725	
	QueryViewPanel(MarkupContainer).onRender(MarkupStream) line: 1559	
	QueryViewPanel(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1461	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 66	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1465	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 73	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1465	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 66	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1465	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 73	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1465	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 66	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1465	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	BasePage$2(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 73	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	BasePage$2(MarkupContainer).renderNext(MarkupStream) line: 1465	
	BasePage$2(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	BasePage$2(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	BasePage$2(Component).renderComponent(MarkupStream) line: 2725	
	BasePage$2(MarkupContainer).onRender(MarkupStream) line: 1559	
	BasePage$2(Component).render(MarkupStream) line: 2525	
	BasePage$3(MarkupContainer).renderNext(MarkupStream) line: 1461	
	BasePage$3(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	BasePage$3(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	BasePage$3(Component).renderComponent(MarkupStream) line: 2725	
	BasePage$3(MarkupContainer).onRender(MarkupStream) line: 1559	
	BasePage$3(Component).render(MarkupStream) line: 2525	
	PartyGroupListPage(MarkupContainer).renderNext(MarkupStream) line: 1461	
	PartyGroupListPage(MarkupContainer).renderAll(MarkupStream) line: 1575	
	PartyGroupListPage(Page).onRender(MarkupStream) line: 1599	
	PartyGroupListPage(Component).render(MarkupStream) line: 2525	
	PartyGroupListPage(Page).renderPage() line: 933	
	MpoWebRequestCycle(WebRequestCycle).redirectTo(Page) line: 201	
	PageRequestTarget.respond(RequestCycle) line: 58	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/ we debug verder bij (*)	,
/s
QueryViewPanel$3$1$3(Component).isEnabledInHierarchy() line: 4776	
this=RowActionPanel	,
parent=RepeatingView	,
			{
				state = isEnabled() && isEnableAllowed();
/pd
state=true
/s
QueryViewPanel$3$1$3(Component).isEnableAllowed() line: 2124	
		return isActionAuthorized(ENABLE);
/s
QueryViewPanel$3$1$3(Component).isActionAuthorized(Action) line: 2097	

		IAuthorizationStrategy authorizationStrategy = getSession().getAuthorizationStrategy();
/s
BaseWebSession(Session).getAuthorizationStrategy() line: 543	
		return getApplication().getSecuritySettings().getAuthorizationStrategy();
/s
WicketWebApplication(Application).getSecuritySettings() line: 659	
		return getSettings();
/s
WicketWebApplication(Application).getSettings() line: 919	
		return settings;
settings	Settings  (id=19794)	
	authorizationStrategy	BaseAuthorizationStrategy  (id=18108)	

/ Intermezzo

$ vi ApplicationUtils.java
	public static void init(WebApplication anApplication) {
		anApplication.getSecuritySettings().setAuthorizationStrategy(new BaseAuthorizationStrategy(anApplication));

/ Einde Intermezzo

authorizationStrategy	BaseAuthorizationStrategy  (id=18108)	
	$SWITCH_TABLE$com$mpobjects$oms$model$entity$permission$PermissionType	null	
	LOG	Log4JLogger  (id=18165)	
	permissionService	null	
	webApplication	WicketWebApplication  (id=18166)	

		if (authorizationStrategy != null)
		{
			return authorizationStrategy.isActionAuthorized(this, action);
/s
BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 65	
		PermissionType myP = getPermissionManager(component).checkPermission(component, action);
/s
component	QueryViewPanel$3$1$3  (id=20119)	/ RowActionPanel	, see QueryViewPanel:650	
action	Action  (id=20187)	
ENABLE
BaseAuthorizationStrategy.getPermissionManager(Component) line: 203	
		HttpServletRequest req = ((WebRequest) RequestCycle.get().getRequest()).getHttpServletRequest();
		WicketPermissionManager myManager = (WicketPermissionManager) req.getAttribute("PM");
myManager	WicketPermissionManager  (id=20959)	
com.mpobjects.oms.service.permission.WicketPermissionManager@57632d62
		return myManager;
/t
BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 65	
		PermissionType myP = getPermissionManager(component).checkPermission(component, action);
/s
WicketPermissionManager.checkPermission(Component, Action) line: 28	
		if (isCheckedComponent(aComponent)) {
/s
WicketPermissionManager.isCheckedComponent(Component) line: 53	
		for (Class<?> myClass : getCheckedClasses()) {
/s
	private Set<Class<?>> getCheckedClasses() {
		if (checkedComponentClasses == null) {
/ NEEj
			checkedComponentClasses = new HashSet<Class<?>>();
			checkedComponentClasses.add(AbstractTextComponent.class);
			checkedComponentClasses.add(Enclosure.class);
			checkedComponentClasses.add(FormComponentPanel.class);
		}
		return checkedComponentClasses;
/t
WicketPermissionManager.isCheckedComponent(Component) line: 58	
		for (Class<?> myClass : getCheckedClasses()) {
			if (myClass.isInstance(aComponent)) {
/ NEE
		return false;
/t
WicketPermissionManager.checkPermission(Component, Action) line: 39	
		if (isCheckedComponent(aComponent)) {
/ NEE
		return null;
/t
BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 66	
		PermissionType myP = getPermissionManager(component).checkPermission(component, action);
/d
null
		Privilege myPrivilege = component.getClass().getAnnotation(Privilege.class);
null
		if (myPrivilege == null) {
			return true;
...
/t
QueryViewPanel$3$1$3(Component).isEnabledInHierarchy() line: 4778	
			else
			{
				state = isEnabled() && isEnableAllowed();
true
/t
RowActionPanel$1(Component).isEnabledInHierarchy() line: 4776	

this	RowActionPanel$1  (id=20120)	/ AjaxLink	,	
parent	QueryViewPanel$3$1$3  (id=20119)	

			Component parent = getParent();
			if (parent != null && !parent.isEnabledInHierarchy())
/d
false	, want parent.isEnabledInHierarchy()=true	,
			{
				state = false;
			}
			else
			{
				state = isEnabled() && isEnableAllowed();
/s
RowActionPanel$1(Component).isEnabled() line: 2136	
/ de AjaxButton heeft isEnabled niet overwrite	,
		return getFlag(FLAG_ENABLED);
/s
			return (flags & flag) != 0;
true
/t
				state = isEnabled() && isEnableAllowed();
/pd
/s
/ weer hetzelfde als voor zijn parent, de RowActionPanel	,
		return state;
true
/t
RowActionPanel$1(AbstractLink).isLinkEnabled() line: 144	
		return isEnabledInHierarchy();
/t
RowActionPanel$1(AjaxLink).onComponentTag(ComponentTag) line: 94	
		if (isLinkEnabled())
/ JA
			// disable any href attr in markup
			if (tag.getName().equalsIgnoreCase("a") || tag.getName().equalsIgnoreCase("link") ||
				tag.getName().equalsIgnoreCase("area"))
/ NEE
tag	ComponentTag  (id=21823)	
	xmlTag	XmlTag  (id=21858)	
		name	"button" (id=21861)	
/t
RowActionPanel$1(Component).renderComponent(MarkupStream) line: 2699	
		// Call any tag handler
		onComponentTag(tag);
/d

/c
/ Hieronder zien we dat voor de enable van de AjaxLink wicket in renderComponent onComponentTag calls, die isLinkEnabled calls, die isEnabledInHierarchy() calls	, die die eerst parent.isEnabledInHierarchy() calls	, en dan isEnabled en isEnableAllowed	,

PartyGroupPage$3=RowAction	,
QueryViewPanel$3$1$3=RowActionPanel
RowActionPanel$1=AjaxLink	,



Daemon Thread [http-0.0.0.0-8080-6] (Suspended (breakpoint at line 166 in PartyGroupPage$3))	
	PartyGroupPage$3.isEnabled(List<Object>) line: 166	
/=
		RowAction deleteAction = new RowAction() {
			@Override
			public boolean isEnabled(List<Object> aRow) {
->				return mayDelete;
			}

	QueryViewPanel$3$1$3.isEnabled() line: 655	
/=
		RowActionPanel myPanel = new RowActionPanel(myActions.newChildId(), myAction, aCell.getModelObject(), myAction.getCssClass(), myAction .getTitle()) {
			@Override
			public boolean isEnabled() {
->				return myAction.isEnabled(aRow.getModelObject());
			}

	QueryViewPanel$3$1$3(Component).isEnabledInHierarchy() line: 4776	

parent	RepeatingView  (id=20121)	
this	QueryViewPanel$3$1$3  (id=21898)	

			else
			{
				state = isEnabled() && isEnableAllowed();

	RowActionPanel$1(Component).isEnabledInHierarchy() line: 4770	
			Component parent = getParent();

parent	QueryViewPanel$3$1$3  (id=21898)	
this	RowActionPanel$1  (id=21889)	

			if (parent != null && !parent.isEnabledInHierarchy())

	RowActionPanel$1(AbstractLink).isLinkEnabled() line: 144	
		return isEnabledInHierarchy();

	RowActionPanel$1(AjaxLink).onComponentTag(ComponentTag) line: 94	
		if (isLinkEnabled())

	RowActionPanel$1(Component).renderComponent(MarkupStream) line: 2696	
	RowActionPanel$1(MarkupContainer).onRender(MarkupStream) line: 1559	
	RowActionPanel$1(Component).render(MarkupStream) line: 2525	
	QueryViewPanel$3$1$3(MarkupContainer).renderNext(MarkupStream) line: 1461	
	QueryViewPanel$3$1$3(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	QueryViewPanel$3$1$3(MarkupContainer).renderAssociatedMarkup(String, String) line: 717	
	QueryViewPanel$3$1$3(Panel).onComponentTagBody(MarkupStream, ComponentTag) line: 114	
	QueryViewPanel$3$1$3(Component).renderComponent(MarkupStream) line: 2725	
	QueryViewPanel$3$1$3(MarkupContainer).onRender(MarkupStream) line: 1559	
	QueryViewPanel$3$1$3(Component).render(MarkupStream) line: 2525	
	RepeatingView(AbstractRepeater).renderChild(Component) line: 122	
	RepeatingView(AbstractRepeater).onRender(MarkupStream) line: 103	
	RepeatingView(Component).render(MarkupStream) line: 2525	
	ListItem(MarkupContainer).renderNext(MarkupStream) line: 1461	
...
/c

/ Intermezzo


		dataView = new ListView<List<Object>>("rows", new PropertyModel<List<List<Object>>>(QueryViewPanel.this, "rowsOnPage")) {
QueryViewPanel$3
			@Override
			protected void populateItem(final ListItem<List<Object>> aRow) {
				final ListView<Object> myRow = new ListView<Object>("cells", aRow.getModel()) {
QueryViewPanel$3$1
					@Override
					protected void populateItem(final ListItem<Object> aCell) {
							RepeatingView myActions = new RepeatingView("cellvalue");
							aCell.add(myActions);
							for (final RowAction myAction : rowActionList) {
								RowActionPanel myPanel = new RowActionPanel(myActions.newChildId(), myAction, aCell.getModelObject(), myAction.getCssClass(), myAction .getTitle()) {
QueryViewPanel$3$1$3
									@Override
									public boolean isEnabled() {
										return myAction.isEnabled(aRow.getModelObject());
									}
								myActions.add(myPanel);
				aRow.add(myRow);

/ de rowActionList is create in PartyGroupPage	, en bestaat uit 2 RowAction's	, edit en delete	, voor elk van deze actions wordt een RowActionPanel create	, we zien dus op een rij 2 RowActionPanel's	met daarop een AjaxLink	,

/ QueryViewPanel$3$1$3=RowActionPanel heeft als parent RepeatingView als parent,	
/ RepeatingView heeft als parent ListItem  , die als parent ListView("cells")=QueryViewPanel$3$1 heeft	, 
/ QueryViewPanel$3$1=ListView("cells") heeft als parent een ListItem, die als parent ListView("rows")=QueryViewPanel$3 heeft	,

/ RowActionPanel$1 of RowActionPanel$2 is AjaxLink "link" 

/ Einde Intermezzo

/ 7	.

/ we click edit button op een row	, 

/ de AjaxLink (de button) heeft als parent de RowActionPanel	, wicket checks de hele hierarchy	, dus hij checks ook de permission van de RowActionPanel	, 
/ de enable van de RowactionPanel is zo program, dat deze de permission is van de RowAction	,

								RowActionPanel myPanel = new RowActionPanel(myActions.newChildId(), myAction, aCell.getModelObject(), myAction.getCssClass(), myAction .getTitle()) {
									@Override
									public boolean isEnabled() {
										return myAction.isEnabled(aRow.getModelObject());
									}

/ we zien de stack trace	,

	QueryViewPanel$3$1$3(Component).isEnableAllowed() line: 2124	
		return isActionAuthorized(ENABLE);

	QueryViewPanel$3$1$3(Component).isEnabledInHierarchy() line: 4776	
			else
			{
				state = isEnabled() && isEnableAllowed();

	RowActionPanel$1(Component).isEnabledInHierarchy() line: 4770	
			if (parent != null && !parent.isEnabledInHierarchy())

	BehaviorRequestTarget.processEvents(RequestCycle) line: 142	
		if (!component.isVisibleInHierarchy() ||

	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
			((IEventProcessor)target).processEvents(requestCycle);

	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
		// let the processor handle/ issue any events, including building the component hierarchy
		processor.processEvents(this);

	MpoWebRequestCycle(RequestCycle).step() line: 1358	
				case PROCESS_EVENTS : {
					processEventsAndRespond();

	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
				try
				{
					step();

	MpoWebRequestCycle(RequestCycle).request() line: 545	
		// loop through steps
		steps();

	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
				try
				{
					// Process request
					cycle.request();

	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
		if (wicketFilter.doGet(servletRequest, servletResponse) == false)

	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	
...

/c
	PartyGroupPage$2.execute(Object) line: 126	
				...
				EvoEditFormPage<PartyGroupVO> page = getEditPage();

	RowActionPanel$1.onClick(AjaxRequestTarget) line: 41	
/=
	public RowActionPanel(String aId, final RowAction anAction, final Object anObject, String cssClass, String aTitle) {
		super(aId);

		link = new AjaxLink("link") {

			@Override
			public void onClick(AjaxRequestTarget aTarget) {
				anAction.setTarget(aTarget);
->				if (anAction.execute(anObject)) {

	AjaxLink$1.onEvent(AjaxRequestTarget) line: 68	
/=
		add(new AjaxEventBehavior("onclick")
		{
			private static final long serialVersionUID = 1L;

			@Override
			protected void onEvent(AjaxRequestTarget target)
			{
				onClick(target);

	AjaxLink$1(AjaxEventBehavior).respond(AjaxRequestTarget) line: 177	
		onEvent(target);

	AjaxLink$1(AbstractDefaultAjaxBehavior).onRequest() line: 312	
		WebApplication app = (WebApplication)getComponent().getApplication();
		AjaxRequestTarget target = app.newAjaxRequestTarget(getComponent().getPage());
		RequestCycle.get().setRequestTarget(target);
->		respond(target);

	BehaviorRequestTarget.processEvents(RequestCycle) line: 157	
		// Invoke the interface method
		behaviorListener.onRequest();

	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
		if (target instanceof IEventProcessor)
		{
			Application.get().logEventTarget(target);
			((IEventProcessor)target).processEvents(requestCycle);

	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
		// let the processor handle/ issue any events, including building the component hierarchy
		processor.processEvents(this);

	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/ MAANDAGOCHTEND
/ Ook language file	,
/c
/ Hij gaat de permissions af van de buttons op de page	,
/s
	PartyGroupEditPanel$1(EntityActionButton).isEnabled(IModel<T>) line: 54	
/=
public abstract class EntityActionButton<T extends EntityInterface> extends AbstractEntityActionButton<T> implements EntityAction<T> {
	@Override
	protected boolean isEnabled(IModel<T> aSelection) {
		return true;
	}

	EntityActionAjaxButton$1.isEnabled() line: 46	
/=
	@Override
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new AjaxFallbackButton(aId, null) {
			@Override
			public boolean isEnabled() {
				return EntityActionAjaxButton.this.isEnabled(aModel);

	EntityActionAjaxButton$1(Component).isEnabledInHierarchy() line: 4776	
			else
			{
				state = isEnabled() && isEnableAllowed();

	Form$17.component(Component) line: 1708	
				else if (component instanceof FormComponent)
				{
					FormComponent<?> fc = (FormComponent<?>)component;
					if (fc.isVisibleInHierarchy() && fc.isEnabledInHierarchy())

	AbstractEntityActionButton$EntityABPanel(MarkupContainer).visitChildren(Class<?>, IVisitor<S>) line: 920	
	RepeatingView(MarkupContainer).visitChildren(Class<?>, IVisitor<S>) line: 935	
	BaseActionBuilder$EntityActionPanel(MarkupContainer).visitChildren(Class<?>, IVisitor<S>) line: 935	
	GenericForm(MarkupContainer).visitChildren(Class<?>, IVisitor<S>) line: 935	
	GenericForm(Form).isMultiPart() line: 1691	
	GenericForm(Form).onComponentTag(ComponentTag) line: 1927	
	GenericForm(Component).renderComponent(MarkupStream) line: 2696	
	GenericForm(MarkupContainer).onRender(MarkupStream) line: 1559	
	GenericForm(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1461	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 66	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1465	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	PartyGroupEditPanel(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 73	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	PartyGroupEditPanel(MarkupContainer).renderNext(MarkupStream) line: 1465	
	PartyGroupEditPanel(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	PartyGroupEditPanel(MarkupContainer).renderAssociatedMarkup(String, String) line: 717	
	PartyGroupEditPanel(Panel).onComponentTagBody(MarkupStream, ComponentTag) line: 114	
	PartyGroupEditPanel(Component).renderComponent(MarkupStream) line: 2725	
	PartyGroupEditPanel(MarkupContainer).onRender(MarkupStream) line: 1559	
	PartyGroupEditPanel(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1461	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 66	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1465	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 73	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1465	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 66	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1465	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	BasePage$2(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 73	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	BasePage$2(MarkupContainer).renderNext(MarkupStream) line: 1465	
	BasePage$2(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	BasePage$2(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	BasePage$2(Component).renderComponent(MarkupStream) line: 2725	
	BasePage$2(MarkupContainer).onRender(MarkupStream) line: 1559	
	BasePage$2(Component).render(MarkupStream) line: 2525	
	BasePage$3(MarkupContainer).renderNext(MarkupStream) line: 1461	
	BasePage$3(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	BasePage$3(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	BasePage$3(Component).renderComponent(MarkupStream) line: 2725	
	BasePage$3(MarkupContainer).onRender(MarkupStream) line: 1559	
	BasePage$3(Component).render(MarkupStream) line: 2525	
	PartyGroupEditFormPage(MarkupContainer).renderNext(MarkupStream) line: 1461	
	PartyGroupEditFormPage(MarkupContainer).renderAll(MarkupStream) line: 1575	
	PartyGroupEditFormPage(Page).onRender(MarkupStream) line: 1599	
	PartyGroupEditFormPage(Component).render(MarkupStream) line: 2525	
	PartyGroupEditFormPage(Page).renderPage() line: 933	
	RedirectPageRequestTarget(PageRequestTarget).respond(RequestCycle) line: 63	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	





/ 7	. 

/ debug PartyGroupEditFormPage	,

/s
PartyGroupEditFormPage.<init>(EvoEditFormCallback, BeanWrapper<EnumeratedValueObjectDAOInterface<PartyGroupVO>>, EvoDataProperties) line: 32	
		super(aCallback, aDaoWrapper, aDataProperties);
/s
PartyGroupEditFormPage(EvoEditFormPage).<init>(EvoEditFormCallback, BeanWrapper<EnumeratedValueObjectDAOInterface<T>>, EvoDataProperties) line: 90	
		createPage();
/s
PartyGroupEditFormPage(EvoEditFormPage).createPage() line: 143	
		createEditPanel();
/s
PartyGroupEditFormPage.createEditPanel() line: 40	
		EntityFormActionBuilder<PartyGroupVO> panelBuilder = new EntityFormActionBuilder<PartyGroupVO>(getFormActions());
/s
PartyGroupEditFormPage(EvoEditFormPage).getFormActions() line: 152	

		List<EntityAction<T>> actions = new ArrayList<EntityAction<T>>();

		EntityActionButton<T> saveBtn = new EntityActionAjaxButton<T>("ok", new ResourceModel("save")) {
			...
		actions.add(saveBtn);

/ Intermezzo

public abstract class EntityActionAjaxButton<T extends EntityInterface> extends EntityActionButton<T> {
	@Override
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new AjaxFallbackButton(aId, null) {
			@Override
			public boolean isEnabled() {
				return EntityActionAjaxButton.this.isEnabled(aModel);
			}

public abstract class EntityActionButton<T extends EntityInterface> extends AbstractEntityActionButton<T> implements EntityAction<T> {
	@Override
	protected boolean isEnabled(IModel<T> aSelection) {
		return true;
	}

public abstract class AbstractEntityActionButton<T> implements Serializable {
	protected Button createButton(final IModel<T> aModel, String aId) {
		button = createButtonInstance(aModel, aId);

/ Einde Intermezzo

/t
PartyGroupEditFormPage.createEditPanel() line: 41	
		EntityFormActionBuilder<PartyGroupVO> panelBuilder = new EntityFormActionBuilder<PartyGroupVO>(getFormActions());
/d
		editPanel = new PartyGroupEditPanel("editPanel", new WebComponentEventSwitchBoard(), panelBuilder, daoWrapper, dataProperties);
/s
PartyGroupEditPanel.<init>(String, WebComponentEventSwitchBoard, FormActionsPanelBuilder<PartyGroupVO>, BeanWrapper<EnumeratedValueObjectDAOInterface<PartyGroupVO>>, EvoDataProperties) line: 93	
		super(aId, aWebComponentEventSwitchBoard, aFormActionsPanelBuilder, aDaoWrapper, aDataProperties);
/s
PartyGroupEditPanel(EvoEditPanel).<init>(String, WebComponentEventSwitchBoard, FormActionsPanelBuilder<T>, BeanWrapper<EnumeratedValueObjectDAOInterface<T>>, EvoDataProperties) line: 54	
		// call again, this time is will be executed for real
		createPanel(tempModel);
/s
PartyGroupEditPanel(EvoEditPanel).createPanel(CompoundPropertyModel<T>) line: 84	
		} else {
			super.createPanel(aModel);
/s
PartyGroupEditPanel(GenericFormPanel).createPanel(CompoundPropertyModel<T>) line: 170	
		AbstractActionsPanel<T> actionPanel = getActionsPanel("actionPanel", model);
/s
PartyGroupEditPanel(GenericFormPanel).getActionsPanel(String, CompoundPropertyModel<T>) line: 187	
		return panelBuilder.build(componentId, model, webComponentEventSwitchBoard, this);
/s
EntityFormActionBuilder.build(String, CompoundPropertyModel<T>, WebComponentEventSwitchBoard, GenericFormPanel<T>) line: 38	
		return new EntityActionPanel(aId, aParent, aWebComponentEventSwitchBoard, aModel);
/s
BaseActionBuilder$EntityActionPanel.<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, IModel<T>) line: 34	
			createActions(view, aModel);
/s
EntityFormActionBuilder(BaseActionBuilder).createActions(RepeatingView, IModel<T>) line: 75	
		for (EntityAction<T> action : actions) {
			Component component = action.createComponent(view.newChildId(), aModel);

this	EntityFormActionBuilder  (id=20817)	
	actions	ArrayList  (id=21002)	
		elementData	Object[10]  (id=21005)	
			[0]	EvoEditFormPage$1  (id=19990)	
		EntityActionButton<T> saveBtn = new EntityActionAjaxButton<T>("ok", new ResourceModel("save")) {
			[1]	EvoEditFormPage$2  (id=21007)	
		EntityActionButton<T> cancelBtn = new EntityActionAjaxButton<T>("cancel", new ResourceModel("cancel")) {
			[2]	PartyGroupEditPanel$1  (id=21008)	
		EntityActionButton<PartyGroupVO> addBtn = new EntityActionAjaxButton<PartyGroupVO>("add", new ResourceModel("addParty")) {
			[3]	PartyGroupEditPanel$2  (id=21009)	
		EntityActionButton<PartyGroupVO> deleteBtn = new EntityActionAjaxButton<PartyGroupVO>("delete", new ResourceModel("removeParties")) {
			[4]	PartyGroupEditPanel$3  (id=21010)	
		EntityActionButton<PartyGroupVO> addMsgBtn = new EntityActionAjaxButton<PartyGroupVO>("add", new ResourceModel("addMessage")) {
			[5]	PartyGroupEditPanel$4  (id=21011)	
		EntityActionButton<PartyGroupVO> deleteMsgBtn = new EntityActionAjaxButton<PartyGroupVO>("delete", new ResourceModel("removeMessages")) {

/s
EvoEditFormPage$1(EntityActionButton).createComponent(String, IModel<T>) line: 49	
		return new EntityABPanel(aComponentId, createButton(aModel, "button"));
/s
EvoEditFormPage$1(AbstractEntityActionButton).createButton(IModel<T>, String) line: 220	

/ 7	. 

/ permissions on buttons on partygroup edit form page	,

/c
	EntityActionAjaxButton$1.isEnabled() line: 46	
/=
	@Override
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new AjaxFallbackButton(aId, null) {
			@Override
			public boolean isEnabled() {
				return EntityActionAjaxButton.this.isEnabled(aModel);

	EntityActionAjaxButton$1(Component).isEnabledInHierarchy() line: 4776	
			else
			{
				state = isEnabled() && isEnableAllowed();

	Form$17.component(Component) line: 1708	
				else if (component instanceof FormComponent)
				{
					FormComponent<?> fc = (FormComponent<?>)component;
					if (fc.isVisibleInHierarchy() && fc.isEnabledInHierarchy())

	AbstractEntityActionButton$EntityABPanel(MarkupContainer).visitChildren(Class<?>, IVisitor<S>) line: 920	
this	AbstractEntityActionButton$EntityABPanel  (id=21856)	

		// Iterate through children of this container
		for (int i = 0; i < children_size(); i++)
		{
			// Get next child component
			final Component child = children_get(i);
			Object value = null;

			// Is the child of the correct class (or was no class specified)?
			if (clazz == null || clazz.isInstance(child))
			{
				// Call visitor
				@SuppressWarnings("unchecked")
				S s = (S)child;
				value = visitor.component(s);

	RepeatingView(MarkupContainer).visitChildren(Class<?>, IVisitor<S>) line: 935	
	BaseActionBuilder$EntityActionPanel(MarkupContainer).visitChildren(Class<?>, IVisitor<S>) line: 935	
	GenericForm(MarkupContainer).visitChildren(Class<?>, IVisitor<S>) line: 935	
	GenericForm(Form).isMultiPart() line: 1691	
	GenericForm(Form).onComponentTag(ComponentTag) line: 1927	
	GenericForm(Component).renderComponent(MarkupStream) line: 2696	
	GenericForm(MarkupContainer).onRender(MarkupStream) line: 1559	
	GenericForm(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1461	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 66	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1465	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	PartyGroupEditPanel(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 73	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	PartyGroupEditPanel(MarkupContainer).renderNext(MarkupStream) line: 1465	
	PartyGroupEditPanel(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	PartyGroupEditPanel(MarkupContainer).renderAssociatedMarkup(String, String) line: 717	
	PartyGroupEditPanel(Panel).onComponentTagBody(MarkupStream, ComponentTag) line: 114	
	PartyGroupEditPanel(Component).renderComponent(MarkupStream) line: 2725	
	PartyGroupEditPanel(MarkupContainer).onRender(MarkupStream) line: 1559	
	PartyGroupEditPanel(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1461	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 66	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1465	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 73	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1465	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 66	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1465	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).renderComponent(MarkupStream) line: 2725	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(MarkupContainer).onRender(MarkupStream) line: 1559	
	MarkupInheritanceResolver$TransparentWebMarkupContainer(Component).render(MarkupStream) line: 2525	
	BasePage$2(MarkupContainer).autoAdd(Component, MarkupStream) line: 229	
	MarkupInheritanceResolver.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 73	
	ComponentResolvers.resolve(Application, MarkupContainer, MarkupStream, ComponentTag) line: 81	
	BasePage$2(MarkupContainer).renderNext(MarkupStream) line: 1465	
	BasePage$2(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	BasePage$2(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	BasePage$2(Component).renderComponent(MarkupStream) line: 2725	
	BasePage$2(MarkupContainer).onRender(MarkupStream) line: 1559	
	BasePage$2(Component).render(MarkupStream) line: 2525	
	BasePage$3(MarkupContainer).renderNext(MarkupStream) line: 1461	
	BasePage$3(MarkupContainer).renderComponentTagBody(MarkupStream, ComponentTag) line: 1624	
	BasePage$3(MarkupContainer).onComponentTagBody(MarkupStream, ComponentTag) line: 1548	
	BasePage$3(Component).renderComponent(MarkupStream) line: 2725	
	BasePage$3(MarkupContainer).onRender(MarkupStream) line: 1559	
	BasePage$3(Component).render(MarkupStream) line: 2525	
	PartyGroupEditFormPage(MarkupContainer).renderNext(MarkupStream) line: 1461	
	PartyGroupEditFormPage(MarkupContainer).renderAll(MarkupStream) line: 1575	
	PartyGroupEditFormPage(Page).onRender(MarkupStream) line: 1599	
	PartyGroupEditFormPage(Component).render(MarkupStream) line: 2525	
	PartyGroupEditFormPage(Page).renderPage() line: 933	
	RedirectPageRequestTarget(PageRequestTarget).respond(RequestCycle) line: 63	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/s
EntityActionAjaxButton$1.isEnabled() line: 46	
/=
	@Override
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new AjaxFallbackButton(aId, null) {
			@Override
			public boolean isEnabled() {
				return EntityActionAjaxButton.this.isEnabled(aModel);
/s
EvoEditFormPage$1(EntityActionButton).isEnabled(IModel<T>) line: 54	
	@Override
	protected boolean isEnabled(IModel<T> aSelection) {
		return true;

/ 7	. 

/ waar zijn we hier vlak boven	?

$ vi EvoEditFormPage.java
	protected Collection<EntityAction<T>> getFormActions() {
		EntityActionButton<T> saveBtn = new EntityActionAjaxButton<T>("ok", new ResourceModel("save")) {
		EntityActionButton<T> cancelBtn = new EntityActionAjaxButton<T>("cancel", new ResourceModel("cancel")) {

$ vi EntityActionAjaxButton.java
	@Override
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new AjaxFallbackButton(aId, null) {
			@Override
			public boolean isEnabled() {
				return EntityActionAjaxButton.this.isEnabled(aModel);
/s
EvoEditFormPage$1(EntityActionButton).isEnabled(IModel<T>) line: 54	
		return true;

/ 7	.

/ See blaadje	,


/ Einde DEBUG PCT-1046

/ PCT-1046

/ See MAANDAGOCHTEND in vorige PCT-1046	, 

/ 7	.

/ Tantely heeft veranderd in 
133:	if (Action.ENABLE.equals(action.getName())) {
			if (!(component instanceof VOEditFormPage || component instanceof EvoEditPage || component instanceof EvoEditFormPage)) {
				// Always enable for lists
				return true;
			}


/ 7	.

$ vi oms-menu.xml

	<m:add path="configuration.planning.unitTranslation" privilege="unit-translation.list" actionUrl="wicket?module=oms&amp;wicketpage=unittranslation.UnitTranslationPage" index="1021" />

/ 7	. 

/ Lees SCS-2322

/ we geven role R_PRIVS_PTG de privileges
unit-translation:list
unit-translation:create
unit-translation:delete

/ login u_privs_ptg	, 
/ in menu zien we configuration, planning, unit translation	, omdat u_privs_ptg de priv unit-translation:list heeft	,
/ click 'Create Unit translation'	, 
/ we zien dat de screen read-only is	, omdat unit-translation:edit wordt gemist	,




/ Einde PCT-1046

/ DEBUG PCT-1046

/ u_privs_ptg kiest 
configuration, planning, unit translation

$ vi UnitTranslationPage.java
	@Override
	protected void createPage() {
		super.createPage();
/TODO
		editPage = new UnitTranslationEditFormPage(this, daoWrapper, dataProperties);
/s
UnitTranslationEditFormPage.<init>(VOEditFormCallback, BeanWrapper<BaseDAOInterface<UnitTranslation>>, EvoDataProperties) line: 40	
/=
@Privilege(object = "unit-translation", type = "list")
public class UnitTranslationEditFormPage extends VOEditFormPage<UnitTranslation> {
	public UnitTranslationEditFormPage(VOEditFormCallback aCallback, BeanWrapper<? extends BaseDAOInterface<UnitTranslation>> aDaoWrapper,
			EvoDataProperties aDataProperties) {
->		super(aCallback, aDaoWrapper, aDataProperties);

/ Inderdaad: unit-translation:list privilege op een edit page	,
/ TODO

/s
UnitTranslationEditFormPage(VOEditFormPage).<init>(VOEditFormCallback, BeanWrapper<BaseDAOInterface<T>>, EvoDataProperties) line: 90	
		createPage();
/s
UnitTranslationEditFormPage(VOEditFormPage).createPage() line: 143	
		createEditPanel();
/s
UnitTranslationEditFormPage.createEditPanel() line: 46	
		editPanel = new UnitTranslationEditPanel("editPanel", new WebComponentEventSwitchBoard(), myPanelBuilder, daoWrapper, dataProperties);
/s
public class UnitTranslationEditPanel extends VOEditPanel<UnitTranslation> {
	public UnitTranslationEditPanel(String aId, WebComponentEventSwitchBoard aWebComponentEventSwitchBoard,
			FormActionsPanelBuilder<UnitTranslation> aFormActionsPanelBuilder, BeanWrapper<? extends BaseDAOInterface<UnitTranslation>> aDaoWrapper,
			EvoDataProperties aDataProperties) {
		super(aId, aWebComponentEventSwitchBoard, aFormActionsPanelBuilder, aDaoWrapper, aDataProperties);

/ Inderdaad: Geen privilege	,
/ TODO

/s
	public VOEditPanel(String id, WebComponentEventSwitchBoard webComponentEventSwitchBoard, FormActionsPanelBuilder<T> formActionsPanelBuilder, BeanWrapper<? extends BaseDAOInterface<T>> aDaoWrapper, EvoDataProperties aDataProperties) {
		// call again, this time is will be executed for real
		createPanel(tempModel);
/s
void com.mpobjects.oms.view.wicket.vocode.VOEditPanel.createPanel(CompoundPropertyModel<T> model) 
		} else {
			super.createPanel(aModel);
/s
void com.mpobjects.view.wicket.util.single.GenericFormPanel.createPanel(CompoundPropertyModel<T> model)
		AbstractActionsPanel<T> actionPanel = getActionsPanel("actionPanel", model);
/s
AbstractActionsPanel<T> com.mpobjects.view.wicket.util.single.GenericFormPanel.getActionsPanel(String componentId, CompoundPropertyModel<T> model)
		return panelBuilder.build(componentId, model, webComponentEventSwitchBoard, this);
/s
AbstractActionsPanel<T> com.mpobjects.view.wicket.util.actions.EntityFormActionBuilder.build(String aId, CompoundPropertyModel<T> aModel, WebComponentEventSwitchBoard aWebComponentEventSwitchBoard, GenericFormPanel<T> aParent)
		return new EntityActionPanel(aId, aParent, aWebComponentEventSwitchBoard, aModel);
/s
com.mpobjects.view.wicket.util.actions.BaseActionBuilder.EntityActionPanel.EntityActionPanel(String aId, BaseWebComponent aParent, WebComponentEventSwitchBoard aWebComponentEventSwitchBoard, IModel<T> aModel)
			RepeatingView view = new RepeatingView("actions");
			add(view);
			createActions(view, aModel);
/s
void com.mpobjects.view.wicket.util.actions.BaseActionBuilder.createActions(RepeatingView view, 
 IModel<T> aModel)
	actions	ArrayList  (id=17921)	
		elementData	Object[10]  (id=18055)	
			[0]	UnitTranslationEditFormPage$1  (id=17652)	
			[1]	UnitTranslationEditFormPage$2  (id=18056)	
			[2]	UnitTranslationEditFormPage$3  (id=18057)	

/ Intermezzo

public class UnitTranslationEditFormPage extends VOEditFormPage<UnitTranslation> {
		List<EntityAction<UnitTranslation>> actions = new ArrayList<EntityAction<UnitTranslation>>();
		EntityActionButton<UnitTranslation> saveBtn = new EntityActionAjaxButton<UnitTranslation>("ok", new ResourceModel("save")) {
		actions.add(saveBtn);
		EntityActionButton<UnitTranslation> saveaAndCloseBtn = new EntityActionAjaxButton<UnitTranslation>("ok", new ResourceModel("saveAndClose")) {
		actions.add(saveaAndCloseBtn);
		EntityActionButton<UnitTranslation> cancelBtn = new EntityActionAjaxButton<UnitTranslation>("cancel", new ResourceModel("cancel")) {
		actions.add(cancelBtn);

/ Einde Intermezzo

/s
Component com.mpobjects.view.wicket.util.actions.EntityActionButton.createComponent(String aComponentId, IModel<T> aModel)
		return new EntityABPanel(aComponentId, createButton(aModel, "button"));
/s
Button com.mpobjects.view.wicket.util.actions.AbstractEntityActionButton.createButton(IModel<T> aModel, String aId)
		button = createButtonInstance(aModel, aId);
/s
Button com.mpobjects.view.wicket.util.actions.EntityActionAjaxButton.createButtonInstance(IModel<T> aModel, String aId)
		return new AjaxFallbackButton(aId, null) {
			@Override
			public boolean isEnabled() {
				return EntityActionAjaxButton.this.isEnabled(aModel);
			}
			...

/c

void Page.renderPage()
		// first try to check if the page can be rendered:
		if (!isActionAuthorized(RENDER))
/s
boolean Component.isActionAuthorized(Action action)
action=RENDER
		IAuthorizationStrategy authorizationStrategy = getSession().getAuthorizationStrategy();
com.mpobjects.view.wicket.BaseAuthorizationStrategy@68c3ae34
		if (authorizationStrategy != null)
		{
			return authorizationStrategy.isActionAuthorized(this, action);
/s
boolean com.mpobjects.view.wicket.BaseAuthorizationStrategy.isActionAuthorized(Component component, Action action)
		Privilege myPrivilege = component.getClass().getAnnotation(Privilege.class);
@com.mpobjects.view.wicket.util.Privilege(object=unit-translation, type=list)

		String myObjectName = myPrivilege.object();
myObjectName	"unit-translation" (id=20310)	

		} else if (Action.RENDER.equals(action.getName())) {
/ JA
			if (!EntityAuthorizationFactory.EDIT_TYPE.equals(myPrivilege.type())) {
/ JA
!edit.equals(list)
				// Check if user has either list or view privilege
				myTypeName = LIST;
				if (!MpoBeanFactory.getBean(SecurityService.class).isUserAuthorizedOnPrivilege(myObjectName, myTypeName)) {
/s
boolean com.mpobjects.core.model.service.SecurityServiceImpl.isUserAuthorizedOnPrivilege(String anObjectName, String aTypeName)
		return isUserAuthorizedOnPrivilege(ResourceUtil.getResource(), anObjectName, aTypeName, false);
ResourceUtil.getResource()=Resource:u_privs_ptg(systemId:26894069)
anObjectName=unit-translation
aTypeName=list
/s
SecurityServiceImpl.isUserAuthorizedOnPrivilege(Resource, String, String, boolean) line: 53	
			userId = aResource.getCode();
"u_privs_ptg"
			RoleVO myHighestRole = aResource.getHighestRole();
SystemId:26894067	Name:R_PRIVS_PTG	Description:pct-1046
			myHighestRoleName = myHighestRole.getCode();
R_PRIVS_PTG

		// super user is allowed to do all
		if (SUPER_USER.equals(userId)) {
/ NEE
SUPER_USER="all-admin"
userId="u_privs_ptg"
		if (!anCheckAdministrator && SUPER_ROLE.equalsIgnoreCase(myHighestRoleName)) {
/ NEE
anCheckAdministrator=false
SUPER_ROLE="ADMINISTRATOR"
myHighestRoleName	"R_PRIVS_PTG" (id=21155)	

		if (EntityAuthorizationFactory.UPDATE_TYPE.equals(aTypeName)) {
/ NEE
EntityAuthorizationFactory.UPDATE_TYPE="update"
aTypeName="list"

		PrivilegeDAO privilegeDAO = MpoBeanFactory.getBean(PrivilegeDAO.class);
		Collection<RoleVO> aRoleVOCollection = aResource.getRoles();
[SystemId:26894067	Name:R_PRIVS_PTG	Description:pct-1046]
			List<PrivilegeVO> myPrivilegeVOList = privilegeDAO.getPrivilegesForRole(myRoleVO);
[
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@31a1c214[shipment-order,] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@5cad1c86[list,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@33e99ad[service-order,] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@5cad1c86[list,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@6b86802c[party,] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@6edc8895[create,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@6b86802c[party,] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@5cad1c86[list,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@6b86802c[party,] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@cc720b8[update,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@4e7568e3[profile,The profile] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@305b8ed2[edit,edit], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@3786c26[rate-agreement,Rate agreement] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@5cad1c86[list,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@38f73972[financial-party,Financial party] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@6edc8895[create,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@38f73972[financial-party,Financial party] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@5cad1c86[list,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@38f73972[financial-party,Financial party] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@cc720b8[update,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@38f73972[financial-party,Financial party] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@6095daa5[delete,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@73d360eb[event,Event] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@6edc8895[create,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@5fb17318[unit-translation,Unit translation] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@6edc8895[create,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@5fb17318[unit-translation,Unit translation] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@5cad1c86[list,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@5fb17318[unit-translation,Unit translation] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@6095daa5[delete,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@5dc41c[report,] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@bf60a74[view,View a record (edit /create form in readonly mode?)], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@38f73972[financial-party,Financial party] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@218b21e5[render,render (wicket)], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@38f73972[financial-party,Financial party] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@2fc7c82[enable,enable (wicket)], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@38f73972[financial-party,Financial party] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@305b8ed2[edit,edit], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@3ba2f5cf[financialparty,financialparty wicket screen] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@5cad1c86[list,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@3ba2f5cf[financialparty,financialparty wicket screen] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@218b21e5[render,render (wicket)], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@3ba2f5cf[financialparty,financialparty wicket screen] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@2fc7c82[enable,enable (wicket)], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@5e5f293b[party-group,Party Groups] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@6edc8895[create,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@5e5f293b[party-group,Party Groups] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@5cad1c86[list,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@3786c26[rate-agreement,Rate agreement] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@2fc7c82[enable,enable (wicket)], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@5e893f40[party-type-group,party type group] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@5cad1c86[list,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@748a7e14[serviceordertypetrigger,Service Order Type Trigger] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@305b8ed2[edit,edit], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@130d8557[report-cod-postnl,cod reports postnl] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@5cad1c86[list,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@3cb1f3a[customer-contract,customer-contract] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@5cad1c86[list,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@438052e0[financial-party-bank-account,financial-party-bank-account] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@6edc8895[create,], 
 PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@5e5f293b[party-group,Party Groups] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@6095daa5[delete,]]

			for (PrivilegeVO myPrivilegeVO : myPrivilegeVOList) {

PrivilegeVO: com.mpobjects.oms.model.entity.businessobject.BusinessObject@31a1c214[shipment-order,] - com.mpobjects.oms.model.entity.privilegetype.PrivilegeType@5cad1c86[list,]

				String myUserPrivilegeType = myPrivilegeVO.getPrivilegeType().getCode();
list
				if (EntityAuthorizationFactory.UPDATE_TYPE.equals(myUserPrivilegeType)) {
/ NEE
					myUserPrivilegeType = EntityAuthorizationFactory.EDIT_TYPE;
/ NIET
				}
				boolean myTypeCondition = aTypeName.equals(StringUtils.EMPTY) || aTypeName.equals(myUserPrivilegeType);
true
				if (anObjectName.equals(myPrivilegeVO.getBusinessObject().getCode()) && myTypeCondition) {
/ NEE
"unit-translation"!="shipment-order"
...
/ JA
					return true;
/t
BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 154	
		} else if (Action.RENDER.equals(action.getName())) {
			if (!EntityAuthorizationFactory.EDIT_TYPE.equals(myPrivilege.type())) {
				// Check if user has either list or view privilege
				myTypeName = LIST;
				if (!MpoBeanFactory.getBean(SecurityService.class).isUserAuthorizedOnPrivilege(myObjectName, myTypeName)) {
/ NEE
		myAllow = MpoBeanFactory.getBean(SecurityService.class).isUserAuthorizedOnPrivilege(myObjectName, myTypeName);
true
/ weer	, omdat we render waren	,
		return myAllow;
/t
void Page.renderPage()		
	if (!isActionAuthorized(RENDER))
/ NEE
/ Dit is juist de bedoeling	,

/ 7	.

/ we click de button 'Create new Unit Transaction'	,

/ VOEditPage$3 is de create button	 (new AjaxFallbackButton)	,
/s 
	BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 66	
/ Hieronder	,
	VOEditPage$3(Component).isActionAuthorized(Action) line: 2100	
		IAuthorizationStrategy authorizationStrategy = getSession().getAuthorizationStrategy();
com.mpobjects.view.wicket.BaseAuthorizationStrategy@68c3ae34
		if (authorizationStrategy != null)
		{
			return authorizationStrategy.isActionAuthorized(this, action);

	VOEditPage$3(Component).isEnableAllowed() line: 2124	
		return isActionAuthorized(ENABLE);

	WebRequestCycleProcessor(AbstractRequestCycleProcessor).resolveListenerInterfaceTarget(RequestCycle, Page, String, String, RequestParameters) line: 432	
			if (!component.isEnableAllowed())

	WebRequestCycleProcessor(AbstractRequestCycleProcessor).resolveRenderedPage(RequestCycle, RequestParameters) line: 472	
			// see whether this resolves to a component call or just the page
			final String interfaceName = requestParameters.getInterfaceName();
			if (interfaceName != null)
			{
->				return resolveListenerInterfaceTarget(requestCycle, page, componentPath,
					interfaceName, requestParameters);

	WebRequestCycleProcessor.resolve(RequestCycle, RequestParameters) line: 144	
	MpoWebRequestCycle(RequestCycle).step() line: 1339	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 66	
/=
	public boolean isActionAuthorized(Component component, Action action) {
action=ENABLED
component	VOEditPage$3  (id=24629)	
		Privilege myPrivilege = component.getClass().getAnnotation(Privilege.class);
null
		if (myPrivilege == null) {
			return true;

/ TODO

/c
	BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 66	
/ see Hieronder,	
	UnitTranslationPage(Component).isActionAuthorized(Action) line: 2100	
		IAuthorizationStrategy authorizationStrategy = getSession().getAuthorizationStrategy();
		if (authorizationStrategy != null)
		{
			return authorizationStrategy.isActionAuthorized(this, action);

	UnitTranslationPage(Component).isEnableAllowed() line: 2124	
		return isActionAuthorized(ENABLE);

	UnitTranslationPage(Component).isEnabledInHierarchy() line: 4776	
			else
			{
				state = isEnabled() && isEnableAllowed();

	Form(Component).isEnabledInHierarchy() line: 4770	
			if (parent != null && !parent.isEnabledInHierarchy())

	VOEditPage$3(Component).isEnabledInHierarchy() line: 4770	

	BehaviorRequestTarget.processEvents(RequestCycle) line: 142	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/s
BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 66	

component	UnitTranslationPage  (id=17696)	
action	Action  (id=24630)	

		Privilege myPrivilege = component.getClass().getAnnotation(Privilege.class);
@com.mpobjects.view.wicket.util.Privilege(object=unit-translation, type=list)

		if (Action.ENABLE.equals(action.getName())) {
			if (!(component instanceof VOEditFormPage || component instanceof EvoEditPage || component instanceof EvoEditFormPage)) {
/ JA
				// Always enable for lists
				return true;

/c
	BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 66	
/ see hieronder	,
	Form(Component).isActionAuthorized(Action) line: 2100	
		IAuthorizationStrategy authorizationStrategy = getSession().getAuthorizationStrategy();
		if (authorizationStrategy != null)
		{
			return authorizationStrategy.isActionAuthorized(this, action);

	Form(Component).isEnableAllowed() line: 2124	
		return isActionAuthorized(ENABLE);

	Form(Component).isEnabledInHierarchy() line: 4776	
			else
			{
				state = isEnabled() && isEnableAllowed();

	VOEditPage$3(Component).isEnabledInHierarchy() line: 4770	
	BehaviorRequestTarget.processEvents(RequestCycle) line: 142	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	
/s
BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 66	
		Privilege myPrivilege = component.getClass().getAnnotation(Privilege.class);
null		
		if (myPrivilege == null) {
			return true;

/c
	BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 66	
/ see hieronder	,
	VOEditPage$3(Component).isActionAuthorized(Action) line: 2100	
		IAuthorizationStrategy authorizationStrategy = getSession().getAuthorizationStrategy();
		if (authorizationStrategy != null)
		{
			return authorizationStrategy.isActionAuthorized(this, action);

	VOEditPage$3(Component).isEnableAllowed() line: 2124	
		return isActionAuthorized(ENABLE);

	VOEditPage$3(Component).isEnabledInHierarchy() line: 4776	
			else
			{
				state = isEnabled() && isEnableAllowed();

	BehaviorRequestTarget.processEvents(RequestCycle) line: 142	
		if (!component.isVisibleInHierarchy() ||
			(!(behaviorListener instanceof IIgnoreDisabledComponentBehavior) && !component.isEnabledInHierarchy()))


	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/s
BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 66	
component	VOEditPage$3  (id=24629)	
action	Action  (id=24630)	 ENABLE

		Privilege myPrivilege = component.getClass().getAnnotation(Privilege.class);

		if (myPrivilege == null) {
			LOG.debug("isActionAuthorized(" + component.getId() + ", " + action + ") return: true");
			return true;

/c
	BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 91	
/ see beneden	,
	GenericForm(Component).isActionAuthorized(Action) line: 2100	
			return authorizationStrategy.isActionAuthorized(this, action);

	GenericForm(Component).setDefaultModelObject(Object) line: 3161	
		// Check authorization
		if (!isActionAuthorized(ENABLE))

	GenericForm(Form).setModelObject(T) line: 2397	
		setDefaultModelObject(object);

	UnitTranslationEditPanel(GenericFormPanel).setObject(T) line: 244	
		form.setModelObject(object);

	UnitTranslationEditPanel(VOEditPanel).setEditRecord(T) line: 71	
		setObject(record);
/ record=com.mpobjects.oms.model.entity.unittranslation.UnitTranslation/id:0

	UnitTranslationEditFormPage(VOEditFormPage).setEditRecord(T) line: 106	
		editPanel.setEditRecord(aEntity);

	VOEditPage$3.onSubmit(AjaxRequestTarget, Form<?>) line: 143	
/=
		createButton = new AjaxFallbackButton("createButton", createForm) {
			@Override
			protected void onSubmit(AjaxRequestTarget aTarget, Form<?> aForm) {
				VOEditFormPage<T> page = getEditPage();
				page.setPageTitle(createPageTitle.getObject());
->				page.setEditRecord(daoWrapper.getBean().createNewObject());

	AjaxFallbackButton$1.onSubmit(AjaxRequestTarget) line: 74	
	AjaxFallbackButton$1(AjaxFormSubmitBehavior).onEvent(AjaxRequestTarget) line: 156	
	AjaxFallbackButton$1(AjaxEventBehavior).respond(AjaxRequestTarget) line: 177	
	AjaxFallbackButton$1(AbstractDefaultAjaxBehavior).onRequest() line: 312	
	BehaviorRequestTarget.processEvents(RequestCycle) line: 157	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/s
this	GenericForm  (id=19860)	
action	Action  (id=24630)	

/ Intermezzo

@Privilege(object = "", type = "edit")
public class GenericForm<T> extends AbstractPermissionForm<T> {

/ WH scs kijkt niet naar "edit"/ 
/ TODO
/ "" -> true

/ Einde Intermezzo

		String myObjectName = myPrivilege.object();
""
		if (StringUtils.isEmpty(myObjectName)) {
			Object modelObject = null;
			try {
				IModel<?> model = component.getDefaultModel();
				if (model != null) {
					modelObject = model.getObject();

Model:classname=[org.apache.wicket.model.CompoundPropertyModel]:nestedModel=[EntityDetachableModel[systemId=0,dao=com.mpobjects.view.wicket.util.BeanWrapper@1de98279[type=interface com.mpobjects.oms.dao.unittranslation.UnitTranslationDAO,beanName=<null>]]]
/ TODO (ERICJ MODEL FORM)
f (model != null) {
					modelObject = model.getObject();
id=0
/ de .newObject() dus	,
			if (modelObject instanceof EntityInterface) {
/ JA
				BusinessObject myBusinessObject = modelObject.getClass().getAnnotation(BusinessObject.class);
null
				if (myBusinessObject != null) {
/ NEE
				} else {
					return true;

/c
	BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 66	
component	UnitTranslationEditFormPage  (id=17695)	
action	Action  (id=24630)	 ENABLE

	UnitTranslationEditFormPage(Component).isActionAuthorized(Action) line: 2100	
			return authorizationStrategy.isActionAuthorized(this, action);

	UnitTranslationEditFormPage(Component).isEnableAllowed() line: 2124	
		return isActionAuthorized(ENABLE);

	UnitTranslationEditFormPage(Component).isEnabledInHierarchy() line: 4776	
			else
			{
				state = isEnabled() && isEnableAllowed();

	RequestListenerInterface.invoke(Page, Component) line: 169	
	RedirectPageRequestTarget.processEvents(RequestCycle) line: 56	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/s
BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 66	

component	UnitTranslationEditFormPage  (id=17695)	
action	Action  (id=24630)	

/ Intermezzo

@Privilege(object = "unit-translation", type = "list")
public class UnitTranslationEditFormPage extends VOEditFormPage<UnitTranslation> {

/ Einde Intermezzo

		Privilege myPrivilege = component.getClass().getAnnotation(Privilege.class);
@com.mpobjects.view.wicket.util.Privilege(object=unit-translation, type=list)

		String myObjectName = myPrivilege.object();
unit-translation

		if (Action.ENABLE.equals(action.getName())) {
/ JA
			if (!(component instanceof VOEditFormPage || component instanceof EvoEditPage || component instanceof EvoEditFormPage)) {
/ NEE
				// Always enable for lists
				return true;
/ NIET
			}
			myTypeName = EntityAuthorizationFactory.EDIT_TYPE;
"edit"
		myAllow = MpoBeanFactory.getBean(SecurityService.class).isUserAuthorizedOnPrivilege(myObjectName, myTypeName);
myObjectName	"unit-translation" (id=25708)	
myTypeName	"edit" (id=20397)	

/ Dus list -> edit
/ TODO
		myAllow = MpoBeanFactory.getBean(SecurityService.class).isUserAuthorizedOnPrivilege(myObjectName, myTypeName);
false
		if (!myAllow) {
			// ASECFIX not sure if this is correct, non-authenticated users should get a new session during
			// authentication and thus loose this message anyway
			if (AuthenticationUtils.isAuthenticated()) {
				Session.get().error(String.format("User not authorized for privilege: %s.%s", myObjectName, myTypeName));

		return myAllow;
/t
UnitTranslationEditFormPage(Component).isEnabledInHierarchy() line: 4778	
			else
			{
				state = isEnabled() && isEnableAllowed();
true && false=false

/ 13	. 

/c
	BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 66	
component	UnitTranslationEditFormPage  (id=17695)	
action	Action  (id=20112)	 RENDER

	UnitTranslationEditFormPage(Component).isActionAuthorized(Action) line: 2100	
			return authorizationStrategy.isActionAuthorized(this, action);

	UnitTranslationEditFormPage(Page).renderPage() line: 889	
		if (!isActionAuthorized(RENDER))

	RedirectPageRequestTarget(PageRequestTarget).respond(RequestCycle) line: 63	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/s
BaseAuthorizationStrategy.isActionAuthorized(Component, Action) line: 91	

		Privilege myPrivilege = component.getClass().getAnnotation(Privilege.class);
@com.mpobjects.view.wicket.util.Privilege(object=unit-translation, type=list)

		String myObjectName = myPrivilege.object();
unit-translation
		} else if (Action.RENDER.equals(action.getName())) {
			if (!EntityAuthorizationFactory.EDIT_TYPE.equals(myPrivilege.type())) {
/ JA
				// Check if user has either list or view privilege
				myTypeName = LIST;
				if (!MpoBeanFactory.getBean(SecurityService.class).isUserAuthorizedOnPrivilege(myObjectName, myTypeName)) {
/ NEE	, want er staat "unit-translation:list" op UnitTranslationEditFormPage	,
					// try view
					myTypeName = VIEW;
/ NIET
			} else {
/ NIET
				// For few screens (like edit profile), there is no LIST check return true;
/ NIET
			}
		myAllow = MpoBeanFactory.getBean(SecurityService.class).isUserAuthorizedOnPrivilege(myObjectName, myTypeName);
true
/ TODO (Wat als unit-translation:edit op UnitTranslationEditFormPage ? ERICJ ) 
		return myAllow;

/ TODO TANTELY PRIVILEGES 


/ Einde DEBUG PCT-1046

/ SCS-4910 SCS-5015

/ MICHIEL SPRINGBEAN

/ configuration, inventory, grid templates, create new template	,

/ configuration, inventory, grid templates
GridTemplatePage

$ vi GrioTemplatePage.java

		createButton = new AjaxFallbackButton("createButton", createForm) {
			@Override
			protected void onSubmit(AjaxRequestTarget aTarget, Form<?> aForm) {
				GridTemplateEditPage page = getEditPage(new EntityDetachableModel<GridTemplate>(new GridTemplate(), daoWrapper));
/ TODO WH MICHIEL Waarom een entity detachable model op een gridtemplate	?

$ vi GrioTemplatePage.java

	protected GridTemplateEditPage getEditPage(IModel<GridTemplate> aModel) {
		return new GridTemplateEditPage(aModel) {
			...
$ vi GrioTemplatePage.html

	<wicket:extend>
		<div wicket:id="searchList"></div>
		<div style="height:10px"/>
		<form wicket:id="createForm">
		<button wicket:id="createButton" class="icon icon_new" wicket:message="title:create"><span><wicket:message
			key="create">Create new</wicket:message></span></button>
		</form>
		<wicket:child />
	</wicket:extend>

$ vi GridTemplateEditPage.java

	protected void createPageComponents() {
		Form<GridTemplate> form = new Form<GridTemplate>("form", new CompoundPropertyModel<GridTemplate>(model));
		add(form);
->		form.add(new GridTemplateEditPanel("fields", form.getModel()));
		form.add(new EntityActionPanel<GridTemplate>("actions", form.getModel(), getFormActions()));


$ vi GridTemplateEditPanel.java

	@Override
	protected void onInitialize() {
		OrganizationField myOrganizationPanelField = new OrganizationField("organization");
		add(myOrganizationPanelField);

public class OrganizationField extends EvoField<Organization> {

$ vi EvoField.html
			<span wicket:id="evoLookupButton"></span>

public class EvoField<T extends DescribedUniqueFieldValueObject> extends FormComponentPanel<T> {
	protected void createLookupButton() {
		EvoLookupButton<T> btn = new EvoLookupButton<T>("evoLookupButton", daoWrapper, dataProperties) {

/ 7	. 

/ wat is de build version, local	?
/ right click project	, properties, subversion
Last changed revision	,

/ 7	. 

$ vi GridTemplate.standard.hbm.xml
	<class name="com.mpobjects.inventory.model.entity.gridtemplate.GridTemplate" table="INV_GRID_TEMPLATE">

/ In form 'Edit Grid Template'	,
/ we moeten minimaal name, organization, type geven	,
Name: foo
Organization: PNL-CARGO
Type: DISTRIBUTING
Save

/ JUnit tests store we altijd in 	,
Devel/Java/Wicket/wicket-testing/src/test/java/my/test/own/

/ 7	. 

$ vi EvoLookupButton.java

	protected void onInitialize() {
		super.onInitialize();

		if (buttonTitle == null) {
			buttonTitle = new ResourceModel("global-actions.lookup", "Look up");
		}

		window = new ModalWindow("window");

/ 7	. 

/ Lees	,
https://ci.apache.org/projects/wicket/guide/7.x/guide/bestpractices.html#bestpractices_10
25.10 Do not pass components to constructors

/ 7	. 

/ Lees	,
http://www.tutorialspoint.com/servlets/servlets-form-data.htm

/ ze maken een HTML met een form 	, en een servlet	, beide in Tomcat	,

/ dit is een alternative voor Wicket	,

/ 7	. 

/ Lees	,
http://stackoverflow.com/questions/7874695/servlet-vs-restful

/ over servlet & rest	, 

/ 7	. 

$ vi BehaviorStudyPage.java

public class BehaviorStudyPage extends WebPage{
	private String text;
	public BehaviorStudyPage() {
		Form<String>form=new Form<String>("form"){
			protected void onSubmit() {
				FormComponent<String>textField=(FormComponent<String>)get(0);
				IModel<String>model=textField.getModel();
				String string=(String)model.getObject();
				boolean b=false;
			}
		};
		add(form);
		IModel<String>model=new PropertyModel<String>(this, "text");
		FormComponent<String> textField=new TextField<>("text",model);
		form.
		add(textField);
	

$ vi BehaviorStudyPage.html
		<form wicket:id="form">
			<input type="text" wicket:id="text">
		</form>

/ als we de form submit (Enter geven), 	dan valt hij in onSubmit	,

/ we zien in HTML	, dit lezen we ook in boek (45)	,
<input type="text" wicket:id="text" value="foo bar" name="text" wicketpath="form_text">

/ 7. 	

/ Lees	,
https://cwiki.apache.org/confluence/display/WICKET/Migration+to+Wicket+6.0
1.5																6
org.apache.wicket.behavior.SimpleAttributeModifier 				org.apache.wicket.AttributeModifier#replace(...)

/ 7	. 

$ vi BehaviorStudyPage.html

		<form wicket:id="form">
			<input type="text" wicket:id="text">
		</form>

$ vi BehaviorStudyPage.java

public class BehaviorStudyPage extends WebPage{
	
	
	private String text;
	private String css;
	
	
	public BehaviorStudyPage() {
		
		Form<String>form=new Form<String>("form"){
			protected void onSubmit() {
				FormComponent<String>textField=(FormComponent<String>)get(0);
				IModel<String>model=textField.getModel();
				String string=(String)model.getObject();
				boolean b=false;
			}
		};
		add(form);
		IModel<String>model=new PropertyModel<String>(this, "text");
		FormComponent<String> textField=new TextField<>("text",model);
		this.css="border:solid 4px black";
		textField.add(AttributeModifier.append("style",new PropertyModel<String>(this, "css")));
		form.add(textField);

/ OK

/ 7	.

/ Nu doen we iets grappigs: we geven de textField ook de css-model	,

        IModel<String>model=new PropertyModel<String>(this, "css");
        FormComponent<String> textField=new TextField<>("text",model);

/ we zien dat als we in het text field
border:solid 10px orange
Enter
/ dan krijgt het field ook deze style	,

/ 7	. 

/ Lees	,
https://cwiki.apache.org/confluence/display/WICKET/How+to+modify+an+attribute+on+a+HTML+tag

/ we maken een andere attribute modifier	,

$ vi BehaviorStudyPage.html
		<form wicket:id="form">
			<input type="text" wicket:id="css">
		</form>
		<a wicket:id="link">Link</a>

$ vi BehaviorStudyPage.java

	public BehaviorStudyPage() {
		
		Form<String>form=new Form<String>("form"){
			protected void onSubmit() {
				FormComponent<String>textField=(FormComponent<String>)get(0);
				IModel<String>model=textField.getModel();
				String string=(String)model.getObject();
				boolean b=false;
			}
		};
		add(form);
		IModel<String>model=new PropertyModel<String>(this, "css");
		FormComponent<String> textField=new TextField<>("css",model);
		form.add(textField);
		this.css="border:solid 4px black";
		this.text="return confirm(\"Are you sure?\");";
		textField.add(AttributeModifier.append("style",new PropertyModel<String>(this, "css")));
		textField.add(AttributeModifier.append("onmouseover", new PropertyModel(this,"text")));

		
		Link<Void>link=new Link<Void>("link") {
			@Override
			public void onClick() {
				// TODO Auto-generated method stub
				
			}
		};
		add(link);
		link.add(AttributeModifier.append("onclick", new PropertyModel(this,"text")));


/ Als we de link click, of over de textfield met mouse over	, dan zien we een confirm (window)	, 

/ 7	.	 

/ Ga naar	, 
http://examples7x.wicket.apache.org/index.html
/ click ajax	,
/ we zien Modal Window	,

/ we zijn in project wicket-examples-step-by-step	,

$ vi pom.xml

	<properties>
		<wicket.version>7.2.0</wicket.version>

	<dependency>
			<groupId>org.apache.wicket</groupId>
			<artifactId>wicket-extensions</artifactId>
			<version>${wicket.version}</version>
		</dependency>
		<dependency>
			<groupId>org.apache.wicket</groupId>
			<artifactId>wicket-datetime</artifactId>
			<version>${wicket.version}</version>
		</dependency>

[eric@localhost wicket]$ (cd wicket-examples/src/main/java/org/apache/wicket/examples/; cp -a guestbook /home/eric/Devel/Java/Wicket/wicket-examples-step-by-step/src/main/java/org/apache/wicket/examples)
	
$ vi pom.xml

		<dependency>
		    <groupId>org.apache.commons</groupId>
		    <artifactId>commons-lang3</artifactId>
		    <version>3.4</version>
		</dependency>
/ TODO
/ WH is GuestBook veranderd	,

/ Geef	,
http://localhost:9090/wicket-examples-step-by-step/repeater/

$ vi web.xml

  <filter>
    <filter-name>AjaxApplication</filter-name>
    <filter-class>org.apache.wicket.protocol.http.WicketFilter</filter-class>
    <init-param>
      <param-name>applicationClassName</param-name>
      <param-value>org.apache.wicket.examples.ajax.builtin.AjaxApplication</param-value>
    </init-param>
  </filter>
  <filter-mapping>
    <filter-name>AjaxApplication</filter-name>
    <url-pattern>/ajax/*</url-pattern>
    <dispatcher>REQUEST</dispatcher>
    <dispatcher>INCLUDE</dispatcher>
  </filter-mapping>

/ WICKET 7 MODAL WINDOW 

/ Geef	,
http://localhost:9090/wicket-examples-step-by-step/ajax/modal-window?0

/ 7	. 

/ we hebben in wicket-testing ModalWindowStudyPage gemaakt,	
/ ook in wicket-testing1.4

/ 7	. 

/ we zijn in wicket-testing	, 
/ we hebben ModalWindowStudyPage	, 

/ b's
RequestCycle [line: 219] - RequestCycle	
			IRequestHandler handler = resolveRequestHandler();
WebPageRenderer [line: 124] - WebPageRenderer	
			requestablePage.renderPage();
Component [line: 2345] - internalRender()	
				onRender();


/ 7	. 

/ we openen ModalWindow 	,

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head profile="http://selenium-ide.openqa.org/profiles/test-case">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="selenium.base" href="http://localhost:8080/" />
<title>New Test</title>
</head>
<body>
<table cellpadding="1" cellspacing="1" border="1">
<thead>
<tr><td rowspan="1" colspan="3">New Test</td></tr>
</thead><tbody>
<tr>
	<td>open</td>
	<td>/tms/core/index_frameset</td>
	<td></td>
</tr>
<tr>
	<td>selectFrame</td>
	<td>main_frame</td>
	<td></td>
</tr>
<tr>
	<td>click</td>
	<td>link=Grid templates</td>
	<td></td>
</tr>
<tr>
	<td>click</td>
	<td>//button[@wicketpath='createForm_createButton']</td>
	<td></td>
</tr>
<tr>
	<td>type</td>
	<td>//input[@wicketpath='form_fields_code']</td>
	<td>foo</td>
</tr>
<tr>
	<td>click</td>
	<td>//button[@wicketpath='form_fields_organization_evoLookupButton_button']</td>
	<td></td>
</tr>
<tr>
	<td>selectWindow</td>
	<td>name=modal-dialog-pagemap</td>
	<td></td>
</tr>
<tr>
	<td>click</td>
	<td>//button[@wicketpath='evoSearchList_filterForm_group_objectTable_topToolbars_3_toolbar_filters_1_filter_go']</td>
	<td></td>
</tr>
      name="group:objectTable:topToolbars:3:toolbar:filters:1:filter:go" 
wicketpath="evoSearchList_filterForm_group_objectTable_topToolbars_3_toolbar_filters_1_filter_go" 

	<td>click</td>
	<td>//button[@wicketpath='evoSearchList_filterForm_group_objectTable_body_rows_1_cells_1_cell_entity-actions_cell-actions_actions_1_button']</td>
	<td></td>
</tr>
<tr>
	<td>selectWindow</td>
	<td>name=main_frame</td>
	<td></td>
</tr>
<tr>
	<td>select</td>
	<td>//select[@wicketpath='form_fields_gridTemplateType']</td>
	<td>label=DISTRIBUTION</td>
</tr>
<tr>
	<td>click</td>
	<td>//button[@wicketpath='form_actions_actions_2_button']</td>
	<td></td>
</tr>
<tr>
	<td>waitForPageToLoad</td>
	<td>30000</td>
	<td></td>
</tr>
<tr>
	<td>waitForPageToLoad</td>
	<td>30000</td>
	<td></td>
</tr>
<tr>
	<td>waitForPageToLoad</td>
	<td>30000</td>
	<td></td>
</tr>
<tr>
	<td>waitForPageToLoad</td>
	<td>30000</td>
	<td></td>
</tr>

</tbody></table>
</body>
</html>

/ 7	. 

/ Kies 
configuration, inventory, gridtemplates	,
/ click Create new Grid Template
Name: foo
Organization: click vergrootglas
/ click op popup filter	,
/ Kies PNL CARGO
Type: DISTRIBUTING
Save

/ In record , rm line
selectWindow	name=modal-dialog-pagemap

/ save as /home/eric/Devel/Java/Testing/Selenium/grid.html

/ Voordat we play, rm entry uit datbase	,
pnllogistics3=# select*from inv_grid_template;
 system_id | organization_systemid | name | description | grid_template_type | stock_allocation_policy | consolidation_rule_systemid | sho
w_all_templates 
-----------+-----------------------+------+-------------+--------------------+-------------------------+-----------------------------+----
----------------
  26849272 |                   500 | foo  | NULL        | DISTRIBUTION       | NULL                    |                        NULL |    
              0
(1 row)
pnllogistics3=# delete from inv_grid_template;
DELETE 1
pnllogistics3=# commit;
COMMIT

/ Nu play de record	,
/ OK
/ Er verschijnt weer een entry in de database	,
pnllogistics3=# select*from inv_grid_template;
 system_id | organization_systemid | name | description | grid_template_type | stock_allocation_policy | consolidation_rule_systemid | sho
w_all_templates 
-----------+-----------------------+------+-------------+--------------------+-------------------------+-----------------------------+----
----------------
  26849272 |                   500 | foo  | NULL        | DISTRIBUTION       | NULL                    |                        NULL |    
              0
(1 row)


/ Einde SCS-4910 SCS-5015

/ DEBUG SCS-4910 SCS-5015

/ 7	. 


/ Kies 
configuration, inventory, gridtemplates	,

$ less GridTemplatePage.java

	protected void createListPanel() {
		...
->		searchListPanel.setPanelBuilder(new EntityListActionBuilder<GridTemplate>(getPanelActions()));

	protected Collection<EntityAction<GridTemplate>> getPanelActions() {
		EntityActionButton<GridTemplate> editAction = new EntityActionButton<GridTemplate>("edit",
				new ResourceModel("edit").wrapOnAssignment(GridTemplatePage.this)) {
			@Override
			protected void onSubmit(Button aButton, IModel<GridTemplate> aSelection) {
->				setResponsePage(getEditPage(aSelection));
/ of	,
	protected void createNewButton() {
		createButton = new AjaxFallbackButton("createButton", createForm) {
			@Override
			protected void onSubmit(AjaxRequestTarget aTarget, Form<?> aForm) {
->				GridTemplateEditPage page = getEditPage(new EntityDetachableModel<GridTemplate>(new GridTemplate(), daoWrapper));

	protected GridTemplateEditPage getEditPage(IModel<GridTemplate> aModel) {
->		return new GridTemplateEditPage(aModel) {

$ vi GridTemplateEditPage.java
	@Override
	protected void createPageComponents() {
		Form<GridTemplate> form = new Form<GridTemplate>("form", new CompoundPropertyModel<GridTemplate>(model));
		add(form);
->		form.add(new GridTemplateEditPanel("fields", form.getModel()));

$ vi GridTemplateEditPanel.java

->		OrganizationField myOrganizationPanelField = new OrganizationField("organization");

$ vi OrganizationField.java

public class OrganizationField extends EvoField<Organization> {

$ vi EvoField.java

	protected void createLookupButton() {
		EvoLookupButton<T> btn = new EvoLookupButton<T>("evoLookupButton", daoWrapper, dataProperties) {
de
			protected void onPopupClose(AjaxRequestTarget aTarget) {
				aTarget.addComponent(textField);
				aTarget.focusComponent(textField);
/ TODO
				if (descriptionLabel.isVisible()) {
					aTarget.addComponent(descriptionLabel);
				}
/ code en description worden in XML meegestuurd	, 

$ vi EvoLookupButton.java

	@Override
	protected void onInitialize() {
		super.onInitialize();

		if (buttonTitle == null) {
			buttonTitle = new ResourceModel("global-actions.lookup", "Look up");
		}

		window = new ModalWindow("window");
		window.setPageCreator(new PageCreator() {
			@Override
			public Page createPage() {
				return createSelectionPage();
			}
		});
		window.setWindowClosedCallback(new WindowClosedCallback() {
			@Override
			public void onClose(AjaxRequestTarget aTarget) {
				onPopupClose(aTarget);
			}
		});
		add(window);

/ HIER HIER HIER



















/ click op Grid template (list)
/s
	GridTemplatePage$3(GridTemplateEditPage).<init>(IModel<GridTemplate>) line: 34	
	GridTemplatePage$3.<init>(GridTemplatePage, IModel) line: 97	
	GridTemplatePage.getEditPage(IModel<GridTemplate>) line: 97	
		return new GridTemplateEditPage(aModel) {

	GridTemplatePage$2.onSubmit(AjaxRequestTarget, Form<?>) line: 78	
		createButton = new AjaxFallbackButton("createButton", createForm) {
			@Override
			protected void onSubmit(AjaxRequestTarget aTarget, Form<?> aForm) {
->				GridTemplateEditPage page = getEditPage(new EntityDetachableModel<GridTemplate>(new GridTemplate(), daoWrapper));

	AjaxFallbackButton$1.onSubmit(AjaxRequestTarget) line: 74	
	AjaxFallbackButton$1(AjaxFormSubmitBehavior).onEvent(AjaxRequestTarget) line: 156	
	AjaxFallbackButton$1(AjaxEventBehavior).respond(AjaxRequestTarget) line: 177	
	AjaxFallbackButton$1(AbstractDefaultAjaxBehavior).onRequest() line: 312	
	BehaviorRequestTarget.processEvents(RequestCycle) line: 157	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/c
	GridTemplatePage$3(GridTemplateEditPage).initializePage() line: 61	
	GridTemplatePage$3(AbstractPage).onInitialize() line: 91	
		initializePage();

	GridTemplatePage$3(Component).fireInitialize() line: 4105	
	GridTemplatePage$3(MarkupContainer).initialize() line: 433	
	GridTemplatePage$3(Page).prepareForRender(boolean) line: 1543	
	GridTemplatePage$3(Component).prepareForRender() line: 2329	
	GridTemplatePage$3(Page).renderPage() line: 912	
	RedirectPageRequestTarget(PageRequestTarget).respond(RequestCycle) line: 63	
			// Let page render itself
			page.renderPage();

	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/c
	GridTemplatePage$3(GridTemplateEditPage).createPageComponents() line: 40	
->		Form<GridTemplate> form = new Form<GridTemplate>("form", new CompoundPropertyModel<GridTemplate>(model));
		add(form);
		form.add(new GridTemplateEditPanel("fields", form.getModel()));

	GridTemplatePage$3(AbstractPage).initializePage() line: 76	
		createPageComponents();

	GridTemplatePage$3(AbstractMainPage).initializePage() line: 57	
		super.initializePage();

	GridTemplatePage$3(GridTemplateEditPage).initializePage() line: 62	
		pageTitleModel = new StringResourceModel("gridtemplate.edit", this, model, "Edit Grid Template");
/ Hier waren we net	,
->		super.initializePage();

	GridTemplatePage$3(MarkupContainer).initialize() line: 433	
	GridTemplatePage$3(Page).prepareForRender(boolean) line: 1543	
	GridTemplatePage$3(Component).prepareForRender() line: 2329	
	GridTemplatePage$3(Page).renderPage() line: 912	
	RedirectPageRequestTarget(PageRequestTarget).respond(RequestCycle) line: 63	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/c
GridTemplateEditPanel.<init>(String, IModel<GridTemplate>) line: 30	
/ ook in render fase	,

/c
	GridTemplateEditPanel.onInitialize() line: 39	
	protected void onInitialize() {
->		super.onInitialize();

		OrganizationField myOrganizationPanelField = new OrganizationField("organization");
		add(myOrganizationPanelField);

	GridTemplateEditPanel(Component).fireInitialize() line: 4105	
	GridTemplateEditPanel(MarkupContainer).initialize() line: 433	
	Form(MarkupContainer).addedComponent(Component) line: 1000	
	Form(MarkupContainer).add(Component...) line: 142	
	GridTemplatePage$3(GridTemplateEditPage).createPageComponents() line: 42	
	GridTemplatePage$3(AbstractPage).initializePage() line: 76	
	GridTemplatePage$3(AbstractMainPage).initializePage() line: 57	
	GridTemplatePage$3(GridTemplateEditPage).initializePage() line: 62	
	GridTemplatePage$3(AbstractPage).onInitialize() line: 91	
	GridTemplatePage$3(Component).fireInitialize() line: 4105	
	GridTemplatePage$3(MarkupContainer).initialize() line: 433	
	GridTemplatePage$3(Page).prepareForRender(boolean) line: 1543	
	GridTemplatePage$3(Component).prepareForRender() line: 2329	
	GridTemplatePage$3(Page).renderPage() line: 912	
	RedirectPageRequestTarget(PageRequestTarget).respond(RequestCycle) line: 63	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/c
	OrganizationField(EvoField).createLookupButton() line: 208	
	OrganizationField(EvoField).createElements() line: 201	
	OrganizationField(EvoField).onBeforeRender() line: 232	
		if (textField == null) {
			createElements();

	OrganizationField(Component).internalBeforeRender() line: 1069	
	OrganizationField(Component).beforeRender() line: 1103	
	GridTemplateEditPanel(MarkupContainer).onBeforeRenderChildren() line: 1777	
	GridTemplateEditPanel(Component).onBeforeRender() line: 4001	
	GridTemplateEditPanel(Component).internalBeforeRender() line: 1069	
	GridTemplateEditPanel(Component).beforeRender() line: 1103	
	Form(MarkupContainer).onBeforeRenderChildren() line: 1777	
	Form(Component).onBeforeRender() line: 4001	
	Form.onBeforeRender() line: 2104	
	Form(Component).internalBeforeRender() line: 1069	
	Form(Component).beforeRender() line: 1103	
	GridTemplatePage$3(MarkupContainer).onBeforeRenderChildren() line: 1777	
	GridTemplatePage$3(Component).onBeforeRender() line: 4001	
	GridTemplatePage$3(Page).onBeforeRender() line: 1555	
	GridTemplatePage$3(Component).internalBeforeRender() line: 1069	
	GridTemplatePage$3(Component).beforeRender() line: 1103	
	GridTemplatePage$3(Component).prepareForRender(boolean) line: 2297	
	GridTemplatePage$3(Page).prepareForRender(boolean) line: 1545	
	GridTemplatePage$3(Component).prepareForRender() line: 2329	
	GridTemplatePage$3(Page).renderPage() line: 912	
	RedirectPageRequestTarget(PageRequestTarget).respond(RequestCycle) line: 63	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/c
	EvoField.createLookupButton() line: 208	
		EvoLookupButton<T> btn = new EvoLookupButton<T>("evoLookupButton", daoWrapper, dataProperties) {

	EvoField.createElements() line: 201	
		createLookupButton();

	EvoField.onBeforeRender() line: 232	
		if (textField == null) {
			createElements();

	EvoField(Component).internalBeforeRender() line: 1069	

	EvoField(Component).beforeRender() line: 1103	
	GridTemplateEditPanel(MarkupContainer).onBeforeRenderChildren() line: 1777	
	GridTemplateEditPanel(Component).onBeforeRender() line: 4001	
	GridTemplateEditPanel(Component).internalBeforeRender() line: 1069	
	GridTemplateEditPanel(Component).beforeRender() line: 1103	
	Form(MarkupContainer).onBeforeRenderChildren() line: 1777	
	Form(Component).onBeforeRender() line: 4001	
	Form.onBeforeRender() line: 2104	
	Form(Component).internalBeforeRender() line: 1069	
	Form(Component).beforeRender() line: 1103	
	GridTemplatePage$3(MarkupContainer).onBeforeRenderChildren() line: 1777	
	GridTemplatePage$3(Component).onBeforeRender() line: 4001	
	GridTemplatePage$3(Page).onBeforeRender() line: 1555	
	GridTemplatePage$3(Component).internalBeforeRender() line: 1069	
	GridTemplatePage$3(Component).beforeRender() line: 1103	
	GridTemplatePage$3(Component).prepareForRender(boolean) line: 2297	
	GridTemplatePage$3(Page).prepareForRender(boolean) line: 1545	
	GridTemplatePage$3(Component).prepareForRender() line: 2329	
	GridTemplatePage$3(Page).renderPage() line: 912	
	RedirectPageRequestTarget(PageRequestTarget).respond(RequestCycle) line: 63	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/c
/ TODO
	GridTemplateEditPage$1(AbstractEntityActionButton).createButton(IModel<T>, String) line: 220	
	GridTemplateEditPage$1(EntityActionButton).createComponent(String, IModel<T>) line: 49	
	EntityActionPanel.addActionComponent(EntityAction<T>) line: 127	
	EntityActionPanel.onBeforeRender() line: 148	
	EntityActionPanel(Component).internalBeforeRender() line: 1069	
	EntityActionPanel(Component).beforeRender() line: 1103	
	Form(MarkupContainer).onBeforeRenderChildren() line: 1777	
	Form(Component).onBeforeRender() line: 4001	
	Form.onBeforeRender() line: 2104	
	Form(Component).internalBeforeRender() line: 1069	
	Form(Component).beforeRender() line: 1103	
	GridTemplatePage$3(MarkupContainer).onBeforeRenderChildren() line: 1777	
	GridTemplatePage$3(Component).onBeforeRender() line: 4001	
	GridTemplatePage$3(Page).onBeforeRender() line: 1555	
	GridTemplatePage$3(Component).internalBeforeRender() line: 1069	
	GridTemplatePage$3(Component).beforeRender() line: 1103	
	GridTemplatePage$3(Component).prepareForRender(boolean) line: 2297	
	GridTemplatePage$3(Page).prepareForRender(boolean) line: 1545	
	GridTemplatePage$3(Component).prepareForRender() line: 2329	
	GridTemplatePage$3(Page).renderPage() line: 912	
	RedirectPageRequestTarget(PageRequestTarget).respond(RequestCycle) line: 63	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/c
	GridTemplateEditPage$1(AbstractEntityActionButton).createButtonInstance(IModel<T>, String) line: 251	
	GridTemplateEditPage$1(AbstractEntityActionButton).createButton(IModel<T>, String) line: 220	
	GridTemplateEditPage$1(EntityActionButton).createComponent(String, IModel<T>) line: 49	
	EntityActionPanel.addActionComponent(EntityAction<T>) line: 127	
	EntityActionPanel.onBeforeRender() line: 148	
	EntityActionPanel(Component).internalBeforeRender() line: 1069	
	EntityActionPanel(Component).beforeRender() line: 1103	
	Form(MarkupContainer).onBeforeRenderChildren() line: 1777	
	Form(Component).onBeforeRender() line: 4001	
	Form.onBeforeRender() line: 2104	
	Form(Component).internalBeforeRender() line: 1069	
	Form(Component).beforeRender() line: 1103	
	GridTemplatePage$3(MarkupContainer).onBeforeRenderChildren() line: 1777	
	GridTemplatePage$3(Component).onBeforeRender() line: 4001	
	GridTemplatePage$3(Page).onBeforeRender() line: 1555	
	GridTemplatePage$3(Component).internalBeforeRender() line: 1069	
	GridTemplatePage$3(Component).beforeRender() line: 1103	
	GridTemplatePage$3(Component).prepareForRender(boolean) line: 2297	
	GridTemplatePage$3(Page).prepareForRender(boolean) line: 1545	
	GridTemplatePage$3(Component).prepareForRender() line: 2329	
	GridTemplatePage$3(Page).renderPage() line: 912	
	RedirectPageRequestTarget(PageRequestTarget).respond(RequestCycle) line: 63	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/ 7	.; 

/ we click icon naast organization field	,
/s
	EvoLookupButton$4.onEvent(AjaxRequestTarget) line: 169	
		Button button = new Button("button");
		button.add(new AjaxEventBehavior("onclick") {
			@Override
			protected void onEvent(AjaxRequestTarget aTarget) {
->				window.show(aTarget);

	EvoLookupButton$4(AjaxEventBehavior).respond(AjaxRequestTarget) line: 177	
	EvoLookupButton$4(AbstractDefaultAjaxBehavior).onRequest() line: 312	
		WebApplication app = (WebApplication)getComponent().getApplication();
com.mpobjects.view.wicket.WicketWebApplication@2ec414e7
		AjaxRequestTarget target = app.newAjaxRequestTarget(getComponent().getPage());

		RequestCycle.get().setRequestTarget(target);

	BehaviorRequestTarget.processEvents(RequestCycle) line: 157	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/ Eerder	,
$ vi EvoLookupButton.java
	@Override
	protected void onInitialize() {
		super.onInitialize();

		window = new ModalWindow("window");
window	ModalWindow  (id=20903)	
/ wicket ding	,

$ vi ModalWindow.class

public class ModalWindow extends Panel


$ vi ModalWindow.html

<wicket:panel>
	<div wicket:id="content">
	</div>
</wicket:panel>


/ bij ->	,
aTarget	AjaxRequestTarget  (id=20807)	
	page	GridTemplatePage$3  (id=18438)	
/ is WH	,
	protected GridTemplateEditPage getEditPage(IModel<GridTemplate> aModel) {
->		return new GridTemplateEditPage(aModel) {






/ Einde DEBUG SCS-4910 SCS-5015

/ SCS-4910 SCS-5015

$ vi Devel/Java/Testing/Selenium/grid2.html

<tr>
    <td>clickAndWait</td>
    <td>//button[@wicketpath='createForm_createButton']</td>
    <td></td>
</tr>
<tr>
    <td>type</td>
    <td>//input[@wicketpath='form_fields_code']</td>
    <td>foo</td>
</tr>
<tr>
    <td>click</td>
    <td>//button[@wicketpath='form_fields_organization_evoLookupButton_button']</td>
    <td></td>
</tr>
<tr>
    <td>clickAndWait</td>
    <td>//button[@wicketpath='evoSearchList_filterForm_group_objectTable_topToolbars_3_toolbar_filters_1_filter_go']</td>
    <td></td>
</tr>
<tr>
    <td>click</td>
    <td>//button[@wicketpath='evoSearchList_filterForm_group_objectTable_body_rows_1_cells_1_cell_entity-actions_cell-actions_actions_1_button']</td>
    <td></td>
</tr>
<tr>
    <td>selectWindow</td>
    <td>name=main_frame</td>
    <td></td>
</tr>
<tr>
    <td>select</td>
    <td>//select[@wicketpath='form_fields_gridTemplateType']</td>
    <td>label=DISTRIBUTION</td>
</tr>
<tr>
    <td>clickAndWait</td>
    <td>//button[@wicketpath='form_actions_actions_2_button']</td>
    <td></td>
</tr>




/ Einde SCS-4910 SCS-5015

/ FIX SCS-4910 SCS-5015

$ vi EvoLookupButton.java

public abstract class EvoLookupButton<T extends DescribedUniqueFieldValueObject> extends Panel {
	public class PopupSelectionPage extends EvoSelectPage<T> implements IHeaderContributor {		<- IHeaderContributor
		@Override
		public void renderHead(IHeaderResponse response) {
//			response.renderJavascriptReference(new JavascriptResourceReference(PopupSelectionPage.class, "jquery-1.12.1.js"));
			response.renderJavascriptReference(new JavascriptResourceReference(PopupSelectionPage.class, "PopupSelectionPage.js"));
		}

$ vi PopupSelectionPage.js
$(document).ready(function(){
	$(window.frameElement).attr("name","iframe");
});

// / import jquery-1.12.1.js in com.mpobjects.oms.view.wicket.enumeratedvo	,

/ we hoeven jquery niet zelf te doen	, want is er al	,
/ See beneden	,

/ 7	. 

/ op trunk hebben we module/systemlogic/src/java toegevoegd aan buildpath van het project, anders kent hij in 	,
public abstract class AbstractShipmentOrderMsgProcessor extends XMLProcessor {
	private void logEnd(String[] aMonitorMeta) {
		try {
			myRequest.setTransactionId(MessageThreadLocal.get().getContextId());

/ MessageThreadLocal niet	,

/ 7	. 

/ we zien dat jquery.js er al is in PopupSelectionPage	,

$ vi BasePage.html
	<script type="text/javascript" src="script/class.pagerequest.js"></script>

$ vi class.pagerequest.js
importScript("class.screencontainer.js");
importScript("class.eventutils.js");
importScript("class.stringutils.js");
importScript("class.numberutils.js");
importScript("class.focusonfirstfield.js");
importScript("class.dhtmlutils.js");
importScript("mktree.js");
importScript("jquery.min.js");

/ 7	. 

$ ssh vs-test-9
/ met Eric234@MPO


$ less /local/apps/jboss-4.0.5.GA/server/mposcs/deploy/postgresql-ds.xml
                <xa-datasource-class>org.postgresql.xa.PGXADataSource</xa-datasource-class>
                <xa-datasource-property name="ServerName">mposerv8</xa-datasource-property>
                <xa-datasource-property name="PortNumber">5433</xa-datasource-property>
                <xa-datasource-property name="DatabaseName">mposcs-dev</xa-datasource-property>
                <xa-datasource-property name="User">mposcs_dev</xa-datasource-property>
                <xa-datasource-property name="Password">mqi8o0e6aeg56tpghje2bo0gehgthoi6</xa-datasource-property>

/ Dus op mposerv8	,
PGPASSWORD=mqi8o0e6aeg56tpghje2bo0gehgthoi6 psql -U mposcs_dev -h localhost  -p 5433 mposcs-dev

/ kan vanaf laptop	,
[eric@localhost bin]$  ssh mposerv8 "PGPASSWORD=mqi8o0e6aeg56tpghje2bo0gehgthoi6 psql -U mposcs_dev -h localhost  -p 5433 mposcs-dev"
/ TODO

/ Lees	,
https://system.mp-objects.com/xwiki/bin/view/Technology/AutomatedTestEnvironment

/ Einde FIX SCS-4910 SCS-5015

/ PCT-1238 

/ op acc	,
pnllogistics=> select u.*from tms_user u join user_role ur on u.system_id=ur.user_systemid join tms_role r on ur.role_systemid=r.system_id where r.name='R_SALES';
 system_id | user_id |   user_name    | user_email_address | is_enabled | is_deleted |       last_login        | login_attempt | is_first_login |  last_password_update   | chargeable | grace_login | created_by | created_on | user_password | is_interface_account | user_reference1 | user_reference2 | local_account | time_zone 
----------------+---------------+-----------
  26780502 | u_sales | Employee Sales | NULL               |          1 |          0 | 2016-02-22 10:07:36.795 |             0 |             0 | 2015-11-25 13:14:19.699 |          0 |           0 |   26680352 | 2015-06-01 | Welkom01      |                    0 | NULL            | NULL            |             1 | NULL
(1 row)

pnllogistics=> select u.*from tms_user u join user_role ur on u.system_id=ur.user_systemid join tms_role r on ur.role_systemid=r.system_id where r.name='R_FINANCE';
 system_id |        user_id        |     user_name      |     user_email_address      | is_enabled | is_deleted |       last_login        | l ogin_attempt | is_first_login |  last_password_update   | chargeable | grace_login | created_by | created_on | user_password | is_interface_a ccount | user_reference1 | user_reference2 | local_account | time_zone 
-------+-----------------+-----------------+---------------+-----------
  26780071 | u_finance             | Employee financien | NULL                        |          1 |          0 | 2016-03-02 12:58:06.888 |  0 |              0 | 2015-11-25 13:14:46.942 |          0 |           0 |   26680352 | 2015-05-29 | Welkom01      |               0 | NULL            | NULL            |             1 | NULL


select r.*from tms_user u join user_role ur on u.system_id=ur.user_systemid join tms_role r on ur.role_systemid=r.system_id where u.user_id='u_sales';

/ als we met u_finance inlog	, zien we niet 
Estimated Cost
Actual Cost
Price/Cost button	,

/ Met u_sales wel	,
/ Dat komt omdat hij heeft 	,
		showCost = theResource.hasPrivilege("rca-shipment-order-cost", "view");

djansen
Italia72






/ Einde PCT-1238 

/ PAT-391

[jboss@pnl-app-t log]$ for f in $(find -name "server.log*gz");do grep StreamCorruptedException <(gzip -cd "$f");done
/ NIETS, op test of acc	,


/ Einde PAT-391

/ PAT-178

/ 7	. 

/ we zoeken op window.open( in js files	,

/ ze zijn bijna allemaal in mpo-selector.js	,
/ en 	,
./module/oms/war/oms/script/class.service-order_edit.js:	window.open('mailto:' + aToAddress + '?subject=' + subject + '&body=' + body);
./base-framework/core/war/core/script/PopupWindow.js:			this.popupWindow = window.open(avoidAboutBlank?"":"about:blank","window_"+anchorname,this.windowProperties+",width="+this.width+",height="+this.height+",screenX="+this.x+",left="+this.x+",screenY="+this.y+",top="+this.y+"");
./base-framework/core/war/core/script/class.screencontainer.js:		var myWindow = window.open(anUrl, aWindowName, myWindowOptions);
./base-framework/core/war/core/script/popup.shCore.js:{var code=dp.sh.Utils.FixForBlogger(highlighter.originalCode).replace(/</g,'&lt;');var wnd=window.open('','_blank','width=750, height=400, location=0, resizable=1, menubar=0, scrollbars=0');wnd.document.write('<textarea style="width:99%;height:99%">'+code+'</textarea>');wnd.document.close();}},CopyToClipboard:{label:'copy to clipboard',check:function(){return window.clipboardData!=null||dp.sh.ClipboardSwf!=null;},func:function(sender,highlighter)

/ 7	.

/ we geven Enter in Order Type op sho	,

/ we geven Enter op een field	,bijv Hold Status	,

<tr>
	<td class="label">Organization</td>
	<td nowrap="nowrap" class="input">
		<span id="organization_div">
			<span class="selector_visible" id="organization_text_div">
				<input type="text" id="organization" name="organization" value="PNL-CARGO" size="11" class="required listFieldInput" /> 
			</span>
			<span class="selector_invisible" id="organization_select_div">
				<select id="organization_select" name="organization_select" class="invisible"></select>
			</span>
			<span>
->				<button class="small" href="#" id="organization_href" onclick="return mpobjects.ui.selectors.organization('organization');">
					<img src="../lookandfeel/images/icons/lookup.png" border="0" id="organization_icon" class="selector_icon")/>
				</button>
			</span>
		</span>
	</td>
</tr>
/s
mpobjects.ui.selectors.organization = function(target) {
	var elm = document.getElementById(target);
	mpobjects.ui.selectors['organization_' + target] = function(value) {
		DhtmlUtils.setInputValue(elm, value);
	}
	var callback = 'window.opener.mpobjects.ui.selectors.organization_' + target;
	window.open('../wicket/?module=oms&wicketpage=organization.OrganizationSelectPage&callback='
					+ callback, 'Organization','width=400,height=300,scrollbars=yes,resizable=yes');

elem: input#organization.required.listFieldInput
/ ERR
/ Dit is fout	, want dit is het 1ste field	, Organization	,

/ FIX PAT-178

/ Lees	,
http://stackoverflow.com/questions/4763638/enter-triggers-button-click

/ we moeten <button type="button" .../>

/ want default <button .../> zonder type is type="submit"	, dus als we ergens in het form (hoeft niet perse in een textfield, maar ergens tussenin mag ook)	, dan wordt het 1ste button, in dit geval het button naast het organization field,  gesubmit	, 

<button type="button" .../> iso <button .../> obstructs that the first button is triggered when somewhere on the form Enter is given.

/s
ListFieldTag(FieldTag).doStartTag() line: 349	
					appendInputPart(myRet);
/s
ListFieldTag.appendInputPart(StringBuffer) line: 389	
				aBuffer.append("<button type=\"button\" class=\"small\" href=\"#\"");

/ Einde FIX PAT-178



/ Einde PAT-178

/ CEVA-15338

/ 7	. 

Madhavi Gurram

/ we maken nieuwe instance op de trunk	, wartsila 	, dat is voor CEVA tickets	, 

/ in server config	, open launch configuration	, 

Arguments
Program arguments
-c wartsila
VM arguments
${jrebel_args} -Dprogram.name=run.bat -Djava.endorsed.dirs="/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/bin/../lib/endorsed" -Xms128m -Xmx512m -XX:MaxPermSize=512m

Source
Add 
Java project
trunk

External  Archive
/ zoek de jar files van 
spring-orm-3.2.14.RELEASE-sources.jar
wicket-1.4.23-sources.jar
wicket-extensions-1.4.23-sources.jar

/ 7	. 

/ Ga naar	,
https://webvpn.cevalogistics.com
Group: LogisticsWebVPNGroup
sliekerr
Login123

/ we komen vanzelf op	,
/ we download	,
-rw-r-----. 1 eric eric 2979242 Mar  3 15:58 vpnsetup.sh

[eric@localhost server]$ sudo ~eric/bin/vpnsetup.sh 
Installing Cisco AnyConnect VPN Client ...
Extracting installation files to /tmp/vpn.TiNO79...
ciscovpn/
ciscovpn/vpn_install.sh
ciscovpn/vpnagentd
ciscovpn/vpnagentd_init
ciscovpn/vpn_uninstall.sh
ciscovpn/libssl.so.0.9.8
ciscovpn/libcrypto.so.0.9.8
ciscovpn/vpnui
ciscovpn/anyconnect.desktop
ciscovpn/vpn
ciscovpn/pixmaps/
ciscovpn/pixmaps/company-logo.png
ciscovpn/pixmaps/cvc-about.png
ciscovpn/pixmaps/cvc-connect.png
ciscovpn/pixmaps/cvc-disconnect.png
ciscovpn/pixmaps/cvc-info.png
ciscovpn/pixmaps/systray_connected.png
ciscovpn/pixmaps/systray_disconnecting.png
ciscovpn/pixmaps/systray_notconnected.png
ciscovpn/pixmaps/systray_reconnecting.png
ciscovpn/pixmaps/vpnui48.png
ciscovpn/VPNManifest.dat
ciscovpn/vpndownloader.sh
ciscovpn/update.txt
ciscovpn/license.txt
Starting the VPN agent...
Done!

/ Waar is ciscovpn	?
/ TODO

[eric@localhost server]$  ps ajx | grep cisco
    1 27924 27923 27923 ?           -1 S        0   0:00 /opt/cisco/vpn/bin/vpnagentd

/ 7	. 

/ Lees	,
http://ubuntuforums.org/showthread.php?t=855485&page=3
http://its.fsu.edu/content/download/18072/116739/linux.pdf
https://webvpn.cevalogistics.com/CACHE/stc/4/index.html

/ HIER HIER HIER



/ Einde CEVA-15338

/ KRAMP-26


/ Op jenkins	, 
build product: carconmpo
build.svn.baseurl: /braches/2016.01

/ we maken in jenkins	,
tms-carconmpo-22684-2016.01_build3840.zip

/ 7	. 

/ op kramp-app-t	,
[jboss@kramp-app-t carcon]$ pwd
/local/apps/jboss-4.0.5.GA/server/carcon

[jboss@kramp-app-t carcon]$ cat deploy/firebird-ds.xml 
<datasources>
   <local-tx-datasource>
     <connection-url>jdbc:firebirdsql://localhost//local/apps/firebird/carconserver.fdb</connection-url>
     <driver-class>org.firebirdsql.jdbc.FBDriver</driver-class>
     <user-name>SYSDBA</user-name>
     <password>masterkey</password>

/ we maken op laptop	,

[eric@localhost bin]$ cat kramp-carcon-db-t.sh 
#!/bin/bash
isql-fb -u sysdba -p masterkey kramp-app-t.intermax.mp-objects.com:/local/apps/firebird/carconserver.fdb


/ 7	. 

[eric@localhost bin]$ cat kramp-ssh-t.sh 
#!/bin/bash
ssh vanderveldene@kramp-app-t.intermax.mp-objects.com

/ op laptop	,
[vanderveldene@kramp-app-t ~]$ less /local/apps/jboss-4.0.5.GA/server/kramp/deploy/postgres-ds.xml 
                <xa-datasource-property name="User">kramp</xa-datasource-property>
                <xa-datasource-property name="Password">nljP2KQghRrR3sNAvKRERWiuSoaB7MrW</xa-datasource-property>

[vanderveldene@kramp-app-t ~]$ PGPASSWORD=nljP2KQghRrR3sNAvKRERWiuSoaB7MrW psql -U kramp -h localhost
kramp=> \dg
    Role name    |                   Attributes                   | Member of 
 vanderveldene   | Superuser                                      | {}

/ Dus we kunnen maken op laptop	,
[eric@localhost bin]$ cat kramp-db-t.sh 
#!/usr/bin/bash
PGPASSWORD=h^Zgcyr\&Q psql -U vanderveldene -h  kramp-app-t.intermax.mp-objects.com kramp

/ we hadden per ongeluk ERR	,
[jboss@kramp-app-t ~]$ deploy-kramp.sh /local/apps/releases/tms-carconmpo-22684-2016.01_build3840.zip /local/apps/jboss-4.0.5.GA/server/carcon

/ we moeten de mpo_scs_table in kramp db herstellen	,

kramp=# select count(*)from mpo_scs_patch where module='carconserver';
-[ RECORD 1 ]
count | 103
kramp=# delete from  mpo_scs_patch where module='tntexpressconnect';
DELETE 8
# commit

/ Dan gaat OK	,
[jboss@kramp-app-t ~]$ deploy-kramp.sh /local/apps/releases/tms-kramp-22602-2016.01_build3805.zip /local/apps/jboss-4.0.5.GA/server/kramp/

/ we zien dat er op kramp geen deploy-carcon.sh is	,

[jboss@bard-app-t ~]$ diff $(locate deploy-bard.sh) $(locate deploy-carcon.sh)
3,4c3
< APP_ID=bard
< BACKUP_RETENTION=10
---
> APP_ID=carcon
144c143
< echo "... cleaning up backup files (all but last ${BACKUP_RETENTION})"
---
> echo "... cleaning up backup files older then 93 days"
147c146
< rem_list=`expr $rem_count '-' "${BACKUP_RETENTION}"`
---
> rem_list=`expr $rem_count '-' '5'`
154d152
< 

/ we doen	,
[jboss@kramp-app-t ~]$ cp -a /local/apps/bin/deploy-kramp.sh /local/apps/bin/deploy-carcon.sh
[jboss@kramp-app-t ~]$ vi /local/apps/bin/deploy-carcon.sh 
#!/bin/bash

APP_ID=carcon

/ Nu	, 
[jboss@kramp-app-t ~]$ deploy-carcon.sh /local/apps/releases/tms-carconmpo-22684-2016.01_build3840.zip /local/apps/jboss-4.0.5.GA/server/carcon/

/ patch errors,

/ 13

$ vi oms/patch-518-product-item-cust-order-index.sql],
2016-03-04 11:16:22,015 ERROR [com.mpobjects.dbpatch.DataBasePatcher] CREATE INDEX pi_cust_order_idx ON tms_product_item (orig_cust_order_id, orig_cust_orderline_id)
Unknown columns in index PI_CUST_ORDER_IDX

/ Maar	eerder zou,
patch-072-9-2-branch.sql	,
SQL_SCRIPT:  
ALTER TABLE TMS_PRODUCT_ITEM ADD ORIG_CUST_ORDER_ID VARCHAR(80);
ALTER TABLE TMS_PRODUCT_ITEM ADD ORIG_CUST_ORDERLINE_ID VARCHAR(80);
/ Staat op APPLIED	,

/ we doen patch-072-9-2-branch.sql met de hand	, 

/ 13	. 

2016-03-04 11:42:55,841 INFO  [com.mpobjects.dbpatch.DataBasePatcher] Executing patch [oms/patch-521-stock-transaction-col.sql] ...
2016-03-04 11:42:55,846 ERROR [com.mpobjects.dbpatch.DataBasePatcher] Problem while executing SQL statement in patch [oms/patch-521-stock-transaction-col.sql]: 
2016-03-04 11:42:55,846 ERROR [com.mpobjects.dbpatch.DataBasePatcher] ALTER TABLE STOCK_TRANSACTION ADD CUSTOMER_ORDER_LINE_SYSTEMID INTEGER

/ De module 'inventory' zit helemaal niet in het project	, dus we moeten deze patch op SKIPPED set, met de hand	,

SQL> update mpo_scs_patch set status='SKIPPED' where name = 'patch-521-stock-transaction-col.sql';

/ 13	. 

2016-03-04 12:03:53,585 INFO  [com.mpobjects.dbpatch.DataBasePatcher] Executing patch [oms/patch-565-stock-transaction-shi.sql] ...
2016-03-04 12:03:53,592 ERROR [com.mpobjects.dbpatch.DataBasePatcher] Problem while executing SQL statement in patch [oms/patch-565-stock-tra
nsaction-shi.sql]: 
2016-03-04 12:03:53,592 ERROR [com.mpobjects.dbpatch.DataBasePatcher] ALTER TABLE STOCK_TRANSACTION ADD SHIPMENT_ITEM_SYSTEMID INTEGER

SQL> update mpo_scs_patch set status='SKIPPED' where name = 'patch-565-stock-transaction-shi.sql';
SQL> commit;

/ 13	. 

2016-03-04 12:09:12,868 ERROR [com.mpobjects.dbpatch.DataBasePatcher] Problem while executing SQL statement in patch [event/patch-025-eventvalue.sql]: 
2016-03-04 12:09:12,868 ERROR [com.mpobjects.dbpatch.DataBasePatcher] ALTER TABLE EVENT_VALUE ADD CONSTRAINT FK_EV_EVENT FOREIGN KEY (EVENT_SYSTEMID) REFERENCES EVENT_EVENT(SYSTEM_ID)
2016-03-04 12:09:12,868 ERROR [com.mpobjects.dbpatch.DataBasePatcher] org.firebirdsql.jdbc.FBSQLException: GDS Exception. 335544351. unsuccessful metadata update
could not find UNIQUE or PRIMARY KEY constraint in table EVENT_EVENT with specified columns

/ Intermezzo

/ firebird en postgres hetzlefde met case	,

/ postgres	,

foo=> create table case_or_not(s varchar(32));
CREATE TABLE
foo=> insert into case_or_not values('CASE'),('case');
INSERT 0 2
foo=> commit;
COMMIT
foo=> select*from case_or_not where s like '%case%';
  s   
------
 case
(1 row)
foo=> select*from case_or_not where lower(s) like '%case%';
  s   
------
 CASE
 case
(2 rows)

/ firebird

SQL> create table case_or_not(s varchar(32));
SQL> insert into case_or_not values('CASE');
SQL> insert into case_or_not values('case');

SQL> select*from case_or_not where s like '%case%';

S                                
================================ 
case                             

SQL>  select*from case_or_not where lower(s) like '%case%';

S                                
================================ 
CASE                             
case               

/ 7	. 

/ alter constraint op column	, 

/ post gres

foo=>  create table not_null ( n int);
CREATE TABLE
foo=> insert into not_null values(1);
INSERT 0 1
foo=> alter table not_null alter column n set not null;
ALTER TABLE


/ firebird	,

SQL> create table not_null(integer n);
SQL>  insert into n values(1);
SQL> create domain intnn as int not null;
SQL> alter table not_null alter n type intnn;




/ Einde Intermezzo

/ nu patch-025 repair	,

/ we doen de constraints op EVENT_EVENT uit event/patch-001.sql met de hand	,

/ we doen eerst	,
SQL>  create domain event_event_system_id_not_null as int not null;
SQL> alter table event_event alter column system_id type event_event_system_id_not_null;

/ Nu de constraints uit event/patch-001.sql	,
alter table event_event add CONSTRAINT "PK_TMS_EVENT" PRIMARY KEY ("SYSTEM_ID");
/ en	,
ALTER TABLE "EVENT_EVENT" ADD CONSTRAINT "FK_EVENT_ACTION" FOREIGN KEY ("CLOSE_ACTION_SYSTEMID") REFERENCES "EVENT_ACTION" ("SYSTEM_ID") ON UPDATE CASCADE;
ALTER TABLE "EVENT_EVENT" ADD CONSTRAINT "FK_EVENT_CONSIGNMENT" FOREIGN KEY ("CONSIGNMENT_SYSTEMID") REFERENCES "CONSIGNMENT" ("SYSTEM_ID") ON UPDATE CASCADE;
ALTER TABLE "EVENT_EVENT" ADD CONSTRAINT "FK_EVENT_EVENT_TYPE" FOREIGN KEY ("EVENT_TYPE_SYSTEMID") REFERENCES "EVENT_TYPE" ("SYSTEM_ID") ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE "EVENT_EVENT" ADD CONSTRAINT "FK_EVENT_ORGANIZATION" FOREIGN KEY ("ORGANIZATION_SYSTEMID") REFERENCES "ORGANIZATION" ("SYSTEM_ID") ON UPDATE CASCADE ON DELETE NO ACTION;
ALTER TABLE "EVENT_EVENT" ADD CONSTRAINT "FK_EVENT_SA" FOREIGN KEY ("SERVICE_ACTION_SYSTEMID") REFERENCES "SERVICE_ACTION" ("SYSTEM_ID") ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE "EVENT_EVENT" ADD CONSTRAINT "FK_EVENT_SO" FOREIGN KEY ("SERVICE_ORDER_SYSTEMID") REFERENCES "SERVICE_ORDER" ("SYSTEM_ID") ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE "EVENT_EVENT" ADD CONSTRAINT "FK_E_ET" FOREIGN KEY ("EVENT_TEMPLATE_SYSTEMID") REFERENCES "EVENT_TEMPLATE" ("SYSTEM_ID");


/ 7	. 

/ rm	, 

/ probeer op laptop	,
[eric@localhost tmp]$ ssh vanderveldene@kramp-app-t.intermax.mp-objects.com "cd /local/apps/jboss-4.0.5.GA/server/carcon/lib;ls -l $(ssh vanderveldene@kramp-app-t.intermax.mp-objects.com "awk '/MUST_BE_REMOVED/ && /2016-03-04 13:27:39/ && /.jar/{print \$7}' /local/apps/jboss-4.0.5.GA/server/carcon/log/server.log" 2>/dev/null)
/ TODO

/ we doen op kramp-app-t	,
[jboss@kramp-app-t ~]$ (cd /local/apps/jboss-4.0.5.GA/server/carcon/lib/; rm -f $(  awk '/MUST_BE_REMOVED/ && /2016-03-04 13:27:39/ && /.jar/{print $7}' /local/apps/jboss-4.0.5.GA/server/carcon/log/server.log))
/ OK

/ 7	. 

/ op laptop	,

[eric@localhost pnllogistics]$ (cd lib;ls -l $(ssh vanderveldene@kramp-app-t.intermax.mp-objects.com "awk '/MISSING/ && /2016-03-04 13:27:39/ && /.jar/{print \$7}' /local/apps/jboss-4.0.5.GA/server/carcon/log/server.log" 2>/dev/null))
/ OK
/ Ze zijn er allemaal op de laptop	, in de pnllogistics/lib/	,

[eric@localhost pnllogistics]$ ssh vanderveldene@kramp-app-t.intermax.mp-objects.com "mkdir Downloads/2016-03-04"
[eric@localhost pnllogistics]$ (cd lib;scp $(ssh vanderveldene@kramp-app-t.intermax.mp-objects.com "awk '/MISSING/ && /2016-03-04 13:27:39/ && /.jar/{print \$7}' /local/apps/jboss-4.0.5.GA/server/carcon/log/server.log") vanderveldene@kramp-app-t.intermax.mp-objects.com:Downloads/2016-03-04)
activeio-core-3.1.4.jar                                                                                         100%  100KB 100.2KB/s   00:00    
activemq-broker-5.10.2.jar                                                                                      100% 1013KB   1.0MB/s   00:00    
activemq-client-5.10.2.jar                                                                                      100% 1151KB   1.1MB/s   00:00    
activemq-kahadb-store-5.10.2.jar                                                                                100%  535KB 534.6KB/s   00:00    
activemq-openwire-legacy-5.10.2.jar                                                                             100%  669KB 669.4KB/s   00:00    
activemq-protobuf-1.1.jar                                                                                       100%  144KB 144.4KB/s   00:00    
activemq-spring-5.10.2.jar                                                                                      100%  159KB 159.0KB/s   00:00    
aspectjweaver-1.7.4.jar                                                                                         100% 1807KB   1.8MB/s   00:00    
barcode4j-2.1.jar                                                                                               100%  268KB 268.0KB/s   00:00    
batik-anim-1.7.jar                                                                                              100%   93KB  93.1KB/s   00:00    
batik-awt-util-1.7.jar                                                                                          100%  392KB 392.4KB/s   00:00    
batik-bridge-1.7.jar                                                                                            100%  546KB 545.8KB/s   00:00    
batik-css-1.7.jar                                                                                               100%  304KB 303.6KB/s   00:00    
batik-dom-1.7.jar                                                                                               100%  169KB 169.5KB/s   00:00    
batik-ext-1.7.jar                                                                                               100%   10KB  10.0KB/s   00:00    
batik-gvt-1.7.jar                                                                                               100%  237KB 237.2KB/s   00:00    
batik-parser-1.7.jar                                                                                            100%   71KB  71.4KB/s   00:00    
batik-script-1.7.jar                                                                                            100%   59KB  59.2KB/s   00:00    
batik-svg-dom-1.7.jar                                                                                           100%  587KB 587.0KB/s   00:00    
batik-svggen-1.7.jar                                                                                            100%  210KB 210.2KB/s   00:00    
batik-util-1.7.jar                                                                                              100%  125KB 125.3KB/s   00:00    
batik-xml-1.7.jar                                                                                               100%   30KB  30.1KB/s   00:00    
bcprov-jdk15on-1.53.jar                                                                                         100% 3183KB   3.1MB/s   00:00    
commons-csv-1.1.jar                                                                                             100%   36KB  36.0KB/s   00:00    
commons-pool-1.5.7.jar                                                                                          100%   98KB  98.3KB/s   00:00    
disruptor-3.3.0.jar                                                                                             100%   78KB  77.7KB/s   00:00    
ehcache-2.10.0.jar                                                                                              100% 8700KB   2.8MB/s   00:03    
hawtbuf-1.10.jar                                                                                                100%   49KB  49.0KB/s   00:00    
hibernate3.6.10.mpo.1.jar                                                                                       100% 4070KB   4.0MB/s   00:01    
jackson-annotations-2.6.0.jar                                                                                   100%   46KB  45.9KB/s   00:00    
jackson-core-2.6.0.jar                                                                                          100%  253KB 252.8KB/s   00:00    
jackson-databind-2.6.0.jar                                                                                      100% 1134KB   1.1MB/s   00:00    
jericho-html-3.3.jar                                                                                            100%  218KB 218.0KB/s   00:00    
kahadb-5.3.0.jar                                                                                                100%  149KB 148.9KB/s   00:00    
opensaml-2.6.4.jar                                                                                              100% 1381KB   1.4MB/s   00:00    
openws-1.5.4.jar                                                                                                100%  561KB 560.6KB/s   00:00    
postgresql-9.4-1200.jdbc4.jar                                                                                   100%  628KB 627.8KB/s   00:00    
quartz-1.8.6.jar                                                                                                100%  439KB 438.6KB/s   00:00    
spring-aop-3.2.14.RELEASE.jar                                                                                   100%  331KB 330.7KB/s   00:00    
spring-aspects-3.2.14.RELEASE.jar                                                                               100%   50KB  50.2KB/s   00:00    
spring-beans-3.2.14.RELEASE.jar                                                                                 100%  600KB 600.1KB/s   00:00    
spring-context-3.2.14.RELEASE.jar                                                                               100%  848KB 848.0KB/s   00:00    
spring-context-support-3.2.14.RELEASE.jar                                                                       100%  126KB 125.6KB/s   00:00    
spring-core-3.2.14.RELEASE.jar                                                                                  100%  865KB 864.9KB/s   00:00    
spring-expression-3.2.14.RELEASE.jar                                                                            100%  192KB 192.0KB/s   00:00    
spring-jdbc-3.2.14.RELEASE.jar                                                                                  100%  396KB 396.5KB/s   00:00    
spring-jms-3.2.14.RELEASE.jar                                                                                   100%  202KB 201.5KB/s   00:00    
spring-orm-3.2.14.RELEASE.jar                                                                                   100%  377KB 376.6KB/s   00:00    
spring-security-config-3.2.8.RELEASE.jar                                                                        100%  398KB 398.1KB/s   00:00    
spring-security-core-3.2.8.RELEASE.jar                                                                          100%  363KB 363.0KB/s   00:00    
spring-security-saml2-core-1.0.1.RELEASE.jar                                                                    100%  223KB 222.7KB/s   00:00    
spring-security-web-3.2.8.RELEASE.jar                                                                           100%  339KB 339.3KB/s   00:00    
spring-test-3.2.14.RELEASE.jar                                                                                  100%  448KB 447.6KB/s   00:00    
spring-tx-3.2.14.RELEASE.jar                                                                                    100%  237KB 236.9KB/s   00:00    
spring-web-3.2.14.RELEASE.jar                                                                                   100%  618KB 617.6KB/s   00:00    
wicket-ioc-1.4.23.jar                                                                                           100%   23KB  22.8KB/s   00:00    
wicket-spring-1.4.23.jar                                                                                        100%   29KB  28.7KB/s   00:00    
wiquery-1.2.3.2-20150604.122120-1.jar                                                                           100% 1692KB   1.7MB/s   00:00    
xbean-spring-3.18.jar                                                                                           100%  128KB 128.1KB/s   00:00    
xml-apis-ext-1.3.04.jar                                                                                         100%   84KB  83.7KB/s   00:00    
xmlsec-1.5.7.jar                                                                                                100%  641KB 640.6KB/s   00:00    
xmltooling-1.4.4.jar                                                                                            100%  656KB 656.5KB/s   00:00    

[eric@localhost pnllogistics]$ ssh vanderveldene@kramp-app-t.intermax.mp-objects.com "ls  Downloads/2016-03-04"
/ OK

/ op kramp-ssh-t	,
[jboss@kramp-app-t ~]$ cp -a $(find  ~vanderveldene/Downloads/2016-03-04/ -name "*.jar") /local/apps/jboss-4.0.5.GA/server/carcon/lib/

/ 13	. 

/  we zien een checksum mismatch op kramp-app-t	,

2016-03-04 14:10:36,136 ERROR [com.mpobjects.libcheck.LibCheckService]  CHECKSUM_MISMATCH : rtcalltree-0.1.0-SNAPSHOT.jar
2016-03-04 14:10:36,138 ERROR [com.mpobjects.libcheck.LibCheckService] Summary:         CHECKSUM_MISMATCH=1     MISSING=0       MUST_BE_REMOVED=0       OK=288

/ we doen op de laptop	,
[eric@localhost pnllogistics]$ (cd lib; scp rtcalltree-0.1.0-SNAPSHOT.jar vanderveldene@kramp-app-t.intermax.mp-objects.com:Downloads/2016-03-04)

/ op kramp-app-t	,
[jboss@kramp-app-t ~]$ cp -a ~vanderveldene/Downloads/2016-03-04/rtcalltree-0.1.0-SNAPSHOT.jar /local/apps/jboss-4.0.5.GA/server/carcon/lib/

/ 7	. 

/ Hetzelfde op acc	,

/ 13	. 

/ we maken op laptop	,
[eric@localhost bin]$ cat kramp-carcon-db-a.sh 
#!/bin/bash
isql-fb -u sysdba -p masterkey kramp-app-a.intermax.mp-objects.com:/local/apps/firebird/carconserver.fdb

/ 13	. 

/ copy carcon build over from test to acc	,

[eric@localhost tmp]$ ssh vanderveldene@kramp-app-t.intermax.mp-objects.com 2>/dev/null "awk '/carcon/' <(find /local/apps/releases)"
/local/apps/releases/tms-carconmpo-22684-2016.01_build3840.zip

/ Omdat we het hele pad hebben kunnen we overhalen	,
[eric@localhost tmp]$ scp vanderveldene@kramp-app-t.intermax.mp-objects.com:$(ssh vanderveldene@kramp-app-t.intermax.mp-objects.com 2>/dev/null "awk '/carcon/' <(find /local/apps/releases)") .

[eric@localhost tmp]$ ssh vanderveldene@kramp-app-a.intermax.mp-objects.com 2>/dev/null "mkdir Downloads/2016-03-08"

/ Intermezzo

/ <(...) is als | 
/ $(...) is als | xargs

/ awk levert een file (stdout)

[eric@localhost ShortTests]$ awk '/cast/ && /java/' <(find -type f)
./cast.java

eric@localhost ShortTests]$ awk '/cast/ && /java/' <(find -type f) | cat
./cast.java
[eric@localhost ShortTests]$ awk '/cast/ && /java/' <(find -type f) | xargs cat
public class cast{

	public static void main(String...args){
		new cast();
	}
	public cast(){
		Object o=new Integer(7);
		int i=(int)o;
		System.out.println(i);
	}
}

[eric@localhost ShortTests]$ cat <(awk '/cast/ && /java/' <(find -type f))
./cast.java
[eric@localhost ShortTests]$ cat $(awk '/cast/ && /java/' <(find -type f))
public class cast{

	public static void main(String...args){
		new cast();
	}
	public cast(){
		Object o=new Integer(7);
		int i=(int)o;
		System.out.println(i);
	}
}

/ Einde Intermezzo

/ 13	. 

/ we deden	,
[eric@localhost tmp]$ scp vanderveldene@kramp-app-t.intermax.mp-objects.com:$(ssh vanderveldene@kramp-app-t.intermax.mp-objects.com 2>/dev/null "awk '/carcon/' <(find /local/apps/releases)") .

/ we willen scp vervangen door	ssh ,	 door ssh "cat ..." te doen	,  dan kunnen we | 	, dat kan bij scp niet	,
ssh work.workdomain 'cat foo.tar.bz2' | tar -jxv 

/ TODO

/ 13	. 

$ ssh vanderveldene@kramp-app-t.intermax.mp-objects.com 2>/dev/null "awk '/carcon/' <(find /local/apps/releases)"/local/apps/releases/tms-carconmpo-22684-2016.01_build3840.zip

/ Hoe in 1 keer	, van deze file	, 
$ ssh vanderveldene@kramp-app-t.intermax.mp-objects.com 2>/dev/null "ls -l ..." 

/ TODO

/ 13	. 

/ kramp heeft postgres db	, carcon firebird	, deze zien we	,

[jboss@kramp-app-a releases]$ ls /local/apps/firebird/
carconserver.fbk  carconserver.fdb

/ 13	. 

[eric@localhost bin]$ kramp-carcon-db-a.sh 
Database:  kramp-app-a.intermax.mp-objects.com:/local/apps/firebird/carconserver.fdb, User: sysdba
SQL> 

[jboss@kramp-app-a releases]$ carcon stop
[jboss@kramp-app-a releases]$ deploy-carcon.sh /local/apps/releases/tms-carconmpo-22684-2016.01_build3840.zip /local/apps/jboss-4.0.5.GA/server/carcon/

/ we hebben maar 1 patch error op acc	,
$ vi oms/patch-518-product-item-cust-order-index.sql],

/ 13	. 

/ cp missing jars uit log op kramp-app-t naar kramp-app-t	,

[eric@localhost pnllogistics]$ (cd lib;scp $(ssh vanderveldene@kramp-app-a.intermax.mp-objects.com "awk '/MISSING/ && /2016-03-08 12:17:24/ && /.jar/{print \$7}' /local/apps/jboss-4.0.5.GA/server/carcon/log/server.log" 2>/dev/null) vanderveldene@kramp-app-a.intermax.mp-objects.com:Downloads/2016-03-08)

/ op kramp-app-t	,

/ add	, 
[jboss@kramp-app-a ~]$ cp -a $(find ~vanderveldene/Downloads/2016-03-08/ -name "*.jar") /local/apps/jboss-4.0.5.GA/server/carcon/lib/

/ rm	,
jboss@kramp-app-a ~]$ (cd /local/apps/jboss-4.0.5.GA/server/carcon/lib/; rm -f  $( awk '/MUST_BE_REMOVED/ && /2016-03-08 12:17:24/ && /.jar/{print $7}' /local/apps/jboss-4.0.5.GA/server/carcon/log/server.log ))




/ Einde KRAMP-26

/ CARCON

/ sommige berichten gaan via (eruit), 	carcon, bijv voormelding, labels	
/ andere niet: een sho gaat direct naar SCS

/ stel ik bestel iets bij kramp	,
/ TNT zal de carrier zijn	,
/ kramp werkt met SCS, TNT niet	, 
/ voor wat ik heb besteld, gaat er een voormelding naar TNT, via carcon: carcon bepaalt de accountnumber van kramp , voor de rekening later, want kramp moet de transport bepalen	, en routering, voor track tracing	, 
/ dit zijn allemaal geen SCS gegevens, maar TNT gegevens, dit bepaalt carcon dus voor TNT	, 

/ Einde CARCON

/ KRAMP-202

/ MAANDAGOCHTEND

/ planning, shipment order, search by product
product-item_list

$ vi oms-sitemap.xmap
			<map:action logger="shipmentorder" name="shipmentOrderList" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderListAction"/>			
			<map:match pattern="product-item_list">
				<map:act type="shipmentOrderList"/>			
				<map:call resource="dynatablePage">
					<map:parameter name="xsp" value="xsp/product-item_list.xml"/>
				</map:call>
			</map:match>
$ vi product-item_list.xml

             myTable.addDatabaseColumn("shipment_order_id", "ship.shipment_order_id");
/s
Table.addDatabaseColumn(String, String) line: 245	
		DatabaseColumn myColumn = new DatabaseColumn(aName, aDBColumn);
/s
DatabaseColumn.<init>(String, String) line: 28	
	public DatabaseColumn(String aName, String aDBColumn) {
aName	"shipment_order_id" (id=17782)	
aDBColumn	"ship.shipment_order_id" (id=17783)	
/t
Table.addDatabaseColumn(String, String) line: 246	
		DatabaseColumn myColumn = new DatabaseColumn(aName, aDBColumn);
/d
myColumn	DatabaseColumn  (id=20221)	
	propertyFiltered	false	
	theDBColumn	"ship.shipment_order_id" (id=17783)	
	theFilter	null	
	theFilterUsedFlag	false	
	theFormat	null	
	theHiddenFlag	false	
	theM3Converter	null	
	theName	"shipment_order_id" (id=17782)	
	theOldFilter	null	
	theParentPosition	-1	
	theReloadFlag	true	
	theTable	null	
	theType	0	
	theUsedFlag	false	

		addColumn(myColumn);



/ query	,
SELECT ship.system_id as SYSTEM_ID, ship.shipment_order_id
co.customer_order_number 											/ if(isCustomerOrderJoin)	, NIET
pi.product_item_id, pi.part_number, pi.product_model, pi.product_series, pi.quantity, pi.description,
pi.product_group, 													/ if (!myTable.isFieldHidden("productGroup")) {
pi.product_owner, 													/ if (!myTable.isFieldHidden("productOwner")) {
pi.cost, 
c.currency_code as cost_currency_code,
pi.reference1, 														/ if (!myTable.isFieldHidden("reference1")) { / NIET
pi.reference2 														/ if (!myTable.isFieldHidden("reference2")) { / NIET
pi.reference3 														/ if (!myTable.isFieldHidden("reference3")) {/ NIET
pi.reference4 														/ if (!myTable.isFieldHidden("reference4")) {/ NIET
pi.reference5 														/ if (!myTable.isFieldHidden("reference5")) {/ NIET
pi.reference6 														/ if (!myTable.isFieldHidden("reference6")) {/ NIET
pi.reference7 														/ if (!myTable.isFieldHidden("reference7")) {/ NIET
pi.reference8 														/ if (!myTable.isFieldHidden("reference8")) {/ NIET
pi.reference9 														/ if (!myTable.isFieldHidden("reference9")) {	/ NIET
pi.reference10														/ if (!myTable.isFieldHidden("reference10")) {	/ NIET
ship.from_name, ship.from_city, 
(	
	select country_code 
	from country 
	where system_id=ship.from_country_systemid) as from_country,
ship.to_name, ship.to_city, 
(
	select country_code 
	from country 
	where system_id=ship.to_country_systemid) as to_country,
os.status_description, 
ship.planned_departure_after, ship.planned_arrival_after, ship.system_entry_date 

from shipment_order ship 
inner join tms_product_item pi on ship.system_id = pi.shipment_order_systemid 
inner join order_status os on ship.status_code_systemid = os.system_id 
left join currency c on pi.cost_currency_systemid = c.system_id 

left join customer_order_line col on pi.customer_order_line_systemid = col.system_id 	/ if(isCustomerOrderJoin) / NIET
join customer_order co on col.customer_order_systemid = co.system_id		/ if(isCustomerOrderJoin) NIET 

where ship.is_template = 0 
-#1 AND ship.to_country_systemid in (select SYSTEM_ID FROM COUNTRY WHERE ? ) #-		/ NIET
-#2 AND ship.from_country_systemid in (select SYSTEM_ID FROM COUNTRY WHERE ? ) #-	/ NIET

 AND ship.ORGANIZATION_SYSTEMID IN {USER_ORGANIZATIONS}

/ we zien in de postgres log	,
LOG:  execute <unnamed>: 
SELECT ship.system_id as SYSTEM_ID, ship.shipment_order_id, 
pi.product_item_id, pi.part_number, pi.product_model,
 pi.product_series, pi.quantity, pi.description, 
pi.product_group,pi.product_owner,pi.cost, c.currency_code as cost_currency_code, 
ship.from_name, ship.from_city, (
	select country_code from country where system_id=ship.from_country_systemid) as from_country,ship.to_name, 
ship.to_city, (
	select country_code from country where system_id=ship.to_country_systemid) as to_country,
os.status_description, ship.planned_deprture_after, ship.planned_arrival_after, ship.system_entry_date 

from shipment_order ship 
inner join tms_product_item pi on ship.system_id = pi.shipment_order_systemid 
inner join order_status os on ship.status_code_systemid = os.system_id 
left join currency c on pi.cost_currency_systemid = c.system_id 
where ship.is_template = 0  
AND ship.ORGANIZATION_SYSTEMID IN (0,500,1020,1010,1) 
FETCH FIRST 100 ROWS ONLY

/ 7	. 

/ Hoe wordt theName in Column used	?

/ In language files	,

/ calls LanguageManager	,

/s
CacheColumn(Column).getLabel(String, LanguageManager) line: 103	
		String myRet = aLanguageManager.get(aTableName, getName());
aTableName	"product-item-search" (id=22670)	
getName()=theName="shipment_order_id"
/ In language_en_GB_pnllogistics.properties	,
shipment_order_id=Shipment Order

/ 7	. 

/ isFieldHidden	,

/ calls ApplicationPropertyMananger	,

/s
Table.isFieldHidden(String) line: 641	
aFieldName	"productGroup" (id=22899)	

		String myModule = EntityActionUtil.getModule(new RequestAdaptor(getRequest()));
oms
		String myEntity = StringUtils.formatToPropertiesKey(getName());
productitemsearch
		String myFieldName = StringUtils.formatToPropertiesKey(aFieldName.toLowerCase());
productgroup
		String myKey = myEntity + "." + myFieldName + ".hidden";
productitemsearch.productgroup.hidden
		boolean isHidden = ApplicationPropertyManager.getInstance().getModuleProperty(myModule, myKey, false);

/ Dus zo moet de property eruit zien	,
module.oms.productitemsearch.productgroup.hidden

/ 7	. 

/ we kunnen de properties maken	,
module.oms.productitemsearch.origcustorderid.hidden
module.oms.productitemsearch.origcustorderlineid.hidden


/ 7

/ Als we conf/application.properties edit, en reload config	, dan	,

org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'sessionFactory' defined in file [/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnllogistics/deploy/tms.war/WEB-INF/classes/core-base.sb.xml]: Cannot create inner bean 'org.springframework.jdbc.support.lob.DefaultLobHandler#5faa8c3f' of type [org.springframework.jdbc.support.lob.DefaultLobHandler] while setting bean property 'lobHandler'; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'DeferredEventPurgeTaskTimerFactory' defined in file [/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnllogistics/deploy/tms.war/WEB-INF/classes/event-service.sb.xml]: Invocation of init method failed; nested exception is java.lang.IllegalStateException: Task already scheduled or cancelled
	org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveInnerBean(BeanDefinitionValueResolver.java:287)
	org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:122)
	org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1419)
	org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1160)
	org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:519)
	org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:458)
	org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:293)
	org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:223)
	org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:290)
	org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:195)
	org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1123)
	com.mpobjects.core.factory.MpoBeanFactory.getBean(MpoBeanFactory.java:80)
	com.mpobjects.core.model.CoreOpenSessionInViewFilter.lookupSessionFactory(CoreOpenSessionInViewFilter.java:17)
	org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.lookupSessionFactory(OpenSessionInViewFilter.java:260)
	org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:191)
	org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:106)
	org.jboss.web.tomcat.filters.ReplyHeaderFilter.doFilter(ReplyHeaderFilter.java:96)

/ TODO

/ FIX KRAMP-202

/ we moeten goed op de volgorde letten	,
/ dat addColumn en de myQuery synchroon lopen	,


$ vi product-item_list.xml


             myTable.addDatabaseColumn("product_item_id", "pi.product_item_id");
             
             myQuery.append("pi.product_item_id,");
             
             
             if(!myTable.isFieldHidden("orig_cust_order_id")){
             	myQuery.append("pi.orig_cust_order_id,");
             	myTable.addDatabaseColumn("orig_cust_order_id","pi.orig_cust_order_id");
             }
             if(!myTable.isFieldHidden("orig_cust_orderline_id")){
             	myQuery.append("pi.orig_cust_orderline_id,");
             	myTable.addDatabaseColumn("orig_cust_orderline_id","pi.orig_cust_ordeline_id");
             }        
             
             myQuery.append("pi.part_number, pi.product_model, pi.product_series, pi.quantity, pi.description, ");
             
                         
             myTable.addDatabaseColumn("part_number", "pi.part_number");
             myTable.addDatabaseColumn("model", "pi.product_model");
             myTable.addDatabaseColumn("series", "pi.product_series");
             myTable.addDatabaseColumn("quantity", "pi.quantity", Column.TYPE_NUMBER);
             myTable.addDatabaseColumn("description", "pi.description");


/ To make fields hidden	, 
module.oms.productitemsearch.origcustorderid.hidden
module.oms.productitemsearch.origcustorderlineid.hidden

/ To alter header names	,

pnllogistics.table_product_item_search_orig_cust_orderline_id
table_product_item_search_orig_cust_orderline_id
pnllogistics.orig_cust_orderline_id
orig_cust_orderline_id



/ Einde FIX KRAMP-202


/ Einde KRAMP-202

/ KRAMP-202

/ 7	. 

/ Hoeft niet	, hebben we nog niet gedaan	,
[eric@localhost pnltms]$ PGPASSWORD=h^Zgcyr\&Q pg_dump -Fc -U vanderveldene -h kramp-app-a.intermax.mp-objects.com kramp> /home/eric/DB_TAP/Postgres/Backup/pnltms-t-$(date +%F).dump

 orig_cust_order_id           | character varying(80)  | 
 orig_cust_orderline_id       | character varying(80)  | 

/ Ga naar planning dashboard	,
/ Kies een service order
Baric 	3 (#planned)
/ click op 3	,
/ we zien er 3	, click op de Pickup	, N0052061
/ click op de sho	, SH000055247

/ we maken ee product item op deze sho	, 
Description: <een string>
Quantity: 1
Save

/ we zien de 2 velden orig_cust_order_id ,  orig_cust_orderline_id  NIET	,
/ dus moeten we in de db	,

pnllogistics5a=# select*from shipment_order where shipment_order_id='SH000055247';
-[ RECORD 1 ]------------------+-----------------------------------------
system_id                      | 26898897
pnllogistics5a=# select*from tms_product_item where shipment_order_systemid=26898897;
-[ RECORD 1 ]----------------+---------
system_id                    | 26908209

pnllogistics5a=# update tms_product_item set orig_cust_order_id ='eric' where system_id=  26908209;
UPDATE 1
pnllogistics5a=# update tms_product_item set orig_cust_orderline_id ='sander' where system_id=  26908209;
UPDATE 1
pnllogistics5a=# commit;
COMMIT

/ Ga nu naar planning, shioment order, search by product	,
Geef in Shipment Order : SH000055247
click filter	,
java.lang.IllegalArgumentException: Cannot format given Object as a Number at java.text.DecimalFormat.format(DecimalFormat.java:505) at java.text.Format.format(Format.java:157) at com.mpobjects.view.util.table.Column.getString(Column.java:129) at 

/ Einde KRAMP-202



/ PCT-1112

/ 7	. 

/ database pnllogistics5a,	 
/ sho SH000057037	,
/ we kregen deze door in Search:
Shipment type: euro
/ en dan te sort op shipment order id	, 
/ hij staat bovenaan, Gerard zocht de meest recente, omdat deze autostart heeft	, en hij is 

/ we kunnen de sho SAVE(PLAN)/UNPLAN 
/ we kunnen een PRINT LABEL sa PLAN/UNPLAN

/ PLAN de PRINT LABEL sa. Hij valt in 	,
PnlLogisticsPrintLabelServiceImpl.printLabel(ServiceOrderVO) line: 170	

/ we willen nog een keer in PnlLogisticsPrintLabelServiceImpl.printLabel(ServiceOrderVO)  vallen	, 
/ we UNPLAN de PRINT LABEL sa. UNPLAN de sho	. SAVE de sho	, PLAN de PRINT LABEL sa. 

/ Maar bij deze sho is de PRINT LABEL sa autostart. Dus hoeven we alleen de sho te SAVE (PLAN)	, voor UNPLAN moeten we wel de PRINT LABEL sa UNPLAN	, daarna kunnen we de sho UNPLAN	,

/ Intermezzo

/ Ga naar Service Action Template	,
SAT_PRINT_LABEL_EUROPLATE

Execution mode: AUTO_START

/ Einde Intermezzo

/ 7	. 

/s
			} else if (EURODIS.equals(order.getExecutedByPartyVO().getReference1())) {
				String reportId = ApplicationPropertyManager.getInstance().getModuleProperty(PNLLOGISTICS, "eurodis.report.id", null);
				if (!StringUtils.isBlank(reportId)) {
					HashMap<String, String> params = new HashMap<String, String>();
					String consignmentId = europlategenerator.getNextId(null);
0000000613
					Attachment attachment = reportService.runReport(reportId, params);
/ altijd	,
					if (attachment != null) {
						addAttachment(order, attachment.getFileName(), attachment.getContent(), attachment.getMimeType(), "Eurodis-label");
						order.getDateSetVO().setActualEnd(new Date());
						serviceOrderService.updateServiceOrder(order, true, false);
						result.add(attachment);
					}

/ Hieronder gaat hij maken wat item.setReference2 wordt, en wat we in de shioment item in de GUI zien met als naam Product Reference	, 
/ Deze string bestaat uit verschillende componenten	,
					for (ConsignmentVO consignment : order.getConsignmentList()) {
						for (ServiceActionVO action : consignment.getServiceActionList()) {
							for (ShipmentItemVO item : action.getShipmentOrderVO().getShipmentItemList()) {
								StringBuffer stringBuffer = new StringBuffer();
								stringBuffer.append(order.getExecutedByPartyVO().getReference2());
15848
/=EUROPLATE=carrier	,
								stringBuffer.append(String.format("%02d", i));
158481
/ 1 erbij	,
								stringBuffer.append(consignmentId);
15848010000000613
								stringBuffer.append(order.getReference1());
1584801000000061349
/ 49 is Duitsland	,
								stringBuffer.append(String.format("%05d", Integer.valueOf(order.getToPartyVO().getPostalCode().replaceAll("[^0-9]", ""))));
158480100000006134932130
/ erbij 32130
								item.setReference2(stringBuffer.toString());

								if (StringUtils.isEmpty(item.getReference1())) {
/ NEE

								shipmentItemDAO.save(item);


/ 7	. 

/ sho SH000057037	,
/ als de sho save (planned)	, dan is de PRINT_LABEL autostart 9000	, Unplan deze sa	, 
/ check onder Extra fields: Label required
/ Save sho
/ Zie we op de shi reference2 (Partner reference) veranderd? Dat zou dan fout zijn, want hij was er al	, dat is het issue. 






/ eurodis label -> number gen	, ook als de klant deze al heeft gegeven	,

/ start print label service order	,


/ Einde PCT-1112

/ PAT-432

/ 7	. 

[eric@localhost pnltms]$ PGPASSWORD=h^Zgcyr\&Q pg_dump -Fc -U vanderveldene -h pnl-app-t.intermax.mp-objects.com pnltms > /home/eric/DB_TAP/Postgres/Backup/pnltms-t-$(date +%F).dump

pnllogistics5t=# create database pnltms4t;
CREATE DATABASE

/ pas postgres-ds.xml aan	, in pnltms	,


/ 7	. 

/ uitleg probleem	,

/ Ga naar sho search	,
/ Kies een shipment order in de toekomst	,
0000598263-20160309
/ we zien bij de data	, 09-Mar-2016	,

/ Kies de delivery seo	, N0066123 
/ we komen op service order edit	, 
Service order id: N0066123
Hold status: AT_OPPLA

/ planning, shipment order, mass update
/ search op shipment order id: 0000598263-20160309
/ select deze sho	, click Update

/ we komen op Actie Pagina
Omschrijving: <een string> 
Actions:UNPLAN ORDER
Als we op Authorization Save click , komen er 2 Cancel messages op een queue	,
/TODO

/ 7	. 

/ 
0000005474-20160322

/ Intermezzo

/ 13	. 

/ from timestamp to date, we moeten cast	,
::date

pnltms4t=# \d shipment_order
 requested_departure_before     | timestamp without time zone | 

pnltms4t=# select requested_departure_before from shipment_order  where shipment_order_id='0000598263-20160309';
 requested_departure_before 
----------------------------
 2016-03-09 16:30:00

pnltms4t=# select count(1) from shipment_order  where requested_departure_before::date = '2016-03-10';
 count 
-------
  1455
(1 row)

pnltms4t=# select count(1) from shipment_order  where requested_departure_before::date > '2016-03-09';
 count 
-------
 17747
(1 row)

/ 13	. 

/ extract	, werkt niet met date, maar alleen met de afzonderlijke fields, 

pnltms4t=# select count(1) from shipment_order  where extract(day from requested_departure_before) = '10'; 
/ of	,
pnltms4t=# select count(1) from shipment_order  where extract(day from requested_departure_before) = 10;
 count 
-------
  2768
(1 row)

/ 13	. 

date_trunc
/ TODO

pnltms4t=# select date_trunc('hour', requested_departure_before) from shipment_order where  extract(day from requested_departure_before) = 10 limit 5;
     date_trunc      
---------------------
 2016-03-10 23:00:00
 2016-03-10 23:00:00
 2016-03-10 23:00:00
 2016-03-10 23:00:00
 2016-03-10 23:00:00
(5 rows)
/ TODO

/ 13	. 

pnltms4t=# select now()::date;
    now     
------------
 2016-03-09
(1 row)

pnltms4t=# select now()::date+1;
  ?column?  
------------
 2016-03-10
(1 row)

/ we willen sho, met requested_departure_before=morgen	,

pnltms4t=# select count(system_id) from shipment_order  where requested_departure_before::date = now()::date+1;
 count 
-------
  1455

/ Ook	,

pnltms4t=# select distinct status_code_systemid from shipment_order;
 status_code_systemid 
----------------------
                    6
                   34
                   28
                    1
                    2
(5 rows)

pnltms4t=# select*from order_status where system_id in (6,34,28,1,2);
 system_id | is_deleted | status_code | status_type | status_description 
-----------+------------+-------------+-------------+--------------------
         1 |          0 | 9000        | ENDED       | FINISHED
         2 |          0 | 8000        | STARTED     | STARTED
         6 |          0 | 1404        | OPEN        | OPEN
        28 |          0 | 1450        | PLANNED     | PLANNED
        34 |          0 | 9500        | CANCELED    | SHIPMENT CANCELED
(5 rows)
(1 row)

pnltms4t=# create view sho_fut as
select sho.system_id,sho.shipment_order_id, sho.action_approval_status,sho.requested_departure_before,os.status_code from shipment_order sho join service_action sa on sa.shipment_order_systemid=sho.system_id join consignment con on sa.consignment_systemid=con.system_id join service_order seo on con.service_order_systemid=seo.system_id join hold_status hs on seo.hold_status_systemid=hs.system_id join order_status os on sho.status_code_systemid =os.system_id where requested_departure_before::date = now()::date+1 and hs.hold_status_code='AT_OPPLA' order by sho.system_id desc limit 15;
 system_id |  shipment_order_id  | action_approval_status | status_code 
-----------+---------------------+------------------------+-------------
  28609704 | 0000734979-20160311 | PENDING                | 1450
  28609683 | 0001230729-20160311 | PENDING                | 1450
  28609651 | 0000299664-20160311 | PENDING                | 1450
  28609637 | 0000009109-20160311 | PENDING                | 1450
  28609295 | 0000801691-20160311 | PENDING                | 1450
  28603239 | 0000299800-20160311 | PENDING                | 1450
  28603226 | 0000299799-20160311 | OPEN                   | 1450
  28603213 | 0000299774-20160311 | OPEN                   | 1450
  28603200 | 0000299824-20160311 | OPEN                   | 1450
  28603187 | 0000299788-20160311 | OPEN                   | 1450
  28603174 | 0000009541-20160311 | OPEN                   | 1450
  28603161 | 0000299812-20160311 | OPEN                   | 1450
  28603148 | 0000009536-20160311 | OPEN                   | 1450
  28603135 | 0000009529-20160311 | OPEN                   | 1450
  28603121 | 0000009538-20160311 | OPEN                   | 1450
/ TODO (update)


/ Voor dat mass update ...,  
action_approval_status         | OPEN
approval_status                | OPEN

/ daarna	,
action_approval_status         | PENDING 
approval_status                | OPEN

/ Als een sho PENDING is	, kun je hem op het Shipment Order Mass Update scherm niet check	,

/ 7	.


pnltms4t=# create view eag_foo as 
select description from mau_action_group where description like 'foo%';
pnltms4t=# select*from existing_eag_desc;
 description 
-------------
 foo
 foo1
 foo2
 foo3
 foo4
 foo5
 foo6
 foo8
 foo9
 foo10
(10 rows)

/ 7	. 

/ create or replace view	,
/ als we een view hebben , en we willen de column veranderen (met ander type), dan moeten we de column name hetzelfde houden	, wel kun je altijd een column add	, 
/ De column in de view heet dus verkeerd,	
/ TODO

foo=> \d y
            Table "public.y"
 Column |       Type        | Modifiers 
--------+-------------------+-----------
 j      | integer           | 
 t      | character varying | 

foo=> create view vy as select j from y;
CREATE VIEW
foo=> select*from vy;
 j 
---
 1
 2
(2 rows)

foo=> create or replace view vy(j) as select t from y;
CREATE VIEW
foo=> select*from vy;
    j    
---------
 Eric J.
 Foo
(2 rows)

/ Einde Intermezzo

/ 7	.

/ DISABLE WICKET BREAKPONTS

QueryViewPanel [line: 119] - QueryViewPanel(String, IModel<QueryDefinition>, List<RowAction>, List<GroupAction>, Set<Serializable>)	
QueryViewPanel [line: 681] - populateItem(ListItem<Object>)	
QueryViewPanel$3$1$1 [line: 650] - setObject(Boolean)	 	/ als we checkbox click	,
CheckPanel$1 [line: 25] - onUpdate(AjaxRequestTarget)	
ShipmentOrderMassUpdatePage$1 [line: 119] - execute(Set<? extends Serializable>)	/ click update button on mass update	,
ShipmentOrderBundleServiceImpl [line: 67] - getShipmentOrdersForBundle(Bundle)	
ShipmentOrderIterator [line: 34] - hasNext()	
ShipmentOrderIterator [line: 39] - next()	

EntityActionGroupPanel$8 [line: 284] - onSubmit() /click Save op Entity Action Group Edit Page, op foo bijv	,

EntityActionGroupPanel$12.onSubmit(AjaxRequestTarget, Form<?>) line: 373	/ click Save onder Authorization	,
/s
EntityActionGroupServiceImpl.startActionGroup(EntityActionGroup) line: 322	
/s
EntityActionGroupServiceImpl [line: 328] - startActionGroup(EntityActionGroup, AuthorizationLevelConfiguration, Set<AuthorizationLevel>)	
EntityActionGroupServiceImpl [line: 385] - startActionGroup(EntityActionGroup, AuthorizationLevelConfiguration, Set<AuthorizationLevel>)	
/s
TransactionHelperImpl [line: 125] - executeAfterCommitTx(Runnable)	
/s
EntityActionGroupServiceImpl$2 [line: 399] - run()	
/s
EntityActionGroupServiceImpl [line: 61] - addToQueue(int)	

/ 7	. 

/ INTERFACING

[eric@localhost bin]$ mk_ssh_passwordless_intermax.sh pnl-int-t
[eric@localhost bin]$ pnl-ssh-int-t.sh 
[vanderveldene@pnl-int-t from-scs]$ pwd
/local/apps/interface/pnltms/jms/from-scs
$ /archive/2016-03/10

[vanderveldene@pnl-int-t 10]$ ls -ltr
-rw-rw-r--+ 1 servicemix servicemix  9464 Mar 10 12:06 ID-pnl-app-t-36558-1457531617496-6-7-2-2-1
-rw-rw-r--+ 1 servicemix servicemix  9210 Mar 10 12:29 ID-pnl-app-t-36558-1457531617496-6-7-4-2-1
-rw-rw-r--+ 1 servicemix servicemix  8956 Mar 10 12:29 ID-pnl-app-t-36558-1457531617496-6-7-1-2-37
-rw-rw-r--+ 1 servicemix servicemix  8956 Mar 10 12:29 ID-pnl-app-t-36558-1457531617496-6-7-2-2-2

[vanderveldene@pnl-int-t 10]$ cat ID-pnl-app-t-36558-1457531617496-6-7-2-2-1 | awk '/SERVICE_ORDER_ID/'
            <mtccore:SERVICE_ORDER_ID>N0078802</mtccore:SERVICE_ORDER_ID>
[vanderveldene@pnl-int-t 10]$ cat ID-pnl-app-t-36558-1457531617496-6-7-4-2-1 | awk '/SERVICE_ORDER_ID/'
            <mtccore:SERVICE_ORDER_ID>N0072982</mtccore:SERVICE_ORDER_ID>
[vanderveldene@pnl-int-t 10]$ cat ID-pnl-app-t-36558-1457531617496-6-7-1-2-37 | awk '/SERVICE_ORDER_ID/'
            <mtccore:SERVICE_ORDER_ID>N0085997</mtccore:SERVICE_ORDER_ID>
[vanderveldene@pnl-int-t 10]$ cat ID-pnl-app-t-36558-1457531617496-6-7-2-2-2 | awk '/SERVICE_ORDER_ID/'
            <mtccore:SERVICE_ORDER_ID>N0085997</mtccore:SERVICE_ORDER_ID>

/ Hoe kunnen we hier de sho achterhalen	?
/ Nee	, want de service order is al unplanned	, de sa's zijn weg	,
select sho.system_id,sho.shipment_order_id, sho.action_approval_status from shipment_order sho join service_action sa on sa.shipment_order_systemid=sho.system_id join consignment con on sa.consignment_systemid=con.system_id join service_order seo on con.service_order_systemid=seo.system_id where seo.service_order_id='N0085997';
(0 rows)

/ 7	. 

/ Op server	,
[eric@localhost pnltms]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnltms
[eric@localhost pnltms]$ vi conf/jboss-service.xml
  <!--
      | The fast in-memory transaction manager.
    -->
   <mbean code="org.jboss.tm.TransactionManagerService"
      name="jboss:service=TransactionManager"
      xmbean-dd="resource:xmdesc/TransactionManagerService-xmbean.xml">
<!--
      <attribute name="TransactionTimeout">300</attribute>
-->
      <attribute name="TransactionTimeout">30000</attribute>
 



	








/ Einde PAT-432

/ PAT-432

/ 7	. 

/ classes die een rol spelen	,
ServiceOrderExportRequest
TriggerTask
ExportServiceOrder.execute
ServiceOrderTypeTrigger
ServiceOrderTriggerHandlerImpl.checkTrigger/.checkForUpdate		, versturende kant	,

/ 7	. 

/ versturende kant van de msg	,

/ We hebben een stack trace	, erboven staan notes	, 

/ Ad 1	.
aSotTrigger	ServiceOrderTypeTrigger  (id=22088)	
	name	"CANCEL TPO VIA UPDATE" (id=22098)	
	onUpdate	Boolean  (id=883)	
		value	true	
	onUpdateExpression	"${serviceOrder.requestedTotalColli}" (id=22123)	
	filterExpressionRule	Rule  (id=22280)	
		ALL
		(jx:serviceOrder:./totalShipmentOrders REGEX 0,
		jx:serviceOrder:./holdStatusVO/code REGEX AT_OPPLA,
		jx:serviceOrder:./serviceOrderTypeVO/code REGEX DELIVERY)

/ ga naar	,
configuratie, execution	, triggers, service order type trigger	,
/ Kies CANCEL TPO VIA UPDATE
/ we zien	,
Filter, 								/ de 3 properties hierboven	,
On Update, checked
On Update Expression: ${serviceOrder.requestedTotalColli}
										/ Als deze is veranderd (hij vergelijkt old seo , en new seo)	, dan 
Actions: CANCEL_TPO						/ wat er moet gebeuren	,

/ Ad 15	, 
/ waar staat dat triggerEventHandlers tot de call in 3 leidt: 
				getTriggerHandler().handleUpdate(getOld(aServiceOrder), aServiceOrder);
/ terwijl deze in 15 ook staat	, 
/ Dus wordt 2 keer called	,

/ stack trace	,

/ 1	,
	ServiceOrderTriggerHandlerImpl.evaluateAndExecuteRequest(ServiceOrderVO, ServiceOrderTypeTrigger) line: 39	
/=
	public boolean evaluateAndExecuteRequest(ServiceOrderVO aServiceOrderVO, ServiceOrderTypeTrigger aSotTrigger) {

		if (checkTrigger(aSotTrigger, aServiceOrderVO)) {
->			TriggerExecutionRequest<ServiceOrderTypeTrigger> myRequest = new TriggerExecutionRequest<ServiceOrderTypeTrigger>(aSotTrigger);
			myRequest.addObject(ServiceOrderResolver.SERVICE_ORDER_SYSTEM_ID, aServiceOrderVO.getSystemId());
			myRequest.addObject(TriggerConstants.RESOURCE_NAME, AuthenticationUtils.getResource().getFullName());
			getTriggerRequestProducer().produce(myRequest);
/2	,
	ServiceOrderTriggerHandlerImpl.handleUpdate(ServiceOrderVO, ServiceOrderVO) line: 109	
...
			mustExecute = mustExecute || (mySotTrigger.getOnPlan() && (myEval.isPlanned() || statusToPlanned));
			mustExecute = mustExecute || (mySotTrigger.getOnUnPlan() && (myEval.isUnPlanned() || statusToUnPlanned));

			mustExecute = mustExecute || (mySotTrigger.getOnPrecalcApproval() && checkPrecalcApproval(mySotTrigger, myOld, myNew));
			mustExecute = mustExecute || (mySotTrigger.getOnPostcalcApproval() && checkPostcalcApproval(mySotTrigger, myOld, myNew));

			if (mustExecute) {
				evaluateAndExecuteRequest(myNew, mySotTrigger);
/ 3	, 
	ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderVO, TMSEventContext, boolean, boolean) line: 1536	
...
				getTriggerHandler().handleUpdate(getOld(aServiceOrder), aServiceOrder);
/ 4	, 
	ServiceOrderCalculationServiceImpl.update(ServiceOrderVO, AlternativeResultSet, List<String>, boolean) line: 177	
		if (orderChanged && aPersist) {
			try {
				LOG.info("Updating service order due to changes by rate calculation.");
				aServiceOrder.calculateTotalCosts();
				// We need to propagate the changes otherwise EventEventListener won't get the update
				TMSEventContext eventCtx = new TMSEventContext();
				eventCtx.removeFlag(TMSEventContext.FLAG_MAY_RATE_CALC);
				aServiceOrder.setRatecalcMd5Hash(RateCalcHashCalculator.calculate(anAlternative.getRateCalculation().getRateAgreementVO(), aServiceOrder));
->				serviceOrderService.updateServiceOrder(aServiceOrder, eventCtx, true, false);

/ 5	,
	RateCalculationVO.applyCorrections(AlternativeResultSet, List<String>, boolean) line: 1009	
			case SERVICE_ORDER:
				// Update the service order cost records
				ServiceOrderVO myServiceOrder = MpoBeanFactory.getBean(ServiceOrderDao.class).getBySystemId(myEntitySystemId);
				if (myServiceOrder != null && !myServiceOrder.isTemplate()) {
->					MpoBeanFactory.getBean(ServiceOrderCalculationService.class).update(myServiceOrder, aResultSet, aLog, aPersist);

/ 6	, 
	RateCalculationVO.applyCorrections(AlternativeResultSet, List<String>) line: 988	
		applyCorrections(aResultSet, aLog, true);

/ 7	, 
	RateCalculationVO.runFor(List<RateAgreementVO>) line: 827	
					if (serviceOrder != null || shipmentOrder != null || customerOrderLine != null) {
						RateCalculationAlternative firstAlt = alternativeList.iterator().next();
						List<String> myLog = getTempLog();
						for (AlternativeResultSet mySet : firstAlt.getResultSetList().values()) {
->						applyCorrections(mySet, myLog);

/ 8	, 
	CalculationServiceImpl.recalculate(LogisticsOrderVO, AgreementType, TMSEventContext) line: 585	
				// Now calculate the rates
				myRateCalculationVO.runFor(mySelectedRateAgreement);

/ 9	, 
	RateCalcEventListener.recalculate(ServiceOrderVO, AgreementType, TMSEventContext) line: 332	
		if (doRecalculate) {
			boolean calculateServiceOrderCostsImmediately = Boolean.parseBoolean(ApplicationPropertyManager.getInstance().getModuleProperty("ratecalc", "serviceorder.calculaterightafterplanning", "false"));

			// calculate in batch or immediately
			if (calculateServiceOrderCostsImmediately) {
				getCalculationService().recalculate(myOrder, AgreementType.SERVICE_ORDER, anEventContext);
/ 10	,
	RateCalcEventListener.recalcServiceOrderCost(Event) line: 234	
		} else if (myType.equals(ServiceOrderEvent.UPDATED) || myType.equals(ServiceOrderEvent.CREATED)) {
			ServiceOrderVO myServiceOrder = ((ServiceOrderEvent) anEvent).getNewServiceOrderVO();
			anEvent.debug("handled by RateCalcEventListener - recalculating cost for [" + myServiceOrder.getServiceOrderId() + "]");
->			recalculate(myServiceOrder, AgreementType.SERVICE_ORDER, anEvent.getEventContext());

/ 11	, 
	RateCalcEventListener.handleEvent(Event) line: 72	
		if (anEvent.getEventContext().hasFlag(TMSEventContext.FLAG_MAY_RATE_CALC)) {
			LOG.debug("Received event: " + anEvent);
			String myRecalcExecution = ApplicationPropertyManager.getInstance().getModuleProperty("ratecalc", "serviceorder.ratecalculation.execution");

			if (myRecalcExecution.equalsIgnoreCase("auto")) {
->				recalcServiceOrderCost(anEvent);

/ 12	, 
	ListenerList.fireEvent(Event<?>) line: 82	
		for (EventListener myListener : theListenerList) {
			LOG.info("Notifying event [" + anEvent.getEventType() + "] to [" + myListener.getClass() + "] eventContext [" + anEvent.getEventContext() + "]");
->			myListener.handleEvent(anEvent);

/ 13	, 
	EventHandlerServiceImpl.handleEvent(Event) line: 109	
			listenerList.fireEvent(anEvent);
/ 14	, 
	ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderVO, ServiceOrderVO, boolean, TMSEventContext) line: 1905	
			eventHandlerService.handleEvent(myEvent);

/ 15	,
	ServiceOrderServiceImpl.deleteConsignment(ConsignmentVO, int) line: 1712	
			} else {
				setDatesAndStatusAfterConsignmentUpdate(myNewServiceOrder);
				serviceOrderDAO.save(myNewServiceOrder);
->>				getTriggerHandler().handleUpdate(myOldServiceOrder, myNewServiceOrder, oldServiceActionTotalCount);
->				triggerEventHandler(myOldServiceOrder, myNewServiceOrder, true, myContext);
////////////////////
getTriggerHandler()=WH ServiceOrderTriggerHandlerImpl	,
/ Bij ->> en -> gebeurt het	, we zitten nu bij ->
/ Maar -> calls in ServiceOrderServiceImpl.updateServiceOrder weer 
getTriggerHandler().handleUpdate(getOld(aServiceOrder), aServiceOrder); 

	ServiceOrderServiceImpl.handleConsignmentDeleted(ConsignmentVO, int) line: 1016	
			deleteConsignment(myOldConsignment, oldServiceActionTotalCount);

	ConsignmentServiceImpl.removeServiceAction(ServiceActionVO, TMSEventContext) line: 705	
			if (myNewConsignment.getServiceActionList().size() == 0) {
				consignmentDAO.removeConsignment(myNewConsignment.getSystemId());
->				serviceOrderService.handleConsignmentDeleted(myOldConsignment, oldServiceActionTotalCount);
->> TODO		triggerEventHandler(myOldConsignment, null, false, aContext);
/ Bij deze gebeurt er ook iets	?

	ConsignmentServiceImpl.removeServiceAction(ServiceActionVO) line: 670	
		removeServiceAction(anAction, new TMSEventContext());

	ConsignmentServiceImpl.handleServiceActionDelete(ServiceActionVO) line: 417	
				ConsignmentVO myOldConsignmentVO = myOldVO.getConsignmentVO();
				if (myOldConsignmentVO != null) {
					LOG.debug("handled by " + this.getClass() + ".handleServiceActionDelete");
					removeServiceAction(myOldVO);

	ServiceActionServiceImpl.updateConsignment(ServiceActionVO, ConsignmentVO) line: 980	
		if (aNewConsignment == null) {
->			consignmentService.handleServiceActionDelete(aServiceAction);
			aServiceAction.setManuallyUnplanned(true);

	ShipmentOrderServiceImpl.unplan(ShipmentOrderVO) line: 1791	
		for (ServiceActionVO serviceAction : reversedList) {
			if (serviceAction.getConsignmentVO() != null) {
				LOG.info("Unplanning service action: " + serviceAction + " from " + aShipmentOrderVO);
->				getServiceActionService().updateConsignment(serviceAction, null);

	UnplanActionType.execute(ShipmentOrderVO) line: 45	
		try {
->			shipmentOrderServiceWrapper.getBean().unplan(aShipmentOrder);

	UnplanActionType(ActionTypeDefinition).executeAction(ShipmentOrderVO, List<EntityActionParameter<?>>) line: 19	
		execute(aShipmentOrder);

	EntityAction.execute(ShipmentOrderVO) line: 33	
		actionType.getDefinition().executeAction(aShipmentOrder, parameters);

	EntityActionGroupServiceImpl.executeActionsForBundleObject(BundleObjectId) line: 160	
					myAction.execute(myShipmentorder);

	EntityActionGroupHandlerImpl.processMessageAsRoot(Message) line: 39	
		if (serializable instanceof BundleObjectId) {
			BundleObjectId myBundleObjectId = (BundleObjectId) serializable;
			LOG.debug("Executing actions for " + myBundleObjectId);
->			entityActionGroupService.executeActionsForBundleObject(myBundleObjectId);

	EntityActionGroupHandlerImpl(AbstractConsumer).onMessage(Message) line: 49	
			processMessageAsRoot(aMessage);

/ 7	. 

/ versturende kant van de msg	,

/ stack trace	,

	ServiceOrderTriggerHandlerImpl.checkForUpdate(ServiceOrderTypeTrigger, ServiceOrderVO, ServiceOrderVO) line: 169	

	ServiceOrderTriggerHandlerImpl.handleUpdate(ServiceOrderVO, ServiceOrderVO) line: 100	
		for (ServiceOrderTypeTrigger mySotTrigger : myList) {
...
->			mustExecute = mustExecute || (mySotTrigger.getOnUpdate() && checkForUpdate(mySotTrigger, myOld, myNew));

	ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderVO, TMSEventContext, boolean, boolean) line: 1536	
				getTriggerHandler().handleUpdate(getOld(aServiceOrder), aServiceOrder);
...
/ See boven	,

/ 7	. 

/ ontvangende kant van de msg	,

/ notes	,

/ ad 1	.

/ ExportServiceOrder is een TriggerTask	,  die in de TriggerAction staat	,

/ ad 2		.  

myTriggerActionList	ArrayList  (id=22414)	
	elementData	Object[1]  (id=22423)	
		[0]	TriggerAction  (id=22410)	
			code	"CANCEL_TPO" (id=22416)	
			configuration	"closeOnSuccess=false;peerType=;purposeCode=CANCEL;onceOnEnd=false;onceOnStart=false;onceOnRelease=false;onceForServiceOrder=false;" (id=22417)	
			description	"Export Cancel TPO" (id=22418)	
			executionOrder	Integer  (id=22427)	
			organization	Organization  (id=22429)	
			parameters	ArrayList  (id=22400)	
[TaskParameter[closeOnSuccess =false], TaskParameter[peerType =null], TaskParameter[purposeCode =CANCEL], TaskParameter[onceOnEnd =false], TaskParameter[onceOnStart =false], TaskParameter[onceOnRelease =false], TaskParameter[onceForServiceOrder =false]]
			performanceMonitorService	null	
			systemId	28418498	
			triggerTask	"EXPORT_SERVICE_ORDER" (id=22434)	
	size	1	

myTask	ExportServiceOrder  (id=22399)	
	parameters	ArrayList  (id=22562)	
[TaskParameter[closeOnSuccess =null], TaskParameter[peerType =null], TaskParameter[purposeCode =null], TaskParameter[onceOnEnd =null], TaskParameter[onceOnStart =null], TaskParameter[onceOnRelease =null], TaskParameter[onceForServiceOrder =null]]
	performanceMonitorService	null	
	systemId	0	
/ Deze zien we in de GUI als EXPORT_SERVICE_ORDER	,

/ Ga naar 
configuratie, execution, triggers, actions	,
/ Kies CANCEL_TPO	, 
/ we zien 
Trigger Task: EXPORT_SERVICE_ORDER

/ Klopt	,
pnltms4t=# select*from so_type_trigger where system_id=28454140;
...
/ ServiceOrderTypeTrigger maps to so_type_trigger	,

/ ad 3 

myRequest	TriggerExecutionRequest  (id=22412)	
	objectMap	HashMap  (id=22401)	
	resource	null	
	triggerSystemId	28454140	
	type	Class (com.mpobjects.oms.model.trigger.ServiceOrderTypeTrigger) (id=2782)	


 

/ stack trace	,

/1	.
	ExportServiceOrder.execute(Collection<TriggerTaskParameter<?>>, Map<String,Serializable>) line: 68	

/2	.
	TriggerActionExecutionServiceImpl.executeRequest(TriggerExecutionRequest<?>) line: 47	
		AbstractTrigger myTrigger = triggerDaoManager.getDao(aRequest.getType()).getBySystemId(aRequest.getTriggerSystemId());
		List<TriggerAction> myTriggerActionList = new ArrayList<TriggerAction>(myTrigger.getTriggerList());
		for (TriggerAction myTriggerAction : myTriggerActionList) {
			TriggerTask myTask = triggerTaskDefinitionManager.getTask(myTriggerAction.getTriggerTask());
->			myTask.execute(myTriggerAction.getParameters(), aRequest.getObjectMap());

/ 3	. 
	TriggerRequestHandlerImpl.onMessage(Message) line: 44	
		try {
			TriggerExecutionRequest<?> myRequest = (TriggerExecutionRequest<?>) ((ObjectMessage) aMessage).getObject();

			triggerActionExecutionService.executeRequest(myRequest);

/ UNPLAN SHIPMENT ORDER 

/ we unplan sho	,

/	7	.

/ versturende kant	,

/ stack trace	,

/ 1	.
	ServiceOrderTriggerHandlerImpl.checkForUpdate(ServiceOrderTypeTrigger, ServiceOrderVO, ServiceOrderVO) line: 169	

/ 2	.
	ServiceOrderTriggerHandlerImpl.determineMustExecute(ServiceOrderVO, ServiceOrderVO, ServiceOrderTypeTrigger, int) line: 242	
		mustExecute = mustExecute || (mySotTrigger.getOnUpdate() && checkForUpdate(mySotTrigger, myOldServiceOrder, myNewServiceOrder));

/ 3	.
	ServiceOrderTriggerHandlerImpl.handleUpdate(ServiceOrderVO, ServiceOrderVO, int) line: 128	
		for (ServiceOrderTypeTrigger mySotTrigger : myList) {
->			boolean mustExecute = determineMustExecute(myOldServiceOrder, myNewServiceOrder, mySotTrigger, oldServiceActionTotalCount);
			if (mustExecute) {
->>STRAKS 		evaluateAndExecuteRequest(myNewServiceOrder, mySotTrigger);


/ 4	.
	ServiceOrderServiceImpl.deleteConsignment(ConsignmentVO, int) line: 1711	
			} else {
				setDatesAndStatusAfterConsignmentUpdate(myNewServiceOrder);
				serviceOrderDAO.save(myNewServiceOrder);
->				getTriggerHandler().handleUpdate(myOldServiceOrder, myNewServiceOrder, oldServiceActionTotalCount);
->>STRAKS		triggerEventHandler(myOldServiceOrder, myNewServiceOrder, true, myContext);
/ Nu in ->	,
...

/c
/ 7	. 

/ versturende kant	,

/ 1	. 
	ServiceOrderTriggerHandlerImpl.checkTrigger(ServiceOrderTypeTrigger, ServiceOrderVO) line: 205	

/ 2	. 
	ServiceOrderTriggerHandlerImpl.evaluateAndExecuteRequest(ServiceOrderVO, ServiceOrderTypeTrigger) line: 38	
->		if (checkTrigger(aSotTrigger, aServiceOrderVO)) {
			TriggerExecutionRequest<ServiceOrderTypeTrigger> myRequest = new TriggerExecutionRequest<ServiceOrderTypeTrigger>(aSotTrigger);
			myRequest.addObject(ServiceOrderResolver.SERVICE_ORDER_SYSTEM_ID, aServiceOrderVO.getSystemId());
			myRequest.addObject(TriggerConstants.RESOURCE_NAME, AuthenticationUtils.getResource().getFullName());
!			getTriggerRequestProducer().produce(myRequest);
			return true;
		}

/ 3	. 
	ServiceOrderTriggerHandlerImpl.handleUpdate(ServiceOrderVO, ServiceOrderVO, int) line: 130	
		List<ServiceOrderTypeTrigger> myList = serviceOrderTypeTriggerDAO.getByServiceOrderType(myNewServiceOrder.getServiceOrderType());
		for (ServiceOrderTypeTrigger mySotTrigger : myList) {
->>ZONET	boolean mustExecute = determineMustExecute(myOldServiceOrder, myNewServiceOrder, mySotTrigger, oldServiceActionTotalCount);
			if (mustExecute) {
->				evaluateAndExecuteRequest(myNewServiceOrder, mySotTrigger);

/ 4	.
	ServiceOrderServiceImpl.deleteConsignment(ConsignmentVO, int) line: 1711	
			} else {
				setDatesAndStatusAfterConsignmentUpdate(myNewServiceOrder);
				serviceOrderDAO.save(myNewServiceOrder);
->				getTriggerHandler().handleUpdate(myOldServiceOrder, myNewServiceOrder, oldServiceActionTotalCount);
				triggerEventHandler(myOldServiceOrder, myNewServiceOrder, true, myContext);

/ c
/ 7	.

	ServiceOrderTriggerHandlerImpl.evaluateAndExecuteRequest(ServiceOrderVO, ServiceOrderTypeTrigger) line: 39	
		if (checkTrigger(aSotTrigger, aServiceOrderVO)) {
->			TriggerExecutionRequest<ServiceOrderTypeTrigger> myRequest = new TriggerExecutionRequest<ServiceOrderTypeTrigger>(aSotTrigger);
			myRequest.addObject(ServiceOrderResolver.SERVICE_ORDER_SYSTEM_ID, aServiceOrderVO.getSystemId());
			myRequest.addObject(TriggerConstants.RESOURCE_NAME, AuthenticationUtils.getResource().getFullName());
			getTriggerRequestProducer().produce(myRequest);
			return true;

	ServiceOrderTriggerHandlerImpl.handleUpdate(ServiceOrderVO, ServiceOrderVO, int) line: 130	
		List<ServiceOrderTypeTrigger> myList = serviceOrderTypeTriggerDAO.getByServiceOrderType(myNewServiceOrder.getServiceOrderType());
		for (ServiceOrderTypeTrigger mySotTrigger : myList) {
			boolean mustExecute = determineMustExecute(myOldServiceOrder, myNewServiceOrder, mySotTrigger, oldServiceActionTotalCount);
			if (mustExecute) {
->				evaluateAndExecuteRequest(myNewServiceOrder, mySotTrigger);

	ServiceOrderServiceImpl.deleteConsignment(ConsignmentVO, int) line: 1711	
			} else {
				setDatesAndStatusAfterConsignmentUpdate(myNewServiceOrder);
				serviceOrderDAO.save(myNewServiceOrder);
->				getTriggerHandler().handleUpdate(myOldServiceOrder, myNewServiceOrder, oldServiceActionTotalCount);
				triggerEventHandler(myOldServiceOrder, myNewServiceOrder, true, myContext);

/ c

/ Duur even	, 
/ 7	. 

/ versturende kant	,

/ stack trace	, 

/ 1	.
	ServiceOrderTriggerHandlerImpl.checkTrigger(ServiceOrderTypeTrigger, ServiceOrderVO) line: 205	

/ 2	.
	ServiceOrderTriggerHandlerImpl.evaluateAndExecuteRequest(ServiceOrderVO, ServiceOrderTypeTrigger) line: 38	
->		if (checkTrigger(aSotTrigger, aServiceOrderVO)) {
			TriggerExecutionRequest<ServiceOrderTypeTrigger> myRequest = new TriggerExecutionRequest<ServiceOrderTypeTrigger>(aSotTrigger);
			myRequest.addObject(ServiceOrderResolver.SERVICE_ORDER_SYSTEM_ID, aServiceOrderVO.getSystemId());
			myRequest.addObject(TriggerConstants.RESOURCE_NAME, AuthenticationUtils.getResource().getFullName());
			getTriggerRequestProducer().produce(myRequest);
			return true;

/ 3	. 
	ServiceOrderTriggerHandlerImpl.handleUpdate(ServiceOrderVO, ServiceOrderVO) line: 109	
...
			mustExecute = mustExecute || (mySotTrigger.getOnUpdate() && checkForUpdate(mySotTrigger, myOld, myNew));
			mustExecute = mustExecute || (mySotTrigger.getOnPlan() && (myEval.isPlanned() || statusToPlanned));
			mustExecute = mustExecute || (mySotTrigger.getOnUnPlan() && (myEval.isUnPlanned() || statusToUnPlanned));
			mustExecute = mustExecute || (mySotTrigger.getOnPrecalcApproval() && checkPrecalcApproval(mySotTrigger, myOld, myNew));
			mustExecute = mustExecute || (mySotTrigger.getOnPostcalcApproval() && checkPostcalcApproval(mySotTrigger, myOld, myNew));
			if (mustExecute) {
->				evaluateAndExecuteRequest(myNew, mySotTrigger);


/ 4	.
	ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderVO, TMSEventContext, boolean, boolean) line: 1536	
				getTriggerHandler().handleUpdate(getOld(aServiceOrder), aServiceOrder);

/ 5	.
	ServiceOrderCalculationServiceImpl.update(ServiceOrderVO, AlternativeResultSet, List<String>, boolean) line: 177	
...
		if (orderChanged && aPersist) {
			try {
				LOG.info("Updating service order due to changes by rate calculation.");
				aServiceOrder.calculateTotalCosts();
				// We need to propagate the changes otherwise EventEventListener won't get the update
				TMSEventContext eventCtx = new TMSEventContext();
				eventCtx.removeFlag(TMSEventContext.FLAG_MAY_RATE_CALC);
->				aServiceOrder.setRatecalcMd5Hash(RateCalcHashCalculator.calculate(anAlternative.getRateCalculation().getRateAgreementVO(), aServiceOrder));

	RateCalculationVO.applyCorrections(AlternativeResultSet, List<String>, boolean) line: 1009	
	RateCalculationVO.applyCorrections(AlternativeResultSet, List<String>) line: 988	
	RateCalculationVO.runFor(List<RateAgreementVO>) line: 827	
	CalculationServiceImpl.recalculate(LogisticsOrderVO, AgreementType, TMSEventContext) line: 585	
	RateCalcEventListener.recalculate(ServiceOrderVO, AgreementType, TMSEventContext) line: 332	
	RateCalcEventListener.recalcServiceOrderCost(Event) line: 234	
	RateCalcEventListener.handleEvent(Event) line: 72	
	ListenerList.fireEvent(Event<?>) line: 82	
	EventHandlerServiceImpl.handleEvent(Event) line: 109	
	ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderVO, ServiceOrderVO, boolean, TMSEventContext) line: 1905	
	ServiceOrderServiceImpl.deleteConsignment(ConsignmentVO, int) line: 1712	
	ServiceOrderServiceImpl.handleConsignmentDeleted(ConsignmentVO, int) line: 1016	
	ConsignmentServiceImpl.removeServiceAction(ServiceActionVO, TMSEventContext) line: 705	
	ConsignmentServiceImpl.removeServiceAction(ServiceActionVO) line: 670	
	ConsignmentServiceImpl.handleServiceActionDelete(ServiceActionVO) line: 417	
	ServiceActionServiceImpl.updateConsignment(ServiceActionVO, ConsignmentVO) line: 980	
	ShipmentOrderServiceImpl.unplan(ShipmentOrderVO) line: 1791	
	UnplanActionType.execute(ShipmentOrderVO) line: 45	
	UnplanActionType(ActionTypeDefinition).executeAction(ShipmentOrderVO, List<EntityActionParameter<?>>) line: 19	
	EntityAction.execute(ShipmentOrderVO) line: 33	
	EntityActionGroupServiceImpl.executeActionsForBundleObject(BundleObjectId) line: 160	
	EntityActionGroupHandlerImpl.processMessageAsRoot(Message) line: 39	
	EntityActionGroupHandlerImpl(AbstractConsumer).onMessage(Message) line: 49	
	Thread.run() line: 745	

/ c
/ 7	. 

/ stack trace	,

	ServiceOrderTriggerHandlerImpl.checkForUpdate(ServiceOrderTypeTrigger, ServiceOrderVO, ServiceOrderVO) line: 166	
	ServiceOrderTriggerHandlerImpl.handleUpdate(ServiceOrderVO, ServiceOrderVO) line: 100	
->			mustExecute = mustExecute || (mySotTrigger.getOnUpdate() && checkForUpdate(mySotTrigger, myOld, myNew));
			mustExecute = mustExecute || (mySotTrigger.getOnPlan() && (myEval.isPlanned() || statusToPlanned));
			mustExecute = mustExecute || (mySotTrigger.getOnUnPlan() && (myEval.isUnPlanned() || statusToUnPlanned));
			mustExecute = mustExecute || (mySotTrigger.getOnPrecalcApproval() && checkPrecalcApproval(mySotTrigger, myOld, myNew));
			mustExecute = mustExecute || (mySotTrigger.getOnPostcalcApproval() && checkPostcalcApproval(mySotTrigger, myOld, myNew));
			if (mustExecute) {
				evaluateAndExecuteRequest(myNew, mySotTrigger);

	ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderVO, TMSEventContext, boolean, boolean) line: 1536	
				getTriggerHandler().handleUpdate(getOld(aServiceOrder), aServiceOrder);

	ServiceOrderCalculationServiceImpl.update(ServiceOrderVO, AlternativeResultSet, List<String>, boolean) line: 177	
		if (orderChanged && aPersist) {
			try {
				LOG.info("Updating service order due to changes by rate calculation.");
				aServiceOrder.calculateTotalCosts();
				// We need to propagate the changes otherwise EventEventListener won't get the update
				TMSEventContext eventCtx = new TMSEventContext();
				eventCtx.removeFlag(TMSEventContext.FLAG_MAY_RATE_CALC);
->				aServiceOrder.setRatecalcMd5Hash(RateCalcHashCalculator.calculate(anAlternative.getRateCalculation().getRateAgreementVO(), aServiceOrder));

	RateCalculationVO.applyCorrections(AlternativeResultSet, List<String>, boolean) line: 1009	
		switch (aResultSet.getEntityType()) {
			case SERVICE_ORDER:
				// Update the service order cost records
				ServiceOrderVO myServiceOrder = MpoBeanFactory.getBean(ServiceOrderDao.class).getBySystemId(myEntitySystemId);
				if (myServiceOrder != null && !myServiceOrder.isTemplate()) {
->					MpoBeanFactory.getBean(ServiceOrderCalculationService.class).update(myServiceOrder, aResultSet, aLog, aPersist);

	RateCalculationVO.applyCorrections(AlternativeResultSet, List<String>) line: 988	
	RateCalculationVO.runFor(List<RateAgreementVO>) line: 827	
	CalculationServiceImpl.recalculate(LogisticsOrderVO, AgreementType, TMSEventContext) line: 585	
	RateCalcEventListener.recalculate(ServiceOrderVO, AgreementType, TMSEventContext) line: 332	
	RateCalcEventListener.recalcServiceOrderCost(Event) line: 234	
	RateCalcEventListener.handleEvent(Event) line: 72	
	ListenerList.fireEvent(Event<?>) line: 82	
	EventHandlerServiceImpl.handleEvent(Event) line: 109	
	ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderVO, ServiceOrderVO, boolean, TMSEventContext) line: 1905	
	ServiceOrderServiceImpl.deleteConsignment(ConsignmentVO, int) line: 1712	
				getTriggerHandler().handleUpdate(myOldServiceOrder, myNewServiceOrder, oldServiceActionTotalCount);
->				triggerEventHandler(myOldServiceOrder, myNewServiceOrder, true, myContext);

	ServiceOrderServiceImpl.handleConsignmentDeleted(ConsignmentVO, int) line: 1016	
	ConsignmentServiceImpl.removeServiceAction(ServiceActionVO, TMSEventContext) line: 705	
	ConsignmentServiceImpl.removeServiceAction(ServiceActionVO) line: 670	
	ConsignmentServiceImpl.handleServiceActionDelete(ServiceActionVO) line: 417	

/ c
/ 7	.

/ stack trace	,

	ServiceOrderTriggerHandlerImpl.checkTrigger(ServiceOrderTypeTrigger, ServiceOrderVO) line: 205	
	ServiceOrderTriggerHandlerImpl.evaluateAndExecuteRequest(ServiceOrderVO, ServiceOrderTypeTrigger) line: 38	
->		if (checkTrigger(aSotTrigger, aServiceOrderVO)) {
			TriggerExecutionRequest<ServiceOrderTypeTrigger> myRequest = new TriggerExecutionRequest<ServiceOrderTypeTrigger>(aSotTrigger);
			myRequest.addObject(ServiceOrderResolver.SERVICE_ORDER_SYSTEM_ID, aServiceOrderVO.getSystemId());
			myRequest.addObject(TriggerConstants.RESOURCE_NAME, AuthenticationUtils.getResource().getFullName());
			getTriggerRequestProducer().produce(myRequest);
			return true;
		}

	ServiceOrderTriggerHandlerImpl.handleUpdate(ServiceOrderVO, ServiceOrderVO) line: 109	
			mustExecute = mustExecute || (mySotTrigger.getOnUpdate() && checkForUpdate(mySotTrigger, myOld, myNew));
			mustExecute = mustExecute || (mySotTrigger.getOnPlan() && (myEval.isPlanned() || statusToPlanned));
			mustExecute = mustExecute || (mySotTrigger.getOnUnPlan() && (myEval.isUnPlanned() || statusToUnPlanned));

			mustExecute = mustExecute || (mySotTrigger.getOnPrecalcApproval() && checkPrecalcApproval(mySotTrigger, myOld, myNew));
			mustExecute = mustExecute || (mySotTrigger.getOnPostcalcApproval() && checkPostcalcApproval(mySotTrigger, myOld, myNew));
			if (mustExecute) {
->				evaluateAndExecuteRequest(myNew, mySotTrigger);

	ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderVO, TMSEventContext, boolean, boolean) line: 1536	
				getTriggerHandler().handleUpdate(getOld(aServiceOrder), aServiceOrder);

	ServiceOrderCalculationServiceImpl.update(ServiceOrderVO, AlternativeResultSet, List<String>, boolean) line: 177	
				serviceOrderService.updateServiceOrder(aServiceOrder, eventCtx, true, false);

	RateCalculationVO.applyCorrections(AlternativeResultSet, List<String>, boolean) line: 1009	
			case SERVICE_ORDER:
				// Update the service order cost records
				ServiceOrderVO myServiceOrder = MpoBeanFactory.getBean(ServiceOrderDao.class).getBySystemId(myEntitySystemId);
				if (myServiceOrder != null && !myServiceOrder.isTemplate()) {
->					MpoBeanFactory.getBean(ServiceOrderCalculationService.class).update(myServiceOrder, aResultSet, aLog, aPersist);

	RateCalculationVO.applyCorrections(AlternativeResultSet, List<String>) line: 988	
	RateCalculationVO.runFor(List<RateAgreementVO>) line: 827	
	CalculationServiceImpl.recalculate(LogisticsOrderVO, AgreementType, TMSEventContext) line: 585	

	RateCalcEventListener.recalculate(ServiceOrderVO, AgreementType, TMSEventContext) line: 332	
	RateCalcEventListener.recalcServiceOrderCost(Event) line: 234	
	RateCalcEventListener.handleEvent(Event) line: 72	
	ListenerList.fireEvent(Event<?>) line: 82	
	EventHandlerServiceImpl.handleEvent(Event) line: 109	
	ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderVO, ServiceOrderVO, boolean, TMSEventContext) line: 1905	
	ServiceOrderServiceImpl.deleteConsignment(ConsignmentVO, int) line: 1712	
				getTriggerHandler().handleUpdate(myOldServiceOrder, myNewServiceOrder, oldServiceActionTotalCount);
->				triggerEventHandler(myOldServiceOrder, myNewServiceOrder, true, myContext);

/ c
/ 7	.

/ versturende kant	,

/ stack trace	,

/1	.
	ServiceOrderTriggerHandlerImpl.evaluateAndExecuteRequest(ServiceOrderVO, ServiceOrderTypeTrigger) line: 39	
		if (checkTrigger(aSotTrigger, aServiceOrderVO)) {
->			TriggerExecutionRequest<ServiceOrderTypeTrigger> myRequest = new TriggerExecutionRequest<ServiceOrderTypeTrigger>(aSotTrigger);
			myRequest.addObject(ServiceOrderResolver.SERVICE_ORDER_SYSTEM_ID, aServiceOrderVO.getSystemId());
			myRequest.addObject(TriggerConstants.RESOURCE_NAME, AuthenticationUtils.getResource().getFullName());
			getTriggerRequestProducer().produce(myRequest);
/ 2	.
	ServiceOrderTriggerHandlerImpl.handleUpdate(ServiceOrderVO, ServiceOrderVO) line: 109	
			mustExecute = mustExecute || (mySotTrigger.getOnUpdate() && checkForUpdate(mySotTrigger, myOld, myNew));
			mustExecute = mustExecute || (mySotTrigger.getOnPlan() && (myEval.isPlanned() || statusToPlanned));
			mustExecute = mustExecute || (mySotTrigger.getOnUnPlan() && (myEval.isUnPlanned() || statusToUnPlanned));
			mustExecute = mustExecute || (mySotTrigger.getOnPrecalcApproval() && checkPrecalcApproval(mySotTrigger, myOld, myNew));
			mustExecute = mustExecute || (mySotTrigger.getOnPostcalcApproval() && checkPostcalcApproval(mySotTrigger, myOld, myNew));
			if (mustExecute) {
->				evaluateAndExecuteRequest(myNew, mySotTrigger);

/	3	.
	ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderVO, TMSEventContext, boolean, boolean) line: 1536	
				getTriggerHandler().handleUpdate(getOld(aServiceOrder), aServiceOrder);

/ 4	.
	ServiceOrderCalculationServiceImpl.update(ServiceOrderVO, AlternativeResultSet, List<String>, boolean) line: 177	
				serviceOrderService.updateServiceOrder(aServiceOrder, eventCtx, true, false);


	RateCalculationVO.applyCorrections(AlternativeResultSet, List<String>, boolean) line: 1009	
	RateCalculationVO.applyCorrections(AlternativeResultSet, List<String>) line: 988	
	RateCalculationVO.runFor(List<RateAgreementVO>) line: 827	
	CalculationServiceImpl.recalculate(LogisticsOrderVO, AgreementType, TMSEventContext) line: 585	

	RateCalcEventListener.recalculate(ServiceOrderVO, AgreementType, TMSEventContext) line: 332	
	RateCalcEventListener.recalcServiceOrderCost(Event) line: 234	
	RateCalcEventListener.handleEvent(Event) line: 72	
	ListenerList.fireEvent(Event<?>) line: 82	
	EventHandlerServiceImpl.handleEvent(Event) line: 109	
	ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderVO, ServiceOrderVO, boolean, TMSEventContext) line: 1905	
	ServiceOrderServiceImpl.deleteConsignment(ConsignmentVO, int) line: 1712	
				getTriggerHandler().handleUpdate(myOldServiceOrder, myNewServiceOrder, oldServiceActionTotalCount);
->				triggerEventHandler(myOldServiceOrder, myNewServiceOrder, true, myContext);


/ c
/ 7	.

/ ontvangende kant	,

/ stack trace	,

/ 1	.
	ConsignmentServiceImpl.removeServiceAction(ServiceActionVO, TMSEventContext) line: 706	
			if (myNewConsignment.getServiceActionList().size() == 0) {
				consignmentDAO.removeConsignment(myNewConsignment.getSystemId());
				serviceOrderService.handleConsignmentDeleted(myOldConsignment, oldServiceActionTotalCount);
->				triggerEventHandler(myOldConsignment, null, false, aContext);

/ 2	.
	ConsignmentServiceImpl.removeServiceAction(ServiceActionVO) line: 670	
		removeServiceAction(anAction, new TMSEventContext());

/ 3	.
	ConsignmentServiceImpl.handleServiceActionDelete(ServiceActionVO) line: 417	
			if (myOldVO != null) {
				// The ServiceAction was removed from the consignment, check the size of the serviceactionlist
				ConsignmentVO myOldConsignmentVO = myOldVO.getConsignmentVO();
				if (myOldConsignmentVO != null) {
					LOG.debug("handled by " + this.getClass() + ".handleServiceActionDelete");
->					removeServiceAction(myOldVO);

/ 4	. 
	ServiceActionServiceImpl.updateConsignment(ServiceActionVO, ConsignmentVO) line: 980	
		if (aNewConsignment == null) {
->			consignmentService.handleServiceActionDelete(aServiceAction);
			aServiceAction.setManuallyUnplanned(true);
/ 5	. 
	ShipmentOrderServiceImpl.unplan(ShipmentOrderVO) line: 1791	
		for (ServiceActionVO serviceAction : reversedList) {
			if (serviceAction.getConsignmentVO() != null) {
				LOG.info("Unplanning service action: " + serviceAction + " from " + aShipmentOrderVO);
->				getServiceActionService().updateConsignment(serviceAction, null);

/ 6	.
	UnplanActionType.execute(ShipmentOrderVO) line: 45	
		try {
			shipmentOrderServiceWrapper.getBean().unplan(aShipmentOrder);
/ 7		.
	UnplanActionType(ActionTypeDefinition).executeAction(ShipmentOrderVO, List<EntityActionParameter<?>>) line: 19	
		execute(aShipmentOrder);
/ 8	.
	EntityAction.execute(ShipmentOrderVO) line: 33	
		actionType.getDefinition().executeAction(aShipmentOrder, parameters);
/ 9	.
	EntityActionGroupServiceImpl.executeActionsForBundleObject(BundleObjectId) line: 160	
			for (EntityAction myAction : myActionGroup.getActions()) {
				if (myAction instanceof GroupActionType) {
					// Do nothing
				} else if (myAction.executeAfterSave()) {
					afterSaveActions.add(myAction);
				} else {
					myCurrentAction = myAction;
					if (!propagateChange && myAction.shouldPropagateChange()) {
						propagateChange = true;
					}
->					myAction.execute(myShipmentorder);

/ 10	.
	EntityActionGroupHandlerImpl.processMessageAsRoot(Message) line: 39	
		ObjectMessage myMessage = (ObjectMessage) aMessage;
		Serializable serializable = myMessage.getObject();
		if (serializable instanceof BundleObjectId) {
			BundleObjectId myBundleObjectId = (BundleObjectId) serializable;
			LOG.debug("Executing actions for " + myBundleObjectId);
->			entityActionGroupService.executeActionsForBundleObject(myBundleObjectId);


/ 11	.
	EntityActionGroupHandlerImpl(AbstractConsumer).onMessage(Message) line: 49	
		Authentication myAuth = runAsService.runAsRoot();
		String myMessageId = "unknown";
		boolean redelivery = false;
		try {
			myMessageId = aMessage.getJMSMessageID();
			redelivery = aMessage.getJMSRedelivered();
			StringBuilder myBuilder = new StringBuilder();
			myBuilder.append("Redelivered message [" + aMessage.getJMSMessageID() + "] in queue ["
					+ aMessage.getJMSDestination() + "], handled by [" + this.getClass().getName() + "]");
			if (redelivery) {
				if (aMessage instanceof ActiveMQObjectMessage) {
					ActiveMQObjectMessage myActiveMQObjectMessage = (ActiveMQObjectMessage) aMessage;
					myBuilder.append(", redeliveryCounter: ").append(myActiveMQObjectMessage.getRedeliveryCounter());
				}
				LOG.info(myBuilder);
			} else {
				LOG.debug(myBuilder);
			}
->			processMessageAsRoot(aMessage);


/ 12	. 
	$Proxy477.onMessage(Message) line: not available	
	Thread.run() line: 745	


/ BREAKPOINTS PAT-432

AbstractConsumer [line: 31] - onMessage(Message)	
ConsignmentServiceImpl [line: 410] - handleServiceActionDelete(ServiceActionVO)	
ConsignmentServiceImpl [line: 706] - removeServiceAction(ServiceActionVO, TMSEventContext)	
ConsignmentVO [line: 286] - removeServiceAction(ServiceActionVO)	
EntityActionGroupHandlerImpl [line: 34] - processMessageAsRoot(Message)	
EntityActionGroupPanel [line: 284] - onSubmit()									/ NIET
EntityActionGroupPanel [line: 373] - onSubmit(AjaxRequestTarget, Form<?>)		/ NIET	
EntityActionGroupServiceImpl [line: 74] - addToQueue(int)	
EntityActionGroupServiceImpl [line: 142] - executeActionsForBundleObject(BundleObjectId)	
EntityActionGroupServiceImpl [line: 164] - executeActionsForBundleObject(BundleObjectId)	
EntityActionGroupServiceImpl [line: 322] - startActionGroup(EntityActionGroup) 	/ NIET	
EntityActionGroupServiceImpl [line: 328] - startActionGroup(EntityActionGroup, AuthorizationLevelConfiguration, Set<AuthorizationLevel>)																	/ NIET
EntityActionGroupServiceImpl [line: 385] - startActionGroup(EntityActionGroup, AuthorizationLevelConfiguration, Set<AuthorizationLevel>)																		/ NIET
EntityActionGroupServiceImpl [line: 399] - run()								/ NIET
EvoLookupButton [line: 156] - onInitialize()									/ NIET	
ExportServiceOrder [line: 68] - execute(Collection<TriggerTaskParameter<?>>, Map<String, Serializable>)	
LanguageManager [line: 258] [conditional] - get(String, String)					/ NIET
PnlLogisticsPrintLabelServiceImpl [line: 130] - printLabel(ServiceOrderVO)	/ NIET
PnlLogisticsPrintLabelServiceImpl [line: 162] - printLabel(ServiceOrderVO)	/ NIET
QueryViewPanel [line: 119] - QueryViewPanel(String, IModel<QueryDefinition>, List<RowAction>, List<GroupAction>, Set<Serializable>)		/ NIET
QueryViewPanel [line: 417] - createRow(List<Object>, QueryColumn, ListItem<Object>) / NIET	
QueryViewPanel [line: 635] - populateItem(ListItem<Object>)	/ NIET	
QueryViewPanel [line: 650] - setObject(Boolean)	/ NIET	
QueryViewPanel [line: 663] - isEnabled()	/ NIET	
QueryViewPanel [line: 681] - populateItem(ListItem<Object>)	/ NIET	
ServiceActionServiceImpl [line: 977] - updateConsignment(ServiceActionVO, ConsignmentVO)	
ServiceOrderServiceImpl [line: 1016] - handleConsignmentDeleted(ConsignmentVO, int)	
ServiceOrderServiceImpl [line: 1700] - deleteConsignment(ConsignmentVO, int)	
ServiceOrderServiceImpl [line: 1711] - deleteConsignment(ConsignmentVO, int)	
ServiceOrderTriggerHandlerImpl [line: 39] - evaluateAndExecuteRequest(ServiceOrderVO, ServiceOrderTypeTrigger)	
ServiceOrderTriggerHandlerImpl [line: 166] [conditional] - checkForUpdate(ServiceOrderTypeTrigger, ServiceOrderVO, ServiceOrderVO)	
ServiceOrderTriggerHandlerImpl [line: 205] - checkTrigger(ServiceOrderTypeTrigger, ServiceOrderVO)	
ShipmentOrderBundleServiceImpl [line: 67] - getShipmentOrdersForBundle(Bundle)	/ NIET	
ShipmentOrderIterator [line: 34] - hasNext()	/ NIET	
ShipmentOrderIterator [line: 39] - next()	/ NIET	
ShipmentOrderMassUpdatePage [line: 119] - execute(Set<? extends Serializable>)	/ NIET	
ShipmentOrderServiceImpl [line: 1782] - unplan(ShipmentOrderVO)	
Table [line: 245] - addDatabaseColumn(String, String)	/ NIET	
Table [line: 312] - addHiddenColumn(String)	/ NIET	
Table [line: 641] [conditional] - isFieldHidden(String)/ NIET		
Table [line: 750] - reloadFilters()	/ NIET	
Table [line: 976] - getHeaderLabel()	/ NIET	
Table [line: 999] - addColumn(Column)	/ NIET	

/ we rm	b	,,
AbstractConsumer.onMessage	,

/ FIX PAT-432

/ Dit heeft Paul gedaan	,

/1	.

/ In module/oms/src/java/com/mpbojects/oms/service/trigger

package com.mpobjects.oms.service.trigger;
public class TriggerActionExecutionServiceImpl implements TriggerActionExecutionService {
	@Override
	public void executeRequest(TriggerExecutionRequest<?> aRequest) {
...
->ERBIJ		TriggerExecutionManager.getInstance().removeFromQueue(aRequest);
	}

/ 2	.

/ In module/oms/src/java/com/mpbojects/oms/service/trigger

package com.mpobjects.oms.service.trigger;
$ vi TriggerExecutionManager.java
/ HELEMAAL NIEUW

/ 3	.

/ In module/oms/src/java/com/mpbojects/oms/service/trigger

package com.mpobjects.oms.service.trigger;
public class TriggerExecutionRequest<T extends AbstractTrigger> implements Serializable {

/ WAS
	public void addObject(String aName, Serializable anObject) {
		objectMap.put(aName, anObject);
	}
/ NU
	public void addObject(String aName, Integer anObject) {
		objectMap.put(aName, anObject);
	}

	public void addObject(String aName, String anObject) {
		objectMap.put(aName, anObject);
	}

/4	.

/ In module/oms/src/java/com/mpbojects/oms/service/trigger

package com.mpobjects.oms.service.trigger;
public class TriggerRequestProducerImpl extends AbstractProducer implements TriggerRequestProducer {

/ WAS	,
	@Override
	public void produce(final TriggerExecutionRequest<?> aRequest) {

		transactionHelper.executeAfterCommit(new Runnable() {

			@Override
			public void run() {
				queueRequest(aRequest);
			}
		});
	}

/ NU	,
	@Override
	public void produce(final TriggerExecutionRequest<?> aRequest) {

		TriggerExecutionManager myManager = TriggerExecutionManager.getInstance();
		if (myManager.addToQueue(aRequest)) {
			transactionHelper.executeAfterCommit(new Runnable() {

				@Override
				public void run() {
					queueRequest(aRequest);
				}
			});
		} else {
			LOG.debug("Skipping request [" + aRequest + "], already queued");
		}
	}

/ 5	.

/ In module/oms/test/src/java/com/mpbojects/oms/service/trigger

package com.mpobjects.oms.service.trigger;
$ vi TriggerExecutionManagerTest.java
/ NIEUW

/ we zien	,



/ Einde FIX PAT-432


/ Einde PAT-432



/ DEBUG PAT-432

/ 7		.

/ we kiezen	sho,
  28609703 | 0000734979-20160310

/ planning, shipment order, mass update	,
ShipmentOrderMassUpdatePage

/ 7	. 

$ vi QueryViewPanel.java

			protected void populateItem(final ListItem<List<Object>> aRow) {

/ Hier komt hij steeds	, voor elke column	,


				final ListView<Object> myRow = new ListView<Object>("cell", aRow.getModel()) {
					@Override
					protected void populateItem(final ListItem<Object> aCell) {
						QueryColumn myColDef = queryStateModel.getObject().getQueryColumns().get(aCell.getIndex());
						if (myColDef.isId()) {
/ Is dit voor de checkbox?
/ TODO
							IModel<Boolean> myBooleanModel = new IModel<Boolean>() {

								@Override
								public void detach() {

								}

								@Override
								public Boolean getObject() {
									return selectedRows.contains(aCell.getModelObject());
								}

								@Override
								public void setObject(Boolean aValue) {
/ Na (*) hieronder vallen we hier (**), bij check checkbox	,
/ TODO
									if (aValue) {
										selectedRows.add((Serializable) aCell.getModelObject());
									} else {
										selectedRows.remove(aCell.getModelObject());
									}
								}
							};
							RepeatingView myActions = new RepeatingView("cellvalue");

							CheckPanel myCheckPanel = new CheckPanel(myActions.newChildId(), myBooleanModel) {

								@Override
								public boolean isEnabled() {
/ Vallen we in , als we de checkbox check ! See (*) onder	,
/ TODO
									return !isReadOnly() && isRowSelectable(aRow.getModelObject());
								}

								@Override
								public boolean isVisible() {
									return groupActionList.size() > 0;
								}

								@Override
								public void onPanelUpdate(AjaxRequestTarget aTarget) {
									aTarget.addComponent(QueryViewPanel.this);
								}

							};
							myActions.add(myCheckPanel);
							for (final RowAction myAction : rowActionList) {
/ NEE
							aCell.add(myActions);
						} else {
/ Is dit voor de overige, behalve de checkbox	?
/ TODO
							if (aCell.getModel().getObject() != null) {
	->							createRow(aRow.getModelObject(), myColDef, aCell);
/s
ShipmentOrderMassUpdatePage$4.createRow(List<Object>, QueryColumn, ListItem<Object>) line: 194	
		add(new QueryViewPanel("query", Model.of(myQuery), null, myGroupActions, selection) {
			@Override
			protected void createRow(List<Object> aRow, QueryColumn myColumn, ListItem<Object> aCell) {
				if (myColumn.getProperty().equals("shipmentOrderId")) {
/ NEE
				} else {
	->				super.createRow(aRow, myColumn, aCell);
/s
/ of	, als het betreft shipment_order_id	,
public class ShipmentOrderMassUpdatePage extends AbstractMainPage {
		add(new QueryViewPanel("query", Model.of(myQuery), null, myGroupActions, selection) {
			@Override
			protected void createRow(List<Object> aRow, QueryColumn myColumn, ListItem<Object> aCell) {
				if (myColumn.getProperty().equals("shipmentOrderId")) {
/ of	, als het betreft overig	,
ShipmentOrderMassUpdatePage$4(QueryViewPanel).createRow(List<Object>, QueryColumn, ListItem<Object>) line: 424	
		if (myColumn.getFormatter() == null) {
			aCell.add(new Label("cellvalue", aCell.getModel().getObject().toString()));

/ Ad (*)
/ als we de checkbox check,	 vallen we hierboven in b	, maar hoe	?
/s
	QueryViewPanel$3$1$2.isEnabled() line: 663	
	QueryViewPanel$3$1$2(Component).isEnabledInHierarchy() line: 4776	
	CheckPanel$1(Component).isEnabledInHierarchy() line: 4770	
	BehaviorRequestTarget.processEvents(RequestCycle) line: 142										<-
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
/ TODO
/ Is die Behavior automatisch, omdat het een Ajax elem is	?
/ Want
$ vi CheckPaneljava
		AjaxCheckBox myCheck = new AjaxCheckBox("checkbox", aModel) {

			@Override
			protected void onUpdate(AjaxRequestTarget aTarget) {
				onPanelUpdate(aTarget);
/ TODO

/ 13	. 

/ we disable
QueryViewPanel:417, 635	, 663	,


/ 13	. 

/ Als we 1 of meerdere sho's hebben checked,	 en click op update	, dan vallen we in, bij ->
/s
GroupActionPanel$1.onClick(AjaxRequestTarget) line: 37	
/=
public class GroupActionPanel extends Panel {

	public GroupActionPanel(String aId, final GroupAction anAction, final IModel<Set<? extends Serializable>> aSelection) {
		AjaxLink myLink = new AjaxLink("button") {
			@Override
			public void onClick(AjaxRequestTarget aTarget) {
				anAction.setTarget(aTarget);
				anAction.execute(aSelection.getObject());
/s
ShipmentOrderMassUpdatePage$1.execute(Set<Serializable>) line: 119	
/=
public class ShipmentOrderMassUpdatePage extends AbstractMainPage {
			myGroupActions.add(new GroupAction("update", "edit") {
				@Override
				public void execute(Set<? extends Serializable> aSelectedRowSet) {
->					LOG.debug("Starting mass update for [" + aSelectedRowSet.size() + "] items");
...
					Page page = getResponsePage();
					if (page == null) {
...
						page = new EntityActionGroupEditPage(Model.of(myEntityActionGroup), ShipmentOrderMassUpdatePage.this);
					setResponsePage(page);

/ 7		.

$ vi EntityActionGroupEditPage.java

	protected void createPage(IModel<EntityActionGroup> anActionGroupModel, Page basePage, int aShipmentOrderId) {
		add(new EntityActionGroupPanel("editPanel", anActionGroupModel, basePage, aShipmentOrderId) {

/ Als we action UNPLAN_ORDER hebben gekozen	, en we click Save	, vallen we in	,

$ vi EntityActionGroupEditPanel.java
public abstract class EntityActionGroupPanel extends Panel {
		final Button saveButton = new Button("saveButton") {
...
			@Override
			public void onSubmit() {
				try {
->					save(actionGroupModel.getObject());

/ 13	. 

/ Als we click op Save in Authorization	,

$ vi EntityActionGroupEditPanel.java
		final IModel<List<EntityAction>> actionsModel = new PropertyModel<List<EntityAction>>(actionGroupModel, "actions");
		AjaxButton startButton = new IndicatingAjaxButton("startButton", new StringResourceModel("add", actionGroupModel)) {
			@Override
			protected void onSubmit(AjaxRequestTarget target, Form<?> form) {
->				if (startGroup(actionGroupModel)) {
					target.addComponent(actionsPanel);
					target.addComponent(authorizationPanel);
					target.addComponent(statusField);
					target.addComponent(startDateField);
					target.addComponent(saveButton);
					target.addComponent(deleteButton);
				} else {
				}
			}
		};
		authorizationPanel.add(startButton);

/ 7	. 

/ we hadden select	, 
  28609703 | 0000734979-20160310
/ we create Action group	,
Description: foo
Actions: UNPLAN_ORDER
/ click Save
/ click bij Authorization Save	,
/s
EntityActionGroupPanel$12.onSubmit(AjaxRequestTarget, Form<?>) line: 373	
				if (startGroup(actionGroupModel)) {
/s
EntityActionGroupEditPage$1(EntityActionGroupPanel).startGroup(IModel<EntityActionGroup>) line: 412	
		EntityActionGroupService service = MpoBeanFactory.getBean(EntityActionGroupService.class);
		try {
			service.startActionGroup(actionGroupModel.getObject());

actionGroupModel.getObject()=
EntityActionGroup [systemId:28985101, description:foo]
/s
EntityActionGroupServiceImpl.startActionGroup(EntityActionGroup) line: 322	
		startActionGroup(anActionGroup, AuthorizationLevelConfiguration.ORDER_AUTHORIZATION_CODE, null);
/s
EntityActionGroupServiceImpl.startActionGroup(EntityActionGroup, AuthorizationLevelConfiguration, Set<AuthorizationLevel>) line: 328	
			switch (anAuthorizationType) {
/ NIETS	, want	,
				case ORDER_AUTHORIZATION_CODE:
					for (EntityAction myAction : anActionGroup.getActions()) {

myAction	EntityAction  (id=22941)	
	actionGroup	EntityActionGroup  (id=22863)	
EntityActionGroup [systemId:28985101, description:foo]
	actionType	EntityActionType  (id=22947)	
		name	"UNPLAN ORDER" (id=22958)	
	configuration	"" (id=22948)	
	parameters	LinkedList  (id=22949)	
	performanceMonitorService	null	
	systemId	28985102	

						for (AuthorizationLevel myLevel : myAction.getActionType().getAuthorizationLevels()) {
/ NEE
					break;

			switch (anAuthorizationType) {
/ Einde	,

			Iterator<ShipmentOrderVO> bundle = shipmentOrderBundleService.getShipmentOrdersForBundle(anActionGroup.getBundle());
/s
ShipmentOrderBundleServiceImpl.getShipmentOrdersForBundle(Bundle) line: 67	
		return new ShipmentOrderIterator(aBundle);

this	ShipmentOrderBundleServiceImpl  (id=22998)	
aBundle	Bundle  (id=22868)	
	code	"SHO_MASS_UPDATE_1457529102033" (id=22979)	
	description	"1 shipment order(s) total cost is : 0" (id=22980)	
	lastUpdate	Date  (id=22981)	
	locked	false	
	objectList	PersistentSet  (id=22982)	
	organization	Organization  (id=22960)	
	owner	Resource  (id=22871)	
	performanceMonitorService	null	
	shared	false	
	sourceReference	"SHIPMENTORDER_BUNDLE" (id=22597)	
	systemId	28985100	

/s
ShipmentOrderIterator.<init>(Bundle) line: 28	
		BundleDAO bundleDAO = MpoBeanFactory.getBean(BundleDAO.class);
		objectIterator = bundleDAO.getBySystemId(aBundle.getSystemId()).getObjectList().iterator();
		shipmentOrderDao = MpoBeanFactory.getBean(ShipmentOrderDao.class);
/t
EntityActionGroupServiceImpl.startActionGroup(EntityActionGroup, AuthorizationLevelConfiguration, Set<AuthorizationLevel>) line: 357	
			Iterator<ShipmentOrderVO> bundle = shipmentOrderBundleService.getShipmentOrdersForBundle(anActionGroup.getBundle());
/d
			while (bundle.hasNext()) {
				ShipmentOrderVO myShipmentOrder = bundle.next();
				String myAuthorizationCodesString = myShipmentOrder.getAuthorizationCodes();
null
				if (!StringUtils.isBlank(myAuthorizationCodesString)) {
/ NEE
				myShipmentOrder.setActionApprovalStatus(ApprovalStatus.PENDING);
				myShipmentOrder.setLockedByProcess(true);
				shipmentOrderService.getShipmentOrderDao().save(myShipmentOrder);


			if (myRequiredAuthorizationCodes.isEmpty()) {
				anActionGroup.setStatus(EntityActionStatus.APPROVED);
			anActionGroup.setStartDate(new Date());
			anActionGroup.setLastUpdateDate(new Date());
			saveActionGroup(anActionGroup);
			if (myRequiredAuthorizationCodes.isEmpty()) {
/ JA
				addToQueueAfterCommit(anActionGroup);

anActionGroup	EntityActionGroup  (id=23415)	
	actions	PersistentBag  (id=23437)	
	authorizations	PersistentBag  (id=23438)	
	bundle	Bundle  (id=23115)	
	description	"foo" (id=23439)	
	executionDate	null	
	lastUpdateDate	Date  (id=23441)	
	performanceMonitorService	null	
	requestedBy	Resource  (id=23444)	
	startDate	Date  (id=23445)	
	status	EntityActionStatus  (id=23456)	
	systemId	28985107	
/s
EntityActionGroupServiceImpl.addToQueueAfterCommit(EntityActionGroup) line: 395	
->		transactionHelper.executeAfterCommitTx(new Runnable() {
			@Override
			public void run() {
->>				addToQueue(myActionGroup.getSystemId());
/ Eerst in ->	, later in ->>
/s
public class EntityActionGroupServiceImpl implements EntityActionGroupService {
	@Override
	public void addToQueue(int anActionGroupSystemid) {
->		EntityActionGroup actionGroup = entityActionGroupDAO.getBySystemId(anActionGroupSystemid);

/ Intermezzo

/ EntityActionGroups maps naar mau_action_group	,

pnltms4t=# select*from mau_action_group
 system_id |          description           |  status  | requested_by_systemid | bundle_systemid |       started_dtm       |      executed
_dtm       |     last_update_dtm     
-----------+--------------------------------+----------+-----------------------+-----------------+-------------------------+--------------
  28985110 | bar                            | INITIAL  |              28417680 |        28985109 | NULL                    | NULL         | 2016-03-09 15:38:02.675

/ Einde Intermezzo

/ HIER HIER HIER

		EntityActionGroup actionGroup = entityActionGroupDAO.getBySystemId(anActionGroupSystemid);
		Bundle bundle = actionGroup.getBundle();

		for (EntityAction action : actionGroup.getActions()) {
			ActionTypeDefinition definition = action.getActionType().getDefinition();
			if (definition instanceof GroupActionType) {
/ NEE
		Set<BundleObject> objectList = shipmentOrderBundleService.getBundleDAO().getBySystemId(bundle.getSystemId()).getObjectList();
[com.mpobjects.oms.model.bundle.BundleObject@ca8f146, com.mpobjects.oms.model.bundle.BundleObject@3b6b7854]
/=
objectList	PersistentSet  (id=24049)	
	cachedSize	-1	
	directlyAccessible	false	
	dirty	false	
	initialized	true	
	initializing	false	
	key	Integer  (id=24056)	
	operationQueue	null	
	owner	Bundle  (id=24059)	
	role	"com.mpobjects.oms.model.bundle.Bundle.objectList" (id=22993)	
	session	SessionImpl  (id=24062)	
	set	HashSet  (id=24064)	
		map	HashMap  (id=24075)	
			entrySet	HashMap$EntrySet  (id=24078)	
			hashSeed	0	
			keySet	HashMap$KeySet  (id=24080)	
			loadFactor	0.75	
			modCount	2	
			size	2	
			table	HashMap$Entry[4]  (id=24084)	
				[1]	HashMap$Entry  (id=24088)	
					hash	209447109	
					key	BundleObject  (id=24091)	
						bundle	Bundle_$$_javassist_48  (id=24045)	
						executionStatus	BundleObjectExecutionStatus  (id=24094)	
						id	BundleObjectId  (id=24095)	
							bundle	28985112	
							objectId	28609650	
						objectId	Integer  (id=24096)	
							value	28609650	
						retryAttempt	0	
					next	null	
					value	Object  (id=21172)	
				[2]	HashMap$Entry  (id=24089)	
					hash	950571034	
					key	BundleObject  (id=24105)	
						bundle	Bundle_$$_javassist_48  (id=24045)	
						executionStatus	BundleObjectExecutionStatus  (id=24094)	
						id	BundleObjectId  (id=24107)	
							bundle	28985112	
							objectId	28609682	
						objectId	Integer  (id=24108)	
							value	28609682	
						retryAttempt	0	
					next	null	
					value	Object  (id=21172)	
			threshold	3	
			values	null	
	storedSnapshot	HashMap  (id=24066)	
	tempList	null	

		for (BundleObject object : objectList) {
			simpleMessageProducer.sendMessage(QUEUE, object.getId());

public class EntityActionGroupServiceImpl implements EntityActionGroupService {
	private static final String QUEUE = "com.mpobjects.massupdate.queue.shipmentorder";

/ Intermezzo

/ we kunnen een EntityActionGroup alleen rm	, (ga naar planning, shipment_order), als in mau_action_group status='INITIAL'	,  want anders kunnen we ze niet edit in de appl	,
pnltms4t=# update mau_action_group set  status = 'INITIAL' where description in ('gee','bar');
UPDATE 2
pnltms4t=# commit;
/ Nu kunnen we ze rm	,

/ Dan moeten we ook de sho's aanpassen	,

pnltms4t=# select shipment_order_id from shipment_order where action_approval_status='PENDING';
  shipment_order_id  
---------------------
 0001230729-20160310
 0000299664-20160310
(2 rows)
/ Precies de 2 sho's bij bar en gee	, 

pnltms4t=# update shipment_order set action_approval_status='OPEN' where shipment_order_id in (select shipment_order_id from shipment_order where action_approval_status='PENDING');
UPDATE 2
pnltms4t=# commit;
COMMIT

/ Einde Intermezzo

/ Intermezzo

/ we hebben 2 BundleObject's op de QUEUE = "com.mpobjects.massupdate.queue.shipmentorder" set	, 
/ Wat haalt ze er af	?

/ we zoeken	,
text: com.mpobjects.massupdate.queue.shipmentorder
file: *.sb.xml

$ vi massupdate-service.sb.xml

	<!-- Destination for mass update requests -->
	<amq:queue id="com.mpobjects.massupdate.queue.shipmentorder" physicalName="com.mpobjects.massupdate.queue.shipmentorder" />

	<bean class="org.springframework.jms.listener.DefaultMessageListenerContainer" name="internaljms.com.mpobjects.massupdate.service.actiongroup.EntityActionGroupHandler">
		<property name="concurrentConsumers" value="${module.oms.massupdate.concurrentConsumers}" />
		<property name="connectionFactory" ref="jmsEmbeddedBrokerConnectionFactory" />
		<property name="destination" ref="com.mpobjects.massupdate.queue.shipmentorder" />
		<property name="messageListener" ref="com.mpobjects.massupdate.service.actiongroup.EntityActionGroupHandler" />
		<property name="maxConcurrentConsumers" value="${module.oms.massupdate.maxConcurrentConsumers}" />
	</bean>

$ vi EntityActionGroupHandlerImpl.java

	@Override
	protected void processMessageAsRoot(Message aMessage) throws Exception {
->

/ Einde Intermezzo

/s
EntityActionGroupHandlerImpl.processMessageAsRoot(Message) line: 39	
		ObjectMessage myMessage = (ObjectMessage) aMessage;
		Serializable serializable = myMessage.getObject();
		if (serializable instanceof BundleObjectId) {
			BundleObjectId myBundleObjectId = (BundleObjectId) serializable;
			LOG.debug("Executing actions for " + myBundleObjectId);
			entityActionGroupService.executeActionsForBundleObject(myBundleObjectId);
myBundleObjectId	BundleObjectId  (id=17977)	
	bundle	28985116	
	objectId	28609704	
/s
EntityActionGroupServiceImpl.executeActionsForBundleObject(BundleObjectId) line: 142	
myBundleObjectId	BundleObjectId  (id=19633)	
	bundle	28985122	
	objectId	28609651	

		BundleObject myBundleObject = bundleDAO.getBundleObject(myBundleObjectId);
		EntityActionGroup myActionGroup = entityActionGroupDAO.getActionGroupForBundle(myBundleObject.getBundle());
		ShipmentOrderVO myShipmentorder = shipmentOrderService.getShipmentOrder(myBundleObject.getObjectId());
ShipmentOrder: 0001230729-20160312(SystemId:28609684; Org:PNL-TMS-AB)

			for (EntityAction myAction : myActionGroup.getActions()) {
				if (myAction instanceof GroupActionType) {
					// Do nothing
				} else if (myAction.executeAfterSave()) {
					afterSaveActions.add(myAction);
				} else {
					myCurrentAction = myAction;
					if (!propagateChange && myAction.shouldPropagateChange()) {
						propagateChange = true;
					}
					myAction.execute(myShipmentorder);
/s
EntityAction.execute(ShipmentOrderVO) line: 33	
		actionType.getDefinition().executeAction(aShipmentOrder, parameters);
/s
UnplanActionType(ActionTypeDefinition).executeAction(ShipmentOrderVO, List<EntityActionParameter<?>>) line: 18	
/=
	public void executeAction(ShipmentOrderVO aShipmentOrder, List<EntityActionParameter<?>> parameters) throws ActionTypeDefinitionException {
parameters=null
		execute(aShipmentOrder);
/s
		try {
			shipmentOrderServiceWrapper.getBean().unplan(aShipmentOrder);
/s
ShipmentOrderServiceImpl.unplan(ShipmentOrderVO) line: 1782	



		List<ServiceActionVO> reversedList = new ArrayList<ServiceActionVO>(aShipmentOrderVO.getServiceActionList());
0001230729-20160312/DELIVERY/28549239
/ we zien	,
[sho system_id/se type/sa system_id]

/ Intermezzo

/ 13	. 

/ we zien	, 
nltms4t=# select sat.*from service_action sa join service_action_type sat on sa.service_action_type_systemid=sat.system_id where sa.system_id=28549239
service_action_type  | DELIVERY

pnltms4t=# select sho.* from service_action sa join shipment_order sho on sa.shipment_order_systemid=sho.system_id where sa.system_id=28549239;
shipment_order_id              | 0001230729-20160312

/ 13	. 

/ een consigment heeft een seo  system_id	, 

pnltms4t=# select*from consignment where system_id=28549239;
consignment_number          | N0080206.1 

/ Einde Intermezzo

		for (ServiceActionVO serviceAction : reversedList) {
			if (serviceAction.getConsignmentVO() != null) {
/= theConsignmentVO
N0078781.1/28547814
/ we zien	,
consigment_number/consignment's system_id

/ we zijn nog in	,
ShipmentOrderServiceImpl.unplan(ShipmentOrderVO) line: 1791	
		for (ServiceActionVO serviceAction : reversedList) {
			if (serviceAction.getConsignmentVO() != null) {
				getServiceActionService().updateConsignment(serviceAction, null);
/s
ServiceActionServiceImpl.updateConsignment(ServiceActionVO, ConsignmentVO) line: 977	

		if (aNewConsignment == null) {
/ JA
			consignmentService.handleServiceActionDelete(aServiceAction);
/s
ConsignmentServiceImpl.handleServiceActionDelete(ServiceActionVO) line: 410	
/=
	public void handleServiceActionDelete(ServiceActionVO myOldVO) {
			if (myOldVO != null) {
0001230729-20160312/DELIVERY/28549239
sho/<type>/sa's system_id
				ConsignmentVO myOldConsignmentVO = myOldVO.getConsignmentVO();
N0078781.1/28547814
				if (myOldConsignmentVO != null) {
					removeServiceAction(myOldVO);
/s
ConsignmentServiceImpl.removeServiceAction(ServiceActionVO) line: 670	
		removeServiceAction(anAction, new TMSEventContext());
/s
ConsignmentServiceImpl.removeServiceAction(ServiceActionVO, TMSEventContext) line: 682	
/=
	public void removeServiceAction(ServiceActionVO anAction, TMSEventContext aContext) throws ConsignmentException {

			ConsignmentVO myNewConsignment = consignmentDAO.getInitializedBySystemId(anAction.getConsignmentVO().getSystemId());
N0078781.1/28547814
			ConsignmentVO myOldConsignment = getOld(myNewConsignment);
N0078781.1/28547814
			List<ServiceActionVO> myOldServiceActionList = new ArrayList<ServiceActionVO>(myOldConsignment.getServiceActionList());
[0001230729-20160312/DELIVERY/28549239]
			myOldConsignment.setServiceActionList(myOldServiceActionList);
			int oldServiceActionTotalCount = myOldServiceActionList.size();

			if (LOG.isDebugEnabled()) {
				LOG.debug("Removing service action " + anAction + " from consignment [" + myNewConsignment + "]");
			}

			lock(myNewConsignment);


			for (EventVO myEventVO : getEventService().getEventsForServiceAction(anAction.getSystemId())) {

[Event id: [28840228], event type: [POC], status: [OPEN_DEFAULT], 
Event id: [28840229], event type: [POD], status: [OPEN_DEFAULT]]
/ Er zijn inderdaad 2 expected events	, 
POC: proof of collect	, 
POD: proof of delivery	,

				myEventVO.setConsignmentSystemid(null);
/ WAS al null
/ TODO
				getEventService().save(myEventVO);
			}
			myNewConsignment.removeServiceAction(anAction);
/s
ConsignmentVO.removeServiceAction(ServiceActionVO) line: 286	
/=
	public void removeServiceAction(ServiceActionVO anAction) {

theServiceActionList=
[0001230729-20160312/DELIVERY/28549239]
anAction
0001230729-20160312/DELIVERY/28549239

		if (theServiceActionList.remove(anAction)) {
			anAction.setConsignmentVO(null);
/=
		theConsignmentVO = aConsignmentVO;
/ WAS inderdaad !=null	, N0078781.1/28547814
/t
ConsignmentServiceImpl.removeServiceAction(ServiceActionVO, TMSEventContext) line: 703	
			myNewConsignment.removeServiceAction(anAction);
/d
			if (myNewConsignment.getServiceActionList().size() == 0) {
/ JA
/ Net allemaal rm	,
				consignmentDAO.removeConsignment(myNewConsignment.getSystemId());
				serviceOrderService.handleConsignmentDeleted(myOldConsignment, oldServiceActionTotalCount);
myOldConsignment=
N0078781.1/28547814
oldServiceActionTotalCount=
1
/s
ServiceOrderServiceImpl.handleConsignmentDeleted(ConsignmentVO, int) line: 1016	
			deleteConsignment(myOldConsignment, oldServiceActionTotalCount);
/s
ServiceOrderServiceImpl.deleteConsignment(ConsignmentVO, int) line: 1693	
			ServiceOrderVO myNewServiceOrder = aConsignment.getServiceOrderVO();
N0078781/28403235
			ServiceOrderVO myOldServiceOrder = getOld(myNewServiceOrder);
N0078781/28403235
			if (myNewServiceOrder.getConsignmentList().remove(aConsignment)) {
[N0078781.1/28547814] -> []
				myNewServiceOrder.setRecalculate();
/s
ServiceOrderVO(LogisticsOrderVO).setRecalculate() line: 960	
		setRecalculate(true);
/s
ServiceOrderVO(LogisticsOrderVO).setRecalculate(boolean) line: 970	
		theRecalculateFlag = aRecalculate;
true
		theRecalculateActualsFlag = aRecalculate;
true
/t
ServiceOrderServiceImpl.deleteConsignment(ConsignmentVO, int) line: 1700	
				myNewServiceOrder.setRecalculate();
/s
ServiceOrderVO(LogisticsOrderVO).recalculate() line: 749	
		LogisticsOrderTotalsCalculator<? extends LogisticsOrderVO> calc = getLogisticsOrderTotalsCalculator(false);
		Collection<? extends LogisticsOrderVO> items = getCustomerLogisticsOrderList();
[]
		if (items == null || items.isEmpty()) {
			calc.zeroValues();
/s
LogisticsOrderTotalsCalculator.zeroValues() line: 289	
		if (calculateRequestedTotalColli) {
			requestedTotalColli = BigDecimal.ZERO;
		}
		if (calculateRequestedTotalItems) {
			requestedTotalItems = BigDecimal.ZERO;
		}
		if (calculateRequestedTotalWeight) {
			requestedTotalWeight = BigDecimal.ZERO;
		}
		if (calculateRequestedTotalVolume) {
			requestedTotalVolume = BigDecimal.ZERO;
		}
		if (calculateRequestedTotalLDM) {
			requestedTotalLDM = BigDecimal.ZERO;
		}
		if (calculateRequestedTotalValue) {
			requestedTotalValue = BigDecimal.ZERO;
		}
		if (calculateRequestedTotalAltValue) {
			requestedTotalAltValue = BigDecimal.ZERO;
		}
/t
ServiceOrderVO(LogisticsOrderVO).recalculate() line: 776	
			calc.zeroValues();
/d
		calc.applyChanges();
/s
LogisticsOrderTotalsCalculator.applyChanges() line: 134	
		if (calculateRequestedTotalColli && requestedTotalColli != null) {
			entity.setRequestedTotalColli(requestedTotalColli);

this	LogisticsOrderTotalsCalculator  (id=19419)	
	entity	ServiceOrderVO  (id=19403)	
N0078781/28403235

requestedTotalColli=BigDecimal 0

		if (calculateRequestedTotalItems && requestedTotalItems != null) {
			entity.setRequestedTotalItems(requestedTotalItems);
requestedTotalItems=BigDecimal 0

		if (calculateRequestedTotalWeight && requestedTotalWeight != null) {
			entity.setRequestedTotalWeightKg(requestedTotalWeight);
requestedTotalWeight=BigDecimal 0

		if (calculateRequestedTotalVolume && requestedTotalVolume != null) {
			entity.setRequestedTotalVolumeM3(requestedTotalVolume);
requestedTotalVolumne=BigDecimal 0

		if (calculateRequestedTotalLDM && requestedTotalLDM != null) {
			entity.setRequestedTotalLoadingMeters(requestedTotalLDM);
requestedTotalLDM=BigDecimal 0

		if (calculateRequestedTotalValue && requestedTotalValue != null) {
			entity.setRequestedTotalValue(requestedTotalValue);
requestedTotalValue=BigDecimal 0

		if (calculateRequestedTotalAltValue && requestedTotalAltValue != null) {
			entity.setRequestedAltTotalValue(requestedTotalAltValue);
requestedTotalAltValue=BigDecimal 0
			entity.setAltValueCurrencyVO(myAltValueCurrency);
/= 		
				theAltValueCurrencyVO = aCurrencyVO;

/t
ServiceOrderVO(LogisticsOrderVO).recalculate() line: 777	
		calc.applyChanges();
/d
		theRecalculateFlag = false;
/t
ServiceOrderServiceImpl.deleteConsignment(ConsignmentVO, int) line: 1700	
				myNewServiceOrder.recalculate();
/d
			if (myNewServiceOrder.getConsignmentList().size() == 0 && myNewServiceOrder.getServiceOrderType() != null
					&& myNewServiceOrder.getServiceOrderType().isDeleteWhenOpen()) {
true && true && fals
/ NEE
			} else {
				setDatesAndStatusAfterConsignmentUpdate(myNewServiceOrder);
				serviceOrderDAO.save(myNewServiceOrder);
				getTriggerHandler().handleUpdate(myOldServiceOrder, myNewServiceOrder, oldServiceActionTotalCount);
				triggerEventHandler(myOldServiceOrder, myNewServiceOrder, true, myContext);















				triggerEventHandler(myOldConsignment, null, false, aContext);





/ Einde DEBUG PAT-432

/ PCT-1263

/ 7	. 

/ we cp acc database	,

[eric@localhost bin]$ pnl-db-dump-a.sh pnllogistics
-rw-rw-r--. 1 eric     eric     1.5G Mar 14 11:30 pnllogistics-a-2016-03-14.dump


pnllogistics5a=# create database pnllogistics6a;
CREATE DATABASE

[eric@localhost bin]$ PGPASSWORD=mpopostgres@mpo pg_restore -U mpopostgres -d pnllogistics6a ~/DB_TAP/Postgres/Backup/

$ vi deploy/postgres-ds.xml
<datasources>
    <xa-datasource>
        <xa-datasource-property name="DatabaseName">pnllogistics6a</xa-datasource-property>
    <local-tx-datasource>
                <connection-url>jdbc:postgresql://127.0.0.1:5432/pnllogistics6a</connection-url>

[eric@localhost bin]$ local-pg_restore.sh pnllogistics6a ~/DB_TAP/Postgres/Backup/pnllogistics-a-2016-03-14.dump 

/ 7	. 

/ Ga op test naar SH000127437	,
/ we zien bij Post calculated 
Vrachtkosten	2.75 E
/ we zien in de Calculation log	,
RC-PRICE RP-TOTAL_PRICE(SUM)=2.75EUR

/ Ga naar 
Finance, Service Agreement, 

	public void performCustomRecalculation(ShipmentOrderVO myOldShipmentOrderVO) {

/ 7	. 

/ calc ShipmentOrderVO.price	,

class ShipmentOrderVO

/ 7	. 

			<map:action logger="shipmentorder" name="shipmentOrderEdit" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderEditAction"/>

shipment-order_edit.jsp line: 293	
							<c:if test="${fn:length(formVO.shipmentOrderPricePartList) > 0}">
			                	<tr>
			                		<td class="label"><mpo:label name="price"/></td>
			                		<td class="input"> 
->			                		<c:forEach var="price" items="${formVO.priceByCurrency}">
			                			<span style="white-space: nowrap;">${price.value} ${price.key.code}</span>
/s
ShipmentOrderVO.getPriceByCurrency() line: 1288	
[theSystemId: 26886629, Amount :65.89, 
theSystemId: 26892052, Amount :65.89, 
theSystemId: 26910652, Amount :10.00]

$ vi ShipmentOrderVO.java
	public Map<CurrencyVO, BigDecimal> getPriceByCurrency() {

		CurrencyGroup myMap = new CurrencyGroup();

		for (ShipmentOrderPricePartVO myVO : getShipmentOrderPricePartList()) {
			if (myVO.getCorrectionType().equals(CorrectionType.ADD)) {
				myMap.add(myVO.getCurrency(), myVO.getAmount());
			} else if (myVO.getCorrectionType().equals(CorrectionType.SUBTRACT)) {
				myMap.add(myVO.getCurrency(), myVO.getAmount().negate());
			}
		}

		return myMap.getAmountMap();
{SystemId:7001	isDeleted:false	Code:EUR	Name:Euro=141.78}

/ Dus hij telt alle price parts op, per currency	,

/ 7	. 
/ Er zijn 2 methods	,
class ShipmentOrderVO{
	public void calculatePrice() {
/ calcs ShipmentOrder.price
	public Map<CurrencyVO, BigDecimal> getPriceByCurrency() {
/ toont op jsp per currency foutief de price 	,

/ FIX PCT-1263

    public Map<CurrencyVO, BigDecimal> getPriceByCurrency() {

        CurrencyGroup myGroup = RatePartUtil.getTotalByStatusAndPriority(getShipmentOrderPricePartList());

        return myGroup.getAmountMap();
    }


/ Einde FIX PCT-1263


/ Einde PCT-1263

/ DEBUG PCT-1263


/ we click Recalculate rate on the shipment order SH000097407	, 

/ stack trace	,
/s
	ShipmentOrderVO.calculatePrice() line: 389	

	PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 2071	
				myNew.calculatePrice();

	PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).updateShipmentOrder(ShipmentOrderVO, boolean) line: 1985	
		return updateShipmentOrder(aShipmentOrder, new TMSEventContext(), propagateChange);

	ShipmentOrderCalculationServiceImpl.update(ShipmentOrderVO, AlternativeResultSet, List<String>, boolean) line: 424	
		if (shipmentOrderChanged && aPersist) {
...
				shipmentOrder = shipmentOrderService.updateShipmentOrder(shipmentOrder, false);

	RateCalculationVO.applyCorrections(AlternativeResultSet, List<String>, boolean) line: 1026	
			case SHIPMENT_ORDER:
				} else {
					MpoBeanFactory.getBean(ShipmentOrderCalculationService.class).update(myShipmentOrder, aResultSet, aLog, aPersist);

	RateCalculationVO.applyCorrections(AlternativeResultSet, List<String>) line: 988	
		applyCorrections(aResultSet, aLog, true);

	RateCalculationVO.runFor(List<RateAgreementVO>) line: 827	
				try {
					if (serviceOrder != null || shipmentOrder != null || customerOrderLine != null) {
						RateCalculationAlternative firstAlt = alternativeList.iterator().next();
						List<String> myLog = getTempLog();
						for (AlternativeResultSet mySet : firstAlt.getResultSetList().values()) {
->							applyCorrections(mySet, myLog);

	CalculationServiceImpl.executeRateCalculation(List<RateAgreementVO>, AgreementType, LogisticsOrderVO) line: 354	
		myRateCalculationVO.runFor(aRateAgreementList);

	RateCalculationExecuteAction.act() line: 52	
			myRateCalculationVO = MpoBeanFactory.getBean(CalculationService.class).executeRateCalculation(myRaList, myAgreementType, myOrder);

	RateCalculationExecuteAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	
				Map myMap = act();

/ we gaan debug	,
/s
ShipmentOrderVO.calculatePrice() line: 389	
		CurrencyGroup myGroup = RatePartUtil.getTotalByStatusAndPriority(getShipmentOrderPricePartList());
/s
		return theShipmentOrderPricePartList;
/=
[theSystemId: 26886629, Amount :65.89, 
theSystemId: 26892052, Amount :65.89, 
theSystemId: 26910652, Amount :10.00]
/t
/s
RatePartUtil.getTotalByStatusAndPriority(Collection<LogisticsOrderRatePart>) line: 132	
		Map<RatePartStatus, CurrencyGroup> myResult = calculateTotalByStatus(aParts);
/s
RatePartUtil.calculateTotalByStatus(Collection<LogisticsOrderRatePart>) line: 58	
		return calculateTotalByStatus(aParts, null);
/s
RatePartUtil.calculateTotalByStatus(Collection<LogisticsOrderRatePart>, Collection<String>) line: 70	
		for (LogisticsOrderRatePart part : aParts) {
			CurrencyGroup myGroup = myResult.get(part.getStatus());
null
/ want	,
part.getStatus()=
	name "ESTIMATED"
myResult={}

/ Intermezzo

enum RatePartStatus {

	ACTUAL,

	/** At some point, estimated will be replaced by post calculated */
	ESTIMATED,

	PRECALCULATED;

	/* POSTCALCULATED; */

/ Omdat de status ESTIMATED is	, = post calculated	, zien we deze price part in de POST CALCULATED tab	, 
/ de Invoice status=INVOICED is iets anders	,

/ Einde Intermezzo

			if (myGroup == null) {
/ JA
				myGroup = new CurrencyGroup();
				myResult.put(part.getStatus(), myGroup);
{ESTIMATED=}
			BigDecimal myAmount = BigDecimal.ZERO;
			if (part.getCorrectionType().equals(CorrectionType.ADD)) {
/ JA
				myAmount = part.getAmount();
65.89
			myGroup.add(part.getCurrency(), myAmount);
myResult={ESTIMATED=65.89 EUR}

/ volgende	,

		for (LogisticsOrderRatePart part : aParts) {
			CurrencyGroup myGroup = myResult.get(part.getStatus());
null
/ want,	
part.getStatus()=ACTUAL
			if (myGroup == null) {
				myGroup = new CurrencyGroup();
				myResult.put(part.getStatus(), myGroup);
myResult=
{ACTUAL=, ESTIMATED=65.89 EUR}
			}

			BigDecimal myAmount = BigDecimal.ZERO;
			if (part.getCorrectionType().equals(CorrectionType.ADD)) {
				myAmount = part.getAmount();
65.89
			} else if (part.getCorrectionType().equals(CorrectionType.SUBTRACT)) {
				myAmount = part.getAmount().negate();
			}
			myGroup.add(part.getCurrency(), myAmount);
myResult={ACTUAL=65.89 EUR, ESTIMATED=65.89 EUR}
		}

/ volgende	,

		for (LogisticsOrderRatePart part : aParts) {

			if (aComponentTypeList != null && !aComponentTypeList.contains(part.getComponentType().getCode())) {
				continue;
			}
			CurrencyGroup myGroup = myResult.get(part.getStatus());
part.getStatus()=ESTIMATED
			if (myGroup == null) {
/ NEE
			BigDecimal myAmount = BigDecimal.ZERO;
			if (part.getCorrectionType().equals(CorrectionType.ADD)) {
				myAmount = part.getAmount();
10.00
			myGroup.add(part.getCurrency(), myAmount);
{ACTUAL=65.89 EUR, ESTIMATED=75.89 EUR}
		}

		return myResult;
/t
RatePartUtil.getTotalByStatusAndPriority(Collection<LogisticsOrderRatePart>) line: 133	
		Map<RatePartStatus, CurrencyGroup> myResult = calculateTotalByStatus(aParts);
/d
{ACTUAL=65.89 EUR, ESTIMATED=75.89 EUR}

		CurrencyGroup myGroup = myResult.get(RatePartStatus.ACTUAL);
65.89 EUR
		if (myGroup == null) {
/ NEE
		return myGroup;
/t
ShipmentOrderVO.calculatePrice() line: 390	
		CurrencyGroup myGroup = RatePartUtil.getTotalByStatusAndPriority(getShipmentOrderPricePartList());
65.89 EUR
		setPrice(myGroup.getAmount());
/s
CurrencyGroup.getAmount() line: 87	
		if (method.equals(TotalAmountCalculationMethod.CONVERTED)) {
/ NEE
SINGLE
		} else if (amountMap.size() == 1) {
/ JA
			CurrencyVO myCurrency = amountMap.keySet().iterator().next();
			BigDecimal myAmount = amountMap.get(myCurrency);
65.89
			if (myAmount.scale() != myCurrency.getPrecision()) {
/ NEE
			return myAmount;
/t
ShipmentOrderVO.setPrice(BigDecimal) line: 2378	
		price = aPrice;
/t
ShipmentOrderVO.calculatePrice() line: 391	
		setPrice(myGroup.getAmount());








 

/ Einde DEBUG PCT-1263

/ MPO-139


/ 7	. 

$ vi datetimepicker-timezone.js

/** Called for mouse over, the date time is now in display datetime and is converted to the user date time */
function dateTimeInfo(dateField, dateFieldName, userTimeZone, aDisplayTimeZone, anApplicationTimeZone) {
741:if (dateField.value != "") {
		myDisplayTimeZone = aDisplayTimeZone;
		var myMomentTime = formatAndConvert(document.getElementById(dateFieldName).value, document.getElementById(dateFieldName + 'Time').value);

/ we zien bijv op sho	, 
Planned End Before	,

<td nowrap="nowrap" class="input">
	<span id="plannedEndBefore_div">
		<input type="text" name="plannedEndBeforeDate" onmouseover="dateTimeInfo(this ,'plannedEndBeforeDate','Europe/Amsterdam','Europe/Amsterdam','Europe/Amsterdam');" id="plannedEndBeforeDate" size="12" value="11-Nov-2016" class="dateField required " readonly="readonly">
		<a href="#" onclick="NewCal('plannedEndBeforeDate','ddmmmyyyy',true,'Europe/Amsterdam',24); return false;">
			<img class="imgPosition" src="../lookandfeel/styles/images/icons/calendar16.gif" border="0" alt="Pick a date">	
		</a>
		<input type="text" name="plannedEndBeforeDateTime" id="plannedEndBeforeDateTime" size="5" value="18:00" class=" timeField required" readonly="readonly">
		<a href="#" class="hintanchor" onmouseover="showhint('The original end (before) date was:<br>
			<b> 11-Nov-2016 18:00</b><br><br>The planning-reason description:<br><b></b>', this, event,'')">
			<img src="../lookandfeel/styles/images/icons/info.gif" border="0">
		</a>
	</span>
</td>

/ 7	. 

$ vi service-order_edit.jsp
	<mpo:defineTab name="serviceActions" />

$ vi tab-sa-serviceactions.tag
	<mpo:setFormVO valueObject="${serviceAction.dateSetVO}" prefix="field_service_action_${serviceAction.systemId}">
		<c:if test="${cf:property('oms', 'tab.serviceaction.requestedstartafter.hidden', 'false')=='false'}">
			<td><mpo:dateField name="requestedStartAfter" type="date" showFieldContext="false" readOnly="true" /></td>
	
$ vi DateFieldTag.java
	@Override
	protected void appendInputPart(StringBuffer aBuffer) {
		aBuffer.append(" onmouseover=\"dateTimeInfo(this ,'" + getDateFieldName() + "','" + userTimeZone + "','" + defaultTimeZone + "');\"");

/ 7	. 

/ In MPO 2015.03	, valt vanwege null.value in	,

$ vi mpobjects.core.js

window.onerror = function() {
_this.onWindowError.apply(_this, arguments);
};

/ In PNLLOGISTICS 2016.01	, valt vanwege null.value in	,

$ vi class.screencontainer.js

function globalScreenContainerCatchMoveEvent(e) {
	gloScreenContainer.moveEventOccured(e);
}

/ we zien dat in mpo 2015.03 wel mpobjects.core.js	, en in dsvfms 2015.03 niet	,

$ vi service-order_edit.jsp

		<c:if test="${cf:property('oms', 'googlemaps.hidden', 'true')=='false'}">
			<script type="text/javascript" src="../wicket/js/googlemaps.js"> </script>
		</c:if>

/ Zoek in devtools met search naar 
mpobjects.core.js

$ vi googlemaps.js
document.write('<script type="text/javascript" src="https://scs.mp-objects.com/mpo/wicket/resources/com.mpobjects.view.wicket.js.MPOJavascriptReference/mpobjects.core.js"> </script>');
document.write('<script type="text/javascript" src="https://scs.mp-objects.com/mpo/wicket/resources/com.mpobjects.view.wicket.js.MPOJavascriptReference/mpobjects.googlemaps.js"> </script>');
document.write('<script type="text/javascript" src="https://scs.mp-objects.com/mpo/wicket/resources/com.mpobjects.view.wicket.js.MPOJavascriptReference/mpobjects.ui.js"> </script>');
document.write('<script type="text/javascript" src="https://scs.mp-objects.com/mpo/wicket/resources/com.mpobjects.view.wicket.js.MPOJavascriptReference/mpobjects.l10n.js"> </script>');

/ FIX MPO-139

/ There are 2 posibilities	,
module.oms.googlemaps.hidden: true voor NEEC-NL	,
/ Dan zien we google mpas niet meer	, en mpobjects.core.js is er ook niet, en de window ook niet	,

/ The second	,

$ vi datetimepicker-timezone.js

function dateTimeInfo(dateField, dateFieldName, userTimeZone, aDisplayTimeZone, anApplicationTimeZone) {
	if (dateField.value != "") {
		myDisplayTimeZone = aDisplayTimeZone;

////////
		var timeField=document.getElementById(dateFieldName + 'Time');
		var time="";
		if(timeField!==null){
			time=timeField.value;
		}
		var myMomentTime = formatAndConvert(document.getElementById(dateFieldName).value, time);
////////

In datetimepicker-timezone.js the time is not taken into account when there is no field for it.

SQL> select distinct org.organization_id from service_order so join organization org on so.organization_systemid=org.system_id;

ORGANIZATION_ID      
==================== 
DSV-BE               
DSV-DE               
DSV-DE-LAH           
DSV-ES               
DSV-ES-BCN           
DSV-ES-MAD           
DSV-NL               
DSV-NL-AMS           
DSV-NL-HRB           
DSV-NL-MDK           
DSV-SOL     

/ we hadden dit moeten incheck in de patch branch van mpo	,

[eric@localhost workspace]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace
[eric@localhost workspace]$ svn co https://system.mp-objects.com/svn/tms/patches/2015.03/mpo
checked out revision 22781.
[eric@localhost workspace]$ ls
2016.01  dsvfms  geodis  mpo  trunk	... 

[eric@localhost workspace]$ cp 2015.03/.classpath mpo/
[eric@localhost workspace]$ cp 2015.03/.project mpo
[eric@localhost workspace]$ vi mpo/.project 
<projectDescription>
    <name>mpo</name>

[eric@localhost workspace]$ vi mpo/.classpath 
<classpath>
    <classpathentry kind="con" path="org.dbpowder.plugins.LIB_CONTAINER/recurse~project/mpo/base-framework/core/lib/jar"/>
    <classpathentry kind="con" path="org.dbpowder.plugins.LIB_CONTAINER/recurse~project/mpo/base-framework/buildscripts/build-lib"/>
    <classpathentry kind="con" path="org.dbpowder.plugins.LIB_CONTAINER/recurse~project/mpo/module/interfacing/lib"/>

/ right click explorer in eclipse,      
/ Import, general, existing eclipse project
/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/mpo

[eric@localhost workspace]$ cp 2015.03/application.properties mpo/
$ vi application.properties
base.product=mpo







/ Einde FIX MPO-139


/ See ook BARD-111

/ Einde MPO-139

/ INSTALL CEVA-15529

/ we moeten firebird database hebben voor dit issue	,

/ 13	.

[eric@localhost bin]$ dsvcts-ssh-a.sh 
[vanderveldene@application-a ~]$ cat /etc/hosts
...
192.168.173.10	Application-a.intermax.mp-objects.com	Application-a
80.95.170.185	integration
192.168.173.10	application
192.168.173.20	database

[vanderveldene@application-a ~]$ less /local/apps/jboss-4.0.5.GA/server/dsvcts/deploy/firebird-ds.xml
     <connection-url>jdbc:firebirdsql://database//local/apps/firebird/dsvcts.fdb?defaultResultSetHoldable=true</connection-url>
     <user-name>SYSDBA</user-name>
     <password>+qjweLrf</password>

/ database is database-a	,

/ 13	. 

////////////////////////////////////////////
/ Onthoud	,
/ alleen de user firebird kan gbak	,

///////////////////////////////////
/ Zorg ook dat de current dir is niet o+w	, anders kan firebird niet write	,

/ Lees	,
http://forums.devshed.com/firebird-sql-development-61/gbak-restore-linux-453690.html

[eric@localhost bin]$ dsvcts-ssh-db-a.sh 

[vanderveldene@database-a ~]$ cat /etc/hosts
192.168.173.20	Database-a.intermax.mp-objects.com	Database-a

/ Hier zijn de database backups	,

[eric@localhost bin]$ scp vanderveldene@database-a.intermax.mp-objects.com:/backup/mpo-backup/db/dsvcts.fdb_20160315-031355.fbk.gz /home/eric/DB_TAP/Firebird/Misc/
dsvcts.fdb_20160315-031355.fbk.gz                                                                           100% 2469MB   1.6MB/s   25:46    

[eric@localhost bin]$ scp vanderveldene@database-a.intermax.mp-objects.com:/backup/mpo-backup/db/dsvoms.fdb_20160315-044450.fbk.gz /home/eric/DB_TAP/Firebird/Misc/
dsvoms.fdb_20160315-044450.fbk.gz                                                                           100% 5438KB   1.3MB/s   00:04    

[eric@localhost Misc]$ scp vanderveldene@database-a.intermax.mp-objects.com:/backup/mpo-backup/db/dsvcts.fdb_20160316-025058.fbk.gz .
[eric@localhost Misc]$ scp vanderveldene@database-a.intermax.mp-objects.com:/backup/mpo-backup/db/dsvoms.fdb_20160316-041943.fbk.gz .
f
[eric@localhost Misc]$ sudo chown firebird.firebird dsvoms.fdb_20160316-041943.fbk.gz 
[eric@localhost Misc]$ sudo -u firebird gzip -d dsvoms.fdb_20160316-041943.fbk.gz 
gzip: dsvoms.fdb_20160316-041943.fbk: Permission denied
///////////////////////////////////
/ De current dir Misc is niet o+w	,
[eric@localhost Misc]$ cd ..
[eric@localhost Firebird]$ chmod o+w Misc/
[eric@localhost Firebird]$ cd Misc/
[eric@localhost Misc]$ sudo -u firebird gzip -d dsvoms.fdb_20160316-041943.fbk.gz 
/ OK
[eric@localhost Misc]$ sudo -u firebird gbak -c -user sysdba -password masterkey dsvoms.fdb_20160316-041943.fbk dsvoms.fdb_20160316-041943.fdb

/ Herinner	, de Misc/ moet o+w	,  en de user moet firebird zijn,	
[eric@localhost Misc]$ sudo chown firebird.firebird dsvcts.fdb_20160316-025058.fbk.gz
[eric@localhost Misc]$ sudo -u firebird gzip -d dsvcts.fdb_20160316-025058.fbk.gz
[eric@localhost Misc]$ sudo -u firebird gbak -c -user sysdba -password masterkey dsvcts.fdb_20160316-025058.fbk dsvcts.fdb_20160316-025058.fdb

[eric@localhost Misc]$ isql-fb -u sysdba -p masterkey dsvcts.fdb_20160316-025058.fdb
/ OK
[eric@localhost Misc]$ isql-fb -u sysdba -p masterkey dsvoms.fdb_20160316-041943.fdb
/ OK

/ 13	. 

[eric@localhost wartsila]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/wartsila

$ vi deploy/firebird-ds.xml
 <datasources>
   <local-tx-datasource>
    <connection-url>jdbc:firebirdsql://127.0.0.1//home/eric/DB_TAP/Firebird/Misc/dsvcts.fdb_20160316-025058.fdb?no_result_set_tracking&amp;defaultResultSetHoldable=true</connection-url>
/ OK

/home/eric/DB_TAP/Firebird/Misc/dsvoms.fdb_20160316-041943.fdb
/ TODO

/ 13	. 

////////////////////////////////////////////////
/ encryptie login	,

PDurr
Ceva2010
dece2a8e0f2ce1d9ff98b5cd0e993fde

local-admin
unitA5004
7502edee2555bcdd9f401f13e16dbd6a

module.login.encryption.enabled=false

/ Vervang server/wartsila/conf/mpokey.dat door
f74c52f12697e5cda11f58928ad3f2f22501efa8167ad3b3

/ we doen	,
[eric@localhost wartsila]$ echo -n f74c52f12697e5cda11f58928ad3f2f22501efa8167ad3b3 >conf/mpokey.dat 

SQL> update tms_user set user_password='dece2a8e0f2ce1d9ff98b5cd0e993fde' where user_id='PDurr';

SQL> update tms_user set is_enabled=1 where user_id='PDurr';
SQL> commit;
SQL> select login_attempt from tms_user where user_id='PDurr';

LOGIN_ATTEMPT 
============ 
           4 
/ Moet 0 worden	,

SQL> update tms_user set login_attempt=0 where user_id='PDurr';
SQL> commit;
/ Als verkeerd inlog	, dan login_attempt++	, 
/ als succesvol inlog	, dan =0

/ 13	. 

/ de log/query.log is 0 bytes	,

/ we hadden WH toevallig een wartsila/ in jboss 	,





/ Einde INSTALL CEVA-15529

/ CEVA-15529

$ vi ServiceActionTypeEventType.standard.hbm.xml

<hibernate-mapping>
	<class name="com.mpobjects.event.sateventtype.model.ServiceActionTypeEventType" table="event_sat_event_type">
		<cache usage="read-write" />
		<id name="systemId" type="int" unsaved-value="0" column="system_id">
			<generator class="com.mpobjects.util.dao.SafeSequenceStyleGenerator">
				<param name="sequence_name">sysid_SATEventType</param>
				<param name="increment_size">1</param>
			</generator>
		</id>
		<many-to-one name="organization" column="organization_systemid" class="com.mpobjects.oms.model.entity.organization.Organization"  fetch="join" not-null="true" />
		<many-to-one name="role" column="role_systemid" class="com.mpobjects.oms.model.entity.role.RoleVO" fetch="join" not-null="false" />
		
		<many-to-one name="serviceActionType" column="sat_systemid" class="com.mpobjects.oms.model.entity.serviceactiontype.ServiceActionType" fetch="join" not-null="true" />
		<many-to-one name="eventType" column="event_type_systemid" class="com.mpobjects.event.model.entity.eventtype.EventType" fetch="join" not-null="true" />
		<property name="sequence" column="SEQUENCE" />
	</class>
</hibernate-mapping>

$ vi ServiceActionTypeEventTypeDAOImpl.java

public class ServiceActionTypeEventTypeDAOImpl extends GenericHibernateDAO<ServiceActionTypeEventType> implements ServiceActionTypeEventTypeDAO {

/ 13	. 

/ ERROR 	,
org.firebirdsql.jdbc.FBSQLException: GDS Exception. 335544569. Dynamic SQL Error
SQL error code = -104
Invalid expression in the select list (not contained in either an aggregate function or the GROUP BY clause)

/ Lees	,
http://www.firebirdfaq.org/faq184/

But, if you try:

select *, emp_no from EMPLOYEE;

You'll the the error:

335544569 Invalid token
SQL error code = -104
Token unknown - line 1, char 9 ,
 
/ 7	. 

/ Er is op de instances	pagina	,
Wartsila (TEST)
durrp
...
/ we hebben create	,
eric
rtdMpo45

/ TODO (Afmaken WICKET TABLES MICHEL)


/ Einde CEVA-15529

/ DEBUG CEVA-15529

/ Configuration, Execution, Sat et
/=
ServiceActionTypeEventTypeListPage	, wicket page	,

/ De ServiceActionTypeEventTypeDAOImpl.runQuery wordt 2 keer called	, 
/ 1 keer voor de size = aantal rows te bepalen	, en 1 keer ... TODO

/s
	ServiceActionTypeEventTypeDAOImpl.runQuery(QueryParam, DAOFilterExpression<ServiceActionTypeEventType>) line: 75	
	ServiceActionTypeEventTypeDAOImpl.runQueryCount(DAOFilterExpression<ServiceActionTypeEventType>) line: 122	
		return runQuery(null, aFilter).size();

	ServiceActionTypeEventTypeSearchListPanel$ServiceActionTypeEventTypeDataProviderBuilder$ServiceActionTypeEventTypeDataProvider(GenericTableDataProvider).size() line: 243	
		int size = daoWrapper.getBean().runQueryCount(filter);

	DataTable$1(DataViewBase).internalGetItemCount() line: 141	
	DataTable$1(AbstractPageableView).getItemCount() line: 258	
	DataTable$1(AbstractPageableView).getRowCount() line: 240	
	DataTable$1(AbstractPageableView).getViewSize() line: 352	
	DataTable$1(AbstractPageableView).getItemModels() line: 105	
	DataTable$1(RefreshingView).onPopulate() line: 94	
	DataTable$1(AbstractRepeater).onBeforeRender() line: 131	
	DataTable$1(AbstractPageableView).onBeforeRender() line: 121	
	DataTable$1(Component).internalBeforeRender() line: 1069	
	DataTable$1(Component).beforeRender() line: 1103	
	WebMarkupContainer(MarkupContainer).onBeforeRenderChildren() line: 1777	
	WebMarkupContainer(Component).onBeforeRender() line: 4001	
	WebMarkupContainer(Component).internalBeforeRender() line: 1069	
	WebMarkupContainer(Component).beforeRender() line: 1103	
	MpoDataTable(MarkupContainer).onBeforeRenderChildren() line: 1777	
	MpoDataTable(Component).onBeforeRender() line: 4001	
	MpoDataTable(Component).internalBeforeRender() line: 1069	
	MpoDataTable(Component).beforeRender() line: 1103	
	CheckGroup(MarkupContainer).onBeforeRenderChildren() line: 1777	
	CheckGroup(Component).onBeforeRender() line: 4001	
	CheckGroup(Component).internalBeforeRender() line: 1069	
	CheckGroup(Component).beforeRender() line: 1103	
	FilterForm(MarkupContainer).onBeforeRenderChildren() line: 1777	
	FilterForm(Component).onBeforeRender() line: 4001	
	FilterForm(Form).onBeforeRender() line: 2104	
	FilterForm(Component).internalBeforeRender() line: 1069	
	FilterForm(Component).beforeRender() line: 1103	
	ServiceActionTypeEventTypeSearchListPanel(MarkupContainer).onBeforeRenderChildren() line: 1777	
	ServiceActionTypeEventTypeSearchListPanel(Component).onBeforeRender() line: 4001	
	ServiceActionTypeEventTypeSearchListPanel(Component).internalBeforeRender() line: 1069	
	ServiceActionTypeEventTypeSearchListPanel(Component).beforeRender() line: 1103	
	ServiceActionTypeEventTypeListPage(MarkupContainer).onBeforeRenderChildren() line: 1777	
	ServiceActionTypeEventTypeListPage(Component).onBeforeRender() line: 4001	
	ServiceActionTypeEventTypeListPage(Page).onBeforeRender() line: 1555	
	ServiceActionTypeEventTypeListPage(Component).internalBeforeRender() line: 1069	
	ServiceActionTypeEventTypeListPage(Component).beforeRender() line: 1103	
	ServiceActionTypeEventTypeListPage(Component).prepareForRender(boolean) line: 2297	
	ServiceActionTypeEventTypeListPage(Page).prepareForRender(boolean) line: 1545	
	ServiceActionTypeEventTypeListPage(Component).prepareForRender() line: 2329	
	ServiceActionTypeEventTypeListPage(Page).renderPage() line: 912	
	MpoWebRequestCycle(WebRequestCycle).redirectTo(Page) line: 201	
	PageRequestTarget.respond(RequestCycle) line: 58	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/s
	ServiceActionTypeEventTypeDAOImpl.runQuery(QueryParam, DAOFilterExpression<ServiceActionTypeEventType>) line: 75	
	ServiceActionTypeEventTypeSearchListPanel$ServiceActionTypeEventTypeDataProviderBuilder$ServiceActionTypeEventTypeDataProvider(GenericTableDataProvider).iterator(int, int) line: 212	
		} else {
			return daoWrapper.getBean().runQuery(queryParam, filter).iterator();

	DataViewBase$ModelIterator.<init>(IDataProvider<T>, int, int) line: 109	
			items = count > 0 ? dataProvider.iterator(offset, count) : null;

	DataTable$1(DataViewBase).getItemModels(int, int) line: 76	
	DataTable$1(AbstractPageableView).getItemModels() line: 107	
	DataTable$1(RefreshingView).onPopulate() line: 94	
	DataTable$1(AbstractRepeater).onBeforeRender() line: 131	
	DataTable$1(AbstractPageableView).onBeforeRender() line: 121	
	DataTable$1(Component).internalBeforeRender() line: 1069	
	DataTable$1(Component).beforeRender() line: 1103	
	WebMarkupContainer(MarkupContainer).onBeforeRenderChildren() line: 1777	
	WebMarkupContainer(Component).onBeforeRender() line: 4001	
	WebMarkupContainer(Component).internalBeforeRender() line: 1069	
	WebMarkupContainer(Component).beforeRender() line: 1103	
	MpoDataTable(MarkupContainer).onBeforeRenderChildren() line: 1777	
	MpoDataTable(Component).onBeforeRender() line: 4001	
	MpoDataTable(Component).internalBeforeRender() line: 1069	
	MpoDataTable(Component).beforeRender() line: 1103	
	CheckGroup(MarkupContainer).onBeforeRenderChildren() line: 1777	
	CheckGroup(Component).onBeforeRender() line: 4001	
	CheckGroup(Component).internalBeforeRender() line: 1069	
	CheckGroup(Component).beforeRender() line: 1103	
	FilterForm(MarkupContainer).onBeforeRenderChildren() line: 1777	
	FilterForm(Component).onBeforeRender() line: 4001	
	FilterForm(Form).onBeforeRender() line: 2104	
	FilterForm(Component).internalBeforeRender() line: 1069	
	FilterForm(Component).beforeRender() line: 1103	
	ServiceActionTypeEventTypeSearchListPanel(MarkupContainer).onBeforeRenderChildren() line: 1777	
	ServiceActionTypeEventTypeSearchListPanel(Component).onBeforeRender() line: 4001	
	ServiceActionTypeEventTypeSearchListPanel(Component).internalBeforeRender() line: 1069	
	ServiceActionTypeEventTypeSearchListPanel(Component).beforeRender() line: 1103	
	ServiceActionTypeEventTypeListPage(MarkupContainer).onBeforeRenderChildren() line: 1777	
	ServiceActionTypeEventTypeListPage(Component).onBeforeRender() line: 4001	
	ServiceActionTypeEventTypeListPage(Page).onBeforeRender() line: 1555	
	ServiceActionTypeEventTypeListPage(Component).internalBeforeRender() line: 1069	
	ServiceActionTypeEventTypeListPage(Component).beforeRender() line: 1103	
	ServiceActionTypeEventTypeListPage(Component).prepareForRender(boolean) line: 2297	
	ServiceActionTypeEventTypeListPage(Page).prepareForRender(boolean) line: 1545	
	ServiceActionTypeEventTypeListPage(Component).prepareForRender() line: 2329	
	ServiceActionTypeEventTypeListPage(Page).renderPage() line: 912	
	MpoWebRequestCycle(WebRequestCycle).redirectTo(Page) line: 201	
	PageRequestTarget.respond(RequestCycle) line: 58	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	



/ we gaan debug	,
ServiceActionTypeEventTypeSearchListPanel$ServiceActionTypeEventTypeDataProviderBuilder$ServiceActionTypeEventTypeDataProvider(GenericTableDataProvider).size() line: 243	

		int size = daoWrapper.getBean().runQueryCount(filter);
/ daoWrapper=
com.mpobjects.view.wicket.util.BeanWrapper@49db33d9[type=interface com.mpobjects.event.dao.sateventtype.ServiceActionTypeEventTypeDAO,beanName=<null>]
/ filter=
com.mpobjects.view.wicket.util.multi.GenericTableDataProvider$FilterStateFilterExpression@472151af[filterValues={},filterParameter={},legacyFilterObject=[0, , , , ] = 0]
/s
ServiceActionTypeEventTypeDAOImpl.runQueryCount(DAOFilterExpression<ServiceActionTypeEventType>) line: 122	
		return runQuery(null, aFilter).size();
/s
ServiceActionTypeEventTypeDAOImpl.runQuery(QueryParam, DAOFilterExpression<ServiceActionTypeEventType>) line: 75	

		hql.append("select o, sat, r ");
		hql.append("from ServiceActionTypeEventType satEt ");
		hql.append("join satEt.serviceActionType sat ");
		hql.append("join satEt.organization o ");
		hql.append("left join satEt.role r ");

		if (!aFilter.getParameters().isEmpty()) {
/ NEE
		hql.append(" group by o.id, o.code, r.id, r.code, sat.id, sat.code ");
		Query query = getHibernateTemplate().getSessionFactory().getCurrentSession().createQuery(hql.toString());
query=
QueryImpl(select o, sat, r from ServiceActionTypeEventType satEt join satEt.serviceActionType sat join satEt.organization o left join satEt.role r  group by o.id, o.code, r.id, r.code, sat.id, sat.code )

		List<Object[]> results = query.list();
results	ArrayList  (id=18323)	
	elementData	Object[18]  (id=18326)	
		[0]	Object[3]  (id=18329)	
			[0]	Organization  (id=18361)	
SystemId:500	Id:PNL-CARGO	Description:PostNL Cargo
			[1]	ServiceActionType  (id=18362)	
26681851/COLLECT/Collect / Ophaal
			[2]	RoleVO  (id=18363)	
SystemId:26777869	Name:R_CUSTOMER_SERVICE	Description:Role for employee Customer Service department
		[1]	Object[3]  (id=18330)	
		[2]	Object[3]  (id=18332)	
		[3]	Object[3]  (id=18333)	
		[4]	Object[3]  (id=18335)	
		[5]	Object[3]  (id=18337)	
		[6]	Object[3]  (id=18339)	
		[7]	Object[3]  (id=18341)	
		[8]	Object[3]  (id=18343)	
		[9]	Object[3]  (id=18344)	
		[10]	Object[3]  (id=18346)	
		[11]	Object[3]  (id=18348)	
		[12]	Object[3]  (id=18350)	
		[13]	Object[3]  (id=18352)	
		[14]	Object[3]  (id=18354)	
		[15]	Object[3]  (id=18355)	
		[16]	Object[3]  (id=18357)	
		[17]	Object[3]  (id=18359)	
	size	18	

		List<ServiceActionTypeEventType> resultList = new ArrayList<ServiceActionTypeEventType>();
		for (Object[] objects : results) {
			resultList.add(new ServiceActionTypeEventType((ServiceActionType) objects[1], (Organization) objects[0], (RoleVO) objects[2]));
		}

resultList	ArrayList  (id=20226)	
	elementData	Object[22]  (id=20227)	
		[0]	ServiceActionTypeEventType  (id=20228)	
			eventType	null	
			organization	Organization  (id=18361)	
SystemId:500	Id:PNL-CARGO	Description:PostNL Cargo
			performanceMonitorService	null	
			role	RoleVO  (id=18363)	
SystemId:26777869	Name:R_CUSTOMER_SERVICE	Description:Role for employee Customer Service department
			sequence	0	
			serviceActionType	ServiceActionType  (id=18362)	
26681851/COLLECT/Collect / Ophaal
			systemId	0	
		[1]	ServiceActionTypeEventType  (id=20229)	
		[2]	ServiceActionTypeEventType  (id=20230)	
		[3]	ServiceActionTypeEventType  (id=20231)	
		[4]	ServiceActionTypeEventType  (id=20232)	
		[5]	ServiceActionTypeEventType  (id=20233)	
		[6]	ServiceActionTypeEventType  (id=20234)	
		[7]	ServiceActionTypeEventType  (id=20235)	
		[8]	ServiceActionTypeEventType  (id=20236)	
		[9]	ServiceActionTypeEventType  (id=20237)	
		[10]	ServiceActionTypeEventType  (id=20238)	
		[11]	ServiceActionTypeEventType  (id=20239)	
		[12]	ServiceActionTypeEventType  (id=20240)	
		[13]	ServiceActionTypeEventType  (id=20241)	
		[14]	ServiceActionTypeEventType  (id=20242)	
		[15]	ServiceActionTypeEventType  (id=20243)	
		[16]	ServiceActionTypeEventType  (id=20244)	
		[17]	ServiceActionTypeEventType  (id=20245)	
	size	18	




	<class name="com.mpobjects.event.sateventtype.model.ServiceActionTypeEventType" table="event_sat_event_type">

/ we zien in de hibernate.log	,

[eric@localhost misc]$ pwd
/home/eric/Devel/Firebird/scripts/misc
[eric@localhost misc]$ cat ceva-15529.sql\$firebird
select
organizati2_.SYSTEM_ID as SYSTEM1_147_0_,
serviceact1_.SYSTEM_ID as SYSTEM1_96_1_,
rolevo3_.SYSTEM_ID as SYSTEM1_165_2_,
organizati2_.IS_DELETED as IS2_147_0_,
organizati2_.SEQUENCE as SEQUENCE147_0_,
organizati2_.ORGANIZATION_ID as ORGANIZA4_147_0_,
organizati2_.DESCRIPTION as DESCRIPT5_147_0_,
organizati2_.ORGANIZATION_GROUP as ORGANIZA6_147_0_,
organizati2_.AUTOM_RATE_CALC as AUTOM7_147_0_,
organizati2_.EDI_IDENTIFIER as EDI8_147_0_,
serviceact1_.SERVICE_ACTION_TYPE as SERVICE2_96_1_,
serviceact1_.DESCRIPTION as DESCRIPT3_96_1_,
serviceact1_.IS_TRACK_TRACE as IS4_96_1_,
serviceact1_.VISIBILITY as VISIBILITY96_1_,
serviceact1_.IS_DELETED as IS6_96_1_,
serviceact1_.QUOTATION_MODE as QUOTATION7_96_1_,
serviceact1_.PATH_EVALUATION_MODE as PATH8_96_1_,
rolevo3_.NAME as NAME165_2_,
rolevo3_.DESCRIPTION as DESCRIPT3_165_2_,
rolevo3_.ROLE_WEIGHT as ROLE4_165_2_,
rolevo3_.CHARGE_TYPE as CHARGE5_165_2_,
rolevo3_.IS_DELETED as IS6_165_2_,
rolevo3_.ACCOUNT_EXP as ACCOUNT7_165_2_,
rolevo3_.PASSWORD_EXP as PASSWORD8_165_2_,
rolevo3_.SESSION_TIMEOUT as SESSION9_165_2_,
rolevo3_.GRACE_LOGINS as GRACE10_165_2_
from event_sat_event_type serviceact0_
inner join SERVICE_ACTION_TYPE serviceact1_ on serviceact0_.sat_systemid=serviceact1_.SYSTEM_ID
inner join ORGANIZATION organizati2_ on serviceact0_.organization_systemid=organizati2_.SYSTEM_ID
left outer join TMS_ROLE rolevo3_ on serviceact0_.role_systemid=rolevo3_.SYSTEM_ID
group by 
organizati2_.SYSTEM_ID , 
organizati2_.ORGANIZATION_ID , 
rolevo3_.SYSTEM_ID , 
rolevo3_.NAME ,
serviceact1_.SYSTEM_ID , 
serviceact1_.SERVICE_ACTION_TYPE
;

[eric@localhost Misc]$ isql-fb -u sysdba -p masterkey dsvcts.fdb_20160316-025058.fdb </home/eric/Devel/Firebird/scripts/misc/ceva-15529.sql 
Statement failed, SQLSTATE = 42000
Dynamic SQL Error
-SQL error code = -104
-Invalid expression in the select list (not contained in either an aggregate function or the GROUP BY clause)

/ we start cargo	, op pnllogistics6a	, en we zien in de log	,

$ vi /home/eric/Devel/Firebird/scripts/misc/ceva-15529.sql\$postgres 
select 
organizati2_.SYSTEM_ID as SYSTEM1_147_0_,
serviceact1_.SYSTEM_ID as SYSTEM1_98_1_,
rolevo3_.SYSTEM_ID as SYSTEM1_165_2_,
organizati2_.IS_DELETED as IS2_147_0_,
organizati2_.SEQUENCE as SEQUENCE147_0_,
organizati2_.ORGANIZATION_ID as ORGANIZA4_147_0_,
organizati2_.DESCRIPTION as DESCRIPT5_147_0_,
organizati2_.ORGANIZATION_GROUP as ORGANIZA6_147_0_,
organizati2_.AUTOM_RATE_CALC as AUTOM7_147_0_,
organizati2_.EDI_IDENTIFIER as EDI8_147_0_,
serviceact1_.SERVICE_ACTION_TYPE as SERVICE2_98_1_,
serviceact1_.DESCRIPTION as DESCRIPT3_98_1_,
serviceact1_.IS_TRACK_TRACE as IS4_98_1_,
serviceact1_.VISIBILITY as VISIBILITY98_1_,
serviceact1_.IS_DELETED as IS6_98_1_,
serviceact1_.QUOTATION_MODE as QUOTATION7_98_1_,
serviceact1_.PATH_EVALUATION_MODE as PATH8_98_1_,
rolevo3_.NAME as NAME165_2_,
rolevo3_.DESCRIPTION as DESCRIPT3_165_2_,
rolevo3_.ROLE_WEIGHT as ROLE4_165_2_,
rolevo3_.CHARGE_TYPE as CHARGE5_165_2_,
rolevo3_.IS_DELETED as IS6_165_2_,
rolevo3_.ACCOUNT_EXP as ACCOUNT7_165_2_,
rolevo3_.PASSWORD_EXP as PASSWORD8_165_2_,
rolevo3_.SESSION_TIMEOUT as SESSION9_165_2_,
rolevo3_.GRACE_LOGINS as GRACE10_165_2_ 
from event_sat_event_type serviceact0_ 
inner join SERVICE_ACTION_TYPE serviceact1_ on serviceact0_.sat_systemid=serviceact1_.SYSTEM_ID 
inner join ORGANIZATION organizati2_ on serviceact0_.organization_systemid=organizati2_.SYSTEM_ID 
left outer join TMS_ROLE rolevo3_ on serviceact0_.role_systemid=rolevo3_.SYSTEM_ID 
group by organizati2_.SYSTEM_ID ,
organizati2_.ORGANIZATION_ID ,
rolevo3_.SYSTEM_ID ,
rolevo3_.NAME ,
serviceact1_.SYSTEM_ID ,
serviceact1_.SERVICE_ACTION_TYPE 
order by serviceact1_.SERVICE_ACTION_TYPE
;


/ we zien een extra order	, 
/ maar afgezien daarvan	, zien we dat beide queries in postgres OK	, 

[eric@localhost wicket]$ PGPASSWORD=mpopostgres@mpo psql  -U mpopostgres pnllogistics6a </home/eric/Devel/Firebird/scripts/misc/ceva-15529.sql\$firebird
/ OK
[eric@localhost wicket]$ PGPASSWORD=mpopostgres@mpo psql  -U mpopostgres pnllogistics6a </home/eric/Devel/Firebird/scripts/misc/ceva-15529.sql\$postgres 

/ MORGENOCHTEND
/ start pnllogistics	, 
/ See 
[eric@localhost misc]$ pwd
/home/eric/Devel/Firebird/scripts/misc
ceva-15529.sql$firebird  ceva-15529.sql$firebird.work  ceva-15529.sql$postgres

  

/ 7	. 

/ Verbetering	,

select
organizati2_.SYSTEM_ID as SYSTEM1_147_0_,
serviceact1_.SYSTEM_ID as SYSTEM1_96_1_,
rolevo3_.SYSTEM_ID as SYSTEM1_165_2_,
organizati2_.IS_DELETED as IS2_147_0_,
organizati2_.SEQUENCE as SEQUENCE147_0_,
organizati2_.ORGANIZATION_ID as ORGANIZA4_147_0_,
organizati2_.DESCRIPTION as DESCRIPT5_147_0_,
organizati2_.ORGANIZATION_GROUP as ORGANIZA6_147_0_,
organizati2_.AUTOM_RATE_CALC as AUTOM7_147_0_,
organizati2_.EDI_IDENTIFIER as EDI8_147_0_,
serviceact1_.SERVICE_ACTION_TYPE as SERVICE2_96_1_,
serviceact1_.DESCRIPTION as DESCRIPT3_96_1_,
serviceact1_.IS_TRACK_TRACE as IS4_96_1_,
serviceact1_.VISIBILITY as VISIBILITY96_1_,
serviceact1_.IS_DELETED as IS6_96_1_,
serviceact1_.QUOTATION_MODE as QUOTATION7_96_1_,
serviceact1_.PATH_EVALUATION_MODE as PATH8_96_1_,
rolevo3_.NAME as NAME165_2_,
rolevo3_.DESCRIPTION as DESCRIPT3_165_2_,
rolevo3_.ROLE_WEIGHT as ROLE4_165_2_,
rolevo3_.CHARGE_TYPE as CHARGE5_165_2_,
rolevo3_.IS_DELETED as IS6_165_2_,
rolevo3_.ACCOUNT_EXP as ACCOUNT7_165_2_,
rolevo3_.PASSWORD_EXP as PASSWORD8_165_2_,
rolevo3_.SESSION_TIMEOUT as SESSION9_165_2_,
rolevo3_.GRACE_LOGINS as GRACE10_165_2_
from event_sat_event_type serviceact0_
inner join SERVICE_ACTION_TYPE serviceact1_ on serviceact0_.sat_systemid=serviceact1_.SYSTEM_ID
inner join ORGANIZATION organizati2_ on serviceact0_.organization_systemid=organizati2_.SYSTEM_ID
left outer join TMS_ROLE rolevo3_ on serviceact0_.role_systemid=rolevo3_.SYSTEM_ID
group by 
organizati2_.SYSTEM_ID , 
organizati2_.ORGANIZATION_ID , 
rolevo3_.SYSTEM_ID , 
rolevo3_.NAME ,
serviceact1_.SYSTEM_ID , 
serviceact1_.SERVICE_ACTION_TYPE




/ Einde DEBUG CEVA-15529

/ POSTGRESQL

/ 7	.

[eric@localhost misc]$ vi ceva-15529.sql\$firebird.work4

select
count(*)
from event_sat_event_type serviceact0_
inner join SERVICE_ACTION_TYPE serviceact1_ on serviceact0_.sat_systemid=serviceact1_.SYSTEM_ID
inner join ORGANIZATION organizati2_ on serviceact0_.organization_systemid=organizati2_.SYSTEM_ID
left outer join TMS_ROLE rolevo3_ on serviceact0_.role_systemid=rolevo3_.SYSTEM_ID
--group by  
--organizati2_.SYSTEM_ID,  
--organizati2_.ORGANIZATION_ID ,
--rolevo3_.SYSTEM_ID ,  
--rolevo3_.NAME ,
--serviceact1_.SYSTEM_ID  
--serviceact1_.SERVICE_ACTION_TYPE
;

[eric@localhost Misc]$ PGPASSWORD=mpopostgres@mpo psql  -U mpopostgres pnllogistics6a </home/eric/Devel/Firebird/scripts/misc/ceva-15529.sql\$firebird.work4
Null display is "NULL".
 count 
-------
   361
(1 row)

/ 13	. 

[eric@localhost misc]$ vi ceva-15529.sql\$firebird.work4

select
count(*)
from event_sat_event_type serviceact0_
inner join SERVICE_ACTION_TYPE serviceact1_ on serviceact0_.sat_systemid=serviceact1_.SYSTEM_ID
inner join ORGANIZATION organizati2_ on serviceact0_.organization_systemid=organizati2_.SYSTEM_ID
left outer join TMS_ROLE rolevo3_ on serviceact0_.role_systemid=rolevo3_.SYSTEM_ID
group by  
organizati2_.SYSTEM_ID,  
--organizati2_.ORGANIZATION_ID ,
rolevo3_.SYSTEM_ID ,  
--rolevo3_.NAME ,
serviceact1_.SYSTEM_ID  
--serviceact1_.SERVICE_ACTION_TYPE
--;

[eric@localhost Misc]$ PGPASSWORD=mpopostgres@mpo psql  -U mpopostgres pnllogistics6a </home/eric/Devel/Firebird/scripts/misc/ceva-15529.sql\$firebird.work4
Null display is "NULL".
 count 
-------
    21
    58
     5
     5
     2
    28
     9
     5
    21
    58
    21
    58
     3
     5
     3
    30
    12
    17
(18 rows)

/ 13	. 

[eric@localhost misc]$ vi ceva-15529.sql\$firebird.work4

select
organizati2_.SYSTEM_ID,rolevo3_.SYSTEM_ID ,serviceact1_.SYSTEM_ID ,count(*)
from event_sat_event_type serviceact0_
inner join SERVICE_ACTION_TYPE serviceact1_ on serviceact0_.sat_systemid=serviceact1_.SYSTEM_ID
inner join ORGANIZATION organizati2_ on serviceact0_.organization_systemid=organizati2_.SYSTEM_ID
left outer join TMS_ROLE rolevo3_ on serviceact0_.role_systemid=rolevo3_.SYSTEM_ID
group by  
organizati2_.SYSTEM_ID,  
--organizati2_.ORGANIZATION_ID ,
rolevo3_.SYSTEM_ID ,  
--rolevo3_.NAME ,
serviceact1_.SYSTEM_ID  
--serviceact1_.SERVICE_ACTION_TYPE
;

[eric@localhost Misc]$ PGPASSWORD=mpopostgres@mpo psql  -U mpopostgres pnllogistics6a </home/eric/Devel/Firebird/scripts/misc/ceva-15529.sql\$firebird.work4
Null display is "NULL".
 system_id | system_id | system_id | count 
-----------+-----------+-----------+-------
       500 |  26632027 |  26681855 |    21
       500 |  26632027 |  26681854 |    58
       500 |     10100 |  26681851 |     5
       500 |  26777869 |  26681851 |     5
       500 |  26780215 |  26681852 |     2
       500 |  26926010 |  26681854 |    28
       500 |  26926010 |  26681855 |     9
       500 |  26632027 |  26681851 |     5
       500 |     10100 |  26681855 |    21
       500 |  26777869 |  26681854 |    58
       500 |  26777869 |  26681855 |    21
       500 |     10100 |  26681854 |    58
       500 |  26857901 |  26681851 |     3
       500 |  26780215 |  26681851 |     5
       500 |  26857901 |  26681855 |     3
       500 |  26780215 |  26681854 |    30
       500 |  26780215 |  26681855 |    12
       500 |  26857901 |  26681854 |    17
(18 rows)

/////////////////////////////////////////////////////
/ Dus de org	| role	| sa  = 500 |  26632027 |  26681855  staat 21 keer in de event_sat_event_type table	, 

/ 13	. 

/ de id en code zijn toch 1-1, dus we hoeven niet te group op de code	,

[eric@localhost misc]$ vi ceva-15529.sql\$firebird.work4

select
organizati2_.SYSTEM_ID,organizati2_.ORGANIZATION_ID,rolevo3_.SYSTEM_ID ,rolevo3_.NAME,serviceact1_.SERVICE_ACTION_TYPE,serviceact1_.SYSTEM_ID ,count(*)
from event_sat_event_type serviceact0_
inner join SERVICE_ACTION_TYPE serviceact1_ on serviceact0_.sat_systemid=serviceact1_.SYSTEM_ID
inner join ORGANIZATION organizati2_ on serviceact0_.organization_systemid=organizati2_.SYSTEM_ID
left outer join TMS_ROLE rolevo3_ on serviceact0_.role_systemid=rolevo3_.SYSTEM_ID
group by  
organizati2_.SYSTEM_ID,  
--organizati2_.ORGANIZATION_ID ,
rolevo3_.SYSTEM_ID ,  
--rolevo3_.NAME ,
serviceact1_.SYSTEM_ID  
--serviceact1_.SERVICE_ACTION_TYPE
;

[eric@localhost Misc]$ PGPASSWORD=mpopostgres@mpo psql  -U mpopostgres pnllogistics6a </home/eric/Devel/Firebird/scripts/misc/ceva-15529.sql\$firebird.work4
Null display is "NULL".
 system_id | organization_id | system_id |        name        | service_action_type | system_id | count 
-----------+-----------------+-----------+--------------------+---------------------+-----------+-------
       500 | PNL-CARGO       |  26632027 | R_SUPERUSER        | PICKUP              |  26681855 |    21
       500 | PNL-CARGO       |  26632027 | R_SUPERUSER        | DELIVERY            |  26681854 |    58
       500 | PNL-CARGO       |     10100 | ADMINISTRATOR      | COLLECT             |  26681851 |     5
       500 | PNL-CARGO       |  26777869 | R_CUSTOMER_SERVICE | COLLECT             |  26681851 |     5
       500 | PNL-CARGO       |  26780215 | R_PARTNER          | LINEHAUL            |  26681852 |     2
       500 | PNL-CARGO       |  26926010 | R_PARTNER_INTERNAT | DELIVERY            |  26681854 |    28
       500 | PNL-CARGO       |  26926010 | R_PARTNER_INTERNAT | PICKUP              |  26681855 |     9
       500 | PNL-CARGO       |  26632027 | R_SUPERUSER        | COLLECT             |  26681851 |     5
       500 | PNL-CARGO       |     10100 | ADMINISTRATOR      | PICKUP              |  26681855 |    21
       500 | PNL-CARGO       |  26777869 | R_CUSTOMER_SERVICE | DELIVERY            |  26681854 |    58
       500 | PNL-CARGO       |  26777869 | R_CUSTOMER_SERVICE | PICKUP              |  26681855 |    21
       500 | PNL-CARGO       |     10100 | ADMINISTRATOR      | DELIVERY            |  26681854 |    58
       500 | PNL-CARGO       |  26857901 | R_DRIVER           | COLLECT             |  26681851 |     3
       500 | PNL-CARGO       |  26780215 | R_PARTNER          | COLLECT             |  26681851 |     5
       500 | PNL-CARGO       |  26857901 | R_DRIVER           | PICKUP              |  26681855 |     3
       500 | PNL-CARGO       |  26780215 | R_PARTNER          | DELIVERY            |  26681854 |    30
       500 | PNL-CARGO       |  26780215 | R_PARTNER          | PICKUP              |  26681855 |    12
       500 | PNL-CARGO       |  26857901 | R_DRIVER           | DELIVERY            |  26681854 |    17
(18 rows)

/ 13	. 

/ Dit kan ook	, WH omdat we query naar count(*)	,

[eric@localhost misc]$ cat  ceva-15529.sql\$firebird.work4
select
count(*)
from event_sat_event_type serviceact0_
inner join SERVICE_ACTION_TYPE serviceact1_ on serviceact0_.sat_systemid=serviceact1_.SYSTEM_ID
inner join ORGANIZATION organizati2_ on serviceact0_.organization_systemid=organizati2_.SYSTEM_ID
left outer join TMS_ROLE rolevo3_ on serviceact0_.role_systemid=rolevo3_.SYSTEM_ID
group by 
--organizati2_.SYSTEM_ID, 
organizati2_.ORGANIZATION_ID , 
--rolevo3_.SYSTEM_ID , 
rolevo3_.NAME ,
--serviceact1_.SYSTEM_ID 
serviceact1_.SERVICE_ACTION_TYPE
;

[eric@localhost Misc]$ PGPASSWORD=mpopostgres@mpo psql  -U mpopostgres pnllogistics6a </home/eric/Devel/Firebird/scripts/misc/ceva-15529.sql\$firebird.work4
Null display is "NULL".
 count 
-------
     3
     5
    30
     5
     5
     2
    12
    17
     9
    58
    58
    21
     5
    28
     3
    58
    21
    21
(18 rows)

/ TODO

/ 13	. 

select
organizati2_.SYSTEM_ID as SYSTEM1_147_0_,
serviceact1_.SYSTEM_ID as SYSTEM1_96_1_,
rolevo3_.SYSTEM_ID as SYSTEM1_165_2_,
organizati2_.IS_DELETED as IS2_147_0_,
organizati2_.SEQUENCE as SEQUENCE147_0_,
organizati2_.ORGANIZATION_ID as ORGANIZA4_147_0_,
organizati2_.DESCRIPTION as DESCRIPT5_147_0_,
organizati2_.ORGANIZATION_GROUP as ORGANIZA6_147_0_,
organizati2_.AUTOM_RATE_CALC as AUTOM7_147_0_,
organizati2_.EDI_IDENTIFIER as EDI8_147_0_,
serviceact1_.SERVICE_ACTION_TYPE as SERVICE2_96_1_,
serviceact1_.DESCRIPTION as DESCRIPT3_96_1_,
serviceact1_.IS_TRACK_TRACE as IS4_96_1_,
serviceact1_.VISIBILITY as VISIBILITY96_1_,
serviceact1_.IS_DELETED as IS6_96_1_,
serviceact1_.QUOTATION_MODE as QUOTATION7_96_1_,
serviceact1_.PATH_EVALUATION_MODE as PATH8_96_1_,
rolevo3_.NAME as NAME165_2_,
rolevo3_.DESCRIPTION as DESCRIPT3_165_2_,
rolevo3_.ROLE_WEIGHT as ROLE4_165_2_,
rolevo3_.CHARGE_TYPE as CHARGE5_165_2_,
rolevo3_.IS_DELETED as IS6_165_2_,
rolevo3_.ACCOUNT_EXP as ACCOUNT7_165_2_,
rolevo3_.PASSWORD_EXP as PASSWORD8_165_2_,
rolevo3_.SESSION_TIMEOUT as SESSION9_165_2_,
rolevo3_.GRACE_LOGINS as GRACE10_165_2_
from event_sat_event_type serviceact0_
inner join SERVICE_ACTION_TYPE serviceact1_ on serviceact0_.sat_systemid=serviceact1_.SYSTEM_ID
inner join ORGANIZATION organizati2_ on serviceact0_.organization_systemid=organizati2_.SYSTEM_ID
left outer join TMS_ROLE rolevo3_ on serviceact0_.role_systemid=rolevo3_.SYSTEM_ID
--group by
rganizati2_.SYSTEM_ID,
--organizati2_.ORGANIZATION_ID ,
rolevo3_.SYSTEM_ID ,
--rolevo3_.NAME ,
serviceact1_.SYSTEM_ID
--serviceact1_.SERVICE_ACTION_TYPE
;
////////////////////////////////////////
/ we print alleen org	, role	, sa columns	, precies waarop we group	,







/ Einde POSTGRESQL

/ SQL 

/ 7	. 

/ In postgres is het zo dat als we de primary key van een table add aan de group by	list, we kunnen select op alle columns van die table	,  
/ in firebird is dat niet zo	, 

/ POSTGRESQL


$ PGPASSWORD=foo psql -U foo
foo=> create table a1(id int,s varchar(32),primary key(id));
CREATE TABLE
foo=> create table a2(id int,s varchar(32),primary key(id));
CREATE TABLE
foo=> commit;
COMMIT
foo=> insert into a1 values(1,'foo'),(2,'bar');
INSERT 0 2
foo=> insert into a2 values(1,'gee'),(2,'hee');
INSERT 0 2
foo=> commit;
COMMIT

[eric@localhost Local]$ PGPASSWORD=foo psql -U foo <<_
> select a1.id,a1.s,a2.id,a2.s
> from a1 join a2 using(id)
> group by a1.id,a2.id;
> _
Null display is "NULL".
 id |  s  | id |  s  
----+-----+----+-----
  1 | foo |  1 | gee
  2 | bar |  2 | hee
(2 rows)

[eric@localhost Local]$ PGPASSWORD=foo psql -U foo 
Null display is "NULL".
psql (9.3.5)
Type "help" for help.

$ PGPASSWORD=foo psql -U foo
foo=> alter table a2 drop constraint a2_pkey;
foo=> commit;

[eric@localhost Local]$ PGPASSWORD=foo psql -U foo <<_
select a1.id,a1.s,a2.id,a2.s
from a1 join a2 using(id)
group by a1.id,a2.id;
_
ERROR:  column "a2.s" must appear in the GROUP BY clause or be used in an aggregate function
LINE 1: select a1.id,a1.s,a2.id,a2.s

[eric@localhost Local]$ PGPASSWORD=foo psql -U foo 
foo=> alter table a2  add primary key(id);
foo=> commit;


/ FIREBIRD

[eric@localhost wicket]$ local-db.sh /home/eric/DB_TAP/Firebird/Local/first.fdb
SQL> create table a1(id int,s varchar(32),primary key(id));
SQL> create table a2(id int,s varchar(32),primary key(id));
SQL> commit;

[eric@localhost wicket]$ local-db.sh /home/eric/DB_TAP/Firebird/Local/first.fdb
SQL> insert into a1 values(1,'foo');
SQL> insert into a1 values(2,'bar');
SQL> insert into a2 values(1,'gee');
SQL> insert into a2 values(2,'hee');
SQL> commit;

[eric@localhost wicket]$ local-db.sh /home/eric/DB_TAP/Firebird/Local/first.fdb <<_
> select a1.id,a1.s,a2.id,a2.s
> from a1 join a2 using(id)
> group by a1.id,a2.id;
> _
Dynamic SQL Error
-SQL error code = -104
-Invalid expression in the select list (not contained in either an aggregate function or the GROUP BY clause)

[eric@localhost wicket]$ local-db.sh /home/eric/DB_TAP/Firebird/Local/first.fdb <<_
select a1.id,a1.s,a2.id,a2.s
from a1 join a2 using(id)
group by a1.id,a1.s,a2.id,a2.s;
_
          ID S                                          ID S                                
============ ================================ ============ ================================ 
           1 foo                                         1 gee                              
           2 bar                                         2 hee                              

/ of zo	,

[eric@localhost wicket]$ local-db.sh /home/eric/DB_TAP/Firebird/Local/first.fdb <<_
select a1.id,max(a1.s),a2.id,max(a2.s)
from a1 join a2 using(id)
group by a1.id,a2.id;
_


          ID MAX                                        ID MAX                              
============ ================================ ============ ================================ 
           1 foo                                         1 gee                              
           2 bar                                         2 hee             










/ Einde SQL 

/ GSJ-71

[eric@localhost workspace]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace
[eric@localhost workspace]$ svn co https://system.mp-objects.com/svn/tms/patches/2016.01/geosco

[eric@localhost workspace]$ cp 2016.01/.project geosco/
[eric@localhost workspace]$ cp 2016.01/.classpath geosco/
[eric@localhost workspace]$ cp 2016.01/application.properties geosco/

[eric@localhost workspace]$ vi geosco/.project 
<projectDescription>
    <name>geosco</name>
[eric@localhost workspace]$ vi geosco/.classpath 
    <classpathentry kind="con" path="org.dbpowder.plugins.LIB_CONTAINER/recurse~project/geosco/base-framework/core/lib/jar"/>
    <classpathentry kind="con" path="org.dbpowder.plugins.LIB_CONTAINER/recurse~project/geosco/base-framework/buildscripts/build-lib"/>
    <classpathentry kind="con" path="org.dbpowder.plugins.LIB_CONTAINER/recurse~project/geosco/module/interfacing/lib"/>
[eric@localhost workspace]$ vi geosco/application.properties 
base.product=geosco

/ In eclipse	,
File, import..., General, Existing projects into workspace
/ Select root directory /home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/geosco

/ We zoeken	,
$ vi geosco.properties
...
module.ratecalc.cost.allocation.enabled=true





/ Einde GSJ-71

/ DSVSOL-2863

/ dsvfms	,

/ TODO

/ Einde DSVSOL-2863

/ DSVSOL-2869 

[jboss@application-a log]$ gunzip -c  server.log.2016-02-17.gz >my-server.log.2016-02-17
...
2016-02-17 01:03:33,526 ERROR [com.mpobjects.dsvfms.model.shipmentorder.xml.DsvFmsShipmentOrderMsgProcessor] (ShipmentOrderQueueContainer-1:) Error while processing shipment order: null
java.lang.NullPointerException
        at com.mpobjects.dsvfms.model.shipmentorder.xml.DsvFmsShipmentOrderMsgProcessor.processItemFileAndCreateCustomerOrderLine(DsvFmsShipmentOrderMsgProcessor.java:643)
        at com.mpobjects.dsvfms.model.shipmentorder.xml.DsvFmsShipmentOrderMsgProcessor.processDsvItemFile(DsvFmsShipmentOrderMsgProcessor.java:475)
        at com.mpobjects.dsvfms.model.shipmentorder.xml.DsvFmsShipmentOrderMsgProcessor.processCustomPurposeCode(DsvFmsShipmentOrderMsgProcessor.java:80)
        at com.mpobjects.oms.model.shipmentorder.xml.AbstractShipmentOrderMsgProcessor.process(AbstractShipmentOrderMsgProcessor.java:292)
        at com.mpobjects.oms.model.shipmentorder.util.ShipmentOrderMsgConsumer.process(ShipmentOrderMsgConsumer.java:56)
        at com.mpobjects.util.sap.control.MessageConsumer.handle(MessageConsumer.java:108)
        at com.mpobjects.util.messages.link.IncomingSapXMessageLink.handleMessage(IncomingSapXMessageLink.java:172)
        at com.mpobjects.util.messages.link.AbstractIncomingMessageLink.receiveMessage(AbstractIncomingMessageLink.java:66)
        at com.mpobjects.util.messages.link.IncomingSapXMessageLink.receiveMessage(IncomingSapXMessageLink.java:86)
        at com.mpobjects.util.jms.AbstractJmsListener.handleMessage(AbstractJmsListener.java:246)
        at com.mpobjects.dsvfms.integration.jms.ShipmentOrderListener.onMessage(ShipmentOrderListener.java:24)
...
        at java.lang.Thread.run(Thread.java:701)

/ we copy de msg van de ticket	,

/ 13	. 

[eric@localhost dsvfms]$ pwd
/home/eric/Devel/Interfaces/dsvfms
[eric@localhost dsvfms]$ cat dsvsol-2869.xml 
<?xml version="1.0" encoding="UTF-8"?>
<SHIPMENT_ORDER_MSG>
    <header>
        <typ>SHIPMENT_ORDER_MSG</typ>
        <mid>MP Objects DSV FMS POC</mid>
        <ver>1.0</ver>
        <mode>D</mode>
        <ack>NE</ack>
        <cre>Wed Feb 17 01:03:30 CET 2016</cre>
        <sap>sender administration</sap>
        <rap>receiver administration</rap>
    </header>
    <body>
        <SHIPMENT_ORDER>
            <PROCESSING_DETAILS>
                <PURPOSE_CODE>DSV_FMS_ITEM</PURPOSE_CODE>
            </PROCESSING_DETAILS>
            <SHIPMENT_ORDER_BODY>
                <COMMON>
                    <FROM_LOCATION>
                        <LOCATION_ID>W01</LOCATION_ID>
                        <LOCATION_TYPE>WAREHOUSE</LOCATION_TYPE>
                        <NAME>DSV SOLUTIONS</NAME>
                        <NAME2></NAME2>
                        <ADDRESS>TRADE BOULEVARD 4 haven nr 528</ADDRESS>
                        <CITY>Moerdijk</CITY>
                        <POSTAL_CODE>4761 RL</POSTAL_CODE>
                        <COUNTRY>
                            <COUNTRY_CODE>NL</COUNTRY_CODE>
...

-Xms128m -Xmx512m -XX:MaxPermSize=1024m
/ TODO

/ 13	. 

/ als we in de GUI Send Jms Message	, een message ingeven	, dan 	,
Destination: MPOBJECTS.TO.DSVFMS


/ 13	. 

public class DefaultPartyLookupService extends HibernateTemplate implements PartyLookupService {
	@Override
	@CheckForNull
	public MasterDataParty lookupParty(String aPartyId, @CheckForNull PartyLookupContext aContext) {
		if (organizationLessLookup && result == null && org == null) {
/ of	,
		if (organizationLessLookup && result == null && org != null) {

/ 13	. 

h^Zgcyr&Q

/ 13. 

[eric@localhost dsvfms]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/dsvfms
[eric@localhost dsvfms]$ cat conf/local_application.properties
module.omscarcon.carconfetcher.delay=999999999999
module.interfacing.jms.listener.autostartup=true 					
user.event.alert=off


module.interfacing.jms.listener.autostartup=true 					
/ OK
/ is default	,




/ Einde DSVSOL-2869 

/ INTEGRATION

/ 7	. 

/ integration-a	: /local/apps/interfaces/fms/jms/.../archive/2016.03/18/...

/ pnl-int-p: ...
/ op pnl-int-a geen msgs/ in 2016.03/18	, in archive/compressed

[eric@localhost bin]$ mk_ssh_passwordless_intermax.sh pnl-int-p

[vanderveldene@pnl-int-p to-scs]$ pwd
/local/apps/interface/postnl-cargo/jms/to-scs
[vanderveldene@pnl-int-p to-scs]$  ls
archive  LogisticOrderEvents  shipment-orders

[vanderveldene@pnl-int-p to-scs]$ ls archive/2016-03/
14  15  16  17
[vanderveldene@pnl-int-p to-scs]$ ls archive/2016-03/17/
Display all 1990 possibilities? (y or n)
[vanderveldene@pnl-int-p to-scs]$ ls archive/compressed/
/ LEEG	,
/ TODO

[vanderveldene@pnl-int-p to-scs]$ ls shipment-orders/archive/
2016-03  compressed
[vanderveldene@pnl-int-p to-scs]$ ls shipment-orders/archive/2016-03/
17  18
[vanderveldene@pnl-int-p to-scs]$ ls shipment-orders/archive/2016-03/18/GenericMessage_
...
[vanderveldene@pnl-int-p to-scs]$ ls shipment-orders/archive/compressed/
/ LEEG	, 
/ TODO

/ MAANDAGOCHTEND 


[vanderveldene@pnl-int-p to-scs]$ ls shipment-orders/archive/2016-03/18/
GenericMessage_20160317133024907299995.xml.SHIPMENT_ORDER.xml._.0000_0001.xml
GenericMessage_20160317155239893788099.xml.SHIPMENT_ORDER.xml._.0000_0004.xml
...
[vanderveldene@pnl-int-p to-scs]$ ls LogisticOrderEvents/archive/2016-03/18/BarcodeScan_SPIDER_201603180155
BarcodeScan_SPIDER_20160318015509920.txt.xml._.0015_1076.xml.LOE.xml  BarcodeScan_SPIDER_20160318015509920.txt.xml._.0830_1076.xml.LOE.xml
BarcodeScan_SPIDER_20160318015509920.txt.xml._.0016_1076.xml.LOE.xml  BarcodeScan_SPIDER_20160318015509920.txt.xml._.0831_1076.xml.LOE.xml
BarcodeScan_SPIDER_20160318015509920.txt.xml._.0017_1076.xml.LOE.xml  BarcodeScan_SPIDER_20160318015509920.txt.xml._.0832_1076.xml.LOE.xml
...

/ Op pnl-int-a	 zien we alleen archive/compressed	,
[vanderveldene@pnl-int-a to-scs]$ pwd
/local/apps/interface/postnl-cargo/jms/to-scs
[vanderveldene@pnl-int-a to-scs]$ ls archive/compressed/postnl-cargo_jms_to-scs_201
postnl-cargo_jms_to-scs_2015-05.zip  postnl-cargo_jms_to-scs_2015-09.zip  postnl-cargo_jms_to-scs_2016-01.zip
postnl-cargo_jms_to-scs_2015-06.zip  postnl-cargo_jms_to-scs_2015-10.zip  postnl-cargo_jms_to-scs_2016-02.zip
postnl-cargo_jms_to-scs_2015-07.zip  postnl-cargo_jms_to-scs_2015-11.zip  postnl-cargo_jms_to-scs_2016-03.zip
postnl-cargo_jms_to-scs_2015-08.zip  postnl-cargo_jms_to-scs_2015-12.zip  

[vanderveldene@pnl-int-a to-scs]$ unzip -l archive/compressed/postnl-cargo_jms_to-scs_2016-03.zip 
/ gunzip werkt NIET	,





/ Einde INTEGRATION

/ DEBUG DSVSOL-2869 

/ start dsvfms	,  met debugging aan	, dan pakt hij resteerende messages op	,

/ CREATE SHIPMENT ORDER FROM XML	,

/ 1ste XML	,

[eric@localhost dsvfms]$ pwd
/home/eric/Devel/Interfaces/dsvfms
[eric@localhost dsvfms]$ gedit BCNITEMDETAILS_17-03-16_02-00-09.CSV-27.xml
                <SHIPMENT_ORDER_ID>00993536</SHIPMENT_ORDER_ID>
                <ORGANIZATION_ID>DSV-ES-BCN</ORGANIZATION_ID>
               <PRODUCT_ITEMS>
                <PRODUCT_ITEM>
                    <PRODUCT_ITEM_ID>00993536</PRODUCT_ITEM_ID>
                    <DESCRIPTION>R. JOAO RODRIGUES</DESCRIPTION>
                    <PART_NUMBER>0863022560</PART_NUMBER>
                    <QUANTITY>0</QUANTITY>
                    <ITEM_REFERENCE>
                        <VALUE>00615148</VALUE>
                        <QUALIFIER>REFERENCE1</QUALIFIER>
                    </ITEM_REFERENCE>

/s
JmsDsvFmsListener.onMessage(Message) line: 44	
...
/s
/ stack trace,	

Thread [DsvFmsQueueContainer-1] (Suspended (breakpoint at line 77 in DsvFmsShipmentOrderMsgProcessor))	
	DsvFmsShipmentOrderMsgProcessor.processCustomPurposeCode(PurposeCodeVO, ParsedShipmentOrder) line: 77	
		} else if (aPurposeCode.getPurposeCode().equals(DSV_FMS_ITEM)) {
			processDsvItemFile(aShipmentOrder);

	DsvFmsShipmentOrderMsgProcessor(AbstractShipmentOrderMsgProcessor).process(Node) line: 292	
					} else {
						processCustomPurposeCode(myPurposeCode, myShipmentOrder);

	ShipmentOrderMsgConsumer.process(Message) line: 56	
				Node msgNode = XMLUtil.selectSingleNode(((SapXMessage) aIncomingMessage).getDocument(), "SHIPMENT_ORDER_MSG");
[SHIPMENT_ORDER_MSG: null]
				if (msgNode != null) {
					myProcessor.process(((SapXMessage) aIncomingMessage).getBody());

	IncomingMessageDemultiplexer.process(Message) line: 123	
		try {
			myMessageConsumer.process(aIncomingMessage);

	IncomingMessageDemultiplexer(MessageConsumer).handle(Message) line: 108	
			// When message passed all checks it is eligible for processing
			if (theStatus == MC_STATUS_OK) {
				process(incomingMessage);

	MessageSwitch.forwardDataMessage(Message) line: 1198	
		// Let consumer process the message, if sequence numbers were ok.
		if (!retransmissionAfterLostAcknowledgement) {
			if (myRecord.getStatus() == MC_STATUS_OK) {
				LOG.info("Message posted to the consumer");
				theMessageConsumer.handle(aDataMessage);

	MessageSwitch.handleMessage(Message) line: 306	
		} else {
			// No sequence number mismatch, so the data message can be forwarded for further processing
			forwardDataMessage(aMessage);

	IncomingXmlMessageLink(IncomingLink).postMessage(Message) line: 143	
		// post to all subscribers
		for (Iterator it = theSubscribers.iterator(); it.hasNext();) {
			((IncomingMessageSubscriber) it.next()).handleMessage(aMessage);

	IncomingXmlMessageLink.unMarshalFrom(String) line: 158	
		try {
			// When compilation went fine, the document can be embedded in a sap message
			if (getParseOk()) {
->				postMessage(myNewMessage);

	IncomingXmlMessageLink(IncomingLink).handle(String) line: 89	
		} else {
			// The incoming octet sequence has been used for assembly of the incoming protocol data unit
			unMarshalFrom(octets);

	JmsDsvFmsListener.onMessage(Message) line: 64	
			theIncomingLink.handle(myMarshalledMessageText);


/ We sturen msg naar een ander queue WH dan in Jira ticket op acc	. Daarom in een ander listener	, JmsDsvFmsListener ipv ShipmentOrderListener
/ TODO

/ debug	,
/s
DsvFmsShipmentOrderMsgProcessor.processDsvItemFile(ParsedShipmentOrder) line: 475	
		processItemFileAndCreateCustomerOrderLine(aParsedShipmentOrder, true);
/s
DsvFmsShipmentOrderMsgProcessor.processItemFileAndCreateCustomerOrderLine(ParsedShipmentOrder, boolean) line: 590	
			ShipmentOrderVO myNewShipmentOrder = aParsedShipmentOrder.getShipmentOrder();
ShipmentOrder: 00993536(SystemId:0; Org:DSV-ES-BCN)

			// DsvOrderId
			String myCustomerOrderLineId = myNewShipmentOrder.getShipmentOrderId();

			ProductItemVO myNewItem = aParsedShipmentOrder.getProductItemList().iterator().next();

			// Item#
			String myCustomerOrderId = myNewItem.getReference1();
00615148
			CustomerOrder myCustomerOrder = myCustomerOrderDAO.getByCustomerOrderNumber(myCustomerOrderId, myNewShipmentOrder.getOrganizationVO());
null
			CustomerOrderLine myLine = null;
			if (myCustomerOrder != null) {
/ NEE
			/**
			 * Find product items with the same DSV Order ID pi.product_item_id = sho.shipment_order_id (this is changed
			 * later)
			 */
			boolean myOrderExists = myLine != null;
			if (!myOrderExists) {
				// Check if there are other product items for the same item# (customer order id)

				boolean hasCustOrder = myCustomerOrder != null && myCustomerOrder.getCustomerOrderLineSet().size() > 0;
false
				if (hasCustOrder) {
					/**
					 * This is the situation where you have multiple lines of one customer order on one shipment order
					 */
/ NEE
				} else {
					if (aGroupageCheck) {

						boolean myGroupage = false;
						String myPrincipalID = null;

						if (MpoBeanFactory.getBean(PartyService.class).existWithPartyId(myNewShipmentOrder.getPreferedPartyVO().getCode(), myNewShipmentOrder)) {
/s
= thePreferredPartyVO
/=
[SystemId: 1084894; Party: DHLGEN-ES; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@2ced2b6e[PREFERRED_PARTY,Preferred Party]]
/s
PartyVO(AbstractParty).getCode() line: 171	
		return partyId;
DHLGEN-ES
/t
/s
PartyServiceImpl.existWithPartyId(String, PartyLookupContext) line: 112	
		return lookupService.lookupParty(aPartyId, aPartyLookupContext) != null;

aPartyId	"DHLGEN-ES" (id=1195)	
aPartyLookupContext	ShipmentOrderVO  (id=954)	

/ antwoord	
[SystemId: 1084894; Party: DHLGEN-ES; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@2ced2b6e[PREFERRED_PARTY,Preferred Party]]

/t
DsvFmsShipmentOrderMsgProcessor.processItemFileAndCreateCustomerOrderLine(ParsedShipmentOrder, boolean) line: 645	
						if (MpoBeanFactory.getBean(PartyService.class).existWithPartyId(myNewShipmentOrder.getPreferedPartyVO().getCode(), myNewShipmentOrder)) {
/ JA
							Party myPreferredParty = MpoBeanFactory.getBean(PartyService.class).getPartyByPartyId(
									aParsedShipmentOrder.getShipmentOrder().getPreferedPartyVO().getCode(), myNewShipmentOrder);
[SystemId: 1084894; Party: DHLGEN-ES; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@2ced2b6e[PREFERRED_PARTY,Preferred Party]]

							if (StringUtils.equalsIgnoreCase("GRP", myPreferredParty.getReference1())
									|| StringUtils.equalsIgnoreCase("OVO", myPreferredParty.getReference1())) {
/ NEE
INT
						// FIND by cons key
						if (myGroupage && StringUtils.isNotEmpty(myPrincipalID)) {
/ NEE
myGroupage=false
						} else {
							createShipmentOrderAndCustomerOrderLine(aParsedShipmentOrder, myOrderService, myNewShipmentOrder, myNewItem, myCustomerOrder, "NOT GROUPAGE OR NO PRINCIPAL [" + System.nanoTime() + "]");
/s
DsvFmsShipmentOrderMsgProcessor.createShipmentOrderAndCustomerOrderLine(ParsedShipmentOrder, ShipmentOrderService, ShipmentOrderVO, ProductItemVO, CustomerOrder, String) line: 264	

		aNewShipmentOrder.setShipmentOrderId(KeyUtil.getKeyService().getShipmentOrderId());
SH002532701
		addCustomerOrderLine(aCustomerOrder, aNewShipmentOrder, aNewItem);
/s
DsvFmsShipmentOrderMsgProcessor.addCustomerOrderLine(CustomerOrder, ShipmentOrderVO, ProductItemVO) line: 213	
/=
	private void addCustomerOrderLine(CustomerOrder aCustomerOrder, ShipmentOrderVO aShipmentOrder, ProductItemVO aNewItem) {
aCustomerOrder	null	
aNewItem	ProductItemVO  (id=1017)	
aShipmentOrder	ShipmentOrderVO  (id=954)	ShipmentOrder: SH002532699(SystemId:0; Org:DSV-ES-BCN)

/ Wat is	,
ShipmentOrder: 00993536(SystemId:0; Org:DSV-ES-BCN)
/ TODO

ustomerOrderDAO myCustomerOrderDAO = MpoBeanFactory.getBean(CustomerOrderDAO.class);

		// First, create customer order if required
		CustomerOrder myCustomerOrder = aCustomerOrder;
		if (myCustomerOrder == null) {
			myCustomerOrder = new CustomerOrder();
			myCustomerOrder.setCustomerOrderNumber(aNewItem.getReference1()); // Item#
00615148
			myCustomerOrder.setReference1(aNewItem.getDescription()); // Consignee
R. JOAO RODRIGUES
			myCustomerOrder.setOrganization(aShipmentOrder.getOrganizationVO());
SystemId:5610	Id:DSV-ES-BCN	Description:DSV Solutions Barcelona
			myCustomerOrder.setSellerOrderNumber(aShipmentOrder.getReference1()); // Customer Order#
0146807966

		// Add customer line
		CustomerOrderLine myNewCustomerLine = new CustomerOrderLine();
		// Setting details
		myNewCustomerLine.setCustomerOrderLineId(aNewItem.getProductItemId());
00993536
		myNewCustomerLine.setBuyerCustomerOrderLineNumber(aNewItem.getReference2());
0146807966
		myNewCustomerLine.setIncoTerm(aShipmentOrder.getIncoTermVO());
SystemId:1007141	isDeleted:false	Code:CPT	Description:Carriage Paid ToVersion:2000
		myNewCustomerLine.setReference1(aNewItem.getReference3()); // BatchNumber
01232731
		myNewCustomerLine.setReference2(aNewItem.getReference4()); // Voyage
018732
		myNewCustomerLine.setReference3(aNewItem.getReference7()); // IncoTerms2
CPT
		myNewCustomerLine.setReference4(aNewItem.getReference8()); // IncoTerms group
DDU
		if (StringUtils.isNotEmpty(aNewItem.getReference9())) {
			/* Number of items */
			myNewCustomerLine.setRequestedTotalItems(new BigDecimal(aNewItem.getReference9()));
1
		}
		if (StringUtils.isNotEmpty(aNewItem.getReference10())) {
			/* Loading meters */
			myNewCustomerLine.setRequestedTotalLoadingMeters(new BigDecimal(aNewItem.getReference10()));
0
		}
		myNewCustomerLine.setRequestedTotalWeightKg(aNewItem.getWeightKg()); // Weight
43
		myNewCustomerLine.setRequestedTotalVolumeM3(aNewItem.getRequestedTotalVolumeM3()); // Volume
0.384
		myCustomerOrder.addCustomerOrderLine(myNewCustomerLine);
CUSTOMER_ORDER_LINE id:00993536(systemId:0)
		myCustomerOrderDAO.save(myCustomerOrder);
		aNewItem.setCustomerOrderLine(myNewCustomerLine);
/ TODO (Afmaken)


/c

/ CREATE SHIPMENT ORDER FROM XML	,

/ 2de XML

[eric@localhost dsvfms]$ less dsvsol-2869.xml 

                <SHIPMENT_ORDER_ID>09557409</SHIPMENT_ORDER_ID>
                <ORGANIZATION_ID>DSV-NL-MDK</ORGANIZATION_ID>
               <PRODUCT_ITEMS>
                <PRODUCT_ITEM>
                    <PRODUCT_ITEM_ID>09557409</PRODUCT_ITEM_ID>
                    <DESCRIPTION>BabyOne Baby- und Kinderbedarf GmbH</DESCRIPTION>
                    <PART_NUMBER>E8W5324D34S</PART_NUMBER>
                    <QUANTITY>0</QUANTITY>
                    <CUSTOMS_NUMBER></CUSTOMS_NUMBER>
                    <TOTAL_VOLUME_M3>
                        <MEASUREMENT_VALUE>.001</MEASUREMENT_VALUE>
                        <UNIT_OF_MEASUREMENT>CBM</UNIT_OF_MEASUREMENT>
                    </TOTAL_VOLUME_M3>
                    <TOTAL_WEIGHT_KG>
                        <MEASUREMENT_VALUE>9.67</MEASUREMENT_VALUE>
                        <UNIT_OF_MEASUREMENT>KG</UNIT_OF_MEASUREMENT>
                    </TOTAL_WEIGHT_KG>
                    <ITEM_REFERENCE>
                        <VALUE>05826760</VALUE>
                        <QUALIFIER>REFERENCE1</QUALIFIER>
                    </ITEM_REFERENCE>
                    <ITEM_REFERENCE>
                        <VALUE>2341147-001/C1</VALUE>
                        <QUALIFIER>REFERENCE2</QUALIFIER>
...
                   </ITEM_REFERENCE>
                    <ITEM_REFERENCE>
                        <VALUE>08721709</VALUE>
                        <QUALIFIER>REFERENCE3</QUALIFIER>
                    </ITEM_REFERENCE>
                    <ITEM_REFERENCE>
                        <VALUE>608679</VALUE>
                        <QUALIFIER>REFERENCE4</QUALIFIER>
                    </ITEM_REFERENCE>
                    <ITEM_REFERENCE>
                        <VALUE>09557409</VALUE>
                        <QUALIFIER>REFERENCE5</QUALIFIER>
                    </ITEM_REFERENCE>
                    <ITEM_REFERENCE>
                        <VALUE>DDP</VALUE>
                        <QUALIFIER>REFERENCE6</QUALIFIER>
                    </ITEM_REFERENCE>
                    <ITEM_REFERENCE>
                        <VALUE>DDP</VALUE>
                        <QUALIFIER>REFERENCE7</QUALIFIER>
                    </ITEM_REFERENCE>
                    <ITEM_REFERENCE>
                        <VALUE>DDP</VALUE>
                        <QUALIFIER>REFERENCE8</QUALIFIER>
                    </ITEM_REFERENCE>
                    <ITEM_REFERENCE>
                        <VALUE>1</VALUE>
                        <QUALIFIER>REFERENCE9</QUALIFIER>
                    </ITEM_REFERENCE>
                    <ITEM_REFERENCE>
                        <VALUE>0</VALUE>
                        <QUALIFIER>REFERENCE10</QUALIFIER>
                    </ITEM_REFERENCE>
                </PRODUCT_ITEM>
            </PRODUCT_ITEMS>
           <SHIPMENT_ITEMS>
                <SHIPMENT_ITEM>
                    <SHIPMENT_ITEM_ID>1</SHIPMENT_ITEM_ID>
                    <SHIPMENT_ORDER_ID>09557409</SHIPMENT_ORDER_ID>
                    <PACKED_ITEMS/>
                    <PACKAGE_CODE>BOX</PACKAGE_CODE>
                    <DESCRIPTION></DESCRIPTION>
                    <LABEL_NUMBER>3617345778502454</LABEL_NUMBER>
                    <SHIPMENT_ITEMS/>
                    <SHIPMENT_ITEM_REFERENCE>
                        <VALUE>09557409</VALUE>
                        <QUALIFIER>REFERENCE1</QUALIFIER>
                    </SHIPMENT_ITEM_REFERENCE>
                    <SHIPMENT_ITEM_REFERENCE>
                        <VALUE>1</VALUE>
                        <QUALIFIER>REFERENCE3</QUALIFIER>
                    </SHIPMENT_ITEM_REFERENCE>
                </SHIPMENT_ITEM>
            </SHIPMENT_ITEMS>



/s
/ stack trace	,
	DsvFmsShipmentOrderMsgProcessor.processItemFileAndCreateCustomerOrderLine(ParsedShipmentOrder, boolean) line: 583	
	DsvFmsShipmentOrderMsgProcessor.processDsvItemFile(ParsedShipmentOrder) line: 475	
	DsvFmsShipmentOrderMsgProcessor.processCustomPurposeCode(PurposeCodeVO, ParsedShipmentOrder) line: 80	
	DsvFmsShipmentOrderMsgProcessor(AbstractShipmentOrderMsgProcessor).process(Node) line: 292	
	ShipmentOrderMsgConsumer.process(Message) line: 56	
	IncomingMessageDemultiplexer.process(Message) line: 123	
	IncomingMessageDemultiplexer(MessageConsumer).handle(Message) line: 108	
	MessageSwitch.forwardDataMessage(Message) line: 1198	
	MessageSwitch.handleMessage(Message) line: 306	
	IncomingXmlMessageLink(IncomingLink).postMessage(Message) line: 143	
	IncomingXmlMessageLink.unMarshalFrom(String) line: 158	
	IncomingXmlMessageLink(IncomingLink).handle(String) line: 89	
	JmsDsvFmsListener.onMessage(Message) line: 64	

/ debug	,
/s
DsvFmsShipmentOrderMsgProcessor.processItemFileAndCreateCustomerOrderLine(ParsedShipmentOrder, boolean) line: 583	
/=
	private void processItemFileAndCreateCustomerOrderLine(ParsedShipmentOrder aParsedShipmentOrder, boolean aGroupageCheck) throws Exception {

			ShipmentOrderVO myNewShipmentOrder = aParsedShipmentOrder.getShipmentOrder();
ShipmentOrder: 09557409(SystemId:0; Org:DSV-NL-MDK)

			String myCustomerOrderLineId = myNewShipmentOrder.getShipmentOrderId();
09557409

			ProductItemVO myNewItem = aParsedShipmentOrder.getProductItemList().iterator().next();
myNewItem	ProductItemVO  (id=20074)	
	actualAdrCode	null	
	actualAdrCodeSystemId	null	
	actualQuantity	null	
	actualUnNumber	null	
	actualUnNumberSystemId	null	
	approvedBy	null	
	approvedOnDate	null	
	approvePostcalculation	false	
	approvePrecalculation	false	
	calculateVolume	Boolean  (id=18777)	
	calculateWeight	Boolean  (id=18777)	
	children	ArrayList  (id=20099)	
	cost	BigDecimal  (id=19281)	
	costCurrency	null	
	costMethod	null	
	costPartList	HashSet  (id=20103)	
	countryOfOriginSystemid	null	
	countryOfOriginVO	null	
	currencyDAO	null	
	customerOrderLine	null	
	customerOrderLineSystemId	null	
	dao	null	
	emission	null	
	entityDetails	HashMap  (id=20111)	
	fileObjects	ArrayList  (id=20112)	
	flashpoint	null	
	individualItemValue	BigDecimal  (id=19281)	
	isCalculateEnabled	null	
	lockPostcalculation	false	
	lockPrecalculation	false	
	orderProcess	null	
	organization	null	
	packagingGroup	null	
	parent	null	
	parsedShipmentOrderId	null	
	payWeight	null	
	performanceMonitorService	null	
	postCalcApprovedBy	null	
	postCalcApprovedOnDate	null	
	productGroup	null	
	productId	null	
	productOwner	null	
	ratecalcMd5Hash	null	
	reference11	null	
	reference12	null	
	reference13	null	
	reference14	null	
	reference15	null	
	remarks	null	
	requestedAdrCode	null	
	requestedUnNumber	null	
	shipmentOrder	null	
	systemId	0	
	temporary	false	
	theActualTotalColli	null	
	theActualTotalLoadingMeters	null	
	theActualTotalVolumeM3	null	
	theActualTotalWeightKg	null	
	theAdditionalInfoMap	HashMap  (id=20120)	
	theAltValueCurrencySystemId	null	
	theAltValueCurrencyVO	null	
	theCustomsNumber	"" (id=18515)	
	theDateSetVO	DateSetVO  (id=20121)	
	theDescription	"BabyOne Baby- und Kinderbedarf GmbH" (id=20122)	
	theFormattedEntity	null	
	theFormattedEntity	null	
	theFromPartyVO	null	
	theHoldStatus	null	
	theOrderStatusVO	null	
	theOriginalCustomerOrderId	null	
	theOriginalCustomerOrderLineId	null	
	thePackedItemList	ArrayList  (id=20123)	
	thePartNumber	"E8W5324D34S" (id=20124)	
	thePrice	null	
	thePriceCurrencySystemid	null	
	theProduct	null	
	theProductItemId	"09557409" (id=20127)	
	theProductModel	null	
	theProductSeries	null	
	theQuantity	BigDecimal  (id=20128)	
	theRecalculateActualsFlag	false	
	theRecalculateFlag	false	
	theReference1	"05826760" (id=20078)
	theReference10	"0" (id=20131)	
	theReference2	"2341147-001/C1" (id=20132)	
	theReference3	"08721709" (id=20133)	
	theReference4	"608679" (id=20135)	
	theReference5	"09557409" (id=20136)	
	theReference6	"DDP" (id=20137)	
	theReference7	"DDP" (id=20138)	
	theReference8	"DDP" (id=20139)	
	theReference9	"1" (id=20140)	
	theRequestedAltTotalValue	null	
	theRequestedTotalColli	null	
	theRequestedTotalItems	null	
	theRequestedTotalLoadingMeters	null	
	theRequestedTotalValue	null	
	theRequestedTotalVolumeM3	null	
	theRequestedTotalWeightKg	null	
	theToPartyVO	null	
	theTotalVolumeM3	BigDecimal  (id=20141)	
	theValueCurrencyVO	null	
	theWeightKg	BigDecimal  (id=20142)	

			// Item#
			String myCustomerOrderId = myNewItem.getReference1();
05826760
			CustomerOrder myCustomerOrder = myCustomerOrderDAO.getByCustomerOrderNumber(myCustomerOrderId, myNewShipmentOrder.getOrganizationVO());
null
			CustomerOrderLine myLine = null;
			if (myCustomerOrder != null) {
/ NEE
				boolean hasCustOrder = myCustomerOrder != null && myCustomerOrder.getCustomerOrderLineSet().size() > 0;
false
				if (hasCustOrder) {
/ NEE
				if (hasCustOrder) {
/ NEE
				} else {
					if (aGroupageCheck) {
						boolean myGroupage = false;
						String myPrincipalID = null;

						if (MpoBeanFactory.getBean(PartyService.class).existWithPartyId(myNewShipmentOrder.getPreferedPartyVO().getCode(), myNewShipmentOrder)) {
/s
ShipmentOrderVO.getPreferedPartyVO() line: 1258	
		return thePreferedPartyVO;
null

/ Daarom NullPointerException	, want null.getCode() call	,

/ FIX  DSVSOL-2869

/ de XML message dsvsol-2869.xml -> theNewShipmentOrder.thePreferedPartyVO null	, 

/ Einde FIX  DSVSOL-2869


/ Einde DEBUG DSVSOL-2869 

/ DEBUG DSVSOL-2869 

/ 7	. 

BCNITEMDETAILS_17-03-16_02-00-09.CSV-27.xml	: wel aNewShipmentVO.thePreferedPartyVO
dsvsol-2869.xml								: aNewShipmentVO.thePreferedPartyVO=null

/ de XML wordt parsed in 
DsvFmsShipmentOrderMsgProcessor(AbstractShipmentOrderMsgProcessor).process(Node) line: 292	

/ 7	. 

/ we lezen in : BCNITEMDETAILS_17-03-16_02-00-09.CSV-27.xml			
/s
/ stack trace	,
	DsvFmsShipmentOrderMsgProcessor(AbstractShipmentOrderMsgProcessor).process(Node) line: 225	
	ShipmentOrderMsgConsumer.process(Message) line: 56	
	IncomingMessageDemultiplexer.process(Message) line: 123	
	IncomingMessageDemultiplexer(MessageConsumer).handle(Message) line: 108	
	MessageSwitch.forwardDataMessage(Message) line: 1198	
	MessageSwitch.handleMessage(Message) line: 306	
	IncomingXmlMessageLink(IncomingLink).postMessage(Message) line: 143	
	IncomingXmlMessageLink.unMarshalFrom(String) line: 158	
	IncomingXmlMessageLink(IncomingLink).handle(String) line: 89	
	JmsDsvFmsListener.onMessage(Message) line: 64	

/ debug	,
/s
	ShipmentOrderMsgConsumer.process(Message) line: 56	
				Node msgNode = XMLUtil.selectSingleNode(((SapXMessage) aIncomingMessage).getDocument(), "SHIPMENT_ORDER_MSG");
/ Dit is de message in Java obj	,
				if (msgNode != null) {
					myProcessor.process(((SapXMessage) aIncomingMessage).getBody());

/ Intermezzo

<SHIPMENT_ORDER_MSG>
    <header>
        <typ>SHIPMENT_ORDER_MSG</typ>
        <mid>MP Objects DSV FMS POC</mid>
        <ver>1.0</ver>
        <mode>D</mode>
        <ack>NE</ack>
        <cre>Wed Feb 17 01:03:30 CET 2016</cre>
        <sap>sender administration</sap>
        <rap>receiver administration</rap>
    </header>
    <body>
        <SHIPMENT_ORDER>
            <PROCESSING_DETAILS>
                <PURPOSE_CODE>DSV_FMS_ITEM</PURPOSE_CODE>
            </PROCESSING_DETAILS>
            <SHIPMENT_ORDER_BODY>
                <COMMON>
                    <FROM_LOCATION>

msgNode	DeferredElementImpl  (id=20658)	
	firstChild	DeferredTextImpl  (id=20660)	
		nextSibling	DeferredElementImpl  (id=20694)	
			firstChild	DeferredTextImpl  (id=20699)	
				data	"\n        " (id=20726)	
				nextSibling	DeferredElementImpl  (id=20727)	
					firstChild	DeferredTextImpl  (id=20729)	
					name	"typ" (id=20730)	
					nextSibling	DeferredTextImpl  (id=20731)	
			name	"header" (id=20702)	
			nextSibling	DeferredTextImpl  (id=20704)	
				data	"\n    " (id=20717)	
				nextSibling	DeferredElementImpl  (id=20648)	
					firstChild	DeferredTextImpl  (id=20650)	
						data	"\n        " (id=20735)	
						nextSibling	DeferredElementImpl  (id=20736)	
							firstChild	DeferredTextImpl  (id=20738)	
							name	"SHIPMENT_ORDER" (id=20739)	
							nextSibling	DeferredTextImpl  (id=20737)	
					name	"body" (id=20720)	
					nextSibling	DeferredTextImpl  (id=20697)	
	name	"SHIPMENT_ORDER_MSG" (id=20662)	
	nextSibling	null	

/ Einde Intermezzo

/s
DsvFmsShipmentOrderMsgProcessor(AbstractShipmentOrderMsgProcessor).process(Node) line: 225	

		String messageId = org.apache.commons.lang.StringUtils.defaultIfEmpty(findMessageId(node), "?MessageId?");
MP Objects DSV FMS POC
/ want	,
/s
	/**
	 * This will get the message id from the header element (/?/mtccore:header/mtccore:mid)
	 * 
	 * @return the message id, or null if no value is found. Can return an empty string if the message id was not set
	 */
	public String findMessageId(Node aNode) {
		return selectText(doc.getDocumentElement(), "header", "mid");
    <header>
        <mid>MP Objects DSV FMS POC</mid>
/t
		String messageId = org.apache.commons.lang.StringUtils.defaultIfEmpty(findMessageId(node), "?MessageId?");
/d
			for (Node myNode : selectNodeIterable(aNode, "SHIPMENT_ORDER")) {
myNode	DeferredElementImpl  (id=20736)	
	name	"SHIPMENT_ORDER" (id=20739)	
	nextSibling	DeferredTextImpl  (id=20737)	

				monitorMeta[0] = messageId;
MP Objects DSV FMS POC
				monitorMeta[1] = selectText(myNode, PROCESSING_DETAILS_TAG, PurposeCodeProcessor.PURPOSE_CODE_TAG);
SV_FMS_ITEM
				monitorMeta[2] = selectText(myNode, ShipmentOrderProcessor.SHIPMENT_ORDER_BODY_TAG, ShipmentOrderBodyProcessor.SHIPMENT_ORDER_ID_TAG);
09557409
				monitorMeta[3] = selectText(myNode, ShipmentOrderProcessor.SHIPMENT_ORDER_BODY_TAG, ShipmentOrderBodyProcessor.ORGANIZATION_ID_TAG);
DSV-NL-MDK
				monitorMeta[4] = Boolean.FALSE.toString();
false
					PurposeCodeVO myPurposeCode = new PurposeCodeProcessor(this).process(selectSingleNode(myNode, PROCESSING_DETAILS_TAG));
DSV_FMS_ITEM

/ Intermezzo

   <body>
        <SHIPMENT_ORDER>
            <PROCESSING_DETAILS>
                <PURPOSE_CODE>DSV_FMS_ITEM</PURPOSE_CODE>
            </PROCESSING_DETAILS>

/ Einde Intermezzo

					if (myPurposeCode.isPartialUpdate()) {
/s
						="04"
/ NEE
					ShipmentOrderProcessor myProcessor = new ShipmentOrderProcessor();
					myProcessor.setProcessingContext(getProcessingContext());
					myShipmentOrder = myProcessor.process(myNode);
/s
ShipmentOrderProcessor.process(Node) line: 199	
		ShipmentOrderBodyProcessor myProcessor = Factory.getFactory().getInstance(ShipmentOrderBodyProcessor.class);
		try {
			myProcessor.setProcessingContext(getProcessingContext());
			myProcessor.setParent(this);
			myShipmentOrderVO = myProcessor.process(selectSingleNode(aNode, SHIPMENT_ORDER_BODY_TAG));
/s
ShipmentOrderBodyProcessor.process(Node) line: 455	
			ShipmentOrderVO myShipmentOrderVO = ShipmentOrderVOFactory.getShipmentOrderVO();
/ alles null	, 
			MpoBeanFactory.getBean(EntityDetailService.class).initialize(myShipmentOrderVO);
/s
EntityDetailServiceImpl.initialize(EntityDetailSupport) line: 131	
/=
	public void initialize(EntityDetailSupport anEntityDetailSupport) {
anEntityDetailSupport=sho met alles null	,

		List<EntityDetailType> myList = getDAO().getByEntity(anEntityDetailSupport.getEntity());
anEntityDetailSupport.getEntity()="SHIPMENT_ORDER"	, method call ShipmentOrderVO.getEntity()
getDADO()=com.mpobjects.oms.dao.entitydetailtype.EntityDetailTypeDAOImpl@375f1083
myList=[
SystemId:12218712	IsDeleted:false	Detail Type:RateCalcStatus	ValueType:DISPLAY	,
 SystemId:9757376	IsDeleted:false	Detail Type:RateAgreement	ValueType:DISPLAY	,
 SystemId:31613204	IsDeleted:false	Detail Type:ToCountry	ValueType:HIDDEN	,
 SystemId:31613205	IsDeleted:false	Detail Type:Zone	ValueType:HIDDEN	,
 SystemId:123340712	IsDeleted:false	Detail Type:Limited Quantity	ValueType:STRING	,
 SystemId:123342652	IsDeleted:false	Detail Type:Carrier Type	ValueType:STRING	,
 SystemId:123343691	IsDeleted:false	Detail Type:Remarks2	ValueType:REMARKS	]

		if (anEntityDetailSupport.getEntityDetails() != null) {
{}
			myList.removeAll(anEntityDetailSupport.getEntityDetails().keySet());
/ TODO (de test is niet OK: moet zijn : != null &&  !lege lijst)

		for (EntityDetailType myEntityDetailType : myList) {
			anEntityDetailSupport.setEntityDetail(myEntityDetailType, spaceAsInitialValue ? " " : "");
spaceAsInitialValue=false

anEntityDetailSupport	ShipmentOrderVO  (id=21238)	
	entityDetails	HashMap  (id=21239)	
{SystemId:123342652	IsDeleted:false	Detail Type:Carrier Type	ValueType:STRING	=,
 SystemId:123340712	IsDeleted:false	Detail Type:Limited Quantity	ValueType:STRING	=,
 SystemId:31613204	IsDeleted:false	Detail Type:ToCountry	ValueType:HIDDEN	=,
 SystemId:9757376	IsDeleted:false	Detail Type:RateAgreement	ValueType:DISPLAY	=,
 SystemId:12218712	IsDeleted:false	Detail Type:RateCalcStatus	ValueType:DISPLAY	=,
 SystemId:123343691	IsDeleted:false	Detail Type:Remarks2	ValueType:REMARKS	=,
 SystemId:31613205	IsDeleted:false	Detail Type:Zone	ValueType:HIDDEN	=}

/t
ShipmentOrderBodyProcessor.process(Node) line: 459	
			MpoBeanFactory.getBean(EntityDetailService.class).initialize(myShipmentOrderVO);
/d
			myShipmentOrderVO.setSyncToFlag(getSyncFlag("to"));
/s
ShipmentOrderBodyProcessor.getSyncFlag(String) line: 190	
		String myKey = "interface.shipmentorder.sync." + aType + ".flag".toLowerCase();
interface.shipmentorder.sync.to.flag
		return ApplicationPropertyManager.getInstance().getModuleProperty("oms", myKey, PartySyncFlag.DISABLED_CODE);
"D"
/ de property is er niet	,
/t
			myShipmentOrderVO.setSyncFromFlag(getSyncFlag("from"));
			myShipmentOrderVO.setSyncBillToFlag(getSyncFlag("billto"));
			myShipmentOrderVO.setSyncEmployeeResponsibleFlag(getSyncFlag("employeeresponsible"));

myShipmentOrderVO	ShipmentOrderVO  (id=21238)	
	theSyncBillToFlag	"P" (id=21375)	
	theSyncEmployeeResponsibleFlag	"D" (id=21347)	
	theSyncFromFlag	"D" (id=21347)	
	theSyncToFlag	"D" (id=21347)	

			// Defaults for the object, must be set before node processing
			myShipmentOrderVO.setShipmentOrderProcess(OrderProcess.OUTBOUND);

			Node myNode = selectSingleNode(aNode, ORGANIZATION_ID_TAG);
                <ORGANIZATION_ID>DSV-NL-MDK</ORGANIZATION_ID>

			if (myNode != null) {
				Organization myOrganizationVO = OrganizationUtil.getOrganizationFacadeLocal().getOrganization(myNode.getTextContent());
				if (myOrganizationVO != null) {
/ JA
					myShipmentOrderVO.setOrganizationVO(myOrganizationVO);


/ Intermezzo

/ deze is er inderdaad	,

SQL> select*from organization  where organization_id='DSV-NL-MDK';

   SYSTEM_ID ORGANIZATION_ID      DESCRIPTION                                                                                          AUTOM_RATE_CALC IS_DELETED ORGANIZATION_GROUP     SEQUENCE EDI_IDENTIFIER                                                                                                                                                                                                                                                  
============ ==================== =============================================================================== =============== ========== ================== ============ =============================================================================== 
        3190 DSV-NL-MDK           DSV Solutions Moerdijk                                                                                             0          0             <null>            0 <null>       

/ Einde Intermezzo

			Node childNode = aNode.getFirstChild();
aNode=SHIPMENT_ORDER_BODY
[#text: 
                ]
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
/ NEE
				childNode = childNode.getNextSibling();
/ volgende	,
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String myTag = getElementName(childNode);
COMMON
					} else if (COMMON_TAG.equals(myTag)) {
						new LogisticsOrderBodyProcessor(this).process(childNode, myShipmentOrderVO);

/ Intermezzo

                <COMMON>
                    <FROM_LOCATION>
                        <LOCATION_ID>W01</LOCATION_ID>
                        <LOCATION_TYPE>WAREHOUSE</LOCATION_TYPE>
                        <NAME>DSV SOLUTIONS</NAME>
                        <NAME2></NAME2>
                        <ADDRESS>TRADE BOULEVARD 4 haven nr 528</ADDRESS>
                        <CITY>Moerdijk</CITY>
                        <POSTAL_CODE>4761 RL</POSTAL_CODE>
                        <COUNTRY>
                            <COUNTRY_CODE>NL</COUNTRY_CODE>
                        </COUNTRY>
                    </FROM_LOCATION>
                    <TO_LOCATION>
                        <LOCATION_ID>C01</LOCATION_ID>
                        <LOCATION_TYPE>CUSTOMER</LOCATION_TYPE>
                        <NAME>BabyOne Baby- und Kinderbedarf GmbH</NAME>
                                                <NAME2/>
                        <ADDRESS>Zwerchäckerweg 4-30</ADDRESS>
                                                <ADDRESS2/>
                        <CITY>WIEN</CITY>
                        <POSTAL_CODE>1220</POSTAL_CODE>
                        <COUNTRY>
                            <COUNTRY_CODE>AT</COUNTRY_CODE>
                        </COUNTRY>
                    </TO_LOCATION>
                    <DATE_SET>
                        <REQUESTED_START_AFTER>2016-02-16T00:00:00</REQUESTED_START_AFTER>
                        <REQUESTED_START_BEFORE>2016-02-12T00:00:00</REQUESTED_START_BEFORE>
                        <REQUESTED_END_BEFORE>2016-03-16T00:00:00</REQUESTED_END_BEFORE>
                        <REQUESTED_END_AFTER>2016-03-16T00:00:00</REQUESTED_END_AFTER>
                    </DATE_SET>
                    <TOTAL_WEIGHT>
                        <MEASUREMENT_VALUE>9.67</MEASUREMENT_VALUE>
                        <UNIT_OF_MEASUREMENT>KG</UNIT_OF_MEASUREMENT>
                    </TOTAL_WEIGHT>
                    <TOTAL_VOLUME>
                        <MEASUREMENT_VALUE>.001</MEASUREMENT_VALUE>
                        <UNIT_OF_MEASUREMENT>CBM</UNIT_OF_MEASUREMENT>
                    </TOTAL_VOLUME>
                    <TOTAL_LDM>
                        <MEASUREMENT_VALUE>0</MEASUREMENT_VALUE>
                        <UNIT_OF_MEASUREMENT>m2</UNIT_OF_MEASUREMENT>
                    </TOTAL_LDM>
                </COMMON>

/ Einde Intermezzo

/s
LogisticsOrderBodyProcessor.process(Node, LogisticsOrderVO) line: 187	
			// first process the date set, it's needed for party resolving
			Node myNode = selectSingleNode(aNode, DATE_SET_TAG);
			if (myNode != null) {
/ JA
				DateSetVO myDateSet = new DateSetProcessor(this).process(myNode);
RSAFTER: Tue Feb 16 00:00:00 CET 2016,
 RSBEFORE: Fri Feb 12 00:00:00 CET 2016,
 REAFTER: Wed Mar 16 00:00:00 CET 2016,
 REBEFORE: Wed Mar 16 00:00:00 CET 2016,
 PSAFTER: null,
 PSBEFORE: null,
 PEAFTER: null,
 PEBEFORE: null,
 AS: null,
 AE: null,
 RELEASE:null,
 PRELEASE:null,
 CLOSE:null

				aLogisticsOrderVO.setDateSetVO(myDateSet);

			// process the rest
			myNode = aNode.getFirstChild();
			while (myNode != null) {
[FROM_LOCATION: null]
				if (myNode.getNodeType() == Node.ELEMENT_NODE) {
					String myElementName = getElementName(myNode);
FROM_LOCATION
					if (myElementName.equals(FROM_LOCATION_TAG)) {
						Party myLocation = new LocationProcessor(this).process(myNode);
/s
LocationProcessor.process(Node) line: 117	
			Party myPartyVO = new PartyProcessor(this).process(aNode);
/s
PartyProcessor.process(Node) line: 436	
aNode=FROM_LOCATTION
			Party myVO = new VirtualParty();

			Node childNode = aNode.getFirstChild();
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
LOCATION_ID
/ NIET processed hier	,
/ volgende,	
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
LOCATION_TYPE
/ NIET processed hier	,
/ volgende,	
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
NAME
					} else if (NAME_TAG.equals(tag)) {
						myVO.setName(childNode.getTextContent());
VirtualParty  (id=17360)	
	name	"DSV Rubi" (id=17428)	

/ volgende,	
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
NAME2
					} else if (NAME2_TAG.equals(tag)) {
						myVO.setName2(childNode.getTextContent());
""
/ volgende,	
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
ADDRESS
					} else if (ADDRESS_TAG.equals(tag)) {
						myVO.setAddress(childNode.getTextContent());
/ volgende,	
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
CITY
					} else if (CITY_TAG.equals(tag)) {
						myVO.setCity(childNode.getTextContent());
/ volgende,	
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
POSTAL_CODE
					} else if (POSTAL_CODE_TAG.equals(tag)) {
						myVO.setPostalCode(childNode.getTextContent());
/ volgende,	
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
COUNTRY
					} else if (COUNTRY_TAG.equals(tag)) {
						myVO.setCountryVO(new CountryProcessor(this).process(childNode));
/t
LocationProcessor.process(Node) line: 118	
			Party myPartyVO = new PartyProcessor(this).process(aNode);
/d
myPartyVO	VirtualParty  (id=17258)	

			Party myLocationVO = new PartyVO(myPartyVO);

			// Pick up the identification of the location
			String value = getTextNode(aNode, LOCATION_ID_TAG);
			if (value != null) {
W01
				myLocationVO.setCode(value);
			}

			// Pick up the organisation identification from the document and initialise the location VO with it
			value = getTextNode(aNode, ORGANIZATION_ID_TAG);
""
			if (StringUtils.isNotBlank(value)) {
/ NEE

			value = getTextNode(aNode, LOCATION_TYPE_TAG);
WAREHOUSE
			if (value != null) {
				if (!value.equals(PartyProcessor.UNSPECIFIED_PARTY_TYPE)) {
					PartyType myPartyType = new BeanWrapper<PartyTypeDAO>(PartyTypeDAO.class).getBean().getByCode(value);

myPartyType	PartyType  (id=17585)	
	code	"WAREHOUSE" (id=17587)	
	deleted	false	
	description	"Warehouse" (id=17588)	
	partyTypeGroupList	PersistentSet  (id=17589)	[theSystemId: 2PartyTypeGroup :DELIVERY, theSystemId: 1PartyTypeGroup :COLLECTION]
	performanceMonitorService	null	
	systemId	3008	

/ INTERMEZZO

$ vi PartyType.standard.hbm.xml

<hibernate-mapping>
	<class name="com.mpobjects.oms.model.entity.partytype.PartyType" table="PARTY_TYPE">
		<set name="partyTypeGroupList" table="PARTY_TYPE_IN_GROUP" >
			<cache usage="read-write"/>
			<key column="PARTY_TYPE_SYSTEMID" />
			<many-to-many column="PARTY_TYPE_GROUP_SYSTEMID" class="com.mpobjects.oms.model.partytypegroup.vo.PartyTypeGroupVO" />
		</set>

SQL> select ptg.*from party_type pt join party_type_in_group ptig on pt.system_id=ptig.party_type_systemid join party_type_group ptg on ptig.party_type_group_systemid=ptg.system_id where party_type='WAREHOUSE';

   SYSTEM_ID PARTY_TYPE_GROUP     DESCRIPTION                                                                                          IS_DELETED SHOW_ON_SHO SHOW_ON_SO IS_SYSTEM SHOW_ON_CO SHOW_ON_COL 
============ ==================== =============================================================================== ========== =========== ========== ========= ========== =========== 
           1 COLLECTION           <null>                                                                                                        0           1          1         1          0           0 
           2 DELIVERY             <null>                                                                                                        0           1          1         1          0           0 

/ Klopt	,

/ Einde INTERMEZZO

					myLocationVO.setPartyType(myPartyType);
			return myLocationVO;
/t
LogisticsOrderBodyProcessor.process(Node, LogisticsOrderVO) line: 203	
			// process the rest
			myNode = aNode.getFirstChild();
			while (myNode != null) {
				if (myNode.getNodeType() == Node.ELEMENT_NODE) {
					String myElementName = getElementName(myNode);
					if (myElementName.equals(FROM_LOCATION_TAG)) {
						Party myLocation = new LocationProcessor(this).process(myNode);
/d
						Party myParty = PartyProcessor.storeParty(aLogisticsOrderVO, PartyProcessor.FROM_PARTY_QUALIFIER, myLocation);
/s
PartyProcessor.storeParty(PartyLookupContext, String, Party) line: 223	
		return storeParty(aVO, aPartyQualifier, aPartyVO, PartyInterfaceMode.CREATE_UPDATE);
/s
PartyProcessor.storeParty(PartyLookupContext, String, Party, PartyInterfaceMode) line: 244	
/=
	public static Party storeParty(PartyLookupContext aVO, String aPartyQualifier, Party aPartyVO, PartyInterfaceMode aDefaultMode) throws PartyException {

aVO	ShipmentOrderVO  (id=17233)	
/ the new sho	, full with nulls	,
aPartyQualifier	"from" (id=18460)	
aPartyVO	PartyVO  (id=17532)	
aDefaultMode	PartyInterfaceMode  (id=18474)	
CREATE_UPDATE
/ Maar het wordt OPTIONAL_LOOKUP	, via een property	,

		PartyInterfaceMode myPartyMode = getPartyMode(aVO, aPartyQualifier, aDefaultMode);
/s
PartyProcessor.getPartyMode(PartyLookupContext, String, PartyInterfaceMode) line: 215	
		String myEntityName = getEntityName(aVO);
"shipmentorder"
		String myPropertyName = "module.oms.interface." + myEntityName + ".party." + aPartyQualifier + ".mode";
module.oms.interface.shipmentorder.party.from.mode
		String myValue = ApplicationPropertyManager.getInstance().getOrganizationProperty(aVO.getOrganizationVO(), myPropertyName, aDefaultMode.name());
optional_lookup
		return PartyInterfaceMode.valueOf(myValue.toUpperCase().trim());
/t
PartyProcessor.storeParty(PartyLookupContext, String, Party, PartyInterfaceMode) line: 245	
		PartyInterfaceMode myPartyMode = getPartyMode(aVO, aPartyQualifier, aDefaultMode);
/d
OPTIONAL_LOOKUP
		switch (myPartyMode) {
			case OPTIONAL_LOOKUP:
				myMasterDataPartyVO = findParty(aVO, aPartyVO);
/s
PartyProcessor.findParty(PartyLookupContext, Party) line: 358	
		PartyService myService = MpoBeanFactory.getBean(PartyService.class);
		if (StringUtils.isNotBlank(aParty.getPartyId())) {
aParty.getPartyId()="W01"	, een warehouse	,

			Party myParty = myService.getPartyByPartyId(aParty.getPartyId(), aContext);

/ ze geven de aContext=de sho mee	, want daar zit de organization in	, en daar wordt op gezocht,	 of op organization group	, of uiteindelijk alleen op party id (TODO)	,

/s
DefaultPartyLookupService.lookupParty(String, PartyLookupContext) line: 160	
		if (aContext != null) {
			org = aContext.getOrganizationVO();
SystemId:5610	Id:DSV-ES-BCN	Description:DSV Solutions Barcelona

f (org != null) {
			// getByCode requires a non-null organization
			result = partyDAO.getByCode(aPartyId, org);
null
/want	,
/s
public class PartyDAOImpl extends GenericHibernateDAO<PartyVO> implements PartyDAO {
	@Override
	public PartyVO getByCode(String aPartyId, Organization aOrganization) {
		DetachedCriteria crit = DetachedCriteria.forClass(PartyVO.class);
		crit.add(Property.forName("partyId").eq(aPartyId));
		crit.add(Property.forName("organizationVO").eq(aOrganization));
		crit.add(Property.forName("deleted").eq(Boolean.FALSE));
		return getByCriteria(crit);
	}

		if (respectOrganizationGroup && result == null) {
			result = lookupOrgHierarchy(aPartyId, org);
null
/ want	,
/s
DefaultPartyLookupService.lookupOrgHierarchy(String, Organization) line: 309	
		while (result == null && aOrganziation != null) {
			final Organization orgGroup = aOrganziation.getOrganizationGroup();
null
			if (orgGroup == null || orgGroup.equals(aOrganziation)) {
				// stop when parent is null, or this==parent (which is an incorrect config)
				break;
/t
DefaultPartyLookupService.lookupParty(String, PartyLookupContext) line: 187	

		if (organizationLessLookup && result == null && org != null) {
/ JA
			// only perform lookup if organization was not null to begin with
			result = lookupOrgLess(aPartyId);
/s
DefaultPartyLookupService.lookupOrgLess(String) line: 329	
		List<PartyVO> parties = partyDAO.findByCode(aPartyId);
[]
		return null;
/t
DefaultPartyLookupService.lookupParty(String, PartyLookupContext) line: 187	
		return result;
null
/t
PartyProcessor.findParty(PartyLookupContext, Party) line: 361	
			Party myParty = myService.getPartyByPartyId(aParty.getPartyId(), aContext);
null
			if (myParty != null) {
/ NEE
				return myParty;
/ NIET
		String myReference = ApplicationPropertyManager.getInstance().getProperty("module.oms.interface.shipmentorder.party.findby.reference", "");
""
		if (StringUtils.isNotBlank(myReference)) {
/ NEE
		return null;
/t
PartyProcessor.storeParty(PartyLookupContext, String, Party, PartyInterfaceMode) line: 339	
			case OPTIONAL_LOOKUP:
				myMasterDataPartyVO = findParty(aVO, aPartyVO);
/ d
null
/ Heeft gezocht naar party in db	, want deze is geconfigureerd	, vollediger dan in XML	,
/ Maar hij is er niet	,
/ masterdata is wat wordt used in configuratie 	, TODO
				if (myMasterDataPartyVO != null) {
/ NEE
					return myMasterDataPartyVO;
/ NIET
				return aPartyVO;
[SystemId: 0; Party: W01; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@9dc5b7e[WAREHOUSE,Warehouse]]
/ Is niet in de db	,
/t
LogisticsOrderBodyProcessor.process(Node, LogisticsOrderVO) line: 204	
						Party myParty = PartyProcessor.storeParty(aLogisticsOrderVO, PartyProcessor.FROM_PARTY_QUALIFIER, myLocation);
/d
[SystemId: 0; Party: W01; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@9dc5b7e[WAREHOUSE,Warehouse]]

/ bij OPTIONAL_LOOKUP wordt de party niet saved in db, 
/ TODO
						if (myParty != null) {
							aLogisticsOrderVO.setFromPartyVO(new VirtualParty(myParty));
/ volgende,	
			while (myNode != null) {
				if (myNode.getNodeType() == Node.ELEMENT_NODE) {
					String myElementName = getElementName(myNode);

					} else if (myElementName.equals(TO_LOCATION_TAG)) {

						Party myLocation = new LocationProcessor(this).process(myNode);
						Party myParty = PartyProcessor.storeParty(aLogisticsOrderVO, PartyProcessor.TO_PARTY_QUALIFIER, myLocation);
						if (myParty != null) {
							aLogisticsOrderVO.setToPartyVO(new VirtualParty(myParty));
/ "C01" ipv "W01"	, precies hetzelfde verder	,

/ volgende	,
			while (myNode != null) {
				if (myNode.getNodeType() == Node.ELEMENT_NODE) {
					String myElementName = getElementName(myNode);
DATE_SET
					} else if (myElementName.equals(DATE_SET_TAG)) {
						// already processed above
/ volgende	,
			while (myNode != null) {
				if (myNode.getNodeType() == Node.ELEMENT_NODE) {
					String myElementName = getElementName(myNode);
TOTAL_WEIGHT
					} else if (myElementName.equals(TOTAL_WEIGHT_TAG)) {
						MeasurementVO myMeasurement = new MeasurementProcessor(this).process(myNode);
                   <TOTAL_WEIGHT>
                        <MEASUREMENT_VALUE>43.</MEASUREMENT_VALUE>
                        <UNIT_OF_MEASUREMENT>KG</UNIT_OF_MEASUREMENT>
                    </TOTAL_WEIGHT>
/ sets in nyNode	, geen DB lookups	,
						aLogisticsOrderVO.setRequestedTotalWeightKg(myMeasurement.getValue());
43
/ volgende,	
			while (myNode != null) {
				if (myNode.getNodeType() == Node.ELEMENT_NODE) {
					String myElementName = getElementName(myNode);
TOTAL_VOLUME
                   <TOTAL_VOLUME>
                        <MEASUREMENT_VALUE>.384</MEASUREMENT_VALUE>
                        <UNIT_OF_MEASUREMENT>CBM</UNIT_OF_MEASUREMENT>
		    		</TOTAL_VOLUME>
					} else if (myElementName.equals(TOTAL_VOLUME_TAG)) {
						MeasurementVO myMeasurement = new MeasurementProcessor(this).process(myNode);
						aLogisticsOrderVO.setRequestedTotalVolumeM3(myMeasurement.getValue());
/ volgende,	
			while (myNode != null) {
				if (myNode.getNodeType() == Node.ELEMENT_NODE) {
					String myElementName = getElementName(myNode);
TOTAL_LDM
					} else if (myElementName.equals(TOTAL_LDM_TAG)) {
						MeasurementVO myMeasurement = new MeasurementProcessor(this).process(myNode);
						aLogisticsOrderVO.setRequestedTotalLoadingMeters(myMeasurement.getValue());
/t
ShipmentOrderBodyProcessor.process(Node) line: 504	
					} else if (COMMON_TAG.equals(myTag)) {
						new LogisticsOrderBodyProcessor(this).process(childNode, myShipmentOrderVO);
/d
/ volgende	,
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String myTag = getElementName(childNode);
SHIPMENT_ORDER_ID

                <SHIPMENT_ORDER_ID>00993536</SHIPMENT_ORDER_ID>

					} else if (SHIPMENT_ORDER_ID_TAG.equals(myTag)) {
						String nodeText = childNode.getTextContent();
00993536
						myShipmentOrderVO.setShipmentOrderId(nodeText);
						if (getProcessingContext() != null) {
/ JA
							getProcessingContext().addToProcessingContext(SHIPMENT_ORDER_ID_TAG, nodeText);
ProcessingContext: SHIPMENT_ORDER_ID[00993536]

/ volgende	,
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String myTag = getElementName(childNode);
ORGANIZATION_ID
/ is al handled	,

/ volgende	,
            while (childNode != null) {
                if (childNode.getNodeType() == Node.ELEMENT_NODE) {
                    String myTag = getElementName(childNode);
SHIPMENT_TYPE

                <SHIPMENT_TYPE>NORMAL</SHIPMENT_TYPE>

					} else if (SHIPMENT_TYPE_TAG.equals(myTag)) {
						String myType = childNode.getTextContent();
NORMAL
						ShipmentType myShipmentType = new BeanWrapper<ShipmentTypeDAO>(ShipmentTypeDAO.class).getBean().getByCode(myType);
myShipmentType	ShipmentType  (id=19423)	
	code	"NORMAL" (id=19426)	
	deleted	false	
	description	"Normal" (id=19428)	
	organization	Organization  (id=19430)	SystemId:3200	Id:DSV-NL-AMS	Description:DSV Solutions Amsterdam
	performanceMonitorService	null	
	systemId	119795906	

/ Deze is inderdaad in de db	,
SQL> select*from shipment_order_type;
   SYSTEM_ID IS_DELETED ORGANIZATION_ID SHIPMENT_ORDER_TYPE            DESCRIPTION
...
   119795906          0            3200 NORMAL                         Normal                     

						myShipmentOrderVO.setShipmentType(myShipmentType);

/ volgende	,
            while (childNode != null) {
                if (childNode.getNodeType() == Node.ELEMENT_NODE) {
                    String myTag = getElementName(childNode);
SHIPMENT_ORDER_PROCESS

                <SHIPMENT_ORDER_PROCESS>OUTBOUND</SHIPMENT_ORDER_PROCESS>

					} else if (SHIPMENT_ORDER_PROCESS_TAG.equals(myTag)) {
						myShipmentOrderVO.setShipmentOrderProcess(childNode.getTextContent());

/ volgende	,
            while (childNode != null) {
                if (childNode.getNodeType() == Node.ELEMENT_NODE) {
                    String myTag = getElementName(childNode);
SHIPMENT_SERVICE_LEVEL

                <SHIPMENT_SERVICE_LEVEL>DES</SHIPMENT_SERVICE_LEVEL>

					} else if (SHIPMENT_SERVICE_LEVEL_TAG.equals(myTag)) {
						ShipmentServiceLevelVO myServiceLevelVO = checkServiceLevel(childNode.getTextContent());
/s
ShipmentOrderBodyProcessor.checkServiceLevel(String) line: 829	
				myServiceLevelVO = MpoBeanFactory.getBean(ShipmentServiceLevelDAO.class).getByCode(aCode);
				return myServiceLevelVO;

SQL> select*from shipment_service_level where service_level='DES';

   SYSTEM_ID IS_DELETED SERVICE_LEVEL        DESCRIPTION                                        HIERARCHY_LEVEL SCHEDULE_SYSTEMID 
============ ========== ==================== ================================================== =============== ================= 
    53493331          0 DES                  DES Spannish Service level                                       0          51243500 

/t
						ShipmentServiceLevelVO myServiceLevelVO = checkServiceLevel(childNode.getTextContent());
/d
						// TODO: clean up if all interface mappings have been changed.
						myShipmentOrderVO.setRequestedServiceLevelVO(myServiceLevelVO);
						myShipmentOrderVO.setActualServiceLevelVO(myServiceLevelVO);

/ volgende	,
            while (childNode != null) {
                if (childNode.getNodeType() == Node.ELEMENT_NODE) {
                    String myTag = getElementName(childNode);
REASON_CODE
                <REASON_CODE>NA</REASON_CODE>

					} else if (REASON_CODE_TAG.equals(myTag)) {
						String myCode = childNode.getTextContent();
NA
						ReasonCode myReasonCode = null;
						if (StringUtils.isNotEmpty(myCode.trim())) {
							try {
								myReasonCode = new BeanWrapper<ReasonCodeDAO>(ReasonCodeDAO.class).getBean().getByCode(myCode);

SQL> select*from reason_code where reason_code='NA';

   SYSTEM_ID IS_DELETED REASON_CODE          DESCRIPTION                                        
============ ========== ==================== ================================================== 
           1          0 NA                   NOT APPLICABLE             

						myShipmentOrderVO.setReasonCode(myReasonCode);

/ volgende	,
            while (childNode != null) {
                if (childNode.getNodeType() == Node.ELEMENT_NODE) {
                    String myTag = getElementName(childNode);
INCO_TERM
                <INCO_TERM>CPT</INCO_TERM>

					} else if (INCO_TERM_TAG.equals(myTag)) {
						incoTermCode = childNode.getTextContent();
CPT

/ volgende	,
            while (childNode != null) {
                if (childNode.getNodeType() == Node.ELEMENT_NODE) {
                    String myTag = getElementName(childNode);
INCO_TERM_REFERENCE

                <INCO_TERM_REFERENCE>00993536</INCO_TERM_REFERENCE>

					} else if (INCO_TERM_REFERENCE_TAG.equals(myTag)) {
						myShipmentOrderVO.setIncotermsReference(childNode.getTextContent());
/ Geen DB calls	, just set 	,

/ volgende	,
            while (childNode != null) {
                if (childNode.getNodeType() == Node.ELEMENT_NODE) {
                    String myTag = getElementName(childNode);
DANGEROUS_GOODS_YN

                <DANGEROUS_GOODS_YN>N</DANGEROUS_GOODS_YN>

					} else if (DANGEROUS_GOODS_TAG.equals(myTag)) {
						myShipmentOrderVO.setDangerousGoodsYn(childNode.getTextContent().trim().equalsIgnoreCase("Y"));

/ volgende	,
            while (childNode != null) {
                if (childNode.getNodeType() == Node.ELEMENT_NODE) {
                    String myTag = getElementName(childNode);
CASH_ON_DELIVERY

                <CASH_ON_DELIVERY>
                    <AMOUNT>0</AMOUNT>
                    <CURRENCY_CODE>EUR</CURRENCY_CODE>
                </CASH_ON_DELIVERY>

					} else if (CASH_ON_DELIVERY_TAG.equals(myTag)) {
						AmountVO myAmount = new AmountProcessor(this).process(childNode);
0 EUR
						if (myAmount != null) {
							myShipmentOrderVO.setCashOnDelivery(myAmount.getAmount());
							myShipmentOrderVO.setCashOnDeliveryCurrencyVO(myAmount.getCurrencyVO());
						}
/ volgende	,
            while (childNode != null) {
                if (childNode.getNodeType() == Node.ELEMENT_NODE) {
                    String myTag = getElementName(childNode);
REMARKS
					} else if (REMARKS_TAG.equals(myTag)) {
						myShipmentOrderVO.setRemarks(childNode.getTextContent());

/ volgende	,
            while (childNode != null) {
                if (childNode.getNodeType() == Node.ELEMENT_NODE) {
                    String myTag = getElementName(childNode);
SHIPMENT_ORDER_REFERENCE

               <SHIPMENT_ORDER_REFERENCE>
                    <VALUE>0863022560</VALUE>
                    <QUALIFIER>REFERENCE2</QUALIFIER>
                </SHIPMENT_ORDER_REFERENCE>

					if (SHIPMENT_ORDER_REFERENCE_TAG.equals(myTag)) {
						processShipmentOrderReference(myShipmentOrderVO, childNode);
/s
ShipmentOrderBodyProcessor.processShipmentOrderReference(ShipmentOrderVO, Node) line: 762	

		ReferenceVO myReference = new ReferenceProcessor(this).process(aNode);
Reference(qualifier:REFERENCE2, value:0863022560)

		String myQualifier = myReference.getQualifier();
REFERENCE2
			} else if (myQualifier.equals(REFERENCE2_QUALIFIER)) {
				aShipmentOrderVO.setReference2(myReference.getValue());
/t
ShipmentOrderBodyProcessor.process(Node) line: 492	
/ volgende	,
            while (childNode != null) {
                if (childNode.getNodeType() == Node.ELEMENT_NODE) {
                    String myTag = getElementName(childNode);
SHIPMENT_ORDER_REFERENCE
/ Zo gaan ze allemaal	,

/ volgende	,
            while (childNode != null) {
                if (childNode.getNodeType() == Node.ELEMENT_NODE) {
                    String myTag = getElementName(childNode);
SHIPMENT_ORDER_PARTY

               <SHIPMENT_ORDER_PARTY>
                    <PARTY_ROLE>PREFERED_EXECUTION</PARTY_ROLE>
                    <PARTY>
                        <PARTY_ID>DHLGEN</PARTY_ID>
                        <NAME>DHLGEN</NAME>
                        <ADDRESS>...</ADDRESS>
                        <CITY>...</CITY>
                        <POSTAL_CODE>1111AA</POSTAL_CODE>
                        <COUNTRY>
                            <COUNTRY_CODE>NL</COUNTRY_CODE>
                        </COUNTRY>
                    </PARTY>
                </SHIPMENT_ORDER_PARTY>

					} else if (SHIPMENT_ORDER_PARTY_TAG.equals(myTag)) {
						processShipmentOrderParty(myShipmentOrderVO, childNode);
/s
ShipmentOrderBodyProcessor.processShipmentOrderParty(ShipmentOrderVO, Node) line: 670	

	while (childNode != null) {
			if (childNode.getNodeType() == Node.ELEMENT_NODE) {
				String tag = getElementName(childNode);
PARTY_ROLE
				if (PARTY_ROLE_TAG.equals(tag)) {
					partyRoleNode = childNode;

	while (childNode != null) {
			if (childNode.getNodeType() == Node.ELEMENT_NODE) {
				String tag = getElementName(childNode);
PARTY
				} else if (PARTY_TAG.equals(tag)) {
					partyNode = childNode;

/ Klaar met process XML	,

		String myPartyRole = partyRoleNode.getTextContent();
PREFERED_EXECUTION

		} else if (myPartyRole.equals(PARTY_ROLE_PREFERED_EXECUTION_PARTY)) {
			Party myParty = new PartyProcessor(this).process(partyNode);
/s
PartyProcessor.process(Node) line: 436	

			Party myVO = new VirtualParty();

			Node childNode = aNode.getFirstChild();
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
PARTY_ID
					} else if (PARTY_ID_TAG.equals(tag)) {
						myVO.setPartyId(childNode.getTextContent());
DHLGEN

/ volgende	,
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
NAME
					} else if (NAME_TAG.equals(tag)) {
						myVO.setName(childNode.getTextContent());
DHLGEN

/ volgende	,
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
ADDRESS
					} else if (ADDRESS_TAG.equals(tag)) {
						myVO.setAddress(childNode.getTextContent());
...


/ volgende	,
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
CITY
					} else if (CITY_TAG.equals(tag)) {
						myVO.setCity(childNode.getTextContent());
...

/ volgende	,
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
POSTAL_CODE
					} else if (POSTAL_CODE_TAG.equals(tag)) {
						myVO.setPostalCode(childNode.getTextContent());
1111AA

/ volgende	,
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
COUNTRY
					} else if (COUNTRY_TAG.equals(tag)) {
						myVO.setCountryVO(new CountryProcessor(this).process(childNode));
/ wordt lookup in DB	,
NL

			return myVO;
myVO	VirtualParty  (id=19666)	
	address	"..." (id=19694)	
	address2	"" (id=17529)	
	city	"..." (id=19695)	
	contactName	"" (id=17529)	
	countryVO	Country  (id=19699)	
	currencyDAO	null	
	dao	null	
	emailAddress	"" (id=17529)	
	entityDetails	HashMap  (id=19704)	
	faxNumber	"" (id=17529)	
	latitude	null	
	longitude	null	
	manifestReport	"" (id=17529)	
	name	"DHLGEN" (id=19705)	
	name2	"" (id=17529)	
	organization	null	
	partyGroups	HashSet  (id=19707)	
	partyGroupsAsString	null	
	partyId	"DHLGEN" (id=19708)	
	partyType	null	
	performanceMonitorService	null	
	phoneNumber	"" (id=17529)	
	postalCode	"1111AA" (id=19715)	
	prenotifyCarcon	false	
	qualifier	"" (id=17529)	
	reference1	"" (id=17529)	
	reference2	"" (id=17529)	
	reference3	"" (id=17529)	
	reference4	"" (id=17529)	
	reference5	"" (id=17529)	
	reference6	"" (id=17529)	
	regionState	"" (id=17529)	
	scheduleVo	null	
	serviceOrderUrlExpression	"" (id=17529)	
	serviceRemarks	"" (id=17529)	
	systemId	0	
	theFormattedEntity	null	
	timeZone	null	

/t
ShipmentOrderBodyProcessor.processShipmentOrderParty(ShipmentOrderVO, Node) line: 715	
		} else if (myPartyRole.equals(PARTY_ROLE_PREFERED_EXECUTION_PARTY)) {
			Party myParty = new PartyProcessor(this).process(partyNode);
/d
myParty	VirtualParty  (id=18468)	
//////////////////////////////////////////////

			if (myParty != null) {
				PreferedPartyTranslationPojo myPreferedPartyTranslationPojo;
				myPreferedPartyTranslationPojo = MpoBeanFactory.getBean(PreferedPartyTranslationDao.class).findByPartyId(aShipmentOrderVO.getOrganization(),
						myParty.getPartyId());
/s
PreferedPartyTranslationDaoImpl.findByPartyId(Organization, String, boolean, Integer[]) line: 46	
/=
	public PreferedPartyTranslationPojo findByPartyId(Organization aOrganization, String aPartyId, boolean useDefault, Integer[] anExcludedIdList) {

aOrganization	Organization  (id=18509)	SystemId:5610	Id:DSV-ES-BCN	Description:DSV Solutions Barcelona
aPartyId	"DHLGEN" (id=19708)	
useDefault	true	
anExcludedIdList	null	

		DetachedCriteria myCriteria = DetachedCriteria.forClass(PreferedPartyTranslationPojo.class).add(Property.forName("organizationVO").eq(aOrganization))
				.add(Property.forName("partyFromId").eq(aPartyId));
		List<PreferedPartyTranslationPojo> preferedPartyTranslationList = getHibernateTemplate().findByCriteria(myCriteria);


SQL> select ppt.*from prefered_party_translation  ppt join organization o on ppt.organization_systemid=o.system_id where ppt.party_from='DHLGEN' and o.organization_id='DSV-ES-BCN';

   SYSTEM_ID PARTY_FROM                                                                       PARTY_TO_SYSTEMID ORGANIZATION_SYSTEMID 
============ =============================================================================== ================= ===================== 
    53267583 DHLGEN                                                                                     1084894                  5610 

/ dit is een vertaaltabel	, party_from en party_to is NIET zoals op een sho	, 

		return preferedPartyTranslationList.get(0);
/t
ShipmentOrderBodyProcessor.processShipmentOrderParty(ShipmentOrderVO, Node) line: 721	
				myPreferedPartyTranslationPojo = MpoBeanFactory.getBean(PreferedPartyTranslationDao.class).findByPartyId(aShipmentOrderVO.getOrganization(),
						myParty.getPartyId());
/d
myPreferedPartyTranslationPojo	PreferedPartyTranslationPojo  (id=19788)	
	organization	Organization  (id=18509)	
		SystemId:5610	Id:DSV-ES-BCN	Description:DSV Solutions Barcelona
	organizationId	null	
	partyFromId	"DHLGEN" (id=19791)	
	partyTo	PartyVO  (id=19792)	
		[SystemId: 1084894; Party: DHLGEN-ES; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@77f1c5ab[PREFERRED_PARTY,Preferred Party]]
	performanceMonitorService	null	
	systemId	53267583	

				if (myPreferedPartyTranslationPojo != null) {
					myParty = myPreferedPartyTranslationPojo.getPartyTo();

//////////////////////////
/ dit is een PartyVO	, masterdata	,

/ SAMENVATTING

public class ShipmentOrderBodyProcessor extends XMLProcessor {
	protected void processShipmentOrderParty(ShipmentOrderVO aShipmentOrderVO, Node aNode) throws TransformerException, PartyException, ShipmentOrderException {

		} else if (myPartyRole.equals(PARTY_ROLE_PREFERED_EXECUTION_PARTY)) {
			Party myParty = new PartyProcessor(this).process(partyNode);
(*)
				myPreferedPartyTranslationPojo = MpoBeanFactory.getBean(PreferedPartyTranslationDao.class).findByPartyId(aShipmentOrderVO.getOrganization(),
						myParty.getPartyId());
(**)

					myParty = myPreferedPartyTranslationPojo.getPartyTo();
(***)

(*): myParty=VirtualParty	, 
(**): in de lookup wordt de partyId van myParty used	, hij looks up in de prefered_party_translation table	, en de party_tp_systemid refs naar de party table	, master data dus	,

pnllogistics6a=# \d prefered_party_translation
         Table "public.prefered_party_translation"
        Column         |         Type          | Modifiers 
-----------------------+-----------------------+-----------
 system_id             | integer               | not null
 party_from            | character varying(80) | 
 party_to_systemid     | integer               | 
 organization_systemid | integer               | 
Indexes:
    "pk_prefered_party_translation" PRIMARY KEY, btree (system_id)
    "prefered_party_translation_party_to_systemid_idx" btree (party_to_systemid)
Foreign-key constraints:
    "ppt_party_fk" FOREIGN KEY (party_to_systemid) REFERENCES party(system_id)

(***) myParty = 'n PartyVO

/ Einde SAMENVATTING

/ SAMENVATTING

///////////////////////////////////
/ de organization op de order is de organistie die verantwoordelijk is voor de order	, 
   <body>
        <SHIPMENT_ORDER>
            <SHIPMENT_ORDER_BODY>
                <ORGANIZATION_ID>DSV-ES-BCN</ORGANIZATION_ID>
/ Dit is dsv spanje barcelona	,

   <body>
        <SHIPMENT_ORDER>
               <SHIPMENT_ORDER_PARTY>
                    <PARTY_ROLE>PREFERED_EXECUTION</PARTY_ROLE>
                    <PARTY>
                        <PARTY_ID>DHLGEN</PARTY_ID>

SQL> select * from prefered_party_translation where party_from ='DHLGEN';

   SYSTEM_ID PARTY_FROM                                                                       PARTY_TO_SYSTEMID ORGANIZATION_SYSTEMID 
============ =============================================================================== ================= ===================== 
    53267583 DHLGEN                                                                                     1084894                  5610 
    53267584 DHLGEN                                                                                     1084894                  5620 


/ de party_from  en de organization_systemid (in feite de organization.organization_id) staan in XML	,

            <SHIPMENT_ORDER_BODY>
                <ORGANIZATION_ID>DSV-ES-BCN</ORGANIZATION_ID> 		<-
                <SHIPMENT_ORDER_PARTY>
                    <PARTY>
                        <PARTY_ID>DHLGEN</PARTY_ID>					<-

/ de lookup in de prefered_party_translation geeft de party_to_systemid	, de masterdata prefered party	,

SQL>  select o.organization_id from organization o where o.system_id= 5610 ;
ORGANIZATION_ID      
==================== 
DSV-ES-BCN           

SQL>  select o.organization_id from organization o where o.system_id= 5620 ;
ORGANIZATION_ID      
==================== 
DSV-ES-MAD      


SQL> select p.party_id,o.organization_id 
from party p 
join organization o on p.organization_systemid=o.system_id 
where p.system_id=  1084894;

PARTY_ID                                           ORGANIZATION_ID      
================================================== ==================== 
DHLGEN-ES                                          DSV-ES               

/ De party , DHLGEN heeft als organization  DSV-ES	, dat betekent dat hij een prefered party kan zijn van DSV-ES-BCN en DSV-ES-MAD	, (Madrid)	,

/ we zien in party 2 entries met party_id DHLGEN en DHLGEN-ES	,
/ TODO (hierarchy)

/ Dus WH	, 
/ In bestelling XML staat DSVGEN als group van prefered party's in de hierarchy	, en de org DSV-ES-BCN	, dan komt daar de prefered party DSVGEN-ES uit	, omdat dat in de prefered-party-translation tbl staat	, 
/ TODO

/ Maar ipv group van  prefered party's kan het ook meteen goed zijn	, zoals we gaan doen in UPSDE hieronder	, 



/ Einde SAMENVATTING

/ SAMENVATTING

/ In de sho (bestelling) doet een bedrijf (bill to) een bestelling om goederen van het warehouse te vervoeren naar 

               <SHIPMENT_ORDER_PARTY>
                    <PARTY_ROLE>BILL_TO</PARTY_ROLE>
                    <PARTY>
                        <PARTY_ID>BCN000157</PARTY_ID>
                        <NAME>ADG (CAMPINGAZ)</NAME>

          <SHIPMENT_ORDER_BODY>
                <COMMON>
                    <FROM_LOCATION>
                        <LOCATION_ID>W01</LOCATION_ID>
                        <LOCATION_TYPE>WAREHOUSE</LOCATION_TYPE>
                        <NAME>DSV Rubi</NAME>
...
		    <TO_LOCATION>
		        <LOCATION_ID>C01</LOCATION_ID>
                        <LOCATION_TYPE>CUSTOMER</LOCATION_TYPE>
                        <NAME>R. JOAO RODRIGUES</NAME>
						<NAME2/>
...

/ Einde SAMENVATTING



			aShipmentOrderVO.setPreferedPartyVO(MasterDataPartyUtil.getMasterParty(myParty));
/ sets aSHipmentOrderVO.thePreferedPartyVO 

/ TODO (Afmaken: wordt er een nieuwe sho in db write?)

/ 7	. 

/ we lezen in	,
dsvsol-2869.xml
/s
ShipmentOrderBodyProcessor.processShipmentOrderParty(ShipmentOrderVO, Node) line: 670	

                <SHIPMENT_ORDER_PARTY>
                    <PARTY_ROLE>PREFERED_EXECUTION</PARTY_ROLE>
                    <PARTY>
                        <PARTY_ID>UPSDE</PARTY_ID>
                        <NAME>UPSDE</NAME>
                        <ADDRESS>...</ADDRESS>
                        <CITY>...</CITY>
                        <POSTAL_CODE>1111AA</POSTAL_CODE>
                        <COUNTRY>
                            <COUNTRY_CODE>NL</COUNTRY_CODE>
                        </COUNTRY>
                    </PARTY>
                </SHIPMENT_ORDER_PARTY>


		while (childNode != null) {
			if (childNode.getNodeType() == Node.ELEMENT_NODE) {
				String tag = getElementName(childNode);

				if (PARTY_ROLE_TAG.equals(tag)) {
					partyRoleNode = childNode;
                    	<PARTY_ROLE>PREFERED_EXECUTION</PARTY_ROLE>

				} else if (PARTY_TAG.equals(tag)) {
					partyNode = childNode;
                   <PARTY>
                        <PARTY_ID>UPSDE</PARTY_ID>
                        <NAME>UPSDE</NAME>
                        <ADDRESS>...</ADDRESS>
                        <CITY>...</CITY>
                        <POSTAL_CODE>1111AA</POSTAL_CODE>
                        <COUNTRY>
                            <COUNTRY_CODE>NL</COUNTRY_CODE>
                        </COUNTRY>
                    </PARTY>

		String myPartyRole = partyRoleNode.getTextContent();
		} else if (myPartyRole.equals(PARTY_ROLE_PREFERED_EXECUTION_PARTY)) {
			Party myParty = new PartyProcessor(this).process(partyNode);
/d
myParty	VirtualParty  (id=17453)	
	address	"..." (id=17454)	
	address2	"" (id=17455)	
	city	"..." (id=17456)	
	contactName	"" (id=17455)	
	countryVO	Country  (id=17457)	
	currencyDAO	null	
	dao	null	
	emailAddress	"" (id=17455)	
	entityDetails	HashMap  (id=17458)	
	faxNumber	"" (id=17455)	
	latitude	null	
	longitude	null	
	manifestReport	"" (id=17455)	
	name	"UPSDE" (id=17459)	
	name2	"" (id=17455)	
	organization	null	
	partyGroups	HashSet  (id=17460)	
	partyGroupsAsString	null	
	partyId	"UPSDE" (id=17461)	
	partyType	null	
	performanceMonitorService	null	
	phoneNumber	"" (id=17455)	
	postalCode	"1111AA" (id=17462)	
	prenotifyCarcon	false	
	qualifier	"" (id=17455)	
	reference1	"" (id=17455)	
	reference2	"" (id=17455)	
	reference3	"" (id=17455)	
	reference4	"" (id=17455)	
	reference5	"" (id=17455)	
	reference6	"" (id=17455)	
	regionState	"" (id=17455)	
	scheduleVo	null	
	serviceOrderUrlExpression	"" (id=17455)	
	serviceRemarks	"" (id=17455)	
	systemId	0	
	theFormattedEntity	null	
	timeZone	null	

				myPreferedPartyTranslationPojo = MpoBeanFactory.getBean(PreferedPartyTranslationDao.class).findByPartyId(aShipmentOrderVO.getOrganization(),
						myParty.getPartyId());
aShipmentOrderVO.getOrganization()=SystemId:3190	Id:DSV-NL-MDK	Description:DSV Solutions Moerdijk
/= org. verantwoordelijk voor de bestelling
myParty.partyId='UPSDE'	, 
/s
PreferedPartyTranslationDaoImpl.findByPartyId(Organization, String, boolean, Integer[]) line: 57	

		DetachedCriteria myCriteria = DetachedCriteria.forClass(PreferedPartyTranslationPojo.class).add(Property.forName("organizationVO").eq(aOrganization))
				.add(Property.forName("partyFromId").eq(aPartyId));
		List<PreferedPartyTranslationPojo> preferedPartyTranslationList = getHibernateTemplate().findByCriteria(myCriteria);
[]
/ Had niet leeg moeten zijn	,
/ inderdaad	, 
SQL> select ppt.*
from prefered_party_translation  ppt 
join organization o on ppt.organization_systemid=o.system_id 
where ppt.party_from='UPSDE' 
and o.organization_id='DSV-NL-MDK';
/ NEE	, is er NIET	,

/ Intermezzo

SQL> select * from prefered_party_translation where party_from ='UPSDE';
/ LEEG	,
/ En dat is het probleem, 	want  TODO

SQL> select o.organization_id 
from party p 
join organization o on p.organization_systemid=o.system_id 
where party_id='UPSDE';
ORGANIZATION_ID      
==================== 
DSV-NL-MDK    
/ Is dit een terechte query	, want hierboven was de party DSVGEN-ES	, en niet DSVGEN	, zoals in de bestelling XML	,
/ WH is hier geen hierarchy	, in de translation table set we party_from="UPSDE'	 en organization=DSV-NL-MDK	, we set niet bijv party_from ='UPS'	, 
 /TODO

/ En deze staat ook in de XML	,
    <body>
        <SHIPMENT_ORDER>
            <SHIPMENT_ORDER_BODY>
                <ORGANIZATION_ID>DSV-NL-MDK</ORGANIZATION_ID>

/ Dus in de party UPSDE in masterdata staat de goede organization	,  maar TODO

/ Einde Intermezzo

		if (preferedPartyTranslationList.isEmpty()) {
			if (useDefault) {
				String myOrganisationId = getDefaultShippingOrganisation();
/s
PreferedPartyTranslationDaoImpl.getDefaultShippingOrganisation() line: 36	
		String myPropertyName = "interface.default.shipping.organisation";
		String myValue = ApplicationPropertyManager.getInstance().getModuleProperty("oms", myPropertyName, "");
3150
		return myValue;
/t
				if (StringUtils.isNotEmpty(myOrganisationId)) {
					Organization org = MpoBeanFactory.getBean(OrganizationDAO.class).getBySystemId(NumberUtils.toInt(myOrganisationId, 0));
SystemId:3150	Id:DSV-NL	Description:DSV Solutions Netherlands
/////////////////////////////
/ Klopt	, 

SQL> select*from organization where system_id=3150;

   SYSTEM_ID ORGANIZATION_ID      DESCRIPTION                                                                                          AUTOM_RATE_CALC IS_DELETED ORGANIZATION_GROUP     SEQUENCE EDI_IDENTIFIER                                                                                                                                                                                                                                                  
============ ==================== =============================================================================== =============== ========== ================== ============ =============================================================================== 
        3150 DSV-NL               DSV Solutions Netherlands                                                                                          0          0             <null>            0 <null>                                                                                                                                                                        
					myCriteria = DetachedCriteria.forClass(PreferedPartyTranslationPojo.class);
					preferedPartyTranslationList = getHibernateTemplate().findByCriteria(
							myCriteria.add(Property.forName("organizationVO").eq(org)).add(Property.forName("partyFromId").eq(aPartyId)));
[]
				if (preferedPartyTranslationList.isEmpty()) {
					// no unit translation found....
					return null;
/t
ShipmentOrderBodyProcessor.processShipmentOrderParty(ShipmentOrderVO, Node) line: 721	
				myPreferedPartyTranslationPojo = MpoBeanFactory.getBean(PreferedPartyTranslationDao.class).findByPartyId(aShipmentOrderVO.getOrganization(),
						myParty.getPartyId());
/d
null
				if (myPreferedPartyTranslationPojo != null) {
/ NEE
				} else {
					myParty = PartyProcessor.storeParty(aShipmentOrderVO, "prefered_execution", myParty);
myParty	VirtualParty  (id=17453)	
PARTY id:UPSDE(systemId:0)	/ die uit XML dus	,

/s
PartyProcessor.storeParty(PartyLookupContext, String, Party, PartyInterfaceMode) line: 244	
		PartyInterfaceMode myPartyMode = getPartyMode(aVO, aPartyQualifier, aDefaultMode);

aVO	ShipmentOrderVO  (id=17326)	
aPartyQualifier	"prefered_execution" (id=18905)	
aPartyVO	VirtualParty  (id=17453)	
aDefaultMode	PartyInterfaceMode  (id=18906)	CREATE_UPDATE

/s
PartyProcessor.getPartyMode(PartyLookupContext, String, PartyInterfaceMode) line: 209	
		String myEntityName = getEntityName(aVO);
"shipmentorder"
		String myPropertyName = "module.oms.interface." + myEntityName + ".party." + aPartyQualifier + ".mode";
module.oms.interface.shipmentorder.party.prefered_execution.mode
		String myValue = ApplicationPropertyManager.getInstance().getOrganizationProperty(aVO.getOrganizationVO(), myPropertyName, aDefaultMode.name());
merge_from_masterdata
		return PartyInterfaceMode.valueOf(myValue.toUpperCase().trim());
/t
PartyProcessor.storeParty(PartyLookupContext, String, Party, PartyInterfaceMode) line: 244	
		PartyInterfaceMode myPartyMode = getPartyMode(aVO, aPartyQualifier, aDefaultMode);
/d
MERGE_FROM_MASTERDATA

		switch (myPartyMode) {
			case MERGE_FROM_MASTERDATA:
				myMasterDataPartyVO = findParty(aVO, aPartyVO);
/s
PartyProcessor.findParty(PartyLookupContext, Party) line: 358	

		PartyService myService = MpoBeanFactory.getBean(PartyService.class);
		if (StringUtils.isNotBlank(aParty.getPartyId())) {
			Party myParty = myService.getPartyByPartyId(aParty.getPartyId(), aContext);


SQL> select count(*)from party where party_id='UPSDE';

       COUNT 
============ 
           1 

			if (myParty != null) {
				return myParty;
/t
PartyProcessor.storeParty(PartyLookupContext, String, Party, PartyInterfaceMode) line: 309	
			case MERGE_FROM_MASTERDATA:
				myMasterDataPartyVO = findParty(aVO, aPartyVO);
/d
/ Die uit db	,
				if (myMasterDataPartyVO != null) {
					merge(aPartyVO, myMasterDataPartyVO);
/s
	private static void merge(Party aDestParty, Party aSourceParty) {
		aDestParty.setContactName(StringUtils.isEmpty(aDestParty.getContactName()) ? aSourceParty.getContactName() : "");
		aDestParty.setEmailAddress(StringUtils.isEmpty(aDestParty.getEmailAddress()) ? aSourceParty.getEmailAddress() : "");
		aDestParty.setFaxNumber(StringUtils.isEmpty(aDestParty.getFaxNumber()) ? aSourceParty.getFaxNumber() : "");
		aDestParty.setPhoneNumber(StringUtils.isEmpty(aDestParty.getPhoneNumber()) ? aSourceParty.getPhoneNumber() : "");
		aDestParty.setSystemId(aDestParty.getSystemId() == 0 ? aSourceParty.getSystemId() : 0);

/ aPartyVO heeft nu ook een systemId	, 
					return aPartyVO;
/t
ShipmentOrderBodyProcessor.processShipmentOrderParty(ShipmentOrderVO, Node) line: 726	

				if (myPreferedPartyTranslationPojo != null) {
/ NEE
				} else {
					myParty = PartyProcessor.storeParty(aShipmentOrderVO, "prefered_execution", myParty);
/d
			aShipmentOrderVO.setPreferedPartyVO(MasterDataPartyUtil.getMasterParty(myParty));
/s
MasterDataPartyUtil.getMasterParty(Party) line: 35	
/=
	public static final PartyVO getMasterParty(Party aParty) {
aParty=VirtualParty	,

		if (aParty instanceof PartyVO) {
/ NEE
			return (PartyVO) aParty;
		}
		if (aParty instanceof MasterDataParty) {
/ NEE
			return ((MasterDataParty) aParty).getMasterParty();
		}
		return null;

/ SAMENVATTING

/ een virtual party zit in de sho, in de shipment_order table	,  een party (PartyVO) is masterdata	, is in de party table	,
/ masterdata is data die je wilt bewaren, en die steeds wordt opgezocht	, 
/ virtual party zijn bijvoorbeeld de klant adressen in bestellingen, deze wil je niet bewaren	, want wordt nooit meer opgezocht	, we zien ze in de tabs ship_from , ship_to, bill_to	, dit zijn dus virtual parties !
/ er zijn ook shipmentorderparty's,  dat zijn de tabs naast de ship_to, ship_from , bill_to parties	,

/ Einde SAMENVATTING

/ FIX DSVSOL-2869 

/ ga naar	,
Configuration, Planning, Prefered party translations
Add, 
organization:  DSV-NL-MDK		/ of, DSV-NL
party to: UPSDE
party from id: UPSDE			/ staat zo in de XML 


/ Einde FIX DSVSOL-2869 


/ Einde DEBUG DSVSOL-2869 


/ OPEN IN BASH 2016-04-06

[eric@localhost ]$ pwd
/home/eric/Devel/Interfaces/dsvfms
[eric@localhost dsvfms]$ gedit BCNITEMDETAILS_17-03-16_02-00-09.CSV-27.xml

[eric@localhost ]$ pwd
/home/eric/DB_TAP/Firebird/Dsvfms
dsvfms.fdb_20160127-003030.fdb ...
[eric@localhost ]$ ls ...
Dsvfms  Local  Misc
/ db's	,
[eric@localhost Dsvfms]$ isql-fb -u sysdba -p masterkey dsvfms.fdb_20160127-003030.fdb
/ In 
/home/eric/DB_TAP/Firebird/Local
/ is foo.fdb	,




[eric@localhost ]$ pwd
/home/eric/Devel/Firebird/scripts/misc
[eric@localhost misc]$ ls
ceva-15529.sql$firebird       ceva-15529.sql$firebird.work2  ceva-15529.sql$firebird.work4  group.sql
ceva-15529.sql$firebird.work  ceva-15529.sql$firebird.work3  ceva-15529.sql$postgres
[eric@localhost misc]$ ls ..
dsvcts  dsvfms  first  local  misc  tmp

[eric@localhost acc]$ pwd
/home/eric/Devel/Firebird/scripts/dsvfms/acc
[eric@localhost acc]$ ls SCS-4418/
def_drops2.sh           def_stats_defer_evnt.sh        exec_patch-396.sh        exec_rm_dups_shi_fms.sh       set_db_location_in_all_scripts.sh
def_rm_dups_pri_fms.sh  exec_chk_rm_dups_pri_fms_2.sh  exec_patch-397.sh        exec_stats_defer_evnt.sh      test.sh
def_rm_dups_shi_fms.sh  exec_chk_rm_dups_shi_fms_2.sh  exec_rm_dups_pri_fms.sh  exec_update_mpo_scs_patch.sh


[eric@localhost Misc]$ pwd
/home/eric/Devel/Postgres/scripts/Misc
[eric@localhost Misc]$ ls
inv_stock_keeping_unit.sh  psa-422-customer_order.sh               psa-422-stock_transaction-product.sh          psa-422-stock_transaction.sh
product_item.sh            psa-422-stock_transaction-product-2.sh  psa-422-stock_transaction-product-tx_date.sh

[eric@localhost camelinaction]$ pwd
/home/eric/Devel/Java/Camel/camelinaction

[eric@localhost wicket]$ pwd
/home/eric/Devel/Java/Wicket/wicket
/ of	,
/home/eric/Devel/Java/Wicket/wicket/wicket-examples/src/main/java/org/apache/wicket/examples

[eric@localhost deploy]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnllogistics/deploy

[eric@localhost webapp-with-js]$  pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee-test/workspace-wicket7/webapp-with-js

[eric@localhost Selenium]$ pwd
/home/eric/Devel/Java/Testing/Selenium

[eric@localhost own]$ pwd
/home/eric/Devel/Java/Wicket/wicket-testing/src/test/java/my/test/own
ain.java                 EasyMock7Test.java  MockitoTest.java             WicketTesterTest.java       XFramesTest.java
Another.java               EasyMockTest.java   MyCssPanel2Test.java         XChromeIDE4Test.java        XJQuery2Test.java
...

[eric@localhost apache-activemq-5.10.1]$ pwd
/home/eric/Devel/Java/ActiveMQ/apache-activemq-5.10.1
$ bin/activemq console

[eric@localhost oms]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/dsvfms/work/jboss.web/localhost/tms/org/apache/jsp/tag/web/oms
/ work dir	,

[eric@localhost pnllogistics]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/pnllogistics

[eric@localhost eclipse-jee]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee

[eric@localhost eclipse-jee-test]$ pwd
/home/eric/Devel/Java/Eclipse/eclipse-jee-test

[eric@localhost apache-tomcat-8.0.28]$ pwd
/home/eric/Devel/Java/Tomcat/apache-tomcat-8.0.28
[eric@localhost apache-tomcat-8.0.28]$ bin/catalina.sh jpda run


calhost LOGS]$  pwd
/home/eric/Devel/LOGS
LOG_8_sep_2014.txt 	/ wicket
LOG_6_OCT_2014.txt
LOG_new.txt
LOG_23_jul_2015.txt
LOG_sho.txt 
LOG_open.txt

[eric@localhost bin]$ pwd
/home/eric/bin
[eric@localhost bin]$ forticlientsslvpn.sh 

[eric@localhost code]$ pwd
/home/eric/Devel/Java/Testing/dbunit/code

[eric@localhost tmp]$ pwd
/home/eric/tmp
[eric@localhost tmp]$ rsync -avz "$(pwd)/home/eric/" backup/home/eric --exclude-from 'rsync.txt'

[eric@localhost ]$ PGPASSWORD=foo psql -U foo 

[root@localhost pg_log]# pwd
/var/lib/pgsql/data/pg_log

[eric@localhost ]$ PGPASSWORD=mpopostgres@mpo psql  -U  mpopostgres pnllogistics6a

$ local-db.sh /home/eric/DB_TAP/Firebird/Local/first.fdb <<_
select a1.id,max(a1.s),a2.id,max(a2.s)
from a1 join a2 using(id)
group by a1.id,a2.id;
_

[eric@localhost wicket]$ local-db.sh /home/eric/DB_TAP/Firebird/Dsvfms/dsvfms.fdb_20151019-000019.fdb

[eric@localhost wicket]$ PGPASSWORD=mpopostgres@mpo psql  -U mpopostgres pnllogistics6a </home/eric/Devel/Firebird/scripts/misc/ceva-15529.sql\$firebird.work  




/ Einde OPEN IN BASH 2016-04-06

/ VIM CLIPBOARD

$ vi ...
:version
Huge version without GUI.  Features included (+) or not (-):
+acl             +cscope          +folding         +menu            +netbeans_intg   -sniff           +virtualedit
+arabic          +cursorbind      -footer          +mksession       +path_extra      +startuptime     +visual
+autocmd         +cursorshape     +fork()          +modify_fname    +perl            +statusline      +visualextra
-balloon_eval    +dialog_con      +gettext         +mouse           +persistent_undo -sun_workshop    +viminfo
-browse          +diff            -hangul_input    -mouseshape      +postscript      +syntax          +vreplace
++builtin_terms  +digraphs        +iconv           +mouse_dec       +printer         +tag_binary      +wildignore
+byte_offset     -dnd             +insert_expand   +mouse_gpm       +profile         +tag_old_static  +wildmenu
+cindent         -ebcdic          +jumplist        -mouse_jsbterm   +python/dyn      -tag_any_white   +windows
-clientserver    +emacs_tags      +keymap          +mouse_netterm   -python3         -tcl             +writebackup
-clipboard       +eval            +langmap         +mouse_sgr       +quickfix        +terminfo        -X11
+cmdline_compl   +ex_extra        +libcall         -mouse_sysmouse  +reltime         +termresponse    -xfontset
+cmdline_hist    +extra_search    +linebreak       +mouse_urxvt     +rightleft       +textobjects     -xim
+cmdline_info    +farsi           +lispindent      +mouse_xterm     +ruby/dyn        +title           -xsmp
+comments        +file_in_path    +listcmds        +multi_byte      +scrollbind      -toolbar         -xterm_clipboard
+conceal         +find_in_path    +localmap        +multi_lang      +signs           +user_commands   -xterm_save
+cryptv          +float           +lua/dyn         -mzscheme        +smartindent     +vertsplit       -xpm
   system vimrc file: "/etc/vimrc"
     user vimrc file: "$HOME/.vimrc"
 2nd user vimrc file: "~/.vim/vimrc"
      user exrc file: "$HOME/.exrc"
  fall-back for $VIM: "/etc"
 f-b for $VIMRUNTIME: "/usr/share/vim/vim74"
Compilation: gcc -c -I. -Iproto -DHAVE_CONFIG_H     -O2 -g -pipe -Wall -fexceptions -fstack-protector-strong --param=ssp-
buffer-size=4 -grecord-gcc-switches  -m64 -mtune=generic -D_GNU_SOURCE -D_FILE_OFFSET_BITS=64 -U_FORTIFY_SOURCE -D_FORTIF
Y_SOURCE=1
Linking: gcc   -L. -Wl,-z,relro -fstack-protector -rdynamic -Wl,-export-dynamic -Wl,--enable-new-dtags  -Wl,-z,relro  -L/
usr/local/lib -Wl,--as-needed -o vim        -lm -lnsl  -lselinux  -lncurses -lacl -lattr -lgpm -ldl   -Wl,--enable-new-dt
ags  -fstack-protector  -L/usr/lib64/perl5/CORE -lperl -lresolv -lnsl -ldl -lm -lcrypt -lutil -lpthread -lc

/ Maar we zien dus inderdaad	,
-clipboard

/ Lees	,
http://vimcasts.org/blog/2013/11/getting-vim-with-clipboard-support/

/ we moeten install	,
vim-gnome, vim-athena, and vim-gtx.

/ Einde VIM CLIPBOARD

/ POSTGRESQL

/ Lees	,
http://www.alberton.info/postgresql_meta_info.html#.VwTk1XWUeV7


/ Einde POSTGRESQL

/ RSYNC

/ Lees	,
http://articles.slicehost.com/2007/10/10/rsync-exclude-files-and-folders


/ Einde RSYNC

/ FUNCTIONAL TESTS

/ cucumber
/ serenity

/ Einde FUNCTIONAL TESTS

/ DSVSOL-2920

/ Lees	,
http://stackoverflow.com/questions/2171635/java-invalid-stream-header-7371007e
/ Einde DSVSOL-2920


/ CEVA-15490

/ 7	. 

/ Op Wartsila(TEST)	,
https://testservices.nl.cevalogistics.com/tmstest/etms/core/index_frameset
/ Kies	seo,
N3253399
/ Click Events tab	, create Event, 
/ Kies POD 	, dat is het enigste wat we moeten geven	, Save custom event

/ Onder Events tab zien we de list van 1 event	, 
naast de checkbox links was eerst een delete button	, 
/ Dat is het issue	,

https://testservices.nl.cevalogistics.com/tms/wartsila/core/index_frameset
/ wartila test

/ 7.	 

/ local	,
[eric@localhost Misc]$ isql-fb -u sysdba -p masterkey ../Misc/dsvcts.fdb_20160316-025058.fdb 
Database:  ../Misc/dsvcts.fdb_20160316-025058.fdb, User: sysdba
SQL> select first 3 service_order_id from service_order order by system_id desc;

SERVICE_ORDER_ID                                                                 
=============================================================================== 
N2362678                                                                         
N2362677                                                                         
N2362674    

/ we kiezen 
N2362678

/ Ga naar de events tab	, 
/ create een event	, click 'Create custom event'	,
Type: POD
Save

/ 7	. 

$ vi oms-sitemap.xmap

			<map:action logger="serviceorder" name="serviceOrderEdit" src="com.mpobjects.oms.control.serviceorder.action.ServiceOrderEditAction"/>

			<map:match pattern="service-order_edit">
				<map:act type="serviceOrderEdit">
				<map:select type="session-attribute">
					<map:parameter name="attribute-name" value="builder"/>
					<map:when test="jsp">
						<map:read mime-type="text/html" type="jsp" src="jsp/service-order_edit.jsp"/>

$ vi service-order_edit.jsp

<%@taglib prefix="etf" tagdir="/WEB-INF/tags/event/"%>


				<mpo:tabCollection name="serviceAction" defaultTab="${param.base_routeAction=='consignmentEdit'||param.base_routeAction=='moveConsignment'?'route':'serviceActions'}">
					<c:if test="${cf:property('event', 'enabled', 'false')!='false'}">
						<mpo:tab name="events">
							<etf:service-order-tab-events />
						</mpo:tab>
					</c:if>

$ vi TabCollectionTag.java
...
$ vi TabTag.java
...

$ vi ./module/oms/war/WEB-INF/tags/event/service-order-tab-events.tag

	<td nowrap="nowrap">
		<mpo:rowCheckBox script="class='smartSaveIgnore'" /> 
		<c:if test="${(cf:property('oms', 'serviceorder.tab.event.delete.hidden', 'false') == false) && mayDeleteEvents}">
			<mpo:action entity="eventList" name="delete" />
		</c:if> 

/ FIX CEVA-15490

$ vi wartsila.properties

module.oms.serviceorder.tab.event.delete.hidden=false


/ Einde FIX CEVA-15490

/ INSTALL PSA-422

[eric@localhost bin]$ vi pg_dump_intermax.sh 

#!/usr/bin/bash
if [ "$#" -ne 2 ]
then
    echo "pg_dump_intermax.sh <machine> <db>"
    exit 7
fi
cd ~/DB_TAP/Postgres/Backup
PGPASSWORD=h^Zgcyr\&Q pg_dump -U vanderveldene -Fc -h  "$1.intermax.mp-objects.com" "$2" >"$2@$1-$(date +%F).dump"
/ of	,
PGPASSWORD=h^Zgcyr\&Q pg_dump -U vanderveldene -Fc -h  "$1.intermax.mp-objects.com" "$2" >"$1-$(date +%F).dump"
/ TODO

[eric@localhost tmp]$ pg_dump_intermax.sh geosco-app-a geosco
/ OK

pnllogistics6a=# create database geosco_app_a_2016_03_21;
CREATE DATABASE

/ pg_restore_local.sh 
/ TODO

<?xml version="1.0" encoding="UTF-8"?>
<server>
    <mbean code="org.jboss.varia.scheduler.Scheduler" name=":service=PnlLogisticsInterfaces">
        <depends>jboss.jca:name=tmsdevDS,service=DataSourceBinding</depends>
        <depends>jboss.jca:name=tmsdevDS,service=ManagedConnectionPool</depends>
        <attribute name="SchedulableClass">com.mpobjects.control.clockevent.ScheduleListener</attribute>
        <attribute name="SchedulableArguments">ejb/PnlLogisticsInterfaceRunnerFacade,all-admin,admin123@MPO</attribute>
        <attribute name="SchedulableArgumentTypes">java.lang.String,java.lang.String,java.lang.String</attribute>
        <attribute name="InitialStartDate">NOW</attribute>
        <attribute name="SchedulePeriod">60000</attribute>
        <attribute name="InitialRepetitions">-1</attribute>
        <attribute name="StartAtStartup">true</attribute>
    </mbean>
</server>



/ Einde INSTALL PSA-422



/ PSA-422

/ 7	. 

/ planning, inventory, replenishment forecast
/ Zoek op mpo_Prod1	,
/ we zien er 2	, maar we kiezen met locateion GEODIS...

/ Kies 30-03 Wed	, 
/ we vullen onderin 160 in het onderste vakje	, 
/ Nu wordt de rc berekent: deze berekent de 3 data	,
req (after)	: vendor prepare
req (before): vendor pickup: ophalen bij vendor	,
res (after): afleveren bij magazijn	, 
/ Dan wordt er een customer order create, 
/ als we terugrekenen: supplier's voorbereiden: 5 dagen, transport 2 dagen	, dus 7 dagen , met weekend overslaan	, dan komen we op 21-03 Mon	, als deze <= vandaag	, en dat is nu zo, want = vandaag	, dan wordt er ook een sho create	, evt moet er eerst naar de supplier worden gebeld	,
/ click op 160	, 
/ we zien de customer order , FORECAST_IN 	CO000002996 / COL00001984
/ en de sho SH000001119 / 010	

/ click op de sho SH000001119 / 010	, 
/ we komen op deze sho	,
/ we zien data	,
req (after)	: 21-Mar
req (before): 28-Mar 
res (after): 30-Mar 

/ Zie tab Product Items
/ We zien quantity 160	,
/ Maar het kan zijn dat de supplier 80 heeft verstuurd	, we maken Actual Quantity 80	.  edit de Product Item,
 

/ Intermezzo

/ click  op 60 op 22-03 op replenishment forecast	,
/ we zien 6	,
2016-03-22 23:59	FORECAST_IN		CO000002510 / COL00001375	20		7670
2016-03-22 23:59	ORDER_IN	SH000000920 / 010		20		7690
2016-03-22 23:59	FORECAST_IN		CO000002991 / COL00001974	20		7690
2016-03-22 23:59	ORDER_IN	SH000001116 / 010		20		7710
2016-03-22 23:59	FORECAST_IN		CO000002992 / COL00001976	20		7710
2016-03-22 23:59	ORDER_IN	SH000001114 / 030		20		7730

/ Ga naar	, 
planning, inventory, stock transcation,
/ we zien 6 lines van 22-03
/ klopt	,

/ Einde Intermezzo

/ 7	. 

/ we hadden 160 op 30-03	
/ we doen onderaan	140 , erbij	,
/ we zien eerst 140 bij FC In,	 later 300 bij In	, dus de 140 is + bij 160	, 
/ we zien de messages	,
Created a order in the lead time: CO000002999
Replenishment advice executed, #period 155, processed 1 advices

/ click op 300	, we zien nu 4 orders	,  TODO
2016-03-30 23:59	FORECAST_IN		CO000002996 / COL00001984	160		7950
2016-03-30 23:59	ORDER_IN	SH000001119 / 010		160		8110
2016-03-30 23:59	FORECAST_IN		CO000002999 / COL00001991	140		8110
2016-03-30 23:59	ORDER_IN	SH000001119 / 020		140		8250
/ 2 erbij	,

/ click op de  SH000001119 / 020	, 
 



/ Einde PSA-422 

/ SQL PSA-422 STOCK TRANSACTION PAGE

/ 7	. 

planning , customer order , search
CO000002999
/ LEEG result	,

/ Waarom?

/ In de postgres log	,

select customeror0_.SYSTEM_ID as col_0_0_, customeror0_.CUSTOMER_ORDER_NUMBER as col_1_0_, organizati2_.ORGANIZATION_ID as col_2_0_, customeror0_.SELLER_NAME as col_3_0_, customeror0_.BUYER_NAME as col_4_0_, customeror0_.SELLER_ORDER_NUMBER as col_5_0_, customeror0_.BUYER_ORDER_NUMBER as col_6_0_, orderstatu3_.STATUS_CODE as col_7_0_, customeror1_.CUSTOMER_ORDER_TYPE as col_8_0_, customeror0_.CREATION_DATE as col_9_0_ 
from CUSTOMER_ORDER customeror0_ 
left outer join CUSTOMER_ORDER_TYPE customeror1_ on customeror0_.CUSTOMER_ORDER_TYPE_SYSTEMID=customeror1_.SYSTEM_ID, 
ORGANIZATION organizati2_, 
ORDER_STATUS orderstatu3_ 
where customeror0_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID 
and customeror0_.STATUS_CODE_SYSTEMID=orderstatu3_.SYSTEM_ID 
and (customeror0_.ORGANIZATION_SYSTEMID in (
	select userorgani4_.ORGANIZATION_SYSTEMID 
	from USER_ORGANIZATION userorgani4_, 
	ORGANIZATION organizati5_ 
	where userorgani4_.ORGANIZATION_SYSTEMID=organizati5_.SYSTEM_ID 
	and userorgani4_.USER_SYSTEMID=$1
	)
) 
and (customeror0_.FORECAST_ID is null or customeror0_.FORECAST_ID='')  	<-
and customeror0_.IS_DELETED=0 
and (lower(customeror0_.CUSTOMER_ORDER_NUMBER) like lower($2)) 
order by customeror0_.CREATION_DATE 
desc limit $3 
DETAIL:  parameters: $1 = '27176488', $2 = '%CO000002999%', $3 = '50000'

/ See line bij <-	, daarom leeg result	, als we deze line comment out	, dan WEL result	, 

/ Reden	,

geosco_app_a_2016_03_21=# select*from customer_order where customer_order_number='CO000002999';
-[ RECORD 1 ]----------------+------------------------
system_id                    | 26880893
customer_order_number        | CO000002999
forecast_id                  | R3NCY3NCMN8160330
forecast_status              | FIRM
forecast_date                | NULL
/ TODO

/ we hebben 	,
[eric@localhost Misc]$ pwd
/home/eric/Devel/Postgres/scripts/Misc
[eric@localhost Misc]$ cat psa-422.sh 
#!/usr/bin/bash

PGPASSWORD=mpopostgres@mpo psql  -U mpopostgres geosco_app_a_2016_03_21 <<SQL
select customeror0_.SYSTEM_ID as col_0_0_, customeror0_.CUSTOMER_ORDER_NUMBER as col_1_0_, organizati2_.ORGANIZATION_ID as col_2_0_, customeror0_.SELLER_NAME as col_3_0_, customeror0_.BUYER_NAME as col_4_0_, customeror0_.SELLER_ORDER_NUMBER as col_5_0_, customeror0_.BUYER_ORDER_NUMBER as col_6_0_, orderstatu3_.STATUS_CODE as col_7_0_, customeror1_.CUSTOMER_ORDER_TYPE as col_8_0_, customeror0_.CREATION_DATE as col_9_0_
from CUSTOMER_ORDER customeror0_
left outer join CUSTOMER_ORDER_TYPE customeror1_ on customeror0_.CUSTOMER_ORDER_TYPE_SYSTEMID=customeror1_.SYSTEM_ID,
ORGANIZATION organizati2_,
ORDER_STATUS orderstatu3_
where customeror0_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID
and customeror0_.STATUS_CODE_SYSTEMID=orderstatu3_.SYSTEM_ID
and (customeror0_.ORGANIZATION_SYSTEMID in (
    select userorgani4_.ORGANIZATION_SYSTEMID
    from USER_ORGANIZATION userorgani4_,
    ORGANIZATION organizati5_
    where userorgani4_.ORGANIZATION_SYSTEMID=organizati5_.SYSTEM_ID
    and userorgani4_.USER_SYSTEMID='27176488'
    )
)
--and (customeror0_.FORECAST_ID is null or customeror0_.FORECAST_ID='') 		-- <-
and customeror0_.IS_DELETED=0
and (lower(customeror0_.CUSTOMER_ORDER_NUMBER) like lower('%CO000002999%'))
order by customeror0_.CREATION_DATE
SQL

/ we zien	,
geosco_app_a_2016_03_21=# select*from customer_order_type;
 system_id | is_deleted | customer_order_type |   description   
-----------+------------+---------------------+-----------------
  26942698 |          0 | SALES_ORDER         | Sales orders
  26942699 |          0 | PURCHASE_ORDER      | Purchase orders
(2 rows)
/ Not used	,

geosco_app_a_2016_03_21=# select*from order_status;
 system_id | is_deleted | status_code | status_type |         status_description         
-----------+------------+-------------+-------------+------------------------------------
         1 |          0 | 9000        | ENDED       | FINISHED
         2 |          0 | 8000        | STARTED     | STARTED
         3 |          0 | 1401        | GENERAL     | PRODUCTION PLANNED SHIPMENT
         4 |          0 | 1402        | GENERAL     | CREDIT HOLD
         5 |          0 | 1403        | GENERAL     | INSPECTION HOLD
         6 |          0 | 1404        | OPEN        | OPEN
...
/ not used	,



/ 7	. 

/ planning, inventory, stock transaction
StockTransactionListPage

/ we zien in postgres log	,

select stocktrans0_.SYSTEM_ID as col_0_0_, stocktrans0_.TRANSACTION_TYPE as col_1_0_, organizati2_.ORGANIZATION_ID as col_2_0_, (product3_.PRODUCTID||' - '||product3_.DESCRIPTION) as col_3_0_, goodsstatu1_.CODE as col_4_0_, stocklocat5_.NAME as col_5_0_, stocktrans0_.TRANSACTION_TYPE as col_6_0_, stocktrans0_.QUANTITY as col_7_0_, stocktrans0_.CALC_STOCK_LEVEL as col_8_0_, stocktrans0_.TRANSACTION_DATE as col_9_0_ 
from STOCK_TRANSACTION stocktrans0_ 
left outer join GOODS_STATUS goodsstatu1_ on stocktrans0_.GOODS_STATUS_SYSTEMID=goodsstatu1_.SYSTEM_ID, 
ORGANIZATION organizati2_, 
product product3_, 
STOCK_LOCATION stocklocat5_ 
where stocktrans0_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID 
and stocktrans0_.PRODUCT_SYSTEMID=product3_.SYSTEM_ID 
and stocktrans0_.STOCK_LOCATION_SYSTEMID=stocklocat5_.SYSTEM_ID 
and (stocktrans0_.ORGANIZATION_SYSTEMID in (
	select userorgani6_.ORGANIZATION_SYSTEMID 
	from USER_ORGANIZATION userorgani6_, 
	ORGANIZATION organizati7_ 
	where userorgani6_.ORGANIZATION_SYSTEMID=organizati7_.SYSTEM_ID 
	and userorgani6_.USER_SYSTEMID=$1
	)
) 
order by stocktrans0_.TRANSACTION_DATE desc, stocktrans0_.SYSTEM_ID 
desc limit $2
DETAIL:  parameters: $1 = '27176488', $2 = '50000'

/ we maken	
[eric@localhost Misc]$ pwd
/home/eric/Devel/Postgres/scripts/Misc
[eric@localhost Misc]$ cat psa-422-stock_transaction.sh 
#!/usr/bin/bash

PGPASSWORD=mpopostgres@mpo psql  -U mpopostgres geosco_app_a_2016_03_21 <<SQL
select stocktrans0_.SYSTEM_ID as col_0_0_, stocktrans0_.TRANSACTION_TYPE as col_1_0_, organizati2_.ORGANIZATION_ID as col_2_0_, (product3_.PRODUCTID||' - '||product3_.DESCRIPTION) as col_3_0_, goodsstatu1_.CODE as col_4_0_, stocklocat5_.NAME as col_5_0_, stocktrans0_.TRANSACTION_TYPE as col_6_0_, stocktrans0_.QUANTITY as col_7_0_, stocktrans0_.CALC_STOCK_LEVEL as col_8_0_, stocktrans0_.TRANSACTION_DATE as col_9_0_
from STOCK_TRANSACTION stocktrans0_
left outer join GOODS_STATUS goodsstatu1_ on stocktrans0_.GOODS_STATUS_SYSTEMID=goodsstatu1_.SYSTEM_ID,
ORGANIZATION organizati2_,
product product3_,
STOCK_LOCATION stocklocat5_
where stocktrans0_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID
and stocktrans0_.PRODUCT_SYSTEMID=product3_.SYSTEM_ID				-- Hier zoeken we altijd op met 'mpo_Prod1'
and stocktrans0_.STOCK_LOCATION_SYSTEMID=stocklocat5_.SYSTEM_ID		-- warehouse	,
and (stocktrans0_.ORGANIZATION_SYSTEMID in (
    select userorgani6_.ORGANIZATION_SYSTEMID
    from USER_ORGANIZATION userorgani6_,
    ORGANIZATION organizati7_
    where userorgani6_.ORGANIZATION_SYSTEMID=organizati7_.SYSTEM_ID
    and userorgani6_.USER_SYSTEMID=''27176488'
    )
)
order by stocktrans0_.TRANSACTION_DATE desc, stocktrans0_.SYSTEM_ID
limit 10
SQL

/ we zien dat 

geosco_app_a_2016_03_21=#  select*from goods_status;
 system_id | hold_status_systemid | code |        description         | is_deleted 
-----------+----------------------+------+----------------------------+------------
  26877286 |                 NULL | JAIL | Goods in waiting status    |          0
  26877284 |                 NULL | GOOD | The products is available  |          0
  26885025 |                 NULL | BAD  | Product are in a bad mound |          0
( 3 rows)
/ Not used	,

geosco_app_a_2016_03_21=# select*from stock_location;
 system_id |                        name                        | is_deleted | stock_loc_type_systemid | parent_stock_loc_systemid | party_systemid 
-----------+----------------------------------------------------+------------+-------------------------+---------------------------+----------------
  26878599 | NINGBO ZHONGJUN AUTO PARTS CO.,LTD_WH_CH_Zhejiang_ |          0 |                26877539 |                      NULL |       26878367
  26878349 | GEODIS AUTOMOTIVE EST ETUPES_WH_FR_ETUPES_SELLER   |          0 |                26877279 |                      NULL |       26878345
  26878600 | NINGBO ZHONGJUN AUTO PARTS CO.,LTD_WH_FR_ ETUPES   |          0 |                26877539 |                  26878599 |       26878491
  26878447 | GESTAMP_WH_ES_MADRID_SELLER                        |          0 |                26877539 |                      NULL |       26878347
...
geosco_app_a_2016_03_21=# select*from stock_location_type;
 system_id |    name    |           description            | is_deleted 
-----------+------------+----------------------------------+------------
  26877539 | WHS_VENDOR | Vendor Warehouse                 |          0
  26877279 | WHS_GEODIS | Geodis Warehouse                 |          0
  26878452 | WHS_BUYER  | Wharehouse for Buyer information |          0
(3 rows)


/ 7	. 

/ we zoeken op product 'mpo_Prod1'	, 

[eric@localhost Misc]$ pwd
/home/eric/Devel/Postgres/scripts/Misc
[eric@localhost Misc]$ vi psa-422-stock_transaction-product.sh

select
 stocktrans0_.SYSTEM_ID as col_0_0_,
 stocktrans0_.TRANSACTION_TYPE as col_1_0_,
 organizati2_.ORGANIZATION_ID as col_2_0_,
 (product3_.PRODUCTID||' - '||product3_.DESCRIPTION) as col_3_0_,
 goodsstatu1_.CODE as col_4_0_,
 stocklocat5_.NAME as col_5_0_,
 stocktrans0_.TRANSACTION_TYPE as col_6_0_,
 stocktrans0_.QUANTITY as col_7_0_,												-- <-
 stocktrans0_.CALC_STOCK_LEVEL as col_8_0_,
 stocktrans0_.TRANSACTION_DATE as col_9_0_

/ of	,

select *

from STOCK_TRANSACTION stocktrans0_
left outer join GOODS_STATUS goodsstatu1_ on stocktrans0_.GOODS_STATUS_SYSTEMID=goodsstatu1_.SYSTEM_ID,
ORGANIZATION organizati2_,
product product3_,
STOCK_LOCATION stocklocat5_
where stocktrans0_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID
and stocktrans0_.PRODUCT_SYSTEMID=product3_.SYSTEM_ID
and stocktrans0_.STOCK_LOCATION_SYSTEMID=stocklocat5_.SYSTEM_ID
and (stocktrans0_.ORGANIZATION_SYSTEMID in (
    select userorgani6_.ORGANIZATION_SYSTEMID
    from USER_ORGANIZATION userorgani6_,
    ORGANIZATION organizati7_
    where userorgani6_.ORGANIZATION_SYSTEMID=organizati7_.SYSTEM_ID
    and userorgani6_.USER_SYSTEMID=27176488
    )
)
and (lower((product3_.PRODUCTID||' - '||product3_.DESCRIPTION)) like lower('%mpo_Prod1%'))
order by stocktrans0_.TRANSACTION_DATE desc, stocktrans0_.SYSTEM_ID desc

[eric@localhost Misc]$ ./psa-422-stock_transaction-product.sh 
...
(234 rows)
/ OK

/ 7	. 

/ we zoeken op product en transaction_date	,

[eric@localhost Misc]$ pwd
/home/eric/Devel/Postgres/scripts/Misc
[eric@localhost Misc]$ cat ./psa-422-stock_transaction-product-tx_date.sh 

PGPASSWORD=mpopostgres@mpo psql  -U mpopostgres geosco_app_a_2016_03_21 <<SQL
select *
from STOCK_TRANSACTION stocktrans0_
left outer join GOODS_STATUS goodsstatu1_ on stocktrans0_.GOODS_STATUS_SYSTEMID=goodsstatu1_.SYSTEM_ID,
ORGANIZATION organizati2_,
product product3_,
STOCK_LOCATION stocklocat5_
where stocktrans0_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID
and stocktrans0_.PRODUCT_SYSTEMID=product3_.SYSTEM_ID
and stocktrans0_.STOCK_LOCATION_SYSTEMID=stocklocat5_.SYSTEM_ID
and (stocktrans0_.ORGANIZATION_SYSTEMID in (
    select userorgani6_.ORGANIZATION_SYSTEMID
    from USER_ORGANIZATION userorgani6_,
    ORGANIZATION organizati7_
    where userorgani6_.ORGANIZATION_SYSTEMID=organizati7_.SYSTEM_ID
    and userorgani6_.USER_SYSTEMID=27176488
    )
)
and (lower((product3_.PRODUCTID||' - '||product3_.DESCRIPTION)) like lower('%mpo_Prod1%'))
and stocktrans0_.TRANSACTION_DATE>=' Wed Mar 30 00:00:00 CEST 2016' 
order by stocktrans0_.TRANSACTION_DATE desc, stocktrans0_.SYSTEM_ID desc
SQL

[eric@localhost Misc]$ ./psa-422-stock_transaction-product-tx_date.sh 
...
(6 rows)
/ OK

/ 7	. 

/ we zien dat er maar 2 entries zijn met product_item_systemid!=NULL	,

PGPASSWORD=mpopostgres@mpo psql  -U mpopostgres geosco_app_a_2016_03_21 <<SQL
select product_item_systemid
from STOCK_TRANSACTION stocktrans0_
left outer join GOODS_STATUS goodsstatu1_ on stocktrans0_.GOODS_STATUS_SYSTEMID=goodsstatu1_.SYSTEM_ID,
ORGANIZATION organizati2_,
product product3_,
STOCK_LOCATION stocklocat5_
where stocktrans0_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID
and stocktrans0_.PRODUCT_SYSTEMID=product3_.SYSTEM_ID
and stocktrans0_.STOCK_LOCATION_SYSTEMID=stocklocat5_.SYSTEM_ID
and (stocktrans0_.ORGANIZATION_SYSTEMID in (
    select userorgani6_.ORGANIZATION_SYSTEMID
    from USER_ORGANIZATION userorgani6_,
    ORGANIZATION organizati7_
    where userorgani6_.ORGANIZATION_SYSTEMID=organizati7_.SYSTEM_ID
    and userorgani6_.USER_SYSTEMID=27176488
    )
)
and (lower((product3_.PRODUCTID||' - '||product3_.DESCRIPTION)) like lower('%mpo_Prod1%'))
and stocktrans0_.TRANSACTION_DATE>=' Wed Mar 30 00:00:00 CEST 2016' 
order by stocktrans0_.TRANSACTION_DATE desc, stocktrans0_.SYSTEM_ID desc
SQL


[eric@localhost Misc]$ ./psa-422-stock_transaction-product-tx_date.sh 
Null display is "NULL".
 product_item_systemid 
-----------------------
                  NULL
                  NULL
              26880413
                  NULL
              26880393
                  NULL
(6 rows)

/ we doen daarom	,

PGPASSWORD=mpopostgres@mpo psql  -U mpopostgres geosco_app_a_2016_03_21 <<SQL
select product_item_systemid
from STOCK_TRANSACTION stocktrans0_
left outer join GOODS_STATUS goodsstatu1_ on stocktrans0_.GOODS_STATUS_SYSTEMID=goodsstatu1_.SYSTEM_ID,
ORGANIZATION organizati2_,
product product3_,
STOCK_LOCATION stocklocat5_
where stocktrans0_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID
and stocktrans0_.PRODUCT_SYSTEMID=product3_.SYSTEM_ID
and stocktrans0_.STOCK_LOCATION_SYSTEMID=stocklocat5_.SYSTEM_ID
and (stocktrans0_.ORGANIZATION_SYSTEMID in (
    select userorgani6_.ORGANIZATION_SYSTEMID
    from USER_ORGANIZATION userorgani6_,
    ORGANIZATION organizati7_
    where userorgani6_.ORGANIZATION_SYSTEMID=organizati7_.SYSTEM_ID
    and userorgani6_.USER_SYSTEMID=27176488
    )
)
and (lower((product3_.PRODUCTID||' - '||product3_.DESCRIPTION)) like lower('%mpo_Prod1%'))
and stocktrans0_.TRANSACTION_DATE>=' Wed Mar 30 00:00:00 CEST 2016' 
and product_item_systemid is not null
order by stocktrans0_.TRANSACTION_DATE desc, stocktrans0_.SYSTEM_ID desc
SQL

[eric@localhost Misc]$ ./psa-422-stock_transaction-product-tx_date.sh 
Null display is "NULL".
 product_item_systemid 
-----------------------
              26880413
              26880393
(2 rows)

/ 7	. 

/ we doen select *	, met \x	, en \o /tmp/res.txt

-[ RECORD 1 ]----------------+--------------------------
system_id                    | 27176495
quantity                     | 140.00000
serial_number                | NULL
lot_id                       | NULL
transaction_date             | 2016-03-30 23:59:00
product_systemid             | 27044086
goods_status_systemid        | 26877284
stock_location_systemid      | 26878346
product_item_systemid        | 26880413
external_id                  | NULL
organization_systemid        | 12000
calc_stock_level             | 8250.00000
is_dirty                     | 0
transaction_type             | ORDER_IN
customer_order_line_systemid | NULL
shipment_item_systemid       | NULL
ignore_on_balance            | 0
system_id                    | 26877284
hold_status_systemid         | NULL
code                         | GOOD
description                  | The products is available
is_deleted                   | 0
system_id                    | 12000
organization_id              | LOG_EMEA_FR_CT_PSA
description                  | Organization for PSA CT
autom_rate_calc              | 0
is_deleted                   | 0
organization_group           | 7000
sequence                     | 0
edi_identifier               | NULL
system_id                    | 27044086
productid                    | MPO_Prod1
description                  | MPO_Prod1
organization_systemid        | 12000
series                       | NULL
model                        | NULL
partnumber                   | NULL
customsnumber                | NULL
length                       | 1.0000
width                        | 0.2000
height                       | 0.3000
volume                       | 0.0600
loadingmeters                | NULL
country_systemid             | NULL
product_value                | NULL
currency_systemid            | NULL
reference1                   | NULL
reference2                   | NULL
reference3                   | NULL
reference4                   | NULL
reference5                   | NULL
reference6                   | NULL
reference7                   | NULL
reference8                   | NULL
reference9                   | NULL
reference10                  | NULL
addresscode_systemid         | NULL
flashpoint                   | NULL
unnumber_systemid            | NULL
is_deleted                   | 0
weight_kg                    | 50.00000
packaging_group              | NULL
remarks                      | NULL
product_owner                | NULL
product_group                | NULL
pref_ship_unit_systemid      | NULL
dg_adn_tankvessel_systemid   | NULL
qty_in_unit                  | NULL
created_date                 | 2016-02-09 09:49:31.244
last_update                  | 2016-03-10 14:14:36.086
system_id                    | 26878346
name                         | GEODIS_WHS_FR_SOCHAUX
is_deleted                   | 0
stock_loc_type_systemid      | 26877279
parent_stock_loc_systemid    | 26878470
party_systemid               | 26878344

-[ RECORD 2 ]----------------+--------------------------
system_id                    | 27176429
quantity                     | 160.00000
serial_number                | NULL
lot_id                       | NULL
transaction_date             | 2016-03-30 23:59:00
product_systemid             | 27044086
goods_status_systemid        | 26877284
stock_location_systemid      | 26878346
product_item_systemid        | 26880393
external_id                  | NULL
organization_systemid        | 12000
calc_stock_level             | 8110.00000
is_dirty                     | 0
transaction_type             | ORDER_IN
customer_order_line_systemid | NULL
shipment_item_systemid       | NULL
ignore_on_balance            | 0
system_id                    | 26877284
hold_status_systemid         | NULL
code                         | GOOD
description                  | The products is available
is_deleted                   | 0
system_id                    | 12000
organization_id              | LOG_EMEA_FR_CT_PSA
description                  | Organization for PSA CT
autom_rate_calc              | 0
is_deleted                   | 0
organization_group           | 7000
sequence                     | 0
edi_identifier               | NULL
system_id                    | 27044086
productid                    | MPO_Prod1
description                  | MPO_Prod1
organization_systemid        | 12000
series                       | NULL
model                        | NULL
partnumber                   | NULL
customsnumber                | NULL
length                       | 1.0000
width                        | 0.2000
height                       | 0.3000
volume                       | 0.0600
loadingmeters                | NULL
country_systemid             | NULL
product_value                | NULL
currency_systemid            | NULL
reference1                   | NULL
reference2                   | NULL
reference3                   | NULL
reference4                   | NULL
reference5                   | NULL
reference6                   | NULL
reference7                   | NULL
reference8                   | NULL
reference9                   | NULL
reference10                  | NULL
addresscode_systemid         | NULL
flashpoint                   | NULL
unnumber_systemid            | NULL
is_deleted                   | 0
weight_kg                    | 50.00000
packaging_group              | NULL
remarks                      | NULL
product_owner                | NULL
product_group                | NULL
pref_ship_unit_systemid      | NULL
dg_adn_tankvessel_systemid   | NULL
qty_in_unit                  | NULL
created_date                 | 2016-02-09 09:49:31.244
last_update                  | 2016-03-10 14:14:36.086
system_id                    | 26878346
name                         | GEODIS_WHS_FR_SOCHAUX
is_deleted                   | 0
stock_loc_type_systemid      | 26877279
parent_stock_loc_systemid    | 26878470
party_systemid               | 26878344

/ we zien dus de quantity van de stock transaction	, 
/ Waar wordt deze set?

/ 7	. 

/ we zoeken op product en transaction_date	,

/ Zoek in de log file '%mpo_Prod1'	,

/ 7	. 

/ we moeten letten op	,
$ vi StockTransactionListPage.java
	@Override
	protected void createPageComponents() {
		myQuery.getColumns().add(new NumberQueryColumn("quantity", "s.quantity"));

geosco_app_a_2016_03_21=# \d stock_transaction
                                     Table "public.stock_transaction"
            Column            |            Type             |                  Modifiers                  
------------------------------+-----------------------------+---------------------------------------------
 quantity                     | numeric(18,5)               | not null

/ Einde SQL PSA-422 STOCK TRANSACTION PAGE

/ DEBUG PSA-422 STOCK TRANSACTION PAGE


/ Einde DEBUG PSA-422 STOCK TRANSACTION PAGE

/ SQL PSA-422 STOCK REPLENISHMENT FORECAST 

/ 7	. 

planning, inventory, replenishment forecast
ForecastListPage

/ we zoeken op product id 'mpo_Prod1'	, 
/ dat is handig voor in de postgres log	, want dan zoeken we op '%mpo_Prod1%'	,

select stockkeepi0_.SYSTEM_ID as col_0_0_, product2_.PRODUCTID as col_1_0_, product2_.DESCRIPTION as col_2_0_, goodsstatu1_.CODE as 
col_3_0_, stocklocat4_.NAME as col_4_0_ 
 of	,
select *
from INV_STOCK_KEEPING_UNIT stockkeepi0_ 
left outer join GOODS_STATUS goodsstatu1_ on stockkeepi0_.GOODS_STATUS_SYSTEMID=goodsstatu1_.SYSTEM_ID, 
product product2_, 
STOCK_LOCATION stocklocat4_ 
where stockkeepi0_.PRODUCT_SYSTEMID=product2_.SYSTEM_ID 
and stockkeepi0_.STOCK_LOCATION_SYSTEMID=stocklocat4_.SYSTEM_ID 
and (stockkeepi0_.ORGANIZATION_SYSTEMID in (
    select userorgani5_.ORGANIZATION_SYSTEMID
    from USER_ORGANIZATION userorgani5_,
    ORGANIZATION organizati6_ 
    where userorgani5_.ORGANIZATION_SYSTEMID=organizati6_.SYSTEM_ID
    and userorgani5_.USER_SYSTEMID=27176488
))
and (lower(product2_.PRODUCTID) like lower('%mpo_Prod1%')) 
SQL

[eric@localhost Misc]$ ./inv_stock_keeping_unit.sh 
...
/ OK

/ 7	. 

/ we edit de bovenste	, mpo_Prod1 && GEODIS_WHS_FR_SOCHAUX	, 
/ dan zien we de page, met alle kolommen	, 

$ vi ForecastListPage.java
				setResponsePage(new EditingReplenishmentAdvicePage(ForecastListPage.this, (Integer) aObject));

/ replenish=bijvullen	,

/ we kijken eerst naar de HTML	,

<div id="pageContent">
...
/ bovenste gebied	,
	<div class="timeline">

/ title linksboven	,
		<div class="sku-info">
			<span class="special-message" wicket:id="specialMessage" wicketpath="timeline_specialMessage">155 Days</span>

/ rij met columns met datum-tijd	, bovenin , naast elkaar	, in iedere column bijv	, 
03-04
Mon
00:00
		<div class="period" wicket:id="period" wicketpath="timeline_period_0">
			<wicket:container wicket:id="periodPanel" id="periodPanela9d" wicketpath="timeline_period_0_periodPanel"><wicket:panel>
				<div class="main" wicket:id="main" wicketpath="timeline_period_0_periodPanel_main">20-03</div>
				<div class="sub" wicket:id="sub" wicketpath="timeline_period_0_periodPanel_sub">Sun</div>
				<div class="time" wicket:id="time" wicketpath="timeline_period_0_periodPanel_time">00:00</div>
			</wicket:panel></wicket:container>
		</div><div class="period" wicket:id="period" wicketpath="timeline_period_1">
			<wicket:container wicket:id="periodPanel" id="periodPanela9e" wicketpath="timeline_period_1_periodPanel"><wicket:panel>
				<div class="main" wicket:id="main" wicketpath="timeline_period_1_periodPanel_main">21-03</div>
				<div class="sub" wicket:id="sub" wicketpath="timeline_period_1_periodPanel_sub">Mon</div>
				<div class="time" wicket:id="time" wicketpath="timeline_period_1_periodPanel_time">00:00</div>
			</wicket:panel></wicket:container>
		</div>
...

/ rij met columns  
FC In	0
In		160
FC Out
Out
Count
		----------
Balance	8750
		<div wicket:id="sku" id="skuad9" wicketpath="sku"><wicket:panel>
	<div class="sku-line">

/ min/max/... links 	,
		<div class="sku-info" wicket:id="skuInfo" wicketpath="sku_skuInfo"><wicket:panel>
	<span class="product" wicket:id="product" wicketpath="sku_skuInfo_product">MPO_Prod1</span><wicket:enclosure child="goodsstatus" wicketpath="sku_skuInfo_enclosure-19">(<span wicket:id="goodsstatus" wicketpath="sku_skuInfo_goodsstatus">GOOD</span>)</wicket:enclosure>-<span class="location" wicket:id="location" wicketpath="sku_skuInfo_location">GEODIS_WHS_FR_SOCHAUX</span><br>
	<span wicket:id="min" wicketpath="sku_skuInfo_min">15</span>/<span wicket:id="target" wicketpath="sku_skuInfo_target">30</span>/<span wicket:id="max" wicketpath="sku_skuInfo_max">45</span>/<span wicket:id="leadTime" wicketpath="sku_skuInfo_leadTime">2d</span>/<span wicket:id="lotSize" wicketpath="sku_skuInfo_lotSize">20</span>
</wicket:panel></div>

FC In	
In	
FC Out
Out
Count
Balance	
		<div class="projection-title">

/ rij met columns die er zo uitzien	,
0
3540
0
0
7640
		<div class="projection day-even" wicket:id="projection" id="id0ada" wicketpath="sku_projection_0" onclick="var wcall=wicketAjaxGet('?wicket:interface=:44:sku:projection:0::IBehaviorListener:1:',function() { }.bind(this),function() { }.bind(this), function() {return Wicket.$('id0ada') != null;}.bind(this));">
			<wicket:container wicket:id="projectionInfo" wicketpath="sku_projection_0_projectionInfo"><wicket:panel>
				<div class="stock-in invalid-sku" wicket:id="stock-in-fc" wicketpath="sku_projection_0_projectionInfo_stock-in-fc">0</div>
				<div class="stock-in invalid-sku" wicket:id="stock-in" wicketpath="sku_projection_0_projectionInfo_stock-in">0</div>					/ (*)
				<div class="stock-out invalid-sku" wicket:id="stock-out-fc" wicketpath="sku_projection_0_projectionInfo_stock-out-fc">0</div>
				<div class="stock-out invalid-sku" wicket:id="stock-out" wicketpath="sku_projection_0_projectionInfo_stock-out">0</div>
				<div class="stock-count" wicket:id="stock-count" wicketpath="sku_projection_0_projectionInfo_stock-count"></div>
				<div class="stock-balance over" wicket:id="stock-balance" wicketpath="sku_projection_0_projectionInfo_stock-balance">4130</div>
		</wicket:panel></wicket:container>
...


		<form wicket:id="form" id="formb16" wicketpath="form" method="post" action="?wicket:interface=:44:form::IFormSubmitListener::" _lpchecked="1"><div style="width:0px;height:0px;position:absolute;left:-100px;top:-100px;overflow:hidden"><input type="hidden" name="formb16_hf_0" id="formb16_hf_0"></div>
					<div class="sku-info" wicket:id="source-description" wicketpath="form_source_0_source-description">MPO_Vend1</div>
					<div style="display: inline-block;">
						<div class="receipt-line">

/ rij van columns, 	 onderaan	,
0		/ Advice
100	 / Planned receipts
							<div class="projection receipt" wicket:id="planned-receipts" wicketpath="form_source_0_planned-receipts_2">
								<div wicket:id="planned-qty-editor" id="planned_qty_editorb17" wicketpath="form_source_0_planned-receipts_2_planned-qty-editor"><wicket:border>
									<wicket:body wicketpath="form_source_0_planned-receipts_2_planned-qty-editor___body">
										<div class="advice" wicket:id="advice-qty" wicketpath="form_source_0_planned-receipts_2_planned-qty-editor_advice-qty">0</div>
										<input wicket:id="planned-qty" size="2" value="0" name="source:0:planned-receipts:2:planned-qty-editor:planned-qty" id="planned_qtyb18" wicketpath="form_source_0_planned-receipts_2_planned-qty-editor_planned-qty" class="adviced" onchange="var wcall=wicketAjaxPost('?wicket:interface=:44:form:source:0:planned-receipts:2:planned-qty-editor:planned-qty::IBehaviorListener:1:', wicketSerialize(Wicket.$('planned_qtyb18')),function() { }.bind(this),function() { }.bind(this), function() {return Wicket.$('planned_qtyb18') != null;}.bind(this));">	/ (**)
								</wicket:body> </wicket:border></div>
							</div>


/ See (*) en (**)

$ vi EditingReplenishmentAdvicePage.html

		<div wicket:id="timeline"></div>
		<div wicket:id="sku"></div>
		<form wicket:id="form">


$ vi EditingReplenishmentAdvicePage.java

		add(new TimeLinePanel("timeline", projectionProperties) {

		skuLinePanel = new SkuLinePanel("sku", stockKeepingUnit, projectionProperties) {

		final Form<?> myForm = new Form<Object>("form");

$ vi SkuLinePanel.html
		<div class="projection" wicket:id="projection">
			<wicket:container wicket:id="projectionInfo" />
		</div>


$ vi SkuLinePanel.java

	protected void onInitialize() {
			protected void loadProjections() {
				List<StockProjection> list = stockProjectionService.get(sku.getObject(), projectionProperties, getTemporaryStockTransactions());
				projections = new HashMap<ProjectionPeriod, StockProjection>();
				for (StockProjection proj : list) {
					projections.put(proj.getPeriod(), proj);
				}
			}
		};

		add(new SkuInfoPanel("skuInfo", sku));
		ListView<ProjectionPeriod> myProjectionView = new ListView<ProjectionPeriod>("projection",			<-
				new PropertyModel<List<ProjectionPeriod>>(projectionProperties, "periods")) {
			@Override
			protected void populateItem(final ListItem<ProjectionPeriod> aProjectionItem) {
				final IModel<StockProjection> projModel = Model.of(stockProjections.getObject().get(aProjectionItem.getModelObject()));
				aProjectionItem.add(new ProjectionPanel("projectionInfo", projModel, sku.getObject()));		<-

$ vi ProjectionPanel.java
	public ProjectionPanel(String aId, IModel<StockProjection> aModel, StockKeepingUnit aSku) {
		NumberLabel myIn = new NumberLabel("stock-in", "#.##", model.getObject().getTotalIn());
		addCssClass(myIn, model.getObject().isHasIgnoredIn(), "ignoredBalance");
		addCssClass(myIn, sku.isValid(), "invalid-sku");
		add(myIn);

/ we gaan debug	,



/s
SkuLinePanel$2.populateItem(ListItem<ProjectionPeriod>) line: 97		/ SkuLinePanel$2=ListView	,	
/=
		ListView<ProjectionPeriod> myProjectionView = new ListView<ProjectionPeriod>("projection",
				new PropertyModel<List<ProjectionPeriod>>(projectionProperties, "periods")) {
			@Override
			protected void populateItem(final ListItem<ProjectionPeriod> aProjectionItem) {
				final IModel<StockProjection> projModel = Model.of(stockProjections.getObject().get(aProjectionItem.getModelObject()));
/s
SkuLinePanel$1.getObject() line: 66										/ AbstractReadOnlyModel	,	
					loadProjections();
/s
SkuLinePanel$1.getObject() line: 66	
				List<StockProjection> list = stockProjectionService.get(sku.getObject(), projectionProperties,
						getTemporaryStockTransactions());

this	SkuLinePanel$1  (id=47149)			
	projections	null	
	this$0	EditingReplenishmentAdvicePage$2  (id=47151) 	
		children	MarkupContainer$ChildList  (id=48093)	
			childs	Object[3]  (id=48215)	
				[0]	SkuInfoPanel  (id=48216)	
				[1]	SkuLinePanel$2  (id=47150)	
			modCount	0	
			size	2	
		data	null	
		flags	1153458330	
		generatedMarkupId	-1	
		id	"sku" (id=48094)	
		markupHelper	null	
		markupIndex	-1	
		markupStream	null	
		parent	EditingReplenishmentAdvicePage  (id=48095)	
		projectionProperties	ProjectionProperties  (id=48096)	
			end	DateTime  (id=48340)	
2016-08-24T14:49:14.354+02:00
			noOfPeriods	60	
			originalStart	DateTime  (id=48341)	
2016-03-20T14:49:14.354+01:00
			periods	ArrayList  (id=48342)	
[[2016-03-20T00:00:00.000+01:00, 2016-03-21T00:00:00.000+01:00), [2016-03-21T00:00:00.000+01:00, 2016-03-22T00:00:00.000+01:00), [2016-03-22T00:00:00.000+01:00, 2016-03-23T00:00:00.000+01:00), [2016-03-23T00:00:00.000+01:00, 2016-03-24T00:00:00.000+01:00), [2016-03-24T00:00:00.000+01:00, 2016-03-25T00:00:00.000+01:00), [2016-03-25T00:00:00.000+01:00, 2016-03-26T00:00:00.000+01:00), [2016-03-26T00:00:00.000+01:00, 2016-03-27T00:00:00.000+01:00), [2016-03-27T00:00:00.000+01:00, 2016-03-28T00:00:00.000+02:00), [2016-03-28T00:00:00.000+02:00, 2016-03-29T00:00:00.000+02:00), [2016-03-29T00:00:00.000+02:00, 2016-03-30T00:00:00.000+02:00), [2016-03-30T00:00:00.000+02:00, 2016-03-31T00:00:00.000+02:00), [2016-03-31T00:00:00.000+02:00, 2016-04-01T00:00:00.000+02:00), [2016-04-01T00:00:00.000+02:00, 2016-04-02T00:00:00.000+02:00), [2016-04-02T00:00:00.000+02:00, 2016-04-03T00:00:00.000+02:00), [2016-04-03T00:00:00.000+02:00, 2016-04-04T00:00:00.000+02:00), [2016-04-04T00:00:00.000+02:00, 2016-04-05T00:00:00.000+02:00), [2016-04-05T00:00:00.000+02:00, 2016-04-06T00:00:00.000+02:00), [2016-04-06T00:00:00.000+02:00, 2016-04-07T00:00:00.000+02:00), [2016-04-07T00:00:00.000+02:00, 2016-04-08T00:00:00.000+02:00), [2016-04-08T00:00:00.000+02:00, 2016-04-09T00:00:00.000+02:00), [2016-04-09T00:00:00.000+02:00, 2016-04-10T00:00:00.000+02:00), [2016-04-10T00:00:00.000+02:00, 2016-04-11T00:00:00.000+02:00), [2016-04-11T00:00:00.000+02:00, 2016-04-12T00:00:00.000+02:00), [2016-04-12T00:00:00.000+02:00, 2016-04-13T00:00:00.000+02:00), [2016-04-13T00:00:00.000+02:00, 2016-04-14T00:00:00.000+02:00), [2016-04-14T00:00:00.000+02:00, 2016-04-15T00:00:00.000+02:00), [2016-04-15T00:00:00.000+02:00, 2016-04-16T00:00:00.000+02:00), [2016-04-16T00:00:00.000+02:00, 2016-04-17T00:00:00.000+02:00), [2016-04-17T00:00:00.000+02:00, 2016-04-18T00:00:00.000+02:00), [2016-04-18T00:00:00.000+02:00, 2016-04-19T00:00:00.000+02:00), [2016-04-19T00:00:00.000+02:00, 2016-04-20T00:00:00.000+02:00), [2016-04-20T00:00:00.000+02:00, 2016-04-21T00:00:00.000+02:00), [2016-04-21T00:00:00.000+02:00, 2016-04-22T00:00:00.000+02:00), [2016-04-22T00:00:00.000+02:00, 2016-04-23T00:00:00.000+02:00), [2016-04-23T00:00:00.000+02:00, 2016-04-24T00:00:00.000+02:00), [2016-04-24T00:00:00.000+02:00, 2016-04-25T00:00:00.000+02:00), [2016-04-25T00:00:00.000+02:00, 2016-04-26T00:00:00.000+02:00), [2016-04-26T00:00:00.000+02:00, 2016-04-27T00:00:00.000+02:00), [2016-04-27T00:00:00.000+02:00, 2016-04-28T00:00:00.000+02:00), [2016-04-28T00:00:00.000+02:00, 2016-04-29T00:00:00.000+02:00), [2016-04-29T00:00:00.000+02:00, 2016-04-30T00:00:00.000+02:00), [2016-04-30T00:00:00.000+02:00, 2016-05-01T00:00:00.000+02:00), [2016-05-01T00:00:00.000+02:00, 2016-05-02T00:00:00.000+02:00), [2016-05-02T00:00:00.000+02:00, 2016-05-03T00:00:00.000+02:00), [2016-05-03T00:00:00.000+02:00, 2016-05-04T00:00:00.000+02:00), [2016-05-04T00:00:00.000+02:00, 2016-05-05T00:00:00.000+02:00), [2016-05-05T00:00:00.000+02:00, 2016-05-06T00:00:00.000+02:00), [2016-05-06T00:00:00.000+02:00, 2016-05-07T00:00:00.000+02:00), [2016-05-07T00:00:00.000+02:00, 2016-05-08T00:00:00.000+02:00), [2016-05-08T00:00:00.000+02:00, 2016-05-09T00:00:00.000+02:00), [2016-05-09T00:00:00.000+02:00, 2016-05-10T00:00:00.000+02:00), [2016-05-10T00:00:00.000+02:00, 2016-05-11T00:00:00.000+02:00), [2016-05-11T00:00:00.000+02:00, 2016-05-12T00:00:00.000+02:00), [2016-05-12T00:00:00.000+02:00, 2016-05-13T00:00:00.000+02:00), [2016-05-13T00:00:00.000+02:00, 2016-05-14T00:00:00.000+02:00), [2016-05-14T00:00:00.000+02:00, 2016-05-15T00:00:00.000+02:00), [2016-05-15T00:00:00.000+02:00, 2016-05-16T00:00:00.000+02:00), [2016-05-16T00:00:00.000+02:00, 2016-05-17T00:00:00.000+02:00), [2016-05-17T00:00:00.000+02:00, 2016-05-18T00:00:00.000+02:00), [2016-05-18T00:00:00.000+02:00, 2016-05-19T00:00:00.000+02:00)]
			projectionInterval	ProjectionInterval  (id=48343)	
DAYS
			start	DateTime  (id=48341)	
2016-03-20T14:49:14.354+01:00
			zoomEnabled	false	
		sku	EntityDetachableModel  (id=48097)	
			attached	true	
			attachedVolatile	true	
			dao	BeanWrapper  (id=48106)	
			entity	StockKeepingUnit_$$_javassist_18  (id=48107)	
			systemId	27044089	
		stockProjections	SkuLinePanel$1  (id=47149)	
		stockProjectionService	$Proxy538  (id=48098)	
		this$0	EditingReplenishmentAdvicePage  (id=48095)	
		wasOpenCloseTag	false	

/s
StockProjectionServiceImpl.get(StockKeepingUnit, ProjectionProperties, Collection<StockTransaction>) line: 65	
/=
	public List<StockProjection> get(StockKeepingUnit aSku, ProjectionProperties aProperties, Collection<StockTransaction> aTempList) {

this	StockProjectionServiceImpl  (id=50229)	
aSku	StockKeepingUnit_$$_javassist_18  (id=48107)	
	handler	JavassistLazyInitializer  (id=50762)	
		target	StockKeepingUnit  (id=50818)	
			distributionStrategy	DistributionStrategy  (id=50829)	
			goodsStatus	GoodsStatus_$$_javassist_56  (id=50830)	
			leadTime	Period  (id=50831)	
P2D
			lotSize	BigDecimal  (id=50832)	
20.00000
			maxStockLevel	BigDecimal  (id=50833)	
45.00000
			minStockLevel	BigDecimal  (id=50841)	
15.00000
			organization	Organization  (id=50842)	
SystemId:12000	Id:LOG_EMEA_FR_CT_PSA	Description:Organization for PSA CT
			performanceMonitorService	null	
			product	Product_$$_javassist_14  (id=50845)	
MPO_Prod1 (27044086)
			replenishmentStrategy	ReplenishmentStrategy  (id=50847)	
TO_TARGET
			sourcingStrategy	SourcingStrategy  (id=50849)	
TO_TARGET
			stockLocation	StockLocation_$$_javassist_78  (id=50851)	
GEODIS_WHS_FR_SOCHAUX
			systemId	27044089	
			targetStockLevel	BigDecimal  (id=50853)	
			validFrom	Timestamp  (id=50855)	
			validTo	Timestamp  (id=50857)	
aProperties	ProjectionProperties  (id=48096)	
	end	DateTime  (id=48340)	
2016-08-24T14:49:14.354+02:00
	noOfPeriods	60	
	originalStart	DateTime  (id=48341)	
2016-03-20T14:49:14.354+01:00
	periods	ArrayList  (id=48342)	
[[2016-03-20T00:00:00.000+01:00, 2016-03-21T00:00:00.000+01:00), [2016-03-21T00:00:00.000+01:00, 2016-03-22T00:00:00.000+01:00), [2016-03-22T00:00:00.000+01:00, 2016-03-23T00:00:00.000+01:00), [2016-03-23T00:00:00.000+01:00, 2016-03-24T00:00:00.000+01:00), [2016-03-24T00:00:00.000+01:00, 2016-03-25T00:00:00.000+01:00), [2016-03-25T00:00:00.000+01:00, 2016-03-26T00:00:00.000+01:00), [2016-03-26T00:00:00.000+01:00, 2016-03-27T00:00:00.000+01:00), [2016-03-27T00:00:00.000+01:00, 2016-03-28T00:00:00.000+02:00), [2016-03-28T00:00:00.000+02:00, 2016-03-29T00:00:00.000+02:00), [2016-03-29T00:00:00.000+02:00, 2016-03-30T00:00:00.000+02:00), [2016-03-30T00:00:00.000+02:00, 2016-03-31T00:00:00.000+02:00), [2016-03-31T00:00:00.000+02:00, 2016-04-01T00:00:00.000+02:00), [2016-04-01T00:00:00.000+02:00, 2016-04-02T00:00:00.000+02:00), [2016-04-02T00:00:00.000+02:00, 2016-04-03T00:00:00.000+02:00), [2016-04-03T00:00:00.000+02:00, 2016-04-04T00:00:00.000+02:00), [2016-04-04T00:00:00.000+02:00, 2016-04-05T00:00:00.000+02:00), [2016-04-05T00:00:00.000+02:00, 2016-04-06T00:00:00.000+02:00), [2016-04-06T00:00:00.000+02:00, 2016-04-07T00:00:00.000+02:00), [2016-04-07T00:00:00.000+02:00, 2016-04-08T00:00:00.000+02:00), [2016-04-08T00:00:00.000+02:00, 2016-04-09T00:00:00.000+02:00), [2016-04-09T00:00:00.000+02:00, 2016-04-10T00:00:00.000+02:00), [2016-04-10T00:00:00.000+02:00, 2016-04-11T00:00:00.000+02:00), [2016-04-11T00:00:00.000+02:00, 2016-04-12T00:00:00.000+02:00), [2016-04-12T00:00:00.000+02:00, 2016-04-13T00:00:00.000+02:00), [2016-04-13T00:00:00.000+02:00, 2016-04-14T00:00:00.000+02:00), [2016-04-14T00:00:00.000+02:00, 2016-04-15T00:00:00.000+02:00), [2016-04-15T00:00:00.000+02:00, 2016-04-16T00:00:00.000+02:00), [2016-04-16T00:00:00.000+02:00, 2016-04-17T00:00:00.000+02:00), [2016-04-17T00:00:00.000+02:00, 2016-04-18T00:00:00.000+02:00), [2016-04-18T00:00:00.000+02:00, 2016-04-19T00:00:00.000+02:00), [2016-04-19T00:00:00.000+02:00, 2016-04-20T00:00:00.000+02:00), [2016-04-20T00:00:00.000+02:00, 2016-04-21T00:00:00.000+02:00), [2016-04-21T00:00:00.000+02:00, 2016-04-22T00:00:00.000+02:00), [2016-04-22T00:00:00.000+02:00, 2016-04-23T00:00:00.000+02:00), [2016-04-23T00:00:00.000+02:00, 2016-04-24T00:00:00.000+02:00), [2016-04-24T00:00:00.000+02:00, 2016-04-25T00:00:00.000+02:00), [2016-04-25T00:00:00.000+02:00, 2016-04-26T00:00:00.000+02:00), [2016-04-26T00:00:00.000+02:00, 2016-04-27T00:00:00.000+02:00), [2016-04-27T00:00:00.000+02:00, 2016-04-28T00:00:00.000+02:00), [2016-04-28T00:00:00.000+02:00, 2016-04-29T00:00:00.000+02:00), [2016-04-29T00:00:00.000+02:00, 2016-04-30T00:00:00.000+02:00), [2016-04-30T00:00:00.000+02:00, 2016-05-01T00:00:00.000+02:00), [2016-05-01T00:00:00.000+02:00, 2016-05-02T00:00:00.000+02:00), [2016-05-02T00:00:00.000+02:00, 2016-05-03T00:00:00.000+02:00), [2016-05-03T00:00:00.000+02:00, 2016-05-04T00:00:00.000+02:00), [2016-05-04T00:00:00.000+02:00, 2016-05-05T00:00:00.000+02:00), [2016-05-05T00:00:00.000+02:00, 2016-05-06T00:00:00.000+02:00), [2016-05-06T00:00:00.000+02:00, 2016-05-07T00:00:00.000+02:00), [2016-05-07T00:00:00.000+02:00, 2016-05-08T00:00:00.000+02:00), [2016-05-08T00:00:00.000+02:00, 2016-05-09T00:00:00.000+02:00), [2016-05-09T00:00:00.000+02:00, 2016-05-10T00:00:00.000+02:00), [2016-05-10T00:00:00.000+02:00, 2016-05-11T00:00:00.000+02:00), [2016-05-11T00:00:00.000+02:00, 2016-05-12T00:00:00.000+02:00), [2016-05-12T00:00:00.000+02:00, 2016-05-13T00:00:00.000+02:00), [2016-05-13T00:00:00.000+02:00, 2016-05-14T00:00:00.000+02:00), [2016-05-14T00:00:00.000+02:00, 2016-05-15T00:00:00.000+02:00), [2016-05-15T00:00:00.000+02:00, 2016-05-16T00:00:00.000+02:00), [2016-05-16T00:00:00.000+02:00, 2016-05-17T00:00:00.000+02:00), [2016-05-17T00:00:00.000+02:00, 2016-05-18T00:00:00.000+02:00), [2016-05-18T00:00:00.000+02:00, 2016-05-19T00:00:00.000+02:00)]
	projectionInterval	ProjectionInterval  (id=48343)	
DAYS
	start	DateTime  (id=48341)	
2016-03-20T14:49:14.354+01:00
	zoomEnabled	false	

		DateTime myStart = aProperties.getProjectionStart();
		DateTime myEnd = aProperties.getProjectionEnd();

		List<StockTransaction> myTransactionList = stockTransactionDAO.get(aSku, myStart.toDate(), myEnd.toDate());
myTransactionList= [
27142666/FORECAST_IN/2016-03-21 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/3500.00000/4170.00000/false,
27135199/FORECAST_IN/2016-03-21 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/4130.00000/false,
27135230/ORDER_IN/2016-03-21 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/4170.00000/false,
27142669/ORDER_IN/2016-03-21 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/3500.00000/7670.00000/false,
27135204/ORDER_IN/2016-03-21 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/4150.00000/false,
27135225/FORECAST_IN/2016-03-21 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/4150.00000/false,
27176393/FORECAST_IN/2016-03-22 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/7710.00000/false,
27176384/FORECAST_IN/2016-03-22 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/7690.00000/false,
27135221/FORECAST_IN/2016-03-22 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/7670.00000/false,
27135333/ORDER_IN/2016-03-22 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/7690.00000/false,
27176387/ORDER_IN/2016-03-22 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/7710.00000/false,
27176396/ORDER_IN/2016-03-22 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/7730.00000/false,
27135216/FORECAST_IN/2016-03-23 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/7730.00000/false,
27176326/FORECAST_IN/2016-03-23 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/7770.00000/false,
27176329/ORDER_IN/2016-03-23 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/7790.00000/false,
27135324/ORDER_IN/2016-03-23 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/7750.00000/false,
27135971/ORDER_IN/2016-03-23 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/7770.00000/false,
27135276/FORECAST_IN/2016-03-23 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/7730.00000/false,
27139943/FORECAST_IN/2016-03-24 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/7790.00000/false,
27139945/ORDER_IN/2016-03-24 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/7810.00000/false,
27142529/FORECAST_IN/2016-03-25 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/7810.00000/false,
27142532/ORDER_IN/2016-03-25 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/7830.00000/false,
27142539/FORECAST_IN/2016-03-28 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/7830.00000/false,
27142542/ORDER_IN/2016-03-28 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00000/7850.00000/false,
27176408/ORDER_IN/2016-03-29 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/100.00000/7950.00000/false,
27176405/FORECAST_IN/2016-03-29 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/100.00000/7850.00000/false,
27176495/ORDER_IN/2016-03-30 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/140.00000/8250.00000/false,
27176493/FORECAST_IN/2016-03-30 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/140.00000/8110.00000/false,
27176426/FORECAST_IN/2016-03-30 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/160.00000/7950.00000/false,
27176429/ORDER_IN/2016-03-30 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/160.00000/8110.00000/false,
27176423/FORECAST_IN/2016-04-05 00:00:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/100.00000/8350.00000/false]
/ # = 31

		for (StockTransaction myTempTransaction : aTempList) {
/ NEE
aTempList=[]

		StockTransaction myPrevious = stockTransactionDAO.getPrevious(aSku, myStart.toDate());
myPrevious=
27143052/ORDER_IN/2016-03-18 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/3500.00000/4130.00000/false

		if (myPrevious != null) {
			BigDecimal calcStockLevel = null;
			if (myPrevious.getCalculatedStockLevel() == null) {
/ NEE
			} else {
				calcStockLevel = myPrevious.getCalculatedStockLevel();
4130.00000
			myStartBalance = myStartBalance.add(calcStockLevel);

/t
SkuLinePanel$1.loadProjections() line: 85	
				List<StockProjection> list = stockProjectionService.get(sku.getObject(), projectionProperties,
						getTemporaryStockTransactions());
/d
[
StockProjection[period=[2016-03-20T00:00:00.000+01:00, 2016-03-21T00:00:00.000+01:00),balance=4130.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-03-21T00:00:00.000+01:00, 2016-03-22T00:00:00.000+01:00),balance=7670.00000,totalIn=3540.00000,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-03-22T00:00:00.000+01:00, 2016-03-23T00:00:00.000+01:00),balance=7730.00000,totalIn=60.00000,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-03-23T00:00:00.000+01:00, 2016-03-24T00:00:00.000+01:00),balance=7790.00000,totalIn=60.00000,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-03-24T00:00:00.000+01:00, 2016-03-25T00:00:00.000+01:00),balance=7810.00000,totalIn=20.00000,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-03-25T00:00:00.000+01:00, 2016-03-26T00:00:00.000+01:00),balance=7830.00000,totalIn=20.00000,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-03-26T00:00:00.000+01:00, 2016-03-27T00:00:00.000+01:00),balance=7830.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-03-27T00:00:00.000+01:00, 2016-03-28T00:00:00.000+02:00),balance=7830.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-03-28T00:00:00.000+02:00, 2016-03-29T00:00:00.000+02:00),balance=7850.00000,totalIn=20.00000,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-03-29T00:00:00.000+02:00, 2016-03-30T00:00:00.000+02:00),balance=7950.00000,totalIn=100.00000,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-03-30T00:00:00.000+02:00, 2016-03-31T00:00:00.000+02:00),balance=8250.00000,totalIn=300.00000,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-03-31T00:00:00.000+02:00, 2016-04-01T00:00:00.000+02:00),balance=8250.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-01T00:00:00.000+02:00, 2016-04-02T00:00:00.000+02:00),balance=8250.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-02T00:00:00.000+02:00, 2016-04-03T00:00:00.000+02:00),balance=8250.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-03T00:00:00.000+02:00, 2016-04-04T00:00:00.000+02:00),balance=8250.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-04T00:00:00.000+02:00, 2016-04-05T00:00:00.000+02:00),balance=8250.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-05T00:00:00.000+02:00, 2016-04-06T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=100.00000,totalOutForecast=0], 
StockProjection[period=[2016-04-06T00:00:00.000+02:00, 2016-04-07T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-07T00:00:00.000+02:00, 2016-04-08T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-08T00:00:00.000+02:00, 2016-04-09T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-09T00:00:00.000+02:00, 2016-04-10T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-10T00:00:00.000+02:00, 2016-04-11T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-11T00:00:00.000+02:00, 2016-04-12T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-12T00:00:00.000+02:00, 2016-04-13T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-13T00:00:00.000+02:00, 2016-04-14T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-14T00:00:00.000+02:00, 2016-04-15T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-15T00:00:00.000+02:00, 2016-04-16T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-16T00:00:00.000+02:00, 2016-04-17T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-17T00:00:00.000+02:00, 2016-04-18T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-18T00:00:00.000+02:00, 2016-04-19T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-19T00:00:00.000+02:00, 2016-04-20T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-20T00:00:00.000+02:00, 2016-04-21T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-21T00:00:00.000+02:00, 2016-04-22T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-22T00:00:00.000+02:00, 2016-04-23T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-23T00:00:00.000+02:00, 2016-04-24T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-24T00:00:00.000+02:00, 2016-04-25T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-25T00:00:00.000+02:00, 2016-04-26T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-26T00:00:00.000+02:00, 2016-04-27T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-27T00:00:00.000+02:00, 2016-04-28T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-28T00:00:00.000+02:00, 2016-04-29T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-29T00:00:00.000+02:00, 2016-04-30T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-04-30T00:00:00.000+02:00, 2016-05-01T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-05-01T00:00:00.000+02:00, 2016-05-02T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-05-02T00:00:00.000+02:00, 2016-05-03T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-05-03T00:00:00.000+02:00, 2016-05-04T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-05-04T00:00:00.000+02:00, 2016-05-05T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-05-05T00:00:00.000+02:00, 2016-05-06T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-05-06T00:00:00.000+02:00, 2016-05-07T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-05-07T00:00:00.000+02:00, 2016-05-08T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-05-08T00:00:00.000+02:00, 2016-05-09T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-05-09T00:00:00.000+02:00, 2016-05-10T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-05-10T00:00:00.000+02:00, 2016-05-11T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-05-11T00:00:00.000+02:00, 2016-05-12T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-05-12T00:00:00.000+02:00, 2016-05-13T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-05-13T00:00:00.000+02:00, 2016-05-14T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-05-14T00:00:00.000+02:00, 2016-05-15T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-05-15T00:00:00.000+02:00, 2016-05-16T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-05-16T00:00:00.000+02:00, 2016-05-17T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-05-17T00:00:00.000+02:00, 2016-05-18T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0], 
StockProjection[period=[2016-05-18T00:00:00.000+02:00, 2016-05-19T00:00:00.000+02:00),balance=8350.00000,totalIn=0,totalOut=0,totalInForecast=0,totalOutForecast=0]]
/ Deze zien we op het scherm	,

/ we zijn nog in	,
SkuLinePanel$1.loadProjections() line: 85	
				projections = new HashMap<ProjectionPeriod, StockProjection>();
				for (StockProjection proj : list) {
					projections.put(proj.getPeriod(), proj);

/ Einde SQL PSA-422 STOCK REPLENISHMENT FORECAST 

/ DEBUG PSA-422 STOCK REPLENISHMENT FORECAST 

/ we zijn op replenishment screen	, mpo_Prod1	, 30-Mar , we geven onderin extra 100	, 
/s
	SkuLinePanel$2(ListView).onPopulate() line: 562	
/s
	SkuLinePanel$2.populateItem(ListItem<ProjectionPeriod>) line: 97	
/s
	SkuLinePanel$1.getObject() line: 66	
/s
	SkuLinePanel$1.getObject() line: 77	
/s
	SkuLinePanel$1.loadProjections() line: 83	
				List<StockProjection> list = stockProjectionService.get(sku.getObject(), projectionProperties,
						getTemporaryStockTransactions());
/s
	EditingReplenishmentAdvicePage$2.getTemporaryStockTransactions() line: 329	
/=
		skuLinePanel = new SkuLinePanel("sku", stockKeepingUnit, projectionProperties) {
			@Override
			protected Collection<StockTransaction> getTemporaryStockTransactions() {
				return EditingReplenishmentAdvicePage.this.getTemporaryStockTransactions();
/s
	EditingReplenishmentAdvicePage.getTemporaryStockTransactions() line: 526	
/=
	protected Collection<StockTransaction> getTemporaryStockTransactions() {
		List<StockTransaction> myTemp = new ArrayList<StockTransaction>();
		for (Map<ProjectionPeriod, AdviceView> myLocationAdvice : advices.getObject().values()) {

			for (Entry<ProjectionPeriod, AdviceView> myAdvice : myLocationAdvice.entrySet()) {
				AdviceView myView = myAdvice.getValue();
				if (myView.hasChangedQty()) {
					StockTransaction myFromTransaction = new StockTransaction();
					if (myView.getNewForecastQty() != null) {
						if (myView.getCurrentForecastQty() != null) {
							myFromTransaction.setQuantity(myView.getNewForecastQty().subtract(myView.getCurrentForecastQty()));
/s
	StockTransaction.setQuantity(BigDecimal) line: 242	
/=
	public void setQuantity(BigDecimal quantity) {
		this.quantity = quantity;
100	, 
/ hebben we zojuist ingevuld	,

/ 7	. 

/ we geven onderin 120	, 

/ customerorderline=FC In
/ In= op shipment order	,

/ stack trace	,
/s
	StockTransaction.setQuantity(BigDecimal) line: 242	
	StockTransactionServiceImpl.createTransaction(CustomerOrderLine, StockKeepingUnit, StockTransactionType, Date, BigDecimal) line: 686	
	StockTransactionServiceImpl.createForShipTo(CustomerOrderLine) line: 642	
	StockTransactionServiceImpl.handleCustomerOrderLineUpdate(CustomerOrderLine) line: 970	
	StockTransactionServiceImpl.handleCustomerOrderCreated(CustomerOrderEvent) line: 170	
	StockTransactionEventListener.handle(CustomerOrderEvent) line: 79	
	StockTransactionEventListener.handleEvent(Event<?>) line: 53	
	ListenerList.fireEvent(Event<?>) line: 82	
	EventHandlerServiceImpl.handleEvent(Event) line: 109	
	CustomerOrderServiceImpl.triggerEventHandler(CustomerOrder, CustomerOrder, TMSEventContext, boolean) line: 582	
	CustomerOrderServiceImpl.create(CustomerOrder, boolean, boolean, TMSEventContext) line: 169	
	CustomerOrderServiceImpl.create(CustomerOrder, boolean, boolean) line: 135	
	CustomerOrderServiceImpl.create(CustomerOrder) line: 125	
	ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).executeReplenishmentAdvice(ReplenishmentAdvice, CustomerOrderReplenishServiceImpl$CustomerOrderReplenishState, ReplenishmentFeedBack) line: 355	
	ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).executeReplenishmentAdvice(Collection<ReplenishmentAdvice>, ProgressMonitor) line: 114	   EditingReplenishmentAdvicePage.processAdvice() line: 794	
	EditingReplenishmentAdvicePage$7.onSubmit(AjaxRequestTarget, Form<?>) line: 424	
	AjaxButton$1.onSubmit(AjaxRequestTarget) line: 101	
	AjaxButton$1(AjaxFormSubmitBehavior).onEvent(AjaxRequestTarget) line: 156	
	AjaxButton$1(AjaxEventBehavior).respond(AjaxRequestTarget) line: 177	
	AjaxButton$1(AbstractDefaultAjaxBehavior).onRequest() line: 312	
	BehaviorRequestTarget.processEvents(RequestCycle) line: 157	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/ we debug	,
/s
StockTransactionServiceImpl.handleCustomerOrderCreated(CustomerOrderEvent) line: 170	
/=
	public void handleCustomerOrderCreated(CustomerOrderEvent aEvent) {
customerorder.created, context [id/value: 343983239/63]]  old [null] new [CO000003001] 
		CustomerOrder myNew = customerOrderDAO.getBySystemId(aEvent.getNewCustomerOrder().getSystemId());
CO000003001
		for (CustomerOrderLine myLine : myNew.getCustomerOrderLineSet()) {
			handleCustomerOrderLineUpdate(myLine);
/s
StockTransactionServiceImpl.handleCustomerOrderLineUpdate(CustomerOrderLine) line: 970	
/=
	private void handleCustomerOrderLineUpdate(CustomerOrderLine aNewLine) {
...
			createForShipTo(aNewLine);
/s
StockTransactionServiceImpl.createForShipTo(CustomerOrderLine) line: 642	
		Map<StockKeepingUnit, BigDecimal> mySkuList = getStockKeepingUnit(aLine.getToPartyVO(), aLine.getProduct(), aLine.getGoodsStatus(), aLine);
mySkuList[0].product=MPO_Box1 (27044087)
/ TODO
		for (Entry<StockKeepingUnit, BigDecimal> myEntry : mySkuList.entrySet()) {
			createTransaction(aLine, myEntry.getKey(), StockTransactionType.FORECAST_IN, aLine.getDateSetVO().getEndDate(), myEntry.getValue());
/s
StockTransactionServiceImpl.createTransaction(CustomerOrderLine, StockKeepingUnit, StockTransactionType, Date, BigDecimal) line: 686	
aItem	CustomerOrderLine  (id=31618)	
CUSTOMER_ORDER_LINE id:COL00001994(systemId:27309316)
aBomQty	BigDecimal  (id=31622)	
1
		Validate.notNull(aTransactionDate, "No transaction date");
		StockTransaction myTransaction = new StockTransaction();
		myTransaction.setCustomerOrderLine(aItem);

		myTransaction.setStockLocation(aStockKeepingUnit.getStockLocation());
		myTransaction.setDirty(true);

		myTransaction.setProduct(aStockKeepingUnit.getProduct());
		myTransaction.setGoodsStatus(aStockKeepingUnit.getGoodsStatus());
		myTransaction.setTransactionDate(aTransactionDate);
		myTransaction.setTransactionType(aType);
		// The stock decreases at the ship-from location
		BigDecimal myProductItemQty = aType.equals(StockTransactionType.FORECAST_OUT) || aType.equals(StockTransactionType.ORDER_OUT)
				? aItem.getQuantity().negate() : aItem.getQuantity();
		myTransaction.setQuantity(myProductItemQty.multiply(aBomQty));
/s
StockTransaction.setQuantity(BigDecimal) line: 242	
quantity 12

/ 7	. 

/ we hadden de appl opnieuw start	,
/ Als we een quantity add	, wordt er een nieuwe co, sho create	, 
/ de volgende keren als we een quantity add worden deze consolidate	op dezelfde co, sho	,

/ 7	. 

/ stack trace	,
/s
	ProductItemVO.<init>() line: 167	
	ProductItemServiceImpl.create(CustomerOrderLine, BigDecimal) line: 137	
	ShipmentOrderServiceImpl.addCustomerOrderLine(ShipmentOrderVO, CustomerOrderLine, int) line: 232	
	ShipmentOrderConsolidationServiceImpl.addCustomerOrderLine(GridTemplate, ShipmentOrderVO, CustomerOrderLine) line: 247	
	ShipmentOrderConsolidationServiceImpl.consolidateSingleLine(CustomerOrderLine, ShipmentOrderConsolidationServiceImpl$ConsolidationState) line: 306	
	ShipmentOrderConsolidationServiceImpl.consolidate(Collection<CustomerOrderLine>) line: 118	
	ForecastServiceImpl.freeze(CustomerOrder, boolean) line: 134	
	ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).executeReplenishmentAdvice(ReplenishmentAdvice, CustomerOrderReplenishServiceImpl$CustomerOrderReplenishState, ReplenishmentFeedBack) line: 360	
	ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).executeReplenishmentAdvice(Collection<ReplenishmentAdvice>, ProgressMonitor) line: 114	   EditingReplenishmentAdvicePage.processAdvice() line: 794	
	EditingReplenishmentAdvicePage$7.onSubmit(AjaxRequestTarget, Form<?>) line: 424	
	AjaxButton$1.onSubmit(AjaxRequestTarget) line: 101	
	AjaxButton$1(AjaxFormSubmitBehavior).onEvent(AjaxRequestTarget) line: 156	
	AjaxButton$1(AjaxEventBehavior).respond(AjaxRequestTarget) line: 177	
	AjaxButton$1(AbstractDefaultAjaxBehavior).onRequest() line: 312	
	BehaviorRequestTarget.processEvents(RequestCycle) line: 157	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/ debug	,

ShipmentOrderServiceImpl.addCustomerOrderLine(ShipmentOrderVO, CustomerOrderLine, int) line: 232	
/=
	public void addCustomerOrderLine(ShipmentOrderVO aShipmentOrderVO, CustomerOrderLine line, int quantity) {
ShipmentOrder: SH000001127(SystemId:26879361; Org:LOG_EMEA_FR_CT_PSA)
CUSTOMER_ORDER_LINE id:COL00002005(systemId:27309329)
quantity	80	
				if (quantity > 0) {
					ProductItemVO myItem = productItemService.create(line, new BigDecimal(quantity));
					aShipmentOrderVO.addProductItem(myItem);
					productItemService.save(myItem);
					customerOrderLineService.updateOpenQuantity(line);

/ we gaan deze lines debug	, 
					ProductItemVO myItem = productItemService.create(line, new BigDecimal(quantity));
/s
ProductItemServiceImpl.create(CustomerOrderLine, BigDecimal) line: 140	
		ProductItemVO myItem = new ProductItemVO();
		myItem.setProductVO(aLine.getProduct());
		myItem.setGoodsStatus(aLine.getGoodsStatus());
		myItem.setQuantity(quantity);
80
		setProductItemDetails(aLine.getProduct(), myItem, quantity);
		myItem.setCustomerOrderLine(aLine);
		myItem.setOriginalCustomerOrderLineId(aLine.getCustomerOrderLineId());
		myItem.setOriginalCustomerOrderId(aLine.getCustomerOrder().getCustomerOrderNumber());
		entityDetailService.initialize(myItem);
/s
EntityDetailServiceImpl.initialize(EntityDetailSupport) line: 126	
/ NIETS	, 
/ de product item heeft geen entity details	,
/t
		if (aLine.getProduct() != null) {
			myItem.setDescription(aLine.getProduct().getDescription());
		}
		aLine.addProductItem(myItem);
/s
...
		linkedProductItemSet.add(productItem);
/ 1 product item, deze	, 
/ Waar zijn de vorigen?
/ TODO
/t
		return myItem;
/t
ShipmentOrderServiceImpl.addCustomerOrderLine(ShipmentOrderVO, CustomerOrderLine, int) line: 233	
					ProductItemVO myItem = productItemService.create(line, new BigDecimal(quantity));
					aShipmentOrderVO.addProductItem(myItem);
theProductItemList=
[PRODUCT_ITEM id:null(systemId:26880433), 
PRODUCT_ITEM id:null(systemId:26880434), 
PRODUCT_ITEM id:null(systemId:26880435), 
PRODUCT_ITEM id:null(systemId:26880436)]
					productItemService.save(myItem);
					customerOrderLineService.updateOpenQuantity(line);
/s
CustomerOrderLineServiceImpl.updateOpenQuantity(CustomerOrderLine) line: 228	
/=
	public void updateOpenQuantity(CustomerOrderLine line) {

line	CustomerOrderLine  (id=22956)	
	linkedProductItemSet	PersistentSet  (id=23573)	
[PRODUCT_ITEM id:null(systemId:26880436)]

			BigDecimal totalQuantity = BigDecimal.ZERO;
			for (ProductItemVO productItem : line.getLinkedProductItemSet()) {
				if (productItem.getActualQuantity() != null) {
/= theQuantity
/ NEE
					totalQuantity = totalQuantity.add(productItem.getActualQuantity());
/ NIET
				} else if (productItem.getQuantity() != null) {
/ JA
80.00
					totalQuantity = totalQuantity.add(productItem.getQuantity());
80.00
				}
			}
			if (line.getQuantity() != null) {
/=quantity
80
				line.setOpenQuantity(line.getQuantity().subtract(totalQuantity));
/=openQuantity	, 
/ WAS 80, NU 0.00
			} else {
/ NEE
				line.setOpenQuantity(BigDecimal.ZERO.subtract(totalQuantity));
/ NIET

			customerOrderLineDao.save(line);
/t
ShipmentOrderServiceImpl.addCustomerOrderLine(ShipmentOrderVO, CustomerOrderLine, int) line: 242	
					customerOrderLineService.updateOpenQuantity(line);
/d
		packNewProductItems(aShipmentOrderVO);

/ 7	. 

ProductItemVO.getActualQuantity() is called door	,
	public class CustomerOrderLineServiceImpl implements CustomerOrderLineService {
		public void updateOpenQuantity(CustomerOrderLine line) {
	public class ProductItemServiceImpl extends ShipmentOrderChildService<ProductItemVO, ProductItemDAO> implements Serializable, ProductItemService {
		private ProductItemVO updateActualsForProductItem(ProductItemVO aProdItem) {
	public class CustomerOrderLine extends LogisticsOrderVO implements ReferenceSupport, BinaryContainer {
		public BigDecimal getTotalLinkedQuantity(ProductItemVO aExcluding) {
	public class CustomerOrderLine extends LogisticsOrderVO implements ReferenceSupport, BinaryContainer {
		public BigDecimal getTotalLinkedQuantity() {
		public BigDecimal getTotalLinkedQuantity() {
		public BigDecimal get(Object key) {
		public Map<ProductItemVO, BigDecimal> getCurrentLinkedQuantity() {

	public class ProductItemProcessor extends XMLProcessor {
		public void generate(Node aNode, ProductItemVO anItemVO) throws ShipmentItemException {

ProductItemVO.setActualQuantity() is called door	,
	public class ProductItemProcessor extends XMLProcessor {
		public ProductItemVO process(Node aNode, ShipmentOrderVO myShipmentOrderVO) throws ShipmentItemException {
	public class ProductItemServiceImpl extends ShipmentOrderChildService<ProductItemVO, ProductItemDAO> implements Serializable, ProductItemService {
		private ProductItemVO updateActualsForProductItem(ProductItemVO aProdItem) {

/ 7	. 

/ we hadden 'Save Forcast' clicked	, op replenishment screen	,

/ stack trace

/ s
	StockTransaction.setQuantity(BigDecimal) line: 242	
	StockTransactionDAOImpl.getPrevious(StockTransaction) line: 253	
	StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 153	
	StockLevelCalculationServiceImpl.recalculate(Product, StockLocation, GoodsStatus) line: 134	
	StockLevelCalculationServiceImpl.recalculate(StockKeepingUnit) line: 70	
	EditingReplenishmentAdvicePage.processAdvice() line: 795	
			stockLevelCalculationService.recalculate(stockKeepingUnit.getObject());

	EditingReplenishmentAdvicePage$7.onSubmit(AjaxRequestTarget, Form<?>) line: 424	
				processAdvice();

	AjaxButton$1.onSubmit(AjaxRequestTarget) line: 101	
	AjaxButton$1(AjaxFormSubmitBehavior).onEvent(AjaxRequestTarget) line: 156	
	AjaxButton$1(AjaxEventBehavior).respond(AjaxRequestTarget) line: 177	
	AjaxButton$1(AbstractDefaultAjaxBehavior).onRequest() line: 312	
	BehaviorRequestTarget.processEvents(RequestCycle) line: 157	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/c
/s
	StockTransaction.setQuantity(BigDecimal) line: 242	
	StockTransactionDAOImpl.getFirstDirty(Product, StockLocation, GoodsStatus) line: 157	
	StockLevelCalculationServiceImpl.recalculate(Product, StockLocation, GoodsStatus) line: 130	
	StockLevelCalculationServiceImpl.recalculate(StockKeepingUnit) line: 70	
	StockLevelCalculationServiceImpl.handleRequest(StockLevelCalculationRequest) line: 63	
	StockTransactionHandlerImpl.processMessageAsRoot(Message) line: 56	
	StockTransactionHandlerImpl(AbstractConsumer).onMessage(Message) line: 49	

/c
/s
	StockTransaction.setQuantity(BigDecimal) line: 242	
	StockTransactionDAOImpl.get(StockKeepingUnit, Date, Date) line: 57	
	StockProjectionServiceImpl.get(StockKeepingUnit, ProjectionProperties, Collection<StockTransaction>) line: 68	
	StockProjectionServiceImpl.get(StockKeepingUnit, ProjectionProperties) line: 59	
	EditingReplenishmentAdvicePage.getAdviceList() line: 454	
	EditingReplenishmentAdvicePage.initializeModel() line: 555	
	EditingReplenishmentAdvicePage.processAdvice() line: 814	
			stockLevelCalculationService.recalculate(stockKeepingUnit.getObject());
/ ZONET
		initializeModel();
/ NU
	EditingReplenishmentAdvicePage$7.onSubmit(AjaxRequestTarget, Form<?>) line: 424	
	AjaxButton$1.onSubmit(AjaxRequestTarget) line: 101	
	AjaxButton$1(AjaxFormSubmitBehavior).onEvent(AjaxRequestTarget) line: 156	
	AjaxButton$1(AjaxEventBehavior).respond(AjaxRequestTarget) line: 177	
	AjaxButton$1(AbstractDefaultAjaxBehavior).onRequest() line: 312	
	BehaviorRequestTarget.processEvents(RequestCycle) line: 157	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/c
/ stack trace	,

/ Hoe komen we hier	?
/ Dit is NIET als we op het sho scherm een product item save	,
/ WH dit is click 'Save Forecast' op replenish scherm	,
/ TODO

/s
	StockTransaction.setQuantity(BigDecimal) line: 242	
	StockTransactionServiceImpl.createTransaction(ProductItemVO, StockKeepingUnit, StockTransactionType, Date, BigDecimal) line: 706	
	StockTransactionServiceImpl.createTransaction(ProductItemVO, StockTransactionServiceImpl$StockTXData) line: 727	
->	StockTransactionServiceImpl.handleProductItemUpdated(ProductItemEvent) line: 320	
	StockTransactionEventListener.handle(ProductItemEvent) line: 109	
		} else if (anEvent.getEventType().equals(ProductItemEvent.UPDATED)) {
			stockTransactionService.handleProductItemUpdated(anEvent);

	StockTransactionEventListener.handleEvent(Event<?>) line: 47	
		boolean stockTransactionsEnabled = ApplicationPropertyManager.getInstance().getModuleProperty("inventory", "enable.stock.transactions", true);
true
		if (stockTransactionsEnabled) {
			} else if (anEvent.getEventType().startsWith(ProductItemEvent.PREFIX)) {
anEvent=productitem.updated, context [id/value: 1580961020/63]]  old [null] new [PRODUCT_ITEM id:(systemId:26880436)] 
				ProductItemEvent myEvent = (ProductItemEvent) anEvent;
				handle(myEvent);

	ListenerList.fireEvent(Event<?>) line: 82	
[com.mpobjects.document.model.eventhandler.util.DocumentEventListener,
 com.mpobjects.oms.model.eventhandler.util.CustomerOrderEventListener,
 com.mpobjects.oms.service.shipmentordercostpart.ShoCostAllocationEventListener,
 com.mpobjects.oms.service.shipmentorderprice.ShoPriceAllocationServiceImpl,
 com.mpobjects.omscarcon.model.eventhandler.util.TMSCarConServiceOrderEventListener,
 com.mpobjects.invoice.model.eventhandler.util.SupplierInvoiceUpdateEventListener,
 com.mpobjects.event.service.DeferredEventServiceImpl@682a179,
 com.mpobjects.event.event.model.util.EventEventListener,
 com.mpobjects.oms.ratecalc.model.eventhandler.util.AllocationEventListener,
 com.mpobjects.inventory.service.stocktransaction.StockTransactionEventListener,			<-
 com.mpobjects.capabletopromise.model.eventhandler.util.CapableToPromiseEventListener,
 com.mpobjects.customerinvoice.model.eventhandler.util.CustomerInvoiceUpdateEventListener,
 com.mpobjects.invoice.model.service.InvoiceServiceOrderEventHandler@13f1709f,
 com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener]

	EventHandlerServiceImpl.handleEvent(Event) line: 109	
			listenerList.fireEvent(anEvent);

	ProductItemServiceImpl.fireProductItemEvent(ProductItemEvent) line: 272	
			eventHandlerService.handleEvent(anEvent);

	ProductItemServiceImpl.save(ProductItemVO, boolean, boolean) line: 530	
			fireProductItemEvent(myEvent);

	ProductItemServiceImpl.save(ProductItemVO, boolean) line: 495	

	ProductItemCalculationServiceImpl.update(ProductItemVO, AlternativeResultSet, List<String>, boolean) line: 276	
	RateCalculationVO.applyCorrections(AlternativeResultSet, List<String>, boolean) line: 1038	
	RateCalculationVO.applyCorrections(AlternativeResultSet, List<String>) line: 986	
	RateCalculationVO.runFor(List<RateAgreementVO>) line: 827	
	CalculationServiceImpl.recalculate(LogisticsOrderVO, AgreementType, TMSEventContext) line: 585	
	RateCalcEventListener.recalculate(ShipmentOrderVO, AgreementType, TMSEventContext) line: 396	
	RateCalcEventListener.recalcShipOrderPrice(Event) line: 98	
	RateCalcEventListener.handleEvent(Event) line: 79	
	ListenerList.fireEvent(Event<?>) line: 82	
	EventHandlerServiceImpl.handleEvent(Event) line: 109	
	ShipmentOrderServiceImpl.triggerEventHandler(ShipmentOrderVO, ShipmentOrderVO, TMSEventContext) line: 2645	
	ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 2076	
	ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderVO, boolean) line: 1977	
	ShipmentOrderServiceImpl.recalculateShipmentOrder(ShipmentOrderVO, boolean) line: 1299	
	ShipmentOrderServiceImpl.recalculateShipmentOrder(ShipmentOrderVO) line: 1288	
	ProductItemServiceImpl(ShipmentOrderChildService).recalculateShipmentOrder(ShipmentOrderVO) line: 20	
	ProductItemServiceImpl.save(ProductItemVO, boolean, boolean) line: 522	
	ProductItemServiceImpl.save(ProductItemVO, boolean) line: 495	
	ProductItemServiceImpl.save(ProductItemVO) line: 489	
	ProductItemServiceImpl.save(EntityInterface) line: 55	
	ShipmentOrderServiceImpl.addCustomerOrderLine(ShipmentOrderVO, CustomerOrderLine, int) line: 234	
	ShipmentOrderConsolidationServiceImpl.addCustomerOrderLine(GridTemplate, ShipmentOrderVO, CustomerOrderLine) line: 247	
	ShipmentOrderConsolidationServiceImpl.consolidateSingleLine(CustomerOrderLine, ShipmentOrderConsolidationServiceImpl$ConsolidationState) line: 306	
	ShipmentOrderConsolidationServiceImpl.consolidate(Collection<CustomerOrderLine>) line: 118	
	ForecastServiceImpl.freeze(CustomerOrder, boolean) line: 134	
	ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).executeReplenishmentAdvice(ReplenishmentAdvice, CustomerOrderReplenishServiceImpl$CustomerOrderReplenishState, ReplenishmentFeedBack) line: 360	
	ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).executeReplenishmentAdvice(Collection<ReplenishmentAdvice>, ProgressMonitor) line: 114
	EditingReplenishmentAdvicePage.processAdvice() line: 794	
	EditingReplenishmentAdvicePage$7.onSubmit(AjaxRequestTarget, Form<?>) line: 424	
	AjaxButton$1.onSubmit(AjaxRequestTarget) line: 101	
	AjaxButton$1(AjaxFormSubmitBehavior).onEvent(AjaxRequestTarget) line: 156	
	AjaxButton$1(AjaxEventBehavior).respond(AjaxRequestTarget) line: 177	
	AjaxButton$1(AbstractDefaultAjaxBehavior).onRequest() line: 312	
	BehaviorRequestTarget.processEvents(RequestCycle) line: 157	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/ debug	,
/s

/s
StockTransactionServiceImpl.handleProductItemUpdated(ProductItemEvent) line: 320	
		// First check if we should even create transactions. Based on shipment order state.
		// Updating/deleting should not matter here, because that should be handled via the shipment order update.
		if (!canCreateTransactions(anEvent.getNewVO().getShipmentOrder())) {
			return;
		}

		ProductItemVO item = anEvent.getNewVO();
		Product product = getProduct(item);

		if (product == null) {
			deleteStockTransactions(item);
			return;
		}

		Map<Product, BigDecimal> productList = null;
		List<StockTransaction> transactions = null;

		// This method is also called by handleProductItemCreated
		boolean isNewProduct = ProductItemEvent.CREATED.equals(anEvent.getEventType());
		// old vo is not set for productitem in productitemservice.save
		boolean shouldUpdate = isNewProduct || anEvent.getOldVO() == null;
		if (!shouldUpdate) {
			ProductItemVO oldItem = anEvent.getNewVO();
			shouldUpdate |= NumberUtils.compareTo(item.getQuantity(), oldItem.getQuantity()) != 0;
			shouldUpdate |= ObjectUtils.equals(product, oldItem.getProductVO());
			// FIXME: also check goods status change

			if (!product.getBillOfMaterialsList().isEmpty()) {
				transactions = stockTransactionDAO.getByProductItem(item);
				productList = productService.getProductList(product, item.getQuantity(), 1);
				// TODO: check depth for changes in qty
			}
		}

		if (!shouldUpdate) {
			return;
		}

		// Explode the bill of material
		if (transactions == null) {
			transactions = stockTransactionDAO.getByProductItem(item);
			productList = productService.getProductList(product, item.getQuantity(), 1);
		} else {
			transactions = Collections.emptyList();
			productList = Collections.emptyMap();
		}

		// Process existing transactions
		for (StockTransaction tx : transactions) {
			BigDecimal expectedQty = productList.get(tx.getProduct());
			if (expectedQty == null) {
				expectedQty = BigDecimal.ZERO;
			}
			if (StockTransactionType.ORDER_OUT.equals(tx.getTransactionType())) {
				expectedQty = expectedQty.negate();
			}
			if (NumberUtils.compareTo(expectedQty, tx.getQuantity()) != 0) {
				markNextDirty(tx);
				tx.setQuantity(expectedQty);
				tx.setDirty(true);
				stockTransactionDAO.save(tx);
			}
			// TODO: product change?
			// TODO: check SKU due to goods status
		}

		if (!transactions.isEmpty()) {
			return;
			// But what about missing transactions elements? (e.g. BOL changed, ...)
		}

		// There was no data, create new
		StockTXData outData = createStockTXData(item.getShipmentOrder(), false);
		outData.dateChanged = true;
		outData.partyChanged = true;
		createTransaction(item, outData);

		StockTXData inData = createStockTXData(item.getShipmentOrder(), true);
		inData.dateChanged = true;
		inData.partyChanged = true;
->		createTransaction(item, inData);
/ TODO

/c
/s
	CustomerOrderLineServiceImpl.updateOpenQuantity(CustomerOrderLine) line: 228	
		if (line != null) {
			BigDecimal totalQuantity = BigDecimal.ZERO;
				if (productItem.getActualQuantity() != null) {
 /NEE
					totalQuantity = totalQuantity.add(productItem.getActualQuantity());
/ NIET
				} else if (productItem.getQuantity() != null) {
/ JA
					totalQuantity = totalQuantity.add(productItem.getQuantity());
				}
			}
			if (line.getQuantity() != null) {
/ JA
				line.setOpenQuantity(line.getQuantity().subtract(totalQuantity));
			} else {
/ NEE
				line.setOpenQuantity(BigDecimal.ZERO.subtract(totalQuantity));
			}
			customerOrderLineDao.save(line);

	ShipmentOrderServiceImpl.addCustomerOrderLine(ShipmentOrderVO, CustomerOrderLine, int) line: 235	
		} else {
			try {
				if (quantity > 0) {
					ProductItemVO myItem = productItemService.create(line, new BigDecimal(quantity));
					aShipmentOrderVO.addProductItem(myItem);
					productItemService.save(myItem);
					customerOrderLineService.updateOpenQuantity(line);

	ShipmentOrderConsolidationServiceImpl.addCustomerOrderLine(GridTemplate, ShipmentOrderVO, CustomerOrderLine) line: 247	
	ShipmentOrderConsolidationServiceImpl.consolidateSingleLine(CustomerOrderLine, ShipmentOrderConsolidationServiceImpl$ConsolidationState) line: 306	
	ShipmentOrderConsolidationServiceImpl.consolidate(Collection<CustomerOrderLine>) line: 118	
	ForecastServiceImpl.freeze(CustomerOrder, boolean) line: 134	
	ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).executeReplenishmentAdvice(ReplenishmentAdvice, CustomerOrderReplenishServiceImpl$CustomerOrderReplenishState, ReplenishmentFeedBack) line: 360	
	ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).executeReplenishmentAdvice(Collection<ReplenishmentAdvice>, ProgressMonitor) line: 114	   EditingReplenishmentAdvicePage.processAdvice() line: 794	
	EditingReplenishmentAdvicePage$7.onSubmit(AjaxRequestTarget, Form<?>) line: 424	
	AjaxButton$1.onSubmit(AjaxRequestTarget) line: 101	
	AjaxButton$1(AjaxFormSubmitBehavior).onEvent(AjaxRequestTarget) line: 156	
	AjaxButton$1(AjaxEventBehavior).respond(AjaxRequestTarget) line: 177	
	AjaxButton$1(AbstractDefaultAjaxBehavior).onRequest() line: 312	
	BehaviorRequestTarget.processEvents(RequestCycle) line: 157	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/ 7		. 

/ we click op het aantal bij In	, 1080	, 
/ we zien de co's en sho's	, 2 van elk	, 
/ we open de laatste sho SH000001127	, 
/ we edit product item quantity =80	, 
/ we set actual quantity: 40.00	, Save Product Item	,
/ stack trace	,
/s
	StockTransactionServiceImpl.handleProductItemUpdated(ProductItemEvent) line: 280	
	StockTransactionEventListener.handle(ProductItemEvent) line: 109	
		} else if (anEvent.getEventType().equals(ProductItemEvent.UPDATED)) {
			stockTransactionService.handleProductItemUpdated(anEvent);

	StockTransactionEventListener.handleEvent(Event<?>) line: 47	
		boolean stockTransactionsEnabled = ApplicationPropertyManager.getInstance().getModuleProperty("inventory", "enable.stock.transactions", true);
true
		if (stockTransactionsEnabled) {
			} else if (anEvent.getEventType().startsWith(ProductItemEvent.PREFIX)) {
				ProductItemEvent myEvent = (ProductItemEvent) anEvent;
anEvent=productitem.updated, context [id/value: 1580961020/63]]  old [null] new [PRODUCT_ITEM id:(systemId:26880436)] 
				handle(myEvent);

	ListenerList.fireEvent(Event<?>) line: 82	
		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);

theListenerList=
[com.mpobjects.document.model.eventhandler.util.DocumentEventListener,
 com.mpobjects.oms.model.eventhandler.util.CustomerOrderEventListener,
 com.mpobjects.oms.service.shipmentordercostpart.ShoCostAllocationEventListener,
 com.mpobjects.oms.service.shipmentorderprice.ShoPriceAllocationServiceImpl,
 com.mpobjects.omscarcon.model.eventhandler.util.TMSCarConServiceOrderEventListener,
 com.mpobjects.invoice.model.eventhandler.util.SupplierInvoiceUpdateEventListener,
 com.mpobjects.event.service.DeferredEventServiceImpl@682a179,
 com.mpobjects.event.event.model.util.EventEventListener,
 com.mpobjects.oms.ratecalc.model.eventhandler.util.AllocationEventListener,
 com.mpobjects.inventory.service.stocktransaction.StockTransactionEventListener,				<-
 com.mpobjects.capabletopromise.model.eventhandler.util.CapableToPromiseEventListener,
 com.mpobjects.customerinvoice.model.eventhandler.util.CustomerInvoiceUpdateEventListener,
 com.mpobjects.invoice.model.service.InvoiceServiceOrderEventHandler@13f1709f,
 com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener]

	EventHandlerServiceImpl.handleEvent(Event) line: 109	
			listenerList.fireEvent(anEvent);

	ProductItemServiceImpl.fireProductItemEvent(ProductItemEvent) line: 272	
			eventHandlerService.handleEvent(anEvent);

	ProductItemServiceImpl.save(ProductItemVO, boolean, boolean) line: 530	
			fireProductItemEvent(myEvent);

	ProductItemServiceImpl.save(ProductItemVO, boolean) line: 495	
		return save(aVO, recalculate, false);

	ProductItemServiceImpl.save(ProductItemVO) line: 489	
		return save(aVO, true);

	ProductItemServiceImpl.save(EntityInterface) line: 55	
	ProductItemSaveAction.handleSave() line: 47	
		getProductItemService().save(myProductItem);

	ProductItemSaveAction(AbstractSaveAction).act() line: 69	
			handleSave();

	ProductItemSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	
				Map myMap = act();

	ThreadWithAttributes(Thread).run() line: 745	


/ we gaan debug	,
/s
StockTransactionServiceImpl.handleProductItemUpdated(ProductItemEvent) line: 280	
/=
	public void handleProductItemUpdated(ProductItemEvent anEvent) {

this	StockTransactionServiceImpl  (id=19661)	
anEvent	ProductItemEvent  (id=26179)	
	theEventType	"productitem.updated" (id=26210)	
	theNewVO	ProductItemVO  (id=25938)	
		actualQuantity	BigDecimal  (id=26182)	
40.00
		theQuantity	BigDecimal  (id=26239)	
80.00
	theOldVO	null	

		if (!canCreateTransactions(anEvent.getNewVO().getShipmentOrder())) {
/s
StockTransactionServiceImpl.canCreateTransactions(ShipmentOrderVO) line: 603	
...
	return true;
/t
StockTransactionServiceImpl.handleProductItemUpdated(ProductItemEvent) line: 280	

		ProductItemVO item = anEvent.getNewVO();
		Product product = getProduct(item);

		boolean shouldUpdate = isNewProduct || anEvent.getOldVO() == null;
true
		if (transactions == null) {
			transactions = stockTransactionDAO.getByProductItem(item);
/s
StockTransactionDAOImpl.getByProductItem(ProductItemVO) line: 87	
		DetachedCriteria myCriteria = DetachedCriteria.forClass(StockTransaction.class);
		myCriteria.add(Property.forName("productItem").eq(aItem));
PRODUCT_ITEM id:(systemId:26880437)
/ Met actualQuantity=90	,
		return getHibernateTemplate().findByCriteria(myCriteria);

/ Intermezzo
select ...
from STOCK_TRANSACTION this_ 
left outer join TMS_PRODUCT_ITEM productite2_ on this_.PRODUCT_ITEM_SYSTEMID=productite2_.SYSTEM_ID 
left outer join TMS_PRODUCT_ITEM productite3_ on productite2_.PARENT_SYSTEMID=productite3_.SYSTEM_ID 
inner join ORGANIZATION organizati4_ on this_.ORGANIZATION_SYSTEMID=organizati4_.SYSTEM_ID 
left outer join ORGANIZATION organizati5_ on organizati4_.ORGANIZATION_GROUP=organizati5_.SYSTEM_ID 
where this_.PRODUCT_ITEM_SYSTEMID=?
2016-03-24 10:25:03,671 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-5:) binding parameter [1] as [INTEGER] - 26880436

/ Einde Intermezzo

/s
StockTransaction.setQuantity(BigDecimal) line: 242	
quantity	BigDecimal  (id=26123)	
/ TODO (Waarom called?)
/ TODO (Welke query wordt hier gedaan	?)k:w

/t
StockTransactionServiceImpl.handleProductItemUpdated(ProductItemEvent) line: 281	
			transactions = stockTransactionDAO.getByProductItem(item);
/d
[27176605/ORDER_IN/2016-03-30 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/80.00000/8910.00000/false, 
27176604/ORDER_OUT/2016-03-21 10:30:00.0/MPO_Prod1 (27044086)/MPO_Vend1/-80.00000/-17110.00000/false]

/ Intermezzo

geosco_app_a_2016_03_21=# select*from stock_transaction where transaction_date='2016-03-30 23:59:00' and product_systemid=27044086;

-[ RECORD 15 ]---------------+--------------------
system_id                    | 27176605
quantity                     | 80.00000
serial_number                | NULL
lot_id                       | NULL
transaction_date             | 2016-03-30 23:59:00
product_systemid             | 27044086
goods_status_systemid        | 26877284
stock_location_systemid      | 26878346
product_item_systemid        | 26880436
external_id                  | NULL
organization_systemid        | 12000
calc_stock_level             | 8910.00000
is_dirty                     | 0
transaction_type             | ORDER_IN
customer_order_line_systemid | NULL
shipment_item_systemid       | NULL
ignore_on_balance            | 0

/ Einde Intermezzo

			productList = productService.getProductList(product, item.getQuantity(), 1);

/ We zitten nog in de save van de product item	, waarvan we zojuist de actualQuantity=40. hebben set	, in mem is item.getActualQuantity()=40,	 maar in de db NULL	,

/ Intermezzo

geosco_app_a_2016_03_21=#  select*from tms_product_item where system_id=26880436;
-[ RECORD 1 ]----------------+------------
system_id                    | 26880436
customs_number               | NULL
description                  | MPO_Prod1
part_number                  | NULL
product_series               | NULL
product_model                | NULL
quantity                     | 80.00000
shipment_order_systemid      | 26879361
product_item_id              | 040
weight_kg                    | 50.00000
reference1                   | NULL
reference2                   | 0
reference3                   | NULL
reference4                   | NULL
reference5                   | NULL
country_of_origin_systemid   | NULL
value_currency_systemid      | NULL
individual_item_value        | NULL
tot_volume_m3                | 4.80000
orig_cust_order_id           | CO000003007
orig_cust_orderline_id       | COL00002007
reference6                   | NULL
reference7                   | NULL
reference8                   | NULL
reference9                   | NULL
reference10                  | NULL
requested_adr_code           | NULL
actual_adr_code              | NULL
requested_un_number          | NULL
actual_un_number             | NULL
flashpoint                   | NULL
packaging_group              | NULL
remarks                      | NULL
product_systemid             | 27044086
customer_order_line_systemid | 27309331
productid                    | NULL
reference11                  | NULL
reference12                  | NULL
reference13                  | NULL
reference14                  | NULL
reference15                  | NULL
cost_currency_systemid       | NULL
cost                         | 0.00000
product_owner                | NULL
product_group                | NULL
parent_systemid              | NULL
actual_quantity              | NULL
goods_status_systemid        | 26877284


/ Einde Intermezzo

/s
ProductServiceImpl.getProductList(Product, BigDecimal, int) line: 26	
		Map<Product, BigDecimal> myList = new HashMap<Product, BigDecimal>();
		myList.put(aProduct, aQty);
...
		return myList;
/t
StockTransactionServiceImpl.handleProductItemUpdated(ProductItemEvent) line: 289	
			productList = Collections.emptyMap();
/d
{MPO_Prod1 (27044086)=80.00}

		// Process existing transactions
		for (StockTransaction tx : transactions) {
			BigDecimal expectedQty = productList.get(tx.getProduct());
80.00
			if (expectedQty == null) {
/ NEE
			if (StockTransactionType.ORDER_OUT.equals(tx.getTransactionType())) {
/ NEE
ORDER_IN













/ 7	. 

/ als we een aantal onderin invullen	, dan geeft dat (zien we als we op In click), een nieuwe entry co & sho	, 
/ deze 2 staan er omdat er een stock transactie is bijgekomen	,
/ dus als we op In click, en er 6 co & sho's staan, dan zijn er dus 6 stock transacties geweest	, die in het totall result in In	,
 













/ 7	. 



/ 7	. 

/ calls .setQuantity	,
StockTransactionServiceImpl.createTransaction(ProductItemVO, StockKeepingUnit, StockTransactionType, Date, BigDecimal) line: 706	
EditingReplenishmentAdvicePage.getTemporaryStockTransactions() line: 526	


/ 7	. 





/ Einde DEBUG PSA-422 STOCK REPLENISHMENT FORECAST 

/ INSTALL PSA-479

[eric@localhost bin]$  geosco-pg_dump-a.sh 

pnllogistics7a=# create database geosco2a;

[eric@localhost bin]$ local-pg_restore.sh geosco2a ~/DB_TAP/Postgres/Backup/geosco-a-2016-04-25.dump

[eric@localhost geosco]$ vi deploy/postgres-ds.xml

/ WAS
    <xa-datasource>
        <xa-datasource-property name="DatabaseName">geosco_app_a_2016_03_21</xa-datasource-property>

/ NU	,
    <xa-datasource>
        <xa-datasource-property name="DatabaseName">geosco2a</xa-datasource-property>

    <local-tx-datasource>
                <connection-url>jdbc:postgresql://127.0.0.1:5432/geosco2a</connection-url>

/ 7	. 

/ planning, inventory, replenishment forecast	, 
/ Search op mpo_prod1	, kies location sochaux	,
/ we zien het ingewikkelde scherm	, 
/ Kies 27-4
/ Geef 20 onderin	, 
/ creates	,
SH000001415
/ we zien 2 shi, met 10 	,

/ Kies Tue	, Kies 20 onderin	, click 'Save forecast'	,   
SH000001417
/ we zien bij de shi's: er zijn 2 shi besteld, met labels LA2JS1QEV en A4CI08394	,  en elk Quantity 10.00 

/ we set de berichten in 	,
[eric@localhost Geosco]$ pwd
/home/eric/Integration/Geosco

/ we moeten de berichten aanpassen	, de 04 met de label numbers	, 

/ 13	. 

/ 1ste bericht	,

[eric@localhost Geosco]$ gedit 04-DESADV-ID-SH-1248.xml 

/ 04-DESADV-ID-SH-1248.xml: despatch advice (= dit gaat er komen)	, van leverancies naar SCS	,: hoeveel in welke doos	, welke stickers op de dozen	,

         <mtc:CONSIGNMENT>
            <mtc:SHIPMENT_ORDER>
              <so:PRODUCT_ITEMS>
                  <mtccore:PRODUCT_ITEM>
                     <mtccore:PRODUCT_ITEM_ID>MPO_Prod1</mtccore:PRODUCT_ITEM_ID>
                     <mtccore:QUANTITY>20</mtccore:QUANTITY>							/ NIETS van aan trekken	
                  </mtccore:PRODUCT_ITEM>
               </so:PRODUCT_ITEMS>

                <mtccore:SHIPMENT_ITEM>
                     <mtccore:LABEL_NUMBER>LA2JS1QEV</mtccore:LABEL_NUMBER>
                </mtccore:SHIPMENT_ITEM>
                     <mtccore:LABEL_NUMBER>A4CI08394</mtccore:LABEL_NUMBER>

/ we zien dat de getallen niet kloppen	, maar dat geeft niet: op de sho, bij product item mpo_prod1 zien we 17	, 

/ Use Jms entry om deze in SCS te sturen	,
/ Ga terug naar SH000001415
/ We zien dat de 04 verwerkt is	,
/ kijk naar de shi's	, 
/ we zien nu	,
Case number
MBOX1
MBOX2

Container	,
100971646	 / pallets	,
100971646

Label info	,  
                     WB2Z1D7CJ
                     HGOY2S1YS
/ Deze hadden we in de despatch gezet	 ( = van vendor naar SCS	, dus dat klopt	,)

/ we zien ook Quantity
12
5
/ Deze staan zo in het bericht	,
/ We hadden gevraagd: (ik had 20 ingevuld)	,
10
10

/ 13	. 

/ 2de bericht	,

/ Dan SCS-> Magazijn: 08-despatch advice	,

/ 13	. 

/ 3de bericht	,

[eric@localhost Geosco]$ gedit 13-RECADV-ID-SCSIN.xml


13-redadv: Magazijn -> SCS ontvangst receipt	,

<mtc:header> 
     <mtc:ref xmlns:mtc="http://system.mp-objects.com/schemas/MTC/MTCCore/V1/MTCCore.xsd">
         <mtc:VALUE>PSA_MPO_RECADV_20160315_155231_0345.xml</mtc:VALUE>
         <mtc:QUALIFIER>fileName</mtc:QUALIFIER>
      </mtc:ref>
/ WAS
         <mtc:VALUE>PSA_MPO_RECADV_20160315_155231_0344.xml</mtc:VALUE>
/ Moeten 1 ophogen	, anders process hij hem niet	,

         <mtc:CONSIGNMENT>
            <mtc:SHIPMENT_ORDER>
              <mtc:PRODUCT_ITEMS>
                  <mtccore:PRODUCT_ITEM>
                     <mtccore:SHIPMENT_ORDER_ID>SH000001415</mtccore:SHIPMENT_ORDER_ID>
                     <mtccore:PRODUCT>
                        <mtccore:PRODUCT_ID>MPO_Prod1</mtccore:PRODUCT_ID>
                     </mtccore:PRODUCT>
                     <mtccore:QUANTITY>20</mtccore:QUANTITY>				/ WH weer niets van aantrekken	,
                  </mtccore:PRODUCT_ITEM>
               </mtc:PRODUCT_ITEMS>

              <mtc:SHIPMENT_ITEMS>
                  <mtccore:SHIPMENT_ITEM>
                     <mtccore:SHIPMENT_ITEM_ID/>
                     <mtccore:SHIPMENT_ORDER_ID>SH000001415</mtccore:SHIPMENT_ORDER_ID>
                     <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:PRODUCT_ITEM_ID>1</mtccore:PRODUCT_ITEM_ID>
                           <mtccore:SHIPMENT_ORDER_ID>SH000001415</mtccore:SHIPMENT_ORDER_ID>
                           <mtccore:QUANTITY>12</mtccore:QUANTITY>
                           <mtccore:ACTUAL_QUANTITY>15</mtccore:ACTUAL_QUANTITY>
                        </mtccore:PACKED_ITEM>
                     </mtccore:PACKED_ITEMS>
                     <mtccore:PACKAGE_CODE>00112</mtccore:PACKAGE_CODE>
                     <mtccore:CASE_NUMBER>BOX1</mtccore:CASE_NUMBER>
                     <mtccore:CONTAINER_NUMBER>100971646</mtccore:CONTAINER_NUMBER>

		 		<mtccore:SHIPMENT_ITEM>
                     <mtccore:SHIPMENT_ITEM_ID/>
                     <mtccore:SHIPMENT_ORDER_ID>SH000001415</mtccore:SHIPMENT_ORDER_ID>
                     <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:PRODUCT_ITEM_ID>1</mtccore:PRODUCT_ITEM_ID>
                           <mtccore:SHIPMENT_ORDER_ID>SH000001415</mtccore:SHIPMENT_ORDER_ID>
                           <mtccore:QUANTITY>5</mtccore:QUANTITY>
                           <mtccore:ACTUAL_QUANTITY>13</mtccore:ACTUAL_QUANTITY>
                        </mtccore:PACKED_ITEM>
                     </mtccore:PACKED_ITEMS>
                     <mtccore:PACKAGE_CODE>00112</mtccore:PACKAGE_CODE>
                     <mtccore:AIRWAYBILL_NUMBER/>
                     <mtccore:CASE_NUMBER>BOX2</mtccore:CASE_NUMBER>
                     <mtccore:CONTAINER_NUMBER>100971646</mtccore:CONTAINER_NUMBER>
                  </mtccore:SHIPMENT_ITEM>
/ Overal: SHO00001415	,

/ dus we zien	, over mpo_prod1	,
packet item	 Quantity	Actual Quantity
BOX1			12			15
BOX2			5			13
------------------------------------------
				17			28

/ Via JMS entry in SCS lezen	,

/ we zien op de product item Quantity 17, Actual Quantity 28	, klopt	,

/ Maar 
planning, inventory, stock transaction	,
/ Een stock transactie is over een product (mpo_prod1) in het magazijn (sochaux): 
/ Geef mpo_prod1
/ pak de bovenste	,
/ dan zie je wat er in het magazijn is gebeurd	, 
Quantity: 20
/ Dit is wat er bij is gekomen	,   kan ook negatief zijn	,
/ Dit is ERR: had 28 moeten zijn	,
Calc. Level: totale quentity	,

/ 13	. 

/ een product item is een product	
/ een shi is een doos	, of een container, pallet	,
/ een packed item zit in de shi	, en heeft een aantal van een product	, 
/ een shi kan meerder packed items hebben	,  als er meerdere producten in de container zitten bijv	,
/ een product item kan meerdere packed items hebben	, als de product item in meerdere dozen zit	,


/ Vb	,

mpo_prod1 
17/28

mpo_prod2 
...

shi 010
packed item heeft 12/15 mpo_prod1's  	/ quantity (in 04)/actual quantity (in 13)
packed item heeft ... mpo_prod2's 

shi 020
packed item heeft 5/13 mpo_prod1's 		/ quantity (in 04)/actual quantity (in 13)
packed item heeft ... mpo_prod2's 

/ 13	. 

/ In 04 staan shi's?
/ TODO

/ Worden de shi's gevonden op hun	,
<mtccore:LABEL_NUMBER>T31MB26BA</mtccore:LABEL_NUMBER>
/ TODO

/ Einde INSTALL PSA-479

/ DEBUG PSA-479

/ JMS QUEUES IN SCS

/ 13	. 

[eric@localhost workspace]$ find pnllogistics/ -name "*Jms*Listener*java" 

pnllogistics/isbscs/isbscs/src/java/com/mpobjects/isbscs/integration/jms/JmsIsbScsListener.java
pnllogistics/geosco/geosco/src/java/com/mpobjects/geosco/integration/jms/JmsGeoScoListener.java
pnllogistics/dsvfms/dsvfms/src/java/com/mpobjects/dsvfms/integration/jms/JmsDsvFmsListener.java
pnllogistics/dsvoms/dsvoms/src/java/com/mpobjects/dsvoms/integration/jms/JmsDsvOmsListener.java
pnllogistics/geodis/geodis/src/java/com/mpobjects/geodis/integration/jms/JmsGeodisListener.java
pnllogistics/pnltms/pnltms/src/java/com/mpobjects/pnltms/integration/jms/JmsPnlTmsListener.java
pnllogistics/dsvcts/dsvcts/src/java/com/mpobjects/dsvcts/integration/jms/JmsDsvCtsListener.java
pnllogistics/mpo/mpo/src/java/com/mpobjects/mpo/integration/jms/JmsMpoListener.java

pnllogistics/cevaoms/cevaoms/src/java/com/mpobjects/cevaoms/integration/jms/JmsCevaOmsListener.java
pnllogistics/module/interfacing/src/java/com/mpobjects/util/jms/AbstractJmsMessageListener.java
pnllogistics/module/interfacing/src/java/com/mpobjects/util/jms/AbstractJmsListener.java
pnllogistics/module/interfacing/src/java/com/mpobjects/util/jms/RequeueingJmsListener.java

/ 13	. 

$ vi interfacing-jms.sb.xml

	<bean id="messageListenerContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer"
		abstract="true">
		<property name="concurrentConsumers" value="1" />
		<property name="maxConcurrentConsumers" value="1" />
		<property name="connectionFactory" ref="jmsConnectionFactory" />
		<property name="autoStartup" value="${module.interfacing.jms.listener.autostartup}" />
		<property name="sessionTransacted" value="${module.interfacing.jms.listener.sessiontransacted}" />
	</bean>

	<!-- The JMS Connection factory instance -->
	<alias alias="jmsConnectionFactory" name="${module.interfacing.jms.provider}.connectionFactory" />
/ module.interfacing.jms.provider=activemq	, en activemq.connectionFactory is def in interfacing-activemq.sb.xml	, 

	<!-- Defines the part class for queue destinations -->
	<alias alias="jmsQueue" name="${module.interfacing.jms.provider}.queue" />
/ activemq.queue

	<!-- Template for message listeners -->
	<bean id="jmsMessageListener" class="com.mpobjects.interfacing.jms.MpoMessageListener" abstract="true">
		<property name="messageConverter" ref="com.mpobjects.interfacing.jms.JmsMessageConverter" />
		<property name="logHeaders" value="${module.interfacing.jms.listener.log.headers:true}" />
		<property name="logProperties" value="${module.interfacing.jms.listener.log.properties:false}" />
		<property name="logPayload" value="${module.interfacing.jms.listener.log.payload:false}" />
		<property name="monitoringService" ref="com.mpobjects.core.monitoring.MonitoringService" />
	</bean>

	<!-- Default JMS message listener which accepts all kinds of messages (generic message listener) -->
	<bean id="JmsGenericDemuxMsgListener" parent="jmsMessageListener" lazy-init="true">
...

$ vi interfacing-activemq.sb.xml

	<bean id="activemq.connectionFactory" class="org.apache.activemq.spring.ActiveMQConnectionFactory" lazy-init="true">
		<property name="clientIDPrefix" value="${module.interfacing-activemq.jms.server.clientid}" />
		<property name="brokerURL" value="${module.interfacing-activemq.jms.server.url}" />
		<property name="userName" value="${module.interfacing-activemq.jms.server.username}" />
		<property name="password" value="${module.interfacing-activemq.jms.server.password}" />
		<property name="redeliveryPolicy" ref="activemq.redeliveryPolicy" />
		<property name="prefetchPolicy" ref="activemq.prefetchPolicy" />
	</bean>

	<bean id="activemq.queue" class="org.apache.activemq.command.ActiveMQQueue" abstract="true" />
/ TODO (abstract?)


$ vi oms-integration.sb.xml

	<bean id="ShipmentOrderMsgHandler" class="com.mpobjects.interfacing.messages.handler.MessageConsumerHandler" lazy-init="true">
		<constructor-arg value="ShipmentOrderMsgHandler" />
		<lookup-method name="getConsumer" bean="com.mpobjects.oms.model.shipmentorder.util.ShipmentOrderMsgConsumer" />
	</bean>

	<bean id="JmsShipmentOrderMsgListener" parent="jmsMessageListener" lazy-init="true">
/ jmsMessageListener in interfacing-jms.sb.xml	,
		<constructor-arg index="0" value="ShipmentOrder" />
		<constructor-arg index="1">
			<bean class="com.mpobjects.interfacing.messages.handler.MessageHandler">
				<constructor-arg index="0" ref="defaultExchangeHandlers" />
				<constructor-arg>
					<array>
						<ref bean="ShipmentOrderMsgHandler" />
/ in oms-integration.sb.xml	,
					</array>
				</constructor-arg>
			</bean>
		</constructor-arg>
	</bean>



$ vi interfacing-activemq.properties

module.interfacing.jms.provider=activemq
# By default, use the global value
module.interfacing-activemq.jms.server.url=${module.interfacing.jms.server.url}
/ in geosco.properties	,
module.interfacing-activemq.jms.server.clientid=${module.interfacing.jms.server.clientid}
/ in geosco.properties	,
module.interfacing-activemq.jms.server.username=${module.interfacing.jms.server.username}
/ TODO
module.interfacing-activemq.jms.server.password=${module.interfacing.jms.server.password}
/ TODO

$ vi geosco.properties

module.interfacing.jms.event.queue=GEOSCO.EVENTS
module.interfacing.jms.geosco.queue=MPOBJECTS.TO.GEOSCO
module.interfacing.jms.shipmentorder.queue=GEOSCO.SHIPMENTORDERS
module.interfacing.jms.customerorder.queue=GEOSCO.CUSTOMERORDERS
module.interfacing.jms.serviceorder.queue=GEOSCO.SERVICEORDERS
module.interfacing.jms.stocktransaction.queue=GEOSCO.STOCKTRANSACTIONS

module.interfacing.jms.server.clientid=GEOSCO
module.interfacing.jms.server.url=tcp://localhost:61616

module.interfacing.jmsmessage.from.destination=MPOBJECTS.FROM.GEOSCO
module.interfacing.jmsmessage.destination=MPOBJECTS.TO.GEOSCO
module.interfacing.jmsmessage.serverid=default

development.destination = MPOBJECTS.FROM.GEOSCO
development.local-mode = false
development.mode = debug
development.serverid = default



$ vi geosco-integration.sb.xml

	<!-- Shipment order queue -->
	<bean id="ShipmentOrderQueueContainer" parent="messageListenerContainer"> 			
/ messageListenerContainer is def in interfacing-jms.sb.xml
		<property name="destination">
			<bean parent="jmsQueue">
				<constructor-arg index="0" value="${module.interfacing.jms.shipmentorder.queue}" /> 
/ GEOSCO.SHIPMENTORDER
			</bean>
		</property>
		<property name="messageListener" ref="JmsShipmentOrderMsgListener" />
/ def in oms-integration.sb.xml	,
	</bean>

	<bean id="StockTransactionQueueContainer" parent="messageListenerContainer">
		<property name="destination">
			<bean parent="jmsQueue">
				<constructor-arg index="0" value="${module.interfacing.jms.stocktransaction.queue}" />
/ GEOSCO.STOCKTRANSACTIONS
			</bean>
		</property>
		<property name="messageListener" ref="JmsStockTransactionMsgListener" />
/ def in oms-integration.sb.xml	,
	</bean>

	<!-- The generic GeoSco queue for other messages -->
	<bean id="GeoScoQueueContainer" parent="messageListenerContainer">
		<property name="destination">
			<bean parent="jmsQueue">
				<constructor-arg index="0" value="${module.interfacing.jms.geosco.queue}" />
/ MPOBJECTS.TO.GEOSCO
			</bean>
		</property>
		<property name="messageListener" ref="JmsGenericDemuxMsgListener" />
/ def in  interfacing-jms.sb.xml
	</bean>

/ See boven	,
$ vi interfacing-jms.sb.xml
	<!-- Template for message listeners -->
	<bean id="jmsMessageListener" class="com.mpobjects.interfacing.jms.MpoMessageListener" abstract="true">
	<!-- Default JMS message listener which accepts all kinds of messages (generic message listener) -->
	<bean id="JmsGenericDemuxMsgListener" parent="jmsMessageListener" lazy-init="true">
/ def in interfacing-jms.sb.xml
/ (*)


$ vi dsvfms-integration.sb.xml

	<!-- Generic queue -->
	<bean id="DsvFmsQueueContainer" parent="messageListenerContainer">
		<property name="messageListener" ref="com.mpobjects.dsvfms.integration.jms.JmsDsvFmsListener" />

/ Ad (*)
/ b in MpoMessageListener.onMessage	,


/ 13	. 

/ Hier komt hij ook langs	,
GeoScoShipmentOrderMsgProcessor
ShipmentOrderBodyProcessor

/ 13	. 

/ Eerder	, 
LOG_29_sep_2015.txt:JmsDsvFmsListener.onMessage(Message) line: 44	

/ 13	. 

/ MORGENOCHTEND
/ start geosco
/home/eric/Integration/Geosco
[eric@localhost apache-activemq-5.10.1]$ bin/activemq console



/ JMS QUEUES IN SCS

/ Einde DEBUG PSA-479

/ 13	. 

/ we maken sho SHO00001416	,

/ we zien in Send Jms Message  de queue MPOBJECTS.TO.GEOSCO	, inderdaad boven	, 
	<!-- The generic GeoSco queue for other messages -->
/ Dus moeten we een b set in MpoMessageListener.onMessage	,

/ we willen nog een keer geven	,
[eric@localhost Geosco]$ gedit 04-DESADV-ID-SH-1248.xml 

/ Maar we maken een nieuwe sho	,
planning, inventory, replenish forecast
/ vul in vakje bij 27-04 20 in (In is nu 50)	,
/ click nu ergens in het vak onder 27-04, we zien In 70 	, we zien dat er een nieuwe sho is create	,  met  1 product item mpo_prod1	, en 2 shi's	, 
SH000001416 / 010
/ we zien de shi's	

Item id 				0010
Label info 				7N3G9F9F9 
Item id					010			 	/ van deze shi	,	
Quantity				10
Actual quantity			0

Item id 				0020
Label info 			 	T31MB26BA	
Item id					020				/ van deze shi
Quantity				10
Actual quantity			0

/ we passen in 04 de label info's aan 


/ Intermezzo

/ Bij Nippon een andere listener	,

/ omgekeerder stack	,

[eric@localhost server]$ stacktrace.sh 2144 2194 ~/LOGS/LOG_NIP_45.txt  
        at com.mpobjects.mpo.integration.jms.JmsMpoListener.onMessage(JmsMpoListener.java:65)
        at com.mpobjects.util.sap.link.IncomingLink.handle(IncomingLink.java:89)
        at com.mpobjects.util.sap.link.IncomingXmlMessageLink.unMarshalFrom(IncomingXmlMessageLink.java:158)
        at com.mpobjects.util.sap.link.IncomingLink.postMessage(IncomingLink.java:143)
        at com.mpobjects.util.sap.control.MessageSwitch.handleMessage(MessageSwitch.java:306)
        at com.mpobjects.util.sap.control.MessageSwitch.forwardDataMessage(MessageSwitch.java:1198)
        at com.mpobjects.util.sap.control.MessageConsumer.handle(MessageConsumer.java:108)
        at com.mpobjects.util.sap.control.IncomingMessageDemultiplexer.process(IncomingMessageDemultiplexer.java:123)
        at com.mpobjects.oms.model.shipmentorder.util.ShipmentOrderMsgConsumer.process(ShipmentOrderMsgConsumer.java:56)
        at com.mpobjects.oms.model.shipmentorder.xml.AbstractShipmentOrderMsgProcessor.process(AbstractShipmentOrderMsgProcessor.java:266)
        at com.mpobjects.mpo.model.shipmentorder.xml.MpoShipmentOrderMsgProcessor.processUpdate(MpoShipmentOrderMsgProcessor.java:68)
        at com.mpobjects.mpo.model.shipmentorder.xml.MpoShipmentOrderMsgProcessor.processOriginal(MpoShipmentOrderMsgProcessor.java:56)
        at com.mpobjects.oms.model.service.ShipmentOrderServiceImpl.createShipmentOrder(ShipmentOrderServiceImpl.java:878)

/ Nu	, 
/s
MpoMessageListener.onMessage(Message) line: 194	

/ we geven continue	,

/ SERVICE ORDER FROM XML

/ HANDLE 04-DESADV ABSTRACT 

/ 7	. 

///////////////////////////
/ BREAKPOINTS
ServiceOrderMsgConsumer.process(Message) line: 52	
/ of alleen in	,
GeoScoServiceOrderProcessor.process(Node) line: 258	
/ of alleen in 	,
ServiceOrderBodyProcessor.process(Node) line: 360	


/ 7	. 

/ Over het algemeen gaat het zo	,
RetryExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
		boolean canContinue = onExchange(aExchange);
			aChain.next(aExchange);
/s
DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
			lastHandler.handleExchange(this, aExchange);
/ s
/ volgende	,

/ 7	. 

/ Maar soms loopt het anders	, 

/ 13	. 

/ In het begin	, 

MessageHandler.handleExchange(MessageExchange) line: 55	
		DefaultExchangeHandlerChain handlerChain = new DefaultExchangeHandlerChain(chain);
chain=
[ExchangeHandler[com.mpobjects.interfacing.messages.handler.RetryExchangeHandler],
 ExchangeHandler[com.mpobjects.interfacing.messages.handler.ArchiveErrorExchangeHandler],
 ExchangeHandler[com.mpobjects.interfacing.messages.handler.SapXConverterExchangeHandler],
 ExchangeHandler[com.mpobjects.interfacing.messages.handler.ArchiveExchangeHandler],
 ExchangeHandler[com.mpobjects.interfacing.messages.handler.AuthNExchangeHandler],
 ExchangeHandler[com.mpobjects.interfacing.messages.handler.trace.MessageTraceExchangeHandler],
 ExchangeHandler[com.mpobjects.interfacing.messages.handler.tx.TxExchangeHandler],
 ExchangeHandler[com.mpobjects.interfacing.messages.handler.DemuxExchangeHandler]]
		try {
			handlerChain.next(aExchange);
/ GEEN onExchange

/ 13	. 

/ stap ervoor om eerst een tx te start	,

	@Transactional(propagation = Propagation.REQUIRED, rollbackFor = Exception.class)
TxExchangeHandler.handleExchange(ExchangeHandlerChain, MessageExchange) line: 62	
		super.handleExchange(aChain, aExchange);
/s
TxExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
		boolean canContinue = onExchange(aExchange);
			aChain.next(aExchange);

/ 13	. 

/ Einde chain, we gaan nu onExchange in	, en komen VOORLOPIG niet terug	,	 

DemuxExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 43	
		boolean canContinue = onExchange(aExchange);			<-
			aChain.next(aExchange);						/ komen we voorlopig niet
/s
DemuxExchangeHandler.onExchange(MessageExchange) line: 123	
		ExchangeHandler handler = exchangeHandlers.get(messageType);
messageType=
SERVICE_ORDER_MSG
handler=
ExchangeHandler[com.mpobjects.interfacing.messages.handler.MessageConsumerHandler$$EnhancerBySpringCGLIB$$ca5a33ca[ServiceOrderMsgHandler]]
		handleMessage(handler, aExchange);
/s
DemuxExchangeHandler.handleMessage(ExchangeHandler, MessageExchange) line: 110 			/ helper method	,	
		ExchangeHandlerChain chain = new SingletonExchangeHandlerChain(aHandler);
		chain.next(aExchange);
/ creates nieuwe chain	,
/s
SingletonExchangeHandlerChain.next(MessageExchange) line: 43	
		handler.handleExchange(this, aExchange);
/s
MessageConsumerHandler$$EnhancerBySpringCGLIB$$ca5a33ca(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 43	
		boolean canContinue = onExchange(aExchange);		<- hier gaan we in	,
			aChain.next(aExchange);							<- voorloptig niet,	
/s
MessageConsumerHandler$$EnhancerBySpringCGLIB$$ca5a33ca(MessageConsumerHandler).onExchange(MessageExchange) line: 172	
		MessageConsumerInterface consumer = getConsumer();
		consumer.handle(message);

/ Er wordt eerst weer een tx start	, 
/ TODO
/s
ServiceOrderMsgConsumer(MessageConsumer).handle(Message) line: 120	
				process(incomingMessage);
/s
ServiceOrderMsgConsumer.process(Message) line: 52	
				myProcessor.process(((SapXMessage) aIncomingMessage).getDocument().getDocumentElement());
/s
ServiceOrderMsgProcessor.process(Node) line: 91	
					getServiceOrderProcessor().process(myNode);
/s
GeoScoServiceOrderProcessor.process(Node) line: 239	
			final String purposeCode = selectText(aNode, MTCCoreNames.PROCESSING_DETAILS, MTCCoreNames.PURPOSE_CODE);
DespatchAdviceShipment
			} else if (DESPATCH_ADVICE_SHIPMENT.equals(purposeCode)) {
				processDespatchAdviceShipment(aNode, myProcessor, documentId);
/s
GeoScoServiceOrderProcessor.processDespatchAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 420	



/ Einde HANDLE 04-DESADV ABSTRACT 

/ STACK TRACE ABSTRACT 

/ STACK TRACE 04-DESADV

Thread [GeoScoQueueContainer-2] (Suspended (breakpoint at line 126 in EntityDetailServiceImpl))	
	EntityDetailServiceImpl.initialize(EntityDetailSupport) line: 126	
->
	ShipmentOrderBodyProcessor.process(Node) line: 457	
			MpoBeanFactory.getBean(EntityDetailService.class).initialize(myShipmentOrderVO);

	ShipmentOrderProcessor.process(Node) line: 208	
/***
			myShipmentOrderVO = myProcessor.process(selectSingleNode(aNode, SHIPMENT_ORDER_BODY_TAG));

	GeoScoServiceOrderProcessor(ServiceOrderProcessorImpl).processConsignments(Node, ServiceOrderVO) line: 356	
							ParsedShipmentOrder myParsedShipmentOrderVO = new ShipmentOrderProcessor().process(myShipmentOrderNode);

	 /** * Processes the despatch advice for a shipment order (04-DESADV)
	GeoScoServiceOrderProcessor.processDespatchAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 403	
		ServiceOrderVO updateServiceOrderVO = aProcessor.process(selectSingleNode(aNode, SERVICE_ORDER_BODY_TAG));
/*****
->		processConsignments(aNode, updateServiceOrderVO);
		List<ShipmentItemVO> existingShipmentItems = processDesadvServiceOrder(updateServiceOrderVO);
		processPurchaseServiceOrdersForShipmentItems(existingShipmentItems);

	GeoScoServiceOrderProcessor.process(Node) line: 248	
			} else if (DESPATCH_ADVICE_SHIPMENT.equals(purposeCode)) {
				processDespatchAdviceShipment(aNode, myProcessor, documentId);

	ServiceOrderMsgProcessor.process(Node) line: 91	
					getServiceOrderProcessor().process(myNode);

	ServiceOrderMsgConsumer.process(Message) line: 52	
/ **
			if (aIncomingMessage instanceof SapXMessage) {
				ServiceOrderMsgProcessor myProcessor = Factory.getFactory()
						.getInstance(com.mpobjects.oms.model.serviceorder.xml.ServiceOrderMsgProcessor.class);
				myProcessor.process(((SapXMessage) aIncomingMessage).getDocument().getDocumentElement());

	ServiceOrderMsgConsumer(MessageConsumer).handle(Message) line: 108	
				process(incomingMessage);

	MessageConsumerHandler$$EnhancerBySpringCGLIB$$ca5a33ca(MessageConsumerHandler).onExchange(MessageExchange) line: 172	
		final SapXMessage message = getSapXMessage(aExchange.getIn());
		MessageConsumerInterface consumer = getConsumer();
		consumer.handle(message);

	MessageConsumerHandler$$EnhancerBySpringCGLIB$$ca5a33ca(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 43	
	SingletonExchangeHandlerChain.next(MessageExchange) line: 43	
		handler.handleExchange(this, aExchange);

	DemuxExchangeHandler.handleMessage(ExchangeHandler, MessageExchange) line: 110	
		chain.next(aExchange);

	DemuxExchangeHandler.onExchange(MessageExchange) line: 123	
		handleMessage(handler, aExchange);

	DemuxExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 43	
		boolean canContinue = onExchange(aExchange);

	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
			lastHandler.handleExchange(this, aExchange);

	TxExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
			aChain.next(aExchange);

	TxExchangeHandler.handleExchange(ExchangeHandlerChain, MessageExchange) line: 62	
		super.handleExchange(aChain, aExchange);

	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
			lastHandler.handleExchange(this, aExchange);

	MessageTraceExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	AuthNExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	ArchiveExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	SapXConverterExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	ArchiveErrorExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	RetryExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
			aChain.next(aExchange);
	RetryExchangeHandler.handleExchange(ExchangeHandlerChain, MessageExchange) line: 80	
				super.handleExchange(fork, exchangeCopy);

	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
			lastHandler.handleExchange(this, aExchange);

	MessageHandler.handleExchange(MessageExchange) line: 55	
/*
			handlerChain.next(aExchange);

	MpoMessageListener.processMessage(Message, JmsMpoMessage) line: 378	
			messageHandler.handleExchange(exchange);

	MpoMessageListener.onMessage(Message) line: 199	
				processMessage(aMessage, mpoMsg);

	DefaultMessageListenerContainer(AbstractMessageListenerContainer).doInvokeListener(MessageListener, Message) line: 569	
	DefaultMessageListenerContainer(AbstractMessageListenerContainer).invokeListener(Session, Message) line: 507	
	DefaultMessageListenerContainer(AbstractMessageListenerContainer).doExecuteListener(Session, Message) line: 474	
	DefaultMessageListenerContainer(AbstractPollingMessageListenerContainer).doReceiveAndExecute(Object, Session, MessageConsumer, TransactionStatus) line: 325	
	DefaultMessageListenerContainer(AbstractPollingMessageListenerContainer).receiveAndExecute(Object, Session, MessageConsumer) line: 263	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener() line: 1103	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop() line: 1095	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run() line: 992	
	Thread.run() line: 745	

/*
this	com.mpobjects.interfacing.messages.handler.MessageHandler  (id=1111)	
handlerChain	com.mpobjects.interfacing.messages.handler.DefaultExchangeHandlerChain  (id=1110)	
	chain	java.util.ArrayList  (id=1125)	
/=
[ExchangeHandler[com.mpobjects.interfacing.messages.handler.RetryExchangeHandler],
 ExchangeHandler[com.mpobjects.interfacing.messages.handler.ArchiveErrorExchangeHandler],
 ExchangeHandler[com.mpobjects.interfacing.messages.handler.SapXConverterExchangeHandler],
 ExchangeHandler[com.mpobjects.interfacing.messages.handler.ArchiveExchangeHandler],
 ExchangeHandler[com.mpobjects.interfacing.messages.handler.AuthNExchangeHandler],
 ExchangeHandler[com.mpobjects.interfacing.messages.handler.trace.MessageTraceExchangeHandler],
 ExchangeHandler[com.mpobjects.interfacing.messages.handler.tx.TxExchangeHandler],
 ExchangeHandler[com.mpobjects.interfacing.messages.handler.DemuxExchangeHandler]]

/**
/ In 04-DESADV staat inderdaad een seo	,
   <so:body>
      <so:SERVICE_ORDER>
         <so:PROCESSING_DETAILS>
            <mtccore:PURPOSE_CODE>DespatchAdviceShipment</mtccore:PURPOSE_CODE>

/***
/ In een seo zitten meerdere sho's (consolidatie)	,


/ we debug verder	,

/s
	protected void processDespatchAdviceShipment(Node aNode, ServiceOrderBodyProcessor aProcessor, String aDocumentId) throws ServiceOrderException {
/*****
		ServiceOrderVO updateServiceOrderVO = aProcessor.process(selectSingleNode(aNode, SERVICE_ORDER_BODY_TAG));
/s
ServiceOrderBodyProcessor.process(Node) line: 360	

/ Intermezzo

    <so:SERVICE_ORDER>
         <so:PROCESSING_DETAILS>
            <mtccore:PURPOSE_CODE>DespatchAdviceShipment</mtccore:PURPOSE_CODE>
            <mtccore:REQUESTED_ID>2589</mtccore:REQUESTED_ID>
         </so:PROCESSING_DETAILS>
         <so:SERVICE_ORDER_BODY>
            <mtccore:COMMON>
               <mtccore:DATE_SET>
                  <mtccore:PLANNED_END_AFTER>2016-04-06T15:00:00</mtccore:PLANNED_END_AFTER>
               </mtccore:DATE_SET>
            </mtccore:COMMON>
            <mtccore:SERVICE_ORDER_ID/>
            <mtccore:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtccore:ORGANIZATION_ID>
         </so:SERVICE_ORDER_BODY>
         <so:CONSIGNMENT>
...

/ Einde Intermezzo

		ServiceOrderVO myServiceOrderVO = new ServiceOrderVO();
			// Pick up the organization identification from the document and initialise the VO with it
			String myOrg = getTextNode(aNode, ORGANIZATION_ID_TAG);
LOG_EMEA_FR_CT_PSA
				Organization myOrganizationVO = MpoBeanFactory.getBean(OrganizationService.class).getOrganization(myOrg);
				if (myOrganizationVO != null) {
					myServiceOrderVO.setOrganization(myOrganizationVO);

			myServiceOrderVO.setSyncToFlag(getSyncFlag("to"));
/s
	protected static String getSyncFlag(String aType) {
		String myKey = "interface.serviceorder.sync." + aType + ".flag".toLowerCase();
		return ApplicationPropertyManager.getInstance().getModuleProperty("oms", myKey, "D");
/ property is er niet, dus default "D"	,

			myServiceOrderVO.setSyncFromFlag(getSyncFlag("from"));
			new LogisticsOrderBodyProcessor(this).process(selectSingleNode(aNode, COMMON_TAG), myServiceOrderVO);
/s
LogisticsOrderBodyProcessor.process(Node, LogisticsOrderVO) line: 187	

			// first process the date set, it's needed for party resolving
			Node myNode = selectSingleNode(aNode, DATE_SET_TAG);
			if (myNode != null) {
				DateSetVO myDateSet = new DateSetProcessor(this).process(myNode);
/s
DateSetProcessor.process(Node) line: 118	
			DateSetVO myDateSetVO = new DateSetVO();

			Node childNode = aNode.getFirstChild();
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
PLANNED_END_AFTER
					} else if (PLANNED_END_AFTER_TAG.equals(tag)) {
						myDateSetVO.setPlannedEndAfter(parse(childNode.getTextContent()));
RSAFTER: null, RSBEFORE: null, REAFTER: null, REBEFORE: null, PSAFTER: null, PSBEFORE: null, PEAFTER: Wed Apr 06 15:00:00 CEST 2016, PEBEFORE: null, AS: null, AE: null, RELEASE:null, PRELEASE:null, CLOSE:null

			return myDateSetVO;
/t
LogisticsOrderBodyProcessor.process(Node, LogisticsOrderVO) line: 193	
				DateSetVO myDateSet = new DateSetProcessor(this).process(myNode);
/d
				aLogisticsOrderVO.setDateSetVO(myDateSet);

			// process the rest
			myNode = aNode.getFirstChild();
			while (myNode != null) {
				if (myNode.getNodeType() == Node.ELEMENT_NODE) {
					String myElementName = getElementName(myNode);
DATE_SET
/ Hebben we al process	,
					if (myElementName.equals(FROM_LOCATION_TAG)) {
/ NEE
					} else if (myElementName.equals(TO_LOCATION_TAG)) {
/ NEE
					} else if (myElementName.equals(DATE_SET_TAG)) {
/ JA
						// already processed above
					}

/t
ServiceOrderBodyProcessor.process(Node) line: 379	
			new LogisticsOrderBodyProcessor(this).process(selectSingleNode(aNode, COMMON_TAG), myServiceOrderVO);
/d
			String myId = getTextNode(aNode, SERVICE_ORDER_ID_TAG);
""
/ De tag is er wel	, maar is leeg	, 
			if (myId != null) {
				myServiceOrderVO.setServiceOrderId(myId);
				if (getProcessingContext() != null) {
					getProcessingContext().addToProcessingContext(SERVICE_ORDER_ID_TAG, myId);
/s
ProcessingContext.addToProcessingContext(String, String) line: 20	
sb=ProcessingContext: SERVICE_ORDER_ID[]
		context_list.add(sb.toString());
/t
ServiceOrderBodyProcessor.process(Node) line: 387	
					getProcessingContext().addToProcessingContext(SERVICE_ORDER_ID_TAG, myId);
/d
			String myProcess = getTextNode(aNode, SERVICE_ORDER_PROCESS_TAG);
""
/ tag is er niet	,
			if (StringUtils.isNotBlank(myProcess)) {
/ NEE
				myServiceOrderVO.setOrderProcess(OrderProcessUtils.getByCode(myProcess));
			} else {
				myServiceOrderVO.setOrderProcess(OrderProcessUtils.getByCode(OrderProcess.OUTBOUND));
OUTBOUND

			String myType = getTextNode(aNode, SERVICE_ORDER_TYPE_TAG);
""
			if (StringUtils.isNotBlank(myType)) {
/ NEE

			String myServiceTypeCode = getTextNode(aNode, SERVICE_TYPE_TAG);
""
			if (StringUtils.isNotBlank(myServiceTypeCode)) {
/ NEE

			String myRemarks = getTextNode(aNode, REMARKS_TAG);
""
			if (myRemarks != null) {
/ JA
				myServiceOrderVO.setRemarks(myRemarks);

			String myLevel = getTextNode(aNode, SERVICE_LEVEL_TAG);
""
			if (myLevel != null) {
/ JA
				myServiceOrderVO.setServiceLevel(myLevel);
			}

			Node myExecBy = selectSingleNode(aNode, EXECUTED_BY_TAG);
null
			if (myExecBy != null) {
/ NEE

			Node myExecBy2 = selectSingleNode(aNode, EXECUTED_BY_2_TAG);
null
			if (myExecBy2 != null) {
/ NEE

			String myEquipment = selectText(aNode, EQUIPMENT_ID_TAG);
null
			if (myEquipment != null) {
/ NEE

			Node myVolumeNode = selectSingleNode(aNode, EQUIPMENT_VOLUME_TAG);
null
			if (myVolumeNode != null) {
/ NEE

			Node myWeightNode = selectSingleNode(aNode, EQUIPMENT_WEIGHT_TAG);
null
			if (myWeightNode != null) {
/ NEE

			String myAirwayBill = getTextNode(aNode, AIRWAY_BILL_TAG);
""
			if (myAirwayBill != null) {
/ JA
				myServiceOrderVO.setAirwayBillNr(myAirwayBill);

			String myBol = getTextNode(aNode, BILL_OF_LADING_TAG);
""
			if (myBol != null) {
/ JA
				myServiceOrderVO.setBillOfLadingNr(myBol);

			Node myCarrierDataNode = selectSingleNode(aNode, GenericCarrierServiceOrderDataProcessor.CARRIER_SERVICE_ORDER_DATA_TAG);
null
			if (myCarrierDataNode != null) {
/ NEE

			Node myScheduleNode = selectSingleNode(aNode, ScheduleProcessor.SCHEDULE_TAG);
null
			if (myScheduleNode != null) {
/ NEE

			Iterable<Node> myIterator = selectNodeIterable(aNode, SERVICE_ORDER_REFERENCE_TAG);
			for (Node myRefNode : myIterator) {
/ GEEN

			myServiceOrderVO.setSystemEntryDate(MpoBeanFactory.getBean(TimeService.class).getPresentDate(myServiceOrderVO.getOrganization()));
Mon May 09 13:12:43 CEST 2016
/ Nu	,

			Node myImportExportNode = selectSingleNode(aNode, ImportExportProcessor.IMPORT_EXPORT_INFO);
null
			if (myImportExportNode != null) {
/ NEE

			return myServiceOrderVO;

/t
GeoScoServiceOrderProcessor.processDespatchAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 402	
		ServiceOrderVO updateServiceOrderVO = aProcessor.process(selectSingleNode(aNode, SERVICE_ORDER_BODY_TAG));
/d
                 <mtccore:PLANNED_END_AFTER>2016-04-06T15:00:00</mtccore:PLANNED_END_AFTER>
            <mtccore:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtccore:ORGANIZATION_ID>
/ set in deze seo	,

		processConsignments(aNode, updateServiceOrderVO);
/s
GeoScoServiceOrderProcessor(ServiceOrderProcessorImpl).processConsignments(Node, ServiceOrderVO) line: 339	

/ Intermezzo

         <so:CONSIGNMENT>
            <so:CONSIGNMENT_BODY>
               <mtccore:COMMON/>
               <mtccore:CONSIGNMENT_ID/>
            </so:CONSIGNMENT_BODY>
            <so:SHIPMENT_ORDER>
               <so:SHIPMENT_ORDER_BODY>
                  <mtccore:SHIPMENT_ORDER_ID>2589</mtccore:SHIPMENT_ORDER_ID>
                  <mtccore:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtccore:ORGANIZATION_ID>
               </so:SHIPMENT_ORDER_BODY>
               <so:PRODUCT_ITEMS>
...


/ Einde Intermezzo
			Iterable<Node> myConsignmentIterator = selectNodeIterable(aNode, "CONSIGNMENT");
			for (Node myConsignmentNode : myConsignmentIterator) {
				} else {
					ConsignmentVO myConsignment = new ConsignmentVO();
/ !
					ArrayList<ServiceActionVO> myServiceActionList = new ArrayList<ServiceActionVO>();
					String myConsignmentNr = selectText(myConsignmentNode, "CONSIGNMENT_BODY", "CONSIGNMENT_ID");
""
					if (StringUtils.isNotEmpty(myConsignmentNr)) {
/ NEE

					Iterable<Node> myShipmentOrderIterator = selectNodeIterable(myConsignmentNode, "SHIPMENT_ORDER");
					for (Node myShipmentOrderNode : myShipmentOrderIterator) {
						} else {
							ParsedShipmentOrder myParsedShipmentOrderVO = new ShipmentOrderProcessor().process(myShipmentOrderNode);
/s
ShipmentOrderProcessor.process(Node) line: 199	
		ShipmentOrderBodyProcessor myProcessor = Factory.getFactory().getInstance(ShipmentOrderBodyProcessor.class);
			myProcessor.setProcessingContext(getProcessingContext());
			myProcessor.setParent(this);
			myShipmentOrderVO = myProcessor.process(selectSingleNode(aNode, SHIPMENT_ORDER_BODY_TAG));
/s
ShipmentOrderBodyProcessor.process(Node) line: 455	
			ShipmentOrderVO myShipmentOrderVO = ShipmentOrderVOFactory.getShipmentOrderVO();
/ WH met new	, 
/ TODO

			MpoBeanFactory.getBean(EntityDetailService.class).initialize(myShipmentOrderVO);
/s
EntityDetailServiceImpl.initialize(EntityDetailSupport) line: 126	
		List<EntityDetailType> myList = entityDetailTypeDAO.getByEntity(anEntityDetailSupport.getEntity());
anEntityDetailSupport.getEntity()=SHIPMENT_ORDER
/ myList=
[SystemId:27043050	IsDeleted:false	Detail Type:deliveryCode	ValueType:STRING	, 
SystemId:27142548	IsDeleted:false	Detail Type:Employee Nbr	ValueType:STRING	, 
SystemId:27142549	IsDeleted:false	Detail Type:Employee Name	ValueType:STRING	, 
SystemId:27043219	IsDeleted:false	Detail Type:DepartmentCode	ValueType:STRING	]

/ Klopt,	 in entity_detail_type zijn er 4 met entity="SHIPMENT_ORDER"	,
/ Deze query heeft dus niets met de onze sho's te maken	,


		if (anEntityDetailSupport.getEntityDetails() != null) {
{}
/ want anEntityDetailSupport= sho 	, created met new hierboven	, in ShipmentOrderBodyProcessor.process(Node)
			myList.removeAll(anEntityDetailSupport.getEntityDetails().keySet());
		}

		for (EntityDetailType myEntityDetailType : myList) {
			anEntityDetailSupport.setEntityDetail(myEntityDetailType, spaceAsInitialValue ? " " : "");
		}

/t
ShipmentOrderBodyProcessor.process(Node) line: 459	

              <so:SHIPMENT_ORDER_BODY>
                  <mtccore:SHIPMENT_ORDER_ID>2589</mtccore:SHIPMENT_ORDER_ID>
                  <mtccore:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtccore:ORGANIZATION_ID>
               </so:SHIPMENT_ORDER_BODY>
/ Klein dus,
			MpoBeanFactory.getBean(EntityDetailService.class).initialize(myShipmentOrderVO);
/d

			myShipmentOrderVO.setSyncToFlag(getSyncFlag("to"));
			myShipmentOrderVO.setSyncFromFlag(getSyncFlag("from"));
			myShipmentOrderVO.setSyncBillToFlag(getSyncFlag("billto"));
			myShipmentOrderVO.setSyncEmployeeResponsibleFlag(getSyncFlag("employeeresponsible"));

			// Defaults for the object, must be set before node processing
			myShipmentOrderVO.setShipmentOrderProcess(OrderProcess.OUTBOUND);

			Node myNode = selectSingleNode(aNode, ORGANIZATION_ID_TAG);
			if (myNode != null) {
				Organization myOrganizationVO = OrganizationUtil.getOrganizationFacadeLocal().getOrganization(myNode.getTextContent());
SystemId:12000	Id:LOG_EMEA_FR_CT_PSA	Description:Organization for PSA CT
/ Klopt	,
                  <mtccore:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtccore:ORGANIZATION_ID>
				if (myOrganizationVO != null) {
					myShipmentOrderVO.setOrganizationVO(myOrganizationVO);

			while (childNode != null) {
              <so:SHIPMENT_ORDER_BODY>
                  <mtccore:SHIPMENT_ORDER_ID>2589</mtccore:SHIPMENT_ORDER_ID>
 
					String myTag = getElementName(childNode);
SHIPMENT_ORDER_ID
					} else if (SHIPMENT_ORDER_ID_TAG.equals(myTag)) {
						String nodeText = childNode.getTextContent();
"2589"
						myShipmentOrderVO.setShipmentOrderId(nodeText);
						if (getProcessingContext() != null) {
							getProcessingContext().addToProcessingContext(SHIPMENT_ORDER_ID_TAG, nodeText);
/ TODO
{ProcessingContext: SHIPMENT_ORDER_ID[2589]}

				childNode = childNode.getNextSibling();
/ volgende,	
			while (childNode != null) {
					String myTag = getElementName(childNode);
ORGANIZATION_ID
/ AL	,

			myShipmentOrderVO.setSystemEntryDate(MpoBeanFactory.getBean(TimeService.class).getPresentDate());

			myShipmentOrderVO.resolveShipmentType();
/s
ShipmentOrderVO.resolveShipmentType() line: 2067	
		boolean enabled = ApplicationPropertyManager.getInstance().getModuleProperty("oms", "resolve.shipmenttype.enabled", false);
		if (!enabled) {
/ JA
			return;
		}
/t
ShipmentOrderBodyProcessor.process(Node) line: 639	
			myShipmentOrderVO.resolveShipmentType();
/d
			return myShipmentOrderVO;
/t
ShipmentOrderProcessor.process(Node) line: 208	
			myShipmentOrderVO = myProcessor.process(selectSingleNode(aNode, SHIPMENT_ORDER_BODY_TAG));
/d
			List<ProductItemVO> myProductList = parseProductItems(aNode, myShipmentOrderVO);
aNode=<so:SHIPMENT_ORDER>
/s
ShipmentOrderProcessor.parseProductItems(Node, ShipmentOrderVO) line: 140	

/ Intermezzo

            <so:SHIPMENT_ORDER>
               <so:SHIPMENT_ORDER_BODY>
                  <mtccore:SHIPMENT_ORDER_ID>2589</mtccore:SHIPMENT_ORDER_ID>
                  <mtccore:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtccore:ORGANIZATION_ID>
               </so:SHIPMENT_ORDER_BODY>
               <so:PRODUCT_ITEMS>
                  <mtccore:PRODUCT_ITEM>
                     <mtccore:PRODUCT_ITEM_ID>MPO_Prod1</mtccore:PRODUCT_ITEM_ID>
                     <mtccore:SHIPMENT_ORDER_ID>ID TRANSPORT</mtccore:SHIPMENT_ORDER_ID>
                     <mtccore:PRODUCT>
                        <mtccore:PRODUCT_ID>MPO_Prod1</mtccore:PRODUCT_ID>
                        <mtccore:DESCRIPTION>SUPPORT INTERRUPTEUR CONSOLE PAVILL</mtccore:DESCRIPTION>
                     </mtccore:PRODUCT>
                     <mtccore:QUANTITY>20</mtccore:QUANTITY>
                  </mtccore:PRODUCT_ITEM>
                  <mtccore:PRODUCT_ITEM>
                     <mtccore:PRODUCT_ITEM_ID>MPO_Prod2</mtccore:PRODUCT_ITEM_ID>
                     <mtccore:SHIPMENT_ORDER_ID>ID TRANSPORT</mtccore:SHIPMENT_ORDER_ID>
                     <mtccore:PRODUCT>
                        <mtccore:PRODUCT_ID>MPO_Prod2</mtccore:PRODUCT_ID>
                        <mtccore:DESCRIPTION>SUPPORT INTERRUPTEUR CONSOLE PAVILL</mtccore:DESCRIPTION>
                     </mtccore:PRODUCT>
                     <mtccore:QUANTITY>12</mtccore:QUANTITY>
                  </mtccore:PRODUCT_ITEM>
               </so:PRODUCT_ITEMS>

/ EInde Intermezzo

		Node myItemsNode = selectSingleNode(aNode, PRODUCT_ITEMS_TAG);
		ProductItemProcessor productItemProcessor = new ProductItemProcessor(this);
...
		while (myNode != null) {
				if (PRODUCT_ITEM_TAG.equals(getElementName(myNode))) {
					ProductItemVO myProductItem = productItemProcessor.process(myNode, myShipmentOrderVO);
/s
ProductItemProcessor.process(Node, ShipmentOrderVO) line: 319	
/ process een pi	,

			ProductItemVO myItemVO = new ProductItemVO();

			MpoBeanFactory.getBean(EntityDetailService.class).initialize(myItemVO);
/ WH GEEN	,
			while (childNode != null) {
					String tag = getElementName(childNode);
PRODUCT_ITEM_ID
					if (PRODUCT_ITEM_ID_TAG.equals(tag)) {
						myItemVO.setProductItemId(childNode.getTextContent());
theProductItemId=MPO_Prod1

/ volgende	,
			while (childNode != null) {
					String tag = getElementName(childNode);
SHIPMENT_ORDER_ID
					} else if (SHIPMENT_ORDER_ID_TAG.equals(tag)) {
						myItemVO.setParsedShipmentOrderId(childNode.getTextContent());
parsedShipmentOrderId=ID TRANSPORT
/ TODO

/ volgende	,
			while (childNode != null) {
					String tag = getElementName(childNode);
PRODUCT
					} else if (ProductProcessor.PRODUCT_TAG.equals(tag)) {
						LOG.warn("Parsing product info on product item is not supported, ignoring...");
/ JAN

/ volgende	,
			while (childNode != null) {
					String tag = getElementName(childNode);
QUANTITY
					} else if (QUANTITY_TAG.equals(tag)) {
						myItemVO.setQuantity(new BigDecimal(childNode.getTextContent()));
myItemVO(='n ProductItemVO).theQuantity=20
/ TODO (Wat doet deze quantity?)
/ See hieronder: de packed item in de shi bij dit product item heeft ook een quantity	, en deze wordt used	,

/t
ShipmentOrderProcessor.parseProductItems(Node, ShipmentOrderVO) line: 153	
		while (myNode != null) {
			if (myNode.getNodeType() == Node.ELEMENT_NODE) {
				if (PRODUCT_ITEM_TAG.equals(getElementName(myNode))) {
					ProductItemVO myProductItem = productItemProcessor.process(myNode, myShipmentOrderVO);
/d
					myProductList.add(myProductItem);

/ volgende	,
		while (myNode != null) {
			if (myNode.getNodeType() == Node.ELEMENT_NODE) {
				if (PRODUCT_ITEM_TAG.equals(getElementName(myNode))) {
					ProductItemVO myProductItem = productItemProcessor.process(myNode, myShipmentOrderVO);
/s
ProductItemProcessor.process(Node, ShipmentOrderVO) line: 312	

			ProductItemVO myItemVO = new ProductItemVO();

			Node childNode = aNode.getFirstChild();
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
PRODUCT_ITEM_ID
					if (PRODUCT_ITEM_ID_TAG.equals(tag)) {
						// uniqueId = childNode.getTextContent();
						myItemVO.setProductItemId(childNode.getTextContent());
theProductItemId	"MPO_Prod2" (id=33698)	

					} else if (QUANTITY_TAG.equals(tag)) {
						myItemVO.setQuantity(new BigDecimal(childNode.getTextContent()));
theQuantity	12.00
			return itemVO
/t
ShipmentOrderProcessor.parseProductItems(Node, ShipmentOrderVO) line: 153	
		Node myNode = myItemsNode.getFirstChild();
		while (myNode != null) {
			if (myNode.getNodeType() == Node.ELEMENT_NODE) {
				if (PRODUCT_ITEM_TAG.equals(getElementName(myNode))) {
					ProductItemVO myProductItem = productItemProcessor.process(myNode, myShipmentOrderVO);
/d
					myProductList.add(myProductItem);
				}
			}
			myNode = myNode.getNextSibling();
		}
		return myProductList;
/t
ShipmentOrderProcessor.process(Node) line: 215	
			List<ProductItemVO> myProductList = parseProductItems(aNode, myShipmentOrderVO);
/d
			List<ShipmentItemVO> myShipmentItems = parseShipmentItems(aNode, myProductList, myShipmentOrderVO.getOrganizationSystemid());
/s
ShipmentOrderVO(ResourceProtectedValueObject).getOrganizationSystemid() line: 23	
this	ShipmentOrderVO  (id=32955)	
ShipmentOrder: 2589(SystemId:0; Org:LOG_EMEA_FR_CT_PSA)
/ created met new	,
/t
/s
ShipmentOrderProcessor.parseShipmentItems(Node, List<ProductItemVO>, int) line: 164	
/=
	public List<ShipmentItemVO> parseShipmentItems(Node aNode, List<ProductItemVO> aProductList, int anOrganizationSystemId) throws TransformerException,
aProductList=list van 2 product items	, zojuist created	, MPO_Prod1 en MPO_Prod2	,

              <so:PRODUCT_ITEMS>
                  <mtccore:PRODUCT_ITEM>
                     <mtccore:PRODUCT_ITEM_ID>MPO_Prod1</mtccore:PRODUCT_ITEM_ID>
                     <mtccore:SHIPMENT_ORDER_ID>ID TRANSPORT</mtccore:SHIPMENT_ORDER_ID>
                     <mtccore:PRODUCT>
                        <mtccore:PRODUCT_ID>MPO_Prod1</mtccore:PRODUCT_ID>
                        <mtccore:DESCRIPTION>SUPPORT INTERRUPTEUR CONSOLE PAVILL</mtccore:DESCRIPTION>
                     </mtccore:PRODUCT>
                     <mtccore:QUANTITY>20</mtccore:QUANTITY>
                  </mtccore:PRODUCT_ITEM>
                  <mtccore:PRODUCT_ITEM>
                     <mtccore:PRODUCT_ITEM_ID>MPO_Prod2</mtccore:PRODUCT_ITEM_ID>
                     <mtccore:SHIPMENT_ORDER_ID>ID TRANSPORT</mtccore:SHIPMENT_ORDER_ID>
                     <mtccore:PRODUCT>
                        <mtccore:PRODUCT_ID>MPO_Prod2</mtccore:PRODUCT_ID>
                        <mtccore:DESCRIPTION>SUPPORT INTERRUPTEUR CONSOLE PAVILL</mtccore:DESCRIPTION>
                     </mtccore:PRODUCT>
                     <mtccore:QUANTITY>12</mtccore:QUANTITY>
                  </mtccore:PRODUCT_ITEM>
               </so:PRODUCT_ITEMS>

              <so:SHIPMENT_ITEMS>
                  <mtccore:SHIPMENT_ITEM>
                     <mtccore:SHIPMENT_ITEM_ID>Box1</mtccore:SHIPMENT_ITEM_ID>
                     <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:PRODUCT_ITEM_ID>MPO_Prod1</mtccore:PRODUCT_ITEM_ID>				/ refers to product item above,	
                           <mtccore:SHIPMENT_ORDER_ID>ID TRANSPORT</mtccore:SHIPMENT_ORDER_ID>
                           <mtccore:QUANTITY>12</mtccore:QUANTITY>
                        </mtccore:PACKED_ITEM>
                     </mtccore:PACKED_ITEMS>
                     <mtccore:PACKAGE_CODE>00112</mtccore:PACKAGE_CODE>
                     <mtccore:LABEL_NUMBER>7N3G9F9F9</mtccore:LABEL_NUMBER>
                     <mtccore:AIRWAYBILL_NUMBER>ID TRANSPORT</mtccore:AIRWAYBILL_NUMBER>
                     <mtccore:CASE_NUMBER>BOX1</mtccore:CASE_NUMBER>
                     <mtccore:CONTAINER_NUMBER>100971646</mtccore:CONTAINER_NUMBER>
                     <mtccore:SHIPMENT_ITEM_REFERENCE>
                        <mtccore:VALUE/>
                        <mtccore:QUALIFIER>REFERENCE1</mtccore:QUALIFIER>
                     </mtccore:SHIPMENT_ITEM_REFERENCE>
                     <mtccore:SHIPMENT_ITEM_REFERENCE>
                        <mtccore:VALUE>ID TRANSPORT</mtccore:VALUE>
                        <mtccore:QUALIFIER>REFERENCE2</mtccore:QUALIFIER>
                     </mtccore:SHIPMENT_ITEM_REFERENCE>
                     <mtccore:SHIPMENT_ITEM_REFERENCE>
                        <mtccore:VALUE>FR</mtccore:VALUE>
                        <mtccore:QUALIFIER>REFERENCE3</mtccore:QUALIFIER>
                     </mtccore:SHIPMENT_ITEM_REFERENCE>
                  </mtccore:SHIPMENT_ITEM>

		  		  <mtccore:SHIPMENT_ITEM>
                     <mtccore:SHIPMENT_ITEM_ID>Box2</mtccore:SHIPMENT_ITEM_ID>
                     <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:PRODUCT_ITEM_ID>MPO_Prod1</mtccore:PRODUCT_ITEM_ID>
                           <mtccore:SHIPMENT_ORDER_ID>ID TRANSPORT</mtccore:SHIPMENT_ORDER_ID>
                           <mtccore:QUANTITY>5</mtccore:QUANTITY>
                        </mtccore:PACKED_ITEM>
                     </mtccore:PACKED_ITEMS>
                     <mtccore:PACKAGE_CODE/>
                     <mtccore:LABEL_NUMBER>T31MB26BA</mtccore:LABEL_NUMBER>
                     <mtccore:AIRWAYBILL_NUMBER>ID TRANSPORT</mtccore:AIRWAYBILL_NUMBER>
                     <mtccore:CASE_NUMBER>BOX2</mtccore:CASE_NUMBER>
                     <mtccore:CONTAINER_NUMBER>100971646</mtccore:CONTAINER_NUMBER>
                     <mtccore:SHIPMENT_ITEM_REFERENCE>
                        <mtccore:VALUE/>
                        <mtccore:QUALIFIER>REFERENCE1</mtccore:QUALIFIER>
                     </mtccore:SHIPMENT_ITEM_REFERENCE>
                     <mtccore:SHIPMENT_ITEM_REFERENCE>
                        <mtccore:VALUE>ID TRANSPORT</mtccore:VALUE>
                        <mtccore:QUALIFIER>REFERENCE2</mtccore:QUALIFIER>
                     </mtccore:SHIPMENT_ITEM_REFERENCE>
                     <mtccore:SHIPMENT_ITEM_REFERENCE>
                        <mtccore:VALUE>FR</mtccore:VALUE>
                        <mtccore:QUALIFIER>REFERENCE3</mtccore:QUALIFIER>
                     </mtccore:SHIPMENT_ITEM_REFERENCE>
                  </mtccore:SHIPMENT_ITEM>


		Node shipmentItemsNode = selectSingleNode(aNode, SHIPMENT_ITEMS_TAG);
		for (ProductItemVO myProductItem : aProductList) {
aProductList=list van 2 product items	, MPO_Prod1 en MPO_Prod2	,


		Map<String, ProductItemVO> myProductMap = new HashMap<String, ProductItemVO>();
		for (ProductItemVO myProductItem : aProductList) {
			if (StringUtils.isNotBlank(myProductItem.getProductItemId())) {
/ JA	,
MPO_Prod1
MPO_Prod2
				if (StringUtils.isNotBlank(myProductItem.getParsedShipmentOrderId())) {
/ JA	,
ID TRANSPORT
					myProductMap.put(myProductItem.getParsedShipmentOrderId() + "-" + myProductItem.getProductItemId(), myProductItem);
{ID TRANSPORT-MPO_Prod1=PRODUCT_ITEM id:null(systemId:0)}
{ID TRANSPORT-MPO_Prod1=PRODUCT_ITEM id:null(systemId:0), ID TRANSPORT-MPO_Prod2=PRODUCT_ITEM id:null(systemId:0)}


		ShipmentItemProcessor myProcessor = Factory.getFactory().getInstance(ShipmentItemProcessor.class);
		myProcessor.setParent(this);
		Node myNode = shipmentItemsNode.getFirstChild();
		while (myNode != null) {
			if (myNode.getNodeType() == Node.ELEMENT_NODE) {
				if (SHIPMENT_ITEM_TAG.equals(getElementName(myNode))) {
					ShipmentItemVO myItemVO = myProcessor.process(myNode, myProductMap, anOrganizationSystemId);
/s
ShipmentItemProcessor.process(Node, Map<String,ProductItemVO>, int) line: 355	
			ShipmentItemVO myItemVO = ShipmentItemVOFactory.getShipmentItemVO();
/ WH new	,
			MpoBeanFactory.getBean(EntityDetailService.class).initialize(myItemVO);
/ GEEN	,
			Node childNode = aNode.getFirstChild();
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
SHIPMENT_ITEM_ID
					} else if (SHIPMENT_ITEM_ID_TAG.equals(tag)) {
						myItemVO.setShipmentItemId(childNode.getTextContent());
Box1

/ volgende	,
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
PACKED_ITEMS
					} else if (PACKED_ITEMS_TAG.equals(tag)) {
						for (PackedItemVO item : parsePackedItems(childNode, aProducts)) {
/s
ShipmentItemProcessor.parsePackedItems(Node, Map<String,ProductItemVO>) line: 569	

		List<PackedItemVO> myPackedItems = new ArrayList<PackedItemVO>();
		for (Node aPackedItemNode : selectNodeIterable(aNode, PACKED_ITEM_TAG)) {
			String productItemId = getTextNode(aPackedItemNode, PRODUCT_ITEM_ID_TAG);
MPO_Prod1
			BigDecimal myQuantity = parseDecimalNodeValue(aPackedItemNode, PRODUCT_QUANTITY_TAG);
12
			BigDecimal myActualQuantity = parseDecimalNodeValue(aPackedItemNode, MTCCoreNames.ACTUAL_QUANTITY);
null
			String myParserShipmentOrderId = getTextNode(aPackedItemNode, PARSED_SHIPMENT_ORDER_ID_TAG);
ID TRANSPORT
PARSED_SHIPMENT_ORDER_ID_TAG="SHIPMENT_ORDER_ID"

			String internalId = getTextNode(aPackedItemNode, INTERNAL_ID_TAG);
""
			if (StringUtils.isNotEmpty(myParserShipmentOrderId)) {
				myProduct = aProducts.get(myParserShipmentOrderId + "-" + productItemId);
aProducts={ID TRANSPORT-MPO_Prod1=PRODUCT_ITEM id:null(systemId:0)}
////////////////////////////////////
/ Dus de PRODUCT_ITEM_ID in een packed item refers to de product item eerder ingelezen hierboven	,
/ En wordt dus echt used	, want komt in new PackedItem hier beneden	,  

/ Intermezzo

			ProductItemVO myProduct = null;
			if (StringUtils.isNotEmpty(myParserShipmentOrderId)) {
				myProduct = aProducts.get(myParserShipmentOrderId + "-" + productItemId);
			} else {
				myProduct = aProducts.get(productItemId);
			}
			if (myProduct == null) {
				throw new IllegalArgumentException("Packed item points to non-existing product: " + aPackedItemNode);
			}

/ Als MPO_Prod1 niet in aProducts is	, dan ERR	, 

/////////////////////////////////////////////////////////////////////////
/ In feite	, open op acc sho SH000001253-20160411-115803	, 
/ open een shi, die packed items heeft	, een pallet heeft deze bijv niet	,
/ we open hipment Item 0070	, we zien KL0SQE8J7-R	, deze heeft 1 product item met Quantity >0	, dit is dan de product item in deze doos 	, in PSA heeft een doos 1 product	, 
/ we zullen straks de shi zoeken op het label  KL0SQE8J7-R	, en vinden met Quantity>0 het product in de shi	, 


/ Einde Intermezzo

			PackedItemVO myPackedItem = new PackedItemVO(myProduct, myQuantity);
myPackedItem.theQuantity=12
myPackedItem.theProductItemVO.theQuantity=20
/ WH NIET used	,

			if (StringUtils.isNotEmpty(myParserShipmentOrderId)) {
				myPackedItem.setParsedShipmentOrderId(myParserShipmentOrderId);
ID TRANSPORT
/ Een PRODUCT_ITEM deed dit ook al	, 
/ TODO
			}
			myPackedItems.add(myPackedItem);
		return myPackedItems;

/ In een shi zit 1 packed item , er zit maar 1 product in de shi	,

/t
ShipmentItemProcessor.process(Node, Map<String,ProductItemVO>, int) line: 373	
					} else if (PACKED_ITEMS_TAG.equals(tag)) {
						for (PackedItemVO item : parsePackedItems(childNode, aProducts)) {
/d
							myItemVO.addPackedItem(item);

/ per shi kunnen er meerdere packed items zijn, als er nl. meerdere products in de shi zitten	,
/ Nu maar 1	,

/ volgende (child van de shi)
			while (childNode != null) {
					String tag = getElementName(childNode);
PACKAGE_CODE
/ WH NIET processed	,
/ JAN


/ volgende (child van de shi)
			while (childNode != null) {
					String tag = getElementName(childNode);
LABEL_NUMBER
					} else if (LABEL_NUMBER_TAG.equals(tag)) {
						myItemVO.setLabelInfo(childNode.getTextContent());
myItemVO.theLabelInfo=LA2JS1QEV

/ volgende (child van de shi)
			while (childNode != null) {
					String tag = getElementName(childNode);
AIRWAYBILL_NUMBER
					} else if (AIRWAYBILL_NUMBER_TAG.equals(tag)) {
						myItemVO.setAirwaybillNumber(childNode.getTextContent());

/ volgende (child van de shi)
			while (childNode != null) {
					String tag = getElementName(childNode);
CASE_NUMBER
					} else if (CASE_NUMBER_TAG.equals(tag)) {
						myItemVO.setCaseNumber(childNode.getTextContent());

/ volgende (child van de shi)
			while (childNode != null) {
					String tag = getElementName(childNode);
CONTAINER_NUMBER
					} else if (CONTAINER_NUMBER_TAG.equals(tag)) {
						myItemVO.setContainerNumber(childNode.getTextContent());
100971646

/ volgende	,
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
SHIPMENT_ITEM_REFERENCE
					if (SHIPMENT_ITEM_REFERENCE_TAG.equals(tag)) {
						processReference(childNode, myItemVO);
/s
ShipmentItemProcessor.processReference(Node, ShipmentItemVO) line: 608	
		ReferenceVO myReference = new ReferenceProcessor(this).process(aNode);
/s
ReferenceProcessor.process(Node) line: 39	
		ReferenceVO myVO = new ReferenceVO();
		while (childNode != null) {
			if (childNode.getNodeType() == Node.ELEMENT_NODE) {
				String tag = getElementName(childNode);
VALUE

/ Intermezzo

/ we zijn in	,

Thread [GeoScoQueueContainer-1] (Suspended)	
	ReferenceProcessor.process(Node) line: 46	
	ShipmentItemProcessor.processReference(Node, ShipmentItemVO) line: 609	
	ShipmentItemProcessor.process(Node, Map<String,ProductItemVO>, int) line: 367	
	ShipmentOrderProcessor.parseShipmentItems(Node, List<ProductItemVO>, int) line: 189	
	ShipmentOrderProcessor.process(Node) line: 215	
	GeoScoServiceOrderProcessor(ServiceOrderProcessorImpl).processConsignments(Node, ServiceOrderVO) line: 356	
	GeoScoServiceOrderProcessor.processDespatchAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 403	
	GeoScoServiceOrderProcessor.process(Node) line: 248	
	ServiceOrderMsgProcessor.process(Node) line: 91	
	ServiceOrderMsgConsumer.process(Message) line: 52	
	ServiceOrderMsgConsumer(MessageConsumer).handle(Message) line: 108	
	MessageConsumerHandler$$EnhancerBySpringCGLIB$$ca5a33ca(MessageConsumerHandler).onExchange(MessageExchange) line: 172	
	MessageConsumerHandler$$EnhancerBySpringCGLIB$$ca5a33ca(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 43	
	SingletonExchangeHandlerChain.next(MessageExchange) line: 43	
	DemuxExchangeHandler.handleMessage(ExchangeHandler, MessageExchange) line: 110	
	DemuxExchangeHandler.onExchange(MessageExchange) line: 123	
	DemuxExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 43	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	TxExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	TxExchangeHandler.handleExchange(ExchangeHandlerChain, MessageExchange) line: 62	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	MessageTraceExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	AuthNExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	ArchiveExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	SapXConverterExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	ArchiveErrorExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	RetryExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	RetryExchangeHandler.handleExchange(ExchangeHandlerChain, MessageExchange) line: 80	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	MessageHandler.handleExchange(MessageExchange) line: 55	
	MpoMessageListener.processMessage(Message, JmsMpoMessage) line: 378	
	MpoMessageListener.onMessage(Message) line: 199	
...
	Thread.run() line: 745	

/ Einde Intermezzo

				if (VALUE_TAG.equals(tag)) {
					myVO.setValue(StringUtils.filterNullValue(childNode.getTextContent()));
myVO=ReferenceVO	,

/ volgende	,
		while (childNode != null) {
			if (childNode.getNodeType() == Node.ELEMENT_NODE) {
				String tag = getElementName(childNode);
QUALIFIER
				} else if (QUALIFIER_TAG.equals(tag)) {
					myVO.setQualifier(StringUtils.filterNullValue(childNode.getTextContent()));

		return myVO;
myVO	ReferenceVO  (id=20896)	
	theQualifier	"REFERENCE1" (id=20911)	
	theValue	"" (id=20731)	

/t
ShipmentItemProcessor.processReference(Node, ShipmentItemVO) line: 610	
		ReferenceVO myReference = new ReferenceProcessor(this).process(aNode);
/d
		String myQualifier = myReference.getQualifier();
		if (myQualifier != null) {
			myQualifier = myQualifier.trim();
			if (myQualifier.equals(REFERENCE1_QUALIFIER)) {
				aItemVO.setReference1(myReference.getValue());
aItemVO=ShipmentItemVO	,
aItemVO.theReference1=""

/ De reference's zijn dus geen sub obj's in een shi	, maar het gaat zo: 
shi.theReference1=value	,
/ straks	,
shi.theReference2=value	,

/t
ShipmentItemProcessor.process(Node, Map<String,ProductItemVO>, int) line: 367	
					if (SHIPMENT_ITEM_REFERENCE_TAG.equals(tag)) {
						processReference(childNode, myItemVO);
/d
/ volgende	,
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
SHIPMENT_ITEM_REFERENCE
					if (SHIPMENT_ITEM_REFERENCE_TAG.equals(tag)) {
						processReference(childNode, myItemVO);
/s
ShipmentItemProcessor.processReference(Node, ShipmentItemVO) line: 616	
		ReferenceVO myReference = new ReferenceProcessor(this).process(aNode);
myReference	ReferenceVO  (id=20952)	
	theQualifier	"REFERENCE2" (id=20953)	
	theValue	"ID TRANSPORT" (id=20963)	
			} else if (myQualifier.equals(REFERENCE2_QUALIFIER)) {
				aItemVO.setReference2(myReference.getValue());
/t
ShipmentItemProcessor.process(Node, Map<String,ProductItemVO>, int) line: 367	
						processReference(childNode, myItemVO);
/d
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					if (SHIPMENT_ITEM_REFERENCE_TAG.equals(tag)) {
						processReference(childNode, myItemVO);
/d
/ Reference3 net zo	, 
/ volgende	,
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
/ GEEN
			parsePackageCode(aNode, myItemVO, anOrganizationSystemid);
/ TODO	, WH NIET	,

			return myItemVO;

/t
ShipmentOrderProcessor.parseShipmentItems(Node, List<ProductItemVO>, int) line: 189	

		List<ShipmentItemVO> myShipmentItems = new ArrayList<ShipmentItemVO>();
...
		while (myNode != null) {
			if (myNode.getNodeType() == Node.ELEMENT_NODE) {
				if (SHIPMENT_ITEM_TAG.equals(getElementName(myNode))) {
					ShipmentItemVO myItemVO = myProcessor.process(myNode, myProductMap, anOrganizationSystemId);
/d
					myShipmentItems.add(myItemVO);
/ we geloven het	,
/c
		return myShipmentItems;
myShipmentItems	ArrayList  (id=20089)	
	elementData	Object[10]  (id=20816)	
		[0]	ShipmentItemVO  (id=20218)	
shipmentItem: Box1(systemId:0, labelInfo:7N3G9F9F9)
		[1]	ShipmentItemVO  (id=20810)	
shipmentItem: Box2(systemId:0, labelInfo:T31MB26BA)

/t
ShipmentOrderProcessor.process(Node) line: 217	
			List<ShipmentItemVO> myShipmentItems = parseShipmentItems(aNode, myProductList, myShipmentOrderVO.getOrganizationSystemid());
/d
			ArrayList<CustomerOrder> customerOrders = parseCustomerOrders(aNode);
[]
			ParsedShipmentOrder myRet = new ParsedShipmentOrder(myShipmentOrderVO, myProductList, myShipmentItems);
/s
	public ParsedShipmentOrder(ShipmentOrderVO aShipmentOrder, Collection<ProductItemVO> aProductItems, Collection<ShipmentItemVO> aShipmentItems) {
		shipmentOrder = aShipmentOrder;
		productItems = new TreeSet<ProductItemVO>(new StringSequencedEntityComparator());
		productItems.addAll(aProductItems);
		shipmentItems = new TreeSet<ShipmentItemVO>(new StringSequencedEntityComparator());
		shipmentItems.addAll(aShipmentItems);
		customerOrders = new ArrayList<CustomerOrder>();
	}
myShipmentOrderVO	ShipmentOrderVO  (id=1044)	
ShipmentOrder: 2589(SystemId:0; Org:LOG_EMEA_FR_CT_PSA)
myProductList	ArrayList  (id=19703)	
[PRODUCT_ITEM id:null(systemId:0)]			/ Eig. 2	,
myShipmentItems	ArrayList  (id=20089)	
[shipmentItem: Box1(systemId:0, labelInfo:7N3G9F9F9), shipmentItem: Box2(systemId:0, labelInfo:T31MB26BA)]

			myRet.setCustomerOrders(customerOrders);
			return myRet;
/t
GeoScoServiceOrderProcessor(ServiceOrderProcessorImpl).processConsignments(Node, ServiceOrderVO) line: 357	
					for (Node myShipmentOrderNode : myShipmentOrderIterator) {
							ParsedShipmentOrder myParsedShipmentOrderVO = new ShipmentOrderProcessor().process(myShipmentOrderNode);
/d
							ShipmentOrderVO myShipmentOrderVO = myParsedShipmentOrderVO.getShipmentOrder();
ShipmentOrder: 2589(SystemId:0; Org:LOG_EMEA_FR_CT_PSA)
							myShipmentOrderVO.setProductItemList(myParsedShipmentOrderVO.getProductItemList());
theProductItemList=
[PRODUCT_ITEM MPO_Prod1 id:null(systemId:0), PRODUCT_ITEM MPO_Prod2 id:null(systemId:0)]
							myShipmentOrderVO.setShipmentItemList(myParsedShipmentOrderVO.getShipmentItemList());
thiShipmentItemList=
[shipmentItem: Box1(systemId:0, labelInfo:7N3G9F9F9), shipmentItem: Box2(systemId:0, labelInfo:T31MB26BA)]

							ServiceActionVO myServiceAction = new ServiceActionVO();
							myServiceAction.setShipmentOrderVO(myShipmentOrderVO);	// sho > {sa} , seo (via > {cons}) > {sa}	, andere coll	,
							myServiceAction.setConsignmentVO(myConsignment);		// seo > {cons}	, cons={sa}
/ Klopt	, 
geosco2a=# \d service_action
 consignment_systemid           | integer                     | 
 shipment_order_systemid        | integer                     | 

							myConsignment.setServiceOrderVO(serviceOrder);			// seo > {cons}
							myShipmentOrderVO.addServiceAction(myServiceAction);
/ Pointers terug	,

/ Intermezzo

/ we zien many-to-one ook in H. 	,

$ vi ServiceAction.standard.hbm.xml

		<many-to-one name="shipmentOrderVO" class="com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO" fetch="select">
			<column name="SHIPMENT_ORDER_SYSTEMID" />
		</many-to-one>

		<many-to-one name="consignmentVO" class="com.mpobjects.oms.model.consignment.vo.ConsignmentVO" fetch="select">
			<column name="CONSIGNMENT_SYSTEMID" />
		</many-to-one>

$ vi ShipmentOrder.standard.hbm.xml

		<set name="serviceActionList" cascade="all-delete-orphan" sort="com.mpobjects.util.dao.SequencedEntityComparator" >
			<cache usage="read-write" />
			<key column="SHIPMENT_ORDER_SYSTEMID" />
			<one-to-many class="com.mpobjects.oms.model.serviceaction.vo.ServiceActionVO" />
		</set>

$ vi Consignment.standard.hbm.xml

		<bag name="serviceActionList" >
         	<key column="CONSIGNMENT_SYSTEMID"/>
         	<one-to-many class="com.mpobjects.oms.model.serviceaction.vo.ServiceActionVO"/>
      	</bag>

/ Einde Intermezzo
							myServiceActionList.add(myServiceAction);
/t
			for (Node myConsignmentNode : myConsignmentIterator) {
					for (Node myShipmentOrderNode : myShipmentOrderIterator) {
/ volgende	,
/ GEEN	,
					myConsignment.setServiceActionList(myServiceActionList);		// cons={sa}
					myConsignmentList.add(myConsignment);

			for (Node myConsignmentNode : myConsignmentIterator) {
/ volgende	,
/ GEEN	,

			serviceOrder.setConsignmentList(myConsignmentList);		/ seo > {cons}

/t
GeoScoServiceOrderProcessor.processDespatchAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 404	
		ServiceOrderVO updateServiceOrderVO = aProcessor.process(selectSingleNode(aNode, SERVICE_ORDER_BODY_TAG));
ServiceOrderBodyProcessor aProcessor
		processConsignments(aNode, updateServiceOrderVO);
/d
/ EINDE SERVICE ORDER FROM XML

/ Intermezzo

/ Hoe naar de shi's	?

updateServiceOrderVO	ServiceOrderVO  (id=21519)	
	consignmentList	ArrayList  (id=21493)	
		elementData	Object[10]  (id=22114)	
			[0]	ConsignmentVO  (id=21486)	
				theServiceActionList	ArrayList  (id=21487)	
					elementData	Object[10]  (id=22048)	
						[0]	ServiceActionVO  (id=22157)	
							shipmentOrderVO	ShipmentOrderVO  (id=21452)	
								theShipmentItemList	TreeSet  (id=21618)	
										size	2	

/ we moeten straks blijkbaar de label info's geven	,
/ TODO

/ EInde Intermezzo


		List<ShipmentItemVO> existingShipmentItems = processDesadvServiceOrder(updateServiceOrderVO);
/s
GeoScoServiceOrderProcessor.processDesadvServiceOrder(ServiceOrderVO) line: 903	
		List<ShipmentItemVO> shipmentItems = new ArrayList<ShipmentItemVO>();
		for (ConsignmentVO myConsignmentVO : aUpdateServiceOrderVO.getConsignmentList()) {
			for (ServiceActionVO myServiceActionVO : myConsignmentVO.getServiceActionList()) {
				ShipmentOrderVO myShipmentOrderVO = myServiceActionVO.getShipmentOrderVO();

				Collection<ShipmentItemVO> myExistingItems = processDesAdvShipmentOrder(myShipmentOrderVO);
/s
GeoScoServiceOrderProcessor.processDesAdvShipmentOrder(ShipmentOrderVO) line: 956	
		if (myShipmentOrderVO != null) {
			for (ShipmentItemVO myItem : myShipmentOrderVO.getShipmentItemList()) {
				checkItem(myItem);
/ kijkt of de shi een case number heeft	, BOX1 bijv	,
				myResult.addAll(processDesadvShipmentItem(myItem));
/s
GeoScoServiceOrderProcessor.processDesadvShipmentItem(ShipmentItemVO) line: 933	
		String myLabelInfo = aItem.getLabelInfo();
LA2JS1QEV
		ShipmentItemVO myExistingItem = shipmentItemDAO.getShipmentItem(myLabelInfo);
shipmentItem: 0010(systemId:26888511, labelInfo:LA2JS1QEV)
/ want	,
/s
GeoScoServiceOrderProcessor.processDesadvShipmentItem(ShipmentItemVO) line: 934	
/=
	private Collection<ShipmentItemVO> processDesadvShipmentItem(ShipmentItemVO aItem) {
/ aItem is uit XML	,

		Collection<ShipmentItemVO> myResult = findShipmentItemsByLabel(aLabel);
/s
	private Collection<ShipmentItemVO> findShipmentItemsByLabel(String aLabel) {
		String mySql = "SELECT si.* FROM  SHIPMENT_ITEM si " + " WHERE si." + LABEL_INFO + "=:labelInfo order by si.SYSTEM_ID desc";
		Collection<ShipmentItemVO> myResult = executeSqlSelect(mySql, "si", new StringNamedQueryParameter("labelInfo", aLabel), 1);
		return myResult;
	}
/ NATIVE SQL HIBERNATE
		return myResult.iterator().next();

		if (myExistingItem.getShipmentItemList().isEmpty()) {
/ JA
/= theChildren=[]
			return processDesadvSingleShipmentItem(myExistingItem, aItem);
/s
/ myExistingItem=Uit db	,
/ aItem is uit XML	,
/s
GeoScoServiceOrderProcessor.processDesadvSingleShipmentItem(ShipmentItemVO, ShipmentItemVO) line: 975	
/=
	private Collection<ShipmentItemVO> processDesadvSingleShipmentItem(ShipmentItemVO aExistingItem, ShipmentItemVO aProcessedItem) {

/ we gaan de existing shi aanpassen	met die uit XML	,

		aExistingItem.setCaseNumber(aProcessedItem.getCaseNumber());
		aExistingItem.setContainerNumber(aProcessedItem.getContainerNumber());
		aExistingItem.setReference1(aProcessedItem.getReference1());
		aExistingItem.setReference2(aProcessedItem.getReference2());
		aExistingItem.setReference3(aProcessedItem.getReference3());

		aExistingItem = shipmentItemDAO.save(aExistingItem);
/ shi

		if (aProcessedItem.getPackedItemList().isEmpty()) {
			LOG.error("No packed items for processed shipment item [" + aProcessedItem + "]");
		} else if (aExistingItem.getPackedItemList().isEmpty()) {
			LOG.error("No packed items for existing shipment item [" + aExistingItem + "]");
		} else {
			PackedItemVO myProcessedPackedItemVO = aProcessedItem.getPackedItemList().iterator().next();
/ een shi heeft maar 1 packed item	,
			PackedItemVO myExistingPackedItemVO = aExistingItem.getPackedItemList().iterator().next();
			// This is used to remember the original requested qty. FIXME: refactor when working correctly with
			// quantities
			myExistingPackedItemVO.setRequestedQuantity(myExistingPackedItemVO.getQuantity());
/ TODO (op scherm in shi zien we bij packed item alleen quantity en actual quantity)
/ JAN
			myExistingPackedItemVO.setQuantity(myProcessedPackedItemVO.getQuantity());
/ QUANTITY (IN PACKED ITEM) FROM XML TO DB
			packedItemDAO.save(myExistingPackedItemVO);
/ pi
		List<ShipmentItemVO> myResult = new ArrayList<ShipmentItemVO>();
		myResult.add(aExistingItem);
		return myResult;
...
/t
GeoScoServiceOrderProcessor.processDesAdvShipmentOrder(ShipmentOrderVO) line: 959	
			for (ShipmentItemVO myItem : myShipmentOrderVO.getShipmentItemList()) {
				checkItem(myItem);
				myResult.addAll(processDesadvShipmentItem(myItem));
/d
/ volgende	,
			for (ShipmentItemVO myItem : myShipmentOrderVO.getShipmentItemList()) {
				checkItem(myItem);
				myResult.addAll(processDesadvShipmentItem(myItem));
/s
GeoScoServiceOrderProcessor.processDesadvShipmentItem(ShipmentItemVO) line: 934	
		String myLabelInfo = aItem.getLabelInfo();
A4CI08394
		ShipmentItemVO myExistingItem = shipmentItemDAO.getShipmentItem(myLabelInfo);
		if (myExistingItem.getShipmentItemList().isEmpty()) {
			return processDesadvSingleShipmentItem(myExistingItem, aItem);
/s
GeoScoServiceOrderProcessor.processDesadvSingleShipmentItem(ShipmentItemVO, ShipmentItemVO) line: 975	

		aExistingItem.setCaseNumber(aProcessedItem.getCaseNumber());
		aExistingItem.setContainerNumber(aProcessedItem.getContainerNumber());
		aExistingItem.setReference1(aProcessedItem.getReference1());
		aExistingItem.setReference2(aProcessedItem.getReference2());
		aExistingItem.setReference3(aProcessedItem.getReference3());

		aExistingItem = shipmentItemDAO.save(aExistingItem);

		if (aProcessedItem.getPackedItemList().isEmpty()) {
			LOG.error("No packed items for processed shipment item [" + aProcessedItem + "]");
		} else if (aExistingItem.getPackedItemList().isEmpty()) {
			LOG.error("No packed items for existing shipment item [" + aExistingItem + "]");
		} else {
			PackedItemVO myProcessedPackedItemVO = aProcessedItem.getPackedItemList().iterator().next();
			PackedItemVO myExistingPackedItemVO = aExistingItem.getPackedItemList().iterator().next();
			// This is used to remember the original requested qty. FIXME: refactor when working correctly with
			// quantities
			myExistingPackedItemVO.setRequestedQuantity(myExistingPackedItemVO.getQuantity());
			myExistingPackedItemVO.setQuantity(myProcessedPackedItemVO.getQuantity());
			packedItemDAO.save(myExistingPackedItemVO);
		}

		List<ShipmentItemVO> myResult = new ArrayList<ShipmentItemVO>();
		myResult.add(aExistingItem);
		return myResult;
	}
/t
GeoScoServiceOrderProcessor.processDesAdvShipmentOrder(ShipmentOrderVO) line: 960	
			for (ShipmentItemVO myItem : myShipmentOrderVO.getShipmentItemList()) {
				checkItem(myItem);
				myResult.addAll(processDesadvShipmentItem(myItem));
/d
/////////////////////////////////////////////////////////////////
/ UPDATE PACKED ITEMS
 We hebben uit XML de quantity uit de pi's in de db set	,

		return myResult;
[shipmentItem: 0010(systemId:26888511, labelInfo:LA2JS1QEV), shipmentItem: 0020(systemId:26888512, labelInfo:A4CI08394)]
/t
GeoScoServiceOrderProcessor.processDesadvServiceOrder(ServiceOrderVO) line: 908	

		List<ShipmentItemVO> shipmentItems = new ArrayList<ShipmentItemVO>();
		for (ConsignmentVO myConsignmentVO : aUpdateServiceOrderVO.getConsignmentList()) {
			for (ServiceActionVO myServiceActionVO : myConsignmentVO.getServiceActionList()) {
				ShipmentOrderVO myShipmentOrderVO = myServiceActionVO.getShipmentOrderVO();
ShipmentOrder: 2589(SystemId:0; Org:LOG_EMEA_FR_CT_PSA)
/ Nieuwe sho	, niet die in db (TODO) 

				Collection<ShipmentItemVO> myExistingItems = processDesAdvShipmentOrder(myShipmentOrderVO);
[shipmentItem: 0010(systemId:26888511, labelInfo:LA2JS1QEV), shipmentItem: 0020(systemId:26888512, labelInfo:A4CI08394)]
/d
/ de bestaande shi's (uit de db) zijn processed met data uit XML	,

				// New Logic for PSA-401
				Map<ShipmentOrderVO, Collection<ShipmentItemVO>> myShipmentOrderMap = createShipmentOrderMap(myExistingItems);
/s
GeoScoServiceOrderProcessor.createShipmentOrderMap(Collection<ShipmentItemVO>) line: 707	
		Map<ShipmentOrderVO, Collection<ShipmentItemVO>> myMap = new HashMap<ShipmentOrderVO, Collection<ShipmentItemVO>>();
		for (ShipmentItemVO shipmentItemVO : aExistingItems) {
			ShipmentOrderVO mySho = shipmentItemVO.getShipmentOrderVO();
ShipmentOrder: SH000001417(SystemId:26879741; Org:LOG_EMEA_FR_CT_PSA)

/ Dit is de de bestaande sho uit de db	,  
/ hierboven uit XML hebben we create	,
ShipmentOrder: 2589(SystemId:0; Org:LOG_EMEA_FR_CT_PSA)

			Collection<ShipmentItemVO> myList = myMap.get(mySho);
			if (myList == null) {
				myList = new ArrayList<ShipmentItemVO>();
				myMap.put(mySho, myList);
			myList.add(shipmentItemVO);
		}
		return myMap;
/t
GeoScoServiceOrderProcessor.processDesadvServiceOrder(ServiceOrderVO) line: 908	

				Map<ShipmentOrderVO, Collection<ShipmentItemVO>> myShipmentOrderMap = createShipmentOrderMap(myExistingItems);
{ShipmentOrder: SH000001417(SystemId:26879741; Org:LOG_EMEA_FR_CT_PSA)=
[shipmentItem: 0010(systemId:26888511, labelInfo:LA2JS1QEV), 
shipmentItem: 0020(systemId:26888512, labelInfo:A4CI08394)]}
/ sho en shi's existing	, 

				for (Collection<ShipmentItemVO> myItemsByOrder : myShipmentOrderMap.values()) {
					Collection<ShipmentItemVO> myProcessedItems = createNewShipmentOrderForProcessedItems(myItemsByOrder);
/s
GeoScoServiceOrderProcessor.createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO>) line: 624	

		// Get the existing shipment order
		ShipmentOrderVO myExisting = aExistingItems.iterator().next().getShipmentOrder();

		// Get the top level items
		Collection<ShipmentItemVO> myAll = new ArrayList<ShipmentItemVO>(myExisting.getShipmentItemList());
		myAll.removeAll(aExistingItems);
[]
		if (myAll.isEmpty()) {
///////////////////////////////////////////////////////////////////////////////////////////
			// The current shipment order is processed completely, no need to split.
			updateProductItemsForDesadv(aExistingItems);
/ UPDATE PRODUCT ITEMS
/s
GeoScoServiceOrderProcessor.updateProductItemsForDesadv(Collection<ShipmentItemVO>) line: 1254	
/=
	private void updateProductItemsForDesadv(Collection<ShipmentItemVO> aResult) {
aResult=
[shipmentItem: 0010(systemId:26888511, labelInfo:LA2JS1QEV), shipmentItem: 0020(systemId:26888512, labelInfo:A4CI08394)]

/ Herinner: de quantity in de existing pi's waren updated met die uit XML	, dus deze zijn update	,  

		for (ShipmentItemVO myItem : aResult) {
myItem=shipmentItem: 0010(systemId:26888511, labelInfo:LA2JS1QEV)

			if (!myItem.getPackedItemList().isEmpty()) {
				ProductItemVO myProductItem = myItem.getPackedItemList().get(0).getProductItemVO();
myProductItem=
PRODUCT_ITEM id:null(systemId:26883413)

				myProductItem = productItemDAO.getBySystemId(myProductItem.getSystemId());
PRODUCT_ITEM id:null(systemId:26883413)
/ TODO (We hadden hem toch al?)

				BigDecimal myQty = BigDecimal.ZERO;
				for (PackedItemVO myPacked : myProductItem.getPackedItemList()) {
myPacked=
com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:26888183
myPacked.theQuantity=5
					ShipmentItemVO myPackedInShipmentItem = myPacked.getShipmentItemVO();
shipmentItem: 0020(systemId:26888512, labelInfo:A4CI08394)
					if (StringUtils.isNotEmpty(myPackedInShipmentItem.getCaseNumber())) {
						myQty = myQty.add(myPacked.getQuantity());
+5=5
/ volgende	,
				for (PackedItemVO myPacked : myProductItem.getPackedItemList()) {
myPacked=
com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:26888182
myPacked.theQuantity=12
					ShipmentItemVO myPackedInShipmentItem = myPacked.getShipmentItemVO();
shipmentItem: 0010(systemId:26888511, labelInfo:LA2JS1QEV)
					if (StringUtils.isNotEmpty(myPackedInShipmentItem.getCaseNumber())) {
						myQty = myQty.add(myPacked.getQuantity());
+12=17
				if (myProductItem.getQuantity().compareTo(myQty) != 0) {
					myProductItem.setQuantity(myQty);
					productItemDAO.save(myProductItem);
				}

/ volgende,	
		for (ShipmentItemVO myItem : aResult) {
myItem=
shipmentItem: 0020(systemId:26888512, labelInfo:A4CI08394)
			if (!myItem.getPackedItemList().isEmpty()) {
				ProductItemVO myProductItem = myItem.getPackedItemList().get(0).getProductItemVO();
myProductItem=]
PRODUCT_ITEM id:null(systemId:26883413)
/ die hadden we net ook	,

				myProductItem = productItemDAO.getBySystemId(myProductItem.getSystemId());

				BigDecimal myQty = BigDecimal.ZERO;
				for (PackedItemVO myPacked : myProductItem.getPackedItemList()) {
myPacked=
com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:26888183
					ShipmentItemVO myPackedInShipmentItem = myPacked.getShipmentItemVO();
myPackedInShipmentItem=
shipmentItem: 0020(systemId:26888512, labelInfo:A4CI08394)
					if (StringUtils.isNotEmpty(myPackedInShipmentItem.getCaseNumber())) {
						myQty = myQty.add(myPacked.getQuantity());
+5=5
					}
				}
/ volgende	,
				for (PackedItemVO myPacked : myProductItem.getPackedItemList()) {
myPacked=
com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:26888182
					ShipmentItemVO myPackedInShipmentItem = myPacked.getShipmentItemVO();
myPackedInShipmentItem=
shipmentItem: 0010(systemId:26888511, labelInfo:LA2JS1QEV)
					if (StringUtils.isNotEmpty(myPackedInShipmentItem.getCaseNumber())) {
						myQty = myQty.add(myPacked.getQuantity());
+12=17
					}
				}
				if (myProductItem.getQuantity().compareTo(myQty) != 0) {
/ NEE

/t
GeoScoServiceOrderProcessor.createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO>) line: 637	
		if (myAll.isEmpty()) {
			// The current shipment order is processed completely, no need to split.
			updateProductItemsForDesadv(aExistingItems);
/d
			return aExistingItems;
/t
GeoScoServiceOrderProcessor.processDesadvServiceOrder(ServiceOrderVO) line: 912	

		List<ShipmentItemVO> shipmentItems = new ArrayList<ShipmentItemVO>();
...
				Map<ShipmentOrderVO, Collection<ShipmentItemVO>> myShipmentOrderMap = createShipmentOrderMap(myExistingItems);
{ShipmentOrder: SH000001417(SystemId:26879741; Org:LOG_EMEA_FR_CT_PSA)=[shipmentItem: 0010(systemId:26888511, labelInfo:LA2JS1QEV), shipmentItem: 0020(systemId:26888512, labelInfo:A4CI08394)]}
/existing sho+ shi's
				// New Logic for PSA-401
				for (Collection<ShipmentItemVO> myItemsByOrder : myShipmentOrderMap.values()) {
					Collection<ShipmentItemVO> myProcessedItems = createNewShipmentOrderForProcessedItems(myItemsByOrder);
/ update product items	,
myProcessedItems=
[shipmentItem: 0010(systemId:26888511, labelInfo:LA2JS1QEV), shipmentItem: 0020(systemId:26888512, labelInfo:A4CI08394)]
					shipmentItems.addAll(myProcessedItems);

/ volgende	,
		for (ConsignmentVO myConsignmentVO : aUpdateServiceOrderVO.getConsignmentList()) {
/ GEEN
			for (ServiceActionVO myServiceActionVO : myConsignmentVO.getServiceActionList()) {
/ GEEN 

		return shipmentItems;
/t
GeoScoServiceOrderProcessor.processDespatchAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 407	

		ServiceOrderVO updateServiceOrderVO = aProcessor.process(selectSingleNode(aNode, SERVICE_ORDER_BODY_TAG));
		processConsignments(aNode, updateServiceOrderVO);
		List<ShipmentItemVO> existingShipmentItems = processDesadvServiceOrder(updateServiceOrderVO);
/d
		processPurchaseServiceOrdersForShipmentItems(existingShipmentItems);
/s
GeoScoServiceOrderProcessor.processPurchaseServiceOrdersForShipmentItems(List<ShipmentItemVO>) line: 1016	
		Set<ShipmentOrderVO> existingShipmentOrders = findShipmentOrders(existingShipmentItems);
[ShipmentOrder: SH000001417(SystemId:26879741; Org:LOG_EMEA_FR_CT_PSA)]

		Set<ServiceOrderVO> existingPurchaseServiceOrders = findServiceOrders(existingShipmentOrders);
/s
GeoScoServiceOrderProcessor.class
	private Set<ServiceOrderVO> findServiceOrders(Set<ShipmentOrderVO> existingShipmentOrders) {
		Set<ServiceOrderVO> existingServiceOrders = new HashSet<ServiceOrderVO>();
		for (ShipmentOrderVO shipmentOrderVO : existingShipmentOrders) {
			existingServiceOrders.addAll(shipmentOrderVO.getServiceOrderList());
/s
ShipmentOrderVO.class
	public List<ServiceOrderVO> getServiceOrderList() {
		List<ServiceOrderVO> myList = new ArrayList<ServiceOrderVO>();
		for (ServiceActionVO myAction : getServiceActionList()) {
			ConsignmentVO myConsignment = myAction.getConsignmentVO();
			if (myConsignment != null) {
				myList.add(myConsignment.getServiceOrderVO());
			}
		}
		return myList;
	}
/t
GeoScoServiceOrderProcessor.class
	private Set<ServiceOrderVO> findServiceOrders(Set<ShipmentOrderVO> existingShipmentOrders) {

		for (ShipmentOrderVO shipmentOrderVO : existingShipmentOrders) {
			existingServiceOrders.addAll(shipmentOrderVO.getServiceOrderList());
		}
/d
[N0006170/26881769, N0006169/26881768, N0006171/26881770]
/ WH Purchase, Delivery, Receipt	,
		Set<ServiceOrderVO> purchaseServiceOrders = filterPurchaseOrders(existingServiceOrders);
[N0006169/26881768]
		return purchaseServiceOrders;
	}
/t
GeoScoServiceOrderProcessor.processPurchaseServiceOrdersForShipmentItems(List<ShipmentItemVO>) line: 1018	
		Set<ServiceOrderVO> existingPurchaseServiceOrders = findServiceOrders(existingShipmentOrders);
/d
[N0006169/26881768]

		Set<ServiceOrderVO> processedPurchaseServiceOrders = processPurchaseServiceOrders(existingPurchaseServiceOrders);
/s
GeoScoServiceOrderProcessor.processPurchaseServiceOrders(Set<ServiceOrderVO>) line: 1004	

		for (ServiceOrderVO serviceOrderVO : existingServiceOrders) {
			processedPurchaseServiceOrders.add(closePurchaseServiceOrder(serviceOrderVO));
/s
GeoScoServiceOrderProcessor.closePurchaseServiceOrder(ServiceOrderVO) line: 607	
		aServiceOrder.getDateSetVO().setActualEnd(new Date());
/ De purchase order wordt afgesloten	, de 04-DESADV is processed	,

 		aServiceOrder = serviceOrderService.updateServiceOrder(aServiceOrder, true, false);
/ propagate=true
/ replan=false
/s
ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderVO, TMSEventContext, boolean, boolean) line: 1554	
...
				if (propagate) {
					consignmentService.handleServiceOrderActualDateChange(aServiceOrder, myOldServiceOrderVO);
/ TODO
					consignmentService.handleServiceOrderPlannedDateChange(aServiceOrder, myOldServiceOrderVO);
/ TODO
				if (propagate) {
...
					triggerEventHandler(myOldServiceOrderVO, aServiceOrder, false, aContext);
/s
ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderVO, ServiceOrderVO, boolean, TMSEventContext) line: 1902	

			} else {
				myEvent = new ServiceOrderEvent(anOldVO, aNewVO, ServiceOrderEvent.UPDATED, aContext);
			myEvent.setInitiatedByConsignmentChange(anIsInitiatedByConsignmentChange);
false
			eventHandlerService.handleEvent(myEvent);
/s
EventHandlerServiceImpl.handleEvent(Event) line: 109	
			listenerList.fireEvent(anEvent);
/s
ListenerList.fireEvent(Event<?>) line: 80	
		for (EventListener myListener : theListenerList) {
this	ListenerList  (id=23814)	
	theListenerList	ArrayList  (id=23816)	
		elementData	Object[15]  (id=23819)	
			[0]	DocumentEventListener  (id=23820)	
			[1]	CustomerOrderEventListener  (id=23821)	
			[2]	ShoCostAllocationEventListener  (id=23822)	
			[3]	ShoPriceAllocationServiceImpl  (id=23823)	
			[4]	TMSCarConServiceOrderEventListener  (id=23824)	
			[5]	SupplierInvoiceUpdateEventListener  (id=23825)	
			[6]	$Proxy398  (id=23826)	
			[7]	EventEventListener  (id=23827)	
			[8]	AllocationEventListener  (id=23828)	
->			[9]	StockTransactionEventListener  (id=23856)	
			[10]	CapableToPromiseEventListener  (id=23857)	
			[11]	CustomerInvoiceUpdateEventListener  (id=23858)	
			[12]	InvoiceServiceOrderEventHandler  (id=23859)	
			[13]	RateCalcEventListener  (id=23860)	
		size	14	

		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);
/s
StockTransactionEventListener.handleEvent(Event<?>) line: 37	
		boolean stockTransactionsEnabled = ApplicationPropertyManager.getInstance().getModuleProperty("inventory", "enable.stock.transactions", true);
true
/ Default, want de property is er niet	,

anEvent.getEventType()="serviceorder.update"

		if (stockTransactionsEnabled) {
			if (anEvent.getEventType().equals(ShipmentOrderEvent.UPDATED) || anEvent.getEventType().equals(ShipmentOrderEvent.DATES_UPDATED)) {
/ NEE
				ShipmentOrderEvent myShipmentOrderEvent = (ShipmentOrderEvent) anEvent;
				stockTransactionService.handleShipmentOrderEvent(myShipmentOrderEvent);
			} else if (anEvent.getEventType().startsWith(ShipmentItemEvent.PREFIX)) {
/ NEE
				ShipmentItemEvent myEvent = (ShipmentItemEvent) anEvent;
				handle(myEvent);
			} else if (anEvent.getEventType().startsWith(ProductItemEvent.PREFIX)) {
/ NEE
				ProductItemEvent myEvent = (ProductItemEvent) anEvent;
				handle(myEvent);
			} else if (anEvent.getEventType().startsWith(CustomerOrderLineEvent.PREFIX)) {
/ NEE
				CustomerOrderLineEvent myEvent = (CustomerOrderLineEvent) anEvent;
				handle(myEvent);
			} else if (anEvent.getEventType().startsWith(CustomerOrderEvent.PREFIX)) {
/ NEE
				CustomerOrderEvent myEvent = (CustomerOrderEvent) anEvent;
				handle(myEvent);
			} else if (anEvent.getEventType().startsWith(ServiceActionEvent.PREFIX)) {
/ NEE
				handle((ServiceActionEvent) anEvent);


/t
GeoScoServiceOrderProcessor.closePurchaseServiceOrder(ServiceOrderVO) line: 612	

		aServiceOrder.getDateSetVO().setActualEnd(new Date());
		aServiceOrder = serviceOrderService.updateServiceOrder(aServiceOrder, true, false);
/d
		return aServiceOrder;
/t
GeoScoServiceOrderProcessor.processPurchaseServiceOrders(Set<ServiceOrderVO>) line: 1010	

		Set<ServiceOrderVO> processedPurchaseServiceOrders = new HashSet<ServiceOrderVO>();

		for (ServiceOrderVO serviceOrderVO : existingServiceOrders) {
			processedPurchaseServiceOrders.add(closePurchaseServiceOrder(serviceOrderVO));
/d
		return processedPurchaseServiceOrders;
/t
GeoScoServiceOrderProcessor.processPurchaseServiceOrdersForShipmentItems(List<ShipmentItemVO>) line: 1019	
		Set<ServiceOrderVO> processedPurchaseServiceOrders = processPurchaseServiceOrders(existingPurchaseServiceOrders);
/d
		return processedPurchaseServiceOrders;
/t
GeoScoServiceOrderProcessor.process(Node) line: 248	
			} else if (DESPATCH_ADVICE_SHIPMENT.equals(purposeCode)) {
				processDespatchAdviceShipment(aNode, myProcessor, documentId);
/d
/ we zijn in 	,
/ stack
Thread [GeoScoQueueContainer-1] (Suspended)	
	ServiceOrderMsgProcessor.process(Node) line: 95	
	ServiceOrderMsgConsumer.process(Message) line: 52	
	ServiceOrderMsgConsumer(MessageConsumer).handle(Message) line: 108	
	MessageConsumerHandler$$EnhancerBySpringCGLIB$$ca5a33ca(MessageConsumerHandler).onExchange(MessageExchange) line: 172	
	MessageConsumerHandler$$EnhancerBySpringCGLIB$$ca5a33ca(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 43	
	SingletonExchangeHandlerChain.next(MessageExchange) line: 43	
	DemuxExchangeHandler.handleMessage(ExchangeHandler, MessageExchange) line: 110	
	DemuxExchangeHandler.onExchange(MessageExchange) line: 123	
	DemuxExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 43	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	TxExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	TxExchangeHandler.handleExchange(ExchangeHandlerChain, MessageExchange) line: 62	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	MessageTraceExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	AuthNExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	ArchiveExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	SapXConverterExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	ArchiveErrorExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	RetryExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	RetryExchangeHandler.handleExchange(ExchangeHandlerChain, MessageExchange) line: 80	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	MessageHandler.handleExchange(MessageExchange) line: 55	
	MpoMessageListener.processMessage(Message, JmsMpoMessage) line: 378	
	MpoMessageListener.onMessage(Message) line: 199	
	DefaultMessageListenerContainer(AbstractMessageListenerContainer).doInvokeListener(MessageListener, Message) line: 569	
	DefaultMessageListenerContainer(AbstractMessageListenerContainer).invokeListener(Session, Message) line: 507	
	DefaultMessageListenerContainer(AbstractMessageListenerContainer).doExecuteListener(Session, Message) line: 474	
	DefaultMessageListenerContainer(AbstractPollingMessageListenerContainer).doReceiveAndExecute(Object, Session, MessageConsumer, TransactionStatus) line: 325	
	DefaultMessageListenerContainer(AbstractPollingMessageListenerContainer).receiveAndExecute(Object, Session, MessageConsumer) line: 263	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener() line: 1103	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop() line: 1095	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run() line: 992	
	Thread.run() line: 745	


/ Einde DEBUG PSA-479

/ PSA-479

/ Geodis is een transportbedrijf	. Dus SCS (Geodis) regelt het transport van de vendor naar het magazijn	,
/ Als de 04 is binnen, wordt hij processed	, de Purchase seo wordt update:  de actual end date wordt new Date()===NU set	, klopt: de tijd van het process van de 04	,
Pln. start date: 29-apr-2016	: aanmaak tijd van de purchase order	,
Pln. end date: 10-may-2016	: verwachte tijd dat product in het magazijn binnenkomt	, 
Actual . end date: 10-may-2016	: tijd dat product in het magazijn binnenkomt	, 


/ Einde PSA-479

/ FIX PSA-479

$ vi GeoScoServiceOrderProcessor.class
	private void updateProductItemsForDesadv(Collection<ShipmentItemVO> aResult) {

				if (myProductItem.getQuantity().compareTo(myQty) != 0) {
					myProductItem.setQuantity(myQty);
->					productItemService.save(myProductItem); / WAS: productItemDAO.save(myProductItem)
				}
/ dit is het enigste wat we moeten doen	,

/ Want	,
/ Dan
$ vi ProductItemServiceImpl.class
	@Override
	public ProductItemVO save(ProductItemVO aProductItemVO, boolean recalculate, boolean useQueue) {
...
		if (shouldFireEvent()) {
			if (useQueue) {
				myEvent.getEventContext().addFlag(TMSEventContext.FLAG_ADD_TO_QUEUE);
			}
			fireProductItemEvent(myEvent);
		}

$ vi StockTransactionEventListener.class
			} else if (anEvent.getEventType().startsWith(ProductItemEvent.PREFIX)) {
ProductItemEvent.PREFIX="productitem"
/ JA	, want event type zal zijn "productitem.updated"
				ProductItemEvent myEvent = (ProductItemEvent) anEvent;
				handle(myEvent);



/ Einde FIX PSA-479

/ DEBUG FIX PSA-479

/s
GeoScoServiceOrderProcessor.updateProductItemsForDesadv(Collection<ShipmentItemVO>) line: 1254	
/=
	private void updateProductItemsForDesadv(Collection<ShipmentItemVO> aResult) {
aResult=
[shipmentItem: 0010(systemId:26888511, labelInfo:LA2JS1QEV), shipmentItem: 0020(systemId:26888512, labelInfo:A4CI08394)]


/ we veranderen in Expressions	, 
myQty=17 nu	,
myQty=new BigDecimal(18)

				if (myProductItem.getQuantity().compareTo(myQty) != 0) {
/ JA
					myProductItem.setQuantity(myQty);
					productItemService.save(myProductItem);
/s
ProductItemServiceImpl.save(ProductItemVO, boolean, boolean) line: 514	
productItemVO= PRODUCT_ITEM id:null(systemId:26883413)
recalculate=true
useQueue=false

		if (aProductItemVO.isVolatile()) {
/ NEE
		ProductItemEvent myEvent = null;
		if (shouldFireEvent()) {
			myEvent = createProductItemEvent(aProductItemVO);
/s
ProductItemServiceImpl.createProductItemEvent(ProductItemVO) line: 174	
		} else {
			// FIXME ML: shouldn't we pass the old item?
			myEvent = new ProductItemEvent(null, aNewProductItem, ProductItemEvent.UPDATED, myEventContext);
		return myEvent;
/t
ProductItemServiceImpl.save(ProductItemVO, boolean, boolean) line: 531	
			myEvent = createProductItemEvent(aProductItemVO);
/d
		aProductItemVO = super.save(aProductItemVO);
/s
ProductItemServiceImpl(AbstractService).save(TypeVO) line: 64	
		return getDAO().save(aVO);
/ getDAO()=proxy naar com.mpobjects.oms.model.shipmentorder.dao.ProductItemDAOImpl@3cce2b8e
/t
ProductItemServiceImpl.save(ProductItemVO, boolean, boolean) line: 532	
		aProductItemVO = super.save(aProductItemVO);
/d
		removeEmptyPackedItems(aProductItemVO);
/ NIETS
			recalculateShipmentOrder(sho);
/ TODO ( StockTransactionEventListener.handleEvent wordt called, maar dan met ServiceActionEvent )
			aProductItemVO.setShipmentOrder(sho);

		if (shouldFireEvent()) {
			if (useQueue) {
/ **
/ NEE
				myEvent.getEventContext().addFlag(TMSEventContext.FLAG_ADD_TO_QUEUE);
/ NIET
			fireProductItemEvent(myEvent);
/s
ProductItemServiceImpl.fireProductItemEvent(ProductItemEvent) line: 275	
			eventHandlerService.handleEvent(anEvent);
/s
EventHandlerServiceImpl.handleEvent(Event) line: 72	

anEvent	ProductItemEvent  (id=22742)	
	theNewVO	ProductItemVO  (id=22543)	
		theQuantity	BigDecimal  (id=22778)	
18
/ klopt	,
		String myEventType = anEvent.getEventType();
productitem.updated
			listenerList.fireEvent(anEvent);
/s
ListenerList.fireEvent(Event<?>) line: 80	
		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);
/s
StockTransactionEventListener.handleEvent(Event<?>) line: 37	
		boolean stockTransactionsEnabled = ApplicationPropertyManager.getInstance().getModuleProperty("inventory", "enable.stock.transactions", true);
true (default)
			} else if (anEvent.getEventType().startsWith(ProductItemEvent.PREFIX)) {
productitem.updated
				ProductItemEvent myEvent = (ProductItemEvent) anEvent;
				handle(myEvent);
/s
StockTransactionEventListener.handle(ProductItemEvent) line: 104	
		boolean addToQueue = anEvent.getEventContext().hasFlag(TMSEventContext.FLAG_ADD_TO_QUEUE);
false
/ See ** hierboven		, bij useQueue	,

		} else if (anEvent.getEventType().equals(ProductItemEvent.UPDATED)) {
			stockTransactionService.handleProductItemUpdated(anEvent);
/s
StockTransactionEventListener.handle(ProductItemEvent) line: 109	
		if (!canCreateTransactions(anEvent.getNewVO().getShipmentOrder())) {
/ NEE

		ProductItemVO item = anEvent.getNewVO();
		Product product = getProduct(item);
MPO_Prod1
		boolean isNewProduct = ProductItemEvent.CREATED.equals(anEvent.getEventType());
false
		boolean shouldUpdate = isNewProduct || anEvent.getOldVO() == null;
false || true = true

		if (!shouldUpdate) {
/ NEE
		if (transactions == null) {
			transactions = stockTransactionDAO.getByProductItem(item);
[27214919/ORDER_IN/2016-05-10 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/16.00000/8636.00000/false, 
27214918/ORDER_OUT/2016-04-29 10:30:00.0/MPO_Prod1 (27044086)/MPO_Vend1/-17.00000/-16807.00000/false]
/ een order_in	, en een order_out	,
item='n ProductItemVO	,

			productList = productService.getProductList(product, getTransactionQuantity(item), 1);
/s
StockTransactionServiceImpl.getTransactionQuantity(ProductItemVO) line: 327	
		if (!NumberUtils.isNullOrZero(itemVO.getActualQuantity())) {
/ NEE
		} else {
			return itemVO.getQuantity();
/t
			productList = productService.getProductList(product, getTransactionQuantity(item), 1);
/ pd
/s
ProductServiceImpl.getProductList(Product, BigDecimal, int) line: 26	
		Map<Product, BigDecimal> myList = new HashMap<Product, BigDecimal>();
		myList.put(aProduct, aQty);
MPO_Prod1: 18
		addChildren(aProduct, myList, aQty, aLevel);
/ NIETS
/ TODO (BillOfMaterials)

		return myList;
/t
StockTransactionServiceImpl.handleProductItemUpdated(ProductItemEvent) line: 288	
			productList = productService.getProductList(product, getTransactionQuantity(item), 1);
/d
{MPO_Prod1 (27044086)=18.00}

		// Process existing transactions
		for (StockTransaction tx : transactions) {
...ORDER_IN...
			BigDecimal expectedQty = productList.get(tx.getProduct());
18
 			if (StockTransactionType.ORDER_OUT.equals(tx.getTransactionType())) {
/ NEE
				expectedQty = expectedQty.negate();
/ NIET
			if (NumberUtils.compareTo(expectedQty, tx.getQuantity()) != 0) {
/ JA	, 
expectedQty=18	, tx.getQuantity()=16
				markNextDirty(tx);
/ NIETS
/ TODO
				tx.setQuantity(expectedQty);
				tx.setDirty(true);
				stockTransactionDAO.save(tx);

/ volgende	,
		for (StockTransaction tx : transactions) {
...ORDER_OUT...
			BigDecimal expectedQty = productList.get(tx.getProduct());
18
 			if (StockTransactionType.ORDER_OUT.equals(tx.getTransactionType())) {
/ NEE
				expectedQty = expectedQty.negate();
/ NIET
			if (NumberUtils.compareTo(expectedQty, tx.getQuantity()) != 0) {
/ JA	, 
expectedQty=-18	, tx.getQuantity()=16
				markNextDirty(tx);
/ NIETS
/ TODO
				tx.setQuantity(expectedQty);
				tx.setDirty(true);
				stockTransactionDAO.save(tx);

		if (!transactions.isEmpty()) {
			return;`













/ Einde DEBUG FIX PSA-479

/ PSA-537

/ Kies forecast scherm  op MPO_Prod2	,
/ Maak (min) 40 op Thu	, hij maakt sho SH000001418	,

/ we zien 1 MPO_Complex1, en 8 MPO_Box1 en 1 MPO_Pallet1
/ dat betekent dat op deze pallet 8 dozen staan	,

/ we geven de shi's als label info die van de MPO_Complex1	,

$ vi file:///home/eric/Integration/Geosco/04-DESADV-ID-SH-1248-pallet.xml 

               <so:SHIPMENT_ITEMS>
                  <mtccore:SHIPMENT_ITEM>
                     <mtccore:SHIPMENT_ITEM_ID>Box1</mtccore:SHIPMENT_ITEM_ID>
                     <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:PRODUCT_ITEM_ID>MPO_Prod2</mtccore:PRODUCT_ITEM_ID>					<- MPO_Prod2
                           <mtccore:SHIPMENT_ORDER_ID>ID TRANSPORT</mtccore:SHIPMENT_ORDER_ID>
                           <mtccore:QUANTITY>12</mtccore:QUANTITY>
                        </mtccore:PACKED_ITEM>
                     </mtccore:PACKED_ITEMS>
                     <mtccore:PACKAGE_CODE>00112</mtccore:PACKAGE_CODE>
                     <mtccore:LABEL_NUMBER>9IRLCO5BT</mtccore:LABEL_NUMBER>								<- label info van MPO_Comlex1
                     <mtccore:AIRWAYBILL_NUMBER>ID TRANSPORT</mtccore:AIRWAYBILL_NUMBER>
                     <mtccore:CASE_NUMBER>BOX1</mtccore:CASE_NUMBER>
                     <mtccore:CONTAINER_NUMBER>100971646</mtccore:CONTAINER_NUMBER>
		  			<mtccore:SHIPMENT_ITEM>
                     <mtccore:SHIPMENT_ITEM_ID>Box2</mtccore:SHIPMENT_ITEM_ID>
                     <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:PRODUCT_ITEM_ID>MPO_Prod2</mtccore:PRODUCT_ITEM_ID> 				<- MPO_Prod2
                           <mtccore:SHIPMENT_ORDER_ID>ID TRANSPORT</mtccore:SHIPMENT_ORDER_ID>
                           <mtccore:QUANTITY>9</mtccore:QUANTITY>
                        </mtccore:PACKED_ITEM>
                     </mtccore:PACKED_ITEMS>
                     <mtccore:PACKAGE_CODE/>
                     <mtccore:LABEL_NUMBER>9IRLCO5BT</mtccore:LABEL_NUMBER>							<- label info van MPO_Complex1
                     <mtccore:AIRWAYBILL_NUMBER>ID TRANSPORT</mtccore:AIRWAYBILL_NUMBER>
                     <mtccore:CASE_NUMBER>BOX2</mtccore:CASE_NUMBER>
                     <mtccore:CONTAINER_NUMBER>100971646</mtccore:CONTAINER_NUMBER>
                  </mtccore:SHIPMENT_ITEM>


/ Einde PSA-537

/ DEBUG PSA-537

GeoScoServiceOrderProcessor.processDespatchAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 403	
		ServiceOrderVO updateServiceOrderVO = aProcessor.process(selectSingleNode(aNode, SERVICE_ORDER_BODY_TAG));
/d
/ Slaan we over	,
		processConsignments(aNode, updateServiceOrderVO);
...
/s
ShipmentOrderProcessor.process(Node) line: 215	
			List<ProductItemVO> myProductList = parseProductItems(aNode, myShipmentOrderVO);
/ slaan we over	,
			List<ShipmentItemVO> myShipmentItems = parseShipmentItems(aNode, myProductList, myShipmentOrderVO.getOrganizationSystemid());
/s
		while (myNode != null) {
			if (myNode.getNodeType() == Node.ELEMENT_NODE) {
				if (SHIPMENT_ITEM_TAG.equals(getElementName(myNode))) {
					ShipmentItemVO myItemVO = myProcessor.process(myNode, myProductMap, anOrganizationSystemId);
myItemVO
	theLabelInfo	"9IRLCO5BT" (id=25830)	

					myShipmentItems.add(myItemVO);
/t
ShipmentOrderProcessor.process(Node) line: 217	
			List<ShipmentItemVO> myShipmentItems = parseShipmentItems(aNode, myProductList, myShipmentOrderVO.getOrganizationSystemid());
/d
			ParsedShipmentOrder myRet = new ParsedShipmentOrder(myShipmentOrderVO, myProductList, myShipmentItems);
			return myRet;
/t
							ShipmentOrderVO myShipmentOrderVO = myParsedShipmentOrderVO.getShipmentOrder();
							myShipmentOrderVO.setProductItemList(myParsedShipmentOrderVO.getProductItemList());
							myShipmentOrderVO.setShipmentItemList(myParsedShipmentOrderVO.getShipmentItemList());
							ServiceActionVO myServiceAction = new ServiceActionVO();
							myServiceAction.setShipmentOrderVO(myShipmentOrderVO);
							myServiceAction.setConsignmentVO(myConsignment);
							myConsignment.setServiceOrderVO(serviceOrder);
							myShipmentOrderVO.addServiceAction(myServiceAction);
							myServiceActionList.add(myServiceAction);
						}
					}
					myConsignment.setServiceActionList(myServiceActionList);
					myConsignmentList.add(myConsignment);
				}
			}
			serviceOrder.setConsignmentList(myConsignmentList);
/t
GeoScoServiceOrderProcessor.processDespatchAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 404	
		processConsignments(aNode, updateServiceOrderVO);
/d
		List<ShipmentItemVO> existingShipmentItems = processDesadvServiceOrder(updateServiceOrderVO);
/s
	private List<ShipmentItemVO> processDesadvServiceOrder(ServiceOrderVO aUpdateServiceOrderVO) {
		List<ShipmentItemVO> shipmentItems = new ArrayList<ShipmentItemVO>();
		for (ConsignmentVO myConsignmentVO : aUpdateServiceOrderVO.getConsignmentList()) {
			for (ServiceActionVO myServiceActionVO : myConsignmentVO.getServiceActionList()) {
				ShipmentOrderVO myShipmentOrderVO = myServiceActionVO.getShipmentOrderVO();
ShipmentOrder: 2589(SystemId:0; Org:LOG_EMEA_FR_CT_PSA)
/ Dus niet de existing	,
				Collection<ShipmentItemVO> myExistingItems = processDesAdvShipmentOrder(myShipmentOrderVO);
/s
GeoScoServiceOrderProcessor.processDesAdvShipmentOrder(ShipmentOrderVO) line: 958	
		Set<ShipmentItemVO> myResult = new HashSet<ShipmentItemVO>();
		if (myShipmentOrderVO != null) {
ShipmentOrder: 2589(SystemId:0; Org:LOG_EMEA_FR_CT_PSA)
/ processed sho	, niet existing,	

			for (ShipmentItemVO myItem : myShipmentOrderVO.getShipmentItemList()) {
/ list=
[shipmentItem: Box1(systemId:0, labelInfo:9IRLCO5BT), 
shipmentItem: Box2(systemId:0, labelInfo:9IRLCO5BT)]

myItem=
shipmentItem: Box1(systemId:0, labelInfo:9IRLCO5BT)
/ processed shi	, niet de existing	, nog niet opgezocht	,

				checkItem(myItem);
				myResult.addAll(processDesadvShipmentItem(myItem));
/s
GeoScoServiceOrderProcessor.processDesadvShipmentItem(ShipmentItemVO) line: 933	
		String myLabelInfo = aItem.getLabelInfo();
9IRLCO5BT
		ShipmentItemVO myExistingItem = shipmentItemDAO.getShipmentItem(myLabelInfo);
/ De MPO_Complex1	,
shipmentItem: 0010(systemId:26888521, labelInfo:9IRLCO5BT)
/s
	private Collection<ShipmentItemVO> findShipmentItemsByLabel(String aLabel) {
		String mySql = "SELECT si.* FROM  SHIPMENT_ITEM si " + " WHERE si." + LABEL_INFO + "=:labelInfo order by si.SYSTEM_ID desc";
		Collection<ShipmentItemVO> myResult = executeSqlSelect(mySql, "si", new StringNamedQueryParameter("labelInfo", aLabel), 1);
		return myResult;
/ NATIVE HIBERNATE 

/ Dit is de MPO_Complex1	,

/ Intermezzo

geosco2a=#  select*from shipping_unit where lower(unit) similar to '%box|compl|pall%';
 system_id | is_deleted |    unit     | nr_of_loading_meters |     description     | load_factor | allow_on_container | wei
ght_kg | volume_m3 | length_m | width_m | height_m | product_systemid 
-----------+------------+-------------+----------------------+---------------------+-------------+--------------------+----
-------+-----------+----------+---------+----------+------------------
  26673765 |          0 | PALLET(s)   |                    0 | PALLET(s)           |     0.00000 |                  0 |   0
.00000 |   0.00000 |  0.00000 | 0.00000 |  0.00000 |             NULL
  26673755 |          0 | BOX         |                    0 | BOX(s)              |    10.00000 |                  0 |   0
.00000 |   0.00000 |  0.00000 | 0.00000 |  0.00000 |             NULL
  27135552 |          0 | MPO_PAL4BOX |                    0 | Pallet with 4 boxes |     0.00000 |                  1 | 500
.00000 |   1.00000 |  1.00000 | 1.00000 |  1.00000 |             NULL
(3 rows)

geosco2a=# select su.unit from shipment_item shi join shipping_unit su on shi.shipping_unit_systemid=su.system_id where label_info='9IRLCO5BT' ;
     unit     
--------------
 MPO_Complex1
(1 row)

/ Einde Intermezzo

		if (myExistingItem.getShipmentItemList().isEmpty()) {
/ NEE
[
shipmentItem: 0100(systemId:26888530, labelInfo:B5IQCGIYQ), 
shipmentItem: 0090(systemId:26888529, labelInfo:BBRF9XZPD), 
shipmentItem: 0080(systemId:26888528, labelInfo:CJ0K8I29S), 
shipmentItem: 0070(systemId:26888527, labelInfo:HWZV8SN0F), 
shipmentItem: 0060(systemId:26888526, labelInfo:GB1K8NDKU), 
shipmentItem: 0050(systemId:26888525, labelInfo:CE3N3ZRB1), 
shipmentItem: 0040(systemId:26888524, labelInfo:ZDF9WMT4S), 
shipmentItem: 0030(systemId:26888523, labelInfo:08HC6ERUJ), 
shipmentItem: 0020(systemId:26888522, labelInfo:KI8GXTZWA)
]

/Intermezzo

myExistingItem.getShipmentItemList()= ShipmentItemVO.getChildren()

$ vi ShipmentItem.standard.hbm.xml

        <bag name="children" access="property" cascade="delete" inverse="true">
        	<cache usage="read-write"/>
            <key column="PARENT_SYSTEMID"/>
            <one-to-many class="com.mpobjects.oms.model.shipmentorder.vo.ShipmentItemVO"/>
        </bag>

geosco2a=# select shi.label_info from shipment_item shi join shipment_item shi_parent on shi.parent_systemid=shi_parent.system_id where shi_parent.label_info='9IRLCO5BT' ;
 label_info 
------------
 BBRF9XZPD
 KI8GXTZWA
 B5IQCGIYQ
 CJ0K8I29S
 HWZV8SN0F
 GB1K8NDKU
 CE3N3ZRB1
 ZDF9WMT4S
 08HC6ERUJ
(9 rows)

/ wat zijn de unit types van deze?

 reference1                    | character varying(80)       | 
geosco2a=# select shi.label_info,su.unit,shi.case_number from shipment_item shi join shipping_unit su on shi.shipping_unit_systemid=su.system_id join shipment_item shi_parent on shi.parent_systemid=shi_parent.system_id where shi_parent.label_info='9IRLCO5BT' ;
 label_info |    unit     | case_number 
------------+-------------+-------------
 BBRF9XZPD  | MPO_Box1    | BOX2
 KI8GXTZWA  | MPO_Pallet1 | NULL
 B5IQCGIYQ  | MPO_Box1    | BOX1
 CJ0K8I29S  | MPO_Box1    | NULL
 HWZV8SN0F  | MPO_Box1    | NULL
 GB1K8NDKU  | MPO_Box1    | NULL
 CE3N3ZRB1  | MPO_Box1    | NULL
 ZDF9WMT4S  | MPO_Box1    | NULL
 08HC6ERUJ  | MPO_Box1    | NULL
(9 rows)

/ MPO_Complex1 is de parent van MPO_Pallet1 en MPO_Box1's	, 
/ omdat we sturen naar de vendor (in de Purchase order WH TODO ) alleen de MPO_Complex , en label info, maar daar doet de vendor niets mee, hij stuurt de label info van de MPO_Complex1 alleen terug, zodat wij de shi's daarmee kunnen opzoeken	, 
/ de children zijn 8 box's en 1 pallet	, hij kijkt alleen naar children met packed item's amount >0	, en een pallet heeft dat niet	,

                <mtccore:SHIPMENT_ITEM>
                     <mtccore:SHIPMENT_ITEM_ID>Box1</mtccore:SHIPMENT_ITEM_ID>
/ TODO
                     <mtccore:LABEL_NUMBER>9IRLCO5BT</mtccore:LABEL_NUMBER>
                     <mtccore:CASE_NUMBER>BOX1</mtccore:CASE_NUMBER>
 

/ we zien in de 04-desadv op de shi's alleen de MPO_Complex1's label info	, NIET die van de shi's zelf	, 

/ in de 04-desadv zien we  case_number, deze heeft de vendor erop gezet	, 
/ Samen met de sho id is deze combinatie uniek	,
 

/Einde Intermezzo

		if (myExistingItem.getShipmentItemList().isEmpty()) {
/ NEE
			return processDesadvSingleShipmentItem(myExistingItem, aItem);
/ NIET
		} else {
			return processDesadvNestedShipmentItem(myExistingItem, aItem);
/s
existingItem=shipmentItem: 0010(systemId:26888521, labelInfo:9IRLCO5BT)	 / theShippingUnit=MPO_Complex1	, existing	,
aItem=shipmentItem: Box1(systemId:0, labelInfo:9IRLCO5BT)				/  theShippingUnit=00112	, processed  (dus de unit!= MPO_Box1)
/s
GeoScoServiceOrderProcessor.processDesadvNestedShipmentItem(ShipmentItemVO, ShipmentItemVO) line: 839	

existingItem=shipmentItem: 0010(systemId:26888521, labelInfo:9IRLCO5BT)	 / theShippingUnit=MPO_Complex1	, existing	,
aProcessedItem=shipmentItem: Box1(systemId:0, labelInfo:9IRLCO5BT)		/  theShippingUnit=00112	, processed  (dus de unit!= MPO_Box1)

		ShipmentItemVO myExisting = processDesadvPackingShipmentItem(aExistingItem, aProcessedItem);
/s
GeoScoServiceOrderProcessor.processDesadvPackingShipmentItem(ShipmentItemVO, ShipmentItemVO) line: 885	
		aExistingItem.setContainerNumber(aProcessedItem.getContainerNumber());
		aExistingItem.setReference2(aProcessedItem.getReference2());
		return shipmentItemDAO.save(aExistingItem);
/t
GeoScoServiceOrderProcessor.processDesadvNestedShipmentItem(ShipmentItemVO, ShipmentItemVO) line: 839	

		myProcessedList.add(myExisting);
shipmentItem: 0010(systemId:26888521, labelInfo:9IRLCO5BT) / de exisiting MPO_Complex1	,

		for (ShipmentItemVO myChild : myExisting.getShipmentItemList()) {
/list=
[
shipmentItem: 0100(systemId:26888530, labelInfo:B5IQCGIYQ), 	 	MPO_Box1 	BOX1
shipmentItem: 0090(systemId:26888529, labelInfo:BBRF9XZPD), 		MOO_Box1	BOX2
shipmentItem: 0080(systemId:26888528, labelInfo:CJ0K8I29S),			MOO_BOX1	NULL 
shipmentItem: 0070(systemId:26888527, labelInfo:HWZV8SN0F), 
shipmentItem: 0060(systemId:26888526, labelInfo:GB1K8NDKU), 
shipmentItem: 0050(systemId:26888525, labelInfo:CE3N3ZRB1), 
shipmentItem: 0040(systemId:26888524, labelInfo:ZDF9WMT4S), 
shipmentItem: 0030(systemId:26888523, labelInfo:08HC6ERUJ), 
shipmentItem: 0020(systemId:26888522, labelInfo:KI8GXTZWA)			 MPO_Pallet1 	NULL
]

/ myExisting=MPO_Complex1 uit db	, en nu probeert hij de existing shi uit db met dezelfde case number, BOX1 , voor deze processed shi	,

/ aProcessedItem.getCaseNumber()="BOX1"

myChild=
shipmentItem: 0090(systemId:26888529, labelInfo:BBRF9XZPD)	MPO_Box1	 BOX2
			if (isPackingMaterial(myChild)) {
/ NEE
			if (org.apache.commons.lang.StringUtils.isBlank(myChild.getCaseNumber())) {
/ NEE
			} else if (myFoundChild == null && aProcessedItem.getCaseNumber() != null && myChild.getCaseNumber().equals(aProcessedItem.getCaseNumber())) {
/ NEE	, 
myChild.getCaseNumber()="BOX2" != "BOX1"

/ volgende,	
/ myChild=
shipmentItem: 0020(systemId:26888522, labelInfo:KI8GXTZWA)			MPO_Pallet1 NULL

			if (isPackingMaterial(myChild)) {
/ JA
				// packingMaterial
				LOG.info("No packed items [" + myChild + "]");
				if (org.apache.commons.lang.StringUtils.isBlank(myChild.getContainerNumber())) {
/ NEE
				continue;
			}

/ volgende	,
shipmentItem: 0100(systemId:26888530, labelInfo:B5IQCGIYQ) MPO_Box1	BOX1
			if (isPackingMaterial(myChild)) {
/ NEE
			if (org.apache.commons.lang.StringUtils.isBlank(myChild.getCaseNumber())) {
/ NEE
			} else if (myFoundChild == null && aProcessedItem.getCaseNumber() != null && myChild.getCaseNumber().equals(aProcessedItem.getCaseNumber())) {
				myFoundChild = myChild;

/ volgende,	
shipmentItem: 0080(systemId:26888528, labelInfo:CJ0K8I29S) MPO_Box1 NULL
			if (isPackingMaterial(myChild)) {
/ NEE
			if (org.apache.commons.lang.StringUtils.isBlank(myChild.getCaseNumber())) {
/ JA
				if (myFirstNonUpdated == null) {
/ JA
					myFirstNonUpdated = myChild;

/ Intermezzo

///////////////////////////////////////////////////////

/ Als je een bestelling doet van 40,	 worden meteen 8 shi's create	(, en een pallet	, en een complex). Ze zijn er dus al, al moeten ze nog komen	, 
/ Ze zijn ook alle 8 identiek	, geen enkele heeft een case_number	,
/ Als de 04-desadv voor het eerst komt	, vindt hij dus geen shi met de case numbers uit de processed shi's	, dus pakt voor elke processed shi de 1ste	, dat is myFirstNonUpdated	, en daarvan gaat hij de case number set	, en zijn packed item's quantity update	,

/ Einde Intermezzo

/ volgende	,
shipmentItem: 0010(systemId:26888521, labelInfo:9IRLCO5BT)
shipmentItem: 0060(systemId:26888526, labelInfo:GB1K8NDKU)
shipmentItem: 0050(systemId:26888525, labelInfo:CE3N3ZRB1)
shipmentItem: 0040(systemId:26888524, labelInfo:ZDF9WMT4S)
shipmentItem: 0030(systemId:26888523, labelInfo:08HC6ERUJ)

			if (isPackingMaterial(myChild)) {
/ NEE
			if (org.apache.commons.lang.StringUtils.isBlank(myChild.getCaseNumber())) {
/ JA
				if (myFirstNonUpdated == null) {
/ NEE

/ we hebben dus de existing shi gevonden bij processed shi , case number "BOX1"	, deze case number komt van de vendor	,
/ TODO ( Hoe asl deze 04-desadv voor het eerst binnenkomt	, dan zijn er in de db toch geen shi's met case number "BOX1"	?

/ Verder	,
		if (myFoundChild != null) {
/ JA
			// myProcessedList.addAll(processDesadvSingleShipmentItem(myFoundChild, aProcessedItem));
			processDesadvSingleShipmentItem(myFoundChild, aProcessedItem);
/////////////////////////////
/ SET QUANTITY ON PACKED ITEM
/ set quantity on existing packed item in the (existing) shi	, 
/s
GeoScoServiceOrderProcessor.processDesadvSingleShipmentItem(ShipmentItemVO, ShipmentItemVO) line: 975	

		aExistingItem.setCaseNumber(aProcessedItem.getCaseNumber());
		aExistingItem.setContainerNumber(aProcessedItem.getContainerNumber());
		aExistingItem.setReference1(aProcessedItem.getReference1());
		aExistingItem.setReference2(aProcessedItem.getReference2());
		aExistingItem.setReference3(aProcessedItem.getReference3());

		aExistingItem = shipmentItemDAO.save(aExistingItem);

                 <mtccore:SHIPMENT_ITEM>
                     <mtccore:SHIPMENT_ITEM_ID>Box1</mtccore:SHIPMENT_ITEM_ID>
                     <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:PRODUCT_ITEM_ID>MPO_Prod2</mtccore:PRODUCT_ITEM_ID>
                           <mtccore:SHIPMENT_ORDER_ID>ID TRANSPORT</mtccore:SHIPMENT_ORDER_ID>
                           <mtccore:QUANTITY>12</mtccore:QUANTITY>
                        </mtccore:PACKED_ITEM>
                     </mtccore:PACKED_ITEMS>

		if (aProcessedItem.getPackedItemList().isEmpty()) {
/ NEE
		} else if (aExistingItem.getPackedItemList().isEmpty()) {
/ NEE
		} else {
			PackedItemVO myProcessedPackedItemVO = aProcessedItem.getPackedItemList().iterator().next();
			PackedItemVO myExistingPackedItemVO = aExistingItem.getPackedItemList().iterator().next();
			// This is used to remember the original requested qty. FIXME: refactor when working correctly with
			// quantities
			myExistingPackedItemVO.setRequestedQuantity(myExistingPackedItemVO.getQuantity());
/ TODO
			myExistingPackedItemVO.setQuantity(myProcessedPackedItemVO.getQuantity());
12
			packedItemDAO.save(myExistingPackedItemVO);
		}

/t
GeoScoServiceOrderProcessor.processDesadvNestedShipmentItem(ShipmentItemVO, ShipmentItemVO) line: 873	
		myProcessedList.add(myExisting);
		if (myFoundChild != null) {
			processDesadvSingleShipmentItem(myFoundChild, aProcessedItem);
/d
		return myProcessedList;
[shipmentItem: 0010(systemId:26888521, labelInfo:9IRLCO5BT)]
/ existing MPO_Complex1	, 
/t
GeoScoServiceOrderProcessor.processDesadvShipmentItem(ShipmentItemVO) line: 942	
		if (myExistingItem.getShipmentItemList().isEmpty()) {
/ NEE
		} else {
			return processDesadvNestedShipmentItem(myExistingItem, aItem);
/t
GeoScoServiceOrderProcessor.processDesAdvShipmentOrder(ShipmentOrderVO) line: 960	
			for (ShipmentItemVO myItem : myShipmentOrderVO.getShipmentItemList()) {
				checkItem(myItem);
				myResult.addAll(processDesadvShipmentItem(myItem));
/myResult=
[shipmentItem: 0010(systemId:26888521, labelInfo:9IRLCO5BT)]
/ existing MPO_Complex1	, 
/d
/ volgende	,
            for (ShipmentItemVO myItem : myShipmentOrderVO.getShipmentItemList()) {

myShipmentOrderVO= ShipmentOrder: 2589(SystemId:0; Org:LOG_EMEA_FR_CT_PSA) 				, processed sho	,
myItem=shipmentItem: Box2(systemId:0, labelInfo:9IRLCO5BT)								, processed shi	, 
                checkItem(myItem);
                myResult.addAll(processDesadvShipmentItem(myItem));
...
/s
GeoScoServiceOrderProcessor.processDesadvNestedShipmentItem(ShipmentItemVO, ShipmentItemVO) line: 865	
...
/ Hij heeft existing shi found met case number BOX2	,
		if (myFoundChild != null) {
			processDesadvSingleShipmentItem(myFoundChild, aProcessedItem);
/ sets quantity on existing pi on the shi	,
myFoundChild=shipmentItem: 0090(systemId:26888529, labelInfo:BBRF9XZPD)
aProcessedItem=shipmentItem: Box2(systemId:0, labelInfo:9IRLCO5BT)
/s
GeoScoServiceOrderProcessor.processDesadvSingleShipmentItem(ShipmentItemVO, ShipmentItemVO) line: 975	
...
			PackedItemVO myProcessedPackedItemVO = aProcessedItem.getPackedItemList().iterator().next();
			PackedItemVO myExistingPackedItemVO = aExistingItem.getPackedItemList().iterator().next();
...
			myExistingPackedItemVO.setQuantity(myProcessedPackedItemVO.getQuantity());
			packedItemDAO.save(myExistingPackedItemVO);
		myResult.add(aExistingItem);
		return myResult;
...
/t
GeoScoServiceOrderProcessor.processDesAdvShipmentOrder(ShipmentOrderVO) line: 960	
			for (ShipmentItemVO myItem : myShipmentOrderVO.getShipmentItemList()) {
				checkItem(myItem);
				myResult.addAll(processDesadvShipmentItem(myItem));
/d
		return myResult;
/myResult=
[shipmentItem: 0010(systemId:26888521, labelInfo:9IRLCO5BT)]
/ existing MPO_Complex1	, 
/t
GeoScoServiceOrderProcessor.processDesadvServiceOrder(ServiceOrderVO) line: 908	
				Map<ShipmentOrderVO, Collection<ShipmentItemVO>> myShipmentOrderMap = createShipmentOrderMap(myExistingItems);
/d
[shipmentItem: 0010(systemId:26888521, labelInfo:9IRLCO5BT)]
/ existing shi MPO_Complex1	, 
/ en de existing packed item's quantity zijn update met processed packed item's quantity 	,

				Map<ShipmentOrderVO, Collection<ShipmentItemVO>> myShipmentOrderMap = createShipmentOrderMap(myExistingItems);
{ShipmentOrder: SH000001418(SystemId:26879751; Org:LOG_EMEA_FR_CT_PSA)=[shipmentItem: 0010(systemId:26888521, labelInfo:9IRLCO5BT)]}
=
[existing sho: existing shi MPO_Complex1]

				for (Collection<ShipmentItemVO> myItemsByOrder : myShipmentOrderMap.values()) {
					Collection<ShipmentItemVO> myProcessedItems = createNewShipmentOrderForProcessedItems(myItemsByOrder);
/s
GeoScoServiceOrderProcessor.createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO>) line: 624	

		// Get the existing shipment order
		ShipmentOrderVO myExisting = aExistingItems.iterator().next().getShipmentOrder();
ShipmentOrder: SH000001418(SystemId:26879751; Org:LOG_EMEA_FR_CT_PSA)

		// Get the top level items
		Collection<ShipmentItemVO> myAll = new ArrayList<ShipmentItemVO>(myExisting.getShipmentItemList());
[shipmentItem: 0010(systemId:26888521, labelInfo:9IRLCO5BT)]
/ De MPO_Complex1	,

/ Intermezzo

geosco2a=# select shi.label_info,su.unit,shi.parent_systemid from shipment_item shi join shipping_unit su on shi.shipping_unit_systemid=su.system_id join shipment_order sho on  shi.shipment_order_systemid=sho.system_id  where sho.shipment_order_id similar to '%1418%';
 label_info |     unit     | parent_systemid 
------------+--------------+-----------------
 BBRF9XZPD  | MPO_Box1     |        26888521
 KI8GXTZWA  | MPO_Pallet1  |        26888521
 B5IQCGIYQ  | MPO_Box1     |        26888521
 9IRLCO5BT  | MPO_Complex1 |            NULL
 CJ0K8I29S  | MPO_Box1     |        26888521
 HWZV8SN0F  | MPO_Box1     |        26888521
 GB1K8NDKU  | MPO_Box1     |        26888521
 CE3N3ZRB1  | MPO_Box1     |        26888521
 ZDF9WMT4S  | MPO_Box1     |        26888521
 08HC6ERUJ  | MPO_Box1     |        26888521
(10 rows)

geosco2a=# select shi.label_info,su.unit,shi.parent_systemid from shipment_item shi join shipping_unit su on shi.shipping_unit_systemid=su.system_id join shipment_order sho on  shi.shipment_order_systemid=sho.system_id  where sho.shipment_order_id similar to '%1418%' and shi.parent_systemid is null;
 label_info |     unit     | parent_systemid 
------------+--------------+-----------------
 9IRLCO5BT  | MPO_Complex1 |            NULL
(1 row)

/ Dit is ook wat H. doet	, 

$ vi ShipmentOrder.standard.hbm.xml

		<set name="shipmentItemList" cascade="delete" sort="com.mpobjects.util.dao.StringSequencedEntityComparator" where="PARENT_SYSTEMID is null">
			<cache usage="read-write" />
			<key column="SHIPMENT_ORDER_SYSTEMID" update="false"/>
			<one-to-many class="com.mpobjects.oms.model.shipmentorder.vo.ShipmentItemVO" />
		</set>

/ Einde Intermezzo

		// Get the top level items
		Collection<ShipmentItemVO> myAll = new ArrayList<ShipmentItemVO>(myExisting.getShipmentItemList());
[shipmentItem: 0010(systemId:26888521, labelInfo:9IRLCO5BT)]
		myAll.removeAll(aExistingItems);
[]
		if (myAll.isEmpty()) {
			// The current shipment order is processed completely, no need to split.
			updateProductItemsForDesadv(aExistingItems);
/s
GeoScoServiceOrderProcessor.updateProductItemsForDesadv(Collection<ShipmentItemVO>) line: 1254	
/=
	private void updateProductItemsForDesadv(Collection<ShipmentItemVO> aResult) {

aResult= [shipmentItem: 0010(systemId:26888521, labelInfo:9IRLCO5BT)] 		/ de MPO_Complex1	, 

		for (ShipmentItemVO myItem : aResult) {
			if (!myItem.getPackedItemList().isEmpty()) {
/ NEE 
myItem= shipmentItem: 0010(systemId:26888521, labelInfo:9IRLCO5BT) 		/ de MPO_Complex1	, 
/ Ook NEE straks voor MPO_Pallet1	, als 1 van de children van MPO_Complex1	,

			updateProductItemsForDesadv(myItem.getChildren());

myItem.getChildren()=
[
shipmentItem: 0090(systemId:26888529, labelInfo:BBRF9XZPD), 
shipmentItem: 0020(systemId:26888522, labelInfo:KI8GXTZWA), 
shipmentItem: 0100(systemId:26888530, labelInfo:B5IQCGIYQ), 
shipmentItem: 0080(systemId:26888528, labelInfo:CJ0K8I29S), 
shipmentItem: 0070(systemId:26888527, labelInfo:HWZV8SN0F), 
shipmentItem: 0060(systemId:26888526, labelInfo:GB1K8NDKU), 
shipmentItem: 0050(systemId:26888525, labelInfo:CE3N3ZRB1), 
shipmentItem: 0040(systemId:26888524, labelInfo:ZDF9WMT4S), 
shipmentItem: 0030(systemId:26888523, labelInfo:08HC6ERUJ)]
/ 9 , klopt	,

/s
	private void updateProductItemsForDesadv(Collection<ShipmentItemVO> aResult) {

/ SET QUANTITY ON PRODUCT ITEM

aResult=
[
shipmentItem: 0090(systemId:26888529, labelInfo:BBRF9XZPD), 
shipmentItem: 0020(systemId:26888522, labelInfo:KI8GXTZWA), 
shipmentItem: 0100(systemId:26888530, labelInfo:B5IQCGIYQ), 
shipmentItem: 0080(systemId:26888528, labelInfo:CJ0K8I29S), 
shipmentItem: 0070(systemId:26888527, labelInfo:HWZV8SN0F), 
shipmentItem: 0060(systemId:26888526, labelInfo:GB1K8NDKU), 
shipmentItem: 0050(systemId:26888525, labelInfo:CE3N3ZRB1), 
shipmentItem: 0040(systemId:26888524, labelInfo:ZDF9WMT4S), 
shipmentItem: 0030(systemId:26888523, labelInfo:08HC6ERUJ)]
/ 9	, 1 ervan is de pallet	, 

			if (!myItem.getPackedItemList().isEmpty()) {
myItem=shipmentItem: 0090(systemId:26888529, labelInfo:BBRF9XZPD)			/ BOX2

				ProductItemVO myProductItem = myItem.getPackedItemList().get(0).getProductItemVO();
MPO_Prod2
				myProductItem = productItemDAO.getBySystemId(myProductItem.getSystemId());

				BigDecimal myQty = BigDecimal.ZERO;
				for (PackedItemVO myPacked : myProductItem.getPackedItemList()) {
myProductItem	ProductItemVO  (id=20630)	
	thePackedItemList	PersistentBag  (id=20684)	
		bag	ArrayList  (id=20722)	
			elementData	Object[9]  (id=20762)	
				[0]	PackedItemVO  (id=20728)		
				[1]	PackedItemVO  (id=20729)	
				[2]	PackedItemVO  (id=20716)	
				[3]	PackedItemVO  (id=20730)	
				[4]	PackedItemVO  (id=20731)	
				[5]	PackedItemVO  (id=20732)	
				[6]	PackedItemVO  (id=20733)	
				[7]	PackedItemVO  (id=20734)	
			size	8	
/ Het product MPO_Prod2 zit in 8 pi's, dus in 8 shi's	,
/ Zie scherm : de pallet (en complex) heet geen packed item	, dus de pallet (en complex) komen in dit lijstje niet voor	,	
					ShipmentItemVO myPackedInShipmentItem = myPacked.getShipmentItemVO();
					if (StringUtils.isNotEmpty(myPackedInShipmentItem.getCaseNumber())) {
/ 2 bij ons	,
						myQty = myQty.add(myPacked.getQuantity());
					}
				}
				if (myProductItem.getQuantity().compareTo(myQty) != 0) {
/ JA
					myProductItem.setQuantity(myQty);
					productItemService.save(myProductItem);

/ Intermezzo

/ MPO_Prod2 werkt met pallets	,
/ MPO_Prod2	; geef 40 products	, dan komt er 1 pallet	, met 8 dozen met 5 products	, 	
/ MPO_Prod2	; geef 80	, dan komt er 2 pallets	,

/ MPO_Prod1 werkt met dozen	,
/ MPO_Prod2	; geef 20 products	, dan komt er 2 dozen , elk met 10 products	,

/ Doe op dezelfde dag naar dezefde vendor MPO_Prod1 en MPO_Prod2	, dan verschijnen ze op dezelfde sho	,
/ De vendor op de forecast replenishment scherm zien we links onder	, MPO_Vend1 bij ons	,  

/ Als we een sho hebben met een pallet (MPO_Prod2)  en  2 dozen (MPO_Prod1)	, en we laten 1 doos in de 04-desadv komen	, dan verschijnt deze ene doos op een nieuwe sho	, see 1535 op acc	. Op deze is de quantity op de product item NIET OK	. Op de oorscronkelijke sho is de quantity wel aangepast (van 20 naar 10)	, maar deze zijn nog niet binnen	, dus dat is iets anders	,

/ Einde Intermezzo

/s
ProductItemServiceImpl.save(ProductItemVO, boolean, boolean) line: 531	
/=
	public ProductItemVO save(ProductItemVO aProductItemVO, boolean recalculate, boolean useQueue) {
aProductItemVO=MPO_Prod2
recalculate=true
useQueue=false

		ProductItemEvent myEvent = null;
		if (shouldFireEvent()) {
			myEvent = createProductItemEvent(aProductItemVO);
productitem.updated, context [id/value: 447369810/63]]  old [null] new [PRODUCT_ITEM id:null(systemId:26883423)] 

		if (shouldFireEvent()) {
			fireProductItemEvent(myEvent);
/s
ProductItemServiceImpl.fireProductItemEvent(ProductItemEvent) line: 275	
			eventHandlerService.handleEvent(anEvent);
/s
EventHandlerServiceImpl.handleEvent(Event) line: 72	
			listenerList.fireEvent(anEvent);
/s
StockTransactionEventListener.handleEvent(Event<?>) line: 38	
/=
	public void handleEvent(Event<?> anEvent) throws AbstractException {
anEvent=
productitem.updated, context [id/value: 447369810/63]]  old [null] new [PRODUCT_ITEM id:null(systemId:26883423)] 

			} else if (anEvent.getEventType().startsWith(ProductItemEvent.PREFIX)) {
"productitem"
				ProductItemEvent myEvent = (ProductItemEvent) anEvent;
				handle(myEvent);
/s
StockTransactionEventListener.handle(ProductItemEvent) line: 109	
		} else if (anEvent.getEventType().equals(ProductItemEvent.UPDATED)) {
			stockTransactionService.handleProductItemUpdated(anEvent);
/s
StockTransactionServiceImpl.handleProductItemUpdated(ProductItemEvent) line: 242	

		ProductItemVO item = anEvent.getNewVO();
		Product product = getProduct(item);

		// This method is also called by handleProductItemCreated
		boolean isNewProduct = ProductItemEvent.CREATED.equals(anEvent.getEventType());
false
		// old vo is not set for productitem in productitemservice.save
/ TODO
		boolean shouldUpdate = isNewProduct || anEvent.getOldVO() == null;
true
		if (!shouldUpdate) {
/ NEE

		// Explode the bill of material
		if (transactions == null) {
			transactions = stockTransactionDAO.getByProductItem(item);
elementData	Object[10]  (id=22762)	
	[0]	StockTransaction  (id=22755)	
		productItem	ProductItemVO  (id=20630)	
			theQuantity	BigDecimal 21
			the Product Product
				code	"MPO_Prod2" (id=22861)	
		quantity	BigDecimal  (id=22760)	

			productList = productService.getProductList(product, getTransactionQuantity(item), 1);
/s
tockTransactionServiceImpl.getTransactionQuantity(ProductItemVO) line: 324	
		if (!NumberUtils.isNullOrZero(itemVO.getActualQuantity())) {
/ NEE
			return itemVO.getActualQuantity();
/ NIET
		} else {
			return itemVO.getQuantity();
/t
			productList = productService.getProductList(product, getTransactionQuantity(item), 1);
/d
{Product: BigDecimal}={MPO_Prod2 (27135414)=24.00}
/ quantity uit de product item	,


/ SET QUANTITY ON STOCK TRANSACTION
/ De quantity op de stock transaction= product item's actual quantity, of als deze er niet is, de quantity	,
		// Process existing transactions
		for (StockTransaction tx : transactions) {
			BigDecimal expectedQty = productList.get(tx.getProduct());
			if (NumberUtils.compareTo(expectedQty, tx.getQuantity()) != 0) {
				markNextDirty(tx);
				tx.setQuantity(expectedQty);
				tx.setDirty(true);
				stockTransactionDAO.save(tx);
			}


//////////////////////////////////////

/ FIX PSA-537

/ 13	. 

/ Er zijn 2 methods waar een b in moet	,
GeoScoServiceOrderProcessor.updateProductItemsForDesadv(Collection<ShipmentItemVO>) line: 1269	
/ SET QUANTITY ON PACKED ITEM
/ and call to set quantity on stock transaction	,
					productItemService.save(myProductItem);
/s
StockTransactionServiceImpl.handleProductItemUpdated(ProductItemEvent) line: 261	
/ SET QUANTITY ON STOCK TRANSACTION

$ vi GeoScoServiceOrderProcessor.java

	private void updateProductItemsForDesadv(Collection<ShipmentItemVO> aResult) {
		for (ShipmentItemVO myItem : aResult) {
...
			}
->			updateProductItemsForDesadv(myItem.getChildren());
/ Deze erbij	,


/ Einde DEBUG PSA-537

/ PSA-538

/  7	. 

https://acceptance-geosco.mp-objects.com/extplorer/index.php
geodis
geodis@mpo

[eric@localhost bin]$ mk_ssh_passwordless_intermax.sh geosco-int-a
h^Zgcyr&Q

[eric@localhost bin]$ cat geosco-int-a.sh 
#!/bin/bash
ssh vanderveldene@geosco-int-a.intermax.mp-objects.com

[eric@localhost bin]$ geosco-int-a.sh 
[vanderveldene@geosco-int-a ~]$  ls /local/apps/interface/geodispsa
geodispsa/    geodispsa-mq/ 
[vanderveldene@geosco-int-a ~]$  ls /local/apps/interface/geodispsa/from-scs/
0/                    13/                   24-INVOIC/            35-INVRPT/            FORECAST/
02-FORECAST/          15-PMDUPD/            25-PREPORD/           36-ORDER/             
05-IFCSUM/            16-RECADV/            33-VENDUPD/           50/                   
08-DESADV/            19-PREINV/            34-VENDPMD/           APPLICATION_RESPONSE/ 
[vanderveldene@geosco-int-a ~]$  ls /local/apps/interface/geodispsa/from-scs/APPLICATION_RESPONSE/archive/2016-05/11
queue-MPOBJECTS-FROM-GEOSCO-ID-geosco-app-a-46347-1462323835996-6-92-1-1-1
queue-MPOBJECTS-FROM-GEOSCO-ID-geosco-app-a-46347-1462323835996-6-92-1-1-3
queue-MPOBJECTS-FROM-GEOSCO-ID-geosco-app-a-46347-1462323835996-6-92-1-1-4
queue-MPOBJECTS-FROM-GEOSCO-ID-geosco-app-a-46347-1462323835996-6-92-1-1-5
/ Hoe hebben we deze messages local	?
/ TODO

/ we hebben blijkbaar ook eerder	,

[eric@localhost bin]$ mk_ssh_passwordless_intermax.sh integration-a 
h^Zgcyr&Q
/ want	,
[eric@localhost bin]$ ssh vanderveldene@integration-a.intermax.mp-objects.com
/ OK

/ 7	. 
[eric@localhost Geosco]$ pwd
/home/eric/Integration/Geosco
[eric@localhost Geosco]$ ls -ltr
total 88
-rw-r-----. 1 eric eric  9033 Apr 25 12:46 13-RECADV-ID-SCSIN.xml
/ Oud	,

-rw-r-----. 1 eric eric 18914 May 10 17:05 04-DESADV-ID-SH-1248.xml
/ OK
-rw-r-----. 1 eric eric 10066 May 11 10:50 13-RECADV-ID-SCSIN-TESTING.xml
/ Laatste van Jan	,

/ 7	. 

/ de 04-DESADV is antwoord op purchase	, 
/ SCS parses de 04-DESACV en psta daarmee packed items aan, shi's , ... 
/ 13-RECADV is antwoord op receipt	, de  receipt die het warehouse krijgt van de spullen	,
/ SCS parses de 13-RECADV en zal weer packed items aanpassen, set actual quantity, ...
/ de 04-DESADV is op shi niveau	, de sho komt niet voor	, hij kijkt naar de label info LA2JS1QEV	, A4CI08394	
/ het forecast scherm had de SH000001417 create	,

/ de 04-DESADV sets packed item's quantity	,
/ de 13-RECADV sets packet item's actual quantity	,

/ we zijn op SH000001417
/ we zien de receipt seo N0006171

/ we passen aan	,

/ AANPASSEN 13-RECADV 

$ 13-RECADV-ID-SCSIN-TESTING.xml

   <mtc:header>
     <mtc:ref xmlns:mtc="http://system.mp-objects.com/schemas/MTC/MTCCore/V1/MTCCore.xsd">
         <mtc:VALUE>PSA_MPO_RECADV_20160315_155231_0344.xml</mtc:VALUE>							/ +1	, 
         <mtc:QUALIFIER>fileName</mtc:QUALIFIER>
      </mtc:ref>

   <mtc:body>
      <mtc:SERVICE_ORDER>
         <mtc:SERVICE_ORDER_BODY>
            <mtccore:SERVICE_ORDER_ID>N0006171</mtccore:SERVICE_ORDER_ID>						/ receipt	,

           <mtc:SHIPMENT_ORDER>																	/ sho	,
               <mtc:SHIPMENT_ORDER_BODY>
                  <mtccore:SHIPMENT_ORDER_ID>SH000001417</mtccore:SHIPMENT_ORDER_ID>

               <mtc:PRODUCT_ITEMS>
                  <mtccore:PRODUCT_ITEM>
                     <mtccore:PRODUCT_ITEM_ID>1</mtccore:PRODUCT_ITEM_ID>
                     <mtccore:SHIPMENT_ORDER_ID>SH000001417</mtccore:SHIPMENT_ORDER_ID>

               <mtc:SHIPMENT_ITEMS>
                  <mtccore:SHIPMENT_ITEM>
                     <mtccore:SHIPMENT_ORDER_ID>SH000001417</mtccore:SHIPMENT_ORDER_ID>
                     <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:SHIPMENT_ORDER_ID>SH000001417</mtccore:SHIPMENT_ORDER_ID>
		  		  <mtccore:SHIPMENT_ITEM>
                     <mtccore:SHIPMENT_ORDER_ID>SH000001417</mtccore:SHIPMENT_ORDER_ID>
                        <mtccore:PACKED_ITEM>
                           <mtccore:SHIPMENT_ORDER_ID>SH000001417</mtccore:SHIPMENT_ORDER_ID>

           <mtc:SHIPMENT_ORDER>
               <mtc:PRODUCT_ITEMS>
                  <mtccore:PRODUCT_ITEM>
                     <mtccore:PRODUCT>
                        <mtccore:PRODUCT_ID>MPO_Prod1</mtccore:PRODUCT_ID> 					/ 

               <mtc:SHIPMENT_ITEMS>
                 <mtccore:SHIPMENT_ITEM>
                     <mtccore:PACKAGE_CODE>MPO_Box1</mtccore:PACKAGE_CODE>					/ 
                     <mtccore:CASE_NUMBER>BOX1</mtccore:CASE_NUMBER>						/ 
                     <mtccore:CONTAINER_NUMBER>100971646</mtccore:CONTAINER_NUMBER>			/


/ Einde PSA-538

/ DEBUG PSA-538

/ we zijn in 	,
/ stack	,
Thread [GeoScoQueueContainer-1] (Suspended)	
	ServiceOrderMsgProcessor.getServiceOrderProcessor() line: 128	
	ServiceOrderMsgProcessor.process(Node) line: 91	
	ServiceOrderMsgConsumer.process(Message) line: 52	
	ServiceOrderMsgConsumer(MessageConsumer).handle(Message) line: 108	
	MessageConsumerHandler$$EnhancerBySpringCGLIB$$ca5a33ca(MessageConsumerHandler).onExchange(MessageExchange) line: 172	
	MessageConsumerHandler$$EnhancerBySpringCGLIB$$ca5a33ca(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 43	
	SingletonExchangeHandlerChain.next(MessageExchange) line: 43	
	DemuxExchangeHandler.handleMessage(ExchangeHandler, MessageExchange) line: 110	
	DemuxExchangeHandler.onExchange(MessageExchange) line: 123	
	DemuxExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 43	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	TxExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	TxExchangeHandler.handleExchange(ExchangeHandlerChain, MessageExchange) line: 62	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	MessageTraceExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	AuthNExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	ArchiveExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	SapXConverterExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	ArchiveErrorExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	RetryExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	RetryExchangeHandler.handleExchange(ExchangeHandlerChain, MessageExchange) line: 80	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	MessageHandler.handleExchange(MessageExchange) line: 55	
	MpoMessageListener.processMessage(Message, JmsMpoMessage) line: 378	
	MpoMessageListener.onMessage(Message) line: 199	
	DefaultMessageListenerContainer(AbstractMessageListenerContainer).doInvokeListener(MessageListener, Message) line: 569	
	DefaultMessageListenerContainer(AbstractMessageListenerContainer).invokeListener(Session, Message) line: 507	
	DefaultMessageListenerContainer(AbstractMessageListenerContainer).doExecuteListener(Session, Message) line: 474	
	DefaultMessageListenerContainer(AbstractPollingMessageListenerContainer).doReceiveAndExecute(Object, Session, MessageConsumer, TransactionStatus) line: 325	
	DefaultMessageListenerContainer(AbstractPollingMessageListenerContainer).receiveAndExecute(Object, Session, MessageConsumer) line: 263	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener() line: 1103	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop() line: 1095	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run() line: 992	
	Thread.run() line: 745	

/s
ServiceOrderMsgProcessor.process(Node) line: 91	
			Node myBody = selectSingleNode(aNode, "body");
			Iterable<Node> myIterator = selectNodeIterable(myBody, SERVICE_ORDER_TAG);
			for (Node myNode : myIterator) {
				if (myNode != null) {
					getServiceOrderProcessor().process(myNode);
/s
ServiceOrderMsgProcessor.getServiceOrderProcessor() line: 128	
		if (serviceOrderProcessor == null) {
			serviceOrderProcessor = MpoBeanFactory.getBean(ServiceOrderProcessor.class);
com.mpobjects.geosco.model.serviceorder.xml.GeoScoServiceOrderProcessor@673bd9de

/ Intermezzo

$ vi geosco-service.sb.xml

	<bean id="com.mpobjects.oms.model.serviceorder.xml.ServiceOrderProcessor" class="com.mpobjects.geosco.model.serviceorder.xml.GeoScoServiceOrderProcessor">
		<property name="serviceOrderExportService" ref="com.mpobjects.oms.model.service.export.ServiceOrderExportService" />
		<property name="serviceOrderDao" ref="com.mpobjects.oms.dao.ServiceOrderDao" />
		<property name="serviceOrderTypeDAO" ref="com.mpobjects.oms.dao.serviceordertype.ServiceOrderTypeDAO" />
		<property name="productItemDAO" ref="com.mpobjects.oms.model.shipmentorder.dao.ProductItemDAO" />
...
/ TODO (Wanneer Spring started	, en hoe wordt  geosco-service.sb.xml gevonden?)

/ Einde Intermezzo

			serviceOrderProcessor.setParent(this);
this=
com.mpobjects.oms.model.serviceorder.xml.ServiceOrderMsgProcessor@5a192e84

		return serviceOrderProcessor;
/t
/s
GeoScoServiceOrderProcessor.process(Node) line: 227	

		ServiceOrderBodyProcessor myProcessor = Factory.getFactory().getInstance(ServiceOrderBodyProcessor.class);
com.mpobjects.oms.model.serviceorder.xml.ServiceOrderBodyProcessor@48292214

			serviceOrderId = org.apache.commons.lang3.StringUtils.defaultIfBlank(
					selectText(aNode, ServiceOrderNames.SERVICE_ORDER_BODY, MTCCoreNames.SERVICE_ORDER_ID), null);
N0006171
/ want	,
  <mtc:body>
      <mtc:SERVICE_ORDER>
            <mtccore:SERVICE_ORDER_ID>N0006171</mtccore:SERVICE_ORDER_ID>

			if (serviceOrderId != null) {
				lockManager.lock(serviceOrderId, null);
				locked = true;
			}
/ TODO

			final String purposeCode = selectText(aNode, MTCCoreNames.PROCESSING_DETAILS, MTCCoreNames.PURPOSE_CODE);
ReceiptAdviceShipment
			final String documentId = selectText(aNode, MTCCoreNames.PROCESSING_DETAILS, REQUESTED_ID);
164
/ want	,
   <mtc:body>
      <mtc:SERVICE_ORDER>
         <mtc:PROCESSING_DETAILS>
            <mtccore:PURPOSE_CODE>ReceiptAdviceShipment</mtccore:PURPOSE_CODE>
            <mtccore:REQUESTED_ID>164</mtccore:REQUESTED_ID>

			} else if (RECEIPT_ADVICE_SHIPMENT.equals(purposeCode)) {
				processReceiptAdviceShipment(aNode, myProcessor, documentId);
/s
GeoScoServiceOrderProcessor.processReceiptAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 1101	

		ServiceOrderVO myServiceOrderVOIncomming = aProcessor.process(selectSingleNode(aNode, SERVICE_ORDER_BODY_TAG));
   <mtc:body>
      <mtc:SERVICE_ORDER>
         <mtc:SERVICE_ORDER_BODY>
/ Slaan we nu over	,
/ TODO
		processConsignments(aNode, myServiceOrderVOIncomming);
/s
GeoScoServiceOrderProcessor(ServiceOrderProcessorImpl).processConsignments(Node, ServiceOrderVO) line: 339	
			Iterable<Node> myConsignmentIterator = selectNodeIterable(aNode, "CONSIGNMENT");
					String myConsignmentNr = selectText(myConsignmentNode, "CONSIGNMENT_BODY", "CONSIGNMENT_ID");
""
        <mtc:CONSIGNMENT>
            <mtc:CONSIGNMENT_BODY>
               <mtccore:CONSIGNMENT_ID/>

					Iterable<Node> myShipmentOrderIterator = selectNodeIterable(myConsignmentNode, "SHIPMENT_ORDER");
					for (Node myShipmentOrderNode : myShipmentOrderIterator) {
						if (myShipmentOrderNode == null) {
/ NEE
						} else {
							ParsedShipmentOrder myParsedShipmentOrderVO = new ShipmentOrderProcessor().process(myShipmentOrderNode);
/s
ShipmentOrderProcessor.process(Node) line: 199	
		ShipmentOrderBodyProcessor myProcessor = Factory.getFactory().getInstance(ShipmentOrderBodyProcessor.class);
			myShipmentOrderVO = myProcessor.process(selectSingleNode(aNode, SHIPMENT_ORDER_BODY_TAG));
/s
ShipmentOrderBodyProcessor.process(Node) line: 455	
        <mtc:CONSIGNMENT>
            <mtc:SHIPMENT_ORDER>
               <mtc:SHIPMENT_ORDER_BODY>
                  <mtccore:SHIPMENT_ORDER_ID>SH000001417</mtccore:SHIPMENT_ORDER_ID>
                  <mtccore:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtccore:ORGANIZATION_ID>
               </mtc:SHIPMENT_ORDER_BODY>

			MpoBeanFactory.getBean(EntityDetailService.class).initialize(myShipmentOrderVO);
/ Uit table bij SHIPMENT_ORDER 4 entity detail types, met "" value	,
...
			Node myNode = selectSingleNode(aNode, ORGANIZATION_ID_TAG);
				Organization myOrganizationVO = OrganizationUtil.getOrganizationFacadeLocal().getOrganization(myNode.getTextContent());
SystemId:12000	Id:LOG_EMEA_FR_CT_PSA	Description:Organization for PSA CT
					myShipmentOrderVO.setOrganizationVO(myOrganizationVO);

			while (childNode != null) {

				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String myTag = getElementName(childNode);
SHIPMENT_ORDER_ID
					} else if (SHIPMENT_ORDER_ID_TAG.equals(myTag)) {
						String nodeText = childNode.getTextContent();
SH000001417
						myShipmentOrderVO.setShipmentOrderId(nodeText);
/ sets theShipmentOrderId	,

/ verder geen	,
			myShipmentOrderVO.setSystemEntryDate(MpoBeanFactory.getBean(TimeService.class).getPresentDate());
			myShipmentOrderVO.resolveShipmentType();
/ NIETS
/ TODO
			return myShipmentOrderVO;
/t
ShipmentOrderProcessor.process(Node) line: 209	
			myShipmentOrderVO = myProcessor.process(selectSingleNode(aNode, SHIPMENT_ORDER_BODY_TAG));
/d
			List<ProductItemVO> myProductList = parseProductItems(aNode, myShipmentOrderVO);
/s
ShipmentOrderProcessor.parseProductItems(Node, ShipmentOrderVO) line: 140	

               <mtc:PRODUCT_ITEMS>
                  <mtccore:PRODUCT_ITEM>
                     <mtccore:PRODUCT_ITEM_ID>1</mtccore:PRODUCT_ITEM_ID>
                     <mtccore:SHIPMENT_ORDER_ID>SH000001417</mtccore:SHIPMENT_ORDER_ID>
                     <mtccore:PRODUCT>
                        <mtccore:PRODUCT_ID>MPO_Prod1</mtccore:PRODUCT_ID>
                     </mtccore:PRODUCT>
                     <mtccore:QUANTITY>31</mtccore:QUANTITY>
                  </mtccore:PRODUCT_ITEM>
               </mtc:PRODUCT_ITEMS>

		ProductItemProcessor productItemProcessor = new ProductItemProcessor(this);

		Node myNode = myItemsNode.getFirstChild();
		while (myNode != null) {
			if (myNode.getNodeType() == Node.ELEMENT_NODE) {
				if (PRODUCT_ITEM_TAG.equals(getElementName(myNode))) {
					ProductItemVO myProductItem = productItemProcessor.process(myNode, myShipmentOrderVO);
/s
ProductItemProcessor.process(Node, ShipmentOrderVO) line: 312	

			ProductItemVO myItemVO = new ProductItemVO();

			Node childNode = aNode.getFirstChild();
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);

					if (PRODUCT_ITEM_ID_TAG.equals(tag)) {
						// uniqueId = childNode.getTextContent();
						myItemVO.setProductItemId(childNode.getTextContent());
"1"
/ volgende	,
					} else if (SHIPMENT_ORDER_ID_TAG.equals(tag)) {
						myItemVO.setParsedShipmentOrderId(childNode.getTextContent());
/sets ProductItemVO's 		parsedShipmentOrderId 

/t
				childNode = childNode.getNextSibling();
/ volgende	,

/t
ShipmentOrderProcessor.process(Node) line: 215	
			List<ProductItemVO> myProductList = parseProductItems(aNode, myShipmentOrderVO);
/d
			List<ShipmentItemVO> myShipmentItems = parseShipmentItems(aNode, myProductList, myShipmentOrderVO.getOrganizationSystemid());
/s
ShipmentOrderProcessor.parseShipmentItems(Node, List<ProductItemVO>, int) line: 164	

              <mtc:PRODUCT_ITEMS>
                  <mtccore:PRODUCT_ITEM>
                     <mtccore:PRODUCT_ITEM_ID>1</mtccore:PRODUCT_ITEM_ID>
                     <mtccore:SHIPMENT_ORDER_ID>SH000001417</mtccore:SHIPMENT_ORDER_ID>
                     <mtccore:PRODUCT>
                        <mtccore:PRODUCT_ID>MPO_Prod1</mtccore:PRODUCT_ID>
                     </mtccore:PRODUCT>
                     <mtccore:QUANTITY>31</mtccore:QUANTITY>
                  </mtccore:PRODUCT_ITEM>
               </mtc:PRODUCT_ITEMS>

              <mtc:SHIPMENT_ITEMS>
                  <mtccore:SHIPMENT_ITEM>
                     <mtccore:SHIPMENT_ITEM_ID/>
                     <mtccore:SHIPMENT_ORDER_ID>SH000001417</mtccore:SHIPMENT_ORDER_ID>
                     <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:PRODUCT_ITEM_ID>1</mtccore:PRODUCT_ITEM_ID>
                           <mtccore:SHIPMENT_ORDER_ID>SH000001417</mtccore:SHIPMENT_ORDER_ID>
                           <mtccore:QUANTITY>8</mtccore:QUANTITY>
                           <mtccore:ACTUAL_QUANTITY>10</mtccore:ACTUAL_QUANTITY>
                        </mtccore:PACKED_ITEM>
                     </mtccore:PACKED_ITEMS>
                     <mtccore:PACKAGE_CODE>MPO_Box1</mtccore:PACKAGE_CODE>
                     <mtccore:AIRWAYBILL_NUMBER/>
                     <mtccore:CASE_NUMBER>BOX1</mtccore:CASE_NUMBER>
                     <mtccore:CONTAINER_NUMBER>100971646</mtccore:CONTAINER_NUMBER>
                  </mtccore:SHIPMENT_ITEM>
...

		List<ShipmentItemVO> myShipmentItems = new ArrayList<ShipmentItemVO>();
		Node shipmentItemsNode = selectSingleNode(aNode, SHIPMENT_ITEMS_TAG);

		Map<String, ProductItemVO> myProductMap = new HashMap<String, ProductItemVO>();
		for (ProductItemVO myProductItem : aProductList) {
myProductItem.theQuantity=31	, not used WH	,

			if (StringUtils.isNotBlank(myProductItem.getProductItemId())) {
1
				if (StringUtils.isNotBlank(myProductItem.getParsedShipmentOrderId())) {
SH000001417
					myProductMap.put(myProductItem.getParsedShipmentOrderId() + "-" + myProductItem.getProductItemId(), myProductItem);
myProductMap=
{SH000001417-1=PRODUCT_ITEM id:null(systemId:0)}

		ShipmentItemProcessor myProcessor = Factory.getFactory().getInstance(ShipmentItemProcessor.class);
		while (myNode != null) {
			if (myNode.getNodeType() == Node.ELEMENT_NODE) {
				if (SHIPMENT_ITEM_TAG.equals(getElementName(myNode))) {
					ShipmentItemVO myItemVO = myProcessor.process(myNode, myProductMap, anOrganizationSystemId);
/s
ShipmentItemProcessor.process(Node, Map<String,ProductItemVO>, int) line: 355	

			ShipmentItemVO myItemVO = ShipmentItemVOFactory.getShipmentItemVO();

			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
SHIPMENT_ITEM_ID
					} else if (SHIPMENT_ITEM_ID_TAG.equals(tag)) {
						myItemVO.setShipmentItemId(childNode.getTextContent());

/ volgende	,
                    String tag = getElementName(childNode);
SHIPMENT_ORDER_ID
/ Not used	,
/ JAN 

/ volgende	,
					} else if (PACKED_ITEMS_TAG.equals(tag)) {
						for (PackedItemVO item : parsePackedItems(childNode, aProducts)) {
/s
ShipmentItemProcessor.parsePackedItems(Node, Map<String,ProductItemVO>) line: 569	
		List<PackedItemVO> myPackedItems = new ArrayList<PackedItemVO>();

		for (Node aPackedItemNode : selectNodeIterable(aNode, PACKED_ITEM_TAG)) {
			String productItemId = getTextNode(aPackedItemNode, PRODUCT_ITEM_ID_TAG);
1
			BigDecimal myQuantity = parseDecimalNodeValue(aPackedItemNode, PRODUCT_QUANTITY_TAG);
8
			BigDecimal myActualQuantity = parseDecimalNodeValue(aPackedItemNode, MTCCoreNames.ACTUAL_QUANTITY);
10
			String myParserShipmentOrderId = getTextNode(aPackedItemNode, PARSED_SHIPMENT_ORDER_ID_TAG);
SH000001417
			String internalId = getTextNode(aPackedItemNode, INTERNAL_ID_TAG);
""
			ProductItemVO myProduct = null;
			if (StringUtils.isNotEmpty(myParserShipmentOrderId)) {
				myProduct = aProducts.get(myParserShipmentOrderId + "-" + productItemId);
/ processed product item		, theQuantity=31	 , WH niet used	,

/ Intermezzo

              <mtc:PRODUCT_ITEMS>
                  <mtccore:PRODUCT_ITEM>
                     <mtccore:PRODUCT_ITEM_ID>1</mtccore:PRODUCT_ITEM_ID>						<-
                     <mtccore:SHIPMENT_ORDER_ID>SH000001417</mtccore:SHIPMENT_ORDER_ID>			<-
               <mtc:SHIPMENT_ITEMS>
                  <mtccore:SHIPMENT_ITEM>
                     <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:PRODUCT_ITEM_ID>1</mtccore:PRODUCT_ITEM_ID>					<<-
                           <mtccore:SHIPMENT_ORDER_ID>SH000001417</mtccore:SHIPMENT_ORDER_ID>	<<-
/ bij <- , <<- moeten gelijk	,

/ Einde Intermezzo

			PackedItemVO myPackedItem = new PackedItemVO(myProduct, myQuantity);
myProduct is een product item	,
myQuantity=8	,
			if (myActualQuantity != null) {
				myPackedItem.setActualQuantity(myActualQuantity);
10
			if (StringUtils.isNotEmpty(myParserShipmentOrderId)) {
				myPackedItem.setParsedShipmentOrderId(myParserShipmentOrderId);
SH000001417
			myPackedItems.add(myPackedItem);
		return myPackedItems;
/t
ShipmentItemProcessor.process(Node, Map<String,ProductItemVO>, int) line: 374	
					} else if (PACKED_ITEMS_TAG.equals(tag)) {
						for (PackedItemVO item : parsePackedItems(childNode, aProducts)) {
/d
							myItemVO.addPackedItem(item);
/ volgende	,
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
          <mtccore:PACKAGE_CODE>MPO_Box1</mtccore:PACKAGE_CODE>
/ Apart hieronder	, 

/ volgende	,
					} else if (AIRWAYBILL_NUMBER_TAG.equals(tag)) {
						myItemVO.setAirwaybillNumber(childNode.getTextContent());

/ volgende	,
					} else if (CASE_NUMBER_TAG.equals(tag)) {
						myItemVO.setCaseNumber(childNode.getTextContent());
    <mtccore:CASE_NUMBER>BOX1</mtccore:CASE_NUMBER>

/ volgende	,
					} else if (CONTAINER_NUMBER_TAG.equals(tag)) {
						myItemVO.setContainerNumber(childNode.getTextContent());
100971646

/ Klaar met tags	,
			parsePackageCode(aNode, myItemVO, anOrganizationSystemid);
/s
ShipmentItemProcessor.parsePackageCode(Node, ShipmentItemVO, int) line: 477	
		String myPackageCode = getTextNode(aNode, PACKAGE_CODE_TAG);
MPO_Box1
				/* Check if the shipping unit is in the database */
				myUnitVO = MpoBeanFactory.getBean(ShippingUnitDAO.class).getByCode(myPackageCode);
SystemId:27044088	isDeleted: false	ShippingUnit:MPO_Box1	Nr of loading meters: 0.0	Description:MPO_Box1

			myItemVO.setShippingUnit(myUnitVO);
/ myItemVO is de shipment item	, die we hierboven hebben set met alle tags uit de XML	,

			boolean copyShippingUnitToShipmentItem = BooleanUtils.isTrue(ApplicationPropertyManager.getInstance().getModuleProperty("oms", "copy.shippingunit.to.shipmentitem", "false"));
			if (copyShippingUnitToShipmentItem) {
/ JA
				myItemVO.updateDimensionsBasedOnShippingUnit();
/s
ShipmentItemVO.updateDimensionsBasedOnShippingUnit() line: 1224	
		if (theShippingUnit != null) {
			if (NumberUtils.isNullOrZero(getLength()) && NumberUtils.isNullOrZero(getHeight()) && NumberUtils.isNullOrZero(getWidth())
					&& NumberUtils.isNullOrZero(getVolumeM3()) && NumberUtils.isNullOrZero(getBaseWeightKg())) {
JA
				if (theShippingUnit.getDimensions() != null && !theShippingUnit.getDimensions().allNullOrZero()) {
/ JA
					Dimensions aDimensions = theShippingUnit.getDimensions();
Volume [0.36000], Weight [250.00000], Length [1.00000], Width [0.60000], Height [0.60000]
this=shipment item	,
					setLengthM(aDimensions.getLengthM());
					setWidthM(aDimensions.getWidthM());
					setHeightM(aDimensions.getHeightM());
					setVolumeM3(aDimensions.getVolumeM3());
					setBaseWeightKg(aDimensions.getWeightKg());
/t
				// TODO: This was old logic, to be reviewed later 
				myItemVO.setWeightKg(myUnitVO.getDimensions().getWeightKg());
				myItemVO.setVolumeM3(myUnitVO.getDimensions().getVolumeM3());
/t
ShipmentItemProcessor.process(Node, Map<String,ProductItemVO>, int) line: 441	
			parsePackageCode(aNode, myItemVO, anOrganizationSystemid);
			return myItemVO;
/t
ShipmentOrderProcessor.parseShipmentItems(Node, List<ProductItemVO>, int) line: 189	
		while (myNode != null) {
			if (myNode.getNodeType() == Node.ELEMENT_NODE) {
				if (SHIPMENT_ITEM_TAG.equals(getElementName(myNode))) {
					ShipmentItemVO myItemVO = myProcessor.process(myNode, myProductMap, anOrganizationSystemId);
/d
					myShipmentItems.add(myItemVO);
				}
			}
/ volgende net zo	, slaan we over	,
		return myShipmentItems;
/t
ShipmentOrderProcessor.process(Node) line: 217	
			List<ShipmentItemVO> myShipmentItems = parseShipmentItems(aNode, myProductList, myShipmentOrderVO.getOrganizationSystemid());
/d
			ParsedShipmentOrder myRet = new ParsedShipmentOrder(myShipmentOrderVO, myProductList, myShipmentItems);
			return myRet;
/t
GeoScoServiceOrderProcessor(ServiceOrderProcessorImpl).processConsignments(Node, ServiceOrderVO) line: 357	

			for (Node myConsignmentNode : myConsignmentIterator) {
					Iterable<Node> myShipmentOrderIterator = selectNodeIterable(myConsignmentNode, "SHIPMENT_ORDER");
					for (Node myShipmentOrderNode : myShipmentOrderIterator) {
/ er is maar 1 sho in de XML	, 
						if (myShipmentOrderNode == null) {
						} else {
/ JA
							ParsedShipmentOrder myParsedShipmentOrderVO = new ShipmentOrderProcessor().process(myShipmentOrderNode);
/d
							ShipmentOrderVO myShipmentOrderVO = myParsedShipmentOrderVO.getShipmentOrder();
							myShipmentOrderVO.setProductItemList(myParsedShipmentOrderVO.getProductItemList());
							myShipmentOrderVO.setShipmentItemList(myParsedShipmentOrderVO.getShipmentItemList());

							ServiceActionVO myServiceAction = new ServiceActionVO();
							myServiceAction.setShipmentOrderVO(myShipmentOrderVO);
							myServiceAction.setConsignmentVO(myConsignment);
							myConsignment.setServiceOrderVO(serviceOrder);
							myShipmentOrderVO.addServiceAction(myServiceAction);
							myServiceActionList.add(myServiceAction);
						}
					}
					myConsignment.setServiceActionList(myServiceActionList);
					myConsignmentList.add(myConsignment);
				}
			}
			serviceOrder.setConsignmentList(myConsignmentList);
/t
GeoScoServiceOrderProcessor.processReceiptAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 1104	
		processConsignments(aNode, myServiceOrderVOIncomming);
/d
		for (ConsignmentVO myConsignmentVO : myServiceOrderVOIncomming.getConsignmentList()) {
			for (ServiceActionVO myServiceActionVO : myConsignmentVO.getServiceActionList()) {
				ShipmentOrderVO myShipmentOrderVOUpdate = myServiceActionVO.getShipmentOrderVO();
				processRecAdvShipmentOrder(myShipmentOrderVOUpdate);
/s
GeoScoServiceOrderProcessor.processRecAdvShipmentOrder(ShipmentOrderVO) line: 1065	

/ Intermezzo

/ Met een 04-desadv kom je in	, 
GeoScoServiceOrderProcessor.processDevAdvShipmentOrder(ShipmentOrderVO) line: 955	

/ Einde Intermezzo

/s
GeoScoServiceOrderProcessor.processRecAdvShipmentOrder(ShipmentOrderVO) line: 1065	
		ShipmentOrderVO myExistingShipmentOrder = shipmentOrderDao.getShipmentOrder(aShipmentOrderVOUpdate.getShipmentOrderId(),
				aShipmentOrderVOUpdate.getOrganization());

/ See	,
            <mtc:SHIPMENT_ORDER>
               <mtc:SHIPMENT_ORDER_BODY>
                  <mtccore:SHIPMENT_ORDER_ID>SH000001417</mtccore:SHIPMENT_ORDER_ID>			<-
                  <mtccore:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtccore:ORGANIZATION_ID>			<-

/ met deze 2 <-'s wordt de sho gevonden	,

aShipmentOrderVOUpdate=ShipmentOrder: SH000001417(SystemId:0; Org:LOG_EMEA_FR_CT_PSA
myExistingShipmentOrder=ShipmentOrder: SH000001417(SystemId:26879741; Org:LOG_EMEA_FR_CT_PSA)

		Collection<ShipmentItemVO> shipmentItems = new ArrayList<ShipmentItemVO>();
		for (ShipmentItemVO myUpdatedItem : aShipmentOrderVOUpdate.getShipmentItemList()) {
BOX1
			ShipmentItemVO updatedShipmentItem = processRecAdvShipmentItem(myExistingShipmentOrder, myUpdatedItem);
/s
GeoScoServiceOrderProcessor.processRecAdvShipmentItem(ShipmentOrderVO, ShipmentItemVO) line: 1050	
/=
	private ShipmentItemVO processRecAdvShipmentItem(ShipmentOrderVO aExistingShipmentOrder, ShipmentItemVO aUpdatedItem) {

		if (aUpdatedItem.getPackedItemList().isEmpty()) {
/ NEE
/ heeft packed item met (quantity=8 en) actual quantity=10

		BigDecimal myActualQty = aUpdatedItem.getPackedItemList().get(0).getActualQuantity();
10
		for (ShipmentItemVO myExistingShipmentItem : aExistingShipmentOrder.getShipmentItemList()) {
[shipmentItem: 0010(systemId:26888511, labelInfo:LA2JS1QEV), 
shipmentItem: 0020(systemId:26888512, labelInfo:A4CI08394)]

			ShipmentItemVO myFound = processRecAdvNestedShipmentItem(myExistingShipmentItem, aUpdatedItem, myActualQty);
/s
GeoScoServiceOrderProcessor.processRecAdvShipmentItem(ShipmentOrderVO, ShipmentItemVO) line: 1056	
/=
	private ShipmentItemVO processRecAdvNestedShipmentItem(ShipmentItemVO myExistingShipmentItem, ShipmentItemVO aUpdatedItem, BigDecimal myActualQty) {

		if (myExistingShipmentItem.getCaseNumber() != null && myExistingShipmentItem.getCaseNumber().equalsIgnoreCase(aUpdatedItem.getCaseNumber())) {
/ JA,
BOX1
			BigDecimal quantity = aUpdatedItem.getPackedItemList().get(0).getQuantity().setScale(5);
8
			List<PackedItemVO> list = packedItemDAO.getMatchedPackedItemByQuantity(myExistingShipmentItem, quantity);
[]
/ want	,
geosco2a=# select*from tms_packed_item where shipment_item_systemid=26888511;
 system_id | quantity | product_item_systemid | shipment_item_systemid | actual_quantity | additional_info | requested_quantity 
-----------+----------+-----------------------+------------------------+-----------------+-----------------+--------------------
  26888182 | 13.00000 |              26883413 |               26888511 |            NULL | NULL            |           12.00000
(1 row)


/ FIX PSA-538

class PackedItemDAOImpl extends GenericHibernateDAO<PackedItemVO> implements PackedItemDAO {
	@Override
	public List<PackedItemVO> getMatchedPackedItemByQuantity(ShipmentItemVO shipmentItem, BigDecimal quantity) {
->	myDetachedCriteria.add(Restrictions.gt("quantity", new BigDecimal(0)));
		/ WAS: myDetachedCriteria.add(Restrictions.eq("quantity", quantity);


/ Einde FIX PSA-538

/ MORGENOCHTEND
/ Overzicht maken methods waarin verandering	, belangrijke methods	,


/ Einde DEBUG PSA-538

               <xa-datasource-property name="DatabaseName">mpo</xa-datasource-property>
                <xa-datasource-property name="User">mpo</xa-datasource-property>
                <xa-datasource-property name="Password">zwnnCLP0YYVGCdbCDIOp7lS4JrAxEgj4</xa-datasource-property>
 
[vanderveldene@scs-application-p mpo]$ PGPASSWORD=zwnnCLP0YYVGCdbCDIOp7lS4JrAxEgj4 psql -U mpo mpo


/ SAMENVATTING PSA-479 PSA-537 PSA-538

/ PSA-537
/ pallets	, na 04-desadv
/ Open replenish forecast op MPO_Prod2	, stock tx 12-05 Thu	, 24 
/ MPO_Prod2	, pallets	, SH000001418	, 04-DESADV-ID-SH-1248-pallet.xml

/ PSA-479 
/ boxes	,	 na 04-desadv
/ Open replenish forecast op MPO_Prod1	,  stock tx 10-5 Tue, 	21 
/ MPO_Prod1	, boxes , SH000001417	, 04-DESADV-ID-SH-1248.xml

/ PSA-538
/ boxes, na 13-desadv
/ Open replenish forecast op MPO_Prod1	,  stock tx 10-5 Tue, 	21 
/ MPO_Prod1	, boxes , SH000001417	, 13-RECADV-ID-SCSIN-TESTING.xml

		LOG.info("Successfully create shipment order [" + myNewShipmentOrderVO + "]");
		
		//Updating the product items,this ensures updating quantity on product items.
		updateProductItemsForDesadv(myNewShipmentOrderVO.getShipmentItemList());
		return myNewShipmentOrderVO.getShipmentItemList();

/ 7	. 

/ PSA-479

$ vi GeoScoServiceOrderProcessor.class
	private void updateProductItemsForDesadv(Collection<ShipmentItemVO> aResult) {

				if (myProductItem.getQuantity().compareTo(myQty) != 0) {
					myProductItem.setQuantity(myQty);
					productItemService.save(myProductItem);	 		/ PSA-479	, bij boxes , updates stock tx's quantity  
				}
			updateProductItemsForDesadv(myItem.getChildren());	/ PSA-735	, bij pallet (met boxes erop)  wordt prodi's quantity update	,

class PackedItemDAOImpl extends GenericHibernateDAO<PackedItemVO> implements PackedItemDAO {
	@Override
	public List<PackedItemVO> getMatchedPackedItemByQuantity(ShipmentItemVO shipmentItem, BigDecimal quantity) {
	myDetachedCriteria.add(Restrictions.gt("quantity", new BigDecimal(0)));	/ PSA-538	, at least in case of boxes	,  the packi's actual quantity is updated	,

/ Ook	,
/ via 
					productItemService.save(myProductItem);	 		/ PSA-479	, bij boxes , updates stock tx's quantity  
/s
StockTransactionServiceImpl.handleProductItemUpdated(ProductItemEvent) line: 261	
/ sets quantity on stock tx	, 

/ 7	. 

[eric@localhost Geosco]$ pwd
/home/eric/Integration/Geosco
[eric@localhost Geosco]$ ls
04-DESADV-ID-SH-1248.xml		/ PSA-479        
04-DESADV-ID-SH-1248-pallet.xml   / PSA-537
13-RECADV-ID-SCSIN-TESTING.xml	/ PSA-538




/ Einde SAMENVATTING PSA-479 537 538

/ PSA-541

/ Er is ingechecked	, 
/ WH voor PSA-515	, 

$ vi GeoScoServiceOrderProcessor.java

	private Collection<ShipmentItemVO> createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO> aExistingItems) {
...
		LOG.info("Successfully create shipment order [" + myNewShipmentOrderVO + "]");
		
->		//Updating the product items,this ensures updating quantity on product items.		/ New	,
-> 		updateProductItemsForDesadv(myNewShipmentOrderVO.getShipmentItemList());			/ New	,

		return myNewShipmentOrderVO.getShipmentItemList();


/ 7	. 

/ Kies mpo_prod1	,
/ we maken op forecast scherm op 18-05 Wed  een stock tx , 20	, 

/ we krijgen 
SH000001419
/ we zien 2 shi's	,
ZG77RYB2B
CZCQNKM10

/ we zien op de packi's item id 010, quantity 10	,  
/ we zien op de prodi 010 quantity 10	,
/ we zien op de stock tx quantity 20	,
/ Dit zijn allen verwachtingen	, je verwacht dat de stock +20	, 

/ we maken	, 
[eric@localhost Geosco]$ pwd
/home/eric/Integration/Geosco
$ vi 04-DESADV-1-of-2-shis.xml
               <so:SHIPMENT_ITEMS>
                  <mtccore:SHIPMENT_ITEM>
                        <mtccore:PACKED_ITEM>
                           <mtccore:QUANTITY>7</mtccore:QUANTITY>
                        </mtccore:PACKED_ITEM>
                     </mtccore:PACKED_ITEMS>
                     <mtccore:LABEL_NUMBER>ZG77RYB2B</mtccore:LABEL_NUMBER>
/ We sturen hem in	, 
/ we zien nu 2 sho's	,
SH000001419
SH000001419-20160517-161348
/ op	,
SH000001419-20160517-161348
/ ZG77RYB2B , de shi die wel binnenkomt	, komt op de afgesplitste sho	,
/ we zien dat de packi's quantity op 7 OK	, maar de prodi's quantity is nog 10	 ERR  (*)	
/ op SH000001419	, is de shi ZG77RYB2B  rm OK	, de packi quantity is 10 OK	, de prodi quantity is 10 OK,	 
/ See (*) , dus PSA-515 is not solved	,
/ Bij afsplitsen wordt er ook een nieuwe stock tx create	,

/ we zien ook dat de 2 stock tx's quantities niet kloppen	, 
/ bij de stock tx van SH000001419 is de quantity 20	ERR	, zou 10 moeten zijn	,
/ bij de stock tx van SH000001419-20160517-161348 is de quantity  0 ERR	, zou 7 moeten zijn	,

/ Bij het zoeken naar de stock tx moeten we kijken naar de req. end (After) op de sho	, want dat is het verwachte moment dat de 04-desadv het warehouse inkomt	, 
/ TODO


/ Einde PSA-541

/ DEBUG PSA-541

/ we maken een sho , stock tx op Tue 17-05	, Mpo_prod1,	 bestellen er 20	,
/ er is created	 SH000001420 / 010	, 
/ er is created stock tx 	,  

/ In de sho zijn 2 shi's,	
NQXQSUUPX
OW64VX8JQ

/ we maken	,
$ vi 04-DESADV-1-of-2-shis.xml 
              <so:SHIPMENT_ITEMS>
                  <mtccore:SHIPMENT_ITEM>
                     <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:QUANTITY>7</mtccore:QUANTITY>
                        </mtccore:PACKED_ITEM>
                     </mtccore:PACKED_ITEMS>
                     <mtccore:LABEL_NUMBER>NQXQSUUPX</mtccore:LABEL_NUMBER>
/s
GeoScoServiceOrderProcessor.processDespatchAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 402	
		ServiceOrderVO updateServiceOrderVO = aProcessor.process(selectSingleNode(aNode, SERVICE_ORDER_BODY_TAG));
		processConsignments(aNode, updateServiceOrderVO);
		List<ShipmentItemVO> existingShipmentItems = processDesadvServiceOrder(updateServiceOrderVO);
/s
GeoScoServiceOrderProcessor.processDespatchAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 402	
		List<ShipmentItemVO> shipmentItems = new ArrayList<ShipmentItemVO>();
		for (ConsignmentVO myConsignmentVO : aUpdateServiceOrderVO.getConsignmentList()) {
/ processed	, created met new	,
			for (ServiceActionVO myServiceActionVO : myConsignmentVO.getServiceActionList()) {
/ processed	, created met new	,
				ShipmentOrderVO myShipmentOrderVO = myServiceActionVO.getShipmentOrderVO();
/ processed	, created met new	,
				Collection<ShipmentItemVO> myExistingItems = processDesAdvShipmentOrder(myShipmentOrderVO);
/s
GeoScoServiceOrderProcessor.processDesAdvShipmentOrder(ShipmentOrderVO) line: 960	
			for (ShipmentItemVO myItem : myShipmentOrderVO.getShipmentItemList()) {
				myResult.addAll(processDesadvShipmentItem(myItem));
/s
GeoScoServiceOrderProcessor.processDesadvShipmentItem(ShipmentItemVO) line: 933	
		String myLabelInfo = aItem.getLabelInfo();
NQXQSUUPX
		ShipmentItemVO myExistingItem = shipmentItemDAO.getShipmentItem(myLabelInfo);
shipmentItem: 0010(systemId:26888534, labelInfo:NQXQSUUPX)

		if (myExistingItem.getShipmentItemList().isEmpty()) {
			return processDesadvSingleShipmentItem(myExistingItem, aItem);
/s
GeoScoServiceOrderProcessor.processDesadvSingleShipmentItem(ShipmentItemVO, ShipmentItemVO) line: 975	
/=
	private Collection<ShipmentItemVO> processDesadvSingleShipmentItem(ShipmentItemVO aExistingItem, ShipmentItemVO aProcessedItem) {
existingItem=shipmentItem: 0010(systemId:26888534, labelInfo:NQXQSUUPX)
aProcessedItem=shipmentItem: Box1(systemId:0, labelInfo:NQXQSUUPX)

		aExistingItem.setCaseNumber(aProcessedItem.getCaseNumber());
/ Het label	, BOX1	,
		aExistingItem.setContainerNumber(aProcessedItem.getContainerNumber());
100971646

		if (aProcessedItem.getPackedItemList().isEmpty()) {
/ NEE
		} else if (aExistingItem.getPackedItemList().isEmpty()) {
/ NEE
/ Klopt	, die moet er zijn	, rechts op het scherm in een shi	, in het blauw	,
		} else {
			PackedItemVO myProcessedPackedItemVO = aProcessedItem.getPackedItemList().iterator().next();
			PackedItemVO myExistingPackedItemVO = aExistingItem.getPackedItemList().iterator().next();

			myExistingPackedItemVO.setRequestedQuantity(myExistingPackedItemVO.getQuantity());
/ TODO
			myExistingPackedItemVO.setQuantity(myProcessedPackedItemVO.getQuantity());
/ van 10 -> 7
/t
GeoScoServiceOrderProcessor.processDesAdvShipmentOrder(ShipmentOrderVO) line: 961	
			for (ShipmentItemVO myItem : myShipmentOrderVO.getShipmentItemList()) {
myShipmentOrderVO=
ShipmentOrder: 2589(SystemId:0; Org:LOG_EMEA_FR_CT_PSA)	/ de processed shi	, heeft maar 1 packi	,
				myResult.addAll(processDesadvShipmentItem(myItem));
/d
myResult=
[shipmentItem: 0010(systemId:26888534, labelInfo:NQXQSUUPX)]
		return myResult;
/t
GeoScoServiceOrderProcessor.processDesadvServiceOrder(ServiceOrderVO) line: 908	
		for (ConsignmentVO myConsignmentVO : aUpdateServiceOrderVO.getConsignmentList()) {
			for (ServiceActionVO myServiceActionVO : myConsignmentVO.getServiceActionList()) {
				ShipmentOrderVO myShipmentOrderVO = myServiceActionVO.getShipmentOrderVO();
				Collection<ShipmentItemVO> myExistingItems = processDesAdvShipmentOrder(myShipmentOrderVO);
/d
myExistingItems=
[shipmentItem: 0010(systemId:26888534, labelInfo:NQXQSUUPX)]
				Map<ShipmentOrderVO, Collection<ShipmentItemVO>> myShipmentOrderMap = createShipmentOrderMap(myExistingItems);
myShipmentOrderMap=
{ShipmentOrder: SH000001420(SystemId:26879763; Org:LOG_EMEA_FR_CT_PSA)=[shipmentItem: 0010(systemId:26888534, labelInfo:NQXQSUUPX)]}
/ de sho & de processed -> existing shi's	,

				for (Collection<ShipmentItemVO> myItemsByOrder : myShipmentOrderMap.values()) {
					Collection<ShipmentItemVO> myProcessedItems = createNewShipmentOrderForProcessedItems(myItemsByOrder);
/s
GeoScoServiceOrderProcessor.createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO>) line: 624	
/=
	private Collection<ShipmentItemVO> createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO> aExistingItems) {

aExistingItems=
[shipmentItem: 0010(systemId:26888534, labelInfo:NQXQSUUPX)]

		// Get the existing shipment order
		ShipmentOrderVO myExisting = aExistingItems.iterator().next().getShipmentOrder();

		// Get the top level items
		Collection<ShipmentItemVO> myAll = new ArrayList<ShipmentItemVO>(myExisting.getShipmentItemList());
/ dit zijn er 2	, 
[shipmentItem: 0010(systemId:26888534, labelInfo:NQXQSUUPX), 
shipmentItem: 0020(systemId:26888535, labelInfo:OW64VX8JQ)]

		myAll.removeAll(aExistingItems);
myAll=
[shipmentItem: 0020(systemId:26888535, labelInfo:OW64VX8JQ)]

		if (myAll.isEmpty()) {
			// The current shipment order is processed completely, no need to split.
/ NEE

//////////////////////////////////////
/ Maak de afgesplitste sho	,

		// Create a copy of the current shipment order.

		// copy header
		ShipmentOrderVO myNewShipmentOrderVO = myExisting.copy();
		myNewShipmentOrderVO.setSystemId(ValueObject.VOLATILE_SYSTEM_ID);
		// id must be altered
		myNewShipmentOrderVO.setShipmentOrderId(myExisting.getShipmentOrderId().trim() + "-" + String.format("%1$tY%1$tm%1$td-%1$tH%1$tM%1$tS", new Date()));
ShipmentOrder: SH000001420-20160518-083336(SystemId:0; Org:LOG_EMEA_FR_CT_PSA)
/ TODO "%1$tY%1$tm%1$td-%1$tH%1$tM%1$tS"

		myNewShipmentOrderVO.setReasonCode(getPartialDeliveryReasonCode());
/ sets theReasonCode	,
		myExisting.setReasonCode(getPartialDeliveryReasonCode());

			// first save header in order to attach items
			myNewShipmentOrderVO = shipmentOrderService.createShipmentOrder(myNewShipmentOrderVO);
/ TODO (Slaan we over)
/ myNewShipmentOrderVO heeft systemId	,

		// Copy product items to the new shipment order, based on the shipment items which have been received
//////////////////////////////
/ Klopt	, de received shi's zijn de existing shi's	, en dat is de collection arg van deze method	,
 
		Set<ProductItemVO> myCopyList = getProductItems(aExistingItems);
/s
GeoScoServiceOrderProcessor.getProductItems(Collection<ShipmentItemVO>) line: 752	
		Set<ProductItemVO> myList = new HashSet<ProductItemVO>();
		for (ShipmentItemVO myItem : aExistingItems) {
shipmentItem: 0010(systemId:26888534, labelInfo:NQXQSUUPX)	, 						/ existing	,

			for (PackedItemVO myPacked : myItem.getPackedItemList()) {
/= thePackedItemList	,
				myList.add(myPacked.getProductItemVO());
/= theProductItemVO	,
[PRODUCT_ITEM id:null(systemId:26883435)]											/ , existing	,

heQuantity=20 / van deze prodi	,	 is dus nog het verwachte totale aantal	, 
theiProductItemId="010"
theDescription="MPO_Prod1"

			}
			myList.addAll(getProductItems(myItem.getShipmentItemList()));
[] 
/////////////////////////////////////////////////////////
/ PALLET
/ bij ons nu	, geen pallets	, 
		}
		return myList;
/t
GeoScoServiceOrderProcessor.createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO>) line: 659	
		// Copy product items to the new shipment order, based on the shipment items which have been received
		Set<ProductItemVO> myCopyList = getProductItems(aExistingItems);
/d
[PRODUCT_ITEM id:null(systemId:26883435)]	, existing	,

		Map<ProductItemVO, ProductItemVO> myProductItemMapping = new HashMap<ProductItemVO, ProductItemVO>();
		for (ProductItemVO myOriginalProductItem : myCopyList) {
			ProductItemVO myNewProductItem = myOriginalProductItem.copy();
			myNewProductItem.setShipmentOrder(myNewShipmentOrderVO);
			myNewProductItem.setQuantity(BigDecimal.ZERO);						/ !
			productItemService.save(myNewProductItem);
/s
ProductItemServiceImpl.save(ProductItemVO, boolean, boolean) line: 544	
			myEvent = createProductItemEvent(aProductItemVO);
productitem.created, context [id/value: 593184284/63]]  old [null] new [PRODUCT_ITEM id:null(systemId:26883459)] 

		if (recalculate) {
			ShipmentOrderVO sho = aProductItemVO.getShipmentOrder();
			recalculateShipmentOrder(sho);
/ Hier valt debugger onderdoor in	,
			aProductItemVO.setShipmentOrder(sho);

			fireProductItemEvent(myEvent);
/s
StockTransactionEventListener.handleEvent(Event<?>) line: 47	
			} else if (anEvent.getEventType().startsWith(ProductItemEvent.PREFIX)) {
				ProductItemEvent myEvent = (ProductItemEvent) anEvent;
				handle(myEvent);
/s
StockTransactionEventListener.handle(ProductItemEvent) line: 107	
		} else if (anEvent.getEventType().equals(ProductItemEvent.CREATED)) {
			stockTransactionService.handleProductItemCreated(anEvent);
/s
StockTransactionServiceImpl.handleProductItemCreated(ProductItemEvent) line: 214	
		handleProductItemUpdated(anEvent);
/s
StockTransactionServiceImpl.handleProductItemUpdated(ProductItemEvent) line: 247	
		ProductItemVO item = anEvent.getNewVO();
item's sho=
ShipmentOrder: SH000001422-20160518-125954(SystemId:26879787; Org:LOG_EMEA_FR_CT_PSA)

		boolean isNewProduct = ProductItemEvent.CREATED.equals(anEvent.getEventType());
true
		boolean shouldUpdate = isNewProduct || anEvent.getOldVO() == null;
true
		if (transactions == null) {
			transactions = stockTransactionDAO.getByProductItem(item);
[]
			productList = productService.getProductList(product, getTransactionQuantity(item), 1);
/s
StockTransactionServiceImpl.getTransactionQuantity(ProductItemVO) line: 327	
		} else {
			return itemVO.getQuantity();
0
/t
			productList = productService.getProductList(product, getTransactionQuantity(item), 1);
{MPO_Prod1 (27044086)=0.00}

		// Process existing transactions
		for (StockTransaction tx : transactions) {
/ GEEN	,

		// There was no data, create new
		StockTXData outData = createStockTXData(item.getShipmentOrder(), false);
/s
StockTransactionServiceImpl.createStockTXData(ShipmentOrderVO, boolean) line: 660	
/=
	private StockTXData createStockTXData(ShipmentOrderVO aShipmentOrder, boolean aInData) {
aShipmentOrder=
ShipmentOrder: SH000001422-20160518-125954(SystemId:26879787; Org:LOG_EMEA_FR_CT_PSA)
aInData=false
/ dus OUT	,
		StockTXData data = new StockTXData(aInData ? StockTransactionType.ORDER_IN : StockTransactionType.ORDER_OUT);
		if (aInData) {
		} else {
			data.party = aShipmentOrder.getFromPartyVO();
PARTY id:MPO_Vend1(systemId:0)

		if (shouldUseShipmentOrderDate(aShipmentOrder, !aInData)) {
/s
StockTransactionServiceImpl.shouldUseShipmentOrderDate(ShipmentOrderVO, boolean) line: 1127	
		return getServiceActionTypeForTxDate(aShipmentOrder, aStartDate).isEmpty();
true
/ want	,
/s
StockTransactionServiceImpl.getServiceActionTypeForTxDate(ShipmentOrderVO, boolean) line: 529	
		if (aShipmentOrder.getShipmentType() != null) {
			shoType = aShipmentOrder.getShipmentType().getCode();
PARTS_PACKAGES
		if (aStartDate) {
true
			propName = "stocktransaction.startdate.from.serviceaction";

		ApplicationPropertyManager props = ApplicationPropertyManager.getInstance();
		String propVal = props.getModuleOrganizationProperty(aShipmentOrder.getOrganization(), "inventory", propName + "." + shoType, null);
		if (propVal == null) {
			propVal = props.getModuleOrganizationProperty(aShipmentOrder.getOrganization(), "inventory", propName, "");
""
		return StringUtils.split(propVal);
/t
StockTransactionServiceImpl.createStockTXData(ShipmentOrderVO, boolean) line: 670	
		if (shouldUseShipmentOrderDate(aShipmentOrder, !aInData)) {
			if (aInData) {
/ NEE
			} else {
				data.date = aShipmentOrder.getDateSetVO().getStartDate();
2016-05-11 23:59:00.0
		return data;
/t
StockTransactionServiceImpl.handleProductItemUpdated(ProductItemEvent) line: 313	
		// There was no data, create new
		StockTXData outData = createStockTXData(item.getShipmentOrder(), false);
/d
date	Timestamp  (id=24148)	
dateChanged	true	
party	VirtualParty  (id=24055)	
partyChanged	true	
type	StockTransactionType  (id=24041)	ORDER_OUT

		outData.dateChanged = true;
		outData.partyChanged = true;
		createTransaction(item, outData);
/s
StockTransactionServiceImpl.createTransaction(ProductItemVO, StockTransactionServiceImpl$StockTXData) line: 726	

		Map<StockKeepingUnit, BigDecimal> mySkuList = getStockKeepingUnit(aData.party, getProduct(aProductItem), aProductItem.getGoodsStatus(), aProductItem.getShipmentOrder());
/ MPO_Vend1
{com.mpobjects.inventory.model.entity.stockkeepingunit.StockKeepingUnit/id:27044222=1}
/ TODO

		for (Entry<StockKeepingUnit, BigDecimal> myEntry : mySkuList.entrySet()) {
			createTransaction(aProductItem, myEntry.getKey(), aData.type, aData.date, myEntry.getValue());
/s
StockTransactionServiceImpl.createTransaction(ProductItemVO, StockKeepingUnit, StockTransactionType, Date, BigDecimal) line: 701	
/=
	private void createTransaction(ProductItemVO aItem, StockKeepingUnit aStockKeepingUnit, StockTransactionType aType, Date aTransactionDate, BigDecimal aBomQty) {

		StockTransaction myTransaction = new StockTransaction();
		myTransaction.setProductItem(aItem);
/ aItem's shipment order=
ShipmentOrder: SH000001422-20160518-125954(SystemId:26879787; Org:LOG_EMEA_FR_CT_PSA)

		myTransaction.setStockLocation(aStockKeepingUnit.getStockLocation());
MPO_Vend1
		myTransaction.setProduct(aStockKeepingUnit.getProduct());
MPO_Prod1 (27044086)

		myTransaction.setGoodsStatus(aStockKeepingUnit.getGoodsStatus());
		myTransaction.setTransactionDate(aTransactionDate);

		myTransaction.setTransactionType(aType);
		// The stock decreases at the ship-from location
		BigDecimal myProductItemQty = aType.equals(StockTransactionType.FORECAST_OUT) || aType.equals(StockTransactionType.ORDER_OUT) ? aItem.getQuantity() .negate() : aItem.getQuantity();
0
		myTransaction.setQuantity(myProductItemQty.multiply(aBomQty));
		myTransaction.setOrganization(aItem.getShipmentOrder().getOrganization());
		save(myTransaction);
/t
StockTransactionServiceImpl.handleProductItemUpdated(ProductItemEvent) line: 317	
		// There was no data, create new
		StockTXData outData = createStockTXData(item.getShipmentOrder(), false);
		outData.dateChanged = true;
		outData.partyChanged = true;
		createTransaction(item, outData);
/d
		StockTXData inData = createStockTXData(item.getShipmentOrder(), true);
/s
StockTransactionServiceImpl.createStockTXData(ShipmentOrderVO, boolean) line: 666	
		StockTXData data = new StockTXData(aInData ? StockTransactionType.ORDER_IN : StockTransactionType.ORDER_OUT);
ORDER_IN
		if (aInData) {
			data.party = aShipmentOrder.getToPartyVO();
PARTY id:093139861944500198(systemId:0)

		if (shouldUseShipmentOrderDate(aShipmentOrder, !aInData)) {
			if (aInData) {
				data.date = aShipmentOrder.getDateSetVO().getEndDate();
2016-05-20 23:59:00.0
		return data;
/t
StockTransactionServiceImpl.handleProductItemUpdated(ProductItemEvent) line: 318	
		StockTXData inData = createStockTXData(item.getShipmentOrder(), true);
/d
		inData.dateChanged = true;
		inData.partyChanged = true;
		createTransaction(item, inData);
/s
StockTransactionServiceImpl.createTransaction(ProductItemVO, StockTransactionServiceImpl$StockTXData) line: 726	

		Map<StockKeepingUnit, BigDecimal> mySkuList = getStockKeepingUnit(aData.party, getProduct(aProductItem), aProductItem.getGoodsStatus(), aProductItem.getShipmentOrder());
/ SOCHAUX	,
{com.mpobjects.inventory.model.entity.stockkeepingunit.StockKeepingUnit/id:27044089=1}
		for (Entry<StockKeepingUnit, BigDecimal> myEntry : mySkuList.entrySet()) {
			createTransaction(aProductItem, myEntry.getKey(), aData.type, aData.date, myEntry.getValue());
/s
StockTransactionServiceImpl.createTransaction(ProductItemVO, StockKeepingUnit, StockTransactionType, Date, BigDecimal) line: 701	

		StockTransaction myTransaction = new StockTransaction();
		myTransaction.setProductItem(aItem);

		myTransaction.setStockLocation(aStockKeepingUnit.getStockLocation());
GEODIS_WHS_FR_SOCHAUX
		myTransaction.setDirty(true);

		myTransaction.setProduct(aStockKeepingUnit.getProduct());
		myTransaction.setGoodsStatus(aStockKeepingUnit.getGoodsStatus());
		myTransaction.setTransactionDate(aTransactionDate);
		myTransaction.setTransactionType(aType);
		// The stock decreases at the ship-from location
		BigDecimal myProductItemQty = aType.equals(StockTransactionType.FORECAST_OUT) || aType.equals(StockTransactionType.ORDER_OUT) ? aItem.getQuantity() .negate() : aItem.getQuantity();
0
		myTransaction.setQuantity(myProductItemQty.multiply(aBomQty));
		myTransaction.setOrganization(aItem.getShipmentOrder().getOrganization());
		save(myTransaction);
...
/t
StockTransactionEventListener.handle(ProductItemEvent) line: 107	
		} else if (anEvent.getEventType().equals(ProductItemEvent.CREATED)) {
			stockTransactionService.handleProductItemCreated(anEvent);
/d
...
/t
ProductItemServiceImpl.save(ProductItemVO, boolean, boolean) line: 547	
			fireProductItemEvent(myEvent);
/d
		return aProductItemVO;
/ aProductItemVO's shipmentOrder=
ShipmentOrder: SH000001422-20160518-125954(SystemId:26879787; Org:LOG_EMEA_FR_CT_PSA)
...
/t
GeoScoServiceOrderProcessor.createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO>) line: 664	
		for (ProductItemVO myOriginalProductItem : myCopyList) {
			ProductItemVO myNewProductItem = myOriginalProductItem.copy();
			myNewProductItem.setShipmentOrder(myNewShipmentOrderVO);
			myNewProductItem.setQuantity(BigDecimal.ZERO);
			productItemService.save(myNewProductItem);
/d
			myProductItemMapping.put(myOriginalProductItem, myNewProductItem);

/ myProductItemMapping=
key=myOriginalProductItem	, theQuantity=20	, existing	,
value=myNewProductItem	, theQuantity=0			, existing	,

		for (ShipmentItemVO myOriginalShipmentItem : aExistingItems) {
			moveShipmentItem(myProductItemMapping, myOriginalShipmentItem, myNewShipmentOrderVO, null);
/s
GeoScoServiceOrderProcessor.moveShipmentItem(Map<ProductItemVO,ProductItemVO>,ShipmentItemVO, ShipmentOrderVO, ShipmentItemVO) line: 795
/=
	private ShipmentItemVO moveShipmentItem(Map<ProductItemVO, ProductItemVO> aProductItemMapping, ShipmentItemVO anOriginalShipmentItem,
			ShipmentOrderVO aNewShipmentOrderVO, ShipmentItemVO aNewParent) {

		ShipmentItemVO myNewShipmentItem = anOriginalShipmentItem.copy();
		aNewShipmentOrderVO.addShipmentItem(myNewShipmentItem);
		anOriginalShipmentItem.setLabelInfo(anOriginalShipmentItem.getLabelInfo() + "-D");
shipmentItem: 0010(systemId:26888534, labelInfo:NQXQSUUPX-D)

		// In this way, by appending 'R', you can only report on a box once
/ TODO
		myNewShipmentItem.setLabelInfo(myNewShipmentItem.getLabelInfo() + "-R");

/ anOriginalShipmentItem=
shipmentItem: 0010(systemId:26888534, labelInfo:NQXQSUUPX-D)
/ myNewShipmentItem= 
shipmentItem: 0010(systemId:0, labelInfo:NQXQSUUPX-R) 

		shipmentItemService.save(anOriginalShipmentItem);
/ shipmentitem.updated event, geen productitem.... -> niets met stock tx
/ Dus overslaan	,

		myNewShipmentItem = shipmentItemService.save(myNewShipmentItem);
/ shipmentitem.updated event, geen productitem.... -> niets met stock tx
/ Dus overslaan	,

/ myNewShipmentItem= 
shipmentItem: 0010(systemId:26888541, labelInfo:NQXQSUUPX-R)

		// copy packed items
		List<PackedItemVO> myOrigPackedItemList = anOriginalShipmentItem.getPackedItemList();
[com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:26888205]
		for (PackedItemVO myOrigPackedItemVO : myOrigPackedItemList) {
			PackedItemVO myNewPackedItem = new PackedItemVO();
			myNewPackedItem.setRequestedQuantity(myOrigPackedItemVO.getRequestedQuantity());
10
			myNewPackedItem.setQuantity(myOrigPackedItemVO.getQuantity());
7
/ Klopt	, de processed quantity on the packi was al set op de existing prodi	,

			myNewPackedItem.setActualQuantity(myOrigPackedItemVO.getActualQuantity());
null
			myNewPackedItem.setShipmentItemVO(myNewShipmentItem);

			// get product item by product mapping already made, and wire bidirectionally together
			ProductItemVO myNewProductItem = aProductItemMapping.get(myOrigPackedItemVO.getProductItemVO());
/ klopt	,
			myNewPackedItem.setProductItemVO(myNewProductItem);
			myNewShipmentItem.getPackedItemList().add(myNewPackedItem);
			myNewProductItem.getPackedItemList().add(myNewPackedItem);
/ M-N relation	,

			// Set qty based on the original qty
			myNewProductItem.setQuantity(myNewProductItem.getQuantity().add(myNewPackedItem.getRequestedQuantity()));
0+10
/ TODO (Waarom niet myNewPackedItem.getQuantity()	)
/ Peter

		// Move child items recursively
		List<ShipmentItemVO> myNestedItems = new ArrayList<ShipmentItemVO>(anOriginalShipmentItem.getShipmentItemList());
[]
/ PALLET

		myNewShipmentItem = shipmentItemService.save(myNewShipmentItem);
/ shipmentitem.updated event, geen productitem.... -> niets met stock tx
/ overslaan	,
		shipmentItemService.delete(anOriginalShipmentItem, false);
/ shipmentitem.pre-deleted event, geen productitem.... -> niets met stock tx
		return myNewShipmentItem;
/t
GeoScoServiceOrderProcessor.createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO>) line: 669	
		for (ShipmentItemVO myOriginalShipmentItem : aExistingItems) {
			moveShipmentItem(myProductItemMapping, myOriginalShipmentItem, myNewShipmentOrderVO, null);
/d
		myNewShipmentOrderVO = shipmentOrderService.updateShipmentOrder(myNewShipmentOrderVO, true);
ShipmentOrder: SH000001420-20160518-083336(SystemId:26879771; Org:LOG_EMEA_FR_CT_PSA)
/ Geen events	, 
/ TODO
		myExisting = shipmentOrderService.updateShipmentOrder(myExisting, false);
ShipmentOrder: SH000001420(SystemId:26879763; Org:LOG_EMEA_FR_CT_PSA)
/ Geen events	, 
/ TODO

		// Remove product items which do not have packed items
		Collection<ProductItemVO> myOrigProductItemList = myExisting.getProductItemList();
		Collection<ProductItemVO> myDeleteList = new ArrayList<ProductItemVO>();
		for (ProductItemVO myProductItemVO : myOrigProductItemList) {
			if (myProductItemVO.getPackedItemList().isEmpty()) {
/ NEE
/ Er is nog een shi met het product in deze sho	,
		productItemService.deleteAll(myDeleteList);
[]

		// Recalculate the new product item quantity based on the packed items
		// For the initial shipment order.
		productItemService.updateAndSavePlannedQuantities(myExisting);
/s
ProductItemServiceImpl.updateAndSavePlannedQuantities(ShipmentOrderVO) line: 698	
/=
	public List<ProductItemVO> updateAndSavePlannedQuantities(ShipmentOrderVO aShipmentOrderVO) {

aShipmentOrderVO=originele sho	,
ShipmentOrder: SH000001423(SystemId:26879791; Org:LOG_EMEA_FR_CT_PSA)

		for (ProductItemVO myProdItem : aShipmentOrderVO.getProductItemList()) {
PRODUCT_ITEM id:null(systemId:26883463)

			ProductItemVO myUpdatedItem = updatePlannedQtyForProductItem(myProdItem);
/ we zijn op de originele sho	,
/ myProdItem.theQuantity=20	, 
/s
ProductItemServiceImpl.updatePlannedQtyForProductItem(ProductItemVO) line: 902	

		for (PackedItemVO myPacked : aProdItem.getPackedItemList()) {
com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:26888233

			if (NumberUtils.isNullOrZero(myPacked.getQuantity())) {
/ NEE
			} else {
				myActual = myActual.add(myPacked.getQuantity());
10
/ Klopt	, we zijn op de originele sho	,
		BigDecimal myQty = aProdItem.getQuantity();
20
		if (ObjectUtils.compare(myActual, myQty) != 0) {
			aProdItem.setQuantity(myActual);
10
			return aProdItem;
/t
ProductItemServiceImpl.updateAndSavePlannedQuantities(ShipmentOrderVO) line: 701	
		for (ProductItemVO myProdItem : aShipmentOrderVO.getProductItemList()) {
			ProductItemVO myUpdatedItem = updatePlannedQtyForProductItem(myProdItem);
/d
myUpdatedItem's theQuantity=10	, is som van de quantities op de packed items	,

			if (myUpdatedItem != null) {
				myList.add(myUpdatedItem);

		} else {
			LOG.info("Updating the following product items: " + myList);
			for (ProductItemVO myProdItem : myList) {
				this.save(myProdItem); / WAS: getDAO().save(myProdItem);
/ FIX PSA-515

		return myList;
/t
GeoScoServiceOrderProcessor.createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO>) line: 692	
		productItemService.updateAndSavePlannedQuantities(myExisting);
/d

		myExisting = shipmentOrderService.updateShipmentOrder(myExisting, true);
/ event serviceaction.updated -> niet in stock tx event handler	,
		myNewShipmentOrderVO = shipmentOrderService.updateShipmentOrder(myNewShipmentOrderVO, true);
/ event serviceaction.updated -> niet in stock tx event handler	,

		PathAssignmentService myPathAssignmentService = MpoBeanFactory.getBean(PathAssignmentService.class);
		myPathAssignmentService.assignPath(myNewShipmentOrderVO);
/ TODO


...
		//Updating the product items,this ensures updating quantity on product items.
		updateProductItemsForDesadv(myNewShipmentOrderVO.getShipmentItemList());
/s
GeoScoServiceOrderProcessor.updateProductItemsForDesadv(Collection<ShipmentItemVO>) line: 1272	
/=
	private void updateProductItemsForDesadv(Collection<ShipmentItemVO> aResult) {
		for (ShipmentItemVO myItem : aResult) {
shipmentItem: 0010(systemId:26888541, labelInfo:NQXQSUUPX-R)

			if (!myItem.getPackedItemList().isEmpty()) {
[com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:26888212]

				ProductItemVO myProductItem = myItem.getPackedItemList().get(0).getProductItemVO();

				myProductItem = productItemDAO.getBySystemId(myProductItem.getSystemId());

				BigDecimal myQty = BigDecimal.ZERO;
				for (PackedItemVO myPacked : myProductItem.getPackedItemList()) {
					ShipmentItemVO myPackedInShipmentItem = myPacked.getShipmentItemVO();
					if (StringUtils.isNotEmpty(myPackedInShipmentItem.getCaseNumber())) {
						myQty = myQty.add(myPacked.getQuantity());
					}
				}
				if (myProductItem.getQuantity().compareTo(myQty) != 0) {
					myProductItem.setQuantity(myQty);
					productItemService.save(myProductItem);

/t
GeoScoServiceOrderProcessor.createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO>) line: 702	
		//Updating the product items,this ensures updating quantity on product items.
		updateProductItemsForDesadv(myNewShipmentOrderVO.getShipmentItemList());
/d
		return myNewShipmentOrderVO.getShipmentItemList();
/t
GeoScoServiceOrderProcessor.processDesadvServiceOrder(ServiceOrderVO) line: 914	
				for (Collection<ShipmentItemVO> myItemsByOrder : myShipmentOrderMap.values()) {
					Collection<ShipmentItemVO> myProcessedItems = createNewShipmentOrderForProcessedItems(myItemsByOrder);
/d
					shipmentItems.addAll(myProcessedItems);
		return shipmentItems;
/=
shipmentItems	ArrayList  (id=19053)	
	elementData	Object[10]  (id=22294)	
		[0]	ShipmentItemVO  (id=19631)	
			shipmentOrder	ShipmentOrderVO  (id=19104)	
ShipmentOrder: SH000001420-20160518-083336(SystemId:26879771; Org:LOG_EMEA_FR_CT_PSA)
/t
GeoScoServiceOrderProcessor.processDespatchAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 407	

		List<ShipmentItemVO> existingShipmentItems = processDesadvServiceOrder(updateServiceOrderVO);
/d
		// processAndHandleLogisticsOrderEvents(aNode, updateServiceOrderVO, DESPATCH_ADVICE_SHIPMENT);
		processPurchaseServiceOrdersForShipmentItems(existingShipmentItems);
/ NIETS
/t
GeoScoServiceOrderProcessor.process(Node) line: 248	
			} else if (DESPATCH_ADVICE_SHIPMENT.equals(purposeCode)) {
				processDespatchAdviceShipment(aNode, myProcessor, documentId);
/d


/ FIX PSA-515

$ vi ProductItemServiceImpl.java

	@Override
	public List<ProductItemVO> updateAndSavePlannedQuantities(ShipmentOrderVO aShipmentOrderVO) {
		List<ProductItemVO> myList = new ArrayList<ProductItemVO>();
		for (ProductItemVO myProdItem : aShipmentOrderVO.getProductItemList()) {
			ProductItemVO myUpdatedItem = updatePlannedQtyForProductItem(myProdItem);
			if (myUpdatedItem != null) {
				myList.add(myUpdatedItem);
			}
		}

		if (myList.isEmpty()) {
			LOG.info("Nothing to update for actual qty");
		} else {
			LOG.info("Updating the following product items: " + myList);
			for (ProductItemVO myProdItem : myList) {
				this.save(myProdItem);										/ WAS getDAO().save(myProdItem);
			}
		}

		return myList;

	}

Changed a dao call to a service call, so there is created a productitem.updated event and the stock tx is updated.

/ Paul heeft ingechedked	,
geosco.properties
InvoiceHeaderKey.java
ForecastSplitServiceImpl.java
ForecastSplitServiceImplTest.java



/ Einde FIX PSA-515



/ Einde DEBUG PSA-515

/ PSA-SPLIT

/ we maken via forecast scherm een bestelling van 20 mpo_prod1: 2 boxen, ieder 10 products,	 
/ als we een 04-DESADV hebben	, met 1 box 	, met 7 items	, 
/ dan wordt er een nieuwe sho create	,   daar verschijnt deze box als shi	, en de quantity wordt 7 set	, OK	,
/ de shi verdwijnt van de oorspronkelijke sho	, OK	, en die blijft heeft nog quantity 10	, OK	, 
/ Maar de quantity op het product item wordt niet update		,


/ Einde PSA-SPLIT

/ PSA-540

/ 7	. 

/ Jan had 04-desadv create voor PSA-540	, met 3 shi's	, label info XXQKP1I96	, 
/ we kunnen de sho vinden, door in menu	, 
planning, shipment order, search by item
XXQKP1I96
/ we komen op 	,
SH000001571

/ we zien 2 pallets in deze sho	,
XXQKP1I96
97YUV8U9G
/ In het bericht staan 3 dozen op XXQKP1I96	, 
/ we krijgen het ERR bericht	,

/ 7	. 

/ Jan vertelde me dat het eenvoudiger is om een MPO_Prod1 order te maken met 4 boxes	, en dan 2 boxes in de desadv bericht	 	, 

/ 25-05 Wed, 40	, -> SH000001425
/ we zien 4 boxes	,
/ we passen onze 04-desadv aan , met 2 van de 4 boxes er in	, 
/ We plaatsten de 04-desadv op MPOBJECTS TO GEOSCO	, 
/ op MPOBJECTS FROM GEOSCO verschijnt de application-response	, 
/ Ga naar	,
http://localhost:8161/admin/message.jsp?id=ID%3alocalhost.localdomain-55730-1463634929117-6%3a5557%3a1%3a1%3a3&JMSDestination=MPOBJECTS.FROM.GEOSCO
/ Kies de queue	, en sort op Timestamp	, 
/ we zien de msg van 2016-05-19	, 
/ we pakken de 1ste	, en we zien precies het 04-desadv 	, en de reden van de ERR	, 

<application_response><mid>ID:localhost.localdomain-55730-1463634929117-10:1:1:1:1</mid><code>ERROR</code><message>Consumer could not handle message [ID:localhost.localdomain-55730-1463634929117-10:1:1:1:1]: Could not process message: com.mpobjects.oms.model.serviceorder.ServiceOrderException: [In process([ProcessingContext: SERVICE_ORDER_ID[]][Node: [so:SERVICE_ORDER: null]][Reason: null][XmlMessage: &lt;?xml version="1.0" encoding="utf-8"?&gt;

$ vi 04-DESADV-ID-SH-1248.xml
               	<mtccore:SHIPMENT_ITEM>
                     <mtccore:LABEL_NUMBER>KLG4RQ6J3</mtccore:LABEL_NUMBER>
		  		<mtccore:SHIPMENT_ITEM>
                     <mtccore:LABEL_NUMBER>I7OUYPFO0</mtccore:LABEL_NUMBER>

/ 7	. 	

/ In GeoScoServiceOrderProcessor.java

	private void updateProductItemsForDesadv(Collection<ShipmentItemVO> aResult) {	 / *
		for (ShipmentItemVO myItem : aResult){ 
...
			updateProductItemsForDesadv(myItem.getChildren());
		}

/ wat is aResult en myItem.getChildren()	?

/ In onze call	,
/ aResult is een PersistedSortedSet	,	want is in de caller shipmentOrderVO.getShipmentItems()
/ myItem.getChildren() is een PersistentBag	,

/ 13	. 

$ vi ShipmentOrderVO.java

	protected SortedSet<ShipmentItemVO> theShipmentItemList = new TreeSet<ShipmentItemVO>();
	public SortedSet<ShipmentItemVO> getShipmentItemList() {
		return theShipmentItemList;
	}

$ vi ShimentOrder.standard.hbm.xml

		<set name="shipmentItemList" cascade="delete" sort="com.mpobjects.util.dao.StringSequencedEntityComparator" where="PARENT_SYSTEMID is null">
			<cache usage="read-write" />
			<key column="SHIPMENT_ORDER_SYSTEMID" update="false"/>
			<one-to-many class="com.mpobjects.oms.model.shipmentorder.vo.ShipmentItemVO" />
		</set>

/ In onzze call (*) zien we een PersistentSortedSet	,
/  persistent wrapper for a java.util.SortedSet. Underlying collection is a TreeSet.

/ Intermezzo 

/ In H. source	,

[eric@localhost hibernate-core-4.3.5.Final-sources]$ less ./org/hibernate/type/SortedSetType.java
        @SuppressWarnings( {"unchecked"})
        public Object instantiate(int anticipatedSize) {
                return new TreeSet(comparator);
        }
/ TODO

/ Einde Intermezzo 



/ 13	. 

$ vi ShipmentItemVO.java

	private List<PackedItemVO> thePackedItemList = new ArrayList<PackedItemVO>();
	public List<PackedItemVO> getPackedItemList() {
		return thePackedItemList;
	}

$ vi ShipmentItem.standard.hbm.xml

        <bag name="packedItemList" inverse="true" cascade="all" >
        	<cache usage="read-write"/>
			<key column="SHIPMENT_ITEM_SYSTEMID" />
			<one-to-many class="com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO" />
		</bag>

/ Bij (*) zien we PersistentBag	,
An unordered, unkeyed collection that can contain the same element multiple times. The Java collections API, curiously, has no Bag. Most developers seem to use Lists to represent bag semantics, so Hibernate follows this practice.

/ we doen in Display	, 
myProductItem.getPackedItemList() instanceof List
true
myProductItem.getPackedItemList() instanceof ArrayList
false

/ Einde Intermezzo


/s
GeoScoServiceOrderProcessor.createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO>) line: 701	
		updateProductItemsForDesadv(myNewShipmentOrderVO.getShipmentItemList());
/s
GeoScoServiceOrderProcessor.updateProductItemsForDesadv(Collection<ShipmentItemVO>) line: 1261	
/=
	private void updateProductItemsForDesadv(Collection<ShipmentItemVO> aResult) {
aResult	PersistentSortedSet  (id=22709)	


		for (ShipmentItemVO myItem : aResult) {
			if (!myItem.getPackedItemList().isEmpty()) {
				ProductItemVO myProductItem = myItem.getPackedItemList().get(0).getProductItemVO();

myItem.getPackedItemList()=PersistentBag
[com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:26888324]

/ 7	. 

/ we moeten niet voorbij de leap time een bestelling doen, want dan geen sho	,

/ Op 20-05 is de purchage seo, van de sho 1422,  op 8000	, de Actual Start Date is ingevuld	, dus kunnen we op 20-5 een nieuwe bestelling plaatsen	, deze gaat naast de 1ste	,  we order 40 MPO_Prod1	, dus zien we sho 1430 erbij	, 

/ Hoe sho, of seo's van 1450 -> 8000	, door 04-desadv en 13-recadv	?
/ TODO

/ Na een 04-desadv zien we dat de afgesplitste sho op 9000	,  de purchase seo op 9000	, de  delivery en receipt seo op 1450	,

/ maar de oorspronkelijke sho , deze staat nog op 1450	, dat klopt ook wel, want daarvan zijn de items nog niet binnengekomen	,  alle seo's staan op 1450	,
/ we kunnen een nieuwe 04-desadv maken , met de 2 shi's op de originele sho	, maar we kunnen ook naar de originele sho gaan, dan naar de purchase seo	, en daar de Actual Start Date invullen	, Save	, dan wordt de status van deze 8000	, en dan van de originele sho ook 8000	, 
/ nu kunnen we weer een nieuwe bestelling doen op het foreast scherm	,

/ FIX PSA-540

/ fixes ConcurrentModificationException	,

public class GeoScoServiceOrderProcessor extends ServiceOrderProcessorImpl {

	private void updateProductItemsForDesadv(Collection<ShipmentItemVO> aResult) {
->		Collection<ShipmentItemVO> myList = new ArrayList<ShipmentItemVO>(aResult);
		for (ShipmentItemVO myItem : myList) {

				if (myProductItem.getQuantity().compareTo(myQty) != 0) {
					myProductItem.setQuantity(myQty);
*					productItemService.save(myProductItem);


/ de Set aResult verandert	, het is een PersistedSortedSet	, de items blijven onveranderd	, 
/ WH doet H. dat	, die wordt called door *	, 
 
/ Lees	, 
https://docs.oracle.com/javase/7/docs/api/
/ MAANDAGOCHTEND 

/ Einde FIX PSA-540
 



/ Einde PSA-540

/ DEBUG PSA-540

aResult	PersistentSortedSet  (id=28804)	
	cachedSize	-1	
	comparator	StringSequencedEntityComparator  (id=28806)	
	directlyAccessible	true	
	dirty	false	
	initialized	true	
	initializing	false	
	key	Integer  (id=28807)	
	operationQueue	null	
	owner	ShipmentOrderVO  (id=28776)	
	role	"com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO.shipmentItemList" (id=22713)	
	session	SessionImpl  (id=28808)	
	set	TreeSet  (id=28809)	
		m	TreeMap  (id=28819)	
			comparator	StringSequencedEntityComparator  (id=28806)	
			descendingMap	null	
			entrySet	TreeMap$EntrySet  (id=28846)	
			keySet	null	
			modCount	43									/ na * is 46	,	
			navigableKeySet	TreeMap$KeySet  (id=28823)	
			root	TreeMap$Entry  (id=28825)				/ na * is veranderd: id=28888	
				color	true	
				key	ShipmentItemVO  (id=28829)	
				left	null	
				parent	null	
				right	TreeMap$Entry  (id=28831)		/ na * is veranderd: id=28889	
					color	false	
					key	ShipmentItemVO  (id=28834)	
					left	null	
					parent	TreeMap$Entry  (id=28825)		/ na * is veranderd: id=28888	
					right	null	
					value	Object  (id=25257)	
				value	Object  (id=25257)	
			size	2	
			values	null	
	storedSnapshot	HashMap  (id=28810)	
	tempList	null	

	private void updateProductItemsForDesadv(Collection<ShipmentItemVO> aResult) {
		Collection<ShipmentItemVO> myList = new ArrayList<ShipmentItemVO>(aResult);
		for (ShipmentItemVO myItem : myList) {
			if (!myItem.getPackedItemList().isEmpty()) {
				ProductItemVO myProductItem = myItem.getPackedItemList().get(0).getProductItemVO();

				myProductItem = productItemDAO.getBySystemId(myProductItem.getSystemId());

				BigDecimal myQty = BigDecimal.ZERO;
				for (PackedItemVO myPacked : myProductItem.getPackedItemList()) {
					ShipmentItemVO myPackedInShipmentItem = myPacked.getShipmentItemVO();
					if (StringUtils.isNotEmpty(myPackedInShipmentItem.getCaseNumber())) {
						myQty = myQty.add(myPacked.getQuantity());
					}
				}
				if (myProductItem.getQuantity().compareTo(myQty) != 0) {
					myProductItem.setQuantity(myQty);
*					productItemService.save(myProductItem);

				}
			}

/ Na *	, 



/ Einde DEBUG PSA-540

/ DEBUG PSA-540

/s
GeoScoServiceOrderProcessor.processDespatchAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 404	
		ServiceOrderVO updateServiceOrderVO = aProcessor.process(selectSingleNode(aNode, SERVICE_ORDER_BODY_TAG));
		processConsignments(aNode, updateServiceOrderVO);
		List<ShipmentItemVO> existingShipmentItems = processDesadvServiceOrder(updateServiceOrderVO);
/s
GeoScoServiceOrderProcessor.processDespatchAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 404	
		for (ConsignmentVO myConsignmentVO : aUpdateServiceOrderVO.getConsignmentList()) {
/ 1
			for (ServiceActionVO myServiceActionVO : myConsignmentVO.getServiceActionList()) {
/ 1
				ShipmentOrderVO myShipmentOrderVO = myServiceActionVO.getShipmentOrderVO();
				Collection<ShipmentItemVO> myExistingItems = processDesAdvShipmentOrder(myShipmentOrderVO);
/s
GeoScoServiceOrderProcessor.processDesAdvShipmentOrder(ShipmentOrderVO) line: 963	

			for (ShipmentItemVO myItem : myShipmentOrderVO.getShipmentItemList()) {
[shipmentItem: Box1(systemId:0, labelInfo:KLG4RQ6J3), 
shipmentItem: Box2(systemId:0, labelInfo:I7OUYPFO0)]
				myResult.addAll(processDesadvShipmentItem(myItem));
/s
GeoScoServiceOrderProcessor.processDesadvShipmentItem(ShipmentItemVO) line: 943	

		String myLabelInfo = aItem.getLabelInfo();
KLG4RQ6J3
		ShipmentItemVO myExistingItem = shipmentItemDAO.getShipmentItem(myLabelInfo);
shipmentItem: 0010(systemId:26888581, labelInfo:KLG4RQ6J3)
		if (myExistingItem.getShipmentItemList().isEmpty()) {
			return processDesadvSingleShipmentItem(myExistingItem, aItem);
/s
GeoScoServiceOrderProcessor.processDesadvSingleShipmentItem(ShipmentItemVO, ShipmentItemVO) line: 978	

		aExistingItem.setCaseNumber(aProcessedItem.getCaseNumber());
		aExistingItem.setContainerNumber(aProcessedItem.getContainerNumber());
		} else {

			PackedItemVO myProcessedPackedItemVO = aProcessedItem.getPackedItemList().iterator().next();
myProcessedPackedItemVO	PackedItemVO  (id=29804)	
	requestedQuantity	BigDecimal  (id=29324)	 	0	/ not used WH	,
	systemId										0
	theQuantity	BigDecimal  (id=29808)				13

			PackedItemVO myExistingPackedItemVO = aExistingItem.getPackedItemList().iterator().next();
			myExistingPackedItemVO.setRequestedQuantity(myExistingPackedItemVO.getQuantity());
			myExistingPackedItemVO.setQuantity(myProcessedPackedItemVO.getQuantity());
myExistingPackedItemVO	PackedItemVO  (id=29805)	
	requestedQuantity	BigDecimal  (id=29808)		13	/ WAS 10	,
	systemId	26888252			
	theQuantity	BigDecimal  (id=29808)				13	/ WAS TODO	
/ Klopt	,

		List<ShipmentItemVO> myResult = new ArrayList<ShipmentItemVO>();
		myResult.add(aExistingItem);
		return myResult;
/t
GeoScoServiceOrderProcessor.processDesAdvShipmentOrder(ShipmentOrderVO) line: 964	
			for (ShipmentItemVO myItem : myShipmentOrderVO.getShipmentItemList()) {
				myResult.addAll(processDesadvShipmentItem(myItem));
/d
/ volgende	,
			for (ShipmentItemVO myItem : myShipmentOrderVO.getShipmentItemList()) {
				myResult.addAll(processDesadvShipmentItem(myItem));
/s
GeoScoServiceOrderProcessor.processDesadvShipmentItem(ShipmentItemVO) line: 938	
		String myLabelInfo = aItem.getLabelInfo();
I7OUYPFO0
		ShipmentItemVO myExistingItem = shipmentItemDAO.getShipmentItem(myLabelInfo);
shipmentItem: 0020(systemId:26888582, labelInfo:I7OUYPFO0)
		if (myExistingItem.getShipmentItemList().isEmpty()) {
			return processDesadvSingleShipmentItem(myExistingItem, aItem);
/s
GeoScoServiceOrderProcessor.processDesadvSingleShipmentItem(ShipmentItemVO, ShipmentItemVO) line: 981	
		aExistingItem.setCaseNumber(aProcessedItem.getCaseNumber());
		aExistingItem.setContainerNumber(aProcessedItem.getContainerNumber());
		} else {
			PackedItemVO myProcessedPackedItemVO = aProcessedItem.getPackedItemList().iterator().next();
myProcessedPackedItemVO	PackedItemVO  (id=29836)	
	requestedQuantity	BigDecimal  (id=29324)		0	/ not used	,
	systemId	0	
	theQuantity	BigDecimal  (id=29878)	 			11

			PackedItemVO myExistingPackedItemVO = aExistingItem.getPackedItemList().iterator().next();
			myExistingPackedItemVO.setRequestedQuantity(myExistingPackedItemVO.getQuantity());
			myExistingPackedItemVO.setQuantity(myProcessedPackedItemVO.getQuantity());
myExistingPackedItemVO	PackedItemVO  (id=29837)	
	requestedQuantity	BigDecimal  (id=29878)		/ 11
	systemId	26888253	
	theQuantity	BigDecimal  (id=29878)				/ 11	

		List<ShipmentItemVO> myResult = new ArrayList<ShipmentItemVO>();
		myResult.add(aExistingItem);
		return myResult;
/t
GeoScoServiceOrderProcessor.processDesAdvShipmentOrder(ShipmentOrderVO) line: 966	
			for (ShipmentItemVO myItem : myShipmentOrderVO.getShipmentItemList()) {
				checkItem(myItem);
				myResult.addAll(processDesadvShipmentItem(myItem));
			}
		}
		return myResult;
/t
GeoScoServiceOrderProcessor.processDesadvServiceOrder(ServiceOrderVO) line: 910	
		for (ConsignmentVO myConsignmentVO : aUpdateServiceOrderVO.getConsignmentList()) {
			for (ServiceActionVO myServiceActionVO : myConsignmentVO.getServiceActionList()) {
				ShipmentOrderVO myShipmentOrderVO = myServiceActionVO.getShipmentOrderVO();
				Collection<ShipmentItemVO> myExistingItems = processDesAdvShipmentOrder(myShipmentOrderVO);
/d
				Map<ShipmentOrderVO, Collection<ShipmentItemVO>> myShipmentOrderMap = createShipmentOrderMap(myExistingItems);
{ShipmentOrder: SH000001425(SystemId:26879811; Org:LOG_EMEA_FR_CT_PSA)=[
	shipmentItem: 0020(systemId:26888582, labelInfo:I7OUYPFO0), 
	shipmentItem: 0010(systemId:26888581, labelInfo:KLG4RQ6J3)
]}
				for (Collection<ShipmentItemVO> myItemsByOrder : myShipmentOrderMap.values()) {
					Collection<ShipmentItemVO> myProcessedItems = createNewShipmentOrderForProcessedItems(myItemsByOrder);
/s
GeoScoServiceOrderProcessor.createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO>) line: 624	
/=
	private Collection<ShipmentItemVO> createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO> aExistingItems) {
aExistingItems=
[shipmentItem: 0020(systemId:26888582, labelInfo:I7OUYPFO0), 
shipmentItem: 0010(systemId:26888581, labelInfo:KLG4RQ6J3)
]
		// Get the existing shipment order
		ShipmentOrderVO myExisting = aExistingItems.iterator().next().getShipmentOrder();
ShipmentOrder: SH000001425(SystemId:26879811; Org:LOG_EMEA_FR_CT_PSA)

		// Get the top level items
		Collection<ShipmentItemVO> myAll = new ArrayList<ShipmentItemVO>(myExisting.getShipmentItemList());
/ 4
		myAll.removeAll(aExistingItems);
[shipmentItem: 0030(systemId:26888583, labelInfo:XVPJSMLQP), 
shipmentItem: 0040(systemId:26888584, labelInfo:55UFGW2HE)]

		if (myAll.isEmpty()) {
/ NEE
		// copy header
		ShipmentOrderVO myNewShipmentOrderVO = myExisting.copy();
		myNewShipmentOrderVO.setSystemId(ValueObject.VOLATILE_SYSTEM_ID);
		// id must be altered
		myNewShipmentOrderVO.setShipmentOrderId(myExisting.getShipmentOrderId().trim() + "-" + String.format("%1$tY%1$tm%1$td-%1$tH%1$tM%1$tS", new Date()));
		myNewShipmentOrderVO.setReasonCode(getPartialDeliveryReasonCode());
com.mpobjects.oms.model.entity.reasoncode.ReasonCode@77f1af79[PARTIAL_DELIVERY,Partial delivery, order split]
ShipmentOrder: SH000001425-20160519-104710(SystemId:0; Org:LOG_EMEA_FR_CT_PSA)
		myExisting.setReasonCode(getPartialDeliveryReasonCode());
ShipmentOrder: SH000001425(SystemId:26879811; Org:LOG_EMEA_FR_CT_PSA)

			myNewShipmentOrderVO = shipmentOrderService.createShipmentOrder(myNewShipmentOrderVO);
ShipmentOrder: SH000001425-20160519-104710(SystemId:26879819; Org:LOG_EMEA_FR_CT_PSA)

		Set<ProductItemVO> myCopyList = getProductItems(aExistingItems);
aExistingItems=
ShipmentOrder: SH000001425(SystemId:26879811; Org:LOG_EMEA_FR_CT_PSA)
myCopyList=
[PRODUCT_ITEM id:null(systemId:26883483)]			/= [ProductItemVO theProductItemId="010", theDescription="MPO_Prod1"]
/ Via de packed item in elk van de shi's	,

		Set<ProductItemVO> myCopyList = getProductItems(aExistingItems);
		Map<ProductItemVO, ProductItemVO> myProductItemMapping = new HashMap<ProductItemVO, ProductItemVO>();
		for (ProductItemVO myOriginalProductItem : myCopyList) {
			ProductItemVO myNewProductItem = myOriginalProductItem.copy();
			myNewProductItem.setShipmentOrder(myNewShipmentOrderVO);			/ !
			myNewProductItem.setQuantity(BigDecimal.ZERO);
			productItemService.save(myNewProductItem);
/ stock tx IN and OUT are created	, 	1 keer, want er is maar 1 product	, 
PRODUCT_ITEM id:null(systemId:26883491)
			myProductItemMapping.put(myOriginalProductItem, myNewProductItem);
/ Beide zijn existing prodi's	,  elk op een sho	, op de originele	, en op de nieuwe	, afgesplitste	,

myProductItemMapping	HashMap  (id=30535)	
	table	HashMap$Entry[16]  (id=30591)	
		[14]	HashMap$Entry  (id=30595)	
			key	ProductItemVO  (id=29807)	
PRODUCT_ITEM id:null(systemId:26883483)
			value	ProductItemVO  (id=30520)	
PRODUCT_ITEM id:null(systemId:26883491)

myCopyList's prodi 26883483's sho=myProductItemMapping's key's sho= ShipmentOrder: SH000001425(SystemId:26879811; Org:LOG_EMEA_FR_CT_PSA)
myNewProductItem 26883491's sho=myProductItemMapping's value's sho= ShipmentOrder: SH000001425-20160519-104710(SystemId:26879819; Org:LOG_EMEA_FR_CT_PSA)
////////////////////////////
/ Dus mapping van prodi in originele sho naar cpy van deze in de nieuwe sho	,

		for (ShipmentItemVO myOriginalShipmentItem : aExistingItems) {
/ existing 0020, 0010 	, corresponding with those in 04-desadv	,
			moveShipmentItem(myProductItemMapping, myOriginalShipmentItem, myNewShipmentOrderVO, null);

/  myOriginalShipmentItem's sho=SH000001425, 
/s
/ We moeten de product item myProductItemMapping.key 	, en de myOriginalShipmentItem op de myNewShipmentOrderVO set	, 
/ TODO
GeoScoServiceOrderProcessor.moveShipmentItem(Map<ProductItemVO,ProductItemVO>,ShipmentItemVO,ShipmentOrderVO, ShipmentItemVO) line: 795	
/=
	private ShipmentItemVO moveShipmentItem(Map<ProductItemVO, ProductItemVO> aProductItemMapping, ShipmentItemVO anOriginalShipmentItem, ShipmentOrderVO aNewShipmentOrderVO, ShipmentItemVO aNewParent) {


		ShipmentItemVO myNewShipmentItem = anOriginalShipmentItem.copy();
/ cpy de shi op de originele sho	,
		aNewShipmentOrderVO.addShipmentItem(myNewShipmentItem);
		anOriginalShipmentItem.setLabelInfo(anOriginalShipmentItem.getLabelInfo() + "-D");
		// In this way, by appending 'R', you can only report on a box once
		myNewShipmentItem.setLabelInfo(myNewShipmentItem.getLabelInfo() + "-R");

		shipmentItemService.save(anOriginalShipmentItem);
shipmentItem: 0020(systemId:26888582, labelInfo:I7OUYPFO0-D)
		myNewShipmentItem = shipmentItemService.save(myNewShipmentItem);
shipmentItem: 0020(systemId:26888599, labelInfo:I7OUYPFO0-R)

		List<PackedItemVO> myOrigPackedItemList = anOriginalShipmentItem.getPackedItemList();
		for (PackedItemVO myOrigPackedItemVO : myOrigPackedItemList) {
com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:26888253

		for (PackedItemVO myOrigPackedItemVO : myOrigPackedItemList) {
/ Er is 1 for loop	,
/ Kunnen er multiple packi's in een shi	?
/ TODO
			PackedItemVO myNewPackedItem = new PackedItemVO();
			myNewPackedItem.setRequestedQuantity(myOrigPackedItemVO.getRequestedQuantity());
11
			myNewPackedItem.setQuantity(myOrigPackedItemVO.getQuantity());
11
			myNewPackedItem.setActualQuantity(myOrigPackedItemVO.getActualQuantity());
			myNewPackedItem.setShipmentItemVO(myNewShipmentItem);
			// get product item by product mapping already made, and wire bidirectionally together
			ProductItemVO myNewProductItem = aProductItemMapping.get(myOrigPackedItemVO.getProductItemVO());
/ Klopt	, cpy in nieuwe sho van prodi in originele sho 
			myNewPackedItem.setProductItemVO(myNewProductItem);
			myNewShipmentItem.getPackedItemList().add(myNewPackedItem);
			myNewProductItem.getPackedItemList().add(myNewPackedItem);

			// Set qty based on the original qty
			myNewProductItem.setQuantity(myNewProductItem.getQuantity().add(myNewPackedItem.getRequestedQuantity()));
11

		myNewShipmentItem = shipmentItemService.save(myNewShipmentItem);
/ myNewShipmentItem had al een id (hierboven in deze method)	, maar nu krijgt de prodi in deze shi ook een id	,
myNewShipmentItem	ShipmentItemVO  (id=30835)	
	systemId	26888599	
	thePackedItemList	PersistentBag  (id=31018)	
[com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:26888270]

		shipmentItemService.delete(anOriginalShipmentItem, false);
shipmentItem: 0020(systemId:26888582, labelInfo:I7OUYPFO0-D)
		return myNewShipmentItem;
/t
GeoScoServiceOrderProcessor.createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO>) line: 669	
		for (ShipmentItemVO myOriginalShipmentItem : aExistingItems) {
			moveShipmentItem(myProductItemMapping, myOriginalShipmentItem, myNewShipmentOrderVO, null);
/d
/ volgende	,
		for (ShipmentItemVO myOriginalShipmentItem : aExistingItems) {
shipmentItem: 0010(systemId:26888581, labelInfo:KLG4RQ6J3)
			moveShipmentItem(myProductItemMapping, myOriginalShipmentItem, myNewShipmentOrderVO, null);
/s
GeoScoServiceOrderProcessor.moveShipmentItem(Map<ProductItemVO,ProductItemVO>,ShipmentItemVO,ShipmentOrderVO,ShipmentItemVO) line: 795	
/=
	private ShipmentItemVO moveShipmentItem(Map<ProductItemVO, ProductItemVO> aProductItemMapping, ShipmentItemVO anOriginalShipmentItem, ShipmentOrderVO aNewShipmentOrderVO, ShipmentItemVO aNewParent) {
//////////////////
/ ze sturen een map aProductItemMapping mee	, en niet de nieuwe prodi	, want er kunnen meerdere prodi's zijn op de shi	,

		ShipmentItemVO myNewShipmentItem = anOriginalShipmentItem.copy();
		aNewShipmentOrderVO.addShipmentItem(myNewShipmentItem);
/ sets ook deze shi's sho	,
		anOriginalShipmentItem.setLabelInfo(anOriginalShipmentItem.getLabelInfo() + "-D");
shipmentItem: 0010(systemId:26888581, labelInfo:KLG4RQ6J3-D)
		// In this way, by appending 'R', you can only report on a box once
		myNewShipmentItem.setLabelInfo(myNewShipmentItem.getLabelInfo() + "-R");
shipmentItem: 0010(systemId:0, labelInfo:KLG4RQ6J3-R)

		shipmentItemService.save(anOriginalShipmentItem);
		myNewShipmentItem = shipmentItemService.save(myNewShipmentItem);
shipmentItem: 0010(systemId:26888600, labelInfo:KLG4RQ6J3-R)

		// copy packed items
		List<PackedItemVO> myOrigPackedItemList = anOriginalShipmentItem.getPackedItemList();
/ originelen voor de mapping	, net als in wiskunde	,
		for (PackedItemVO myOrigPackedItemVO : myOrigPackedItemList) { / 	mapping	, fct	,
			PackedItemVO myNewPackedItem = new PackedItemVO();
			myNewPackedItem.setRequestedQuantity(myOrigPackedItemVO.getRequestedQuantity());
			myNewPackedItem.setQuantity(myOrigPackedItemVO.getQuantity());
			myNewPackedItem.setActualQuantity(myOrigPackedItemVO.getActualQuantity());
			myNewPackedItem.setShipmentItemVO(myNewShipmentItem);
			// get product item by product mapping already made, and wire bidirectionally together
			ProductItemVO myNewProductItem = aProductItemMapping.get(myOrigPackedItemVO.getProductItemVO()); / pas fct toe	,
			myNewPackedItem.setProductItemVO(myNewProductItem);
			myNewShipmentItem.getPackedItemList().add(myNewPackedItem);
			myNewProductItem.getPackedItemList().add(myNewPackedItem);

			// Set qty based on the original qty
			myNewProductItem.setQuantity(myNewProductItem.getQuantity().add(myNewPackedItem.getRequestedQuantity()));
		}

		myNewShipmentItem = shipmentItemService.save(myNewShipmentItem);
myNewShipmentItem	ShipmentItemVO  (id=31154)	
	systemId	26888600	
	thePackedItemList	PersistentBag  (id=31345)	
[com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:26888271]			/ heeft nu ook een systemId	,

		shipmentItemService.delete(anOriginalShipmentItem, false);
shipmentItem: 0010(systemId:26888581, labelInfo:KLG4RQ6J3-D)
		return myNewShipmentItem;
/t
GeoScoServiceOrderProcessor.createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO>) line: 672	

		for (ShipmentItemVO myOriginalShipmentItem : aExistingItems) {
			moveShipmentItem(myProductItemMapping, myOriginalShipmentItem, myNewShipmentOrderVO, null);
/d
		myNewShipmentOrderVO = shipmentOrderService.updateShipmentOrder(myNewShipmentOrderVO, true);
		myExisting = shipmentOrderService.updateShipmentOrder(myExisting, false);

		// Recalculate the new product item quantity based on the packed items
		// For the initial shipment order.
		productItemService.updateAndSavePlannedQuantities(myExisting);
/s
ProductItemServiceImpl.updateAndSavePlannedQuantities(ShipmentOrderVO) line: 698	
/=
	public List<ProductItemVO> updateAndSavePlannedQuantities(ShipmentOrderVO aShipmentOrderVO) {

ShipmentOrderVO= ShipmentOrder: SH000001425(SystemId:26879811; Org:LOG_EMEA_FR_CT_PSA)	/ de orig	,

/ Update de quantity on the prodi in de orig sho	, WAS 40	, moet 20 worden	, want er zijn 2 shi's af	,

		for (ProductItemVO myProdItem : aShipmentOrderVO.getProductItemList()) {
			ProductItemVO myUpdatedItem = updatePlannedQtyForProductItem(myProdItem);
/s
ProductItemServiceImpl.updatePlannedQtyForProductItem(ProductItemVO) line: 904	
/=
	private ProductItemVO updatePlannedQtyForProductItem(ProductItemVO aProdItem) {

/ aProdItem is op de orig sho	,

		for (PackedItemVO myPacked : aProdItem.getPackedItemList()) {
/ er zijn 2	shi over op de originele sho	, 2 packi's dus	, elk met quantity 10 
			} else {
				myActual = myActual.add(myPacked.getQuantity());
myActual=20

		BigDecimal myQty = aProdItem.getQuantity();
		if (ObjectUtils.compare(myActual, myQty) != 0) {
			aProdItem.setQuantity(myActual);
			return aProdItem;
/t
ProductItemServiceImpl.updateAndSavePlannedQuantities(ShipmentOrderVO) line: 702	
		for (ProductItemVO myProdItem : aShipmentOrderVO.getProductItemList()) {
/ 1 for loop	,
			ProductItemVO myUpdatedItem = updatePlannedQtyForProductItem(myProdItem);
/d
			if (myUpdatedItem != null) {
				myList.add(myUpdatedItem);
			for (ProductItemVO myProdItem : myList) {
				this.save(myProdItem);
/s
ProductItemServiceImpl.save(ProductItemVO, boolean, boolean) line: 514	
			myEvent = createProductItemEvent(aProductItemVO);
aProductItemVO
/s
ProductItemServiceImpl.createProductItemEvent(ProductItemVO) line: 179	
		if (aNewProductItem.isVolatile()) {
/ NEE
		} else {
			myEvent = new ProductItemEvent(null, aNewProductItem, ProductItemEvent.UPDATED, myEventContext);
productitem.updated, context [id/value: 391962364/63]]  old [null] new [PRODUCT_ITEM id:null(systemId:26883483)] 

/t
ProductItemServiceImpl.save(ProductItemVO, boolean, boolean) line: 531	
		aProductItemVO = super.save(aProductItemVO);
		if (recalculate) {
			ShipmentOrderVO sho = aProductItemVO.getShipmentOrder();
			recalculateShipmentOrder(sho);
/ Overslaan	,
		if (shouldFireEvent()) {
			fireProductItemEvent(myEvent);
/s
StockTransactionEventListener.handleEvent(Event<?>) line: 38	
			} else if (anEvent.getEventType().startsWith(ProductItemEvent.PREFIX)) {
				ProductItemEvent myEvent = (ProductItemEvent) anEvent;
				handle(myEvent);
/s
StockTransactionEventListener.handle(ProductItemEvent) line: 103	
		} else if (anEvent.getEventType().equals(ProductItemEvent.UPDATED)) {
			stockTransactionService.handleProductItemUpdated(anEvent);
/s
StockTransactionServiceImpl.handleProductItemUpdated(ProductItemEvent) line: 242	
		ProductItemVO item = anEvent.getNewVO();
/ item.getQuantity()=20
/ Klopt	,

		boolean isNewProduct = ProductItemEvent.CREATED.equals(anEvent.getEventType());
false
		boolean shouldUpdate = isNewProduct || anEvent.getOldVO() == null;
true
			transactions = stockTransactionDAO.getByProductItem(item);
[27215044/ORDER_IN/2016-05-25 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/20.00/8793.00000/true, 
27215043/ORDER_OUT/2016-05-16 10:30:00.0/MPO_Prod1 (27044086)/MPO_Vend1/-20.00/-16931.00000/true]

			productList = productService.getProductList(product, getTransactionQuantity(item), 1);
{MPO_Prod1 (27044086)=20.00}

		// Process existing transactions
		for (StockTransaction tx : transactions) {
			BigDecimal expectedQty = productList.get(tx.getProduct());
20
			if (NumberUtils.compareTo(expectedQty, tx.getQuantity()) != 0) {
/ NEE
/ Dus de stock tx is al OK	,
/ TODO (Ik dacht dat de stock tx's quantity 40 zou zijn)

/ volgende	, 
/ de OUT stock tx krijgt -20	, 

		if (!transactions.isEmpty()) {
			return;
...
/t
ProductItemServiceImpl.updateAndSavePlannedQuantities(ShipmentOrderVO) line: 711	
			for (ProductItemVO myProdItem : myList) {
/ 1 for loop	,
				this.save(myProdItem);
/d
		return myList;
[PRODUCT_ITEM id:null(systemId:26883483)]	, product item op de originele sho	,
ShipmentOrder: SH000001425(SystemId:26879811; Org:LOG_EMEA_FR_CT_PSA)

/t
GeoScoServiceOrderProcessor.createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO>) line: 692	
		myExisting = shipmentOrderService.updateShipmentOrder(myExisting, true);
/d
...
		updateProductItemsForDesadv(myNewShipmentOrderVO.getShipmentItemList());
/s
GeoScoServiceOrderProcessor.updateProductItemsForDesadv(Collection<ShipmentItemVO>) line: 1261	
/=
	private void updateProductItemsForDesadv(Collection<ShipmentItemVO> aResult) {
/ aResult = coll van 2 shi's	,
		for (ShipmentItemVO myItem : aResult) {
			if (!myItem.getPackedItemList().isEmpty()) {
				ProductItemVO myProductItem = myItem.getPackedItemList().get(0).getProductItemVO();
/ 010, theQuantity=20	, moet nog worden update	,
				for (PackedItemVO myPacked : myProductItem.getPackedItemList()) {
					ShipmentItemVO myPackedInShipmentItem = myPacked.getShipmentItemVO();
					if (StringUtils.isNotEmpty(myPackedInShipmentItem.getCaseNumber())) {
						myQty = myQty.add(myPacked.getQuantity());
13
/ volgende,	
+11=24
				if (myProductItem.getQuantity().compareTo(myQty) != 0) {
/ JA
					myProductItem.setQuantity(myQty);
20-> 24
					productItemService.save(myProductItem);
/s
ProductItemServiceImpl.save(ProductItemVO, boolean, boolean) line: 514	
...
			fireProductItemEvent(myEvent);
/s
StockTransactionEventListener.handleEvent(Event<?>) line: 38	
			} else if (anEvent.getEventType().startsWith(ProductItemEvent.PREFIX)) {
				ProductItemEvent myEvent = (ProductItemEvent) anEvent;
				handle(myEvent);
/s
StockTransactionEventListener.handle(ProductItemEvent) line: 109	
		} else if (anEvent.getEventType().equals(ProductItemEvent.UPDATED)) {
			stockTransactionService.handleProductItemUpdated(anEvent);
/s
StockTransactionServiceImpl.handleProductItemUpdated(ProductItemEvent) line: 242	
		ProductItemVO item = anEvent.getNewVO();
/ item's sho=ShipmentOrder: SH000001425-20160519-134845(SystemId:26879821; Org:LOG_EMEA_FR_CT_PSA)

		if (transactions == null) {
			transactions = stockTransactionDAO.getByProductItem(item);
[27215109/ORDER_IN/2016-05-25 23:59:00.0/MPO_Prod1 (27044086)/GEODIS_WHS_FR_SOCHAUX/0.00/null/true, 
27215108/ORDER_OUT/Thu May 19 14:58:23 CEST 2016/MPO_Prod1 (27044086)/MPO_Vend1/0.00/null/true]
			productList = productService.getProductList(product, getTransactionQuantity(item), 1);
{MPO_Prod1 (27044086)=24.00}

		// Process existing transactions
		for (StockTransaction tx : transactions) {
			BigDecimal expectedQty = productList.get(tx.getProduct());
24
			if (NumberUtils.compareTo(expectedQty, tx.getQuantity()) != 0) {
/ JA
tx's quantity=0
				markNextDirty(tx);
				tx.setQuantity(expectedQty);
				tx.setDirty(true);
				stockTransactionDAO.save(tx);
/ Ook de OUT -24	,
/t
GeoScoServiceOrderProcessor.updateProductItemsForDesadv(Collection<ShipmentItemVO>) line: 1279	
		for (ShipmentItemVO myItem : aResult) {
/ 2 for loops	, 0010 en 0020	,
					productItemService.save(myProductItem);
/d





/ Einde DEBUG PSA-540

/ DEBUG PSA-540

/ we maken 27-05 , 40, sho SH000001427
/ we passen aan 04-DESADV-ID-SH-1248.xml
/ Er zijn ook al 2 stock tx's  create	,  ORDER_IN en FORECAST_IN	, beide quantity=40	,

/ WH wordt er straks alleen nog voor de afgespliste sho een stock tx create	,
/s
GeoScoServiceOrderProcessor.createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO>) line: 664	
		for (ProductItemVO myOriginalProductItem : myCopyList) {
...
			productItemService.save(myNewProductItem);			/ 664	,
/ Hier wordt nieuwe stock tx create	,
...
/s
GeoScoServiceOrderProcessor.createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO>) line: 701	
		updateProductItemsForDesadv(myNewShipmentOrderVO.getShipmentItemList());
/s
GeoScoServiceOrderProcessor.updateProductItemsForDesadv(Collection<ShipmentItemVO>) line: 1261	
/=
	private void updateProductItemsForDesadv(Collection<ShipmentItemVO> aResult) {
aResult=PersistentSortedSet	,
[shipmentItem: 0010(systemId:26888625, labelInfo:MP4TGE6FP-R), 
shipmentItem: 0020(systemId:26888626, labelInfo:UCQE03UOM-R)]
		for (ShipmentItemVO myItem : aResult) {
				ProductItemVO myProductItem = myItem.getPackedItemList().get(0).getProductItemVO();
				for (PackedItemVO myPacked : myProductItem.getPackedItemList()) {
					ShipmentItemVO myPackedInShipmentItem = myPacked.getShipmentItemVO();
					if (StringUtils.isNotEmpty(myPackedInShipmentItem.getCaseNumber())) {
						myQty = myQty.add(myPacked.getQuantity());
23
			updateProductItemsForDesadv(myItem.getChildren());
myItem=
shipmentItem: 0010(systemId:26888625, labelInfo:MP4TGE6FP-R)
myItem.getChildren()=PersistentBag	, []

/ Einde DEBUG PSA-540


/ GSJ-76 INSTALL 

/ Install	,

/ Het VPN wachtwoord is	,
HA65Fs8LTTCK
/ Hierachter moeten de getallen 	,

[eric@localhost workspace]$ svn co https://system.mp-objects.com/svn/tms/branches/2016.03
 1002  cp geosco/.classpath 2016.03
 1003  cp geosco/.project 2016.03
 1008  cp geosco/application.properties  2016.03

$ cd 2016.03

$ vi .project
<projectDescription>
        <name>2016.03</name>

$ vi .classpath
...
        <classpathentry kind="con" path="org.dbpowder.plugins.LIB_CONTAINER/recurse~project/2016.03/base-framework/core/lib/jar"/>
        <classpathentry kind="con" path="org.dbpowder.plugins.LIB_CONTAINER/recurse~project/2016.03/base-framework/buildscripts/build-lib"/>
        <classpathentry kind="con" path="org.dbpowder.plugins.LIB_CONTAINER/recurse~project/2016.03/module/interfacing/lib"/>
</classpath>

$ vi application.properties
base.product=geosco

/ op geosco-app-t	, 
[jboss@geosco-app-t geosco]$ PGPASSWORD=de2d45045b493b021bbfa90e4f3848a9 psql -h localhost -U  geosco geosco
geosco=> \dg
 vanderveldene   | Password valid until infinity                  | {admin}

[eric@localhost bin]$ cat geosco-pg_dump-t.sh 
#!/usr/bin/bash
cd ~/DB_TAP/Postgres/Backup
PGPASSWORD=h^Zgcyr\&Q pg_dump -U vanderveldene -Fc -h  geosco-app-t.intermax.mp-objects.com geosco >"geosco-t-$(date +%F).dump" 

[eric@localhost bin]$ geosco-pg_dump-t.sh 

sco2a=# create database geosco3;
CREATE DATABASE
[eric@localhost bin]$ local-pg_restore.sh geosco3 geosco-t-2016-05-23.dump

/ We zagen de ERR	,
Missing source folder base-framework/build/generate/java
/ we deden met ant	,
clean-prepare-and-dev-deploy
/ We deden refresh	,
/ De ERR verdween	,

/ Nu zien we de ERR
com.mpobjects.systemlog.service cannot be resolved	,
/ we zien bijv	,

$ vi JmsSystemLog.java

import com.mpobjects.systemlog.service.MessageThreadLocal;	/ wordt niet gevonden	,
import com.mpobjects.systemlog.service.SystemLogContext;	/ wordt niet gevonden	,
public class JmsSystemLog {

/ Maar module/systemlog is er wel	, we moeten hem in het classpath set	, 
/ right click project 2016.03	, build path	, configure build path	, click add folder	,
module/systemlog/src/java	: check
/ hij staat erbij in de list onder tab Source	,
/ ook in .classpath file 	,
/ refresh project	,

/ we doen weer met ant	,
clean-prepare-and-dev-deploy

/ we zien in jboss 	, dat de geosco/ is update	,
[eric@localhost server]$ vi geosco/deploy/postgres-ds.xml
/ vervang op 2 plaatsen geosco2a -> geosco3
/ geosco2a is psa	,
/ geosco3 is gjc

/ Einde GSJ-76 INSTALL

/ GSJ-76

/ log in als eric	,
/ ga naar execution, event activity dashboard	,
/ click op filter button	, 
/ in het form geef	,
organization: geodis
Save as filter		/ onderaan	,
/ we zien dat het filter meteen active is	, omdat in de organization kolom alleen geodis voorkomt	,

/ we zien het filter verschijnen in de blauwe balk	, en rechts op de blauwe zien we button 'manage filters'	,
/ click daarop	, we zien het filter onder My Filters	,
/ edit de filter	, 
Share with : Rogier van Oostrom

/ log in als oostromr	,
/ ga naar execution, event activity dashboard	,
/ we zien dat het filter meteen active is	, omdat in de organization kolom alleen geodis voorkomt	,

/ oostromr click op 'Manage Filters', en ziet het filter ook onder My Filter	,
/ hij kan net als eric ook alles met het filter	, ook share met anderen bijv	,

 


/ Einde GSJ-76

/ GSJ-76 WICKET 

/ 7	. 

/ Als we het Wicket scherm Execution, Event activity dashboard	, open , dan ERR	,
/ See LOG_GSJ-76.txt

/ 7. 

/ Planning, Shipment order, Search	,
/=ShipmentOrderListPage

/ Kies het main_frame als je in console zoekt	, 
document.getElementById("simple-search")
<div class="simple-search">
/ right click op deze DOM elem in console	, we zien: Reveal in ELements Panel	, 
/ dan zien we hem in Elements	, wat we wilden	,

/ 7	. 

/ we zien  de blauwe bar	, 
<form ...>
	<div class="simple-search">...</div>
	<div class="advanced-search">...</div>
</form>
<div class="linkexcel">...</div>
<div class="link-excel">...</div>

/ .simple-search is de input, Search, clear, settings buttons	,
/ .advanced search is de drop down	, met fields	,

/ Dit is 
$ vi FilterBarPanel.html




 



/ Einde GSJ-76 WICKET

/ DEBUG GSJ-76

/ 7	. 

/s
Daemon Thread [http-0.0.0.0-8080-7] (Suspended (breakpoint at line 51 in FilterDAOImpl))	
	FilterDAOImpl.getFilters(String, Resource) line: 51	

	FilterServiceImpl.getDefaultFilter(String, Resource) line: 32	
		List<Filter> myFilters = filterDAO.getFilters(aSourceId, aResource);

	QueryViewPanel.initFilter() line: 898	
		Filter myDefault = filterService.getBean().getDefaultFilter(getQueryDefinition().getId(), AuthenticationUtils.getResource());

	QueryViewPanel.<init>(String, IModel<QueryDefinition>, List<RowAction>, List<GroupAction>, Set<Serializable>) line: 131	
		initFilter();

	QueryViewPanel.<init>(String, IModel<QueryDefinition>, List<RowAction>, List<GroupAction>) line: 123	
	ShipmentOrderListPage.createView() line: 311	
		add(new QueryViewPanel("query", Model.of(myQuery), myRowAction, myGroupAction));

	ShipmentOrderListPage.createPageComponents() line: 64	
		createView();

	ShipmentOrderListPage(AbstractPage).initializePage() line: 76						
		createPageComponents();

	ShipmentOrderListPage(AbstractMainPage).initializePage() line: 57		
		super.initializePage();

	ShipmentOrderListPage(AbstractPage).onInitialize() line: 91					/ hier en hierboven mpo pages	,	
		initializePage();

	ShipmentOrderListPage(Component).fireInitialize() line: 4105	
			onInitialize();

	ShipmentOrderListPage(MarkupContainer).initialize() line: 433	
	ShipmentOrderListPage(Page).prepareForRender(boolean) line: 1543	
			initialize();

	ShipmentOrderListPage(Component).prepareForRender() line: 2329	
	ShipmentOrderListPage(Page).renderPage() line: 912	
	MpoWebRequestCycle(WebRequestCycle).redirectTo(Page) line: 201	
	PageRequestTarget.respond(RequestCycle) line: 58	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/ Intermezzo

$ vi Filter.standard.hbm.xml
	<class name="com.mpobjects.oms.model.filter.Filter" table="OMS_FILTER"> 


/ Einde Intermezzo

/s
FilterDAOImpl.getFilters(String, Resource) line: 51	
/=
	public List<Filter> getFilters(String aSourceId, Resource aResource) {
aSourceId="shipment-order-list"
		Set<Filter> myResult = new HashSet<Filter>(findByOwner(aSourceId, aResource));
[]
/ want	,
/s
	public List<Filter> findByOwner(String aSourceId, Resource aResource) {
		List<Filter> myList = getHibernateTemplate().findByCriteria(
			DetachedCriteria.forClass(Filter.class).add(Property.forName("system").eq(false)).add(Property.forName("owner").eq(aResource)) .add(Property.forName("sourceId").eq(aSourceId)) .addOrder(Order.asc("sequence")));
		return myList;
	}
/ we zien 	,

select ... 
from OMS_FILTER this_ 
where this_.IS_SYSTEM=? 
and this_.USER_SYSTEMID=? 
and this_.SOURCE_ID=? 
order by this_.SEQUENCE asc 
2016-05-24 11:36:45,641 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [1] as [BIT] - false
2016-05-24 11:36:45,641 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [2] as [INTEGER] - 26891768
2016-05-24 11:36:45,642 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [3] as [VARCHAR] - shipment-order-list

/t
		myResult.addAll(findShared(aSourceId, aResource));
/s
FilterDAOImpl.findShared(String, Resource) line: 39	

		List<Filter> myList = getHibernateTemplate().findByCriteria(
				DetachedCriteria.forClass(Filter.class).
						add(Property.forName("system").eq(false)).
						add(Property.forName("master").eq(false)).
						add(Property.forName("sourceId").eq(aSourceId)).
						createCriteria("sharedWithUsers").add(Property.forName("systemId").eq(aResource.getSystemId())));
		return myList;
[]
/ want	,
select *
_ from OMS_FILTER this_
inner join OMS_FILTER_SHARE_USER sharedwith3_ on this_.SYSTEM_ID=sharedwith3_.FILTER_SYSTEMID 
inner join TMS_USER resource1_ on sharedwith3_.USER_SYSTEMID=resource1_.SYSTEM_ID 
left outer join TMS_USER resource5_ on resource1_.CREATED_BY=resource5_.SYSTEM_ID 
where this_.IS_SYSTEM=? 
and this_.IS_MASTER=? 
and this_.SOURCE_ID=? 
and resource1_.SYSTEM_ID=?
2016-05-24 11:48:48,420 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [1] as [BIT] - false
2016-05-24 11:48:48,421 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [2] as [BIT] - false
2016-05-24 11:48:48,421 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [3] as [VARCHAR] - shipment-order-list
2016-05-24 11:48:48,422 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [4] as [INTEGER] - 26891768

/t
FilterDAOImpl.getFilters(String, Resource) line: 53	
		return new ArrayList<Filter>(myResult);
[]
/t
FilterServiceImpl.getDefaultFilter(String, Resource) line: 32	
		List<Filter> myFilters = filterDAO.getFilters(aSourceId, aResource);
/d
[]		if (myFilters.isEmpty()) {
			return getSystemFilter(aSourceId, aResource);
/s
FilterServiceImpl.getSystemFilter(String, Resource) line: 59	
		Filter mySystem = filterDAO.getSystemFilter(aSourceId, aResource);
/s
FilterDAOImpl.getSystemFilter(String, Resource) line: 73	

		List<Filter> myList = getHibernateTemplate().findByCriteria(
				DetachedCriteria.forClass(Filter.class).add(Property.forName("system").eq(true)).add(Property.forName("owner").eq(aResource)) .add(Property.forName("sourceId").eq(aSourceId)));
[]

 we zien	,
select *
from OMS_FILTER this_ 
where this_.IS_SYSTEM=? 
and this_.USER_SYSTEMID=? 
and this_.SOURCE_ID=?
2016-05-24 12:14:03,798 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [1] as [BIT] - true
2016-05-24 12:14:03,799 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [2] as [INTEGER] - 26891768
2016-05-24 12:14:03,800 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [3] as [VARCHAR] - shipment-order-list

		if (myList.isEmpty()) {
			return null;
/t
FilterServiceImpl.getSystemFilter(String, Resource) line: 61	
		Filter mySystem = filterDAO.getSystemFilter(aSourceId, aResource);
null
aSourceId="shipment-order-list";
		if (mySystem == null) {
			mySystem = new Filter("system");
			mySystem.setSystem(true);
mySystem	Filter  (id=20321)	
	code	"system" (id=20322)		<-	
	configuration	null	
	description	null	
	master	false	
	organization	null	
	owner	null	
	performanceMonitorService	null	
	sequence	0	
	sharedWithUsers	HashSet  (id=20345)	
	sourceId	null	
	system	true					<-
	systemId	0	

/t
QueryViewPanel.initFilter() line: 898	
		Filter myDefault = filterService.getBean().getDefaultFilter(getQueryDefinition().getId(), AuthenticationUtils.getResource());
myDefault	Filter  (id=20321)	
	code	"system" (id=20322)	
	configuration	null	
	description	null	
	master	false	
	organization	null	
	owner	null	
	performanceMonitorService	null	
	sequence	0	
	sharedWithUsers	HashSet  (id=20345)	
	sourceId	null	
	system	true	
	systemId	0	
		activeFilter = new EntityDetachableModel<Filter>(myDefault, FilterDAO.class);

		Filter myMaster = filterService.getBean().getMasterFilter(getQueryDefinition().getId(), AuthenticationUtils.getResource());
/s
FilterServiceImpl.getMasterFilter(String, Resource) line: 54	
		return filterDAO.getMasterFilter(aSourceId, aResource);
/s
FilterServiceImpl.getMasterFilter(String, Resource) line: 54	
		List<Filter> myList = getHibernateTemplate().findByCriteria(
				DetachedCriteria.forClass(Filter.class).
						add(Property.forName("system").eq(false)).
						add(Property.forName("master").eq(true)).
						add(Property.forName("sourceId").eq(aSourceId)).
						createCriteria("sharedWithUsers").add(Property.forName("systemId").eq(aResource.getSystemId())));
[]
/ we zien	,
select*
from OMS_FILTER this_ inner join OMS_FILTER_SHARE_USER sharedwith3_ on this_.SYSTEM_ID=sharedwith3_.FILTER_SYSTEMID 
inner join TMS_USER resource1_ on sharedwith3_.USER_SYSTEMID=resource1_.SYSTEM_ID 
left outer join TMS_USER resource5_ on resource1_.CREATED_BY=resource5_.SYSTEM_ID 
where this_.IS_SYSTEM=? 
and this_.IS_MASTER=? 
and this_.SOURCE_ID=? 
and resource1_.SYSTEM_ID=?
2016-05-24 14:00:02,429 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [1] as [BIT] - false
2016-05-24 14:00:02,429 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [2] as [BIT] - true
2016-05-24 14:00:02,430 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [3] as [VARCHAR] - shipment-order-list
2016-05-24 14:00:02,431 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-7:) binding parameter [4] as [INTEGER] - 26891768

		if (myList.isEmpty()) {
			return null;
/t
QueryViewPanel.initFilter() line: 901	
		Filter myMaster = filterService.getBean().getMasterFilter(getQueryDefinition().getId(), AuthenticationUtils.getResource());
/d
		masterFilter = new EntityDetachableModel<Filter>(myMaster, FilterDAO.class);
/t
QueryViewPanel.<init>(String, IModel<QueryDefinition>, List<RowAction>, List<GroupAction>, Set<Serializable>) line: 132	
		initFilter();
/d
		initState();
/s
QueryViewPanel.initState() line: 906	
		queryStateModel = new Model<QueryState>();
		queryStateModel.setObject(QueryStateParser.toQueryState(activeFilter.getObject(), queryDefinition));
/s
QueryStateParser.toQueryState(Filter, QueryDefinition) line: 50	

		for (QueryColumn<?> myColumn : aQueryDefinition.getColumns()) {
			if (myColumn.isHidden() || myColumn.isId()) {
/ JA
systemId
				myState.getSystemColumns().add(myColumn);
				continue;
/ volgende	,
		for (QueryColumn<?> myColumn : aQueryDefinition.getColumns()) {
			if (myColumn.isHidden() || myColumn.isId()) {
			} else {
/ JA
				myTemp.add(myColumn.copy());

			if (!myColumn.isFilter()) {
/ NEE
			FilterExpression<?> myExpression = FilterExpressionFactory.create(myColumn);
/s
FilterExpressionFactory.create(QueryColumn<?>) line: 14	
		} else {
			return new TextFilterExpression((QueryColumn<String>) aColumn);
/ TODO (Overslaan)

/t
QueryStateParser.toQueryState(Filter, QueryDefinition) line: 67	
		for (QueryColumn<?> myColumn : aQueryDefinition.getColumns()) {
			FilterExpression<?> myExpression = FilterExpressionFactory.create(myColumn);
/d
			myState.addFilterExpression(myExpression);
myState	QueryState  (id=21003)	
	displayColumns	ArrayList  (id=21011)	
	filterExpressions	ArrayList  (id=21012)	
	searchQuery	null	
	sortAsc	false	
	sortColumn	null	
	systemColumns	ArrayList  (id=21013)	

		if (aFilter != null && aFilter.getConfiguration() != null) {
/ NEE
		myState.getDisplayColumns().addAll(myTemp);

myState	QueryState  (id=21003)	
	displayColumns	ArrayList  (id=21011)	
[shipmentorder.organization, shipmentorder.shipmentorderprocess, shipmentorder.shipmentorderid, shipmentorder.status, shipmentorder.customerstatus, shipmentorder.holdstatus, shipmentorder.shipmenttype, shipmentorder.requestedtotalweightkg, shipmentorder.cost, shipmentorder.cost.currency, shipmentorder.price, shipmentorder.price.currency, shipmentorder.margin, shipmentorder.reference1, shipmentorder.reference2, shipmentorder.reference3, shipmentorder.reference4, shipmentorder.reference5, shipmentorder.reference6, shipmentorder.reference7, shipmentorder.reference8, shipmentorder.reference9, shipmentorder.reference10, shipmentorder.customerordernumber, from.partyid, from.name, from.postalcode, from.city, from.country, to.partyid, to.name, to.postalcode, to.city, to.country, shipmentorder.billto, shipmentorder.preferredparty, shipmentorder.actualservicelevel, shipmentorder.incoterm, shipmentorder.requestedstartafter, shipmentorder.requestedstartbefore, shipmentorder.requestedendafter, shipmentorder.requestedendbefore, shipmentorder.systementrydate]
	filterExpressions	ArrayList  (id=21012)	
[com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@64675547, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@1722f441, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@77d1e344, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@749fc2d0, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@24af2181, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@65c0aef7, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@4d1f0e51, com.mpobjects.oms.view.wicket.entityview.filter.NumberFilterExpression@31e50f65, com.mpobjects.oms.view.wicket.entityview.filter.NumberFilterExpression@3555c97a, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@131e83f1, com.mpobjects.oms.view.wicket.entityview.filter.NumberFilterExpression@38684d05, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@4798a031, com.mpobjects.oms.view.wicket.entityview.filter.NumberFilterExpression@753d15af, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@7d5ad04a, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@5520ea91, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@64080140, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@498a440e, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@147a18da, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@5bf59ab6, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@598051e4, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@77807da3, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@14b895a0, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@62674600, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@6a24dc78, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@1a0680b9, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@20ecff08, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@275b771b, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@65e8a1cc, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@bd68c59, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@32982d21, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@24baeb7a, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@6bb9a96c, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@6a2228b4, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@689e77db, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@7bcf0085, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@532b5b43, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@4374b65d, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@2370b644, com.mpobjects.oms.view.wicket.entityview.filter.DateTimeFilterExpression@3cce3c89, com.mpobjects.oms.view.wicket.entityview.filter.DateTimeFilterExpression@7e8658f, com.mpobjects.oms.view.wicket.entityview.filter.DateTimeFilterExpression@2a639357, com.mpobjects.oms.view.wicket.entityview.filter.DateTimeFilterExpression@6f5e4a7e, com.mpobjects.oms.view.wicket.entityview.filter.DateTimeFilterExpression@176ccf51]
	searchQuery	null	
	sortAsc	false	
	sortColumn	null	
	systemColumns	ArrayList  (id=21013)	
[systemId, holdColor, shipmentorder.requestedservicelevel]

		return myState;
/t
QueryViewPanel.initState() line: 907	
		queryStateModel.setObject(QueryStateParser.toQueryState(activeFilter.getObject(), queryDefinition));
/d
this	QueryViewPanel  (id=18342)	
	queryStateModel	Model  (id=21226)	
		object	QueryState  (id=21003)	
			displayColumns	ArrayList  (id=21011)	
			filterExpressions	ArrayList  (id=21012)	
			searchQuery	null	
			sortAsc	false	
			sortColumn	null	
			systemColumns	ArrayList  (id=21013)	
/t
QueryViewPanel.<init>(String, IModel<QueryDefinition>, List<RowAction>, List<GroupAction>, Set<Serializable>) line: 133	
		initState();
/d
		if (rowActions != null) {
			rowActionList = rowActions;
		}
		createComponents();
/s
QueryViewPanel.createComponents() line: 419	
...
		addSearchBar();
/s
QueryViewPanel.addSearchBar() line: 830	
		final WebMarkupContainer mySearchBar = new WebMarkupContainer("search-bar");
		if (queryDefinition.isFilterEnabled() && !queryDefinition.getFilterableColumns().isEmpty()) {
			mySearchBar.add(createFilterBar());
/s
QueryViewPanel.createFilterBar() line: 891	
		return new FilterBarPanel("filter-bar", QueryViewPanel.this);
/s
FilterBarPanel.<init>(String, QueryViewPanel) line: 72	
/ MORGENOCHTEND (geosco)



























/s
Daemon Thread [http-0.0.0.0-8080-5] (Suspended (breakpoint at line 206 in FilterBarPanel))	
	FilterBarPanel.getUserFilters() line: 206	
	FilterBarPanel$7.onConfigure() line: 173	
	FilterBarPanel$7(Component).configure() line: 1165	
	FilterBarPanel$7(Component).internalBeforeRender() line: 1056	
	FilterBarPanel$7(Component).beforeRender() line: 1103	
	FilterBarPanel$1(MarkupContainer).onBeforeRenderChildren() line: 1777	
	FilterBarPanel$1(Component).onBeforeRender() line: 4001	
	FilterBarPanel$1(Form).onBeforeRender() line: 2104	
	FilterBarPanel$1(Component).internalBeforeRender() line: 1069	
	FilterBarPanel$1(Component).beforeRender() line: 1103	
	FilterBarPanel(MarkupContainer).onBeforeRenderChildren() line: 1777	
	FilterBarPanel(Component).onBeforeRender() line: 4001	
	FilterBarPanel(Component).internalBeforeRender() line: 1069	
	FilterBarPanel(Component).beforeRender() line: 1103	
	WebMarkupContainer(MarkupContainer).onBeforeRenderChildren() line: 1777	
	WebMarkupContainer(Component).onBeforeRender() line: 4001	
	WebMarkupContainer(Component).internalBeforeRender() line: 1069	
	WebMarkupContainer(Component).beforeRender() line: 1103	
	QueryViewPanel(MarkupContainer).onBeforeRenderChildren() line: 1777	
	QueryViewPanel(Component).onBeforeRender() line: 4001	
	QueryViewPanel(Component).internalBeforeRender() line: 1069	
	QueryViewPanel(Component).beforeRender() line: 1103	
	EventActivityListPage(MarkupContainer).onBeforeRenderChildren() line: 1777	
	EventActivityListPage(Component).onBeforeRender() line: 4001	
	EventActivityListPage(Page).onBeforeRender() line: 1555	
	EventActivityListPage(Component).internalBeforeRender() line: 1069	
	EventActivityListPage(Component).beforeRender() line: 1103	
	EventActivityListPage(Component).prepareForRender(boolean) line: 2297	
	EventActivityListPage(Page).prepareForRender(boolean) line: 1545	
	EventActivityListPage(Component).prepareForRender() line: 2329	
	EventActivityListPage(Page).renderPage() line: 912	
	MpoWebRequestCycle(WebRequestCycle).redirectTo(Page) line: 201	
	PageRequestTarget.respond(RequestCycle) line: 58	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/ we zijn in 	,
rPanel.getUserFilters() line: 206	




/ Einde DEBUG GSJ-76

/ PCT-1480

[jboss@pnl-app-p ~]$ pnllogistics heapdump
[jboss@pnl-app-p ~]$ ls -ltr
-rw------- 1 jboss jboss 1431543524 May 26 17:08 pnllogistics.20160526-170843.hprof

/ print meest recente file in dir	,
[jboss@pnl-app-p ~]$ awk 'NR==1' <(ls -1t)
pnllogistics.20160526-170843.hprof

/ print last line	,
[jboss@pnl-app-p ~]$ awk 'END{print}' <(ls -1tr)
pnllogistics.20160526-170843.hprof
[jboss@pnl-app-p ~]$ gzip $(awk 'NR==1' <(ls -1t))
[jboss@pnl-app-p ~]$ awk 'NR==1' <(ls -1t)
pnllogistics.20160526-170843.hprof.gz
[jboss@pnl-app-p ~]$ chmod a+r $(awk 'NR==1' <(ls -1t))		

[eric@localhost bin]$ pnl-ssh-p.sh "cp /home/jboss$(awk 'NR==1' <(ls -1t)) ."
[eric@localhost bin]$ pnl-ssh-p.sh "echo $(awk 'NR==1' <(ls -1t /home/jboss))"

[eric@localhost bin]$ pnl-ssh-p.sh "awk 'NR==1' <(ls -1t /home/jboss)"
/ OK

/ Zo raken we Intermax comments kwijt	,
/ Set 2>/dev/null ervoor	,
[eric@localhost tmp]$ 2>/dev/null pnl-ssh-p.sh ls
ehcache-2.10.0.jar
quartz-1.8.6.jar

[eric@localhost tmp]$ 2>/dev/null pnl-ssh-p.sh "awk 'NR==1' <(ls -1t /home/jboss)"
pnllogistics.20160526-170843.hprof.gz
/ OK
[eric@localhost tmp]$ 2>/dev/null pnl-ssh-p.sh "cat <(awk 'NR==1' <(ls -1t /home/jboss))"
pnllogistics.20160526-170843.hprof.gz
/ OK
[eric@localhost tmp]$ 2>/dev/null pnl-ssh-p.sh "echo \$(awk 'NR==1' <(ls -1t /home/jboss))"
pnllogistics.20160526-170843.hprof.gz
/ OK	, escape $	,
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
[eric@localhost tmp]$ 2>/dev/null pnl-ssh-p.sh "cp  /home/jboss/\$(awk 'NR==1' <(ls -1t /home/jboss)) ."
/ OK	, 
/ Heeft naar /home/vanderveldene copy	,

[eric@localhost tmp]$ echo $(2>/dev/null pnl-ssh-p.sh "awk 'NR==1' <(ls -1t)")
pnllogistics.20160526-170843.hprof.gz

[eric@localhost bin]$ cat pnl-scp-from-p.sh 
#!/bin/bash

scp vanderveldene@pnl-app-p.intermax.mp-objects.com:$1 $2

/ TODO QUOTES IN BASH
/ We mogen niet "$1"	, want dan in knoop WH met quotes in arg	, hieronder	met awk

[eric@localhost tmp]$ 2>/dev/null pnl-scp-from-p.sh $(2>/dev/null pnl-ssh-p.sh "awk 'NR==1' <(ls -1t)") /tmp
pnllogistics.20160526-170843.hprof.gz                                                                           100%  262MB   1.7MB/s   02:34    









/ Einde PCT-1480

/ GGS-67

[eric@localhost bin]$ geosco-pg_dump-p.sh 
geosco3=# create database geosco2p;
[eric@localhost bin]$ local-pg_restore.sh local-pg_restore.sh geosco2p ~/DB_TAP/Postgres/Backup/geosco-

[vanderveldene@geosco-int-p ~]$ less /local/apps/interface/geodispsa/to-scs/InventoryReport/archive/2016-06/02/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-1713-1-1-1.xml
/ Deze moeten we hebben	,
/ samen met	,
[eric@localhost eclipse-interfacing-testing]$ awk 'NR==1' <(ls -1t ~/DB_TAP/Postgres/Backup/)
geosco-p-2016-06-01.dump

[eric@localhost bin]$ cat geosco-scp-from-int-p.sh 
#!/bin/bash
if [ "$#" -ne 2 ]
then
	echo "Give <file name> <target dir>."
	exit 7
fi
scp vanderveldene@geosco-int-p.intermax.mp-objects.com:/local/apps/interface/geodispsa/"$1" "$2"

[eric@localhost Geosco]$ pwd
/home/eric/Integration/Geosco
[eric@localhost Geosco]$ geosco-scp-from-int-p.sh to-scs/InventoryReport/archive/2016-06/02/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-1713-1-1-1.xml InventoryReport/2016/06/02/
/ OK

/ 7	. 

/ product 9675627980

/ Kijk in stock transactions scherm	, planning, inventory, stock transaction	,
/ Zoek op product / product 9675627980

LOG_EMEA_FR_CT_PSA	9675627980 - ECHANGEUR AIR AIR	GOOD	GEODIS_WHS_FR_SOCHAUX	ORDER_IN	1260.00	3071.00	14-Jun-2016 23:59:00
LOG_EMEA_FR_CT_PSA	9675627980 - ECHANGEUR AIR AIR	GOOD	GEODIS_WHS_FR_SOCHAUX	FORECAST_OUT	-1199.00	1811.00	14-Jun-2016 23:59:00
LOG_EMEA_FR_CT_PSA	9675627980 - ECHANGEUR AIR AIR	GOOD	GEODIS_WHS_FR_SOCHAUX	FORECAST_IN		1260.00	3010.00	14-Jun-2016 23:59:00
LOG_EMEA_FR_CT_PSA	9675627980 - ECHANGEUR AIR AIR	GOOD	GEODIS_WHS_FR_SOCHAUX	FORECAST_OUT	0.00	3713.00	13-Jun-2016 23:59:00

/ 7	. 

/ op geosco-int-p	, 

[vanderveldene@geosco-int-p 07]$ pwd
/local/apps/interface/geodispsa/to-scs/InventoryReport/archive/2016-06/07
[vanderveldene@geosco-int-p 07]$ less 14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2222-1-1-1.xml 
   <mtc:body>
      <mtc:STOCK_TRANSACTION_GROUP>
         <mtc:PROCESSING_DETAILS>
            <mtccore:PURPOSE_CODE>05</mtccore:PURPOSE_CODE>
     <mtc:STOCK_TRANSACTION_GROUP>
         <mtc:PROCESSING_DETAILS>
            <mtccore:PURPOSE_CODE>05</mtccore:PURPOSE_CODE>
...

/ Er zijn meerdere stock transaction groups	, 
/ TODO
/ In onze ReceiptAdvice XML was er 1 seo	, een receipt	,   
   <mtc:body>
      <mtc:SERVICE_ORDER>
         <mtc:PROCESSING_DETAILS>
            <mtccore:PURPOSE_CODE>ReceiptAdviceShipment</mtccore:PURPOSE_CODE>



/ Einde GGS-67

/ GGS-67 INVESTIGATE

/ we zien dus	,

LOG_EMEA_FR_CT_PSA	9675627980 - ECHANGEUR AIR AIR	GOOD	GEODIS_WHS_FR_SOCHAUX	FORECAST_IN		1260.00	3010.00	14-Jun-2016 23:59:00
LOG_EMEA_FR_CT_PSA	9675627980 - ECHANGEUR AIR AIR	GOOD	GEODIS_WHS_FR_SOCHAUX	FORECAST_OUT	0.00	3713.00	13-Jun-2016 23:59:00

/ 7	. 

geosco=> select*from product where productid='9675627980';

geosco=> select*from stock_location where name like '%SOCH%';
 system_id |         name          | is_deleted | stock_loc_type_systemid | parent_stock_loc_systemid | party_systemid 
-----------+-----------------------+------------+-------------------------+---------------------------+----------------
  26878346 | GEODIS_WHS_FR_SOCHAUX |          0 |                26877279 |                  26878470 |       26878344
(1 row)

sco=> select count(*) from stock_transaction st join product p on st.product_systemid=p.system_id join stock_location sl on st.stock_location_systemid=sl.system_id  where p.productid='9675627980' and sl.name like '%SOCH%';




/ 7	. 

/ we zien de application responses in from-scs	,
/local/apps/interface/geodispsa/from-scs/APPLICATION_RESPONSE/archive/2016-06/07

/ 13-recadv komt in to-scs	,

/ 7	. 

sco=> select count(*) from stock_transaction st join product p on st.product_systemid=p.system_id join stock_location sl on st.stock_location_systemid=sl.system_id  where p.productid='9675627980' and sl.name like '%SOCH%' and '2016-06-01' <= st.transaction_date and st.transaction_date <= '2016-06-22';
 count 
-------
    58
(1 row)

geosco=> select st.* from stock_transaction st join product p on st.product_systemid=p.system_id join stock_location sl on st.stock_location_systemid=sl.system_id  where p.productid='9675627980' and sl.name like '%SOCH%' and st.transaction_date <= '2016-06-22' and st.transaction_type='FORECAST_IN' and st.transaction_date='14-Jun-2016 23:59:00';
 system_id |  quantity  | serial_number | lot_id |  transaction_date   | product_systemid | goods_status_systemid | stock_location_systemid | product_item_systemid | external_id | organization_systemid | calc_stock_level | is_dirty | transaction_type | customer_order_line_systemid | shipment_item_systemid | ignore_on_balance 
-----------+------------+---------------+--------+---------------------+------------------+-----------------------+-------------------------+------ -----------------+-------------+-----------------------+------------------+----------+------------------+------------------------------+----------- -------------+-------------------
  27367488 | 1260.00000 | NULL          | NULL   | 2016-06-14 23:59:00 |         26878513 |              26877284 |                26878346 |      NULL | NULL        |                 12000 |       3010.00000 |        0 | FORECAST_IN      |                     27466485 |           NULL |                 1
(1 row)

/ PAUL: als je deze stock tx dirty maakt,	 wordt alles opnieuw uitgerekend	,

/ 7. 	

/ we maken een backup van de prod db 	,

[eric@localhost bin]$ geosco-pg_dump-p.sh 
# create database geosco2p

/ we oef	,

[eric@localhost bin]$ echo local-pg_restore.sh geosco2p $(find /home/eric/DB_TAP/Postgres/Backup/ -type f | xargs ls -1t | awk 'NR==1')
local-pg_restore.sh geosco2p /home/eric/DB_TAP/Postgres/Backup/geosco-p-2016-06-07.dump
/ of	,
[eric@localhost bin]$ find /home/eric/DB_TAP/Postgres/Backup/ -type f | xargs ls -1t | awk 'NR==1' | xargs echo local-pg_restore.sh geosco2p
local-pg_restore.sh geosco2p /home/eric/DB_TAP/Postgres/Backup/geosco-p-2016-06-07.dump

/ Nu doen	,

[eric@localhost bin]$ find /home/eric/DB_TAP/Postgres/Backup/ -type f | xargs ls -1t | awk 'NR==1' | xargs   local-pg_restore.sh geosco2p

/ 7	. 

/ we halen inventoty report op 	, van 8 Jun	,

[eric@localhost bin]$ cat geosco-int-invp-from-p.sh 

#!/bin/bash

# vervang door rsync	,

if [ "$#" -ne 1 ]
then
	echo 'Give year-month/date, for example 2016-06/08' 
	exit 7
fi

LOCAL="$HOME/Integration/Geosco" 
REMOTE="/local/apps/interface/geodispsa/to-scs"
DIR="InventoryReport/archive/$@"

if [ ! -d "$LOCAL/$DIR" ]
then
	mkdir -p "$LOCAL/$DIR" 
fi

file=$(ssh vanderveldene@geosco-int-p.intermax.mp-objects.com "find "$REMOTE/$DIR" -type f")
scp vanderveldene@geosco-int-p.intermax.mp-objects.com:$file "$LOCAL/$DIR" 

[eric@localhost bin]$ 2>/dev/null geosco-int-invp-from-p.sh 2016-06/08
[eric@localhost InventoryReport]$ less  archive/2016-06/08/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2379-1-1-1.xml 
/ OK

/ 7.	 

/ we set in postgres-ds.xml geosco2p als db	, 2 keer	,

/ 7	. 

/ In een inventory report staan alleen nieuwe stock tx's	, 
/ Dit moet nieuwe recalculate opleveren	,

public class StockLevelCalculationServiceImpl implements StockLevelCalculationService {
	@Override
	public void recalculate(StockKeepingUnit aSku) {
		LOG.info("Starting recalculation of stock levels for SKU [" + aSku + "] ...");
		recalculate(aSku.getProduct(), aSku.getStockLocation(), aSku.getGoodsStatus());
	}

/ 7	. 

/ we zien op 8 Jan weer een fout	,

LOG_EMEA_FR_CT_PSA	9675627980 - ECHANGEUR AIR AIR	GOOD	GEODIS_WHS_FR_SOCHAUX	ORDER_IN	1260.00	3736.00	15-Jun-2016 23:59:00
LOG_EMEA_FR_CT_PSA	9675627980 - ECHANGEUR AIR AIR	GOOD	GEODIS_WHS_FR_SOCHAUX	FORECAST_OUT	-1205.00	2476.00	15-Jun-2016 23:59:00
LOG_EMEA_FR_CT_PSA	9675627980 - ECHANGEUR AIR AIR	GOOD	GEODIS_WHS_FR_SOCHAUX	FORECAST_IN	1260.00	3681.00	15-Jun-2016 23:59:00
LOG_EMEA_FR_CT_PSA	9675627980 - ECHANGEUR AIR AIR	GOOD	GEODIS_WHS_FR_SOCHAUX	FORECAST_OUT	-1199.00	3742.00	14-Jun-2016 23:59:00

/ MORGENOCHTEND

/ 7	. 

/ GGS-67 STOCK LOG

/ op prod	,
$ vi log4j.xml 

        <appender name="STOCK" class="org.jboss.logging.appender.DailyRollingFileAppender">
                <errorHandler class="org.jboss.logging.util.OnlyOnceErrorHandler"/>
                <param name="File" value="${jboss.server.log.dir}/stock.log"/>
                <param name="Append" value="true"/>
                <param name="DatePattern" value="'.'yyyy-MM-dd"/>
                <layout class="org.apache.log4j.PatternLayout">
                        <param name="ConversionPattern" value="%d %-5p [%c] (%t:%x) %m%n"/>
                </layout>
        </appender>

        <category name="com.mpobjects.inventory.service.stocktransaction" additivity="false">
                <priority value="DEBUG" />
                <appender-ref ref="STOCK"/>
        </category>


/ 7 .

[eric@localhost InventoryReport]$ awk '/EXTERNAL_ID/{print}' archive/2016-06/08/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2379-1-1-1.xml | awk '{gsub(/<[\/]*mtc:EXTERNAL_ID>/,"");print}' | awk '{gsub(/^[ \t]* | [ \t]*$/,"");print}'| awk '{print "\x27"$0"\x27"}' | awk '{printf "%s,",$0}' | awk '{gsub(/,$/,"");print "select count(*)from stock_transaction where external_id in("$0")"}'

select count(*)from stock_transaction where external_id in('1288-2016-06-08T05:16:01Z-1','1288-2016-06-08T05:16:01Z-2','1288-2016-06-08T05:16:01Z-3','1288-2016-06-08T05:16:01Z-4','1288-2016-06-08T05:16:01Z-5','1288-2016-06-08T05:16:01Z-6','1288-2016-06-08T05:16:01Z-7','1288-2016-06-08T05:16:01Z-8','1288-2016-06-08T05:16:01Z-9','1288-2016-06-08T05:16:01Z-10','1288-2016-06-08T05:16:01Z-11','1288-2016-06-08T05:16:01Z-12','1288-2016-06-08T05:16:01Z-13','1...41','1288-2016-06-08T05:16:01Z-242','1288-2016-06-08T05:16:01Z-243','1288-2016-06-08T05:16:01Z-244','1288-2016-06-08T05:16:01Z-245','1288-2016-06-08T05:16:01Z-246')

/ Als we deze exec  , dan zien we
0
/ Het zijn altijd allemaal nieuwe stock tx's, van type COUNT    ,

/ 7	. 




/ Einde GGS-67 INVESTIGATE

////////////////////////////////////////////////

/ GGS-67 DEBUG INVENTORY REPORT

/ 7	. 

/ DemuxExchangeHandler.onExchange: de 1ste keer dat we de .onExchange method in gaan	,

/ stack trace	,

Thread [GeoScoQueueContainer-2] (Suspended)	
	DemuxExchangeHandler.onExchange(MessageExchange) line: 117	
	DemuxExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 43	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	TxExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
/ Voor deze call is er een tx start	, met @Transactional annot	,

	TxExchangeHandler.handleExchange(ExchangeHandlerChain, MessageExchange) line: 62	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy478.handleExchange(ExchangeHandlerChain, MessageExchange) line: not available	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	MessageTraceExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	AuthNExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	ArchiveExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	SapXConverterExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	ArchiveErrorExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	RetryExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	RetryExchangeHandler.handleExchange(ExchangeHandlerChain, MessageExchange) line: 80	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	MessageHandler.handleExchange(MessageExchange) line: 55	
	MpoMessageListener.processMessage(Message, JmsMpoMessage) line: 378	
	MpoMessageListener.onMessage(Message) line: 199	
	DefaultMessageListenerContainer(AbstractMessageListenerContainer).doInvokeListener(MessageListener, Message) line: 569	
	DefaultMessageListenerContainer(AbstractMessageListenerContainer).invokeListener(Session, Message) line: 507	
	DefaultMessageListenerContainer(AbstractMessageListenerContainer).doExecuteListener(Session, Message) line: 474	
	DefaultMessageListenerContainer(AbstractPollingMessageListenerContainer).doReceiveAndExecute(Object, Session, MessageConsumer, TransactionStatus) line: 325	
	DefaultMessageListenerContainer(AbstractPollingMessageListenerContainer).receiveAndExecute(Object, Session, MessageConsumer) line: 263	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener() line: 1103	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop() line: 1095	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run() line: 992	
	Thread.run() line: 745	

/s
DemuxExchangeHandler.onExchange(MessageExchange) line: 117	
		String messageType = getMessageType(aExchange);
STOCK_TRANSACTION_MSG

this.exchangeHandlers=
{PRODUCT_MASTER_DATA_MSG=ExchangeHandler[com.mpobjects.interfacing.messages.handler.MessageConsumerHandler$$EnhancerBySpringCGLIB$$933b1294[ProductMasterDataMsgHandler]], 
SHIPMENT_ORDER_MSG=ExchangeHandler[com.mpobjects.interfacing.messages.handler.MessageConsumerHandler$$EnhancerBySpringCGLIB$$27ee1c21[ShipmentOrderMsgHandler]], 
STOCK_TRANSACTION_MSG=ExchangeHandler[com.mpobjects.interfacing.messages.handler.MessageConsumerHandler$$EnhancerBySpringCGLIB$$28e5a805[StockTransactionMsgHandler]], 
CUSTOMER_ORDER_MSG=ExchangeHandler[com.mpobjects.interfacing.messages.handler.MessageConsumerHandler$$EnhancerBySpringCGLIB$$1564440d[CustomerOrderMsgHandler]], 
SERVICE_ORDER_MSG=ExchangeHandler[com.mpobjects.interfacing.messages.handler.MessageConsumerHandler$$EnhancerBySpringCGLIB$$ca5a33ca[ServiceOrderMsgHandler]], 
LOGISTICS_ORDER_EVENT_MSG=ExchangeHandler[com.mpobjects.interfacing.messages.handler.MessageConsumerHandler$$EnhancerBySpringCGLIB$$c633448[LogisticsOrderEventMsgHandler]]}

		ExchangeHandler handler = exchangeHandlers.get(messageType);
ExchangeHandler[com.mpobjects.interfacing.messages.handler.MessageConsumerHandler$$EnhancerBySpringCGLIB$$28e5a805[StockTransactionMsgHandler]]
		handleMessage(handler, aExchange);
/s
DemuxExchangeHandler.handleMessage(ExchangeHandler, MessageExchange) line: 110	
/=
	protected void handleMessage(@Nonnull ExchangeHandler aHandler, @Nonnull MessageExchange aExchange) throws Exception {
		ExchangeHandlerChain chain = new SingletonExchangeHandlerChain(aHandler);
		chain.next(aExchange);
/s
SingletonExchangeHandlerChain.next(MessageExchange) line: 39	
		handler.handleExchange(this, aExchange);
/s
MessageConsumerHandler$$EnhancerBySpringCGLIB$$28e5a805(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 36	
		boolean canContinue = onExchange(aExchange);
/s
MessageConsumerHandler$$EnhancerBySpringCGLIB$$28e5a805(MessageConsumerHandler).onExchange(MessageExchange) line: 168	
		MessageConsumerInterface consumer = getConsumer();
/ TODO
com.mpobjects.inventory.util.StockTransactionMsgConsumer@c65d388
		consumer.handle(message);
/s
/ Voor deze call wordt een tx start	, nu niet via @Transactional	, maar via Spring	,
StockTransactionMsgConsumer(MessageConsumer).handle(Message) line: 90	

  
/ Intermezzo

/ 7	. 

/ we waren eerst in ServiceOrderMsgConsumer	, nu in StockTransactionMsgConsumer	,

/ In ShipmentOrderMsgConsumer wordt ook 
myProcessor.processHeader(aIncomingMessage.getMessageHeader());

/ In ServiceOrderMsgConsumer is .processHeader er NIET	, 
/ TODO

/ 7	. 

$ vi inventory-service.sb.xml

	<tx:annotation-driven />
/ TODO

	<bean id="com.mpobjects.inventory.util.StockTransactionMsgConsumer" parent="transactionRequiredTemplate">
		<property name="target">
			<bean class="com.mpobjects.inventory.util.StockTransactionMsgConsumer" />
		</property>
	</bean>

$ vi core-base.sb.xml

	<!-- The default transaction bean. Extend this abstract bean to apply transaction constraints to a bean. -->
	<bean abstract="true" id="transactionRequiredTemplate" class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
		<property name="transactionManager" ref="transactionManager" />
		<property name="transactionAttributes">
			<props>
				<!-- common read actions -->
				<prop key="load*">PROPAGATION_SUPPORTS,ISOLATION_REPEATABLE_READ,-Exception</prop>
				<prop key="get*">PROPAGATION_SUPPORTS,ISOLATION_REPEATABLE_READ,-Exception</prop>
				<prop key="is*">PROPAGATION_SUPPORTS,ISOLATION_REPEATABLE_READ,-Exception</prop>
				<prop key="set*">PROPAGATION_SUPPORTS,ISOLATION_REPEATABLE_READ,-Exception</prop>
				<prop key="find*">PROPAGATION_SUPPORTS,ISOLATION_REPEATABLE_READ,-Exception</prop>
				<prop key="exists*">PROPAGATION_SUPPORTS,ISOLATION_REPEATABLE_READ,-Exception</prop>
				<!-- common write actions -->
				<prop key="create*">PROPAGATION_REQUIRED,ISOLATION_REPEATABLE_READ,-Exception</prop>
				<prop key="delete*">PROPAGATION_REQUIRED,ISOLATION_REPEATABLE_READ,-Exception</prop>
				<prop key="remove*">PROPAGATION_REQUIRED,ISOLATION_REPEATABLE_READ,-Exception</prop>
				<prop key="update*">PROPAGATION_REQUIRED,ISOLATION_REPEATABLE_READ,-Exception</prop>
				<prop key="save*">PROPAGATION_REQUIRED,ISOLATION_REPEATABLE_READ,-Exception</prop>
				<!-- the rest -->
				<prop key="*">PROPAGATION_REQUIRED,ISOLATION_REPEATABLE_READ,-Exception</prop>
			</props>
		</property>
	</bean>

	<!-- The main transaction manager -->
	<bean id="transactionManager" class="org.springframework.transaction.jta.JtaTransactionManager">
		<property name="transactionManagerName">
			<value>java:/TransactionManager</value>
		</property>
		<property name="userTransactionName">
			<value>UserTransaction</value>
		</property>
		<property name="allowCustomIsolationLevels">
			<value>true</value>
		</property>
		<property name="failEarlyOnGlobalRollbackOnly" value="true" />
	</bean>

/ Einde Intermezzo

/ we waren in 	,
StockTransactionMsgConsumer(MessageConsumer).handle(Message) line: 108	
				process(incomingMessage);
/s
StockTransactionMsgConsumer.process(Message) line: 44	

			if (aIncomingMessage instanceof SapXMessage) {
				CachedXPathAPI myXpathAPI = new CachedXPathAPI();
				StockTransactionMsgProcessor myProcessor = new StockTransactionMsgProcessor();
				myProcessor.setCachedXpathAPI(myXpathAPI);
				myProcessor.setMessageHeader(aIncomingMessage.getMessageHeader());
				myProcessor.processHeader(aIncomingMessage.getMessageHeader());

				Node msgNode = XMLUtil.selectSingleNode(((SapXMessage) aIncomingMessage).getDocument(), "STOCK_TRANSACTION_MSG");
				if (msgNode != null) {
/ JA	,
  <mtc:header>
      <mtccore:typ>STOCK_TRANSACTION_MSG</mtccore:typ>

					myProcessor.process(((SapXMessage) aIncomingMessage).getBody());
/s
StockTransactionMsgProcessor.process(Node) line: 53	
		node = aNode;
body
		StockTransaction myStockTransaction = null;
		String messageId = org.apache.commons.lang.StringUtils.defaultIfEmpty(findMessageId(node), "?MessageId?");
?MessageId?
		String[] monitorMeta = new String[5];
		try {

/ Er zijn multiple stock transactin group's in de 04-inventory report	,
			for (Node myNode : selectNodeIterable(aNode, StockTransactionBodyProcessor.STOCK_TRANSACTION_GROUP_TAG)) {

myNode=[mtc:STOCK_TRANSACTION_GROUP: null]

  <mtc:body>
      <mtc:STOCK_TRANSACTION_GROUP>
         <mtc:PROCESSING_DETAILS>
            <mtccore:PURPOSE_CODE>05</mtccore:PURPOSE_CODE>
         </mtc:PROCESSING_DETAILS>
         <mtc:STOCK_TRANSACTION>
            <mtc:QUANTITY>3</mtc:QUANTITY>
            <mtc:ABSOLUTE/>
            <mtc:SERIAL_NUMBER/>
            <mtc:LOT_ID/>
            <mtc:TRANSACTION_DATE>2016-06-08T05:15:40Z</mtc:TRANSACTION_DATE>
            <mtc:PRODUCT_ID>Z000495429</mtc:PRODUCT_ID>
            <mtc:GOODS_STATUS>GOOD</mtc:GOODS_STATUS>
            <mtc:LOCATION>GEODIS_WHS_FR_SOCHAUX</mtc:LOCATION>
            <mtc:EXTERNAL_ID>1288-2016-06-08T05:16:01Z-1</mtc:EXTERNAL_ID>
            <mtc:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtc:ORGANIZATION_ID>
         </mtc:STOCK_TRANSACTION>
      </mtc:STOCK_TRANSACTION_GROUP>
      <mtc:STOCK_TRANSACTION_GROUP>
		...

				long start = System.currentTimeMillis();
				PurposeCodeVO myPurposeCode = new PurposeCodeProcessor(this).process(selectSingleNode(myNode, PROCESSING_DETAILS_TAG));
/s
PurposeCodeProcessor.process(Node) line: 40	
		PurposeCodeVO myVO = new PurposeCodeVO();
				myVO.setPurposeCode(myNode.getTextContent());
myVO	PurposeCodeVO  (id=25629)	
	thePurposeCode	"05" (id=25658)	

		return myVO;

/ Intermezzo

public class PurposeCodeVO {
	public static final String PURPOSE_CODE_CANCEL = "01";
	public static final String PURPOSE_CODE_DELETE = "01";
	public static final String PURPOSE_CODE_ORIGINAL = "00";
	public static final String PURPOSE_CODE_PARTIAL_UPDATE = "04";
	public static final String PURPOSE_CODE_UPDATE = "05";
	public static final String PURPOSE_CODE_ACTIONS = "ACTIONS";

/ Einde Intermezzo

/t
StockTransactionMsgProcessor.process(Node) line: 70	
				PurposeCodeVO myPurposeCode = new PurposeCodeProcessor(this).process(selectSingleNode(myNode, PROCESSING_DETAILS_TAG));
/d
myPurposeCode	PurposeCodeVO  (id=25629)	
	thePurposeCode	"05" (id=25658)	

				StockTransactionBodyProcessor myProcessor = new StockTransactionBodyProcessor();
				myProcessor.setProcessingContext(getProcessingContext());
[]
				myProcessor.setParent(getParent());
null
				myStockTransaction = myProcessor.process(selectSingleNode(myNode, StockTransactionBodyProcessor.STOCK_TRANSACTION_TAG));
/s
StockTransactionBodyProcessor.process(Node) line: 73	

/ Intermezzo

/ Bij desadv/ recadv 

    ServiceOrderMsgConsumer.process(Message) line: 52
/s
    ServiceOrderMsgProcessor.process(Node) line: 91
/s
    GeoScoServiceOrderProcessor.process(Node) line: 262

/ Nu in inv-p

	StockTransactionMsgConsumer.process(Message) line: 44	
/s
	StockTransactionMsgProcessor.process(Node) line: 53	
/s
	StockTransactionBodyProcessor.process(Node) line: 73	

/ Einde Intermezzo

/ we hebben	,
         <mtc:STOCK_TRANSACTION>
            <mtc:QUANTITY>3</mtc:QUANTITY>
            <mtc:ABSOLUTE/>
            <mtc:SERIAL_NUMBER/>
            <mtc:LOT_ID/>
            <mtc:TRANSACTION_DATE>2016-06-08T05:15:40Z</mtc:TRANSACTION_DATE>
            <mtc:PRODUCT_ID>Z000495429</mtc:PRODUCT_ID>
            <mtc:GOODS_STATUS>GOOD</mtc:GOODS_STATUS>
            <mtc:LOCATION>GEODIS_WHS_FR_SOCHAUX</mtc:LOCATION>
            <mtc:EXTERNAL_ID>1288-2016-06-08T05:16:01Z-1</mtc:EXTERNAL_ID>
            <mtc:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtc:ORGANIZATION_ID>
         </mtc:STOCK_TRANSACTION>

/ we zijn in	,
StockTransactionBodyProcessor.process(Node) line: 73	
			StockTransaction myStockTransaction = new StockTransaction();
			myStockTransaction.setQuantity(new BigDecimal(getNodeTextContent(selectSingleNode(aNode, QUANTITY_TAG))));
3
			myStockTransaction.setSerialNumber(getNodeTextContent(selectSingleNode(aNode, SERIAL_NUMBER_TAG)));
""
			myStockTransaction.setLotId(getNodeTextContent(selectSingleNode(aNode, LOT_ID_TAG)));
""
			String dateString = getNodeTextContent(selectSingleNode(aNode, TRANSACTION_DATE_TAG));
2016-06-08T05:15:40Z
			myStockTransaction.setTransactionDate(DateUtils.javaDateCustomFormatToDate("yyyy-MM-dd'T'HH:mm:ss", dateString));
Wed Jun 08 05:15:40 CEST 2016

			String myOrganizationCode = getNodeTextContent(selectSingleNode(aNode, ORGANIZATION_ID_TAG));
LOG_EMEA_FR_CT_PSA
			Organization myOrganization = MpoBeanFactory.getBean(OrganizationDAO.class).getByCode(myOrganizationCode);
SystemId:12000	Id:LOG_EMEA_FR_CT_PSA	Description:Organization for PSA CT
			myStockTransaction.setOrganization(myOrganization);

			String myProductCode = getNodeTextContent(selectSingleNode(aNode, PRODUCT_ID_TAG));
Z000495429
			Product myProduct = null;
			if (!StringUtils.isBlank(myProductCode)) {
				myProduct = MpoBeanFactory.getBean(ProductDAO.class).getByCode(myProductCode);
Z000495429 (26942481)
			myStockTransaction.setProduct(myProduct);

			String myGoodsStatusCode = getNodeTextContent(selectSingleNode(aNode, GOODS_STATUS_TAG));
"GOOD"
			if (!StringUtils.isBlank(myGoodsStatusCode)) {
				GoodsStatus myGoodsStatus = MpoBeanFactory.getBean(GoodsStatusDAO.class).getByCode(myGoodsStatusCode);
com.mpobjects.oms.model.entity.goodsstatus.GoodsStatus@15ef3299[GOOD,The products is available]
				if (myGoodsStatus == null) {
					throw new StockTransactionException("9999", "GoodsStatus code not found [" + myGoodsStatusCode + "]");
				}
				myStockTransaction.setGoodsStatus(myGoodsStatus);

			String myLocationCode = getNodeTextContent(selectSingleNode(aNode, LOCATION_TAG));
GEODIS_WHS_FR_SOCHAUX
			StockLocation myStockLocation = null;
			if (!StringUtils.isBlank(myLocationCode)) {
				StockLocationDAO myDAO = MpoBeanFactory.getBean(StockLocationDAO.class);
				myStockLocation = myDAO.getByCode(myLocationCode);
GEODIS_WHS_FR_SOCHAUX
				if (myStockLocation == null) {
/ NEE
					Party myParty = MpoBeanFactory.getBean(PartyDAO.class).getByCode(myLocationCode, myOrganization);
/ NIET
					if (myParty != null) {
						myStockLocation = myDAO.getByParty(myParty);
/ NIET

/ Als hij niet in de stock_location table staat	, dan blijkbaar in de party table	,
/ TODO
			myStockTransaction.setStockLocation(myStockLocation);

			myStockTransaction.setExternalId(getNodeTextContent(selectSingleNode(aNode, EXTERNAL_ID_TAG)));
1288-2016-06-08T05:16:01Z-1
			myStockTransaction.setTransactionType(StockTransactionType.COUNT);
			myStockTransaction.setDirty(true);
/ default is false
			return myStockTransaction;
/t
StockTransactionMsgProcessor.process(Node) line: 75	
				myStockTransaction = myProcessor.process(selectSingleNode(myNode, StockTransactionBodyProcessor.STOCK_TRANSACTION_TAG));
/d
				if (myPurposeCode.isOriginal()) {
/ NEE
					processAdd(myStockTransaction);
				} else if (myPurposeCode.isPartialUpdate() || myPurposeCode.isUpdate()) {
/ JA
					processUpdate(myStockTransaction);
				} else if (myPurposeCode.isDelete()) {
					processDelete(myStockTransaction);
				} else {
					throw new RuntimeException("Purpose code [" + myPurposeCode + "] is not supported");
				}

/ Intermezzo

/ Bij seo gebeurt dat in	
    GeoScoServiceOrderProcessor.process(Node) line: 262
/ NIET in	,
    ServiceOrderMsgProcessor.process(Node) line: 91


/ Einde Intermezzo

/s
StockTransactionMsgProcessor.processUpdate(StockTransaction) line: 165	
/=
	/**
	 * Processes a stock transaction which is provided for update (via the purpose code). If the stock transaction turns
	 * out not to exist yet, the stock transaction is treated as a new stock transaction Note: Hibernate can handle both
	 * add and update StockTransaction. No separate logic required
	 */
	public void processUpdate(StockTransaction aStockTransaction) throws Exception {
		processAdd(aStockTransaction);
/s
StockTransactionMsgProcessor.processAdd(StockTransaction) line: 112	
		StockTransaction myStockTransaction = getStockTransactionDAO().getByExternalId(aStockTransaction.getExternalId());
null
		if (myStockTransaction != null) {
/ NEE
			mySystemId = myStockTransaction.getSystemId();
/ NIET
			aStockTransaction.setSystemId(mySystemId);
/ NIET
			getStockTransactionDAO().merge(aStockTransaction);
/ NIET
		} else {
/ JA
			getStockTransactionDAO().save(aStockTransaction);
/t
StockTransactionMsgProcessor.process(Node) line: 78	
			for (Node myNode : selectNodeIterable(aNode, StockTransactionBodyProcessor.STOCK_TRANSACTION_GROUP_TAG)) {
				} else if (myPurposeCode.isPartialUpdate() || myPurposeCode.isUpdate()) {
					processUpdate(myStockTransaction);
/d
/ volgende,	
			for (Node myNode : selectNodeIterable(aNode, StockTransactionBodyProcessor.STOCK_TRANSACTION_GROUP_TAG)) {
				PurposeCodeVO myPurposeCode = new PurposeCodeProcessor(this).process(selectSingleNode(myNode, PROCESSING_DETAILS_TAG));
...
				myStockTransaction = myProcessor.process(selectSingleNode(myNode, StockTransactionBodyProcessor.STOCK_TRANSACTION_TAG));

				} else if (myPurposeCode.isPartialUpdate() || myPurposeCode.isUpdate()) {
					processUpdate(myStockTransaction);
/ save of merges stock tx	,
/ We zien alleen saves	, 
/ TODO



/ Einde GGS-67 DEBUG INVENTORY REPORT


/ GGS-67 RECALCULATE WHEN APPL STARTS

/' we kijken naar 	,
/ product 9820100780	,		/ als appl start	, wil hij recalculate dit product	,
/ product 9675627980	,

geosco2p=# select p.productid,sl.name,gs.code from inv_stock_keeping_unit sku join product p on sku.product_systemid=p.system_id join stock_location sl on sku.stock_location_systemid=sl.system_id join goods_status gs on sku.goods_status_systemid=gs.system_id  where sku.system_id=27274021;
 productid  |         name          | code 
------------+-----------------------+------
 9820100780 | GEODIS_WHS_FR_SOCHAUX | GOOD

geosco2p=# select count(st.*) from stock_transaction st join inv_stock_keeping_unit sku using (stock_location_systemid,goods_status_systemid,product_systemid) where sku.system_id=27274021;
 count 
-------
   158
(1 row)
geosco2p=# select distinct st.transaction_type from stock_transaction st join inv_stock_keeping_unit sku using (stock_location_systemid,goods_status_systemid,product_systemid) where sku.system_id=27274021;
 transaction_type 
------------------
 FORECAST_OUT
(1 row)
geosco2p=# select p.productid,count(st.*) from stock_transaction st join inv_stock_keeping_unit sku using (stock_location_systemid,goods_status_systemid,product_systemid) join product p on sku.product_systemid=p.system_id where sku.system_id=27274021 group by p.productid
;
 productid  | count 
------------+-------
 9820100780 |   158
(1 row)

/ we join alleen met product	,
geosco2p=# select distinct st.transaction_type,st.is_dirty from stock_transaction st join product p on st.product_systemid=p.system_id where p.productid='9820100780';
 transaction_type | is_dirty 
------------------+----------
 FORECAST_OUT     |        0
(1 row)

/ 7	. 

/ Eerder product 9675627980	,

geosco2p=# select count(*)from inv_stock_keeping_unit sku join product p on sku.product_systemid=p.system_id where p.productid='9675627980';
 count 
-------
     1
(1 row)
/ logisch	,

geosco2p=# select distinct st.transaction_type from stock_transaction st join product p on st.product_systemid=p.system_id where p.productid='9675627980'
;
 transaction_type 
------------------
 FORECAST_IN
 ORDER_IN
 COUNT
 FORECAST_OUT
(4 rows)
/ we join alleen op product, niet op sku	, 

/ 7	. 

/ product 9820100780	,	

geosco2p=# select distinct st.transaction_type from stock_transaction st join product p on st.product_systemid=p.system_id where p.productid='' and st.is_dirty != 0;
 transaction_type 
------------------
(0 rows)

/ Intermezzo

geosco2p=# select distinct st.transaction_type,st.is_dirty from stock_transaction st join product p on st.product_systemid=p.system_id where p.productid='9675627980' 
geosco2p-# ;
 transaction_type | is_dirty 
------------------+----------
 COUNT            |        1
 FORECAST_OUT     |        0
 COUNT            |        0
 ORDER_IN         |        0
 FORECAST_IN      |        0
(5 rows)
geosco2p=# select count(st.transaction_type) from stock_transaction st join product p on st.product_systemid=p.system_id where p.productid='9675627980' and st.is_dirty != 0;
 count 
-------
    46
(1 row)
/ Er zijn 46 COUNT st tx's die dirty zijn	, bij product 9675627980	, 

/ 7	. 

$ vi StockLevelCalculationServiceImpl.java

	@Override
	public void recalculateAll() {
		LOG.info("Firing requests to recalculate all SKUs ...");
		long myStart = System.currentTimeMillis();
		Collection<StockKeepingUnit> myList = stockKeepingUnitDAO.getAll();
		for (StockKeepingUnit mySku : myList) {
			StockLevelCalculationRequest myRequest = new StockLevelCalculationRequest(mySku);
			simpleMessageProducer.sendMessage(StockTransactionHandlerImpl.QUEUE, myRequest);
		}
/ Deze sets WH deze messages hieronder op de interne queue	,
StockTransactionHandlerImpl.QUEU


/ we zien hieronder dat we de volgende msgs krijgen	, 
/ dit zijn geen invp's	,

/ In de method die na onMessage komt	, processMessageAsRoot	, zien we dat het StockLevelCalculationRequest's zijn	,

message=
ActiveMQObjectMessage {commandId = 41728, responseRequired = false, messageId = ID:localhost.localdomain-34217-1465386863343-4:21:1:1:41519, originalDestination = null, originalTransactionId = null, producerId = ID:localhost.localdomain-34217-1465386863343-4:21:1:1, destination = queue://com.mpobjects.inventory.queue.stocktransaction, transactionId = TX:ID:localhost.localdomain-34217-1465386863343-4:21:103, expiration = 0, timestamp = 1465399131899, arrival = 0, brokerInTime = 1465399131939, brokerOutTime = 1465464432199, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activemq.util.ByteSequence@6e266499, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 1154, properties = null, readOnlyProperties = true, readOnlyBody = true, droppable = false, jmsXGroupFirstForConsumer = false}
/ product 9820100780	,	

/ message=
ActiveMQObjectMessage {commandId = 41729, responseRequired = false, messageId = ID:localhost.localdomain-34217-1465386863343-4:21:1:1:41520, originalDestination = null, originalTransactionId = null, producerId = ID:localhost.localdomain-34217-1465386863343-4:21:1:1, destination = queue://com.mpobjects.inventory.queue.stocktransaction, transactionId = TX:ID:localhost.localdomain-34217-1465386863343-4:21:103, expiration = 0, timestamp = 1465399131899, arrival = 0, brokerInTime = 1465399131939, brokerOutTime = 1465467410468, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activemq.util.ByteSequence@5e657dd8, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 1154, properties = null, readOnlyProperties = true, readOnlyBody = true, droppable = false, jmsXGroupFirstForConsumer = false}
/ product: 9686685480 (26878520)

/ message=
ActiveMQObjectMessage {commandId = 41730, responseRequired = false, messageId = ID:localhost.localdomain-34217-1465386863343-4:21:1:1:41521, originalDestination = null, originalTransactionId = null, producerId = ID:localhost.localdomain-34217-1465386863343-4:21:1:1, destination = queue://com.mpobjects.inventory.queue.stocktransaction, transactionId = TX:ID:localhost.localdomain-34217-1465386863343-4:21:103, expiration = 0, timestamp = 1465399131899, arrival = 0, brokerInTime = 1465399131939, brokerOutTime = 1465481171873, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activemq.util.ByteSequence@5ead08df, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 1154, properties = null, readOnlyProperties = true, readOnlyBody = true, droppable = false, jmsXGroupFirstForConsumer = false}
/ product: 7903233018 (26878504)

/ message=
ActiveMQObjectMessage {commandId = 41731, responseRequired = false, messageId = ID:localhost.localdomain-34217-1465386863343-4:21:1:1:41522, originalDestination = null, originalTransactionId = null, producerId = ID:localhost.localdomain-34217-1465386863343-4:21:1:1, destination = queue://com.mpobjects.inventory.queue.stocktransaction, transactionId = TX:ID:localhost.localdomain-34217-1465386863343-4:21:103, expiration = 0, timestamp = 1465399131899, arrival = 0, brokerInTime = 1465399131939, brokerOutTime = 1465481535054, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activemq.util.ByteSequence@399a2556, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 1154, properties = null, readOnlyProperties = true, readOnlyBody = true, droppable = false, jmsXGroupFirstForConsumer = false}
/ product: 9803779180 (26878523)

/ message=
ActiveMQObjectMessage {commandId = 41732, responseRequired = false, messageId = ID:localhost.localdomain-34217-1465386863343-4:21:1:1:41523, originalDestination = null, originalTransactionId = null, producerId = ID:localhost.localdomain-34217-1465386863343-4:21:1:1, destination = queue://com.mpobjects.inventory.queue.stocktransaction, transactionId = TX:ID:localhost.localdomain-34217-1465386863343-4:21:103, expiration = 0, timestamp = 1465399131899, arrival = 0, brokerInTime = 1465399131939, brokerOutTime = 1465481623981, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activemq.util.ByteSequence@6ac2900e, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 1154, properties = null, readOnlyProperties = true, readOnlyBody = true, droppable = false, jmsXGroupFirstForConsumer = false}
/ product=9817189980 (26878882)

/ message=
ActiveMQObjectMessage {commandId = 41733, responseRequired = false, messageId = ID:localhost.localdomain-34217-1465386863343-4:21:1:1:41524, originalDestination = null, originalTransactionId = null, producerId = ID:localhost.localdomain-34217-1465386863343-4:21:1:1, destination = queue://com.mpobjects.inventory.queue.stocktransaction, transactionId = TX:ID:localhost.localdomain-34217-1465386863343-4:21:103, expiration = 0, timestamp = 1465399131899, arrival = 0, brokerInTime = 1465399131939, brokerOutTime = 1465481679854, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activemq.util.ByteSequence@bc2eb28, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 1154, properties = null, readOnlyProperties = true, readOnlyBody = true, droppable = false, jmsXGroupFirstForConsumer = false}
/ product=
9817155980 (26878879)

/ 7	. 

/s
StockLevelCalculationServiceImpl.recalculateAll() line: 79	
		Collection<StockKeepingUnit> myList = stockKeepingUnitDAO.getAll();
/ aantal=407

/ klopt	,
geosco2p=# select count(*)from inv_stock_keeping_unit;
 count 
-------
   407
(1 row)

		for (StockKeepingUnit mySku : myList) {
			StockLevelCalculationRequest myRequest = new StockLevelCalculationRequest(mySku);
			simpleMessageProducer.sendMessage(StockTransactionHandlerImpl.QUEUE, myRequest);
		}

/ 7	. 

$ vi inventory-service.sb.xml

	<!-- scheduled task to periodically recalculate stock levels -->
	<bean id="recalcStockLevels" class="org.springframework.scheduling.quartz.SimpleTriggerBean">
		<property name="jobDetail">
			<bean class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean">
				<property name="targetObject" ref="com.mpobjects.inventory.service.stocktransaction.StockLevelCalculationService" />
				<property name="targetMethod" value="recalculateAll" />
				<property name="concurrent" value="false" />
			</bean>
		</property>
		<property name="startDelay" value="${module.inventory.recalculation.service.delay}" />
		<property name="repeatInterval" value="${module.inventory.recalculation.service.interval}" />
	</bean>

$ vi conf/application.properties
module.inventory.recalculation.service.delay   =15000
module.inventory.recalculation.service.interval=120000 

/ 120000 ms= 120 s 	, /60= 2 min	, klopt	,

/ delay=12h=12*60min=720min=43200sec=43200000ms.
$ vi application.properties
module.inventory.recalculation.service.delay=43200000		/ delay werkt NIET	,
module.inventory.recalculation.service.interval=43200000	/ OK

/ 7	. 



/ Einde GGS-67 RECALCULATE WHEN APPL STARTS

/ PSA QUEUES

/ 7	. 

/ MPOBJECTS.TO.GEOSCO

$ vi geosco.properties
module.interfacing.jms.geosco.queue=MPOBJECTS.TO.GEOSCO

$ vi geosco-integration.sb.xml

	<!-- The generic GeoSco queue for other messages -->
	<bean id="GeoScoQueueContainer" parent="messageListenerContainer">
		<property name="destination">
			<bean parent="jmsQueue">
				<constructor-arg index="0" value="${module.interfacing.jms.geosco.queue}" />					<-
			</bean>
		</property>
		<property name="messageListener" ref="JmsGenericDemuxMsgListener" />
	</bean>

$ vi interfacing-jms.sb.xml

	<!-- Default JMS message listener which accepts all kinds of messages (generic message listener) -->
	<bean id="JmsGenericDemuxMsgListener" parent="jmsMessageListener" lazy-init="true">
		<constructor-arg index="0" value="GenericQueue" />
		<constructor-arg index="1">
			<bean class="com.mpobjects.interfacing.messages.handler.MessageHandler">
				<constructor-arg index="0" ref="defaultExchangeHandlers" />
				<constructor-arg>
					<array>
						<ref bean="com.mpobjects.interfacing.messages.handler.DemuxExchangeHandler" />
					</array>
				</constructor-arg>
			</bean>
		</constructor-arg>
	</bean>

	<!-- Template for message listeners -->
	<bean id="jmsMessageListener" class="com.mpobjects.interfacing.jms.MpoMessageListener" abstract="true">				<-
		<property name="messageConverter" ref="com.mpobjects.interfacing.jms.JmsMessageConverter" />
		<property name="logHeaders" value="${module.interfacing.jms.listener.log.headers:true}" />
		<property name="logProperties" value="${module.interfacing.jms.listener.log.properties:false}" />
		<property name="logPayload" value="${module.interfacing.jms.listener.log.payload:false}" />
		<property name="monitoringService" ref="com.mpobjects.core.monitoring.MonitoringService" />
	</bean>

/ Klopt	, als we via JMS entry GUI een bericht geven op MPOBJECTS TO GEOSCO, dan vallen we in MpoMessageListener.onMessage

/ 7	. 

/ com.mpobjects.inventory.queue.stocktransaction

$ vi inventory-service.sb.xml

	<!-- Destination for ShipmentOrderConsolidationRequests -->
	<amq:queue id="com.mpobjects.inventory.queue.stocktransaction" physicalName="com.mpobjects.inventory.queue.stocktransaction" />

	<bean class="org.springframework.jms.listener.DefaultMessageListenerContainer" name="internaljms.com.mpobjects.inventory.service.stocktransaction.StockTransactionHandler">
		<property name="concurrentConsumers" value="${module.inventory.stocktransaction.concurrentConsumers}" />
		<property name="connectionFactory" ref="jmsEmbeddedBrokerConnectionFactory" />
		<property name="destination" ref="com.mpobjects.inventory.queue.stocktransaction" />
		<property name="messageListener" ref="com.mpobjects.inventory.service.stocktransaction.StockTransactionHandler" />
		<property name="maxConcurrentConsumers" value="${module.inventory.stocktransaction.maxConcurrentConsumers}" />
	</bean>


	<bean id="com.mpobjects.inventory.service.stocktransaction.StockTransactionHandler" parent="transactionRequiredTemplate">
		<property name="target">
			<bean class="com.mpobjects.inventory.service.stocktransaction.StockTransactionHandlerImpl">
				<property name="runAsService" ref="com.mpobjects.auth.service.RunAsService" />
				<property name="stockTransactionEventListener" ref="com.mpobjects.inventory.service.stocktransaction.StockTransactionEventListener" />
				<property name="stockLevelCalculationService" ref="StockLevelCalculationService" />
			</bean>
		</property>
	</bean>

/ Klopt	, StockLevelCalculationServiceImpl.recalculateAll puts StockLevelCalculationRequest(mySku)	op com.mpobjects.inventory.queue.stocktransaction	, voor elke sku	,

/ 7.	 

/ 13	. 

AbstractConsumer
	public void onMessage(Message aMessage) {
			processMessageAsRoot(aMessage);
/s
StockTransactionHandler
	protected void processMessageAsRoot(Message aMessage) throws Exception {
		ObjectMessage myMessage = (ObjectMessage) aMessage;
		Serializable serializable = myMessage.getObject();
		} else if (serializable instanceof StockLevelCalculationRequest) {
			StockLevelCalculationRequest myRequest = (StockLevelCalculationRequest) serializable;
			LOG.debug("Processing: " + myRequest);
			stockLevelCalculationService.handleRequest(myRequest);

/ 13	. 

MpoMessageListener
	public void onMessage(Message aMessage) {
				processMessage(aMessage, mpoMsg);
/s
	protected void processMessage(@Nonnull Message aMessage, @Nonnull JmsMpoMessage aMpoMessage) {
			MessageExchange exchange = new DefaultMessageExchange(aMpoMessage);
			messageHandler.handleExchange(exchange);

/ Waarom het verschil tussen deze 2 messages	?
/ TODO
/ we kunnen hier NIET eens	, 
        ObjectMessage myMessage = (ObjectMessage) aMessage;
/ TODO



/ Einde PSA QUEUES

/ GGS-67 DEBUG INTERNAL STOCK MESSAGE QUEUE 

/ op prod	, 14 jun	,

/ 7	. 

/ product 	,
98184060FU 	

LOG_EMEA_FR_CT_PSA	98184060FU - MONOGRAMMES VERSION GT	GOOD	GEODIS_WHS_FR_SOCHAUX	FORECAST_IN	0.00	96.00	23-Jun-2016 23:59:00
LOG_EMEA_FR_CT_PSA	98184060FU - MONOGRAMMES VERSION GT	GOOD	GEODIS_WHS_FR_SOCHAUX	FORECAST_OUT	-2.00	54.00	22-Jun-2016 23:59

/ 7	. 

/ product	,
9806313580

LOG_EMEA_FR_CT_PSA	9806313580 - Motoventilateur ( GMV ) cl1	GOOD	GEODIS_WHS_FR_SOCHAUX	FORECAST_IN	864.00	18857.00	22-Jun-2016 23:59:00	/ ERR
LOG_EMEA_FR_CT_PSA	9806313580 - Motoventilateur ( GMV ) cl1	GOOD	GEODIS_WHS_FR_SOCHAUX	ORDER_IN	912.00	18735.00	21-Jun-2016 23:59:00
LOG_EMEA_FR_CT_PSA	9806313580 - Motoventilateur ( GMV ) cl1	GOOD	GEODIS_WHS_FR_SOCHAUX	FORECAST_OUT	-1034.00	17823.00	21-Jun-2016 23:59:00
LOG_EMEA_FR_CT_PSA	9806313580 - Motoventilateur ( GMV ) cl1	GOOD	GEODIS_WHS_FR_SOCHAUX	FORECAST_IN	912.00	18857.00	21-Jun-2016 23:59:00	/ OK
LOG_EMEA_FR_CT_PSA	9806313580 - Motoventilateur ( GMV ) cl1	GOOD	GEODIS_WHS_FR_SOCHAUX	FORECAST_OUT	0.00	18857.00	20-Jun-2016 23:59:00
LOG_EMEA_FR_CT_PSA	9806313580 - Motoventilateur ( GMV ) cl1	GOOD	GEODIS_WHS_FR_SOCHAUX	FORECAST_IN	0.00	18857.00	20-Jun-2016 23:59:00
LOG_EMEA_FR_CT_PSA	9806313580 - Motoventilateur ( GMV ) cl1	GOOD	GEODIS_WHS_FR_SOCHAUX	FORECAST_OUT	-1001.00	18857.00	17-Jun-2016 23:59:00
LOG_EMEA_FR_CT_PSA	9806313580 - Motoventilateur ( GMV ) cl1	GOOD	GEODIS_WHS_FR_SOCHAUX	ORDER_IN	1032.00	19858.00	17-Jun-2016 23:59:00
LOG_EMEA_FR_CT_PSA	9806313580 - Motoventilateur ( GMV ) cl1	GOOD	GEODIS_WHS_FR_SOCHAUX	FORECAST_IN	1032.00	18826.00	17-Jun-2016 23:59:00	/ OK
LOG_EMEA_FR_CT_PSA	9806313580 - Motoventilateur ( GMV ) cl1	GOOD	GEODIS_WHS_FR_SOCHAUX	FORECAST_OUT	-1467.00	18826.00	16-Jun-2016 23:59:00
LOG_EMEA_FR_CT_PSA	9806313580 - Motoventilateur ( GMV ) cl1	GOOD	GEODIS_WHS_FR_SOCHAUX	ORDER_IN	1296.00	20293.00	16-Jun-2016 23:59:00


/ 7	. 

/ we halen de prod db over	,
[eric@localhost bin]$ geosco-pg_dump-p.sh 
geosco2p=# create database geosco2p2;
[eric@localhost bin]$ local-pg_restore.sh geosco2p2   $(awk 'NR==1' <(ls -1t $(find /home/eric/DB_TAP/Postgres/Backup/  -type f)))
/ OK


/ 7	. 

/ we hebben cond b set	, 
aSku.getProduct().getCode().equals("9806313580")
/s
StockLevelCalculationServiceImpl.recalculate(StockKeepingUnit) line: 70	
		recalculate(aSku.getProduct(), aSku.getStockLocation(), aSku.getGoodsStatus());
/s
StockLevelCalculationServiceImpl.recalculate(Product, StockLocation, GoodsStatus) line: 131	

			StockTransaction myTransaction = stockTransactionDAO.getFirstDirty(aProduct, aLocation, aStatus);
null
			if (myTransaction == null) {
				break;

/ Intermezzo

/ we zien	,

select ...
from STOCK_TRANSACTION this_ 
left outer join TMS_PRODUCT_ITEM productite2_ on this_.PRODUCT_ITEM_SYSTEMID=productite2_.SYSTEM_ID 
left outer join TMS_PRODUCT_ITEM productite3_ on productite2_.PARENT_SYSTEMID=productite3_.SYSTEM_ID 
inner join ORGANIZATION organizati4_ on this_.ORGANIZATION_SYSTEMID=organizati4_.SYSTEM_ID 
left outer join ORGANIZATION organizati5_ on organizati4_.ORGANIZATION_GROUP=organizati5_.SYSTEM_ID 
where this_.PRODUCT_SYSTEMID=26878527
and this_.STOCK_LOCATION_SYSTEMID=26878346
and this_.GOODS_STATUS_SYSTEMID=26877284
and this_.IS_DIRTY=true
order by this_.TRANSACTION_DATE asc, this_.SYSTEM_ID asc 

/ we doen	,

select this_.* 
from STOCK_TRANSACTION this_ 
where this_.PRODUCT_SYSTEMID=26878527
and this_.STOCK_LOCATION_SYSTEMID=26878346	
and this_.GOODS_STATUS_SYSTEMID=26877284
and this_.IS_DIRTY=true
order by this_.TRANSACTION_DATE asc, this_.SYSTEM_ID asc 


/ EInde Intermezzo

/ we kunnen op de machine zelf	,
PGPASSWORD=de2d45045b493b021bbfa90e4f3848a9 psql -U geosco -h  localhost geosco 

/ 7	 

SH000003043 22-jun

/ Intermezzo

/ Stock Transactions scherm	,

/ we doen	,

select st.* 
from stock_transaction st
join product p on st.product_systemid=p.system_id
where p.productid='9806313580'
and st.transaction_date>='22jun2016'
and st.transaction_date<='30jun2016'
order by st.transaction_date desc
;


/ we zien in server log	,

select stocktrans0_.*
from STOCK_TRANSACTION stocktrans0_ 
left outer join GOODS_STATUS goodsstatu1_ on stocktrans0_.GOODS_STATUS_SYSTEMID=goodsstatu1_.
SYSTEM_ID, 
ORGANIZATION organizati2_, 
product product3_, 
STOCK_LOCATION stocklocat5_ 
where stocktrans0_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID 
and stocktrans0_.PRODUCT_SYSTEMID=product3_.SYSTEM_ID 
and stocktrans0_.STOCK_LOCATION_SYSTEMID=stocklocat5_.SYSTEM_ID 
and (stocktrans0_.ORGANIZATION_SYSTEMID in (
	select userorgani6_.ORGANIZATION_SYSTEMID 
	from USER_ORGANIZATION userorgani6_, 
	ORGANIZATION organizati7_ 
	where userorgani6_.ORGANIZATION_SYSTEMID=organizati7_.SYSTEM_ID 
	and userorgani6_.USER_SYSTEMID=27382388)) 
and (lower((product3_.PRODUCTID||' - '||product3_.DESCRIPTION)) like lower('%9806313580%')) 
and stocktrans0_.TRANSACTION_DATE>='Wed Jun 22 00:00:00 CEST 2016' 
and stocktrans0_.TRANSACTION_DATE<='Thu Jun 30 00:00:00 CEST 2016' 
and (lower(organizati2_.ORGANIZATION_ID) like lower('%9806313580%') or lower((product3_.PRODUCTID||' - '||product3_.DESCRIPTION)) like lower('%9806313580%') or lower(goodsstatu1_.CODE) like lower('%9806313580%') or lower(stocklocat5_.NAME) like lower('%9806313580%') or lower(stocktrans0_.TRANSACTION_TYPE) like lower('%9806313580%')) 
order by stocktrans0_.TRANSACTION_DATE desc, stocktrans0_.SYSTEM_ID desc 


/ Einde Intermezzo

/ 7	. 

/ Intermezzo

geosco2p2-# and p.productid='9806313580'
geosco2p2-# ;
 productid  | code |         name          | system_id |  transaction_date   | transaction_type | ignore_on_balance | calc_
stock_level |  transaction_date   | transaction_type | calc_stock_level 
------------+------+-----------------------+-----------+---------------------+------------------+-------------------+------
------------+---------------------+------------------+------------------
 9806313580 | GOOD | GEODIS_WHS_FR_SOCHAUX |  27388805 | 2016-06-22 23:59:00 | FORECAST_IN      |                 1 |      
18857.00000 | 2016-06-21 23:59:00 | ORDER_IN         |      18735.00000
 9806313580 | GOOD | GEODIS_WHS_FR_SOCHAUX |  27396796 | 2016-06-23 23:59:00 | FORECAST_IN      |                 1 |      
18857.00000 | 2016-06-22 23:59:00 | ORDER_IN         |      18724.00000
(2 rows)

/ we nemen de oudste	,

geosco2p2=# update stock_transaction set is_dirty=1 where system_id=27388805;
UPDATE 1
geosco2p2=# commit;
COMMIT

/ Einde Intermezzo

/s
StockLevelCalculationServiceImpl.recalculate(Product, StockLocation, GoodsStatus) line: 130	
		while (true) {
			StockTransaction myTransaction = stockTransactionDAO.getFirstDirty(aProduct, aLocation, aStatus);
27388805/FORECAST_IN/2016-06-22 23:59:00.0/9806313580 (26878527)/GEODIS_WHS_FR_SOCHAUX/864.00000/18857.00000/true
/ Klopt	,
			} else {
				if (recalculate(myTransaction)) {
/s
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 146	
		aTransaction.setDirty(false);
		} else {
			StockTransaction myPrevious = stockTransactionDAO.getPrevious(aTransaction);
27404652/ORDER_IN/2016-06-21 23:59:00.0/9806313580 (26878527)/GEODIS_WHS_FR_SOCHAUX/912.00000/18735.00000/false
/ Klopt	,
			if (myPrevious != null) {
				myLastKnownBalance = myPrevious.getCalculatedStockLevel();
18735.00000
			myLevelChange = recalculateStockLevel(aTransaction, myLastKnownBalance);
aTransaction=FORECAST_IN
/s
StockLevelCalculationServiceImpl.recalculateStockLevel(StockTransaction, BigDecimal) line: 112	
		if (aTransaction.isIgnoreOnBalance()) {
/ JA
			myNewBalance = aLastKnownBalance;

		if (aTransaction.getCalculatedStockLevel() == null || myNewBalance.compareTo(aTransaction.getCalculatedStockLevel()) != 0) {
/ JA
			aTransaction.setCalculatedStockLevel(myNewBalance);
			return true;
/t
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 161	
			myLevelChange = recalculateStockLevel(aTransaction, myLastKnownBalance);
/d
true
			myLastKnownBalance = aTransaction.getCalculatedStockLevel();
18735.00000
		stockTransactionDAO.save(aTransaction);

		// Now recalculate all records until we meet the next count or until done all
		StockTransaction myCurrent = aTransaction;
		main: while (true) {
			List<StockTransaction> myNextList = stockTransactionDAO.getFollowingTransactions(myCurrent, 50);
/ list van 50 sttx's	,

			for (StockTransaction myNext : myNextList) {
				if (myNext.getTransactionType().equals(StockTransactionType.COUNT)) {
27402956/FORECAST_OUT/2016-06-22 23:59:00.0/9806313580 (26878527)/GEODIS_WHS_FR_SOCHAUX/-997.00000/17860.00000/false
/ Klopt	, dat is de 1ste boven onze FORECAST_IN 	,
17860.00000 is dus NIET OK MEER	,

				myCurrent = myNext;
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/s
myCurrent=nieuwe sttx	, FORECAST_OUT
myLastKnownBalance=18735.00000
/s
StockLevelCalculationServiceImpl.recalculateStockLevel(StockTransaction, BigDecimal) line: 115	
		if (aTransaction.isIgnoreOnBalance()) {
		} else {
/ JA
			myNewBalance = aLastKnownBalance.add(aTransaction.getQuantity());
17738.00000
		if (aTransaction.getCalculatedStockLevel() == null || myNewBalance.compareTo(aTransaction.getCalculatedStockLevel()) != 0) {
			aTransaction.setCalculatedStockLevel(myNewBalance);
			return true;
/t
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 178	
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/d
					myCurrent.setDirty(false);
					stockTransactionDAO.save(myCurrent);
					myLevelChange = true;
				}
				myLastKnownBalance = myCurrent.getCalculatedStockLevel();
17738.00000

/ volgende	,
			for (StockTransaction myNext : myNextList) {
27406484/ORDER_IN/2016-06-22 23:59:00.0/9806313580 (26878527)/GEODIS_WHS_FR_SOCHAUX/864.00000/18724.00000/false
/ Klopt	,
				myCurrent = myNext;
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/s
StockLevelCalculationServiceImpl.recalculateStockLevel(StockTransaction, BigDecimal) line: 115	
		} else {
			myNewBalance = aLastKnownBalance.add(aTransaction.getQuantity());
18602.00000
		if (aTransaction.getCalculatedStockLevel() == null || myNewBalance.compareTo(aTransaction.getCalculatedStockLevel()) != 0) {
			aTransaction.setCalculatedStockLevel(myNewBalance);
			return true;
/t
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 177	
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
					myCurrent.setDirty(false);
					stockTransactionDAO.save(myCurrent);
					myLevelChange = true;
				}
				myLastKnownBalance = myCurrent.getCalculatedStockLevel();
18602.00000

/ volgende	,
			for (StockTransaction myNext : myNextList) {
27396796/FORECAST_IN/2016-06-23 23:59:00.0/9806313580 (26878527)/GEODIS_WHS_FR_SOCHAUX/912.00000/18857.00000/false

				myCurrent = myNext;
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/s
StockLevelCalculationServiceImpl.recalculateStockLevel(StockTransaction, BigDecimal) line: 112	
		if (aTransaction.isIgnoreOnBalance()) {
			myNewBalance = aLastKnownBalance;
18602.00000
		if (aTransaction.getCalculatedStockLevel() == null || myNewBalance.compareTo(aTransaction.getCalculatedStockLevel()) != 0) {
/ JA
/ de FORECAST_IN had foute calc	,
			aTransaction.setCalculatedStockLevel(myNewBalance);
			return true;
/t
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 178	
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
					myCurrent.setDirty(false);
					stockTransactionDAO.save(myCurrent);
					myLevelChange = true;
				}
				myLastKnownBalance = myCurrent.getCalculatedStockLevel();
18602.00000

/ volgende	,
			for (StockTransaction myNext : myNextList) {
27403094/FORECAST_OUT/2016-06-23 23:59:00.0/9806313580 (26878527)/GEODIS_WHS_FR_SOCHAUX/-1036.00000/17821.00000/false
/ klopt	,
				myCurrent = myNext;
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
					stockTransactionDAO.save(myCurrent);
					myLevelChange = true;
				}
				myLastKnownBalance = myCurrent.getCalculatedStockLevel();
17566.00000

/ volgende,	
27406689/ORDER_IN/2016-06-23 23:59:00.0/9806313580 (26878527)/GEODIS_WHS_FR_SOCHAUX/912.00000/18733.00000/false

				myLastKnownBalance = myCurrent.getCalculatedStockLevel();
18478.00000

/ volgende	,
			for (StockTransaction myNext : myNextList) {
27388806/FORECAST_IN/2016-06-24 23:59:00.0/9806313580 (26878527)/GEODIS_WHS_FR_SOCHAUX/912.00000/19645.00000/false

/ Deze FORECAST_IN is NIET ignore_on_balance

				myCurrent = myNext;
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/s
StockLevelCalculationServiceImpl.recalculateStockLevel(StockTransaction, BigDecimal) line: 112	
		if (aTransaction.isIgnoreOnBalance()) {
		} else {
/ JA
			myNewBalance = aLastKnownBalance.add(aTransaction.getQuantity());
19390.00000
		if (aTransaction.getCalculatedStockLevel() == null || myNewBalance.compareTo(aTransaction.getCalculatedStockLevel()) != 0) {
/ JA
			aTransaction.setCalculatedStockLevel(myNewBalance);
			return true;
/t
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 178	
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/d
					myCurrent.setDirty(false);
					stockTransactionDAO.save(myCurrent);
					myLevelChange = true;
				}
				myLastKnownBalance = myCurrent.getCalculatedStockLevel();
19390.00000


/ 7	. 

/ we zien in geosco2p2 dat er 7 sttx overblijven	, die dirty blijven	,

 productid  | code |         name          |  transaction_date   | transaction_type | ignore_on_balance | calc_stock_level 
|  transaction_date   | transaction_type | calc_stock_level 
------------+------+-----------------------+---------------------+------------------+-------------------+------------------
+---------------------+------------------+------------------
 9675747980 | GOOD | GEODIS_WHS_FR_SOCHAUX | 2016-06-23 23:59:00 | FORECAST_IN      |                 1 |        824.00000 
| 2016-06-22 23:59:00 | ORDER_IN         |        564.00000
 98103236ZD | GOOD | GEODIS_WHS_FR_SOCHAUX | 2016-06-28 23:59:00 | FORECAST_IN      |                 1 |         81.00000 
| 2016-06-28 23:59:00 | FORECAST_OUT     |         48.00000
 9676426180 | GOOD | GEODIS_WHS_FR_SOCHAUX | 2016-05-31 23:59:00 | FORECAST_IN      |                 1 |        205.00000 
| 2016-05-29 00:00:00 | FORECAST_OUT     |        133.00000
 9676426180 | GOOD | GEODIS_WHS_FR_SOCHAUX | 2016-05-24 23:59:00 | FORECAST_IN      |                 1 |        133.00000 
| 2016-05-22 00:00:00 | FORECAST_OUT     |         85.00000
 9676426180 | GOOD | GEODIS_WHS_FR_SOCHAUX | 2016-06-14 23:59:00 | FORECAST_IN      |                 1 |        373.00000 
| 2016-06-07 23:59:00 | FORECAST_IN      |        301.00000
 9676426180 | GOOD | GEODIS_WHS_FR_SOCHAUX | 2016-06-07 23:59:00 | FORECAST_IN      |                 1 |        301.00000 
| 2016-05-31 23:59:00 | FORECAST_IN      |        205.00000
 9676426180 | GOOD | GEODIS_WHS_FR_SOCHAUX | 2016-04-19 23:59:00 | FORECAST_IN      |                 1 |         63.00000 
| 2016-04-17 00:00:00 | FORECAST_OUT     |         39.00000
 9676426180 | GOOD | GEODIS_WHS_FR_SOCHAUX | 2016-05-03 23:59:00 | FORECAST_IN      |                 1 |         85.00000 
| 2016-05-01 00:00:00 | FORECAST_OUT     |         61.00000
 9814061280 | GOOD | GEODIS_WHS_FR_SOCHAUX | 2016-03-01 23:59:00 | FORECAST_IN      |                 1 |          4.00000 
| 2016-03-01 00:00:00 | FORECAST_OUT     |         20.00000
(9 rows)

/ TODO

/ OK	,
/ 9806313580
/ ERR
/ 9676426180   
aSku.getProduct().getProductId().equals("9676426180")   
aSku.getProduct().getProductId().equals("9806313580")








/ Einde GGS-67 DEBUG INTERNAL STOCK MESSAGE QUEUE 



/ GGS-67 FORECAST_IN QUERY

/ Geef alle results	,

select p.productid,gs.code,sl.name,tgt.transaction_date,tgt.transaction_type,tgt.ignore_on_balance,tgt.calc_stock_level,prv.transaction_date,prv.transaction_type,prv.calc_stock_level
from stock_transaction tgt 
join stock_transaction prv 
    on prv.product_systemid=tgt.product_systemid
    and prv.goods_status_systemid=tgt.goods_status_systemid
    and prv.stock_location_systemid=tgt.stock_location_systemid
    and (prv.transaction_date<tgt.transaction_date or prv.transaction_date=tgt.transaction_date and prv.system_id<tgt.system_id)
left outer join stock_transaction chk
    on chk.product_systemid=prv.product_systemid
    and chk.goods_status_systemid=prv.goods_status_systemid
    and chk.stock_location_systemid=prv.stock_location_systemid
    and (chk.transaction_date<tgt.transaction_date or chk.transaction_date=tgt.transaction_date and chk.system_id<tgt.system_id)
    and (chk.transaction_date>prv.transaction_date or chk.transaction_date=prv.transaction_date and chk.system_id>prv.system_id)
join(select distinct product_systemid,goods_status_systemid,stock_location_systemid from stock_transaction) sku
    on sku.product_systemid=tgt.product_systemid
    and sku.goods_status_systemid=tgt.goods_status_systemid
    and sku.stock_location_systemid=tgt.stock_location_systemid
join product p on tgt.product_systemid=p.system_id
join goods_status gs on tgt.goods_status_systemid=gs.system_id
join stock_location sl on tgt.stock_location_systemid=sl.system_id
where tgt.transaction_type='FORECAST_IN'
and tgt.ignore_on_balance=true
and prv.calc_stock_level!=tgt.calc_stock_level
and chk.transaction_date is null

/ Om te oefenen,

select p.productid,gs.code,sl.name,tgt.system_id,tgt.transaction_date,tgt.transaction_type,tgt.ignore_on_balance,tgt.calc_stock_level,prv.transaction_date,prv.transaction_type,prv.calc_stock_level
from stock_transaction tgt 
join stock_transaction prv 
    on prv.product_systemid=tgt.product_systemid
    and prv.goods_status_systemid=tgt.goods_status_systemid
    and prv.stock_location_systemid=tgt.stock_location_systemid
    and (prv.transaction_date<tgt.transaction_date or prv.transaction_date=tgt.transaction_date and prv.system_id<tgt.system_id)
left outer join stock_transaction chk
    on chk.product_systemid=prv.product_systemid
    and chk.goods_status_systemid=prv.goods_status_systemid
    and chk.stock_location_systemid=prv.stock_location_systemid
    and (chk.transaction_date<tgt.transaction_date or chk.transaction_date=tgt.transaction_date and chk.system_id<tgt.system_id)
    and (chk.transaction_date>prv.transaction_date or chk.transaction_date=prv.transaction_date and chk.system_id>prv.system_id)
join(select distinct product_systemid,goods_status_systemid,stock_location_systemid from stock_transaction) sku
    on sku.product_systemid=tgt.product_systemid
    and sku.goods_status_systemid=tgt.goods_status_systemid
    and sku.stock_location_systemid=tgt.stock_location_systemid
join product p on tgt.product_systemid=p.system_id
join goods_status gs on tgt.goods_status_systemid=gs.system_id
join stock_location sl on tgt.stock_location_systemid=sl.system_id
where tgt.transaction_type='FORECAST_IN'
and tgt.ignore_on_balance=true
and prv.calc_stock_level!=tgt.calc_stock_level
and chk.transaction_date is null
and p.productid='9806313580'						-- test, not part of query	,

/ Einde GGS-67 FORCAST_IN QUERY

/ GSS-67 DEBUG INTERNAL STOCK MESSAGE QUEUE 

/ 7	. 

/ een sttx uit invp wordt dirty set	,

        <mtc:STOCK_TRANSACTION>
            <mtc:QUANTITY>3</mtc:QUANTITY>
            <mtc:ABSOLUTE/>
            <mtc:SERIAL_NUMBER/>
            <mtc:LOT_ID/>
            <mtc:TRANSACTION_DATE>2016-06-08T05:15:40Z</mtc:TRANSACTION_DATE>			<- transaction date	,
            <mtc:PRODUCT_ID>Z000495429</mtc:PRODUCT_ID>									<- product	, 
            <mtc:GOODS_STATUS>GOOD</mtc:GOODS_STATUS>
            <mtc:LOCATION>GEODIS_WHS_FR_SOCHAUX</mtc:LOCATION>
            <mtc:EXTERNAL_ID>1288-2016-06-08T05:16:01Z-1</mtc:EXTERNAL_ID>
            <mtc:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtc:ORGANIZATION_ID>
         </mtc:STOCK_TRANSACTION>
      </mtc:STOCK_TRANSACTION_GROUP>

/s
StockTransactionBodyProcessor.process(Node) line: 132	

			String dateString = getNodeTextContent(selectSingleNode(aNode, TRANSACTION_DATE_TAG));
			myStockTransaction.setTransactionDate(DateUtils.javaDateCustomFormatToDate("yyyy-MM-dd'T'HH:mm:ss", dateString));
			myStockTransaction.setDirty(true);

/ 7	. 

/ We zien  in invp van 8 Jun	, het product 9675627980	,

         <mtc:STOCK_TRANSACTION>
            <mtc:QUANTITY>182</mtc:QUANTITY>
            <mtc:ABSOLUTE/>
            <mtc:SERIAL_NUMBER/>
            <mtc:LOT_ID/>
            <mtc:TRANSACTION_DATE>2016-06-08T05:15:40Z</mtc:TRANSACTION_DATE>
            <mtc:PRODUCT_ID>9675627980</mtc:PRODUCT_ID>
            <mtc:GOODS_STATUS>BAD</mtc:GOODS_STATUS>
            <mtc:LOCATION>GEODIS_WHS_FR_SOCHAUX</mtc:LOCATION>
            <mtc:EXTERNAL_ID>1288-2016-06-08T05:16:01Z-26</mtc:EXTERNAL_ID>
            <mtc:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtc:ORGANIZATION_ID>
         </mtc:STOCK_TRANSACTION>

/ 7	.

/ Later	,

/ we set conditional b 
aSku.getProduct().getCode().equals("9675627980")
/ op	,
	@Override
	public void recalculate(StockKeepingUnit aSku) {
		LOG.info("Starting recalculation of stock levels for SKU [" + aSku + "] ...");
		recalculate(aSku.getProduct(), aSku.getStockLocation(), aSku.getGoodsStatus());
	}

/ want	, 
$ vi Product.standard.hbm.xml
	<class name="com.mpobjects.oms.model.entity.Product" table="product">
		<property name="code" type="string">
			<column name="PRODUCTID" />
		</property>

/ als we een invp inlezen	, zijn alle COUNT sttxs dirty	, andere sttx kunnen ook dirty zijn	, bijv als we een quantity op een shi edit & save	, TODO	, maar  nu zijn het de COUNTs	,

/ 7	. 

/ we set b in	,

StockLevelCalculationServiceImpl.recalculate(StockKeepingUnit) line: 70	
->		recalculate(aSku.getProduct(), aSku.getStockLocation(), aSku.getGoodsStatus());			/ rm	, 
/s
StockLevelCalculationServiceImpl.recalculate(Product, StockLocation, GoodsStatus) line: 134	
		while (true) {
			StockTransaction myTransaction = stockTransactionDAO.getFirstDirty(aProduct, aLocation, aStatus);
			if (myTransaction == null) {
				break;
			} else {
->				if (recalculate(myTransaction)) {


/////////////////////////////////////////////////////////
/ 7	. 

/ product 9815434180 (26878587)

StockLevelCalculationServiceImpl.recalculate(StockKeepingUnit) line: 70	
		recalculate(aSku.getProduct(), aSku.getStockLocation(), aSku.getGoodsStatus());
/s
StockLevelCalculationServiceImpl.recalculate(Product, StockLocation, GoodsStatus) line: 134	
			StockTransaction myTransaction = stockTransactionDAO.getFirstDirty(aProduct, aLocation, aStatus);

aProduct=9815434180 (26878587)
myTransaction=27350828/FORECAST_IN/2016-06-21 23:59:00.0/9815434180 (26878587)/GEODIS_WHS_FR_SOCHAUX/1120.00000/5727.00000/true

/ we zien	,
geosco2p=# select*from stock_transaction where system_id=27350828;
 system_id |  quantity  | serial_number | lot_id |  transaction_date   | product_systemid | goods_status_systemid | stock_location_systemid | product_item_systemid | external_id | organization_systemid | calc_stock_level | is_dirty | transaction_type | customer_order_line_systemid | shipment_item_systemid | ignore_on_balance 
-----------+------------+---------------+--------+---------------------+------------------+-----------------------+------- ------------------+-----------------------+-------------+-----------------------+------------------+----------+----------- -------+------------------------------+------------------------+-------------------
  27350828 | 1120.00000 | NULL          | NULL   | 2016-06-21 23:59:00 |         26878587 |              26877284 |       26878346 |                  NULL | NULL        |                 12000 |       5727.00000 |        1 | FORECAST_IN      |                     27452053 |                   NULL |                 1
(1 row)

/ Dirty sttx van 21 Jun	, In de toekomst	,

				if (recalculate(myTransaction)) {
/s
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 146	
		aTransaction.setDirty(false);
		if (aTransaction.getTransactionType().equals(StockTransactionType.COUNT)) {
/ NEE
		} else {
			StockTransaction myPrevious = stockTransactionDAO.getPrevious(aTransaction);
27169745/FORECAST_OUT/2016-06-05 00:00:00.0/9815434180 (26878587)/GEODIS_WHS_FR_SOCHAUX/0.00000/3985.00000/false
/ Klopt	,

/ Intermezzo

/ PREVIOUS QUERY
select this_.*
from STOCK_TRANSACTION this_ 
left outer join TMS_PRODUCT_ITEM productite2_ on this_.PRODUCT_ITEM_SYSTEMID=productite2_.SYSTEM_ID 
left outer join TMS_PRODUCT_ITEM productite3_ on productite2_.PARENT_SYSTEMID=productite3_.SYSTEM_ID 
inner join ORGANIZATION organizati4_ on this_.ORGANIZATION_SYSTEMID=organizati4_.SYSTEM_ID 
left outer join ORGANIZATION organizati5_ on organizati4_.ORGANIZATION_GROUP=organizati5_.SYSTEM_ID 
where this_.PRODUCT_SYSTEMID=26878587
and this_.STOCK_LOCATION_SYSTEMID=26878346
and this_.GOODS_STATUS_SYSTEMID=26877284
and this_.TRANSACTION_DATE<='2016-06-21 23:59:00.00'
and this_.SYSTEM_ID<27350828										-- sttx
order by this_.TRANSACTION_DATE desc, this_.SYSTEM_ID desc limit 1; 

 system_id | quantity | serial_number | lot_id |  transaction_date   | product_systemid | goods_status_systemid | stock_lo
cation_systemid | product_item_systemid | external_id | organization_systemid | calc_stock_level | is_dirty | transaction_
type | customer_order_line_systemid | shipment_item_systemid | ignore_on_balance 
-----------+----------+---------------+--------+---------------------+------------------+-----------------------+---------
----------------+-----------------------+-------------+-----------------------+------------------+----------+-------------
-----+------------------------------+------------------------+-------------------
  27169745 |  0.00000 | NULL          | NULL   | 2016-06-05 00:00:00 |         26878587 |              26877284 |         
       26878346 |                  NULL | NULL        |                 12000 |       3985.00000 |        0 | FORECAST_OUT
     |                     27282838 |                   NULL |                 0
(1 row)

/ we doen deze	, en dit is ook OK	,
/ TODO (Waarom al die regels hierboven in de query, over product_item en organization	?)

select this_.*
from STOCK_TRANSACTION this_ 
where this_.PRODUCT_SYSTEMID=26878587
and this_.STOCK_LOCATION_SYSTEMID=26878346
and this_.GOODS_STATUS_SYSTEMID=26877284
and this_.TRANSACTION_DATE<='2016-06-21 23:59:00.00'
and this_.SYSTEM_ID<27350828
order by this_.TRANSACTION_DATE desc, this_.SYSTEM_ID desc limit 1;

/ we join 	,
select this_.transaction_type, this_.transaction_date,sl.name,gs.code,this_.quantity,this_.calc_stock_level
from STOCK_TRANSACTION this_ 
join stock_location sl on this_.stock_location_systemid=sl.system_id
join goods_status gs on this_.goods_status_systemid=gs.system_id
where this_.PRODUCT_SYSTEMID=26878587
and this_.STOCK_LOCATION_SYSTEMID=26878346
and this_.GOODS_STATUS_SYSTEMID=26877284
and this_.TRANSACTION_DATE<='2016-06-21 23:59:00.00'
and this_.SYSTEM_ID<27350828
order by this_.TRANSACTION_DATE desc, this_.SYSTEM_ID desc limit 1;
geosco2p-# order by this_.TRANSACTION_DATE desc, this_.SYSTEM_ID desc limit 1;
 transaction_type |  transaction_date   |         name          | code | quantity | calc_stock_level 
------------------+---------------------+-----------------------+------+----------+------------------
 FORECAST_OUT     | 2016-06-05 00:00:00 | GEODIS_WHS_FR_SOCHAUX | GOOD |  0.00000 |       3985.00000
(1 row)

/ Einde Intermezzo

			if (myPrevious != null) {
				myLastKnownBalance = myPrevious.getCalculatedStockLevel();
3985.00000
			myLevelChange = recalculateStockLevel(aTransaction, myLastKnownBalance);
/s
StockLevelCalculationServiceImpl.recalculateStockLevel(StockTransaction, BigDecimal) line: 112	
/=
	protected boolean recalculateStockLevel(StockTransaction aTransaction, BigDecimal aLastKnownBalance) {
aTransaction=27350828/FORECAST_IN/2016-06-21 23:59:00.0/9815434180 (26878587)/GEODIS_WHS_FR_SOCHAUX/1120.00000/5727.00000/true
aLastKnownBalance=3985.00000 / van de previous

		if (aTransaction.isIgnoreOnBalance()) {
/ JA
			myNewBalance = aLastKnownBalance;
		if (aTransaction.getCalculatedStockLevel() == null || myNewBalance.compareTo(aTransaction.getCalculatedStockLevel()) != 0) {
			aTransaction.setCalculatedStockLevel(myNewBalance);
27350828/FORECAST_IN/2016-06-21 23:59:00.0/9815434180 (26878587)/GEODIS_WHS_FR_SOCHAUX/1120.00000/3985.00000/false
			return true;
/t
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 163	
		if (aTransaction.getTransactionType().equals(StockTransactionType.COUNT)) {
/ NEE
		} else {
			StockTransaction myPrevious = stockTransactionDAO.getPrevious(aTransaction);
			if (myPrevious != null) {
				myLastKnownBalance = myPrevious.getCalculatedStockLevel();

			myLevelChange = recalculateStockLevel(aTransaction, myLastKnownBalance);
/d
			myLastKnownBalance = aTransaction.getCalculatedStockLevel();
		}
		stockTransactionDAO.save(aTransaction);

		StockTransaction myCurrent = aTransaction;
27350828/FORECAST_IN/2016-06-21 23:59:00.0/9815434180 (26878587)/GEODIS_WHS_FR_SOCHAUX/1120.00000/3985.00000/false

		main: while (true) {
			List<StockTransaction> myNextList = stockTransactionDAO.getFollowingTransactions(myCurrent, 50);

/ Intermezzo

select this_.*
from STOCK_TRANSACTION this_ 
left outer join TMS_PRODUCT_ITEM productite2_ on this_.PRODUCT_ITEM_SYSTEMID=productite2_.SYSTEM_ID 
left outer join TMS_PRODUCT_ITEM productite3_ on productite2_.PARENT_SYSTEMID=productite3_.SYSTEM_ID 
inner join ORGANIZATION organizati4_ on this_.ORGANIZATION_SYSTEMID=organizati4_.SYSTEM_ID 
left outer join ORGANIZATION organizati5_ on organizati4_.ORGANIZATION_GROUP=organizati5_.SYSTEM_ID 
where this_.PRODUCT_SYSTEMID=26878587
and this_.STOCK_LOCATION_SYSTEMID=26878346 
and this_.GOODS_STATUS_SYSTEMID=26877284 
and (this_.TRANSACTION_DATE>'2016-06-21 23:59:00.000' or (this_.TRANSACTION_DATE='2016-06-21 23:59:00.000' and this_.SYSTEM_ID>27350828)) 
order by this_.TRANSACTION_DATE asc, this_.SYSTEM_ID asc limit 2; 

/ Klopt	, de orders in de toekomst na onze order	, FORECAST_IN nu	, die dirty was	, 

  27386856 | -1013.00000 | NULL          | NULL   | 2016-06-21 23:59:00 |         26878587 |              26877284 |       
         26878346 |                  NULL | NULL        |                 12000 |       4714.00000 |        0 | FORECAST_OUT     |                     27483046 |                   NULL |                 0
  27392346 |  1120.00000 | NULL          | NULL   | 2016-06-21 23:59:00 |         26878587 |              26877284 |       
         26878346 |              26890255 | NULL        |                 12000 |             NULL |        1 | ORDER_IN   
      |                         NULL |                   NULL |                 0

/ Einde Intermezzo

			for (StockTransaction myNext : myNextList) {
				if (myNext.getTransactionType().equals(StockTransactionType.COUNT)) {
/ NEE
					break main;
/ NIET
				}
				myCurrent = myNext;
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/s
StockLevelCalculationServiceImpl.recalculateStockLevel(StockTransaction, BigDecimal) line: 115	
		if (aTransaction.isIgnoreOnBalance()) {
/ NEE
			myNewBalance = aLastKnownBalance;
/ NIET
		} else {
			myNewBalance = aLastKnownBalance.add(aTransaction.getQuantity());
-1013
2972.00000
		if (aTransaction.getCalculatedStockLevel() == null || myNewBalance.compareTo(aTransaction.getCalculatedStockLevel()) != 0) {
			aTransaction.setCalculatedStockLevel(myNewBalance);
			return true;
/t
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 177	
			for (StockTransaction myNext : myNextList) {
				if (myNext.getTransactionType().equals(StockTransactionType.COUNT)) {
					break main;
				}
				myCurrent = myNext;
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/d
					myCurrent.setDirty(false);
					stockTransactionDAO.save(myCurrent);
					myLevelChange = true;
				}
				myLastKnownBalance = myCurrent.getCalculatedStockLevel();

/t
StockLevelCalculationServiceImpl.recalculate(Product, StockLocation, GoodsStatus) line: 139	

		while (true) {
			StockTransaction myTransaction = stockTransactionDAO.getFirstDirty(aProduct, aLocation, aStatus);
			if (myTransaction == null) {
				break;
			} else {
				if (recalculate(myTransaction)) {
/d
					check = true;

/ volgende,	
		while (true) {
			StockTransaction myTransaction = stockTransactionDAO.getFirstDirty(aProduct, aLocation, aStatus);
			if (myTransaction == null) {
				break;

		if (check) {
/ JA
			trigger(aProduct, aLocation, aStatus);
/ TODO
		LOG.info("Recalculation of stock levels done in " + (System.currentTimeMillis() - myStart) + "ms.");



////////////////////////////////////////////////

/ 7	. 

/ product 9806313580 (26878527)

StockLevelCalculationServiceImpl.recalculate(Product, StockLocation, GoodsStatus) line: 134	

		while (true) {
			StockTransaction myTransaction = stockTransactionDAO.getFirstDirty(aProduct, aLocation, aStatus);

27388804/FORECAST_IN/2016-06-20 23:59:00.0/9806313580 (26878527)/GEODIS_WHS_FR_SOCHAUX/0.00000/1698.00000/true

/ Intermezzo

/ getFirstDirty	,

select this_.*
from STOCK_TRANSACTION this_ 
left outer join TMS_PRODUCT_ITEM productite2_ on this_.PRODUCT_ITEM_SYSTEMID=productite2_.SYSTEM_ID 
left outer join TMS_PRODUCT_ITEM productite3_ on productite2_.PARENT_SYSTEMID=productite3_.SYSTEM_ID 
inner join ORGANIZATION organizati4_ on this_.ORGANIZATION_SYSTEMID=organizati4_.SYSTEM_ID 
left outer join ORGANIZATION organizati5_ on organizati4_.ORGANIZATION_GROUP=organizati5_.SYSTEM_ID 
where this_.PRODUCT_SYSTEMID=26878527
and this_.STOCK_LOCATION_SYSTEMID=26878346 
and this_.GOODS_STATUS_SYSTEMID=26877284 
and this_.IS_DIRTY=true 
order by this_.TRANSACTION_DATE asc, this_.SYSTEM_ID asc limit 1;
 system_id | quantity | serial_number | lot_id |  transaction_date   | product_systemid | goods_status_systemid | stock_location_systemid | product_item_systemid | external_id | organization_systemid | calc_stock_level | is_dirty | transaction_type | customer_order_line_systemid | shipment_item_systemid | ignore_on_balance 
-----------+----------+---------------+--------+---------------------+------------------+-----------------------+---------- ---------------+-----------------------+-------------+-----------------------+------------------+----------+--------------- ---+------------------------------+------------------------+-------------------
  27388804 |  0.00000 | NULL          | NULL   | 2016-06-20 23:59:00 |         26878527 |              26877284 |          26878346 |                  NULL | NULL        |                 12000 |       1698.00000 |        1 | FORECAST_IN   |                     27484383 |                   NULL |                 1
(1 row)

/we kunnen ook	,

select this_.*
from STOCK_TRANSACTION this_ 
where this_.PRODUCT_SYSTEMID=26878527
and this_.STOCK_LOCATION_SYSTEMID=26878346 
and this_.GOODS_STATUS_SYSTEMID=26877284 
and this_.IS_DIRTY=true 
order by this_.TRANSACTION_DATE asc, this_.SYSTEM_ID asc limit 1;

/ Einde Intermezzo

			if (myTransaction == null) {
/ NEE
			} else {
				if (recalculate(myTransaction)) {
/s
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 146	
		aTransaction.setDirty(false);
		} else {
			StockTransaction myPrevious = stockTransactionDAO.getPrevious(aTransaction);
27386602/FORECAST_OUT/2016-06-20 23:59:00.0/9806313580 (26878527)/GEODIS_WHS_FR_SOCHAUX/0.00000/1698.00000/false

/ Intermezzo

/ we doen inclusief de current	, dus  <= ipv < in 	,
and this_.SYSTEM_ID<=27388804

/ PREVIOUS QUERY
select this_.*
from STOCK_TRANSACTION this_ 
left outer join TMS_PRODUCT_ITEM productite2_ on this_.PRODUCT_ITEM_SYSTEMID=productite2_.SYSTEM_ID 
left outer join TMS_PRODUCT_ITEM productite3_ on productite2_.PARENT_SYSTEMID=productite3_.SYSTEM_ID 
inner join ORGANIZATION organizati4_ on this_.ORGANIZATION_SYSTEMID=organizati4_.SYSTEM_ID 
left outer join ORGANIZATION organizati5_ on organizati4_.ORGANIZATION_GROUP=organizati5_.SYSTEM_ID 
where this_.PRODUCT_SYSTEMID=26878527 
and this_.STOCK_LOCATION_SYSTEMID=26878346 
and this_.GOODS_STATUS_SYSTEMID=26877284 
and this_.TRANSACTION_DATE<='2016-06-20 23:59:00.000'
and this_.SYSTEM_ID<=27388804 
order by this_.TRANSACTION_DATE desc, this_.SYSTEM_ID desc limit 5

 system_id |  quantity   | serial_number | lot_id |  transaction_date   | product_systemid | goods_status_systemid | stock_
location_systemid | product_item_systemid | external_id | organization_systemid | calc_stock_level | is_dirty | transaction
_type | customer_order_line_systemid | shipment_item_systemid | ignore_on_balance 
-----------+-------------+---------------+--------+---------------------+------------------+-----------------------+-------
------------------+-----------------------+-------------+-----------------------+------------------+----------+------------
------+------------------------------+------------------------+-------------------
  27388804 |     0.00000 | NULL          | NULL   | 2016-06-20 23:59:00 |         26878527 |              26877284 |       
         26878346 |                  NULL | NULL        |                 12000 |       1698.00000 |        1 | FORECAST_IN |                     27484383 |                   NULL |                 1
  27386602 |     0.00000 | NULL          | NULL   | 2016-06-20 23:59:00 |         26878527 |              26877284 |       
         26878346 |                  NULL | NULL        |                 12000 |       1698.00000 |        0 | FORECAST_OUT     |                     27482811 |                   NULL |                 0
  27386168 | -1035.00000 | NULL          | NULL   | 2016-06-17 23:59:00 |         26878527 |              26877284 |       
         26878346 |                  NULL | NULL        |                 12000 |        666.00000 |        0 | FORECAST_OUT     |                     27482340 |                   NULL |                 0
  27362542 |  1032.00000 | NULL          | NULL   | 2016-06-17 23:59:00 |         26878527 |              26877284 |       
         26878346 |                  NULL | NULL        |                 12000 |       1701.00000 |        0 | FORECAST_IN |                     27462433 |                   NULL |                 1
  27385975 | -1053.00000 | NULL          | NULL   | 2016-06-16 23:59:00 |         26878527 |              26877284 |       
         26878346 |                  NULL | NULL        |                 12000 |        648.00000 |        0 | FORECAST_OUT     |                     27482063 |                   NULL |                 0

/ HIER HIER HIER


/ Einde Intermezzo

select this_.*
from STOCK_TRANSACTION this_
left outer join TMS_PRODUCT_ITEM productite2_ on this_.PRODUCT_ITEM_SYSTEMID=productite2_.SYSTEM_ID
left outer join TMS_PRODUCT_ITEM productite3_ on productite2_.PARENT_SYSTEMID=productite3_.SYSTEM_ID
inner join ORGANIZATION organizati4_ on this_.ORGANIZATION_SYSTEMID=organizati4_.SYSTEM_ID
left outer join ORGANIZATION organizati5_ on organizati4_.ORGANIZATION_GROUP=organizati5_.SYSTEM_ID
where this_.PRODUCT_SYSTEMID=26878513
and this_.STOCK_LOCATION_SYSTEMID=26878346
and this_.GOODS_STATUS_SYSTEMID=26877284
and this_.TRANSACTION_DATE<='22-Jun-2016 00:00:00'
and this_.SYSTEM_ID<=27388804
order by this_.TRANSACTION_DATE desc, this_.SYSTEM_ID desc limit 5

--select curr.calc_stock_level,prev.calc_stock_level
select curr.system_id,curr.calc_stock_level
from stock_transaction curr 
where curr.transaction_type='FORECAST_IN'
and curr.ignore_on_balance=true
and curr.calc_stock_level !=(
	select prev.calc_stock_level
	from stock_transaction prev
	where prev.system_id<curr.system_id 
	limit 1)

select curr.system_id,curr.transaction_type,prev.system_id,prev.transaction_type
from stock_transaction curr 
join stock_transaction prev using (product_systemid,goods_status_systemid,stock_location_systemid)
where curr.transaction_type='FORECAST_IN'
and curr.ignore_on_balance=true
and curr.system_id=26878513
and prev.system_id<curr.system_id
order by curr.system_id,prev.system_id desc;

/ 13	. 


select  stocktrans0_.*
from STOCK_TRANSACTION stocktrans0_ 
left outer join GOODS_STATUS goodsstatu1_ on stocktrans0_.GOODS_STATUS_SYSTEMID=goodsstatu1_.SYSTEM_ID, 
ORGANIZATION organizati2_, 
product product3_, 
STOCK_LOCATION stocklocat5_ 
where stocktrans0_.ORGANIZATION_SYSTEMID=organizati2_.SYSTEM_ID 
and stocktrans0_.PRODUCT_SYSTEMID=product3_.SYSTEM_ID 
and stocktrans0_.STOCK_LOCATION_SYSTEMID=stocklocat5_.SYSTEM_ID 
and (stocktrans0_.ORGANIZATION_SYSTEMID in (
	select userorgani6_.ORGANIZATION_SYSTEMID 
	from USER_ORGANIZATION userorgani6_, 
	ORGANIZATION organizati7_ 
	where userorgani6_.ORGANIZATION_SYSTEMID=organizati7_.SYSTEM_ID 
	and userorgani6_.USER_SYSTEMID=27382388)
) 
and (lower((product3_.PRODUCTID||' - '||product3_.DESCRIPTION)) like lower('%9675627980%')) 
and stocktrans0_.TRANSACTION_DATE>='Wed Jun 01 00:00:00 CEST 2016' and stocktrans0_.TRANSACTION_DATE<='Wed Jun 22 00:00:00 CEST 2016' 
order by stocktrans0_.TRANSACTION_DATE desc, stocktrans0_.SYSTEM_ID desc
/ SCS

select  stocktrans0_.*
from STOCK_TRANSACTION stocktrans0_ 
join GOODS_STATUS goodsstatu1_ on stocktrans0_.GOODS_STATUS_SYSTEMID=goodsstatu1_.SYSTEM_ID, 
product product3_, 
STOCK_LOCATION stocklocat5_ 
where stocktrans0_.PRODUCT_SYSTEMID=product3_.SYSTEM_ID 
and stocktrans0_.STOCK_LOCATION_SYSTEMID=stocklocat5_.SYSTEM_ID 
and (lower((product3_.PRODUCTID||' - '||product3_.DESCRIPTION)) like lower('%9675627980%')) 
and stocktrans0_.TRANSACTION_DATE>='Wed Jun 01 00:00:00 CEST 2016' and stocktrans0_.TRANSACTION_DATE<='Wed Jun 22 00:00:00 CEST 2016' 
order by stocktrans0_.TRANSACTION_DATE desc, stocktrans0_.SYSTEM_ID desc
/ SCS vereenvoudigd	,

select curr.* --curr.system_id --,curr.quantity,curr.calc_stock_level,curr.transaction_date   --curr.transaction_type)--,prev.system_id,prev.transaction_type
from stock_transaction curr 
--join stock_transaction prev using (product_systemid,goods_status_systemid,stock_location_systemid)
--where curr.transaction_type='FORECAST_IN'
--and curr.ignore_on_balance=true
where curr.transaction_date >='Wed Jun 01 00:00:00 CEST 2016' and curr.transaction_date <='Wed Jun 22 00:00:00 CEST 2016'
and curr.product_systemid=26878513
order by curr.transaction_date desc,curr.system_id desc
/ WE

63 rows	,

/ Intermezzo

select  count(stocktrans0_.*)
from STOCK_TRANSACTION stocktrans0_ 
join GOODS_STATUS goodsstatu1_ on stocktrans0_.GOODS_STATUS_SYSTEMID=goodsstatu1_.SYSTEM_ID, 
product product3_, 
STOCK_LOCATION stocklocat5_ 
where stocktrans0_.PRODUCT_SYSTEMID=product3_.SYSTEM_ID 
and stocktrans0_.STOCK_LOCATION_SYSTEMID=stocklocat5_.SYSTEM_ID 
and (lower((product3_.PRODUCTID||' - '||product3_.DESCRIPTION)) like lower('%9675627980%')) 
and stocktrans0_.TRANSACTION_DATE>='Wed Jun 01 00:00:00 CEST 2016' and stocktrans0_.TRANSACTION_DATE<='Wed Jun 22 00:00:00 CEST 2016' 
order by stocktrans0_.TRANSACTION_DATE desc, stocktrans0_.SYSTEM_ID desc

ERROR:  column "stocktrans0_.transaction_date" must appear in the GROUP BY clause or be used in an aggregate function
LINE 10: order by stocktrans0_.TRANSACTION_DATE desc, stocktrans0_.SY...

/ komt door order by	,
/ TODO




/ Einde Intermezzo

/ 13	. 

sku=product_systemid | goods_status_systemid | stock_location_systemid 26878513,26877284,26878346

select count(curr.*)  --curr.system_id --,curr.quantity,curr.calc_stock_level,curr.transaction_date   --curr.transaction_type)--,prev.system_id,prev.transaction_type
from stock_transaction curr 
join stock_transaction prev using (product_systemid,goods_status_systemid,stock_location_systemid)
where curr.transaction_type='FORECAST_IN'
--and curr.ignore_on_balance=true
and curr.transaction_date >='2016/06/01 00:00:00 ' and curr.transaction_date <='2016/06/22 00:00:00 '
and curr.product_systemid=26878513
and curr.system_id=27367473
--order by curr.transaction_date desc,curr.system_id desc
/ SCS
/=
select count(curr.*) 
from stock_transaction curr 
--and curr.ignore_on_balance=true
where curr.product_systemid=26878513
and curr.goods_status_systemid=26877284
and curr.stock_location_systemid=26878346
--order by curr.transaction_date desc,curr.system_id desc
/ 592

select count(curr.*) 
from stock_transaction curr 
where curr.transaction_type='FORECAST_IN'
--and curr.ignore_on_balance=true
and curr.product_systemid=26878513
and curr.goods_status_systemid=26877284
and curr.stock_location_systemid=26878346
and curr.transaction_date >='2016/06/01 00:00:00' 
and curr.transaction_date <='2016/06/22 00:00:00'
--order by curr.transaction_date desc,curr.system_id desc
/ 14

/ 13	. 

select curr.*,prev.*
from stock_transaction curr 
join stock_transaction prev using (product_systemid,goods_status_systemid,stock_location_systemid)
where curr.transaction_type='FORECAST_IN'
--and curr.ignore_on_balance=true
and curr.product_systemid=26878513
and curr.goods_status_systemid=26877284
and curr.stock_location_systemid=26878346
and curr.transaction_date >='2016/06/01 00:00:00' 
and curr.transaction_date <='2016/06/22 00:00:00'
and curr.system_id=27367473
and prev.system_id<curr.system_id
order by curr.transaction_date desc,curr.system_id desc, prev.system_id
limit 1;

/ 1313

select curr.*
from stock_transaction curr
where curr.transaction_date=(
select max(curr.transaction_date)
from stock_transaction curr
where curr.transaction_type='FORECAST_IN'
--and curr.ignore_on_balance=true
and curr.product_systemid=26878513
and curr.goods_status_systemid=26877284
and curr.stock_location_systemid=26878346
and curr.transaction_date >='2016/06/01 00:00:00'
and curr.transaction_date <='2016/06/22 00:00:00')
/ NOT OK

select curr.* 
from stock_transaction curr
where curr.transaction_type='FORECAST_IN'
and curr.ignore_on_balance=true
and curr.product_systemid=26878513
and curr.goods_status_systemid=26877284
and curr.stock_location_systemid=26878346
and curr.transaction_date >='2016/06/01 00:00:00'
and curr.transaction_date <='2016/06/22 00:00:00'
order by curr.transaction_date desc
;
/ OK 14	, 

select curr.* 
from stock_transaction curr
where curr.transaction_type='FORECAST_IN'
--and curr.ignore_on_balance=true
and curr.product_systemid=26878513
and curr.goods_status_systemid=26877284
and curr.stock_location_systemid=26878346
and curr.transaction_date >='2016/06/01 00:00:00'
and curr.transaction_date <='2016/06/22 00:00:00'
;



select curr.*
from stock_transaction curr 
--where curr.transaction_type='FORECAST_IN'
--and curr.ignore_on_balance=true
where curr.product_systemid=26878513
and curr.goods_status_systemid=26877284
and curr.stock_location_systemid=26878346
and curr.transaction_date >='2016/06/01 00:00:00' 
and curr.transaction_date <='2016/06/22 00:00:00'
order by curr.transaction_date desc,curr.system_id desc
  27367473 |  1260.00000 | NULL          | NULL   | 2016-06-22 00:00:00 |         26878513 |              26877284 |       
         26878346 |                  NULL | NULL                         |                 12000 |       4661.00000 |      
  0 | FORECAST_IN      |                     27466470 |                   NULL |                 0
  27386912 | -1185.00000 | NULL          | NULL   | 2016-06-21 23:59:00 |         26878513 |              26877284 |       
         26878346 |                  NULL | NULL                         |                 12000 |       3476.00000 |      
  0 | FORECAST_OUT     |                     27482954 |                   NULL |                 0
  27367474 |  1260.00000 | NULL          | NULL   | 2016-06-21 00:00:00 |         26878513 |              26877284 |       
         26878346 |                  NULL | NULL                         |                 12000 |       4661.00000 |      

/ 1313	.

/ GGSPREV 
select st1.*,st2.*
from stock_transaction st1
join stock_transaction st2 
	on st2.product_systemid=st1.product_systemid 
	and st2.goods_status_systemid=st1.goods_status_systemid 
	and st2.stock_location_systemid=st1.stock_location_systemid 
	and st2.transaction_date<st1.transaction_date
left outer join stock_transaction st3 
	on st3.product_systemid=st1.product_systemid 
	and st3.goods_status_systemid=st1.goods_status_systemid 
	and st3.stock_location_systemid=st1.stock_location_systemid 
	and st3.transaction_date<st1.transaction_date
	and st3.transaction_date>st2.transaction_date
join(select distinct product_systemid,goods_status_systemid,stock_location_systemid from stock_transaction) st4 
	on st4.product_systemid=st1.product_systemid 
	and st4.goods_status_systemid=st1.goods_status_systemid 
	and st4.stock_location_systemid=st1.stock_location_systemid 
where st1.transaction_type='FORECAST_IN'
and st1.ignore_on_balance=true
and st2.calc_stock_level!=st1.calc_stock_level
and st3.transaction_date is null
limit 1

/ 1313	.

/ Join met sku	,

/ We hebben ook    


/ GGS-67 PREVIUOS QUERY FINAL

select p.productid,gs.code,sl.name,st1.transaction_date,st1.transaction_type,st1.ignore_on_balance,st1.calc_stock_level,st2.transaction_date,st2.transaction_type,st2.calc_stock_level
from stock_transaction st1
join stock_transaction st2 
	on st2.product_systemid=st1.product_systemid 
	and st2.goods_status_systemid=st1.goods_status_systemid 
	and st2.stock_location_systemid=st1.stock_location_systemid 
	and (st2.transaction_date<st1.transaction_date or st2.transaction_date=st1.transaction_date and st2.system_id<st1.system_id)
left outer join stock_transaction st3 
	on st3.product_systemid=st2.product_systemid 
	and st3.goods_status_systemid=st2.goods_status_systemid 
	and st3.stock_location_systemid=st2.stock_location_systemid 
	and (st3.transaction_date<st1.transaction_date or st3.transaction_date=st1.transaction_date and st3.system_id<st1.system_id)
	and (st3.transaction_date>st2.transaction_date or st3.transaction_date=st2.transaction_date and st3.system_id>st2.system_id)
join(select distinct product_systemid,goods_status_systemid,stock_location_systemid from stock_transaction) st4 
	on st4.product_systemid=st1.product_systemid 
	and st4.goods_status_systemid=st1.goods_status_systemid 
	and st4.stock_location_systemid=st1.stock_location_systemid 
join product p on st1.product_systemid=p.system_id
join goods_status gs on st1.goods_status_systemid=gs.system_id
join stock_location sl on st1.stock_location_systemid=sl.system_id
where st1.transaction_type='FORECAST_IN'
and st1.ignore_on_balance=true
and st2.calc_stock_level!=st1.calc_stock_level
and st3.transaction_date is null
;

/ we hebben de namen veranderd	,

/ tgt: target, the forecast_in met ignore_on_balance=true
/ prv: previous, the stock transaction prior to the target,
/ chk: check, a way to find the previous	, 
/ sku: not required, but for us to see it, to check it in our screens. 

select p.productid,gs.code,sl.name,tgt.transaction_date,tgt.transaction_type,tgt.ignore_on_balance,tgt.calc_stock_level,prv.transaction_date,prv.transaction_type,prv.calc_stock_level
from stock_transaction tgt 
join stock_transaction prv 
    on prv.product_systemid=tgt.product_systemid
    and prv.goods_status_systemid=tgt.goods_status_systemid
    and prv.stock_location_systemid=tgt.stock_location_systemid
    and (prv.transaction_date<tgt.transaction_date or prv.transaction_date=tgt.transaction_date and prv.system_id<tgt.system_id)
left outer join stock_transaction chk
    on chk.product_systemid=prv.product_systemid
    and chk.goods_status_systemid=prv.goods_status_systemid
    and chk.stock_location_systemid=prv.stock_location_systemid
    and (chk.transaction_date<tgt.transaction_date or chk.transaction_date=tgt.transaction_date and chk.system_id<tgt.system_id)
    and (chk.transaction_date>prv.transaction_date or chk.transaction_date=prv.transaction_date and chk.system_id>prv.system_id)
join(select distinct product_systemid,goods_status_systemid,stock_location_systemid from stock_transaction) sku
    on sku.product_systemid=tgt.product_systemid
    and sku.goods_status_systemid=tgt.goods_status_systemid
    and sku.stock_location_systemid=tgt.stock_location_systemid
join product p on tgt.product_systemid=p.system_id
join goods_status gs on tgt.goods_status_systemid=gs.system_id
join stock_location sl on tgt.stock_location_systemid=sl.system_id
where tgt.transaction_type='FORECAST_IN'
and tgt.ignore_on_balance=true
and prv.calc_stock_level!=tgt.calc_stock_level
and chk.transaction_date is null

/ Einde GGS-67 PREVIUOS QUERY FINAL












/ 1313

select * 
from b 
where i=(select max(i)from b)

select b_.* 
from b b_ 
join b b__ using(i)
where b__.system_id= 


/ 13	. 



select curr.*
from stock_transaction curr 
where system_id=27107855
union
select curr.*
from stock_transaction curr 
where 
where system_id<27107855 
limit 1;
/ MAANDAGOCHTEND










/ Einde GSS-67 DEBUG INVENTORY REPORT

/ GGS-93


/ 7	. 

/ een fabriek stuurt een FORECAST_OUT naar het magazijn: want hij wil op 16 jul 5 stuks, dus hij stuurt een voorspelling dat er op 16 jul 5 stuks uit het magazijn gaan 
/ hetm magazijn stuurt een FORECAST_IN naar de leverancier want hij wil op 1 jul 100 stuks, dus hij stuurt een voorspelling dat er op 1 jul 100 stuks het magazijn in gaan 

/ PSA fabriek -> FORECAST_OUT -> Magazijn
/ ->
/ Magazijn -> FORECAST_IN-> Vendor

/ de fabriek wil geen vooraad	, ze sturen per dag of meerdere keren per dag kleine requests	,
/ PSA fabriek stuurt: 
FORECAST_OUT 5 op 16 jul
FORECAST_OUT 5 op 17 jul
FORECAST_OUT 5 op 18 jul
...
/ Het magazijn stuurt naar de vendor 1 groot request	,
/ Magazijn stuurt : FORECAST_IN 100 op 1 jul

/ De voorraad in het magazijn ziet er dan zo uit	,
100, 95, 90, ... 100, 95, 90, ...

/ Als je op het repl forecast scherm een getal in het vakje invult	, maak je een repl advice,	 
/ Dan wordt er een customerorder create, met 1 customer order line	, Dit is een FORECAST_IN	,
/ de forecast_id wordt create ogv product, good status, datum vendor -> foredcast id	, 
/ Maar een dag later kan de forecast_out update, de febriek wil een dat later er 4 ipv 5 op 16 jul	, de forecast_in moet dan ook worden update		, TODO
/ als er al een customerorder is met deze id	, dan wordt hij update	, anders create	,
 
/ 7	. 

/ We zien in het ticket	,

geosco=> \d customer_order
 customer_order_number        | character varying(100)      | 
 forecast_id                  | character varying(40)       | 
 forecast_status              | character varying(20)       | 
 forecast_date                | timestamp without time zone | 

geosco=> \d customer_order_line
 customer_order_systemid        | integer                     | 
 customer_orderline_id          | character varying(100)      | 
 product_systemid               | integer                     | 
 goods_status_systemid          | integer                     | 


select col.requested_start_after,p.productid,gs.code,co.customer_order_number,co.forecast_id,co.seller_party_id
select col.requested_start_after,p.productid,gs.code,col.from_party_id,co.forecast_id
from customer_order_line col
join customer_order co on col.customer_order_systemid=co.system_id
join product p on col.product_systemid=p.system_id
join goods_status gs on col.goods_status_systemid=gs.system_id
where col.customer_orderline_id in ('COL00022251','COL00019100');
-[ RECORD 1 ]---------+--------------------
requested_start_after | 2016-07-15 09:55:00
productid             | 9803778880
code                  | GOOD
from_party_id         | 76022G  02
forecast_id           | R049403LLN8160727
-[ RECORD 2 ]---------+--------------------
requested_start_after | 2016-07-15 09:55:00
productid             | 9803778880
code                  | GOOD
from_party_id         | 76022G  02
forecast_id           | R049403LLN8160822

select col.requested_start_after,p.productid,gs.code,col.from_party_id,co.forecast_id
from customer_order_line col
join customer_order co on col.customer_order_systemid=co.system_id
join product p on col.product_systemid=p.system_id
join goods_status gs on col.goods_status_systemid=gs.system_id
where col.customer_orderline_id in ('COL00022242','COL00019119');
-[ RECORD 1 ]---------+--------------------
requested_start_after | 2016-07-08 09:55:00
productid             | 9803778880
code                  | GOOD
from_party_id         | 76022G  02
forecast_id           | R049403LLN8160720
-[ RECORD 2 ]---------+--------------------
requested_start_after | 2016-07-08 09:55:00
productid             | 9803778880
code                  | GOOD
from_party_id         | 76022G  02
forecast_id           | R049403LLN8160725

9806313580

/ local ook in geosco2p2	,

/ Meer details	,
select col.requested_start_after,col.requested_start_before,col.requested_end_after,col.requested_end_before,p.productid,gs.code,co.customer_order_number,co.forecast_id,co.seller_party_id
from customer_order_line col
join customer_order co on col.customer_order_systemid=co.system_id
join product p on col.product_systemid=p.system_id
join goods_status gs on col.goods_status_systemid=gs.system_id
where col.customer_orderline_id in ('COL00022251','COL00019100');
 requested_start_after | requested_start_before | requested_end_after | requested_end_before | productid  | code | customer
_order_number |    forecast_id    | seller_party_id 
-----------------------+------------------------+---------------------+----------------------+------------+------+---------
--------------+-------------------+-----------------
 2016-07-15 09:55:00   | 2016-07-22 17:30:00    | 2016-07-27 14:00:00 | 2016-07-27 23:59:00  | 9803778880 | GOOD | CO000024
344           | R049403LLN8160727 | 76022G  02
 2016-07-15 09:55:00   | 2016-07-22 17:00:00    | 2016-08-22 07:30:00 | 2016-08-22 23:59:00  | 9803778880 | GOOD | CO000021
088           | R049403LLN8160822 | 76022G  02
(2 rows)

/ Kijk op repl forecast screen 	, 
/ op 27-07 Wed zien we CO000024344
/ op 22-07 Wed zien we CO000021088 

/ HOI HOI HOI

/ we download  deze db	, en install	,

[eric@localhost bin]$ geosco-pg_dump-p.sh 
sco2p=# create database geosco2p3;

[eric@localhost bin]$ find /home/eric/DB_TAP/Postgres/Backup -type f |xargs  ls -1tr | awk 'END{print}'
/home/eric/DB_TAP/Postgres/Backup/geosco-p-2016-06-17.dump
[eric@localhost bin]$ local-pg_restore.sh 
Give <database name> <dump file>.
/ TODO



/ Einde GGS-93

/ DEBUG GGS-93

/ BREAKPOINTS

EntityDetailServiceImpl [line: 126] - initialize(EntityDetailSupport)	
StockTransactionEventListener [line: 38] - handleEvent(Event<?>)	
StockLevelCalculationServiceImpl [line: 154] [conditional] - recalculate(Product, StockLocation, GoodsStatus)	
StockTransactionDAOImpl [line: 190] - getFollowingTransactions(StockTransaction, int)	
StockTransactionServiceImpl [line: 168] - handleCustomerOrderCreated(CustomerOrderEvent)	
StockLevelCalculationServiceImpl [line: 169] - recalculate(StockTransaction)	
ShipmentOrderServiceImpl [line: 226] - addCustomerOrderLine(ShipmentOrderVO, CustomerOrderLine, int)	
ShipmentOrderServiceImpl [line: 234] - addCustomerOrderLine(ShipmentOrderVO, CustomerOrderLine, int)	
StockTransactionServiceImpl [line: 214] - handleProductItemCreated(ProductItemEvent)	
StockTransactionServiceImpl [line: 242] - handleProductItemUpdated(ProductItemEvent)	
CustomerOrderLineServiceImpl [line: 228] - updateOpenQuantity(CustomerOrderLine)	


/ Einde BREAKPOINTS

/ 7	. 

/ Replenishment (aanvullen) forecast scherm	,
public class EditingReplenishmentAdvicePage extends AbstractMainPage {
	protected void processAdvice() {
		} else {
			ReplenishmentFeedBack myFeedback = customerOrderReplenishService.executeReplenishmentAdvice(list, null);
/s
public class CustomerOrderReplenishServiceImpl implements CustomerOrderReplenishService {
	protected void executeReplenishmentAdvice(@Nonnull ReplenishmentAdvice aAdvice, @Nonnull CustomerOrderReplenishState aState,
			ReplenishmentFeedBack aFeedBack) {
/s
public class ForecastIdGeneratorImpl implements ForecastIdGenerator {


/ 7	. 

/ tijdens start appl	, 
/s
ForecastIdGeneratorImpl.generateId(ReplenishmentAdvice) line: 35	
aAdvice=
ReplenishmentAdvice[start=Tue Jun 14 00:00:00 CEST 2016,end=Wed Jun 15 00:00:00 CEST 2016,startLocation=GATE_WH_FR_ST REMY DE MAURIENNE,endLocation=GEODIS_WHS_FR_SOCHAUX,product=9806313580 (26878527),quantity=0]

		StringBuilder sb = new StringBuilder();
		sb.append(prefix);
		sb.append(StringUtils.leftPad(StringUtils.right(Integer.toString(aAdvice.getStartLocation().getSystemId(), 36), 4), 4, '0'));
		sb.append(StringUtils.leftPad(StringUtils.right(Integer.toString(aAdvice.getProduct().getSystemId(), 36), 4), 4, '0'));
		if (aAdvice.getGoodsStatus() != null) {
			sb.append(StringUtils.leftPad(StringUtils.right(Integer.toString(aAdvice.getGoodsStatus().getSystemId(), 36), 2), 2, '0'));
sb="R03np03lrn8"
		SimpleDateFormat sdf = new SimpleDateFormat(dateFormat);
		sb.append(sdf.format(aAdvice.getEnd()));
		return sb.toString().toUpperCase();
sb="R03np03lrn8160615"
/ 17 lang	,

aAdvice.getStartLocation().getSystemId()= 26878597
Integer.toString(aAdvice.getStartLocation().getSystemId(), 36)="g03np"
StringUtils.leftPad(StringUtils.right(Integer.toString(aAdvice.getStartLocation().getSystemId(), 36), 4), 4, '0'))="03np"
aAdvice.getProduct().getSystemId()=26878527
(Integer.toString(aAdvice.getProduct().getSystemId(), 36)="g03lr"
StringUtils.leftPad(StringUtils.right(Integer.toString(aAdvice.getProduct().getSystemId(), 36), 4), 4, '0'))="03lr"
aAdvice.getGoodsStatus().getSystemId()=26877284
Integer.toString(aAdvice.getProduct().getSystemId(), 36)="g02n8"
StringUtils.leftPad(StringUtils.right(Integer.toString(aAdvice.getGoodsStatus().getSystemId(), 36), 2), 2, '0'))="02n8"
aAdvice.getEnd()=Wed Jun 15 00:00:00 CEST 2016
df.format(aAdvice.getEnd())=160615
/t
ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).getCurrentForecast(ReplenishmentAdvice) line: 126	
/=
	public List<CustomerOrderLine> getCurrentForecast(@Nonnull ReplenishmentAdvice aAdvice) {
		final String forecastId = forecastIdGenerator.generateId(aAdvice);
/d
		List<CustomerOrderLine> result = new ArrayList<CustomerOrderLine>();
		for (CustomerOrder co : forecastDAO.findCurrentForecast(getOrganization(aAdvice), forecastId)) {
/s
ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).getOrganization(ReplenishmentAdvice) line: 504	
		if (aAdvice.getShipmentOrderTemplate() != null) {
ShipmentOrder: PSA_REPLENISHMENT_SHO(SystemId:26878201; Org:LOG_EMEA_FR_CT_PSA)
			return aAdvice.getShipmentOrderTemplate().getOrganization();
SystemId:12000	Id:LOG_EMEA_FR_CT_PSA	Description:Organization for PSA CT
/t
/s
ForecastDAOImpl.findCurrentForecast(Organization, String) line: 39	
		Set<ForecastStatus> stati = EnumSet.allOf(ForecastStatus.class);
[SPLITTING, FORECAST, FIRM, CANCELLED]
		stati.remove(ForecastStatus.CANCELLED);
		stati.remove(ForecastStatus.SPLITTING);
		return findForecasts(aOrganization, aForecastId, stati);
/s
ForecastDAOImpl.findForecasts(Organization, String, Set<ForecastStatus>) line: 81	
/=
	public List<CustomerOrder> findForecasts(Organization aOrganization, @Nonnull String aForecastId, @Nonnull Set<ForecastStatus> aForecastStatus) {
this	ForecastDAOImpl  (id=68634)	
	type	Class (com.mpobjects.oms.model.entity.CustomerOrder) (id=25699)	
aOrganization	Organization  (id=66985)	SystemId:12000	Id:LOG_EMEA_FR_CT_PSA	Description:Organization for PSA CT
aForecastId	"R03NP03LRN8160615" (id=64426)	
aForecastStatus	RegularEnumSet  (id=69885) [FORECAST, FIRM]	

		DetachedCriteria crit = DetachedCriteria.forClass(type);
		if (aOrganization != null) {
			crit.add(Property.forName("organization").eq(aOrganization));
		}
		crit.add(Property.forName("forecast.forecastId").eq(aForecastId));
		if (!aForecastStatus.isEmpty()) {
			crit.add(Property.forName("forecast.forecastStatus").in(aForecastStatus));
		}
		return findByCriteria(crit);

/ Intermezzo

select this_.*
from CUSTOMER_ORDER this_ 
left outer join TMS_USER resource2_ on this_.CREATED_BY_SYSTEMID=resource2_.SYSTEM_ID 
left outer join TMS_USER resource3_ on resource2_.CREATED_BY=resource3_.SYSTEM_ID 
where this_.organization_systemid in (
	select uo.organization_systemid 
	from user_organization uo 
	where uo.user_systemid = 27382388 
) 
and this_.ORGANIZATION_SYSTEMID= 12000
and this_.FORECAST_ID='R03NP03LRN8160615' 
and this_.FORECAST_STATUS in ('FORECAST','FIRM' );

  26901556 | CO000023748           |                   NULL |          0 |                  NULL | NULL               | NUL
L                | NULL       | NULL       | NULL       | NULL       | NULL       | NULL       | NULL       | NULL       | 
NULL       | NULL        |                 12000 | 2016-06-06 10:13:43.301 | AQ             | ATLANTIQ   |             | 11
3 boulevard Haussmann |                | PARIS      | 75008             |                    |                   4069 |    
                |                     |                  |                    | NULL            | NULL           | 95010W  
01      | JOHNSON ELECTRIC ASTI S.R.L. | vendeur Gate Saint Rémy | Corso Alessandria 395 |                 | ASTI        | 
14100              | AT                  |                    4101 |                     |                      |          
         |                     | NULL             | NULL            |            26879399 |                    6 |         
            26942699 |                   |                   |                   | 0060429031636     | 5                 | 
                 |                  |                  | 52791964100037   | 5                |                 NULL |      
             |                  | NULL        | 2016-06-06 11:38:38.056 | R03NP03LRN8160615 | FIRM            | NULL
(1 row)


/ Einde Intermezzo

/t
ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).getCurrentForecast(ReplenishmentAdvice) line: 126	
		for (CustomerOrder co : forecastDAO.findCurrentForecast(getOrganization(aAdvice), forecastId)) {
/d
CO000023748
			result.addAll(findForecastLink(co, aAdvice));
/s
ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).findForecastLink(CustomerOrder, ReplenishmentAdvice) line: 375	
/=
	protected List<CustomerOrderLine> findForecastLink(CustomerOrder aForecastCo, ReplenishmentAdvice aAdvice) {
aForecastCo	CustomerOrder  (id=83995)	
aAdvice	ReplenishmentAdvice  (id=2687)	
ReplenishmentAdvice[start=Tue Jun 14 00:00:00 CEST 2016,end=Wed Jun 15 00:00:00 CEST 2016,startLocation=GATE_WH_FR_ST REMY DE MAURIENNE,endLocation=GEODIS_WHS_FR_SOCHAUX,product=9806313580 (26878527),quantity=0]

		String fromPartyId = StringUtils.normalizeSpace(aAdvice.getStartLocation().getParty().getCode());
"45086F  01"

/ aAdvice.getStartLocation()=StockLocation	,
aAdvice.getStartLocation().getParty()=location 	,

/ Intermezzo

geosco2p2=# select*from stock_location where system_id=26878597;
 system_id |              name               | is_deleted | stock_loc_type_systemid | parent_stock_loc_systemid | party_sys
temid 
-----------+---------------------------------+------------+-------------------------+---------------------------+----------
------
  26878597 | GATE_WH_FR_ST REMY DE MAURIENNE |          0 |                26877539 |                  27274426 |       268
78371
(1 row)

geosco2p2=# select*from party where system_id=26878371;
 system_id | is_deleted |  party_id  | party_type_systemid | organization_systemid | name | name2 |            address     
       | address2 |         city         | zipcode | country_systemid | contact_name | emailaddress | faxnumber | phonenumb
er | region_state | tnt_zone | reference1 | reference2 | reference3 |  reference4   | reference5 | service_order_url_expres
sion | manifest_report | time_zone | longitude | latitude | schedule_systemid | prenotify_carcon | service_remarks 
-----------+------------+------------+---------------------+-----------------------+------+-------+------------------------
-------+----------+----------------------+---------+------------------+--------------+--------------+-----------+----------
---+--------------+----------+------------+------------+------------+---------------+------------+-------------------------
-----+-----------------+-----------+-----------+----------+-------------------+------------------+-----------------
  26878371 |          0 | 45086F  01 |            26877287 |                 12000 | GATE |       | Lieu-dit Moulins De La 
Girard |          | ST REMY DE MAURIENNE | 73660   |             4069 |              |              |           |          
   |              |          | APP01      | EDI        |            | 0931327656781 | 10         |                         
     |                 | NULL      | NULL      | NULL     |              NULL |                0 | 
(1 row)

/ Einde Intermezzo

/ we zijn in 	,
ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).findForecastLink(CustomerOrder, ReplenishmentAdvice) line: 381	
/=
	protected List<CustomerOrderLine> findForecastLink(CustomerOrder aForecastCo, ReplenishmentAdvice aAdvice) {
aForecastCo= CO000023748
aAdvice=ReplenishmentAdvice[start=Tue Jun 14 00:00:00 CEST 2016,end=Wed Jun 15 00:00:00 CEST 2016,startLocation=GATE_WH_FR_ST REMY DE MAURIENNE,endLocation=GEODIS_WHS_FR_SOCHAUX,product=9806313580 (26878527),quantity=0]

		List<CustomerOrderLine> result = new ArrayList<CustomerOrderLine>();
		String fromPartyId = StringUtils.normalizeSpace(aAdvice.getStartLocation().getParty().getCode());
45086F 01
		String toPartyId = StringUtils.normalizeSpace(aAdvice.getEndLocation().getParty().getCode());
093139861944500198

		for (CustomerOrderLine line : aForecastCo.getCustomerOrderLineSet()) {
[CUSTOMER_ORDER_LINE id:COL00021663(systemId:27484135)]
			String linePartyFrom = line.getFromPartyVO().getCode();
45086F  01
			String linePartyTo = line.getToPartyVO().getCode();
093139861944500198
			result.add(line);
		return result;
/t
ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).getPreviousForecast(ReplenishmentAdvice) line: 181
	List<CustomerOrderLine> currentForecast = customerOrderReplenishService.getCurrentForecast(aView.getAdvice());
/d

/ Intermezzo

public class CustomerOrderReplenishServiceImpl implements CustomerOrderReplenishService {

	public List<CustomerOrderLine> getCurrentForecast(@Nonnull ReplenishmentAdvice aAdvice) {
		...
		for (CustomerOrder co : forecastDAO.findCurrentForecast(getOrganization(aAdvice), forecastId)) {

	public List<CustomerOrderLine> getPreviousForecast(@Nonnull ReplenishmentAdvice aAdvice) {
		...
		for (CustomerOrder co : forecastDAO.findPreviousForecast(getOrganization(aAdvice), forecastId)) {

public class ForecastDAOImpl extends GenericHibernateDAO<CustomerOrder> implements ForecastDAO {

//////////////////////////////
/ current	,

	public List<CustomerOrder> findCurrentForecast(Organization aOrganization, @Nonnull String aForecastId) {
		Set<ForecastStatus> stati = EnumSet.allOf(ForecastStatus.class);
		stati.remove(ForecastStatus.CANCELLED);
		stati.remove(ForecastStatus.SPLITTING);
		return findForecasts(aOrganization, aForecastId, stati);
	}
/s
	public List<CustomerOrder> findForecasts(Organization aOrganization, @Nonnull String aForecastId, @Nonnull Set<ForecastStatus> aForecastStatus) {
		DetachedCriteria crit = DetachedCriteria.forClass(type);
		if (aOrganization != null) {
			crit.add(Property.forName("organization").eq(aOrganization));
		}
		crit.add(Property.forName("forecast.forecastId").eq(aForecastId));
		if (!aForecastStatus.isEmpty()) {
			crit.add(Property.forName("forecast.forecastStatus").in(aForecastStatus));
		}
		return findByCriteria(crit);
	}

//////////////////////////
/ previous	,

	public List<CustomerOrder> findPreviousForecast(Organization aOrganization, String aForecastId) {
		StringBuilder sb = new StringBuilder();
		sb.append("select co from com.mpobjects.oms.model.entity.CustomerOrder co");
		sb.append(" where co.forecast.forecastId = :forecastId");
		sb.append(" and co.organization = :org");
		sb.append(" and not co.importExportInfo.lastExport is null");
		sb.append(" and co.importExportInfo.lastExport = (
			select max(co2.importExportInfo.lastExport) 
			from com.mpobjects.oms.model.entity.CustomerOrder co2 
			where not co2.importExportInfo.lastExport is null 
				and co2.forecast.forecastId = co.forecast.forecastId 
				and co2.organization = co.organization)");
		sb.append(" order by co.dateSetVO.createdDate desc");
		Query q = getCurrentSession().createQuery(sb.toString());
		q.setParameter("forecastId", aForecastId);
		q.setParameter("org", aOrganization);
		return q.list();
	}

/ Einde Intermezzo

/t
EditingReplenishmentAdvicePage.loadCustomerOrderLines(EditingReplenishmentAdvicePage$AdviceView) line: 640	
/=
	protected void loadCustomerOrderLines(AdviceView aView) {
/ TODO PAUL (aView)
		List<CustomerOrderLine> currentForecast = customerOrderReplenishService.getCurrentForecast(aView.getAdvice());
/d
		for (CustomerOrderLine line : currentForecast) {
			CustomerOrder myOrder = line.getCustomerOrder();
CO000019009
			// Exclude the firm orders
			if (myOrder.getForecast().getForecastStatus().equals(ForecastStatus.FORECAST)) {
/ JA
/ TODO PAUL
				aView.addCurrent(line.getQuantity());

aView	EditingReplenishmentAdvicePage$AdviceView  (id=29568)	
	advice	ReplenishmentAdvice  (id=29556)	
	attached	true	
	currentForecastQty	BigDecimal  (id=49377)	
1152
	newForecastQty	null	
	previousForecastQty	BigDecimal  (id=49378)	
1152

		if (aView.getNewForecastQty() == null) {
			aView.setNewForecastQty(aView.getCurrentForecastQty());

/c
EditingReplenishmentAdvicePage.loadCustomerOrderLines(EditingReplenishmentAdvicePage$AdviceView) line: 630	
/=
	protected void loadCustomerOrderLines(AdviceView aView) {

aView	EditingReplenishmentAdvicePage$AdviceView  (id=50640)	
	advice	ReplenishmentAdvice  (id=50634)	
ReplenishmentAdvice[start=Tue Oct 04 00:00:00 CEST 2016,end=Wed Oct 05 00:00:00 CEST 2016,startLocation=GATE_WH_FR_ST REMY DE MAURIENNE,endLocation=GEODIS_WHS_FR_SOCHAUX,product=9806313580 (26878527),quantity=1152.00000]
	attached	true	
	currentForecastQty	BigDecimal  (id=55581)	
0
	newForecastQty	null	
	previousForecastQty	null	
0
/s
ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).getPreviousForecast(ReplenishmentAdvice) line: 176	
		final String forecastId = forecastIdGenerator.generateId(aAdvice);
R03NP03LRN8161005
		List<CustomerOrderLine> result = new ArrayList<CustomerOrderLine>();
		for (CustomerOrder co : forecastDAO.findPreviousForecast(getOrganization(aAdvice), forecastId)) {
/s
ForecastDAOImpl.findPreviousForecast(Organization, String) line: 95	

		StringBuilder sb = new StringBuilder();
		sb.append("select co from com.mpobjects.oms.model.entity.CustomerOrder co");
		sb.append(" where co.forecast.forecastId = :forecastId");
		sb.append(" and co.organization = :org");
		sb.append(" and not co.importExportInfo.lastExport is null");
		sb.append(" and co.importExportInfo.lastExport = (select max(co2.importExportInfo.lastExport) from com.mpobjects.oms.model.entity.CustomerOrder co2 where not co2.importExportInfo.lastExport is null and co2.forecast.forecastId = co.forecast.forecastId and co2.organization = co.organization) ");
		sb.append(" order by co.dateSetVO.createdDate desc");
		Query q = getCurrentSession().createQuery(sb.toString());
		q.setParameter("forecastId", aForecastId);
		q.setParameter("org", aOrganization);
		return q.list();

/ Intermezzo

/ We zien	,

select customeror0_.*
from CUSTOMER_ORDER customeror0_ 
where customeror0_.organization_systemid in (
	select uo.organization_systemid 
	from user_organization uo 
	where uo.user_systemid =27382388 
) 
and customeror0_.FORECAST_ID='R03NP03LRN8161005' 
and customeror0_.ORGANIZATION_SYSTEMID=12000 
and (customeror0_.LAST_EXPORT is not null) 
and customeror0_.LAST_EXPORT=(
	select max(customeror1_.LAST_EXPORT) 
	from CUSTOMER_ORDER customeror1_ 
	where customeror1_.organization_systemid in (
		select uo.organization_systemid 
		from user_organization uo 
		where uo.user_systemid =27382388 
	) 
	and (customeror1_.LAST_EXPORT is not null) 
	and customeror1_.FORECAST_ID=customeror0_.FORECAST_ID 
	and customeror1_.ORGANIZATION_SYSTEMID=customeror0_.ORGANIZATION_SYSTEMID
) 
order by customeror0_.CREATION_DATE desc 

  26900742 | CO000022934           |                   NULL |          0 |                  NULL | NULL               | NUL
L                | NULL       | NULL       | NULL       | NULL       | NULL       | NULL       | NULL       | NULL       | 
NULL       | NULL        |                 12000 | 2016-05-25 12:01:17.721 | AQ             | ATLANTIQ   |             | 11
3 boulevard Haussmann |                | PARIS      | 75008             |                    |                   4069 |    
                |                     |                  |                    | NULL            | NULL           | 95010W  
01      | JOHNSON ELECTRIC ASTI S.R.L. | vendeur Gate Saint Rémy | Corso Alessandria 395 |                 | ASTI        | 
14100              | AT                  |                    4101 |                     |                      |          
         |                     | NULL             | NULL            |            26879399 |                    6 |         
            26942699 |                   |                   |                   | 0060429031636     | 5                 | 
                 |                  |                  | 52791964100037   | 5                |                 NULL |      
             |                  | NULL        | 2016-06-09 18:29:00.684 | R03NP03LRN8161005 | FORECAST        | NULL
(1 row)

/ Dit is de previous	,


/ 7	. 

/ Dit is de current	, 
/ = previous	,
/ TODO

select this_.*
from CUSTOMER_ORDER this_ 
where this_.organization_systemid in (
	select uo.organization_systemid 
	from user_organization uo 
	where uo.user_systemid = 27382388 
) 
and this_.ORGANIZATION_SYSTEMID= 12000
and this_.FORECAST_ID='R03NP03LRN8161005' 
and this_.FORECAST_STATUS in ('FORECAST','FIRM' );

 26900742 | CO000022934           |                   NULL |          0 |                  NULL | NULL               | NUL
L                | NULL       | NULL       | NULL       | NULL       | NULL       | NULL       | NULL       | NULL       | 
NULL       | NULL        |                 12000 | 2016-05-25 12:01:17.721 | AQ             | ATLANTIQ   |             | 11
3 boulevard Haussmann |                | PARIS      | 75008             |                    |                   4069 |    
                |                     |                  |                    | NULL            | NULL           | 95010W  
01      | JOHNSON ELECTRIC ASTI S.R.L. | vendeur Gate Saint Rémy | Corso Alessandria 395 |                 | ASTI        | 
14100              | AT                  |                    4101 |                     |                      |          
         |                     | NULL             | NULL            |            26879399 |                    6 |         
            26942699 |                   |                   |                   | 0060429031636     | 5                 | 
                 |                  |                  | 52791964100037   | 5                |                 NULL |      
             |                  | NULL        | 2016-06-09 18:29:00.684 | R03NP03LRN8161005 | FORECAST        | NULL
(1 row)



/ Einde Intermezzo


/t
ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).getPreviousForecast(ReplenishmentAdvice) line: 179	
		for (CustomerOrder co : forecastDAO.findPreviousForecast(getOrganization(aAdvice), forecastId)) {
			result.addAll(findForecastLink(co, aAdvice));
		}
		return result;

/t
EditingReplenishmentAdvicePage.loadCustomerOrderLines(EditingReplenishmentAdvicePage$AdviceView) line: 646	

		List<CustomerOrderLine> previousForecast = customerOrderReplenishService.getPreviousForecast(aView.getAdvice());
/d
		for (CustomerOrderLine line : previousForecast) {
			aView.addPrevious(line.getQuantity());
		}

		List<CustomerOrderLine> currentForecast = customerOrderReplenishService.getCurrentForecast(aView.getAdvice());
		for (CustomerOrderLine line : currentForecast) {

			CustomerOrder myOrder = line.getCustomerOrder();
			// Exclude the firm orders
			if (myOrder.getForecast().getForecastStatus().equals(ForecastStatus.FORECAST)) {
				aView.addCurrent(line.getQuantity());
			}
		}

aView	EditingReplenishmentAdvicePage$AdviceView  (id=50640)	
	advice	ReplenishmentAdvice  (id=50634)	
ReplenishmentAdvice[start=Tue Oct 04 00:00:00 CEST 2016,end=Wed Oct 05 00:00:00 CEST 2016,startLocation=GATE_WH_FR_ST REMY DE MAURIENNE,endLocation=GEODIS_WHS_FR_SOCHAUX,product=9806313580 (26878527),quantity=1152.00000]
	attached	true	
	currentForecastQty	BigDecimal  (id=74010)	
1152
	newForecastQty	null	
	previousForecastQty	BigDecimal  (id=74011)	
1152

		if (aView.getNewForecastQty() == null) {
			aView.setNewForecastQty(aView.getCurrentForecastQty());
1152

/c

/ 7	. 

/ we nemen product	,
/ 9806313580
/ in geosco2p2 	, 
/ Op Mon 20 Jun repl advivce: 48
/ we moeten eig. naar de FC Out kijken , om te bepalen wat de FC In moet zijn	,
/ click 'Save forecast'

/s
/ stack trace

Daemon Thread [http-0.0.0.0-8080-3] (Suspended (breakpoint at line 798 in EditingReplenishmentAdvicePage))	
	EditingReplenishmentAdvicePage.processAdvice() line: 798	
	EditingReplenishmentAdvicePage$7.onSubmit(AjaxRequestTarget, Form<?>) line: 402	
				processAdvice();

	AjaxButton$1.onSubmit(AjaxRequestTarget) line: 101	
				AjaxButton.this.onSubmit(target, AjaxButton.this.getForm());

	AjaxButton$1(AjaxFormSubmitBehavior).onEvent(AjaxRequestTarget) line: 156	
			onSubmit(target);

	AjaxButton$1(AjaxEventBehavior).respond(AjaxRequestTarget) line: 177	
		onEvent(target);

	AjaxButton$1(AbstractDefaultAjaxBehavior).onRequest() line: 312	
		respond(target);

	BehaviorRequestTarget.processEvents(RequestCycle) line: 157	
		// Invoke the interface method
		behaviorListener.onRequest();

	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
			((IEventProcessor)target).processEvents(requestCycle);
target	BehaviorRequestTarget  (id=28472)	


	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
		// let the processor handle/ issue any events, including building the component hierarchy
		processor.processEvents(this);

	MpoWebRequestCycle(RequestCycle).step() line: 1358	
				case PROCESS_EVENTS : {
					processEventsAndRespond();

	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/ we gaan debug	,
/s
EditingReplenishmentAdvicePage.processAdvice() line: 798	

/ Intermezzo

	/**
	 * A hashmap per location, containing a map with advices per period
	 */
	private IModel<HashMap<Integer, Map<ProjectionPeriod, AdviceView>>> advices;

/ Einde Intermezzo

/ Intermezzo

EditingReplenishmentAdvicePage.processAdvice() line: 806	

		for (Map<ProjectionPeriod, AdviceView> entry : advices.getObject().values()) {
			for (Entry<ProjectionPeriod, AdviceView> view : entry.entrySet()) {
				AdviceView myAdviceView = view.getValue();

this	EditingReplenishmentAdvicePage  (id=28461)	
	advices	Model  (id=38537)	
		object	HashMap  (id=38539)	
			size	1	
			table	HashMap$Entry[16]  (id=39784)	
				[11]	HashMap$Entry  (id=41103)	
					hash	25210107	
					key	Integer  (id=41105)	
					next	null	
					value	HashMap  (id=28466)	
/=
entry	HashMap  (id=28466)	



/ Einde Intermezzo

		for (Map<ProjectionPeriod, AdviceView> entry : advices.getObject().values()) {
entry	HashMap  (id=28466)	
/ 94 items	,
			for (Entry<ProjectionPeriod, AdviceView> view : entry.entrySet()) {
view	HashMap$Entry  (id=41119)	
	hash	368076034	
	key	ProjectionPeriod  (id=43641)	
[2016-09-21T00:00:00.000+02:00, 2016-09-22T00:00:00.000+02:00)
	next	null	
	value	EditingReplenishmentAdvicePage$AdviceView  (id=43642)	
EditingReplenishmentAdvicePage.AdviceView[advice=ReplenishmentAdvice[
	start=Tue Sep 20 00:00:00 CEST 2016,
	end=Wed Sep 21 00:00:00 CEST 2016,
	startLocation=GATE_WH_FR_ST REMY DE MAURIENNE,
	endLocation=GEODIS_WHS_FR_SOCHAUX,
	product=9806313580 (26878527),
	quantity=1128.00000],
	current=1152,
	previous=1152
]
				AdviceView myAdviceView = view.getValue();
myAdviceView	EditingReplenishmentAdvicePage$AdviceView  (id=43642)	
	advice	ReplenishmentAdvice  (id=46377)	
ReplenishmentAdvice[start=Tue Sep 20 00:00:00 CEST 2016,end=Wed Sep 21 00:00:00 CEST 2016,startLocation=GATE_WH_FR_ST REMY DE MAURIENNE,endLocation=GEODIS_WHS_FR_SOCHAUX,product=9806313580 (26878527),quantity=1128.00000]
	attached	false	
	currentForecastQty	BigDecimal  (id=46378)	
1152
	newForecastQty	BigDecimal  (id=46378)	
1152
	previousForecastQty	BigDecimal  (id=47375)	
1152
/ Klopt	, in het repl forecast screen zien we bij 21-09 Wed 00:00 1152 
FC In	 1152
Advice 	1128
				if (myAdviceView.hasChangedQty()) {
/ NEE

/ volgende	,
			for (Entry<ProjectionPeriod, AdviceView> view : entry.entrySet()) {
				AdviceView myAdviceView = view.getValue();
myAdviceView	EditingReplenishmentAdvicePage$AdviceView  (id=73310)	
	advice	ReplenishmentAdvice  (id=73315)	
ReplenishmentAdvice[start=Thu Oct 13 00:00:00 CEST 2016,end=Fri Oct 14 00:00:00 CEST 2016,startLocation=GATE_WH_FR_ST REMY DE MAURIENNE,endLocation=GEODIS_WHS_FR_SOCHAUX,product=9806313580 (26878527),quantity=1104.00000]
	attached	false	
	currentForecastQty	BigDecimal  (id=73316)	
1104
	newForecastQty	BigDecimal  (id=73316)	
1104
	previousForecastQty	BigDecimal  (id=73317)	
1104
/ Klopt	, kijk bij 14-10 Fri 00:00
				if (myAdviceView.hasChangedQty()) {
/ NEE

/ volgende,	
			for (Entry<ProjectionPeriod, AdviceView> view : entry.entrySet()) {
				AdviceView myAdviceView = view.getValue();
myAdviceView	EditingReplenishmentAdvicePage$AdviceView  (id=78151)	
	advice	ReplenishmentAdvice  (id=78304)	
ReplenishmentAdvice[start=Wed Oct 05 00:00:00 CEST 2016,end=Thu Oct 06 00:00:00 CEST 2016,startLocation=GATE_WH_FR_ST REMY DE MAURIENNE,endLocation=GEODIS_WHS_FR_SOCHAUX,product=9806313580 (26878527),quantity=1152.00000]
	attached	false	
	currentForecastQty	BigDecimal  (id=78305)	
1152
	newForecastQty	BigDecimal  (id=78305)	
1152
	previousForecastQty	BigDecimal  (id=78306)	
1152
/ Klopt	, kijk naar 07-10 Fri 00:00

/ c
 /we set b	,  zodat hij in de if valt	,
/s
		for (Map<ProjectionPeriod, AdviceView> entry : advices.getObject().values()) {
			for (Entry<ProjectionPeriod, AdviceView> view : entry.entrySet()) {
				AdviceView myAdviceView = view.getValue();

view	HashMap$Entry  (id=28464)	
	advice	ReplenishmentAdvice  (id=88082)	
end	Date  (id=88149)	
Mon Jun 20 00:00:00 CEST 2016
	attached	false	
	currentForecastQty	BigDecimal  (id=88084)	
0
	newForecastQty	BigDecimal  (id=88086)	
48
	previousForecastQty	BigDecimal  (id=88084)	
0
/ Klopt, 20-06 Mon 00:00	, 
///////////////////////////////////////////////////
/ Deze heb ik zojuist ingevuld	,

				if (myAdviceView.hasChangedQty()) { 		current != new
					// get fresh values, just in case the COs were already changed by an other process.
					loadCustomerOrderLines(view.getValue());
/s
EditingReplenishmentAdvicePage.loadCustomerOrderLines(EditingReplenishmentAdvicePage$AdviceView) line: 618	
/=
	protected void loadCustomerOrderLines(AdviceView aView) {

		aView.setAttached(true);
		aView.setPreviousForecastQty(null);
/ TODO
		aView.setCurrentForecastQty(BigDecimal.ZERO);
/ TODO


		// Work around
		initializeReplenishmentAdvice(aView.getAdvice());
/s
EditingReplenishmentAdvicePage.initializeReplenishmentAdvice(ReplenishmentAdvice) line: 939	

		anAdvice.setStartLocation(stockLocationDao.getBySystemId(anAdvice.getStartLocation().getSystemId()));
		anAdvice.setEndLocation(stockLocationDao.getBySystemId(anAdvice.getEndLocation().getSystemId()));
		if (anAdvice.getShipmentOrderTemplate() != null) {
			anAdvice.setShipmentOrderTemplate(shipmentOrderDao.getBySystemId(anAdvice.getShipmentOrderTemplate().getSystemId()));
		}
		if (anAdvice.getProduct() != null) {
			anAdvice.setProduct(productDao.getBySystemId(anAdvice.getProduct().getSystemId()));
		}
		if (anAdvice.getGoodsStatus() != null) {
			anAdvice.setGoodsStatus(goodsStatusDao.getBySystemId(anAdvice.getGoodsStatus().getSystemId()));
		}
/ TODO
anAdvice=
ReplenishmentAdvice[start=Fri Jun 17 00:00:00 CEST 2016,end=Mon Jun 20 00:00:00 CEST 2016,startLocation=GATE_WH_FR_ST REMY DE MAURIENNE,endLocation=GEODIS_WHS_FR_SOCHAUX,product=9806313580 (26878527),quantity=0]

		List<CustomerOrderLine> previousForecast = customerOrderReplenishService.getPreviousForecast(aView.getAdvice());
[CUSTOMER_ORDER_LINE id:COL00021911(systemId:27484383)]

		for (CustomerOrderLine line : previousForecast) {
			aView.addPrevious(line.getQuantity());
0

		List<CustomerOrderLine> currentForecast = customerOrderReplenishService.getCurrentForecast(aView.getAdvice());
[CUSTOMER_ORDER_LINE id:COL00021911(systemId:27484383)]

		for (CustomerOrderLine line : currentForecast) {
			CustomerOrder myOrder = line.getCustomerOrder();
			// Exclude the firm orders
			if (myOrder.getForecast().getForecastStatus().equals(ForecastStatus.FORECAST)) {
/ NEE
				aView.addCurrent(line.getQuantity());
/ NIET

		if (aView.getNewForecastQty() == null) {
/ NEE
			aView.setNewForecastQty(aView.getCurrentForecastQty());
/ NIET
/t
EditingReplenishmentAdvicePage.processAdvice() line: 809	
					loadCustomerOrderLines(view.getValue());
/d
					if (isMutable(view.getKey(), view.getValue())) {
view.getKey()=
[2016-06-20T00:00:00.000+02:00, 2016-06-21T00:00:00.000+02:00)
view.getValue()=
EditingReplenishmentAdvicePage.AdviceView[advice=ReplenishmentAdvice[start=Fri Jun 17 00:00:00 CEST 2016,end=Mon Jun 20 00:00:00 CEST 2016,startLocation=GATE_WH_FR_ST REMY DE MAURIENNE,endLocation=GEODIS_WHS_FR_SOCHAUX,product=9806313580 (26878527),quantity=0],current=0,previous=0]
/s
EditingReplenishmentAdvicePage.isMutable(ProjectionPeriod, EditingReplenishmentAdvicePage$AdviceView) line: 610	
		if (aPeriod != null && aPeriod.getEnd().isBeforeNow()) {
/ NEE
/ Het is niet in het verleden geeindigd	,

		return true;
/t
EditingReplenishmentAdvicePage.processAdvice() line: 810	
					if (isMutable(view.getKey(), view.getValue())) {
/d
						ReplenishmentAdvice myAdvice = view.getValue().getAdvice();
						myAdvice.setQuantity(view.getValue().getNewForecastQty());
48
/ Heb ik ingetypt	,
myAdvice=
ReplenishmentAdvice[start=Fri Jun 17 00:00:00 CEST 2016,end=Mon Jun 20 00:00:00 CEST 2016,startLocation=GATE_WH_FR_ST REMY DE MAURIENNE,endLocation=GEODIS_WHS_FR_SOCHAUX,product=9806313580 (26878527),quantity=48]

						list.add(view.getValue().getAdvice());
/ Dit was de enigste	,
/ want	,
/c
		for (Map<ProjectionPeriod, AdviceView> entry : advices.getObject().values()) {
			for (Entry<ProjectionPeriod, AdviceView> view : entry.entrySet()) {
/ GEEN	,
		// FIXME fix broken objects, should not be done like this
		for (ReplenishmentAdvice adv : list) {
			initializeReplenishmentAdvice(adv);
/ TODO

		} else {
			ReplenishmentFeedBack myFeedback = customerOrderReplenishService.executeReplenishmentAdvice(list, null);
/s
ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).executeReplenishmentAdvice(Collection<ReplenishmentAdvice>, ProgressMonitor) line: 103	

		for (ReplenishmentAdvice advice : aAdvices) {
			executeReplenishmentAdvice(advice, state, feedback);
/s
ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).executeReplenishmentAdvice(ReplenishmentAdvice, CustomerOrderReplenishServiceImpl$CustomerOrderReplenishState, ReplenishmentFeedBack) line: 308	

		final String forecastId = forecastIdGenerator.generateId(aAdvice);
R03NP03LRN8160620
aAdvice=
ReplenishmentAdvice[start=Fri Jun 17 00:00:00 CEST 2016,end=Mon Jun 20 00:00:00 CEST 2016,startLocation=GATE_WH_FR_ST REMY DE MAURIENNE,endLocation=GEODIS_WHS_FR_SOCHAUX,product=9806313580 (26878527),quantity=48]

		// Create/update the customer order header
		boolean newCo = false;
		CustomerOrder co = getCustomerOrderHeader(forecastId, aAdvice, aState);
/s
ReplacingCustomerOrderReplenishServiceImpl.getCustomerOrderHeader(String, ReplenishmentAdvice, CustomerOrderReplenishServiceImpl$CustomerOrderReplenishState) line: 56	

		CustomerOrder co = super.getCustomerOrderHeader(aForecastId, aAdvice, aState);
/s
ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).getCustomerOrderHeader(String, ReplenishmentAdvice, CustomerOrderReplenishServiceImpl$CustomerOrderReplenishState) line: 427	

		Organization org = getOrganization(aAdvice);
aAdvice	ReplenishmentAdvice  (id=19214)	
	shipmentOrderTemplate	ShipmentOrderVO_$$_javassist_139  (id=19728)	
ShipmentOrder: PSA_REPLENISHMENT_SHO(SystemId:26878201; Org:LOG_EMEA_FR_CT_PSA)
/ In dit template zit de org	,
org=
SystemId:12000	Id:LOG_EMEA_FR_CT_PSA	Description:Organization for PSA CT

		List<CustomerOrder> cos = forecastDAO.findCurrentForecast(org, aForecastId);
[CO000023996]
/=
  26901804 | CO000023996           |                   NULL |          0 |                  NULL | NULL               | NUL
L                | NULL       | NULL       | NULL       | NULL       | NULL       | NULL       | NULL       | NULL       | 
NULL       | NULL        |                 12000 | 2016-06-06 14:48:16.352 | AQ             | ATLANTIQ   |             | 11
3 boulevard Haussmann |                | PARIS      | 75008             |                    |                   4069 |    
                |                     |                  |                    | NULL            | NULL           | 95010W  
01      | JOHNSON ELECTRIC ASTI S.R.L. | vendeur Gate Saint Rémy | Corso Alessandria 395 |                 | ASTI        | 
14100              | AT                  |                    4101 |                     |                      |          
         |                     | NULL             | NULL            |            26879399 |                    6 |         
            26942699 |                   |                   |                   | 0060429031636     | 5                 | 
                 |                  |                  | 52791964100037   | 5                |                 NULL |      
             |                  | NULL        | 2016-06-09 18:28:55.747 | R03NP03LRN8160620 | FIRM            | NULL
(1 row)

/ we zien op prod ook	, dat FC In, In, FC Out, Out zijn allemaal 0	, en toch is er een CO
/ TODO PAUL
/ Hij is ook FIRM	, maar er is GEEN sho	,

		for (CustomerOrder myOrder : cos) {
			if (myOrder.getForecast() != null && !ForecastStatus.FORECAST.equals(myOrder.getForecast().getForecastStatus())) {
FIRM
				LOG.debug(String.format("Cannot update customer order %s in state %s", myOrder, myOrder.getForecast().getForecastStatus()));

		return myResult;
null
/t
ReplacingCustomerOrderReplenishServiceImpl.getCustomerOrderHeader(String, ReplenishmentAdvice, CustomerOrderReplenishServiceImpl$CustomerOrderReplenishState) line: 58	
		CustomerOrder co = super.getCustomerOrderHeader(aForecastId, aAdvice, aState);
/d
		if (co == null) {
			return null;
/t
ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).executeReplenishmentAdvice(ReplenishmentAdvice, CustomerOrderReplenishServiceImpl$CustomerOrderReplenishState, ReplenishmentFeedBack) line: 317	
		boolean newCo = false;
		CustomerOrder co = getCustomerOrderHeader(forecastId, aAdvice, aState);
		if (co == null) {
			if (!aState.createLine) {
				LOG.debug("Not creating customer order because quantity is zero");
				return;

/ TODO 
/ We hadden door moeten gaan	, want er komt toch een nieuwe CO en SHO

/ 7	. 

 2016-07-15 09:55:00   | 2016-07-22 17:30:00    | 2016-07-27 14:00:00 | 2016-07-27 23:59:00  | 9803778880 | GOOD | CO000024
344           | R049403LLN8160727 | 76022G  02
 2016-07-15 09:55:00   | 2016-07-22 17:00:00    | 2016-08-22 07:30:00 | 2016-08-22 23:59:00  | 9803778880 | GOOD | CO000021
088           | R049403LLN8160822 | 76022G  02
(2 rows)
R049403lln8160727

/ Kijk op repl forecast screen 	, 
/ op 27-07 Wed zien we CO000024344
/ op 22-07 Wed zien we CO000021088 

/ we geven op 27-07 Wed 2640
/ click 'Save forecast'
/s
EditingReplenishmentAdvicePage.processAdvice() line: 798	

		for (Map<ProjectionPeriod, AdviceView> entry : advices.getObject().values()) {
			for (Entry<ProjectionPeriod, AdviceView> view : entry.entrySet()) {
				AdviceView myAdviceView = view.getValue();
myAdviceView	EditingReplenishmentAdvicePage$AdviceView  (id=22365)	
	advice	ReplenishmentAdvice  (id=22386)	
		quantity	BigDecimal  (id=22397)	
7920.00000
/ Deze zien we op het scherm als advice, vlak boven Planned receipts (het vakje)	,	 maar ook als Previous planned receipts
/ TODO PAUL

				if (myAdviceView.hasChangedQty()) {
					// get fresh values, just in case the COs were already changed by an other process.
					loadCustomerOrderLines(view.getValue());
/s
EditingReplenishmentAdvicePage.loadCustomerOrderLines(EditingReplenishmentAdvicePage$AdviceView) line: 618	
		aView.setPreviousForecastQty(null);
		aView.setCurrentForecastQty(BigDecimal.ZERO);

		// Work around
		initializeReplenishmentAdvice(aView.getAdvice());

aView	EditingReplenishmentAdvicePage$AdviceView  (id=22365)	
	advice	ReplenishmentAdvice  (id=22386)	
ReplenishmentAdvice[start=Fri Jul 22 00:00:00 CEST 2016,end=Wed Jul 27 00:00:00 CEST 2016,startLocation=SOCAT_WH_FR_TERRASSON LA VILLEDIEU,endLocation=GEODIS_WHS_FR_SOCHAUX,product=9803778880 (26878521),quantity=7920.00000]
	attached	true	
	currentForecastQty	BigDecimal  (id=19278)	
0
	newForecastQty	BigDecimal  (id=22388)	
2640
	previousForecastQty	null	
null

		List<CustomerOrderLine> previousForecast = customerOrderReplenishService.getPreviousForecast(aView.getAdvice());
/s
ReplacingCustomerOrderReplenishServiceImpl(CustomerOrderReplenishServiceImpl).getPreviousForecast(ReplenishmentAdvice) line: 176	
		final String forecastId = forecastIdGenerator.generateId(aAdvice);
/s
ForecastIdGeneratorImpl.generateId(ReplenishmentAdvice) line: 34	

		StringBuilder sb = new StringBuilder();
		sb.append(prefix);
R
		sb.append(StringUtils.leftPad(StringUtils.right(Integer.toString(aAdvice.getStartLocation().getSystemId(), 36), 4), 4, '0'));
SOCAT_WH_FR_TERRASSON LA VILLEDIEU
R0494
		sb.append(StringUtils.leftPad(StringUtils.right(Integer.toString(aAdvice.getProduct().getSystemId(), 36), 4), 4, '0'));
9803778880 (26878521)
R049403ll
		if (aAdvice.getGoodsStatus() != null) {
			sb.append(StringUtils.leftPad(StringUtils.right(Integer.toString(aAdvice.getGoodsStatus().getSystemId(), 36), 2), 2, '0'));
com.mpobjects.oms.model.entity.goodsstatus.GoodsStatus@4bdc8d6e[GOOD,The products is available]
R049403lln8
		} else {
			sb.append("00");
		}
		SimpleDateFormat sdf = new SimpleDateFormat(dateFormat);
		sb.append(sdf.format(aAdvice.getEnd()));
Wed Jul 27 00:00:00 CEST 2016
R049403lln8160727
		return sb.toString().toUpperCase();
/ HOI HOI HOI
















/ Einde DEBUG GGS-93

/ PSA-563

/ 7 	.	

 In ~/Downloads zijn files met spaces in hun naam	, daarom find -print0	, xargs -0	,
[eric@localhost eclipse-jee-test]$ find ~/Downloads/ -type f -print0 | xargs -0 ls -1tr | awk 'END{print}' | xargs less
...
/ OK
/ Het is een Inventory report van 15 Jun 2016	,
/ find ~/Downloads/ -type f -print0 | xargs -0 ls -1tr	: we geven aan ls alle files	, achter elkaar	,

[eric@localhost bin]$ geosco-pg_dump-p.sh 

[eric@localhost bin]$ find /home/eric/DB_TAP/Postgres/Backup/ -type f | xargs ls -1tr | awk 'END{print}' | xargs local-pg_restore.sh geosco2p3 
/ OK

/ Intermezzo

/ 7	. 

/ postition args in xargs	,

/ Lees	,
http://offbytwo.com/2011/06/26/things-you-didnt-know-about-xargs.html

[eric@localhost bin]$ find /home/eric/DB_TAP/Postgres/Backup/ -type f -print0 | xargs -0 ls -1tr | awk 'END{print}' | xargs -I % echo  % /tmp
/home/eric/DB_TAP/Postgres/Backup/geosco-p-2016-06-20.dump /tmp

/ Lees	, 
http://stackoverflow.com/questions/14639206/how-can-i-pass-all-arguments-with-xargs-in-middle-of-command-in-linux
/ TODO

/ 7	. 

[eric@localhost bin]$ echo 1 2 3 4 5 | xargs -n 2 echo 
1 2
3 4
5

[eric@localhost bin]$ echo 1 2 3 4 5 | xargs -n 2 -I % echo %
1 2 3 4 5

[eric@localhost bin]$  echo 1 2 3 4 5 | xargs -n 2  echo {}
{} 1 2
{} 3 4
{} 5

/ TODO

/ Einde Intermezzo

/ 7	. 

/ Het speelt zich af in acc	, niet prod	.

[vanderveldene@geosco-int-a 15]$ pwd
/local/apps/interface/geodispsa/from-geobus/InventoryReport/archive/2016-06/15
[vanderveldene@geosco-int-a 15]$ ls
14-INVRPT-ID-geosco-int-a-45473-1462932383370-2-923-1-1-1.xml  14-INVRPT-ID-geosco-int-a-45473-1462932383370-2-926-1-1-1.xml
/ Waarom 2?
/ De laatste	, 14-INVRPT-ID-geosco-int-a-45473-1462932383370-2-926-1-1-1.xml,	 is PRE_CORPORATE_TX_ReceptionWPS_SCO.PSA%20.R_OPTILOG_STKADV_ESB749572

/ en 	, 
[vanderveldene@geosco-int-a 15]$ pwd
/local/apps/interface/geodispsa/to-scs/InventoryReport/archive/2016-06/15
[vanderveldene@geosco-int-a 15]$ ls
14-INVRPT-ID-geosco-int-a-45473-1462932383370-2-923-1-1-1.xml  14-INVRPT-ID-geosco-int-a-45473-1462932383370-2-926-1-1-1.xml

/ Ook  14-INVRPT-ID-geosco-int-a-45473-1462932383370-2-926-1-1-1.xml is attached in ticket	,

/ 7	. 

[eric@localhost bin]$ geosco-pg_dump-a.sh 
geosco2p2=# create database geosco0620a;
/ dat is 20 Jun acc	,
[eric@localhost bin]$ geosco-pg_dump-a.sh 
[eric@localhost bin]$ find ~/DB_TAP/Postgres/Backup/ -print0 | xargs -0 ls -1tr | awk 'END{print}' | xargs local-pg_restore.sh geosco0620a 

[eric@localhost bin]$ geosco-scp-from-int-a.sh to-scs/InventoryReport/archive/2016-06/15/14-INVRPT-ID-geosco-int-a-45473-1462932383370-2-926-1-1-1.xml ~/DB_TAP/Postgres/Backup/

/ 7	. 

/ Lees over | vim
http://stackoverflow.com/questions/17713421/why-doesnt-history-vim-work

By piping into vim, you are changing the standard input stream. Because vim is an interactive program, it requires the standard input to be the console.
If you want to view in vim, you should tell it you are reading the file from stdin (by supplying the argument -):

/ 7	. 

/ Einde PSA-563

/ DEBUG PSA-563

/ we sturen in 	,
[eric@localhost tmp]$ find /home/eric/DB_TAP/Postgres/Backup/ -type f | xargs ls -1tr | awk 'END{print}' | xargs gedit
/ =
/home/eric/DB_TAP/Postgres/Backup/14-INVRPT-ID-geosco-int-a-45473-1462932383370-2-926-1-1-1.xml
/ we hebben mv naar	,
/home/eric/Integration/Geosco/InventoryReport/archive/2016-06/15

/s
MpoMessageListener.onMessage(Message) line: 194	
...
/s
StockTransactionMsgProcessor.process(Node) line: 53	
			for (Node myNode : selectNodeIterable(aNode, StockTransactionBodyProcessor.STOCK_TRANSACTION_GROUP_TAG)) {
				StockTransactionBodyProcessor myProcessor = new StockTransactionBodyProcessor();
/s
StockTransactionBodyProcessor.process(Node) line: 74	
			StockTransaction myStockTransaction = new StockTransaction();
...
			myStockTransaction.setTransactionType(StockTransactionType.COUNT);
			myStockTransaction.setDirty(true);
			return myStockTransaction;
/t
StockTransactionMsgProcessor.process(Node) line: 75	
				myStockTransaction = myProcessor.process(selectSingleNode(myNode, StockTransactionBodyProcessor.STOCK_TRANSACTION_TAG));
/d
				} else if (myPurposeCode.isPartialUpdate() || myPurposeCode.isUpdate()) {
					processUpdate(myStockTransaction);
/s
StockTransactionMsgProcessor.processUpdate(StockTransaction) line: 165	
		processAdd(aStockTransaction);
/s
StockTransactionMsgProcessor.processAdd(StockTransaction) line: 112	
		StockTransaction myStockTransaction = getStockTransactionDAO().getByExternalId(aStockTransaction.getExternalId());
/ FIX PSA-563
/ Deze moet unique zijn .

/ Einde DEBUG PSA-563


/ BARD-170

/ ... Quantity OK
				... RM
						Reference2 ... OK

/ Einde BARD-170

/ POSTGRES

/ 7	. 

foo=>  \d b
              Table "public.b"
 Column |         Type          | Modifiers 
--------+-----------------------+-----------
 i      | integer               | 
 s      | character varying(32) | 
 p      | character(1)          | 

foo=> insert into b values(1,'foo','a'),(2,'bar','a'),(3,'baz','a');
foo=> insert into b values(11,'fee','b'),(12,'ber','b'),(13,'bez','b'); 

foo=> select p,max(i)
from b 
group by p;
 p | max 
---+-----
 b |  13
 a |   3
(2 rows)

/ 7	. 

/ row met max in een column	,

/ Lees	,
http://stackoverflow.com/questions/121387/fetch-the-row-which-has-the-max-value-for-a-column

/ 13	. 

foo=> create table c(i int,v int,d date);
CREATE TABLE
foo=> commit;
COMMIT
foo=> insert into c values(1,11,'9jun2016');
INSERT 0 1
foo=> insert into c values(1,12,'10jun2016');
INSERT 0 1
foo=> insert into c values(2,21,'9jun2016');
INSERT 0 1
foo=> insert into c values(2,22,'10jun2016');
INSERT 0 1
foo=> select*from c;
 i | v  |     d      
---+----+------------
 1 | 11 | 2016-06-09
 1 | 12 | 2016-06-10
 2 | 21 | 2016-06-09
 2 | 22 | 2016-06-10
(4 rows)

foo=> select i,v
from c
where d=(
    select max(d)
    from c c2
    where c2.i=c.i
)
;
 i | v  
---+----
 1 | 12
 2 | 22
(2 rows)

/ 13	. 

/ Eerst	,

foo=> select c1.*,c2.*
foo-> from c c1
foo-> left outer join  c c2 on (c1.i=c2.i and c1.d<c2.d);
 i | v  |     d      |  i   |  v   |     d      
---+----+------------+------+------+------------
 1 | 11 | 2016-06-09 |    1 |   12 | 2016-06-10
 1 | 12 | 2016-06-10 | NULL | NULL | NULL				/ is er niet , want linker is maximaal	,
 2 | 21 | 2016-06-09 |    2 |   22 | 2016-06-10
 2 | 22 | 2016-06-10 | NULL | NULL | NULL
(4 rows)

/ Dus 	,
 
select c1.*,c2.*
from c c1
left outer join  c c2 on (c1.i=c2.i and c1.d<c2.d)
where c2.i is null;
 i | v  |     d      
---+----+------------
 1 | 12 | 2016-06-10
 2 | 22 | 2016-06-10
(2 rows)

/ 13	. 

/ Dezelfde 13 als hierboven	, maar in geval van meerdere rows	,

drop table c;
create table c(id int,i int,v int,d date);
insert into c values(1,1,11,'9jun2016');
insert into c values(2,1,12,'10jun2016');
insert into c values(3,1,12,'10jun2016');
insert into c values(4,2,21,'9jun2016');
insert into c values(5,2,22,'10jun2016');
insert into c values(6,2,22,'10jun2016');
commit;
 
foo=> select c1.*,c2.*
foo-> from c c1
foo-> left outer join c c2 on c1.i=c2.i and c1.d<c2.d
foo-> ;
 id | i | v  |     d      |  id  |  i   |  v   |     d      
----+---+----+------------+------+------+------+------------
  1 | 1 | 11 | 2016-06-09 |    2 |    1 |   12 | 2016-06-10
  1 | 1 | 11 | 2016-06-09 |    3 |    1 |   12 | 2016-06-10
  2 | 1 | 12 | 2016-06-10 | NULL | NULL | NULL | NULL
  3 | 1 | 12 | 2016-06-10 | NULL | NULL | NULL | NULL
  4 | 2 | 21 | 2016-06-09 |    5 |    2 |   22 | 2016-06-10
  4 | 2 | 21 | 2016-06-09 |    6 |    2 |   22 | 2016-06-10
  5 | 2 | 22 | 2016-06-10 | NULL | NULL | NULL | NULL
  6 | 2 | 22 | 2016-06-10 | NULL | NULL | NULL | NULL

foo=> select c1.*,c2.*
from c c1
left outer join c c2 on c1.i=c2.i and c1.d<c2.d
where c2.i is null;
 id | i | v  |     d      |  id  |  i   |  v   |  d   
----+---+----+------------+------+------+------+------
  2 | 1 | 12 | 2016-06-10 | NULL | NULL | NULL | NULL
  3 | 1 | 12 | 2016-06-10 | NULL | NULL | NULL | NULL
  5 | 2 | 22 | 2016-06-10 | NULL | NULL | NULL | NULL
  6 | 2 | 22 | 2016-06-10 | NULL | NULL | NULL | NULL
(4 rows)

/ Dit is NIET OK	,

foo=> select c1.*,c2.*
foo-> from c c1
foo-> left outer join c c2 on c1.i=c2.i and (c1.d<c2.d or (c1.d=c2.d and c1.id<c2.id));
 id | i | v  |     d      |  id  |  i   |  v   |     d      
----+---+----+------------+------+------+------+------------
  1 | 1 | 11 | 2016-06-09 |    2 |    1 |   12 | 2016-06-10
  1 | 1 | 11 | 2016-06-09 |    3 |    1 |   12 | 2016-06-10
  2 | 1 | 12 | 2016-06-10 |    3 |    1 |   12 | 2016-06-10
  3 | 1 | 12 | 2016-06-10 | NULL | NULL | NULL | NULL
  4 | 2 | 21 | 2016-06-09 |    5 |    2 |   22 | 2016-06-10
  4 | 2 | 21 | 2016-06-09 |    6 |    2 |   22 | 2016-06-10
  5 | 2 | 22 | 2016-06-10 |    6 |    2 |   22 | 2016-06-10
  6 | 2 | 22 | 2016-06-10 | NULL | NULL | NULL | NULL

/ Nu zijn er per i maar 1 row met NULL's	,


select c1.*
from c c1
left outer join c c2 on c1.i=c2.i and (c1.d<c2.d or (c1.d=c2.d and c1.id<c2.id))
where c2.i is null;

foo=> select c1.*
foo-> from c c1
foo-> left outer join c c2 on c1.i=c2.i and (c1.d<c2.d or (c1.d=c2.d and c1.id<c2.id))
foo-> where c2.i is null;
 id | i | v  |     d      
----+---+----+------------
  3 | 1 | 12 | 2016-06-10
  6 | 2 | 22 | 2016-06-10
(2 rows)

/ 7	. 

foo=> select i,max(v)
foo-> from c
foo-> group by i;
 i | max 
---+-----
 1 |  12
 2 |  22
(2 rows)

/ 7	. 

drop table a;
create table a(id int,i int,s char(1),t char(1),j int);
insert into a values(1,1,'a','a',1); 
insert into a values(2,3,'b','a',1); 
insert into a values(3,5,'c','a',1); 
insert into a values(4,7,'a','a',2); 
insert into a values(5,10,'b','a',2); 
insert into a values(6,16,'c','a',2); 
insert into a values(7,17,'a','b',1); 
insert into a values(8,21,'b','b',1); 
insert into a values(9,24,'c','b',1); 
insert into a values(10,28,'a','b',2); 
insert into a values(11,29,'b','b',2); 
insert into a values(12,34,'c','b',2); 
commit;

/ t,j=sku	,

/13	. 

foo=> select t,j,max(i)
foo-> from a
foo-> group by t,j;'
 t | j | max 
---+---+-----
 b | 1 |   9
 a | 1 |   3
 a | 2 |   6
 b | 2 |  12
(4 rows)
/ OK

/ 13	. 

/ Maar willen we niet	, we willen bijv de max(i) doen alleen in group t,j='a',1

foo=> select max(i)
foo-> from a
foo-> where t='a'
foo-> and j=1;
 max 
-----
   3
(1 row)
/ OK

/ 13	. 

/ we willen de row met de max(i)	, in de group van t,j='a',1	,

select a1.*
from a a1
where t='a' 
and j=1
and i=(
	select max(a2.i)
	from a a2
	where t='a'
	and j=1
)
 i | s | t | j 
---+---+---+---
 3 | c | a | 1
(1 row)

/ Kan dit makkelijker	?
/ TODO

select a1.*
from a a1
where j=1
and i=(
	select max(a2.i)
	from a a2
	where j=1
)
 i | s | t | j 
---+---+---+---
 3 | c | a | 1
(1 row)

/ 1313

foo=> select a1.*
from a a1
where j=1 
and i=(
    select max(a2.i)
    from a a2
    where j=1 
)
;
 i | s | t | j 
---+---+---+---
 9 | c | b | 1
(1 row)

/ 1313	. 

select a1.*
from a a1
where a1.i=(
    select max(a2.i)
    from a a2
    where j=1 
	and t='a'
)
;
/ OK

/ 1313	.

foo=> select*from a;
 id | i  | s | t | j 
----+----+---+---+---
  1 |  1 | a | a | 1
  2 |  3 | b | a | 1
  3 |  5 | c | a | 1
  4 |  7 | a | a | 2
  5 | 10 | b | a | 2
  6 | 16 | c | a | 2
  7 | 17 | a | b | 1
  8 | 21 | b | b | 1
  9 | 24 | c | b | 1
 10 | 28 | a | b | 2
 11 | 29 | b | b | 2
 12 | 34 | c | b | 2
(12 rows)

/ t,j=sku

select *
from a
where id>(
	select id
	from a
	where id=7
)
limit 1
/ OK
 id | i  | s | t | j 
----+----+---+---+---
  8 | 21 | b | b | 1
(1 row)


select *
from a
where t='a'
and j=1
and id>(
	select id
	from a
	where t='a'
	and j=1 
)
limit 1
/ ERR
/ er zijn meerdere id's in de subselect,	

/ 1313	.

select a1.* ,a2.*
from a a1
join a a2  using(t,j)
where a1.t='a' 
and a1.j=1
--and a1.i>a2.i

/ 13	.

//////////////////////////////
/ Find rows bij een bepaalde sku, die forecast_in & on_balance=true,  en vind de voorlaatste row (in de tijd)	,

/ de 1ste query is PREVIOUS1	, de 2de  PREVIOUS2	,
/ Ook voor alles sku's : PREVIOUS3	,


drop table a;
create table a(id int,i int,d date,s char(1),t char(1),j int);
insert into a values(1,1,'1jun2016','a','a',1); 
insert into a values(2,3,'2jun2016','b','a',1); 
insert into a values(3,5,'3jun2016','c','a',1); 
insert into a values(4,7,'4jun2016','a','a',1); 
insert into a values(5,10,'7jun2016','b','a',1); 
insert into a values(6,16,'11jun2016','c','a',1); 
insert into a values(7,17,'15jun2016','a','a',1); 
insert into a values(8,21,'21jun2016','b','a',1); 
insert into a values(9,24,'22jun2016','c','a',1); 
insert into a values(10,28,'25jun2016','a','a',1); 
insert into a values(11,29,'27jun2016','b','a',1); 
insert into a values(12,34,'30jun2016','c','a',1); 
commit;

/ t,j=sku	,

select*
from a
where s='a'
and t='a'
and j=1

foo=> select*from a;
 id | i  |     d      | s | t | j 
----+----+------------+---+---+---
  1 |  1 | 2016-06-01 | a | a | 1
  2 |  3 | 2016-06-02 | b | a | 1
  3 |  5 | 2016-06-03 | c | a | 1
  4 |  7 | 2016-06-04 | a | a | 1
  5 | 10 | 2016-06-07 | b | a | 1
  6 | 16 | 2016-06-11 | c | a | 1
  7 | 17 | 2016-06-15 | a | a | 1
  8 | 21 | 2016-06-21 | b | a | 1
  9 | 24 | 2016-06-22 | c | a | 1
 10 | 28 | 2016-06-25 | a | a | 1
 11 | 29 | 2016-06-27 | b | a | 1
 12 | 34 | 2016-06-30 | c | a | 1
(12 rows)

foo=> select*       
from a
where s='b'							/ forcast_in & on_balance=true
and t='a' and j=1;					/ sku
 id | i  |     d      | s | t | j 
----+----+------------+---+---+---
  2 |  3 | 2016-06-02 | b | a | 1
  5 | 10 | 2016-06-07 | b | a | 1
  8 | 21 | 2016-06-21 | b | a | 1
 11 | 29 | 2016-06-27 | b | a | 1
(4 rows)


/////////////////////////////////////////////////////////////////////////////

/ PREVIOUS1

/ Zo kan het	,

select a1.*,a2.*
from a a1
join a a2 using(t,j) 
where a1.s='b'
and a1.t='a' and j=1
and a2.d=(
	select max(a3.d)
	from a a3
	where a3.d<a1.d
)
 id | i  |     d      | s | t | j | id | i  |     d      | s | t | j 
----+----+------------+---+---+---+----+----+------------+---+---+---
  2 |  3 | 2016-06-02 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1
  5 | 10 | 2016-06-07 | b | a | 1 |  4 |  7 | 2016-06-04 | a | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 |  7 | 17 | 2016-06-15 | a | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 | 10 | 28 | 2016-06-25 | a | a | 1
(4 rows)
//////////////////////////////////////////////////////////////////////////////

/ 13

/ Maar kan het ook makkelijker?

/ Hieronder PREVIOUS2

select a1.*,a2.*
from a a1
join a a2 using(t,j)
where a1.s='b'
and a1.t='a' and j=1
 id | i  |     d      | s | t | j | id | i  |     d      | s | t | j 
----+----+------------+---+---+---+----+----+------------+---+---+---
  2 |  3 | 2016-06-02 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1
  2 |  3 | 2016-06-02 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1
  2 |  3 | 2016-06-02 | b | a | 1 |  3 |  5 | 2016-06-03 | c | a | 1
  2 |  3 | 2016-06-02 | b | a | 1 |  4 |  7 | 2016-06-04 | a | a | 1
  2 |  3 | 2016-06-02 | b | a | 1 |  5 | 10 | 2016-06-07 | b | a | 1
  2 |  3 | 2016-06-02 | b | a | 1 |  6 | 16 | 2016-06-11 | c | a | 1
  2 |  3 | 2016-06-02 | b | a | 1 |  7 | 17 | 2016-06-15 | a | a | 1
  2 |  3 | 2016-06-02 | b | a | 1 |  8 | 21 | 2016-06-21 | b | a | 1
  2 |  3 | 2016-06-02 | b | a | 1 |  9 | 24 | 2016-06-22 | c | a | 1
  2 |  3 | 2016-06-02 | b | a | 1 | 10 | 28 | 2016-06-25 | a | a | 1
  2 |  3 | 2016-06-02 | b | a | 1 | 11 | 29 | 2016-06-27 | b | a | 1
  2 |  3 | 2016-06-02 | b | a | 1 | 12 | 34 | 2016-06-30 | c | a | 1
  5 | 10 | 2016-06-07 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1
  5 | 10 | 2016-06-07 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1
  5 | 10 | 2016-06-07 | b | a | 1 |  3 |  5 | 2016-06-03 | c | a | 1
  5 | 10 | 2016-06-07 | b | a | 1 |  4 |  7 | 2016-06-04 | a | a | 1
  5 | 10 | 2016-06-07 | b | a | 1 |  5 | 10 | 2016-06-07 | b | a | 1
  5 | 10 | 2016-06-07 | b | a | 1 |  6 | 16 | 2016-06-11 | c | a | 1
  5 | 10 | 2016-06-07 | b | a | 1 |  7 | 17 | 2016-06-15 | a | a | 1
  5 | 10 | 2016-06-07 | b | a | 1 |  8 | 21 | 2016-06-21 | b | a | 1
  5 | 10 | 2016-06-07 | b | a | 1 |  9 | 24 | 2016-06-22 | c | a | 1
  5 | 10 | 2016-06-07 | b | a | 1 | 10 | 28 | 2016-06-25 | a | a | 1
  5 | 10 | 2016-06-07 | b | a | 1 | 11 | 29 | 2016-06-27 | b | a | 1
  5 | 10 | 2016-06-07 | b | a | 1 | 12 | 34 | 2016-06-30 | c | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 |  3 |  5 | 2016-06-03 | c | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 |  4 |  7 | 2016-06-04 | a | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 |  5 | 10 | 2016-06-07 | b | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 |  6 | 16 | 2016-06-11 | c | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 |  7 | 17 | 2016-06-15 | a | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 |  8 | 21 | 2016-06-21 | b | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 |  9 | 24 | 2016-06-22 | c | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 | 10 | 28 | 2016-06-25 | a | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 | 11 | 29 | 2016-06-27 | b | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 | 12 | 34 | 2016-06-30 | c | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 |  3 |  5 | 2016-06-03 | c | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 |  4 |  7 | 2016-06-04 | a | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 |  5 | 10 | 2016-06-07 | b | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 |  6 | 16 | 2016-06-11 | c | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 |  7 | 17 | 2016-06-15 | a | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 |  8 | 21 | 2016-06-21 | b | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 |  9 | 24 | 2016-06-22 | c | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 | 10 | 28 | 2016-06-25 | a | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 | 11 | 29 | 2016-06-27 | b | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 | 12 | 34 | 2016-06-30 | c | a | 1
(48 rows)

select a1.*,a2.*
from a a1
join a a2 on a1.t=a2.t and a1.j=a2.j and a2.d<a1.d
where a1.s='b'
and a1.t='a' and a1.j=1;

 id | i  |     d      | s | t | j | id | i  |     d      | s | t | j 
----+----+------------+---+---+---+----+----+------------+---+---+---
  2 |  3 | 2016-06-02 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1
  5 | 10 | 2016-06-07 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1
  5 | 10 | 2016-06-07 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1
  5 | 10 | 2016-06-07 | b | a | 1 |  3 |  5 | 2016-06-03 | c | a | 1
  5 | 10 | 2016-06-07 | b | a | 1 |  4 |  7 | 2016-06-04 | a | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 |  3 |  5 | 2016-06-03 | c | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 |  4 |  7 | 2016-06-04 | a | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 |  5 | 10 | 2016-06-07 | b | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 |  6 | 16 | 2016-06-11 | c | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 |  7 | 17 | 2016-06-15 | a | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 |  3 |  5 | 2016-06-03 | c | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 |  4 |  7 | 2016-06-04 | a | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 |  5 | 10 | 2016-06-07 | b | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 |  6 | 16 | 2016-06-11 | c | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 |  7 | 17 | 2016-06-15 | a | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 |  8 | 21 | 2016-06-21 | b | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 |  9 | 24 | 2016-06-22 | c | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 | 10 | 28 | 2016-06-25 | a | a | 1
(22 rows)


select a1.*,a2.*,a3.*
from a a1
join a a2 on a1.t=a2.t and a1.j=a2.j and a1.d>a2.d
left outer join a a3 on a1.t=a3.t and a1.j=a3.j and a1.d>a3.d and a3.d>a2.d
where a1.s='b'
and a1.t='a' and a1.j=1;

 id | i  |     d      | s | t | j | id | i  |     d      | s | t | j |  id  |  i   |     d      |  s   |  t   |  j   
----+----+------------+---+---+---+----+----+------------+---+---+---+------+------+------------+------+------+------
  2 |  3 | 2016-06-02 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1 | NULL | NULL | NULL       | NULL | NULL | NULL
  5 | 10 | 2016-06-07 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1 |    2 |    3 | 2016-06-02 | b    | a    |    1
  5 | 10 | 2016-06-07 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1 |    3 |    5 | 2016-06-03 | c    | a    |    1
  5 | 10 | 2016-06-07 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1 |    4 |    7 | 2016-06-04 | a    | a    |    1
  5 | 10 | 2016-06-07 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1 |    3 |    5 | 2016-06-03 | c    | a    |    1
  5 | 10 | 2016-06-07 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1 |    4 |    7 | 2016-06-04 | a    | a    |    1
  5 | 10 | 2016-06-07 | b | a | 1 |  3 |  5 | 2016-06-03 | c | a | 1 |    4 |    7 | 2016-06-04 | a    | a    |    1
  5 | 10 | 2016-06-07 | b | a | 1 |  4 |  7 | 2016-06-04 | a | a | 1 | NULL | NULL | NULL       | NULL | NULL | NULL
  8 | 21 | 2016-06-21 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1 |    2 |    3 | 2016-06-02 | b    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1 |    3 |    5 | 2016-06-03 | c    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1 |    4 |    7 | 2016-06-04 | a    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1 |    5 |   10 | 2016-06-07 | b    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1 |    6 |   16 | 2016-06-11 | c    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1 |    7 |   17 | 2016-06-15 | a    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1 |    3 |    5 | 2016-06-03 | c    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1 |    4 |    7 | 2016-06-04 | a    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1 |    5 |   10 | 2016-06-07 | b    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1 |    6 |   16 | 2016-06-11 | c    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1 |    7 |   17 | 2016-06-15 | a    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  3 |  5 | 2016-06-03 | c | a | 1 |    4 |    7 | 2016-06-04 | a    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  3 |  5 | 2016-06-03 | c | a | 1 |    5 |   10 | 2016-06-07 | b    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  3 |  5 | 2016-06-03 | c | a | 1 |    6 |   16 | 2016-06-11 | c    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  3 |  5 | 2016-06-03 | c | a | 1 |    7 |   17 | 2016-06-15 | a    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  4 |  7 | 2016-06-04 | a | a | 1 |    5 |   10 | 2016-06-07 | b    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  4 |  7 | 2016-06-04 | a | a | 1 |    6 |   16 | 2016-06-11 | c    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  4 |  7 | 2016-06-04 | a | a | 1 |    7 |   17 | 2016-06-15 | a    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  5 | 10 | 2016-06-07 | b | a | 1 |    6 |   16 | 2016-06-11 | c    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  5 | 10 | 2016-06-07 | b | a | 1 |    7 |   17 | 2016-06-15 | a    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  6 | 16 | 2016-06-11 | c | a | 1 |    7 |   17 | 2016-06-15 | a    | a    |    1
  8 | 21 | 2016-06-21 | b | a | 1 |  7 | 17 | 2016-06-15 | a | a | 1 | NULL | NULL | NULL       | NULL | NULL | NULL
 11 | 29 | 2016-06-27 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1 |    2 |    3 | 2016-06-02 | b    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1 |    3 |    5 | 2016-06-03 | c    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1 |    4 |    7 | 2016-06-04 | a    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1 |    5 |   10 | 2016-06-07 | b    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1 |    6 |   16 | 2016-06-11 | c    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1 |    7 |   17 | 2016-06-15 | a    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1 |    8 |   21 | 2016-06-21 | b    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1 |    9 |   24 | 2016-06-22 | c    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1 |   10 |   28 | 2016-06-25 | a    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1 |    3 |    5 | 2016-06-03 | c    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1 |    4 |    7 | 2016-06-04 | a    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1 |    5 |   10 | 2016-06-07 | b    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1 |    6 |   16 | 2016-06-11 | c    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1 |    7 |   17 | 2016-06-15 | a    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1 |    8 |   21 | 2016-06-21 | b    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1 |    9 |   24 | 2016-06-22 | c    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  2 |  3 | 2016-06-02 | b | a | 1 |   10 |   28 | 2016-06-25 | a    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  3 |  5 | 2016-06-03 | c | a | 1 |    4 |    7 | 2016-06-04 | a    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  3 |  5 | 2016-06-03 | c | a | 1 |    5 |   10 | 2016-06-07 | b    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  3 |  5 | 2016-06-03 | c | a | 1 |    6 |   16 | 2016-06-11 | c    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  3 |  5 | 2016-06-03 | c | a | 1 |    7 |   17 | 2016-06-15 | a    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  3 |  5 | 2016-06-03 | c | a | 1 |    8 |   21 | 2016-06-21 | b    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  3 |  5 | 2016-06-03 | c | a | 1 |    9 |   24 | 2016-06-22 | c    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  3 |  5 | 2016-06-03 | c | a | 1 |   10 |   28 | 2016-06-25 | a    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  4 |  7 | 2016-06-04 | a | a | 1 |    5 |   10 | 2016-06-07 | b    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  4 |  7 | 2016-06-04 | a | a | 1 |    6 |   16 | 2016-06-11 | c    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  4 |  7 | 2016-06-04 | a | a | 1 |    7 |   17 | 2016-06-15 | a    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  4 |  7 | 2016-06-04 | a | a | 1 |    8 |   21 | 2016-06-21 | b    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  4 |  7 | 2016-06-04 | a | a | 1 |    9 |   24 | 2016-06-22 | c    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  4 |  7 | 2016-06-04 | a | a | 1 |   10 |   28 | 2016-06-25 | a    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  5 | 10 | 2016-06-07 | b | a | 1 |    6 |   16 | 2016-06-11 | c    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  5 | 10 | 2016-06-07 | b | a | 1 |    7 |   17 | 2016-06-15 | a    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  5 | 10 | 2016-06-07 | b | a | 1 |    8 |   21 | 2016-06-21 | b    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  5 | 10 | 2016-06-07 | b | a | 1 |    9 |   24 | 2016-06-22 | c    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  5 | 10 | 2016-06-07 | b | a | 1 |   10 |   28 | 2016-06-25 | a    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  6 | 16 | 2016-06-11 | c | a | 1 |    7 |   17 | 2016-06-15 | a    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  6 | 16 | 2016-06-11 | c | a | 1 |    8 |   21 | 2016-06-21 | b    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  6 | 16 | 2016-06-11 | c | a | 1 |    9 |   24 | 2016-06-22 | c    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  6 | 16 | 2016-06-11 | c | a | 1 |   10 |   28 | 2016-06-25 | a    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  7 | 17 | 2016-06-15 | a | a | 1 |    8 |   21 | 2016-06-21 | b    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  7 | 17 | 2016-06-15 | a | a | 1 |    9 |   24 | 2016-06-22 | c    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  7 | 17 | 2016-06-15 | a | a | 1 |   10 |   28 | 2016-06-25 | a    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  8 | 21 | 2016-06-21 | b | a | 1 |    9 |   24 | 2016-06-22 | c    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  8 | 21 | 2016-06-21 | b | a | 1 |   10 |   28 | 2016-06-25 | a    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 |  9 | 24 | 2016-06-22 | c | a | 1 |   10 |   28 | 2016-06-25 | a    | a    |    1
 11 | 29 | 2016-06-27 | b | a | 1 | 10 | 28 | 2016-06-25 | a | a | 1 | NULL | NULL | NULL       | NULL | NULL | NULL
(76 rows)

////////////////////////////////////////////////////////////////////////////////
/ PREVIOUS 2 
select a1.*,a2.*
from a a1
join a a2 on a1.t=a2.t and a1.j=a2.j and a1.d>a2.d
left outer join a a3 on a1.t=a3.t and a1.j=a3.j and a1.d>a3.d and a3.d>a2.d		-- to find max in a2	,
where a1.s='b'																	-- forecast_in , on_balance=true
and a1.t='a' and a1.j=1															-- sku
and a3.d is null;
 id | i  |     d      | s | t | j | id | i  |     d      | s | t | j 
----+----+------------+---+---+---+----+----+------------+---+---+---
  2 |  3 | 2016-06-02 | b | a | 1 |  1 |  1 | 2016-06-01 | a | a | 1
  5 | 10 | 2016-06-07 | b | a | 1 |  4 |  7 | 2016-06-04 | a | a | 1
  8 | 21 | 2016-06-21 | b | a | 1 |  7 | 17 | 2016-06-15 | a | a | 1
 11 | 29 | 2016-06-27 | b | a | 1 | 10 | 28 | 2016-06-25 | a | a | 1
(4 rows)
/////////////////////////////////////////////////////////////////////////////////

/ 13	. 

/ Nu voor alle sku's	,
/ we hebben antwoord in PREVIOUS3

drop table a;
create table a(id int,i int,d date,s char(1),t char(1),j int);
insert into a values(1,1,'1jun2016','a','a',1); 
insert into a values(2,3,'2jun2016','b','a',1); 
insert into a values(3,5,'3jun2016','c','a',1); 
insert into a values(4,7,'4jun2016','a','a',1); 
insert into a values(5,10,'7jun2016','b','a',1); 
insert into a values(6,16,'11jun2016','c','a',1); 
insert into a values(7,17,'15jun2016','a','a',1); 
insert into a values(8,21,'21jun2016','b','a',1); 
insert into a values(9,24,'22jun2016','c','a',1); 
insert into a values(10,28,'25jun2016','a','a',1); 
insert into a values(11,29,'27jun2016','b','a',1); 
insert into a values(12,34,'30jun2016','c','a',1); 

insert into a values(11,1,'1jun2016','a','a',2);
insert into a values(12,3,'2jun2016','b','a',2);
insert into a values(13,5,'3jun2016','c','a',2);
insert into a values(14,7,'4jun2016','a','a',2);
insert into a values(15,10,'7jun2016','b','a',2);
insert into a values(16,16,'11jun2016','c','a',2);
insert into a values(17,17,'15jun2016','a','a',2);
insert into a values(18,21,'21jun2016','b','a',2);
insert into a values(19,24,'22jun2016','c','a',2);
insert into a values(110,28,'25jun2016','a','a',2);
insert into a values(111,29,'27jun2016','b','a',2);
insert into a values(112,34,'30jun2016','c','a',2);

commit;

-- t,j=sku	,
-- s=forecast_in & on_balance=true

/ Intermezzo

/ De laatste rows hebben we gemaakt met awk	,

[eric@localhost conf]$ awk '{gsub(/values\(/,"values(1");print}' | awk '{gsub(/1);$/,"2);");print}'
insert into a values(1,1,'1jun2016','a','a',1);
insert into a values(2,3,'2jun2016','b','a',1);
insert into a values(3,5,'3jun2016','c','a',1);
insert into a values(4,7,'4jun2016','a','a',1);
insert into a values(5,10,'7jun2016','b','a',1);
insert into a values(6,16,'11jun2016','c','a',1);
insert into a values(7,17,'15jun2016','a','a',1);
insert into a values(8,21,'21jun2016','b','a',1);
insert into a values(9,24,'22jun2016','c','a',1);
insert into a values(10,28,'25jun2016','a','a',1);
insert into a values(11,29,'27jun2016','b','a',1);
insert into a values(12,34,'30jun2016','c','a',1);
^d

/ we kunnen ook "" ipv //	, maar dan moeten we \\( ipv \(	,
/ ) hoeven we niet te escape	,

[eric@localhost eclipse-interfacing-testing]$ awk '{gsub("values\\(","values(1");print}' | awk '{gsub("1);$","2);");print}'
insert into a values(2,3,'2jun2016','b','a',1);
^d
insert into a values(12,3,'2jun2016','b','a',2);

[eric@localhost eclipse-interfacing-testing]$ awk '{gsub("values\\(","values(1");print}' | awk '{gsub("'a',1);","'a',2);");print}'
insert into a values(2,3,'2jun2016','b','a',1);
^d
insert into a values(12,3,'2jun2016','b','a',1);
/ ERR	,
/ TODO

/ Einde Intermezzo


select a1.*,a2.*
from a a1
join a a2 on a1.t=a2.t and a1.j=a2.j and a1.d>a2.d
left outer join a a3 on a1.t=a3.t and a1.j=a3.j and a1.d>a3.d and a3.d>a2.d		-- to find max in a2	,
where a1.s='b'																	-- forecast_in , on_balance=true
and a1.t='a' and a1.j=1															-- sku
and a3.d is null;
/ OK

select a1.*,a2.*
from a a1
join a a2 on a1.t=a2.t and a1.j=a2.j and a1.d>a2.d
left outer join a a3 on a1.t=a3.t and a1.j=a3.j and a1.d>a3.d and a3.d>a2.d		-- to find max in a2	,
where a1.s='b'																	-- forecast_in , on_balance=true
and a3.d is null;
group by a1.t,a1.j																-- sku
ERROR:  column "a1.id" must appear in the GROUP BY clause or be used in an aggregate function
/ TODO

/ Oef	,
select a1.*,a2.*
from a a1
join (select distinct t,j from a) a2 using(t,j)
where a1.s='b'									
 id  | i  |     d      | s | t | j | t | j 
-----+----+------------+---+---+---+---+---
  11 | 29 | 2016-06-27 | b | a | 1 | a | 1
   8 | 21 | 2016-06-21 | b | a | 1 | a | 1
   5 | 10 | 2016-06-07 | b | a | 1 | a | 1
   2 |  3 | 2016-06-02 | b | a | 1 | a | 1
 111 | 29 | 2016-06-27 | b | a | 2 | a | 2
  18 | 21 | 2016-06-21 | b | a | 2 | a | 2
  15 | 10 | 2016-06-07 | b | a | 2 | a | 2
  12 |  3 | 2016-06-02 | b | a | 2 | a | 2
(8 rows)

/////////////////////////////////////////////////////
/ PREVIOUS3
select a1.*,a2.*
from a a1
join a a2 on a1.t=a2.t and a1.j=a2.j and a1.d>a2.d
left outer join a a3 on a1.t=a3.t and a1.j=a3.j and a1.d>a3.d and a3.d>a2.d		-- to find max in a2	,
join (select distinct t,j from a) a4 on a1.t=a4.t and a1.j=a4.j
where a1.s='b'																	-- forecast_in , on_balance=true
and a3.d is null;
 id  | i  |     d      | s | t | j | id  | i  |     d      | s | t | j 
-----+----+------------+---+---+---+-----+----+------------+---+---+---
   2 |  3 | 2016-06-02 | b | a | 1 |   1 |  1 | 2016-06-01 | a | a | 1
   5 | 10 | 2016-06-07 | b | a | 1 |   4 |  7 | 2016-06-04 | a | a | 1
   8 | 21 | 2016-06-21 | b | a | 1 |   7 | 17 | 2016-06-15 | a | a | 1
  11 | 29 | 2016-06-27 | b | a | 1 |  10 | 28 | 2016-06-25 | a | a | 1
  12 |  3 | 2016-06-02 | b | a | 2 |  11 |  1 | 2016-06-01 | a | a | 2
  15 | 10 | 2016-06-07 | b | a | 2 |  14 |  7 | 2016-06-04 | a | a | 2
  18 | 21 | 2016-06-21 | b | a | 2 |  17 | 17 | 2016-06-15 | a | a | 2
 111 | 29 | 2016-06-27 | b | a | 2 | 110 | 28 | 2016-06-25 | a | a | 2
(8 rows)

/ 7	. 

/ and or	,

drop table if exists d;
create table d(id int,ts date);
insert into d values(1,'2jun2016');
insert into d values(2,'3jun2016');
insert into d values(3,'3jun2016');
insert into d values(4,'4jun2016');
insert into d values(5,'4jun2016');
commit;
select d1.*,d2.*
from d d1
--join d d2 on d1.ts<d2.ts or d1.ts=d2.ts and d1.id<d2.id
join d d2 on d1.ts<d2.ts
/ OK

/ 7	. 

/ gelijke date's

/ we maken bijv id=5, en id=3 en id=4 hebben dezelfde date	.
/ In a2 krijgen we dan 2 rows	,  met 7 jun	,
/ Daarom doen we in a3 ook 
	a3.d>a2.d  or a3.d=a2.d and a3.id>a2.id
/ ipv alleen	,
	a3.d>a2.d 

drop table a;
create table a(id int,i int,d date,s char(1),t char(1),j int);
insert into a values(1,1,'2jun2016','a','a',1); 
insert into a values(2,3,'2jun2016','b','a',1); 
insert into a values(3,5,'7jun2016','c','a',1); 
insert into a values(4,7,'7jun2016','a','a',1); 
insert into a values(5,10,'7jun2016','b','a',1); 
insert into a values(6,16,'11jun2016','c','a',1); 
insert into a values(7,17,'15jun2016','a','a',1); 
insert into a values(8,21,'21jun2016','b','a',1); 
insert into a values(9,24,'22jun2016','c','a',1); 
insert into a values(10,28,'25jun2016','a','a',1); 
insert into a values(11,29,'27jun2016','b','a',1); 
insert into a values(12,34,'30jun2016','c','a',1); 

insert into a values(11,1,'1jun2016','a','a',2);
insert into a values(12,3,'2jun2016','b','a',2);
insert into a values(13,5,'3jun2016','c','a',2);
insert into a values(14,7,'4jun2016','a','a',2);
insert into a values(15,10,'7jun2016','b','a',2);
insert into a values(16,16,'11jun2016','c','a',2);
insert into a values(17,17,'15jun2016','a','a',2);
insert into a values(18,21,'15jun2016','b','a',2);
insert into a values(19,24,'22jun2016','c','a',2);
insert into a values(110,28,'25jun2016','a','a',2);
insert into a values(111,29,'25jun2016','b','a',2);
insert into a values(112,34,'30jun2016','c','a',2);

commit;

/ we doen eerst in a3	, 
	a3.d>a2.d
/ Maar dan zien we er 2	,

foo=> select a1.*,a2.*,a3.*
foo-> from a a1
foo-> join a a2 on a2.t=a1.t and a2.j=a1.j and (a2.d<a1.d or a2.d=a1.d and a2.id<a1.id)
foo-> left outer join a a3 on a3.t=a1.t and a3.j=a1.j and (a3.d<a1.d or a3.d=a1.d and a3.id<a1.id) and a3.d>a2.d
foo-> join (select distinct t,j from a) a4 on a1.t=a4.t and a1.j=a4.j
foo-> where a1.s='b'
foo-> --and a3.d is null;
foo-> order by a1.id,a2.d;
 id  | i  |     d      | s | t | j | id  | i  |     d      | s | t | j |  id  |  i   |     d      |  s   |  t   |  j   
-----+----+------------+---+---+---+-----+----+------------+---+---+---+------+------+------------+------+------+------
   2 |  3 | 2016-06-02 | b | a | 1 |   1 |  1 | 2016-06-02 | a | a | 1 | NULL | NULL | NULL       | NULL | NULL | NULL
   5 | 10 | 2016-06-07 | b | a | 1 |   1 |  1 | 2016-06-02 | a | a | 1 |    4 |    7 | 2016-06-07 | a    | a    |    1
   5 | 10 | 2016-06-07 | b | a | 1 |   2 |  3 | 2016-06-02 | b | a | 1 |    4 |    7 | 2016-06-07 | a    | a    |    1
   5 | 10 | 2016-06-07 | b | a | 1 |   1 |  1 | 2016-06-02 | a | a | 1 |    3 |    5 | 2016-06-07 | c    | a    |    1
   5 | 10 | 2016-06-07 | b | a | 1 |   2 |  3 | 2016-06-02 | b | a | 1 |    3 |    5 | 2016-06-07 | c    | a    |    1
   5 | 10 | 2016-06-07 | b | a | 1 |   4 |  7 | 2016-06-07 | a | a | 1 | NULL | NULL | NULL       | NULL | NULL | NULL
   5 | 10 | 2016-06-07 | b | a | 1 |   3 |  5 | 2016-06-07 | c | a | 1 | NULL | NULL | NULL       | NULL | NULL | NULL
   8 | 21 | 2016-06-21 | b | a | 1 |   2 |  3 | 2016-06-02 | b | a | 1 |    4 |    7 | 2016-06-07 | a    | a    |    1
   8 | 21 | 2016-06-21 | b | a | 1 |   1 |  1 | 2016-06-02 | a | a | 1 |    4 |    7 | 2016-06-07 | a    | a    |    1


/ Daarom	,
/ PREVIOUS4
select a1.*,a2.*,a3.*
from a a1
join a a2 on a2.t=a1.t and a2.j=a1.j and (a2.d<a1.d or a2.d=a1.d and a2.id<a1.id)
left outer join a a3 on a3.t=a1.t and a3.j=a1.j and (a3.d<a1.d or a3.d=a1.d and a3.id<a1.id) and (a3.d>a2.d  or a3.d=a2.d and a3.id>a2.id)
join (select distinct t,j from a) a4 on a1.t=a4.t and a1.j=a4.j
where a1.s='b'																
--and a3.d is null;
order by a1.id,a2.d
	








/ Einde POSTGRES


/ GGS-67 DEBUG RECALCULATE WHEN APPL STARTS

/ we start de appl	, 
/ hij valt in het recalculate b	, 
/ TODO

/ we komen zo direct in	,

/ stack trace

Thread [internaljms.com.mpobjects.inventory.service.stocktransaction.StockTransactionHandler-1] (Suspended)	
	StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 177	
			for (StockTransaction myNext : myNextList) {
				...
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {

	StockLevelCalculationServiceImpl.recalculate(Product, StockLocation, GoodsStatus) line: 134	
			} else {
				if (recalculate(myTransaction)) {

	StockLevelCalculationServiceImpl.recalculate(StockKeepingUnit) line: 70	
		recalculate(aSku.getProduct(), aSku.getStockLocation(), aSku.getGoodsStatus());

	StockLevelCalculationServiceImpl.handleRequest(StockLevelCalculationRequest) line: 63	
		StockKeepingUnit myStockKeepingUnit = stockKeepingUnitDAO.getBySystemId(aRequest.getStockKeepingUnitSystemId());
		if (myStockKeepingUnit != null) {
			recalculate(myStockKeepingUnit);

	StockTransactionHandlerImpl.processMessageAsRoot(Message) line: 56	
		} else if (serializable instanceof StockLevelCalculationRequest) {
			StockLevelCalculationRequest myRequest = (StockLevelCalculationRequest) serializable;
			LOG.debug("Processing: " + myRequest);
			stockLevelCalculationService.handleRequest(myRequest);

	StockTransactionHandlerImpl(AbstractConsumer).onMessage(Message) line: 49	
message=
ActiveMQObjectMessage {commandId = 41728, responseRequired = false, messageId = ID:localhost.localdomain-34217-1465386863343-4:21:1:1:41519, originalDestination = null, originalTransactionId = null, producerId = ID:localhost.localdomain-34217-1465386863343-4:21:1:1, destination = queue://com.mpobjects.inventory.queue.stocktransaction, transactionId = TX:ID:localhost.localdomain-34217-1465386863343-4:21:103, expiration = 0, timestamp = 1465399131899, arrival = 0, brokerInTime = 1465399131939, brokerOutTime = 1465464432199, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activemq.util.ByteSequence@6e266499, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 1154, properties = null, readOnlyProperties = true, readOnlyBody = true, droppable = false, jmsXGroupFirstForConsumer = false}
			processMessageAsRoot(aMessage);

	/ tx started	, 
/ TODO

/ Deze message gaat WH over 1 sku	, 
/ een invp gaat over allemaal verschillende sku's 	, allen -> COUNT  stock tx's	,


/ 7	. 

/ product 9820100780	,	

/s
StockTransactionHandlerImpl(AbstractConsumer).onMessage(Message) line: 49	
			processMessageAsRoot(aMessage);
/s
StockTransactionHandlerImpl.processMessageAsRoot(Message) line: 56	
		ObjectMessage myMessage = (ObjectMessage) aMessage;
		Serializable serializable = myMessage.getObject();
StockLevelCalculationRequest [27274021]
		if (serializable instanceof Event<?>) {
/ NEE
		} else if (serializable instanceof StockLevelCalculationRequest) {
			StockLevelCalculationRequest myRequest = (StockLevelCalculationRequest) serializable;
			LOG.debug("Processing: " + myRequest);
			stockLevelCalculationService.handleRequest(myRequest);
/s
StockLevelCalculationServiceImpl.handleRequest(StockLevelCalculationRequest) line: 63	
		StockKeepingUnit myStockKeepingUnit = stockKeepingUnitDAO.getBySystemId(aRequest.getStockKeepingUnitSystemId());
		if (myStockKeepingUnit != null) {
			recalculate(myStockKeepingUnit);
/s
StockLevelCalculationServiceImpl.recalculate(StockKeepingUnit) line: 69	
		recalculate(aSku.getProduct(), aSku.getStockLocation(), aSku.getGoodsStatus());
/s
StockLevelCalculationServiceImpl.recalculate(Product, StockLocation, GoodsStatus) line: 131	
			StockTransaction myTransaction = stockTransactionDAO.getFirstDirty(aProduct, aLocation, aStatus);
null
/ Deze doet	,
/ Geef in less -I	, 
from STOCK_TRANSACTION this_ 
left outer join TMS_PRODUCT_ITEM productite2_ on this_.PRODUCT_ITEM_SYSTEMID=productite2_.SYSTEM_ID 
left outer join TMS_PRODUCT_ITEM productite3_ on productite2_.PARENT_SYSTEMID=productite3_.SYSTEM_ID 
inner join ORGANIZATION organizati4_ on this_.ORGANIZATION_SYSTEMID=organizati4_.SYSTEM_ID 
left outer join ORGANIZATION organizati5_ on organizati4_.ORGANIZATION_GROUP=organizati5_.SYSTEM_ID 
where this_.PRODUCT_SYSTEMID=? 
and this_.STOCK_LOCATION_SYSTEMID=? 
and this_.GOODS_STATUS_SYSTEMID=? 
and this_.IS_DIRTY=? 
order by this_.TRANSACTION_DATE asc, this_.SYSTEM_ID asc limit ?
2016-06-09 10:53:57,453 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (internaljms.com.mpobjects.inventory.service.stocktransaction.StockTransactionHandler-1:) binding parameter [1] as [INTEGER] - 27264936
2016-06-09 10:53:57,454 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (internaljms.com.mpobjects.inventory.service.stocktransaction.StockTransactionHandler-1:) binding parameter [2] as [INTEGER] - 26878346
2016-06-09 10:53:57,455 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (internaljms.com.mpobjects.inventory.service.stocktransaction.StockTransactionHandler-1:) binding parameter [3] as [INTEGER] - 26877284
2016-06-09 10:53:57,455 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (internaljms.com.mpobjects.inventory.service.stocktransaction.StockTransactionHandler-1:) binding parameter [4] as [BIT] - true

geosco2p=# select distinct st.transaction_type from stock_transaction st join product p on st.product_systemid=p.system_id where p.productid='' and st.is_dirty != 0;
 transaction_type 
------------------
(0 rows)
/ Klopt, die zijn er niet	,

			if (myTransaction == null) {
				break;

/c
StockLevelCalculationServiceImpl.recalculate(Product, StockLocation, GoodsStatus) line: 126	
aProduct=
9675380280 (26878514)
/ Ook GEEN dirty stock tx's	,

/c
StockLevelCalculationServiceImpl.recalculate(Product, StockLocation, GoodsStatus) line: 126	
aProduct=
9815434180 (26878587)

geosco2p=# select count(st.transaction_type) from stock_transaction st join product p on st.product_systemid=p.system_id where p.productid='9815434180' and st.is_dirty != 0;
 count 
-------
    44
(1 row)
/ Allen COUNT's	,

/c
StockLevelCalculationServiceImpl.recalculate(Product, StockLocation, GoodsStatus) line: 131	
aProduct=
9806313580 (26878527)
			StockTransaction myTransaction = stockTransactionDAO.getFirstDirty(aProduct, aLocation, aStatus);
27392043/COUNT/2016-06-08 05:15:40.0/9806313580 (26878527)/GEODIS_WHS_FR_SOCHAUX/2769.00000/null/true
			} else {
				if (recalculate(myTransaction)) {
/s
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 169	
		aTransaction.setDirty(false);
		if (aTransaction.getTransactionType().equals(StockTransactionType.COUNT)) {
			aTransaction.setCalculatedStockLevel(aTransaction.getQuantity());
2769.00000
			myLastKnownBalance = aTransaction.getQuantity();
		stockTransactionDAO.save(aTransaction);
		// Now recalculate all records until we meet the next count or until done all
		StockTransaction myCurrent = aTransaction;
		main: while (true) {
			List<StockTransaction> myNextList = stockTransactionDAO.getFollowingTransactions(myCurrent, 50);
/ list van 50 stock tx's

/ we zien 	,
/ FOLLOWINGTRANSACTIONS QUERY
select count(*)
from STOCK_TRANSACTION this_ 
left outer join TMS_PRODUCT_ITEM productite2_ on this_.PRODUCT_ITEM_SYSTEMID=productite2_.SYSTEM_ID
left outer join TMS_PRODUCT_ITEM productite3_ on productite2_.PARENT_SYSTEMID=productite3_.SYSTEM_ID
inner join ORGANIZATION organizati4_ on this_.ORGANIZATION_SYSTEMID=organizati4_.SYSTEM_ID
left outer join ORGANIZATION organizati5_ on organizati4_.ORGANIZATION_GROUP=organizati5_.SYSTEM_ID
where this_.PRODUCT_SYSTEMID=26878527
and this_.STOCK_LOCATION_SYSTEMID=26878346
and this_.GOODS_STATUS_SYSTEMID=26877284
and (this_.TRANSACTION_DATE>'2016-06-08 05:15:40.0' or (this_.TRANSACTION_DATE='2016-06-08 05:15:40.0' and this_.SYSTEM_ID>27392043)) 
--order by this_.TRANSACTION_DATE asc, this_.SYSTEM_ID asc;
 count 
-------
   230
(1 row)
/ TODO (Als we order, en vragen count(*)	, dan ERR: de fields waarop je order by, moeten in group by	, of in een aggregate function	,
/ TODO (Vergl. met stockTransactionDAO.getFollowingTransactions)

			for (StockTransaction myNext : myNextList) {
myNext=

				if (myNext.getTransactionType().equals(StockTransactionType.COUNT)) {
					break main;
				}
/ Klopt	, als je een COUNT tegenkomt	, stop dan	,

/ In de db zien we dat alle 230 niet dirty zijn	,

				myCurrent = myNext;
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
myCurrent=
FORECAST_IN
myLastKnownBalance=
2769.00000
/s
StockLevelCalculationServiceImpl.recalculateStockLevel(StockTransaction, BigDecimal) line: 112	
		if (aTransaction.isIgnoreOnBalance()) {
/ JA	, 
/ FORECAST_IN
			myNewBalance = aLastKnownBalance;
/ Deze was hierboven set	, komt uit de COUNT	, initial	,

		if (aTransaction.getCalculatedStockLevel() == null || myNewBalance.compareTo(aTransaction.getCalculatedStockLevel()) != 0) {
/ JA
aTransaction.getCalculatedStockLevel()=2419.00000
			aTransaction.setCalculatedStockLevel(myNewBalance);
			return true;

/ Intermezzo

geosco2p=# select*from stock_transaction where system_id=27362877;
 system_id |  quantity  | serial_number | lot_id |  transaction_date   | product_systemid | goods_status_systemid | stock_
location_systemid | product_item_systemid | external_id | organization_systemid | calc_stock_level | is_dirty | transactio
n_type | customer_order_line_systemid | shipment_item_systemid | ignore_on_balance 
-----------+------------+---------------+--------+---------------------+------------------+-----------------------+-------
------------------+-----------------------+-------------+-----------------------+------------------+----------+-----------
-------+------------------------------+------------------------+-------------------
  27362877 | 1032.00000 | NULL          | NULL   | 2016-06-08 23:59:00 |         26878527 |              26877284 |       
         26878346 |                  NULL | NULL        |                 12000 |       2419.00000 |        0 | FORECAST_I
N      |                     27462667 |                   NULL |                 1
(1 row)

/ Welk product is dit	?
geosco2p=# select productid from product where system_id=26878527;
 productid  
------------
 9806313580

/ we zien in de invp van 8 Jun	,

         <mtc:STOCK_TRANSACTION>
            <mtc:QUANTITY>2769</mtc:QUANTITY>
            <mtc:ABSOLUTE/>
            <mtc:SERIAL_NUMBER/>
            <mtc:LOT_ID/>
            <mtc:TRANSACTION_DATE>2016-06-08T05:15:40Z</mtc:TRANSACTION_DATE>
            <mtc:PRODUCT_ID>9806313580</mtc:PRODUCT_ID>
            <mtc:GOODS_STATUS>GOOD</mtc:GOODS_STATUS>
            <mtc:LOCATION>GEODIS_WHS_FR_SOCHAUX</mtc:LOCATION>
            <mtc:EXTERNAL_ID>1288-2016-06-08T05:16:01Z-73</mtc:EXTERNAL_ID>
            <mtc:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtc:ORGANIZATION_ID>
         </mtc:STOCK_TRANSACTION>

/ Dus dit klopt	, hij moet worden set naar 2769	, 

/ Einde Intermezzo

/t
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 177	
			for (StockTransaction myNext : myNextList) {
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/ JA
					myCurrent.setDirty(false);
					stockTransactionDAO.save(myCurrent);
					myLevelChange = true;
				myLastKnownBalance = myCurrent.getCalculatedStockLevel();
/ volgende	,
			for (StockTransaction myNext : myNextList) {
myNext=
27375011/ORDER_IN/2016-06-08 23:59:00.0/9806313580 (26878527)/GEODIS_WHS_FR_SOCHAUX/1032.00000/3451.00000/false

/ Intermezzo

geosco2p=# select productid from product where system_id=26878527;
 productid  
------------
 9806313580
(1 row)

geosco2p=# select*from stock_transaction where system_id=27375011;
 system_id |  quantity  | serial_number | lot_id |  transaction_date   | product_systemid | goods_status_systemid | stock_
location_systemid | product_item_systemid | external_id | organization_systemid | calc_stock_level | is_dirty | transactio
n_type | customer_order_line_systemid | shipment_item_systemid | ignore_on_balance 
-----------+------------+---------------+--------+---------------------+------------------+-----------------------+-------
------------------+-----------------------+-------------+-----------------------+------------------+----------+-----------
-------+------------------------------+------------------------+-------------------
  27375011 | 1032.00000 | NULL          | NULL   | 2016-06-08 23:59:00 |         26878527 |              26877284 |       
         26878346 |              26888888 | NULL        |                 12000 |       3451.00000 |        0 | ORDER_IN  
       |                         NULL |                   NULL |                 0
(1 row)

/ De quantity van de stock tx=1032	, de calc stock level=3451	, 
/ Nu komt de COUNT met 2769.00000 	, deze moet dus + 1032	, dat wordt de nieuwe calc level	,  

/ Einde Intermezzo

				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/s
StockLevelCalculationServiceImpl.recalculateStockLevel(StockTransaction, BigDecimal) line: 112	
		if (aTransaction.isIgnoreOnBalance()) {
/ NEE
/ Want het is een ORDER_IN	, 
			myNewBalance = aLastKnownBalance;
/ NIET
		} else {
			myNewBalance = aLastKnownBalance.add(aTransaction.getQuantity());
3801.00000
f (aTransaction.getCalculatedStockLevel() == null || myNewBalance.compareTo(aTransaction.getCalculatedStockLevel()) != 0) {
/ JA
3801 != 3451.00000
			aTransaction.setCalculatedStockLevel(myNewBalance);
			return true;
/t
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 178	
			for (StockTransaction myNext : myNextList) {
				myCurrent = myNext;
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/ JA
					myCurrent.setDirty(false);
					stockTransactionDAO.save(myCurrent);
					myLevelChange = true;
				myLastKnownBalance = myCurrent.getCalculatedStockLevel();

/ volgende	,
			for (StockTransaction myNext : myNextList) {
myNext=
27389694/FORECAST_OUT/2016-06-08 23:59:00.0/9806313580 (26878527)/GEODIS_WHS_FR_SOCHAUX/-1084.00000/2367.00000/false
				myCurrent = myNext;
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/s
StockLevelCalculationServiceImpl.recalculateStockLevel(StockTransaction, BigDecimal) line: 112	
/=
	protected boolean recalculateStockLevel(StockTransaction aTransaction, BigDecimal aLastKnownBalance) {
aLastKnownBalance=
3801.00000
		if (aTransaction.isIgnoreOnBalance()) {
/ NEE
		} else {
			myNewBalance = aLastKnownBalance.add(aTransaction.getQuantity());
2717.00000
aTransaction.getQuantity()= -1084.00000
		if (aTransaction.getCalculatedStockLevel() == null || myNewBalance.compareTo(aTransaction.getCalculatedStockLevel()) != 0) {
			aTransaction.setCalculatedStockLevel(myNewBalance);
			return true;
/t
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 177	
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/d
					myCurrent.setDirty(false);
					stockTransactionDAO.save(myCurrent);
					myLevelChange = true;
				myLastKnownBalance = myCurrent.getCalculatedStockLevel();
2717.00000

/ volgende	,
			for (StockTransaction myNext : myNextList) {
				myCurrent = myNext;
27391443/ORDER_IN/2016-06-08 23:59:00.0/9806313580 (26878527)/GEODIS_WHS_FR_SOCHAUX/0.00000/2367.00000/false
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/s
StockLevelCalculationServiceImpl.recalculateStockLevel(StockTransaction, BigDecimal) line: 115	
/=
	protected boolean recalculateStockLevel(StockTransaction aTransaction, BigDecimal aLastKnownBalance) {
aLastKnownBalance=
2717.00000
		if (aTransaction.isIgnoreOnBalance()) {
			myNewBalance = aLastKnownBalance;
		} else {
			myNewBalance = aLastKnownBalance.add(aTransaction.getQuantity());
2717.00000
aTransaction.getQuantity()=0

		if (aTransaction.getCalculatedStockLevel() == null || myNewBalance.compareTo(aTransaction.getCalculatedStockLevel()) != 0) {
/ JA
aTransaction.getCalculatedStockLevel()=2367.00000
			aTransaction.setCalculatedStockLevel(myNewBalance);
			return true;
/t
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 177	
			for (StockTransaction myNext : myNextList) {
				myCurrent = myNext;
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/d
					myCurrent.setDirty(false);
					stockTransactionDAO.save(myCurrent);
				}
				myLastKnownBalance = myCurrent.getCalculatedStockLevel();
2717.00000

/ volgende	,
			for (StockTransaction myNext : myNextList) {
				myCurrent = myNext;
27362895/FORECAST_IN/2016-06-09 23:59:00.0/9806313580 (26878527)/GEODIS_WHS_FR_SOCHAUX/1032.00000/2367.00000/false
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/s
StockLevelCalculationServiceImpl.recalculateStockLevel(StockTransaction, BigDecimal) line: 112	
/=
	protected boolean recalculateStockLevel(StockTransaction aTransaction, BigDecimal aLastKnownBalance) {
aLastKnownBalance=2717.00000
		if (aTransaction.isIgnoreOnBalance()) {
/ JA
			myNewBalance = aLastKnownBalance;

		if (aTransaction.getCalculatedStockLevel() == null || myNewBalance.compareTo(aTransaction.getCalculatedStockLevel()) != 0) {
2717.00000!=2367.00000
			aTransaction.setCalculatedStockLevel(myNewBalance);
2717.00000
/t
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 177	
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/d
					myCurrent.setDirty(false);
					stockTransactionDAO.save(myCurrent);
				}
				myLastKnownBalance = myCurrent.getCalculatedStockLevel();

/ Einde GGS-67 DEBUG RECALCULATE WHEN APPL STARTS

/ POSTGRES

/ 7	. 

sco2p=# select st.transaction_type,st.is_dirty from stock_transaction st join product p on st.product_systemid=p.system_id where p.productid='9815434180' and st.is_dirty != 0;

select count(st.*)
select st.system_id
from stock_transaction st 
join product p on st.product_systemid=p.system_id 
join stock_location sl on st.stock_location_systemid=sl.system_id 
join goods_status gs on st.goods_status_systemid=gs.system_id  
where p.productid='9815434180' 
and sl.name='GEODIS_WHS_FR_SOCHAUX'
and gs.code='GOOD'
and st.is_dirty != 0;
 count 
-------
     1 
(1 row)

select count(st.*)
from stock_transaction st
join product p on st.product_systemid=p.system_id
join stock_location sl on st.stock_location_systemid=sl.system_id
where p.productid='9815434180'
and sl.name='GEODIS_WHS_FR_SOCHAUX'
and st.is_dirty != 0;
 count 
-------
    44
(1 row)


select gs.code , count(gs.code)
from stock_transaction st 
join product p on st.product_systemid=p.system_id 
join stock_location sl on st.stock_location_systemid=sl.system_id 
join goods_status gs on st.goods_status_systemid=gs.system_id  
where p.productid='9815434180' 
and sl.name='GEODIS_WHS_FR_SOCHAUX'
and st.is_dirty != 0
group by gs.code;
 code | count 
------+-------
 BAD  |    43
 GOOD |     1
(2 rows)

select this_.system_id 
from STOCK_TRANSACTION this_ 
left outer join TMS_PRODUCT_ITEM productite2_ on this_.PRODUCT_ITEM_SYSTEMID=productite2_.SYSTEM_ID 
left outer join TMS_PRODUCT_ITEM productite3_ on productite2_.PARENT_SYSTEMID=productite3_.SYSTEM_ID 
inner join ORGANIZATION organizati4_ on this_.ORGANIZATION_SYSTEMID=organizati4_.SYSTEM_ID 
left outer join ORGANIZATION organizati5_ on organizati4_.ORGANIZATION_GROUP=organizati5_.SYSTEM_ID 
where this_.PRODUCT_SYSTEMID=26878587
and this_.STOCK_LOCATION_SYSTEMID=26878346
and this_.GOODS_STATUS_SYSTEMID=26877284 
and this_.IS_DIRTY=true
order by this_.TRANSACTION_DATE asc, this_.SYSTEM_ID asc;
 system_id 
-----------
  27392136
(1 row)
/ TODO (H antwoord klopt niet met deze)

/ 7	. 

select gs.code , count(gs.code)
from stock_transaction st 
join product p on st.product_systemid=p.system_id 
join stock_location sl on st.stock_location_systemid=sl.system_id 
join goods_status gs on st.goods_status_systemid=gs.system_id  
where p.productid='9806313580' 
and sl.name='GEODIS_WHS_FR_SOCHAUX'
and st.is_dirty != 0
group by gs.code;
 code | count 
------+-------
 BAD  |    43
 GOOD |     1
(2 rows)

/ 7	. 

/ we zien   ,
select count(*)
from STOCK_TRANSACTION this_ 
left outer join TMS_PRODUCT_ITEM productite2_ on this_.PRODUCT_ITEM_SYSTEMID=productite2_.SYSTEM_ID 
left outer join TMS_PRODUCT_ITEM productite3_ on productite2_.PARENT_SYSTEMID=productite3_.SYSTEM_ID 
inner join ORGANIZATION organizati4_ on this_.ORGANIZATION_SYSTEMID=organizati4_.SYSTEM_ID 
left outer join ORGANIZATION organizati5_ on organizati4_.ORGANIZATION_GROUP=organizati5_.SYSTEM_ID 
where this_.PRODUCT_SYSTEMID=26878527
and this_.STOCK_LOCATION_SYSTEMID=26878346
and this_.GOODS_STATUS_SYSTEMID=26877284
and (this_.TRANSACTION_DATE>'2016-06-08 05:15:40.0' or (this_.TRANSACTION_DATE='2016-06-08 05:15:40.0' and this_.SYSTEM_ID>27392043))
--order by this_.TRANSACTION_DATE asc, this_.SYSTEM_ID asc;
 count
-------
   230
(1 row)
/ TODO (Als we order, en vragen count(*)    , dan ERR: de fields waarop je order by, moeten in group by , of in een aggregate function
 ,
/ Lees	over 'distinct on',
http://stackoverflow.com/questions/19601948/must-appear-in-the-group-by-clause-or-be-used-in-an-aggregate-function
http://dba.stackexchange.com/questions/74773/group-by-one-column-while-sorting-by-another-in-postgresql


select this_.TRANSACTION_DATE  , this_.system_id, this_.is_dirty  
from STOCK_TRANSACTION this_ 
left outer join TMS_PRODUCT_ITEM productite2_ on this_.PRODUCT_ITEM_SYSTEMID=productite2_.SYSTEM_ID 
left outer join TMS_PRODUCT_ITEM productite3_ on productite2_.PARENT_SYSTEMID=productite3_.SYSTEM_ID 
inner join ORGANIZATION organizati4_ on this_.ORGANIZATION_SYSTEMID=organizati4_.SYSTEM_ID 
left outer join ORGANIZATION organizati5_ on organizati4_.ORGANIZATION_GROUP=organizati5_.SYSTEM_ID 
where this_.PRODUCT_SYSTEMID=26878527
and this_.STOCK_LOCATION_SYSTEMID=26878346
and this_.GOODS_STATUS_SYSTEMID=26877284
and (this_.TRANSACTION_DATE>'2016-06-08 05:15:40.0' or (this_.TRANSACTION_DATE='2016-06-08 05:15:40.0' and this_.SYSTEM_ID>27392043))
and this_.is_dirty != 0
order by this_.TRANSACTION_DATE asc, this_.SYSTEM_ID asc;
 transaction_date | system_id | is_dirty 
------------------+-----------+----------
(0 rows)




/ Einde POSTGRES


/ LINUX FIND ORDER BY TIME


/ 7	. 

alhost bin]$ find ~/DB_TAP/Postgres/Backup/ -print0  | od -t x1 -t c
0000000  2f  68  6f  6d  65  2f  65  72  69  63  2f  44  42  5f  54  41
          /   h   o   m   e   /   e   r   i   c   /   D   B   _   T   A
0000020  50  2f  50  6f  73  74  67  72  65  73  2f  42  61  63  6b  75
          P   /   P   o   s   t   g   r   e   s   /   B   a   c   k   u
0000040  70  2f  00  2f  68  6f  6d  65  2f  65  72  69  63  2f  44  42
          p   /  \0   /   h   o   m   e   /   e   r   i   c   /   D   B
...
/ We zien dat er \0 tussen zit	, 

[eric@localhost bin]$ find ~/DB_TAP/Postgres/Backup/ -print0  | xargs -0 echo | od -t x1 -t c
0000000  2f  68  6f  6d  65  2f  65  72  69  63  2f  44  42  5f  54  41
          /   h   o   m   e   /   e   r   i   c   /   D   B   _   T   A
0000020  50  2f  50  6f  73  74  67  72  65  73  2f  42  61  63  6b  75
          P   /   P   o   s   t   g   r   e   s   /   B   a   c   k   u
0000040  70  2f  20  2f  68  6f  6d  65  2f  65  72  69  63  2f  44  42
          p   /       /   h   o   m   e   /   e   r   i   c   /   D   B
...

/ we zien een space ertussen	,
/ TODO

/ Lees	,
http://unix.stackexchange.com/questions/34325/sorting-the-output-of-find
http://superuser.com/questions/294161/unix-linux-find-and-sort-by-date-modified/294164
/ TODO

/ 7	. 
/ Lees	,
http://superuser.com/questions/294161/unix-linux-find-and-sort-by-date-modified/294164

/ 13	. 

[eric@localhost bin]$  find /home/eric/DB_TAP/Postgres/Backup/ -printf "%T@ %p\n" | sort -n | awk 'END{print}'
1465302500.2951507520 /home/eric/DB_TAP/Postgres/Backup/geosco-p-2016-06-07.dump
[eric@localhost bin]$  find /home/eric/DB_TAP/Postgres/Backup/ -printf "%T@ %p\n" | sort -n | awk 'END{print $NF}'
/home/eric/DB_TAP/Postgres/Backup/geosco-p-2016-06-07.dump

/ 13	. 

/ we kunnen aan ls niet alleen een dir geven, maar ook een list van files,	:w

[eric@localhost bin]$ find /home/eric/DB_TAP/Postgres/Backup/ -type f -exec ls -1t "{}" +
/home/eric/DB_TAP/Postgres/Backup/geosco-p-2016-06-07.dump
...
[eric@localhost bin]$ find /home/eric/DB_TAP/Postgres/Backup/ -type f -exec ls -1t "{}" + | awk 'NR==1'
/home/eric/DB_TAP/Postgres/Backup/geosco-p-2016-06-07.dump

[eric@localhost bin]$ find /home/eric/DB_TAP/Postgres/Backup/ -type f -print0 | xargs -0 ls -1t
/home/eric/DB_TAP/Postgres/Backup/geosco-p-2016-06-07.dump
...
[eric@localhost bin]$ find /home/eric/DB_TAP/Postgres/Backup/ -type f -print0 | xargs -0 ls -1t | awk 'NR==1'
/home/eric/DB_TAP/Postgres/Backup/geosco-p-2016-06-07.dump
/ \0 ertussen

[eric@localhost bin]$ find /home/eric/DB_TAP/Postgres/Backup/ -type f -print | xargs ls -1t | awk 'NR==1'
/home/eric/DB_TAP/Postgres/Backup/geosco-p-2016-06-07.dump
/ -print kun je net zo goed weglaten: \n ertussen	,

/ -print0 of -print is voor als er geen -exec is	,

http://www.in-ulm.de/~mascheck/various/argmax/
/ Als met -exec : argument listtoo long	,  dan moet je -print0 of -print (default)	,
/ ARGUMENTS LIST TOO LONG

/ 13	.  

[eric@localhost bin]$ ls -1t $(find /home/eric/DB_TAP/Postgres/Backup/  -type f)

/ 7	. 

/ geef in googele
xargs argument in middle
/ Lees	,
http://offbytwo.com/2011/06/26/things-you-didnt-know-about-xargs.html
/ MORGENOCHTEND

/ xargs maakt een command van args	, en execs hem	,

/ we geven expres echo erbij	,
$ find /home/eric/DB_TAP/Postgres/Backup/ -type f | xargs ls -1t | awk 'NR==1' | xargs echo local-pg_restore.sh geosco2p
local-pg_restore.sh geosco2p /home/eric/DB_TAP/Postgres/Backup/geosco-p-2016-06-07.dump

/ Einde LINUX FIND ORDER BY TIME

/ LINUX AWK

/ 7	. 

/ Lees	,
http://articles.slicehost.com/2007/10/10/rsync-exclude-files-and-folders
http://stackoverflow.com/questions/2021982/awk-without-printing-newline
http://unix.stackexchange.com/questions/26788/using-sed-to-convert-newlines-into-spaces
http://www.thegeekstuff.com/2010/01/8-powerful-awk-built-in-variables-fs-ofs-rs-ors-nr-nf-filename-fnr/
http://www.catonmat.net/blog/awk-one-liners-explained-part-two/

/ we willen een psql stmt maken	, 
/ we kunnen dat met awk	, of met xargs	,

/ 13	. 

[eric@localhost InventoryReport]$ xargs echo cmd
foo
bar
/ Geef ^d
cmd foo bar


/ 13	. 

[eric@localhost InventoryReport]$ awk '/EXTERNAL_ID/'   archive/2016-06/08/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2379-1-1-1.xml 
            <mtc:EXTERNAL_ID>1288-2016-06-08T05:16:01Z-1</mtc:EXTERNAL_ID>
            <mtc:EXTERNAL_ID>1288-2016-06-08T05:16:01Z-2</mtc:EXTERNAL_ID>
            <mtc:EXTERNAL_ID>1288-2016-06-08T05:16:01Z-3</mtc:EXTERNAL_ID>


[eric@localhost InventoryReport]$ awk '/EXTERNAL_ID/{gsub(/<mtc:EXTERNAL_ID>/,"");gsub(/<\/mtc:EXTERNAL_ID>/,"");print}'   archive/2016-06/08/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2379-1-1-1.xml 
            1288-2016-06-08T05:16:01Z-1
            1288-2016-06-08T05:16:01Z-2
            1288-2016-06-08T05:16:01Z-3
...

[eric@localhost InventoryReport]$ awk '/EXTERNAL_ID/{print gensub(/(<.*>)/,"","g",$0)}'   archive/2016-06/08/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2379-1-1-1.xml 
/ Hij pakt de uiterste < en > dus lege regels	,
/ TODO

/ 13	. 

[eric@localhost InventoryReport]$ xargs echo  < <( awk '/EXTERNAL_ID/{gsub(/<mtc:EXTERNAL_ID>/,"");gsub(/<\/mtc:EXTERNAL_ID>/,"");print}'   archive/2016-06/08/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2379-1-1-1.xml)
1288-2016-06-08T05:16:01Z-1 1288-2016-06-08T05:16:01Z-2 1288-2016-06-08T05:16:01Z-3 1288-2016-06-08T05:16:01Z-4 1288-2016-06-08T05:16:01Z-5 1288-2016-06-08T05:16:01Z-6 1288-2016-06-08T05:16:01Z-7  ...

[eric@localhost InventoryReport]$  awk '/EXTERNAL_ID/{gsub(/<mtc:EXTERNAL_ID>/,"");gsub(/<\/mtc:EXTERNAL_ID>/,"");print}'   archive/2016-06/08/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2379-1-1-1.xml | awk '{gsub(/ /,",");print}'
,,,,,,,,,,,,1288-2016-06-08T05:16:01Z-1
,,,,,,,,,,,,1288-2016-06-08T05:16:01Z-2
,,,,,,,,,,,,1288-2016-06-08T05:16:01Z-3
...

[eric@localhost InventoryReport]$  awk '/EXTERNAL_ID/{gsub(/<mtc:EXTERNAL_ID>/,"");gsub(/<\/mtc:EXTERNAL_ID>/,"");print}'   archive/2016-06/08/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2379-1-1-1.xml |xargs  awk '{gsub(/ /,",");print}' 
awk: fatal: cannot open file `1288-2016-06-08T05:16:01Z-1' for reading (No such file or directory)

[eric@localhost InventoryReport]$ awk -v  RS="" '{gsub(/\n/,",");print}' <(awk '/EXTERNAL_ID/{gsub(/<mtc:EXTERNAL_ID>/,"");gsub(/<\/mtc:EXTERNAL_ID>/,"");print}'   archive/2016-06/08/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2379-1-1-1.xml )
/ TODO

/ 13	. 

/ Lees	,
http://www.thegeekstuff.com/2010/01/8-powerful-awk-built-in-variables-fs-ofs-rs-ors-nr-nf-filename-fnr/

/ awk -F is hetzelfde als FS	, 


[eric@localhost InventoryReport]$ awk '{print $0}' RS="," <(awk '/EXTERNAL_ID/{gsub(/ /,"");print}' archive/2016-06/08/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2379-1-1-1.xml)
/ TODO

/ 13	. 

[eric@localhost InventoryReport]$ tr '\n' ',' < <(awk '/EXTERNAL_ID/{gsub(/ /,"");print}' archive/2016-06/08/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2379-1-1-1.xml)
/ Use tr met < <(...)	, std input dus	,
/ Als we < vergeten zien we	,
tr: extra operand ‘/dev/fd/63’


/ 13	. 

[eric@localhost InventoryReport]$ awk '{gsub(/<\/mtc:EXTERNAL_ID>/,"");print}' <(awk '{gsub(/<mtc:EXTERNAL_ID>/,"");print}' <(awk '/EXTERNAL_ID/{gsub(/ /,"");print}' archive/2016-06/08/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2379-1-1-1.xml)) 
/ OK

[eric@localhost InventoryReport]$ tr '\n' ',' < <(awk '{gsub(/<\/mtc:EXTERNAL_ID>/,"");print}' <(awk '{gsub(/<mtc:EXTERNAL_ID>/,"");print}' <(awk '/EXTERNAL_ID/{gsub(/ /,"");print}' archive/2016-06/08/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2379-1-1-1.xml)) )
1288-2016-06-08T05:16:01Z-1,1288-2016-06-08T05:16:01Z-2,1288-2016-06-08T05:16:01Z-3,1288-2016-06-08T05:16:01Z-4,1288-2016-06-08T05:16:01Z-5,1288-2016-06-08T05:16:01Z-6,1288-2016-06-08T05:16:01Z-7,1288-2016-06-08T05:16:01Z-8,1288-2016-06-08T05:16:01Z-9,1288-2016-06-08T05:16:01Z-10,...

/ 7	.  

/ Lees	,
http://www.catonmat.net/blog/awk-one-liners-explained-part-two/

/ 13	. 

/ evt. een / dus <div> of </div>

[eric@localhost InventoryReport]$ awk '{gsub(/<[\/]*mtc:EXTERNAL_ID>/,"");print}' <(awk '/EXTERNAL_ID/{gsub(/ /,"");print}' archive/2016-06/08/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2379-1-1-1.xml)
/ OK

/ 13	. 

/ rm trailing , leading spaces	,

[eric@localhost InventoryReport]$ awk '{gsub(/^[ \t]* | [ \t]*$/,"");print}' <(awk '{gsub(/<[\/]*mtc:EXTERNAL_ID>/,"");print}' <(awk '/EXTERNAL_ID/{print}' archive/2016-06/08/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2379-1-1-1.xml))

/ 13	. 

/ Lees	,
http://stackoverflow.com/questions/2021982/awk-without-printing-newline

/ vervang newline door ,
/ Met ORS of met printf	,

[eric@localhost InventoryReport]$ awk 'BEGIN{ORS=","}{print}' <(awk '{gsub(/^[ \t]* | [ \t]*$/,"");print}' <(awk '{gsub(/<[\/]*mtc:EXTERNAL_ID>/,"");print}' <(awk '/EXTERNAL_ID/{print}' archive/2016-06/08/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2379-1-1-1.xml)))

/ of	, 
[eric@localhost InventoryReport]$ awk '{printf "%s,",$0}' <(awk '{gsub(/^[ \t]* | [ \t]*$/,"");print}' <(awk '{gsub(/<[\/]*mtc:EXTERNAL_ID>/,"");print}' <(awk '/EXTERNAL_ID/{print}' archive/2016-06/08/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2379-1-1-1.xml)))

/ of pipe	,

[eric@localhost InventoryReport]$ awk '/EXTERNAL_ID/{print}' archive/2016-06/08/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2379-1-1-1.xml | awk '{gsub(/<[\/]*mtc:EXTERNAL_ID>/,"");print}' | awk '{gsub(/^[ \t]* | [ \t]*$/,"");print}'| awk '{printf "%s,",$0}'

/ Maar we zien een trailing ,	, 
/ TODO

/ 13	. 

/ Lees	,
http://stackoverflow.com/questions/9899001/how-to-escape-single-quote-in-awk-inside-printf

[eric@localhost InventoryReport]$ awk '{print "\x27"$0}' /tmp/quote.txt
'foo
'bar
[eric@localhost InventoryReport]$ awk '{print "'\''"$0}' /tmp/quote.txt
'foo
'bar

/ WH is de laatste	,
[eric@localhost InventoryReport]$ awk '{print " '\'' "$0}' /tmp/quote.txt
 ' foo
 ' bar
[eric@localhost InventoryReport]$ echo \'
'
/ WH komen we in bash	,
/ TODO

/ 7	. 

/ we quote alle items	,

[eric@localhost InventoryReport]$ awk '/EXTERNAL_ID/{print}' archive/2016-06/08/14-INVRPT-ID-geosco-int-p-52926-1463537208771-2-2379-1-1-1.xml | awk '{gsub(/<[\/]*mtc:EXTERNAL_ID>/,"");print}' | awk '{gsub(/^[ \t]* | [ \t]*$/,"");print}'| awk '{print "\x27"$0"\x27"}' | awk '{printf "%s,",$0}' | awk '{gsub(/,$/,"");print "select count(*)from stock_transaction where external_id in("$0")"}'  

select count(*)from stock_transaction where external_id in('1288-2016-06-08T05:16:01Z-1','1288-2016-06-08T05:16:01Z-2','1288-2016-06-08T05:16:01Z-3','1288-2016-06-08T05:16:01Z-4','1288-2016-06-08T05:16:01Z-5','1288-2016-06-08T05:16:01Z-6','1288-2016-06-08T05:16:01Z-7','1288-2016-06-08T05:16:01Z-8','1288-2016-06-08T05:16:01Z-9','1288-2016-06-08T05:16:01Z-10','1288-2016-06-08T05:16:01Z-11','1288-2016-06-08T05:16:01Z-12','1288-2016-06-08T05:16:01Z-13','1...41','1288-2016-06-08T05:16:01Z-242','1288-2016-06-08T05:16:01Z-243','1288-2016-06-08T05:16:01Z-244','1288-2016-06-08T05:16:01Z-245','1288-2016-06-08T05:16:01Z-246')


/ 7	.  

[root@localhost pg_log]# pwd
/var/lib/pgsql/data/pg_log
[root@localhost pg_log]# > postgresql-Tue.log 
...


/ Einde LINUX AWK






















/////////////////////////////////////////////////











/ POSTGRES

/ 7	. 

/ we moeten '2016-05-29 cast naar date	, als we + integer of + interval willen doen	,

=> select*from a where d <= date '2016-05-29' + integer '1';
     d      |             t              
------------+----------------------------
 2016-05-30 | 2016-05-30 04:43:30.531975
(1 row)

foo=> select*from a where d <= date '2016-05-29' + interval '1 day';
     d      |             t              
------------+----------------------------
 2016-05-30 | 2016-05-30 04:43:30.531975
(1 row)

/ 7	. 

/ >=

foo=> select*from a where d >=  '2016-05-30'
;
     d      |             t              
------------+----------------------------
 2016-05-30 | 2016-05-30 04:43:30.531975
(1 row)

foo=> select*from a where d <=  '2016-05-30' and d >='2016-05-30';
     d      |             t              
------------+----------------------------
 2016-05-30 | 2016-05-30 04:43:30.531975
(1 row)

foo=> select*from a where d >= date '2016-06-01' - interval '2 day' ;
     d      |             t              
------------+----------------------------
 2016-05-30 | 2016-05-30 04:43:30.531975
(1 row)


foo=> select*from a where d >= date '2016-06-01' - interval '2 day' and d <= '2016-06-01';
     d      |             t              
------------+----------------------------
 2016-05-30 | 2016-05-30 04:43:30.531975
(1 row)

foo=> select*from a where d between date '2016-06-01' - interval '3 day' and date '2016-06-01' + interval '2 day'
foo-> ;
     d      |             t              
------------+----------------------------
 2016-05-30 | 2016-05-30 04:43:30.531975
(1 row)

/ 7	. 

/ we kunnen d >= date ...	, en date ... <= d	,  

foo=> select*from a where d >= date  '2016-06-01' - interval '2 day' ;
     d      |             t              
------------+----------------------------
 2016-05-30 | 2016-05-30 04:43:30.531975
(1 row)

foo=> select*from a where  date  '2016-06-01' - interval '2 day' <= d;
     d      |             t              
------------+----------------------------
 2016-05-30 | 2016-05-30 04:43:30.531975
(1 row)

/ 7	. 

/ timestamp	,

foo=> select timestamp '2016-06-01' - interval '2 day';
      ?column?       
---------------------
 2016-05-30 00:00:00
(1 row)

foo=> select  timestamp '2016-06-01' - interval '2 day -5 hour';
      ?column?       
---------------------
 2016-05-30 05:00:00
(1 row)

foo=> select  timestamp '2016-06-01' - interval '2 day 5 hour';
      ?column?       
---------------------
 2016-05-29 19:00:00
(1 row)

/ Nu toepassen	,

foo=> select*from a where timestamp '2016-06-01' - interval '2 day -4 hour' <= t;
     d      |             t              
------------+----------------------------
 2016-05-30 | 2016-05-30 04:43:30.531975
(1 row)

foo=> select*from a where timestamp '2016-06-01' - interval '2 day -5 hour' <= t;
 d | t 
---+---
(0 rows)




/ Einde POSTGRES



/ PSA HERHALING

/ 7	. 

/ Als we op het forecast replenish screen  een bestelling doen	, moeten wij de bestaande sho op 8000 set	, anders gaat hij consolideren ,
/ Hoe doe je dat? Ga naar de Purchase seo	, en set de Actual start date	, dat betekent dat de bestelling is verzonden	, 
/ De actual end date wordt set door de 04-desadv	,  dat betekent dat het bericht is aangekomen	,

/ 7. 	

/ Eerdere fixes	,

/ 13	. 

/ In deze methods hebben we code changed	,

$ vi GeoScoServiceOrderProcessor.class
    private void updateProductItemsForDesadv(Collection<ShipmentItemVO> aResult) { / PSA-479/537/540
	private Collection<ShipmentItemVO> createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO> aExistingItems) { / PSA-515
														/ 1ste deel Sattisch: pri's quantity in orginal sho wordt update bij split	,
$ vi ProductItemServiceImpl.class
    public ProductItemVO save(ProductItemVO aProductItemVO, boolean recalculate, boolean useQueue) {
	public List<ProductItemVO> updateAndSavePlannedQuantities(ShipmentOrderVO aShipmentOrderVO) {	/ PSA-515, 
														/ 2de deel, stock tx's quantity wordt update met pri's actual quantity	,
$ vi StockTransactionEventListener.class
    public void handleEvent(Event<?> anEvent) throws AbstractException {
class PackedItemDAOImpl extends GenericHibernateDAO<PackedItemVO> implements PackedItemDAO {
    public List<PackedItemVO> getMatchedPackedItemByQuantity(ShipmentItemVO shipmentItem, BigDecimal quantity) { / PSA-538



/ 13	.  

$ vi GeoScoServiceOrderProcessor.class
	private Collection<ShipmentItemVO> createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO> aExistingItems) {
		// Updating the product items,this ensures updating quantity on product items.
		updateProductItemsForDesadv(myNewShipmentOrderVO.getShipmentItemList());	/ PSA-515, 	
														/ 1ste deel Sattisch: pri's quantity in original sho wordt update bij split	,
														/ onderaan de method	,

	private void updateProductItemsForDesadv(Collection<ShipmentItemVO> aResult) {
->		Collection<ShipmentItemVO> myList = new ArrayList<ShipmentItemVO>(aResult); / PSA-540, 
		for (ShipmentItemVO myItem : myList) {							/ fixes ConcurrentModificationException	,
                if (myProductItem.getQuantity().compareTo(myQty) != 0) {
//////////////
/ set quantity on packed item   ,
                    myProductItem.setQuantity(myQty);
////////////////
/ and call to set quantity on stock transaction ,
->                  productItemService.save(myProductItem); / WAS: productItemDAO.save(myProductItem)	/ PSA-479, DESADV, 
																						/ update stock transaction's quantity	,
/////////////
/ pallets   ,
            updateProductItemsForDesadv(myItem.getChildren());	 / PSA-537	, pri's quantity update bij pallet	,

$ vi ProductItemServiceImpl.class
    @Override
    public ProductItemVO save(ProductItemVO aProductItemVO, boolean recalculate, boolean useQueue) {
            fireProductItemEvent(myEvent);

$ vi StockTransactionEventListener.class
	public void handleEvent(Event<?> anEvent) throws AbstractException {
            } else if (anEvent.getEventType().startsWith(ProductItemEvent.PREFIX)) {
ProductItemEvent.PREFIX="productitem"
/ JA    , want event type zal zijn "productitem.updated"
                ProductItemEvent myEvent = (ProductItemEvent) anEvent;
                handle(myEvent);

/ 13	. 

/ 13-recadv => update pri's actual quantity	,

class PackedItemDAOImpl extends GenericHibernateDAO<PackedItemVO> implements PackedItemDAO {
    @Override
    public List<PackedItemVO> getMatchedPackedItemByQuantity(ShipmentItemVO shipmentItem, BigDecimal quantity) {
->  myDetachedCriteria.add(Restrictions.gt("quantity", new BigDecimal(0)));
        / WAS: myDetachedCriteria.add(Restrictions.eq("quantity", quantity);	 / PSA-538	, resadv updates pcki's actual quantity 
																/ en dan ook de pri's actual quantity (TODO)

/ 13	.  

ProductItemServiceImpl.updateAndSavePlannedQuantities(ShipmentOrderVO) line: 701
                this.save(myProdItem); / WAS: getDAO().save(myProdItem);		/ PSA-515	, 
														/ 2de deel, stock tx's quantity wordt update met pri's actual quantity	,

/ Einde PSA HERHALING

/ PSA DEBUG RM BREAKPOINTS
/ Einde PSA DEBUG RM BREAKPOINTS


/ PSA DEBUG HERHALING


/ BREAKPOINTS
/s
GeoScoServiceOrderProcessor.processDespatchAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 422	
		ServiceOrderVO updateServiceOrderVO = aProcessor.process(selectSingleNode(aNode, SERVICE_ORDER_BODY_TAG));
		processConsignments(aNode, updateServiceOrderVO);
		List<ShipmentItemVO> existingShipmentItems = processDesadvServiceOrder(updateServiceOrderVO);


/ RM B'S

ServiceOrderBodyProcessor.process(Node) line: 360	
LogisticsOrderBodyProcessor.process(Node, LogisticsOrderVO) line: 187	
DateSetProcessor.process(Node) line: 118	


/ Einde RM B'S


/ Einde PSA DEBUG HERHALING

/ PSA DEBUG DESADV

/s
GeoScoServiceOrderProcessor.processDespatchAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 421	
		ServiceOrderVO updateServiceOrderVO = aProcessor.process(selectSingleNode(aNode, SERVICE_ORDER_BODY_TAG));
		processConsignments(aNode, updateServiceOrderVO);
		List<ShipmentItemVO> existingShipmentItems = processDesadvServiceOrder(updateServiceOrderVO);
/s
GeoScoServiceOrderProcessor.processDesadvServiceOrder(ServiceOrderVO) line: 944	
		for (ConsignmentVO myConsignmentVO : aUpdateServiceOrderVO.getConsignmentList()) {
/ processed	,
			for (ServiceActionVO myServiceActionVO : myConsignmentVO.getServiceActionList()) {
/ processed	,
				ShipmentOrderVO myShipmentOrderVO = myServiceActionVO.getShipmentOrderVO();
/ processed	,
				// handy for comparing shipment items on original order and processed order(for pallets)
				setProcessedOrder(myShipmentOrderVO);
				Collection<ShipmentItemVO> myExistingItems = processDesAdvShipmentOrder(myShipmentOrderVO);
/s
GeoScoServiceOrderProcessor.processDesAdvShipmentOrder(ShipmentOrderVO) line: 1009	

			if (myLabels.size() != uniqueLabels.size()) {
/ NEE
			for (ShipmentItemVO myItem : myShipmentOrderVO.getShipmentItemList()) {
				myResult.addAll(processDesadvShipmentItem(myItem));
/s
GeoScoServiceOrderProcessor.processDesadvShipmentItem(ShipmentItemVO) line: 977	
		String myLabelInfo = aItem.getLabelInfo();
/ processed item	,
		ShipmentItemVO myExistingItem = shipmentItemDAO.getShipmentItem(myLabelInfo);

		if (aItem.getCaseNumber().equals(myExistingItem.getCaseNumber())) {
aItem.theCaseNumber="BOX1"
myExistingItem.theCaseNumber=null
/ Dit is OK	,
			if (myExistingItem.getShipmentItemList().isEmpty()) {
				return processDesadvSingleShipmentItem(myExistingItem, aItem);
/s
GeoScoServiceOrderProcessor.processDesadvSingleShipmentItem(ShipmentItemVO, ShipmentItemVO) line: 1047	
		aExistingItem.setCaseNumber(aProcessedItem.getCaseNumber());				<-
		aExistingItem.setContainerNumber(aProcessedItem.getContainerNumber());
		aExistingItem.setReference1(aProcessedItem.getReference1());
		aExistingItem.setReference2(aProcessedItem.getReference2());
		aExistingItem.setReference3(aProcessedItem.getReference3());
		aExistingItem = shipmentItemDAO.save(aExistingItem);

		} else {
			PackedItemVO myProcessedPackedItemVO = aProcessedItem.getPackedItemList().iterator().next();
			PackedItemVO myExistingPackedItemVO = aExistingItem.getPackedItemList().iterator().next();
			// This is used to remember the original requested qty. FIXME: refactor when working correctly with
			// quantities
			myExistingPackedItemVO.setRequestedQuantity(myExistingPackedItemVO.getQuantity());
			myExistingPackedItemVO.setQuantity(myProcessedPackedItemVO.getQuantity());
			packedItemDAO.save(myExistingPackedItemVO);

		List<ShipmentItemVO> myResult = new ArrayList<ShipmentItemVO>();
		myResult.add(aExistingItem);
		return myResult;
/t
GeoScoServiceOrderProcessor.processDesadvServiceOrder(ServiceOrderVO) line: 952	
				Collection<ShipmentItemVO> myExistingItems = processDesAdvShipmentOrder(myShipmentOrderVO);
/d
/ de al bestaande shi's zijn update, met data in de processed shi's	, en de pcki's zijn update met processed pcki's	,
/ Omdat er in de XML minder shi's staan als dat er besteld zijn	, zijn er partial shi's uidated	,

				Map<ShipmentOrderVO, Collection<ShipmentItemVO>> myShipmentOrderMap = createShipmentOrderMap(myExistingItems);
/ sho:{updated shi}
				for (Collection<ShipmentItemVO> myItemsByOrder : myShipmentOrderMap.values()) {
myItemsByOrder ={updated existing shi's}
					Collection<ShipmentItemVO> myProcessedItems = createNewShipmentOrderForProcessedItems(myItemsByOrder);
/s
GeoScoServiceOrderProcessor.createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO>) line: 650	
/=
	private Collection<ShipmentItemVO> createNewShipmentOrderForProcessedItems(Collection<ShipmentItemVO> aExistingItems) {
aExistingItems={updated existing shi's, corresp. met alle processed shi's}

		ShipmentOrderVO myExisting = aExistingItems.iterator().next().getShipmentOrder();

		// Get the top level items
		Collection<ShipmentItemVO> myAll = new ArrayList<ShipmentItemVO>(myExisting.getShipmentItemList());
		myAll.removeAll(aExistingItems);
/ Je houdt de unprocessed over	,
		if (myAll.isEmpty()) {
			// The current shipment order is processed completely, no need to split.
/ NEE

		// copy header
		ShipmentOrderVO myNewShipmentOrderVO = myExisting.copy();
		myNewShipmentOrderVO.setSystemId(ValueObject.VOLATILE_SYSTEM_ID);
		// id must be altered
		myNewShipmentOrderVO.setShipmentOrderId(myExisting.getShipmentOrderId().trim() + "-" + String.format("%1$tY%1$tm%1$td-%1$tH%1$tM%1$tS", new Date()));
		myNewShipmentOrderVO.setReasonCode(getPartialDeliveryReasonCode());
		myExisting.setReasonCode(getPartialDeliveryReasonCode());

/ TODO (Afmaken)	.


/ Einde PSA DEBUG DESADV





/ PSA DEBUG DESADV WITH LABEL WHICH WAS ALREADY BEFORE PROCESSED 

/s
GeoScoServiceOrderProcessor.process(Node) line: 258	
			final String purposeCode = selectText(aNode, MTCCoreNames.PROCESSING_DETAILS, MTCCoreNames.PURPOSE_CODE);
DespatchAdviceShipment
			} else if (DESPATCH_ADVICE_SHIPMENT.equals(purposeCode)) {
				processDespatchAdviceShipment(aNode, myProcessor, documentId);
/s
GeoScoServiceOrderProcessor.processDespatchAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 422	
		ServiceOrderVO updateServiceOrderVO = aProcessor.process(selectSingleNode(aNode, SERVICE_ORDER_BODY_TAG));
		processConsignments(aNode, updateServiceOrderVO);
		List<ShipmentItemVO> existingShipmentItems = processDesadvServiceOrder(updateServiceOrderVO);
/s
GeoScoServiceOrderProcessor.processDesadvServiceOrder(ServiceOrderVO) line: 955	
		for (ConsignmentVO myConsignmentVO : aUpdateServiceOrderVO.getConsignmentList()) {
/ processed	,
			for (ServiceActionVO myServiceActionVO : myConsignmentVO.getServiceActionList()) {
/ processed	,
				ShipmentOrderVO myShipmentOrderVO = myServiceActionVO.getShipmentOrderVO();
/ processed	,
				setProcessedOrder(myShipmentOrderVO);
				Collection<ShipmentItemVO> myExistingItems = processDesAdvShipmentOrder(myShipmentOrderVO);
/s
GeoScoServiceOrderProcessor.processDesAdvShipmentOrder(ShipmentOrderVO) line: 1009	
			for (ShipmentItemVO myVO : myShipmentOrderVO.getShipmentItemList()) {
				// preventing pallets in the list, they are filled with container numbers,because pallets may update
				// multiple shipment items with same label info.
/ TODO
				if (org.apache.commons.lang.StringUtils.isBlank(myVO.getContainerNumber())) {
/ NEE
					myLabels.add(myVO.getLabelInfo());
/ NIET

/ container number=100971646 bijv	,
/ label info=CEQ4IJVFI-R	, 	 door SCS	, voor naar supplier	,
/ case number=Box1			, door supplier	, het warehouse werkt daarmee, zie 13-recadv TODO

			if (myLabels.size() != uniqueLabels.size()) {
/ NEE
				String message = "Could not process DESADV, should not contain same label info/number for multiple shipment items(which are not pallets) within desadv." + myLabels;
/ NIET
				LOG.error(message);
/ NIET
				throw new RuntimeException(message);
/ NIET
			}
/ TODO PSA
			for (ShipmentItemVO myItem : myShipmentOrderVO.getShipmentItemList()) {
				myResult.addAll(processDesadvShipmentItem(myItem));
/s
GeoScoServiceOrderProcessor.processDesadvShipmentItem(ShipmentItemVO) line: 977	
		String myLabelInfo = aItem.getLabelInfo();
		ShipmentItemVO myExistingItem = shipmentItemDAO.getShipmentItem(myLabelInfo);
/ finds shi by label	,
/ Herinner: de shi is al in de db	, want besteld	, ze moeten alleen nog update met case number, ... als de 04-desadv  binnenkomt	,

		if (aItem.getCaseNumber().equals(myExistingItem.getCaseNumber())) {
/ JA
/ we hadden deze 04-desadv blijkbaar als run	, 
			String message = "Could not process DESADV, " + myExistingItem.toString() + " has already updated by other DESADV before, with case number " + myExistingItem.getCaseNumber();
			LOG.error(message);						/ log4j	,
			throw new RuntimeException(message);
/ TODO PSA TICKET ( Vergelijkt processing case number met die uit db, die wat dus in een eerdere run proecess	, maar we moeten label nummers in de dezelfde XML op uniqueness check	, niet uit verschillende XML's	. 
/t
GeoScoServiceOrderProcessor.process(Node) line: 276	
/=
	public void process(Node aNode) throws ServiceOrderException {

			} else if (DESPATCH_ADVICE_SHIPMENT.equals(purposeCode)) {
				processDespatchAdviceShipment(aNode, myProcessor, documentId);
			}
		} catch (Exception anException) {
			String myMessage = createEnhancedErrorMessage(aNode, myProcessor, anException);
			LOG.error(myMessage, anException);
			throw new ServiceOrderException(myMessage, anException);	/ checked exception	,
/t
ServiceOrderMsgProcessor.process(Node) line: 96	
					getServiceOrderProcessor().process(myNode);
/d
		} catch (Exception anException) {
			throw new ServiceOrderException("", anException);
/t
ServiceOrderMsgConsumer.process(Message) line: 57	
				myProcessor.process(((SapXMessage) aIncomingMessage).getDocument().getDocumentElement());
/d
		} catch (Exception anException) {
			// The stack trace helps to identify the real cause
			LOG.error(anException);
			// Status is propagated to invoker
			setStatusFailed(MC_STATUS_FAILURE, "Could not process message: " + anException);
/s
ServiceOrderMsgConsumer(MessageConsumer).setStatusFailed(int, String) line: 179	
		// initialise status and explanation at the same time
		theStatus = aNonOkStatus;
2
		theExplanation = anExplanation;
Could not process message: com.mpobjects.oms.model.serviceorder.ServiceOrderException: [In process([ProcessingContext: SERVICE_ORDER_ID[]ProcessingContext: SERVICE_ORDER_ID[]][Node: [so:SERVICE_ORDER: null]][Reason: Could not process DESADV, shipmentItem: 0010(systemId:26888707, labelInfo:QTPRNDZJH) has already updated by other DESADV before, with case number BOX1][XmlMessage: <?xml version="1.0" encoding="utf-8"?>
<!--Input file: 04-DESADV-ID-SH-1967-packtest-GEO-2.xml--><!--$Id: 04-DESADV.xsl 5382 2015-10-09 04:20:12Z radhika $--><so:SERVICE_ORDER_MSG xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2" xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2" xmlns:da="urn:oasis:names:specification:ubl:schema:xsd:DespatchAdvice-2" xmlns:event="http://system.mp-objects.com/schemas/MTC/LogisticsOrder/V1/LogisticsOrderEvent.xsd" xmlns:mtc="http://system.mp-objects.com/schemas/MTC/MTCCore/V1/MTCCore.xsd" xmlns:mtccore="http://system.mp-objects.com/schemas/MTC/MTCCore/V1/MTCCore.xsd" xmlns:so="http://system.mp-objects.com/schemas/MTC/ServiceOrder/V1/ServiceOrder.xsd" xmlns:xs="http://www.w3.org/2001/XMLSchema">
   <so:header>
...
/t
ServiceOrderMsgConsumer.process(Message) line: 64	
				myProcessor.process(((SapXMessage) aIncomingMessage).getDocument().getDocumentElement());
				setStatusOk();
			}

			runAsService.logout(authentication);
		} catch (Exception anException) {
			// The stack trace helps to identify the real cause
			LOG.error(anException);

			// Status is propagated to invoker
			setStatusFailed(MC_STATUS_FAILURE, "Could not process message: " + anException);
		}
/ returns gewoon	,
/t
ServiceOrderMsgConsumer(MessageConsumer).handle(Message) line: 111	
/ TODO (welke call doet hij?)
/ returns gewoon	,
/t
Thread [GeoScoQueueContainer-2] (Suspended)	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy353.handle(Message) line: not available	
	MessageConsumerHandler$$EnhancerBySpringCGLIB$$ca5a33ca(MessageConsumerHandler).onExchange(MessageExchange) line: 172	
	MessageConsumerHandler$$EnhancerBySpringCGLIB$$ca5a33ca(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 43	
	SingletonExchangeHandlerChain.next(MessageExchange) line: 43	
	DemuxExchangeHandler.handleMessage(ExchangeHandler, MessageExchange) line: 110	
	DemuxExchangeHandler.onExchange(MessageExchange) line: 123	
	DemuxExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 43	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	TxExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	TxExchangeHandler.handleExchange(ExchangeHandlerChain, MessageExchange) line: 62	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy478.handleExchange(ExchangeHandlerChain, MessageExchange) line: not available	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	MessageTraceExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	AuthNExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	ArchiveExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	SapXConverterExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	ArchiveErrorExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	RetryExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	RetryExchangeHandler.handleExchange(ExchangeHandlerChain, MessageExchange) line: 80	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	MessageHandler.handleExchange(MessageExchange) line: 55	
	MpoMessageListener.processMessage(Message, JmsMpoMessage) line: 378	
	MpoMessageListener.onMessage(Message) line: 199	
	DefaultMessageListenerContainer(AbstractMessageListenerContainer).doInvokeListener(MessageListener, Message) line: 569	
	DefaultMessageListenerContainer(AbstractMessageListenerContainer).invokeListener(Session, Message) line: 507	
	DefaultMessageListenerContainer(AbstractMessageListenerContainer).doExecuteListener(Session, Message) line: 474	
	DefaultMessageListenerContainer(AbstractPollingMessageListenerContainer).doReceiveAndExecute(Object, Session, MessageConsumer, TransactionStatus) line: 325	
	DefaultMessageListenerContainer(AbstractPollingMessageListenerContainer).receiveAndExecute(Object, Session, MessageConsumer) line: 263	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener() line: 1103	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop() line: 1095	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run() line: 992	
	Thread.run() line: 745	

/ TODO AFMAKEN (Volg ERR, 	en sending of application response)

 
/ Einde PSA DEBUG DESADV WITH LABEL WHICH WAS ALREADY BEFORE PROCESSED 

/ PSA DEBUG RECADV

/ 7	. 

/ we hebben op 3 Jun een SH000001434 met 2 shi's	, 
/ we hebben een partial desadv sent	,
$ vi 04-DESADV-1-of-2-shis.xml
              <so:SHIPMENT_ITEMS>
                  <mtccore:SHIPMENT_ITEM>
                     <mtccore:SHIPMENT_ITEM_ID>Box1</mtccore:SHIPMENT_ITEM_ID>
                     <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:PRODUCT_ITEM_ID>MPO_Prod1</mtccore:PRODUCT_ITEM_ID>
                           <mtccore:SHIPMENT_ORDER_ID>ID TRANSPORT</mtccore:SHIPMENT_ORDER_ID>
                           <mtccore:QUANTITY>6</mtccore:QUANTITY>
                        </mtccore:PACKED_ITEM>
                     </mtccore:PACKED_ITEMS>
                     <mtccore:LABEL_NUMBER>ZJWJLP38V</mtccore:LABEL_NUMBER>

/ Na deze zijn er 2 sho's
SH000001434
SH000001434-20160603-172118
/ Op SH000001434-20160603-172118 heeft de shi de label ZJWJLP38V-R gekregen	, de shi's pcki: quantity=6, actual quantity=0	, want die moet van de recadv komen straks	,	 de shi's case number is "BOX1"


/ 7	. 

/ we passen 13-RECADV-ID-SCSIN-TESTING.xml

      <mtc:ref xmlns:mtc="http://system.mp-objects.com/schemas/MTC/MTCCore/V1/MTCCore.xsd">
         <mtc:VALUE>PSA_MPO_RECADV_20160315_155231_0345.xml</mtc:VALUE>					<- +1
         <mtc:QUALIFIER>fileName</mtc:QUALIFIER>
      </mtc:ref>
   </mtc:header>

   <mtc:body>
      <mtc:SERVICE_ORDER>
         <mtc:SERVICE_ORDER_BODY>
            <mtccore:SERVICE_ORDER_ID>N0006362</mtccore:SERVICE_ORDER_ID>	<- receipt seo, ga naar de sho 
																			SH000001434-20160603-172118 we zien 3 seo's, purchase	, 
																			..., receipt	, pak receipt	,

   <mtc:body>
      <mtc:SERVICE_ORDER>
         <mtc:CONSIGNMENT>
            <mtc:SHIPMENT_ORDER>
               <mtc:SHIPMENT_ORDER_BODY>
                  <mtccore:SHIPMENT_ORDER_ID>SH000001434-20160603-172118</mtccore:SHIPMENT_ORDER_ID>		<-
               <mtc:PRODUCT_ITEMS>
                  <mtccore:PRODUCT_ITEM>
                     <mtccore:SHIPMENT_ORDER_ID>SH000001434-20160603-172118</mtccore:SHIPMENT_ORDER_ID>		<-
              <mtc:SHIPMENT_ITEMS>
                  <mtccore:SHIPMENT_ITEM>
                     <mtccore:SHIPMENT_ORDER_ID>SH000001434-20160603-172118</mtccore:SHIPMENT_ORDER_ID>		<-
                     <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:SHIPMENT_ORDER_ID>SH000001434-20160603-172118</mtccore:SHIPMENT_ORDER_ID>	<-
		  		  <mtccore:SHIPMENT_ITEM>
                     <mtccore:SHIPMENT_ORDER_ID>SH000001434-20160603-172118</mtccore:SHIPMENT_ORDER_ID>			<-
                     <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:SHIPMENT_ORDER_ID>SH000001434-20160603-172118</mtccore:SHIPMENT_ORDER_ID>	<-


/ 7	. 

/s
GeoScoServiceOrderProcessor.process(Node) line: 262	
			final String purposeCode = selectText(aNode, MTCCoreNames.PROCESSING_DETAILS, MTCCoreNames.PURPOSE_CODE);
ReceiptAdviceShipment
			} else if (RECEIPT_ADVICE_SHIPMENT.equals(purposeCode)) {
				processReceiptAdviceShipment(aNode, myProcessor, documentId);
/s
GeoScoServiceOrderProcessor.processReceiptAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 1177	
		ServiceOrderVO myServiceOrderVOIncomming = aProcessor.process(selectSingleNode(aNode, SERVICE_ORDER_BODY_TAG));
		processConsignments(aNode, myServiceOrderVOIncomming);

		for (ConsignmentVO myConsignmentVO : myServiceOrderVOIncomming.getConsignmentList()) {
/0
			for (ServiceActionVO myServiceActionVO : myConsignmentVO.getServiceActionList()) {
[SH000001434-20160603-172118/NO SERVICE ACTION TYPE!!!/0]
/ TODO (Zie sa NIET in XML)	,
				ShipmentOrderVO myShipmentOrderVOUpdate = myServiceActionVO.getShipmentOrderVO();
ShipmentOrder: SH000001434-20160603-172118(SystemId:0; Org:LOG_EMEA_FR_CT_PSA)
				processRecAdvShipmentOrder(myShipmentOrderVOUpdate);
/s
GeoScoServiceOrderProcessor.processRecAdvShipmentOrder(ShipmentOrderVO) line: 1137	
/=
	private void processRecAdvShipmentOrder(ShipmentOrderVO aShipmentOrderVOUpdate) {
aShipmentOrderVOUpdate ShipmentOrder: SH000001434-20160603-172118(SystemId:0; Org:LOG_EMEA_FR_CT_PSA)
/ processed sho	,
		ShipmentOrderVO myExistingShipmentOrder = shipmentOrderDao.getShipmentOrder(aShipmentOrderVOUpdate.getShipmentOrderId(),
				aShipmentOrderVOUpdate.getOrganization());
ShipmentOrder: SH000001434-20160603-172118(SystemId:26879894; Org:LOG_EMEA_FR_CT_PSA)
/ existing sho	,

		for (ShipmentItemVO myUpdatedItem : aShipmentOrderVOUpdate.getShipmentItemList()) {
1 processed shi's	,
updatedShipmentItem=processed shi	,
			ShipmentItemVO updatedShipmentItem = processRecAdvShipmentItem(myExistingShipmentOrder, myUpdatedItem);
myExistingShipmentOrder=existing sho	,
/s
GeoScoServiceOrderProcessor.processRecAdvShipmentItem(ShipmentOrderVO, ShipmentItemVO) line: 1122	
/=
	private ShipmentItemVO processRecAdvShipmentItem(ShipmentOrderVO aExistingShipmentOrder, ShipmentItemVO aUpdatedItem) {
axistingShipmentOrder=existing sho	,
aUupdatedItem=processed shi	,
		BigDecimal myActualQty = aUpdatedItem.getPackedItemList().get(0).getActualQuantity();
11
/ De actual quantity zit inderdaad in de recadv 	,

/ Loop existing shi's af	, op zoek naar die shi met case number == processed shi's case number,	
		for (ShipmentItemVO myExistingShipmentItem : aExistingShipmentOrder.getShipmentItemList()) {
shipmentItem: 0010(systemId:26888714, labelInfo:ZJWJLP38V-R)
			ShipmentItemVO myFound = processRecAdvNestedShipmentItem(myExistingShipmentItem, aUpdatedItem, myActualQty);

/ Intermezzo

                 <mtccore:SHIPMENT_ITEM>
                     <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:SHIPMENT_ORDER_ID>SH000001434-20160603-172118</mtccore:SHIPMENT_ORDER_ID>
                           <mtccore:QUANTITY>8</mtccore:QUANTITY>
                           <mtccore:ACTUAL_QUANTITY>11</mtccore:ACTUAL_QUANTITY>
                        </mtccore:PACKED_ITEM>
                     </mtccore:PACKED_ITEMS>
                     <mtccore:CASE_NUMBER>BOX1</mtccore:CASE_NUMBER>

/ processRecAdvShipmentItem(ShipmentOrderVO aExistingShipmentOrder, ShipmentItemVO aUpdatedItem) processes de processed shi, aUpdatedItem	,
/ scs kijkt naar de actual quantity 	, typisch recadv 	,
/ Hieronder, in processRecAdvNestedShipmentItem,  loopt existing shi's af	, en kijkt of de case number van deze existing shi's == case number van de processed shi	, 
		for (ShipmentItemVO myExistingShipmentItem : aExistingShipmentOrder.getShipmentItemList()) {
[shipmentItem: 0010(systemId:26888714, labelInfo:ZJWJLP38V-R)]
			ShipmentItemVO myFound = processRecAdvNestedShipmentItem(myExistingShipmentItem, aUpdatedItem, myActualQty);
			if (myFound != null) {
				return myFound;
			}
		}
		return null;
/ TODO GGS-87 Wat gebeurt er als return null? Moet exception throw	,

 Einde Intermezzo

/s
GeoScoServiceOrderProcessor.processRecAdvNestedShipmentItem(ShipmentItemVO, ShipmentItemVO, BigDecimal) line: 1095	
		if (myExistingShipmentItem.getCaseNumber() != null && myExistingShipmentItem.getCaseNumber().equalsIgnoreCase(aUpdatedItem.getCaseNumber())) {
/ JA
"BOX1"
			BigDecimal quantity = aUpdatedItem.getPackedItemList().get(0).getQuantity().setScale(5);
8.00000
			List<PackedItemVO> list = packedItemDAO.getMatchedPackedItemByQuantity(myExistingShipmentItem, quantity);
[com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:26888385]

/ Klopt	,
geosco2a=# select*from tms_packed_item where quantity=6 and shipment_item_systemid=26888714;
 system_id | quantity | product_item_systemid | shipment_item_systemid | actual_quantity | additional_info | requested_quan
tity 
-----------+----------+-----------------------+------------------------+-----------------+-----------------+---------------
-----
  26888385 |  6.00000 |              26883566 |               26888714 |            NULL | NULL            |           10.0
0000
(1 row)
			if (list.size() > 0) {
				for (PackedItemVO pakdItem : list) {
					pakdItem.setActualQuantity(myActualQty);					/ WAS null
					myExistingShipmentItem.getPackedItemList().add(pakdItem);
[com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:26888385, com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:26888385]
/ TODO PAUL (Dezelfde pcki staat er 2 keer in)	,

			return myExistingShipmentItem;
/t
GeoScoServiceOrderProcessor.processRecAdvShipmentItem(ShipmentOrderVO, ShipmentItemVO) line: 1130	
		for (ShipmentItemVO myExistingShipmentItem : aExistingShipmentOrder.getShipmentItemList()) {
			ShipmentItemVO myFound = processRecAdvNestedShipmentItem(myExistingShipmentItem, aUpdatedItem, myActualQty);
/d
			if (myFound != null) {
				return myFound;
/t
GeoScoServiceOrderProcessor.processRecAdvShipmentOrder(ShipmentOrderVO) line: 1147	
		for (ShipmentItemVO myUpdatedItem : aShipmentOrderVOUpdate.getShipmentItemList()) {
			ShipmentItemVO updatedShipmentItem = processRecAdvShipmentItem(myExistingShipmentOrder, myUpdatedItem);
/d
/ existing shi	,
			if (updatedShipmentItem != null) {
				shipmentItems.add(updatedShipmentItem);

/ volgende,	
		for (ShipmentItemVO myUpdatedItem : aShipmentOrderVOUpdate.getShipmentItemList()) {
/ NEE	,
			shipmentItemDAO.save(shipmentItems);
			List<ProductItemVO> myItems = productItemService.updateActualQuantities(myExistingShipmentOrder);
/s
ProductItemServiceImpl.updateActualQuantities(ShipmentOrderVO) line: 685	
/=
	public List<ProductItemVO> updateActualQuantities(ShipmentOrderVO aShipmentOrderVO) {
aShipmentOrderVO=existing sho	,
		for (ProductItemVO myProdItem : aShipmentOrderVO.getProductItemList()) {
[PRODUCT_ITEM id:null(systemId:26883566)]
/s
ProductItemServiceImpl.updateActualsForProductItem(ProductItemVO) line: 886	
		for (PackedItemVO myPacked : aProdItem.getPackedItemList()) {
[com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:26888385]
			} else {
				myActual = myActual.add(myPacked.getActualQuantity());
11
		BigDecimal myProdActQty = aProdItem.getActualQuantity();
null
		if (ObjectUtils.compare(myActual, myProdActQty) != 0) {
			aProdItem.setActualQuantity(myActual);
			return aProdItem;
/t
ProductItemServiceImpl.updateActualQuantities(ShipmentOrderVO) line: 689	
		for (ProductItemVO myProdItem : aShipmentOrderVO.getProductItemList()) {
			ProductItemVO myUpdatedItem = updateActualsForProductItem(myProdItem);
			if (myUpdatedItem != null) {
				myList.add(myUpdatedItem);
		return myList;
/t
GeoScoServiceOrderProcessor.processRecAdvShipmentOrder(ShipmentOrderVO) line: 1156	
			List<ProductItemVO> myItems = productItemService.updateActualQuantities(myExistingShipmentOrder);
/d
[PRODUCT_ITEM id:null(systemId:26883566)]
/ pri's actualQuantity=11

			} else {
				for (ProductItemVO myProdItem : myItems) {
					productItemDAO.save(myProdItem);
			shipmentOrderService.updateShipmentOrder(myExistingShipmentOrder, true, false);
/s
ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderVO, boolean, boolean) line: 1985	
			} else {
				myOldVO = shipmentOrderDao.getBySystemId(aShipmentOrder.getSystemId());
			return updateShipmentOrder(aShipmentOrder, new TMSEventContext(), propagateChange);
/ Overslaan	,
/t
GeoScoServiceOrderProcessor.processReceiptAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 1188	
		for (ConsignmentVO myConsignmentVO : myServiceOrderVOIncomming.getConsignmentList()) {
			for (ServiceActionVO myServiceActionVO : myConsignmentVO.getServiceActionList()) {
				ShipmentOrderVO myShipmentOrderVOUpdate = myServiceActionVO.getShipmentOrderVO();
				processRecAdvShipmentOrder(myShipmentOrderVOUpdate);
/d
		// Now try to set the actual date on the service order.
		ServiceOrderVO mySO = serviceOrderDao.getServiceOrder(myServiceOrderVOIncomming.getServiceOrderId(), myServiceOrderVOIncomming.getOrganization());
myServiceOrderVOIncomming.getServiceOrderId()=N0006362
/ staat inderdaad in de recadv	,
		if (mySO != null) {
			mySO.getDateSetVO().setActualEnd(myServiceOrderVOIncomming.getDateSetVO().getActualEnd());
/ Inderdaad	,
   <mtc:body>
      <mtc:SERVICE_ORDER>
         <mtc:SERVICE_ORDER_BODY>
              <mtccore:DATE_SET>
                  <mtccore:ACTUAL_END>2016-03-15T15:48:15</mtccore:ACTUAL_END>
               </mtccore:DATE_SET>

			serviceOrderService.updateServiceOrder(mySO, true, false);
/ Overslaan	,
/t
GeoScoServiceOrderProcessor.process(Node) line: 262	
			} else if (RECEIPT_ADVICE_SHIPMENT.equals(purposeCode)) {
				processReceiptAdviceShipment(aNode, myProcessor, documentId);
/d
/t
ServiceOrderMsgConsumer.process(Message) line: 53	
				myProcessor.process(((SapXMessage) aIncomingMessage).getDocument().getDocumentElement());
/d


/ Einde PSA DEBUG RECADV

/ PSA DEBUG RECADV WITH WRONG CASE NUMBER

/ 7	. 

/ we maken op 6 Jun
SH000001435
/ deze heeft 2 shi's	,met QL9H3LXRL  en nog een	,

/ we geven hem eerst een partial desadv	,  alleen met QL9H3LXRL	,
/ jwe zien SH000001435, SH000001435-20160606-145017
/ op  SH000001435-20160606-145017 zien we de shi	,die nu label QL9H3LXRL-R heeft	, en case number "BOX1"	,

/ we maken een recadv  voor sho  SH000001435-20160606-145017	, 
/ in de XML we set de counter +1	, we set de receipt seo's seoid	N0006368, we set de sho's shoid	, SH000001435-20160606-145017	, as usual	, 
/ but now we set case number BX1	, die niet bestaat	, 

      <mtc:ref xmlns:mtc="http://system.mp-objects.com/schemas/MTC/MTCCore/V1/MTCCore.xsd">
         <mtc:VALUE>PSA_MPO_RECADV_20160315_155231_0348.xml</mtc:VALUE>
         <mtc:QUALIFIER>fileName</mtc:QUALIFIER>
      </mtc:ref>
   </mtc:header>
  </mtc:header>
   <mtc:body>
      <mtc:SERVICE_ORDER>
         <mtc:SERVICE_ORDER_BODY>
            <mtccore:SERVICE_ORDER_ID>N0006368</mtccore:SERVICE_ORDER_ID>
         <mtc:CONSIGNMENT>
            <mtc:SHIPMENT_ORDER>
               <mtc:SHIPMENT_ORDER_BODY>
                  <mtccore:SHIPMENT_ORDER_ID>SH000001435-20160606-145017</mtccore:SHIPMENT_ORDER_ID>
               <mtc:PRODUCT_ITEMS>
                  <mtccore:PRODUCT_ITEM>
                     <mtccore:PRODUCT_ITEM_ID>1</mtccore:PRODUCT_ITEM_ID>
               <mtc:SHIPMENT_ITEMS>
                  <mtccore:SHIPMENT_ITEM>
                     <mtccore:SHIPMENT_ORDER_ID>SH000001435-20160606-145017</mtccore:SHIPMENT_ORDER_ID>
                     <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:SHIPMENT_ORDER_ID>SH000001435-20160606-145017</mtccore:SHIPMENT_ORDER_ID>
                           <mtccore:QUANTITY>8</mtccore:QUANTITY>
                           <mtccore:ACTUAL_QUANTITY>11</mtccore:ACTUAL_QUANTITY>
                        </mtccore:PACKED_ITEM>
                     <mtccore:CASE_NUMBER>BX1</mtccore:CASE_NUMBER>						<- BX1	, is er NIET	, 
                  </mtccore:SHIPMENT_ITEM>

/s
GeoScoServiceOrderProcessor.processReceiptAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 1177	
		ServiceOrderVO myServiceOrderVOIncomming = aProcessor.process(selectSingleNode(aNode, SERVICE_ORDER_BODY_TAG));
		processConsignments(aNode, myServiceOrderVOIncomming);

		for (ConsignmentVO myConsignmentVO : myServiceOrderVOIncomming.getConsignmentList()) {
			for (ServiceActionVO myServiceActionVO : myConsignmentVO.getServiceActionList()) {
				ShipmentOrderVO myShipmentOrderVOUpdate = myServiceActionVO.getShipmentOrderVO();
				processRecAdvShipmentOrder(myShipmentOrderVOUpdate);
/s
GeoScoServiceOrderProcessor.processRecAdvShipmentOrder(ShipmentOrderVO) line: 1137	
		ShipmentOrderVO myExistingShipmentOrder = shipmentOrderDao.getShipmentOrder(aShipmentOrderVOUpdate.getShipmentOrderId(), aShipmentOrderVOUpdate.getOrganization());
		for (ShipmentItemVO myUpdatedItem : aShipmentOrderVOUpdate.getShipmentItemList()) {
			ShipmentItemVO updatedShipmentItem = processRecAdvShipmentItem(myExistingShipmentOrder, myUpdatedItem);
/s
GeoScoServiceOrderProcessor.processRecAdvShipmentItem(ShipmentOrderVO, ShipmentItemVO) line: 1122	
		BigDecimal myActualQty = aUpdatedItem.getPackedItemList().get(0).getActualQuantity();
11
		for (ShipmentItemVO myExistingShipmentItem : aExistingShipmentOrder.getShipmentItemList()) {
			ShipmentItemVO myFound = processRecAdvNestedShipmentItem(myExistingShipmentItem, aUpdatedItem, myActualQty);
/s
GeoScoServiceOrderProcessor.processRecAdvNestedShipmentItem(ShipmentItemVO, ShipmentItemVO, BigDecimal) line: 1095	
		if (myExistingShipmentItem.getCaseNumber() != null && myExistingShipmentItem.getCaseNumber().equalsIgnoreCase(aUpdatedItem.getCaseNumber())) {
/ NEE
BOX1	, BX1
		for (ShipmentItemVO myChild : myExistingShipmentItem.getShipmentItemList()) {
/ GEEN nested shi's
/ TODO
		return null;
/t
GeoScoServiceOrderProcessor.processRecAdvShipmentItem(ShipmentOrderVO, ShipmentItemVO) line: 1129	
			ShipmentItemVO myFound = processRecAdvNestedShipmentItem(myExistingShipmentItem, aUpdatedItem, myActualQty);
/d
null
		return null;
/t
GeoScoServiceOrderProcessor.processRecAdvShipmentOrder(ShipmentOrderVO) line: 1146	
		for (ShipmentItemVO myUpdatedItem : aShipmentOrderVOUpdate.getShipmentItemList()) {
			ShipmentItemVO updatedShipmentItem = processRecAdvShipmentItem(myExistingShipmentOrder, myUpdatedItem);
/d
null
		if (!shipmentItems.isEmpty()) {
/ NEE
}
/ method returns	,
/t
GeoScoServiceOrderProcessor.processReceiptAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 1188	
		ServiceOrderVO myServiceOrderVOIncomming = aProcessor.process(selectSingleNode(aNode, SERVICE_ORDER_BODY_TAG));
		processConsignments(aNode, myServiceOrderVOIncomming);

		for (ConsignmentVO myConsignmentVO : myServiceOrderVOIncomming.getConsignmentList()) {
			for (ServiceActionVO myServiceActionVO : myConsignmentVO.getServiceActionList()) {
				ShipmentOrderVO myShipmentOrderVOUpdate = myServiceActionVO.getShipmentOrderVO();
				processRecAdvShipmentOrder(myShipmentOrderVOUpdate);
/d
		// Now try to set the actual date on the service order.
		ServiceOrderVO mySO = serviceOrderDao.getServiceOrder(myServiceOrderVOIncomming.getServiceOrderId(), myServiceOrderVOIncomming.getOrganization());
		if (mySO != null) {
			LOG.debug("Closing SO [" + mySO + "]");
			mySO.getDateSetVO().setActualEnd(myServiceOrderVOIncomming.getDateSetVO().getActualEnd());
			serviceOrderService.updateServiceOrder(mySO, true, false);
/ Dit gaat het dus gewoon doen	,
/ Dit is ERR	,



/ Einde PSA DEBUG RECADV WITH WRONG CASE NUMBER

/ PSA DEBUG RECADV WITH WRONG SHIPMENT ORDER ID 

/ 7	. 

/ 13-RECADV
        <mtc:CONSIGNMENT>
            <mtc:SHIPMENT_ORDER>
               <mtc:SHIPMENT_ORDER_BODY>
                  <mtccore:SHIPMENT_ORDER_ID>SHO_ERR</mtccore:SHIPMENT_ORDER_ID>		<-

/s
GeoScoServiceOrderProcessor.process(Node) line: 272	
			} else if (RECEIPT_ADVICE_SHIPMENT.equals(purposeCode)) {
				processReceiptAdviceShipment(aNode, myProcessor, documentId);
/s
	private void processReceiptAdviceShipment(Node aNode, ServiceOrderBodyProcessor aProcessor, String aDocumentId) throws ServiceOrderException {
		ServiceOrderVO myServiceOrderVOIncomming = aProcessor.process(selectSingleNode(aNode, SERVICE_ORDER_BODY_TAG));
		processConsignments(aNode, myServiceOrderVOIncomming);
/ throws Exception	, 
/ TODO 
/t
		} catch (ServiceOrderException anException) {
anException=ServiceOrderException	, 
/ TODO
			String myMessage = createEnhancedErrorMessage(aNode, myProcessor, anException);
/ soort anExceptoin.toString()
/ TODO
			LOG.error(myMessage, anException);
			anException.setMessage(myMessage);
			throw anException;
/t
ServiceOrderMsgProcessor.process(Node) line: 96	
					getServiceOrderProcessor().process(myNode);
		} catch (Exception anException) {
			throw new ServiceOrderException("", anException);
/t
ServiceOrderMsgConsumer.process(Message) line: 57	
				myProcessor.process(((SapXMessage) aIncomingMessage).getDocument().getDocumentElement());
		} catch (Exception anException) {
			// The stack trace helps to identify the real cause
			LOG.error(anException);

			// Status is propagated to invoker
			setStatusFailed(MC_STATUS_FAILURE, "Could not process message: " + anException);
/t
ServiceOrderMsgConsumer(MessageConsumer).handle(Message) line: 111	
/ TODO (Waar zat hij in ?)
	}
/ returns gewoon	,

/t
MessageConsumerHandler$$EnhancerBySpringCGLIB$$ca5a33ca(MessageConsumerHandler).onExchange(MessageExchange) line: 175	
		consumer.handle(message);
/d
		if (MessageCheckStatusValues.MC_STATUS_OK != consumer.getStatus()) {
			String errormsg = String.format("Consumer could not handle message [%s]: %s", aExchange.getIn().getMessageID(), consumer.getExplanation());
			throw new MessageConsumerHandlerException(errormsg);
/t
TxExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 73	
/ TODO (Waaruit	?)
		} catch (Exception e) {
			onChainNextException(aChain, aExchange, e);
/s
TxExchangeHandler.onChainNextException(ExchangeHandlerChain, MessageExchange, Exception) line: 80	
		super.onChainNextException(aChain, aExchange, aThrownException);
/s
			aExchange.setException(aThrownException);

		// rethrow the exception to cause a transaction rollback
		throw aThrownException;


/ 7	. 

/ Op queue MPOBJECTS.FROM.GEOSCO staan application_response's , maar ook andere berichten , bijv SERVICE_ORDER_MSG	, 

/ we zien inderdaad	,
<application_response>
	<mid>ID:localhost.localdomain-32916-1465222460341-8:1:1:1:1</mid>
	<code>ERROR</code>
	<message>Consumer could not handle message [ID:localhost.localdomain-32916-1465222460341-8:1:1:1:1]: Could not process message: com.mpobjects.oms.model.serviceorder.ServiceOrderException: [In unMarshallServiceOrder.consignments(N0006368/0), error: com.mpobjects.oms.model.shipmentorder.ShipmentOrderException: [In process([ProcessingContext: SHIPMENT_ORDER_ID[SHO_ERR]][Node: [mtc:SHIPMENT_ORDER: null]][Reason: null][XmlMessage: &lt;?xml version="1.0" encoding="utf-8"?&gt;

/ en	,
<application_response>
	<mid>ID:localhost.localdomain-35542-1463059860924-8:1:1:1:1</mid>
	<code>OK</code>
	<message></message>
	<organisation>NOT-SET</organisation>
	<date>2016-05-12T15:47:23.237+02:00</date>
	<halfFlowCategory></halfFlowCategory>
	<customerName></customerName>
	<receiver></receiver>
	<instanceId></instanceId>
	<processName></processName>
	<businessDomain></businessDomain>
	<halfFlowName></halfFlowName>
	messageType></messageType><originalInstanceId></originalInstanceId><creationDate></creationDate><monitoringExchange></monitoringExchange><sourceSystem></sourceSystem><fileName></fileName><emitter></emitter><processingStep></processingStep></application_response>




/ Einde PSA DEBUG RECADV WITH WRONG SHIPMENT ORDER ID 

/ PSA DEBUG RECADV WITH 2 SHI 

/ 7 Jun	, order 40	, 
/ desadv, met 2 shi's	-> SH000001436-20160607-072349
/ recadv op SH000001436-20160607-072349	, met 2 orders dus 	, die OK zijn	, 
/ Hoe lopen die for loops	?

/ we geven in scs	, 
[eric@localhost ggs-87]$ gedit 13-RECADV-ID-SCSIN-TESTING-2.xml 


/ Intermezzo

/ STACK TRACE START TRANSACTION 

Thread [GeoScoQueueContainer-1] (Suspended (breakpoint at line 1177 in GeoScoServiceOrderProcessor))	
	GeoScoServiceOrderProcessor.processReceiptAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 1177	
	GeoScoServiceOrderProcessor.process(Node) line: 262	
			} else if (RECEIPT_ADVICE_SHIPMENT.equals(purposeCode)) {
				processReceiptAdviceShipment(aNode, myProcessor, documentId);

	ServiceOrderMsgProcessor.process(Node) line: 91	
					getServiceOrderProcessor().process(myNode);

	ServiceOrderMsgConsumer.process(Message) line: 52	
				myProcessor.process(((SapXMessage) aIncomingMessage).getDocument().getDocumentElement());

	ServiceOrderMsgConsumer(MessageConsumer).handle(Message) line: 108	
				process(incomingMessage);

	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy353.handle(Message) line: not available	
	MessageConsumerHandler$$EnhancerBySpringCGLIB$$ca5a33ca(MessageConsumerHandler).onExchange(MessageExchange) line: 172	
		MessageConsumerInterface consumer = getConsumer();
		consumer.handle(message);

	MessageConsumerHandler$$EnhancerBySpringCGLIB$$ca5a33ca(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 43	
		boolean canContinue = onExchange(aExchange);

	SingletonExchangeHandlerChain.next(MessageExchange) line: 43	
		handler.handleExchange(this, aExchange);

	DemuxExchangeHandler.handleMessage(ExchangeHandler, MessageExchange) line: 110	
		ExchangeHandlerChain chain = new SingletonExchangeHandlerChain(aHandler);
		chain.next(aExchange);

	DemuxExchangeHandler.onExchange(MessageExchange) line: 123	
		handleMessage(handler, aExchange);

	DemuxExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 43	
		boolean canContinue = onExchange(aExchange);

	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
			lastHandler = handlers.next();
			lastHandler.handleExchange(this, aExchange);

	TxExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
		try {
			aChain.next(aExchange);

	TxExchangeHandler.handleExchange(ExchangeHandlerChain, MessageExchange) line: 62	
/=
@Transactional(propagation = Propagation.SUPPORTS)
public class TxExchangeHandler extends AbstractExchangeHandler {		/ (*)
	@Override
	@Transactional(propagation = Propagation.REQUIRED, rollbackFor = Exception.class)
	public void handleExchange(@Nonnull ExchangeHandlerChain aChain, @Nonnull MessageExchange aExchange) throws Exception {
		if (commitAction != null) {
			transactionHelper.executeAfterCommit(new TxExchangeHandlerJob(commitAction, true, aExchange));
		}
		if (rollbackAction != null) {
			transactionHelper.executeAfterRollback(new TxExchangeHandlerJob(rollbackAction, false, aExchange));
		}
		super.handleExchange(aChain, aExchange);

	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy478.handleExchange(ExchangeHandlerChain, MessageExchange) line: not available	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	MessageTraceExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	AuthNExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	ArchiveExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	SapXConverterExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	ArchiveErrorExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
			aChain.next(aExchange);

	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
			lastHandler = handlers.next();
			lastHandler.handleExchange(this, aExchange);

	RetryExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
			aChain.next(aExchange);

	RetryExchangeHandler.handleExchange(ExchangeHandlerChain, MessageExchange) line: 80	
				super.handleExchange(fork, exchangeCopy);

	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
			lastHandler = handlers.next();
			lastHandler.handleExchange(this, aExchange);

	MessageHandler.handleExchange(MessageExchange) line: 55	
			handlerChain.next(aExchange);

	MpoMessageListener.processMessage(Message, JmsMpoMessage) line: 378	
			// Actually process the message
			messageHandler.handleExchange(exchange);

	MpoMessageListener.onMessage(Message) line: 199	
				processMessage(aMessage, mpoMsg);

	DefaultMessageListenerContainer(AbstractMessageListenerContainer).doInvokeListener(MessageListener, Message) line: 569	
	DefaultMessageListenerContainer(AbstractMessageListenerContainer).invokeListener(Session, Message) line: 507	
	DefaultMessageListenerContainer(AbstractMessageListenerContainer).doExecuteListener(Session, Message) line: 474	
	DefaultMessageListenerContainer(AbstractPollingMessageListenerContainer).doReceiveAndExecute(Object, Session, MessageConsumer, TransactionStatus) line: 325	
	DefaultMessageListenerContainer(AbstractPollingMessageListenerContainer).receiveAndExecute(Object, Session, MessageConsumer) line: 263	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener() line: 1103	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop() line: 1095	
	DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run() line: 992	
	Thread.run() line: 745	

/ Bij (*) begint de tx	,


/ Einde Intermezzo

/ Intermezzo

[eric@localhost ggs-87]$ gedit 13-RECADV-ID-SCSIN-TESTING.xml 
/ ERR
[eric@localhost ggs-87]$ gedit 13-RECADV-ID-SCSIN-TESTING-2.xml 
/ OK
/ TODO

/ Einde Intermezzo

		for (ConsignmentVO myConsignmentVO : myServiceOrderVOIncomming.getConsignmentList()) {
			for (ServiceActionVO myServiceActionVO : myConsignmentVO.getServiceActionList()) {
				ShipmentOrderVO myShipmentOrderVOUpdate = myServiceActionVO.getShipmentOrderVO();
				processRecAdvShipmentOrder(myShipmentOrderVOUpdate);
/s
GeoScoServiceOrderProcessor.processRecAdvShipmentOrder(ShipmentOrderVO) line: 1137	
/=
	private void processRecAdvShipmentOrder(ShipmentOrderVO aShipmentOrderVOUpdate) {
aShipmentOrderVOUpdate=processed sho	,
		ShipmentOrderVO myExistingShipmentOrder = shipmentOrderDao.getShipmentOrder(aShipmentOrderVOUpdate.getShipmentOrderId(),
				aShipmentOrderVOUpdate.getOrganization());
myExistingShipmentOrder=existing sho	,

		for (ShipmentItemVO myUpdatedItem : aShipmentOrderVOUpdate.getShipmentItemList()) {
myUpdatedItem=processed shi	, aantal=2	,
			ShipmentItemVO updatedShipmentItem = processRecAdvShipmentItem(myExistingShipmentOrder, myUpdatedItem);
/s
GeoScoServiceOrderProcessor.processRecAdvShipmentItem(ShipmentOrderVO, ShipmentItemVO) line: 1122	
		BigDecimal myActualQty = aUpdatedItem.getPackedItemList().get(0).getActualQuantity();
10
		for (ShipmentItemVO myExistingShipmentItem : aExistingShipmentOrder.getShipmentItemList()) {
			ShipmentItemVO myFound = processRecAdvNestedShipmentItem(myExistingShipmentItem, aUpdatedItem, myActualQty);
myFound=existing shi	,
/ want,	
/s
GeoScoServiceOrderProcessor.processRecAdvNestedShipmentItem(ShipmentItemVO, ShipmentItemVO, BigDecimal) line: 1095	
		if (myExistingShipmentItem.getCaseNumber() != null && myExistingShipmentItem.getCaseNumber().equalsIgnoreCase(aUpdatedItem.getCaseNumber())) {
			BigDecimal quantity = aUpdatedItem.getPackedItemList().get(0).getQuantity().setScale(5);
8.00000
/ uit XML
			List<PackedItemVO> list = packedItemDAO.getMatchedPackedItemByQuantity(myExistingShipmentItem, quantity);
[com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:26888407]
			if (list.size() > 0) {
				for (PackedItemVO pakdItem : list) {
					pakdItem.setActualQuantity(myActualQty);
					myExistingShipmentItem.getPackedItemList().add(pakdItem);
			return myExistingShipmentItem;
/t
GeoScoServiceOrderProcessor.processRecAdvShipmentItem(ShipmentOrderVO, ShipmentItemVO) line: 1130	
/=
	private ShipmentItemVO processRecAdvShipmentItem(ShipmentOrderVO aExistingShipmentOrder, ShipmentItemVO aUpdatedItem) {

		for (ShipmentItemVO myExistingShipmentItem : aExistingShipmentOrder.getShipmentItemList()) {
			ShipmentItemVO myFound = processRecAdvNestedShipmentItem(myExistingShipmentItem, aUpdatedItem, myActualQty);
/d
/ Dus gegeven existing sho, shi from XML	, the existing shi is found	, and the actual quantity in the existing shi's pcki is update	,
			if (myFound != null) {
				return myFound;
/t
GeoScoServiceOrderProcessor.processRecAdvShipmentOrder(ShipmentOrderVO) line: 1147	
		for (ShipmentItemVO myUpdatedItem : aShipmentOrderVOUpdate.getShipmentItemList()) {
			ShipmentItemVO updatedShipmentItem = processRecAdvShipmentItem(myExistingShipmentOrder, myUpdatedItem);
/d
updatedShipmentItem is existing shi	, met updated pcki	: actual quantity is set	,

			if (updatedShipmentItem != null) {
				shipmentItems.add(updatedShipmentItem);
			}
/ FIX GGS-87
			} else {
				String message = "Could not find shipment item in shipment order [" + aShipmentOrderVOUpdate.getShipmentOrderId() + "] given the case number "
						+ myUpdatedItem.getCaseNumber() + " of the proceesed shipment item in the ReceiptAdvice";
				LOG.error(message);
				throw new RuntimeException(message);
			}

/ Einde PSA DEBUG RECADV WITH 2 SHI 


/ FIX GGS-87

/ Added (*)

	private void processRecAdvShipmentOrder(ShipmentOrderVO aShipmentOrderVOUpdate) {
		ShipmentOrderVO myExistingShipmentOrder = shipmentOrderDao.getShipmentOrder(aShipmentOrderVOUpdate.getShipmentOrderId(),
				aShipmentOrderVOUpdate.getOrganization());
		if (myExistingShipmentOrder == null) {
			throw new RuntimeException("Cannot find shipment order for ReceiptAdvice: shipmentOrderId [" + aShipmentOrderVOUpdate.getShipmentOrderId() + "] and organization [" + aShipmentOrderVOUpdate.getOrganization().getCode() + "]");
		}
		Collection<ShipmentItemVO> shipmentItems = new ArrayList<ShipmentItemVO>();
		for (ShipmentItemVO myUpdatedItem : aShipmentOrderVOUpdate.getShipmentItemList()) {
myUpdatedItem= processed shi	,

			ShipmentItemVO updatedShipmentItem = processRecAdvShipmentItem(myExistingShipmentOrder, myUpdatedItem);
updatedShipmentItem= existing shi	, met case number die van de processed shi	,

			if (updatedShipmentItem != null) {
				shipmentItems.add(updatedShipmentItem);

			} else {	/ (*)
				String message = "Could not find shipment item in shipment order [" + aShipmentOrderVOUpdate.getShipmentOrderId() + "] given the case number " + myUpdatedItem.getCaseNumber() + " of the proceesed shipment item in the ReceiptAdvice";
				LOG.error(message);
				throw new RuntimeException(message);
			}
		}

		if (!shipmentItems.isEmpty()) {
			shipmentItemDAO.save(shipmentItems);
			// Trigger triggers if required
			List<ProductItemVO> myItems = productItemService.updateActualQuantities(myExistingShipmentOrder);
/ update product item	, set actual quantity	,

/ we geven 
[eric@localhost ggs-87]$ gedit 13-RECADV-ID-SCSIN-TESTING-2.xml 
		  			<mtccore:SHIPMENT_ITEM>
                     <mtccore:CASE_NUMBER>BX2</mtccore:CASE_NUMBER>
/ De shi met case number BX2 bestaat niet	,

/ we zien op de mpbojects.from.geosco queue	,

<application_response><mid>ID:localhost.localdomain-39081-1465283079373-8:1:1:1:1</mid><code>ERROR</code><message>Consumer could not handle message [ID:localhost.localdomain-39081-1465283079373-8:1:1:1:1]: Could not process message: com.mpobjects.oms.model.serviceorder.ServiceOrderException: [In process([ProcessingContext: SERVICE_ORDER_ID[N0006374]][Node: [mtc:SERVICE_ORDER: null]][Reason: Could not find shipment item in shipment order [SH000001436-20160607-072349] given the case number BX2 of the proceesed shipment item in the ReceiptAdvice][XmlMessage: &lt;?xml version="1.0" encoding="utf-8"?&gt;


/ 7	. 

/ Kijk in prod	,

[vanderveldene@geosco-int-p archive]$ (_pwd=$(pwd);cd; unzip    $_pwd/compressed/geodispsa_to-scs_ReceiptAdvice_2016-06.zip )


/ Einde FIX GGS-87

/ PSA


	private Collection<ShipmentItemVO> processDesAdvShipmentOrder(ShipmentOrderVO myShipmentOrderVO) {
			for (ShipmentItemVO myVO : myShipmentOrderVO.getShipmentItemList()) {
// WAS
				// preventing pallets in the list, they are filled with container numbers,because pallets may update
				// multiple shipment items with same label info.
				if (org.apache.commons.lang.StringUtils.isBlank(myVO.getContainerNumber())) {
					myLabels.add(myVO.getLabelInfo());
				}
			}
// NU	,
				myLabels.add(myVO.getLabelInfo());

/ TODO
/ SATTISH

/ Einde PSA



/ GGS-87

/ 7	. 

1) No actual quantity updated after RECADV reception 
For shipment SH000002627-20160601-153142 we have received a RECADV but in MPO we don't see actual quantity updated. 

RECADV received from Optilog with real quantity 
SCO_PSA_WPS321650815 
06/01/16 16:17:08 
File name: PSA_MPO_RECADV_20160601_161708_1740.xml 

2) No Actual Quantity (product items) or Reference 2 = BL (Shipment items) in RECADV sent from MPO to ATLANTIQ 
Even though Reference 2 is visible in MPO in message generated we don't have it, so message is failed in our EDI platform and not sent to Atlantiq. 

RECADV from Optilog to Atlantiq without real quantity: 
SCO_PSA_SI119482699 
06/01/16 16:17:10 
MPO.IN.RECADV.WQA_SI119482699 

/ 7	. 

https://geosco.mp-objects.com/extplorer
/ login met	,
interfacing
interfacing@mpo

geodispsa
	to-scs
		ReceiptAdvice
			archive
				2016-06
					01

/ of 	,
$ geosco-int-p.sh
[vanderveldene@geosco-int-p ~]$ cd /local/apps/interface/geodispsa/to-scs/ReceiptAdvice/archive/2016-06/01

/ 7	. 

/ Open de sho	,
SH000002627-20160601-153142
/ we zien 3 seo's	, purchase, delivery, receipt	,

/ een recadv gaat over (TODO) receipt seo	, deze is N0009887
/ we zien in deze seo 
Actual end date: 01 Jun 16:16

/ Ze hebben de desadv bijgesloten, maar dat is het verkeerde format		, UBL	, 
/ we kunnen 2 dingen doen	, om de desadv in ons format te vinden	, 
/ In /local/apps/interface/geodispsa/to-scs/ReceiptAdvice/archive/2016-06/01
/ Zoek op ongeveer 16:16	, 
/ of grep op N0009887

$ geosco-int-p.sh
[vanderveldene@geosco-int-p 01]$ pwd
/local/apps/interface/geodispsa/to-scs/ReceiptAdvice/archive/2016-06/01

[vanderveldene@geosco-int-p 01]$ awk '/16:17/' <(ls -l)
-rw-rw-r--+ 1 servicemix servicemix  8023 Jun  1 16:17 13-RECADV-ID-geosco-int-p-52926-1463537208771-2-1643-1-1-1.xml
-rw-rw-r--+ 1 servicemix servicemix 10797 Jun  1 16:17 13-RECADV-ID-geosco-int-p-52926-1463537208771-2-1643-1-1-2.xml

/ De archive is dus 1 sec later	,
/ Het is de 1ste	, maar we moeten toch de msg in om te kijken of het hem is	,
/ Dus grep is beter	,

[vanderveldene@geosco-int-p 01]$ grep N0009887 -r *
13-RECADV-ID-geosco-int-p-52926-1463537208771-2-1643-1-1-1.xml:            <mtccore:SERVICE_ORDER_ID>N0009887</mtccore:SERVICE_ORDER_ID>

$ less 13-RECADV-ID-geosco-int-p-52926-1463537208771-2-1643-1-1-1.xml
   <mtc:header>
      <mtccore:typ>SERVICE_ORDER_MSG</mtccore:typ>
      <mtccore:cre>2016-06-01T16:17:090Z</mtccore:cre>

   <mtc:body>
      <mtc:SERVICE_ORDER>
         <mtc:PROCESSING_DETAILS>
            <mtccore:PURPOSE_CODE>ReceiptAdviceShipment</mtccore:PURPOSE_CODE>
         <mtc:SERVICE_ORDER_BODY>
            <mtccore:SERVICE_ORDER_ID>N0009887</mtccore:SERVICE_ORDER_ID>
            <mtccore:SERVICE_ORDER_PROCESS>INBOUND</mtccore:SERVICE_ORDER_PROCESS>
            <mtccore:SERVICE_ORDER_TYPE>RECEIPT</mtccore:SERVICE_ORDER_TYPE>
         </mtc:SERVICE_ORDER_BODY>
         <mtc:CONSIGNMENT>
            <mtc:SHIPMENT_ORDER>
               <mtc:SHIPMENT_ORDER_BODY>
                  <mtccore:SHIPMENT_ORDER_ID>SH000002627-20160601-153142</mtccore:SHIPMENT_ORDER_ID>
               <mtc:SHIPMENT_ITEMS>
                  <mtccore:SHIPMENT_ITEM>
                     <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:PRODUCT_ITEM_ID>1</mtccore:PRODUCT_ITEM_ID>
                           <mtccore:ACTUAL_QUANTITY>1</mtccore:ACTUAL_QUANTITY>
                     <mtccore:CASE_NUMBER>8651406</mtccore:CASE_NUMBER>

/ Deze case number is er niet	, 286514066	, dus de 1ste en laatste cijfer ontbreken	, 
/ dus de code moet exc throw	, en niet doorgaan	, want hij meldt niet dat er een fout is	, hij set actual quantity gewoon niet	, en daat door	,

/ 7	. 

[vanderveldene@geosco-int-p geodispsa]$ ls
from-geobus  from-jms  from-scs  scs-from-jms  test  to-geobus  to-scs

/ De oorspronkelijke bericht meegestuurd met GGS-87	, PSA_MPO_RECADV_20160601_161708_1740.xml, vinden we WH in from-geobus	,
[vanderveldene@geosco-int-p 01]$ less 13-RECADV-ID-geosco-int-p-52926-1463537208771-2-1643-1-1-1.xml

<?xml version="1.0" encoding="UTF-8" standalone="yes" ?><ReceiptAdvice xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns='urn:oasis:names:specification:ubl:schema:xsd:ReceiptAdvice-2' xmlns:cbc='urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2' xmlns:cac='urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2' xsi:schemaLocation="urn:oasis:names:specification:ubl:schema:xsd:ReceiptAdvice-2 UBL-ReceiptAdvice-2.1.xsd" ><cbc:UBLVersionID>2.1</cbc:UBLVersionID><cbc:ID>1129</cbc:ID><cbc:IssueDate>2016-06-01</cbc:IssueDate><cbc:IssueTime>16:17:01</cbc:IssueTime><cac:OrderReference><cbc:ID>N0009887</cbc:ID><cbc:OrderTypeCode>ServiceOrder</cbc:OrderTypeCode></cac:OrderReference><cac:DeliveryCustomerParty><cac:Party><cac:PartyIdentification><cbc:ID schemeID="COFOR" >093139861944500198</cbc:ID></cac:PartyIdentification><cac:PartyName><cbc:Name>GEODIS AUTOMOTIVE EST</cbc:Name></cac:PartyName></cac:Party></cac:DeliveryCustomerParty><cac:DespatchSupplierParty><cac:Party><cac:PartyIdentification><cbc:ID schemeID="COFOR" >98127J  02</cbc:ID></cac:PartyIdentification><cac:PartyName><cbc:Name>FAURECIA</cbc:Name></cac:PartyName></cac:Party></cac:DespatchSupplierParty><cac:Shipment><cbc:ID>47308288</cbc:ID><cac:Delivery><cbc:ID>47308288</cbc:ID><cbc:ActualDeliveryDate>2016-06-01</cbc:ActualDeliveryDate><cbc:ActualDeliveryTime>16:16:56</cbc:ActualDeliveryTime><cac:CarrierParty><cac:PartyIdentification><cbc:ID/></cac:PartyIdentification><cac:PartyName><cbc:Name/></cac:PartyName></cac:CarrierParty></cac:Delivery></cac:Shipment><cac:ReceiptLine><cbc:ID>1</cbc:ID><cbc:ReceivedQuantity unitCode="PCE" >1</cbc:ReceivedQuantity><cac:OrderLineReference><cbc:LineID>1</cbc:LineID><cac:OrderReference><cbc:ID>SH000002627-20160601-153142</cbc:ID><cbc:OrderTypeCode>ShipmentOrder</cbc:OrderTypeCode></cac:OrderReference></cac:OrderLineReference><cac:Item><cbc:Description>P84  VOLET SIMPLE  NOIR PERLA NERA</cbc:Description><cbc:PackSizeNumeric>1</cbc:PackSizeNumeric><cac:SellersItemIdentification><cbc:ID>981082609V</cbc:ID></cac:SellersItemIdentification><cac:ItemInstance><cac:AdditionalItemProperty><cbc:Name>SHIPPING_UNIT</cbc:Name><cbc:Value>PCE</cbc:Value></cac:AdditionalItemProperty><cac:LotIdentification><cbc:LotNumberID/></cac:LotIdentification></cac:ItemInstance></cac:Item><cac:Shipment><cbc:ID/><cac:TransportHandlingUnit><cac:TransportEquipment><cbc:ID>8651406</cbc:ID><cbc:TransportEquipmentTypeCode>SB104</cbc:TransportEquipmentTypeCode><cac:ContainedInTransportEquipment><cbc:ID>8651406</cbc:ID><cbc:TransportEquipmentTypeCode>SB104</cbc:TransportEquipmentTypeCode><cac:GoodsItem><cbc:Quantity unitCode="PCE" >1</cbc:Quantity></cac:GoodsItem></cac:ContainedInTransportEquipment><cac:GoodsItem><cbc:Quantity unitCode="PCE" >1</cbc:Quantity></cac:GoodsItem></cac:TransportEquipment></cac:TransportHandlingUnit></cac:Shipment></cac:ReceiptLine></ReceiptAdvice>

/ we zien de ERR case number <cbc:ID>8651406</cbc:ID><	, it should have been <cbc:ID>286514066</cbc:ID><
/ Ga op prod naar SH000002627-20160601-153142	, dat zie je deze shi	,


/ Einde GGS-87



/ PSA-267

/ 7	. 

/ Dus dit is WH sales order= forecast out= FC Out	, = WH fabriek PSA asks	,
[vanderveldene@geosco-int-p to-scs]$ less ForecastRevision/archive/2016-06/02/01-FORECAST-ID-geosco-int-p-52926-1463537208771-2-1716-1-1-1.xml 
            <mtc:CUSTOMER_ORDER_TYPE>SALES_ORDER</mtc:CUSTOMER_ORDER_TYPE>

/ 7	. 

/ In prod db local	, kies bijv, co CO000023680	,
/ planning, customer order, search forecast
/ Kies een co	,
/ Als hij firm is, dan moet er een sho zijn	, maar  is er niet	,
/ TODO

/ 7	. 

/ planning, inventory, stock count	,
/ Kies soc (SOCHAUX)
/ doe dan check	,

/ planning, customer order, search forecast
/ we zien co's 	met 'Creation date'	, dat is system_entry_date in db	,


/ issue	, 
/ via forcast xml	, of stock count scherm	, zorg dat balance in rood: moet email komen	, 
/ via FC out gaat het WH OK	,
/ via stock count scherm ERR	,

/ forecast msg -> FC Out 	OK
/ inventory report -> count ERR
/ scherm ERR

/ 7	. 

/ customer order: shipment order =1:N

/ 7	. 

/ een product item refs naar een customer order line	, 
/ dus dan kun je een customer order line NIET rm

/ Einde PSA-267

/ PSA-267

/ db geosco0620a
/ vandaag 0621	, 
/ we geven 280 op 27 Jun op count scherm	,
Planning, Inventory, Stock count
/ Zoek op location	,  geef soc	/= SOCHAUX
/ Kies Count Date 27 Jun
/ Set allen op skip	,
/ Zoek Prod1 , unskip en set op 280
Save and close	,
/ Ga terug naar replenish scherm	, het is gelukt	, de balance is rood vanaf 27 Jun	

/ De balance is 280 op 27-06	, en advice 120	, Klopt precies	,
300/400/500/2d/20  
min/target/max/lead time/units
/ het vakje is rood	, want is ongelijk aan het advice	,

/ 7	. 

[eric@localhost Geosco]$ pwd
/home/eric/Integration/Geosco
[eric@localhost Geosco]$ scp vanderveldene@geosco-int-p.intermax.mp-objects.com:/local/apps/interface/geodispsa/to-scs/ForecastRevision/archive/2016-06/21/01-FORECAST-ID-geosco-int-p-52926-1463537208771-2-3674-1-1-1.xml ForecastRevision/archive/2016-06/21/
[eric@localhost Geosco]$ scp vanderveldene@geosco-int-p.intermax.mp-objects.com:/local/apps/interface/geodispsa/to-scs/ForecastRevision/archive/2016-06/21/01-FORECAST-ID-geosco-int-p-52926-1463537208771-2-3664-1-1-1.xml ForecastRevision/archive/2016-06/21/

/ we gaan proberen hetzelfde te doen als we deden op het stock count scherm	, 

/ purchase_order = forecast_in	, 
/ sales_order= forecast_out

/ planning, customer order, search forecast
/ open een sales order	, 
/ we zien customer order lines	, 
/ deze staan in de forecast xml	,

[eric@localhost 21]$ pwd
/home/eric/Integration/Geosco/ForecastRevision/archive/2016-06/21
$ less my-FORECAST-0621.xml

<?xml version="1.0" encoding="utf-8"?>
<co:CUSTOMER_ORDER_MSG xmlns:xs="http://www.w3.org/2001/XMLSchema"
                       xmlns:mtc="http://system.mp-objects.com/schemas/MTC/MTCCore/V1/MTCCore.xsd"
                       xmlns:co="http://system.mp-objects.com/schemas/MTC/CustomerOrder/CustomerOrder.xsd"
                       xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2"
                       xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2"
                       xmlns:fc="urn:oasis:names:specification:ubl:schema:xsd:ForecastRevision-2">
   <co:header>
      <mtc:typ>CUSTOMER_ORDER_MSG</mtc:typ>
      <mtc:mid/>
      <mtc:ver>1.0</mtc:ver>
      <mtc:mode>P</mtc:mode>
      <mtc:ack>NE</mtc:ack>
      <mtc:cre>2016-06-21T01:56:00</mtc:cre>
      <mtc:sap>GEODIS</mtc:sap>
      <mtc:rap>MPO</mtc:rap>
      <mtc:ref>
         <mtc:VALUE>WPS325268528</mtc:VALUE>
         <mtc:QUALIFIER>instanceId</mtc:QUALIFIER>
      </mtc:ref>
      <mtc:ref>
         <mtc:VALUE>SCO_PSA</mtc:VALUE>
         <mtc:QUALIFIER>monitoringExchange</mtc:QUALIFIER>
      </mtc:ref>
      <mtc:ref>
         <mtc:VALUE/>
         <mtc:QUALIFIER>sourceSystem</mtc:QUALIFIER>
      </mtc:ref>
      <mtc:ref>
         <mtc:VALUE>SCO.PSA.E_MPO_DELFOR</mtc:VALUE>
         <mtc:QUALIFIER>halfFlowName</mtc:QUALIFIER>
      </mtc:ref>
      <mtc:ref>
         <mtc:VALUE>Silver</mtc:VALUE>
         <mtc:QUALIFIER>halfFlowCategory</mtc:QUALIFIER>
      </mtc:ref>
      <mtc:ref>
         <mtc:VALUE/>
         <mtc:QUALIFIER>emitter</mtc:QUALIFIER>
      </mtc:ref>
      <mtc:ref>
         <mtc:VALUE>SCO.A.MPO</mtc:VALUE>
         <mtc:QUALIFIER>receiver</mtc:QUALIFIER>
      </mtc:ref>
      <mtc:ref>
         <mtc:VALUE>Supply Chain Optimization</mtc:VALUE>
         <mtc:QUALIFIER>businessDomain</mtc:QUALIFIER>
      </mtc:ref>
      <mtc:ref>
         <mtc:VALUE>SCO.A.MPO</mtc:VALUE>
         <mtc:QUALIFIER>customerName</mtc:QUALIFIER>
      </mtc:ref>
      <mtc:ref>
         <mtc:VALUE>PES_CORPORATE_TX</mtc:VALUE>
         <mtc:QUALIFIER>processName</mtc:QUALIFIER>
      </mtc:ref>
      <mtc:ref>
         <mtc:VALUE/>
         <mtc:QUALIFIER>processingStep</mtc:QUALIFIER>
      </mtc:ref>
      <mtc:ref>
         <mtc:VALUE/>
         <mtc:QUALIFIER>creationDate</mtc:QUALIFIER>
      </mtc:ref>
      <mtc:ref>
         <mtc:VALUE/>
         <mtc:QUALIFIER>originalInstanceId</mtc:QUALIFIER>
      </mtc:ref>
      <mtc:ref>
         <mtc:VALUE>PSA_MPO_DELFOR_20160621_064705_2454.xml</mtc:VALUE>
         <mtc:QUALIFIER>fileName</mtc:QUALIFIER>
      </mtc:ref>
      <mtc:ref>
         <mtc:VALUE>DELFOR_UBL</mtc:VALUE>
         <mtc:QUALIFIER>messageType</mtc:QUALIFIER>
      </mtc:ref>
   </co:header>
   <co:body>
      <co:CUSTOMER_ORDER>
         <mtc:PROCESSING_DETAILS>
            <mtc:PURPOSE_CODE>FORECAST_UPDATE</mtc:PURPOSE_CODE>
         </mtc:PROCESSING_DETAILS>
         <mtc:CUSTOMER_ORDER_BODY>
            <mtc:CUSTOMER_ORDER_ID/>
            <mtc:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtc:ORGANIZATION_ID>
            <mtc:FORECAST>
               <mtc:FORECAST_ID>2016-06-21-PSA</mtc:FORECAST_ID>					<- 1
               <mtc:FORECAST_STATUS>FORECAST</mtc:FORECAST_STATUS>
               <mtc:FORECAST_DATE>2016-06-21T01:56:00</mtc:FORECAST_DATE>
            </mtc:FORECAST>
            <mtc:BUYER_ORDER_NUMBER>0004454269</mtc:BUYER_ORDER_NUMBER>				<- 2
            <mtc:CREATION_DATE>2016-06-21T01:56:00</mtc:CREATION_DATE>				<- 3
            <mtc:CUSTOMER_ORDER_TYPE>SALES_ORDER</mtc:CUSTOMER_ORDER_TYPE>			<- 3a
            <mtc:BUYER>
               <mtc:PARTY_ID>000254206547900140</mtc:PARTY_ID>						<- 4
            </mtc:BUYER>
            <mtc:SELLER>
               <mtc:PARTY_ID>093139861944500198</mtc:PARTY_ID>
            </mtc:SELLER>
         </mtc:CUSTOMER_ORDER_BODY>
         <mtc:CUSTOMER_ORDER_LINE>
            <mtc:CUSTOMER_ORDER_LINE_ID>1766</mtc:CUSTOMER_ORDER_LINE_ID>
            <mtc:SELLER_ORDER_LINE_NUMBER/>
            <mtc:PRODUCT>
               <mtc:PRODUCT_ID>MPO_Prod1</mtc:PRODUCT_ID>							<- 5
            </mtc:PRODUCT>
            <mtc:GOODS_STATUS>
               <mtc:INTERNAL_STATUS_CODE>GOOD</mtc:INTERNAL_STATUS_CODE>
            </mtc:GOODS_STATUS>
            <mtc:QUANTITY>30</mtc:QUANTITY>											<- 6 
            <mtc:FROM_PARTY>
               <mtc:PARTY_ID>093139861944500198</mtc:PARTY_ID>						<- 4 
            </mtc:FROM_PARTY>
            <mtc:TO_PARTY>
               <mtc:PARTY_ID>000254206547900140</mtc:PARTY_ID>						
            </mtc:TO_PARTY>
            <mtc:REQUESTED_START_AFTER>2016-06-27T00:00:00</mtc:REQUESTED_START_AFTER>	<- 7
            <mtc:REQUESTED_END_AFTER>2016-06-27T23:59:59</mtc:REQUESTED_END_AFTER>
            <mtc:INCO_TERM>
               <mtc:CODE>EXW</mtc:CODE>
            </mtc:INCO_TERM>
            <mtc:REFERENCE>
               <mtc:VALUE>1 Days</mtc:VALUE>
               <mtc:QUALIFIER>REFERENCE1</mtc:QUALIFIER>
            </mtc:REFERENCE>
            <mtc:REFERENCE>
               <mtc:VALUE/>
               <mtc:QUALIFIER>REFERENCE2</mtc:QUALIFIER>
            </mtc:REFERENCE>
            <mtc:REFERENCE>
               <mtc:VALUE>9806625180</mtc:VALUE>
               <mtc:QUALIFIER>REFERENCE3</mtc:QUALIFIER>
            </mtc:REFERENCE>
            <mtc:REFERENCE>
               <mtc:VALUE>1</mtc:VALUE>
               <mtc:QUALIFIER>REFERENCE4</mtc:QUALIFIER>
            </mtc:REFERENCE>
         </mtc:CUSTOMER_ORDER_LINE>
      </co:CUSTOMER_ORDER>
   </co:body>
</co:CUSTOMER_ORDER_MSG>


/ 1	. date dat de forecast is bepaald	, doet er niet toe	,
/ 2	. id van de forecast  TODO als we vervolgens deze forecast 
/ 3	. misschien zoiets als 1. TODO
/ 3a	. sales_order = forecast_out	, het is dus een FORECAST_OUT
/ 4	.  in party table	,
	 26878344 |          0 | 093139861944500198 |            26877277 |                 12000 | GEODIS AUTOMOTIVE EST SOCHAUX 
  26878432 |          0 | 000254206547900140 |            26877276 |                 12000 | PSA Montage SX | Client livré 
/ 5	. we kiezen het product MPO_Prod1
/ 6	. quantity, die we normaal in het vakje set	, als deze 20	, gaat er 20 van de balance af	, als 30 , en de id in 2 is gelijk	, dan gaat er 30 af van de balance, waar er eerder 20 vanaf was gegaan	, het is een update	als de id uit 2. hetzelfde is	, dus NIET 50 eraf	, maar 30	,
/ 7	. de date die we zien op het repl. forecast screen	,    

/ OK	, 
/ Bij quant 20 ging de balance van 240 -> 220	, bij quant 40 ging de balance van 220 -> 210

/ 13	. 

/ MICHEL 
$ vi local_application.properties

module.core.emailservice.server.host=smtp.internal.mp-objects.com
module.core.emailservice.destination.override.development=michel.lopez@mpobjects.com
# email

module.inventory.recalculation.service.interval=43200000
# tmp


/ en 	, 
https://system.mp-objects.com/xwiki/bin/view/Blog/New+E-Mail+service+in+SCS

/ Maak in orde	,
geosco-int-from-p.sh 

/ Lees	,
http://www.commandlinefu.com/commands/view/7789/copy-a-file-over-ssh-without-scp

/ update local_application.properties in geosco

/ 13	. 

/ we zien ERR	,

2016-06-22 10:02:27,582 ERROR [com.mpobjects.control.clockevent.ScheduleListener] (Timer-2:) SchedulerListener Error at [Wed Jun 22 10:01:44 CEST 2016], JNDI name [ejb/GeoScoInterfaceRunnerFacade].:com.mpobjects.util.service.ServiceLocatorException: [could not get remote home for jndi name ejb/GeoScoInterfaceRunnerFacade] ejb not bound
com.mpobjects.util.service.ServiceLocatorException: [could not get remote home for jndi name ejb/GeoScoInterfaceRunnerFacade] ejb not bound
	at com.mpobjects.util.service.ServiceLocator.getRemoteHome(ServiceLocator.java:136)
	at com.mpobjects.control.clockevent.ScheduleListener.delegateTimeOutHandlingToBean(ScheduleListener.java:141)
	at com.mpobjects.control.clockevent.ScheduleListener.perform(ScheduleListener.java:113)
	at org.jboss.varia.scheduler.Scheduler$Listener.handleNotification(Scheduler.java:1251)
	at sun.reflect.GeneratedMethodAccessor10.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.jboss.mx.notification.NotificationListenerProxy.invoke(NotificationListenerProxy.java:153)
	at com.sun.proxy.$Proxy11.handleNotification(Unknown Source)
	at javax.management.NotificationBroadcasterSupport.handleNotification(NotificationBroadcasterSupport.java:274)
	at javax.management.NotificationBroadcasterSupport$SendNotifJob.run(NotificationBroadcasterSupport.java:339)
	at javax.management.NotificationBroadcasterSupport$1.execute(NotificationBroadcasterSupport.java:324)
	at javax.management.NotificationBroadcasterSupport.sendNotification(NotificationBroadcasterSupport.java:247)
	at javax.management.timer.Timer.sendNotification(Timer.java:1235)
	at javax.management.timer.Timer.notifyAlarmClock(Timer.java:1197)
	at javax.management.timer.TimerAlarmClock.run(Timer.java:1286)
	at java.util.TimerThread.mainLoop(Timer.java:555)
	at java.util.TimerThread.run(Timer.java:505)
Caused by: javax.naming.NameNotFoundException: ejb not bound
	at org.jnp.server.NamingServer.getBinding(NamingServer.java:529)
	at org.jnp.server.NamingServer.getBinding(NamingServer.java:537)
	at org.jnp.server.NamingServer.getObject(NamingServer.java:543)
	at org.jnp.server.NamingServer.lookup(NamingServer.java:267)
	at org.jnp.interfaces.NamingContext.lookup(NamingContext.java:625)
	at org.jnp.interfaces.NamingContext.lookup(NamingContext.java:587)
	at javax.naming.InitialContext.lookup(InitialContext.java:411)
	at com.mpobjects.util.service.ServiceLocator.getRemoteHome(ServiceLocator.java:129)
	... 17 more

/ 13	. 

select st.* 
from stock_transaction st
join product p on st.product_systemid=p.system_id
join goods_status gs on st.goods_status_systemid=gs.system_id
join stock_location sl on st.stock_location_systemid=sl.system_id
where p.productid='MPO_Prod1'
and gs.code='GOOD'
and sl.name='GEODIS_WHS_FR_SOCHAUX'
and st.transaction_date >=timestamp '2016-06-27' 
and st.transaction_date <=timestamp '2016-06-27' + interval '1 day'
;

 system_id | quantity  | serial_number | lot_id |  transaction_date   | product_systemid | goods_status_systemid | stock_lo
cation_systemid | product_item_systemid | external_id | organization_systemid | calc_stock_level | is_dirty | transaction_t
ype | customer_order_line_systemid | shipment_item_systemid | ignore_on_balance 
-----------+-----------+---------------+--------+---------------------+------------------+-----------------------+---------
----------------+-----------------------+-------------+-----------------------+------------------+----------+--------------
----+------------------------------+------------------------+-------------------
  27232007 | -20.00000 | NULL          | NULL   | 2016-06-27 23:55:00 |         27044086 |              26877284 |         
       26878346 |                  NULL | NULL        |                 12000 |             NULL |        1 | FORECAST_OUT 
    |                     27360294 |                   NULL |                 0
  27232004 | 240.00000 | NULL          | NULL   | 2016-06-27 00:00:00 |         27044086 |              26877284 |         
       26878346 |                  NULL | SC000000034 |                 12000 |        240.00000 |        0 | COUNT        
    |                         NULL |                   NULL |                 0
  27232003 | 280.00000 | NULL          | NULL   | 2016-06-27 00:00:00 |         27044086 |              26877284 |         
       26878346 |                  NULL | SC000000032 |                 12000 |        280.00000 |        0 | COUNT        
    |                         NULL |                   NULL |                 0
(3 rows)

/ Klopt	, 
/ we hebben forecast_out's gedaan: 20,30,20,	 en hij updates, dus we zien maar 1 forecast	,
/ we zien 2 counts	,

/ we maken 

[eric@localhost Geosco]$ gedit InventoryReport/archive/2016-06/15/my-INVRPT-2-a.xml 

     <mtc:STOCK_TRANSACTION_GROUP>
         <mtc:PROCESSING_DETAILS>
            <mtccore:PURPOSE_CODE>05</mtccore:PURPOSE_CODE>
         </mtc:PROCESSING_DETAILS>
         <mtc:STOCK_TRANSACTION>
            <mtc:QUANTITY>400</mtc:QUANTITY>
            <mtc:ABSOLUTE/>
            <mtc:SERIAL_NUMBER/>
            <mtc:LOT_ID/>
            <mtc:TRANSACTION_DATE>2016-06-27T11:48:29Z</mtc:TRANSACTION_DATE>
            <mtc:PRODUCT_ID>MPO_Prod1</mtc:PRODUCT_ID>
            <mtc:GOODS_STATUS>GOOD</mtc:GOODS_STATUS>
            <mtc:LOCATION>GEODIS_WHS_FR_SOCHAUX</mtc:LOCATION>
            <mtc:EXTERNAL_ID>1150-2016-06-27T11:48:29Z</mtc:EXTERNAL_ID>
            <mtc:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtc:ORGANIZATION_ID>
         </mtc:STOCK_TRANSACTION>
      </mtc:STOCK_TRANSACTION_GROUP>

/ we geven aan SCS	, en we zien in db	,

 system_id | quantity  | serial_number | lot_id |  transaction_date   | product_systemid | goods_status_systemid | stock_lo
cation_systemid | product_item_systemid |        external_id        | organization_systemid | calc_stock_level | is_dirty |
 transaction_type | customer_order_line_systemid | shipment_item_systemid | ignore_on_balance 
-----------+-----------+---------------+--------+---------------------+------------------+-----------------------+---------
----------------+-----------------------+---------------------------+-----------------------+------------------+----------+
------------------+------------------------------+------------------------+-------------------
  27232008 | 400.00000 |               |        | 2016-06-27 11:48:29 |         27044086 |              26877284 |         
       26878346 |                  NULL | 1150-2016-06-27T11:48:29Z |                 12000 |             NULL |        1 |
 COUNT            |                         NULL |                   NULL |                 0
  27232007 | -20.00000 | NULL          | NULL   | 2016-06-27 23:55:00 |         27044086 |              26877284 |         
       26878346 |                  NULL | NULL                      |                 12000 |             NULL |        1 |
 FORECAST_OUT     |                     27360294 |                   NULL |                 0
  27232004 | 240.00000 | NULL          | NULL   | 2016-06-27 00:00:00 |         27044086 |              26877284 |         
       26878346 |                  NULL | SC000000034               |                 12000 |        240.00000 |        0 |
 COUNT            |                         NULL |                   NULL |                 0
  27232003 | 280.00000 | NULL          | NULL   | 2016-06-27 00:00:00 |         27044086 |              26877284 |         
       26878346 |                  NULL | SC000000032               |                 12000 |        280.00000 |        0 |
 COUNT            |                         NULL |                   NULL |                 0
(4 rows)

/ we zien op het scherm balance 380, en geen 400	, 
/ dat is omdat de forecast_out -20 later is dan onze count	, dus 400-20=380	.

/ een count word opgezocht aan de hand van de externalId	, 
/ een forecast_out wordt opgezocht aan de hand van de 'Buyer Order number' in de CO	,
/ SCS maakt de Customer Order Number 	, dus forecast_in's worden opgezocht aan de hand van deze 'Customer Order Number'	,

/ 13	. 

/ we hebben dus 2 msg's create	,

[eric@localhost Geosco]$ gedit InventoryReport/archive/2016-06/15/my-INVRPT-2-a.xml 		/ COUNT
[eric@localhost Geosco]$ less ForecastRevision/archive/2016-06/21/my-FORECAST-0621.xml		/ FORECAST_OUT

/ 13	. 

/ we geven nog een keer een forecast_out	, met 150	, 

           <mtc:REQUESTED_START_AFTER>2016-06-27T00:00:00</mtc:REQUESTED_START_AFTER>
            <mtc:REQUESTED_END_AFTER>2016-06-27T23:59:59</mtc:REQUESTED_END_AFTER>

/ Dus we geven in de forecast_out de dag op , hierboven	,
/ het systeem set de time altijd op 23:55:00	, dat valt altijd na de COUNT	,

/ we zien in de db	,

geosco0620a=# select st.*
from stock_transaction st
join product p on st.product_systemid=p.system_id
join goods_status gs on st.goods_status_systemid=gs.system_id
join stock_location sl on st.stock_location_systemid=sl.system_id
where p.productid='MPO_Prod1'
and gs.code='GOOD'
and sl.name='GEODIS_WHS_FR_SOCHAUX'
and st.transaction_date >=timestamp '2016-06-27'  
and st.transaction_date <=timestamp '2016-06-27' + interval '1 day'
;
 system_id |  quantity  | serial_number | lot_id |  transaction_date   | product_systemid | goods_status_systemid | stock_l
ocation_systemid | product_item_systemid |        external_id        | organization_systemid | calc_stock_level | is_dirty 
| transaction_type | customer_order_line_systemid | shipment_item_systemid | ignore_on_balance 
-----------+------------+---------------+--------+---------------------+------------------+-----------------------+--------
-----------------+-----------------------+---------------------------+-----------------------+------------------+----------
+------------------+------------------------------+------------------------+-------------------
  27232010 | -150.00000 | NULL          | NULL   | 2016-06-27 23:55:00 |         27044086 |              26877284 |        
        26878346 |                  NULL | NULL                      |                 12000 |             NULL |        1 
| FORECAST_OUT     |                     27360296 |                   NULL |                 0
  27232008 |  400.00000 |               |        | 2016-06-27 11:48:29 |         27044086 |              26877284 |        
        26878346 |                  NULL | 1150-2016-06-27T11:48:29Z |                 12000 |             NULL |        1 
| COUNT            |                         NULL |                   NULL |                 0
  27232004 |  240.00000 | NULL          | NULL   | 2016-06-27 00:00:00 |         27044086 |              26877284 |        
        26878346 |                  NULL | SC000000034               |                 12000 |        240.00000 |        0 
| COUNT            |                         NULL |                   NULL |                 0
  27232003 |  280.00000 | NULL          | NULL   | 2016-06-27 00:00:00 |         27044086 |              26877284 |        
        26878346 |                  NULL | SC000000032               |                 12000 |        280.00000 |        0 
| COUNT            |                         NULL |                   NULL |                 0
(4 rows)

/ we zien balance=400-150=250

/ 13. 	

/ In user eric geven we 
email : eric.vandervelden@mpobjects.com

/ 13	. 

/ we geven de COUNT nog een keer , maar nu met 600	, 
//////////////////////////////////
/ met dezelfde external_id	,
/ Als we de transaction_date veranderen, verandert de transaction_date is de db	, in dezelfde COUNT, dus wordt update	,

[eric@localhost Geosco]$ gedit InventoryReport/archive/2016-06/15/my-INVRPT-2-a.xml 

         <mtc:STOCK_TRANSACTION>
            <mtc:QUANTITY>600</mtc:QUANTITY>
            <mtc:TRANSACTION_DATE>2016-06-27T11:49:29Z</mtc:TRANSACTION_DATE>		<- 48 -> 49
            <mtc:PRODUCT_ID>MPO_Prod1</mtc:PRODUCT_ID>
            <mtc:GOODS_STATUS>GOOD</mtc:GOODS_STATUS>
            <mtc:LOCATION>GEODIS_WHS_FR_SOCHAUX</mtc:LOCATION>
            <mtc:EXTERNAL_ID>1150-2016-06-27T11:48:29Z</mtc:EXTERNAL_ID>
            <mtc:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtc:ORGANIZATION_ID>
         </mtc:STOCK_TRANSACTION>

/ we zien in de db	, dat hij de COUNT heeft update	,

 system_id |  quantity  | serial_number | lot_id |  transaction_date   | product_systemid | goods_status_systemid | stock_l
ocation_systemid | product_item_systemid |        external_id        | organization_systemid | calc_stock_level | is_dirty 
| transaction_type | customer_order_line_systemid | shipment_item_systemid | ignore_on_balance 
-----------+------------+---------------+--------+---------------------+------------------+-----------------------+--------
-----------------+-----------------------+---------------------------+-----------------------+------------------+----------
+------------------+------------------------------+------------------------+-------------------
------------------+------------------------------+------------------------+-------------------
  27232010 | -150.00000 | NULL          | NULL   | 2016-06-27 23:55:00 |         27044086 |              26877284 |        
        26878346 |                  NULL | NULL                      |                 12000 |             NULL |        1 
| FORECAST_OUT     |                     27360296 |                   NULL |                 0
  27232008 |  600.00000 |               |        | 2016-06-27 11:49:29 |         27044086 |              26877284 |        
        26878346 |                  NULL | 1150-2016-06-27T11:48:29Z |                 12000 |             NULL |        1 
| COUNT            |                         NULL |                   NULL |                 0
  27232004 |  240.00000 | NULL          | NULL   | 2016-06-27 00:00:00 |         27044086 |              26877284 |        
        26878346 |                  NULL | SC000000034               |                 12000 |        240.00000 |        0 
| COUNT            |                         NULL |                   NULL |                 0
  27232003 |  280.00000 | NULL          | NULL   | 2016-06-27 00:00:00 |         27044086 |              26877284 |        
        26878346 |                  NULL | SC000000032               |                 12000 |        280.00000 |        0 
| COUNT            |                         NULL |                   NULL |                 0
(4 rows)


/ dan balance=600-450	,

/ Nu maken we een forecast_out	, 

[eric@localhost Geosco]$ gedit  ForecastRevision/archive/2016-06/21/my-FORECAST-0621.xml 

            <mtc:BUYER_ORDER_NUMBER>0004454269</mtc:BUYER_ORDER_NUMBER>
            <mtc:QUANTITY>450</mtc:QUANTITY>

/ OK	, de balance is 600-450=150	, 
/ Maar ik krijg geen email	,
/ TODO

/ Einde PSA-267

/ DEBUG PSA-267 STOCK COUNT SCREEN

/ 7	. 

Planning, Inventory, Stock count
/= StockCountListPage	,

$ vi StockCountListPage.java
		myRowActions.add(new RowAction() {
			@Override
			public boolean execute(Object aObject) {
				StockCountEditPage myPage = new StockCountEditPage((Integer) aObject, StockCountListPage.this);
				setResponsePage(myPage);
				return false;
			}
		});

$ vi StockCountEditPage.html

				<td nowrap="nowrap" class="input"><span wicket:id="countDate" /></td>

						<tr class="headers">
							<th><input id="selectall" type="checkbox">
						</tr>
						<tr wicket:id="itemList">
							<td><input wicket:id="skipFlag" id="skipme" type="checkbox" /></td>
							<td><input wicket:id="count" /></td>
						</tr>

$ vi StockCountEditPage.java

		AjaxFallbackButton mySave = new AjaxFallbackButton("save", form) {

			@Override
			protected void onSubmit(AjaxRequestTarget aTarget, Form<?> aForm) {
->				saveStockCount();
				aTarget.addComponent(feedbackPanel);
			}

		};

/ 7	. 

/ Save op count edit scherm	,
/ we geven 240 op Mpo_Prod1 op 26 Jun	,
/s
StockCountEditPage$2.onSubmit(AjaxRequestTarget, Form<?>) line: 160	
/=
		AjaxFallbackButton mySave = new AjaxFallbackButton("save", form) {

			@Override
			protected void onSubmit(AjaxRequestTarget aTarget, Form<?> aForm) {
				saveStockCount();
/s
StockCountEditPage.saveStockCount() line: 269	
		daoWrapper.getBean().deleteForExternalId(getReference());
SC000000033
/ 1ste veld	, = external id van de stock tx	,

		for (StockCountDetail myStockCount : myStockCountDetailList.getModelObject()) {
			if (!myStockCount.isSkipFlag()) {
				StockTransaction myStockTransaction = new StockTransaction();
this	StockCountEditPage  (id=18095)	
myStockCount	StockCountDetail  (id=18096)	
	count	Integer  (id=18107)	
240
	countDate	null							/ TODO	, 
	goodsStatus	"GOOD" (id=18108)	
	product	Product_$$_javassist_14  (id=18112)	
MPO_Prod1 (27044086)
	skipFlag	false	

				StockTransaction myStockTransaction = new StockTransaction();
				myStockTransaction.setDirty(true);
				myStockTransaction.setExternalId(getReference());
SC000000034
				myStockTransaction.setOrganization(AuthenticationUtils.getResource().getActiveOrganization());
SystemId:12000	Id:LOG_EMEA_FR_CT_PSA	Description:Organization for PSA CT
				myStockTransaction.setProduct(myStockCount.getProduct());
MPO_Prod1 (27044086)
				if (StringUtils.isBlank(myStockCount.getGoodsStatus())) {
/ NEE
				} else {
					myStockTransaction.setGoodsStatus(goodsStatusDAO.getBean().getByCode(myStockCount.getGoodsStatus()));
GOOD
				myStockTransaction.setQuantity(new BigDecimal(myStockCount.getCount()));
240
				myStockTransaction.setStockLocation(stockLocationDaoWrapper.getBean().getBySystemId(stockLocationModel.getObject().getSystemId()));
GEODIS_WHS_FR_SOCHAUX
				myStockTransaction.setTransactionDate(getCountDate());
Mon Jun 27 00:00:00 CEST 2016
				myStockTransaction.setTransactionType(StockTransactionType.COUNT);
				daoWrapper.getBean().save(myStockTransaction);
				recordAdded = true;
		}
/ Geen volgende	,
		if (recordAdded) {
			feedbackPanel.info("Stock Transactions Created.");

/ Einde DEBUG PSA-267 STOCK COUNT SCREEN

/ DEBUG PSA-267 FORECAST_OUT MESSAGE 

/ stack trace	, 

Thread [GeoScoQueueContainer-1] (Suspended)	
	MessageConsumerHandler$$EnhancerBySpringCGLIB$$1564440d(MessageConsumerHandler).onExchange(MessageExchange) line: 172	
		consumer.handle(message);

	MessageConsumerHandler$$EnhancerBySpringCGLIB$$1564440d(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 43	
	SingletonExchangeHandlerChain.next(MessageExchange) line: 43	
	DemuxExchangeHandler.handleMessage(ExchangeHandler, MessageExchange) line: 110	
	DemuxExchangeHandler.onExchange(MessageExchange) line: 123	
		handleMessage(handler, aExchange);

	DemuxExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 43	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	TxExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	TxExchangeHandler.handleExchange(ExchangeHandlerChain, MessageExchange) line: 62	
/=
	@Transactional(propagation = Propagation.REQUIRED, rollbackFor = Exception.class)
	public void handleExchange(@Nonnull ExchangeHandlerChain aChain, @Nonnull MessageExchange aExchange) throws Exception {
/ Voor deze handler wordt dus een tx create	, deze handler execs in een tx	,
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy478.handleExchange(ExchangeHandlerChain, MessageExchange) line: not available	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	MessageTraceExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	AuthNExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	ArchiveExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	SapXConverterExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	ArchiveErrorExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	RetryExchangeHandler(AbstractExchangeHandler).handleExchange(ExchangeHandlerChain, MessageExchange) line: 64	
	RetryExchangeHandler.handleExchange(ExchangeHandlerChain, MessageExchange) line: 80	
	DefaultExchangeHandlerChain.next(MessageExchange) line: 50	
	MessageHandler.handleExchange(MessageExchange) line: 55	
	MpoMessageListener.processMessage(Message, JmsMpoMessage) line: 378	
	MpoMessageListener.onMessage(Message) line: 199	

/ debug	,
/s
MessageConsumerHandler$$EnhancerBySpringCGLIB$$1564440d(MessageConsumerHandler).onExchange(MessageExchange) line: 172	
/////////////////////////////////////////////////////////////
/ Hier valt hij altijd wel in	, dus set b hier	,
/ Kan niet vlg. Eclipse	, linenumbers  zijn er niet	,
/ TODO
/ Vanaf nu per message type een andere consumer	,

		MessageConsumerInterface consumer = getConsumer();
com.mpobjects.oms.service.messages.CustomerOrderMsgConsumer@60973fae
		consumer.handle(message);
/s
CustomerOrderMsgConsumer(MessageConsumer).handle(Message) line: 90	
				process(incomingMessage);
/s
CustomerOrderMsgConsumer.process(Message) line: 30	
				CustomerOrderMsgProcessor myProcessor = new CustomerOrderMsgProcessor();
				Node msgNode = XMLUtil.selectSingleNode(((SapXMessage) aIncomingMessage).getDocument(), CustomerOrderNames.CUSTOMER_ORDER_MSG);
[co:CUSTOMER_ORDER_MSG: null]
					myProcessor.process(((SapXMessage) aIncomingMessage).getBody());
/s
CustomerOrderMsgProcessor.process(Node) line: 27	
		for (Node node : selectNodeIterable(aNode, CustomerOrderNames.CUSTOMER_ORDER)) {
[co:CUSTOMER_ORDER: null]
			getNodeProcessor().processCustomerOrderNodeInNewTx(node);
/s
CustomerOrderXmlNodeProcessorImpl.processCustomerOrderNodeInNewTx(Node) line: 50	
		processCustomerOrder(aNode);
/s
CustomerOrderXmlNodeProcessorImpl.processCustomerOrder(Node) line: 65	
/=
	protected void processCustomerOrder(Node aNode) throws XMLProcessorException {
node=
[co:CUSTOMER_ORDER: null]
			CustomerOrder customerOrder = getCustomerOrderProcessor().process(aNode);
/s
CustomerOrderProcessor.process(Node) line: 99	
		CustomerOrder order = new CustomerOrder();
		Node childNode = aNode.getFirstChild();
		while (childNode != null) {
			final String element = getElementName(childNode);

			if (MTCCoreNames.PROCESSING_DETAILS.equals(element)) {
				// we don't process this here
			// end
			childNode = childNode.getNextSibling();

		while (childNode != null) {
			final String element = getElementName(childNode);
CUSTOMER_ORDER_BODY
			} else if (MTCCoreNames.CUSTOMER_ORDER_BODY.equals(element)) {
				hasBody = true;
				try {
					customerOrderBodyProcessor.process(order, childNode);
/s
CustomerOrderBodyProcessor.process(CustomerOrder, Node) line: 166	
		final String organizationId = selectText(aNode, MTCCoreNames.ORGANIZATION_ID);
LOG_EMEA_FR_CT_PSA
		final Organization organization = getOrganizationDao().getByCode(organizationId);
SystemId:12000	Id:LOG_EMEA_FR_CT_PSA	Description:Organization for PSA CT

		aOrder.setOrganization(organization);

		TimeZone timeZone = organization.getTimeZone().toTimeZone();
sun.util.calendar.ZoneInfo[id="Europe/Amsterdam",offset=3600000,dstSavings=3600000,useDaylight=true,transitions=180,lastRule=java.util.SimpleTimeZone[id=Europe/Amsterdam,offset=3600000,dstSavings=3600000,useDaylight=true,startYear=0,startMode=2,startMonth=2,startDay=-1,startDayOfWeek=1,startTime=3600000,startTimeMode=2,endMode=2,endMonth=9,endDay=-1,endDayOfWeek=1,endTime=3600000,endTimeMode=2]]

		String customerOrderType = selectText(aNode, CUSTOMER_ORDER_TYPE_TAG);
SALES_ORDER

		Node childNode = aNode.getFirstChild();
		while (childNode != null) {
			final String element = getElementName(childNode);
CUSTOMER_ORDER_ID
			} else if (MTCCoreNames.CUSTOMER_ORDER_ID.equals(element)) {
				aOrder.setCustomerOrderNumber(getNodeTextContent(childNode, true).trim());
""

/ volgende	,
			final String element = getElementName(childNode);
ORGANIZATION_ID
			if (MTCCoreNames.ORGANIZATION_ID.equals(element)) {
				// skip
/ volgende	,
			final String element = getElementName(childNode);
FORECAST
			} else if (ForecastProcessor.FORECAST.equals(element)) {
				aOrder.setForecast(ForecastProcessor.process(childNode));
/ TODO
/ volgende	,
			final String element = getElementName(childNode);
BUYER_ORDER_NUMBER
			} else if (MTCCoreNames.BUYER_ORDER_NUMBER.equals(element)) {
				aOrder.setBuyerOrderNumber(getNodeTextContent(childNode, true).trim());
/ volgende	,
			final String element = getElementName(childNode);
CREATION_DATE
			} else if (MTCCoreNames.CREATION_DATE.equals(element)) {
				aOrder.setCreationDate(DateUtils.safeParseISO8601(getNodeTextContent(childNode, true).trim(), timeZone));
/ volgende	,
			final String element = getElementName(childNode);
CUSTOMER_ORDER_TYPE
			} else if (CUSTOMER_ORDER_TYPE_TAG.equals(element)) {
				aOrder.setCustomerOrderType(customerOrderTypeDAO.getByCode(getNodeTextContent(childNode, true)));
SALES_ORDER

/ volgende	,
			final String element = getElementName(childNode);
BUYER
			} else if (MTCCoreNames.BUYER.equals(element)) {
					Party party = partyProcessor.process(childNode);
/s
PartyProcessor.process(Node) line: 455	
			Node childNode = aNode.getFirstChild();
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
PARTY_ID
					} else if (PARTY_ID_TAG.equals(tag)) {
						myVO.setPartyId(childNode.getTextContent());
			return myVO;
/t
CustomerOrderBodyProcessor.process(CustomerOrder, Node) line: 201	
			} else if (MTCCoreNames.BUYER.equals(element)) {
				try {
					Party party = partyProcessor.process(childNode);
/d
party	VirtualParty  (id=22918)	
PARTY id:000254206547900140(systemId:0)
					} else {
						lookup = ApplicationPropertyManager.getInstance().getModuleOrganizationProperty(organization, "oms",
								"customer.order.party.lookup." + customerOrderType + ".buyer", false);
true
					if (lookup) {
						Party msparty = partyService.getPartyByPartyId(party.getCode(), aOrder);
[SystemId: 26878432; Party: 000254206547900140; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@7f301ac6[CUSTOMER,Customer companie]]
/ Een PartyVO	,
						if (msparty != null) {
							aOrder.setBuyer(new VirtualParty(msparty));

/ volgende	,
			final String element = getElementName(childNode);
SELLER
				try {
					Party party = partyProcessor.process(childNode);
					} else {
						lookup = ApplicationPropertyManager.getInstance().getModuleOrganizationProperty(organization, "oms",
								"customer.order.party.lookup." + customerOrderType + ".seller", false);
true
					if (lookup) {
						Party msparty = partyService.getPartyByPartyId(party.getCode(), aOrder);
							aOrder.setSeller(new VirtualParty(msparty));
/t
CustomerOrderProcessor.process(Node) line: 126	
			} else if (MTCCoreNames.CUSTOMER_ORDER_BODY.equals(element)) {
				hasBody = true;
				try {
					customerOrderBodyProcessor.process(order, childNode);
/d
/ volgende	,
			final String element = getElementName(childNode);
CUSTOMER_ORDER_LINE
			} else if (MTCCoreNames.CUSTOMER_ORDER_LINE.equals(element)) {
				CustomerOrderLine line = customerOrderLineProcessor.process(childNode, order, partyCache, incoCache, edtCache);
/s
CustomerOrderLineProcessor.process(Node, CustomerOrder, Map<String,Party>, Map<String,IncoTermVO>, Map<String,EntityDetailType>) line: 241	
		CustomerOrderLine line = new CustomerOrderLine();

		BasicPartyLookupContext partyLookupContext = new BasicPartyLookupContext(CustomerOrderLine.class);
partyLookupContext	BasicPartyLookupContext  (id=23014)	
	dateSetVO	DateSetVO  (id=23018)	
RSAFTER: null, RSBEFORE: null, REAFTER: null, REBEFORE: null, PSAFTER: null, PSBEFORE: null, PEAFTER: null, PEBEFORE: null, AS: null, AE: null, RELEASE:null, PRELEASE:null, CLOSE:null
	entityType	Class (com.mpobjects.oms.model.entity.CustomerOrderLine) (id=17549)	
	organization	null	

		Node childNode = aNode.getFirstChild();
		while (childNode != null) {
			final String element = getElementName(childNode);
CUSTOMER_ORDER_LINE_ID
			if (MTCCoreNames.CUSTOMER_ORDER_LINE_ID.equals(element)) {
				line.setCustomerOrderLineId(getNodeTextContent(childNode, true).trim());
/ volgende	,
		while (childNode != null) {
			final String element = getElementName(childNode);
SELLER_ORDER_LINE_NUMBER
			} else if (MTCCoreNames.SELLER_ORDER_LINE_NUMBER.equals(element)) {
				line.setSellerCustomerOrderLineNumber(getNodeTextContent(childNode, true).trim());
""
/ volgende	,
		while (childNode != null) {
			final String element = getElementName(childNode);
PRODUCT
			} else if (MTCCoreNames.PRODUCT.equals(element)) {
				if (ApplicationPropertyManager.getInstance().getModuleProperty("oms", "customerorderline.product.lookup", true)) {
true
						parsedProduct = new ProductProcessor(this).parse(childNode);
/s
ProductProcessor.parse(Node) line: 255	
			Product product = new Product();
			Node childNode = aNode.getFirstChild();
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);
PRODUCT_ID
					} else if (PRODUCT_ID_TAG.equals(tag)) {
						product.setCode(childNode.getTextContent());
			return product;
/t
CustomerOrderLineProcessor.process(Node, CustomerOrder, Map<String,Party>, Map<String,IncoTermVO>, Map<String,EntityDetailType>) line: 281	
						parsedProduct = new ProductProcessor(this).parse(childNode);
/d
						if (parsedProduct.getOrganization() == null) {
							parsedProduct.setOrganization(customerOrder.getOrganization());
					Product product = null;
					boolean modelBasedProductLookup = ApplicationPropertyManager.getInstance().getModuleProperty("oms", "model.based.product.lookup", false);
					if (modelBasedProductLookup) {
						if (!StringUtils.isBlank(parsedProduct.getProductId())) {
							product = productDAO.getByCodeModelAndOrganization(parsedProduct.getProductId(), parsedProduct.getModel(),
									customerOrder.getOrganization());
						}
					Product product = null;
					} else {
						product = productDAO.getByCodeAndOrganization(parsedProduct.getProductId(), customerOrder.getOrganization());
MPO_Prod1 (27044086)
					} else {
						String mode = ApplicationPropertyManager.getInstance().getModuleProperty("oms", "customerorderline.product.mode", "copy-from-line");
'master-date-lookup'
						if (mode.equalsIgnoreCase("copy-from-line")) {
/ NEE
						} else {
							// Do nothing
						}
						line.setProduct(product);
/ we zijn in	,
CustomerOrderLineProcessor.process(Node, CustomerOrder, Map<String,Party>, Map<String,IncoTermVO>, Map<String,EntityDetailType>) line: 260	

/ volgende,	
		while (childNode != null) {
			final String element = getElementName(childNode);
GOODS_STATUS
			} else if (MTCCoreNames.GOODS_STATUS.equals(element)) {
				GoodsStatus goodsStatus = GoodsStatusProcessor.process(childNode);
/s
GoodsStatusProcessor.process(Node) line: 28	
			if (myNode != null && StringUtils.isNotEmpty(myNode.getTextContent())) {
"GOOD"
				myVO = MpoBeanFactory.getBean(GoodsStatusDAO.class).getByCode(myNode.getTextContent());
com.mpobjects.oms.model.entity.goodsstatus.GoodsStatus@1fe393e6[GOOD,The products is available]
			return myVO;
/t
CustomerOrderLineProcessor.process(Node, CustomerOrder, Map<String,Party>, Map<String,IncoTermVO>, Map<String,EntityDetailType>) line: 321	
			} else if (MTCCoreNames.GOODS_STATUS.equals(element)) {
				GoodsStatus goodsStatus = GoodsStatusProcessor.process(childNode);
/d
				line.setGoodsStatus(goodsStatus);


/ volgende,	
		while (childNode != null) {
			final String element = getElementName(childNode);
QUANTITY
			} else if (MTCCoreNames.QUANTITY.equals(element)) {
				line.setQuantity(XMLSchemaUtils.parseDecimal(getNodeTextContent(childNode, true)));
450

/ volgende,	
		while (childNode != null) {
			final String element = getElementName(childNode);
FROM_PARTY
			} else if (MTCCoreNames.FROM_PARTY.equals(element)) {
				try {
					Party party = partyProcessor.process(childNode);

            <mtc:FROM_PARTY>
               <mtc:PARTY_ID>093139861944500198</mtc:PARTY_ID>
            </mtc:FROM_PARTY>
/s
PartyProcessor.process(Node) line: 465	

			Party myVO = new VirtualParty();
					String tag = getElementName(childNode);
PARTY_ID
					} else if (PARTY_ID_TAG.equals(tag)) {
						myVO.setPartyId(childNode.getTextContent());
			return myVO;
/t
CustomerOrderLineProcessor.process(Node, CustomerOrder, Map<String,Party>, Map<String,IncoTermVO>, Map<String,EntityDetailType>) line: 342	
			} else if (MTCCoreNames.FROM_PARTY.equals(element)) {
				try {
					Party party = partyProcessor.process(childNode);
/d
party	VirtualParty  (id=23218)	
PARTY id:093139861944500198(systemId:0)

					if (shipmentOrderType == null) {
						lookup = ApplicationPropertyManager.getInstance().getModuleProperty("oms", "customer.order.line.party.lookup.from", false);
false
					} else {
						line.setFromPartyVO(new VirtualParty(party));
/ TODO PAUL

/ volgende	,
		while (childNode != null) {
			final String element = getElementName(childNode);
TO_PARTY
			} else if (MTCCoreNames.TO_PARTY.equals(element)) {
				try {
					Party party = partyProcessor.process(childNode);
PARTY id:000254206547900140(systemId:0)
					boolean lookup;
					if (shipmentOrderType == null) {
						lookup = ApplicationPropertyManager.getInstance().getModuleProperty("oms", "customer.order.line.party.lookup.to", false);
false
					} else {
						line.setToPartyVO(new VirtualParty(party));

/ volgende	,
		while (childNode != null) {
			final String element = getElementName(childNode);
REQUESTED_START_AFTER
			} else if (MTCCoreNames.REQUESTED_START_AFTER.equals(element)) {
				line.setRequestedStartAfter(DateUtils.safeParseISO8601(getNodeTextContent(childNode, true).trim(), timeZone));
getNodeTextContent(childNode, true)=2016-06-27T00:00:00
Mon Jun 27 00:00:00 CEST 2016

/ volgende	,
		while (childNode != null) {
			final String element = getElementName(childNode);
REQUESTED_END_AFTER
			} else if (MTCCoreNames.REQUESTED_END_AFTER.equals(element)) {
				line.setRequestedEndAfter(DateUtils.safeParseISO8601(getNodeTextContent(childNode, true).trim(), timeZone));

/ volgende	,
		while (childNode != null) {
			final String element = getElementName(childNode);
INCO_TERM
			} else if (MTCCoreNames.INCO_TERM.equals(element)) {
				String code = selectText(childNode, MTCCoreNames.CODE);
EXW
/ TODO

/t
CustomerOrderProcessor.process(Node) line: 129	
			} else if (MTCCoreNames.CUSTOMER_ORDER_LINE.equals(element)) {
				CustomerOrderLine line = customerOrderLineProcessor.process(childNode, order, partyCache, incoCache, edtCache);
/d
				if (line != null) {
					order.addCustomerOrderLine(line);

/ Er is geen volgende customer order line	,
		return order;
/t
CustomerOrderXmlNodeProcessorImpl.processCustomerOrder(Node) line: 76	
			CustomerOrder customerOrder = getCustomerOrderProcessor().process(aNode);
/d
				CustomerOrderMessageProcessor customerOrderMsgProcessor = MpoBeanFactory.getBean(CustomerOrderMessageProcessor.class);
com.mpobjects.geosco.model.customerorder.xml.GeoScoCustomerOrderMsgProcessor@559935fa
				customerOrderMsgProcessor.handleCustomerOrderMessage(customerOrder, monitorMeta[1]);

/ Intermezzo

/ stack	,
	CustomerOrderXmlNodeProcessorImpl.processCustomerOrder(Node) line: 80	
			CustomerOrder customerOrder = getCustomerOrderProcessor().process(aNode);
/d
			CustomerOrderMessageProcessor customerOrderMsgProcessor = MpoBeanFactory.getBean(CustomerOrderMessageProcessor.class);
			customerOrderMsgProcessor.handleCustomerOrderMessage(customerOrder, monitorMeta[1]);

	CustomerOrderXmlNodeProcessorImpl.processCustomerOrderNodeInNewTx(Node) line: 50	
		processCustomerOrder(aNode);
	/ create tx	,
	CustomerOrderMsgProcessor.process(Node) line: 29	
			getNodeProcessor().processCustomerOrderNodeInNewTx(node);

	CustomerOrderMsgConsumer.process(Message) line: 36	
					myProcessor.process(((SapXMessage) aIncomingMessage).getBody());

	CustomerOrderMsgConsumer(MessageConsumer).handle(Message) line: 108	
				process(incomingMessage);
	/creates tx
	MessageConsumerHandler$$EnhancerBySpringCGLIB$$1564440d(MessageConsumerHandler).onExchange(MessageExchange) line: 172	
		MessageConsumerInterface consumer = getConsumer();
		consumer.handle(message);

/ Er is dus een 
	CustomerOrderMsgProcessor
	CustomerOrderMessageProcessor
/ TODO

/ Einde Intermezzo

/ we zijn in	,
				customerOrderMsgProcessor.handleCustomerOrderMessage(customerOrder, monitorMeta[1]);
monitorMeta[1]="FORECAST_UPDATE";
/s
GeoScoCustomerOrderMsgProcessor.handleCustomerOrderMessage(CustomerOrder, String) line: 23	
			if (FORECAST_UPDATE_PURPOSE_CODE.equalsIgnoreCase(aPurposeCode)) {
				processForecastUpdate(msgCustomerOrder);
/s
GeoScoCustomerOrderMsgProcessor.processForecastUpdate(CustomerOrder) line: 62	
		MpoBeanFactory.getBean(ForecastService.class).processForecast(aForecast);
/s
ForecastServiceImpl.processForecast(CustomerOrder) line: 200	
/=
	public void processForecast(CustomerOrder aForecast) {
aForecast	CustomerOrder  (id=17667)	
O000003754
/ Heeft systemId	, dus is existing	,
/ TODO (Wanneer is query gedaan?)

		forecastIdService.assignForecastId(aForecast);
/s
ForecastIdServiceImpl.assignForecastId(CustomerOrder) line: 31	
		for (CustomerOrderLine myLine : aForecast.getCustomerOrderLineSet()) {
CUSTOMER_ORDER_LINE id:1766(systemId:27360305)

			Date myStart = myLine.getDateSetVO().getStartDate();
Mon Jun 27 23:55:00 CEST 2016
			if (myFirstStart == null || myFirstStart.after(myStart)) {
/ JA
				myFirstStart = myStart;
			if (myLastStart == null || myLastStart.before(myStart)) {
/ JA
				myLastStart = myStart;

		DateTime myFirst = new DateTime(myFirstStart).withTimeAtStartOfDay();
2016-06-27T00:00:00.000+02:00
		DateTime myLast = new DateTime(myLastStart).withTimeAtStartOfDay();
2016-06-27T00:00:00.000+02:00

		StringBuilder myBuilder = new StringBuilder();
		if (myFirstStart != null) {
			myBuilder.append(myFormatter.print(myFirst)).append("-");
160627-
			if (myLastStart != null && !myLastStart.equals(myFirstStart)) {
/ NEE
		String myBuyer = null;
		if (aForecast.getBuyer() != null) {
			myBuyer = aForecast.getBuyer().getCode();
000254206547900140
			if (StringUtils.isNotBlank(myBuyer)) {
				int myHash = myBuyer.hashCode();
				if (myHash < 0) {
					myHash = -myHash;
1990187723
				myBuilder.append(StringUtils.leftPad(StringUtils.right(Integer.toString(myHash, 36), PARTY_ID_LENGTH), PARTY_ID_LENGTH, '0'));
160627-00wwwmob
				myBuilder.append("-");
160627-00wwwmob-

		String mySeller = null;
		if (aForecast.getSeller() != null) {
			mySeller = aForecast.getSeller().getCode();
093139861944500198
			if (StringUtils.isBlank(mySeller)) {
				mySeller = aForecast.getSeller().getName();
			}
			if (StringUtils.isNotBlank(mySeller)) {
				int myHash = mySeller.hashCode();
				if (myHash < 0) {
					myHash = -myHash;
				}
				myBuilder.append(StringUtils.leftPad(StringUtils.right(Integer.toString(myHash, 36), PARTY_ID_LENGTH), PARTY_ID_LENGTH,
						'0'));
160627-00wwwmob-00928odq

		String myForecastId = myBuilder.toString().toUpperCase();
160627-00WWWMOB-00928ODQ
		aForecast.getForecast().setForecastId(myForecastId);

///////////////////////////
/ Een forecast id bestaat dus uit date	, buyer	, seller	,

/t
ForecastServiceImpl.processForecast(CustomerOrder) line: 205	
		forecastIdService.assignForecastId(aForecast);

/d

/ Intermezzo

/ CustomerOrder heeft een forecast property	,
forecast	Forecast  (id=18612)	
	forecastDate	Date  (id=19523)						/ Tue Jun 21 01:56:00 CEST 2016
	forecastId	"160627-00WWWMOB-00928ODQ" (id=19500)	
	forecastStatus	ForecastStatus  (id=19524)	
/ WH als een co een forecat is	, wordt deze forecast set	, anders blijft null	,

/ Einde Intermezzo

		Collection<CustomerOrder> myCurrent = new ArrayList<CustomerOrder>(forecastDAO.findCurrentForecast(aForecast.getForecast()));
/s
ForecastDAOImpl.findCurrentForecast(Forecast) line: 34	
		return findCurrentForecast(null, aForecast.getForecastId());
/s
ForecastDAOImpl.findCurrentForecast(Organization, String) line: 39	
		Set<ForecastStatus> stati = EnumSet.allOf(ForecastStatus.class);
		stati.remove(ForecastStatus.CANCELLED);
		stati.remove(ForecastStatus.SPLITTING);
[FORECAST, FIRM]
		return findForecasts(aOrganization, aForecastId, stati);
/s
ForecastDAOImpl.findForecasts(Organization, String, Set<ForecastStatus>) line: 81	
		DetachedCriteria crit = DetachedCriteria.forClass(type);
type=class com.mpobjects.oms.model.entity.CustomerOrder
		crit.add(Property.forName("forecast.forecastId").eq(aForecastId));
160627-00WWWMOB-00928ODQ
		if (!aForecastStatus.isEmpty()) {
			crit.add(Property.forName("forecast.forecastStatus").in(aForecastStatus));
[FORECAST, FIRM]

crit	DetachedCriteria  (id=20059)	
	criteria	CriteriaImpl  (id=20065)	
		criterionEntries	ArrayList  (id=20068)	
[forecast.forecastId=160627-00WWWMOB-00928ODQ, 
forecast.forecastStatus in (FORECAST, FIRM)]
		entityOrClassName	"com.mpobjects.oms.model.entity.CustomerOrder" (id=20070)	

		return findByCriteria(crit);
/s
ForecastDAOImpl(GenericHibernateDAO).findByCriteria(DetachedCriteria) line: 211	
		return getHibernateTemplate().findByCriteria(aDetachedCriteria);
/t
ForecastServiceImpl.processForecast(CustomerOrder) line: 206	
		Collection<CustomerOrder> myCurrent = new ArrayList<CustomerOrder>(forecastDAO.findCurrentForecast(aForecast.getForecast()));
/d
/ we zien	,
select this_.*
from CUSTOMER_ORDER this_ 
where this_.FORECAST_ID='160627-00WWWMOB-00928ODQ' 
and this_.FORECAST_STATUS in ('FORECAST', 'FIRM')
;
 system_id | customer_order_number | sold_to_party_systemid | is_deleted | seller_party_systemid | buyer_order_number | sel
ler_order_number | reference1 | reference2 | reference3 | reference4 | reference5 | reference6 | reference7 | reference8 | 
reference9 | reference10 | organization_systemid |    creation_date    |   buyer_party_id   |   buyer_name   | buyer_name2 
 |          buyer_address          | buyer_address2 | buyer_city | buyer_postal_code | buyer_region_state | buyer_country_s
ystemid | buyer_contact_name | buyer_email_address | buyer_fax_number | buyer_phone_number | buyer_longitude | buyer_latitu
de |  seller_party_id   |          seller_name          |          seller_name2          |        seller_address         | 
seller_address2 | seller_city | seller_postal_code | seller_region_state | seller_country_systemid | seller_contact_name | 
seller_email_address | seller_fax_number | seller_phone_number | seller_longitude | seller_latitude | created_by_systemid |
 status_code_systemid | customer_order_type_systemid | seller_reference1 | seller_reference2 | seller_reference3 | seller_r
eference4  | seller_reference5 | buyer_reference1 | buyer_reference2 | buyer_reference3 |  buyer_reference4  | buyer_refere
nce5 | hold_status_systemid | seller_reference6 | buyer_reference6 | last_import | last_export |       forecast_id        |
 forecast_status |    forecast_date    
---------------------------------------
  26881783 | CO000003753           |                   NULL |          0 |                  NULL | 0004454269         | NUL
L                | NULL       | NULL       | NULL       | NULL       | NULL       | NULL       | NULL       | NULL       | 
NULL       | NULL        |                 12000 | 2016-06-21 01:56:00 | 000254206547900140 | PSA Montage SX | Client livré
 | 1 Ter Avenue du Général Leclerc | 78001H  3C     | SOCHAUX    | 25600             |                    |                
   4069 |                    |                     |                  |                    | NULL            | NULL        
   | 093139861944500198 | GEODIS AUTOMOTIVE EST SOCHAUX | 72572G  16 Expéditeur pour PSA | 11 avenue du Général LECLERC  | 
                | SOCHAUX     | 25600              |                     |                    4069 |                     | 
                     |                   |                     | NULL             | NULL            |               10100 |
                    6 |                     26942698 |                   | EDI               |                   | 09313986
1944500198 | 10                |                  |                  |                  | 000254206547900140 | 5           
     |                 NULL |                   |                  | NULL        | NULL        | 160627-00WWWMOB-00928ODQ |
 FORECAST        | 2016-06-21 01:56:00
(1 row)

		for (CustomerOrder myOrder : myCurrent) {
			} else {
				if (!ObjectUtils.equals(myOrder.getForecast().getForecastDate(), aForecast.getForecast().getForecastDate())) {
/ NEE
/ Beide 2016-06-21 01:56:00.0
					cancelForecast(myOrder);
				} else {
					// The forecast was re-sent
					LOG.info("Deleting old forecast, new forecast was re-sent [" + myOrder + "]");
					deleteForecast(myOrder);
/ myOrder hebben we zojuist opgevraagd	, opg. transaction date + buyer+seller	,
/s
ForecastServiceImpl.deleteForecast(CustomerOrder) line: 270	
		customerOrderDeleteService.requestAsyncDeletion(aOrder);
/s
CustomerOrderDeleteServiceImpl.requestAsyncDeletion(CustomerOrder) line: 51	
		final CustomerOrderDeleteRequest myRequest = new CustomerOrderDeleteRequest(aCustomerOrder);

		transactionHelper.executeAfterCommit(new Runnable() {
/ has exec	,
			@Override
			public void run() {
				simpleMessageProducer.sendMessage("com.mpobjects.customerorder.delete", myRequest);
/ Heeft nog niet exec	,

/t
ForecastServiceImpl.processForecast(CustomerOrder) line: 219	
					deleteForecast(myOrder);
/d

/ volgende	,
		Collection<CustomerOrder> myCurrent = new ArrayList<CustomerOrder>(forecastDAO.findCurrentForecast(aForecast.getForecast()));
[CO000003753, CO000003754]
/ CO000003754 zien we niet meer	, 
/ TODO

		createForecast(aForecast);
/s
ForecastServiceImpl.createForecast(CustomerOrder) line: 77	
		boolean mustSplit = forecastSplitService.mustSplit(aForecast);
/s
ForecastSplitServiceImpl.mustSplit(CustomerOrder) line: 98	
			CustomerOrderLine myFirst = aForecast.getCustomerOrderLineSet().iterator().next();
CUSTOMER_ORDER_LINE id:1766(systemId:27360305)
			DateSetVO myDates = myFirst.getDateSetVO();
RSAFTER: Mon Jun 27 23:55:00 CEST 2016, RSBEFORE: null, REAFTER: Mon Jun 27 23:59:59 CEST 2016, REBEFORE: null, PSAFTER: null, PSBEFORE: null, PEAFTER: null, PEBEFORE: null, AS: null, AE: null, RELEASE:null, PRELEASE:null, CLOSE:null

			if (myDates.getStartDate() == null || myDates.getEndDate() == null || DateUtils.isSameDay(myDates.getStartDate(), myDates.getEndDate())) {
/ JA	,
				return false;
/t
ForecastServiceImpl.createForecast(CustomerOrder) line: 78	
		boolean mustSplit = forecastSplitService.mustSplit(aForecast);
/d
false
		} else {
			aForecast.getForecast().setForecastStatus(ForecastStatus.FORECAST);
		CustomerOrder myForecast = customerOrderService.create(aForecast, true, false, myContext);
/s
CustomerOrderServiceImpl.create(CustomerOrder, boolean, boolean, TMSEventContext) line: 140	
/=
	public CustomerOrder create(CustomerOrder aCustomerOrder, boolean checkIds, boolean fromInterface, TMSEventContext aContext) {
		setCreationData(aCustomerOrder);
/s
CustomerOrderServiceImpl.setCreationData(CustomerOrder) line: 531	
CO000003754
/ TODO ( In db is CO000003753)
		if (aCustomerOrder.getCreationDate() == null) {
/ NEE
		if (aCustomerOrder.getCreatedBy() == null) {
/ NEE
/t
CustomerOrderServiceImpl.create(CustomerOrder, boolean, boolean, TMSEventContext) line: 144	
		setCreationData(aCustomerOrder);
/d
		setCustomerOrderStatus(aCustomerOrder);
/s
CustomerOrderServiceImpl.setCustomerOrderStatus(CustomerOrder) line: 553	
		if (setCustomerOrderLineStatus(aCustomerOrder)) {
/s
CustomerOrderServiceImpl.setCustomerOrderLineStatus(CustomerOrder) line: 542	
CO000003754 , systemId=26881784
		for (CustomerOrderLine customerOrderLine : aCustomerOrder.getCustomerOrderLineSet()) {
CUSTOMER_ORDER_LINE id:1766(systemId:27360305)
			changed |= customerOrderLineService.setCustomerOrderLineStatus(customerOrderLine);
/s
CustomerOrderLineServiceImpl.setCustomerOrderLineStatus(CustomerOrderLine) line: 178	
		for (ProductItemVO productItem : aLine.getLinkedProductItemSet()) {
[]
		if (shipmentOrderSize == 0) {
			return setOrderLineStatus(OrderStatusVO.STATUS_UNPLANNED, aLine);
/s
CustomerOrderLineServiceImpl.setOrderLineStatus(String, CustomerOrderLine) line: 254	
		if (customerOrderLine.getOrderStatusVO() != null) {
/ JA
OrderStatus:1404 (systemId:6)
			customerOrderLineStatus = customerOrderLine.getOrderStatusVO();

		if (customerOrderLineStatus == null || !customerOrderLineStatus.getCode().equals(orderStatusCode)) {
/ NEE
		return myChanged;
false
/t
CustomerOrderServiceImpl.setCustomerOrderLineStatus(CustomerOrder) line: 543	
			changed |= customerOrderLineService.setCustomerOrderLineStatus(customerOrderLine);
false
		return changed;
/t
CustomerOrderServiceImpl.setCustomerOrderStatus(CustomerOrder) line: 556	
		if (setCustomerOrderLineStatus(aCustomerOrder)) {
/ NEE
/t
CustomerOrderServiceImpl.create(CustomerOrder, boolean, boolean, TMSEventContext) line: 145	
		setCustomerOrderStatus(aCustomerOrder);
/d
		if (checkIds) {
			if (StringUtils.isBlank(aCustomerOrder.getCustomerOrderNumber())) {
/ NEE
CO000003754
			for (CustomerOrderLine line : aCustomerOrder.getCustomerOrderLineSet()) {
				if (StringUtils.isEmpty(line.getCustomerOrderLineId())) {
/ NEE
1766
		for (CustomerOrderLine line : aCustomerOrder.getCustomerOrderLineSet()) {
			line.setOpenQuantity(line.getQuantity());
450
		boolean shouldLinkFromInterface = fromInterface
				&& ApplicationPropertyManager.getInstance().getProperty("module.oms.customerorder.resolve.productitems", false);
false
		CustomerOrder myNew = customerOrderDAO.save(aCustomerOrder);

		triggerEventHandler(null, myNew, aContext, fromInterface);
/s
	private void triggerEventHandler(CustomerOrder anOldVO, CustomerOrder aNewVO, TMSEventContext anEventContext, boolean fromInterface) {
anOldVO	null	
aNewVO	CustomerOrder  (id=17667)	
CO000003754
		CustomerOrderEvent myEvent = null;
		if (anOldVO == null) {
			if (!fromInterface) {
				myEvent = new CustomerOrderEvent(anOldVO, aNewVO, CustomerOrderEvent.CREATED, anEventContext);
		try {
			eventHandlerService.handleEvent(myEvent);
/s
EventHandlerServiceImpl.handleEvent(Event) line: 72	
			listenerList.fireEvent(anEvent);
this	EventHandlerServiceImpl  (id=20738)	
	listenerList	ListenerList  (id=21074)	
		theListenerList	ArrayList  (id=21076)	
[com.mpobjects.document.model.eventhandler.util.DocumentEventListener,
 com.mpobjects.oms.model.eventhandler.util.CustomerOrderEventListener,
 com.mpobjects.oms.service.shipmentordercostpart.ShoCostAllocationEventListener,
 com.mpobjects.oms.service.shipmentorderprice.ShoPriceAllocationServiceImpl,
 com.mpobjects.omscarcon.model.eventhandler.util.TMSCarConServiceOrderEventListener,
 com.mpobjects.invoice.model.eventhandler.util.SupplierInvoiceUpdateEventListener,
 com.mpobjects.event.service.DeferredEventServiceImpl@6fd511e2,
 com.mpobjects.event.event.model.util.EventEventListener,
 com.mpobjects.oms.ratecalc.model.eventhandler.util.AllocationEventListener,
 com.mpobjects.inventory.service.stocktransaction.StockTransactionEventListener,
 com.mpobjects.capabletopromise.model.eventhandler.util.CapableToPromiseEventListener,
 com.mpobjects.customerinvoice.model.eventhandler.util.CustomerInvoiceUpdateEventListener,
 com.mpobjects.invoice.model.service.InvoiceServiceOrderEventHandler@739b1ead,
 com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener]

/c
/stack
	CustomerOrderDeleteServiceImpl$1.run() line: 57	
/=
	public void requestAsyncDeletion(CustomerOrder aCustomerOrder) {

		final CustomerOrderDeleteRequest myRequest = new CustomerOrderDeleteRequest(aCustomerOrder);

		transactionHelper.executeAfterCommit(new Runnable() {

			@Override
			public void run() {
->				simpleMessageProducer.sendMessage("com.mpobjects.customerorder.delete", myRequest);

	TransactionHelperImpl$TXAction.afterCompletion(int) line: 55	
	TransactionImpl.doAfterCompletion() line: 1526	
	TransactionImpl.completeTransaction() line: 1198	
	TransactionImpl.commit() line: 377	
	TxManager.commit() line: 240	
	ServerVMClientUserTransaction.commit() line: 140	
	JtaTransactionManager.doCommit(DefaultTransactionStatus) line: 1012	
	JtaTransactionManager(AbstractPlatformTransactionManager).processCommit(DefaultTransactionStatus) line: 755	
	JtaTransactionManager(AbstractPlatformTransactionManager).commit(TransactionStatus) line: 724	
	TransactionInterceptor(TransactionAspectSupport).commitTransactionAfterReturning(TransactionAspectSupport$TransactionInfo) line: 475	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 270	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy350.processCustomerOrderNodeInNewTx(Node) line: not available	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy351.processCustomerOrderNodeInNewTx(Node) line: not available	
	CustomerOrderMsgProcessor.process(Node) line: 29	
		for (Node node : selectNodeIterable(aNode, CustomerOrderNames.CUSTOMER_ORDER)) {
			getNodeProcessor().processCustomerOrderNodeInNewTx(node);

/ Dus als de tx commits	, runs 

/ we debug	, 
/s
CustomerOrderDeleteServiceImpl$1.run() line: 57	
				simpleMessageProducer.sendMessage("com.mpobjects.customerorder.delete", myRequest);
/s
SimpleMessageProducerImpl.sendMessage(String, Serializable) line: 27	
		sendMessage(aDestination, aSerializable, Collections.<String, Object> emptyMap());
aDestination="com.mpobjects.customerorder.delete"
/ TODO

/ 7	. 

/ OVERNIEUW

/ Op 27 Jun zijn er geen CO's,	 alleen COUNT's

MpoMessageListener.onMessage(Message) line: 199	
				processMessage(aMessage, mpoMsg);
...
/s
	@Transactional(propagation = Propagation.REQUIRES_NEW)
CustomerOrderXmlNodeProcessorImpl.processCustomerOrderNodeInNewTx(Node) line: 50	
		processCustomerOrder(aNode);
/s
ustomerOrderXmlNodeProcessorImpl.processCustomerOrder(Node) line: 65	
			CustomerOrder customerOrder = getCustomerOrderProcessor().process(aNode);
/ processed co	, systemId=0	, customerOrderNumber=""
				CustomerOrderMessageProcessor customerOrderMsgProcessor = MpoBeanFactory.getBean(CustomerOrderMessageProcessor.class);
				customerOrderMsgProcessor.handleCustomerOrderMessage(customerOrder, monitorMeta[1]);
/s
GeoScoCustomerOrderMsgProcessor.handleCustomerOrderMessage(CustomerOrder, String) line: 23	
		try {
			if (FORECAST_UPDATE_PURPOSE_CODE.equalsIgnoreCase(aPurposeCode)) {
				processForecastUpdate(msgCustomerOrder);
/s
GeoScoCustomerOrderMsgProcessor.processForecastUpdate(CustomerOrder) line: 62	
		MpoBeanFactory.getBean(ForecastService.class).processForecast(aForecast);
/s
ForecastServiceImpl.processForecast(CustomerOrder) line: 200	
		forecastIdService.assignForecastId(aForecast);
aForecast	CustomerOrder  (id=19306)	
	forecast	Forecast  (id=19323)	
		forecastDate	Date  (id=19524)	
Tue Jun 21 01:56:00 CEST 2016
		forecastId	"160627-00WWWMOB-00928ODQ" (id=19525)	
		forecastStatus	ForecastStatus  (id=19526)	
FORECAST

		Collection<CustomerOrder> myCurrent = new ArrayList<CustomerOrder>(forecastDAO.findCurrentForecast(aForecast.getForecast()));
[]
		for (CustomerOrder myOrder : myCurrent) {
/ NEE
		createForecast(aForecast);
/s
ForecastServiceImpl.createForecast(CustomerOrder) line: 77	
		boolean mustSplit = forecastSplitService.mustSplit(aForecast);
false
		} else {
			aForecast.getForecast().setForecastStatus(ForecastStatus.FORECAST);

		CustomerOrder myForecast = customerOrderService.create(aForecast, true, false, myContext);
/s
CustomerOrderServiceImpl.create(CustomerOrder, boolean, boolean, TMSEventContext) line: 140	
/=
	public CustomerOrder create(CustomerOrder aCustomerOrder, boolean checkIds, boolean fromInterface, TMSEventContext aContext) {
checkIds	true	
fromInterface	false	
/ TODO

		setCreationData(aCustomerOrder);
/s
CustomerOrderServiceImpl.setCreationData(CustomerOrder) line: 535	
		if (aCustomerOrder.getCreationDate() == null) {
/ NEE
		if (aCustomerOrder.getCreatedBy() == null) {
/ JA
			aCustomerOrder.setCreatedBy(AuthenticationUtils.getResource());
Resource:all-admin(systemId:10100)

/t
CustomerOrderServiceImpl.create(CustomerOrder, boolean, boolean, TMSEventContext) line: 144	
		setCreationData(aCustomerOrder);
/d
		setCustomerOrderStatus(aCustomerOrder);
/s
	private void setCustomerOrderStatus(CustomerOrder aCustomerOrder) {
		int customerOrderLineSize = aCustomerOrder.getCustomerOrderLineSet().size();
		if (customerOrderLineSize == 0) {
/ NEE
		if (setCustomerOrderLineStatus(aCustomerOrder)) {
/s
CustomerOrderServiceImpl.setCustomerOrderLineStatus(CustomerOrder) line: 542	
		for (CustomerOrderLine customerOrderLine : aCustomerOrder.getCustomerOrderLineSet()) {
			changed |= customerOrderLineService.setCustomerOrderLineStatus(customerOrderLine);
/s
CustomerOrderLineServiceImpl.setCustomerOrderLineStatus(CustomerOrderLine) line: 172	
		Set<ShipmentOrderVO> shipmentOrderVOs = new HashSet<ShipmentOrderVO>();
		for (ProductItemVO productItem : aLine.getLinkedProductItemSet()) {
/ GEEN
		int shipmentOrderSize = shipmentOrderVOs.size();
		if (shipmentOrderSize == 0) {
			return setOrderLineStatus(OrderStatusVO.STATUS_UNPLANNED, aLine);
/s
CustomerOrderLineServiceImpl.setOrderLineStatus(String, CustomerOrderLine) line: 254	
		if (customerOrderLine.getOrderStatusVO() != null) {
			customerOrderLineStatus = customerOrderLine.getOrderStatusVO();
OrderStatus:1404 (systemId:6)
		if (customerOrderLineStatus == null || !customerOrderLineStatus.getCode().equals(orderStatusCode)) {
/ NEE
/ de status is al OK	,
		return myChanged;
false
/t
CustomerOrderServiceImpl.setCustomerOrderLineStatus(CustomerOrder) line: 544	
			changed |= customerOrderLineService.setCustomerOrderLineStatus(customerOrderLine);
/d
		}
		return changed;
false
/t
CustomerOrderServiceImpl.setCustomerOrderStatus(CustomerOrder) line: 553	
		if (setCustomerOrderLineStatus(aCustomerOrder)) {
/ NEE
/ Hij was al OK	,
/t
CustomerOrderServiceImpl.create(CustomerOrder, boolean, boolean, TMSEventContext) line: 145	
		setCustomerOrderStatus(aCustomerOrder);
/d
		if (checkIds) {
/ JA
			if (StringUtils.isBlank(aCustomerOrder.getCustomerOrderNumber())) {
/ JA
				aCustomerOrder.setCustomerOrderNumber(orderNumberGenerator.getNextId(aCustomerOrder));
/s
DbIdGenerator.getNextId(Object) line: 65	
		KeyGenService src = getKeyGenService();
/ Spring bean,
		int id = src.generateNewKey(keyReference);
keyReference	"customerOrder" (id=20703)	
/s
KeyGenServiceImpl.generateNewKey(String) line: 74	

			Integer myKey = myKeyResponseQueue.take();
3755
/t
DbIdGenerator.getNextId(Object) line: 67	
		int id = src.generateNewKey(keyReference);
3755
		return String.format(format, id);
/t
CustomerOrderServiceImpl.create(CustomerOrder, boolean, boolean, TMSEventContext) line: 147	
/=
	public CustomerOrder create(CustomerOrder aCustomerOrder, boolean checkIds, boolean fromInterface, TMSEventContext aContext) {
checkIds=true
formInterface=false
/ TODO
			if (StringUtils.isBlank(aCustomerOrder.getCustomerOrderNumber())) {
				aCustomerOrder.setCustomerOrderNumber(orderNumberGenerator.getNextId(aCustomerOrder));
/d
CO000003755
			for (CustomerOrderLine line : aCustomerOrder.getCustomerOrderLineSet()) {
				if (StringUtils.isEmpty(line.getCustomerOrderLineId())) {
/ NEE
1766
		for (CustomerOrderLine line : aCustomerOrder.getCustomerOrderLineSet()) {
			line.setOpenQuantity(line.getQuantity());
450
		boolean shouldLinkFromInterface = fromInterface
false
				&& ApplicationPropertyManager.getInstance().getProperty("module.oms.customerorder.resolve.productitems", false);


		CustomerOrder myNew = customerOrderDAO.save(aCustomerOrder);
		triggerEventHandler(null, myNew, aContext, fromInterface);
/s
CustomerOrderServiceImpl.triggerEventHandler(CustomerOrder, CustomerOrder, TMSEventContext, boolean) line: 563	
/=
	private void triggerEventHandler(CustomerOrder anOldVO, CustomerOrder aNewVO, TMSEventContext anEventContext, boolean fromInterface) {
		if (anOldVO == null) {
/ JA
			if (!fromInterface) {
/ JA
				myEvent = new CustomerOrderEvent(anOldVO, aNewVO, CustomerOrderEvent.CREATED, anEventContext);
			} else {
/ NEE
				myEvent = new CustomerOrderEvent(anOldVO, aNewVO, CustomerOrderEvent.CREATED_FROM_MSG, anEventContext);
/ NIET
/ TODO PAUL

		try {
			eventHandlerService.handleEvent(myEvent);
/s
EventHandlerServiceImpl.handleEvent(Event) line: 72	
		String myEventType = anEvent.getEventType();
customerorder.created
			listenerList.fireEvent(anEvent);
[com.mpobjects.document.model.eventhandler.util.DocumentEventListener,
 com.mpobjects.oms.model.eventhandler.util.CustomerOrderEventListener,
 com.mpobjects.oms.service.shipmentordercostpart.ShoCostAllocationEventListener,
 com.mpobjects.oms.service.shipmentorderprice.ShoPriceAllocationServiceImpl,
 com.mpobjects.omscarcon.model.eventhandler.util.TMSCarConServiceOrderEventListener,
 com.mpobjects.invoice.model.eventhandler.util.SupplierInvoiceUpdateEventListener,
 com.mpobjects.event.service.DeferredEventServiceImpl@3a441ed3,
 com.mpobjects.event.event.model.util.EventEventListener,
 com.mpobjects.oms.ratecalc.model.eventhandler.util.AllocationEventListener,
 com.mpobjects.inventory.service.stocktransaction.StockTransactionEventListener,
 com.mpobjects.capabletopromise.model.eventhandler.util.CapableToPromiseEventListener,
 com.mpobjects.customerinvoice.model.eventhandler.util.CustomerInvoiceUpdateEventListener,
 com.mpobjects.invoice.model.service.InvoiceServiceOrderEventHandler@e8feb4e,
 com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener]
/s
ListenerList.fireEvent(Event<?>) line: 80	
		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);
/s
CustomerOrderEventListener.handleEvent(Event) line: 28	
		if (anEvent.getEventType().equals(ShipmentOrderEvent.STATUS_UPDATED)) {
/ NEE
/t
/s
StockTransactionEventListener.handleEvent(Event<?>) line: 37	
event=customerorder.created, context [id/value: 150957407/190]]  old [null] new [CO000003755] 
		boolean stockTransactionsEnabled = ApplicationPropertyManager.getInstance().getModuleProperty("inventory", "enable.stock.transactions", true);
true
		if (stockTransactionsEnabled) {
			} else if (anEvent.getEventType().startsWith(CustomerOrderEvent.PREFIX)) {
				CustomerOrderEvent myEvent = (CustomerOrderEvent) anEvent;
				handle(myEvent);
/s
StockTransactionEventListener.handle(CustomerOrderEvent) line: 75	
		boolean addToQueue = anEvent.getEventContext().hasFlag(TMSEventContext.FLAG_ADD_TO_QUEUE);
true
		if (addToQueue) {
			stockTransactionService.addToQueue(anEvent);
/s
	public void addToQueue(CustomerOrderEvent anEvent) {
		simpleMessageProducer.sendMessage(StockTransactionHandlerImpl.QUEUE, anEvent);

/ Dit was de PRODUCER	,
/c

/ Intermezzo

public class StockTransactionHandlerImpl extends AbstractConsumer implements StockTransactionHandler {
	public static final String QUEUE = "com.mpobjects.inventory.queue.stocktransaction";


/ Einde Intermezzo

/ Nu de CONSUMER	,	

/s
StockTransactionHandlerImpl(AbstractConsumer).onMessage(Message) line: 49	
			processMessageAsRoot(aMessage);
/s
StockTransactionHandlerImpl.processMessageAsRoot(Message) line: 52	
		ObjectMessage myMessage = (ObjectMessage) aMessage;
		Serializable serializable = myMessage.getObject();
serializable	CustomerOrderEvent  (id=21125)	
customerorder.created, context [id/value: 1126879885/63]]  old [null] new [CO000003755] 

			stockTransactionEventListener.handleEvent(myEvent);
/s
StockTransactionEventListener.handleEvent(Event<?>) line: 53	
		boolean stockTransactionsEnabled = ApplicationPropertyManager.getInstance().getModuleProperty("inventory", "enable.stock.transactions", true);
		if (stockTransactionsEnabled) {
			} else if (anEvent.getEventType().startsWith(CustomerOrderEvent.PREFIX)) {
				CustomerOrderEvent myEvent = (CustomerOrderEvent) anEvent;
				handle(myEvent);
/s
StockTransactionEventListener.handle(CustomerOrderEvent) line: 79	
		boolean addToQueue = anEvent.getEventContext().hasFlag(TMSEventContext.FLAG_ADD_TO_QUEUE);
false
		if (addToQueue) {
/ NEE
		} else if (anEvent.getEventType().equals(CustomerOrderEvent.CREATED)) {
/ JA
			stockTransactionService.handleCustomerOrderCreated(anEvent);
/s
StockTransactionServiceImpl.handleCustomerOrderCreated(CustomerOrderEvent) line: 168	
		CustomerOrder myNew = customerOrderDAO.getBySystemId(aEvent.getNewCustomerOrder().getSystemId());
/ we zien in db	,
  26881793 | CO000003755           |                   NULL |          0 |                  NULL | 0004454269         | NUL
L                | NULL       | NULL       | NULL       | NULL       | NULL       | NULL       | NULL       | NULL       | 
NULL       | NULL        |                 12000 | 2016-06-21 01:56:00 | 000254206547900140 | PSA Montage SX | Client livré
 | 1 Ter Avenue du Général Leclerc | 78001H  3C     | SOCHAUX    | 25600             |                    |                
   4069 |                    |                     |                  |                    | NULL            | NULL        
   | 093139861944500198 | GEODIS AUTOMOTIVE EST SOCHAUX | 72572G  16 Expéditeur pour PSA | 11 avenue du Général LECLERC  | 
                | SOCHAUX     | 25600              |                     |                    4069 |                     | 
                     |                   |                     | NULL             | NULL            |               10100 |
                 NULL |                     26942698 |                   | EDI               |                   | 09313986
1944500198 | 10                |                  |                  |                  | 000254206547900140 | 5           
     |                 NULL |                   |                  | NULL        | NULL        | 160627-00WWWMOB-00928ODQ |
 FORECAST        | 2016-06-21 01:56:00
(1 row)

		for (CustomerOrderLine myLine : myNew.getCustomerOrderLineSet()) {
			handleCustomerOrderLineUpdate(myLine);
CUSTOMER_ORDER_LINE id:1766(systemId:27360314)
/s
StockTransactionServiceImpl.handleCustomerOrderLineUpdate(CustomerOrderLine) line: 940	

		Product myProduct = aNewLine.getProduct();
MPO_Prod1 (27044086)
		Map<Product, BigDecimal> myProducts = productService.getProductList(myProduct, aNewLine.getQuantity(), 1);
/s
ProductServiceImpl.getProductList(Product, BigDecimal, int) line: 26	
		Map<Product, BigDecimal> myList = new HashMap<Product, BigDecimal>();
		myList.put(aProduct, aQty);
		...
		return myList;
/t
StockTransactionServiceImpl.handleCustomerOrderLineUpdate(CustomerOrderLine) line: 940	
		Map<Product, BigDecimal> myProducts = productService.getProductList(myProduct, aNewLine.getQuantity(), 1);
/d
{MPO_Prod1 (27044086)=450}

		List<StockTransaction> myTransactions = stockTransactionDAO.getByCustomerOrderLine(aNewLine);
[]

/ Intermezzo

select st.*
from stock_transaction st
join customer_order_line col on st.customer_order_line_systemid=col.system_id
where col.customer_orderline_id='1766'
;
----+------------------------------+------------------------+-------------------
  27097816 |   0.00000 | NULL          | NULL   | 2016-02-09 00:00:00 |         26890274 |              26877284 |         
       26878346 |                  NULL | NULL        |                 12000 |         14.00000 |        0 | FORECAST_OUT 
    |                     27229246 |                   NULL |                 0
  26990848 |   0.00000 | NULL          | NULL   | 2016-02-20 00:00:00 |         26878503 |              26877284 |         
       26878346 |                  NULL | NULL        |                 12000 |       1997.00000 |        0 | FORECAST_OUT 
    |                     27058608 |                   NULL |                 0
  27154567 |  -3.00000 | NULL          | NULL   | 2016-03-10 00:00:00 |         26879321 |              26877284 |         
       26878346 |                  NULL | NULL        |                 12000 |         62.00000 |        0 | FORECAST_OUT 
    |                     27286688 |                   NULL |                 0
  27178367 | -16.00000 | NULL          | NULL   | 2016-04-12 00:00:00 |         26878895 |              26877284 |         
       26878346 |                  NULL | NULL        |                 12000 |       -123.00000 |        0 | FORECAST_OUT 
    |                     27311053 |                   NULL |                 0
  27229456 |   0.00000 | NULL          | NULL   | 2016-06-21 23:55:00 |         26879312 |              26877284 |         
       26878346 |                  NULL | NULL        |                 12000 |         -1.00000 |        0 | FORECAST_OUT 
    |                     27358927 |                   NULL |                 0
(5 rows)

select st.*
from stock_transaction st
join customer_order_line col on st.customer_order_line_systemid=col.system_id
where col.system_id=27360314
;
(0 rows)

/ Einde Intermezzo


		if (myTransactions.isEmpty()) {
			// check to be sure
			myProductChange = true;

		ForecastStatus forecastStatus = ForecastStatus.FORECAST;
		if (aNewLine.getCustomerOrder() != null && aNewLine.getCustomerOrder().getForecast() != null) {
			forecastStatus = aNewLine.getCustomerOrder().getForecast().getForecastStatus();
FORECAST
		if (myProductChange || ForecastStatus.CANCELLED.equals(forecastStatus)) {
true || WH false = true
			for (StockTransaction myTransaction : myTransactions) {
[]
		List<StockTransaction> existingTransactions = stockTransactionDAO.getByCustomerOrderLine(aNewLine);
[]
		if (!ForecastStatus.CANCELLED.equals(forecastStatus) && !ForecastStatus.SPLITTING.equals(forecastStatus) && existingTransactions.isEmpty()) {
/ JA
			createForShipFrom(aNewLine);
/s
StockTransactionServiceImpl.createForShipFrom(CustomerOrderLine) line: 633	

		Map<StockKeepingUnit, BigDecimal> mySkuList = getStockKeepingUnit(aLine.getFromPartyVO(), aLine.getProduct(), aLine.getGoodsStatus(), aLine);
mySkuList	HashMap  (id=21445)	
	size	1	
	table	HashMap$Entry[16]  (id=21448)	
		[15]	HashMap$Entry  (id=21452)	
			key	StockKeepingUnit  (id=21454)	
				distributionStrategy	DistributionStrategy  (id=21458)	
				goodsStatus	GoodsStatus_$$_javassist_56  (id=21459)	
com.mpobjects.oms.model.entity.goodsstatus.GoodsStatus@d15104[GOOD,The products is available]
				leadTime	Period  (id=21460)	
P2D
				lotSize	BigDecimal  (id=21461)	
20.00000
				maxStockLevel	BigDecimal  (id=21463)	
				minStockLevel	BigDecimal  (id=21464)	
				organization	Organization  (id=21466)	
				performanceMonitorService	null	
				product	Product  (id=21305)	
MPO_Prod1 (27044086)
				replenishmentStrategy	ReplenishmentStrategy  (id=21479)	
				sourcingStrategy	SourcingStrategy  (id=21480)	
				stockLocation	StockLocation  (id=21481)	
GEODIS_WHS_FR_SOCHAUX
				systemId	27044089	
				targetStockLevel	BigDecimal  (id=21484)	
400.00000
				validFrom	Timestamp  (id=21485)	
				validTo	Timestamp  (id=21486)	

		for (Entry<StockKeepingUnit, BigDecimal> myEntry : mySkuList.entrySet()) {
			createTransaction(aLine, myEntry.getKey(), StockTransactionType.FORECAST_OUT, aLine.getDateSetVO().getStartDate(), myEntry.getValue());
/s
StockTransactionServiceImpl.createTransaction(CustomerOrderLine, StockKeepingUnit, StockTransactionType, Date, BigDecimal) line: 680	
/=
	private void createTransaction(CustomerOrderLine aItem, StockKeepingUnit aStockKeepingUnit, StockTransactionType aType, Date aTransactionDate, BigDecimal aBomQty) {

aItem	CustomerOrderLine  (id=21288)	
CUSTOMER_ORDER_LINE id:1766(systemId:27360314)
aStockKeepingUnit	StockKeepingUnit  (id=21454)	
com.mpobjects.inventory.model.entity.stockkeepingunit.StockKeepingUnit/id:27044089
aType	StockTransactionType  (id=21586)	
FORECAST_OUT
aTransactionDate	Timestamp  (id=21587)	
2016-06-27 23:55:00.0
aBomQty	BigDecimal  (id=21456)	
1

		StockTransaction myTransaction = new StockTransaction();
		myTransaction.setCustomerOrderLine(aItem);

		myTransaction.setStockLocation(aStockKeepingUnit.getStockLocation());
		myTransaction.setDirty(true);

		myTransaction.setProduct(aStockKeepingUnit.getProduct());
		myTransaction.setGoodsStatus(aStockKeepingUnit.getGoodsStatus());
		myTransaction.setTransactionDate(aTransactionDate);
		myTransaction.setTransactionType(aType);
		// The stock decreases at the ship-from location
		BigDecimal myProductItemQty = aType.equals(StockTransactionType.FORECAST_OUT) || aType.equals(StockTransactionType.ORDER_OUT) ? aItem.getQuantity() 
/ JA
	.negate() 
	: aItem.getQuantity();
		myTransaction.setQuantity(myProductItemQty.multiply(aBomQty));
-450
		myTransaction.setOrganization(aItem.getOrganization());
		save(myTransaction);
/s
			stockTransactionDAO.save(aTransaction);
/s
KeyGenServiceImpl.generateNewKey(String) line: 104	
			Integer myKey = myKeyResponseQueue.take();
27232016
/t
StockTransactionServiceImpl.handleCustomerOrderLineUpdate(CustomerOrderLine) line: 978	
			createForShipFrom(aNewLine);
/d
/ FORECAST_OUT 
			createForShipTo(aNewLine);
/ Nu een FORECAST_IN	, maar doet NIETS	, 	
s/
StockTransactionServiceImpl.createForShipTo(CustomerOrderLine) line: 644	
		Map<StockKeepingUnit, BigDecimal> mySkuList = getStockKeepingUnit(aLine.getToPartyVO(), aLine.getProduct(), aLine.getGoodsStatus(), aLine);
{}
		for (Entry<StockKeepingUnit, BigDecimal> myEntry : mySkuList.entrySet()) {
/ NEE
/t
StockTransactionHandlerImpl.processMessageAsRoot(Message) line: 60	
			stockTransactionEventListener.handleEvent(myEvent);
/d


 

















/ Einde Intermezzo
 

/ Einde DEBUG PSA-267 FORECAST_OUT MESSAGE 

/ PSA-267

/ Nu is het 0627	, 
/ de balance is -150	, dus later ook	,
/ we maken	,

[eric@localhost Geosco]$ pwd
/home/eric/Integration/Geosco
[eric@localhost Geosco]$ cat  InventoryReport/archive/2016-06/15/my-INVRPT-0704-a.xml 

     <mtc:STOCK_TRANSACTION_GROUP>
         <mtc:PROCESSING_DETAILS>
            <mtccore:PURPOSE_CODE>05</mtccore:PURPOSE_CODE>
         </mtc:PROCESSING_DETAILS>
         <mtc:STOCK_TRANSACTION>
            <mtc:QUANTITY>400</mtc:QUANTITY>
            <mtc:ABSOLUTE/>
            <mtc:SERIAL_NUMBER/>
            <mtc:LOT_ID/>
            <mtc:TRANSACTION_DATE>2016-07-04T11:49:29Z</mtc:TRANSACTION_DATE>
            <mtc:PRODUCT_ID>MPO_Prod1</mtc:PRODUCT_ID>
            <mtc:GOODS_STATUS>GOOD</mtc:GOODS_STATUS>
            <mtc:LOCATION>GEODIS_WHS_FR_SOCHAUX</mtc:LOCATION>
            <mtc:EXTERNAL_ID>1150-2016-07-04T11:48:29Z</mtc:EXTERNAL_ID>
            <mtc:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtc:ORGANIZATION_ID>
         </mtc:STOCK_TRANSACTION>
      </mtc:STOCK_TRANSACTION_GROUP>

/ deze sets de balance op 0704 op 400	,

[eric@localhost Geosco]$ cat ForecastRevision/archive/2016-06/21/my-FORECAST-0704-a.xml 

        <mtc:CUSTOMER_ORDER_BODY>
            <mtc:CUSTOMER_ORDER_ID/>
            <mtc:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtc:ORGANIZATION_ID>
            <mtc:FORECAST>
               <mtc:FORECAST_ID>2016-06-21-PSA</mtc:FORECAST_ID>
               <mtc:FORECAST_STATUS>FORECAST</mtc:FORECAST_STATUS>
               <mtc:FORECAST_DATE>2016-06-21T01:56:00</mtc:FORECAST_DATE>
            </mtc:FORECAST>
            <mtc:BUYER_ORDER_NUMBER>0004454269</mtc:BUYER_ORDER_NUMBER>
            <mtc:CREATION_DATE>2016-06-21T01:56:00</mtc:CREATION_DATE>
            <mtc:CUSTOMER_ORDER_TYPE>SALES_ORDER</mtc:CUSTOMER_ORDER_TYPE>
            <mtc:BUYER>
               <mtc:PARTY_ID>000254206547900140</mtc:PARTY_ID>
            </mtc:BUYER>
            <mtc:SELLER>
               <mtc:PARTY_ID>093139861944500198</mtc:PARTY_ID>
            </mtc:SELLER>
         </mtc:CUSTOMER_ORDER_BODY>

        <mtc:CUSTOMER_ORDER_LINE>
            <mtc:CUSTOMER_ORDER_LINE_ID>1766</mtc:CUSTOMER_ORDER_LINE_ID>
            <mtc:SELLER_ORDER_LINE_NUMBER/>
            <mtc:PRODUCT>
               <mtc:PRODUCT_ID>MPO_Prod1</mtc:PRODUCT_ID>
            </mtc:PRODUCT>
            <mtc:GOODS_STATUS>
               <mtc:INTERNAL_STATUS_CODE>GOOD</mtc:INTERNAL_STATUS_CODE>
            </mtc:GOODS_STATUS>
            <mtc:QUANTITY>150</mtc:QUANTITY>
            <mtc:FROM_PARTY>
               <mtc:PARTY_ID>093139861944500198</mtc:PARTY_ID>
            </mtc:FROM_PARTY>
            <mtc:TO_PARTY>
               <mtc:PARTY_ID>000254206547900140</mtc:PARTY_ID>
            </mtc:TO_PARTY>
            <mtc:REQUESTED_START_AFTER>2016-07-04T00:00:00</mtc:REQUESTED_START_AFTER>
            <mtc:REQUESTED_END_AFTER>2016-06-04T23:59:59</mtc:REQUESTED_END_AFTER>

/ HOI HOI HOI 
/ Einde PSA-267


/ PSA-267


/ we zien in de emails dat balance onderm min	,
98160830ZD
98160199PR	<-
98120910ZD
9806313580
98159511VL
98159522WP
981595249G
98159524KL
9675380280
9820100680
98108260KL
9820100780



/ we nemen in geosco2p3
9803778880
/ Nu 28 jun	, de balance op 6 jul is 20470	, we zien een In 5280	, 
/ we maken een forecast_out van 18000	, dan 2214	, dus onder min 2470	, dus onder 2760	,

[eric@localhost Geosco]$ vi ForecastRevision/archive/2016-06/21/my-FORECAST_OUT-p.xml 
           <mtc:PRODUCT>
               <mtc:PRODUCT_ID>9803778880</mtc:PRODUCT_ID>
            </mtc:PRODUCT>
            <mtc:GOODS_STATUS>
               <mtc:INTERNAL_STATUS_CODE>GOOD</mtc:INTERNAL_STATUS_CODE>
            </mtc:GOODS_STATUS>
            <mtc:QUANTITY>18000</mtc:QUANTITY>
            <mtc:FROM_PARTY>
               <mtc:PARTY_ID>093139861944500198</mtc:PARTY_ID>
            </mtc:FROM_PARTY>
            <mtc:TO_PARTY>
               <mtc:PARTY_ID>000254206547900140</mtc:PARTY_ID>
            </mtc:TO_PARTY>
            <mtc:REQUESTED_START_AFTER>2016-07-06T00:00:00</mtc:REQUESTED_START_AFTER>
            <mtc:REQUESTED_END_AFTER>2016-07-06T23:59:59</mtc:REQUESTED_END_AFTER>

/ Maar we zien GEEN email	,
/ Maar dat komt WH omdat hij niet binnen de lead time valt	,
/ TODO

/ 7	. 

geosco2p3=# select st.*                                                     
from stock_transaction st
join product p on st.product_systemid=p.system_id
join goods_status gs on st.goods_status_systemid=gs.system_id
join stock_location sl on st.stock_location_systemid=sl.system_id
where p.productid='9803778880'
and st.transaction_date='2016/07/08'
;
 system_id |  quantity   | serial_number | lot_id |  transaction_date   | product_systemid | goods_status_systemid | stock_
location_systemid | product_item_systemid | external_id | organization_systemid | calc_stock_level | is_dirty | transaction
_type | customer_order_line_systemid | shipment_item_systemid | ignore_on_balance 
-----------+-------------+---------------+--------+---------------------+------------------+-----------------------+-------
------------------+-----------------------+-------------+-----------------------+------------------+----------+------------
------+------------------------------+------------------------+-------------------
  27306057 | -1201.00000 | NULL          | NULL   | 2016-07-08 00:00:00 |         26878521 |              26877284 |       
         26878346 |                  NULL | NULL        |                 12000 |       2653.00000 |        0 | FORECAST_OU
T     |                     27408532 |                   NULL |                 0
(1 row)


geosco2p3=# update stock_transaction
set calc_stock_level=0
from stock_transaction st 
join product p on st.product_systemid=p.system_id
join goods_status gs on st.goods_status_systemid=gs.system_id
join stock_location sl on st.stock_location_systemid=sl.system_id
where p.productid='9803778880'
and st.transaction_date='2016/07/08'
;
/ ERR
/ update ze allemaal	,
/ TODO MICHEL

/ we doen met de hand	,
geosco2p3=# update stock_transaction set calc_stock_level=0 where system_id=27306057
geosco2p3-# ;
UPDATE 1
geosco2p3=# commit;
COMMIT
/ In de db blijft calc_stock_level=0	, en op het scherm blijven we zien 2653	, 

/ dan doen we 	,
geosco2p3=# update stock_transaction set is_dirty=1 where system_id=27306057
;
# commit

/ Dan recalculate bepaalt opnieuw dat de calc_stock_level=2653	, dus weer oude situatie	,  
/ 7	. 

/ 13	. 

configuration, inventory, stock keeping unit trigger


/ we zien alleen 
Alert_Product
/ click	,
On Exceed Low In Lead Time: checked
/ Alleen als binnen lead time onder min	, volgt er een actie	,
/ Anders is er tijd genoeg, om bij te bestellen	,
/ TODO

/ we zien ook de action	, PSA_SX_STOCK_ALERT	,  

/ 13	. 

configuration, execution, triggers, actions
PSA_SX_STOCK_ALERT
/ click 
execution order: 1
trigger task: SEND_MESSAGE
message: PSA_SX_ALERT_SKU
/ click op button ernaast	, we zien description: SKU Below Min

/ 7	. 

$ less StockLevelCalculationServiceImpl.java

	private void recalculate(Product aProduct, StockLocation aLocation, GoodsStatus aStatus) {
		boolean check = false;
		while (true) {
			StockTransaction myTransaction = stockTransactionDAO.getFirstDirty(aProduct, aLocation, aStatus);
			if (myTransaction == null) {
				break;
			} else {
				if (recalculate(myTransaction)) {			<-[
/(*)
					check = true;
				}
			}
		}
		if (check) {
			trigger(aProduct, aLocation, aStatus);

	private void trigger(Product aProduct, StockLocation aLocation, GoodsStatus aStatus) {
		stockKeepingUnitTriggerHandler.handleUpdate(aProduct, aLocation, aStatus);
	}
/s
$ vi StockKeepingUnitTriggerHandlerImpl.java

	@Override
	public void handleUpdate(StockKeepingUnit aSku) {
		Collection<StockKeepingUnitTrigger> myList = stockKeepingUnitTriggerDAO.getAll();
		for (StockKeepingUnitTrigger myTrigger : myList) {
			if ((myTrigger.getOnExceedLowInLeadTime() && stockReplenishmentService.exceedsLowInLeadTime(aSku)) ||
					(myTrigger.getOnExceedHighInLeadTime() && stockReplenishmentService.exceedsHighInLeadTime(aSku))) {
				evaluateAndExecuteRequest(aSku, myTrigger);
/s
	@Override
	public boolean evaluateAndExecuteRequest(StockKeepingUnit aSku, StockKeepingUnitTrigger aTrigger) {
		if (checkTrigger(aTrigger, aSku)) {
			TriggerExecutionRequest<StockKeepingUnitTrigger> myRequest = new TriggerExecutionRequest<StockKeepingUnitTrigger>(aTrigger);
			myRequest.addObject(StockKeepingUnitResolver.STOCK_KEEPING_UNIT_SYSTEMID, aSku.getSystemId());
			getTriggerRequestProducer().produce(myRequest);
			return true;
		}
		return false;
	}
/ TODO (Afmaken)

/ Ad (*)

$ less StockLevelCalculationServiceIimpl.java

	private boolean recalculate(StockTransaction aTransaction) {
		boolean myLevelChange = false;
		BigDecimal myLastKnownBalance = null;
		aTransaction.setDirty(false);
		if (aTransaction.getTransactionType().equals(StockTransactionType.COUNT)) {
			aTransaction.setCalculatedStockLevel(aTransaction.getQuantity());
			myLastKnownBalance = aTransaction.getQuantity();
			myLevelChange=true;												<- PAUL
		} else {
			StockTransaction myPrevious = stockTransactionDAO.getPrevious(aTransaction);  <- (**)
			if (myPrevious != null)  {
				myLastKnownBalance = myPrevious.getCalculatedStockLevel();
			}
			if (myLastKnownBalance == null) {
				myLastKnownBalance = BigDecimal.ZERO;
			}
			myLevelChange = recalculateStockLevel(aTransaction, myLastKnownBalance);
			myLastKnownBalance = aTransaction.getCalculatedStockLevel();
		}
		stockTransactionDAO.save(aTransaction);

/*
/ Als de stock level opnieuw moet worden calc, returns deze method true	,
*/
	protected boolean recalculateStockLevel(StockTransaction aTransaction, BigDecimal aLastKnownBalance) {
		BigDecimal myNewBalance;
		if (aTransaction.isIgnoreOnBalance()) {
			myNewBalance = aLastKnownBalance;
		} else {
			myNewBalance = aLastKnownBalance.add(aTransaction.getQuantity());
		}
		if (aTransaction.getCalculatedStockLevel() == null || myNewBalance.compareTo(aTransaction.getCalculatedStockLevel()) != 0) {
			aTransaction.setCalculatedStockLevel(myNewBalance);
			return true;
		} else {
			return false;
		}
	}

/ (**)
tx		qty		balance		dirty
1		10			10		
2		20			30
3		-5			25
4		-10			15

/ Als bij 3 doordat de sho verandert, de qty -7 wordt	, dan wordt tx 3 dirty	, en wordt de balance opnieuw calc	, ook verder	, 
2 		20			30
3		-7			23		1
4		-10			13

/ Hij calcs: previous tx =2 	, die heeft balance 30	, dus wordt balance van 3 23	, en van 4 13	,  

/ als we een email trigger willen force	, moeten we in de db de st tx is_dirty=1 set en de calc_stock_level=0 (of wat dan ook, als het maar anders is dan de vorige)	,

/ 7	. 

/ Als we de interne quees willen empty	,

[eric@localhost data]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/geosco/data
[eric@localhost data]$ rm -rf activemq/


/ Einde PSA-267

/ DEBUG PSA-267

/ 7	. 

/ BREAKPOINTS

	@Override
	public void recalculate(StockKeepingUnit aSku) {
		LOG.info("Starting recalculation of stock levels for SKU [" + aSku + "] ...");
70:		recalculate(aSku.getProduct(), aSku.getStockLocation(), aSku.getGoodsStatus());			<- disable 
/ cond b	,
aSku.getProduct().getProductId().equals("9676426180")

	@Override
	public void recalculateAll() {
79:		LOG.info("Firing requests to recalculate all SKUs ...");			<- disable	, 

	private void recalculate(Product aProduct, StockLocation aLocation, GoodsStatus aStatus) {
		LOG.info("Starting recalculation of stock levels for [" + aProduct + "/" + aLocation + "/" + aStatus + "] ...");
		long myStart = System.currentTimeMillis();
		boolean check = false;
		while (true) {
			StockTransaction myTransaction = stockTransactionDAO.getFirstDirty(aProduct, aLocation, aStatus);
			if (myTransaction == null) {
				break;
			} else {
134:				if (recalculate(myTransaction)) { 		<- hier zal een dirty st tx invallen	,

/ 7	. 

/ we maken een forecast_out 	, binnen de leap time	, 
/ dit geeft een nieuwe co (bestelling)	, en dat geeft een nieuwe st tx, en die is drity	,
/ deze zal in b 134 vallen	, 
/ later, maken we deze st tx dirty, en set de calc_stock_level=0	, dan recalculate rekent opnieuw uit	,

/ 7	. 

/ geosco2p3	, 
/ nu 28-06	, 
/ lead time = 3d	, we gaan een forecast_out maken op 30-06	, is nu 17703	, we doen -15000	, dan 2703 < 2760	, dus balance wordt rood	, 
/ we debug alleen recalculate	,

/ bericht	,
        <mtc:CUSTOMER_ORDER_LINE>
            <mtc:PRODUCT>
               <mtc:PRODUCT_ID>9803778880</mtc:PRODUCT_ID>
            </mtc:PRODUCT>
            <mtc:GOODS_STATUS>
               <mtc:INTERNAL_STATUS_CODE>GOOD</mtc:INTERNAL_STATUS_CODE>
            </mtc:GOODS_STATUS>
            <mtc:QUANTITY>15000</mtc:QUANTITY>
            <mtc:FROM_PARTY>
               <mtc:PARTY_ID>093139861944500198</mtc:PARTY_ID>
            </mtc:FROM_PARTY>
            <mtc:TO_PARTY>
               <mtc:PARTY_ID>000254206547900140</mtc:PARTY_ID>
            </mtc:TO_PARTY>
            <mtc:REQUESTED_START_AFTER>2016-06-30T00:00:00</mtc:REQUESTED_START_AFTER>
            <mtc:REQUESTED_END_AFTER>2016-06-30T23:59:59</mtc:REQUESTED_END_AFTER>

/ BREAKPOINTS

public class ProductServiceImpl implements ProductService {
	@Override
	public Map<Product, BigDecimal> getProductList(Product aProduct, BigDecimal aQty, int aLevel) {
		Map<Product, BigDecimal> myList = new HashMap<Product, BigDecimal>();							<- disable

StockTransactionServiceImpl [line: 943] - handleCustomerOrderLineUpdate(CustomerOrderLine)		< disable
/=
	private void handleCustomerOrderLineUpdate(CustomerOrderLine aNewLine) {

		Product myProduct = aNewLine.getProduct();
		Map<Product, BigDecimal> myProducts = productService.getProductList(myProduct, aNewLine.getQuantity(), 1);

		List<StockTransaction> myTransactions = stockTransactionDAO.getByCustomerOrderLine(aNewLine);	< disable	,

///////////////////////////////////////////////////////////////////////////////////////
StockTransactionHandlerImpl [line: 46] - processMessageAsRoot(Message)	
	@Override
	protected void processMessageAsRoot(Message aMessage) throws Exception {
		ObjectMessage myMessage = (ObjectMessage) aMessage;							< disable	,
 
AbstractConsumer [line: 31] - onMessage(Message)	<- disable

StockLevelCalculationServiceImpl [line: 61] - handleRequest(StockLevelCalculationRequest)	<- disable

EventHandlerServiceImpl.handleEvent(Event) line: 72		<- disable
StockTransactionEventListener.handleEvent(Event<?>) line: 38	<- disable
CustomerOrderLineServiceImpl [line: 172] - setCustomerOrderLineStatus(CustomerOrderLine)	<- disable
StockTransactionEventListener.handleEvent(Event<?>) line: 52	<- disable
StockTransactionServiceImpl.handleCustomerOrderCreated(CustomerOrderEvent) line: 168	<-disable
StockReplenishmentServiceImpl [line: 140] - exceedsLowInLeadTime(StockKeepingUnit)	

/ methods aan ontvangende kant , waar de emails worden create	,
TriggerRequestProducerImpl$1 [line: 32] - produce(TriggerExecutionRequest<?>)		<- disable
ggerRequestProducerImpl$1 [line: 36] - run()	<- disable
AbstractProducer$1 [line: 38] - createMessage(Session)	<- disable
TriggerRequestHandlerImpl [line: 38] - onMessage(Message)	<- disable
StockKeepingUnitTriggerHandlerImpl [line: 44] - evaluateAndExecuteRequest(StockKeepingUnit, StockKeepingUnitTrigger)	<- disable
TriggerRequestProducerImpl [line: 51] - queueRequest(TriggerExecutionRequest<?>)	<- disable
TriggerActionExecutionServiceImpl [line: 29] - executeRequest(TriggerExecutionRequest<?>)	<- disable
SendMessage [line: 36] - execute(Collection<TriggerTaskParameter<?>>, Map<String, Serializable>)	<- disable


/ 7	. 

$ vi inventory-service.sb.xml

	<!-- scheduled task to periodically recalculate stock levels -->
	<bean id="recalcStockLevels" class="org.springframework.scheduling.quartz.SimpleTriggerBean">
		<property name="jobDetail">
			<bean class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean">
				<property name="targetObject" ref="com.mpobjects.inventory.service.stocktransaction.StockLevelCalculationService" />
				<property name="targetMethod" value="recalculateAll" />
				<property name="concurrent" value="false" />
			</bean>
		</property>
		<property name="startDelay" value="${module.inventory.recalculation.service.delay}" />
		<property name="repeatInterval" value="${module.inventory.recalculation.service.interval}" />
	</bean>

/ zo wordt de recalculateAll fct om de 2 min called	,	

/ 7	. 

/ geosco0628p	,
/ Product  9803778880
/ Oo 1 Jul st tx	,
2016-07-01 23:59	FORECAST_OUT		CO000029661 / 1766

select st.* from stock_transaction st
join product p on st.product_systemid=p.system_id
where p.productid='9803778880'
and '2016-07-01' <= st.transaction_date
and st.transaction_date <= '2016-07-01 23:59:59.999999'
;
 system_id |   quantity   | serial_number | lot_id |  transaction_date   | product_systemid | goods_status_systemid | stock
_location_systemid | product_item_systemid | external_id | organization_systemid | calc_stock_level | is_dirty | transactio
n_type | customer_order_line_systemid | shipment_item_systemid | ignore_on_balance 
-----------+--------------+---------------+--------+---------------------+------------------+-----------------------+------
-------------------+-----------------------+-------------+-----------------------+------------------+----------+-----------
-------+------------------------------+------------------------+-------------------
  27462572 | -12500.00000 | NULL          | NULL   | 2016-07-01 23:59:00 |         26878521 |              26877284 |      
          26878346 |                  NULL | NULL        |                 12000 |       2466.00000 |        0 | FORECAST_O
UT     |                     27551454 |                   NULL |                 0
(1 row)

update stock_transaction
set is_dirty=1,calc_stock_level=0
where system_id=27462572
commit

/ Als we dit doen	, wordt het weer als de oude situatie	, calc_stock_level=2466 en is_dirty=0	,
/ HOI HOI HOI
 





/ Einde DEBUG PSA-267

/ DEBUG PSA-267

/ Dit is een ander product dan 9803778880	, 
/ maar we komen in 	,
/s
StockTransactionHandlerImpl(AbstractConsumer).onMessage(Message) line: 49	
			processMessageAsRoot(aMessage);
/s
StockTransactionHandlerImpl.processMessageAsRoot(Message) line: 56	
		Serializable serializable = myMessage.getObject();
StockLevelCalculationRequest [26879357]
		} else if (serializable instanceof StockLevelCalculationRequest) {
			stockLevelCalculationService.handleRequest(myRequest);
/s
StockLevelCalculationServiceImpl.handleRequest(StockLevelCalculationRequest) line: 63	

		StockKeepingUnit myStockKeepingUnit = stockKeepingUnitDAO.getBySystemId(aRequest.getStockKeepingUnitSystemId());
goodsStatus	GoodsStatus_$$_javassist_56  (id=21750)	
GOOD
product	Product_$$_javassist_14  (id=21742)	
9818409880 (26878895)
stockLocation	StockLocation_$$_javassist_78  (id=21749)	
GEODIS_WHS_FR_SOCHAUX

		if (myStockKeepingUnit != null) {
			recalculate(myStockKeepingUnit);
/s
StockLevelCalculationServiceImpl.recalculate(StockKeepingUnit) line: 70	
		recalculate(aSku.getProduct(), aSku.getStockLocation(), aSku.getGoodsStatus());				/ l. 70	,
/s
StockLevelCalculationServiceImpl.recalculate(Product, StockLocation, GoodsStatus) line: 140	
		while (true) {
			StockTransaction myTransaction = stockTransactionDAO.getFirstDirty(aProduct, aLocation, aStatus);
			if (myTransaction == null) {
				break;
			} else {
				if (recalculate(myTransaction)) {			/ overgeslagen	, 
					check = true;
				}
			}
		}
		if (check) {
			trigger(aProduct, aLocation, aStatus);
/s
StockLevelCalculationServiceImpl.trigger(Product, StockLocation, GoodsStatus) line: 193	
		stockKeepingUnitTriggerHandler.handleUpdate(aProduct, aLocation, aStatus);
/s
StockKeepingUnitTriggerHandlerImpl.handleUpdate(Product, StockLocation, GoodsStatus) line: 72	
		List<StockKeepingUnit> myUnitList = stockKeepingUnitDAO.find(aStockLocation, aProduct, aStatus);
		for (StockKeepingUnit myUnit : myUnitList) {
			handleUpdate(myUnit);
/s
StockKeepingUnitTriggerHandlerImpl.handleUpdate(StockKeepingUnit) line: 82	
		Collection<StockKeepingUnitTrigger> myList = stockKeepingUnitTriggerDAO.getAll();
/ size=1
name	"Alert_Product" (id=21884)	

		for (StockKeepingUnitTrigger myTrigger : myList) {
			if (
				(myTrigger.getOnExceedLowInLeadTime() 	
true
				&& stockReplenishmentService.exceedsLowInLeadTime(aSku))  / (*)
true
			||
				(myTrigger.getOnExceedHighInLeadTime() 
false
				&& stockReplenishmentService.exceedsHighInLeadTime(aSku))
		) {
true
				evaluateAndExecuteRequest(aSku, myTrigger);

/ (*)
/s
StockReplenishmentServiceImpl.exceedsLowInLeadTime(StockKeepingUnit) line: 140	
		Period myLeadTime = aUnit.getLeadTime();
P2D
		DateTime myDateTime = new DateTime();
/ Nu, 28 Jun	,
		Date myHigh = myDateTime.plus(myLeadTime).toDate();
/ 30 Jun	,
		StockTransaction myLast = stockTransactionDAO.getPrevious(aUnit, myHigh);
/ Deze queries <myHigh	, bij de SKU aUnit	,
27417530/FORECAST_OUT/2016-06-29 23:59:00.0/9818409880 (26878895)/GEODIS_WHS_FR_SOCHAUX/-42.00000/-1277.00000/false

			myLevel = myLast.getCalculatedStockLevel();
-1277.00000
			return aUnit.getMinStockLevel() != null && myLevel.compareTo(aUnit.getMinStockLevel()) < 0;
2 != null && -1 < 0 = true
/ Klopt	, 

/ we herhalen waar we waren	,
				evaluateAndExecuteRequest(aSku, myTrigger);
/s
StockKeepingUnitTriggerHandlerImpl.evaluateAndExecuteRequest(StockKeepingUnit, StockKeepingUnitTrigger) line: 44	
/=
	public boolean evaluateAndExecuteRequest(StockKeepingUnit aSku, StockKeepingUnitTrigger aTrigger) {
			TriggerExecutionRequest<StockKeepingUnitTrigger> myRequest = new TriggerExecutionRequest<StockKeepingUnitTrigger>(aTrigger);
			myRequest.addObject(StockKeepingUnitResolver.STOCK_KEEPING_UNIT_SYSTEMID, aSku.getSystemId());
			getTriggerRequestProducer().produce(myRequest);
/s
TriggerRequestProducerImpl.produce(TriggerExecutionRequest<?>) line: 32	
		transactionHelper.executeAfterCommit(new Runnable() {
			@Override
			public void run() {
				queueRequest(aRequest);
/ even later	,
/s
public class TriggerRequestProducerImpl extends AbstractProducer implements TriggerRequestProducer {
	private void queueRequest(TriggerExecutionRequest<?> aRequest) {
		try {
			sendMessage(aRequest);
/s
public class AbstractProducer {
	public void sendMessage(final Serializable aSerializable) {
		jmsTemplate.send(destination, new MessageCreator() {
destination=queue://com.mpobjects.triggerrequest
			@Override
			public Message createMessage(Session aSession) throws JMSException {
				return aSession.createObjectMessage(aSerializable);

/ Welke is de consumer	?
/ TODO

/ Een volgende stlvcalcreq	,
/s
StockTransactionHandlerImpl(AbstractConsumer).onMessage(Message) line: 31	
			processMessageAsRoot(aMessage);
/s
StockTransactionHandlerImpl.processMessageAsRoot(Message) line: 53	
		Serializable serializable = myMessage.getObject();
StockLevelCalculationRequest [26878565]
		} else if (serializable instanceof StockLevelCalculationRequest) {
			stockLevelCalculationService.handleRequest(myRequest);
/s
StockTransactionHandlerImpl.processMessageAsRoot(Message) line: 56	
		StockKeepingUnit myStockKeepingUnit = stockKeepingUnitDAO.getBySystemId(aRequest.getStockKeepingUnitSystemId());
			recalculate(myStockKeepingUnit);
/s
/ MORGENOCHTEND
[eric@localhost Geosco]$ gedit ForecastRevision/archive/2016-06/21/my-FORECAST_OUT-p.xml 
/ Hebben we al ingevoerd	, deze wordt nu processed	, 
/ Op 30 Jun rode balance	,
/ HOI HOI HOI

/ we doen	,
[eric@localhost geosco]$ find  ~/DB_TAP/Postgres/Backup/  -type f | grep geosco | xargs ls -1tr | awk 'END{print}' | xargs -I % local-pg_restore.sh  geosco0628p %



/ Einde DEBUG PSA-267

/ DEBUG PSA-267 FORECAST_OUT FINAL

/ 7	 

/ Nu 29 Jun	,
/ Binnen lead time onder min	,

//////////////////////////////////////////////////////////////
/ DEZE IS HELEMAAL OK

/ er was eerder een stock tx create	, omdat we een FORECAST_OUT hadden ingeschoten	,

        <mtc:CUSTOMER_ORDER_LINE>
            <mtc:CUSTOMER_ORDER_LINE_ID>1766</mtc:CUSTOMER_ORDER_LINE_ID>
            <mtc:SELLER_ORDER_LINE_NUMBER/>
            <mtc:PRODUCT>
               <mtc:PRODUCT_ID>9803778880</mtc:PRODUCT_ID>
            </mtc:PRODUCT>
            <mtc:GOODS_STATUS>
               <mtc:INTERNAL_STATUS_CODE>GOOD</mtc:INTERNAL_STATUS_CODE>
            </mtc:GOODS_STATUS>
            <mtc:QUANTITY>12500</mtc:QUANTITY>
            <mtc:FROM_PARTY>
               <mtc:PARTY_ID>093139861944500198</mtc:PARTY_ID>
            </mtc:FROM_PARTY>
            <mtc:TO_PARTY>
               <mtc:PARTY_ID>000254206547900140</mtc:PARTY_ID>
            </mtc:TO_PARTY>
            <mtc:REQUESTED_START_AFTER>2016-07-01T00:00:00</mtc:REQUESTED_START_AFTER>
            <mtc:REQUESTED_END_AFTER>2016-07-01T23:59:59</mtc:REQUESTED_END_AFTER>

/ Hierdoor komt de balance onder het min	,
/ SCS kijkt naar de laatste st tx binnen de lead time	, als van deze de balance < min	, dan email is send	,

/ De st tx is 27462572	,

/ we doen steeds	,

geosco0628p=# update stock_transaction
set is_dirty=1,calc_stock_level=0
where system_id=27462572
;
UPDATE 1
geosco0628p=# commit;
COMMIT

/ Een email is dan send	, 

/ 7	. 

/ we zien dat de st tx 27462572	, die wordt create door de forecast_out	-12500	, heeft transaction date 2016-07-01 23:59:00	, 
/  Waarom 23:59:00	?
 


/ SENDING SIDE

/ geosco0628p

$ vi my-FORECAST_OUT-p.xml 

        <mtc:CUSTOMER_ORDER_LINE>
            <mtc:CUSTOMER_ORDER_LINE_ID>1766</mtc:CUSTOMER_ORDER_LINE_ID>
            <mtc:SELLER_ORDER_LINE_NUMBER/>
            <mtc:PRODUCT>
               <mtc:PRODUCT_ID>9803778880</mtc:PRODUCT_ID>
            </mtc:PRODUCT>
            <mtc:GOODS_STATUS>
               <mtc:INTERNAL_STATUS_CODE>GOOD</mtc:INTERNAL_STATUS_CODE>
            </mtc:GOODS_STATUS>
            <mtc:QUANTITY>12500</mtc:QUANTITY>
            <mtc:FROM_PARTY>
               <mtc:PARTY_ID>093139861944500198</mtc:PARTY_ID>
            </mtc:FROM_PARTY>
            <mtc:TO_PARTY>
               <mtc:PARTY_ID>000254206547900140</mtc:PARTY_ID>
            </mtc:TO_PARTY>
            <mtc:REQUESTED_START_AFTER>2016-07-01T00:00:00</mtc:REQUESTED_START_AFTER>
            <mtc:REQUESTED_END_AFTER>2016-07-01T23:59:59</mtc:REQUESTED_END_AFTER>

/s
StockLevelCalculationServiceImpl.recalculate(Product, StockLocation, GoodsStatus) line: 134	
		while (true) {
			StockTransaction myTransaction = stockTransactionDAO.getFirstDirty(aProduct, aLocation, aStatus);
27462572/FORECAST_OUT/2016-07-01 23:59:00.0/9803778880 (26878521)/GEODIS_WHS_FR_SOCHAUX/-12500.00000/null/false
			if (myTransaction == null) {
				break;
			} else {
				if (recalculate(myTransaction)) {
/s
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 146	
		aTransaction.setDirty(false);
		} else {
			StockTransaction myPrevious = stockTransactionDAO.getPrevious(aTransaction);
27223187/FORECAST_OUT/2016-06-30 00:00:00.0/9803778880 (26878521)/GEODIS_WHS_FR_SOCHAUX/-691.00000/14966.00000/false
			if (myPrevious != null) {
				myLastKnownBalance = myPrevious.getCalculatedStockLevel();
14966.00000
			myLevelChange = recalculateStockLevel(aTransaction, myLastKnownBalance);
aTransaction=
27462572/FORECAST_OUT/2016-07-01 23:59:00.0/9803778880 (26878521)/GEODIS_WHS_FR_SOCHAUX/-12500.00000/null/false
/s
StockLevelCalculationServiceImpl.recalculateStockLevel(StockTransaction, BigDecimal) line: 112	
		} else {
			myNewBalance = aLastKnownBalance.add(aTransaction.getQuantity());
14966.00000 - 12500 = 2466.00000
		if (aTransaction.getCalculatedStockLevel() == null || myNewBalance.compareTo(aTransaction.getCalculatedStockLevel()) != 0) {
/ JA
null
/ WH nieuwe tx	,
27462572/FORECAST_OUT/2016-07-01 23:59:00.0/9803778880 (26878521)/GEODIS_WHS_FR_SOCHAUX/-12500.00000/null/false
			aTransaction.setCalculatedStockLevel(myNewBalance);
27462572/FORECAST_OUT/2016-07-01 23:59:00.0/9803778880 (26878521)/GEODIS_WHS_FR_SOCHAUX/-12500.00000/2466.00000/false

			return true;
/t
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 162	
			myLevelChange = recalculateStockLevel(aTransaction, myLastKnownBalance);
/d
true
			myLastKnownBalance = aTransaction.getCalculatedStockLevel();
2466.00000
		stockTransactionDAO.save(aTransaction);

		// Now recalculate all records until we meet the next count or until done all
		StockTransaction myCurrent = aTransaction;
		main: while (true) {
			List<StockTransaction> myNextList = stockTransactionDAO.getFollowingTransactions(myCurrent, 50);

			for (StockTransaction myNext : myNextList) {
				if (myNext.getTransactionType().equals(StockTransactionType.COUNT)) {
/ NEE
				myCurrent = myNext;
27356837/FORECAST_IN/2016-07-04 23:59:00.0/9803778880 (26878521)/GEODIS_WHS_FR_SOCHAUX/0.00000/14965.00000/true
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/s
StockLevelCalculationServiceImpl.recalculateStockLevel(StockTransaction, BigDecimal) line: 118	
		if (aTransaction.isIgnoreOnBalance()) {
/ JA
			myNewBalance = aLastKnownBalance;

		if (aTransaction.getCalculatedStockLevel() == null || myNewBalance.compareTo(aTransaction.getCalculatedStockLevel()) != 0) {
/ JA
2466.00000 != 14965.00000
			aTransaction.setCalculatedStockLevel(myNewBalance);
27356837/FORECAST_IN/2016-07-04 23:59:00.0/9803778880 (26878521)/GEODIS_WHS_FR_SOCHAUX/0.00000/2466.00000/true

			return true;
/t
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 179	
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/d
					myCurrent.setDirty(false);
					stockTransactionDAO.save(myCurrent);
					myLevelChange = true;
				}
				myLastKnownBalance = myCurrent.getCalculatedStockLevel();
2466.00000

			for (StockTransaction myNext : myNextList) {
27461402/FORECAST_OUT/2016-07-04 23:59:00.0/9803778880 (26878521)/GEODIS_WHS_FR_SOCHAUX/-1257.00000/13708.00000/false
				if (myNext.getTransactionType().equals(StockTransactionType.COUNT)) {
/ NEE
				}
				myCurrent = myNext;
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/s
StockLevelCalculationServiceImpl.recalculateStockLevel(StockTransaction, BigDecimal) line: 115	
		} else {
			myNewBalance = aLastKnownBalance.add(aTransaction.getQuantity());
2466-1257=1209.00000
		if (aTransaction.getCalculatedStockLevel() == null || myNewBalance.compareTo(aTransaction.getCalculatedStockLevel()) != 0) {
			aTransaction.setCalculatedStockLevel(myNewBalance);
27461402/FORECAST_OUT/2016-07-04 23:59:00.0/9803778880 (26878521)/GEODIS_WHS_FR_SOCHAUX/-1257.00000/1209.00000/false
			return true;
/t
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 178	
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
true || false = true
					myCurrent.setDirty(false);
					stockTransactionDAO.save(myCurrent);
					myLevelChange = true;
				}
				myLastKnownBalance = myCurrent.getCalculatedStockLevel();
1209.00000

/ we geloven het	, 
/c
		return myLevelChange;
true
/t
StockLevelCalculationServiceImpl.recalculate(Product, StockLocation, GoodsStatus) line: 135	
		while (true) {
			StockTransaction myTransaction = stockTransactionDAO.getFirstDirty(aProduct, aLocation, aStatus);
			if (myTransaction == null) {
				break;
			} else {
				if (recalculate(myTransaction)) {
/d
true
27462572/FORECAST_OUT/2016-07-01 23:59:00.0/9803778880 (26878521)/GEODIS_WHS_FR_SOCHAUX/-12500.00000/2466.00000/false
					check = true;
		while (true) {
			StockTransaction myTransaction = stockTransactionDAO.getFirstDirty(aProduct, aLocation, aStatus);
			if (myTransaction == null) {
/ JA
				break;

		if (check) {
			trigger(aProduct, aLocation, aStatus);
/s
StockLevelCalculationServiceImpl.trigger(Product, StockLocation, GoodsStatus) line: 194	
		stockKeepingUnitTriggerHandler.handleUpdate(aProduct, aLocation, aStatus);
/s
StockKeepingUnitTriggerHandlerImpl.handleUpdate(Product, StockLocation, GoodsStatus) line: 70	
		List<StockKeepingUnit> myUnitList = stockKeepingUnitDAO.find(aStockLocation, aProduct, aStatus);
		for (StockKeepingUnit myUnit : myUnitList) {
			handleUpdate(myUnit);
/s
StockKeepingUnitTriggerHandlerImpl.handleUpdate(StockKeepingUnit) line: 78	
		Collection<StockKeepingUnitTrigger> myList = stockKeepingUnitTriggerDAO.getAll();
[Alert_Product]
		for (StockKeepingUnitTrigger myTrigger : myList) {
			if ((myTrigger.getOnExceedLowInLeadTime() 
			&& stockReplenishmentService.exceedsLowInLeadTime(aSku)) ||
/s
StockReplenishmentServiceImpl.exceedsLowInLeadTime(StockKeepingUnit) line: 140	
		DateTime myDateTime = new DateTime();
/ Nu, 	2016-06-29T15:18:41.897+02:00
		Date myHigh = myDateTime.plus(myLeadTime).toDate();
Sat Jul 02 15:18:41 CEST 2016

		StockTransaction myLast = stockTransactionDAO.getPrevious(aUnit, myHigh);
27462572/FORECAST_OUT/2016-07-01 23:59:00.0/9803778880 (26878521)/GEODIS_WHS_FR_SOCHAUX/-12500.00000/2466.00000/false

		if (myLast != null) {
			myLevel = myLast.getCalculatedStockLevel();
2466.00000
			return aUnit.getMinStockLevel() != null && myLevel.compareTo(aUnit.getMinStockLevel()) < 0;
2760.00000	&& 2466 < 2760
/t
StockKeepingUnitTriggerHandlerImpl.handleUpdate(StockKeepingUnit) line: 82	
		for (StockKeepingUnitTrigger myTrigger : myList) {
			if ((myTrigger.getOnExceedLowInLeadTime() && stockReplenishmentService.exceedsLowInLeadTime(aSku)) ||
					(myTrigger.getOnExceedHighInLeadTime() && stockReplenishmentService.exceedsHighInLeadTime(aSku))) {
/ JA
				evaluateAndExecuteRequest(aSku, myTrigger);
/s
StockKeepingUnitTriggerHandlerImpl.evaluateAndExecuteRequest(StockKeepingUnit, StockKeepingUnitTrigger) line: 44	
		if (checkTrigger(aTrigger, aSku)) {
			TriggerExecutionRequest<StockKeepingUnitTrigger> myRequest = new TriggerExecutionRequest<StockKeepingUnitTrigger>(aTrigger);
			myRequest.addObject(StockKeepingUnitResolver.STOCK_KEEPING_UNIT_SYSTEMID, aSku.getSystemId());
TriggerExecutionRequest[triggerSystemId=27108683,type=class com.mpobjects.inventory.model.entity.stockkeepingunittrigger.StockKeepingUnitTrigger,objectMap={stockKeepingUnitSystemId=26878556}]

geosco0628p=# select p.productid,gs.code,sl.name
geosco0628p-# from inv_stock_keeping_unit sku
geosco0628p-# join product p on sku.product_systemid=p.system_id
geosco0628p-# join goods_status gs on sku.goods_status_systemid=gs.system_id
geosco0628p-# join stock_location sl on sku.stock_location_systemid=sl.system_id
geosco0628p-# where sku.system_id=26878556
geosco0628p-# ;
 productid  | code |         name          
------------+------+-----------------------
 9803778880 | GOOD | GEODIS_WHS_FR_SOCHAUX
(1 row)

			getTriggerRequestProducer().produce(myRequest);
/s
TriggerRequestProducerImpl.produce(TriggerExecutionRequest<?>) line: 32	
		transactionHelper.executeAfterCommit(new Runnable() {
			@Override
			public void run() {
/ even later	,
				queueRequest(aRequest);
/s
TriggerRequestProducerImpl.queueRequest(TriggerExecutionRequest<?>) line: 51	
			sendMessage(aRequest);
/s
TriggerRequestProducerImpl(AbstractProducer).sendMessage(Serializable) line: 34	
/=
	public void sendMessage(final Serializable aSerializable) {
		jmsTemplate.send(destination, new MessageCreator() {
destination=queue://com.mpobjects.triggerrequest
			@Override
			public Message createMessage(Session aSession) throws JMSException {
				return aSession.createObjectMessage(aSerializable);
this	AbstractProducer$1  (id=23745)	
	val$aSerializable	TriggerExecutionRequest  (id=23684)	

/ Einde SENDING SIDE

/ 7	. 

/ Ontvangende kant	, 

/ RECEIVER SIDE

/s
public class TriggerRequestHandlerImpl implements TriggerRequestHandler {
	public void onMessage(Message aMessage) {
		try {
			TriggerExecutionRequest<?> myRequest = (TriggerExecutionRequest<?>) ((ObjectMessage) aMessage).getObject();
			triggerActionExecutionService.executeRequest(myRequest);
/s
TriggerActionExecutionServiceImpl.executeRequest(TriggerExecutionRequest<?>) line: 29	
		AbstractTrigger myTrigger = triggerDaoManager.getDao(aRequest.getType()).getBySystemId(aRequest.getTriggerSystemId());

Request	TriggerExecutionRequest  (id=23926)	
	objectMap	HashMap  (id=23970)	
{stockKeepingUnitSystemId=26878556}
	resource	null	
	triggerSystemId	27108683	
	type	Class (com.mpobjects.inventory.model.entity.stockkeepingunittrigger.StockKeepingUnitTrigger) (id=1443)	

ggerDaoManager.getDao(aRequest.getType())=
com.mpobjects.inventory.dao.stockkeepingunittrigger.StockKeepingUnitTriggerDAOImpl@64eee9a8

myTrigger=
com.mpobjects.inventory.model.entity.stockkeepingunittrigger.StockKeepingUnitTrigger/id:27108683
Alert_Product

		List<TriggerAction> myTriggerActionList = new ArrayList<TriggerAction>(myTrigger.getTriggerList());
[com.mpobjects.oms.model.trigger.TriggerAction/id:26879449]

		for (TriggerAction myTriggerAction : myTriggerActionList) {
myTriggerAction	TriggerAction  (id=18509)	
	code	"PSA_SX_STOCK_ALERT" (id=18512)	
	configuration	"message=;" (id=18513)	
	description	"This is the alert in case of the SKU is below the mininmum under the lead time" (id=18554)	
	executionOrder	Integer  (id=18555)	
	organization	Organization  (id=18504)	
	parameters	null	
	performanceMonitorService	null	
	systemId	26879449	
	triggerTask	"SEND_MESSAGE" (id=18569)	
			TriggerTask myTask = triggerTaskDefinitionManager.getTask(myTriggerAction.getTriggerTask());

myTriggerAction.getTriggerTask()="SEND_MESSAGE"
/s
TriggerTaskDefinitionManagerImpl.getTask(String) line: 50	
		Class<? extends TriggerTask> myClass = definitionMap.get(aName);
class com.mpobjects.oms.model.trigger.task.SendMessage

this	TriggerTaskDefinitionManagerImpl  (id=24110)	
	definitionMap	HashMap  (id=24111)	
{EXPORT_CUSTOM_SHIPMENT_ORDER_MESSAGE=class com.mpobjects.oms.model.trigger.task.ExportCustomShipmentOrderMessage,
 EXPORT_LOGISTICS_ORDER_EVENT=class com.mpobjects.oms.model.trigger.task.ExportLogisticsOrderEvent,
 CREATE_SERVICE_ORDER_EVENT=class com.mpobjects.event.service.triggertask.CreateServiceOrderEvent,
 ASSIGN_PATH=class com.mpobjects.oms.model.trigger.task.AssignPath,
 EXPORT_SERVICE_ORDER=class com.mpobjects.oms.model.trigger.task.ExportServiceOrder,
 GENERATE_DOCUMENT=class com.mpobjects.oms.model.trigger.task.GenerateDocument,
 GENERATE_LABEL=class com.mpobjects.oms.model.trigger.task.GenerateLabel,
 GENERATE_SUPPLIER_INVOICE=class com.mpobjects.invoice.model.trigger.GenerateSupplierInvoice,
 EXPORT_CUSTOM_MESSAGE=class com.mpobjects.oms.model.trigger.task.ExportCustomMessage,
 VALIDATE_SHIPMENT_ORDER=class com.mpobjects.oms.model.trigger.task.ValidateShipmentOrder,
 GENERATE_INBOUND_LABEL=class com.mpobjects.oms.model.trigger.task.GenerateInboundLabel,
 GENERATE_CUSTOMER_INVOICE=class com.mpobjects.customerinvoice.model.trigger.GenerateCustomerInvoice,
 RELEASE_SERVICE_ORDER_FOR_EVENT=class com.mpobjects.oms.model.trigger.task.ReleaseServiceOrderForEvent,
 SEND_MESSAGE=class com.mpobjects.oms.model.trigger.task.SendMessage,
 CHECK_SHIPMENT_ORDER_SERVICE_AGREEMENT=class com.mpobjects.oms.ratecalc.model.trigger.RecalculateShipmentOrderPriceCost}

				return myClass.newInstance();
/t
TriggerActionExecutionServiceImpl.executeRequest(TriggerExecutionRequest<?>) line: 47	
		for (TriggerAction myTriggerAction : myTriggerActionList) {
			TriggerTask myTask = triggerTaskDefinitionManager.getTask(myTriggerAction.getTriggerTask());
/d
myTask	SendMessage  (id=18673)	

			myTask.execute(myTriggerAction.getParameters(), aRequest.getObjectMap());

myTriggerAction.getParameters(),=
null
aRequest.getObjectMap()=
{stockKeepingUnitSystemId=26878556}

/s
TriggerAction.getParameters() line: 63	
		if (parameters == null) {
			parseParameters();
/s
TriggerAction.parseParameters() line: 121	
		parameters = MpoBeanFactory.getBean(TriggerTaskDefinitionManager.class).getTask(getTriggerTask()).getParameters();
[TaskParameter[message =null]]
		if (!StringUtils.isBlank(configuration)) {
configuration=
"message=;"
			for (String myParam : configuration.split(PARAM_SEPARATOR)) {	 / PARAM_SEPARATOR=";"
message=
				String[] mySplit = myParam.split(VALUE_SEPARATOR);	/ VALUE_SEPARATOR="="
[message]
				TriggerTaskParameter<?> myParameter = resolveParameter(mySplit[0]);
TaskParameter[message =null]
				if (myParameter != null && mySplit.length > 1) {
/ NEE
/ TODO
					myParameter.setStringValue(mySplit[1]);
/t
/s
SendMessage.execute(Collection<TriggerTaskParameter<?>>, Map<String,Serializable>) line: 36	

/ Intermezzo

/ we voegen een Message toe	,
Configuration , Execution, Triggers, Actions
/ Kes	PSA_SX_STOCK_ALERT
Message , click icon	,
/ Kies	,
PSA_SX_ALERT_SKU	SKU Below Min

/ Einde Intermezzo

		parameters.clear();
		parameters.addAll(aParameters);
[TaskParameter[message =null]]
		MessageService myService = MpoBeanFactory.getBean(MessageService.class);

		Message myMessage = (Message) getParameter(MESSAGE_PARAM).getValue();
com.mpobjects.oms.model.entity.alertmessaging.Message@6c24f851[systemId=26879423,code=PSA_SX_ALERT_SKU,description=SKU Below Min,type=EMAIL,subject=SKU Below Min ${stockKeepingUnit.product.code} ${stockKeepingUnit.stockLocation.code},toAddress=adriana.velasquez@geodis.com,]

		try {
			HashMap<String, Object> myMap = new HashMap<String, Object>();
			myMap.putAll(anObjectMap);
myMap=
{stockKeepingUnitSystemId=26878556}
			MpoBeanFactory.getBean(ObjectResolverManager.class).resolve(myMap);
myMap=
{stockKeepingUnit=com.mpobjects.inventory.model.entity.stockkeepingunit.StockKeepingUnit/id:26878556, stockKeepingUnitSystemId=26878556}
			ConvertedMessage myConverted = myService.convert(myMessage, myMap);
EMAIL SKU Below Min 9803778880 GEODIS_WHS_FR_SOCHAUX adriana.velasquez@geodis.com,
			myService.sendMessage(myConverted);
/s
MessageServiceImpl.sendMessage(ConvertedMessage) line: 384	
message=
EMAIL SKU Below Min 9803778880 GEODIS_WHS_FR_SOCHAUX adriana.velasquez@geodis.com,

		switch (aMessage.getType()) {
				try {
					String[] myAddrList = { aMessage.getToAddress(), aMessage.getCcAddress(), aMessage.getBccAddress(), aMessage.getReplyToAddress(), aMessage.getFromAddress() };
[adriana.velasquez@geodis.com, fanny.garnier.ext@geodis.com, bruno.perez@geodis.com, daniel.maufroy@geodis.com,, null, null, null, no-reply@mp-objects.com]
					MailUtil.sendEmailMessage(aMessage.getSubject(), aMessage.getBody(), myAddrList, aMessage.getAttachments());
/s
MailUtil.sendEmailMessage(String, String, String[], Collection<Attachment>) line: 90	
		String myToList = anAddressList[0];
		String myCcList = anAddressList[1];
		String myBccList = anAddressList[2];
		String myReplyToList = anAddressList[3];
		String myFromAddr = anAddressList[4];

		String myFromUserProperty = ApplicationPropertyManager.getInstance().getModuleProperty("mail", "from.user", "no-reply@mp-objects.com");
		MailMessage myMailMessage = new MailMessage();

		// Subject
		myMailMessage.setSubject(aSubject);

		// Body
		myMailMessage.setBodyText(aMailContent + "\n\n");

		myMailMessage.addToRecipient(myToList);
		myMailMessage.addCcRecipient(myCcList);
		myMailMessage.addBccRecipient(myBccList);
		myMailMessage.addReplyTo(myReplyToList);

		if (anAttachmentList != null) {
			for (Attachment myAttachment : anAttachmentList) {
/ GEEN
		if (!StringUtils.isEmpty(myFromAddr)) {
			// If from addr is set use this one
			myMailMessage.setSendFrom(new InternetAddress(myFromAddr));
		// Do the send!
		MailUtil.getMailService().send(myMailMessage);

/ 13	. 

module.core.emailservice.server.host=smtp.internal.mp-objects.com
module.core.emailservice.destination.override.development=eric.vandervelden@mpobjects.com

/ De override property zorgt ervoor dat de email NIET naar adriana.velasquez@geodis.com gaat	, maar naar eric.vandervelden@mpobjects.com

/ EInde RECEIVER SIDE



/ Einde DEBUG PSA-267 FORECAST_OUT FINAL

/ PSA-267 INVENTORY REPORT 

/ We zagen dat de st tx die van de forecast_out op 1jul  op product 9803778880 kwan	, op 23:59:00 is	, 
/ TODO
/ we maken daarom een inv rep op 2 juli	, 

/ 2500 < min	,

$ vi InventoryReport/archive/2016-06/15/my-INVRPT-p.xml

     <mtc:STOCK_TRANSACTION_GROUP>
         <mtc:PROCESSING_DETAILS>
            <mtccore:PURPOSE_CODE>05</mtccore:PURPOSE_CODE>
         </mtc:PROCESSING_DETAILS>
         <mtc:STOCK_TRANSACTION>
            <mtc:QUANTITY>2500</mtc:QUANTITY>
            <mtc:ABSOLUTE/>
            <mtc:SERIAL_NUMBER/>
            <mtc:LOT_ID/>
            <mtc:TRANSACTION_DATE>2016-07-02T11:49:29Z</mtc:TRANSACTION_DATE>
            <mtc:PRODUCT_ID>9803778880</mtc:PRODUCT_ID>
            <mtc:GOODS_STATUS>GOOD</mtc:GOODS_STATUS>
            <mtc:LOCATION>GEODIS_WHS_FR_SOCHAUX</mtc:LOCATION>
            <mtc:EXTERNAL_ID>1150-2016-07-02T11:48:29Z</mtc:EXTERNAL_ID>
            <mtc:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtc:ORGANIZATION_ID>
         </mtc:STOCK_TRANSACTION>
      </mtc:STOCK_TRANSACTION_GROUP>

public class StockLevelCalculationServiceImpl implements StockLevelCalculationService {
	private boolean recalculate(StockTransaction aTransaction) {
		boolean myLevelChange = false;
		BigDecimal myLastKnownBalance = null;
		aTransaction.setDirty(false);
		if (aTransaction.getTransactionType().equals(StockTransactionType.COUNT)) {
			aTransaction.setCalculatedStockLevel(aTransaction.getQuantity());
			myLastKnownBalance = aTransaction.getQuantity();
->			myLevelChange = true;
/ FIX PSA-267

/ we hebben ook used	,
InventoryReport/archive/2016-06/15/my-INVRPT-p.xml

/ EInde DEBUG PSA-267 INVENTORY REPORT 

/ PSA-267


/ Voor 2016.03 release	,
$ geosco-pg_dump-p.sh 
# create database geosco0630p
$ find /home/eric/DB_TAP/Postgres/Backup/ -type f | grep geosco | xargs ls -1tr | awk 'END{print}' | xargs -I % local-pg_restore.sh geosco0630p %




/ 7	. 

/ emails to acceptance,	 test	, 

https://groups.google.com/a/mp-objects.com/forum/?hl=en-GB#!forum/mposcs


/ Einde PSA-267

/ POSTGRES 

/ tablespaces	,

[root@localhost lib]# find -maxdepth 1 -type d | grep pgsql | xargs ls -ld
drwx------. 4 postgres postgres 4096 Jul 14  2015 ./pgsql

[eric@localhost Postgres]$ pwd
/home/eric/DB_TAP/Postgres
[eric@localhost Postgres]$ mkdir data

[root@localhost pgsql]# chown postgres /home/eric/DB_TAP/Postgres/data/
[root@localhost pgsql]# chgrp postgres /home/eric/DB_TAP/Postgres/data/
[root@localhost pgsql]# chmod go-rxw /home/eric/DB_TAP/Postgres/data
[eric@localhost Postgres]$ ls -l
drwx------. 2 postgres postgres 4096 Jul  1 10:10 data

/ we deden	,
foo=> select*from pg_indexes;
 schemaname |        tablename        |                indexname                | tablespace |                           
                                  indexdef                                                             
------------+-------------------------+-----------------------------------------+------------+---------------------------
-------------------------------------------------------------------------------------------------------
 public     | x2ref                   | x2ref_pkey                              | NULL       | CREATE UNIQUE INDEX x2ref_
pkey ON x2ref USING btree (i)
 pg_catalog | pg_authid               | pg_authid_rolname_index                 | pg_global  | CREATE UNIQUE INDEX pg_aut
hid_rolname_index ON pg_authid USING btree (rolname)
...

foo=>  select*from pg_tablespace;
  spcname   | spcowner | spcacl | spcoptions 
------------+----------+--------+------------
 pg_default |       10 | NULL   | NULL
 pg_global  |       10 | NULL   | NULL
(2 rows)

/ Lees	,
http://dba.stackexchange.com/questions/9603/postgresql-query-for-location-of-global-tablespace/9628

/ Do as superuser , mpopostgres	, NOT eric	,

/ pg_default lives in	,
geosco0630p=# select setting||'/base' from pg_settings where name='data_directory';
         ?column?         
--------------------------
 /var/lib/pgsql/data/base
(1 row)

/ pg_global lives in	,
geosco0630p=# select setting||'/global' from pg_settings where name='data_directory';
          ?column?          
----------------------------
 /var/lib/pgsql/data/global
(1 row)

geosco0630p=# show data_directory;
   data_directory    
---------------------
 /var/lib/pgsql/data
(1 row)

geosco0630p=# create tablespace scs location '/home/eric/DB_TAP/Postgres/data';
CREATE TABLESPACE

eosco0630p=# select*from pg_tablespace;
  spcname   | spcowner | spcacl | spcoptions 
------------+----------+--------+------------
 pg_default |       10 | NULL   | NULL
 pg_global  |       10 | NULL   | NULL
 scs        |    16384 | NULL   | NULL
(3 rows)
/ of	,
irst=# \db
                    List of tablespaces
    Name    |    Owner    |            Location             
------------+-------------+---------------------------------
 pg_default | postgres    | 
 pg_global  | postgres    | 
 scs        | mpopostgres | /home/eric/DB_TAP/Postgres/data
(3 rows)

geosco0630p=# create database first tablespace scs;
CREATE DATABASE
[root@localhost data]# ls /home/eric/DB_TAP/Postgres/data/
PG_9.3_201306121

geosco0630p=# \l+
                                                                        List of databases
      Name      |    Owner    | Encoding |   Collate   |    Ctype    |   Access privileges   |  Size   | Tablespace |    
            Description                 
----------------+-------------+----------+-------------+-------------+-----------------------+---------+------------+----
----------------------------------------
 first          | mpopostgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 |                       | 6481 kB | scs        | 
 foo            | foo         | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =Tc/foo              +| 98 MB   | pg_default | 
                |             |          |             |             | foo=CTc/foo          +|         |            | 
                |             |          |             |             | bar=CTc/foo           |         |            | 

/ Inderdaad	, we zien de tablespace	, 
sco0630p=# \c first
You are now connected to database "first" as user "mpopostgres".
first=# create table a(i int,s varchar(32));
CREATE TABLE
first=# insert into a values(7,'johannes');
INSERT 0 1
first=# commit;
COMMIT
first=# select*from a;
 i |    s     
---+----------
 7 | johannes
(1 row)

/ 13	. 

/ we lezen op 
https://www.postgresql.org/docs/9.1/static/manage-ag-tablespaces.html
Two tablespaces are automatically created when the database cluster is initialized. The pg_global tablespace is used for shared system catalogs. The pg_default tablespace is the default tablespace of the template1 and template0 databases (and, therefore, will be the default tablespace for other databases as well, unless overridden by a TABLESPACE clause in CREATE DATABASE).

/ 13	. 

/ een database name is uniek, over alle tablespaces heen	,

foo=# drop database first;
DROP DATABASE

foo=# create database first;
CREATE DATABASE
foo=# create database first tablespace scs;
ERROR:  database "first" already exists

/ 13	. 

/ Als mpopostgres is \c met foo	, en	,
foo=# create table aa(i int) tablespace scs;
/ dan is table aa in db foo	, maar op tablespace scs	,

foo=# select * from pg_tables where tablename='aa';
 schemaname | tablename | tableowner  | tablespace | hasindexes | hasrules | hastriggers 
------------+-----------+-------------+------------+------------+----------+-------------
 public     | aa        | mpopostgres | scs        | f          | f        | f
(1 row)

/ 13	. 

/ Als eric	,
foo=> create table aa(i int) tablespace scs;
ERROR:  permission denied for tablespace scs
/ we moeten permissions set voor de tablespace scs	, 
/ TODO
/ Met grant	
/ TODO
/ Lees	,
https://www.postgresql.org/docs/8.4/static/sql-grant.html
/ TODO

/ 7	. 

[eric@localhost bin]$ pnl-db-dump-p.sh pnllogistics
foo=# create database pnllogistics0701p tablespace scs;
CREATE DATABASE
[eric@localhost bin]$ find /home/eric/DB_TAP/Postgres/Backup/ -type f | grep pnllogistics-p  | xargs ls -1tr | awk 'END{print}' | xargs -I % local-pg_restore.sh pnllogistics0701p %
...
WARNING: errors ignored on restore: 782

[eric@localhost bin]$ pnl-db-dump-t.sh pnllogistics
pnllogistics0701p=# create database pnllogistics0701t tablespace scs;
CREATE DATABASE
[eric@localhost bin]$ find /home/eric/DB_TAP/Postgres/Backup/ -type f  | grep pnllogistics-t | xargs ls -1tr | awk 'END{print}' | xargs -I % local-pg_restore.sh pnllogistics0701t %

/ Lees LOG_ERRs_pg_restore.txt


/ Einde POSTGRES 

/ 7	. 

gistics0701p=# explain select *from shipment_order;
                                QUERY PLAN                                
--------------------------------------------------------------------------
 Seq Scan on shipment_order  (cost=0.00..23873.16 rows=219216 width=4593)
(1 row)
estimated start-up cost=0	,
estimated total cost=458	,
estimated number of rows=215216
estimated width=4593

 



/ find werkt niet in /home/jboss/releases	, 
/ Niet in links	, 
/ TODO

/ find in current 

/ find of current dir, of sub dir's geeft relative path, niet hele path	,
/ doe	,
[eric@localhost wicket]$ pwd | xargs -I % find % -type f
/ dan hele path	, 
/ Lees	,
http://stackoverflow.com/questions/9620050/list-all-files-with-full-paths-in-a-directory-and-subdirectories-order-by-a

 /we doen daarom	,
jboss@mposerv11:~$ find /local/apps/releases/ -type f | grep mpo | xargs ls -1tr | awk 'END{print}'| xargs -I % echo deploy-mpo.sh % /local/apps/jboss-4.0.5.GA/server/mpo

[eric@localhost tmp]$ pwd | xargs -I % find % -maxdepth 1 | grep mpo | xargs ls -1tr | awk 'END{print}' | xargs -I %  scp % vanderveldene@application-a.intermax.mp-objects.com:Downloads
tms-mpo-23716-2016.01_build4260.zip                                                                      100%   37MB   1.8MB/s   00:21    

/ op application-a	,
[jboss@application-a releases]$ find /local/apps/releases -type f | grep mpo  | xargs ls -1tr | awk 'END{print}'  | xargs -I %  ~/bin/deploy-mpo.sh  % /local/apps/jboss-4.0.5.GA/server/mpo



/ Einde MPO-322

/ MPO-326

[eric@localhost tmp]$ ssh eric@mposerv11 "find /local/apps/releases | grep mpo | xargs ls -1tr | awk 'END{print}'" 2>/dev/null | xargs -I % scp eric@mposerv11:% . 2>/dev/null
tms-mpo-23716-2016.01_build4260.zip                                                                      100%   37MB  37.0MB/s   00:01    

/ 7	. 

/ Deoloy	, 

2016-07-04 10:59:04,320 INFO  [com.mpobjects.dbpatch.DataBasePatcher] (main:) Executing patch [oms/patch-522-fix-consignment-float$postgresql.sql] ...
2016-07-04 10:59:04,341 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) Problem while executing SQL statement in patch [oms/patch-522-fix-consignment-float$postgresql.sql]: 
2016-07-04 10:59:04,341 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) ALTER TABLE CONSIGNMENT ADD TOTAL_LDM_D DECIMAL(15,5)
2016-07-04 10:59:04,341 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) org.postgresql.util.PSQLException: ERROR: column "total_ldm_d" of relation "consignment" already exists
2016-07-04 10:59:04,347 ERROR [com.mpobjects.dbpatch.DatabasePatchService] (main:) Error while patching database

/ we doen de patch met de hand	, 

[eric@localhost 2016.01]$ less ./module/oms/src/sql/patch/patch-522-fix-consignment-float\$postgresql.sql
DROP VIEW IF EXISTS RPT_CONSIGNMENTS;
/ Al	,

ALTER TABLE CONSIGNMENT ADD TOTAL_LDM_D DECIMAL(15,5);
/ Overslaan	,

ALTER TABLE CONSIGNMENT ADD TOTAL_VOLUME_D DECIMAL(15,5);
/ Overslaan	,

UPDATE CONSIGNMENT SET TOTAL_LDM_D = TOTAL_LDM, TOTAL_VOLUME_D = TOTAL_VOLUME;
/ Met de hand	,

ALTER TABLE CONSIGNMENT DROP TOTAL_LDM;
/ ERR	,
mpo=# ALTER TABLE CONSIGNMENT DROP TOTAL_LDM;
ERROR:  cannot drop table consignment column total_ldm because other objects depend on it
DETAIL:  view neec depends on table consignment column total_ldm

$ vi ./mpo/mpo/src/sql/patch/patch-002-neecview\$postgresql.sql
...
/ def view neec

mpo=# drop view neec;
DROP VIEW

mpo=# ALTER TABLE CONSIGNMENT DROP TOTAL_LDM;
ALTER TABLE
/ Nu OK	,
ALTER TABLE CONSIGNMENT RENAME TOTAL_LDM_D TO TOTAL_LDM;

/ we herstellen view neec	, 
$ cat ./mpo/mpo/src/sql/patch/patch-002-neecview\$postgresql.sql
...
=# create view NEEC as
...
CREATE VIEW
/ OK

[eric@localhost 2016.01]$ cat  ./module/oms/src/sql/patch/patch-522-fix-consignment-float\$postgresql.sql
mpo=# CREATE VIEW RPT_CONSIGNMENTS (SYSTEM_ID,
...
CREATE VIEW
/ OK

mpo=# commit;
COMMIT

mpo=# update mpo_scs_patch set status='MANUALLY_APPLIED' where name='patch-522-fix-consignment-float$postgresql.sql';
;
UPDATE 1
mpo=# commit;
COMMIT


/ we moeten jar's overhalen	,

[eric@localhost lib]$ mpo-ssh-a.sh cat  /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log | awk '/MISSING/ && /Summary/ && /MUST_BE_REMOVED/'2016-07-04 11:57:19,793 ERROR [com.mpobjects.libcheck.LibCheckService] (main:) Summary: 	CHECKSUM_MISMATCH=0	MISSING=23	MUST_BE_REMOVED=5	OK=266
[eric@localhost lib]$ mpo-ssh-a.sh cat  /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log | awk '/MISSING/ && !/Summary/{count++}END{print count}'
23
[eric@localhost lib]$ mpo-ssh-a.sh cat  /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log | awk '/MUST_BE_REMOVED/ && !/Summary/{count++}END{print count}'
5

set +H.
/ TODO

[eric@localhost lib]$ mpo-ssh-a.sh cat  /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log | awk '/MUST_BE_REMOVED/ && !/Summary/{print $NF}'
bcprov-jdk15on-1.52.jar
opensaml-2.6.1.jar
openws-1.5.1.jar
xmlsec-1.5.6.jar
xmltooling-1.4.1.jar

[eric@localhost lib]$ mpo-ssh-a.sh cat  /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log | awk '/MUST_BE_REMOVED/ && !/Summary/{print $NF}' | awk '{printf $0 OFS}END{print}'
bcprov-jdk15on-1.52.jar opensaml-2.6.1.jar openws-1.5.1.jar xmlsec-1.5.6.jar xmltooling-1.4.1.jar xmltooling-1.4.1.jar
/ Voor op de command line	, 
/ ERR ( de laatste 2 keer)	
/ TODO AWK ( we moeten een newline geven )

[eric@localhost tmp]$ mpo-ssh-a.sh cat /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log | awk '/MISSING/ && !/Summary/{print $NF}'
/ of	,
[eric@localhost tmp]$  mpo-ssh-a.sh cat /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log | awk '/MISSING/ && !/Summary/{print $NF;count++}END{print count}'
barcode4j-2.1.jar
batik-anim-1.7.jar
batik-awt-util-1.7.jar
batik-bridge-1.7.jar
batik-css-1.7.jar
batik-dom-1.7.jar
batik-ext-1.7.jar
batik-gvt-1.7.jar
batik-parser-1.7.jar
batik-script-1.7.jar
batik-svg-dom-1.7.jar
batik-svggen-1.7.jar
batik-util-1.7.jar
batik-xml-1.7.jar
bcprov-jdk15on-1.53.jar
jericho-html-3.3.jar
opensaml-2.6.4.jar
openws-1.5.4.jar
wicket-ioc-1.4.23.jar
wicket-spring-1.4.23.jar
xml-apis-ext-1.3.04.jar
xmlsec-1.5.7.jar
xmltooling-1.4.4.jar
23

[eric@localhost tmp]$ mpo-ssh-a.sh "cat /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log | awk '/MISSING/ && "'!'"/Summary/{print \$NF}'" 
/ of	,
[eric@localhost tmp]$ mpo-ssh-a.sh "cat /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log | awk '/MISSING/ && "'!'"/Summary/{print \$NF;count++}END{print count}'"
23

/ Deze gaat veel sneller	,
/ TODO MICHEL
/ we hebben $ escape met \ , ! door uit de "" te gaan	, en '!' te doen, en een "" er weer achter te set	,
/ TODO BASH

/ 7	. 

[eric@localhost tmp]$ mpo-ssh-a.sh "cat /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log | awk '/MISSING/ && "'!'"/Summary/{print \$NF}'" | xargs ls -1tr
/ TODO BASH

/ workaround	,

[eric@localhost tmp]$ mpo-ssh-a.sh "cat /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log | awk '/MISSING/ && "'!'"/Summary/{print \$NF}'" >/tmp/jars
[eric@localhost lib]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/geosco/lib
[eric@localhost lib]$ cat /tmp/jars | xargs ls -1tr | awk '{count++}END{print count}'
23
/ Dus ze zijn er allemaal	,

[eric@localhost lib]$ mpo-ssh-a.sh "mkdir  Downloads/2016-07-04"

/ 13	. 

alhost lib]$ cat /tmp/jars | xargs ls -1tr  | xargs -I % echo scp % vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp batik-bridge-1.7.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp batik-awt-util-1.7.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp batik-anim-1.7.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp barcode4j-2.1.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp batik-gvt-1.7.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp batik-ext-1.7.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp batik-dom-1.7.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp batik-css-1.7.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp batik-util-1.7.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp batik-svggen-1.7.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp batik-svg-dom-1.7.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp batik-script-1.7.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp batik-parser-1.7.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp bcprov-jdk15on-1.53.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp batik-xml-1.7.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp jericho-html-3.3.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp opensaml-2.6.4.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp openws-1.5.4.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp xmlsec-1.5.7.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp xmltooling-1.4.4.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp wicket-spring-1.4.23.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp wicket-ioc-1.4.23.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp xml-apis-ext-1.3.04.jar vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04

[eric@localhost lib]$ cat /tmp/jars | xargs ls -1tr  | xargs -I % scp % vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04batik-bridge-1.7.jar                
/ OK

/ 13	. 

[eric@localhost lib]$ cat /tmp/jars | xargs ls -1tr  | awk '{printf $0" "}' | xargs -I % echo scp % vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
scp batik-bridge-1.7.jar batik-awt-util-1.7.jar batik-anim-1.7.jar barcode4j-2.1.jar batik-gvt-1.7.jar batik-ext-1.7.jar batik-dom-1.7.jar batik-css-1.7.jar batik-util-1.7.jar batik-svggen-1.7.jar batik-svg-dom-1.7.jar batik-script-1.7.jar batik-parser-1.7.jar bcprov-jdk15on-1.53.jar batik-xml-1.7.jar jericho-html-3.3.jar opensaml-2.6.4.jar openws-1.5.4.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar wicket-spring-1.4.23.jar wicket-ioc-1.4.23.jar xml-apis-ext-1.3.04.jar  vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04

[eric@localhost lib]$ cat /tmp/jars | xargs ls -1tr  | awk '{printf $0 OFS}' | xargs -I % scp % vanderveldene@application-a.intermax.mp-objects.com:Downloads/2016-07-04
batik-bridge-1.7.jar batik-awt-util-1.7.jar batik-anim-1.7.jar barcode4j-2.1.jar batik-gvt-1.7.jar batik-ext-1.7.jar batik-dom-1.7.jar batik-css-1.7.jar batik-util-1.7.jar batik-svggen-1.7.jar batik-svg-dom-1.7.jar batik-script-1.7.jar batik-parser-1.7.jar bcprov-jdk15on-1.53.jar batik-xml-1.7.jar jericho-html-3.3.jar opensaml-2.6.4.jar openws-1.5.4.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar wicket-spring-1.4.23.jar wicket-ioc-1.4.23.jar xml-apis-ext-1.3.04.jar : File name too long
/ TODO BASH (Hoe meerdere files . of ziet hij net als boven het als 1 file met spaces in de name)


/ Einde MPO-326

/ PCT-576

[eric@localhost tmp]$ geosco-ssh-t.sh 2>/dev/null "find /local/apps/releases -type f | grep geosco | xargs ls -1tr" | awk 'END{print}' | xargs -I % scp vanderveldene@geosco-app-t.intermax.mp-objects.com:% .
[eric@localhost tmp]$ pwd | xargs -I % find % -type f | grep geosco | xargs ls -1tr | awk 'END{print}' | xargs -I % scp % vanderveldene@geosco-app-a.intermax.mp-objects.com:Downloads



/ Einde PCT-576


/ BASH

/ 7	. 

/ Alternative for scp

http://www.commandlinefu.com/commands/view/7789/copy-a-file-over-ssh-without-scp
http://intermediatesql.com/linux/scrap-the-scp-how-to-copy-data-fast-using-pigz-and-nc/

/ Einde BASH

/ SCS-4970

/ 7. 	

/ Hoe makan we een sho uit een template	, of XML	?

[eric@localhost LOGS]$ grep SHIPMENT -r * | grep ORDER | grep ' CREATE '
LOG_23_jul_2015.txt:  26684154 |          0 | OptieSoort            | LIST       | SHIPMENT_ORDER |                   500 | CREATE    |        |    7 |        0 |  
LOG_23_jul_2015.txt:  26684154 |          0 | OptieSoort            | LIST       | SHIPMENT_ORDER |                   500 | CREATE    |        |    7 |        0 |  
LOG_23_jul_2015.txt:/ See ook CREATE SHIPMENT ORDER 
LOG_23_jul_2015.txt:/ SAMENVATTING CREATE SHIPMENTORDER
LOG_23_jul_2015.txt:/ Einde SAMENVATTING CREATE SHIPMENTORDER
LOG_23_jul_2015.txt:/ DEBUG CREATE SHIPMENT ORDER
LOG_23_jul_2015.txt:  26684154 |          0 | OptieSoort          | LIST       | SHIPMENT_ORDER |                   500 | CREATE    |        |    7 |   
LOG_23_jul_2015.txt:/ Einde DEBUG CREATE SHIPMENT ORDER
LOG_29_sep_2015.txt:/ CREATE SHIPMENT ORDER FROM XML	,
LOG_29_sep_2015.txt:/ CREATE SHIPMENT ORDER FROM XML	,
LOG_29_sep_2015.txt:/ HOW TO CREATE SHIPMENT ORDER
LOG_29_sep_2015.txt:/ CREATE SHIPMENT ORDER
LOG_29_sep_2015.txt:/ Einde CREATE SHIPMENT ORDER
LOG_29_sep_2015.txt.bak.29.06.16:/ CREATE SHIPMENT ORDER FROM XML	,
LOG_29_sep_2015.txt.bak.29.06.16:/ CREATE SHIPMENT ORDER FROM XML	,
LOG_29_sep_2015.txt.bak.29.06.16:/ HOW TO CREATE SHIPMENT ORDER
LOG_29_sep_2015.txt.bak.29.06.16:/ CREATE SHIPMENT ORDER
LOG_29_sep_2015.txt.bak.29.06.16:/ Einde CREATE SHIPMENT ORDER
LOG_6_OCT_2014.txt:/ See STACKTRACE SHIPMENT ORDER CREATE FROM INTERFACE 
LOG_8_sep_2015.txt:/ see SAMENVATTING CREATE SHIPMENTORDER	, LOG_23_jul_2015.txt	,
LOG_8_sep_2015.txt:/ see SAMENVATTING CREATE SHIPMENTORDER	, LOG_23_jul_2015.txt	,
LOG_sho.txt:/ CREATE SHIPMENTORDER
LOG_sho.txt:/ Einde CREATE SHIPMENTORDER

/ Lees LOG_29_sep_2015.txt	, 

/ HOW TO CREATE SHIPMENT ORDER
/ local ,
/ Kijk in RETURN_LABEL party group, 9105522 zit er niet in      ,
/ we maken sho SH000131483      , 
/ we kiezen  sho tpl name : pharma      ,
/ we moeten
requested productcode: 3606
customer reference: test pct-1234                       / bijv  ,
ship_from       :       2910-3--BE
ship_to         :       4231DJ-118--NL
bill_to         :       9105522
Save
/ we hebben create SH000138137,	
/ We zien COLLO_HOLD	,

package com.mpobjects.control.action;


package com.mpobjects.oms.control.shipmentorder.action;
class ShipmentOrderEditAction

			ShipmentOrderVO myVO = null;
			myVO = MpoBeanFactory.getBean(ShipmentOrderDao.class).getBySystemId(mySystemId);
			getRequest().setAttribute("formVO", myVO);

$ vi shipment-order_edit.jsp

	<mpo:setFormVO valueObject="${formVO}">
			<mpo:listField 
				name="holdStatus" 
				type="holdStatus" 
				infoVisible="${formVO.dateSetVO.holdRelease!=null}" 
				infoValue="${cf:formatDateTime(formVO.dateSetVO.holdRelease)}" 
				readOnly="${!holdStatusEditable}" />
/s

ListFieldTag(FieldTag).doEndTag() line: 286	
			if (StringUtils.isNotEmpty(myInfoValue) && isInfoVisible()) {
				myRet.append("<a href=\"#\" class=\"hintanchor\" onMouseOver=\"showhint(\'" + myInfoValue
						+ "\', this, event,'')\" ><img src=\"../lookandfeel/styles/images/icons/info.gif\" border=\"0\" /></a>");

/ we zien in de <mpo:listField/> tag	, dat infoVisible="${formVO.dateSetVO.holdRelease!=null}"==false	, want want holdRelease is helemaal niet mapped. 
/ In shipment_order table is er de column hold_release_dtm. Ik weet niet wat dit is , maar ook deze is niet mapped	, 
/ Als we de isInfoVisible() test rm	, dan krijgen we	,
The hold release date was: <b>[1]</b>
/ De [1] is niet vervangen	,


/ we unplan SH000138137, 
/ we rm de shi	, 
/ save sho	,
/ create shi
/ save shi	, we debug deze	, 
/ NB. We hebben COLLO_HOLD NIET rm	, dus blijft deze staan	, doe eigenlijk overnieuw	,
/s
ListFieldTag.appendInputPart(StringBuffer) line: 415	
				UniqueFieldValueObject mySourceVO = VOReflectionInvoker.getValueAsUniqueVO(getActiveValueObject(), name);

"getActiveValueObject()"	 (id=22497)			 			<- ShipmentOrder: SH000138137(SystemId:27139264; Org:PNL-CARGO)
	handler	JavassistLazyInitializer  (id=22506)	
		target	ShipmentOrderVO  (id=22877)	
			theDateSetVO	DateSetVO  (id=22898)	
				createdDate	Timestamp  (id=22906)	
				estimatedEndAfter	null	
				estimatedEndBefore	null	
				estimatedStartAfter	null	
				estimatedStartBefore	null	
				performanceMonitorService	null	
				systemId	0	
				theActualEnd	null	
				theActualRelease	null	
				theActualStart	null	
				theCloseDate	null	
				theHoldRelease	null						<-
				theOrigPlannedEndAfter	null	
				theOrigPlannedEndBefore	null	
				theOrigPlannedStartAfter	null	
				theOrigPlannedStartBefore	null	
				thePlannedEndAfter	null	
				thePlannedEndBefore	null	
				thePlannedRelease	null	
				thePlannedStartAfter	null	
				thePlannedStartBefore	null	
				theRequestedEndAfter	Date  (id=22907)	
				theRequestedEndBefore	Date  (id=22908)	
				theRequestedStartAfter	Date  (id=22909)	
				theRequestedStartBefore	Date  (id=22910)	
			theHoldDescription	"" (id=22901)	
			theHoldStatus	HoldStatus  (id=22493)			<- COLLO_HOLD	

mySourceVO	HoldStatus  (id=22493)	
	code	"COLLO_HOLD" (id=22495)	

				if (mySourceVO != null) {
					myValue = mySourceVO.getCode();
/c
ListFieldTag(FieldTag).doEndTag() line: 280	
			String myInfoValue = getInfoValue();
/s
ListFieldTag(FieldTag).getInfoValue() line: 434	
		if (StringUtils.isNotEmpty(infoValue)) {
/ NEE
infoValue=""
/ Dus blijft theInfoValueMap leeg	,

		myRet = getLanguageManager().getInfoValue(getModule() + "." + getFieldOwner().getEntity().toLowerCase() + "." + getName() + ".info", theInfoValueMap);
The hold release date was: <b>[1]</b>

getModule() + "." + getFieldOwner().getEntity().toLowerCase() + "." + getName() + ".info"
/=
oms.shipmentorder.holdStatus.info
$ vi language_en.properties
oms.shipmentorder.holdstatus.info   =The hold release date was\: <b>[1]</b>
/ LanguageManager.getInfoValue replaces [1]	, als er een value is	,

/t
ListFieldTag(FieldTag).doEndTag() line: 288	
			// info generated
			String myInfoValue = getInfoValue();
/d
The hold release date was: <b>[1]</b>

			// Check for visibility and non empty language-file
			if (StringUtils.isNotEmpty(myInfoValue)) {// && isInfoVisible()) {
				// TODO: generate html with css classes, which adds javascript behaviour via the 'onload' hook
				myRet.append("<a href=\"#\" class=\"hintanchor\" onMouseOver=\"showhint(\'" + myInfoValue
						+ "\', this, event,'')\" ><img src=\"../lookandfeel/styles/images/icons/info.gif\" border=\"0\" /></a>");
			if (showFieldContext()) {
				appendInputPartPostfix(myRet);
myRet=
<a href="#" class="hintanchor" onMouseOver="showhint('The hold release date was: <b>[1]</b>', this, event,'')" ><img src="../lookandfeel/styles/images/icons/info.gif" border="0" /></a></span></td>

/ 13	. 

pnllogistics0701p=# select column_name from information_schema.columns
where table_name='shipment_order'
and column_name like '%hold%'; 
       column_name       
-------------------------
 hold_status_systemid
 hold_status_description
 hold_release_dtm
(3 rows)


/ Einde SCS-4970

/ PCT-1500

[eric@localhost tmp]$ svn ls https://system.mp-objects.com/svn/reports/trunk/pnllogistics

/ Gebruike we NIET	,
/ zoek file zonder path	, 
[eric@localhost pnllogistics]$ find  -type f -exec basename {} \; | grep "^received" | grep "jrxml$"
received_events_by_shipment_order.jrxml


[eric@localhost eclipse-jee]$ mkdir workspace-reports
[eric@localhost eclipse-jee]$ cd workspace-reports/
[eric@localhost workspace-reports]$ svn co https://system.mp-objects.com/svn/reports/trunk
[eric@localhost workspace-reports]$ find  ../workspace/pnllogistics/ -type f -name "received*jrxml" | xargs -I % echo cp % trunk/pnllogistics/
[eric@localhost workspace-reports]$ svn add pnllogistics/received_events_by_shipment_order.jrxml 				<-
[eric@localhost workspace-reports]$ find  -type f -name "received*jrxml" | xargs echo svn commit -m "PCT-1500" 
Transmitting file data .
Committed revision 155.


[eric@localhost workspace-reports]$ cp ./trunk/pnllogistics/received_events_by_shipment_order.jrxml ~/tmp
[eric@localhost workspace-reports]$ mv ~/tmp/received_events_by_shipment_order.jrxml ~/tmp/received_events_by_shipment_order-155.jrxml 
/ TODO BASH (hoe program)
/ Jira	,
more, Attach files	,

/ 7	. 

/ we run de query	,

eric@localhost sql]$ pwd
/home/eric/DB_TAP/Postgres/sql
$ PGPASSWORD=mpopostgres@mpo psql  -U  mpopostgres pnllogistics0701p  

/ Intermezzo

select min(sho.system_entry_date)
from shipment_order sho;
           min           
-------------------------
 2015-04-20 12:16:30.398
(1 row)

pnllogistics0701p=# select max(sho.system_entry_date)
from shipment_order sho;
           max           
-------------------------
 2016-06-30 09:43:20.102
(1 row)

/ Einde Intermezzo

[eric@localhost tmp]$ vi received_events_by_shipment_order.jrxml 
    <parameter name="STARTING_DATE" class="java.sql.Timestamp" isForPrompting="false">
        <defaultValueExpression><![CDATA["2008-01-01 00:00:01"]]></defaultValueExpression>
    </parameter>
    <parameter name="ENDING_DATE" class="java.sql.Timestamp" isForPrompting="false">
        <defaultValueExpression><![CDATA["2010-08-02 00:00:00"]]></defaultValueExpression>
    </parameter>
    <parameter name="CARRIER_ID" class="java.lang.String" isForPrompting="false">
        <defaultValueExpression><![CDATA["%"]]></defaultValueExpression>
    </parameter>
    <parameter name="ORGANIZATION_LIST" class="java.lang.String" isForPrompting="false">
        <defaultValueExpression><![CDATA["(1000,2000)"]]></defaultValueExpression>
    </parameter>
    <queryString>
        <![CDATA[SELECT
    distinct o.ORGANIZATION_ID,
...
WHERE
    sho.system_entry_date >= $P{STARTING_DATE} and
    sho.system_entry_date < $P{ENDING_DATE} and
    o.system_id in ($P!{ORGANIZATION_LIST}) and
    p.party_id like $P{CARRIER_ID}

/ we zien de default values voor STARTING_DATE erboven	,
/ maar deze zijn heel oud	, en we laten ze weg	,

[eric@localhost sql]$ pwd
/home/eric/DB_TAP/Postgres/sql
[eric@localhost sql]$ PGPASSWORD=mpopostgres@mpo psql  -U  mpopostgres -d pnllogistics0701p  -f received_events_by_shipment_order.sql 



/ Einde PCT-1500

/ POSTGRES

/ 13	. 

pnllogistics0701p=# \dt information_schema.*
                        List of relations
       Schema       |          Name           | Type  |  Owner   
--------------------+-------------------------+-------+----------
 information_schema | sql_features            | table | postgres
 information_schema | sql_implementation_info | table | postgres
 information_schema | sql_languages           | table | postgres
 information_schema | sql_packages            | table | postgres
 information_schema | sql_parts               | table | postgres
 information_schema | sql_sizing              | table | postgres
 information_schema | sql_sizing_profiles     | table | postgres
(7 rows)

pnllogistics0701p=# \dv information_schema.*
                              List of relations
       Schema       |                 Name                  | Type |  Owner   
--------------------+---------------------------------------+------+----------
 information_schema | _pg_foreign_data_wrappers             | view | postgres
 information_schema | _pg_foreign_servers                   | view | postgres
 information_schema | _pg_foreign_table_columns             | view | postgres
 information_schema | _pg_foreign_tables                    | view | postgres
 information_schema | _pg_user_mappings                     | view | postgres
 information_schema | administrable_role_authorizations     | view | postgres
 information_schema | applicable_roles                      | view | postgres
 information_schema | attributes                            | view | postgres
 information_schema | character_sets                        | view | postgres
 information_schema | check_constraint_routine_usage        | view | postgres
 information_schema | check_constraints                     | view | postgres
 information_schema | collation_character_set_applicability | view | postgres
 information_schema | collations                            | view | postgres
 information_schema | column_domain_usage                   | view | postgres
 information_schema | column_options                        | view | postgres
 information_schema | column_privileges                     | view | postgres
 information_schema | column_udt_usage                      | view | postgres
 information_schema | columns                               | view | postgres
 information_schema | constraint_column_usage               | view | postgres
 information_schema | constraint_table_usage                | view | postgres
 information_schema | data_type_privileges                  | view | postgres
 information_schema | domain_constraints                    | view | postgres
 information_schema | domain_udt_usage                      | view | postgres
 information_schema | domains                               | view | postgres
 information_schema | element_types                         | view | postgres
 information_schema | enabled_roles                         | view | postgres
 information_schema | foreign_data_wrapper_options          | view | postgres
 information_schema | foreign_data_wrappers                 | view | postgres
 information_schema | foreign_server_options                | view | postgres
 information_schema | foreign_servers                       | view | postgres
 information_schema | foreign_table_options                 | view | postgres
 information_schema | foreign_tables                        | view | postgres
 information_schema | information_schema_catalog_name       | view | postgres
 information_schema | key_column_usage                      | view | postgres
 information_schema | parameters                            | view | postgres
 information_schema | referential_constraints               | view | postgres
 information_schema | role_column_grants                    | view | postgres
 information_schema | role_routine_grants                   | view | postgres
 information_schema | role_table_grants                     | view | postgres
 information_schema | role_udt_grants                       | view | postgres
 information_schema | role_usage_grants                     | view | postgres
 information_schema | routine_privileges                    | view | postgres
 information_schema | routines                              | view | postgres
 information_schema | schemata                              | view | postgres
 information_schema | sequences                             | view | postgres
 information_schema | table_constraints                     | view | postgres
 information_schema | table_privileges                      | view | postgres
 information_schema | tables                                | view | postgres
 information_schema | triggered_update_columns              | view | postgres
 information_schema | triggers                              | view | postgres
 information_schema | udt_privileges                        | view | postgres
 information_schema | usage_privileges                      | view | postgres
 information_schema | user_defined_types                    | view | postgres
 information_schema | user_mapping_options                  | view | postgres
 information_schema | user_mappings                         | view | postgres
 information_schema | view_column_usage                     | view | postgres
 information_schema | view_routine_usage                    | view | postgres
 information_schema | view_table_usage                      | view | postgres
 information_schema | views                                 | view | postgres
(59 rows)

/ we zien niets over indices	,

/ 13	. 

/ Lees	,
http://stackoverflow.com/questions/2204058/list-columns-with-indexes-in-postgresql
http://www.alberton.info/postgresql_meta_info.html#.V3uVN3WUeV4
https://www.postgresql.org/docs/current/static/catalog-pg-index.html
https://www.postgresql.org/docs/9.1/static/catalogs.html

/ 13	. 

https://www.postgresql.org/docs/9.1/static/catalogs.html

The system catalogs are the place where a relational database management system stores schema metadata, such as information about tables and columns, and internal bookkeeping information. PostgreSQL's system catalogs are regular tables. You can drop and recreate the tables, add columns, insert and update values, and severely mess up your system that way. Normally, one should not change the system catalogs by hand, there are always SQL commands to do that. (For example, CREATE DATABASE inserts a row into the pg_database catalog — and actually creates the database on disk.) There are some exceptions for particularly esoteric operations, such as adding index access methods.

/ 13	. 

pnllogistics0701p=# select*from pg_class where relname='shipment_order';
    relname     | relnamespace | reltype | reloftype | relowner | relam | relfilenode | reltablespace | relpages | reltup
les | relallvisible | reltoastrelid | reltoastidxid | relhasindex | relisshared | relpersistence | relkind | relnatts | r
elchecks | relhasoids | relhaspkey | relhasrules | relhastriggers | relhassubclass | relispopulated | relfrozenxid | relm
inmxid | relacl | reloptions 
----------------+--------------+---------+-----------+----------+-------+-------------+---------------+----------+-------
----+---------------+---------------+---------------+-------------+-------------+----------------+---------+----------+--
---------+------------+------------+-------------+----------------+----------------+----------------+--------------+-----
-------+--------+------------
 shipment_order |         2200 | 2296760 |         0 |    16384 |     0 |     2296758 |             0 |    21681 |    219
216 |             0 |       2296770 |             0 | t           | f           | p              | r       |      214 |  
       0 | f          | t          | f           | t              | f              | t              |       708462 |     
 11722 | NULL   | NULL
(1 row)

pnllogistics0701p=# select*from pg_indexes where tablename='shipment_order';
 schemaname |   tablename    |                   indexname                    | tablespace |                             
                           indexdef                                                         
------------+----------------+------------------------------------------------+------------+-----------------------------
--------------------------------------------------------------------------------------------
 public     | shipment_order | shipment_order_pk                              | NULL       | CREATE UNIQUE INDEX shipment
_order_pk ON shipment_order USING btree (system_id)
 public     | shipment_order | idx_shipment_order1                            | NULL       | CREATE INDEX idx_shipment_or
der1 ON shipment_order USING btree (reference8)
 public     | shipment_order | idx_shipment_order2                            | NULL       | CREATE INDEX idx_shipment_or
der2 ON shipment_order USING btree (actual_arrival)
 public     | shipment_order | idx_shipment_order3                            | NULL       | CREATE INDEX idx_shipment_or
der3 ON shipment_order USING btree (reference4)
...

/ Er ix pg_index en pg_indexes	, 
/ TODO

SELECT
c.relname AS index_name
FROM
pg_class AS a
JOIN pg_index AS b ON (a.oid = b.indrelid)
JOIN pg_class AS c ON (c.oid = b.indexrelid)
WHERE
a.relname = 'shipment_order';
/ TODO

/ TODO( Vind alle columns in een table, waar een index op zit	)	,

/ 7	. 

/ Wordt er een index create als we een primary of foreign key def?
/ JA	, als we een primary key def	, bij foreign key NIET	,

oo=> create table s2(i int);
CREATE TABLE
foo=> create table t2(i int);
CREATE TABLE
foo=> alter table s2 add primary key (i);
ALTER TABLE
foo=> alter table t2 add constraint i_fk foreign key (i) references s2(i);
ALTER TABLE
foo=> commit;
COMMIT
foo=> \d s2;
      Table "public.s2"
 Column |  Type   | Modifiers 
--------+---------+-----------
 i      | integer | not null
Indexes:
    "s2_pkey" PRIMARY KEY, btree (i)
Referenced by:
    TABLE "t2" CONSTRAINT "i_fk" FOREIGN KEY (i) REFERENCES s2(i)

foo=> \d t2;
      Table "public.t2"
 Column |  Type   | Modifiers 
--------+---------+-----------
 i      | integer | 
Foreign-key constraints:
    "i_fk" FOREIGN KEY (i) REFERENCES s2(i)









/ Einde POSTGRES


/ POSTGRES EXPLAIN

/ Lees	,
https://www.postgresql.org/docs/9.3/static/using-explain.html


/ 7	. 

pnllogistics0701p=# select column_name from information_schema.columns
where table_name='shipment_order';





/ 7	. 

/ 13	. 

explain select *from shipment_order;
                                QUERY PLAN                                
--------------------------------------------------------------------------
 Seq Scan on shipment_order  (cost=0.00..23873.16 rows=219216 width=4593)
(1 row)

/ 13	. 

explain select*from shipment_order
where  system_entry_date > now();
                                      QUERY PLAN                                      
--------------------------------------------------------------------------------------
 Index Scan using sho_sed_desc on shipment_order  (cost=0.42..7.58 rows=1 width=4593)
   Index Cond: (system_entry_date > now())
(2 rows)
/ Inderdaad	, er is een index op system_entry_date

/ 13	. 

explain select*from shipment_order
where  to_name = 'foo';
                              QUERY PLAN                              
----------------------------------------------------------------------
 Seq Scan on shipment_order  (cost=0.00..24421.20 rows=10 width=4593)
   Filter: ((to_name)::text = 'foo'::text)
(2 rows)

/ 13	. 

explain select*from shipment_order
where  to_name != null;
                                QUERY PLAN                                 
---------------------------------------------------------------------------
 Result  (cost=0.00..23873.16 rows=1 width=4593)
   One-Time Filter: NULL::boolean
   ->  Seq Scan on shipment_order  (cost=0.00..23873.16 rows=1 width=4593)
(3 rows)
/ TODO



 


/ Einde POSTGRES EXPLAIN

/ POSTGRES SYSTEM TABLES

/ Lees	,
http://www.alberton.info/postgresql_meta_info.html#.V4xmf3WUeV7
https://www.postgresql.org/docs/9.1/static/view-pg-indexes.html



/ Einde POSTGRES SYSTEM TABLES

/ DEPLOY GEOSCO

/ 7	. 

[eric@localhost tmp]$ 2>/dev/null geosco-ssh-t.sh "cd /local/apps/jboss-4.0.5.GA/server/geosco;awk '/MISSING/ && /\.jar/{print \$NF}'  log/server.log"
commons-beanutils-1.9.2.jar
commons-collections-3.2.2.jar
commons-logging-1.2.jar
commons-validator-1.5.1.jar
vt-password-3.1.2.jar

[eric@localhost workspace]$ svn co https://system.mp-objects.com/svn/tms/branches/2016.06

/ copy application.properties	,
[eric@localhost workspace]$ find 2016.03 -name application.properties | xargs ls -1tr | awk 'END{print}' | xargs -I % cp % 2016.06
[eric@localhost workspace]$ find 2016.03 -name .project | xargs ls -1tr | awk 'END{print}' | xargs -I % cp % 2016.06
[eric@localhost workspace]$ find 2016.03 -name '.classpath' | xargs ls -1tr | awk 'END{print}' | xargs -I % cp % 2016.06

/ Onze 5 jar's zitten in	,
[eric@localhost 2016.06]$ 2>/dev/null geosco-ssh-t.sh "cd /local/apps/jboss-4.0.5.GA/server/geosco;awk '/MISSING/ && /\.jar/{print \$NF}'  log/server.log" | xargs -I % ls -1tr base-framework/core/lib/jar/%
base-framework/core/lib/jar/commons-beanutils-1.9.2.jar
base-framework/core/lib/jar/commons-collections-3.2.2.jar
base-framework/core/lib/jar/commons-logging-1.2.jar
base-framework/core/lib/jar/commons-validator-1.5.1.jar
base-framework/core/lib/jar/vt-password-3.1.2.jar

/ we gaan scp	,  
eric@localhost 2016.06]$ 2>/dev/null geosco-ssh-t.sh "cd /local/apps/jboss-4.0.5.GA/server/geosco;awk '/MISSING/ && /\.jar/{print \$NF}'  log/server.log" | xargs -I % ls -1tr base-framework/core/lib/jar/% | xargs -I % scp % vanderveldene@geosco-app-t.intermax.mp-objects.com:Downloads
/ Hij doet	, (zet echo ervoor)	,
scp base-framework/core/lib/jar/commons-beanutils-1.9.2.jar vanderveldene@geosco-app-t.intermax.mp-objects.com:Downloads
scp base-framework/core/lib/jar/commons-collections-3.2.2.jar vanderveldene@geosco-app-t.intermax.mp-objects.com:Downloads
scp base-framework/core/lib/jar/commons-logging-1.2.jar vanderveldene@geosco-app-t.intermax.mp-objects.com:Downloads
scp base-framework/core/lib/jar/commons-validator-1.5.1.jar vanderveldene@geosco-app-t.intermax.mp-objects.com:Downloads
scp base-framework/core/lib/jar/vt-password-3.1.2.jar vanderveldene@geosco-app-t.intermax.mp-objects.com:Downloads

/ op geosco-app-t	,
[jboss@geosco-app-t ~]$ find  /home/vanderveldene/Downloads/ -type f | xargs -I % cp -a % /local/apps/jboss-4.0.5.GA/server/geosco/lib/
[jboss@geosco-app-t ~]$ geosco start track
/ OK

/ 7	. 

/ we moeten ook de laatste deployment op test naar acc set	,
$ less log/deploy.log
Thu Jul  7 18:39:50 CEST 2016 - 'vanderveldene' deployed '/local/apps/releases/tms-geosco-23753-2016.03_build4269.zip' to '/local/apps/jboss-4.0.5.GA/server/geosco'

/ vanaf laptop	,
[eric@localhost tmp]$ 2>/dev/null geosco-ssh-t.sh  "ls -1tr /local/apps/releases | grep geosco" | awk '{lines[count++]=$0}END{print lines[count-2]}' 
tms-geosco-23753-2016.03_build4269.zip

[eric@localhost tmp]$ 2>/dev/null geosco-ssh-t.sh  "ls -1tr /local/apps/releases | grep geosco" | awk '{lines[count++]=$0}END{print lines[count-2]}' | xargs -I % scp vanderveldene@geosco-app-t.intermax.mp-objects.com:/local/apps/releases/% . 
tms-geosco-23753-2016.03_build4269.zip                                      100%   37MB   1.8MB/s   00:21    
/ OK

[eric@localhost tmp]$ ls -1tr | grep geosco | xargs -I % scp % vanderveldene@geosco-app-a.intermax.mp-objects.com:Downloads
/ OK
/ we moeten dit doen	, want	,
[eric@localhost tmp]$ ls -1tr | grep geosco | xargs -I % scp % vanderveldene@geosco-app-a.intermax.mp-objects.com:/local/apps/releases
scp: /local/apps/releases/tms-geosco-23753-2016.03_build4269.zip: Permission denied

/ Klopt	, 
/ als we op geosco-app-a	,
[vanderveldene@geosco-app-a apps]$ ls -ltr | grep releases
drwxrwxr-x+ 2 jboss    jboss    12288 Jul 12 08:34 releases

[jboss@geosco-app-a releases]$ find /home/vanderveldene/Downloads/ -type f | grep geosco | xargs ls -1tr | awk 'END{print}' | xargs -I %  cp % /local/apps/releases/
/ OK
/ check
[jboss@geosco-app-a releases]$ ls -1tr | grep geosco | awk 'END{print}'
tms-geosco-23753-2016.03_build4269.zip

[jboss@geosco-app-a releases]$ ls -1tr | grep geosco | awk 'END{print}' | xargs -I % echo ~/bin/deploy-geosco.sh $(pwd)/% /local/apps/jboss-4.0.5.GA/server/geosco/
/home/jboss/bin/deploy-geosco.sh /home/jboss/releases/tms-geosco-23753-2016.03_build4269.zip /local/apps/jboss-4.0.5.GA/server/geosco/
/ WH ERR, we moeten deref /home/jboss/releases	,

/ Einde DEPLOY GEOSCO

/ LINUX

/ 7	. 

/ find vindt .project	, als er een file aproject is	, wordt deze zo niet gevonden	, 
/ TODO

[eric@localhost tmp]$ (cd sub;cat >afile)
foo
^d
/ OK
[eric@localhost tmp]$ (cd sub;cat >.file)
foo

[eric@localhost tmp]$ find sub/ -name .file
sub/.file

/ 7	. 

[eric@localhost tmp]$ echo -en "a\nb\nc\nd\n" | awk '{v[c++]=$0}END{print v[c-2]}'
c
/ Klopt	, de indices zijn 0,1,2,3, aan het eind is c=4	, dus index van rij onder de 4 rijen	,
/ dus de enaa laatste rij	,
[eric@localhost tmp]$ echo -en "a\nb\nc\nd\n" | awk '{v[c++]=$0}END{print v[c-2]}'
c

/ Einde LINUX

/ DSVFMS-30333

[eric@localhost Dsvfms]$ pwd
/home/eric/DB_TAP/Firebird/Dsvfms
[eric@localhost Dsvfms]$ dsvfms-ssh-p.sh "find  /backup/mpo-backup/db -type f | grep dsvfms | xargs ls -1tr | awk 'END{print}'"
/backup/mpo-backup/db/dsvfms.fdb_20160717-220002.fbk.gz

[eric@localhost Dsvfms]$ dsvfms-ssh-p.sh "find  /backup/mpo-backup/db -type f | grep dsvfms | xargs ls -1tr | awk 'END{print}'" | xargs -I % scp vanderveldene@scs-application-p.intermax.mp-objects.com:% .
dsvfms.fdb_20160717-220002.fbk.gz                                                   100%   10GB   1.8MB/s 1:38:54     
/ OK

-rw-r--r-- 1 mpo-backup mpo-backup 11009296897 Jul 18 03:43 dsvfms.fdb_20160717-220002.fbk.gz

[eric@localhost Dsvfms]$ gzip -d dsvfms.fdb_20160717-220002.fbk.gz
[eric@localhost Dsvfms]$ gbak -c -user sysdba -password masterkey dsvfms.fdb_20160717-220002.fbk dsvfms.fdb_20160717-220002.fdb

/ 13	. 

/ Als we database dsvfms.fdb_20160204-002837.fdb 	, dan is appl CPU 250%
/ TODO
/ Daarom nemen we database dsvfms.fdb_20160127-003030.fdb	,

/ 7	. 

select count(*) 
from event_event e
join event_type t on e.EVENT_TYPE_SYSTEMID=t.system_id
where t.name like '%POD%';
       COUNT 
============ 
     1736555 

/ Als we naar Execution, Event Dashboard	, dan zien we bij 'Expected events' geen 	, 
/ Dat komt omdat de database is 	,
[eric@localhost Dsvfms]$ isql-fb -u sysdba -p masterkey dsvfms.fdb_20160127-003030.fdb 

/ Kijk naar de code	, die de events ophaalt	, verander de tijd	,
/ Execution, Event Dashboard	, 
/=
EventDashboardPage
/s
EventDashboardPage.<init>() line: 69	
		super();
		daoEventCacheWrapper = new BeanWrapper(EventCacheDAO.class);
		daoWrapper = new BeanWrapper(EventDashboardItemDAO.class);
		eventCustomQueryDaoWrapper = new BeanWrapper(EventCustomQueryDAO.class);
		createPage();
/s
EventDashboardPage.createPage() line: 115	
		createListPanel();
/s
EventDashboardPage.createListPanel() line: 79	
		eventCustomQuerySearchListPanel = new EventCustomQueryDashboardSearchListPanel("eventCustomQuerySearchList", null, webComponentEventSwitchBoard, eventCustomQueryDaoWrapper, getEventCustomQueryListPanelAction(), new GenericTableDataProvider.Builder<EventCustomQuery>());
/s
EventCustomQueryDashboardSearchListPanel.<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, BeanWrapper<BaseDAOInterface<EventCustomQuery>>, Collection<EntityAction<EventCustomQuery>>, TableDataProviderBuilder<EventCustomQuery>) line: 45	
		super(aId, aParent, aWebComponentEventSwitchBoard, new EntityListActionBuilder<EventCustomQuery>(actions), aDaoWrapper, 0, aTableDataProviderBuilder, null);
/s
EventCustomQueryDashboardSearchListPanel(GenericListPanel).<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, ListActionsPanelBuilder<T>, BeanWrapper<BaseDAOInterface<T>>, int, TableDataProviderBuilder<T>, List<EntityGroupAction<T>>) line: 182	
		this(id, parent, aWebComponentEventSwitchBoard, aDaoWrapper, aListLength, tableDataProviderBuilder, aGroupActionList);
/s
EventCustomQueryDashboardSearchListPanel(GenericListPanel).<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, BeanWrapper<BaseDAOInterface<T>>, int, TableDataProviderBuilder<T>, List<EntityGroupAction<T>>) line: 137	

		super(id, parent, aWebComponentEventSwitchBoard);

		if (aGroupActionList != null) {
/ NEE
		if (aListLength != 0) {
/ NEE
		daoWrapper = aDaoWrapper;
com.mpobjects.view.wicket.util.BeanWrapper@3f590a0f[type=interface com.mpobjects.event.dao.eventcustomquery.EventCustomQueryDAO,beanName=<null>]

		if (aTableDataProviderBuilder != null) {
com.mpobjects.view.wicket.util.multi.GenericTableDataProvider$Builder@7f806963
			tableDataProviderBuilder = aTableDataProviderBuilder;

		initialize();
/s
EventCustomQueryDashboardSearchListPanel(GenericListPanel).initialize() line: 304	

		myColumnsList.add(new FilteredAbstractColumn(filterColTitle) {
...
myColumnsList	ArrayList  (id=19464)	
[com.mpobjects.view.wicket.util.multi.GenericListPanel$2@2c14163e]

		addFilterColumns(myColumnsList);
/s
EventCustomQueryDashboardSearchListPanel.addFilterColumns(List<IColumn>) line: 56	
		aColumnList.add(new ConfigurableTextFilteredPropertyColumn<String>(new ResourceModel("code"), "code", "code",
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<String>(15)));
aColumnList=
[com.mpobjects.view.wicket.util.multi.GenericListPanel$2@7ed4dce3, 
com.mpobjects.view.wicket.util.multi.ConfigurableTextFilteredPropertyColumn@1369ec61]

		aColumnList.add(new ExtendedConfigurableTextFilteredPropertyColumn("eventDashboardItemVO.openDefaultCount", "eventDashboardItemVO.openDefaultCount",
				"eventDashboardItemVO.openDefaultCount", new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<Integer>(15)) { ...
aColumnList=
[com.mpobjects.view.wicket.util.multi.GenericListPanel$2@7ed4dce3,
 com.mpobjects.view.wicket.util.multi.ConfigurableTextFilteredPropertyColumn@1369ec61,
 com.mpobjects.event.view.wicket.eventcustomquery.EventCustomQueryDashboardSearchListPanel$1@76c614e1]

		aColumnList.add(new ExtendedConfigurableTextFilteredPropertyColumn("eventDashboardItemVO.openAlertCount", "eventDashboardItemVO.openAlertCount",
				"eventDashboardItemVO.openAlertCount", new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<Integer>(15)) {...
aColumnList=
[com.mpobjects.view.wicket.util.multi.GenericListPanel$2@7ed4dce3,
 com.mpobjects.view.wicket.util.multi.ConfigurableTextFilteredPropertyColumn@1369ec61,
 com.mpobjects.event.view.wicket.eventcustomquery.EventCustomQueryDashboardSearchListPanel$1@76c614e1,
 com.mpobjects.event.view.wicket.eventcustomquery.EventCustomQueryDashboardSearchListPanel$2@67c394a8]

		aColumnList.add(new ExtendedConfigurableTextFilteredPropertyColumn("eventDashboardItemVO.totalOpen", "eventDashboardItemVO.totalOpen", "eventDashboardItemVO.totalOpen", new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<Integer>(15)) {...
aColumnList=
[com.mpobjects.view.wicket.util.multi.GenericListPanel$2@7ed4dce3,
 com.mpobjects.view.wicket.util.multi.ConfigurableTextFilteredPropertyColumn@1369ec61,
 com.mpobjects.event.view.wicket.eventcustomquery.EventCustomQueryDashboardSearchListPanel$1@76c614e1,
 com.mpobjects.event.view.wicket.eventcustomquery.EventCustomQueryDashboardSearchListPanel$2@67c394a8,
 com.mpobjects.event.view.wicket.eventcustomquery.EventCustomQueryDashboardSearchListPanel$3@5d0e181f]

/t
EventCustomQueryDashboardSearchListPanel(GenericListPanel).initialize() line: 294	
		addFilterColumns(myColumnsList);
/d
		columns.addAll(myColumnsList);
...
		makeTable(myColumnsList);
/s
EventCustomQueryDashboardSearchListPanel(GenericListPanel).makeTable(List<IColumn>) line: 446	
		objectDataTable = getMpoDataTable(aColumnsList);
/s
EventCustomQueryDashboardSearchListPanel(GenericListPanel).getMpoDataTable(List<IColumn>) line: 412	
		return new MpoDataTable("objectTable", aColumnsList, dataProvider, getListLength());
/s
MpoDataTable.<init>(String, List<IColumn<T>>, ISortableDataProvider<T>, int) line: 22	
		this(id, columns.toArray(new IColumn[columns.size()]), dataProvider, rowsPerPage);
/s
MpoDataTable.<init>(String, IColumn<T>[], ISortableDataProvider<T>, int) line: 26	
		super(id, columns, dataProvider, rowsPerPage);

		addTopToolbar(new MpoNavigationToolbar(this));
		addTopToolbar(new HeadersToolbar(this, dataProvider));
		addBottomToolbar(new NoRecordsToolbar(this));

/ Intermezzo

/ Geef in google: wicket examples
http://examples7x.wicket.apache.org/repeater/wicket/bookmarkable/org.apache.wicket.examples.repeater.DataTablePage?0

/ of local	,
http://localhost:9090/wicket-examples-step-by-step/repeater/wicket/bookmarkable/org.apache.wicket.examples.repeater.DataTableFilterToolbarPage?1

[eric@localhost Wicket]$ pwd
/home/eric/Devel/Java/Wicket

[eric@localhost Wicket]$ ls ./wicket/wicket-examples/src/main/java/org/apache/wicket/examples/repeater
AjaxDataTablePage.html     ContactsDatabase.java            ExamplePage.html           OIRPage.html              SimplePage.html
AjaxDataTablePage.java     DatabaseLocator.java             ExamplePage.java           OIRPage.java              SimplePage.java
BasePage$ActionPanel.html  DataGridPage.html                FormPage$ActionPanel.html  PagingPage.html           SortableContactDataProvider.java
BasePage.html              DataGridPage.java                FormPage.html              PagingPage.java           SortingPage.html
BasePage.java              DataTableFilterToolbarPage.html  FormPage.java              RefreshingPage.html       SortingPage.java
ContactDataProvider.java   DataTableFilterToolbarPage.java  GridViewPage.html          RefreshingPage.java
ContactFilter.java         DataTablePage.html               GridViewPage.java          RepeaterApplication.java
ContactGenerator.java      DataTablePage.java               Index.html                 RepeatingPage.html
Contact.java               DetachableContactModel.java      Index.java                 RepeatingPage.java

[eric@localhost Wicket]$ less  ./wicket/wicket-examples/src/main/java/org/apache/wicket/examples/repeater/DataTableFilterToolbarPage.java
       public DataTableFilterToolbarPage() {
                List<IColumn<Contact, String>> columns = new ArrayList<>();
                columns.add(new PropertyColumn<Contact, String>(new Model<>("ID"), "id")
...
                SortableContactDataProvider dataProvider = new SortableContactDataProvider();
                DataTable<Contact, String> tableWithFilterForm = new DataTable<>("tableWithFilterForm", columns, dataProvider, 8);
               	FilterForm<ContactFilter> filterForm = new FilterForm<>("filterForm", dataProvider);
                filterForm.add(new TextField<>("dateFrom", PropertyModel.of(dataProvider, "filterState.dateFrom")));
                filterForm.add(new TextField<>("dateTo", PropertyModel.of(dataProvider, "filterState.dateTo")));
                add(filterForm);
                
                FilterToolbar filterToolbar = new FilterToolbar(tableWithFilterForm, filterForm);
                tableWithFilterForm.addTopToolbar(filterToolbar);
                tableWithFilterForm.addTopToolbar(new NavigationToolbar(tableWithFilterForm));
                tableWithFilterForm.addTopToolbar(new HeadersToolbar<>(tableWithFilterForm, dataProvider));
                filterForm.add(tableWithFilterForm);
/ Dus alles staat in het form	,
/ TODO
/ Want	,
/ De 2 fields in het form hebben een name attr	, en er is ook een hidden field met een name attr)	,
/ Wat als je submit	?

/ Wat zijn de .addTopToolbar's	?
/ TODO

/ In HTML zien we meerdere lege	,
<wicket:container wicket:id="toolbars"><wicket:panel xmlns:wicket="http://wicket.apache.org">
	</wicket:panel></wicket:container> 
/ TODO

/ 13	. 

/we zien in HTML	,
<table class="dataview" wicket:id="tableWithFilterForm" id="tableWithFilterForm2">
	<thead wicket:id="topToolbars">

./wicket/wicket-extensions/src/main/java/org/apache/wicket/extensions/markup/html/repeater/data/table/DataTable.java:		topToolbars = new ToolbarsContainer("topToolbars");
/ TODO
 
/ Einde Intermezzo



myColumnsList	ArrayList  (id=19464)	
[com.mpobjects.view.wicket.util.multi.GenericListPanel$2@2c14163e,
 com.mpobjects.view.wicket.util.multi.ConfigurableTextFilteredPropertyColumn@5ac0570d,
 com.mpobjects.event.view.wicket.eventcustomquery.EventCustomQueryDashboardSearchListPanel$1@9934507,
 com.mpobjects.event.view.wicket.eventcustomquery.EventCustomQueryDashboardSearchListPanel$2@2398d37a,
 com.mpobjects.event.view.wicket.eventcustomquery.EventCustomQueryDashboardSearchListPanel$3@66400d8]

[com.mpobjects.view.wicket.util.multi.GenericListPanel$2@2c14163e,
 com.mpobjects.view.wicket.util.multi.ConfigurableTextFilteredPropertyColumn@5ac0570d,
 com.mpobjects.event.view.wicket.eventcustomquery.EventCustomQueryDashboardSearchListPanel$1@9934507,
 com.mpobjects.event.view.wicket.eventcustomquery.EventCustomQueryDashboardSearchListPanel$2@2398d37a,
 com.mpobjects.event.view.wicket.eventcustomquery.EventCustomQueryDashboardSearchListPanel$3@66400d8]

		makeTable(myColumnsList);
/s
EventCustomQueryDashboardSearchListPanel(GenericListPanel).makeTable(List<IColumn>) line: 447	
		objectDataTable = getMpoDataTable(aColumnsList);
		filterForm = new FilterForm("filterForm", dataProvider);

		if (isFilterOn()) {
			objectDataTable.addTopToolbar(new FilterToolbar(objectDataTable, filterForm, dataProvider));

		if (group.get("groupselector") == null) {
			group.add(mySelector);
		}
		if (group.get("objectTable") == null) {
			group.add(objectDataTable);
		}
this.group.children
/=
[[MarkupContainer [Component id = groupselector]], 
[MarkupContainer [Component id = objectTable]]]
		filterForm.add(group);
		filterForm.add(titleLabel);
		addOrReplace(filterForm);
/ Wicket	,
		addGroupActions();
/ WH NIETS	, zijn er niet	,

/t
EventCustomQueryDashboardSearchListPanel(GenericListPanel).<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, ListActionsPanelBuilder<T>, BeanWrapper<BaseDAOInterface<T>>, int, TableDataProviderBuilder<T>, List<EntityGroupAction<T>>) line: 186	
		this(id, parent, aWebComponentEventSwitchBoard, aDaoWrapper, aListLength, tableDataProviderBuilder, aGroupActionList);
/d
		if (listActionsPanelBuilder != null) {
			panelBuilder = listActionsPanelBuilder;
com.mpobjects.view.wicket.util.actions.EntityListActionBuilder@405bfb76

/t
EventDashboardPage.createListPanel() line: 82	
		eventCustomQuerySearchListPanel = new EventCustomQueryDashboardSearchListPanel("eventCustomQuerySearchList", null, webComponentEventSwitchBoard, eventCustomQueryDaoWrapper, getEventCustomQueryListPanelAction(), new GenericTableDataProvider.Builder<EventCustomQuery>());
/d
		eventCustomQuerySearchListPanel.setOutputMarkupId(true);
		add(eventCustomQuerySearchListPanel);

		expectedEventSearchListPanel = new EventCacheSearchListPanel("expectedEventSearchList", null, webComponentEventSwitchBoard, daoEventCacheWrapper, getEventListPanelAction(true), new EventCacheDataProvider.Builder());
/s
EventDashboardPage.getEventListPanelAction(boolean) line: 142	
		List<EntityAction<EventCacheVO>> actions = new ArrayList<EntityAction<EventCacheVO>>();
		EntityActionButton<EventCacheVO> button = new EntityActionAjaxButton<EventCacheVO>("refresh", new ResourceModel("refresh")) {...
/ refresh button op iedere row	,
		actions.add(button);
		return actions;
/t
/s
EventCacheSearchListPanel.<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, BeanWrapper<BaseDAOInterface<EventCacheVO>>, Collection<EntityAction<EventCacheVO>>, TableDataProviderBuilder<EventCacheVO>) line: 41	
		super(aId, aParent, aWebComponentEventSwitchBoard, new EntityListActionBuilder<EventCacheVO>(actions), aDaoWrapper, 0, aTableDataProviderBuilder, null);
/s
EventCacheSearchListPanel(GenericListPanel).<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, ListActionsPanelBuilder<T>, BeanWrapper<BaseDAOInterface<T>>, int, TableDataProviderBuilder<T>, List<EntityGroupAction<T>>) line: 182	
		this(id, parent, aWebComponentEventSwitchBoard, aDaoWrapper, aListLength, tableDataProviderBuilder, aGroupActionList);
/s
EventCacheSearchListPanel(GenericListPanel).<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, BeanWrapper<BaseDAOInterface<T>>, int, TableDataProviderBuilder<T>, List<EntityGroupAction<T>>) line: 120	
		super(id, parent, aWebComponentEventSwitchBoard);
		daoWrapper = aDaoWrapper;
com.mpobjects.view.wicket.util.BeanWrapper@915505f[type=interface com.mpobjects.event.eventcache.model.dao.EventCacheDAO,beanName=<null>]

		if (aTableDataProviderBuilder != null) {
			tableDataProviderBuilder = aTableDataProviderBuilder;
		}
		initialize();
/s
EventCacheSearchListPanel(GenericListPanel).initialize() line: 294	
...
		addFilterColumns(myColumnsList);
[com.mpobjects.view.wicket.util.multi.GenericListPanel$2@391e3501,
 com.mpobjects.view.wicket.util.multi.ConfigurableTextFilteredPropertyColumn@6e29f1f2,
 com.mpobjects.view.wicket.util.multi.ConfigurableTextFilteredPropertyColumn@3cb7f5f,
 com.mpobjects.event.view.wicket.event.EventCacheSearchListPanel$1@251737eb,
 com.mpobjects.event.view.wicket.event.EventCacheSearchListPanel$2@17583853,
 com.mpobjects.event.view.wicket.event.EventCacheSearchListPanel$3@20d9dd1e,
 com.mpobjects.view.wicket.util.multi.DateTimePropertyColumn@3f43ed6b]

		makeTable(myColumnsList);
/s
EventCacheSearchListPanel(GenericListPanel).makeTable(List<IColumn>) line: 446	
		objectDataTable = getMpoDataTable(aColumnsList);
		filterForm = new FilterForm("filterForm", dataProvider);
		if (isFilterOn()) {
			objectDataTable.addTopToolbar(new FilterToolbar(objectDataTable, filterForm, dataProvider));
...
/t
EventDashboardPage.createListPanel() line: 89	
		expectedEventSearchListPanel = new EventCacheSearchListPanel("expectedEventSearchList", null, webComponentEventSwitchBoard, daoEventCacheWrapper, getEventListPanelAction(true), new EventCacheDataProvider.Builder());
/d
		expectedEventSearchListPanel.setOutputMarkupId(true);
		add(expectedEventSearchListPanel);

		unexpectedEventSearchListPanel = new UnExpectedEventDashboardItemSearchListPanel("unexpectedEventSearchList", null, webComponentEventSwitchBoard, daoWrapper, null, new UnExpectedEventDashboardItemDataProvider.Builder(getUnExpectedPrefilterParameters()));

		unexpectedEventSearchListPanel.setOutputMarkupId(true);
		add(unexpectedEventSearchListPanel);

		Form myForm = new Form("refreshForm");
...
		add(myForm);
/c

/ we vallen in 2 b's 	,

/ (*)
Thread [CRON[77]-EventDashboardRefreshTask] (Suspended (breakpoint at line 67 in EventCacheDAOImpl))	
	EventCacheDAOImpl.getByType(int) line: 67	
	EventCacheServiceImpl.getByType(int) line: 31	
	EventCacheServiceImpl.refreshByType(EventType, Date) line: 59	
	EventDashboardItemServiceImpl.refresh(EventType, Resource) line: 150	
	EventDashboardItemServiceImpl.refreshAll(Resource) line: 171	
	EventDashboardRefreshTask.run() line: 43	

/ en we vallen in	,
/ (**)
Daemon Thread [http-0.0.0.0-8080-4] (Suspended (breakpoint at line 150 in EventCacheDAOImpl))	
	EventCacheDAOImpl.runQueryCount(DAOFilterExpression<EventCacheVO>) line: 150	
	EventCacheDataProvider.size() line: 69	
	DataTable$1(DataViewBase).internalGetItemCount() line: 141	
	DataTable$1(AbstractPageableView).getItemCount() line: 258	
	DataTable$1(AbstractPageableView).getRowCount() line: 240	
	DataTable$1(AbstractPageableView).getViewSize() line: 352	
	DataTable$1(AbstractPageableView).getItemModels() line: 105	
	DataTable$1(RefreshingView).onPopulate() line: 94	
	DataTable$1(AbstractRepeater).onBeforeRender() line: 131	
	DataTable$1(AbstractPageableView).onBeforeRender() line: 121	
	DataTable$1(Component).internalBeforeRender() line: 1069	
	DataTable$1(Component).beforeRender() line: 1103	
	WebMarkupContainer(MarkupContainer).onBeforeRenderChildren() line: 1777	
	WebMarkupContainer(Component).onBeforeRender() line: 4001	
	WebMarkupContainer(Component).internalBeforeRender() line: 1069	
	WebMarkupContainer(Component).beforeRender() line: 1103	
	MpoDataTable(MarkupContainer).onBeforeRenderChildren() line: 1777	
	MpoDataTable(Component).onBeforeRender() line: 4001	
	MpoDataTable(Component).internalBeforeRender() line: 1069	
	MpoDataTable(Component).beforeRender() line: 1103	
	CheckGroup(MarkupContainer).onBeforeRenderChildren() line: 1777	
	CheckGroup(Component).onBeforeRender() line: 4001	
	CheckGroup(Component).internalBeforeRender() line: 1069	
	CheckGroup(Component).beforeRender() line: 1103	
	FilterForm(MarkupContainer).onBeforeRenderChildren() line: 1777	
	FilterForm(Component).onBeforeRender() line: 4001	
	FilterForm(Form).onBeforeRender() line: 2104	
	FilterForm(Component).internalBeforeRender() line: 1069	
	FilterForm(Component).beforeRender() line: 1103	
	EventCacheSearchListPanel(MarkupContainer).onBeforeRenderChildren() line: 1777	
	EventCacheSearchListPanel(Component).onBeforeRender() line: 4001	
	EventCacheSearchListPanel(Component).internalBeforeRender() line: 1069	
	EventCacheSearchListPanel(Component).beforeRender() line: 1103	
	EventDashboardPage(MarkupContainer).onBeforeRenderChildren() line: 1777	
	EventDashboardPage(Component).onBeforeRender() line: 4001	
	EventDashboardPage(Page).onBeforeRender() line: 1555	
	EventDashboardPage(Component).internalBeforeRender() line: 1069	
	EventDashboardPage(Component).beforeRender() line: 1103	
	EventDashboardPage(Component).prepareForRender(boolean) line: 2297	
	EventDashboardPage(Page).prepareForRender(boolean) line: 1545	
	EventDashboardPage(Component).prepareForRender() line: 2329	
	EventDashboardPage(Page).renderPage() line: 912															<-
	MpoWebRequestCycle(WebRequestCycle).redirectTo(Page) line: 201	
	PageRequestTarget.respond(RequestCycle) line: 58	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
...
/ Dit is de render page	,

/ Ad (*)
/s
EventDashboardRefreshTask.run() line: 43	
			EventDashboardItemService myService = MpoBeanFactory.getBean(EventDashboardItemService.class);
			myService.refreshAll(ResourceUtil.getResource());
/s
EventDashboardItemServiceImpl.refreshAll(Resource) line: 171	
		Collection<EventType> myEventTypeList = new BeanWrapper<EventTypeDAO>(EventTypeDAO.class).getBean().getAll();
[POD, ADO, OFD, OTH, DLY, REF, REC, REQ, DAM, RET, HOL, CUS, MIS, DL3, DL2, ETA, ePOD, COST_INV, OSH, RTS]
		for (EventType myType : myEventTypeList) {
			refresh(myType, aResource);
myType="POD"
/s
EventDashboardItemServiceImpl.refresh(EventType, Resource) line: 150	
		MpoBeanFactory.getBean(EventCacheService.class).refreshByType(anEventType, getFromDate());
/s
public class EventDashboardItemServiceImpl implements EventDashboardItemService {
	private Date getFromDate() {

		int myDaysBack = ApplicationPropertyManager.getInstance().getModuleApplicationProperty("event", "daysback", 90);
module.event.daysback=45
/ In bash	,
[eric@localhost dsvfms]$ echo $(date --date="45 days ago")
Sat Jun 4 16:20:48 CEST 2016

		Date myDate = new Date();
		myDate.setDate(myDate.getDate() - myDaysBack);
		return myDate;
	}
/s
EventCacheServiceImpl.refreshByType(EventType, Date) line: 59	
		for (EventCacheVO myCache : getByType(anEventType.getSystemId())) {
anEventType="POD"
/s
EventCacheServiceImpl.getByType(int) line: 31	
		return getDAO().getByType(anEventTypeSystemid);
/s
EventCacheDAOImpl.getByType(int) line: 67	
		Collection<Integer> myActivatableOrganizations = ResourceUtil.getResource().getActivatableOrganizationSystemids();
[5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5180, 5450, 5280, 5070, 5410, 3220, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3180, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440]
		String myQuery = 
"Select {ec.*} 
from event_cache ec, event_type et " 
+"where ec.event_type_systemid = et.system_id " 
+ "and et.system_id = "+ anEventTypeSystemid + " " + "and ec.organization_systemid " + "in (" 
	+ StringUtils.implode(myActivatableOrganizations.toArray(), ",") + ") "
+ "order by et.name ";
/ anEventTypeSystemid=1=POD

SQL> select system_id,name from event_type;

   SYSTEM_ID NAME                      
============ ========================= 
           1 POD                       
           3 ADO                       
     4319727 OFD                       
     4448476 OTH                       
     4455290 DLY                       
     4520785 REF                       
...

		return executeSqlSelect(myQuery, "ec");
/ "ec" is alias	,

/ we zien	,
2016-07-19 14:47:47,259 DEBUG [org.hibernate.SQL] (CRON[77]-EventDashboardRefreshTask:) 
Select ec.SYSTEM_ID as SYSTEM1_199_0_, ec.CUSTOM_EVENT_QUERY_SYSTEMID as CUSTOM2_199_0_, ec.EVENT_TYPE_SYSTEMID as EVENT3_199_0_, ec.ORGANIZATION_SYSTEMID as ORGANIZA4_199_0_, ec.LAST_REFRESH as LAST5_199_0_, ec.OPEN_DEFAULT_COUNT as OPEN6_199_0_, ec.OPEN_ALERT_COUNT as OPEN7_199_0_ 
from event_cache ec, event_type et 
where ec.event_type_systemid = et.system_id 
and et.system_id = 1 
and ec.organization_systemid in (5045,5230,5040,5050,5550,5310,5400,3110,5180,5450,5280,5070,5410,3220,3100,3210,5600,5610,5620,3150,3200,3180,3190,200,5540,5290,5080,5560,5300,5090,5460,5420,5100,5110,5470,5520,5120,5570,5020,5430,5125,5130,5140,5150,5160,5170,5030,5190,5200,5210,5500,5580,5530,5220,5240,5250,5320,5260,5270,5390,12123,5510,5440) 
order by et.name 

SYSTEM1_199_0_ CUSTOM2_199_0_ EVENT3_199_0_ ORGANIZA4_199_0_              LAST5_199_0_ OPEN6_199_0_ OPEN7_199_0_ 
============== ============== ============= ================ ========================= ============ ============ 
      21419848         <null>             1             3190 2016-07-19 10:20:22.2670             0            0 
      38840168         <null>             1             3210 2016-07-19 10:20:22.2670             0            0 
     121158588         <null>             1             3180 2016-07-19 10:20:22.2670             0            0 


...
/s
EventCacheDAOImpl(BaseHibernateDAO).executeSqlSelect(String, String, Collection<QueryParameter>, int, int) line: 211	
...
/t
EventCacheServiceImpl.refreshByType(EventType, Date) line: 60	
		for (EventCacheVO myCache : getByType(anEventType.getSystemId())) {
myCache=																	
	performanceMonitorService	null	
	systemId	21419848	
	theCustomEventQuery	null	
	theEventType	EventType  (id=20492)	
POD
	theLastRefresh	Timestamp  (id=20493)	
2016-07-19 10:20:22.267
	theOpenAlertCount	Integer  (id=20494)	
0
	theOpenDefaultCount	Integer  (id=20494)	
0
	theOrganizationSystemid	Integer  (id=20496)	
3190
/ 1ste	, 
/ er zijn er 3	,

			myCache.setOpenAlertCount(0);
			myCache.setOpenDefaultCount(0);
			myCache.setLastRefresh(new Date());
/ nu	,
			getDAO().save(myCache);
		}

		List<Object[]> myCountList = getDAO().statusCount(anEventType, aFromDate);
/s
EventCacheDAOImpl.statusCount(EventType, Date) line: 161	
		String myQuery = 
"select count(distinct e.serviceOrderVO), e.eventStatus, e.organizationSystemid 
from EventVO e 
where e.eventType.systemId = :eventTypeSystemId 
and e.createdDate > :fromDate 
and e.closedOn is null 
and e.expectedEnd is not null 
and (e.eventTemplateSystemid != 0 
	or e.eventTemplateSystemid is not null) 
group by e.eventStatus, e.eventType.systemId, e.organizationSystemid";

		Query query = getCurrentSession().createQuery(myQuery);
		query.setInteger("eventTypeSystemId", anEventType.getSystemId());
POD's system_id=1
		query.setTimestamp("fromDate", aFromDate);
Sat Jun 04 10:30:21 CEST 2016
/ dit is vandaag	, 19 Jul - 45 dagen	, 
$ vi application.properties
module.event.daysback=45

		List<Object[]> myList = new ArrayList<Object[]>();
		for (Iterator<Object[]> myIterator = query.iterate(); myIterator.hasNext();) {
			myList.add(myIterator.next());
		return myList;
[]
/ we zien	,
2016-07-19 16:25:38,110 DEBUG [org.hibernate.SQL] (CRON[77]-EventDashboardRefreshTask:) 
select count(distinct eventvo0_.SERVICE_ORDER_SYSTEMID) as col_0_0_, eventvo0_.EVENT_STATUS as col_1_0_, eventvo0_.ORGANIZATION_SYSTEMID as col_2_0_ 
from EVENT_EVENT eventvo0_, SERVICE_ORDER serviceord1_ 
where eventvo0_.SERVICE_ORDER_SYSTEMID=serviceord1_.SYSTEM_ID 
and eventvo0_.EVENT_TYPE_SYSTEMID=1
and eventvo0_.CREATED_DATE>'2016-06-04 16:41:16.1150'
and (eventvo0_.CLOSED_ON is null) 
and (eventvo0_.EXPECTED_END is not null) 
and (eventvo0_.EVENT_TEMPLATE_SYSTEMID<>0 
	or eventvo0_.EVENT_TEMPLATE_SYSTEMID is not null) 
group by eventvo0_.EVENT_STATUS , eventvo0_.EVENT_TYPE_SYSTEMID , eventvo0_.ORGANIZATION_SYSTEMID
;
/ GEEN	,
/ In log file staat	, 
2016-07-19 16:25:38,113 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (CRON[77]-EventDashboardRefreshTask:) binding parameter [2] as [TIMESTAMP] - Sat Jun 04 10:30:21 CEST 2016
/ TODO (Als je deze neemt, runs query NIET)	,


/ Intermezzo

[eric@localhost 2016.06]$ date --date='2016-01-27 45 days ago' 
Sun Dec 13 00:00:00 CET 2015

select count(distinct eventvo0_.SERVICE_ORDER_SYSTEMID) as col_0_0_, eventvo0_.EVENT_STATUS as col_1_0_, eventvo0_.ORGANIZATION_SYSTEMID as col_2_0_ 
from EVENT_EVENT eventvo0_, SERVICE_ORDER serviceord1_ 
where eventvo0_.SERVICE_ORDER_SYSTEMID=serviceord1_.SYSTEM_ID 
and eventvo0_.EVENT_TYPE_SYSTEMID=1
and eventvo0_.CREATED_DATE>'2015-12-13'
and (eventvo0_.CLOSED_ON is null) 
and (eventvo0_.EXPECTED_END is not null) 
and (eventvo0_.EVENT_TEMPLATE_SYSTEMID<>0 
	or eventvo0_.EVENT_TEMPLATE_SYSTEMID is not null) 
group by eventvo0_.EVENT_STATUS , eventvo0_.EVENT_TYPE_SYSTEMID , eventvo0_.ORGANIZATION_SYSTEMID
;
    COL_0_0_ COL_1_0_                      COL_2_0_ 
============ ========================= ============ 
         905 OPEN_ALERTED                      3180 
        5121 OPEN_ALERTED                      3190 


[eric@localhost 2016.06]$ echo $(( ( $(date +%s) - $(date --date='2016-01-01 07:12:56' +%s))/60/60/24))
200

/ 13	. 

/ we oef,	


SQL> select max(created_date)from event_event;

                      MAX 
========================= 
2016-02-04 10:48:11.0110  

SQL> select min(created_date)from event_event;

                      MIN 
========================= 
2011-05-28 12:36:37.3440  

[eric@localhost 2016.06]$ date --date='2016-07-04 07:12:56'
Mon Jul  4 07:12:56 CEST 2016

[eric@localhost 2016.06]$ echo $(date +%s) - $(date --date='2016-06-04 07:12:56' +%s)
1468940456 - 1465017176
[eric@localhost 2016.06]$ echo $(( ( $(date +%s) - $(date --date='2016-06-04 07:12:56' +%s))))
3923343
[eric@localhost 2016.06]$ echo $(( ( $(date +%s) - $(date --date='2016-06-04 07:12:56' +%s))/60))
65389
[eric@localhost 2016.06]$ echo $(( ( $(date +%s) - $(date --date='2016-06-04 07:12:56' +%s))/60/60))
1089
[eric@localhost 2016.06]$ echo $(( ( $(date +%s) - $(date --date='2016-06-04 07:12:56' +%s))/60/60/24))
45
/ Klopt	,

/ 13	. 

/ DAYSBACK

/ we doen	,
[eric@localhost 2016.06]$ echo $(( ( $(date +%s) - $(date --date='2015-12-13' +%s))/60/60/24))
219

/ Einde Intermezzo

////////////////////////////////////////////////////////////////////////////////////////////
/ we moeten dus	,
[eric@localhost dsvfms]$ vi conf/local_application.properties
219
225


/t
EventCacheServiceImpl.refreshByType(EventType, Date) line: 68	
/ TODO (Later)












/ Ad (**)
/ render page	,
/s
EventCacheDataProvider.size() line: 69	
		int size = daoWrapper.getBean().runQueryCount(filter);
/s
EventCacheDAOImpl.runQueryCount(DAOFilterExpression<EventCacheVO>) line: 150	
/=
	public int runQueryCount(final DAOFilterExpression<EventCacheVO> filter) {
		Map<String, DetachedCriteria> mySubMap = new HashMap<String, DetachedCriteria>();
		DetachedCriteria myDetachedCriteria = prepareCriteria(filter.getLegacyFilter(), mySubMap);
		createCriteria(myDetachedCriteria, filter, mySubMap);
		myDetachedCriteria.setProjection(Projections.rowCount());
		myDetachedCriteria.setProjection(Projections.distinct(Projections.countDistinct("eventType")));
		myDetachedCriteria.add(Restrictions.disjunction().add(Property.forName("openAlertCount").ne(0)).add(Property.forName("openDefaultCount").ne(0)));
		return ((Number) getHibernateTemplate().findByCriteria(myDetachedCriteria).get(0)).intValue();

/ MISSCHIEN we zien	,
2016-07-19 15:52:06,490 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-4:) 
select distinct count(distinct this_.EVENT_TYPE_SYSTEMID) as y0_ 
from EVENT_CACHE this_ 
where this_.organization_systemid in (
	select uo.organization_systemid 
	from user_organization uo 	
	where uo.user_systemid = 120027857) 
and (this_.OPEN_ALERT_COUNT<>0 
		or this_.OPEN_DEFAULT_COUNT<>0)
         Y0_ 
============ 
           0 


/ 7	. 

/ we click getal onder 'Open Alert Count'	, bijv. in de POD rij	, 

public class EventCacheSearchListPanel extends GenericListPanel<EventCacheVO> {
		aColumnList.add(new ExtendedConfigurableTextFilteredPropertyColumn("openAlertCount", "openAlertCount", "openAlertCount",
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<Integer>(5)) {
			@Override
			public void populateItem(Item aCellItem, String aComponentId, IModel aModel) {
				final EventCacheVO item = (EventCacheVO) aModel.getObject();
				Link<EventVO> link = new Link<EventVO>("link", aModel) {

					@Override
					public void onClick() {
->						EventByEventTypePage page = new EventByEventTypePage(item.getEventType().getSystemId(),
								Collections.singleton(EventStatus.OPEN_ALERTED), item.getEventType().getCode(), true);
						setResponsePage(page);

this	EventCacheSearchListPanel$2$1  (id=20996)	
	val$item	EventCacheVO  (id=21017)	
		performanceMonitorService	null	
		systemId	21419848	
		theCustomEventQuery	null	
		theEventType	EventType  (id=21033)	
POD
		theLastRefresh	Timestamp  (id=21034)	
2016-07-20 11:20:47.062
		theOpenAlertCount	Integer  (id=21035)	
5120
		theOpenDefaultCount	Integer  (id=21036)	
0
		theOrganizationSystemid	Integer  (id=21037)	
3190
/ DSV-NL-MDK

/ BREAKPOINTS DISABLED
EventCacheDAOImpl [line: 67] - getByType(int)	
EventCacheDAOImpl [line: 105] - getOpenCountForUser(String)	
EventCacheDAOImpl [line: 161] - statusCount(EventType, Date)	
EventCacheDAOImpl [line: 67] - getByType(int)	



/s
EventByEventTypePage.<init>(int, Collection<EventStatus>, String, boolean) line: 129	
		super();
/s
EventByEventTypePage(AbstractEventListPage).<init>() line: 44	
/s
EventByEventTypePage(AbstractObjectListPage).<init>() line: 30	
/s
EventByEventTypePage(BaseContextPage).<init>() line: 14	
/s
EventByEventTypePage(BaseContextPage).<init>(PageParameters) line: 18	
/s
EventByEventTypePage(BasePage).<init>(PageParameters) line: 37	
	protected WebComponentEventSwitchBoard webComponentEventSwitchBoard = new WebComponentEventSwitchBoard();
/ TODO
/t
EventByEventTypePage(AbstractEventListPage).<init>() line: 44	
	private final HashMap<String, AbstractColumn> columns = new HashMap<String, AbstractColumn>();
/t
EventByEventTypePage.<init>(int, Collection<EventStatus>, String, boolean) line: 129	
	super();
/d
		systemId = aSystemId;
1	/ PDO's system_id	,
		statuses = new HashSet<EventStatus>();
		if (aStatus != null) {
			statuses.addAll(aStatus);
[OPEN_ALERTED]
		eventType = aEventType;
		myDaysBack = ApplicationPropertyManager.getInstance().getModuleApplicationProperty("event", "daysback", 90);
219
		daoWrapper = new BeanWrapper<EventDAO>(EventDAO.class);

		final StringResourceModel myTitle = new StringResourceModel(prefix + "title", this, null, new Object[] { isExpected ? "Expected " : "Unexpected ", eventType });
StringResourceModel[key:dashboard.title,default:null,params:[Expected , POD]]

		add(new Label("pageTitle", myTitle));
		add(new Label("title", myTitle));

		serviceWrapper = new BeanWrapper(EventService.class);

		TableDataProviderBuilder<EventVO> myBuilder = null;
		if (isExpected) {
			myBuilder = new EventDataProvider.Builder(getPrefilteredParameters());
/s
EventByEventTypePage.getPrefilteredParameters() line: 340	
		Date myDate = DateUtils.addTo(new Date(), "D", -myDaysBack);
Mon Dec 14 12:06:43 CET 2015
-myDaysBack=-219

		List<Parameter> myParamList = new ArrayList<Parameter>();

		GenericDAOFilterExpression.ParameterImpl eventTypeParameter = new GenericDAOFilterExpression.ParameterImpl("eventType.systemId", systemId);
eventTypeParameter	GenericDAOFilterExpression$ParameterImpl  (id=21910)	
	criterium	MatchOperation  (id=21881)	
EQ
	fieldName	"eventType.systemId" (id=21882)	
	inverted	false	
	value	Integer  (id=21883)	
1

		GenericDAOFilterExpression.ParameterImpl createdDateParameter = new GenericDAOFilterExpression.ParameterImpl("createdDate", new Timestamp( myDate.getTime()));
		createdDateParameter.setCriterium(MatchOperation.GT);

createdDateParameter	GenericDAOFilterExpression$ParameterImpl  (id=21928)	
	criterium	MatchOperation  (id=21873)	
GT
	fieldName	"createdDate" (id=21874)	
	inverted	false	
	value	Timestamp  (id=21931)	
2015-12-14 12:06:43.015

		GenericDAOFilterExpression.ParameterImpl eventStatusParameter = new GenericDAOFilterExpression.ParameterImpl("eventStatus", statuses);
		eventStatusParameter.setCriterium(MatchOperation.IN);

eventStatusParameter	GenericDAOFilterExpression$ParameterImpl  (id=21945)	
	criterium	MatchOperation  (id=21877)	
IN
	fieldName	"eventStatus" (id=21885)	
	inverted	false	
	value	HashSet  (id=21474)	
[OPEN_ALERTED]

		GenericDAOFilterExpression.ParameterImpl organizationParameter = new GenericDAOFilterExpression.ParameterImpl("organizationSystemid", ResourceUtil.getResource().getActivatableOrganizationSystemids());
		organizationParameter.setCriterium(MatchOperation.IN);

organizationParameter	GenericDAOFilterExpression$ParameterImpl  (id=21954)	
	criterium	MatchOperation  (id=21877)	
IN
	fieldName	"organizationSystemid" (id=21878)	
	inverted	false	
	value	ArrayList  (id=21879)	
[5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440]

		GenericDAOFilterExpression.ParameterImpl nullEventTemplate = new GenericDAOFilterExpression.ParameterImpl("eventTemplateSystemid", "");
		nullEventTemplate.setCriterium(MatchOperation.NULL);

nullEventTemplate	GenericDAOFilterExpression$ParameterImpl  (id=21984)	
	criterium	MatchOperation  (id=21891)	
NULL
	fieldName	"eventTemplateSystemid" (id=21985)	
	inverted	false	
	value	"" (id=21893)	


		GenericDAOFilterExpression.ParameterImpl nullClosedOn = new GenericDAOFilterExpression.ParameterImpl("closedOn", "");
		nullClosedOn.setCriterium(MatchOperation.NULL);

nullClosedOn	GenericDAOFilterExpression$ParameterImpl  (id=21992)	
	criterium	MatchOperation  (id=21891)	
NULL
	fieldName	"closedOn" (id=21892)	
	inverted	false	
	value	"" (id=21893)	

		GenericDAOFilterExpression.ParameterImpl notNullExpectedEnd = new GenericDAOFilterExpression.ParameterImpl("expectedEnd", "");
		notNullExpectedEnd.setCriterium(MatchOperation.NULL);
		notNullExpectedEnd.setInverted(true);

notNullExpectedEnd	GenericDAOFilterExpression$ParameterImpl  (id=22003)	
	criterium	MatchOperation  (id=21891)	
NULL
	fieldName	"expectedEnd" (id=21894)	
	inverted	true	
	value	"" (id=21893)	

		GenericDAOFilterExpression.ParameterImpl notNullEventTemplate = new GenericDAOFilterExpression.ParameterImpl("eventTemplateSystemid", "");
		notNullEventTemplate.setCriterium(MatchOperation.NULL);
		notNullEventTemplate.setInverted(true);

notNullEventTemplate	GenericDAOFilterExpression$ParameterImpl  (id=22032)	
	criterium	MatchOperation  (id=21891)	
NULL
	fieldName	"eventTemplateSystemid" (id=21985)	
	inverted	true	
	value	"" (id=21893)	

		GenericDAOFilterExpression.ParameterImpl nonZeroEventTemplate = new GenericDAOFilterExpression.ParameterImpl("eventTemplateSystemid", 0);
		nonZeroEventTemplate.setCriterium(MatchOperation.EQ);
		nonZeroEventTemplate.setInverted(true);

nonZeroEventTemplate	GenericDAOFilterExpression$ParameterImpl  (id=22039)	
	criterium	MatchOperation  (id=21881)	
EQ
	fieldName	"eventTemplateSystemid" (id=21985)	
	inverted	true	
	value	Integer  (id=22040)	
0

		GenericDAOFilterExpression.ParameterImpl notNullServiceOrder = new GenericDAOFilterExpression.ParameterImpl("serviceOrderVO", "");
		notNullServiceOrder.setCriterium(MatchOperation.NULL);
		notNullServiceOrder.setInverted(true);

notNullServiceOrder	GenericDAOFilterExpression$ParameterImpl  (id=22053)	
	criterium	MatchOperation  (id=21891)	
NULL
	fieldName	"serviceOrderVO" (id=22054)	
	inverted	true	
	value	"" (id=21893)	

		myParamList.add(createdDateParameter);
		myParamList.add(organizationParameter);

		if (isExpected) {
			myParamList.add(eventTypeParameter);
			myParamList.add(eventStatusParameter);
			myParamList.add(nullClosedOn);
			myParamList.add(notNullExpectedEnd);
			myParamList.add(notNullEventTemplate);
			myParamList.add(nonZeroEventTemplate);
			myParamList.add(notNullServiceOrder);
		return myParamList;
/t
EventByEventTypePage.<init>(int, Collection<EventStatus>, String, boolean) line: 156	
		if (isExpected) {
			myBuilder = new EventDataProvider.Builder(getPrefilteredParameters());
/pd
/s
EventDataProvider$Builder.<init>(List<Parameter>) line: 32	
			parameterList = aParameterList;
/t
EventByEventTypePage.<init>(int, Collection<EventStatus>, String, boolean) line: 156	
			myBuilder = new EventDataProvider.Builder(getPrefilteredParameters());
/d
		dataProvider = myBuilder.build(daoWrapper, "systemId");
/s
EventDataProvider$Builder.build(BeanWrapper<BaseDAOInterface<EventVO>>, String) line: 38	
			EventDataProvider myProvider = new EventDataProvider(aDaoWrapper, aDefaultSortProperty);
aDaoWrapper	BeanWrapper  (id=21483)	
com.mpobjects.view.wicket.util.BeanWrapper@7575f134[type=interface com.mpobjects.event.event.model.dao.EventDAO,beanName=<null>]
aDefaultSortProperty	"systemId" (id=22067)	
/s
EventDataProvider(GenericTableDataProvider).<init>(BeanWrapper<BaseDAOInterface<T>>, String) line: 176	
		daoWrapper = aDaoWrapper;
		if (defaultSortProperty != null && defaultSortProperty.length() > 0) {
systemId
			// WARNING: can still cause issues when the property does not exist
			setSort(defaultSortProperty, ASCENDING_SORT);
		resetFilterState();
/sets filter=null
/ Doet niets nu	, want setPrefilterParameters is nog niet called	, terwijl de parameters al zijn set	, 
/ Maar het gebeurt vlak hierna	,

/ Intermezzo

/ Precies hetzelfde als 

$ vi ./src/main/java/org/apache/wicket/examples/repeater/SortableContactDataProvider.java

       public SortableContactDataProvider()
        {
                // set default sort
                setSort("firstName", SortOrder.ASCENDING);
        }

/ Ook	,
       public Iterator<Contact> iterator(long first, long count) {
                List<Contact> contactsFound = getContactsDB().getIndex(getSort());
                return filterContacts(contactsFound).  subList((int)first, (int)(first + count)).  iterator();
       }
       public long size() {
                return filterContacts(getContactsDB().getIndex(getSort())).size();
       }
       private List<Contact> filterContacts(List<Contact> contactsFound)
			...


/ Einde Intermezzo

/t
EventDataProvider$Builder.build(BeanWrapper<BaseDAOInterface<EventVO>>, String) line: 39	
			EventDataProvider myProvider = new EventDataProvider(aDaoWrapper, aDefaultSortProperty);
/d
			myProvider.setPrefilterParameters(parameterList);
			myProvider.resetFilterState();
/s
EventDataProvider(PrefilteredTableDataProvider).resetFilterState() line: 92	
		if (getPrefilterParameters() != null) {
			setFilter();
/s
EventDataProvider(PrefilteredTableDataProvider).setFilter() line: 109	
		preFilter = new FilterStateFilterExpression();
		for (Parameter myParameter : getPrefilterParameters()) {
			preFilter.addParameter(myParameter);
/t
EventDataProvider(PrefilteredTableDataProvider).resetFilterState() line: 92	
		if (getPrefilterParameters() != null) {
			setFilter();
/d
		filter = preFilter;
/t
EventDataProvider$Builder.build(BeanWrapper<BaseDAOInterface<EventVO>>, String) line: 41	
			myProvider.resetFilterState();
/d
			return myProvider;
/t
EventByEventTypePage.<init>(int, Collection<EventStatus>, String, boolean) line: 163	
		dataProvider = myBuilder.build(daoWrapper, "systemId");
/d
this	EventByEventTypePage  (id=18634)	
	dataProvider	EventDataProvider  (id=18678)	
		filter	GenericTableDataProvider$FilterStateFilterExpression  (id=18759)	
			parameters	ArrayList  (id=18771)	
[createdDate 2015-12-15 11:50:21.465 false GT, 
organizationSystemid [5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440] false IN, 
eventType.systemId 1 false EQ, 
eventStatus [OPEN_ALERTED] false IN, 
closedOn  false NULL, 
expectedEnd  true NULL, 
eventTemplateSystemid  true NULL, 
eventTemplateSystemid 0 true EQ, 
serviceOrderVO  true NULL]
/ WH zoiezo filter	, afgezien van de filters op bepaalde columns straks	, die komen er dan bij	,

		ArrayList myColumns = new ArrayList();
		final Collection<AbstractColumn<?>> myProcessedColumns = processColumns();
/s
EventByEventTypePage(AbstractObjectListPage).processColumns() line: 160	
		String myColumnDefinition = getColumnDefinition();
/=
		return ApplicationPropertyManager.getInstance().getModuleProperty("event", prefix + "columndefinition");
/=
[eric@localhost tmp]$ echo eventType.code,serviceOrderVO.serviceOrderId,serviceAction.shipmentOrderVO.reference2,serviceAction.shipmentOrderVO.reference10,serviceAction.shipmentOrderVO.heaviestTopLevelShipmentItem.reference2,expectedEnd,closedOn,actualValue,remarks,serviceAction.shipmentOrderVO.reference5,serviceOrderVO.toPartyVO.countryVO.code,serviceOrderVO.toPartyVO.postalCode,serviceOrderVO.ExecutedByPartyVO.partyId,serviceOrderVO.dateSetVO.plannedEndBefore ,serviceAction.shipmentOrderVO.reference1,org.organizationId,serviceAction.serviceActionType.code | awk 'BEGIN{FS=","}END{print NF}'
17
/=
		ArrayList myColumns = new ArrayList();
		String[] myHeaders = myColumnDefinition.split(",");
myHeaders	String[17]  (id=22788)	
	[0]	"eventType.code" (id=22791)										/ Event Type
	[1]	"serviceOrderVO.serviceOrderId" (id=22792)						/ Service order number
	[2]	"serviceAction.shipmentOrderVO.reference2" (id=22793)			/ Shipment tracking number
	[3]	"serviceAction.shipmentOrderVO.reference10" (id=22794)			/ Principal
	[4]	"serviceAction.shipmentOrderVO.heaviestTopLevelShipmentItem.reference2" (id=22795)			/ Box tracking number
	[5]	"expectedEnd" (id=22796)										/ expected end
	[6]	"closedOn" (id=22797)											/ Closed on 
	[7]	"actualValue" (id=22800)	
	[8]	"remarks" (id=22801)	
	[9]	"serviceAction.shipmentOrderVO.reference5" (id=22802)			/ Original Voyage 
	[10]	"serviceOrderVO.toPartyVO.countryVO.code" (id=22803)		/ Ship to Country code
	[11]	"serviceOrderVO.toPartyVO.postalCode" (id=22804)			/ Ship to Postal code
	[12]	"serviceOrderVO.ExecutedByPartyVO.partyId" (id=22805)		/ Executed by	
	[13]	"serviceOrderVO.dateSetVO.plannedEndBefore " (id=22806)		/ planned end before 
	[14]	"serviceAction.shipmentOrderVO.reference1" (id=22807)		/ Reference1
	[15]	"org.organizationId" (id=22808)								/ organization
	[16]	"serviceAction.serviceActionType.code" (id=22809)			/ Service action type	

/ De titles rechts komen uit EventByEventPage.properties	,

/ Dit zijn de columns in de table die we willen zien	,
/ Verderop doen we getAllColumns()	, en dan kijken we welke van het lijstje hier daarin zitten	,  en die uit getAllColumns() komen er dan	,
/ Rechts staan de titles op de headers	, die komen uit	, 
$ cat >list.txt
dashboard.eventType.code = Event Type												
dashboard.serviceOrderVO.serviceOrderId = Service order number
dashboard.serviceAction.shipmentOrderVO.reference2=Shipment tracking number
dashboard.serviceAction.shipmentOrderVO.reference10=Principal
dashboard.serviceAction.shipmentOrderVO.heaviestTopLevelShipmentItem.reference2=Box tracking number
dashboard.expectedend=expected end
dashboard.actualvalue=actual value
dashboard.remarks=remarks
dashboard.serviceAction.shipmentOrderVO.reference5 = Original Voyage
dashboard.serviceOrderVO.toPartyVO.countryVO.code = Ship to Country code
dashboard.serviceOrderVO.toPartyVO.postalCode = Ship to Postal code
dashboard.serviceOrderVO.ExecutedByPartyVO.partyId=Executed by
dashboard.serviceOrderVO.dateSetVO.plannedEndBefore = planned end before
dashboard.serviceOrderVO.reference1=Reference1
dashboard.serviceAction.serviceactiontype.code = Service action type
[eric@localhost tmp]$ cat list.txt | awk 'END{print NR}'
14
/ Deze zijn er ook in EventByEventType.properties
dashboard.serviceAction.shipmentOrderVO.heaviesttoplevelshipmentitem.reference2=reference2
dashboard.closedon=closed on
dashboard.closedon=Closed on
dashboard.org.organizationid = organization
/ TODO

/ Intermezzo

GoAndClearFilter [line: 83] - GoAndClearFilter(String, FilterForm<?>, IModel<String>, IModel<String>)	

/s
FilterForm(Form).onFormSubmitted() line: 886	
/ Waarom valt hij hierin	?
/ TODO
			else
			{
				// First, see if the processing was triggered by a Wicket IFormSubmittingComponent
				final IFormSubmittingComponent submittingComponent = findSubmittingButton();
submittingComponent	GoFilter$1  (id=19152)	
				}
				else
				{
					// this is the root form
					Form<?> formToProcess = this;

					// find out whether it was a nested form that was submitted
					if (submittingComponent != null)
					{
						formToProcess = submittingComponent.getForm();
					}

					// process the form for this request
					formToProcess.process(submittingComponent);
/s
FilterForm(Form).process(IFormSubmittingComponent) line: 954	
		// save the page in case the component is removed during submit
		final Page page = getPage();
		String hiddenFieldId = getHiddenFieldId();

/ Einde Intermezzo

		HashMap<String, AbstractColumn> myAvailableColumns = getAllColumns();
/s
EventByEventTypePage(AbstractEventListPage).getAllColumns() line: 53	
		columns.put("remarks", new ExtendedConfigurableTextFilteredPropertyColumn(prefix + "remarks", "remarks",
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder(10)) {
					...
		addColumn("partyVO.partyId", 5);
/s
EventByEventTypePage(AbstractEventListPage).addColumn(String, int) line: 196	
		columns.put(aKey, new ExtendedConfigurableTextFilteredPropertyColumn(prefix, aKey, true,
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<String>(aSize)));
/t
EventByEventTypePage(AbstractEventListPage).getAllColumns() line: 53	
		addColumn("partyVO.partyId", 5);
/d
this	EventByEventTypePage  (id=22603)	
	columns	HashMap  (id=22813)	
{partyVO.partyId=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@77118526, 
remarks=com.mpobjects.event.view.wicket.event.AbstractEventListPage$1@5c1da48f}

		ArrayList<EventReportingLevel> repVals = new ArrayList<EventReportingLevel>();
		repVals.add(null);
		repVals.addAll(Arrays.asList(EventReportingLevel.values()));
		columns.put("reportingLevel", new ChoiceFilteredPropertyColumn(new ResourceModel(prefix + "reportingLevel"), "reportingLevel", new Model(repVals)) {
			...
		addColumn("eventType.code", 5);
		addColumn("serviceAction.serviceActionType.code", 5);

		columns.put("serviceOrderVO.serviceOrderId", new ExtendedConfigurableTextFilteredPropertyColumn(prefix + "serviceOrderVO.serviceOrderId", "serviceOrderVO.serviceOrderId", new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder(21)) {
			...
		addColumn("consignment", 10);
		addColumn("serviceAction.shipmentOrderVO.reference2");
		addColumn("serviceAction.shipmentOrderVO.reference10");

		columns.put("serviceAction.shipmentOrderVO.heaviestTopLevelShipmentItem.reference2",
				new PropertyColumn<String>(new ResourceModel(prefix + "serviceAction.shipmentOrderVO.heaviestTopLevelShipmentItem.reference2"),
						"serviceAction.shipmentOrderVO.heaviestTopLevelShipmentItem.reference2"));

		addColumn("serviceActionVO.fromPartyVO.code");
		columns.put("expectedStart", new ExtendedConfigurableTextFilteredPropertyColumn<Date>("expectedStart", new DateFilterBuilder(CUSTOM_DATE_FORMAT)));
		columns.put("expectedEnd", new ExtendedConfigurableTextFilteredPropertyColumn<Date>("expectedEnd", new DateFilterBuilder(CUSTOM_DATE_FORMAT)) { });
		columns.put("closedOn", new DateTimePropertyColumn(new ResourceModel("closedOn"), "closedOn") {
			...
		addColumn("expectedValue");
		columns.put("actualValue", new ExtendedConfigurableTextFilteredPropertyColumn(prefix + "actualValue", "actualValue",
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder(10)) {
					...
		columns.put("required", new BooleanColumn("required"));

		addColumn("org.organizationId");

		addColumn("carrierRemarks");
		addColumn("serviceOrderVO.reference1");

		addColumn("serviceAction.shipmentOrderVO.reference5");
		addColumn("serviceOrderVO.toPartyVO.countryVO.code");
		addColumn("serviceOrderVO.toPartyVO.postalCode");

		columns.put("serviceOrderVO.dateSetVO.plannedEndBefore", new ExtendedConfigurableTextFilteredPropertyColumn<Date>(prefix
				+ "serviceOrderVO.dateSetVO.plannedEndBefore", "serviceOrderVO.dateSetVO.plannedEndBefore", new DateFilterBuilder()));

		addColumn("serviceOrderVO.ExecutedBy2PartyVO.partyId");
		addColumn("serviceOrderVO.ExecutedByPartyVO.partyId");

		addColumn("serviceOrderVO.reference8");
		addColumn("serviceAction.shipmentOrderVO.reference1");
		addColumn("serviceOrderVO.reference2");
		addColumn("serviceOrderVO.reference3");

		addColumn("serviceOrderVO.remarks2");
		addColumn("shipmentItemVO.reference3");

		return columns;
/ columns=
{serviceOrderVO.serviceOrderId=com.mpobjects.event.view.wicket.event.AbstractEventListPage$3@1daa3fdd,
 serviceAction.shipmentOrderVO.reference10=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@383df68f,
 expectedStart=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@354e8a70,
 expectedValue=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@31832e67,
 closedOn=com.mpobjects.event.view.wicket.event.AbstractEventListPage$5@1cc85701,
 actualValue=com.mpobjects.event.view.wicket.event.AbstractEventListPage$6@7352c708,
 consignment=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@57c80b,
 remarks=com.mpobjects.event.view.wicket.event.AbstractEventListPage$1@5c1da48f,
 serviceAction.serviceActionType.code=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@29c4b59d,
 reportingLevel=com.mpobjects.event.view.wicket.event.AbstractEventListPage$2@53b2bbd7,
 partyVO.partyId=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@77118526,
 eventType.code=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@3fce0e8e,
 serviceActionVO.fromPartyVO.code=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@12d51be9,
 serviceAction.shipmentOrderVO.reference2=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@2dabaf1f,
 serviceAction.shipmentOrderVO.heaviestTopLevelShipmentItem.reference2=org.apache.wicket.extensions.markup.html.repeater.data.table.PropertyColumn@2e384024,
 expectedEnd=com.mpobjects.event.view.wicket.event.AbstractEventListPage$4@70730855}

/t
EventByEventTypePage(AbstractObjectListPage).processColumns() line: 164	
		HashMap<String, AbstractColumn> myAvailableColumns = getAllColumns();
/d

/ de titles rechts komen uit EventByEventPage.properties	,

myHeaders	String[17]  (id=22788)	
->	[0]	"eventType.code" (id=22791)										/ Event Type					
->	[1]	"serviceOrderVO.serviceOrderId" (id=22792)						/ Service order number
->	[2]	"serviceAction.shipmentOrderVO.reference2" (id=22793)			/ Shipment tracking number
->	[3]	"serviceAction.shipmentOrderVO.reference10" (id=22794)			/ Principal
->	[4]	"serviceAction.shipmentOrderVO.heaviestTopLevelShipmentItem.reference2" (id=22795) / Box tracking number
->	[5]	"expectedEnd" (id=22796)										/ expected end
->	[6]	"closedOn" (id=22797)											/ Closed on 
->	[7]	"actualValue" (id=22800)	
->	[8]	"remarks" (id=22801)	
->	[9]	"serviceAction.shipmentOrderVO.reference5" (id=22802)			/ Original Voyage 
->	[10]	"serviceOrderVO.toPartyVO.countryVO.code" (id=22803)		/ Ship to Country code
->	[11]	"serviceOrderVO.toPartyVO.postalCode" (id=22804)			/ Ship to Postal code
->	[12]	"serviceOrderVO.ExecutedByPartyVO.partyId" (id=22805)		/ Executed by	
->	[13]	"serviceOrderVO.dateSetVO.plannedEndBefore " (id=22806)		/ planned end before 
->	[14]	"serviceAction.shipmentOrderVO.reference1" (id=22807)		/ Reference1
->	[15]	"org.organizationId" (id=22808)								/ organization
->	[16]	"serviceAction.serviceActionType.code" (id=22809)			/ Service action type	

myAvailableColumns=
{serviceOrderVO.serviceOrderId=com.mpobjects.event.view.wicket.event.AbstractEventListPage$3@1296b8bf,
 expectedValue=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@653b0d21,
 closedOn=com.mpobjects.event.view.wicket.event.AbstractEventListPage$5@7db2573,
 actualValue=com.mpobjects.event.view.wicket.event.AbstractEventListPage$6@4477a50c,
 carrierRemarks=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@af4d9f2,
 remarks=com.mpobjects.event.view.wicket.event.AbstractEventListPage$1@5110a47c,
 reportingLevel=com.mpobjects.event.view.wicket.event.AbstractEventListPage$2@1b9ef278,
 serviceOrderVO.ExecutedByPartyVO.partyId=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@6040b272,
 partyVO.partyId=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@37838bbc,
 serviceActionVO.fromPartyVO.code=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@1d4b001d,
 eventType.code=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@26f47ef1,
 serviceAction.shipmentOrderVO.heaviestTopLevelShipmentItem.reference2=org.apache.wicket.extensions.markup.html.repeater.data.table.PropertyColumn@7dba1431,
 serviceOrderVO.toPartyVO.postalCode=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@4383dd73,
 serviceOrderVO.ExecutedBy2PartyVO.partyId=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@63fcba6,
 required=com.mpobjects.view.wicket.util.multi.BooleanColumn@4653027e,
 expectedStart=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@73c8c243,
 serviceAction.shipmentOrderVO.reference10=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@149f818,
 serviceOrderVO.reference1=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@1f3ef051,
 serviceOrderVO.reference2=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@5d1365dd,
 serviceOrderVO.reference3=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@2484bfe8,
 serviceOrderVO.remarks2=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@7532b13,
 consignment=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@6530f026,
 serviceOrderVO.reference8=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@6fe682b0,
 serviceAction.serviceActionType.code=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@68e2a35,
 serviceOrderVO.toPartyVO.countryVO.code=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@5f7500ef,
 serviceAction.shipmentOrderVO.reference1=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@7a907bde,
 serviceAction.shipmentOrderVO.reference2=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@23b46aaf,
 expectedEnd=com.mpobjects.event.view.wicket.event.AbstractEventListPage$4@19c81979,
 org.organizationId=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@20006428,
 serviceAction.shipmentOrderVO.reference5=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@79af8e81,
 shipmentItemVO.reference3=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@74b4f590,
 serviceOrderVO.dateSetVO.plannedEndBefore=com.mpobjects.view.wicket.util.multi.ExtendedConfigurableTextFilteredPropertyColumn@1465fccc}

		for (String myHeader : myHeaders) {
			AbstractColumn myColumn = myAvailableColumns.get(myHeader.trim());
			if (myColumn != null) {

				myColumns.add(myColumn);

/ Alle uit myHeaders worden add	, 

		return myColumns;
/t
EventByEventTypePage.<init>(int, Collection<EventStatus>, String, boolean) line: 165	
		final Collection<AbstractColumn<?>> myProcessedColumns = processColumns();
/d
/ Ook 17	, dus alle columns uit ons rijtje, uit application properties , zijn er 	,

		myColumns.add(new FilteredAbstractColumn(new ResourceModel("filter")) {
/ De 1ste column	, WH Filters	,
		myColumns.addAll(1, myProcessedColumns);
		IColumn[] myTColumns = (IColumn[]) myColumns.toArray(new IColumn[myColumns.size()]);

		DataTable myEventDataTable = new DataTable("dataTable", myTColumns, dataProvider, ApplicationPropertyManager.getInstance()
				.getModuleApplicationProperty("event", prefix + "itemsperpage", DEFAULT_MAX_SIZE)) {

/ Onthoud	,
/ 1 column uit EventByEventTypePage
/ alle andere columns uit AbstractEventListPage

		DataTable myEventDataTable = new DataTable("dataTable", myTColumns, dataProvider, ApplicationPropertyManager.getInstance()
				.getModuleApplicationProperty("event", prefix + "itemsperpage", DEFAULT_MAX_SIZE)) {
					...
 ApplicationPropertyManager.getInstance().getModuleApplicationProperty("event", prefix + "itemsperpage", DEFAULT_MAX_SIZE)==50
/ want	,
module.event.dashboard.itemsperpage=50

		final CheckGroup myGroup = new CheckGroup("group", new ArrayList());
		final FilterForm myForm = new FilterForm("form", dataProvider);
		ComponentFeedbackMessageFilter myFBFilter = new ComponentFeedbackMessageFilter(myForm);
		add(new FeedbackPanel("status", myFBFilter).setOutputMarkupId(true).setEscapeModelStrings(false));

		myEventDataTable.addTopToolbar(new NavigationToolbar(myEventDataTable));
		myEventDataTable.addTopToolbar(new HeadersToolbar(myEventDataTable, dataProvider));
		myEventDataTable.addTopToolbar(new FilterToolbar(myEventDataTable, myForm, dataProvider));
/s
/ stack trace	,
	EventDataProvider(GenericTableDataProvider).getFilterState() line: 184	
	FilterForm$FilterStateModel.getObject() line: 180	
	FilterForm(Component).getDefaultModelObject() line: 1729	
	EventByEventTypePage$1$1(GoAndClearFilter).<init>(String, FilterForm<?>, IModel<String>, IModel<String>) line: 74	
	EventByEventTypePage$1$1(GoAndClearFilter).<init>(String, FilterForm<?>) line: 54	
	EventByEventTypePage$1$1(MpoGoAndClearFilter).<init>(String, FilterForm, TableDataProviderInterface<T>) line: 42	
	EventByEventTypePage$1$1.<init>(EventByEventTypePage$1, String, FilterForm, TableDataProviderInterface) line: 169	
	EventByEventTypePage$1.getFilter(String, FilterForm) line: 169	
	FilterToolbar.<init>(DataTable<?>, FilterForm<T>, IFilterStateLocator<T>) line: 83	
	EventByEventTypePage.<init>(int, Collection<EventStatus>, String, boolean) line: 203	
/debug	,
/s
EventDataProvider(GenericTableDataProvider).getFilterState() line: 184	

this	EventDataProvider  (id=18678)	
	filter	GenericTableDataProvider$FilterStateFilterExpression  (id=18759)	
		parameters	ArrayList  (id=18771)	
[createdDate 2015-12-15 11:50:21.465 false GT, 
organizationSystemid [5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440] false IN, 
eventType.systemId 1 false EQ, 
eventStatus [OPEN_ALERTED] false IN, 
closedOn  false NULL, 
expectedEnd  true NULL, 
eventTemplateSystemid  true NULL, 
eventTemplateSystemid 0 true EQ, 
serviceOrderVO  true NULL]

		return filter.getModelProxy();
/s
GenericTableDataProvider$FilterStateFilterExpression.getModelProxy() line: 66	
			if (modelProxy == null) {
				createProxy();
/s
GenericTableDataProvider$FilterStateFilterExpression.createProxy() line: 93	
/ TODO

/t
EventByEventTypePage.<init>(int, Collection<EventStatus>, String, boolean) line: 165	
		myEventDataTable.addTopToolbar(new FilterToolbar(myEventDataTable, myForm, dataProvider));
/d
		myEventDataTable.addBottomToolbar(new NoRecordsToolbar(myEventDataTable));

		add(myForm);
		myForm.add(myGroup);

		myGroup.add(getButtons(myForm, myGroup));
/s
EventByEventTypePage.getButtons(FilterForm, CheckGroup) line: 247	
		final Button mySaveButton = new Button("saveEvent", new ResourceModel("save.event")) {
		final Button myGoBackButton = new Button("goBack", new ResourceModel("go.back")) {
		final Button myCloseButton = new Button("closeEvent", new ResourceModel("close.event")) {
		myButtonList.add(mySaveButton);
		myButtonList.add(myGoBackButton);
		myButtonList.add(myCloseButton);
		return myButtonList.toArray(new Button[] {});
/t
EventByEventTypePage.<init>(int, Collection<EventStatus>, String, boolean) line: 211	
		myGroup.add(getButtons(myForm, myGroup));
/d
		myGroup.add(myEventDataTable);
		myGroup.add(new CheckGroupButton("groupselectorCheckAll", "check"));
		myGroup.add(new CheckGroupButton("groupselectorClearAll", "clear"));
		myGroup.add(new CheckGroupButton("groupselectorInvertSelection", "invert"));
		myGroup.add(new Label("actualValueLabel", "Actual Value") {
			....
		TextField actualValue = new TextField<String>("actualValue", new PropertyModel<String>(this, "actualValue"));
		actualValue.setVisible(!isExpected);
		myGroup.add(actualValue);
/t
EventCacheSearchListPanel$2$1.onClick() line: 83	
/=
public class EventCacheSearchListPanel extends GenericListPanel<EventCacheVO> {
	protected void addFilterColumns(List<IColumn> aColumnList) {
		aColumnList.add(new ExtendedConfigurableTextFilteredPropertyColumn("openAlertCount", "openAlertCount", "openAlertCount",
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<Integer>(5)) {
			@Override
			public void populateItem(Item aCellItem, String aComponentId, IModel aModel) {
				final EventCacheVO item = (EventCacheVO) aModel.getObject();
				Link<EventVO> link = new Link<EventVO>("link", aModel) {
					@Override
					public void onClick() {
						EventByEventTypePage page = new EventByEventTypePage(item.getEventType().getSystemId(),
								Collections.singleton(EventStatus.OPEN_ALERTED), item.getEventType().getCode(), true);
/d
						setResponsePage(page);
/t
EventCacheSearchListPanel$2$1(Link).onLinkClicked() line: 226	
		onClick();
/d

/c
/ Welke query wordt er nu gedaan	?
/ TODO

/c
EventDataProvider.size() line: 67	
		int size = MpoBeanFactory.getBean(EventDAO.class).getConsolidatedEventCount(filter);
/s
EventDAOImpl.getConsolidatedEventCount(DAOFilterExpression<EventVO>) line: 272	
		return getConsolidatedEventList(new QueryParam(0, 0), filter).size();
/s
EventDAOImpl.getConsolidatedEventList(QueryParam, DAOFilterExpression<EventVO>) line: 1004	
		...
		createCriteria(myDetachedCriteria, filter, mySubMap);
filter.parameters=
[createdDate 2015-12-15 07:56:21.816 false GT, 
organizationSystemid [5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440] false IN, 
eventType.systemId 1 false EQ, 
eventStatus [OPEN_ALERTED] false IN, 
closedOn  false NULL, 
expectedEnd  true NULL, 
eventTemplateSystemid  true NULL, 
eventTemplateSystemid 0 true EQ, 
serviceOrderVO  true NULL]
		List<EventVO> eventList = getHibernateTemplate().findByCriteria(myDetachedCriteria);
eventList	java.util.ArrayList  (id=20736)	
	size	7896	

/ we zien in de log	,

select count(*)
from EVENT_EVENT this_ 
inner join EVENT_TYPE eventtype1_ on this_.EVENT_TYPE_SYSTEMID=eventtype1_.SYSTEM_ID 
where this_.CREATED_DATE>'2015-12-15 07:56:21.816' 
and this_.ORGANIZATION_SYSTEMID in ( 5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440) 
and eventtype1_.SYSTEM_ID=1 
and this_.EVENT_STATUS in ('OPEN_ALERTED') 
and this_.CLOSED_ON is null 
and not this_.EXPECTED_END is null 
and not this_.EVENT_TEMPLATE_SYSTEMID is null 
and not this_.EVENT_TEMPLATE_SYSTEMID=0 
and not this_.SERVICE_ORDER_SYSTEMID is null
       COUNT 
============ 
        7896 

/ Klopt	,



/ 7	. 

/ we geven in Shipment tracking number 'USN53700611291'
/ We click Fiter button	,
/ Deze is OK	,
/ Welke query wordt er gedaan	?

/ we zien in de log de query	,

2016-07-20 13:44:40,447 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-1:) 
--select this_.SYSTEM_ID as SYSTEM1_197_10_, this_.version as version197_10_, this_.EVENT_TE...TED_ON as CREATED20_89_7_, reasoncode13_.SYSTEM_ID as SYSTEM1_88_8_, reasoncode13_.REASON_CODE as REASON2_88_8_, reasoncode13_.DESCRIPTION as DESCRIPT3_88_8_, reasoncode13_.IS_DELETED as IS4_88_8_, instructio14_.SYSTEM_ID as SYSTEM1_128_9_, instructio14_.IS_DELETED as IS2_128_9_, instructio14_.CODE as CODE128_9_, instructio14_.DESCRIPTION as DESCRIPT4_128_9_ 
select count(*)
from EVENT_EVENT this_ 
inner join EVENT_TYPE eventtype1_ on this_.EVENT_TYPE_SYSTEMID=eventtype1_.SYSTEM_ID 
inner join SERVICE_ACTION serviceact2_ on this_.SERVICE_ACTION_SYSTEMID=serviceact2_.SYSTEM_ID 
inner join SHIPMENT_ORDER shipmentor3_ on serviceact2_.SHIPMENT_ORDER_SYSTEMID=shipmentor3_.SYSTEM_ID 
left outer join TMS_USER resource8_ on shipmentor3_.CREATED_BY_SYSTEMID=resource8_.SYSTEM_ID 
left outer join TMS_USER resource9_ on resource8_.CREATED_BY=resource9_.SYSTEM_ID 
left outer join TMS_USER resource10_ on shipmentor3_.ASSIGNEE_SYSTEMID=resource10_.SYSTEM_ID 
left outer join TMS_USER resource11_ on shipmentor3_.APPROVEDBY_SYSTEMID=resource11_.SYSTEM_ID 
left outer join TMS_USER resource12_ on shipmentor3_.POSTCALC_APPROVEDBY_SYSTEMID=resource12_.SYSTEM_ID
left outer join REASON_CODE reasoncode13_ on shipmentor3_.REASON_CODE_SYSTEMID=reasoncode13_.SYSTEM_ID 
left outer join INSTRUCTION_GROUP instructio14_ on shipmentor3_.INSTRUCTION_GROUP_SYSTEMID=instructio14_.SYSTEM_ID 
--where this_.CREATED_DATE>? 
where this_.CREATED_DATE>'2015-12-14 13:41:17.443'
--and this_.ORGANIZATION_SYSTEMID in (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) 
and this_.ORGANIZATION_SYSTEMID in ( 5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440) 
--and eventtype1_.SYSTEM_ID=? 
and eventtype1_.SYSTEM_ID=1
and this_.EVENT_STATUS in ('OPEN_ALERTED') 
and this_.CLOSED_ON is null 
and not this_.EXPECTED_END is null 
and not this_.EVENT_TEMPLATE_SYSTEMID is null 
and not this_.EVENT_TEMPLATE_SYSTEMID=0 
and lower(shipmentor3_.REFERENCE2) like '%usn53700611291%' 
;
2016-07-20 13:44:40,485 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-1:) binding parameter [1] as [TIMESTAMP] - 2015-12-14 13:41:17.443
2016-07-20 13:44:40,485 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-1:) binding parameter [2] as [INTEGER] - 5045
...
2016-07-20 13:44:40,485 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-1:) binding parameter [63] as [INTEGER] - 1
2016-07-20 13:44:40,485 DEBUG [org.hibernate.type.EnumType] (http-0.0.0.0-8080-1:) Binding 'OPEN_ALERTED' to parameter: 64
2016-07-20 13:44:40,485 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-1:) binding parameter [65] as [INTEGER] - 0
2016-07-20 13:44:40,485 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-1:) binding parameter [66] as [VARCHAR] - %usn53700611291%


/ 7	. 

/ we click getal onder 'Open Alert Count'	, bijv. in de POD rij	, 

/ MISSCHIEN	,
/ we zien in log	,
2016-07-20 07:29:22,342 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-6:) 
--select this_.SYSTEM_ID as SYSTEM1_197_1_, this_.version as version197_1_, this_.EVENT_TEMPLATE_SYSTEMID as EVENT3_197_1_, this_.CLOSE_ACTION_SYSTEMID as CLOSE4_197_1_, this_.EXPECTED_VALUE as EXPECTED5_197_1_, this_.EXPECTED_START_EXPR as EXPECTED6_197_1_, this_.EXPECTED_END_EXPR as EXPECTED7_197_1_, this_.EXPECTED_START as EXPECTED8_197_1_, this_.EXPECTED_END as EXPECTED9_197_1_, this_.CREATED_DATE as CREATED10_197_1_, this_.CLOSED_ON as CLOSED11_197_1_, this_.CLOSED_ON_SYSTEM as CLOSED12_197_1_, this_.CUSTOMER_INFORMED as CUSTOMER13_197_1_, this_.EXPORT_DATE as EXPORT14_197_1_, this_.PURPOSE_CODE as PURPOSE15_197_1_, this_.EVENT_STATUS as EVENT16_197_1_, this_.REPORTING_LEVEL as REPORTING17_197_1_, this_.ACTUAL_VALUE as ACTUAL18_197_1_, this_.REMARKS as REMARKS197_1_, this_.CARRIER_DATE as CARRIER20_197_1_, this_.CARRIER_REMARKS as CARRIER21_197_1_, this_.IS_PUBLIC as IS22_197_1_, this_.IS_REQUIRED as IS23_197_1_, this_.ALERTED as ALERTED197_1_, this_.VISIBLE as VISIBLE197_1_, this_.HANDLED as HANDLED197_1_, this_.ORGANIZATION_SYSTEMID as ORGANIZ27_197_1_, this_.REASON_CODE_SYSTEMID as REASON28_197_1_, this_.EVENT_TYPE_SYSTEMID as EVENT29_197_1_, this_.INDUCER_SYSTEMID as INDUCER30_197_1_, this_.PARTY_SYSTEMID as PARTY31_197_1_, this_.SERVICE_ORDER_SYSTEMID as SERVICE32_197_1_, this_.CONSIGNMENT_SYSTEMID as CONSIGN33_197_1_, this_.SERVICE_ACTION_SYSTEMID as SERVICE34_197_1_, this_.SERVICE_ORDER_CONT_SYSTEMID as SERVICE35_197_1_, this_.IS_SHIPMENT_ITEM_EVENT as IS36_197_1_, this_.SHIPMENT_ITEM_SYSTEM_ID as SHIPMENT37_197_1_, this_.EVENT_PARTY_ID as EVENT38_197_1_, this_.EVENT_PARTY_NAME as EVENT39_197_1_, this_.EVENT_PARTY_NAME2 as EVENT40_197_1_, this_.EVENT_PARTY_ADDRESS as EVENT41_197_1_, this_.EVENT_PARTY_ADDRESS2 as EVENT42_197_1_, this_.EVENT_PARTY_CITY as EVENT43_197_1_, this_.EVENT_PARTY_POSTAL_CODE as EVENT44_197_1_, this_.EVENT_PARTY_REGION_STATE as EVENT45_197_1_, this_.EVENT_PARTY_COUNTRY_SYSTEMID as EVENT46_197_1_, this_.EVENT_PARTY_PHONE_NUMBER as EVENT47_197_1_, this_.EVENT_PARTY_FAX_NUMBER as EVENT48_197_1_, this_.EVENT_PARTY_EMAIL_ADDRESS as EVENT49_197_1_, this_.EVENT_PARTY_CONTACT_NAME as EVENT50_197_1_, this_.EVENT_PARTY_TIME_ZONE as EVENT51_197_1_, eventtype1_.SYSTEM_ID as SYSTEM1_195_0_, eventtype1_.IS_DELETED as IS2_195_0_, eventtype1_.NAME as NAME195_0_, eventtype1_.DESCRIPTION as DESCRIPT4_195_0_, eventtype1_.DATA_TYPE as DATA5_195_0_, eventtype1_.DATA_CONSTRAINT as DATA6_195_0_, eventtype1_.ORDER_NR as ORDER7_195_0_, eventtype1_.IS_EXPORTABLE as IS8_195_0_, eventtype1_.PHONE_NUMBER as PHONE9_195_0_, eventtype1_.EMAIL_ADDRESS as EMAIL10_195_0_, eventtype1_.VISIBLE_ON_SECOND_EVENT as VISIBLE11_195_0_, eventtype1_.SHOW_ON_DASHBOARD as SHOW12_15_0_, eventtype1_.CAN_BE_CLOSED_BY_TYPES as CAN13_195_0_, eventtype1_.TIMEZONE_OPTION as TIMEZONE14_195_0_ 
select first 1 * 
from EVENT_EVENT this_ 
inner join EVENT_TYPE eventtype1_ on this_.EVENT_TYPE_SYSTEMID=eventtype1_.SYSTEM_ID 
--where this_.CREATED_DATE>? 
where this_.CREATED_DATE>'2015-12-14 07:28:51.494'
--and this_.ORGANIZATION_SYSTEMID in (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? , ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) 
and this_.ORGANIZATION_SYSTEMID in ( 5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440) 
--and eventtype1_.SYSTEM_ID=? 
and eventtype1_.SYSTEM_ID=1 
--and this_.EVENT_STATUS in (?) 
and this_.EVENT_STATUS in ('OPEN_ALERTED') 
and this_.CLOSED_ON is null 
and not this_.EXPECTED_END is null 
and not this_.EVENT_TEMPLATE_SYSTEMID is null 
--and not this_.EVENT_TEMPLATE_SYSTEMID=?
and not this_.EVENT_TEMPLATE_SYSTEMID=0
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [1] as [TIMESTAMP] - 2015-12-14 07:28:51.494
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [2] as [INTEGER] - 5045
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [3] as [INTEGER] - 5230
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [4] as [INTEGER] - 5040
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [5] as [INTEGER] - 5050
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [6] as [INTEGER] - 5550
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [7] as [INTEGER] - 5310
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [8] as [INTEGER] - 5400
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [9] as [INTEGER] - 3110
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [10] as [INTEGER] - 5450
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [11] as [INTEGER] - 5280
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [12] as [INTEGER] - 5070
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [13] as [INTEGER] - 5410
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [14] as [INTEGER] - 3100
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [15] as [INTEGER] - 3210
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [16] as [INTEGER] - 5600
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [17] as [INTEGER] - 5610
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [18] as [INTEGER] - 5620
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [19] as [INTEGER] - 3150
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [20] as [INTEGER] - 3200
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [21] as [INTEGER] - 3190
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [22] as [INTEGER] - 200
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [23] as [INTEGER] - 5540
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [24] as [INTEGER] - 5290
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [25] as [INTEGER] - 5080
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [26] as [INTEGER] - 5560
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [27] as [INTEGER] - 5300
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [28] as [INTEGER] - 5090
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [29] as [INTEGER] - 5460
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [30] as [INTEGER] - 5420
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [31] as [INTEGER] - 5100
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [32] as [INTEGER] - 5110
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [33] as [INTEGER] - 5470
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [34] as [INTEGER] - 5520
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [35] as [INTEGER] - 5120
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [36] as [INTEGER] - 5570
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [37] as [INTEGER] - 5020
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [38] as [INTEGER] - 5430
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [39] as [INTEGER] - 5125
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [40] as [INTEGER] - 5130
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [41] as [INTEGER] - 5140
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [42] as [INTEGER] - 5150
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [43] as [INTEGER] - 5160
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [44] as [INTEGER] - 5170
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [45] as [INTEGER] - 5030
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [46] as [INTEGER] - 5190
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [47] as [INTEGER] - 5200
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [48] as [INTEGER] - 5210
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [49] as [INTEGER] - 5500
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [50] as [INTEGER] - 5580
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [51] as [INTEGER] - 5530
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [52] as [INTEGER] - 5220
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [53] as [INTEGER] - 1084719
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [54] as [INTEGER] - 5240
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [55] as [INTEGER] - 5250
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [56] as [INTEGER] - 5320
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [57] as [INTEGER] - 5260
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [58] as [INTEGER] - 5270
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [59] as [INTEGER] - 5390
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [60] as [INTEGER] - 12123
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [61] as [INTEGER] - 5510
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [62] as [INTEGER] - 5440
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [63] as [INTEGER] - 1
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.EnumType] (http-0.0.0.0-8080-6:) Binding 'OPEN_ALERTED' to parameter: 64
2016-07-20 07:29:22,354 DEBUG [org.hibernate.type.descriptor.sql.BasicBinder] (http-0.0.0.0-8080-6:) binding parameter [65] as [INTEGER] - 0

/ we doen met de hand	,
SQL> select count(*)
CON> from EVENT_EVENT this_
CON> inner join EVENT_TYPE eventtype1_ on this_.EVENT_TYPE_SYSTEMID=eventtype1_.SYSTEM_ID
CON> --where this_.CREATED_DATE>?
CON> where this_.CREATED_DATE>'2015-12-14 07:28:51.494'
CON> --and this_.ORGANIZATION_SYSTEMID in (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? , ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
CON> and this_.ORGANIZATION_SYSTEMID in ( 5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440)
CON> --and eventtype1_.SYSTEM_ID=?
CON> and eventtype1_.SYSTEM_ID=1
CON> --and this_.EVENT_STATUS in (?)
CON> and this_.EVENT_STATUS in ('OPEN_ALERTED')
CON> and this_.CLOSED_ON is null
CON> and not this_.EXPECTED_END is null
CON> and not this_.EVENT_TEMPLATE_SYSTEMID is null
CON> --and not this_.EVENT_TEMPLATE_SYSTEMID=?
CON> and not this_.EVENT_TEMPLATE_SYSTEMID=0;

       COUNT 
============ 
        8600 

/ 7	. 

/ We hebben b's set in 
GenericTableDataProvider	,
PrefilteredTableDataProvider
EventDataProvider

// we click op Open Alert ... in Expected Events op event dashboard	,

/s
/ stack trace	,
	EventDataProvider(GenericTableDataProvider).getFilterState() line: 183	
		return filter.getModelProxy();
/cb
	FilterForm$FilterStateModel.getObject() line: 180	
			return locator.getFilterState();
/cb
	FilterForm(Component).getDefaultModelObject() line: 1729	
			return model.getObject();
/cb
	EventByEventTypePage$1$1(GoAndClearFilter).<init>(String, FilterForm<?>, IModel<String>, IModel<String>) line: 74	
		originalState = Objects.cloneModel(form.getDefaultModelObject());
/cb
	EventByEventTypePage$1$1(GoAndClearFilter).<init>(String, FilterForm<?>) line: 54	
		this(id, form, DEFAULT_GO_MODEL, DEFAULT_CLEAR_MODEL);
/cb
	EventByEventTypePage$1$1(MpoGoAndClearFilter).<init>(String, FilterForm, TableDataProviderInterface<T>) line: 42	
		super(anId, aForm);
/cb
	EventByEventTypePage$1$1.<init>(EventByEventTypePage$1, String, FilterForm, TableDataProviderInterface) line: 169	
				MpoGoAndClearFilter buttons = new MpoGoAndClearFilter(aComponentId, aForm, dataProvider) {
/cb
	EventByEventTypePage$1.getFilter(String, FilterForm) line: 169	
				MpoGoAndClearFilter buttons = new MpoGoAndClearFilter(aComponentId, aForm, dataProvider) {
/cb
	FilterToolbar.<init>(DataTable<?>, FilterForm<T>, IFilterStateLocator<T>) line: 83	
				filter = filteredCol.getFilter(FILTER_COMPONENT_ID, form);
/cb
	EventByEventTypePage.<init>(int, Collection<EventStatus>, String, boolean) line: 203	
		myEventDataTable.addTopToolbar(new FilterToolbar(myEventDataTable, myForm, dataProvider));
/cb
	EventCacheSearchListPanel$2$1.onClick() line: 83	
						EventByEventTypePage page = new EventByEventTypePage(item.getEventType().getSystemId(),
								Collections.singleton(EventStatus.OPEN_ALERTED), item.getEventType().getCode(), true);
/cb
	EventCacheSearchListPanel$2$1(Link).onLinkClicked() line: 225	
		onClick();
/ TODO

/ 7	. 

/c
/ stack trace	,
	EventDataProvider.size() line: 67	
	DataTable$1(DataViewBase).internalGetItemCount() line: 141	
	DataTable$1(AbstractPageableView).getItemCount() line: 258	
	DataTable$1(AbstractPageableView).getRowCount() line: 240	
	DataTable$1(AbstractPageableView).getViewSize() line: 352	
	DataTable$1(AbstractPageableView).getItemModels() line: 105	
	DataTable$1(RefreshingView).onPopulate() line: 94	
	DataTable$1(AbstractRepeater).onBeforeRender() line: 131	
	DataTable$1(AbstractPageableView).onBeforeRender() line: 121	
	DataTable$1(Component).internalBeforeRender() line: 1069	
	DataTable$1(Component).beforeRender() line: 1103	
	WebMarkupContainer(MarkupContainer).onBeforeRenderChildren() line: 1777	
	WebMarkupContainer(Component).onBeforeRender() line: 4001	
	WebMarkupContainer(Component).internalBeforeRender() line: 1069	
	WebMarkupContainer(Component).beforeRender() line: 1103	
	EventByEventTypePage$2(MarkupContainer).onBeforeRenderChildren() line: 1777	
	EventByEventTypePage$2(Component).onBeforeRender() line: 4001	
	EventByEventTypePage$2(Component).internalBeforeRender() line: 1069	
	EventByEventTypePage$2(Component).beforeRender() line: 1103	
	CheckGroup(MarkupContainer).onBeforeRenderChildren() line: 1777	
	CheckGroup(Component).onBeforeRender() line: 4001	
	CheckGroup(Component).internalBeforeRender() line: 1069	
	CheckGroup(Component).beforeRender() line: 1103	
	FilterForm(MarkupContainer).onBeforeRenderChildren() line: 1777	
	FilterForm(Component).onBeforeRender() line: 4001	
	FilterForm(Form).onBeforeRender() line: 2104	
	FilterForm(Component).internalBeforeRender() line: 1069	
	FilterForm(Component).beforeRender() line: 1103	
	EventByEventTypePage(MarkupContainer).onBeforeRenderChildren() line: 1777	
	EventByEventTypePage(Component).onBeforeRender() line: 4001	
	EventByEventTypePage(Page).onBeforeRender() line: 1555	
	EventByEventTypePage(Component).internalBeforeRender() line: 1069	
	EventByEventTypePage(Component).beforeRender() line: 1103	
	EventByEventTypePage(Component).prepareForRender(boolean) line: 2297	
	EventByEventTypePage(Page).prepareForRender(boolean) line: 1545	
	EventByEventTypePage(Component).prepareForRender() line: 2329	
	EventByEventTypePage(Page).renderPage() line: 912	
	MpoWebRequestCycle(WebRequestCycle).redirectTo(Page) line: 201	
	PageRequestTarget.respond(RequestCycle) line: 58	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	
/debug,	 
/s
EventDataProvider.size() line: 67	
		int size = MpoBeanFactory.getBean(EventDAO.class).getConsolidatedEventCount(filter);
/s
EventDAOImpl.getConsolidatedEventCount(DAOFilterExpression<EventVO>) line: 272	
		return getConsolidatedEventList(new QueryParam(0, 0), filter).size();
/s
EventDAOImpl.getConsolidatedEventList(QueryParam, DAOFilterExpression<EventVO>) line: 992	
		queryParam.setCount(0);
		/* We still have a problem with the filter mechanism, remove this linewhen done */
		CleanSvcOrder myCleaner = new CleanSvcOrder(filter);
/s
EventDAOImpl$CleanSvcOrder.<init>(DAOFilterExpression<EventVO>) line: 96	
				if (myParameter.getFieldName().equals("serviceOrderId") || myParameter.getFieldName().equals("serviceOrderVO")) {
myParameter=
serviceOrderVO  true NULL
					removedParam = myParameter;
			if (removedParam != null) {
				filter.removeParameter(removedParam);

			removedSO = filter.getLegacyFilter().getServiceOrderVO();
null
			} else {
				serviceOrderId = null;
/t
EventDAOImpl.getConsolidatedEventList(QueryParam, DAOFilterExpression<EventVO>) line: 995	
/=
	private List<EventVO> getConsolidatedEventList(QueryParam queryParam, DAOFilterExpression<EventVO> filter) {

queryParam	QueryParam  (id=18841)	
	count	0	
	first	0	
	sort	null	
	sortAsc	true	

/ Deze method doet NIETS met queryParam	,
/ TODO PAUL

filter	GenericTableDataProvider$FilterStateFilterExpression  (id=18819)	
	parameters	ArrayList  (id=18866)	
[createdDate 2015-12-16 07:41:40.834 false GT, 
organizationSystemid [5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440] false IN, 
eventType.systemId 1 false EQ, 
eventStatus [OPEN_ALERTED] false IN, 
closedOn  false NULL, 
expectedEnd  true NULL, 
eventTemplateSystemid  true NULL, 
eventTemplateSystemid 0 true EQ]

/ Intermezzo

/ De query wordt 	,

select count(*)
from EVENT_EVENT this_
inner join EVENT_TYPE eventtype1_ on this_.EVENT_TYPE_SYSTEMID=eventtype1_.SYSTEM_ID
where this_.CREATED_DATE>'2015-12-15 11:50:21.465'
and this_.ORGANIZATION_SYSTEMID in ( 5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440)
and eventtype1_.SYSTEM_ID=1
and this_.EVENT_STATUS in ('OPEN_ALERTED')
and this_.CLOSED_ON is null
and not this_.EXPECTED_END is null
and not this_.EVENT_TEMPLATE_SYSTEMID is null
and not this_.EVENT_TEMPLATE_SYSTEMID=0

/ Einde Intermezzo



		CleanSvcOrder myCleaner = new CleanSvcOrder(filter);
/d
		String myServiceOrderId = myCleaner.serviceOrderId;
null
		Map<String, DetachedCriteria> mySubMap = new HashMap<String, DetachedCriteria>();
		DetachedCriteria myDetachedCriteria = getBaseCriteria();
/s
EventDAOImpl(BaseHibernateDAO).getBaseCriteria() line: 275	
		return DetachedCriteria.forClass(type);
this	EventDAOImpl  (id=19366)	
	type	Class (com.mpobjects.event.event.model.EventVO) (id=12372)	
/t
EventDAOImpl.getConsolidatedEventList(QueryParam, DAOFilterExpression<EventVO>) line: 998	
		DetachedCriteria myDetachedCriteria = getBaseCriteria();
/d
DetachableCriteria(CriteriaImpl(com.mpobjects.event.event.model.EventVO:this[][]))

		createCriteria(myDetachedCriteria, filter, mySubMap);
/s
	/**
	 * Update the DetachedCriteria according to the filter expression
	 *
	 * Override in subclass when this generic solution does not suffice
	 *
	 * @param aSubCriteriaMap
	 *            This Map will be filled with the sub criteria in case any are created. This is important to know in
	 *            case sorting criteria are going to be added later. This logic was added to deal with a
	 *            "Duplicate association path exception".
/ TODO
	 *
	 */
EventDAOImpl(GenericHibernateDAO).createCriteria(DetachedCriteria, DAOFilterExpression<Type>, Map<String,DetachedCriteria>) line: 585	
/=
	protected void createCriteria(DetachedCriteria aDetachedCriteria, DAOFilterExpression<Type> aFilter, Map<String, DetachedCriteria> aSubCriteriaMap) {
		Map<String, DetachedCriteria> criteriaCache = aSubCriteriaMap;
{}
		for (Parameter myOriginal : aFilter.getParameters()) {
myOriginal	GenericDAOFilterExpression$ParameterImpl  (id=18650)	
	criterium	MatchOperation  (id=19868)	
GT
	fieldName	"createdDate" (id=19869)	
	inverted	false	
	value	Timestamp  (id=19803)	
2015-12-15 11:50:21.465

			Object myOriginalValue = myOriginal.getValue();
2015-12-15 11:50:21.465
				} else {
					myResolvedParameterList.add(myOriginal);

/ myResolvedParameterList bestaat steeds uit 1 elem	,

				for (Parameter myResolved : myResolvedParameterList) {
myResolved 	GenericDAOFilterExpression$ParameterImpl  (id=18650)	
	criterium	MatchOperation  (id=19868)	
GT
	fieldName	"createdDate" (id=19869)	
	inverted	false	
	value	Timestamp  (id=19803)	
2015-12-15 11:50:21.465

					CriteriaElement critElement = new CriteriaElement(aDetachedCriteria, myResolved.getFieldName());
					resolveCriteriaElement(critElement, aSubCriteriaMap, componentPaths);
/ Doet NIETS	, by createdDate	, er zit geen . in	,

					Object myPropertyValue = myResolved.getValue();
2015-12-15 11:50:21.465
					Property myProperty = Property.forName(critElement.getProperty());
createdDate
					Criterion myCriterion = null;
					switch (myResolved.getCriterium()) {
						case GT:
							myCriterion = myProperty.gt(myPropertyValue);
/ Property is een Hiberaate type	,
myCriterion	SimpleExpression  (id=19969)	
	ignoreCase	false	
	op	">" (id=19971)	
	propertyName	"createdDate" (id=19869)	
	value	Timestamp  (id=19803)	
2015-12-15 11:50:21.465

					if (myCriterion != null) {
						if (myResolved.isInverted()) {
/ NEE
						} else {
							destCriteria.add(myCriterion);

				myResolvedParameterList.clear();

/ volgende	,
		for (Parameter myOriginal : aFilter.getParameters()) {

myOriginal	GenericDAOFilterExpression$ParameterImpl  (id=18652)	
	criterium	MatchOperation  (id=20003)	
IN
	fieldName	"organizationSystemid" (id=20004)	
	inverted	false	
	value	ArrayList  (id=20005)	
[5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440]

			Object myOriginalValue = myOriginal.getValue();
				} else {
					myResolvedParameterList.add(myOriginal);

				for (Parameter myResolved : myResolvedParameterList) {

myResolved 	GenericDAOFilterExpression$ParameterImpl  (id=18652)	
	criterium	MatchOperation  (id=20003)	
IN
	fieldName	"organizationSystemid" (id=20004)	
	inverted	false	
	value	ArrayList  (id=20005)	
[5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440]

					switch (myResolved.getCriterium()) {
						case IN:
							} else {
								myCriterion = myProperty.in((Collection<?>) myPropertyValue);

					final DetachedCriteria destCriteria = critElement.getCriteria();
destCriteria	DetachedCriteria  (id=19792)	
	criteria	CriteriaImpl  (id=19795)	
		criterionEntries	ArrayList  (id=20094)	
[createdDate>2015-12-15 11:50:21.465]
/ van zonet	,
						} else {
							destCriteria.add(myCriterion);

				myResolvedParameterList.clear();

aDetachedCriteria	DetachedCriteria  (id=19792)	
	criteria	CriteriaImpl  (id=19795)	
		criterionEntries	ArrayList  (id=20094)	
[createdDate>2015-12-15 11:50:21.465, 
organizationSystemid in (5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440)]

/ volgende	,
		for (Parameter myOriginal : aFilter.getParameters()) {
myOriginal=
eventType.systemId 1 false EQ

				} else {
					myResolvedParameterList.add(myOriginal);
				}

				for (Parameter myResolved : myResolvedParameterList) {

					CriteriaElement critElement = new CriteriaElement(aDetachedCriteria, myResolved.getFieldName());
					resolveCriteriaElement(critElement, aSubCriteriaMap, componentPaths);
/s
EventDAOImpl(GenericHibernateDAO).resolveCriteriaElement(CriteriaElement, Map<String,DetachedCriteria>, Map<String,Boolean>) line: 1083	

		String propName = aElement.getProperty();
eventType.systemId
		int idx = propName.indexOf('.');
9
		ClassMetadata currentMeta = getHibernateClassMeta();
SingleTableEntityPersister(com.mpobjects.event.event.model.EventVO)

		while (idx > -1) {
			// subCritName is the part before the .
			String subCritName = propName.substring(0, idx);
eventType
			propertyPath.append(subCritName);
eventType

			// update prop name with the part after the .
			propName = propName.substring(idx + 1);
systemId
			idx = propName.indexOf('.');
-1
			// figure out if we're addressing an component
			String partialPath = propertyPath.toString();
entityType
				try {
					fieldType = currentMeta.getPropertyType(subCritName);
org.hibernate.type.ManyToOneType(com.mpobjects.event.model.entity.eventtype.EventType)

				aComponentPaths.put(partialPath, isComponent);
entittyType=false
			} else {
				destCriteria = destCriteria.createCriteria(subCritName);
/ child	,
criteria	CriteriaImpl$Subcriteria  (id=20206)	
	path	"eventType" (id=20187)	
	parent	CriteriaImpl  (id=19795)	
		entityOrClassName	"com.mpobjects.event.event.model.EventVO" (id=20095)	
		criterionEntries	ArrayList  (id=20094)	
[createdDate>2015-12-15 11:50:21.465, 
organizationSystemid in (5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440)]

				aSubCriteriaMap.put(propertyPath.toString(), destCriteria);

		// We're finally done
		aElement.setCriteria(destCriteria);
		aElement.setProperty(propName);
/t
EventDAOImpl(GenericHibernateDAO).createCriteria(DetachedCriteria, DAOFilterExpression<Type>, Map<String,DetachedCriteria>) line: 631	
				for (Parameter myResolved : myResolvedParameterList) {
					CriteriaElement critElement = new CriteriaElement(aDetachedCriteria, myResolved.getFieldName());
					resolveCriteriaElement(critElement, aSubCriteriaMap, componentPaths);
/d
this	EventDAOImpl  (id=19366)	
aDetachedCriteria	DetachedCriteria  (id=19792)	
	criteria	CriteriaImpl  (id=19795)	
		criterionEntries	ArrayList  (id=20094)	
[createdDate>2015-12-15 11:50:21.465, 
organizationSystemid in (5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440)]

		entityOrClassName	"com.mpobjects.event.event.model.EventVO" (id=20095)	
		subcriteriaList	ArrayList  (id=20243)	
			elementData	Object[10]  (id=20268)	
				[0]	CriteriaImpl$Subcriteria  (id=20206)	
					parent	CriteriaImpl  (id=19795)	
					path	"eventType" (id=20187)	
			size	1	

					Object myPropertyValue = myResolved.getValue();
1
					Property myProperty = Property.forName(critElement.getProperty());
systemId
					switch (myResolved.getCriterium()) {
						case EQ:
							} else {
								myCriterion = myProperty.eq(myPropertyValue);

					final DetachedCriteria destCriteria = critElement.getCriteria();
///////////////////////////////////////
/ Dit is de child criteria	,
						} else {
							destCriteria.add(myCriterion);
				myResolvedParameterList.clear();

						} else {
							destCriteria.add(myCriterion);
				myResolvedParameterList.clear();

this	EventDAOImpl  (id=19366)	
aDetachedCriteria	DetachedCriteria  (id=19792)	
	criteria	CriteriaImpl  (id=19795)	
		criterionEntries	ArrayList  (id=20094)	
[createdDate>2015-12-15 11:50:21.465, 
organizationSystemid in (5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440), 
systemId=1]
		entityOrClassName	"com.mpobjects.event.event.model.EventVO" (id=20095)	
		subcriteriaList	ArrayList  (id=20243)	
			elementData	Object[10]  (id=20268)	
				[0]	CriteriaImpl$Subcriteria  (id=20206)	
					alias	null	
					hasRestriction	true	
					joinType	0	
					lockMode	null	
					parent	CriteriaImpl  (id=19795)	
					path	"eventType" (id=20187)	
					this$0	CriteriaImpl  (id=19795)	
					withClause	null	
			size	1	

/ TODO (Hoe sub criteria?)
/ volgende,	
/c
/ Aan het eind	,

this	EventDAOImpl  (id=19366)	
aDetachedCriteria	DetachedCriteria  (id=19792)	
	criteria	CriteriaImpl  (id=19795)	
		criterionEntries	ArrayList  (id=20094)	
[createdDate>2015-12-15 11:50:21.465, 
organizationSystemid in (5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440), 
systemId=1, 
eventStatus in (OPEN_ALERTED), 
closedOn is null, not expectedEnd is null, 
not eventTemplateSystemid is null, 
not eventTemplateSystemid=0]
		subcriteriaList	ArrayList  (id=20243)	
			elementData	Object[10]  (id=20268)	
				[0]	CriteriaImpl$Subcriteria  (id=20206)	
					alias	null	
					hasRestriction	true	
					joinType	0	
					lockMode	null	
					parent	CriteriaImpl  (id=19795)	
					path	"eventType" (id=20187)	
					this$0	CriteriaImpl  (id=19795)	
					withClause	null	
			size	1	
/t
EventDAOImpl.getConsolidatedEventList(QueryParam, DAOFilterExpression<EventVO>) line: 999	
		createCriteria(myDetachedCriteria, filter, mySubMap);
/d
myDetachedCriteria, is created	, see hier vlak boven	,

		List<EventVO> eventList = getHibernateTemplate().findByCriteria(myDetachedCriteria);
eventList	ArrayList  (id=20475)	
	elementData	Object[9369]  (id=20478)	
	size	7896	

/ we zien in log	,
--select ...
select count(*)
from EVENT_EVENT this_ 
inner join EVENT_TYPE eventtype1_ on this_.EVENT_TYPE_SYSTEMID=eventtype1_.SYSTEM_ID 
where this_.CREATED_DATE>'2015-12-15 11:50:21.465' 
and this_.ORGANIZATION_SYSTEMID in ( 5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440) 
and eventtype1_.SYSTEM_ID=1 
and this_.EVENT_STATUS in ('OPEN_ALERTED') 
and this_.CLOSED_ON is null 
and not this_.EXPECTED_END is null 
and not this_.EVENT_TEMPLATE_SYSTEMID is null 
and not this_.EVENT_TEMPLATE_SYSTEMID=0
;
       COUNT 
============ 
        7896 

		List<EventVO> consolidatedList = new EventConsolidator().getConsolidatedEvents(eventList);
/s
EventConsolidator.getConsolidatedEvents(List<EventVO>) line: 16	
/=
	public List<EventVO> getConsolidatedEvents(List<EventVO> eventsList) {

		ListIterator<EventVO> iter = eventsList.listIterator();
		while (iter.hasNext()) {
			EventVO eventVO = iter.next();
			} else {
				if (seenList.contains(eventVO)) {
					// has been consolidated
					continue;
				}
				seenList.add(eventVO);
[Event id: [123183832], event type: [POD], status: [OPEN_ALERTED]]
				result.add(eventVO);
[Event id: [123183832], event type: [POD], status: [OPEN_ALERTED]]

				ListIterator<EventVO> sublist = eventsList.listIterator(iter.nextIndex());
				while (sublist.hasNext()) {
					EventVO otherEvent = sublist.next();
					if (canConsolidate(eventVO, otherEvent)) {
/ JA	,
eventVO=
Event id: [123183832], event type: [POD], status: [OPEN_ALERTED]
eventType=POD
serviceOrder=N2964254/123183782
otherVO=
Event id: [123183789], event type: [POD], status: [OPEN_ALERTED]
eventType=POD
serviceOrder=N2964254/123183782

						seenList.add(otherEvent);
[Event id: [123183832], event type: [POD], status: [OPEN_ALERTED], 
Event id: [123183789], event type: [POD], status: [OPEN_ALERTED]]

						consolidatedEvents.add(otherEvent);
[Event id: [123183789], event type: [POD], status: [OPEN_ALERTED]]
				eventVO.setConsolidatedEventsList(consolidatedEvents);

/volgende	,
		while (iter.hasNext()) {
/c
		return result;
result	ArrayList  (id=20529)	
	size	7876	
/t
EventDAOImpl.getConsolidatedEventList(QueryParam, DAOFilterExpression<EventVO>) line: 1005	
		List<EventVO> consolidatedList = new EventConsolidator().getConsolidatedEvents(eventList);
/d
consolidatedList	ArrayList  (id=20529)	
	size	7876	

		myCleaner.restore();
		return consolidatedList;
/t
EventDataProvider.size() line: 67	
		int size = MpoBeanFactory.getBean(EventDAO.class).getConsolidatedEventCount(filter);
7876
		if (size > getMaxResult()) {
JA	, 
>1000
			return getMaxResult();

/c
/ stack	,
	EventDataProvider.iterator(int, int) line: 52	
	DataViewBase$ModelIterator.<init>(IDataProvider<T>, int, int) line: 109	
	DataTable$1(DataViewBase).getItemModels(int, int) line: 76	
	DataTable$1(AbstractPageableView).getItemModels() line: 107	
	DataTable$1(RefreshingView).onPopulate() line: 94	
	DataTable$1(AbstractRepeater).onBeforeRender() line: 131	
	DataTable$1(AbstractPageableView).onBeforeRender() line: 121	
	DataTable$1(Component).internalBeforeRender() line: 1069	
	DataTable$1(Component).beforeRender() line: 1103	
	WebMarkupContainer(MarkupContainer).onBeforeRenderChildren() line: 1777	
	WebMarkupContainer(Component).onBeforeRender() line: 4001	
	WebMarkupContainer(Component).internalBeforeRender() line: 1069	
	WebMarkupContainer(Component).beforeRender() line: 1103	
	EventByEventTypePage$2(MarkupContainer).onBeforeRenderChildren() line: 1777	
	EventByEventTypePage$2(Component).onBeforeRender() line: 4001	
	EventByEventTypePage$2(Component).internalBeforeRender() line: 1069	
	EventByEventTypePage$2(Component).beforeRender() line: 1103	
	CheckGroup(MarkupContainer).onBeforeRenderChildren() line: 1777	
	CheckGroup(Component).onBeforeRender() line: 4001	
	CheckGroup(Component).internalBeforeRender() line: 1069	
	CheckGroup(Component).beforeRender() line: 1103	
	FilterForm(MarkupContainer).onBeforeRenderChildren() line: 1777	
	FilterForm(Component).onBeforeRender() line: 4001	
	FilterForm(Form).onBeforeRender() line: 2104	
	FilterForm(Component).internalBeforeRender() line: 1069	
	FilterForm(Component).beforeRender() line: 1103	
	EventByEventTypePage(MarkupContainer).onBeforeRenderChildren() line: 1777	
	EventByEventTypePage(Component).onBeforeRender() line: 4001	
	EventByEventTypePage(Page).onBeforeRender() line: 1555	
	EventByEventTypePage(Component).internalBeforeRender() line: 1069	
	EventByEventTypePage(Component).beforeRender() line: 1103	
	EventByEventTypePage(Component).prepareForRender(boolean) line: 2297	
	EventByEventTypePage(Page).prepareForRender(boolean) line: 1545	
	EventByEventTypePage(Component).prepareForRender() line: 2329	
	EventByEventTypePage(Page).renderPage() line: 912	
	MpoWebRequestCycle(WebRequestCycle).redirectTo(Page) line: 201	
	PageRequestTarget.respond(RequestCycle) line: 58	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	
/ debug	,
/s
EventDataProvider.iterator(int, int) line: 52	
/=
	public Iterator<EventVO> iterator(final int first, final int count) {
first=0
count=50
		SortParam mySortParam = getSort();
mySortParam	SortParam  (id=20749)	
	asc	true	
	property	"systemId" (id=18675)	

		if (queryParam == null) {
/ JA
			queryParam = new QueryParam(first, count, mySortParam.getProperty(), mySortParam.isAscending());

		List<EventVO> myResult = MpoBeanFactory.getBean(EventDAO.class).getConsolidatedEvent(queryParam, filter, first, count);
/s
EventDAOImpl.getConsolidatedEvent(QueryParam, DAOFilterExpression<EventVO>, int, int) line: 260	
		List<EventVO> aEventList = getConsolidatedEventList(queryParam, filter);
queryParam	QueryParam  (id=20757)	
	count	50							
	first	0	
	sort	"systemId" (id=18675)	
	sortAsc	true	

/ Dezelfde call als bij count	, maar toen hadden we ipv. queryParam	,
new QueryParam(0,0)

/s
	private List<EventVO> getConsolidatedEventList(QueryParam queryParam, DAOFilterExpression<EventVO> filter) {
		queryParam.setCount(0);

/ count wordt toch op 0 gezet	, 
/ queryParam wordt helemaal NIET used	,
...
aEventList	ArrayList  (id=20772)	
	size	7876	
/ Precies hetzelfde als bij getConsolidatedEventCount	, dezelfde filter	, queryParam is iets anders	(met sort op systemId, asc), maar wordt niet used	,

/ Intermezzo


class EventDataProvider
    @Override
    public Iterator<EventVO> iterator(final int first, final int count) {
        SortParam mySortParam = getSort();
            queryParam = new QueryParam(first, count, mySortParam.getProperty(), mySortParam.isAscending());
        List<EventVO> myResult = MpoBeanFactory.getBean(EventDAO.class).getConsolidatedEvent(queryParam, filter, first, count);

    public int size() {
        int size = MpoBeanFactory.getBean(EventDAO.class).getConsolidatedEventCount(filter);


class EventDAOImpl 
    @Override
    public int getConsolidatedEventCount(DAOFilterExpression<EventVO> filter) {
        return getConsolidatedEventList(new QueryParam(0, 0), filter).size();
    }
    @Override
    public List<EventVO> getConsolidatedEvent(QueryParam queryParam, DAOFilterExpression<EventVO> filter, int first, int count) {
        List<EventVO> aEventList = getConsolidatedEventList(queryParam, filter);

    private List<EventVO> getConsolidatedEventList(QueryParam queryParam, DAOFilterExpression<EventVO> filter) {


/ Einde Intermezzo

/c

/ 7. 	

/ we geven in filter op Shipment tracking number : USN53700612200, en geven Enter	,
/=	[2]	"serviceAction.shipmentOrderVO.reference2" (id=22793)			/ Shipment tracking number
/s
FilterForm(Form).onFormSubmitted() line: 886	

				else
				{
					// this is the root form
					Form<?> formToProcess = this;

					// find out whether it was a nested form that was submitted
					if (submittingComponent != null)
					{
						formToProcess = submittingComponent.getForm();
					}

					// process the form for this request
					formToProcess.process(submittingComponent);
submittingComponent	GoFilter$1  (id=19459)	
/s
/ stack
	EventDataProvider(GenericTableDataProvider).getFilterState() line: 183	
	FilterForm$FilterStateModel.getObject() line: 180	
	PropertyModel(AbstractPropertyModel).getTarget() line: 206	
	PropertyModel(AbstractPropertyModel).getObject() line: 127	
	TextField(Component).getDefaultModelObject() line: 1729	
	Component$3.compare(Component, Object) line: 554	
	TextField(Component).setDefaultModelObject(Object) line: 3167	
	TextField(FormComponent).updateModel() line: 1183	
	Form$FormModelUpdateVisitor.component(Component) line: 231	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 519	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrder(Component, IVisitor<Component>) line: 470	
	FilterForm(Form).internalUpdateFormComponentModels() line: 2158	
	FilterForm(Form).updateFormComponentModels() line: 2126	
	FilterForm(Form).process() line: 1051	
	FilterForm(Form).process(IFormSubmittingComponent) line: 957	
	FilterForm(Form).onFormSubmitted() line: 922	
/ debug	,
/s
EventDataProvider(GenericTableDataProvider).getFilterState() line: 183	
		return filter.getModelProxy();
filter=
[createdDate 2015-12-16 07:41:40.834 false GT, organizationSystemid [5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440] false IN, eventType.systemId 1 false EQ, eventStatus [OPEN_ALERTED] false IN, closedOn  false NULL, expectedEnd  true NULL, eventTemplateSystemid  true NULL, eventTemplateSystemid 0 true EQ, serviceOrderVO  true NULL]

/ BREAKPOINTS DISABLE
GenericTableDataProvider$FilterStateFilterExpression [line: 111] - getFieldName(String)	
GenericTableDataProvider [line: 183] - getFilterState()	
GenericTableDataProvider$FilterStateFilterExpression$1 [line: 98] - invoke(MethodInvocation)	
GenericTableDataProvider$FilterStateFilterExpression [line: 119] - intercept(Method, Object[])	

/c
/ stack	,
	GoFilter$1.onSubmit() line: 71	
	FilterForm(Form).delegateSubmit(IFormSubmittingComponent) line: 1591	
	FilterForm(Form).process(IFormSubmittingComponent) line: 960	
	FilterForm(Form).onFormSubmitted() line: 922	

/c
/ stack
	EventDataProvider.size() line: 67	
	DataTable$1(DataViewBase).internalGetItemCount() line: 141	
	DataTable$1(AbstractPageableView).getItemCount() line: 258	
	DataTable$1(AbstractPageableView).getRowCount() line: 240	
	DataTable$1(AbstractPageableView).getViewSize() line: 352	
	DataTable$1(AbstractPageableView).getItemModels() line: 105	
	DataTable$1(RefreshingView).onPopulate() line: 94	
	DataTable$1(AbstractRepeater).onBeforeRender() line: 131	
	DataTable$1(AbstractPageableView).onBeforeRender() line: 121	
	DataTable$1(Component).internalBeforeRender() line: 1069	
	DataTable$1(Component).beforeRender() line: 1103	
	WebMarkupContainer(MarkupContainer).onBeforeRenderChildren() line: 1777	
	WebMarkupContainer(Component).onBeforeRender() line: 4001	
	WebMarkupContainer(Component).internalBeforeRender() line: 1069	
	WebMarkupContainer(Component).beforeRender() line: 1103	
	EventByEventTypePage$2(MarkupContainer).onBeforeRenderChildren() line: 1777	
	EventByEventTypePage$2(Component).onBeforeRender() line: 4001	
	EventByEventTypePage$2(Component).internalBeforeRender() line: 1069	
	EventByEventTypePage$2(Component).beforeRender() line: 1103	
	CheckGroup(MarkupContainer).onBeforeRenderChildren() line: 1777	
	CheckGroup(Component).onBeforeRender() line: 4001	
	CheckGroup(Component).internalBeforeRender() line: 1069	
	CheckGroup(Component).beforeRender() line: 1103	
	FilterForm(MarkupContainer).onBeforeRenderChildren() line: 1777	
	FilterForm(Component).onBeforeRender() line: 4001	
	FilterForm(Form).onBeforeRender() line: 2104	
	FilterForm(Component).internalBeforeRender() line: 1069	
	FilterForm(Component).beforeRender() line: 1103	
	EventByEventTypePage(MarkupContainer).onBeforeRenderChildren() line: 1777	
	EventByEventTypePage(Component).onBeforeRender() line: 4001	
	EventByEventTypePage(Page).onBeforeRender() line: 1555	
	EventByEventTypePage(Component).internalBeforeRender() line: 1069	
	EventByEventTypePage(Component).beforeRender() line: 1103	
	EventByEventTypePage(Component).prepareForRender(boolean) line: 2297	
	EventByEventTypePage(Page).prepareForRender(boolean) line: 1545	
	EventByEventTypePage(Component).prepareForRender() line: 2329	
	EventByEventTypePage(Page).renderPage() line: 912	
	MpoWebRequestCycle(WebRequestCycle).redirectTo(Page) line: 201	
	ListenerInterfaceRequestTarget(PageRequestTarget).respond(RequestCycle) line: 58	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	
/ debug	,
/s
EventDataProvider.size() line: 67	
		int size = MpoBeanFactory.getBean(EventDAO.class).getConsolidatedEventCount(filter);
filter
	parameters
[createdDate 2015-12-16 07:41:40.834 false GT, 
organizationSystemid [5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440] false IN, 
eventType.systemId 1 false EQ, 
eventStatus [OPEN_ALERTED] false IN, 
closedOn  false NULL, 
expectedEnd  true NULL, 
eventTemplateSystemid  true NULL, 
eventTemplateSystemid 0 true EQ, 
serviceOrderVO  true NULL, 
serviceAction /NO SERVICE ACTION TYPE!!!/0 false EQ]
/s
EventDAOImpl.getConsolidatedEventList(QueryParam, DAOFilterExpression<EventVO>) line: 992	
/=
	private List<EventVO> getConsolidatedEventList(QueryParam queryParam, DAOFilterExpression<EventVO> filter) {
		DetachedCriteria myDetachedCriteria = getBaseCriteria();
		createCriteria(myDetachedCriteria, filter, mySubMap);
/s
EventDAOImpl(GenericHibernateDAO).createCriteria(DetachedCriteria, DAOFilterExpression<Type>, Map<String,DetachedCriteria>) line: 585	
		for (Parameter myOriginal : aFilter.getParameters()) {


myOriginal	GenericDAOFilterExpression$ParameterImpl  (id=20301)	
	criterium	MatchOperation  (id=20286)	
EQ
	fieldName	"serviceAction" (id=19555)	
	inverted	false	
	value	ServiceActionVO  (id=19556)	
/=
/NO SERVICE ACTION TYPE!!!/0
/=
//////////////////////////////////////////////////////////////
anObject	ServiceActionVO  (id=19556)	
	shipmentOrderVO	ShipmentOrderVO  (id=20426)	
		theReference2	"USN53700612200" (id=20632)	

				// First check if the value of the parameter is an Object
				if (myOriginalValue instanceof EntityInterface && !(myOriginalValue instanceof HibernateComponent)) {
					myResolvedParameterList.addAll(expandParameter((EntityInterface) myOriginalValue, myOriginal, ""));
/s
EventDAOImpl(GenericHibernateDAO).expandParameter(EntityInterface, Parameter, String) line: 730	

		ClassMetadata myCmd = getHibernateTemplate().getSessionFactory().getClassMetadata(anObject.getClass());
		if (myCmd != null) {
			for (String prop : myCmd.getPropertyNames()) {
				properties.add(prop);
prop=
[avgLeadTimeHrs, dateSetVO, preferredServiceOrderVO, handlingInstructions, serviceActionId, fromPartyVO, temporary, executionSequence, remarks, serviceActionType, planningMode, reference2, shipmentOrderVO, reference1, orderStatusVO, consignmentVO, toPartyVO, manuallyUnplanned, sequenceNr, reference5, reference4, reference3, serviceActionTemplate]

		for (Method method : anObject.getClass().getMethods()) {
public java.lang.String com.mpobjects.oms.model.serviceaction.vo.ServiceActionVO.getRemarks()

'			String fieldName = StringUtils.firstCharToLower(match.group(2));
remarks
				value = method.invoke(anObject, (Object[]) null);
""
anObject=
/NO SERVICE ACTION TYPE!!!/0
				} else if (value instanceof String) {
					if (StringUtils.isEmpty((String) value)) {
						continue;

/ volgende	,
		for (Method method : anObject.getClass().getMethods()) {
public com.mpobjects.oms.model.entity.entitydetailtype.EntityType com.mpobjects.oms.model.serviceaction.vo.ServiceActionVO.getEntity()
			// TODO check default value
			if (method.getReturnType().isEnum()) {
				LOG.debug("[" + method + "] return type is enum");
				continue;
			}
/ volgende	,
		for (Method method : anObject.getClass().getMethods()) {
public com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO com.mpobjects.oms.model.serviceaction.vo.ServiceActionVO.getShipmentOrderVO()
			String fieldName = StringUtils.firstCharToLower(match.group(2));
shipmentOrderVO
			try {
				value = method.invoke(anObject, (Object[]) null);
value	ShipmentOrderVO  (id=20426)	
	theReference2	"USN53700612200" (id=20632)	

				else {
					// property1.property2.property3
					if (value instanceof EntityInterface) {
						// Has to be updated to handle property1.2.3.4.etc
						myList.addAll(expandParameter((EntityInterface) value, anOriginalParameter, anOriginalParameter.getFieldName() + "." + fieldName));
//////////////////////////////////////////////
/ recursive call	,
value	ShipmentOrderVO  (id=20426)	
	theReference2	"USN53700612200" (id=20632)	
nOriginalParameter	GenericDAOFilterExpression$ParameterImpl  (id=20301)	
	criterium	MatchOperation  (id=20286)	
	fieldName	"serviceAction" (id=19555)	
	inverted	false	
	value	ServiceActionVO  (id=19556)	
value	ServiceActionVO  (id=19556)	
	shipmentOrderVO	ShipmentOrderVO  (id=20426)	
		theReference2	"USN53700612200" (id=20632)	
anOriginalParameter.getFieldName() + "." + fieldName)=serviceAction.shipmentOrderVO
/s
EventDAOImpl(GenericHibernateDAO).expandParameter(EntityInterface, Parameter, String) line: 730	

		ClassMetadata myCmd = getHibernateTemplate().getSessionFactory().getClassMetadata(anObject.getClass());
		if (myCmd != null) {
			for (String prop : myCmd.getPropertyNames()) {
				properties.add(prop);
[requestedTotalLoadingMeters, billOfLadingNr, cashOnDelivery, payWeight, shipmentOrderParties, shipmentType, preferedPath, cashOnDeliveryCurrencyVO, incotermsReference, requestedTotalColli, reference10, lockPrecalculation, priceCurrencyVO, scheduleDescription, customerContractSystemId, employeeResponsiblePartyVO, template, postCalcApprovedOnDate, productItemList, syncBillToFlag, backupSheetReportName, costCurrency, airportVO, price, createdBy, genericCarrierShipmentOrderData, syncFromFlag, incoTermVO, lastUpdate, approvePostcalculation, entityGroup, approvedBy, actualServiceLevelVO, requestedTotalValue, syncEmployeeResponsibleFlag, requestedTotalWeightKg, orderProcess, lockPostcalculation, remarks2, instructionList, dateSetVO, overrideAddressValidation, authorizationCodes, originalSystemEntryDate, holdDescription, shipmentItemList, lockedByProcess, preferedPartyVO, cashOnDeliveryDone, toPartyVO, systemEntryDate, chargeTimeWindowYn, approvePrecalculation, requestedServiceLevelVO, notUpdatableByInterface, emission, shipmentOrderId, shipmentOrderPricePartList, scheduleXml, lastInstanceDate, screenId, costMethod, notifyTo, approvalStatus, dangerousGoodsYn, holdStatus, recurring, customerOrderNumber, serviceActionList, organizationVO, postCalcApprovedBy, deleted, cost, requestedTotalItems, shipmentOrderTemplate, orderStatusVO, returnCreated, customerStatus, approvalTemplate, approvedOnDate, priceMethod, requestedTotalVolumeM3, importExportInfo, temporary, reasonCode, requestedAltTotalValue, remarks, instructionGroupVO, calculationLog, reference2, reference1, actionApprovalStatus, reference9, reference8, shipmentOrderCostPartList, reference7, reference6, reference5, reference4, reference3, entityDetails, fromPartyVO, ratecalcMd5Hash, assignee, consolidationKey, billToPartyVO, altValueCurrencyVO, salesOrganization, valueCurrencyVO, syncToFlag]
/ H. properties	,

/ Hieronder alle properties: anObject.getClass().getMethods() moet een getter zijn	, dan hebben we een property	, en dan check of het een H. property is	, dat zijn de properties hierboven	,
//////////////////////////////////////////////////////////////////////////
/ dus loops over alle class properties	, die H. properties zijn	,

public java.math.BigDecimal com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO.getLoadFactor()
...
		for (Method method : anObject.getClass().getMethods()) {
->			Matcher match = GETTER.matcher(method.getName());

			if (!properties.contains(fieldName)) {
				continue;
			}



/ we set conditional b op ->	, 
GenericHibernateDAO [line: 743] [conditional] - expandParameter(EntityInterface, Parameter, String)	
method.getName().equals("getReference2")

method=
public java.lang.String com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO.getReference2()

			String fieldName = StringUtils.firstCharToLower(match.group(2));
reference2
				value = method.invoke(anObject, (Object[]) null);
USN53700612200
				else {
				String myParam = anOriginalParameter.getFieldName() + "." + fieldName;
serviceAction.reference2
				if (StringUtils.isNotEmpty(aNewParam)) {
					myParam = aNewParam + "." + fieldName;
serviceAction.shipmentOrderVO.reference2

				ParameterImpl myParameter = new ParameterImpl(myParam, value, method.getReturnType());
myParameter	GenericDAOFilterExpression$ParameterImpl  (id=20985)	
	criterium	MatchOperation  (id=20986)	
LIKE
	fieldName	"serviceAction.shipmentOrderVO.reference2" (id=20982)	
	inverted	false	
	value	"USN53700612200" (id=20632)	

				myList.add(myParameter);
[serviceAction.shipmentOrderVO.reference2 USN53700612200 false LIKE]

		return myList;
/t
EventDAOImpl(GenericHibernateDAO).expandParameter(EntityInterface, Parameter, String) line: 808	
				else {
					// property1.property2.property3
					if (value instanceof EntityInterface) {
						// Has to be updated to handle property1.2.3.4.etc
						myList.addAll(expandParameter((EntityInterface) value, anOriginalParameter, anOriginalParameter.getFieldName() + "." + fieldName));
						continue;
/ volgende	,
		for (Method method : anObject.getClass().getMethods()) {
...
		return myList;
[serviceAction.shipmentOrderVO.reference2 USN53700612200 false LIKE]
/t
EventDAOImpl(GenericHibernateDAO).createCriteria(DetachedCriteria, DAOFilterExpression<Type>, Map<String,DetachedCriteria>) line: 621	
				// First check if the value of the parameter is an Object
				if (myOriginalValue instanceof EntityInterface && !(myOriginalValue instanceof HibernateComponent)) {
					myResolvedParameterList.addAll(expandParameter((EntityInterface) myOriginalValue, myOriginal, ""));
/d
[serviceAction.shipmentOrderVO.reference2 USN53700612200 false LIKE]

				for (Parameter myResolved : myResolvedParameterList) {

/ Loops over alle class props die ook H. properties zijn	,

					CriteriaElement critElement = new CriteriaElement(aDetachedCriteria, myResolved.getFieldName());
aDetachedCriteria	DetachedCriteria  (id=20386)	
	criteria	CriteriaImpl  (id=22735)	
		criterionEntries	ArrayList  (id=22737)	
[createdDate>2015-12-16 07:41:40.834, organizationSystemid in (5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440), systemId=1, eventStatus in (OPEN_ALERTED), closedOn is null, not expectedEnd is null, not eventTemplateSystemid is null, not eventTemplateSystemid=0]
myResolved.getFieldName()= serviceAction.shipmentOrderVO.reference2

					resolveCriteriaElement(critElement, aSubCriteriaMap, componentPaths);
/s
EventDAOImpl(GenericHibernateDAO).resolveCriteriaElement(CriteriaElement, Map<String,DetachedCriteria>, Map<String,Boolean>) line: 1053	
/=
	protected boolean resolveCriteriaElement(@Nonnull final CriteriaElement aElement, Map<String, DetachedCriteria> aSubCriteriaMap,
			Map<String, Boolean> aComponentPaths) {



		DetachedCriteria destCriteria = aElement.getCriteria();
		String propName = aElement.getProperty();
serviceAction.shipmentOrderVO.reference2

		int idx = propName.indexOf('.');
13
		StringBuilder propertyPath = new StringBuilder();
		ClassMetadata currentMeta = getHibernateClassMeta();
persisten van EventVO	,

		while (idx > -1) {
			// subCritName is the part before the .
			String subCritName = propName.substring(0, idx);
serviceAction
			propertyPath.append(subCritName);
serviceAction
			// update prop name with the part after the .
			propName = propName.substring(idx + 1);
shipmentOrderVO.reference2
			idx = propName.indexOf('.');
15

			if (aComponentPaths.containsKey(partialPath)) {
/ NEE
aComponentPaths= {eventType=false}
/ eerdere	, false : isComponent	,

			} else {
					fieldType = currentMeta.getPropertyType(subCritName);
org.hibernate.type.ManyToOneType(com.mpobjects.oms.model.serviceaction.vo.ServiceActionVO)
currentMeta=persister van EventVO	, EventVO.getServiceAction bestaat	,
				} else {
					if (idx > -1 && fieldType.isEntityType()) {
						// set up the next class meta
						currentMeta = getSessionFactory().getClassMetadata(((EntityType) fieldType).getAssociatedEntityName());
SingleTableEntityPersister(com.mpobjects.oms.model.serviceaction.vo.ServiceActionVO)

				aComponentPaths.put(partialPath, isComponent);
{serviceAction=false, eventType=false}

			// create/get the subcriteria for the next step in the path
			if (aSubCriteriaMap.containsKey(propertyPath.toString())) {
aSubCriteriaMap=
{eventType=DetachableCriteria(Subcriteria(eventType:))}
/ NEE
			} else {
				destCriteria = destCriteria.createCriteria(subCritName);
subCritName="serviceAction"
				aSubCriteriaMap.put(propertyPath.toString(), destCriteria);
{serviceAction=DetachableCriteria(Subcriteria(serviceAction:)), eventType=DetachableCriteria(Subcriteria(eventType:))}

/ volgende	,
		while (idx > -1) {
15
			// subCritName is the part before the .
			String subCritName = propName.substring(0, idx);
shipmentOrderVO
			// extend the property path
			if (propertyPath.length() > 0) {
				propertyPath.append('.');
serviceAction.
			propertyPath.append(subCritName);
serviceAction.shipmentOrderVO

			// update prop name with the part after the .
			propName = propName.substring(idx + 1);
reference2
			idx = propName.indexOf('.');
-1
			String partialPath = propertyPath.toString();
serviceAction.shipmentOrderVO
			} else {
					fieldType = currentMeta.getPropertyType(subCritName);
subCritName="shipmentOrderVO"
currentMeta=SingleTableEntityPersister(com.mpobjects.oms.model.serviceaction.vo.ServiceActionVO)
fieldType=org.hibernate.type.ManyToOneType(com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO)

				aComponentPaths.put(partialPath, isComponent);
{serviceAction=false, eventType=false, serviceAction.shipmentOrderVO=false}

			// create/get the subcriteria for the next step in the path
			if (aSubCriteriaMap.containsKey(propertyPath.toString())) {
/ NEE
			} else {
				destCriteria = destCriteria.createCriteria(subCritName);
destCriteria	DetachedCriteria  (id=22928)	
	criteria	CriteriaImpl$Subcriteria  (id=22934)	
		parent	CriteriaImpl$Subcriteria  (id=22872)	
		path	"shipmentOrderVO" (id=22885)	
				aSubCriteriaMap.put(propertyPath.toString(), destCriteria);
{serviceAction=DetachableCriteria(Subcriteria(serviceAction:)), eventType=DetachableCriteria(Subcriteria(eventType:)), serviceAction.shipmentOrderVO=DetachableCriteria(Subcriteria(shipmentOrderVO:))}

		// We're finally done

		aElement.setCriteria(destCriteria);
		aElement.setProperty(propName);

aElement	GenericHibernateDAO$CriteriaElement  (id=22746)	
	criteria	DetachedCriteria  (id=22928)	
		criteria	CriteriaImpl$Subcriteria  (id=22934)	
			parent	CriteriaImpl$Subcriteria  (id=22872)	
			path	"shipmentOrderVO" (id=22885)	
	property	"reference2" (id=22897)	


		return true;
/t
EventDAOImpl(GenericHibernateDAO).createCriteria(DetachedCriteria, DAOFilterExpression<Type>, Map<String,DetachedCriteria>) line: 631	
				for (Parameter myResolved : myResolvedParameterList) {
serviceAction.shipmentOrderVO.reference2 USN53700612200 false LIKE
					CriteriaElement critElement = new CriteriaElement(aDetachedCriteria, myResolved.getFieldName());
					resolveCriteriaElement(critElement, aSubCriteriaMap, componentPaths);
/d
critElement 	GenericHibernateDAO$CriteriaElement  (id=22746)	
	criteria	DetachedCriteria  (id=22928)	
		criteria	CriteriaImpl$Subcriteria  (id=22934)	
			parent	CriteriaImpl$Subcriteria  (id=22872)	
			path	"shipmentOrderVO" (id=22885)	
	property	"reference2" (id=22897)	

					Object myPropertyValue = myResolved.getValue();
USN53700612200
					Property myProperty = Property.forName(critElement.getProperty());
reference2
					Criterion myCriterion = null;
					switch (myResolved.getCriterium()) {
						case LIKE:
							if (myPropertyValue instanceof String) {
								myCriterion = myProperty.like((String) myPropertyValue, MatchMode.ANYWHERE).ignoreCase();

					if (myCriterion != null) {
						if (myResolved.isInverted()) {
/ NEE
						} else {
							destCriteria.add(myCriterion);
/ Nu	, 
aDetachedCriteria	DetachedCriteria  (id=20386)	
	criteria	CriteriaImpl  (id=22735)	
		criterionEntries	ArrayList  (id=22737)	
[createdDate>2015-12-16 07:41:40.834, organizationSystemid in (5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440), systemId=1, eventStatus in (OPEN_ALERTED), closedOn is null, not expectedEnd is null, not eventTemplateSystemid is null, not eventTemplateSystemid=0, reference2 like %USN53700612200%]
/ Hij zit erbij	,

/ 7	. 

/ we hebben edit	, 
/ Maar TODO


$ vi dsvfms.properties

module.event.dashboard.columndefinition=eventType.code,serviceOrderVO.serviceOrderId,serviceAction.shipmentOrderVO.reference2,serviceAction.shipmentOrderVO.reference10,serviceAction.shipmentOrderVO.heaviestTopLevelShipmentItem.reference2,expectedEnd,closedOn,actualValue,remarks,serviceAction.shipmentOrderVO.reference5,serviceOrderVO.toPartyVO.countryVO.code,serviceOrderVO.toPartyVO.postalCode,serviceOrderVO.executedByPartyVO.partyId,serviceOrderVO.dateSetVO.plannedEndBefore ,serviceAction.shipmentOrderVO.reference1,org.organizationId,serviceAction.serviceActionType.code
/ serviceOrderVO.ExecutedByPartyVO.partyId -> serviceOrderVO.executedByPartyVO.partyId 	

$ vi EventByEventTypePage.properties

dashboard.serviceOrderVO.executedByPartyVO.partyId=Executed by
dashboard.serviceOrderVO.executedBy2PartyVO.partyId=Executed by2
/ serviceOrderVO.ExecutedByPartyVO.partyId -> serviceOrderVO.executedByPartyVO.partyId 	

$ vi AbstractEventListPage.java
		addColumn("serviceOrderVO.executedBy2PartyVO.partyId");
		addColumn("serviceOrderVO.executedByPartyVO.partyId");

/ 7	. 

BREAKPOINT DISABLE
GenericHibernateDAO [line: 594] - createCriteria(DetachedCriteria, DAOFilterExpression<Type>, Map<String, DetachedCriteria>)
GenericListPanel$2 [line: 282] - populateItem(Item, String, IModel)
GenericListPanel$ActionPanel [line: 56] - ActionPanel(String, Collection<Component>)
GenericTableDataProvider$FilterStateFilterExpression [line: 93] - createProxy()

BREAKPOINT ENABLE
EventDAOImpl [line: 999] - getConsolidatedEventList(QueryParam, DAOFilterExpression<EventVO>)

/ 7	. 

/ In Executed by 
/  dat is property	"serviceOrderVO.executedByPartyVO.partyId" (id=22805)		/ Executed by	
/ we geven DSV
/s
EventDataProvider.size() line: 67	
		int size = MpoBeanFactory.getBean(EventDAO.class).getConsolidatedEventCount(filter);
/s
EventDAOImpl.getConsolidatedEventCount(DAOFilterExpression<EventVO>) line: 272	
		return getConsolidatedEventList(new QueryParam(0, 0), filter).size();
/s
EventDAOImpl.getConsolidatedEventList(QueryParam, DAOFilterExpression<EventVO>) line: 998	
/=
	private List<EventVO> getConsolidatedEventList(QueryParam queryParam, DAOFilterExpression<EventVO> filter) {
filter
	parameters
[createdDate 2015-12-16 12:32:27.8 false GT, organizationSystemid [5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440] false IN, eventType.systemId 1 false EQ, eventStatus [OPEN_ALERTED] false IN, closedOn  false NULL, expectedEnd  true NULL, eventTemplateSystemid  true NULL, eventTemplateSystemid 0 true EQ, serviceOrderVO  true NULL]
/ We zien GEEN extra instance

/ 7	. 

/ we geven nogmaals 'Shipment tracking number'	, 
/ dat is serviceAction.shipmentOrderVO.reference2
'USN53700612200' 
/ en we kijken waar de ServiceAction wordt create	,

/s
	ServiceActionVO.<init>() line: 95	
	PropertyResolver$MethodGetAndSet.newValue(Object) line: 1279	
/=
		public Object newValue(Object object) {
object	EventVO$$EnhancerBySpringCGLIB$$377ec2fb  (id=18743)	
			Class<?> clz = getMethod.getReturnType();
class com.mpobjects.oms.model.serviceaction.vo.ServiceActionVO
			Object value = null;
				value = clz.newInstance();
				setMethod.invoke(object, new Object[] { value });
/db
	PropertyResolver.getObjectAndGetSetter(String, Object, int, Class<?>) line: 309	
			if (newValue == null)
			{
				if (tryToCreateNull == CREATE_NEW_VALUE)
				{
					newValue = getAndSetter.newValue(value);
/db
	PropertyResolver.getObjectAndGetSetter(String, Object, int) line: 242	
		return getObjectAndGetSetter(expression, object, tryToCreateNull, object.getClass());
/db
	PropertyResolver.setValue(String, Object, Object, PropertyResolverConverter) line: 135	
->		ObjectAndGetSetter setter = getObjectAndGetSetter(expression, object, CREATE_NEW_VALUE);
		setter.setValue(value, converter == null ? new PropertyResolverConverter(Application.get()
			.getConverterLocator(), Session.get().getLocale()) : converter);
/db
	PropertyModel(AbstractPropertyModel).setObject(T) line: 182	
			PropertyResolver.setValue(expression, getTarget(), object, prc);
/db
	TextField(Component).setDefaultModelObject(Object) line: 3170	
		if (!getModelComparator().compare(this, object))
			model.setObject(object);
/db
	TextField(FormComponent).updateModel() line: 1183	
		setDefaultModelObject(getConvertedInput());
/db
	Form$FormModelUpdateVisitor.component(Component) line: 231	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 519	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrder(Component, IVisitor<Component>) line: 470	
	FilterForm(Form).internalUpdateFormComponentModels() line: 2158	
	FilterForm(Form).updateFormComponentModels() line: 2126	
	FilterForm(Form).process() line: 1051	
	FilterForm(Form).process(IFormSubmittingComponent) line: 957	
	FilterForm(Form).onFormSubmitted() line: 922	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	RequestListenerInterface.invoke(Page, Component) line: 182	
	ListenerInterfaceRequestTarget.processEvents(RequestCycle) line: 73	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	


/s
/ TODO MICHIEL MODEL RESOLVES
/ stack
	GenericTableDataProvider$FilterStateFilterExpression.createParameter(String, Object, Class<?>) line: 85	
/cb
	GenericTableDataProvider$FilterStateFilterExpression.intercept(Method, Object[]) line: 141	
/=
		protected Object intercept(Method aMethod, Object[] aArgs) throws Throwable {
aMethod=public void com.mpobjects.event.event.model.EventVO.setServiceAction(com.mpobjects.oms.model.serviceaction.vo.ServiceActionVO)
aArgs=[NO SERVICE ACTION TYPE!!!/0]
				} else {
					Parameter param = createParameter(fieldName, val, aMethod.getParameterTypes()[0]);
/db 
	GenericTableDataProvider$FilterStateFilterExpression$1.invoke(MethodInvocation) line: 98	
/=
			pf.addAdvice(new SerializableMethodInterceptor() {
				@Override
				public Object invoke(MethodInvocation mi) throws Throwable {
->					return FilterStateFilterExpression.this.intercept(mi.getMethod(), mi.getArguments());

/cb 
	PropertyResolver$MethodGetAndSet.newValue(Object) line: 1280	
/=
		public Object newValue(Object object)
object=NO SERVICE ACTION TYPE!!!/0
		{
			Class<?> clz = getMethod.getReturnType();
class com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO
			Object value = null;
			try
			{
				value = clz.newInstance();
				setMethod.invoke(object, new Object[] { value });
public void com.mpobjects.oms.model.serviceaction.vo.ServiceActionVO.setShipmentOrderVO(com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO)
			}

/cb 
	PropertyResolver.getObjectAndGetSetter(String, Object, int, Class<?>) line: 309	
			if (newValue == null)
			{
				if (tryToCreateNull == CREATE_NEW_VALUE)
				{
					newValue = getAndSetter.newValue(value);
value=NO SERVICE ACTION TYPE!!!/0

/cb 
	PropertyResolver.getObjectAndGetSetter(String, Object, int) line: 242	
		return getObjectAndGetSetter(expression, object, tryToCreateNull, object.getClass());

/cb 
	PropertyResolver.setValue(String, Object, Object, PropertyResolverConverter) line: 135	
		ObjectAndGetSetter setter = getObjectAndGetSetter(expression, object, CREATE_NEW_VALUE);
		setter.setValue(value, converter == null ? new PropertyResolverConverter(Application.get().getConverterLocator(), Session.get().getLocale()) : converter);
value="USN53700612200"

/cb 
	PropertyModel(AbstractPropertyModel).setObject(T) line: 182	
			PropertyResolver.setValue(expression, getTarget(), object, prc);
this	PropertyModel  (id=19666)	
prc	PropertyResolverConverter  (id=19743)	
object	"USN53700612200" (id=19704)	
expression	"serviceAction.shipmentOrderVO.reference2" (id=19744)	

/cb 
	TextField(Component).setDefaultModelObject(Object) line: 3170	
			model.setObject(object);
object="USN53700612200"
	TextField(FormComponent).updateModel() line: 1183	
		setDefaultModelObject(getConvertedInput());

/cb 
	Form$FormModelUpdateVisitor.component(Component) line: 231	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 519	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrder(Component, IVisitor<Component>) line: 470	
	FilterForm(Form).internalUpdateFormComponentModels() line: 2158	
	FilterForm(Form).updateFormComponentModels() line: 2126	
	FilterForm(Form).process() line: 1051	
	FilterForm(Form).process(IFormSubmittingComponent) line: 957	
	FilterForm(Form).onFormSubmitted() line: 922	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	RequestListenerInterface.invoke(Page, Component) line: 182	
	ListenerInterfaceRequestTarget.processEvents(RequestCycle) line: 73	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	
/ debug
/s
GenericTableDataProvider$FilterStateFilterExpression.createParameter(String, Object, Class<?>) line: 85	

this	GenericTableDataProvider$FilterStateFilterExpression  (id=19327)	
aFieldName	"serviceAction" (id=19677)	
aValue	ServiceActionVO  (id=19661)	
NO SERVICE ACTION TYPE!!!/0
valueType	Class (com.mpobjects.oms.model.serviceaction.vo.ServiceActionVO) (id=5707)	

/ de ServiceActionVO is met new create	, heeft nog geen ShipmentOrderVO	, met een reference2	,
/s
GenericDAOFilterExpression$ParameterImpl.<init>(String, Object, Class<?>) line: 53	
this	GenericDAOFilterExpression$ParameterImpl  (id=20183)	

			this(aFieldName);
/s
				fieldName = aFieldName;
serviceAction
/t
			value = aValue;
NO SERVICE ACTION TYPE!!!/0
/t
GenericTableDataProvider$FilterStateFilterExpression.intercept(Method, Object[]) line: 144	
				} else {
					Parameter param = createParameter(fieldName, val, aMethod.getParameterTypes()[0]);
/d
					// remove previous value, otherwise is will become: oldCond & newCond
					removeParameter(filterParameter.get(fieldName));
					filterParameter.put(fieldName, param);
					filterValues.put(fieldName, val);
					// TODO find a better solution
					if (!getIgnoredList().contains(fieldName)) {
						addParameter(param);
			return aMethod.invoke(legacyFilterObject, aArgs);

/c
	ShipmentOrderVO.setReference2(String) line: 2431	
	PropertyResolver$MethodGetAndSet.setValue(Object, Object, PropertyResolverConverter) line: 1185	
					setMethod.invoke(object, new Object[] { converted });
object	ShipmentOrderVO  (id=20227)	
converted	"USN53700612200" (id=19704)	

	PropertyResolver$ObjectAndGetSetter.setValue(Object, PropertyResolverConverter) line: 641	
			getAndSetter.setValue(this.value, value, converter);

/db
	PropertyResolver.setValue(String, Object, Object, PropertyResolverConverter) line: 141	
		setter.setValue(value, converter == null ? new PropertyResolverConverter(Application.get()
			.getConverterLocator(), Session.get().getLocale()) : converter);
/db
	PropertyModel(AbstractPropertyModel).setObject(T) line: 182	
			PropertyResolver.setValue(expression, getTarget(), object, prc);
/db
	TextField(Component).setDefaultModelObject(Object) line: 3170	
			model.setObject(object);

	TextField(FormComponent).updateModel() line: 1183	
	Form$FormModelUpdateVisitor.component(Component) line: 231	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 519	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrder(Component, IVisitor<Component>) line: 470	
	FilterForm(Form).internalUpdateFormComponentModels() line: 2158	
	FilterForm(Form).updateFormComponentModels() line: 2126	
	FilterForm(Form).process() line: 1051	
	FilterForm(Form).process(IFormSubmittingComponent) line: 957	
	FilterForm(Form).onFormSubmitted() line: 922	
	RequestListenerInterface.invoke(Page, Component) line: 182	
	ListenerInterfaceRequestTarget.processEvents(RequestCycle) line: 73	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/ BREAKPOINT DISABLE
GenericHibernateDAO [line: 743] [conditional] - expandParameter(EntityInterface, Parameter, String)	

/ 7	.

/ BREAKPOINT REMOVE

AbstractEventListPage [line: 162] - getAllColumns()	
AbstractParty [line: 531] - setPartyId(String)	
AbstractShipmentOrderMsgProcessor [line: 225] - process(Node)	
BaseHibernateDAO [line: 214] - doInHibernate(Session)	
CustomerOrderLine [line: 252] - getCustomerOrder()	
CustomerOrderLine [line: 256] - getCustomerOrderLineId()	
DashboardQueryDAOImpl [line: 90] - getDashboardQueryList(String)	
DsvFmsShipmentOrderMsgProcessor [line: 77] - UPDATES_OF_ITEMS_NOT_SUPPORTED	
DsvFmsShipmentOrderMsgProcessor [line: 578] - processDsvNewOrder(ParsedShipmentOrder)	
DsvFmsShipmentOrderMsgProcessor [line: 643] - processItemFileAndCreateCustomerOrderLine(ParsedShipmentOrder, boolean)	
DsvFmsShipmentOrderMsgProcessor [line: 645] - processItemFileAndCreateCustomerOrderLine(ParsedShipmentOrder, boolean)	
DsvFmsShipmentOrderMsgProcessor [line: 670] - processItemFileAndCreateCustomerOrderLine(ParsedShipmentOrder, boolean)	
EntityDetailServiceImpl [line: 131] - initialize(EntityDetailSupport)	
EventByEventTypePage [line: 129] - EventByEventTypePage(int, Collection<EventStatus>, String, boolean)	
EventByEventTypePage [line: 164] - EventByEventTypePage(int, Collection<EventStatus>, String, boolean)	
EventCacheDAOImpl [line: 36] - EventCacheDAOImpl()	
EventCacheDAOImpl [line: 41] - findByCriteria(DAOFilterExpression<EventCacheVO>, int, int)	
EventCacheDAOImpl [line: 56] - getByCustomQuery(int)	
EventCacheDAOImpl [line: 67] - getByType(int)	
EventCacheDAOImpl [line: 79] - getByTypeAndOrganization(EventType, int)	
EventCacheDAOImpl [line: 97] - getEventCachesForUser()	
EventCacheDAOImpl [line: 105] - getOpenCountForUser(String)	
EventCacheDAOImpl [line: 125] - runQuery(QueryParam, DAOFilterExpression<EventCacheVO>)	
EventCacheDAOImpl [line: 150] - runQueryCount(DAOFilterExpression<EventCacheVO>)	
EventCacheDAOImpl [line: 151] - runQueryCount(DAOFilterExpression<EventCacheVO>)	
EventCacheDAOImpl [line: 161] - statusCount(EventType, Date)	
EventCacheDAOImpl [line: 173] - getQueryForEventCachesForUser(Collection<Integer>)	
EventCacheDataProvider [line: 41] - iterator(int, int)	
EventCacheSearchListPanel [line: 41] - EventCacheSearchListPanel(String, BaseWebComponent, WebComponentEventSwitchBoard, BeanWrapper<? extends BaseDAOInterface<EventCacheVO>>, Collection<EntityAction<EventCacheVO>>, TableDataProviderBuilder<EventCacheVO>)	
EventCacheSearchListPanel [line: 51] - addFilterColumns(List<IColumn>)	
EventCacheSearchListPanel [line: 83] - onClick()	
EventDAOImpl [line: 260] - getConsolidatedEvent(QueryParam, DAOFilterExpression<EventVO>, int, int)	
EventDAOImpl [line: 272] - getConsolidatedEventCount(DAOFilterExpression<EventVO>)	
EventDAOImpl [line: 992] - getConsolidatedEventList(QueryParam, DAOFilterExpression<EventVO>)	
EventDAOImpl [line: 998] - getConsolidatedEventList(QueryParam, DAOFilterExpression<EventVO>)	
EventDashboardPage [line: 147] - onSubmit(Button, AjaxRequestTarget, IModel<EventCacheVO>)	
EventDataProvider [line: 52] - iterator(int, int)	
EventDataProvider [line: 67] - size()	
EventDataProvider$Builder [line: 38] - build(BeanWrapper<? extends BaseDAOInterface<EventVO>>, String)	
Form [line: 843] - Form	
Form [line: 886] - Form	
Form [line: 1605] - new Anonymous	
GenericHibernateDAO [line: 743] [conditional] - expandParameter(EntityInterface, Parameter, String)	
GenericListPanel [line: 120] - GenericListPanel(String, BaseWebComponent, WebComponentEventSwitchBoard, BeanWrapper<? extends BaseDAOInterface<T>>, int, TableDataProviderBuilder<T>, List<EntityGroupAction<T>>)	
GenericListPanel [line: 155] - GenericListPanel(String, BaseWebComponent, WebComponentEventSwitchBoard, ListActionsPanelBuilder<T>, BeanWrapper<? extends BaseDAOInterface<T>>, int, TableDataProviderBuilder<T>, List<EntityCollectionAction<T>>, boolean)	
GenericListPanel [line: 237] - initialize()	
GenericListPanel [line: 446] - makeTable(List<IColumn>)	
GenericListPanel [line: 276] - getFilter(String, FilterForm)	
GenericListPanel [line: 282] - populateItem(Item, String, IModel)	
GenericListPanel$ActionPanel [line: 56] - ActionPanel(String, Collection<Component>)	
GenericTableDataProvider [line: 172] - GenericTableDataProvider(BeanWrapper<? extends BaseDAOInterface<T>>, String)	
GenericTableDataProvider [line: 183] - getFilterState()	
GenericTableDataProvider [line: 203] - iterator(int, int)	
GenericTableDataProvider [line: 237] - resetFilterState()	
GenericTableDataProvider [line: 251] - setQueryParam(QueryParam)	
GenericTableDataProvider [line: 257] - size()	
GenericTableDataProvider$Builder [line: 36] - build(BeanWrapper<? extends BaseDAOInterface<U>>, String)	
GenericTableDataProvider$FilterStateFilterExpression [line: 58] - FilterStateFilterExpression()	
GenericTableDataProvider$FilterStateFilterExpression [line: 85] - createParameter(String, Object, Class<?>)	
GenericTableDataProvider$FilterStateFilterExpression [line: 93] - createProxy()	
GenericTableDataProvider$FilterStateFilterExpression [line: 98] - invoke(MethodInvocation)	
GenericTableDataProvider$FilterStateFilterExpression [line: 141] - intercept(Method, Object[])	
GoFilter [line: 71] - GoFilter(String, IModel<String>)	
HibernateTemplate [line: 555] - new Anonymous	
JmsDsvFmsListener [line: 44] - onMessage(Message)	
LogisticsOrderBodyProcessor [line: 187] - process(Node, LogisticsOrderVO)	
PartyProcessor [line: 244] - storeParty(PartyLookupContext, String, Party, PartyInterfaceMode)	
PartyProcessor [line: 309] - storeParty(PartyLookupContext, String, Party, PartyInterfaceMode)	
PreferedPartyTranslationDaoImpl [line: 46] - findByPartyId(Organization, String, boolean, Integer[])	
PrefilteredTableDataProvider [line: 98] - setPrefilterParameters(List<Parameter>)	
PrefilteredTableDataProvider [line: 107] - setFilter()	
PrefilteredTableDataProvider$Builder [line: 61] - build(BeanWrapper<? extends BaseDAOInterface<U>>, String)	
ProductItemVO [line: 710] - getCustomerOrderLineVO()	
PropertiesValueDAOImpl [line: 37] - getAllWithoutOrgAndUserAsMap()	
ServiceActionVO [line: 122] - ServiceActionVO(int, int, ConsignmentVO, ShipmentOrderVO, ServiceActionType, String, OrderStatusVO, String, String, String, String, String, String, String)	
ServiceActionVO [line: 783] - setShipmentOrderVO(ShipmentOrderVO)	
ServiceOrderVO [line: 2005] - setExecutedByPartyVO(PartyVO)	
ShipmentOrderBodyProcessor [line: 455] - process(Node)	
ShipmentOrderBodyProcessor [line: 471] - process(Node)	
ShipmentOrderBodyProcessor [line: 670] - processShipmentOrderParty(ShipmentOrderVO, Node)	
ShipmentOrderBodyProcessor [line: 721] - processShipmentOrderParty(ShipmentOrderVO, Node)	
ShipmentOrderBodyProcessor [line: 729] - processShipmentOrderParty(ShipmentOrderVO, Node)	
ShipmentOrderListener [line: 24] - onMessage(Message)	
ShipmentOrderProcessor [line: 209] - process(Node)	
ShipmentOrderVO [line: 2431] - setReference2(String)	
DeferredEventDAOImpl [entry] - findEventsByStatus(DeferredEventStatus)	
DeferredEventDAOImpl [entry] - findEventsByStatus(DeferredEventStatus, int)	
EventSatDAOImpl [entry] - getBySatSystemid(int)	
EventSatDAOImpl [entry] - storeEventTemplatesForSat(ServiceActionTemplate, Collection<EventTemplate>)	
Form [entry] - component(Form<?>)	
Form [entry] - component(Form<?>)	
SatSaveListener [entry] - postSubmit()	
ServiceActionVO [entry] - ServiceActionVO()	
ServiceOrderVO [entry] - ServiceOrderVO()	
dashboard-view.jsp [line: 10]	
 
class EventDAOImpl
	private List<EventVO> getConsolidatedEventList(QueryParam queryParam, DAOFilterExpression<EventVO> filter) {
class EventDataProvider
	public Iterator<EventVO> iterator(final int first, final int count) {
	public int size() {
class GenericDataTableProvider
	public class FilterStateFilterExpression extends GenericDAOFilterExpression<T> {
		protected Object intercept(Method aMethod, Object[] aArgs) throws Throwable {

class EventCacheSearchListPanel
		aColumnList.add(new ExtendedConfigurableTextFilteredPropertyColumn("openAlertCount", "openAlertCount", "openAlertCount",
				new ConfigurableTextFilteredPropertyColumn.FilterTextfieldBuilder<Integer>(5)) {
			@Override
			public void populateItem(Item aCellItem, String aComponentId, IModel aModel) {
				final EventCacheVO item = (EventCacheVO) aModel.getObject();
				Link<EventVO> link = new Link<EventVO>("link", aModel) {

					@Override
					public void onClick() {
->						EventByEventTypePage page = new EventByEventTypePage(item.getEventType().getSystemId(),
								Collections.singleton(EventStatus.OPEN_ALERTED), item.getEventType().getCode(), true);
/ als je op een getal clickt op de event dashboard's expected event table	,

/ BREAKPOINTS EXPORT
[eric@localhost eclipse-jee-test]$ less ~/tmp/scs-breakpoints.txt.bkpt 
/ Geef in Help=tab in chrome	, click, op Wizard	, 

/ 7	. 

/ property  "serviceOrderVO.executedByPartyVO.partyId" (id=22805)       / Executed by
/ we geven DSV	, Enter	,

/s
Daemon Thread [http-0.0.0.0-8080-3] (Suspended (entry into method <init> in ServiceOrderVO))	
	ServiceOrderVO.<init>() line: 319	
	PropertyResolver$MethodGetAndSet.newValue(Object) line: 1279	
/=
		public Object newValue(Object object)
object	EventVO$$EnhancerBySpringCGLIB$$3aedc300  (id=18901)	
		{
			Class<?> clz = getMethod.getReturnType();
class com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO
			Object value = null;
			try
			{
				value = clz.newInstance();
				setMethod.invoke(object, new Object[] { value });
/db 
	PropertyResolver.getObjectAndGetSetter(String, Object, int, Class<?>) line: 309	
			if (newValue == null)
			{
				if (tryToCreateNull == CREATE_NEW_VALUE)
				{
					newValue = getAndSetter.newValue(value);
/cb
	PropertyResolver.getObjectAndGetSetter(String, Object, int) line: 242	
		return getObjectAndGetSetter(expression, object, tryToCreateNull, object.getClass());
/cb
	PropertyResolver.setValue(String, Object, Object, PropertyResolverConverter) line: 135	
->		ObjectAndGetSetter setter = getObjectAndGetSetter(expression, object, CREATE_NEW_VALUE);
		setter.setValue(value, converter == null ? new PropertyResolverConverter(Application.get()
			.getConverterLocator(), Session.get().getLocale()) : converter);
/db 
	PropertyModel(AbstractPropertyModel).setObject(T) line: 182	
			PropertyResolver.setValue(expression, getTarget(), object, prc);
/cb 
	TextField(Component).setDefaultModelObject(Object) line: 3170	
			model.setObject(object);
/db
	TextField(FormComponent).updateModel() line: 1183	
		setDefaultModelObject(getConvertedInput());
/cb
	Form$FormModelUpdateVisitor.component(Component) line: 231	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 519	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrder(Component, IVisitor<Component>) line: 470	
	FilterForm(Form).internalUpdateFormComponentModels() line: 2158	
	FilterForm(Form).updateFormComponentModels() line: 2126	
	FilterForm(Form).process() line: 1051	
	FilterForm(Form).process(IFormSubmittingComponent) line: 957	
	FilterForm(Form).onFormSubmitted() line: 922	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	RequestListenerInterface.invoke(Page, Component) line: 182	
	ListenerInterfaceRequestTarget.processEvents(RequestCycle) line: 73	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/c

	ServiceOrderVO.setExecutedByPartyVO(PartyVO) line: 2005	
	PropertyResolver$MethodGetAndSet.newValue(Object) line: 1280	
/=
		public Object newValue(Object object)
object	ServiceOrderVO  (id=18740)	
		{
			Class<?> clz = getMethod.getReturnType();
class com.mpobjects.oms.model.party.vo.PartyVO
				value = clz.newInstance();
				setMethod.invoke(object, new Object[] { value });
			}
/cb
	PropertyResolver.getObjectAndGetSetter(String, Object, int, Class<?>) line: 309	
			if (newValue == null)
			{
				if (tryToCreateNull == CREATE_NEW_VALUE)
				{
					newValue = getAndSetter.newValue(value);
/cb
	PropertyResolver.getObjectAndGetSetter(String, Object, int) line: 242	
	PropertyResolver.setValue(String, Object, Object, PropertyResolverConverter) line: 135	
		ObjectAndGetSetter setter = getObjectAndGetSetter(expression, object, CREATE_NEW_VALUE);
expression=serviceOrderVO.executedByPartyVO.partyId
object	EventVO$$EnhancerBySpringCGLIB$$3aedc300  (id=18901)					/ TODO
		setter.setValue(value, converter == null ? new PropertyResolverConverter(Application.get() .getConverterLocator(), Session.get().getLocale()) : converter);
value="DSV"
/cb
	PropertyModel(AbstractPropertyModel).setObject(T) line: 182	
	TextField(Component).setDefaultModelObject(Object) line: 3170	
	TextField(FormComponent).updateModel() line: 1183	
	Form$FormModelUpdateVisitor.component(Component) line: 231	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 519	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrder(Component, IVisitor<Component>) line: 470	
	FilterForm(Form).internalUpdateFormComponentModels() line: 2158	
	FilterForm(Form).updateFormComponentModels() line: 2126	
	FilterForm(Form).process() line: 1051	
	FilterForm(Form).process(IFormSubmittingComponent) line: 957	
	FilterForm(Form).onFormSubmitted() line: 922	
	RequestListenerInterface.invoke(Page, Component) line: 182	
	ListenerInterfaceRequestTarget.processEvents(RequestCycle) line: 73	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/c
Daemon Thread [http-0.0.0.0-8080-3] (Suspended (breakpoint at line 531 in AbstractParty))	
	PartyVO(AbstractParty).setPartyId(String) line: 531	
	PropertyResolver$MethodGetAndSet.setValue(Object, Object, PropertyResolverConverter) line: 1185	
	PropertyResolver$ObjectAndGetSetter.setValue(Object, PropertyResolverConverter) line: 641	
	PropertyResolver.setValue(String, Object, Object, PropertyResolverConverter) line: 141	
		ObjectAndGetSetter setter = getObjectAndGetSetter(expression, object, CREATE_NEW_VALUE); / object	EventVO$$EnhancerBySpringCGLIB$$3aedc300  (id=18901)	
->		setter.setValue(value, converter == null ? new PropertyResolverConverter(Application.get().getConverterLocator(), Session.get().getLocale()) : converter);

	PropertyModel(AbstractPropertyModel).setObject(T) line: 182	
	TextField(Component).setDefaultModelObject(Object) line: 3170	
	TextField(FormComponent).updateModel() line: 1183	
	Form$FormModelUpdateVisitor.component(Component) line: 231	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 519	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrder(Component, IVisitor<Component>) line: 470	
	FilterForm(Form).internalUpdateFormComponentModels() line: 2158	
	FilterForm(Form).updateFormComponentModels() line: 2126	
	FilterForm(Form).process() line: 1051	
	FilterForm(Form).process(IFormSubmittingComponent) line: 957	
	FilterForm(Form).onFormSubmitted() line: 922	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	RequestListenerInterface.invoke(Page, Component) line: 182	
	ListenerInterfaceRequestTarget.processEvents(RequestCycle) line: 73	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/c
EventDataProvider.size() line: 67	
		int size = MpoBeanFactory.getBean(EventDAO.class).getConsolidatedEventCount(filter);
filter=
[createdDate 2015-12-16 15:07:33.529 false GT, organizationSystemid [5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440] false IN, eventType.systemId 1 false EQ, eventStatus [OPEN_ALERTED] false IN, closedOn  false NULL, expectedEnd  true NULL, eventTemplateSystemid  true NULL, eventTemplateSystemid 0 true EQ, serviceOrderVO  true NULL, serviceOrderVO /0 false EQ] 

filter	GenericTableDataProvider$FilterStateFilterExpression  (id=19411)	
	parameters	ArrayList  (id=19417)	
		elementData	Object[10]  (id=19423)	
			...
			[9]	GenericDAOFilterExpression$ParameterImpl  (id=19436)	
				value	ServiceOrderVO  (id=18740)	
					executedByVO	PartyVO  (id=18916)	
						partyId	"DSV" (id=18920)	
...
/s
EventDAOImpl.getConsolidatedEventList(QueryParam, DAOFilterExpression<EventVO>) line: 992	
/=
	private List<EventVO> getConsolidatedEventList(QueryParam queryParam, DAOFilterExpression<EventVO> filter) {
		CleanSvcOrder myCleaner = new CleanSvcOrder(filter);
/s

/ FIX DSVSOL-3033

/ 7	. 

/ Dit hebben we toch NIET gedaan	,


$ vi dsvfms.properties

module.event.dashboard.columndefinition=eventType.code,serviceOrderVO.serviceOrderId,serviceAction.shipmentOrderVO.reference2,serviceAction.shipmentOrderVO.reference10,serviceAction.shipmentOrderVO.heaviestTopLevelShipmentItem.reference2,expectedEnd,closedOn,actualValue,remarks,serviceAction.shipmentOrderVO.reference5,serviceOrderVO.toPartyVO.countryVO.code,serviceOrderVO.toPartyVO.postalCode,serviceOrderVO.executedByPartyVO.partyId,serviceOrderVO.dateSetVO.plannedEndBefore ,serviceAction.shipmentOrderVO.reference1,org.organizationId,serviceAction.serviceActionType.code
/ serviceOrderVO.ExecutedByPartyVO.partyId -> serviceOrderVO.executedByPartyVO.partyId 	

$ vi EventByEventTypePage.properties

dashboard.serviceOrderVO.executedByPartyVO.partyId=Executed by
dashboard.serviceOrderVO.executedBy2PartyVO.partyId=Executed by2
/ serviceOrderVO.ExecutedByPartyVO.partyId -> serviceOrderVO.executedByPartyVO.partyId 	

$ vi AbstractEventListPage.java
		addColumn("serviceOrderVO.executedBy2PartyVO.partyId");
		addColumn("serviceOrderVO.executedByPartyVO.partyId");

/ 7	. 

/ remove CleanSvcOrder	,

$ vi EventDAOImpl.java 
	public List<EventVO> getUnExpectedList(QueryParam queryParam, DAOFilterExpression<EventVO> filter) {
	public int getUnExpectedListCount(DAOFilterExpression<EventVO> filter, boolean aIsGroupByEventType) {
	private List<EventVO> getConsolidatedEventList(QueryParam queryParam, DAOFilterExpression<EventVO> filter) {



$ vi EventDAOImpl.java 

/ WAS	,
	private List<EventVO> getConsolidatedEventList(QueryParam queryParam, DAOFilterExpression<EventVO> filter) {
		queryParam.setCount(0);
		/* We still have a problem with the filter mechanism, remove this linewhen done */
		CleanSvcOrder myCleaner = new CleanSvcOrder(filter);
		String myServiceOrderId = myCleaner.serviceOrderId;
		Map<String, DetachedCriteria> mySubMap = new HashMap<String, DetachedCriteria>();
		DetachedCriteria myDetachedCriteria = getBaseCriteria();
		createCriteria(myDetachedCriteria, filter, mySubMap);
		if (!org.apache.commons.lang.StringUtils.isBlank(myServiceOrderId)) {
			myDetachedCriteria.createAlias("serviceOrderVO", "serviceorder");
			myDetachedCriteria.add(Property.forName("serviceorder.serviceOrderId").like("%" + myServiceOrderId + "%"));
		}
		List<EventVO> eventList = getHibernateTemplate().findByCriteria(myDetachedCriteria);
		List<EventVO> consolidatedList = new EventConsolidator().getConsolidatedEvents(eventList);
		myCleaner.restore();
		return consolidatedList;
	}

/ NEW	,
	private List<EventVO> getConsolidatedEventList(QueryParam queryParam, DAOFilterExpression<EventVO> filter) {
		queryParam.setCount(0);
		Map<String, DetachedCriteria> mySubMap = new HashMap<String, DetachedCriteria>();
		DetachedCriteria myDetachedCriteria = getBaseCriteria();
		createCriteria(myDetachedCriteria, filter, mySubMap);
		List<EventVO> eventList = getHibernateTemplate().findByCriteria(myDetachedCriteria);
		List<EventVO> consolidatedList = new EventConsolidator().getConsolidatedEvents(eventList);
		return consolidatedList;
	}


/ Einde FIX DSVSOL-3033

/ 7	. 

/ we click aantal 206 DLY in unexpected events	,

/ filter Executed by , kies TNT

/s
EventDAOImpl.getUnExpectedListCount(DAOFilterExpression<EventVO>, boolean) line: 859	

filter.paremeters=
[createdDate 2015-12-13 11:53:04.821 false GT, 
organizationSystemid [5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440] false IN, 
eventType.systemId 4455290 false EQ, 
eventTemplateSystemid  false NULL, 
serviceOrderVO /0 false EQ]

/ we kijken naar de laatste	,
filter	GenericTableDataProvider$FilterStateFilterExpression  (id=19236)	
	parameters	ArrayList  (id=19246)	
		elementData	Object[10]  (id=19336)	
			[4]	GenericDAOFilterExpression$ParameterImpl  (id=19343)	
				value	ServiceOrderVO  (id=19308)	
					executedByVO	PartyVO  (id=19313)	
						partyId	"TNT" (id=19306)	

/ we zien dat hij alle fields van de seo in het filter set	, NIET alleen de onze	, en dat is de fout	, waarom ze de workaround hadden gemaakt	,

2016-07-25 12:01:43,913 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-1:) 
select count(*) as y0_ 
from EVENT_EVENT this_ 
inner join EVENT_TYPE eventtype1_ on this_.EVENT_TYPE_SYSTEMID=eventtype1_.SYSTEM_ID 
inner join SERVICE_ORDER serviceord2_ on this_.SERVICE_ORDER_SYSTEMID=serviceord2_.SYSTEM_ID 
inner join PARTY partyvo3_ on serviceord2_.EXECUTED_BY_PARTY_SYSTEMID=partyvo3_.SYSTEM_ID 
where (this_.ACTUAL_VALUE is null or this_.ACTUAL_VALUE='') 
and this_.CREATED_DATE>'2015-12-13 12:12:17.96' 
and this_.ORGANIZATION_SYSTEMID in ( 5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440) 
and eventtype1_.SYSTEM_ID=4455290 
and this_.EVENT_TEMPLATE_SYSTEMID is null 
and serviceord2_.TOT_COST_ALT=0.00
and serviceord2_.TOT_COST=0.00 
and serviceord2_.CAPACITY_VOLUME=0.000 
and serviceord2_.PLANNED_DISTANCE=0 
and lower(serviceord2_.SERVICE_ORDER_ID) like '%n2971969%' 
and serviceord2_.CAPACITY_WEIGHT=0.00 
and lower(serviceord2_.EXECUTION_STRATEGY) like  '%fixed%' 
and serviceord2_.FREE_CAP_LDM=0 
and serviceord2_.UTILIZATION_VOLUME=0 
and serviceord2_.PREFER_PERC=0
and lower(serviceord2_.SYNC_TO_FLAG) like '%p%' 
and serviceord2_.ACTUAL_DISTANCE=0 
and serviceord2_.UTILIZATION_WEIGHT=9 
and serviceord2_.CAPACITY_LOADING_METER=0.00 
and serviceord2_.ACTUAL_PROCESSING_TIME=0 
and serviceord2_.FREE_CAP_WEIGHT=0 
and serviceord2_.UTILIZATION_LDM=0 
and lower(serviceord2_.SYNC_FROM_FLAG) like '%p%' 
and serviceord2_.FREE_CAP_VOLUME=0 
and serviceord2_.PLANNED_PROCESSING_TIME=0

/ We zien de columns in	,
$ vi AbstractEventListPage.java
...
		addColumn("serviceOrderVO.ExecutedByPartyVO.partyId");

/ Er wordt WH door Wicket FilterForm een ServiceOrder create	, 
$ vi ServiceOrderVO.class
	private Duration actualProcessingTime = Duration.ZERO;
	private String syncFromFlag = PartySyncFlag.PARTY_ID_CODE;
	private String syncToFlag = PartySyncFlag.PARTY_ID_CODE;

/ Vandaar dat we straks zien 	, 
syncFromFlag like '%P%' 
syncToFlag like '%P%' 
/ als we actualProcessingTime  print , zien we PTOS	, 
/ TODO

/ 7	. 

/ 


/ 7	. 

/ we geven DSV in filter form op Executed by column	, en geven Enter	,
/s
EventDAOImpl.getConsolidatedEventCount(DAOFilterExpression<EventVO>) line: 272	
		return getConsolidatedEventList(new QueryParam(0, 0), filter).size();
/s
EventDAOImpl.getConsolidatedEventList(QueryParam, DAOFilterExpression<EventVO>) line: 998	
		createCriteria(myDetachedCriteria, filter, mySubMap);
/s
EventDAOImpl(GenericHibernateDAO).createCriteria(DetachedCriteria, DAOFilterExpression<Type>, Map<String,DetachedCriteria>) line: 621	
		for (Parameter myOriginal : aFilter.getParameters()) {
			Object myOriginalValue = myOriginal.getValue();
myOriginalValue	ServiceOrderVO  (id=19197)	

			if (myOriginalValue != null) {
				if (myOriginalValue instanceof EntityInterface && !(myOriginalValue instanceof HibernateComponent)) {
					myResolvedParameterList.addAll(expandParameter((EntityInterface) myOriginalValue, myOriginal, ""));
/s
EventDAOImpl(GenericHibernateDAO).expandParameter(EntityInterface, Parameter, String) line: 773	
	protected Collection<Parameter> expandParameter(EntityInterface anObject, Parameter anOriginalParameter, String aNewParam) {

anObject	ServiceOrderVO  (id=19197)	
	executedByVO	PartyVO  (id=19206)	
		partyId	"DSV" (id=19996)	

		ClassMetadata myCmd = getHibernateTemplate().getSessionFactory().getClassMetadata(anObject.getClass());
		Set<String> properties = new HashSet<String>();
			for (String prop : myCmd.getPropertyNames()) {
				properties.add(prop);

[invoiceRechargeStatus, capacityWeight, requestedTotalLoadingMeters, billOfLadingNr, serviceOrderTemplate, payWeight, utilizationCapacityWeight, consignmentList, serviceLevel, requestedTotalColli, serviceProviderRemarks, lockPrecalculation, arrPortCountryVO, scheduleDescription, carrierReference, utilizationCapacityLdm, sealNumber, template, postCalcApprovedOnDate, plannedDistance, vesselName, serviceOrderId, serviceType, exportDateOnRelease, syncFromFlag, totalCost, lastUpdate, events, approvePostcalculation, approvedBy, altTotalCost, vatExportLevel, serviceOrderPricePartList, utilizationCapacityVolume, requestedTotalValue, requestedTotalWeightKg, orderProcess, serviceOrderInvoiceStatus, executedByPartyVO, lockPostcalculation, remarks2, instructionList, actualDistance, dateSetVO, portDepDate, supplierContractSystemId, portArrDate, costCurrencyVO, executionStrategy, serviceOrderParties, toPartyVO, systemEntryDate, approvePrecalculation, emission, freeCapacityLdm, scheduleXml, freeCapacityVolume, lastInstanceDate, genericServiceOrderData, exportDateOnEnd, holdStatus, arrPort, recurring, createdByVO, organizationVO, postCalcApprovedBy, freeCapacityWeight, requestedTotalItems, orderStatusVO, serviceOrderCostList, capacityVolume, depPortCountryVO, customerStatus, seaContainerNumber, approvedOnDate, dashboardId, errorMessage, importExportInfo, requestedTotalVolumeM3, planningReasonCodeVO, temporary, instructionGroupVO, remarks, requestedAltTotalValue, airwayBillNr, calculationLog, reference2, reference1, reference8, reference7, depPort, reference6, reference5, reference4, serviceOrderType, reference3, entityDetails, preferencePercentage, fromPartyVO, ratecalcMd5Hash, actualProcessingTime, plannedProcessingTime, executedBy2PartyVO, manualPlan, capacityLoadingMeter, exportDateOnStart, altValueCurrencyVO, syncToFlag, valueCurrencyVO, altCostCurrencyVO]

		for (Method method : anObject.getClass().getMethods()) {
			String fieldName = StringUtils.firstCharToLower(match.group(2));
events
lastUpdate
remarks
consignmentList
...
				value = method.invoke(anObject, (Object[]) null);
null
null
""
[]
...
					continue;
/ of	,
			String fieldName = StringUtils.firstCharToLower(match.group(2));
executedByPartyVO
                value = method.invoke(anObject, (Object[]) null);
value	PartyVO  (id=19206)	
				else {
					// property1.property2.property3
					if (value instanceof EntityInterface) {
						// Has to be updated to handle property1.2.3.4.etc
						myList.addAll(expandParameter((EntityInterface) value, anOriginalParameter, anOriginalParameter.getFieldName() + "." + fieldName));
[serviceOrderVO.executedByPartyVO.partyId DSV false LIKE]
/ want	,
/ RECURSION
/s
EventDAOImpl(GenericHibernateDAO).expandParameter(EntityInterface, Parameter, String) line: 773	
/=
	protected Collection<Parameter> expandParameter(EntityInterface anObject, Parameter anOriginalParameter, String aNewParam) {
aNewParam="serviceOrderVO.executedByPartyVO"

anObject	PartyVO  (id=19206)	
	partyId	"DSV" (id=19996)	

		for (Method method : anObject.getClass().getMethods()) {
/ of	,
			String fieldName = StringUtils.firstCharToLower(match.group(2));
partyPrenotificationRuleList
subParties
tntZone
attachments
serviceOrderUrlExpression
postalCode
contactName
emailAddress
faxNumber
latitude
longitude
manifestReport
name2
...
                value = method.invoke(anObject, (Object[]) null);
null
null
null
[]
""
""
""
""
""
null
null
""
""
...
/ of	,
			String fieldName = StringUtils.firstCharToLower(match.group(2));
partyId
                value = method.invoke(anObject, (Object[]) null);
"DSV"
					myParam = aNewParam + "." + fieldName;
serviceOrderVO.executedByPartyVO.partyId
				myList.add(myParameter);
		return myList;
/ Einde RECURSION

/ of	,
anObject=ServiceOrderVO
			String fieldName = StringUtils.firstCharToLower(match.group(2));
freeCapacityLdm
freeCapacityVolume
freeCapacityWeight
plannedDistance
plannedProcessingTime
preferencePercentage
utilizationCapacityLdm
utilizationCapacityWeight
actualDistance
actualProcessingTime
altTotalCost
capacityLoadingMeter
capacityVolume
capacityWeight
executionStrategy
syncFromFlag
totalCost
toPartyVO
                value = method.invoke(anObject, (Object[]) null);
0	/ a BigDecimal
0	/ a BigDecimal
0	/ a BigDecimal
0	/ a BigDecimal
PT0S / a Duration	, TODO
0	/ a BigDecimal
0	/ a BigDecimal
0	/ a BigDecimal
0	/ a BigDecimal
PT0S / a Duration	, TODO
0	/ a BigDecimal
0	/ a BigDecimal
0	/ a BigDecimal
0	/ a BigDecimal
"FIXED"
"P"
0	/ a BigDecimal

				String myParam = anOriginalParameter.getFieldName() + "." + fieldName;
serviceOrderVO.freeCapacityLdm
serviceOrderVO.freeCapacityVolume
serviceORderVO.freeCapacityWeight
serviceORderVO.plannedDistance
serviceORderVO.preferencePercentage
serviceORderVO.utilizationCapacityLdm 
serviceORderVO.utilizationCapacityWeight
serviceORderVO.actualDistance
serviceORderVO.actualProcessingTime
serviceORderVO.altTotalCost
serviceORderVO.capacityLoadingMeter
serviceORderVO.capacityVolume
serviceORderVO.capacityWeight
serviceORderVO.executionStrategy
serviceORderVO.syncFromFlag
serviceORderVO.totalCost

				ParameterImpl myParameter = new ParameterImpl(myParam, value, method.getReturnType());
				myList.add(myParameter);

/of	,
anObject=ServiceOrderVO
			String fieldName = StringUtils.firstCharToLower(match.group(2));
toPartyVO
fromPartyVO
dateSetVO
				value = method.invoke(anObject, (Object[]) null);
VirtualParty  (id=20946)	
VirtualParty  (id=20946)	
DateSetVO
				else {
					// property1.property2.property3
					if (value instanceof EntityInterface) {
						// Has to be updated to handle property1.2.3.4.etc
						myList.addAll(expandParameter((EntityInterface) value, anOriginalParameter, anOriginalParameter.getFieldName() + "." + fieldName));
/ RECURSION
/ NIETS, 	want hebben geen H. perister	,
/ Einde RECURSION

		return myList;
[serviceOrderVO.syncFromFlag P false LIKE,
 serviceOrderVO.freeCapacityVolume 0 false EQ,
 serviceOrderVO.syncToFlag P false LIKE,
 serviceOrderVO.utilizationCapacityVolume 0 false EQ,
 serviceOrderVO.plannedProcessingTime PT0S false EQ,
 serviceOrderVO.executedByPartyVO.partyId DSV false LIKE,
 serviceOrderVO.actualProcessingTime PT0S false EQ,
 serviceOrderVO.preferencePercentage 0 false EQ,
 serviceOrderVO.totalCost 0.00 false EQ,
 serviceOrderVO.executionStrategy FIXED false LIKE,
 serviceOrderVO.capacityVolume 0.000 false EQ,
 serviceOrderVO.freeCapacityWeight 0 false EQ,
 serviceOrderVO.capacityLoadingMeter 0.00 false EQ,
 serviceOrderVO.freeCapacityLdm 0 false EQ,
 serviceOrderVO.utilizationCapacityLdm 0 false EQ,
 serviceOrderVO.actualDistance 0 false EQ,
 serviceOrderVO.plannedDistance 0 false EQ,
 serviceOrderVO.utilizationCapacityWeight 0 false EQ,
 serviceOrderVO.capacityWeight 0.00 false EQ,
 serviceOrderVO.altTotalCost 0.00 false EQ]

/t
EventDAOImpl(GenericHibernateDAO).createCriteria(DetachedCriteria, DAOFilterExpression<Type>, Map<String,DetachedCriteria>) line: 626	
					myResolvedParameterList.addAll(expandParameter((EntityInterface) myOriginalValue, myOriginal, ""));
/d
				for (Parameter myResolved : myResolvedParameterList) {
					CriteriaElement critElement = new CriteriaElement(aDetachedCriteria, myResolved.getFieldName());
					resolveCriteriaElement(critElement, aSubCriteriaMap, componentPaths);
...
/t
EventDAOImpl.getConsolidatedEventList(QueryParam, DAOFilterExpression<EventVO>) line: 1006	
		createCriteria(myDetachedCriteria, filter, mySubMap);
/d
		List<EventVO> eventList = getHibernateTemplate().findByCriteria(myDetachedCriteria);


/ we zien in log	,
select count(*)
from EVENT_EVENT this_ 
inner join EVENT_TYPE eventtype1_ on this_.EVENT_TYPE_SYSTEMID=eventtype1_.SYSTEM_ID 
inner join SERVICE_ORDER serviceord2_ on this_.SERVICE_ORDER_SYSTEMID=serviceord2_.SYSTEM_ID 
left outer join TMS_USER resource7_ on serviceord2_.CREATED_BY_SYSTEMID=resource7_.SYSTEM_ID 
left outer join TMS_USER resource8_ on resource7_.CREATED_BY=resource8_.SYSTEM_ID 
inner join PARTY partyvo3_ on serviceord2_.EXECUTED_BY_PARTY_SYSTEMID=partyvo3_.SYSTEM_ID 
left outer join ORGANIZATION organizati10_ on partyvo3_.ORGANIZATION_SYSTEMID=organizati10_.SYSTEM_ID 
left outer join ORGANIZATION organizati11_ on organizati10_.ORGANIZATION_GROUP=organizati11_.SYSTEM_ID 
left outer join HOLD_STATUS holdstatus12_ on serviceord2_.HOLD_STATUS_SYSTEMID=holdstatus12_.SYSTEM_ID 
left outer join INSTRUCTION_GROUP instructio13_ on serviceord2_.INSTRUCTION_GROUP_SYSTEMID=instructio13_.SYSTEM_ID 
left outer join ORGANIZATION organizati14_ on serviceord2_.ORGANIZATION_SYSTEMID=organizati14_.SYSTEM_ID 
left outer join SERVICE_ORDER_TYPE serviceord15_ on serviceord2_.SERVICE_ORDER_TYPE_SYSTEMID=serviceord15_.SYSTEM_ID 
left outer join SERVICE_TYPE servicetyp16_ on serviceord2_.SERVICE_TYPE_SYSTEMID=servicetyp16_.SYSTEM_ID 
left outer join TMS_USER resource17_ on serviceord2_.APPROVEDBY_SYSTEMID=resource17_.SYSTEM_ID 
left outer join TMS_USER resource18_ on serviceord2_.POSTCALC_APPROVEDBY_SYSTEMID=resource18_.SYSTEM_ID 
where this_.CREATED_DATE>'2015-12-13 13:49:21.854'
and this_.ORGANIZATION_SYSTEMID in ( 5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440) 
and eventtype1_.SYSTEM_ID=1 
and this_.EVENT_STATUS in ('OPEN_ALERTED') 
and this_.CLOSED_ON is null 
and not this_.EXPECTED_END is null 
and not this_.EVENT_TEMPLATE_SYSTEMID is null 
and not this_.EVENT_TEMPLATE_SYSTEMID=0 
and not this_.SERVICE_ORDER_SYSTEMID is null 
and lower(serviceord2_.SYNC_FROM_FLAG) like '%p%' 
and serviceord2_.FREE_CAP_VOLUME=0 
and lower(serviceord2_.SYNC_TO_FLAG) like '%p%' 
and serviceord2_.UTILIZATION_VOLUME=0 
and serviceord2_.PLANNED_PROCESSING_TIME=0 
and lower(partyvo3_.PARTY_ID) like '%dsv%' 
and serviceord2_.ACTUAL_PROCESSING_TIME=0 
and serviceord2_.PREFER_PERC=0 
and serviceord2_.TOT_COST=0.00 
and lower(serviceord2_.EXECUTION_STRATEGY) like '%fixed%' 
and serviceord2_.CAPACITY_VOLUME=0.000 
and serviceord2_.FREE_CAP_WEIGHT=0 
and serviceord2_.CAPACITY_LOADING_METER=0.00 
and serviceord2_.FREE_CAP_LDM=0 
and serviceord2_.UTILIZATION_LDM=0 
and serviceord2_.ACTUAL_DISTANCE=0 
and serviceord2_.PLANNED_DISTANCE=0 
and serviceord2_.UTILIZATION_WEIGHT=0 
and serviceord2_.CAPACITY_WEIGHT=0.00 
and serviceord2_.TOT_COST_ALT=0.00


/ 7	. 

/ Nogmaals	,

/ Waarom wordt er een ServiceOrderVO obj create	?
/s
	ServiceOrderVO.<init>() line: 319	
	GeneratedConstructorAccessor115.newInstance(Object[]) line: not available	
	DelegatingConstructorAccessorImpl.newInstance(Object[]) line: 45	
	Constructor.newInstance(Object...) line: 526	
	Class.newInstance() line: 379	
	PropertyResolver$MethodGetAndSet.newValue(Object) line: 1279	
	PropertyResolver.getObjectAndGetSetter(String, Object, int, Class<?>) line: 309				<- TODO
	PropertyResolver.getObjectAndGetSetter(String, Object, int) line: 242	
	PropertyResolver.setValue(String, Object, Object, PropertyResolverConverter) line: 135	
->		ObjectAndGetSetter setter = getObjectAndGetSetter(expression, object, CREATE_NEW_VALUE);
		setter.setValue(value, converter == null ? new PropertyResolverConverter(Application.get()
			.getConverterLocator(), Session.get().getLocale()) : converter);

	PropertyModel(AbstractPropertyModel).setObject(T) line: 182	
			PropertyResolver.setValue(expression, getTarget(), object, prc);
this	PropertyModel  (id=18825)	
	expression	"serviceOrderVO.ExecutedByPartyVO.partyId" (id=18850)	
	target	FilterForm$FilterStateModel  (id=18888)	
object	"DSV" (id=18824)	
prc	PropertyResolverConverter  (id=18848)	

	TextField(Component).setDefaultModelObject(Object) line: 3170	
			model.setObject(object);
object="DSV"
	TextField(FormComponent).updateModel() line: 1183	
	Form$FormModelUpdateVisitor.component(Component) line: 231	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 519	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrderHelper(Component, IVisitor<Component>) line: 498	
	FormComponent.visitComponentsPostOrder(Component, IVisitor<Component>) line: 470	
	FilterForm(Form).internalUpdateFormComponentModels() line: 2158	
	FilterForm(Form).updateFormComponentModels() line: 2126	
	FilterForm(Form).process() line: 1051	
	FilterForm(Form).process(IFormSubmittingComponent) line: 957	
	FilterForm(Form).onFormSubmitted() line: 922	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	RequestListenerInterface.invoke(Page, Component) line: 182	
	ListenerInterfaceRequestTarget.processEvents(RequestCycle) line: 73	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doPost(HttpServletRequest, HttpServletResponse) line: 160	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 717	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/ 7	. 

/s
EventDAOImpl.getConsolidatedEventList(QueryParam, DAOFilterExpression<EventVO>) line: 1004	
		List<EventVO> eventList = getHibernateTemplate().findByCriteria(myDetachedCriteria);
eventList	ArrayList  (id=19156)	
	size	311	

[createdDate>2015-12-14 07:21:51.629, organizationSystemid in (5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440), systemId=1, eventStatus in (OPEN_ALERTED), closedOn is null, not expectedEnd is null, not eventTemplateSystemid is null, not eventTemplateSystemid=0, not serviceOrderVO is null, actualDistance=0, syncToFlag like %P%, utilizationCapacityWeight=0, capacityWeight=0.00, utilizationCapacityVolume=0, partyId like %DSV%, executionStrategy like %FIXED%, freeCapacityWeight=0, preferencePercentage=0, capacityVolume=0.000, freeCapacityLdm=0, actualProcessingTime=PT0S, totalCost=0.00, utilizationCapacityLdm=0, capacityLoadingMeter=0.00, plannedProcessingTime=PT0S, altTotalCost=0.00, freeCapacityVolume=0, syncFromFlag like %P%, plannedDistance=0]

/ In de log	, 

select count(*)
from EVENT_EVENT this_ 
inner join EVENT_TYPE eventtype1_ on this_.EVENT_TYPE_SYSTEMID=eventtype1_.SYSTEM_ID 
inner join SERVICE_ORDER serviceord2_ on this_.SERVICE_ORDER_SYSTEMID=serviceord2_.SYSTEM_ID 
left outer join TMS_USER resource7_ on serviceord2_.CREATED_BY_SYSTEMID=resource7_.SYSTEM_ID 
left outer join TMS_USER resource8_ on resource7_.CREATED_BY=resource8_.SYSTEM_ID 
inner join PARTY partyvo3_ on serviceord2_.EXECUTED_BY_PARTY_SYSTEMID=partyvo3_.SYSTEM_ID 
left outer join ORGANIZATION organizati10_ on partyvo3_.ORGANIZATION_SYSTEMID=organizati10_.SYSTEM_ID 
left outer join ORGANIZATION organizati11_ on organizati10_.ORGANIZATION_GROUP=organizati11_.SYSTEM_ID 
left outer join HOLD_STATUS holdstatus12_ on serviceord2_.HOLD_STATUS_SYSTEMID=holdstatus12_.SYSTEM_ID 
left outer join INSTRUCTION_GROUP instructio13_ on serviceord2_.INSTRUCTION_GROUP_SYSTEMID=instructio13_.SYSTEM_ID 
left outer join ORGANIZATION organizati14_ on serviceord2_.ORGANIZATION_SYSTEMID=organizati14_.SYSTEM_ID 
left outer join SERVICE_ORDER_TYPE serviceord15_ on serviceord2_.SERVICE_ORDER_TYPE_SYSTEMID=serviceord15_.SYSTEM_ID 
left outer join SERVICE_TYPE servicetyp16_ on serviceord2_.SERVICE_TYPE_SYSTEMID=servicetyp16_.SYSTEM_ID 
left outer join TMS_USER resource17_ on serviceord2_.APPROVEDBY_SYSTEMID=resource17_.SYSTEM_ID 
left outer join TMS_USER resource18_ on serviceord2_.POSTCALC_APPROVEDBY_SYSTEMID=resource18_.SYSTEM_ID 
where this_.CREATED_DATE>'2015-12-14 07:21:51.629' 
and this_.ORGANIZATION_SYSTEMID in ( 5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440,) 
and eventtype1_.SYSTEM_ID=1
and this_.EVENT_STATUS in ('OPEN_ALERTED') 
and this_.CLOSED_ON is null 
and not this_.EXPECTED_END is null 
and not this_.EVENT_TEMPLATE_SYSTEMID is null 
and not this_.EVENT_TEMPLATE_SYSTEMID=0 
and not this_.SERVICE_ORDER_SYSTEMID is null 
and serviceord2_.ACTUAL_DISTANCE=0 
--and lower(serviceord2_.SYNC_TO_FLAG) like '%p%' 
and serviceord2_.UTILIZATION_WEIGHT=0 
and serviceord2_.CAPACITY_WEIGHT=0.00 
and serviceord2_.UTILIZATION_VOLUME=0 
and lower(partyvo3_.PARTY_ID) like '%dsv%' 
and lower(serviceord2_.EXECUTION_STRATEGY) like '%fixed%' 
and serviceord2_.FREE_CAP_WEIGHT=0 
and serviceord2_.PREFER_PERC=0 
and serviceord2_.CAPACITY_VOLUME=0.000
and serviceord2_.FREE_CAP_LDM=0 
and serviceord2_.ACTUAL_PROCESSING_TIME=0 
and serviceord2_.TOT_COST=0.00 
and serviceord2_.UTILIZATION_LDM=0 
and serviceord2_.CAPACITY_LOADING_METER=0.00 
and serviceord2_.PLANNED_PROCESSING_TIME=0 
and serviceord2_.TOT_COST_ALT=0.00 
and serviceord2_.FREE_CAP_VOLUME=0 
--and lower(serviceord2_.SYNC_FROM_FLAG) like '%p%' 
and serviceord2_.PLANNED_DISTANCE=0
CON> and serviceord2_.PLANNED_DISTANCE=0;

       COUNT 
============ 
         311 


/ 7	. 

/we filter op service order id, N2957298	, en we hadden per ongeluk DSV ook nog op executed by	,

from EVENT_EVENT this_ 
inner join EVENT_TYPE eventtype1_ on this_.EVENT_TYPE_SYSTEMID=eventtype1_.SYSTEM_ID 
inner join SERVICE_ORDER serviceord2_ on this_.SERVICE_ORDER_SYSTEMID=serviceord2_.SYSTEM_ID 
left outer join TMS_USER resource7_ on serviceord2_.CREATED_BY_SYSTEMID=resource7_.SYSTEM_ID 
left outer join TMS_USER resource8_ on resource7_.CREATED_BY=resource8_.SYSTEM_ID 
inner join PARTY partyvo3_ on serviceord2_.EXECUTED_BY_PARTY_SYSTEMID=partyvo3_.SYSTEM_ID 
left outer join ORGANIZATION organizati10_ on partyvo3_.ORGANIZATION_SYSTEMID=organizati10_.SYSTEM_ID 
left outer join ORGANIZATION organizati11_ on organizati10_.ORGANIZATION_GROUP=organizati11_.SYSTEM_ID 
left outer join HOLD_STATUS holdstatus12_ on serviceord2_.HOLD_STATUS_SYSTEMID=holdstatus12_.SYSTEM_ID 
left outer join INSTRUCTION_GROUP instructio13_ on serviceord2_.INSTRUCTION_GROUP_SYSTEMID=instructio13_.SYSTEM_ID 
left outer join ORGANIZATION organizati14_ on serviceord2_.ORGANIZATION_SYSTEMID=organizati14_.SYSTEM_ID 
left outer join SERVICE_ORDER_TYPE serviceord15_ on serviceord2_.SERVICE_ORDER_TYPE_SYSTEMID=serviceord15_.SYSTEM_ID 
left outer join SERVICE_TYPE servicetyp16_ on serviceord2_.SERVICE_TYPE_SYSTEMID=servicetyp16_.SYSTEM_ID 
left outer join TMS_USER resource17_ on serviceord2_.APPROVEDBY_SYSTEMID=resource17_.SYSTEM_ID 
left outer join TMS_USER resource18_ on serviceord2_.POSTCALC_APPROVEDBY_SYSTEMID=resource18_.SYSTEM_ID 
where this_.CREATED_DATE> '2015-12-14 15:28:43.414'
and this_.ORGANIZATION_SYSTEMID in ( 5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440,) 
and eventtype1_.SYSTEM_ID=1 
and this_.EVENT_STATUS in ('OPEN_ALERTED') 
and this_.CLOSED_ON is null 
and not this_.EXPECTED_END is null 
and not this_.EVENT_TEMPLATE_SYSTEMID is null 
and not this_.EVENT_TEMPLATE_SYSTEMID=0
and not this_.SERVICE_ORDER_SYSTEMID is null 
and serviceord2_.TOT_COST_ALT=0.00 
and lower(serviceord2_.SYNC_TO_FLAG) like '%p%' 
and serviceord2_.UTILIZATION_WEIGHT=0 
and serviceord2_.CAPACITY_LOADING_METER=0.00
and serviceord2_.UTILIZATION_LDM=0 
and serviceord2_.UTILIZATION_VOLUME=0 
and lower(partyvo3_.PARTY_ID) like '%dsv%' 
and serviceord2_.PLANNED_PROCESSING_TIME=0 
and serviceord2_.PREFER_PERC=0 
and serviceord2_.CAPACITY_WEIGHT=0.00 
and serviceord2_.TOT_COST=0.00 
and lower(serviceord2_.EXECUTION_STRATEGY) like '%fixed%' 
and lower(serviceord2_.SERVICE_ORDER_ID) like '%n2957298%' 
and serviceord2_.ACTUAL_DISTANCE=0
and serviceord2_.ACTUAL_PROCESSING_TIME=0 
and serviceord2_.FREE_CAP_LDM=0 
and serviceord2_.FREE_CAP_WEIGHT=0
and serviceord2_.CAPACITY_VOLUME=0.000 
and serviceord2_.FREE_CAP_VOLUME=0 
and lower(serviceord2_.SYNC_FROM_FLAG) like '%p%' 
and serviceord2_.PLANNED_DISTANCE=0

/ 7	. 

/ we filter op	,
->	[2]	"serviceAction.shipmentOrderVO.reference2" (id=22793)			/ Shipment tracking number
/ we geven USN53700613368	, 
/s
EventDataProvider.size() line: 67	
		int size = MpoBeanFactory.getBean(EventDAO.class).getConsolidatedEventCount(filter);
this	com.mpobjects.event.view.wicket.event.EventDataProvider  (id=21295)	
	filter	com.mpobjects.view.wicket.util.multi.GenericTableDataProvider$FilterStateFilterExpression  (id=21299)	
		parameters	java.util.ArrayList  (id=21307)	
[createdDate 2015-12-15 08:46:34.309 false GT, 
organizationSystemid [5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440] false IN, 
eventType.systemId 1 false EQ, 
eventStatus [OPEN_ALERTED] false IN, 
closedOn  false NULL, e
xpectedEnd  true NULL, 
eventTemplateSystemid  true NULL, 
eventTemplateSystemid 0 true EQ, 
serviceOrderVO  true NULL, 
serviceAction /NO SERVICE ACTION TYPE!!!/0 false EQ]
/s
EventDAOImpl.getConsolidatedEventList(QueryParam, DAOFilterExpression<EventVO>) line: 1003	
		createCriteria(myDetachedCriteria, filter, mySubMap);
myDetachedCriteria	org.hibernate.criterion.DetachedCriteria  (id=21327)	
	criteria	org.hibernate.impl.CriteriaImpl  (id=21330)	
		criterionEntries	java.util.ArrayList  (id=21331)	
[createdDate>2015-12-15 08:46:34.309, o
rganizationSystemid in (5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440), 
systemId=1, 
eventStatus in (OPEN_ALERTED), 
closedOn is null, 
not expectedEnd is null, 
not eventTemplateSystemid is null, 
not eventTemplateSystemid=0, 
not serviceOrderVO is null, 
reference2 like %USN53700611910%]

/ we zien in de log	,

select count(*)
from EVENT_EVENT this_ 
inner join EVENT_TYPE eventtype1_ on this_.EVENT_TYPE_SYSTEMID=eventtype1_.SYSTEM_ID 
inner join SERVICE_ACTION serviceact2_ on this_.SERVICE_ACTION_SYSTEMID=serviceact2_.SYSTEM_ID 
inner join SHIPMENT_ORDER shipmentor3_ on serviceact2_.SHIPMENT_ORDER_SYSTEMID=shipmentor3_.SYSTEM_ID 
left outer join TMS_USER resource8_ on shipmentor3_.CREATED_BY_SYSTEMID=resource8_.SYSTEM_ID 
left outer join TMS_USER resource9_ on resource8_.CREATED_BY=resource9_.SYSTEM_ID 
left outer join TMS_USER resource10_ on shipmentor3_.ASSIGNEE_SYSTEMID=resource10_.SYSTEM_ID 
left outer join TMS_USER resource11_ on shipmentor3_.APPROVEDBY_SYSTEMID=resource11_.SYSTEM_ID 
left outer join TMS_USER resource12_ on shipmentor3_.POSTCALC_APPROVEDBY_SYSTEMID=resource12_.SYSTEM_ID 
left outer join REASON_CODE reasoncode13_ on shipmentor3_.REASON_CODE_SYSTEMID=reasoncode13_.SYSTEM_ID 
left outer join INSTRUCTION_GROUP instructio14_ on shipmentor3_.INSTRUCTION_GROUP_SYSTEMID=instructio14_.SYSTEM_ID 
where this_.CREATED_DATE>'2015-12-15 08:46:34.309' 
and this_.ORGANIZATION_SYSTEMID in (5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440) 
and eventtype1_.SYSTEM_ID= 1
and this_.EVENT_STATUS in ('OPEN_ALERTED') 
and this_.CLOSED_ON is null 
and not this_.EXPECTED_END is null 
and not this_.EVENT_TEMPLATE_SYSTEMID is null 
and not this_.EVENT_TEMPLATE_SYSTEMID=0 
and not this_.SERVICE_ORDER_SYSTEMID is null 
and lower(shipmentor3_.REFERENCE2) like '%usn53700611910%'  

       COUNT 
============ 
           1 
/ OK

/ 7. 	

/ we maken reference2 veld leeg, en geven in executed by "DSV"
/s
EventDataProvider.size() line: 67	
		int size = MpoBeanFactory.getBean(EventDAO.class).getConsolidatedEventCount(filter);
[createdDate 2015-12-15 08:46:34.309 false GT, 
organizationSystemid [5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440] false IN, 
eventType.systemId 1 false EQ, 
eventStatus [OPEN_ALERTED] false IN, 
closedOn  false NULL, 
expectedEnd  true NULL, 
eventTemplateSystemid  true NULL, 
eventTemplateSystemid 0 true EQ, 
serviceOrderVO  true NULL, 
serviceAction /NO SERVICE ACTION TYPE!!!/0 false EQ, 	<-
serviceOrderVO /0 false EQ]								<-

/ we zien de sa ook 	, WH omdat dat field veranderd is	, en we zien de seo	, want we hebben executed by ingevuld	,
/s
EventDAOImpl.getConsolidatedEventList(QueryParam, DAOFilterExpression<EventVO>) line: 1003	
		createCriteria(myDetachedCriteria, filter, mySubMap);
this	com.mpobjects.event.event.model.dao.EventDAOImpl  (id=18827)	
myDetachedCriteria	org.hibernate.criterion.DetachedCriteria  (id=21521)	
		criterionEntries	java.util.ArrayList  (id=21539)	
[createdDate>2015-12-15 08:46:34.309, 
organizationSystemid in (5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440), 
systemId=1, 
eventStatus in (OPEN_ALERTED), 
closedOn is null, 
not expectedEnd is null, 
not eventTemplateSystemid is null, 
not eventTemplateSystemid=0, 
not serviceOrderVO is null, 
utilizationCapacityWeight=0, 
totalCost=0.00, 
plannedProcessingTime=PT0S, 
capacityLoadingMeter=0.00, 
freeCapacityLdm=0, 
plannedDistance=0, 
utilizationCapacityLdm=0, 
capacityVolume=0.000, 
syncFromFlag like %P%, 
preferencePercentage=0, 
freeCapacityWeight=0, 
altTotalCost=0.00, 
actualDistance=0, 
partyId like %DSV%, 
capacityWeight=0.00, 
actualProcessingTime=PT0S, 
syncToFlag like %P%, 
utilizationCapacityVolume=0, 
executionStrategy like %FIXED%, 
freeCapacityVolume=0]
/ we zien toch GEEN reference2	, omdat hij leeg is, ""	,

/ ERR (11 events	, met de hand 0)

/ 7. 

/ Unexpected events hebben een aparte data provider	,
public class UnExpectedEventDataProvider extends PrefilteredTableDataProvider<EventVO> {


/ 7	. 

/ we click DLY unexpected events	, 
/ we filter op een shipment tracking number 8F5R70NM7NR	,
EventDAOImpl.getUnExpectedListCount(DAOFilterExpression<EventVO>, boolean) line: 872	

filter	com.mpobjects.view.wicket.util.multi.GenericTableDataProvider$FilterStateFilterExpression  (id=22121)	
	parameters	java.util.ArrayList  (id=22142)	
[createdDate 2015-12-15 09:54:09.976 false GT, organizationSystemid [5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440] false IN, eventType.systemId 4455290 false EQ, eventTemplateSystemid  false NULL, 
serviceAction /NO SERVICE ACTION TYPE!!!/0 false EQ]

		createCriteria(myDetachedCriteria, filter, mySubMap);
			myDetachedCriteria.setProjection(Projections.rowCount());
			int myNum = ((Number) getHibernateTemplate().findByCriteria(myDetachedCriteria).get(0)).intValue();
3

/ we zien in de log	,
select count(*) as y0_ 
from EVENT_EVENT this_ 
inner join EVENT_TYPE eventtype1_ on this_.EVENT_TYPE_SYSTEMID=eventtype1_.SYSTEM_ID 
inner join SERVICE_ACTION serviceact2_ on this_.SERVICE_ACTION_SYSTEMID=serviceact2_.SYSTEM_ID 
inner join SHIPMENT_ORDER shipmentor3_ on serviceact2_.SHIPMENT_ORDER_SYSTEMID=shipmentor3_.SYSTEM_ID 
where (this_.ACTUAL_VALUE is null or this_.ACTUAL_VALUE='') 
and this_.CREATED_DATE>'2015-12-15 09:54:09.976' 
and this_.ORGANIZATION_SYSTEMID in ( 5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440) 
and eventtype1_.SYSTEM_ID=4455290 
and this_.EVENT_TEMPLATE_SYSTEMID is null 
and lower(shipmentor3_.REFERENCE2) like '%8f5r70nm7nr%' 
         Y0_ 
============ 
           3 
/ Klopt	,

/c
EventDAOImpl.getUnExpectedConsolidatedEvent(QueryParam, DAOFilterExpression<EventVO>, int, int) line: 772	
		List<EventVO> eventList = getUnExpectedList(queryParam, filter);
/s
EventDAOImpl.getUnExpectedList(QueryParam, DAOFilterExpression<EventVO>) line: 835	

		myDetachedCriteria.add(Restrictions.or(Restrictions.isNull("actualValue"), Restrictions.eq("actualValue", "")));
		Map<String, DetachedCriteria> mySubMap = new HashMap<String, DetachedCriteria>();

		createCriteria(myDetachedCriteria, filter, mySubMap);

filter	com.mpobjects.view.wicket.util.multi.GenericTableDataProvider$FilterStateFilterExpression  (id=22121)	
	parameters	java.util.ArrayList  (id=22142)	
[createdDate 2015-12-15 09:54:09.976 false GT, organizationSystemid [5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440] false IN, eventType.systemId 4455290 false EQ, eventTemplateSystemid  false NULL, 
serviceAction /NO SERVICE ACTION TYPE!!!/0 false EQ]

myDetachedCriteria	org.hibernate.criterion.DetachedCriteria  (id=22161)	
		criterionEntries	java.util.ArrayList  (id=22163)	
[actualValue is null or actualValue=, createdDate>2015-12-15 09:54:09.976, organizationSystemid in (5045, 5230, 5040, 5050, 5550, 5310, 5400, 3110, 5450, 5280, 5070, 5410, 3100, 3210, 5600, 5610, 5620, 3150, 3200, 3190, 200, 5540, 5290, 5080, 5560, 5300, 5090, 5460, 5420, 5100, 5110, 5470, 5520, 5120, 5570, 5020, 5430, 5125, 5130, 5140, 5150, 5160, 5170, 5030, 5190, 5200, 5210, 5500, 5580, 5530, 5220, 1084719, 5240, 5250, 5320, 5260, 5270, 5390, 12123, 5510, 5440), systemId=4455290, eventTemplateSystemid is null, reference2 like %8F5R70NM7NR%]



		addSortOrderToQuery(myDetachedCriteria, mySubMap, queryParam.getSort(), queryParam.isSortAsc());


/ 7	. 














/ Einde DSVSOL-30333

/ DSVSOL-33058

/ 7	. 

/ Support, edit profile
WAS:
Active organization: DSV-NL-MDK
NU:
Active organization:  DPD-NL

/ Einde DSVSOL-33058

/ DEBUG DSVFMS-30333

/ open event dashboard	,
/s
EventDashboardPage.<init>() line: 69	
		super();
		daoEventCacheWrapper = new BeanWrapper(EventCacheDAO.class);		// expected events	,
		daoWrapper = new BeanWrapper(EventDashboardItemDAO.class);			// unexpected events	,
		eventCustomQueryDaoWrapper = new BeanWrapper(EventCustomQueryDAO.class);	// events by query	,
		createPage();
/s
EventDashboardPage.createPage() line: 115	
		createListPanel();
/s
EventDashboardPage.createListPanel() line: 79	
		eventCustomQuerySearchListPanel = new EventCustomQueryDashboardSearchListPanel("eventCustomQuerySearchList", null, webComponentEventSwitchBoard, eventCustomQueryDaoWrapper, getEventCustomQueryListPanelAction(), new GenericTableDataProvider.Builder<EventCustomQuery>()); 
...
		expectedEventSearchListPanel = new EventCacheSearchListPanel("expectedEventSearchList", null, webComponentEventSwitchBoard, daoEventCacheWrapper, getEventListPanelAction(true), new EventCacheDataProvider.Builder());
...
		unexpectedEventSearchListPanel = new UnExpectedEventDashboardItemSearchListPanel("unexpectedEventSearchList", null, webComponentEventSwitchBoard, daoWrapper, null, new UnExpectedEventDashboardItemDataProvider.Builder(getUnExpectedPrefilterParameters()));


EventCacheDAO: from event_cache
EventDashboardItemDAO: 


/ Einde DEBUG DSVFMS-30333

/ MPO ISSUE

/ TODO MICHIEL

Every time the database connection count jumps you will see the following error messages in the log:

2016-07-20 14:59:47,917 ERROR [com.mpobjects.capabletopromise.view.wicket.planboard.JSonResourceOrders] (TP-Processor11:) could not initialize a collection: [com.mpobjects.oms.model.consignment.vo.ConsignmentVO.serviceActionList#27134092]
org.hibernate.exception.GenericJDBCException: could not initialize a collection: [com.mpobjects.oms.model.consignment.vo.ConsignmentVO.serviceActionList#27134092]
        at org.hibernate.exception.SQLStateConverter.handledNonSpecificException(SQLStateConverter.java:140)
        at org.hibernate.exception.SQLStateConverter.convert(SQLStateConverter.java:128)
        at org.hibernate.exception.JDBCExceptionHelper.convert(JDBCExceptionHelper.java:66)
        at org.hibernate.loader.Loader.loadCollection(Loader.java:2173)
        at org.hibernate.loader.collection.BatchingCollectionInitializer.initialize(BatchingCollectionInitializer.java:86)
        at org.hibernate.persister.collection.AbstractCollectionPersister.initialize(AbstractCollectionPersister.java:627)
        at org.hibernate.event.def.DefaultInitializeCollectionEventListener.onInitializeCollection(DefaultInitializeCollectionEventListener.java:83)
        at org.hibernate.impl.SessionImpl.initializeCollection(SessionImpl.java:1863)
        at org.hibernate.collection.AbstractPersistentCollection.initialize(AbstractPersistentCollection.java:369)
        at org.hibernate.collection.AbstractPersistentCollection.read(AbstractPersistentCollection.java:111)
        at org.hibernate.collection.PersistentBag.toArray(PersistentBag.java:280)
        at java.util.ArrayList.addAll(ArrayList.java:497)
        at com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO.getServiceActionList(ServiceOrderVO.java:1313)
        at sun.reflect.GeneratedMethodAccessor2768.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:622)
        at org.hibernate.proxy.pojo.javassist.JavassistLazyInitializer.invoke(JavassistLazyInitializer.java:197)
        at com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO_$$_javassist_135.getServiceActionList(ServiceOrderVO_$$_javassist_135.java)
        at com.mpobjects.capabletopromise.view.wicket.planboard.ConflictHelper.isConflictingServiceAction(ConflictHelper.java:27)

Quite a lot of them. This is where the database connections leak.
The problem is com.mpobjects.capabletopromise.view.wicket.planboard.PlanboardServiceImpl which is made stateful with the ConflictHelper class which is initialized from com.mpobjects.capabletopromise.view.wicket.planboard.JSonResourceOrders with every request. This is obviously not concurrent safe, and due to the fact that this stateful class keeps persisted object with hibernate sessions attached to it outside of transaction handling. In case of a system error the database connection will not be given back to the pool.
Of course you could make it all transactioned so that the connections are given back, but you still have the problem with a stateful singleton bean used by multiple users are the same time.

/ Geef in google	,
hibernate connection leak detection 
hibernate connection leak stateful

/ Einde MPO ISSUE

/ GGS-132

update tms_packed_item 
set actual_quantity = '46'
where shipment_item_systemid in (
	select system_id 
	from shipment_item 
	where shipment_order_systemid= (
		select system_id 
		from shipment_order 
		where shipment_order_id='SH000003101'
	)
)
and actual_quantity is null 
and quantity=46;
/ TODO MICHEL

For SH000003101:
geosco=> update tms_packed_item set actual_quantity = '46' where shipment_item_systemid in (select system_id from shipment_item where shipment_order_systemid= (select system_id from shipment_order where shipment_order_id='SH000003101'))and actual_quantity is null and quantity=46;
UPDATE 120
geosco=> update tms_packed_item set actual_quantity = '75' where shipment_item_systemid in (select system_id from shipment_item where shipment_order_systemid= (select system_id from shipment_order where shipment_order_id='SH000003101'))and actual_quantity is null and quantity=75;
UPDATE 90
geosco=> update tms_packed_item set actual_quantity = '88' where shipment_item_systemid in (select system_id from shipment_item where shipment_order_systemid= (select system_id from shipment_order where shipment_order_id='SH000003101'))and actual_quantity is null and quantity=88;
UPDATE 60
geosco=> update shipment_item set reference2 = '82658' where shipment_order_systemid = (select system_id from shipment_order where shipment_order_id='SH000003101');
UPDATE 337
geosco=> commit;
COMMIT

For SH000003006:
geosco=> update tms_packed_item set actual_quantity = '46' where shipment_item_systemid in (select system_id from shipment_item where shipment_order_systemid= (select system_id from shipment_order where shipment_order_id='SH000003006'))and actual_quantity is null and quantity=46;
UPDATE 180
geosco=> update tms_packed_item set actual_quantity = '75' where shipment_item_systemid in (select system_id from shipment_item where shipment_order_systemid= (select system_id from shipment_order where shipment_order_id='SH000003006'))and actual_quantity is null and quantity=75;
UPDATE 90
geosco=> update tms_packed_item set actual_quantity = '88' where shipment_item_systemid in (select system_id from shipment_item where shipment_order_systemid= (select system_id from shipment_order where shipment_order_id='SH000003006'))and actual_quantity is null and quantity=88;
UPDATE 89
geosco=> update shipment_item set reference2 = '82742' where shipment_order_systemid = (select system_id from shipment_order where shipment_order_id='SH000003006');
UPDATE 369
geosco=> commit;
COMMIT

For SH000003094:
geosco=> update tms_packed_item set actual_quantity = '16' where shipment_item_systemid in (select system_id from shipment_item where shipment_order_systemid= (select system_id from shipment_order where shipment_order_id='SH000003094'))and actual_quantity is null and quantity=16;
UPDATE 349
geosco=> update shipment_item set reference2 = '9239956' where shipment_order_systemid = (select system_id from shipment_order where shipment_order_id='SH000003094');
UPDATE 455
geosco=> commit;
COMMIT

For SH000003288:
geosco=> update tms_packed_item set actual_quantity = '16' where shipment_item_systemid in (select system_id from shipment_item where shipment_order_systemid= (select system_id from shipment_order where shipment_order_id='SH000003288'))and actual_quantity is null and quantity=16;
UPDATE 280
geosco=> commit;
COMMIT

For SH000003300:
geosco=> update tms_packed_item set actual_quantity = '4' where shipment_item_systemid in (select system_id from shipment_item where shipment_order_systemid= (select system_id from shipment_order where shipment_order_id='SH000003300'))and actual_quantity is null and quantity=4;
UPDATE 48
geosco=> update tms_packed_item set actual_quantity = '10' where shipment_item_systemid in (select system_id from shipment_item where shipment_order_systemid= (select system_id from shipment_order where shipment_order_id='SH000003300'))and actual_quantity is null and quantity=10;
UPDATE 21
geosco=> update tms_packed_item set actual_quantity = '12' where shipment_item_systemid in (select system_id from shipment_item where shipment_order_systemid= (select system_id from shipment_order where shipment_order_id='SH000003300'))and actual_quantity is null and quantity=12;
UPDATE 26
geosco=> update tms_packed_item set actual_quantity = '60' where shipment_item_systemid in (select system_id from shipment_item where shipment_order_systemid= (select system_id from shipment_order where shipment_order_id='SH000003300'))and actual_quantity is null and quantity=60;
UPDATE 4
geosco=> commit;
COMMIT

For SH000003204:
geosco=> update tms_packed_item set actual_quantity = '80' where shipment_item_systemid in (select system_id from shipment_item where shipment_order_systemid= (select system_id from shipment_order where shipment_order_id='SH000003204'))and actual_quantity is null and quantity=80;
UPDATE 75
geosco=> commit;
COMMIT




/ Einde GGS-132

/ BARD-170

/ 7	. 

[eric@localhost workspace]$ svn co  https://system.mp-objects.com/svn/tms/patches/2016.01/bard

eric@localhost bin]$ cat bard-psql-p.sh 
PGPASSWORD=h^Zgcyr\&Q psql -U vanderveldene -h  bard-app-p.intermax.mp-objects.com bard 
/ OK
[eric@localhost bin]$ cat  bard-pg_dump-p.sh 
PGPASSWORD=h^Zgcyr\&Q pg_dump -Fc -U vanderveldene -h bard-app-p.intermax.mp-objects.com bard > /home/eric/DB_TAP/Postgres/Backup/bard-p-$(date +%F).dump

[eric@localhost bin]$ bard-pg_dump-p.sh 
/ OK
pnllogistics0701p=# create database bard0705p tablespace scs;
CREATE DATABASE

[eric@localhost bin]$ find /home/eric/DB_TAP/Postgres/Backup/ -type f | grep bard | xargs  ls -1tr | awk 'END{print}' | xargs local-pg_restore.sh bard0705p 
/ OK

/ we import bard in eclipse	,
File, import..., existing projects into workspace

/ In jboss moeten we een bard/ create	, postgres-ds.xml aanpassen	, en een bard-schedule-service.xml maken	,
/ OK

/ 7	. 

/ Open een sho	,
6291690
/ click Product item tab	,
Hide 

Actual Quantity 
weight(kG)
total volume(m3)
Individual item value 	
Country of origin		
Series
Original customer order id
Original customer order line id
Current customer order id
Current customer order line id
Current line quantity

/ FIX BARD-170
/ In db	, insert	, 
module.oms.productitem.actualquantity.hidden=true 	/ al	, 
module.oms.productitem.weightkg.hidden=true			/ insert	,
module.oms.productitem.totalvolumem3.hidden=true	
module.oms.productitem.individualitemvalue.hidden=true
module.oms.productitem.countryoforigin.hidden=true
module.oms.productitem.productseries.hidden=true
module.oms.customerorder.fields.hidden=true

customerorder.fields.hidden
module.oms.productitem.customerorder.fields.hidden

/ $ vi shipment-order_edit.jsp;

customerorder.fields.hidden
				<c:if test="${cf:property('oms', 'shipmentorder.hide.productitems', 'false')=='false'}">
					<mpo:tab name="productItems">
						<tmstags:sho-productitems />
					</mpo:tab>
				</c:if>

/ headers & data	,
$ vi sho-productitems.tag

				<c:if test="${cf:property('oms', 'productitem.actualquantity.hidden', 'false')=='false'}">
					<th><mpo:label name="actualQuantity" entity="productitem" /></th>
				</c:if>
				<c:if test="${cf:property('oms', 'productitem.weightkg.hidden', 'false')=='false'}">
					th><mpo:label name="weightKg" entity="productitem" /></th>
				</c:if>
				<c:if test="${cf:property('oms', 'productitem.totalvolumem3.hidden', 'false')=='false'}">				
					<th><mpo:label name="totalVolumeM3" entity="productitem" /></th>
				</c:if>

				<c:if test="${cf:property('oms', 'productitem.actualquantity.hidden', 'false')=='false'}">
					<td>${cf:formatNumber(currentItem.actualQuantity)}</td>
				</c:if>
				<c:if test="${cf:property('oms', 'productitem.weightkg.hidden', 'false')=='false'}">
					<td>${cf:formatNumber(currentItem.weightKg)}</td>
				</c:if>
				<c:if test="${cf:property('oms', 'productitem.totalvolumem3.hidden', 'false')=='false'}">
					td>${cf:formatNumber(currentItem.totalVolumeM3)}</td>
				</c:if>



/ Einde BARD-170

/ BASH

/ Lees	, 
http://inai.de/linux/usr_sshpipe
but exactly that is a non-interactive session. In both modes, interactive and non-ia, the local STDIN/STDOUT is blindly connected to the remote STDIN/STDOUT 

[eric@localhost bin]$ 2>/dev/null ssh vanderveldene@geosco-app-t.intermax.mp-objects.com "> my.txt"
/ Maak remote my.txt leeg	,
[eric@localhost bin]$ 2>/dev/null ssh vanderveldene@geosco-app-t.intermax.mp-objects.com "cat >> my.txt"
Foo Bar
^d
[eric@localhost bin]$ 2>/dev/null ssh vanderveldene@geosco-app-t.intermax.mp-objects.com "cat my.txt" 
Foo Bar
[eric@localhost bin]$ 2>/dev/null ssh vanderveldene@geosco-app-t.intermax.mp-objects.com cat my.txt
Foo Bar
/ Hier kunnen de "" dus weglaten	, 
/ Maar hier NIET	,
[eric@localhost bin]$ 2>/dev/null ssh vanderveldene@geosco-app-t.intermax.mp-objects.com cat >>my.txt
Foo Bar
^d
/ Deze writes naar local my.txt
/ TODO
/ Ook local	,
[eric@localhost bin]$ 2>/dev/null ssh vanderveldene@geosco-app-t.intermax.mp-objects.com cat
Foo Bar
Foo Bar
/ TODO


/ Einde BASH

/ KRAMP-374

/ 7	. 

/ Ga naar kramp op test	,
/ Open SH002645423	, deze heeft 1 DELIVERY seo	,
N3113722

/ 7	 

[eric@localhost bin]$ mk_ssh_passwordless_intermax.sh  kramp-int-p
h^Zgcyr&Q
[eric@localhost bin]$ mk_ssh_passwordless_intermax.sh  kramp-int-a
h^Zgcyr&Q
[eric@localhost bin]$ mk_ssh_passwordless_intermax.sh  kramp-int-t
h^Zgcyr&Q

[vanderveldene@kramp-int-p ~]$ cd  /local/apps/interface/kramp/
[vanderveldene@kramp-int-p kramp]$ ls
DespatchAdvice  OrderChange  rest

/ 7	. 

/ in shell $ kramp-ssh-t.sh hangs	, we kill in andere bash met $ ps ajx $ kill process	, 
/ als we in 1ste shell terug komen	, werkt Enter niet meer	, geen nieuwe regel 	, 
/ TODO
/ Lees	,
http://www.tldp.org/HOWTO/Keyboard-and-Console-HOWTO-5.html

/ we kunnen niet $ kramp-pg_dump-a.sh	, want de postgres versie op kramp-app-a is 5.3	, local 3.5	,
/ TODO
/ we pg_dump op de server	, 
/ en halen over met scp	,
[vanderveldene@kramp-app-a ~]$ PGPASSWORD=h^Zgcyr\&Q pg_dump -Fc -U vanderveldene -h kramp-app-a.intermax.mp-objects.com kramp > Postgres/Backup/kramp-a-$(date +%F).dump
[eric@localhost bin]$ scp  vanderveldene@kramp-app-a.intermax.mp-objects.com:Postgres/Backup/kramp-a-2016-07-06.dump /home/eric/DB_TAP/Postgres/Backup/

/ en op test	, 
[vanderveldene@kramp-app-t ~]$ PGPASSWORD=h^Zgcyr\&Q pg_dump -Fc -U vanderveldene -h kramp-app-t.intermax.mp-objects.com kramp > Postgres/Backup/kramp-t-$(date +%F).dump
/ localhost werkt NIET
/ TODO


/ 7	. 

/ we start kramp	, met oude db kramp1a	,
/ patch error	,

/ psql -f of stdin	,
/ we oef	,
[eric@localhost 2016.01]$ 2>/dev/null find /tmp -name 1.sql | xargs cat  | PGPASSWORD=foo psql -U foo
Null display is "NULL".
              now              
-------------------------------
 2016-07-06 07:31:44.418227-04
(1 row)

/ of	,
[eric@localhost 2016.01]$ 2>/dev/null find /tmp -name 1.sql |  PGPASSWORD=foo xargs psql -U foo -f 
Null display is "NULL".
              now              
-------------------------------
 2016-07-06 07:37:01.570845-04
(1 row)

[eric@localhost 2016.01]$ find -name "patch*customerperf*sql" | xargs -I % cp % ~/tmp
[eric@localhost 2016.01]$ vi ~/tmp/patch-002-customerperformance.sql 
drop view if exists customer_performance;
create view customer_performance AS
...
commit;

/ Nu kunnen we	,
[eric@localhost 2016.01]$ find ~/tmp -name "patch*customerperf*sql" | xargs cat | PGPASSWORD=mpopostgres@mpo psql  -U  mpopostgres kramp1a

/ Lees over find & Permission denied	,
http://stackoverflow.com/questions/762348/how-can-i-exclude-all-permission-denied-messages-from-find


kramp1a=# update  mpo_scs_patch set status='MANUALLY_APPLIED' where name like '%patch-002%customer%';
UPDATE 1
kramp1a=# commit;
COMMIT

/ 7	. 

[eric@localhost 2016.01]$ find . -name "patch-003-carrierperformance.sql" | xargs -I % cp % ~/tmp
[eric@localhost 2016.01]$ vi ~/tmp/patch-003-carrierperformance.sql 
drop view if exists carrier_performance;
create view carrier_performance AS
...
commit;

[eric@localhost 2016.01]$ find ~/tmp -name "patch-003-carrierperformance.sql" | xargs cat | PGPASSWORD=mpopostgres@mpo psql  -U  mpopostgres kramp1a 
Null display is "NULL".
NOTICE:  view "carrier_performance" does not exist, skipping
DROP VIEW
CREATE VIEW
COMMIT

/ 7	.  

/ We kunnen ook met awk de patch aanpassen	, 
[eric@localhost 2016.01]$ find  -name "patch-003-carrierperf*"  | xargs cat | awk 'NR==1{gsub(/drop view/,"drop view if exists") ;print}END{print "commmit"}'
/ OK

/ Zo sql	, 
[eric@localhost 2016.01]$ echo "insert into s2 values(77);commit;" | PGPASSWORD=foo psql -U foo
Null display is "NULL".
INSERT 0 1
COMMIT

/ 7	. 

/ MORGENOCHTEND
/ Maak een sho	, er is maar 1 template	,
/ Hoe met XML?
/ we hebben 2 database dumps	,
-rw-rw-r--. 1 eric     eric     2463777977 Jul  6 13:22 kramp-a-2016-07-06.dump
-rw-rw-r--. 1 eric     eric      777480311 Jul  6 13:39 kramp-t-2016-07-06.dump

/ we maken een nieuwe db	,
sco0706p=# create database kramp0706t tablespace scs;
CREATE DATABASE
[eric@localhost bin]$ local-pg_restore.sh  kramp0706t ~/DB_TAP/Postgres/Backup/kramp-t-2016-07-06.dump 

sco0706p=# create database kramp0706a tablespace scs;
CREATE DATABASE
[eric@localhost bin]$ local-pg_restore.sh  kramp0706a ~/DB_TAP/Postgres/Backup/kramp-a-2016-07-06.dump 

/ 7	. 

/ kramp1a
/ create sho: silently rolled back	,

/ kramp0706t
/ create sho met template	, 
SH000509580

/ hij is meteen planned in	, we hoeven niet eerst een shi te create	, 
/ Ga naar de delivery	, click  N0770488.1
/ click Events tab	,
/ click Create custom event
Type: DLY
Closed on: <gisteren>
Save seo

/ Ga naar de POD: click date icond onder Closed on, kies <vandaag>
Save seo
/ we zien dat de seo 
status 9000	, 
actual end date: <de datetime uit de pod>

/ In de DLY zou een message moeten staan: ...	, maar is LEEG	,
/ Dit is het issue	,

/ we kunnen link blauwe pijltje click : 
status seo wordt weer 1450, 
seo's actual end date is leeg	, 
en de pod's closed on is leeg	,

/ we kunnen het opnieuw doen	,


/ confiig, exec, events, event type
code: dly
Can Be Closed By Types: POD 





/ Einde KRAMP-374

/ GEOSCO CREATE SHIPMENT ORDER

[vanderveldene@geosco-int-p to-scs]$ pwd
/local/apps/interface/geodispsa/to-scs
[vanderveldene@geosco-int-p to-scs]$ less OrderChange/archive/2016-07/08/18-PREINV-ID-geosco-int-p-52926-1463537208771-2-5710-1-1-1.xml
<mtc:SHIPMENT_ORDER_MSG xmlns:xs="http://www.w3.org/2001/XMLSchema"
                        xmlns:mtccore="http://system.mp-objects.com/schemas
...

/ Als we een vakje invullen in forecast scherm	, wordt er dan XML gen	? 
/ TODO 

/ Einde GEOSCO CREATE SHIPMENT ORDER

/ LINUX

/ use -L als het een soft link is	, -L = --deference	,
eric@mposerv8:~$ ls -Lltrh /local/apps/firebird
-rw-rw-r-- 1 firebird firebird  29G Jul  8 03:04 dsvfms.fdb
/ MORGENOCHTEND





/ Einde LINUX

/ GGS-118

[eric@localhost bin]$ geosco-pg_dump-p.sh 
kramp1a=# create database geosco0706p tablespace scs;
CREATE DATABASE
[eric@localhost bin]$ find  ~/DB_TAP/Postgres/Backup/ | grep geosco | xargs ls -1tr | awk 'END{print}' | xargs local-pg_restore.sh geosco0706p 

/ we zien in ticket PSA_MPO_DESADV_20160706_104336_3090.xml
/ Dit is in origineel format	, 
/ Hoe vinden we de file in ons format	?
[vanderveldene@geosco-int-p 06]$ pwd
/local/apps/interface/geodispsa/to-scs/DespatchAdvice/archive/2016-07/06
[vanderveldene@geosco-int-p 06]$ grep 'PSA_MPO_DESADV_20160706_104336_3090' -r *
04-DESADV-ID-geosco-int-p-52926-1463537208771-2-5365-1-1-2.xml:         <mtc:VALUE>PSA_MPO_DESADV_20160706_104336_3090.xml</mtc:VALUE>
[vanderveldene@geosco-int-p 06]$ grep 'PSA_MPO_DESADV_20160706_104336_3090' -r * | awk -F: '{print $1}'
04-DESADV-ID-geosco-int-p-52926-1463537208771-2-5365-1-1-2.xml

[vanderveldene@geosco-int-p 06]$ grep 'PSA_MPO_DESADV_20160706_104336_3090' -r * | awk -F: '{print $1}' | xargs less
...

$ vi log
org.springframework.dao.InvalidDataAccessApiUsageException: object is an unsaved transient instance - save the transient instance before merging: c
om.mpobjects.oms.model.shipmentorder.vo.PackedItemVO; nested exception is org.hibernate.TransientObjectException: object is an unsaved transient in
stance - save the transient instance before merging: com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO
        at org.springframework.orm.hibernate3.SessionFactoryUtils.convertHibernateAccessException(SessionFactoryUtils.java:671)
        at org.springframework.orm.hibernate3.HibernateAccessor.convertHibernateAccessException(HibernateAccessor.java:412)
        at org.springframework.orm.hibernate3.HibernateTemplate.doExecute(HibernateTemplate.java:412)
        at org.springframework.orm.hibernate3.HibernateTemplate.executeWithNativeSession(HibernateTemplate.java:375)
        at org.springframework.orm.hibernate3.HibernateTemplate.merge(HibernateTemplate.java:814)
        at com.mpobjects.util.dao.GenericHibernateDAO.merge(GenericHibernateDAO.java:433)
        at com.mpobjects.oms.model.shipmentorder.dao.ProductItemDAOImpl.save(ProductItemDAOImpl.java:227)
        at com.mpobjects.oms.model.shipmentorder.dao.ProductItemDAOImpl.save(ProductItemDAOImpl.java:40)
        at sun.reflect.GeneratedMethodAccessor402.invoke(Unknown Source)
$ vi ProductItemDAOImpl
	@Override
	public ProductItemVO save(ProductItemVO anEntity) {
		return super.merge(anEntity);
	}

 have taken PSA_MPO_DESADV_20160706_104336_3090.xml.
This message is about a non-existing shipment order 83690580, and so a non-existing product item 98120910ZD.
I think this is it, but to be sure I will start debugging now.

/we halen de XML over	,
[vanderveldene@geosco-int-p 06]$ grep 'PSA_MPO_DESADV_20160706_104336_3090' -r * | awk -F: '{print $1}' 
04-DESADV-ID-geosco-int-p-52926-1463537208771-2-5365-1-1-2.xml

R1N5DU0UI

/ Einde GGS-118

/ GGS-118

SCO_PSA_WPS328423803
07/07/16 05:30:43
M7701605.txt

/ In psa zijn alle shipment items er al	, SCS geeft ze een label info	, 
/ de supplier geeft  de shipment_item een case_number	, dit is geijk aan reference2	,  

/ In de XML	,
               <so:SHIPMENT_ITEMS>
                  <mtccore:SHIPMENT_ITEM>
                     <mtccore:SHIPMENT_ITEM_ID>153419912</mtccore:SHIPMENT_ITEM_ID>
                     <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:PRODUCT_ITEM_ID>98120910ZD</mtccore:PRODUCT_ITEM_ID>
                           <mtccore:SHIPMENT_ORDER_ID>83690580</mtccore:SHIPMENT_ORDER_ID>
/ 83690580 als shipment_order_id slaat helemaal nergens op	, 
/ TODO
/ hieronder gaan we de sho opzoeken	,

/ 98120910ZD is de partnumber/productid van de product , en heeft niets met product_item te maken	,
/ TODO

/ In SCS scherm kunnen we
planning , sho, search by item
/ we kunnen daar het label invullen 	,
/ we zien in onze XML 4 shi's 	, en elk heeft een label info	,

/we hebben 2 desadv's op 6 juli die fout gaan	,

/ 13	. 

/ In 04-DESADV-ID-geosco-int-p-52926-1463537208771-2-5365-1-1-2.xml van 6 Juli	,
label info=
SF4HMSLAM
X2C95CK0L
...
/ we zien   op de shi's in deze sho dat de case_number helemaal niet is set, dus ook deze is fout gegaan	,

/ 13	.

/ In 04-DESADV-ID-geosco-int-p-52926-1463537208771-2-5378-1-1-1.xml
8CQA6UQCW
/ Deze is in SH000003221
 system_id 
-----------
  26882118
/ In de XML staat	00035419 als system_order_id	,
/ we zien   op de shi's in deze sho dat de case_number helemaal niet is set, dus ook deze is fout gegaan	,

/13	. 

/ we kunnen ook queries	,
geosco=> select system_id from shipment_item where label_info='SF4HMSLAM';	/ 26950774
geosco=> select product_system_id from tms_packed_item where shipment_item_systemid= 26950774; /  26893023 
geosco=> select part_number from tms_product_item where system_id= 26893023; / '98120910ZD'
geosco=> select productid from product where partnumber='98120910ZD'; '98120910ZD'
/ Dus die zijn gelijk	,
/ TODO (Waarom?)

/ 13	. 

select count(*)
from shipment_order sho
join shipment_item shi on shi.shipment_order_systemid=sho.system_id
where sho.system_entry_date=date '2016-07-06'-interval '1 week'
and shi.case_number is not null;

select max(sho.system_entry_date) 
from shipment_order sho
join shipment_item shi on shi.shipment_order_systemid=sho.system_id
and shi.case_number is not null;
           max           
-------------------------
 2016-07-04 18:31:22.603
(1 row)

select distinct sho.shipment_order_id
from shipment_order sho
join shipment_item shi on shi.shipment_order_systemid=sho.system_id
and shi.case_number is not null
and sho.system_entry_date='2016-07-04 18:31:22.603';
      shipment_order_id      
-----------------------------
 SH000003197-20160704-183122


select shi.case_number
from shipment_order sho
join shipment_item shi on shi.shipment_order_systemid=sho.system_id
and shi.case_number is not null
and sho.system_entry_date='2016-07-04 18:31:22.603';

geosco-> and sho.system_entry_date='2016-07-04 18:31:22.603';
 case_number 
-------------
 990018473
 990980469
 990010751
 990011738
 990010752
 990010768
 990008576
 990006312
 990620846
 990018064
 990010055
 990997017
 990008579
 990997029
 990008572
 990018472
 990010754
 990010058
 990984230
 990014753
 990010756
 990010051
 990997030
 990018076
 990008580
 990018065
 990008578
 990018470
 990006313
 990008561
 990984228
 990581719
 990011732
 990595125
 990018469
(35 rows)

/ Op geosco-int-p	,
[vanderveldene@geosco-int-p 2016-07]$ find -name "*.xml" | xargs grep 990018473
./04/04-DESADV-ID-geosco-int-p-52926-1463537208771-2-5025-1-1-2.xml:                     <mtccore:SHIPMENT_ITEM_ID>990018473</mtccore:SHIPMENT_ITEM_ID>
./04/04-DESADV-ID-geosco-int-p-52926-1463537208771-2-5025-1-1-2.xml:                     <mtccore:CASE_NUMBER>990018473</mtccore:CASE_NUMBER>

/ OK	,
[eric@localhost ggs-118]$ ls 0704
04-DESADV-ID-geosco-int-p-52926-1463537208771-2-5025-1-1-2.xml  README.txt

/ ERR	,
[eric@localhost ggs-118]$ ls 0707
04-DESADV-ID-geosco-int-p-52926-1463537208771-2-5365-1-1-2.xml  README.txt


98120910ZD
SH000003166
26895308

/ FIX GGS-118
	private ShipmentItemVO moveShipmentItem(Map<ProductItemVO, ProductItemVO> aProductItemMapping, ShipmentItemVO anOriginalShipmentItem, ShipmentOrderVO aNewShipmentOrderVO, ShipmentItemVO aNewParent) {
		ShipmentItemVO myNewShipmentItem = anOriginalShipmentItem.copy();
		aNewShipmentOrderVO.addShipmentItem(myNewShipmentItem);
		anOriginalShipmentItem.setLabelInfo(anOriginalShipmentItem.getLabelInfo() + "-D");
		// In this way, by appending 'R', you can only report on a box once
		myNewShipmentItem.setLabelInfo(myNewShipmentItem.getLabelInfo() + "-R");
		if (aNewParent != null) {
			aNewParent.addChild(myNewShipmentItem);
		}
		shipmentItemService.save(anOriginalShipmentItem);
		myNewShipmentItem = shipmentItemService.save(myNewShipmentItem);
		// copy packed items
		List<PackedItemVO> myOrigPackedItemList = anOriginalShipmentItem.getPackedItemList();
		for (PackedItemVO myOrigPackedItemVO : myOrigPackedItemList) {
			PackedItemVO myNewPackedItem = new PackedItemVO();
			myNewPackedItem.setRequestedQuantity(myOrigPackedItemVO.getRequestedQuantity());
			myNewPackedItem.setQuantity(myOrigPackedItemVO.getQuantity());
			myNewPackedItem.setActualQuantity(myOrigPackedItemVO.getActualQuantity());
			myNewPackedItem.setShipmentItemVO(myNewShipmentItem);
			// get product item by product mapping already made, and wire bidirectionally together
			ProductItemVO myNewProductItem = aProductItemMapping.get(myOrigPackedItemVO.getProductItemVO());
			myNewPackedItem.setProductItemVO(myNewProductItem);
			myNewShipmentItem.getPackedItemList().add(myNewPackedItem);
			myNewProductItem.getPackedItemList().add(myNewPackedItem);
			packedItemDAO.save(myNewPackedItem);								<-
			// Set qty based on the original qty
			myNewProductItem.setQuantity(myNewProductItem.getQuantity().add(myNewPackedItem.getRequestedQuantity()));







/ Einde GGS-118

/ OPEN IN BASH

/home/eric/Integration/Geosco/ggs-118
/home/eric/Integration/Geosco/ggs-87
/home/eric/Devel/Interfaces/dsvfms


/ Einde OPEN IN BASH

/ OPEN IN CHROME

http://superuser.com/questions/336016/invoking-vi-through-find-xargs-breaks-my-terminal-why
file:///home/eric/Downloads/PSA_MPO_DESADV_20160706_104336_3090.xml


/ Einde OPEN IN CHROME


/ BASH

/ alternative scp	,

[eric@localhost Geosco]$ 2>/dev/null ssh vanderveldene@geosco-int-p.intermax.mp-objects.com "ls| grep DESADV"
04-DESADV-ID-geosco-int-p-52926-1463537208771-2-5365-1-1-2.xml
[eric@localhost Geosco]$ 2>/dev/null ssh vanderveldene@geosco-int-p.intermax.mp-objects.com "ls| grep DESADV|xargs cat" >/tmp/try.xml
/ Hoe de name van de file bewaren?
/ TODO

/ we doen met de hand	,
[eric@localhost Geosco]$ cat ggs-118/04-DESADV-ID-geosco-int-p-52926-1463537208771-2-5365-1-1-2.xml 


/ Einde BASH

/ DEBUG GGS-118

/ See
/ HANDLE 04-DESADV ABSTRACT 

//////////////////////////////////////////
/ Een 04-DESADV creates een seo	,
/ TODO

/s
GeoScoServiceOrderProcessor.processDespatchAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 420	
		ServiceOrderVO updateServiceOrderVO = aProcessor.process(selectSingleNode(aNode, SERVICE_ORDER_BODY_TAG));

         <so:SERVICE_ORDER_BODY>
            <mtccore:COMMON>
               <mtccore:DATE_SET>
                  <mtccore:PLANNED_END_AFTER>2016-07-06T10:42:00</mtccore:PLANNED_END_AFTER>
               </mtccore:DATE_SET>
            </mtccore:COMMON>
            <mtccore:SERVICE_ORDER_ID/>
            <mtccore:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtccore:ORGANIZATION_ID>
         </so:SERVICE_ORDER_BODY>

/s
ServiceOrderBodyProcessor.process(Node) line: 360	
		ServiceOrderVO myServiceOrderVO = new ServiceOrderVO();
			String myOrg = getTextNode(aNode, ORGANIZATION_ID_TAG);
			if (StringUtils.isNotBlank(myOrg)) {
				Organization myOrganizationVO = MpoBeanFactory.getBean(OrganizationService.class).getOrganization(myOrg);
SystemId:12000	Id:LOG_EMEA_FR_CT_PSA	Description:Organization for PSA CT
				if (myOrganizationVO != null) {
					myServiceOrderVO.setOrganization(myOrganizationVO);

			new LogisticsOrderBodyProcessor(this).process(selectSingleNode(aNode, COMMON_TAG), myServiceOrderVO);
/s
LogisticsOrderBodyProcessor.process(Node, LogisticsOrderVO) line: 187	
				DateSetVO myDateSet = new DateSetProcessor(this).process(myNode);
RSAFTER: null, RSBEFORE: null, REAFTER: null, REBEFORE: null, PSAFTER: null, PSBEFORE: null, PEAFTER: Wed Jul 06 10:42:00 CEST 2016, PEBEFORE: null, AS: null, AE: null, RELEASE:null, PRELEASE:null, CLOSE:null

				aLogisticsOrderVO.setDateSetVO(myDateSet);
aLogisticsOrderVO is de seo die deze 04-DESADV creates	,

/t
ServiceOrderBodyProcessor.process(Node) line: 379	
			new LogisticsOrderBodyProcessor(this).process(selectSingleNode(aNode, COMMON_TAG), myServiceOrderVO);
/d
			String myId = getTextNode(aNode, SERVICE_ORDER_ID_TAG);
""
/ Klopt <SERVICE_ORDER_ID/> 
			if (myId != null) {
				myServiceOrderVO.setServiceOrderId(myId);

			String myProcess = getTextNode(aNode, SERVICE_ORDER_PROCESS_TAG);
""
			} else {
				myServiceOrderVO.setOrderProcess(OrderProcessUtils.getByCode(OrderProcess.OUTBOUND));
OrderProcessUtils.getByCode(OrderProcess.OUTBOUND)
	code	"OUTBOUND" (id=25344)	
	deleted	false	
	description	"Outbound" (id=25345)	
	organization	null	
	performanceMonitorService	null	
	systemId	26594670	

geosco0706p=# select*from order_process where code='OUTBOUND';
 system_id |   code   | description | organization_systemid | is_deleted 
-----------+----------+-------------+-----------------------+------------
  26594670 | OUTBOUND | Outbound    |                  NULL |          0
(1 row)

/ Intermezzo

/ bijv	,

			String myLevel = getTextNode(aNode, SERVICE_LEVEL_TAG);
""
			Node myExecBy = selectSingleNode(aNode, EXECUTED_BY_TAG);
null

/ Einde Intermezzo

			myServiceOrderVO.setSystemEntryDate(MpoBeanFactory.getBean(TimeService.class).getPresentDate(myServiceOrderVO.getOrganization()));
Thu Jul 07 13:17:33 CEST 2016
/ nu	,

			return myServiceOrderVO;
/t
GeoScoServiceOrderProcessor.processDespatchAdviceShipment(Node, ServiceOrderBodyProcessor, String) line: 420	
		ServiceOrderVO updateServiceOrderVO = aProcessor.process(selectSingleNode(aNode, SERVICE_ORDER_BODY_TAG));
/d
		processConsignments(aNode, updateServiceOrderVO);

         <so:CONSIGNMENT>
            <so:CONSIGNMENT_BODY>
               <mtccore:COMMON/>
               <mtccore:CONSIGNMENT_ID/>
            </so:CONSIGNMENT_BODY>
            <so:SHIPMENT_ORDER>
               <so:SHIPMENT_ORDER_BODY>
                  <mtccore:ORGANIZATION_ID>LOG_EMEA_FR_CT_PSA</mtccore:ORGANIZATION_ID>
               </so:SHIPMENT_ORDER_BODY>
               <so:PRODUCT_ITEMS>
                  <mtccore:PRODUCT_ITEM>
                     <mtccore:PRODUCT_ITEM_ID>98120910ZD</mtccore:PRODUCT_ITEM_ID>
                     <mtccore:SHIPMENT_ORDER_ID>83690580</mtccore:SHIPMENT_ORDER_ID>
                     <mtccore:PRODUCT>
                        <mtccore:PRODUCT_ID>98120910ZD</mtccore:PRODUCT_ID>
                        <mtccore:DESCRIPTION>P8X GRN INF VOLET AR CLASSIQUE</mtccore:DESCRIPTION>
                     </mtccore:PRODUCT>
                     <mtccore:QUANTITY>40</mtccore:QUANTITY>
                  </mtccore:PRODUCT_ITEM>
               </so:PRODUCT_ITEMS>
               <so:SHIPMENT_ITEMS>
                  <mtccore:SHIPMENT_ITEM>
                     <mtccore:SHIPMENT_ITEM_ID>153419912</mtccore:SHIPMENT_ITEM_ID>
                     <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:PRODUCT_ITEM_ID>98120910ZD</mtccore:PRODUCT_ITEM_ID>
                           <mtccore:SHIPMENT_ORDER_ID>83690580</mtccore:SHIPMENT_ORDER_ID>
                           <mtccore:QUANTITY>8</mtccore:QUANTITY>
                        </mtccore:PACKED_ITEM>
                     </mtccore:PACKED_ITEMS>
                     <mtccore:PACKAGE_CODE/>
                     <mtccore:LABEL_NUMBER>SF4HMSLAM</mtccore:LABEL_NUMBER>
                     <mtccore:AIRWAYBILL_NUMBER>83690580</mtccore:AIRWAYBILL_NUMBER>
                     <mtccore:CASE_NUMBER>153419912</mtccore:CASE_NUMBER>
                     <mtccore:CONTAINER_NUMBER>153419912</mtccore:CONTAINER_NUMBER>
                     <mtccore:SHIPMENT_ITEM_REFERENCE>
                        <mtccore:VALUE/>
                        <mtccore:QUALIFIER>REFERENCE1</mtccore:QUALIFIER>
                     </mtccore:SHIPMENT_ITEM_REFERENCE>
                     <mtccore:SHIPMENT_ITEM_REFERENCE>
                        <mtccore:VALUE>83690580</mtccore:VALUE>
                        <mtccore:QUALIFIER>REFERENCE2</mtccore:QUALIFIER>
                     </mtccore:SHIPMENT_ITEM_REFERENCE>
                     <mtccore:SHIPMENT_ITEM_REFERENCE>
                        <mtccore:VALUE>FR</mtccore:VALUE>
                        <mtccore:QUALIFIER>REFERENCE3</mtccore:QUALIFIER>
                     </mtccore:SHIPMENT_ITEM_REFERENCE>
                  </mtccore:SHIPMENT_ITEM>
/s
GeoScoServiceOrderProcessor(ServiceOrderProcessorImpl).processConsignments(Node, ServiceOrderVO) line: 339	

/ een 04-DESADV creates een seo	, en een consignment	,

			Iterable<Node> myConsignmentIterator = selectNodeIterable(aNode, "CONSIGNMENT");
			ArrayList<ConsignmentVO> myConsignmentList = new ArrayList<ConsignmentVO>();
			for (Node myConsignmentNode : myConsignmentIterator) {
				} else {
/////////////////////////////////////
					ConsignmentVO myConsignment = new ConsignmentVO();

					ArrayList<ServiceActionVO> myServiceActionList = new ArrayList<ServiceActionVO>();
					String myConsignmentNr = selectText(myConsignmentNode, "CONSIGNMENT_BODY", "CONSIGNMENT_ID");
""
					if (StringUtils.isNotEmpty(myConsignmentNr)) {
/ NEE
					Iterable<Node> myShipmentOrderIterator = selectNodeIterable(myConsignmentNode, "SHIPMENT_ORDER");
					for (Node myShipmentOrderNode : myShipmentOrderIterator) {
						if (myShipmentOrderNode == null) {
							break;
						} else {
							ParsedShipmentOrder myParsedShipmentOrderVO = new ShipmentOrderProcessor().process(myShipmentOrderNode);
/s
ShipmentOrderProcessor.process(Node) line: 204	
		ShipmentOrderBodyProcessor myProcessor = Factory.getFactory().getInstance(ShipmentOrderBodyProcessor.class);
			myShipmentOrderVO = myProcessor.process(selectSingleNode(aNode, SHIPMENT_ORDER_BODY_TAG));
/ new
systemId=0

			List<ProductItemVO> myProductList = parseProductItems(aNode, myShipmentOrderVO);
/s
ShipmentOrderProcessor.parseProductItems(Node, ShipmentOrderVO) line: 153	

		ProductItemProcessor productItemProcessor = new ProductItemProcessor(this);

		Node myNode = myItemsNode.getFirstChild();
		while (myNode != null) {
			if (myNode.getNodeType() == Node.ELEMENT_NODE) {
				if (PRODUCT_ITEM_TAG.equals(getElementName(myNode))) {
					ProductItemVO myProductItem = productItemProcessor.process(myNode, myShipmentOrderVO);
/s
ProductItemProcessor.process(Node, ShipmentOrderVO) line: 312	

                 <mtccore:PRODUCT_ITEM>
                     <mtccore:PRODUCT_ITEM_ID>98120910ZD</mtccore:PRODUCT_ITEM_ID>
                     <mtccore:SHIPMENT_ORDER_ID>83690580</mtccore:SHIPMENT_ORDER_ID>
                     <mtccore:PRODUCT>													<- NIET processed	,
                        <mtccore:PRODUCT_ID>98120910ZD</mtccore:PRODUCT_ID>
                        <mtccore:DESCRIPTION>P8X GRN INF VOLET AR CLASSIQUE</mtccore:DESCRIPTION>
                     </mtccore:PRODUCT>
                     <mtccore:QUANTITY>40</mtccore:QUANTITY>
                  </mtccore:PRODUCT_ITEM>

			ProductItemVO myItemVO = new ProductItemVO();
/ Ook met new	,
			Node childNode = aNode.getFirstChild();
			while (childNode != null) {
				if (childNode.getNodeType() == Node.ELEMENT_NODE) {
					String tag = getElementName(childNode);

					if (PRODUCT_ITEM_ID_TAG.equals(tag)) {
						// uniqueId = childNode.getTextContent();
						myItemVO.setProductItemId(childNode.getTextContent());
/s
		theProductItemId = aProductItemId;
98120910ZD
/ TODO PAUL (product_item_id='010' bijv, in tms_product_item is dit part_number)

/ volgende	,
					} else if (SHIPMENT_ORDER_ID_TAG.equals(tag)) {
						myItemVO.setParsedShipmentOrderId(childNode.getTextContent());
/s
		parsedShipmentOrderId = aParsedShipmentOrderId;

/ volgende	,
					} else if (ProductProcessor.PRODUCT_TAG.equals(tag)) {
						LOG.warn("Parsing product info on product item is not supported, ignoring...");
/ volgende	,
					} else if (QUANTITY_TAG.equals(tag)) {
						myItemVO.setQuantity(new BigDecimal(childNode.getTextContent()));
/t
ShipmentOrderProcessor.process(Node) line: 215	
			List<ProductItemVO> myProductList = parseProductItems(aNode, myShipmentOrderVO);
/d
			List<ShipmentItemVO> myShipmentItems = parseShipmentItems(aNode, myProductList, myShipmentOrderVO.getOrganizationSystemid());
/s
ShipmentOrderProcessor.parseShipmentItems(Node, List<ProductItemVO>, int) line: 164	

/ Eerst nog	, 
/ Waarom hier	?
		for (ProductItemVO myProductItem : aProductList) {
aProductList	ArrayList  (id=25149)	
	elementData	Object[10]  (id=25705)	
		[0]	ProductItemVO  (id=25655)	
			parsedShipmentOrderId	"83690580" (id=25070)	<- TODO PAUL	
			theProductItemId	"98120910ZD" (id=25578)		<- TODO PAUL

		for (ProductItemVO myProductItem : aProductList) {
			if (StringUtils.isNotBlank(myProductItem.getProductItemId())) {
				if (StringUtils.isNotBlank(myProductItem.getParsedShipmentOrderId())) {
					myProductMap.put(myProductItem.getParsedShipmentOrderId() + "-" + myProductItem.getProductItemId(), myProductItem);
{83690580-98120910ZD=PRODUCT_ITEM id:null(systemId:0)}

/ Nu pas de shi's	, 

		Node myNode = shipmentItemsNode.getFirstChild();
		while (myNode != null) {
			if (myNode.getNodeType() == Node.ELEMENT_NODE) {
				if (SHIPMENT_ITEM_TAG.equals(getElementName(myNode))) {
					ShipmentItemVO myItemVO = myProcessor.process(myNode, myProductMap, anOrganizationSystemId);
/s
ShipmentItemProcessor.process(Node, Map<String,ProductItemVO>, int) line: 355	

			ShipmentItemVO myItemVO = ShipmentItemVOFactory.getShipmentItemVO();
/ new	,
systemId=0
			while (childNode != null) {
					} else if (SHIPMENT_ITEM_ID_TAG.equals(tag)) {
						myItemVO.setShipmentItemId(childNode.getTextContent());
/s
		theShipmentItemId = aShipmentItemId;
/ TODO PAUL (Is OK?)

/t
ShipmentItemProcessor.process(Node, Map<String,ProductItemVO>, int) line: 355	
/ volgende
					} else if (PACKED_ITEMS_TAG.equals(tag)) {
						for (PackedItemVO item : parsePackedItems(childNode, aProducts)) {
/s
ShipmentItemProcessor.parsePackedItems(Node, Map<String,ProductItemVO>) line: 569	

                    <mtccore:PACKED_ITEMS>
                        <mtccore:PACKED_ITEM>
                           <mtccore:PRODUCT_ITEM_ID>98120910ZD</mtccore:PRODUCT_ITEM_ID>
                           <mtccore:SHIPMENT_ORDER_ID>83690580</mtccore:SHIPMENT_ORDER_ID>
                           <mtccore:QUANTITY>8</mtccore:QUANTITY>
                        </mtccore:PACKED_ITEM>
                     </mtccore:PACKED_ITEMS>
/ MORGENOCHTEND




/ Einde DEBUG GGS-118




/ POMS-35

/ SH000358118
/ click Price Cost
/ click Post Calculated

Page class: com.mpobjects.oms.view.wicket.shipmentorder.shipmentorderfinancialdetails.ShipmentOrderFinancialPage
WicketMessage: Error attaching this container for rendering: [MarkupContainer [Component id = shipmentOrderPricePartView]]
Root cause:
java.lang.NullPointerException
     at com.mpobjects.oms.view.wicket.shipmentorder.shipmentorderfinancialdetails.ShipmentOrderPriceListPanel$3.populateItem(ShipmentOrderPriceListPanel.java:196)
     at org.apache.wicket.markup.repeater.RefreshingView$1.newItem(RefreshingView.java:114)
     at org.apache.wicket.markup.repeater.DefaultItemReuseStrategy$1.next(DefaultItemReuseStrategy.java:71)
     at org.apache.wicket.markup.repeater.DefaultItemReuseStrategy$1.next(DefaultItemReuseStrategy.java:68)
     at org.apache.wicket.markup.repeater.RefreshingView.addItems(RefreshingView.java:189)
     at org.apache.wicket.markup.repeater.RefreshingView.onPopulate(RefreshingView.java:98)
     at org.apache.wicket.markup.repeater.AbstractRepeater.onBeforeRender(AbstractRepeater.java:131)
     at org.apache.wicket.markup.repeater.AbstractPageableView.onBeforeRender(AbstractPageableView.java:121)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.MarkupContainer.onBeforeRenderChildren(MarkupContainer.java:1777)
     at org.apache.wicket.Component.onBeforeRender(Component.java:4001)
     at org.apache.wicket.extensions.markup.html.tabs.TabbedPanel.onBeforeRender(TabbedPanel.java:244)
     at org.apache.wicket.Component.internalBeforeRender(Component.java:1069)
     at org.apache.wicket.Component.beforeRender(Component.java:1103)
     at org.apache.wicket.Component.prepareForRender(Component.java:2297)
     at org.apache.wicket.Component.prepareForRender(Component.java:2329)
     at org.apache.wicket.ajax.AjaxRequestTarget.respondComponent(AjaxRequestTarget.java:853)
     at org.apache.wicket.ajax.AjaxRequestTarget.respondComponents(AjaxRequestTarget.java:680)
     at org.apache.wicket.ajax.AjaxRequestTarget.respond(AjaxRequestTarget.java:590)
     at org.apache.wicket.request.AbstractRequestCycleProcessor.respond(AbstractRequestCycleProcessor.java:105)
     at org.apache.wicket.RequestCycle.processEventsAndRespond(RequestCycle.java:1287)
     at org.apache.wicket.RequestCycle.step(RequestCycle.java:1358)
     at org.apache.wicket.RequestCycle.steps(RequestCycle.java:1465)
     at org.apache.wicket.RequestCycle.request(RequestCycle.java:545)
     at org.apache.wicket.protocol.http.WicketFilter.doGet(WicketFilter.java:486)
     at org.apache.wicket.protocol.http.WicketServlet.doGet(WicketServlet.java:138)

pnllogistics=> select*from shipment_order where shipment_order_id='SH000358118';

select shop.entry_type from shipment_order_price_part shop
join shipment_order sho on shop.shipment_order_systemid=sho.system_id
and sho.shipment_order_id='SH000358118'
;

/ Einde POMS-35

/ PCT-693

[eric@localhost Devel]$ ssh vanderveldene@pnl-app-a.intermax.mp-objects.com "find /local/apps/releases -type f | grep pnllogistics | xargs ls -1tr | awk 'END{print}'" 2>/dev/null
/local/apps/releases/tms-pnllogistics-23664-2016.01_pnllogistics-patch_build4246.zip

[eric@localhost Devel]$ ssh vanderveldene@pnl-app-a.intermax.mp-objects.com "find /local/apps/releases -type f | grep pnllogistics | xargs ls -1tr | awk 'END{print}'" 2>/dev/null | xargs -I % scp vanderveldene@pnl-app-a.intermax.mp-objects.com:% ~/tmp

/ Hoe bij meerdere args?
/ TODO

[eric@localhost Devel]$ find ~/tmp/ -type f | grep pnllogistics | xargs ls -1tr | awk 'END{print}' | xargs -I % scp % vanderveldene@pnl-app-p.intermax.mp-objects.com:Downloads



/ Einde PCT-693

/ SITES

http://serverfault.com/questions/625641/how-can-i-run-arbitrarily-complex-command-using-sudo-over-ssh
http://unix.stackexchange.com/questions/122616/why-do-i-need-a-tty-to-run-sudo-if-i-can-sudo-without-a-password
http://www.catonmat.net/blog/awk-one-liners-explained-part-one/
http://articles.slicehost.com/2007/10/9/backing-up-your-files-with-rsync
http://javarevisited.blogspot.com/2012/01/memorymapped-file-and-io-in-java.html
http://localhost:9090/web/index2.jsp
http://serverfault.com/questions/625641/how-can-i-run-arbitrarily-complex-command-using-sudo-over-ssh
http://localhost:9090/web/index2.jsp
https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Details_of_the_Object_Model
http://site.mockito.org/mockito/docs/current/index.html?org/mockito/package-summary.html


/ Einde SITES

/ DEBUG PSA-267

/ we start de appl,	 er zitten nog msgs in de queue	,

/ Andere product	, 
 9685099380 | GOOD | GEODIS_WHS_FR_SOCHAUX

/s
StockTransactionHandlerImpl(AbstractConsumer).onMessage(Message) line: 49	
			processMessageAsRoot(aMessage);
/s
StockTransactionHandlerImpl.processMessageAsRoot(Message) line: 56	
		Serializable serializable = myMessage.getObject();
StockLevelCalculationRequest [26878553]

/ Intermezzo

select p.productid,gs.code,sl.name 
from inv_stock_keeping_unit sku
join product p on sku.product_systemid=p.system_id
join goods_status gs on sku.goods_status_systemid=gs.system_id
join stock_location sl on sku.stock_location_systemid=sl.system_id
where sku.system_id=26878553
;

 productid  | code |         name          
------------+------+-----------------------
 9685099380 | GOOD | GEODIS_WHS_FR_SOCHAUX
(1 row)


/ Einde Intermezzo

			stockLevelCalculationService.handleRequest(myRequest);
/s
StockLevelCalculationServiceImpl.handleRequest(StockLevelCalculationRequest) line: 63	
		StockKeepingUnit myStockKeepingUnit = stockKeepingUnitDAO.getBySystemId(aRequest.getStockKeepingUnitSystemId());
			recalculate(myStockKeepingUnit);
/s
StockLevelCalculationServiceImpl.recalculate(StockKeepingUnit) line: 70	
		recalculate(aSku.getProduct(), aSku.getStockLocation(), aSku.getGoodsStatus());
/s
StockLevelCalculationServiceImpl.recalculate(Product, StockLocation, GoodsStatus) line: 134	
		while (true) {
			StockTransaction myTransaction = stockTransactionDAO.getFirstDirty(aProduct, aLocation, aStatus);
27282030/FORECAST_IN/2016-06-30 23:59:00.0/9685099380 (26878519)/GEODIS_WHS_FR_SOCHAUX/13500.00000/46009.00000/true
/ queries alle st tx's bij deze sku	, die dirty zijn	, en order ze by transaction_date en system_id	,
			if (myTransaction == null) {
/ NEE
			} else {
				if (recalculate(myTransaction)) {
/s
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 146	
		aTransaction.setDirty(false);
		if (aTransaction.getTransactionType().equals(StockTransactionType.COUNT)) {
/ NEE
		} else {
			StockTransaction myPrevious = stockTransactionDAO.getPrevious(aTransaction);
27417545/FORECAST_OUT/2016-06-29 23:59:00.0/9685099380 (26878519)/GEODIS_WHS_FR_SOCHAUX/-1698.00000/47423.00000/false

			if (myPrevious != null) {
				myLastKnownBalance = myPrevious.getCalculatedStockLevel();
47423.00000
			myLevelChange = recalculateStockLevel(aTransaction, myLastKnownBalance);
/s
StockLevelCalculationServiceImpl.recalculateStockLevel(StockTransaction, BigDecimal) line: 112	
		if (aTransaction.isIgnoreOnBalance()) {
/ JA	, forecast_in	
			myNewBalance = aLastKnownBalance;
47423.00000
		if (aTransaction.getCalculatedStockLevel() == null || myNewBalance.compareTo(aTransaction.getCalculatedStockLevel()) != 0) {
/ JA	, 
47423 != 46009
			aTransaction.setCalculatedStockLevel(myNewBalance);
			return true;													<-
/t
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 161	
			myLevelChange = recalculateStockLevel(aTransaction, myLastKnownBalance);
/d
true
			myLastKnownBalance = aTransaction.getCalculatedStockLevel();
47423.00000
		stockTransactionDAO.save(aTransaction);

		// Now recalculate all records until we meet the next count or until done all
		StockTransaction myCurrent = aTransaction;
		main: while (true) {
			List<StockTransaction> myNextList = stockTransactionDAO.getFollowingTransactions(myCurrent, 50);
myCurrent=
27282030/FORECAST_IN/2016-06-30 23:59:00.0/9685099380 (26878519)/GEODIS_WHS_FR_SOCHAUX/13500.00000/47423.00000/false
/ we zien dat de nieuwe balance is set	,
myNextList.size=50	,

			for (StockTransaction myNext : myNextList) {
				if (myNext.getTransactionType().equals(StockTransactionType.COUNT)) {
/ NEE
				myCurrent = myNext;
27418034/ORDER_IN/2016-06-30 23:59:00.0/9685099380 (26878519)/GEODIS_WHS_FR_SOCHAUX/13500.00000/59509.00000/false
/ TODO (forecast_in tegelijkertijd)	,
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/s
StockLevelCalculationServiceImpl.recalculateStockLevel(StockTransaction, BigDecimal) line: 115	
		if (aTransaction.isIgnoreOnBalance()) {
		} else {
/ JA
			myNewBalance = aLastKnownBalance.add(aTransaction.getQuantity());
60923.00000
aLastKnownBalance=47423.00000
aTransaction.getQuantity()=13500.00000

		if (aTransaction.getCalculatedStockLevel() == null || myNewBalance.compareTo(aTransaction.getCalculatedStockLevel()) != 0) {
			aTransaction.setCalculatedStockLevel(myNewBalance);
			return true;
/t
StockLevelCalculationServiceImpl.recalculate(StockTransaction) line: 178	
				if (recalculateStockLevel(myCurrent, myLastKnownBalance) || myCurrent.isDirty()) {
/d
true
					myCurrent.setDirty(false);
					stockTransactionDAO.save(myCurrent);
					myLevelChange = true;
				myLastKnownBalance = myCurrent.getCalculatedStockLevel();
/ volgende	,
		main: while (true) {
			List<StockTransaction> myNextList = stockTransactionDAO.getFollowingTransactions(myCurrent, 50);
			if (myNextList.isEmpty()) {
				break main;
			}
			for (StockTransaction myNext : myNextList) {

/ we geven continue	,
/t
StockLevelCalculationServiceImpl.recalculate(Product, StockLocation, GoodsStatus) line: 135	
			} else {
				if (recalculate(myTransaction)) {
/d
true
					check = true;
		while (true) {
			StockTransaction myTransaction = stockTransactionDAO.getFirstDirty(aProduct, aLocation, aStatus);
			if (myTransaction == null) {
/ JA
				break;
/ TODO PAUL (2 loops	, 
/ In	,
	private void recalculate(Product aProduct, StockLocation aLocation, GoodsStatus aStatus) {
/ maar ook in	,
	private boolean recalculate(StockTransaction aTransaction) {

		if (check) {
/ JA
			trigger(aProduct, aLocation, aStatus);
/s
StockLevelCalculationServiceImpl.trigger(Product, StockLocation, GoodsStatus) line: 193	
		stockKeepingUnitTriggerHandler.handleUpdate(aProduct, aLocation, aStatus);
/s
StockKeepingUnitTriggerHandlerImpl.handleUpdate(Product, StockLocation, GoodsStatus) line: 70	
		List<StockKeepingUnit> myUnitList = stockKeepingUnitDAO.find(aStockLocation, aProduct, aStatus);
/ List van 1	,
		for (StockKeepingUnit myUnit : myUnitList) {
			handleUpdate(myUnit);
/s
StockKeepingUnitTriggerHandlerImpl.handleUpdate(StockKeepingUnit) line: 78	
		Collection<StockKeepingUnitTrigger> myList = stockKeepingUnitTriggerDAO.getAll();
[com.mpobjects.inventory.model.entity.stockkeepingunittrigger.StockKeepingUnitTrigger/id:27108683]
name=Alert_Product

		for (StockKeepingUnitTrigger myTrigger : myList) {
			if ((myTrigger.getOnExceedLowInLeadTime() 
true
			&& stockReplenishmentService.exceedsLowInLeadTime(aSku)) 
/ (*)
			||
			(myTrigger.getOnExceedHighInLeadTime() 
			&& stockReplenishmentService.exceedsHighInLeadTime(aSku))
		) {

/ (*)
/s
StockReplenishmentServiceImpl.exceedsLowInLeadTime(StockKeepingUnit) line: 150	
		Period myLeadTime = aUnit.getLeadTime();
P2D
		DateTime myDateTime = new DateTime();
/ Nu, 2016-06-29T12:30:30.074+02:00
		Date myHigh = myDateTime.plus(myLeadTime).toDate();
Fri Jul 01 12:30:30 CEST 2016

		StockTransaction myLast = stockTransactionDAO.getPrevious(aUnit, myHigh);
27418034/ORDER_IN/2016-06-30 23:59:00.0/9685099380 (26878519)/GEODIS_WHS_FR_SOCHAUX/13500.00000/60923.00000/false

/ je kijkt alleen naar de laatste st tx binnen de lead time	, 
/ WH	, als hij onder de min was	, maar aan het eind van de lead time niet meer, dan is het probleem al opgelost	,

			return aUnit.getMinStockLevel() != null && myLevel.compareTo(aUnit.getMinStockLevel()) < 0;
false	, 
60923.00000 ! < 16800.00000

/t
StockKeepingUnitTriggerHandlerImpl.handleUpdate(StockKeepingUnit) line: 80	
		for (StockKeepingUnitTrigger myTrigger : myList) {
			if ((myTrigger.getOnExceedLowInLeadTime() && stockReplenishmentService.exceedsLowInLeadTime(aSku)) ||
					(myTrigger.getOnExceedHighInLeadTime() && stockReplenishmentService.exceedsHighInLeadTime(aSku))) {
/ NEE
/ Dus NIET naar Produce email msg	,
/ TODO

/ Einde DEBUG PSA-267



/ PNLLOGISTICS-

/ we moeten deploy van acc naar prod	,

[eric@localhost geosco]$ ssh vanderveldene@pnl-app-a.intermax.mp-objects.com 2>/dev/null "find  /local/apps/releases | grep pnllogistics | xargs ls -1tr | awk 'END{print}'" | xargs -I % scp vanderveldene@pnl-app-a.intermax.mp-objects.com:% ~/tmp 

[eric@localhost geosco]$ ssh vanderveldene@pnl-app-p.intermax.mp-objects.com  "mkdir Downloads" 
[eric@localhost geosco]$ find ~/tmp | grep pnllogistics | xargs ls -1tr | awk 'END{print}' | xargs -I % scp % vanderveldene@pnl-app-p.intermax.mp-objects.com:Downloads

/ Lees	, over ssh "sudo su - jboss"
http://unix.stackexchange.com/questions/122616/why-do-i-need-a-tty-to-run-sudo-if-i-can-sudo-without-a-password
http://serverfault.com/questions/625641/how-can-i-run-arbitrarily-complex-command-using-sudo-over-ssh



/ Einde PNLLOGISTICS-



/ PSA-541

[eric@localhost bin]$ geosco-pg_dump-a.sh 
[eric@localhost bin]$ ls -ltr ~/DB_TAP/Postgres/Backup/ | awk 'END{print}'
-rw-rw-r--. 1 eric     eric      127421923 Jun 24 11:16 geosco-a-2016-06-24.dump

/ we install 2016.01_geosco patch in acc	,

[eric@localhost bin]$ geosco-psql-a.sh 

update stock_transaction
set quantity = (
	select coalesce(pi.actual_quantity, pi.quantity) 
	from tms_product_item pi 
	where product_item_systemid = pi.system_id
), 
is_dirty=1 
where system_id in (
	select t.system_id 
	from stock_transaction t
	join tms_product_item pi2 on t.product_item_systemid = pi2.system_id
	where t.quantity = 0 
	and (pi2.quantity > 0 or pi2.actual_quantity > 0)
)


/ Einde PSA-541

/ LABELS FILTERS GMAIL 

/ we maken eerst een label, daarna een filter die msgs naar dit label stuurt	, 
/ de label form bestaat uit 2 pages	,

/ Ga naar Settings	, 
/ we zien tabs Labels en 'Filters and Blocked Addresses'	,

/ we hebben een label JIRA create	, 
/ we create label PCT , onder JIRA
/ we create filter	, 
Subject: [JIRA] (PCT-
/ click 'create filter with this search	, we komen op nieuw window	,
skip the inbox: check
apply the label: JIRA/PCT
also apply the label to matching conversations: check
/ click CREATE FILTER

/ Label JIRA/OTHERS	, 
/ filter [JIRA] (CEVA- sturen we naar JIRA/OTHERS


/ Einde LABELS FILTERS GMAIL 


/ PSA-541

[eric@localhost bin]$ cat geosco-int-p.sh 
#!/bin/bash
ssh vanderveldene@geosco-int-p.intermax.mp-objects.com

[eric@localhost bin]$ mk_ssh_passwordless_intermax.sh geosco-int-p
h^Zgcyr&Q
/ OK

[eric@localhost bin]$ geosco-ssh-p.sh 
[vanderveldene@geosco-int-p interface]$ ls





/ Einde PSA-541

/ OPEN IN CHROME

http://www.mkyong.com/tutorials/jsf-2-0-tutorials/
http://www.mkyong.com/tutorials/jsf-2-0-tutorials/
https://system.mp-objects.com/xwiki/bin/view/Technology/Deployment+dsvfms+2015.03+to+test
http://stackoverflow.com/questions/3080693/print-just-the-last-line-of-a-file

http://activemq.apache.org/maven2-activemq-broker-plugin.html
http://activemq.apache.org/activemq-5133-release.html
http://javarevisited.blogspot.nl/2012/01/memorymapped-file-and-io-in-java.html

http://stackoverflow.com/questions/29307763/maven-command-to-run-activemq-before-intergation-tests
http://docs.oracle.com/javaee/5/tutorial/doc/bnair.html#bnaix
http://www.mkyong.com/spring-mvc/classnotfoundexception-com-thoughtworks-xstream-io-hierarchicalstreamreader/
http://stackoverflow.com/questions/326390/how-do-i-create-a-java-string-from-the-contents-of-a-file

/ Einde OPEN IN CHROME


/ GEOFLOW+1323 

/ bied een bericht nog een keer aan	, door hem uit het archive te halen	,

[eric@localhost bin]$ ssh vanderveldene@geolog-int-p.intermax.mp-objects.com
vanderveldene@geolog-int-p.intermax.mp-objects.com's password: h^Zgcyr&Q

[vanderveldene@geolog-int-p ]$ sudo su - servicemix
[servicemix@geolog-int-p ~]$ cd /local/apps/ftp/GeoPBUS/GeoPBManifest/
[servicemix@geolog-int-p GeoPBManifest]$ mv archive/2016-05/23/EBAY_COMM_COMM_ODER100007708.txt .
[servicemix@geolog-int-p GeoPBManifest]$ ls
archive  EBAY_COMM_COMM_ODER100007708.txt  inProcess
[servicemix@geolog-int-p GeoPBManifest]$ ls
archive  inProcess

/ we zien dat het bericht eraf is gehaald	,

/ Einde GEOFLOW+1323 


/ MPO-317

/ 7	. 

/ properties values
module.oms.instructions.enabled	ICS	true
￼ ￼	module.oms.instructions.enabled		false
￼ ￼	module.oms.instructions.enabled	HAAL-ZW	TRUE					<-
￼ ￼	module.oms.instructions.enabled	Supergroup DBN	true
￼ ￼	module.oms.instructions.enabled	ICS Transport DBN	true
￼ ￼	property module.oms.instructions.enabled	ICSZA	true
￼ ￼	property module.oms.instructions.enabled	ICS	true
￼ ￼	property module.oms.instructions.enabled	ICS Transport DBN	true￼Create

/ eric
NEEC-NL
/ JoostU
HAAL-ZW

javax.servlet.jsp.el.ELException: Attempt to coerce a value of type "org.hibernate.collection.PersistentMap$MapEntryProxy" to type "com.mpobjects.util.dao.EntityInterface" at
org.apache.commons.el.Logger.logError(Logger.java:481) at
org.apache.commons.el.Logger.logError(Logger.java:498) at
org.apache.commons.el.Logger.logError(Logger.java:566) at
org.apache.commons.el.Coercions.coerceToObject(Coercions.java:799) at
org.apache.commons.el.Coercions.coerce(Coercions.java:343) at
org.apache.commons.el.ExpressionEvaluatorImpl.convertToExpectedType(ExpressionEvaluatorImpl.java:345) at
org.apache.commons.el.ExpressionEvaluatorImpl.evaluate(ExpressionEvaluatorImpl.java:267) at
org.apache.commons.el.ExpressionEvaluatorImpl.evaluate(ExpressionEvaluatorImpl.java:190) at
org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate(PageContextImpl.java:917) at
org.apache.jsp.tag.web.oms.order_002dinstructions_tag._jspx_meth_mpo_setFormVO_0(order_002dinstructions_tag.java:230) at
org.apache.jsp.tag.web.oms.order_002dinstructions_tag._jspx_meth_c_forEach_0(order_002dinstructions_tag.java:199) at
org.apache.jsp.tag.web.oms.order_002dinstructions_tag.doTag(order_002dinstructions_tag.java:111) at
org.apache.jsp.oms.jsp.shipment_002dorder_005fedit_jsp._jspx_meth_tmstags_order$1instructions_0(shipment_002dorder_005fedit_jsp.java:8453) at
org.apache.jsp.oms.jsp.shipment_002dorder_005fedit_jsp._jspx_meth_mpo_setFormVO_6(shipment_002dorder_005fedit_jsp.java:8428) at
org.apache.jsp.oms.jsp.shipment_002dorder_005fedit_jsp._jspx_meth_mpo_tab_12(shipment_002dorder_005fedit_jsp.java:8396) at
org.apache.jsp.oms.jsp.shipment_002dorder_005fedit_jsp._jspx_meth_c_if_84(shipment_002dorder_005fedit_jsp.java:8364) at
org.apache.jsp.oms.jsp.shipment_002dorder_005fedit_jsp._jspx_meth_mpo_tabCollection_1(shipment_002dorder_005fedit_jsp.java:7270) at
org.apache.jsp.oms.jsp.shipment_002dorder_005fedit_jsp._jspService(shipment_002dorder_005fedit_jsp.java:642) at
org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:97) at
javax.servlet.http.HttpServlet.service(HttpServlet.java:810) at
org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:334) at
org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:314) at
org.apache.jasper.servlet.JspServlet.service(JspServlet.java:264) at
javax.servlet.http.HttpServlet.service(HttpServlet.java:810) at
org.apache.cocoon.components.jsp.JSPEngineImpl.executeJSP(JSPEngineImpl.java:75) at
sun.reflect.GeneratedMethodAccessor558.invoke(Unknown Source) at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at
java.lang.reflect.Method.invoke(Method.java:622) at
org.apache.avalon.excalibur.component.ComponentProxyGenerator$ComponentInvocationHandler.invoke(ComponentProxyGenerator.java:143) at
com.sun.proxy.$Proxy499.executeJSP(Unknown Source) at
org.apache.cocoon.reading.JSPReader.generate(JSPReader.java:106) at
org.apache.cocoon.components.pipeline.impl.AbstractCachingProcessingPipeline.processReader(AbstractCachingProcessingPipeline.java:900) at
org.apache.cocoon.components.pipeline.AbstractProcessingPipeline.process(AbstractProcessingPipeline.java:473) at
org.apache.cocoon.components.treeprocessor.sitemap.ReadNode.invoke(ReadNode.java:85) at
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69) at
org.apache.cocoon.components.treeprocessor.sitemap.SelectNode.invoke(SelectNode.java:98) at
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:47) at
org.apache.cocoon.components.treeprocessor.sitemap.ActTypeNode.invoke(ActTypeNode.java:139) at
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:47) at
org.apache.cocoon.components.treeprocessor.sitemap.MatchNode.invoke(MatchNode.java:108) at
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69) at
org.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143) at
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69) at
org.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93) at
org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235) at
org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177) at
org.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:253) at
org.apache.cocoon.components.treeprocessor.sitemap.MountNode.invoke(MountNode.java:118) at
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:47) at
org.apache.cocoon.components.treeprocessor.sitemap.MatchNode.invoke(MatchNode.java:108) at
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69) at
org.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143) at
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69) at
org.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93) at
org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235) at
org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177) at
org.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:253) at
org.apache.cocoon.components.treeprocessor.sitemap.MountNode.invoke(MountNode.java:118) at
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69) at
org.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143) at
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69) at
org.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93) at
org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235) at
org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177) at
org.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:253) at
org.apache.cocoon.Cocoon.process(Cocoon.java:699) at
org.apache.cocoon.servlet.CocoonServlet.service(CocoonServlet.java:1154) at
javax.servlet.http.HttpServlet.service(HttpServlet.java:810) at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252) at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at
com.mpobjects.control.filter.FirstLoginFilter.doFilter(FirstLoginFilter.java:76) at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202) at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:330) at
org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:118) at
org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:84) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:113) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:103) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:113) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:154) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:45) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:199) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:110) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
com.mpobjects.auth.springsec.RunAsLogoutFilter.doFilter(RunAsLogoutFilter.java:41) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
org.springframework.security.web.context.SecurityContextPersistenceFilter.doFilter(SecurityContextPersistenceFilter.java:87) at
org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342) at
org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:192) at
org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:160) at
org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:343) at
org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:260) at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202) at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at
filters.SetCharacterEncodingFilter.doFilter(SetCharacterEncodingFilter.java:111) at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202) at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at
org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:230) at
org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:106) at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202) at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at
org.jboss.web.tomcat.filters.ReplyHeaderFilter.doFilter(ReplyHeaderFilter.java:96) at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202) at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213) at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178) at
org.jboss.web.tomcat.security.SecurityAssociationValve.invoke(SecurityAssociationValve.java:175) at
org.jboss.web.tomcat.security.JaccContextValve.invoke(JaccContextValve.java:74) at
org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126) at
org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105) at
org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107) at
org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148) at
org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:199) at
org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:282) at
org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:767) at
org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:697) at
org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:889) at
org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684) at
java.lang.Thread.run(Thread.java:701)

/ 7	. 

[eric@localhost bin]$  mpo-ssh-p.sh 

[vanderveldene@scs-application-p ~]$ PGPASSWORD=zwnnCLP0YYVGCdbCDIOp7lS4JrAxEgj4 psql -U mpo mpo
mpo=> \dg
 mpopostgres  | Superuser, Create role, Create DB, Replication | {admin}

./mpo-db-p.sh:PGPASSWORD=mpopostgres@mpo psql -U mpopostgres -h  scs-application-p.intermax.mp-objects.com mpo 

/ 7	. 

$ vi shipment-order_edit.jsp

				<c:if test="${cf:property('oms','instructions.enabled', '')}">
					<mpo:tab name="instructions">

						<mpo:setFormVO valueObject="${formVO}">
							<tmstags:order-instructions />
						</mpo:setFormVO>

					</mpo:tab>
				</c:if>

$ vi order-instructions.tag

	<c:forEach var="instruction" items="${formVO.instructionList}">
...

$ vi ShipmentOrder.standard.hbm.xml

	<class name="com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO" table="SHIPMENT_ORDER">

		<map name="instructionList" table="INSTRUCTION" cascade="all,delete">
			<key column="ENTITY_SYSTEMID" not-null="true" />
			<map-key-many-to-many column="INSTRUCTION_CODE_SYSTEMID" class="com.mpobjects.oms.model.entity.instructioncode.InstructionCode" />
			<element column="INSTRUCTION_VALUE" type="string" />
		</map>

		<map name="entityDetails" table="SHIPMENT_ORDER_DETAIL" cascade="all">
			<cache usage="read-write" />
			<key column="ENTITY_SYSTEMID" not-null="true" />
			<map-key-many-to-many column="EDT_SYSTEMID" class="com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailType" />
			<element column="FIELD_VALUE" type="string" />
		</map>

/ 7	. 

mpo=# select system_id from shipment_order where shipment_order_id='20160297_001';
 system_id 
-----------
  28011829
(1 row)
mpo=# select count(*)  from shipment_order_detail where entity_systemid=28011829;
 count 
-------
    20
(1 row)
mpo=# select count(*)  from instruction where entity_systemid=28011829;
 count 
-------
     6
(1 row)

/ FIX MPO-317

/ we rm deze 6	,
mpo=# delete  from instruction where entity_systemid=28011829;
DELETE 6
mpo=# commit;
COMMIT

/ Einde FIX MPO-317


/ SCS-5337

/ Hoe set wicketpath	?

                getDebugSettings().setOutputComponentPath(true);
/ deprecated    ,
/ of    ,
                getDebugSettings().setComponentPathAttributeName("wicketpath");



/ In trunk	,

$ vi ApplicationUtils.java

	public static void init(WebApplication anApplication) {
	if (ApplicationServerType.PRODUCTION != serverType) {
			Application.get().getDebugSettings().setOutputComponentPath(true);
	}



/ Einde SCS-5337




/ Einde MPO-317



/ LINUX

/ truncate de postgres log files	,
# > file


/ Einde LINUX


/ PCT-1234

/ 7	. 

/ 13	. 

Op acc gaat het fout, op test en op mijn laptop gaat het goed. 

Stel ik be op acc.

Stel de  opdrachtgeven 9105522 is niet in de RETURN_LABEL groep.

Maak een retuirn shipment order. Als je deze inplan, zie je niet de PRINT_LABEL sa. Dit is OK. 
Voeg de  opdrachtgeven 9105522 toe aan  de RETURN_LABEL groep. Ga terug naar de shipment order en maak de status van de PRINT_LABEL sa 1450. Unplan en save de shipment order. Dan zien we de PRINT_LABEL sa niet . Dit is ERR.


Nu andersom. Stel de  opdrachtgeven 9105522 is wel in de RETURN_LABEL groep.

Maak een retuirn shipment order. Als je deze inplan, zie je wel de PRINT_LABEL sa. Dit is OK. 
Verwijder de  opdrachtgeven 9105522 uit de RETURN_LABEL groep. Ga terug naar de shipment order en maak de status van de PRINT_LABEL sa 1450. Unplan en save de shipment order. Dan zien we nog steeds de PRINT_LABEL sa. Dit is ERR.

/ 13	. 

/ Create sho met bill_to party = party van type opdrachtegever, de NIET in RETURN_LABEL group	,
/ Hoe doe je dit? : configuration, planning, party groups	, zoek op 'return'	, je vindt RETURN_LABEL grouo, en je ziet de  opdrachtgevers er in	, kies dus een opdrachtgever die er niet inzit	,
/ plan sho in, door Save, dan zal tpl PHARMA RT BE|LU uit NL WITHOUT LABEL  passen, en zien we GEEN PRINT_LABEL sa	,
/ Voeg dan de bill to party juist wel toe aan de RETURN_LABEL group	, 
/ unplan & plan: de sa PRINT_LABEL staat er bij, want tpl HARMA RT BE|LU uit NL WITH LABEL  past	,
/ Haal de bill to party nu uit de group , dus zoals het oorspronkelijk was	, 
/ unplan & plan: de sa PRINT_LABEL staat er NOG STEEDS bij,	 had er NIET moeten staan, dit is het issue 


/ 13	. 

/ configuration, planning, path templates
/ Zoek naar PHARMA RT BE|LU uit NL WITHOUT LABEL  1/2 en PHARMA RT BE|LU uit NL WITH LABEL  1/2
/ elke sho fits precies 1 path	, deze bepaalt welke sa's er worden create	,
/ een path heeft een aantal criteria	,
/ een service agreement heeft ook criteria	, maar dit is de enigste gelijkenis	, een service agreement is iet heel anders	,

/ 13	. 

path template=
PHARMA RT/RT BE|LU uit NL WITHOUT LABEL
process type 			RT
shipment_order_id 		.*RT
hold_status				!.+
bill_to_party_groups  	!(.*,)?RETURN_LABEL(,.*)?	
coldepot				ZWA
distrdepot				TBA
to_country				BE|LU

path template=
PHARMA RT/RT BE|LU uit NL WITH LABEL
bill_to_party_groups  	(.*,)?RETURN_LABEL(,.*)?	
shipment_order_id 		.*RT
hold_status				!.+
process type 			RT
to_country				BE|LU
distrdepot				TBA
coldepot				ZWA


/ op test heeft Gerard create SH000135099RT	, 
/ deze heeft een opdrachtgever	,  9105522	, gemaakt	,   

/ we maken zelf een sho	, 
/ we kiezen  sho tpl name : pharma	,
/ we moeten
ship_from	: 	2910-3--BE
ship_to		:	4231DJ-118--NL
bill_to		:	9105522
distr depot, coll depot: hoeft niet	,
/ we moeten ook	,
/ vul alle 4 data in	, de req. start 2 morgen 	, de req. end 2  overmorgen	,
actual productcode: 3606	 is al in tpl pharma	,
requested productcode: 3606
customer reference: test pct-1234 			/ bijv	,

/ 13	. 

/ we hebben op test create	,
SH000137997
/ rm COLLO_HOLD	,
/ Maak een shi	op SH000137997,
C
3Sev2016040601
Save

/ We hebben nog niets gedaan met deze	, 

/ 13	. 

/we hebben op test create	,
SH000137998
Maar een shi	,
Unit type C
PostNL reference: 3S2016040701
Save
/ plans in	,
/ click 'create return'	,
SH000137998RT
status: 1404
Save
/ we zien sa's	,
LINEHAUL
SCAN
/ Klopt	, de opdrachtegever 9105522 zit niet in de RETURN_LABEL party group, dus PHARMA RT/RT BE|LU uit NL WITHOUT LABEL past,   als we kijken naar het path template PHARMA RT/RT BE|LU uit NL WITHOUT LABEL	, dan zien we deze 2 sa's	,
status 1450	, want de sa's hebben status 1450	,

/ we add de opdrachtgever 9105522 aan de party group RETURN_LABEL	, 
configuration, planning, party groups
/ search RETURN_LABEL	, click 'add party'	, add 9105522	,
/ ga terug naar SH000137998RT	, unplan & save	,
/ we zien 3 sa's , PRINT_LABEL is er 1 van	,

/ we rm de opdrachtgever 9105522 aan de party group RETURN_LABEL	, 
configuration, planning, party groups
/ search RETURN_LABEL	, check 9105522, click 'remove selected parties'	, save	,

/ ga terug naar SH000137998RT	, we zien geen unplan button	, 
/ status sho is 8000 (started)	, want PRINT_LABEL sa heeft status 9000	
/ de return_label sa is auto_close	, dus de status is 9000	, en de status van de sho is 8000	, 
/ auto_start bestaat ook: dan zou de status van de sa 8000 zijn	,
/ we moeten naar de seo gaan waar de sa in zit	, en clear actual start , en clear actual end date	, save and close seo	, 
/ als we alleen de clear actual end date, dan wordt status  van de seo 8000	, STARTED	, we moeten ook clear actual start date	,
/ we komen terug op sho	, sho is 1450	, want alle sa's zijn 1450	,
/ we zien unplan button weer	, unplan , save	,
/ we zien PRINT_LABEL er niet bij	, 

//////////////////////////////////////////////////////////////////////////////////////////
/ 13	. 

/ Hoe zelf sho maken?
/ we kiezen  sho tpl name : pharma	,
/ we moeten
ship_from	: 	2910-3--BE
ship_to		:	4231DJ-118--NL
bill_to		:	9105522
distr depot, coll depot: hoeft niet	,
/ we moeten ook	,
requested productcode: 3606
customer reference: test pct-1234 			/ bijv	,

/ we maken op acc
SH000144566
/ met de opdrachtgever 9105522 niet in de RETURN_LABEL group	,
/ add shi unit type: C	, PostNL reference: 3S2016041101	, 
/ Haal COLLO_HOLD eraf	, Save 	, we plan de sho meteen in	,
/ we create return,
SH000144566RT
/ en save	, 
pnllogistics=> select pt.* 
from path_template pt 
join shipment_order sho on pt.system_id=sho.path_systemid 
where sho.shipment_order_id='SH000144566RT';
-[ RECORD 1 ]------------+-------------------------------------------------------------
system_id                | 26859337
path_template            | PHARMA RT/RT BE|LU uit NL WITHOUT LABEL

/ Dus OK	,

/ we add 9105522 toe aan de party group RETURN_LABEL	,
/ unplan & save
/ we zien nog steeds GEEN PRINT_LABEL sa	, nog steeds PHARMA RT/RT BE|LU uit NL WITHOUT LABEL 	, maar dat kan niet	,
/ TODO

/ En	,	

/ de 9105522 opdrachtgeven zit in de RETURNLABEL group	,

/ we maken op acc een sho met deze opdrachtgever	, SH000144567RT
SH000144567RT
/ we zien 3 sa's dus ook PRINT_LABEL	,
/ we rm 9105522 uit de RETURNLABEL group	, 
/ we brengen de PRINT_LABEL sa van 9000 naar 1450	, door in de seo de actual start, end dates te clear en save and close de seo	. 
/ unplan & save de sho, 	we zien nog steeds 3 sa's	, (en de PRINT_LABEL is weer 9000)	,

////////////////////////////////////////////////////////////////////////////////////////////////////////

/////////////////////////////////////////////////////////////////////////////////////////////////////////

/ 13 	. 

/ we doen hetzelfde local	,

/ we hebben pnllogistics7a	, de db van acc	, waar het fout gaat	,

/ Hoe zelf sho maken?
/ we kiezen  sho tpl name : pharma	,
/ we moeten
ship_from	: 	2910-3--BE
ship_to		:	4231DJ-118--NL
bill_to		:	9105522
distr depot, coll depot: hoeft niet	,
/ we moeten ook	,
requested productcode: 3606
customer reference: test pct-1234 			/ bijv	,

/ we maken op  laptop	,
SH000144568
/ met de opdrachtgever 9105522 niet in de RETURN_LABEL group	,
/ add shi unit type: C	, PostNL reference: 3S2016041101	, 
/ Haal COLLO_HOLD eraf	, Save 	, we plan de sho meteen in	,
/ we create return,
SH000144568RT
/ deze heeft status 1404	, geen sa's 	,
/ en save	, 
/ deze heeft status 1450, met sa's LINEHAUL en ...	, zonder PRINT_LABEL	, 
/ Met welk path ingeplanned?
pnllogistics=> select pt.* 
from path_template pt 
join shipment_order sho on pt.system_id=sho.path_systemid 
where sho.shipment_order_id='SH000144568RT';
system_id                | 26859337
path_template            | PHARMA RT/RT BE|LU uit NL WITHOUT LABEL
/ Klopt	,

/ we add 9105522 toe aan de party group RETURN_LABEL	,
/ unplan & save
/ we zien nog steeds GEEN PRINT_LABEL sa	, nog steeds PHARMA RT/RT BE|LU uit NL WITHOUT LABEL 	, maar dat kan niet	,
/ TODO

/////////////////////////////////////////////////////////////////////////////////////////////////////////


/ 13	. 

/ HOW TO CREATE SHIPMENT ORDER

/ local	,
/ Kijk in RETURN_LABEL party group, 9105522 zit er niet in	,
/ we maken sho SH000131483	, 
/ we kiezen  sho tpl name : pharma	,
/ we moeten
requested productcode: 3606
customer reference: test pct-1234 			/ bijv	,
ship_from	: 	2910-3--BE
ship_to		:	4231DJ-118--NL
bill_to		:	9105522
Save
/ create shi	, C, 3S2016040701
Save shipment item	,
/ click 'create return'	, 
SH000131483RT
Save

pnllogistics6a=# select pt.* from path_template pt join shipment_order sho on pt.system_id=sho.path_systemid where sho.shipment_order_id='SH000131483RT';
-[ RECORD 1 ]------------+-------------------------------------------------------------
system_id                | 26859337
path_template            | PHARMA RT/RT BE|LU uit NL WITHOUT LABEL

/ we add 9105522 aan de RETURN_LABEL group	,
/ we unplan & save SH000131483RT	, 

pnllogistics6a=# select pt.* from path_template pt join shipment_order sho on pt.system_id=sho.path_systemid where sho.shipment_order_id='SH000131483RT';
-[ RECORD 1 ]------------+-------------------------------------------------------------
system_id                | 26859328
path_template            | PHARMA RT/RT BE|LU uit NL WITH LABEL

/ Klopt, we zien 3 sa's , waaronder PRINT_LABEL	,

/ we rm 9105522 uit de RETURN_LABEL group	, 
/ we moeten de PRINT_LABEL sa op 1450 brengen, door in de seo de actual start & end date clear	,
/ unplan & save SH000131483RT	, 
/ OK , we zien 2 sa's	, 


/ OK

/ 7	.  

/ we kijken op acc	,

/ sho SH000144566RT
/ is inplan toen de opdrachtgever 9105522 niet in de RETURN_LABEL party group zit	, 
/ of we later opdrachtgever 9105522 aan de RETURN_LABEL party group add	, maakt niet uit: de PRINT_LABEL sa komt er niet als we unplan & save	,

/ sho SH000144567RT	, 
/ is inplan toen de opdrachtgever 9105522 in de RETURN_LABEL party group zit	, 
/ of we later opdrachtgever 9105522 rm uit de RETURN_LABEL party group , maakt niet uit: de PRINT_LABEL sa blijft als we unplan & save	,

/ we kijken naar SH000144567RT	, 
/ en 9105522 niet in de RETURN_LABEL party group

ent_order_id='SH000144567RT';
-[ RECORD 1 ]------------+-------------------------------------------------------------
system_id                | 26859363
path_template            | PHARMA RT/RT NL uit NL
description              | Pharma & Care return order created with CREATE RETURN button
/ ERR

pnllogistics=> select p.party_id from party p join party_in_group pig on p.system_id=pig.party_systemid join party_group pg on pg.system_id=pig.party_group_systemid where pg.party_group='RETURN_LABEL';
 party_id 
----------
 10398670
 10398668
 10398380
 10398724
 10398696
 10398721
 10398669
 10290301
 10398723
(9 rows)
/ Klopt	,

pnllogistics=> select sat.* from service_action_type sat join service_action sa on sa.service_action_type_systemid=sat.system_id join shipment_order sho on sa.shipment_order_systemid=sho.system_id where sho.shipment_order_id='SH000144567RT';
 system_id | is_deleted | service_action_type |      description       | visibility |  quotation_mode  | path_evaluation_m
ode | is_track_trace 
-----------+------------+---------------------+------------------------+------------+------------------+------------------
----+----------------
  26681850 |          0 | PRINT_LABEL         | Print Label            | PRIVATE    | IGNORE_ZERO_COST | IGNORE_ZERO_COST 
    |              0
  26681853 |          0 | DELIVERY_NOTE       | Delivery Note          | PRIVATE    | IGNORE_ZERO_COST | IGNORE_ZERO_COST 
    |              0
  26681854 |          0 | DELIVERY            | Delivery / Distributie | PUBLIC     | IGNORE_ZERO_COST | IGNORE_ZERO_COST 
    |              0
(3 rows)

/ Als de sho unplanned	,

pnllogistics=> select sat.* from service_action_type sat join service_action sa on sa.service_action_type_systemid=sat.system_id join shipment_order sho on sa.shipment_order_systemid=sho.system_id where sho.shipment_order_id='SH000144567RT';
 system_id | is_deleted | service_action_type | description | visibility | quotation_mode | path_evaluation_mode | is_trac
k_trace 
-----------+------------+---------------------+-------------+------------+----------------+----------------------+--------
--------
(0 rows)

/ 7	. 

/ we maken een nieuwe acc db op laptop	,
# create database pnllogistics7a

[eric@localhost bin]$ pnl-db-dump-a.sh pnllogistics
[eric@localhost bin]$ local-pg_restore.sh pnllogistics7a ~/DB_TAP/Postgres/Backup/pnllogistics-a-2016-04-07.dump 



/ Einde PCT-1234

/ DEBUG UNPLAN PCT-1234

/ pnllogistics6a db	, 
/ OK	, de ERR uit pct-1234 zien we niet	,

/ sho SH000131483RT
/ opdrachtgever 9105522
/ party group LABEL_RETURN
/ path templates
	PHARMA RT/RT BE|LU uit NL WITH LABEL
	PHARMA RT/RT BE|LU uit NL WITHOUT LABEL

/ SH000131483RT is planned	, 
/ debug unplan	,

$ vi shipment-order_edit.jsp 
					<input type="button" value="<mpo:label name="unplan"/>"
						onclick="document.location.href='../oms/shipment-order-unplan-actions?shipmentorder_systemid=${formVO.systemId}&amp;base_sessionLevelOffset=1';" />

$ vi oms-sitemap.xmap
            <map:action logger="shipmentorder" name="shipmentOrderUnplanActions" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderUnplanActionsAction"/>
			<map:match pattern="shipment-order-unplan-actions">
				<map:act type="shipmentOrderUnplanActions"/>
	        	<map:redirect-to uri="../core/back?levelOffset=1"/>
			</map:match>

/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).unplan(ShipmentOrderVO) line: 1789	
		List<ServiceActionVO> reversedList = new ArrayList<ServiceActionVO>(aShipmentOrderVO.getServiceActionList());
		Collections.reverse(reversedList);
[SH000131483RT/SCAN/27035046, SH000131483RT/LINEHAUL/27035045]

		for (ServiceActionVO serviceAction : reversedList) {
			if (serviceAction.getConsignmentVO() != null) {
				LOG.info("Unplanning service action: " + serviceAction + " from " + aShipmentOrderVO);
				getServiceActionService().updateConsignment(serviceAction, null);
/s
ServiceActionServiceImpl.updateConsignment(ServiceActionVO, ConsignmentVO) line: 977	
/=
	public void updateConsignment(ServiceActionVO aServiceAction, ConsignmentVO aNewConsignment) {

aServiceAction=SH000131483RT/SCAN/27035046
aNewConsignment=null

		if (aNewConsignment == null) {
			consignmentService.handleServiceActionDelete(aServiceAction);
/s
ConsignmentServiceImpl.handleServiceActionDelete(ServiceActionVO) line: 410	
/=
	public void handleServiceActionDelete(ServiceActionVO myOldVO) {
myOldVO	ServiceActionVO  (id=19196)	

		LOG.debug("handleServiceActionDelete(" + myOldVO + ")");
			if (myOldVO != null) {
				ConsignmentVO myOldConsignmentVO = myOldVO.getConsignmentVO();
N0126241.1/26977347
				if (myOldConsignmentVO != null) {
					LOG.debug("handled by " + this.getClass() + ".handleServiceActionDelete");
					removeServiceAction(myOldVO);
/s
ConsignmentServiceImpl.removeServiceAction(ServiceActionVO) line: 670	
		removeServiceAction(anAction, new TMSEventContext());
/s
ConsignmentServiceImpl.removeServiceAction(ServiceActionVO, TMSEventContext) line: 682	

/ In Java heeft de sa een theConsignment, en deze heeft theServiceActionList	, hier 1 sa	,

			ConsignmentVO myNewConsignment = consignmentDAO.getInitializedBySystemId(anAction.getConsignmentVO().getSystemId());
/ TODO
			ConsignmentVO myOldConsignment = getOld(myNewConsignment);
			List<ServiceActionVO> myOldServiceActionList = new ArrayList<ServiceActionVO>(myOldConsignment.getServiceActionList());
[SH000131483RT/SCAN/27035046]
			myOldConsignment.setServiceActionList(myOldServiceActionList);
/ TODO
			int oldServiceActionTotalCount = myOldServiceActionList.size();

			for (EventVO myEventVO : getEventService().getEventsForServiceAction(anAction.getSystemId())) {
Event id: [27312078], event type: [Q15], status: [OPEN_ALERTED]

				LOG.warn("Associating service action event " + myEventVO.getSystemId() + " of service action " + anAction.getSystemId()
						+ " events with consignment " + myOldConsignment.getSystemId());
				myEventVO.setConsignmentSystemid(null);
				getEventService().save(myEventVO);
/ Intermezzo
/s
EventServiceImpl.save(EventVO) line: 866	
		List<EventVO> myList = new ArrayList<EventVO>();
		} else {
			myList.add(anEvent);
			List<EventVO> myResult = save(myList);
/s
EventServiceImpl.save(Collection<EventVO>) line: 849	
...
		myTracker.processAll();
/s
EventServiceImpl$EventUpdateResultTracker.processAll() line: 168	
...
			fireEventEvents();
/s
EventServiceImpl$EventUpdateResultTracker.fireEventEvents() line: 216	
...
						eventHandlerService.handleEvent(myEventEvent);
myEventEvent=event.updated, context [id/value: 1226942013/63]]  old [Event id: [27312078], event type: [Q15], status: [OPEN_ALERTED]] new [Event id: [27312078], event type: [Q15], status: [OPEN_ALERTED]] 
/s
EventHandlerServiceImpl.handleEvent(Event) line: 109	
			listenerList.fireEvent(anEvent);

this	EventHandlerServiceImpl  (id=19313)	
	eventThreadStack	EventThreadStack  (id=19555)	
	jmsTemplate	JmsTemplate  (id=19556)	
	jmsTopicName	"com.mpobjects.eventhandler" (id=19557)	
	listenerList	ListenerList  (id=19552)	
		theListenerList	ArrayList  (id=19554)	
			elementData	Object[22]  (id=19559)	
				[0]	DocumentEventListener  (id=19561)	
				[1]	CustomerOrderEventListener  (id=19562)	
				[2]	ShoCostAllocationEventListener  (id=19563)	
				[3]	ShoPriceAllocationServiceImpl  (id=19564)	
				[4]	TMSCarConServiceOrderEventListener  (id=19566)	
				[5]	SupplierInvoiceUpdateEventListener  (id=19567)	
				[6]	StockTransactionEventListener  (id=19569)	
				[7]	$Proxy416  (id=19571)	
				[8]	EventEventListener  (id=19573)	
				[9]	AllocationEventListener  (id=19574)	
				[10]	CustomerInvoiceUpdateEventListener  (id=19576)	
				[11]	CapableToPromiseEventListener  (id=19578)	
				[12]	PnlLogisticsEventListener  (id=19580)	
				[13]	EmailReportEventListener  (id=19582)	
				[14]	InvoiceServiceOrderEventHandler  (id=19583)	
				[15]	RateCalcEventListener  (id=19585)	
			modCount	16	
			size	16	
anEvent	EventEvent  (id=19468)	
myEventType	"event.updated" (id=19531)	
myLevel	0	
myLevelPrefix	"" (id=19548)	
myStartDate	Date  (id=19550)	
info	true	

/ TODO (Overslaan)

/ Einde Intermezzo

			for (EventVO myEventVO : getEventService().getEventsForServiceAction(anAction.getSystemId())) {
/ GEEN meer	,

			myNewConsignment.removeServiceAction(anAction);
/s
	public void removeServiceAction(ServiceActionVO anAction) {
		if (theServiceActionList.remove(anAction)) {
			anAction.setConsignmentVO(null);
/t

anAction	ServiceActionVO  (id=19196)	
	theConsignmentVO	null	
myNewConsignment	ConsignmentVO_$$_javassist_136  (id=19308)	
	handler	JavassistLazyInitializer  (id=19356)	
		target	ConsignmentVO  (id=19363)	
			theServiceActionList	PersistentBag  (id=19380)	
[]
/ In myOldConsignment is theServiceActionList=[SH000131483RT/SCAN/27035046]

			if (myNewConsignment.getServiceActionList().size() == 0) {
/ JA
				consignmentDAO.removeConsignment(myNewConsignment.getSystemId());
/ Intermezzo

/ Nu	,
pnllogistics6a=# select*from consignment where system_id=26977347;
consignment_number          | N0126241.1

/ Einde Intermezzo

				serviceOrderService.handleConsignmentDeleted(myOldConsignment, oldServiceActionTotalCount);
/s
ServiceOrderServiceImpl.handleConsignmentDeleted(ConsignmentVO, int) line: 1016	
			deleteConsignment(myOldConsignment, oldServiceActionTotalCount);
/s
ServiceOrderServiceImpl.deleteConsignment(ConsignmentVO, int) line: 1693	

			ServiceOrderVO myNewServiceOrder = aConsignment.getServiceOrderVO();
			ServiceOrderVO myOldServiceOrder = getOld(myNewServiceOrder);
			if (myNewServiceOrder.getConsignmentList().remove(aConsignment)) {
myNewServiceOrder.getConsignmentList()=[]	, WAS [N0126241.1]
				myNewServiceOrder.setRecalculate();
				myNewServiceOrder.recalculate();
/ TODO (Overslaan)

			if (myNewServiceOrder.getConsignmentList().size() == 0 && myNewServiceOrder.getServiceOrderType() != null
					&& myNewServiceOrder.getServiceOrderType().isDeleteWhenOpen()) {
/ NEE
true && true (SCAN) && false

$ less conf/application.properties
module.oms.serviceordertype.delete.when.open=CANCEL,COLLECT,COL_CNTRY,CUSTOMS,DELIVERY,DELIVERY_NA,INBOUND,INB_WHS,LINEHAUL,LINEHAUL_IN,LINEHAUL_NA,OUTB_WHS,PICKUP,POD_CHK,PRE_ALERT,RET_WHS,SURVEY

			} else {
				setDatesAndStatusAfterConsignmentUpdate(myNewServiceOrder);
				serviceOrderDAO.save(myNewServiceOrder);
				getTriggerHandler().handleUpdate(myOldServiceOrder, myNewServiceOrder, oldServiceActionTotalCount);
/ TODO (Overslaan)
				triggerEventHandler(myOldServiceOrder, myNewServiceOrder, true, myContext);
/ TODO (Overslaan)

/ Intermezzo

/ Nu	,

pnllogistics6a=# select*from service_order where system_id=26994314;
service_order_id               | N0126241

/ Einde Intermezzo

/t
ConsignmentServiceImpl.removeServiceAction(ServiceActionVO, TMSEventContext) line: 706	
				serviceOrderService.handleConsignmentDeleted(myOldConsignment, oldServiceActionTotalCount);
/d
				triggerEventHandler(myOldConsignment, null, false, aContext);
/ TODO (Overslaan)
/t
ConsignmentServiceImpl.handleServiceActionDelete(ServiceActionVO) line: 423	
					removeServiceAction(myOldVO);
/d
		LOG.debug("handleServiceActionDelete(" + myOldVO + ") return");
/t
ServiceActionServiceImpl.updateConsignment(ServiceActionVO, ConsignmentVO) line: 980	
		if (aNewConsignment == null) {
			consignmentService.handleServiceActionDelete(aServiceAction);
/d
			aServiceAction.setManuallyUnplanned(true);
		setDatesAndStatus(aServiceAction);
		shipmentOrderService.handleServiceActionChange(aServiceAction, myOld);
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).handleServiceActionChange(ServiceActionVO, ServiceActionVO) line: 1171	

		LOG.debug("handleServiceActionChange(" + aNewServiceActionVO + ", " + aOldServiceActionVO + ")");
		// --Make sure we have a recent version of the shipment order.--
		ShipmentOrderVO myNewShipmentOrder = aNewServiceActionVO.getShipmentOrderVO();

		boolean shipmentOrderOpenAndServiceActionNot = OrderStatusVO.STATUS_UNPLANNED.equals(myNewShipmentOrder.getOrderStatusCode())
				&& !OrderStatusVO.STATUS_UNPLANNED.equals(aNewServiceActionVO.getOrderStatusCode());
false && !true
myNewShipmentOrder.getOrderStatusCode()=1450=PLANNED
aNewServiceActionVO.getOrderStatusCode()=1404=UNPLANNED

		if (aOldServiceActionVO == null || !aNewServiceActionVO.getDateSetVO().equals(aOldServiceActionVO.getDateSetVO()) || !ObjectUtils.equals(aOldServiceActionVO.getConsignmentVO(), aNewServiceActionVO.getConsignmentVO()) || shipmentOrderOpenAndServiceActionNot) {
/ JA
			// This fix was required because older events where catching up newer events. This resulted in an new
			// service action being replaced by an older one. Hence, the status was incorrect after a shipment order
			// was initially assigned to a service action. The error only occured when the initially assigned plan
			// dates on the service order were not changed.
			// FIXME TR: Check if this is still neededmyNewShipmentOrder.resetServiceActionsLoaded();
			updateShipmentOrder(myNewShipmentOrder, false);
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).updateShipmentOrder(ShipmentOrderVO, boolean) line: 1985	
		return updateShipmentOrder(aShipmentOrder, new TMSEventContext(), propagateChange);
propagateChange=false
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 2032	
			} else {
...
				myNew = shipmentOrderDao.merge(aShipmentOrder);
...
				myNew.setRecalculate();
				myNew.recalculate();
...
				if (propagateChange) {
/ NEE
					MpoBeanFactory.getBean(ServiceActionService.class).handleShipmentOrderChange(myOldVO, myNew);
/ NIET
					MpoBeanFactory.getBean(ConsignmentService.class).handleShipmentOrderChange(myNew, myOldVO);
/ NIET
					triggerEventHandler(myOldVO, myNew, anEventContext);
/ NIET
			return myNew;
/t
ServiceActionServiceImpl.updateConsignment(ServiceActionVO, ConsignmentVO) line: 991	
		shipmentOrderService.handleServiceActionChange(aServiceAction, myOld);
/d
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).unplan(ShipmentOrderVO) line: 1791	
		for (ServiceActionVO serviceAction : reversedList) {
			if (serviceAction.getConsignmentVO() != null) {
				LOG.info("Unplanning service action: " + serviceAction + " from " + aShipmentOrderVO);
				getServiceActionService().updateConsignment(serviceAction, null);
/d
/ consignment is deleted
/ in sa, seo is consigment null (db)
/ TODO
			// Removing shipment order cost parts
			List<ShipmentOrderCostPartVO> myList = new CopyOnWriteArrayList<ShipmentOrderCostPartVO>(aShipmentOrderVO.getShipmentOrderCostPartList());
[]
			for (ShipmentOrderCostPartVO part : myList) {
/ NEE
				shipmentOrderCostPartService.delete(part);
/ NIET
			try {
				getServiceActionService().deleteServiceAction(serviceAction.getSystemId());
/s
ServiceActionServiceImpl.deleteServiceAction(int) line: 317	
			MpoBeanFactory.getBean(EventDAO.class).deleteServiceActionAssociatedEvents(aSystemId);
/s
PnlLogisticsEventDAOImpl(EventDAOImpl).deleteServiceActionAssociatedEvents(int) line: 142	
		Collection<EventVO> eventVOs = getEventsForServiceAction(serviceActionSystemId);
serviceActionSystemId	27035045	
/s
PnlLogisticsEventDAOImpl(EventDAOImpl).getEventsForServiceAction(int) line: 503	
/ NATIVE QUERY
		Collection<EventVO> myRet = new ArrayList<EventVO>();

		String myQuery = "select ev.* from event_event ev where ev.service_action_systemid = :serviceActionId order by ev.closed_on, ev.expected_end ";
		Collection<QueryParameter> params = new ArrayList<QueryParameter>();
		params.add(new IntNamedQueryParameter("serviceActionId", aServiceActionId));
		myRet.addAll(executeSqlSelect(myQuery, "ev", params));

		return myRet;
[]
/t
PnlLogisticsEventDAOImpl(EventDAOImpl).deleteServiceActionAssociatedEvents(int) line: 143	
		Collection<EventVO> eventVOs = getEventsForServiceAction(serviceActionSystemId);
/d
		for (EventVO eventVO : eventVOs) {
/ NEE
			if (eventVO.getServiceOrderVO() != null) {
				eventVO.getServiceOrderVO().getEvents().remove(eventVO);
/ NIET
/ rm alle events uit seo's event coll	, in Java, in mem	, dus eventVO.getServiceOrderVO().events=[]	, eventVO zelf is er ook uit	,
/ maar nu zijn deze events er niet	,

		super.deleteAll(eventVOs);
/s
PnlLogisticsEventDAOImpl(GenericHibernateDAO).deleteAll(Collection<Type>) line: 165	
			} else {
				getHibernateTemplate().deleteAll(aCollection);
/ in db	, 
/ deletes al deze events uit events_events
/ maar nu zijn deze events er niet	,

/t
ServiceActionServiceImpl.deleteServiceAction(int) line: 318	
			MpoBeanFactory.getBean(EventDAO.class).deleteServiceActionAssociatedEvents(aSystemId);
/d
			ServiceActionVO myOldServiceAction = serviceActionDAO.getBySystemId(aSystemId);
			ShipmentOrderVO myShipmentOrderVO = myOldServiceAction.getShipmentOrderVO();
			myShipmentOrderVO.deleteServiceAction(myOldServiceAction);
/s
	public void deleteServiceAction(ServiceActionVO aServiceAction) {
		theServiceActionList.remove(aServiceAction);
		aServiceAction.setShipmentOrderVO(null);
/t
			consignmentService.handleServiceActionDelete(myOldServiceAction);
/s
ConsignmentServiceImpl.handleServiceActionDelete(ServiceActionVO) line: 410	
		LOG.debug("handleServiceActionDelete(" + myOldVO + ")");
			if (myOldVO != null) {
/ sa
				ConsignmentVO myOldConsignmentVO = myOldVO.getConsignmentVO();
null
				if (myOldConsignmentVO != null) {
/ NEE
					LOG.debug("handled by " + this.getClass() + ".handleServiceActionDelete");
/ NIET
					removeServiceAction(myOldVO);
/ Dit is : rm sa van de consignment	, is WH niet: rm sa	,
/ NIET
		LOG.debug("handleServiceActionDelete(" + myOldVO + ") return");
/t
ServiceActionServiceImpl.deleteServiceAction(int) line: 322	
			consignmentService.handleServiceActionDelete(myOldServiceAction);
/d
			triggerEventHandler(myOldServiceAction, null, new TMSEventContext());
...
/s
EventHandlerServiceImpl.handleEvent(Event) line: 72	
anEvent	ServiceActionEvent  (id=21512)	
serviceaction.deleted, context [id/value: 999783363/63]]  old [LINEHAUL/27035045] new [null] 
/ eig. SCAN

			listenerList.fireEvent(anEvent);
...
/t
ServiceActionServiceImpl.deleteServiceAction(int) line: 322	
			triggerEventHandler(myOldServiceAction, null, new TMSEventContext());
/d
/t
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).unplan(ShipmentOrderVO) line: 1799	
				getServiceActionService().deleteServiceAction(serviceAction.getSystemId());
/d
		for (ServiceActionVO serviceAction : reversedList) {
/ GEEN meer	,
reversedList=
[SCAN/27035046, LINEHAUL/27035045]

		shipmentItemService.removeContainerContent(aShipmentOrderVO);
/s
ShipmentItemServiceImpl.removeContainerContent(ShipmentOrderVO) line: 618	
		containerService.removeContainerContent(aShipmentOrderVO);
/s
ContainerServiceImpl.removeContainerContent(ShipmentOrderVO) line: 295	
		List<ShipmentItemContainer> shipmentItems = shipmentItemContainerDAO.getShipmentItems(aShipmentOrderVO);
/s
ShipmentItemContainerDAOImpl.getShipmentItems(ShipmentOrderVO) line: 178	
		DetachedCriteria myCriteria = DetachedCriteria.forClass(type)		
			.createCriteria(ContainerAssociationDAO.LINK)
			.add(Property.forName(ShipmentItemContainerDAO.SHIPMENT_ORDER).eq(aShipmentOrderVO));

this	ShipmentItemContainerDAOImpl  (id=21577)	
	type	Class (com.mpobjects.oms.model.container.ShipmentItemContainer) (id=12516)	
ContainerAssociationDAO.LINK="link"
ShipmentItemContainerDAO.SHIPMENT_ORDER="shipmentOrder"

		return getHibernateTemplate().findByCriteria(myCriteria);

/ Intermezzo

/ ShipmentItemContainer heeft geen H. mapping , maar zijn superclass AbstractContainerAssociation wel	,

$ vi AbstractContainerAssociation.standard.hbm.xml

<hibernate-mapping package="com.mpobjects.oms.model.container">
	<class name="AbstractContainerAssociation">
		<id name="systemId" type="int" unsaved-value="0">
			<column name="SYSTEM_ID" />
			<generator class="com.mpobjects.core.model.HibernateIdGenerator" />
		</id>
		<many-to-one name="container" column="CONTAINER_SYSTEMID" class="Container" />
		<property name="endDate" column="END_DATE" />
		<many-to-one name="endUser" column="END_USER_SYSTEMID" class="com.mpobjects.oms.model.user.Resource" fetch="select" />
		<property name="startDate" column="START_DATE" />
		<many-to-one name="startUser" column="START_USER_SYSTEMID" class="com.mpobjects.oms.model.user.Resource" fetch="select" not-null="true" />
		
		<union-subclass name="ParentContainer" table="PARENT_CONTAINER">
			<many-to-one name="link" column="PARENT_CONTAINER_SYSTEMID" class="Container" />
		</union-subclass>
		<union-subclass name="ServiceOrderContainer"  table="SERVICE_ORDER_CONTAINER">
			<many-to-one name="link" column="SERVICE_ORDER_SYSTEMID" class="com.mpobjects.oms.model.serviceorder.vo.ServiceOrderVO" />
		</union-subclass>
->		<union-subclass name="ShipmentItemContainer" table="SHIPMENT_ITEM_CONTAINER">
			<many-to-one name="link" column="SHIPMENT_ITEM_SYSTEMID" class="com.mpobjects.oms.model.shipmentorder.vo.ShipmentItemVO" />
		</union-subclass>


/ Einde Intermezzo

/t
ContainerServiceImpl.removeContainerContent(ShipmentOrderVO) line: 296	
		List<ShipmentItemContainer> shipmentItems = shipmentItemContainerDAO.getShipmentItems(aShipmentOrderVO);
[]
/ Er is toch 1 shi	?
/ Wat zijn dit voor shipment items? (nu [])
/ TODO
		shipmentItemContainerDAO.deleteAll(shipmentItems);
/t
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).unplan(ShipmentOrderVO) line: 1811	
		shipmentItemService.removeContainerContent(aShipmentOrderVO);
/d
		updateShipmentOrder(aShipmentOrderVO, true);
/ TODO (Overslaan)

/ 7	. 

/ De unplan is klaar	,

/ de shi is nog in de sho	, 
/ See shipment item container .remove shipment items,	 die [] waren	, 
/ TODO

/ dit waren de sa's	,
[SH000131483RT/SCAN/27035046, SH000131483RT/LINEHAUL/27035045]
/ ze zijn rm	,
/ dit was 1 van de de cons's	,
N0126241.1
/ is rm	, 

/ 7	. 

/ we plan opnieuw in	,

/ we zien 	,
pnllogistics6a=# 
select sa.system_id,cons.system_id,seo.system_id,e.system_id,sat.service_action_type,cons.consignment_number ,seo.service_order_id,et.name
select sa.system_id,
cons.system_id,
seo.system_id,
e.system_id,
sat.service_action_type,
cons.consignment_number ,
seo.service_order_id,
et.name
from service_action_type sat
join service_action sa on sa.service_action_type_systemid=sat.system_id
join consignment cons on sa.consignment_systemid=cons.system_id
join service_order seo on cons.service_order_systemid=seo.system_id
left join event_event e on e.service_action_systemid=sa.system_id
left join event_type et on e.event_type_systemid=et.system_id
where sa.system_id in (27035051,27035050);
 system_id | system_id | system_id | system_id | service_action_type | consignment_number | service_order_id | name 
-----------+-----------+-----------+-----------+---------------------+--------------------+------------------+------
  27035050 |  26977351 |  26994318 |      NULL | LINEHAUL            | N0126242.1         | N0126242         | NULL
  27035051 |  26977352 |  26994319 |  27312086 | SCAN                | N0126243.1         | N0126243         | Q15
(2 rows)

/ Na unplan is rm	,
/ beide sa's,
/ beide cons's 
/ 1 seo: LINEHAUL	, de SCAN is er nog	,



N0126242.1/26977351
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).unplan(ShipmentOrderVO) line: 1789	
		List<ServiceActionVO> reversedList = new ArrayList<ServiceActionVO>(aShipmentOrderVO.getServiceActionList());
		Collections.reverse(reversedList);
[SH000131483RT/SCAN/27035051, SH000131483RT/LINEHAUL/27035050]

/s
PnlLogisticsEventDAOImpl(EventDAOImpl).getEventsForServiceAction(int) line: 510	
		Collection<EventVO> myRet = new ArrayList<EventVO>();
[Event id: [27312086], event type: [Q15], status: [OPEN_ALERTED]]

/s
ConsignmentServiceImpl.removeServiceAction(ServiceActionVO, TMSEventContext) line: 705	
			if (myNewConsignment.getServiceActionList().size() == 0) {
				consignmentDAO.removeConsignment(myNewConsignment.getSystemId());
/ deletes consignment in db	,
				serviceOrderService.handleConsignmentDeleted(myOldConsignment, oldServiceActionTotalCount);

/ we disable b	, 
EventHandlerServiceImpl [line: 72] - handleEvent(Event)	

PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).unplan(ShipmentOrderVO) line: 1799	
		for (ServiceActionVO serviceAction : reversedList) {
				getServiceActionService().updateConsignment(serviceAction, null);
/ rm cons	,
/d
				getServiceActionService().deleteServiceAction(serviceAction.getSystemId());
/s
ServiceActionServiceImpl.deleteServiceAction(int) line: 317	
			MpoBeanFactory.getBean(EventDAO.class).deleteServiceActionAssociatedEvents(aSystemId);
/s
PnlLogisticsEventDAOImpl(EventDAOImpl).deleteServiceActionAssociatedEvents(int) line: 143	
		Collection<EventVO> eventVOs = getEventsForServiceAction(serviceActionSystemId);
[Event id: [27312086], event type: [Q15], status: [OPEN_ALERTED]]
		super.deleteAll(eventVOs);

/c
/s
/ TODO
/s
	ServiceOrderServiceImpl.deleteServiceOrder(ServiceOrderVO) line: 554	

	ServiceOrderServiceImpl.deleteConsignment(ConsignmentVO, int) line: 1707	
			if (myNewServiceOrder.getConsignmentList().size() == 0 && myNewServiceOrder.getServiceOrderType() != null
					&& myNewServiceOrder.getServiceOrderType().isDeleteWhenOpen()) {
/LINEHAUL
				LOG.debug("Going to delete service order [" + myNewServiceOrder + "] because there are no consignments left");
				getServiceActionFacadeLocal().removePreferredServiceOrder(myNewServiceOrder);
->				deleteServiceOrder(myNewServiceOrder);

	ServiceOrderServiceImpl.handleConsignmentDeleted(ConsignmentVO, int) line: 1016	
	ConsignmentServiceImpl.removeServiceAction(ServiceActionVO, TMSEventContext) line: 705	
	ConsignmentServiceImpl.removeServiceAction(ServiceActionVO) line: 670	
	ConsignmentServiceImpl.handleServiceActionDelete(ServiceActionVO) line: 417	
	ServiceActionServiceImpl.updateConsignment(ServiceActionVO, ConsignmentVO) line: 980	
	PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).unplan(ShipmentOrderVO) line: 1791	
	PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).unplan(int) line: 1777	
	ShipmentOrderUnplanActionsAction.act() line: 25	
	ShipmentOrderUnplanActionsAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	
 

/ 7	. 

/ opnieuw unplan	,
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).unplan(ShipmentOrderVO) line: 1791	
		for (ServiceActionVO serviceAction : reversedList) {
...
reversedList=
[SH000131483RT/SCAN/27035053, SH000131483RT/LINEHAUL/27035052]

/ we zien 	,
pnllogistics6a=# 
select sa.system_id,
cons.system_id,
seo.system_id,
e.system_id,
sat.service_action_type,
cons.consignment_number ,
seo.service_order_id,
et.name
from service_action_type sat
join service_action sa on sa.service_action_type_systemid=sat.system_id
join consignment cons on sa.consignment_systemid=cons.system_id
join service_order seo on cons.service_order_systemid=seo.system_id
left join event_event e on e.service_action_systemid=sa.system_id
left join event_type et on e.event_type_systemid=et.system_id
where sa.system_id in (27035053, 27035052);
 system_id | system_id | system_id | system_id | service_action_type | consignment_number | service_order_id | name 
-----------+-----------+-----------+-----------+---------------------+--------------------+------------------+------
  27035052 |  26977353 |  26994320 |      NULL | LINEHAUL            | N0126244.1         | N0126244         | NULL
  27035053 |  26977354 |  26994321 |  27312087 | SCAN                | N0126245.1         | N0126245         | Q15
(2 rows)

/ Hoe wordt een sa delete als je een sho unplan?
/ TODO
/ we zien dat het gebeurt	,

2016-04-08 13:19:38,125 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-7:) delete from CONSIGNMENT where SYSTEM_ID=26977354
2016-04-08 13:19:38,127 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-7:) delete from EVENT_EVENT where SYSTEM_ID=27312087  and version=?
2016-04-08 13:19:38,128 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-7:) delete from SERVICE_ACTION where SYSTEM_ID=27035053

2016-04-08 13:20:07,211 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-7:) delete from CONSIGNMENT where SYSTEM_ID=26977353
2016-04-08 13:20:45,381 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-7:) delete from SERVICE_ORDER where SYSTEM_ID=26994320
2016-04-08 13:22:42,478 DEBUG [org.hibernate.SQL] (http-0.0.0.0-8080-7:) delete from SERVICE_ACTION where SYSTEM_9422671 ID=27035052


/ Einde DEBUG UNPLAN PCT-1234

/ DEBUG PLAN PCT-1234

/ local, pnllogistics6a= acc db , waar issue NIET speelt, dus unplan & save gaat OK 	,
ShipmentOrder: SH000131483RT(SystemId:26975555; Org:PNL-CARGO)

/ 7	. 

/ De bill to party (invoice in sho)	, is niet in de party group RETURN_LABEL	,

/ de bill to party is een virtual party	, die wordt gemaakt van de master data party	, WH met dezelfde party_id	, bijv '9105522'	, 
/ de party_in_group join table werkt met system_id's 	, 
/ de shipment_order.invoice_party_id is een party_id	, dus moeten we in de master_data party tbl de system_id opzoeken	,  
 

pnllogistics6a=# select pg.system_id 
from shipment_order sho 
join party p on sho.invoice_party_id=p.party_id
join party_in_group pig on p.system_id=pig.party_systemid 
join party_group pg on pg.system_id=pig.party_group_systemid
where sho.shipment_order_id='SH000131483RT';
/ LEEG	,


$ vi shipment-order_edit.jsp

				<input type="button" value="<mpo:label name="save"/>" onclick="document.getElementById('selectPath').value='yes'; theShipmentorderFormManager.submit('../oms/shipment-order_save', false, 0);" />

$ vi oms-sitemap.xmap
			<map:action logger="shipmentorder" name="shipmentOrderSave" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderSaveAction"/>
           <map:match pattern="shipment-order_save">
                <!-- The shipment order is saved and via redirection send to the correct page -->
				<map:act type="shipmentOrderSave">
                    <map:parameter name="isSave" value="true"/>
                </map:act>
                <!-- This part is only reached when the path selection is manual (see ShipmentOrderSave.shouldTakeControl()-->
                <map:act type="pathMatchAction"/>
                <map:act type="redirectAfterSave">
					<map:parameter name="redirectTo" value="path-template_list-for-shipment-order?refresh=true&amp;manuallyAssign={request-param:manuallyAssign}&amp;base_sessionLevelOffset=1"/>
				</map:act>
            </map:match>
/s
ShipmentOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	
				Map myMap = act();
/s
ShipmentOrderSaveAction(AbstractSaveAction).act() line: 69	
			handleSave();
/s
ShipmentOrderSaveAction.handleSave() line: 17	
		super.handleSave();
/s
ShipmentOrderSaveAction(ShipmentOrderSaveAction).handleSave() line: 61	
			ShipmentOrderVO shipmentOrderVO = (ShipmentOrderVO) getValueObject();
ShipmentOrder: SH000131483RT(SystemId:26975555; Org:PNL-CARGO)
			} else {

				ShipmentOrderService shipmentOrderService = ShipmentOrderUtil.getShipmentOrderFacadeLocal();
				ShipmentOrderVO myOldVO = shipmentOrderService.getShipmentOrder(shipmentOrderVO.getSystemId());
				shipmentOrderVO.setSchedule(null);
				shipmentOrderVO.setScheduleXml(myOldVO.getScheduleXml());
				shipmentOrderVO.setScheduleDescription(myOldVO.getScheduleDescription());
				shipmentOrderVO = shipmentOrderService.updateShipmentOrder(shipmentOrderVO, true, true);

			String mySelectPath = getRequest().getParameter("selectPath");
yes
			getLogger().debug("selectPath parameter value: [" + mySelectPath + "]");
			if (mySelectPath != null && BooleanUtils.isTrue(mySelectPath)) {
				// we're 'really' saving here
				MpoBeanFactory.getBean(Tracer.class).traceUpdate(TracerSubject.SHIPMENT_ORDER, shipmentOrderVO.getSystemId(), shipmentOrderVO.getShipmentOrderId());
				((PathAssignmentService) MpoBeanFactory.getBean("foreground_path_assignment")).assignPath(shipmentOrderVO);
/s
PathAssignmentPickOptimalService(AutomaticPathAssignmentService).assignPath(ShipmentOrderVO) line: 45	
		if (aShipmentOrderVO.getSystemId() != ValueObject.VOLATILE_SYSTEM_ID) {
			aShipmentOrderVO = getShipmentOrderService().getShipmentOrder(aShipmentOrderVO.getSystemId());
/ TODO

		final String[] monitorMeta = new String[] { aShipmentOrderVO.getOrganizationVO().getCode(), aShipmentOrderVO.getShipmentOrderId(), null, Boolean.FALSE.toString() };
[PNL-CARGO, SH000131483RT, null, false]
		final MonitorEvent monitorEvent = monitoringService.startEvent("planning.pathassignment", monitorMeta);

			if (LOG.isDebugEnabled()) {
/ NEE
/ TODO
				LOG.debug("Entering assignPath( [" + aShipmentOrderVO.getShipmentOrderId() + "] )");
			}
			List<PathTemplateVO> myPathTemplateList = getPathTemplateList(aShipmentOrderVO);
/s
PathAssignmentPickOptimalService(AutomaticPathAssignmentService).getPathTemplateList(ShipmentOrderVO) line: 146	
		// get path templates applicable to shipment order
		PathService myPathFacade = PathUtil.getPathService();
/s
			return MpoBeanFactory.getBean(com.mpobjects.oms.service.path.PathService.class);
/t
com.mpobjects.oms.service.path.PathServiceImpl@2e805a5a
		try {
			return myPathFacade.getPathsFor(aShipmentOrderVO);
/s
PathServiceImpl.getPathsFor(ShipmentOrderVO) line: 119	
		return getPathsFor(myResource, aVO);
/s
PathServiceImpl.getPathsFor(Resource, ShipmentOrderVO) line: 249	
		if (LOG.isInfoEnabled()) {
/ JA
			LOG.info("In getPathsFor(" + aResourceVO + ", " + aVO + ")");
		}
		return getPathsFor(aResourceVO, aVO, PathSelectionMode.AUTO_PLAN, -1);
/s
PathServiceImpl.getPathsFor(Resource, ShipmentOrderVO, PathSelectionMode, int) line: 263	
		if (LOG.isInfoEnabled()) {
			LOG.info("In getPathsFor(" + aResourceVO + ", " + aVO + ", " + aMode + ")");
		}
		if (aVO.getServiceActionList() != null && aVO.getServiceActionList().size() > 0) {
/ NEE

		List<PathTemplateVO> myInitialPathsList = getPathTemplatesOrdered(aResourceVO);
/s
			return (List) pathTemplateDAO.getPathTemplateListOrdered();
/s
PathServiceImpl.getPathTemplatesOrdered(Resource) line: 340	
		List<PathTemplateVO> myList = getHibernateTemplate().findByCriteria(
				DetachedCriteria.forClass(PathTemplateVO.class).add(Property.forName("deleted").eq(false)).addOrder(Order.asc("priority")));
/ 188 tpl's	, 
/ klopt	,
pnllogistics6a=# select count(*)from path_template where is_deleted=0;
 count 
-------
   188
(1 row)

		if (LOG.isDebugEnabled()) {
			LOG.debug("Returning " + myList.size() + " records in " + (System.currentTimeMillis() - myStart) + "ms");
		}

		return myList;
/t
PathServiceImpl.getPathsFor(Resource, ShipmentOrderVO, PathSelectionMode, int) line: 274	
		List<PathTemplateVO> myInitialPathsList = getPathTemplatesOrdered(aResourceVO);

/d
/ 188 tpl's

/we maken een cond b op l. 308	,
myPathVO.getSystemId()==26859337 || myPathVO.getSystemId()==26859328
/ of beter	,
myPath.getCode().equals("PHARMA RT/RT BE|LU uit NL WITHOUT LABEL") || myPath.getCode().equals('PHARMA RT/RT BE|LU uit NL WITH LABEL")
 
308:			if (myPathVO.matchesWith(aVO)) {
mypathVO=
pathTemplateVO:PHARMA RT/RT BE|LU uit NL WITH LABEL(systemId:26859328)
/s

////////////
/ 1ste tpl	,"PHARMA RT/RT BE|LU uit NL WITH LABEL" (id=20388)	
/ matches NIET	, want de billto party van de sho zit niet in de RETURN_LABEL group	,

this	com.mpobjects.oms.model.leggen.vo.PathTemplateVO  (id=20383)	
	code	"PHARMA RT/RT BE|LU uit NL WITH LABEL" (id=20388)	
	systemId	26859328	
	thePathCriteriumList	org.hibernate.collection.PersistentBag  (id=20393)	
		bag	java.util.ArrayList  (id=20395)	
			elementData	java.lang.Object[10]  (id=20400)	
				[0]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=20401)	
theSystemId: 26859329
CriteriumTypeSystemId :26682067
CriteriumType :null
Implementation class :null
PathTemplateSystemId :26859328
ValueFrom :(.*,)?RETURN_LABEL(,.*)?
ValueTo :null
ValueType :REGEX
				[1]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=20402)	
				[2]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=20403)	
				[3]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=20404)	
				[4]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=20405)	
				[5]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=20406)	
				[6]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=20407)	
			size	7	

		for (int i = 0; i < thePathCriteriumList.size(); i++) {
i=0
			if (!thePathCriteriumList.get(i).match(aVO)) {
/s
PathCriteriumVO.match(ShipmentOrderVO) line: 223	
/=
	public boolean match(ShipmentOrderVO aVO) {

this	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=20401)	
	criteriumTypeVO	com.mpobjects.oms.model.entity.criteriumtype.CriteriumType_$$_javassist_179  (id=20546)	
	performanceMonitorService	null	
	systemId	26859329	
	theCriteriumTypeCode	null	
	theCriteriumTypeLoaded	false	
	theCriteriumTypeSystemId	java.lang.Integer  (id=20547)	
	theImplementationClass	"billToPartyVO/partyGroupAsString" (id=20548)	
	thePathTemplateLoaded	false	
	thePathTemplateSystemId	java.lang.Integer  (id=20549)	
	thePathTemplateVO	com.mpobjects.oms.model.leggen.vo.PathTemplateVO  (id=20383)	
	theValueFrom	"(.*,)?RETURN_LABEL(,.*)?" (id=20550)	
	theValueTo	null	
	theValueType	com.mpobjects.oms.util.match.MatchTypeName$5  (id=20551)	

/ Hierboven String repr	,
/=
theSystemId: 26859329
CriteriumTypeSystemId :26682067
CriteriumType :null
Implementation class :null
PathTemplateSystemId :26859328
ValueFrom :(.*,)?RETURN_LABEL(,.*)?
ValueTo :null
ValueType :REGEX

aVO	com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO_$$_javassist_143  (id=19601)	
	handler	org.hibernate.proxy.pojo.javassist.JavassistLazyInitializer  (id=20589)	
		target	com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO  (id=20636)	
			theBillToParty	com.mpobjects.oms.model.entity.VirtualParty  (id=20653)	
				partyGroupsAsString	"" (id=20625)	
/ Klopt	, see query bij 7 boven	,

		JXPathContext myContext = JXPathContext.newContext(aVO);
/= sho	,
		theImplementationClass = getCriteriumTypeVO().getImplementationClass();
billToPartyVO/partyGroupAsString

		Object myValue = myContext.getValue(theImplementationClass);
/s
ShipmentOrderVO.getShipmentOrderProcess() line: 1783	
		return getOrderProcess().getCode();
""
/t
PathCriteriumVO.match(ShipmentOrderVO) line: 236	
		Object myValue = myContext.getValue(theImplementationClass);
""
/d
		boolean myResult = matchValue(myValue);
/s
PathCriteriumVO.matchValue(Object) line: 252	
/=
	public boolean matchValue(Object aValue) {
aValue=""
		Matcher myMatcher = getMatchTypeName().getMatcher(this);
myMatcher	RegexMatcher  (id=25060)	

myMatcher	com.mpobjects.oms.util.match.impl.RegexMatcher  (id=20766)	
	pattern	java.util.regex.Pattern  (id=20782)	
	theInvertFlag	false	
	theRegex	"(.*,)?RETURN_LABEL(,.*)?" (id=20550)	

			myMatch = myMatcher.match(aValue);
/s
RegexMatcher.match(Object) line: 73	
		String myValue = obj.toString();
""
		boolean myResult = pattern.matcher(myValue).matches();
/s
Pattern.matcher(CharSequence) line: 1088	

this	java.util.regex.Pattern  (id=20782)	
input	"" (id=20625)	

        Matcher m = new Matcher(this, input);
/t
/s
Matcher.matches() line: 559	
        return match(from, ENDANCHOR);
/s
Matcher.match(int, int) line: 1213	
        boolean result = parentPattern.matchRoot.match(this, from, text);
false
/t
PathCriteriumVO.match(ShipmentOrderVO) line: 238	
		boolean myResult = matchValue(myValue);
/d
false
		return myResult;
/t
PathTemplateVO.matchesWith(ShipmentOrderVO) line: 272	
		for (int i = 0; i < thePathCriteriumList.size(); i++) {
			if (!thePathCriteriumList.get(i).match(aVO)) {
/ JA
				myResult = false;
				break;

/ volgende,  totdat niet match		,
		for (int i = 0; i < thePathCriteriumList.size(); i++) {
			if (!thePathCriteriumList.get(i).match(aVO)) {
/ JA
thePathCriteriumList.get(i)=
theSystemId: 27078295
CriteriumTypeSystemId :23
CriteriumType :null
Implementation class :shipmentOrderId
PathTemplateSystemId :27078292
ValueFrom :!.*RT
ValueTo :null
ValueType :REGEX
aVO=
ShipmentOrder: SH000131483RT(SystemId:26975555; Org:PNL-CARGO)

				myResult = false;
				break;
		LOG.debug("Matching shipment order [" + aVO + "] for path [" + getCode() + "/" + getDescription() + "], result: " + myResult);

		return myResult;
false
/t
PathServiceImpl.getPathsFor(Resource, ShipmentOrderVO, PathSelectionMode, int) line: 308	
		for (int i = 0; i < myInitialPathsList.size(); i++) {
			PathTemplateVO myPathVO = myInitialPathsList.get(i);
			if (myPathVO.matchesWith(aVO)) {
/ NEE

///////////////////////////////////
/ 2de template	, PHARMA RT/RT BE|LU uit NL WITHOUT LABEL	, 

		for (int i = 0; i < myInitialPathsList.size(); i++) {
			PathTemplateVO myPathVO = myInitialPathsList.get(i);
			if (myPathVO.matchesWith(aVO)) {
/s
PathTemplateVO.matchesWith(ShipmentOrderVO) line: 272	

this	com.mpobjects.oms.model.leggen.vo.PathTemplateVO  (id=21420)	
	code	"PHARMA RT/RT BE|LU uit NL WITHOUT LABEL" (id=21425)	
	systemId	26859337	
	thePathCriteriumList	org.hibernate.collection.PersistentBag  (id=21427)	
		bag	java.util.ArrayList  (id=21429)	
			elementData	java.lang.Object[10]  (id=21430)	
				[0]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=21431)	
				[1]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=21432)	
				[2]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=21433)	
				[3]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=21434)	
				[4]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=21435)	
theSystemId: 26859344
CriteriumTypeSystemId :26682067
CriteriumType :null
Implementation class :null
PathTemplateSystemId :26859337
ValueFrom :!(.*,)?RETURN_LABEL(,.*)?
ValueTo :null
ValueType :REGEX
				[5]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=21436)	
				[6]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=21437)	
			size	7	
/s
PathCriteriumVO.match(ShipmentOrderVO) line: 223	
		JXPathContext myContext = JXPathContext.newContext(aVO);
/ sho	,
		theImplementationClass = getCriteriumTypeVO().getImplementationClass();
billToPartyVO/partyGroupAsString
		Object myValue = myContext.getValue(theImplementationClass);
""
		boolean myResult = matchValue(myValue);
true
/t
PathServiceImpl.getPathsFor(Resource, ShipmentOrderVO, PathSelectionMode, int) line: 309	
			if (myPathVO.matchesWith(aVO)) {
/ JA
myPthVO=
pathTemplateVO:PHARMA RT/RT BE|LU uit NL WITHOUT LABEL(systemId:26859337)


/ TODO (Afmaken)









				if (!hasServiceActions && !myPathVO.isAddToExisting()) {
/ JA
/ TODO ( de path template heeft checked 'Add To Existing'	)

					if (LOG.isDebugEnabled()) {
						LOG.debug("Adding path:" + myPathVO + " for shipment:" + aVO);
					}
					myReturnList.add(myPathVO);

		}
		if (LOG.isInfoEnabled()) {
			LOG.info("In getPathsFor(" + aResourceVO + ", " + aVO + ") count:" + myReturnList.size());
		}
		return myReturnList;
/t
PathAssignmentPickOptimalService(AutomaticPathAssignmentService).assignPath(ShipmentOrderVO) line: 63	
			List<PathTemplateVO> myPathTemplateList = getPathTemplateList(aShipmentOrderVO);
/d
[pathTemplateVO:PHARMA RT/RT BE|LU uit NL WITHOUT LABEL(systemId:26859337)]
pathTemplateVO:PHARMA RT/RT BE|LU uit NL WITHOUT LABEL(systemId:26859337)

			int myNumberOfPaths = myPathTemplateList == null ? 0 : myPathTemplateList.size();
1
			if (LOG.isDebugEnabled()) {
				LOG.debug("In assignPath: Number of paths found [" + aShipmentOrderVO.getShipmentOrderId() + "]: " + myNumberOfPaths);
			}

			// get highest priority paths: 1 = HIGH, 999 = LOWER
			int myMostImportantPriority = Integer.MAX_VALUE; // descending scale
			List<PathTemplateVO> myHighestPriorityPathTemplateList = new ArrayList<PathTemplateVO>();
			for (PathTemplateVO myPathTemplateVO : myPathTemplateList) {
				int myPathPriority = myPathTemplateVO.getPriority();
0
				if (myPathPriority < myMostImportantPriority) {
					myMostImportantPriority = myPathPriority;
					myHighestPriorityPathTemplateList.clear();
					myHighestPriorityPathTemplateList.add(myPathTemplateVO);

			if (LOG.isDebugEnabled()) {
				LOG.debug("In assignPath: Number of highest priority paths found [" + aShipmentOrderVO.getShipmentOrderId() + "]: "
						+ myHighestPriorityPathTemplateList.size() + " , priority level: " + myMostImportantPriority);
			}

			PathTemplateVO mySelectedPathTemplate = determinePath(aShipmentOrderVO, myHighestPriorityPathTemplateList);
/s
PathAssignmentPickOptimalService.determinePath(ShipmentOrderVO, List<PathTemplateVO>) line: 88	
		DateTime myEndDate = new DateTime(aShipmentOrderVO.getDateSetVO().getRequestedEnd());

		DateTime myBeginDate = null;
		DateSetVO myDateSet = aShipmentOrderVO.getDateSetVO();
		if (myDateSet.getRequestedStartAfter() != null) {
			myBeginDate = new DateTime(aShipmentOrderVO.getDateSetVO().getRequestedStartAfter());

myBeginDate	DateTime  (id=25193)	
2016-04-07T11:50:34.000+02:00
myEndDate	DateTime  (id=25175)	
2016-04-08T18:00:00.000+02:00

		// determine which path should be taken, and exactly how it should be made concrete
		QuotationPath mySelectedPathTemplate = pathDeterminationService.determinePathShipmentOrder(aShipmentOrderVO, aPathTemplateList, myEndDate, myBeginDate);
PathAssignmentPickOptimalService.determinePath(ShipmentOrderVO, List<PathTemplateVO>) line: 44	
/s
AdvancedPathDeterminationServiceImpl.determinePathShipmentOrder(ShipmentOrderVO, List<PathTemplateVO>, DateTime, DateTime) line: 271	

		LOG.debug("Quotation result before start: " + result.toString() + ", Object: " + this);
		result = new QuotationResult();
		determinePossiblePathsShipmentOrder(aShipmentOrder, aPreSelectedPathTemplateList, anArrivalDate, aStartDate, false);
/s
AdvancedPathDeterminationServiceImpl.determinePossiblePathsShipmentOrder(ShipmentOrderVO, List<PathTemplateVO>, DateTime, DateTime, boolean) line: 300	
/=
	public QuotationResult determinePossiblePathsShipmentOrder(ShipmentOrderVO aShipmentOrder, List<PathTemplateVO> aPreSelectedPathTemplateList, DateTime anArrivalDate, DateTime aStartDate, boolean aDummy) {

aShipmentOrder	ShipmentOrderVO_$$_javassist_143  (id=18997)	ShipmentOrder: SH000131483RT(SystemId:26975555; Org:PNL-CARGO)
aPreSelectedPathTemplateList	ArrayList  (id=19770)	[pathTemplateVO:PHARMA RT/RT BE|LU uit NL WITHOUT LABEL(systemId:26859337)]
anArrivalDate	DateTime  (id=19857)	2016-04-08T18:00:00.000+02:00	
aStartDate	DateTime  (id=19858)	2016-04-07T11:50:34.000+02:00	

		Session mySession = serviceOrderDao.getCurrentSession();
mySession	SessionImpl  (id=19023)	
	persistenceContext	StatefulPersistenceContext  (id=19991)	
		entitiesByKey	HashMap  (id=20002)	
			size 	7201	
		FlushMode myFlushMode = mySession.getFlushMode();
AUTO
		mySession.setFlushMode(FlushMode.MANUAL);
		LOG.info("Entering DeterminePathShipmentOrder");


/ Intermezzo

/ MAANDAGOCHTEND
/ stack	,
	PathAssignmentPickOptimalService.determinePath(ShipmentOrderVO, List<PathTemplateVO>) line: 88	
->		QuotationPath mySelectedPathTemplate = pathDeterminationService.determinePathShipmentOrder(aShipmentOrderVO, aPathTemplateList, myEndDate, myBeginDate);

	PathAssignmentPickOptimalService(AutomaticPathAssignmentService).assignPath(ShipmentOrderVO) line: 92	
->			PathTemplateVO mySelectedPathTemplate = determinePath(aShipmentOrderVO, myHighestPriorityPathTemplateList);

$ vi log4j.xml
  <root>
      <priority value="INFO" /> <!-- DEBUG -->
      <appender-ref ref="CONSOLE"/>
      <appender-ref ref="FILE"/>
   </root>
/ Maak 'm DEBUG	,


/ grotere stack	, moeten we heen	,
	RcaServiceOrderDAOImpl(ServiceOrderDaoImpl).getPlannedConsolidateCandidatesBetweenRequestedStartAfterDates(Collection<ServiceOrderVO>, Date, Date, PlanningMode) line: 553	
	ServiceOrderServiceImpl.getPlannedCosolidationCadidatesBetweenRequestedStartAfterDates(Collection<ServiceOrderVO>, Date, Date, PlanningMode, Map<String,String>) line: 715	
	ServiceActionConsolidatorImpl.findConsolidationCandidatesWithBackwardSearchMode(ServiceActionVO, String) line: 606	
	ServiceActionConsolidatorImpl.findConsolidationCandidateByRequestedStartAfterDate(ServiceActionVO, String) line: 311	
	ServiceActionConsolidatorImpl.findConsolidationCandidate(ServiceActionVO, String) line: 213	
	ServiceActionConsolidatorImpl.attemptToConsolidate(ServiceActionVO, String) line: 87	
	ServiceActionServiceImpl.consolidateServiceAction(ServiceActionVO, String) line: 239	
	ServiceActionServiceImpl.planServiceAction(ServiceActionVO) line: 684	
	ServiceActionServiceImpl.planNew(ServiceActionVO) line: 621	
	ServiceActionServiceImpl.addServiceActionsToShipOrder(ShipmentOrderVO, List, PlanningContext) line: 193	
	AdvancedPathDeterminationServiceImpl.assignPathToShipmentOrder(ShipmentOrderVO, QuotationPath) line: 254	
	AdvancedPathDeterminationServiceImpl.determinePathShipmentOrder(ShipmentOrderVO, List<PathTemplateVO>, DateTime, DateTime) line: 286

	PathAssignmentPickOptimalService.determinePath(ShipmentOrderVO, List<PathTemplateVO>) line: 88	
		// determine which path should be taken, and exactly how it should be made concrete
		QuotationPath mySelectedPathTemplate = pathDeterminationService.determinePathShipmentOrder(aShipmentOrderVO, aPathTemplateList, myEndDate, myBeginDate);

	PathAssignmentPickOptimalService(AutomaticPathAssignmentService).assignPath(ShipmentOrderVO) line: 92	
			PathTemplateVO mySelectedPathTemplate = determinePath(aShipmentOrderVO, myHighestPriorityPathTemplateList);

	ShipmentOrderSaveAction(ShipmentOrderSaveAction).handleSave() line: 112	
	ShipmentOrderSaveAction.handleSave() line: 19	
	ShipmentOrderSaveAction(AbstractSaveAction).act() line: 69	
	ShipmentOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	

/ Einde Intermezzo

/ 7	. 

/ pnllogistics6a	, acc db waar het issue niet speelt, 	waar het inplan dus OK gaat	,
/ sho SH000131483RT	, 
/ we add de billto party van deze sho	, "9105522"	, aan de RETURN_LABEL party group	,

pnllogistics6a=# select pg.party_group
from shipment_order sho 
join party p on sho.invoice_party_id=p.party_id
join party_in_group pig on p.system_id=pig.party_systemid 
join party_group pg on pg.system_id=pig.party_group_systemid
where sho.shipment_order_id='SH000131483RT';
 party_group  
--------------
 RETURN_LABEL
(1 row)

/s
PathAssignmentPickOptimalService(AutomaticPathAssignmentService).assignPath(ShipmentOrderVO) line: 61	
			List<PathTemplateVO> myPathTemplateList = getPathTemplateList(aShipmentOrderVO);
...
/s
PathServiceImpl.getPathsFor(Resource, ShipmentOrderVO, PathSelectionMode, int) line: 263	

			if (myPathVO.matchesWith(aVO)) {
myPathVO=
pathTemplateVO:PHARMA RT/RT BE|LU uit NL WITH LABEL(systemId:26859328)
/=
myPathVO	com.mpobjects.oms.model.leggen.vo.PathTemplateVO  (id=23402)	
	code	"PHARMA RT/RT BE|LU uit NL WITH LABEL" (id=23770)	
	systemId	26859328	
	thePathCriteriumList	org.hibernate.collection.PersistentBag  (id=23775)	
		bag	java.util.ArrayList  (id=23780)	
			elementData	java.lang.Object[10]  (id=23781)	
				[0]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=23783)	
					criteriumTypeVO	com.mpobjects.oms.model.entity.criteriumtype.CriteriumType_$$_javassist_179  (id=23839)	
					performanceMonitorService	null	
					systemId	26859329	
					theCriteriumTypeCode	null	
					theCriteriumTypeSystemId	java.lang.Integer  (id=23840)	
					theImplementationClass	null	
					thePathTemplateLoaded	false	
					thePathTemplateSystemId	java.lang.Integer  (id=23843)	
					thePathTemplateVO	com.mpobjects.oms.model.leggen.vo.PathTemplateVO  (id=23402)	
					theValueFrom	"(.*,)?RETURN_LABEL(,.*)?" (id=23845)	
					theValueTo	null	
					theValueType	com.mpobjects.oms.util.match.MatchTypeName$5  (id=20551)	
				[1]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=23784)	
				[2]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=23785)	
				[3]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=23786)	
				[4]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=23787)	
				[5]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=23788)	
				[6]	com.mpobjects.oms.model.leggen.vo.PathCriteriumVO  (id=23789)	
			size	7	

/s
PathTemplateVO.matchesWith(ShipmentOrderVO) line: 270	
		for (int i = 0; i < thePathCriteriumList.size(); i++) {
			if (!thePathCriteriumList.get(i).match(aVO)) {

this	com.mpobjects.oms.model.leggen.vo.PathTemplateVO  (id=23402)	
aVO	com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO_$$_javassist_143  (id=23279)	
	handler	org.hibernate.proxy.pojo.javassist.JavassistLazyInitializer  (id=23906)	
		target	com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO  (id=23290)	
			theBillToParty	com.mpobjects.oms.model.entity.VirtualParty  (id=23923)	
				partyId	"9105522" (id=23941)	
				partyGroupsAsString	"RETURN_LABEL" (id=23940)	
/ OK
























/ Einde DEBUG PLAN PCT-1234

/ SAMENVATTING PCT-1234 

/ We add de billto party 9105522 aan de RETURN_LABEL group	, 

aVO	com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO_$$_javassist_143  (id=23279)	
	handler	org.hibernate.proxy.pojo.javassist.JavassistLazyInitializer  (id=23906)	
		target	com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO  (id=23290)	
			theBillToParty	com.mpobjects.oms.model.entity.VirtualParty  (id=23923)	
				partyId	"9105522" (id=23941)	
				partyGroupsAsString	"RETURN_LABEL" (id=23940)	
/ Als het OK 	,
				partyGroupsAsString	"999" (id=23940)	
/ Als het ERR	,

/ op acc	, SH000144566RT
/ op test	, SH000138030RT

/ op test,	 
[eric@localhost bin]$ pnl-db-t.sh  pnllogistics

pnllogistics=> select pg.*
from party p 
join party_in_group pig on p.system_id=pig.party_systemid 
join party_group pg on pg.system_id=pig.party_group_systemid 
where party_id='9105522';
-[ RECORD 1 ]---------+----------------------------------------------------------------------------
system_id             | 26857184
party_group           | RETURN_LABEL
is_deleted            | 0
description           | Customers for which a label must be created when a return order is created.
organization_systemid | 500
 
/ op acc	, 

[eric@localhost bin]$ pnl-db-a-pg.sh  pnllogistics

pnllogistics=> select pg.*
pnllogistics-> from party p 
pnllogistics-> join party_in_group pig on p.system_id=pig.party_systemid 
pnllogistics-> join party_group pg on pg.system_id=pig.party_group_systemid 
pnllogistics-> where party_id='9105522';
 system_id | party_group  | is_deleted |                                 description                                 | org
anization_systemid 
-----------+--------------+------------+-----------------------------------------------------------------------------+----
-------------------
  27181092 | 999          |          0 | Klantgroep 999 Cargo totaal                                                 |    
               500
  26857184 | RETURN_LABEL |          0 | Customers for which a label must be created when a return order is created. |    
               500
(2 rows)

/ HIER HIER HIER

/ we zien in Java	,

this	com.mpobjects.oms.model.leggen.vo.PathTemplateVO  (id=23402)	
aVO	com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO_$$_javassist_143  (id=23279)	
	handler	org.hibernate.proxy.pojo.javassist.JavassistLazyInitializer  (id=23906)	
		target	com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO  (id=23290)	
			theBillToParty	com.mpobjects.oms.model.entity.VirtualParty  (id=23923)	
				partyGroups	java.util.HashSet  (id=23939)	
[]
				partyGroupsAsString	"RETURN_LABEL" (id=23940)	
				partyId	"9105522" (id=23941)	
				partyType	com.mpobjects.oms.model.entity.partytype.PartyType_$$_javassist_181  (id=23942)	

/ TODO (999)
/ MORGENOCHTEND ( H. mapping )
/ partyGroups=[]
 /See ook party scherm: we zien PRINT_LABEL group niet	,

/ HIER HIER HIER

/ Einde SAMENVATTING PCT-1234 

/ PARTIES

/ CREATE SHIPMENT ORDER

/ 7	. 

/ classes & Hibernate	,

/ 13	. 

/ classes	,

public class VirtualParty extends AbstractParty implements HibernateComponent {
public abstract class AbstractParty extends EntityDetailSupport implements Party {
public interface Party extends EntityInterface, OrganizationValueObjectInterface, UniqueFieldValueObject, SelectionListHelper.SelectionListItem {

public class PartyVO extends AbstractParty implements SoftDeletable, BinaryContainer, MasterDataParty {
public interface MasterDataParty extends Party, EntityDetailsHolder {

public class ShipmentOrderParty extends LogisticOrderParty {
public abstract class LogisticOrderParty extends AbstractParty {

/ 13	. 

$ vi ShipmentOrder.standard.hbm.xml

		<many-to-one name="orderStatusVO" class="com.mpobjects.oms.model.orderstatus.vo.OrderStatusVO" fetch="select">
			<column name="STATUS_CODE_SYSTEMID" />
		</many-to-one>
		<many-to-one name="organizationVO" class="com.mpobjects.oms.model.entity.organization.Organization" fetch="select">
			<column name="ORGANIZATION_SYSTEMID" />
		</many-to-one>

$ vi Organization.standard.hbm.xml
	<class name="Organization" lazy="false" table="ORGANIZATION">

$ vi OrderProcess.standard.hbm.xml
	<class name="OrderProcess" table="ORDER_PROCESS">

/ Omdat lazy="false" zien we in de ShipmentOrderVO een Organization	, en een proxy naar een OrderProcess	,

/ 13	. 

$ vi ShipmentOrder.standard.hbm.xml

		<component name="billToPartyVO" class="com.mpobjects.oms.model.entity.VirtualParty">
			<property name="code" column="INVOICE_PARTY_ID" />
			<property name="name" column="INVOICE_NAME" />
			<property name="name2" column="INVOICE_NAME2" />
			<property name="address" column="INVOICE_ADDRESS" />
			<property name="address2" column="INVOICE_ADDRESS2" />
			<property name="city" column="INVOICE_CITY" />
			<property name="postalCode" column="INVOICE_POSTAL_CODE" />
			<property name="regionState" column="INVOICE_REGION_STATE" />
			<many-to-one name="countryVO" column="INVOICE_COUNTRY_SYSTEMID" class="com.mpobjects.oms.model.entity.country.Country" />
			<property name="contactName" column="INVOICE_CONTACT_NAME" />
			<property name="emailAddress" column="INVOICE_EMAIL_ADDRESS" />
			<property name="faxNumber" column="INVOICE_FAX_NUMBER" />
			<property name="phoneNumber" column="INVOICE_PHONE_NUMBER" />
			<property name="reference1" column="BILLTO_REFERENCE1" />
			<property name="reference2" column="BILLTO_REFERENCE2" />
			<property name="reference3" column="BILLTO_REFERENCE3" />
			<property name="reference4" column="BILLTO_REFERENCE4" />
			<property name="reference5" column="BILLTO_REFERENCE5" />
			<property name="reference6" column="BILLTO_REFERENCE6" />
		</component>

/ we zien dat de partyGroups en partyGroupsAsString NIET zijn H. mapped	, Dus deze zijn Java properties	, NIET in db,	

/ 13	. 

public class ShipmentOrderParty extends LogisticOrderParty {
/s
public abstract class LogisticOrderParty extends AbstractParty {
/s
public abstract class AbstractParty extends EntityDetailSupport implements Party {
	private Set<PartyGroupVO> partyGroups;
	private transient String partyGroupsAsString;

public class PartyGroupVO extends EnumeratedValueObject implements SoftDeletable {
	protected Set<PartyVO> parties = new HashSet<PartyVO>();


$ vi ShipmentOrderParty.standard.hbm.xml

	<class name="com.mpobjects.oms.model.entity.shipmentorderparty.ShipmentOrderParty" table="SHIPMENT_ORDER_PARTY" polymorphism="explicit">
		<many-to-one name="partyTypeGroup" class="com.mpobjects.oms.model.partytypegroup.vo.PartyTypeGroupVO" fetch="select">
			<column name="PARTY_TYPE_GROUP_SYSTEMID" />
		</many-to-one>

$ vi PartyGroup.standard.hbm.xml

	<class name="com.mpobjects.oms.model.partygroup.vo.PartyGroupVO" lazy="false" discriminator-value="PARTY_GROUP" table="PARTY_GROUP">
		<set name="parties" table="PARTY_IN_GROUP">
			<cache usage="read-write" />
			<key>
				<column name="PARTY_GROUP_SYSTEMID" />
			</key>
			<many-to-many entity-name="com.mpobjects.oms.model.party.vo.PartyVO">
				<column name="PARTY_SYSTEMID" />
			</many-to-many>
		</set>

/ 13	. 

public class ShipmentOrderVO extends LogisticsOrderVO implements CustomerStatusSupport, ReferenceSupport, Authorizable, ImportExportTrackable {
	public Collection<ShipmentOrderParty> getShipmentOrderParties() {
		return theShipmentOrderPartyList;

public class ShipmentOrderParty extends LogisticOrderParty {
	private ShipmentOrderVO shipmentOrder;

$ vi ShipmentOrder.standard.hbm.xml

		<bag name="shipmentOrderParties" cascade="all,delete-orphan">
			<cache usage="read-write" />
			<key column="SHIPMENT_ORDER_SYSTEMID" not-null="true" />
			<one-to-many class="com.mpobjects.oms.model.entity.shipmentorderparty.ShipmentOrderParty" />
		</bag>

$ vi ShipmentOrderParty.standard.hbm.xml

		<many-to-one name="shipmentOrder" class="com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO" column="SHIPMENT_ORDER_SYSTEMID" insert="false" update="false" />


/ 13	. 

/**
 * Masterdata party
 */
public class PartyVO extends AbstractParty implements SoftDeletable, BinaryContainer, MasterDataParty {
/s
public abstract class AbstractParty extends EntityDetailSupport implements Party {
	private Set<PartyGroupVO> partyGroups;
	private transient String partyGroupsAsString;

$ vi Party.standard.hbm.xml

	<class name="PartyVO" table="PARTY">
		<set name="partyGroups" table="PARTY_IN_GROUP" >
			<cache usage="read-write" />
			<key>
				<column name="PARTY_SYSTEMID" />
			</key>
			<many-to-many column="PARTY_GROUP_SYSTEMID"	class="com.mpobjects.oms.model.partygroup.vo.PartyGroupVO" />
		</set>

$ vi PartyGroup.standard.hbm.xml

	<class name="com.mpobjects.oms.model.partygroup.vo.PartyGroupVO" lazy="false" discriminator-value="PARTY_GROUP" table="PARTY_GROUP">
		<set name="parties" table="PARTY_IN_GROUP">
			<cache usage="read-write" />
			<key>
				<column name="PARTY_GROUP_SYSTEMID" />
			</key>
			<many-to-many entity-name="com.mpobjects.oms.model.party.vo.PartyVO">
				<column name="PARTY_SYSTEMID" />
			</many-to-many>
		</set>

/ 13	. 

/ we zien alleen mappings van eind classes	, dus van ShipmentOrderParty	, Party	, NIET van AbstractParty bijv, 
/ er is geen mapping van VirtualParty	, want de mapping van de virtual parties staat in de mapping van ShipmentOrderVO (met components)	,  en omdat er geen mapping is van AbstractParty	, is er geen aparte mapping van Virtual Party	,

/ 13	. 

/ we zien dat de partyGroup van een shipmentOrderParty en van een Party worden mapped naar db	, naar de party_in_group koppel table	, 
/ Van een virtual party NIET	, 

/ 	7. 


/ we create een sho	, 
/ Hoe worden de Virtual parties create	?

/ 7	. 

planning, shipment order, create
/= shipment-order-template_list

			<map:match pattern="shipment-order-template_list">
				<map:call resource="dynatablePage">
					<map:parameter name="xsp" value="xsp/shipment-order-template_list.xml"/>
					<map:parameter name="xsl" value="xsl/shipment-order-template_list.xsl"/>
				</map:call>
			</map:match>

$ less xsp/shipment-order-template_list.xml

            myTable.setQuery(
            "SELECT * FROM SHIPMENT_ORDER " +
            "WHERE IS_TEMPLATE = 1 AND IS_DELETED = 0 AND ORGANIZATION_SYSTEMID IN {USER_ORGANIZATIONS} " +

/ we zien in postgres log	,
LOG:  execute <unnamed>: SELECT * FROM SHIPMENT_ORDER WHERE IS_TEMPLATE = 1 AND IS_DELETED = 0 AND ORGANIZATION_SYSTEMID IN
 (0,500,1020,1010,1) limit $1

  <filter-param name="shipment-order-create-url" defaultValue="shipment-order_create"/>
    <xsp:logic>
	       String myShipmentOrderCreateURL = "";  
            myShipmentOrderCreateURL = request.getParameter("shipment-order-create-url");
            if (StringUtils.isEmpty(myShipmentOrderCreateURL)){
                myShipmentOrderCreateURL = "shipment-order_create";


$ less xsp/shipment-order-template_list.xsl

/ copy link	,
           <xsl:attribute name="href"><xsl:text>shipment-order-template_copy?systemid=</xsl:text><xsl:value-of 
                select="./column[@name='SYSTEMID']"/><xsl:text>&amp;base_sessionLevelOffset=1</xsl:text>

/ edit link	,
                   <xsl:text>shipment-order-template_edit?systemid=</xsl:text><xsl:value-of 
                    select="./column[@name='SYSTEMID']"/><xsl:text>&amp;base_sessionLevelOffset=1</xsl:text>

/ delete link	,
                    <xsl:text>shipment-order-template_delete?systemid=</xsl:text><xsl:value-of 
                    select="./column[@name='SYSTEMID']"/><xsl:text>&amp;base_sessionLevelOffset=1</xsl:text>

/ create order link	,
           <xsl:attribute name="href"><xsl:value-of select="//shipment-order-create-url"></xsl:value-of><xsl:text>?systemid=</xsl:text><xsl:value-of select="./column[@name='SYSTEMID']"/><xsl:text>&amp;base_sessionLevelOffset=1</xsl:text>

/ 2 buttons onderin	,

            	<xsl:text>location.href='shipment-order-template_create?systemid=0&amp;base_sessionLevelOffset=1'</xsl:text>

        		<xsl:value-of select="//shipment-order-create-url"></xsl:value-of>
         		<xsl:text>?systemid=0&amp;base_sessionLevelOffset=1'</xsl:text>



/ 7	. 

/ in pnllogistics7a	, 
/ pharma tpl	, 

requested productcode: 3606
customer reference: test pct-1234 			/ bijv	,
ship_from	: 	2910-3--BE
ship_to		:	4231DJ-118--NL
bill_to		:	9105522
Save
/ create shi	, C, 3S2016040701
Save shipment item	,

$ less oms-sitemap.xmap
			<map:action logger="shipmentorder" name="shipmentOrderCreate" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderCreateAction"/>
			<map:match pattern="shipment-order_create">
				<map:act type="shipmentOrderCreate"/>
				<map:select type="session-attribute">
					<map:parameter name="attribute-name" value="builder"/>
					<map:when test="jsp">
						<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order_edit.jsp"/>
					</map:when>
					<map:otherwise>
						<map:redirect-to uri="../wicket?module=oms&amp;wicketpage=shipmentorder.edit.ShipmentOrderEditSelectionPage"/>
					</map:otherwise>			
				</map:select>
			</map:match>

/ we zien in HTML	, op de 'Create order' button	,
<a href="shipment-order_create?systemid=26788426&amp;base_sessionLevelOffset=1">Create order</a>

/ 26788426 is de sho tpl pharma	,
pnllogistics7a=# select shipment_order_id,is_template from shipment_order where system_id=26788426;
-[ RECORD 1 ]-----+-------
shipment_order_id | pharma
is_template       | 1

/ click de link in HTML in devtools, dus niet op het scherm	, dan hetzelfde als right click de link op het scherm	, we zien een nieuwe tab met url	,
http://localhost:8080/tms/oms/shipment-order_create?systemid=26788426&base_sessionLevelOffset=1
/ Maar we zien dan niet in devtools Network	,
/ TODO

/s
ShipmentOrderCreateAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
			if (getRequest().getAttribute("requestManager") != null) {
				setRequestManager((RequestManager) getRequest().getAttribute("requestManager"));
getRequestManager().getLevel()		4
				Map myMap = act();
/s
ShipmentOrderCreateAction.act() line: 44	

		getLog().debug("In ShipmentOrderCreateAction");
		Request myRequest = getRequest();
		int mySystemId = getSystemIdFromRequest();
26788426
/= sho tpl	,
/ er zijn 2 request params	, systemId en base_sessionLevelOffset	,

			myTemplate = MpoBeanFactory.getBean(ShipmentOrderDao.class).getBySystemId(mySystemId);

/ we zien dat er al een (proxy naar de ) orderProcess is , de orgnization	, 	, de proxy naar de theBillToParty	, theFromParty	, theToParty	,
/ Deze zien we allemaal	, als we 'Create order' hebben click	, want we komen in shipment-order_edit.jsp	, en we zien de pharma shipment order template	,

/ 13	. 

myTemplate	com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO  (id=23978)	
	actionApprovalStatus	com.mpobjects.oms.model.shipmentorder.vo.ApprovalStatus  (id=21495)	
	actualServiceLevelVO	com.mpobjects.oms.model.entity.ShipmentServiceLevelVO_$$_javassist_174  (id=23979)	
	airport	null	
	approvalStatus	com.mpobjects.oms.model.shipmentorder.vo.ApprovalStatus  (id=21495)	
	approvalTemplate	null	
	approvedBy	null	
	approvedOnDate	null	
	approvePostcalculation	false	
	approvePrecalculation	false	
	authorizationCodes	null	
	billOfLadingNr	null	
	calculateVolume	java.lang.Boolean  (id=21497)	
	calculateWeight	java.lang.Boolean  (id=21497)	
	calculationLog	null	
	cashOnDeliveryDone	false	
	chargeTimeWindowYn	false	
	consolidationKey	null	
	cost	null	
	costCurrency	null	
	costCurrencySystemId	0	
	costMethod	null	
	currencyDAO	null	
	customerContractSystemId	null	
	customerStatus	null	
	dangerousGoodsYn	false	
	dao	null	
	deleted	false	
	emission	null	
	entityDetails	org.hibernate.collection.PersistentMap  (id=23980)	
	entityGroup	null	
	fileObjects	java.util.ArrayList  (id=23981)	
	genericCarrierShipmentOrderData	null	
	importExportInfo	null	
	incotermsReference	"" (id=21982)	
	instructionList	org.hibernate.collection.PersistentMap  (id=23982)	
	isCalculateEnabled	null	
	isShipmentOrderCostActual	false	
	lastInstanceDate	null	
	lastUpdate	java.sql.Timestamp  (id=23983)	
	lockedByProcess	false	
	lockPostcalculation	false	
	lockPrecalculation	false	
	myIterator	null	
	notifyTo	"" (id=21988)	
	orderProcess	com.mpobjects.oms.model.entity.orderprocess.OrderProcess_$$_javassist_137  (id=23984)	
		_filter_signature	(id=23343)	
		_methods_	java.lang.reflect.Method[92]  (id=23344)	
		code	"" (id=21498)	
		deleted	false	
		description	"" (id=21498)	
		handler	org.hibernate.proxy.pojo.javassist.JavassistLazyInitializer  (id=23987)						
			componentIdType	null	
			constructed	true	
			entityName	"com.mpobjects.oms.model.entity.orderprocess.OrderProcess" (id=24139)	
			getIdentifierMethod	java.lang.reflect.Method  (id=24140)	
			id	java.lang.Integer  (id=24141)	
			initialized	true	
			interfaces	java.lang.Class[1]  (id=24142)	
			overridesEquals	true	
			persistentClass	java.lang.Class (com.mpobjects.oms.model.entity.orderprocess.OrderProcess) (id=15235)	
			readOnly	false	
			readOnlyBeforeAttachedToSession	null	
			replacement	null	
			session	org.hibernate.impl.SessionImpl  (id=24143)	
			setIdentifierMethod	java.lang.reflect.Method  (id=24144)	
			target	com.mpobjects.oms.model.entity.orderprocess.OrderProcess  (id=24357)	
			unwrap	false	
		organization	null	
		performanceMonitorService	null	
		systemId	0	
	organization	com.mpobjects.oms.model.entity.organization.Organization  (id=23985)	
		automRateCalc	java.lang.Boolean  (id=21992)	
		code	"PNL-CARGO" (id=21993)	
		dateTimeZone	null	
		deleted	false	
		description	"PostNL Cargo" (id=21995)	
		ediIdentifier	null	
		isNewRecord	false	
		mappedProperties	java.util.HashMap  (id=23998)	
		organizationGroup	null	
		performanceMonitorService	null	
		propertiesValues	org.hibernate.collection.PersistentSet  (id=24000)	
		sequence	0	
		systemId	500	
	payWeight	null	
	performanceMonitorService	null	
	postCalcApprovedBy	null	
	postCalcApprovedOnDate	null	
	preferedPathTemplate	null	
	price	null	
	priceMethod	com.mpobjects.oms.model.currency.vo.TotalAmountCalculationMethod  (id=21513)	
	ratecalcMd5Hash	null	
	recurring	false	
	requestedServiceLevelVO	null	
	schedule	null	
	scheduleDescription	null	
	scheduleXml	null	
	screenId	null	
	shipmentOrderCostPartList	org.hibernate.collection.PersistentSortedSet  (id=24001)	
	shipmentOrderTemplate	null	
	shoParties	java.util.HashSet  (id=24002)	
	systemId	26788426	
	temporary	false	
	theActualTotalColli	null	
	theActualTotalLoadingMeters	null	
	theActualTotalVolumeM3	null	
	theActualTotalWeightKg	null	
	theAdditionalInfoMap	java.util.HashMap  (id=24003)	
	theAltValueCurrencySystemId	null	
	theAltValueCurrencyVO	null	
	theAssignee	null	
	theBackupSheetReportName	"" (id=21522)	
	theBillToParty	com.mpobjects.oms.model.entity.VirtualParty  (id=24004)	
		address	"Weijinksweg 18" (id=22530)	
		address2	"" (id=22531)	
		city	"HENGELO OV" (id=22532)	
		contactName	"Daniel Spijkers" (id=22533)	
		countryVO	com.mpobjects.oms.model.entity.country.Country_$$_javassist_65  (id=24008)	
		currencyDAO	null	
		dao	null	
		emailAddress	"" (id=22535)	
		entityDetails	java.util.HashMap  (id=24146)	
		faxNumber	"" (id=22537)	
		latitude	null	
		longitude	null	
		manifestReport	"" (id=21498)	
		name	"DS Internet Trading" (id=22538)	
		name2	"" (id=22539)	
		organization	null	
		partyGroups	java.util.HashSet  (id=24149)	
[]
		partyGroupsAsString	null	
		partyId	"10423181" (id=22541)	
		partyType	null	
		performanceMonitorService	null	
		phoneNumber	"0748526448" (id=22542)	
		postalCode	"7558PL" (id=22544)	
		prenotifyCarcon	false	
		qualifier	"" (id=21498)	
		reference1	"" (id=22545)	
		reference2	"" (id=22546)	
		reference3	"" (id=22568)	
		reference4	"" (id=22586)	
		reference5	"" (id=22587)	
		reference6	"" (id=22588)	
		regionState	"" (id=22589)	
		scheduleVo	null	
		serviceOrderUrlExpression	"" (id=21498)	
		serviceRemarks	"" (id=21498)	
		systemId	0	
		theFormattedEntity	null	
		timeZone	null	
	theCashOnDelivery	null	
	theCashOnDeliveryCurrencyVO	null	
	theCreatedBy	com.mpobjects.oms.model.user.Resource  (id=24005)	
	theCustomerOrderNumber	"" (id=22526)	
	theDateSetVO	com.mpobjects.oms.model.shipmentorder.vo.DateSetVO  (id=24006)	
	theEmployeeResponsibleParty	com.mpobjects.oms.model.entity.VirtualParty  (id=24007)	
	theFormattedEntity	null	
	theFormattedEntity	null	
	theFromPartyVO	com.mpobjects.oms.model.entity.VirtualParty  (id=24163)	
		address	"Weijinksweg" (id=24174)	
		address2	"18" (id=24175)	
		city	"Hengelo" (id=24176)	
		contactName	"" (id=24177)	
		countryVO	com.mpobjects.oms.model.entity.country.Country_$$_javassist_65  (id=24008)	
		currencyDAO	null	
		dao	null	
		emailAddress	"" (id=24178)	
		entityDetails	java.util.HashMap  (id=24179)	
		faxNumber	"" (id=24180)	
		latitude	null	
		longitude	null	
		manifestReport	"" (id=21498)	
		name	"DS Internet Trading" (id=24182)	
		name2	"" (id=24184)	
		organization	null	
		partyGroups	java.util.HashSet  (id=24186)	
[]
		partyGroupsAsString	null	
		partyId	"" (id=24187)	
		partyType	null	
		performanceMonitorService	null	
		phoneNumber	"" (id=24190)	
		postalCode	"7558PL" (id=24191)	
		prenotifyCarcon	false	
		qualifier	"" (id=21498)	
		reference1	"3606" (id=24194)	
		reference2	"gse pharma" (id=24195)	
		reference3	"" (id=24197)	
		reference4	"" (id=24198)	
		reference5	"" (id=24199)	
		reference6	"" (id=24201)	
		regionState	"" (id=24202)	
		scheduleVo	null	
		serviceOrderUrlExpression	"" (id=21498)	
		serviceRemarks	"" (id=21498)	
		systemId	0	
		theFormattedEntity	null	
		timeZone	null	
	theHoldDescription	"" (id=21620)	
	theHoldStatus	null	
	theIncoTermVO	com.mpobjects.oms.model.incoterm.vo.IncoTermVO_$$_javassist_5  (id=24165)	
	theInstructionGroup	null	
	theInstructionList	null	
	theNotUpdatableByInterface	false	
	theOrderStatusVO	com.mpobjects.oms.model.orderstatus.vo.OrderStatusVO_$$_javassist_162  (id=24168)	
	theOriginalSystemEntryDate	java.sql.Timestamp  (id=24171)	
	theOverrideAddressValidation	false	
	thePartyTypeGroupList	null	
	thePreferedPartyVO	null	
	thePrice	null	
	thePriceCurrencySystemid	null	
	thePriceCurrencyVO	null	
	theProductItemList	org.hibernate.collection.PersistentSortedSet  (id=24208)	
	theReasonCode	null	
	theRecalculateActualsFlag	false	
	theRecalculateFlag	false	
	theReference1	"" (id=24211)	
	theReference10	"" (id=24212)	
	theReference2	"" (id=24213)	
	theReference3	"" (id=24215)	
	theReference4	"" (id=24216)	
	theReference5	"" (id=24218)	
	theReference6	"" (id=24219)	
	theReference7	"" (id=24221)	
	theReference8	"" (id=24222)	
	theReference9	"" (id=24224)	
	theRemarks	"" (id=24225)	
	theRemarks2	"" (id=24226)	
	theRequestedAltTotalValue	null	
	theRequestedTotalColli	null	
	theRequestedTotalItems	null	
	theRequestedTotalLoadingMeters	null	
	theRequestedTotalValue	null	
	theRequestedTotalVolumeM3	null	
	theRequestedTotalWeightKg	null	
	theReturnCreated	false	
	theSalesOrganization	"" (id=24232)	
	theServiceActionList	org.hibernate.collection.PersistentSortedSet  (id=24233)	
	theShipmentItemList	org.hibernate.collection.PersistentSortedSet  (id=24234)	
	theShipmentOrderId	"pharma" (id=24236)	
	theShipmentOrderPartyList	org.hibernate.collection.PersistentBag  (id=24237)	
	theShipmentOrderPricePartList	org.hibernate.collection.PersistentSortedSet  (id=24239)	
	theShipmentType	null	
	theSyncBillToFlag	null	
	theSyncEmployeeResponsibleFlag	null	
	theSyncFromFlag	null	
	theSyncToFlag	null	
	theSystemEntryDate	java.sql.Timestamp  (id=24242)	
	theTemplateFlag	true	
	theToPartyVO	com.mpobjects.oms.model.entity.VirtualParty  (id=24244)	
		address	"Demo Street" (id=24247)	
		address2	"1" (id=24249)	
		city	"rotterdam" (id=24250)	
		contactName	"" (id=24251)	
		countryVO	com.mpobjects.oms.model.entity.country.Country_$$_javassist_65  (id=24008)	
		currencyDAO	null	
		dao	null	
		emailAddress	"" (id=24252)	
		entityDetails	java.util.HashMap  (id=24253)	
		faxNumber	"" (id=24254)	
		latitude	null	
		longitude	null	
		manifestReport	"" (id=21498)	
		name	"Demo-3" (id=24255)	
		name2	"" (id=24256)	
		organization	null	
		partyGroups	java.util.HashSet  (id=24257)	
[]
		partyGroupsAsString	null	
		partyId	"" (id=24259)	
		partyType	null	
		performanceMonitorService	null	
		phoneNumber	"" (id=24261)	
		postalCode	"3013ak" (id=24262)	
		prenotifyCarcon	false	
		qualifier	"" (id=21498)	
		reference1	"" (id=24263)	
		reference2	"" (id=24264)	
		reference3	"" (id=24265)	
		reference4	"" (id=24268)	
		reference5	"" (id=24269)	
		reference6	"" (id=24270)	
		regionState	"" (id=24271)	
		scheduleVo	null	
		serviceOrderUrlExpression	"" (id=21498)	
		serviceRemarks	"" (id=21498)	
		systemId	0	
		theFormattedEntity	null	
		timeZone	null	
	theValueCurrencyVO	null	


/ 13	. 


/ Deze 3 virtual parties komen uit de sho tpl	, waar ze alle 3 in zijn	,

/ Als we de sho tpl zien in shipment-order_edit.jsp	, en we select een andere billto party	, dan select we WH master data party	, en dan 9105522 zit in 2 party groups	, dus is WH partyGroups =[999, RETURN_LABEL]	,

/ we gaan verder in de code	,
ShipmentOrderCreateAction.act() line: 53	
		ShipmentOrderVO myVO = MpoBeanFactory.getBean(ShipmentOrderService.class).create(myTemplate);
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).create(ShipmentOrderVO, boolean) line: 568	
			myVO = aShipmentOrderTemplate.copy();
/ Inderdaad	, alles wordt copy	,
			copyShipmentOrderParties(aShipmentOrderTemplate, myVO);
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).copyShipmentOrderParties(ShipmentOrderVO, ShipmentOrderVO) line: 531	

/ Deze zien we naast de bill to party	, 

			Collection<ShipmentOrderParty> myShipmentOrderParties = anOriginal.getShipmentOrderParties();
/=return theShipmentOrderPartyList;

			if (myShipmentOrderParties != null) {
				for (ShipmentOrderParty myParty : myShipmentOrderParties) {
party=
com.mpobjects.oms.model.entity.shipmentorderparty.ShipmentOrderParty@a6c5ff7[shipmentOrder=ShipmentOrder: pharma(SystemId:26788426; Org:PNL-CARGO),name=,partyTypeGroup=theSystemId: 26681486, PartyTypeGroup :DistributionDepot]
party=
com.mpobjects.oms.model.entity.shipmentorderparty.ShipmentOrderParty@62b0fd56[shipmentOrder=ShipmentOrder: (SystemId:0; Org:PNL-CARGO),name=,partyTypeGroup=theSystemId: 26681485, PartyTypeGroup :CollectionDepot]]
/ deze shipmentorderparty's zijn bijna helemaal leeg ,
/ Dus ook partyGroups=[]	,  partyGroupAsString=null	,
/ Ze hebben wel een systemId	, 26788427	, partyTypeGroup,	  
/ TODO
					ShipmentOrderParty myNewParty = new ShipmentOrderParty();
					BeanUtils.copyProperties(myNewParty, myParty);
					myNewParty.setSystemId(ValueObject.VOLATILE_SYSTEM_ID);
					myNewParty.setShipmentOrder(aNewShipmentOrder);
					aNewShipmentOrder.addShipmentOrderParty(myNewParty);

/t
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).create(ShipmentOrderVO, boolean) line: 570	
			myVO = aShipmentOrderTemplate.copy();
			copyShipmentOrderParties(aShipmentOrderTemplate, myVO);
/d

myVO	com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO  (id=19241)	
	theBillToParty	com.mpobjects.oms.model.entity.VirtualParty  (id=19374)	
		partyGroups	java.util.HashSet  (id=19468)	
[]
		partyGroupsAsString	null	
		partyId	"10423181" (id=19471)	
		partyType	null	
	shoParties	java.util.HashSet  (id=19359)	
[]
	theShipmentOrderPartyList	java.util.ArrayList  (id=19400)	
[com.mpobjects.oms.model.entity.shipmentorderparty.ShipmentOrderParty@dead312[shipmentOrder=ShipmentOrder: (SystemId:0; Org:PNL-CARGO),name=,partyTypeGroup=theSystemId: 26681486PartyTypeGroup :DistributionDepot], 
com.mpobjects.oms.model.entity.shipmentorderparty.ShipmentOrderParty@62b0fd56[shipmentOrder=ShipmentOrder: (SystemId:0; Org:PNL-CARGO),name=,partyTypeGroup=theSystemId: 26681485PartyTypeGroup :CollectionDepot]]



			EntityDetailUtil.copyCorrespondingEntityDetails(aShipmentOrderTemplate, myVO);
/ TODO
			myVO.setSystemId(ValueObject.VOLATILE_SYSTEM_ID);
			myVO.setShipmentOrderId("");
			myVO.setShipmentOrderTemplate(aShipmentOrderTemplate);
			myVO.setTemplate(isTemplate);

		addShipmentOrderParties(myVO);
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).addShipmentOrderParties(ShipmentOrderVO) line: 295	

			List<PartyTypeGroupVO> myPartyGroupsToCreate = new ArrayList<PartyTypeGroupVO>();
			myPartyGroupsToCreate.addAll(MpoBeanFactory.getBean(PartyTypeGroupDAO.class).getShowOnShipmentOrder());
[theSystemId: 26681486, PartyTypeGroup :DistributionDepot, 
theSystemId: 26681485, PartyTypeGroup :CollectionDepot]
/=
select this_.SYSTEM_ID as SYSTEM1_159_0_, this_.PARTY_TYPE_GROUP as PARTY2_159_0_, this_.IS_DELETED as IS3_159_0_, this_.DESCRIPTION as DESCRIPT4_159_0_, this_.SHOW_ON_SHO as SHOW5_159_0_, this_.SHOW_ON_SO as SHOW6_159_0_, this_.SHOW_ON_CO as SHOW7_159_0_, this_.SHOW_ON_COL as SHOW8_159_0_, this_.IS_SYSTEM as IS9_159_0_ 
from PARTY_TYPE_GROUP this_ 
where this_.SHOW_ON_SHO=? 
and this_.IS_SYSTEM=? 
and this_.IS_DELETED=?" (id=24722)	

/ Doet query in db	, en kijkt welke party type groups er nog niet zijn in de shipment order	, die er wel zou moeten zijn	, omdat SHOW_ON_SHO=1	,  
/ Van iedere zulke party group maakt hij een shipmentorderparty 	, en zet  die op de shipment order	, 
/ bij ons is er niet zo een	, we hebben ze al	,

			for (ShipmentOrderParty myParty : aShipmentOrder.getShipmentOrderParties()) {
myParty=
com.mpobjects.oms.model.entity.shipmentorderparty.ShipmentOrderParty@dead312[shipmentOrder=ShipmentOrder: (SystemId:0; Org:PNL-CARGO),name=,partyTypeGroup=theSystemId: 26681486, PartyTypeGroup :DistributionDepot]
				PartyTypeGroupVO myPartyTypeGroupVO = myParty.getPartyTypeGroup();
theSystemId: 26681486, PartyTypeGroup :DistributionDepot
				myPartyGroupsToCreate.remove(myPartyTypeGroupVO);
[theSystemId: 26681485PartyTypeGroup :CollectionDepot]
/ 1 over	,
/ volgende,	
			for (ShipmentOrderParty myParty : aShipmentOrder.getShipmentOrderParties()) {
				PartyTypeGroupVO myPartyTypeGroupVO = myParty.getPartyTypeGroup();
				myPartyGroupsToCreate.remove(myPartyTypeGroupVO);
[]
			for (PartyTypeGroupVO myGroup : myPartyGroupsToCreate) {
/ GEEN
				ShipmentOrderParty myShipmentOrderParty = new ShipmentOrderParty();
/ NIET
				myShipmentOrderParty.setPartyTypeGroup(myGroup);
/ NIET
				aShipmentOrder.addShipmentOrderParty(myShipmentOrderParty);
/ NIET
/t
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).create(ShipmentOrderVO, boolean) line: 601	
		addShipmentOrderParties(myVO);
/d
		addShipmentOrderParties(myVO);
		MpoBeanFactory.getBean(EntityDetailService.class).initialize(myVO);
		myVO.setCreatedBy(myResource);
		// TR: merge
		// DateTimeZone myTimeZone = getActiveResource().getActiveOrganization().getTimeZone();
		// myVO.setSystemEntryDate(TimeZoneUtil.changeToTimeZone(DateTimeZone.forID(myTimeZone.getID()), new Date()));
		myVO.setSystemEntryDate(timeService.getPresentDate());
		myVO.setOriginalSystemEntryDate(myVO.getSystemEntryDate());
		myVO.setOrderStatusVO(orderStatusDAO.getByCode(OrderStatusVO.STATUS_UNPLANNED));

		ScheduleLineService myScheduleLineService = MpoBeanFactory.getBean(ScheduleLineService.class);

		ShipmentServiceLevelVO myServiceLevel = myVO.getActualServiceLevelVO();

		if (myServiceLevel != null && myServiceLevel.getScheduleVO() != null) {
/ Hieronder allemaal niet	,

		return myVO;
/t
ShipmentOrderCreateAction.act() line: 55	
		ShipmentOrderVO myVO = MpoBeanFactory.getBean(ShipmentOrderService.class).create(myTemplate);
/d
/ de rest is session, attributes, ...

/ Einde CREATE SHIPMENT ORDER

/ CHANGE SHIP TO, SHIP FROM, BILL TO PARTIES ON SHIPMENT ORDER 

/ 7	. 

/ Met vergrootglas kiezen we een masterdata party	, maar het wordt een virtual party	, 
/ Hoe gaat dat	?

/ 7	. 

/ vergrootglas	,

$ vi shipment-order_edit.jsp

			<mpo:tab name="shipFrom">
				<tmstags:shipfrom formid="shipmentorder" />
			</mpo:tab>
			<mpo:tab name="shipTo">
				<tmstags:shipto formid="shipmentorder" />
			</mpo:tab>
			<mpo:tab name="billTo">
				<tmstags:sho-billto />
			</mpo:tab>

$ vi shipto.tag
				<mpo:listField name="toParty" type="party" filter="${cf:property('oms', filterPropertyKey, 'DELIVERY')}" useEmptyLogic="true" populatePrefix="to" />

$ vi ListFieldTag.java
	protected void appendInputPart(StringBuffer aBuffer) {
			String myOnClickDef = ApplicationPropertyManager.getInstance().getModuleApplicationProperty("core",
					"listinput." + theType.toLowerCase() + ".selector.onclick");
			String myFieldLength = ApplicationPropertyManager.getInstance().getModuleApplicationProperty("core",
					"listinput." + theType.toLowerCase() + ".selector.view.size", "5");

				aBuffer.append("<button type=\"button\" class=\"small\" href=\"#\"");
				aBuffer.append(" id=\"" + getFormFieldName() + "_href\"");
				aBuffer.append(" onclick=\"" + myOnClickUrl + "\"");
				aBuffer.append(">");
				aBuffer.append("<img src=\"../lookandfeel/images/icons/lookup.png\"");
				aBuffer.append(" border=\"0\"");
				aBuffer.append(" id=\"" + getFormFieldName() + "_icon\"");
				aBuffer.append(" class=\"selector_icon\"");
				aBuffer.append(")/>"); //

				aBuffer.append("</button>");


$ vi oms.properties
module.core.listinput.party.selector.onclick = javascript:PartySelector({partyTypeGroup: '[filter]', contextType: '[parentType]', contextSystemId: '[parentSystemId]', fieldId: '[name]', populatePrefix: '[populatePrefix]' }); return false;
module.core.listinput.party.selector.view.size = 15

/ we zien in HTML	,
<button type="button" class="small" href="#" id="toParty_href" onclick="javascript:PartySelector({partyTypeGroup: 'DELIVERY', contextType: 'ShipmentOrder', contextSystemId: '0', fieldId: 'toParty', populatePrefix: 'to' }); return false;"><img src="../lookandfeel/images/icons/lookup.png" border="0" id="toParty_icon" class="selector_icon" )=""></button>

/ 7	. 

/ we click vergrootglas op Ship from	,
/ we vallen in JS op het main window	,
/s
$ vi party-selector.js
function PartySelector(opts) {

opts: Object
	contextSystemId: "26988637"
	contextType: "ShipmentOrder"
	fieldId: "fromParty"
	partyTypeGroup: "COLLECTION"
	populatePrefix: "from"

	var options = "";
	for (var prop in opts) {
		options += "&"+prop+"="+encodeURI(opts[prop]);
	}
options= "&partyTypeGroup=COLLECTION&contextType=ShipmentOrder&contextSystemId=26988637&fieldId=fromParty&populatePrefix=from"
/ 26988637 is de sho	,

	selectorWindow = gloPageRequestObj.getScreenContainer().openWindowOnCursor("../wicket/?module=oms&wicketpage=party.LegacyPartySelect"+options, "PartyPicker", 1010, 550,true);
}
/ we zien nu een 2de window	, party window, geef hierop F12	,

/ we select met filter ... 
/ en click edit button op  de enigste party die overblijft	,
/ of use filter niet , en kies er een, en click de edit, button	,
/ we vallen in JS op het party window	,
/s
$ vi wicket-ajax.js
function wicketSubmitFormById(formId, url, submitButton, successHandler, failureHandler, precondition, channel) {
	var call = new Wicket.Ajax.Call(url, successHandler, failureHandler, channel);
	
	if (typeof(precondition) != "undefined" && precondition != null) {
		call.request.precondition = precondition;
	}
	
	return call.submitFormById(formId, submitButton);
} 
/c
/ we komen op de server	, in Java dus	, 
/s
AjaxFallbackButton$1.onSubmit(AjaxRequestTarget) line: 74	
/=
	public AjaxFallbackButton(String id, IModel<String> model, Form<?> form)
	{
		add(new AjaxFormSubmitBehavior(form, "onclick")
		{
			@Override
			protected void onSubmit(AjaxRequestTarget target)
			{
->				AjaxFallbackButton.this.onSubmit(target, AjaxFallbackButton.this.getForm());
/s
EntityActionAjaxButton$1.onSubmit(AjaxRequestTarget, Form<?>) line: 56	
/=
public abstract class EntityActionAjaxButton<T extends EntityInterface> extends EntityActionButton<T> {
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new AjaxFallbackButton(aId, null) {
			protected void onSubmit(AjaxRequestTarget aTarget, Form<?> aForm) {
->				EntityActionAjaxButton.this.onSubmit(this, aTarget, aModel);
/s
LegacyPartySelect$1.onSubmit(Button, AjaxRequestTarget, IModel<MasterDataParty>) line: 107	
/=
public class LegacyPartySelect extends AbstractMasterDataPartySelectPage {
	protected List<EntityAction<MasterDataParty>> getActions() {
		actions.add(new EntityActionAjaxButton<MasterDataParty>("ok") {
			protected void onSubmit(Button aButton, AjaxRequestTarget aTarget, IModel<MasterDataParty> aSelection) {
->				aTarget.appendJavascript("PopulatePartyFields('" + fieldId + "', '" + populatePrefix + "', " + generatePartyJson(aSelection.getObject()) + ");");

aSelection	com.mpobjects.view.wicket.util.EntityDetachableModel  (id=20803)	
	attached	false	
	attachedVolatile	false	
	dao	com.mpobjects.view.wicket.util.BeanWrapper  (id=21307)	
com.mpobjects.view.wicket.util.BeanWrapper@3ea0fbfd[type=interface com.mpobjects.oms.dao.PartyDAO,beanName=<null>]
	entity	null	
	systemId	26858751	
/ Klopt	, dit is een party	, die we select hebben	,


pnllogistics7a=# select count(*)from party where system_id=26858751;
-[ RECORD 1 ]
count | 1

/s
LegacyPartySelect.generatePartyJson(MasterDataParty) line: 61	
/=
	protected String generatePartyJson(MasterDataParty aParty) {

this	com.mpobjects.oms.view.wicket.party.LegacyPartySelect  (id=23149)	
aParty	com.mpobjects.oms.model.party.vo.PartyVO_$$_javassist_21  (id=23150)	
	handler	org.hibernate.proxy.pojo.javassist.JavassistLazyInitializer  (id=23153)	
		target	com.mpobjects.oms.model.party.vo.PartyVO  (id=23167)	
			partyGroups	org.hibernate.collection.PersistentSet  (id=23186)	
[com.mpobjects.oms.model.partygroup.vo.PartyGroupVO@648090e[RETURN_LABEL,Customers for which a label must be created when a return order is created.], 
com.mpobjects.oms.model.partygroup.vo.PartyGroupVO@120ad96b[999,Klantgroep 999 Cargo totaal]]
			partyGroupsAsString	null	
/ TODO
			partyId	"9105522" (id=23187)	

/ PARTY TO VIRTUAL PARTY
/ VIRTUAL PARTY FROM PARTY

		ObjectMapper mapper = new ObjectMapper();
		try {
			Map<String, String> data = new HashMap<String, String>();
			data.put("PartyId", aParty.getPartyId());
			data.put("Name", StringUtils.defaultString(aParty.getName()));
			data.put("Name2", StringUtils.defaultString(aParty.getName2()));
			data.put("Address", StringUtils.defaultString(aParty.getAddress()));
			data.put("Address2", StringUtils.defaultString(aParty.getAddress2()));
			data.put("City", StringUtils.defaultString(aParty.getCity()));
			data.put("PostalCode", StringUtils.defaultString(aParty.getPostalCode()));
			data.put("RegionState", StringUtils.defaultString(aParty.getRegionState()));
			data.put("Country", StringUtils.defaultString(aParty.getCountryCode()));
			data.put("PhoneNumber", StringUtils.defaultString(aParty.getPhoneNumber()));
			data.put("FaxNumber", StringUtils.defaultString(aParty.getFaxNumber()));
			data.put("EmailAddress", StringUtils.defaultString(aParty.getEmailAddress()));
			data.put("ContactName", StringUtils.defaultString(aParty.getContactName()));
			data.put("TimeZone", StringUtils.defaultString(aParty.getTimeZoneId()));
			data.put("Reference1", StringUtils.defaultString(aParty.getReference1()));
			data.put("Reference2", StringUtils.defaultString(aParty.getReference2()));
			data.put("Reference3", StringUtils.defaultString(aParty.getReference3()));
			data.put("Reference4", StringUtils.defaultString(aParty.getReference4()));
			data.put("Reference5", StringUtils.defaultString(aParty.getReference5()));
			return mapper.writeValueAsString(data);


/ Intermezzo

$ vi LegacyPartySelect.js
///////////////////////////////
/ Deze zien we in JS op het party fromwindow	, niet in de oorspronkelijke window	, 

ship_from	: 	2910-3--BE
ship_to		:	4231DJ-118--NL
bill_to		:	9105522

/ Einde Intermezzo

/we vallen weer in JS in het party window	,
$ vi LegacyPartySelect.js
/s
PopulatePartyFields('fromParty', 'from', {"PartyId":"2910-3--BE","ContactName":"","PhoneNumber":"","Country":"BE","City":"ESSEN","Name":"ELEKTRON BVBA","RegionState":"","PostalCode":"2910","Reference1":"","Reference2":"","Address2":"3","FaxNumber":"","Address":"PEEPOLDERLAAN","Reference5":"","EmailAddress":"","Reference3":"","Reference4":"","TimeZone":"","Name2":""});
/s
PopulatePartyFields (LegacyPartySelect.js:5)
/=
PopulatePartyFields = function(partyField, prefix, data) {
partyField: "fromParty"
prefix: "from"
data: Object
	Address: "PEEPOLDERLAAN"
	Address2: "3"
	City: "ESSEN"
	ContactName: ""
	Country: "BE"
	EmailAddress: ""
	FaxNumber: ""
	Name: "ELEKTRON BVBA"
	Name2: ""
	PartyId: "2910-3--BE"
	PhoneNumber: ""
	PostalCode: "2910"
	Reference1: ""
	Reference2: ""
	Reference3: ""
	Reference4: ""
	Reference5: ""
	RegionState: ""
	TimeZone: ""

	window.opener.populatePartyField(partyField, data['PartyId']);
	if (prefix != '') {
		for (var prop in data) {
			console.log('Setting value for '+(prefix + prop)+' to: '+data[prop]);
			window.opener.populatePartyField(prefix + prop, data[prop]);
		}
	}
/ Fct calls op populatePartyField in JS in main window	,

/ we vallen in JS in main window	,
/s
$ vi party-selector.js
function populatePartyField(aFieldName, aValue){
	if (aFieldName == '') {
	    return;
    }
	var myField = document.getElementById(aFieldName);
	if (myField) {
		DhtmlUtils.setInputValue(myField, StringUtils.decodeHTMLEntities(aValue));
	}
}
/ sets fields in DOM	, in eerste instantie geleverd door JSP shipfrom.tag	, 

/ uiteindelijk 	,
/ Calls PopulatePartyField op fromParty	, fromPartyId, fromContactName, ..., fromCity	, ...
/ Dit zijn allemaal field op shipfrom.tag	,l

				<mpo:listField name="fromParty" type="party" filter="COLLECTION" useEmptyLogic="true" populatePrefix="from" />
				<mpo:setFormVO valueObject="${formVO.fromPartyVO}" prefix="from">
				<mpo:field name="name" required="true" />
				<mpo:field languageKey="shipfrom.name2" name="name2" overRideable="true" />
				<mpo:field name="address" overRideable="true"/>
				<mpo:field name="address2" overRideable="true"/>
				<mpo:field name="city" overRideable="true"/>
				<mpo:field name="postalCode" size="10" overRideable="true"/>
/ Let op prefix "from"	, 



/ Einde CHANGE SHIP TO, SHIP FROM, BILL TO PARTIES ON SHIPMENT ORDER 

/ CREATE PARTY

/ configuration, plaaning, parties
PartyListPage

/ Intermezzo

/ we kijken naar de edit	, delete buttons op een row Party in de list	,

/ In PartyListPage worden de RowAction's def	,
		myRowActions.add(new RowAction() {
			@Override
			public boolean execute(Object aObject) {
				String returnUrl = getRequestCycle().urlFor(PartyListPage.this).toString();
				returnUrl = RequestUtils.toAbsolutePath(returnUrl);
				getRequestCycle().setRequestTarget(
						new RedirectRequestTarget("../oms/party_edit?" + "base_sessionLevelOffset=1" + "&systemid=" + aObject + "&systemId=" + aObject + "&returnUrl=" + returnUrl));
				return false;

/ In QueryViewPanel, die de list van RowAction's meekrijgt,  worden de RowActionPanel's create	,

							for (final RowAction myAction : rowActionList) {
								RowActionPanel myPanel = new RowActionPanel(myActions.newChildId(), myAction, aCell.getModelObject(), myAction.getCssClass(), myAction .getTitle()) {

$ vi RowActionPanel.java
		link = new AjaxLink("link") {
			@Override
			public void onClick(AjaxRequestTarget aTarget) {
				anAction.setTarget(aTarget);
				if (anAction.execute(anObject)) {
					refresh(aTarget);

$ vi RowActionPanel.html

<wicket:panel>
	<button wicket:id="link" ></button>
</wicket:panel>

/ Dus we zien een AjaxLink in Java	, en een button in HTML	,
/ TODO

/ Einde Intermezzo


/ 13	. 

public class PartyListPage extends AbstractMainPage {
	protected void createFormButton() {
		Form<CustomerOrderLine> createForm = new Form<CustomerOrderLine>("createForm");
		add(createForm);
		createForm.add(new Button("createButton") {
			@Override
			public void onSubmit() {
				String returnUrl = getRequestCycle().urlFor(PartyListPage.this).toString();
				returnUrl = RequestUtils.toAbsolutePath(returnUrl);
				getRequestCycle().setRequestTarget(new RedirectRequestTarget("../oms/party_create?" + "base_sessionLevelOffset=1" + "&returnUrl=" + returnUrl));
			}

4 vi PartyListPage.html
         <button wicket:id="createButton" class="icon icon_new" wicket:message="title:create">
            <span>
              <wicket:message key="create">
                Create new
              </wicket:message>
            </span>
          </button>

/ 13	. 

$ vi oms-sitemap.xmap
			<map:action logger="party" name="partyForm" src="com.mpobjects.oms.control.party.action.PartyFormAction"/>
			<map:match type="regexp" pattern="^party_(edit|create)$">
				<map:act type="partyForm"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/party_edit.jsp"/>
			</map:match>

/ we click op create button	,
/ er zijn 2 actions, 	en beide worden called,	
/ WH com.mpobjects.invoice.control.party.action.PartyFormAction via JS	, want in oms-sitemap is NIET config	,
/ TODO

/s
PartyFormAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
				Map myMap = act();
/s
package com.mpobjects.invoice.control.party.action;
PartyFormAction.act() line: 30	
		int partySystemId = getSystemIdFromRequest();
0
/ Er is geen param systemid 	, dus default 0	,
/ In PartyListPage zie je dat systemid wordt meegegeven bij edit van een party uit de list	,

/c
/s
PartyFormAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	
			if (getRequest().getAttribute("requestManager") != null) {
				setRequestManager((RequestManager) getRequest().getAttribute("requestManager"));
				Map myMap = act();
/s
package com.mpobjects.oms.control.party.action;
PartyFormAction.act() line: 27	

		int mySystemId = getSystemIdFromRequest();
		Party myVO;
		if (mySystemId == 0) {
			myVO = new PartyVO();
/ Master data party	,
		getSession().setAttribute("formVO", myVO);
		getRequest().setAttribute("partySystemId", myVO.getSystemId());
		} else {
			myPartyGroupAddVO = new PartyGroupAddVO();
/s
PartyGroupAddVO.<init>() line: 31	
	private HashMap<Integer, PartyGroupVO> partyGroupList = new HashMap<Integer, PartyGroupVO>(PARTIES_PER_GROUP + 1);

/t
PartyFormAction.act() line: 55	
			myPartyGroupAddVO = new PartyGroupAddVO();
/d
		getSession().setAttribute("partyAddFormVO", myPartyGroupAddVO);

/c
FormTag.doStartTag() line: 242	
		if (StringUtils.isEmpty(getAction())) {
/ JA
			setAction(EntityActionUtil.getActionUrl(getRequest(), "save"));
/s
EntityActionUtil.getActionUrl(HttpServletRequest, String) line: 33	
		return getActionUrl(aRequest.getRequestURI(), aTargetAction);
aRequest.getRequestURI()="/tms/oms/party_create"
aTargetAction="save"
/s
EntityActionUtil.getActionUrl(String, String) line: 55	
/=
	public static String getActionUrl(String aFullUrl, String aTargetAction) {
...
/c
/s
FormTag.setAction(String) line: 507	
../oms/party_save

/c
public class FormTag extends TagBase implements FieldOwner {
	public int doEndTag() throws JspTagException {
		getRequest().getSession().setAttribute(theContinuationId + "_form", this);

/ Deze wordt later used in FormSaveAction.getForm()

/c
FieldTag.doStartTag() line: 338	
		if (handleShowField) {
			if (isFieldContextForm()) {
				findSetFormVOTag();
/s
FieldTag.findSetFormVOTag() line: 1107	
		while (myParent != null && !(myParent instanceof SetFormVOTag) && i < max) {
			myParent = myParent.getParent();
			i++;
		}
		SetFormVOTag myTag = (SetFormVOTag) myParent;
com.mpobjects.view.taglib.form.SetFormVOTag@69478d2
	theValueObject	com.mpobjects.oms.model.party.vo.PartyVO  (id=27769)	

		setActiveValueObjectHolder((SetFormVOTag) myTag.clone());
/c
/s
FieldTag.doStartTag() line: 358	
			addFieldToOwner(this);
/s
FieldTag.addFieldToOwner(FieldTag) line: 892	
		getFieldOwner().addField(aTag);
/s
FormTag.addField(FieldTag) line: 157	


/ we zien het Party form	, maar alleen Details, Contact info	,
/ Dus niet party groups tab	, 

/ we geven	,
Party Id: test2016041301
Organization: PNL-CARGO
Party type: OPDRACHTGEVER
Name: MPO 
Address: Stationsplein 45A
Country: NL

/ Intermezzo

/////////////////////////////////////////////

/ WH gaat het zo	,

/ De server maakt FormTag	, SetFormVOTag	, FieldTag's	, 
/ In party_edit.jsp staat SetFormVO	, en zo wordt HTML OK gemaakt	, want in SetFormVO zit de PartyVO	, en zo worden fields gevonden uit de PartyVO	,
/ Dit was edit	, 
/ Nu save	,
/ De FormTag is in de session	, kent ook alle tags, SetFormVO	, FieldTag	, ...  
/ de fields worden uit de request gehaald	, en wordt de fields in de partyVO update	,

/ MORGENOCHTEND
FieldTag.class
	public int doStartTag() throws JspException {
		if (handleShowField) {
			if (isFieldContextForm()) {
->				findSetFormVOTag();

		if (isFieldContextForm()) {
->			addFieldToOwner(this);

/ We hebben b set in
SetFormVOTag.setValueObject	, maar wordt zo vaak called	,
FieldTag.addFieldToOwner	,
/ TODO

/ Hoe new PartyVO in de SetFormVO	?
/ TODO

/ MORGENOCHTEND



/ Einde Intermezzo

/ Intermezzo

/ een save is een nieuw request	, 

/ we zien dan ook in devtools network	,

Request URL:http://localhost:8080/tms/oms/party_save

Form Data:
continuationId:1460538115102
flowDefinition:reload
redirectTo:../core/back?levelOffset=-1
doRedirect:false
base_sessionLevelOffset:0
returnUrl:http://localhost:8080/tms/wicket/?wicket:interface=:32::::
base_windowToOpenUrl:
base_windowToOpenHeight:
base_windowToOpenWidth:
base_windowToOpenTitle:
base_windowToOpenScrollbar:
partyId:test2016041301
organization:PNL-CARGO
partyType:OPDRACHTGEVER
name:MPO
name2:
address:Stationsplein 45A
address2:
city:
postalCode:
regionState:
country:NL
financialPartyId:
PhoneNumber:
faxNumber:
EmailAddress:
ContactName:
reference1:
reference2:
reference3:
reference4:
reference5:
serviceOrderUrlExpression-display:
serviceOrderUrlExpression:
manifestReport:
timeZone:
serviceRemarks-display:
serviceRemarks:
serverUnavailableMessage:Server busy, please wait
processingFormMessage:Form is being processed...
deleteMessage:Are you sure?

/ Einde Intermezzo

$ vi oms-sitemap.xmap
			<map:action logger="party" name="partySave" src="com.mpobjects.oms.control.party.action.PartySaveAction"/>
			<map:match pattern="party_save">
				<map:act type="partySave"/>
				<map:redirect-to uri="edit_party?systemid={request-attr:systemid}"/>
			</map:match>
/s
PartySaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
			try {
				Map myMap = act();

/ click Save		,
/s
PartySaveAction(AbstractSaveAction).act() line: 64	
		validate();
/s
PartySaveAction.validate() line: 71	
		super.validate();
/s
PartySaveAction(BoundSaveAction).validate() line: 218	
		if (getRequest().getAttribute(TAGLIB_FETCHED_DATA) == null) {
			Collection myValidationFields = getForm().getValidateAbleFields();
/s
PartySaveAction(BoundSaveAction).getForm() line: 170	
		if (theFormTag == null) {
			theFormTag = (FormTag) getRequest().getAttribute("form");
null
		if (theFormTag == null) {
			FormTag myTag = (FormTag) getSession().getAttribute(getContinuationId() + "_form");
getContinuationId()=1460541153743
myTag	com.mpobjects.view.taglib.form.FormTag  (id=26522)	

			myTag.setRequest(new RequestAdaptor(getRequest()));
			theFormTag = myTag;
			getRequest().setAttribute("form", theFormTag);

/ Dit request attr wordt used later in deze zelfde methode	, see de 1ste if	, 


/ Intermezzo

session=
[SPRING_SECURITY_CONTEXT=com.mpobjects.auth.context.ResourceSecurityContextImpl@3446e79f: Authentication: org.springframework.security.authentication.UsernamePasswordAuthenticationToken@3446e79f: Principal: com.mpobjects.auth.model.ScsUserDetails@5422169d; Credentials: [PROTECTED]; Authenticated: true; Details: org.springframework.security.web.authentication.WebAuthenticationDetails@43458: RemoteIpAddress: 0:0:0:0:0:0:0:1; SessionId: 1llua8yc8hq0d14hmf8vs3f621; Granted Authorities: ADMINISTRATOR,
 ORG:PNL-CARGO,
 ORG:PNL-OMS-DOCK,
 ORG:PNL-TMS-AB,
 ORG:SYSTEM,
 null,
 null,
 null,
 returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:23::::,
 null,
 wicket:WicketServlet:session=com.mpobjects.view.wicket.BaseWebSession@47244944,
 null,
 formVO=[SystemId: 0; Party: ; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@1c1ce793[OPDRACHTGEVER,
Opdrachtgever (Bill to Party)]],
 null,
 LastUsedTable=country-selection,
 null,
 country-selection_Table=com.mpobjects.view.util.table.Table@9fac892,
 1460533093001_form=com.mpobjects.view.taglib.form.FormTag@2f85ee5c,
 null,
 1460524527226_form=com.mpobjects.view.taglib.form.FormTag@1e3f264,
 null,
 1460535641360_form=com.mpobjects.view.taglib.form.FormTag@1c3e8434,
 null,
 null,
 null,
 partyPrenotificationRule=com.mpobjects.oms.model.party.vo.PartyPrenotificationRule@4c598068[contentOrderType=<null>,
triggerOrderType=<null>,
triggerType=ON_START],
 null,
 active_order=shipment_order,
 base_sessionList=[1460524498996,
 1460524526002,
 1460531827511,
 1460531922807,
 1460533088481,
 1460535443345,
 1460535710965,
 1460537745632,
 1460541015192,
 1460541150579],
 null,
 null,
 null,
 filter_cache=com.mpobjects.view.util.table.FilterCache@44d87a0f,
 null,
 null,
 null,
 base_sessionLevel=9,
 1460537509890_form=com.mpobjects.view.taglib.form.FormTag@8546ac0,
 wicket:WicketServlet:m:null=[PageMap name=null],
 1460531834084_form=com.mpobjects.view.taglib.form.FormTag@5e2c6785,
 null,
 partyAddFormVO=com.mpobjects.oms.model.partygroup.vo.PartyGroupAddVO/id:0,
 null,
 party_type_systemid=26681476,
 base_sessionMap={1460535710965=com.mpobjects.control.action.BaseRequest@35407d10,
 1460531922807=com.mpobjects.control.action.BaseRequest@1cd2c0c0,
 1460524498996=com.mpobjects.control.action.BaseRequest@506c8c08,
 1460541150579=com.mpobjects.control.action.BaseRequest@65d8a78,
 1460535443345=com.mpobjects.control.action.BaseRequest@672dcf8b,
 1460537745632=com.mpobjects.control.action.BaseRequest@7094e398,
 1460531827511=com.mpobjects.control.action.BaseRequest@3eea49e6,
 1460533088481=com.mpobjects.control.action.BaseRequest@799bb4f,
 1460541015192=com.mpobjects.control.action.BaseRequest@7dd8436e,
 1460524526002=com.mpobjects.control.action.BaseRequest@1332b4e},
 myShipmentOrderView=com.mpobjects.oms.view.shipmentorder.ShipmentOrderView@46600e7f,
 null,
 1460541153743_form=com.mpobjects.view.taglib.form.FormTag@4c57d7f1,
 null,
 null,
 1460531923067_form=com.mpobjects.view.taglib.form.FormTag@1b22365f]

/ we zien alle vroegere forms ook in de session	, 
/ TODO

/ Einde Intermezzo

/s
package com.mpobjects.invoice.control.party.action;
PartySaveAction.act() line: 116	
		BoundSaveAction.addSubmitListener(getRequest(), PartyEditFormListener.class);
/c
PartySaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
			if (getRequest().getAttribute("requestManager") != null) {
				setRequestManager((RequestManager) getRequest().getAttribute("requestManager"));
			try {
				Map myMap = act();
/s
PartySaveAction(AbstractSaveAction).act() line: 64	
			handleSave();
/s
package com.mpobjects.oms.control.party.action;
PartySaveAction.handleSave() line: 61	
		MpoBeanFactory.getBean(SpringLegacyHelper.class).runWithTransaction(this);
/s
PartySaveAction.call() line: 31	
		PartyVO myVO = (PartyVO) getValueObject();
/s
PartySaveAction(BoundSaveAction).getValueObject() line: 197	
		return getFetchedData().iterator().next();
/s
PartySaveAction(BoundSaveAction).getFetchedData() line: 136	
			if (theFetchedData == null) {
				Collection<DataFetchable> myFetchFields = getForm().getDataFetchableFields();
/s
PartySaveAction(BoundSaveAction).getForm() line: 180	
		if (theFormTag == null) {
			theFormTag = (FormTag) getRequest().getAttribute("form");

this	com.mpobjects.oms.control.party.action.PartySaveAction  (id=26558)	
	theFormTag	com.mpobjects.view.taglib.form.FormTag  (id=26522)	
		return theFormTag;
/t
/s
FormTag.getDataFetchableFields() line: 346	
		ArrayList<DataFetchable> myList = new ArrayList<DataFetchable>();
		for (Object myField : fieldList) {
			if (myField instanceof DataFetchable) {
				myList.add((DataFetchable) myField);


/ Intermezzo

/ Dit is weer edit	, 


/ TODO (MORGENOCHTEND))
/ we hebben b set in FieldTag.addFieldToOWner	,
/ we hebben b set in FieldTag.setActiveValueObjectHolder`kk

/ Iedere FieldTag krijgt SetFormVOTag	, met de theValueObject=PartyVO TODO
/ Iedere FieldTag set zichzelf in de FormTag's list van fields	,

/s
FieldTag.doStartTag() line: 338	
		if (handleShowField) {
			if (isFieldContextForm()) {
				findSetFormVOTag();
/s
FieldTag.findSetFormVOTag() line: 1107	
	while (myParent != null && !(myParent instanceof SetFormVOTag) && i < max) {
			myParent = myParent.getParent();
			i++;
		}
		SetFormVOTag myTag = (SetFormVOTag) myParent;
myTag	com.mpobjects.view.taglib.form.SetFormVOTag  (id=27164)	
	class$javax$servlet$jsp$tagext$Tag	java.lang.Class (javax.servlet.jsp.tagext.Tag) (id=14043)	
	id	null	
	pageContext	org.apache.jasper.runtime.PageContextImpl  (id=26044)	
	parent	com.mpobjects.view.taglib.form.FormTag  (id=27152)	
	theFetchFrom	null	
	theFetchVar	null	
	theFormTag	com.mpobjects.view.taglib.form.FormTag  (id=27152)	
	theLanguageManager	null	
	thePrefix	"" (id=23092)	
	theValueObject	com.mpobjects.oms.model.party.vo.PartyVO  (id=27372)	
	values	null	

		setActiveValueObjectHolder((SetFormVOTag) myTag.clone());

/c
FieldTag.doStartTag() line: 358	
		if (isFieldContextForm()) {
			addFieldToOwner(this);
/s
FieldTag.addFieldToOwner(FieldTag) line: 892	
		getFieldOwner().addField(aTag);
/s
FieldTag.getFieldOwner() line: 1125	
		return getActiveValueObjectHolder().getFieldOwner();
/s
SetFormVOTag.getFieldOwner() line: 142	
		return getForm();
/s
SetFormVOTag.getForm() line: 163	
		return theFormTag;
com.mpobjects.view.taglib.form.FormTag@18e1b5d5



/ Einde Intermezzo

/ Dit is de form op de server	, vergl. DOM	, en in Wicket ...	,

myFetchFields	java.util.ArrayList  (id=26022)	
	elementData	java.lang.Object[33]  (id=26181)	
		[0]	com.mpobjects.view.taglib.form.FieldTag  (id=26023)	
		[1]	com.mpobjects.view.taglib.form.ListFieldTag  (id=26182)	
		[2]	com.mpobjects.view.taglib.form.ListFieldTag  (id=26183)	
		[3]	com.mpobjects.view.taglib.form.FieldTag  (id=26184)	
		[4]	com.mpobjects.view.taglib.form.FieldTag  (id=26185)	
		[5]	com.mpobjects.view.taglib.form.FieldTag  (id=26186)	
		[6]	com.mpobjects.view.taglib.form.FieldTag  (id=26187)	
		[7]	com.mpobjects.view.taglib.form.FieldTag  (id=26188)	
		[8]	com.mpobjects.view.taglib.form.FieldTag  (id=26189)	
		[9]	com.mpobjects.view.taglib.form.FieldTag  (id=26190)	
		[10]	com.mpobjects.view.taglib.form.ListFieldTag  (id=26191)	
		[11]	com.mpobjects.view.taglib.form.FieldTag  (id=26192)	
		[12]	com.mpobjects.view.taglib.form.FieldTag  (id=26222)	
		[13]	com.mpobjects.view.taglib.form.FieldTag  (id=26223)	
		[14]	com.mpobjects.view.taglib.form.FieldTag  (id=26224)	
		[15]	com.mpobjects.view.taglib.form.FieldTag  (id=26225)	
		[16]	com.mpobjects.view.taglib.form.FieldTag  (id=26226)	
		[17]	com.mpobjects.view.taglib.form.FieldTag  (id=26227)	
		[18]	com.mpobjects.view.taglib.form.FieldTag  (id=26228)	
		[19]	com.mpobjects.view.taglib.form.FieldTag  (id=26229)	
		[20]	com.mpobjects.view.taglib.form.TextFieldTag  (id=26230)	
		[21]	com.mpobjects.view.taglib.form.FieldTag  (id=26231)	
		[22]	com.mpobjects.view.taglib.form.TimeZoneFieldTag  (id=26232)	
		[23]	com.mpobjects.view.taglib.form.TextFieldTag  (id=26233)	
	size	24	

				for (DataFetchable myDataFetchable : myFetchFields) {
myDataFetchable=myDataFetchable	com.mpobjects.view.taglib.form.FieldTag  (id=26023)	
						myDataFetchable.fetchData();
/s
FieldTag.fetchData() line: 379	

this	com.mpobjects.view.taglib.form.FieldTag  (id=26023)	
	activeValueObjectHolder	com.mpobjects.view.taglib.form.SetFormVOTag  (id=26040)	
		theValueObject	com.mpobjects.oms.model.party.vo.PartyVO  (id=26027)	
/ TODO (new PartyVO()	?)

		if (!isCurrentlyReadOnly()) {
/ JA
			VOReflectionInvoker.setValue(getActiveValueObject(), getName(), getValueFromRequest(getFormFieldName()));
getFormFieldName()="partyId"
getValueFromRequest(getFormFieldName())=test2016041301
/ sets partyId in getActiveValueObject()=WH new PartyVO()	,

/////////////////////////////////////////////////////////////////
/ Pak form op server	, en set values uit request er in	,

/ getValueObject() is dus initial form values mergedm met (post) request data (wat user filled in)	,

/c
/s
PartySaveAction(BoundSaveAction).afterSave() line: 65	
		if (removeContinuation) {
			getSession().removeAttribute(getContinuationId() + "_form");
		if (callParent) {
			super.afterSave();
/s
PartySaveAction(AbstractSaveAction).afterSave() line: 157	
		if (shouldTakeControl()) {

			getRequest().setAttribute("redirectTo", myRedirectUrl);
http://localhost:8080/tms/wicket/?wicket:interface=:32::::
			RedirectSaveAction.redirect(getRedirector(), getRequest(), myRedirectUrl);
/c
/ TODO (Afmaken)


/ 	7. 

/ we open een saved party	, 

////////////////////////////
/ Als we click edit een party uit de list	, gaat hij dus een form create,	 dwz FormTag, SetFormVOTag	, FieldTag's, ListTag's,	 ...
/ Als we save	, dan pakt hij het form	, dus FormTag, ... uit de session, en merges hij de values uit de post requiest met de obj uit SetFormVOTag	,

$ vi party_edit.jsp
			<c:if test="${formVO.systemId>0}">
					<c:set scope="page" var="number" value="${cf:property('oms', 'partygroup.per.party' , '0')}" />
					<c:if test="${ number != '0'}">
						<mpo:tab name="partyGroups">
							<mpo:setFormVO fetchFrom="session" fetchVar="partyAddFormVO">
								<table>
									<c:forEach var="entry" begin="1" end="${number}">
										<tr>
											<mpo:idxListField name="partyGroup" type="partygroup" index="${entry}" useEmptyLogic="true" />
										</tr>
									</c:forEach>
								</table>
							</mpo:setFormVO>


						</mpo:tab>
					</c:if>


/ 7	. 

/ We nemen master data party test2016041301	, en we gaan naar 
configuration, planning, party groups	, 
/ we add test2016041301 aan 999 en RETURN_LABEL	,

configuration, planning, party groups
PartyGroupPage

/ 13	. 
$ vi PartyGroupPage.html
...
$ vi PartyGroupPage.java
		RowAction editAction = new RowAction() {
			@Override
			public boolean execute(Object aObject) {
				EvoEditFormPage<PartyGroupVO> page = getEditPage();
				setResponsePage(page);
				return false;

	private EvoEditFormPage<PartyGroupVO> getEditPage() {
		if (editPage == null) {
			editPage = new PartyGroupEditFormPage(this, daoWrapper, dataProperties);


/ 13	. 

$ vi EvoEditFormPgae.html
		<div wicket:id="editPanel"></div>
...
$ vi PartyGroupEditFormPage.java
public class PartyGroupEditFormPage extends EvoEditFormPage<PartyGroupVO> {
	protected void createEditPanel() {
		editPanel = new PartyGroupEditPanel("editPanel", new WebComponentEventSwitchBoard(), panelBuilder, daoWrapper, dataProperties);
/cby
EvoEditFormPage.createPage
		createEditPanel();
/cby
	public EvoEditFormPage(EvoEditFormCallback aCallback, BeanWrapper<? extends EnumeratedValueObjectDAOInterface<T>> aDaoWrapper, EvoDataProperties aDataProperties) {
		createPage();
/cby
	public PartyGroupEditFormPage(EvoEditFormCallback aCallback, BeanWrapper<? extends EnumeratedValueObjectDAOInterface<PartyGroupVO>> aDaoWrapper, EvoDataProperties aDataProperties) {
		super(aCallback, aDaoWrapper, aDataProperties);

/ 13	. 

$ vi PartyGroupEditPanel.html
		<wicket:extend>
...
					<tbody>
						<tr wicket:id="parties">
							<td><input type="checkbox" wicket:id="selection" /></td>
							<td wicket:id="partyId"></td>
							<td wicket:id="partyType"></td>
						</tr>
					</tbody>
		</wicket:extend>
$ vi EvoEditPanel.html
						<input type="text" wicket:id="code" size="10" name="code" />
						<textarea wicket:id="description" name="description" rows="4" cols="50"></textarea>

$ vi GenericFormPanel.html
<form class="genericForm" name="genericForm" id="genericForm" wicket:id="genericForm">
	<h2><div wicket:id="formTitle"/></h2>
	<wicket:child/>
	<div class="actionPanelContainer" wicket:id="actionPanel" />
</form>

/ stack trace	,
/s
	PartyGroupEditPanel(GenericFormPanel).<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, T, FormActionsPanelBuilder<T>, BeanWrapper<BaseDAOInterface<T>>) line: 75	
			myObject = daoWrapper.getBean().createNewObject();
new PartyGroupVO()
		IModel<T> myModel = new EntityDetachableModel<T>(myObject, aDaoWrapper);
		createPanel(new CompoundPropertyModel<T>(myModel));
tempModel=new CompoundPropertyModel<T>(myModel)

	PartyGroupEditPanel(EvoEditPanel).<init>(String, WebComponentEventSwitchBoard, FormActionsPanelBuilder<T>, BeanWrapper<EnumeratedValueObjectDAOInterface<T>>, EvoDataProperties) line: 45	
->		super(id, null, webComponentEventSwitchBoard, null, formActionsPanelBuilder, aDaoWrapper);
		// call again, this time is will be executed for real
		createPanel(tempModel);

	PartyGroupEditPanel.<init>(String, WebComponentEventSwitchBoard, FormActionsPanelBuilder<PartyGroupVO>, BeanWrapper<EnumeratedValueObjectDAOInterface<PartyGroupVO>>, EvoDataProperties) line: 92	
		super(aId, aWebComponentEventSwitchBoard, aFormActionsPanelBuilder, aDaoWrapper, aDataProperties);

	PartyGroupEditFormPage.createEditPanel() line: 41	
		editPanel = new PartyGroupEditPanel("editPanel", new WebComponentEventSwitchBoard(), panelBuilder, daoWrapper, dataProperties);

	PartyGroupEditFormPage(EvoEditFormPage).createPage() line: 143	
		createEditPanel();

	PartyGroupEditFormPage(EvoEditFormPage).<init>(EvoEditFormCallback, BeanWrapper<EnumeratedValueObjectDAOInterface<T>>, EvoDataProperties) line: 90	
	PartyGroupEditFormPage.<init>(EvoEditFormCallback, BeanWrapper<EnumeratedValueObjectDAOInterface<PartyGroupVO>>, EvoDataProperties) line: 32	
	PartyGroupPage.getEditPage() line: 184	
	PartyGroupPage.access$100(PartyGroupPage) line: 38	
	PartyGroupPage$2.execute(Object) line: 128	
	RowActionPanel$1.onClick(AjaxRequestTarget) line: 41	
	AjaxLink$1.onEvent(AjaxRequestTarget) line: 68	
	AjaxLink$1(AjaxEventBehavior).respond(AjaxRequestTarget) line: 177	
	AjaxLink$1(AbstractDefaultAjaxBehavior).onRequest() line: 312	
	BehaviorRequestTarget.processEvents(RequestCycle) line: 157	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/ Intermezzo

/ Let op	,
	PartyGroupEditPanel(GenericFormPanel).<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, T, FormActionsPanelBuilder<T>, BeanWrapper<BaseDAOInterface<T>>) line: 75	
		createPanel(new CompoundPropertyModel<T>(myModel));	 / 1ste keer	,
tempModel=new CompoundPropertyModel<T>(myModel)
/ en	,
	PartyGroupEditPanel(EvoEditPanel).<init>(String, WebComponentEventSwitchBoard, FormActionsPanelBuilder<T>, BeanWrapper<EnumeratedValueObjectDAOInterface<T>>, EvoDataProperties) line: 45	
		// call again, this time is will be executed for real
		createPanel(tempModel);								/ 2de keer	,

/ beide doen call op EvoEditPanel.createPanel	,
	@Override
	protected void createPanel(CompoundPropertyModel<T> aModel) {
		if (dataProperties == null) {
/ 1ste keer	,
			tempModel = aModel;
		} else {
/ 2de keer	,
			super.createPanel(aModel);
/s
class GenericFormPanel
	protected void createPanel(CompoundPropertyModel<T> model) {
		form = new GenericForm<T>("genericForm", model);
		add(form);
		AbstractActionsPanel<T> actionPanel = getActionsPanel("actionPanel", model);
		form.add(actionPanel);
		setForm(form);


/ Einde Intermezzo


/ debug 
/s
PartyGroupEditPanel(EvoEditPanel).<init>(String, WebComponentEventSwitchBoard, FormActionsPanelBuilder<T>, BeanWrapper<EnumeratedValueObjectDAOInterface<T>>, EvoDataProperties) line: 51	

		super(id, null, webComponentEventSwitchBoard, null, formActionsPanelBuilder, aDaoWrapper);
/d
		if (formActionsPanelBuilder instanceof EntityFormActionBuilder) {
			modifyActions((EntityFormActionBuilder<T>) formActionsPanelBuilder);
/s
PartyGroupEditPanel.modifyActions(EntityFormActionBuilder<PartyGroupVO>) line: 134	
		EntityActionButton<PartyGroupVO> addBtn = new EntityActionAjaxButton<PartyGroupVO>("add", new ResourceModel("addParty")) {
			@Override
			protected void onSubmit(Button aButton, AjaxRequestTarget aTarget, IModel<PartyGroupVO> aSelection) {
				newPartyModel.setObject(null);
				partyLookupWindow.show(aTarget);
			}
		};
		addBtn.setDefaultFormProcessing(false);
		aEntityFormActionBuilder.getActions().add(addBtn);
/t
PartyGroupEditPanel(EvoEditPanel).<init>(String, WebComponentEventSwitchBoard, FormActionsPanelBuilder<T>, BeanWrapper<EnumeratedValueObjectDAOInterface<T>>, EvoDataProperties) line: 54	
		if (formActionsPanelBuilder instanceof EntityFormActionBuilder) {
			modifyActions((EntityFormActionBuilder<T>) formActionsPanelBuilder);
		}
		// call again, this time is will be executed for real
		createPanel(tempModel);
/s
PartyGroupEditPanel(EvoEditPanel).createPanel(CompoundPropertyModel<T>) line: 84	
		if (dataProperties == null) {
/ NEE
			tempModel = aModel;
/ NIET
		} else {
			super.createPanel(aModel);
/s
PartyGroupEditPanel(GenericFormPanel).createPanel(CompoundPropertyModel<T>) line: 167	
		form = new GenericForm<T>("genericForm", model);
		add(form);
		AbstractActionsPanel<T> actionPanel = getActionsPanel("actionPanel", model);
/s
PartyGroupEditPanel(GenericFormPanel).getActionsPanel(String, CompoundPropertyModel<T>) line: 187	
		return panelBuilder.build(componentId, model, webComponentEventSwitchBoard, this);
/s
EntityFormActionBuilder.build(String, CompoundPropertyModel<T>, WebComponentEventSwitchBoard, GenericFormPanel<T>) line: 38	
		return new EntityActionPanel(aId, aParent, aWebComponentEventSwitchBoard, aModel);
/s
BaseActionBuilder$EntityActionPanel.<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, IModel<T>) line: 34	
			super(aId, aParent, aWebComponentEventSwitchBoard);
			RepeatingView view = new RepeatingView("actions");
			add(view);
			createActions(view, aModel);
/s
EntityFormActionBuilder(BaseActionBuilder).createActions(RepeatingView, IModel<T>) line: 75	
		for (EntityAction<T> action : actions) {
			Component component = action.createComponent(view.newChildId(), aModel);
component	com.mpobjects.view.wicket.util.actions.AbstractEntityActionButton$EntityABPanel  (id=22212)	
			if (component != null) {
				view.add(component);

this	com.mpobjects.view.wicket.util.actions.EntityFormActionBuilder  (id=20758)	
	actions	java.util.ArrayList  (id=21166)	
		elementData	java.lang.Object[10]  (id=22173)	
			[0]	com.mpobjects.oms.view.wicket.enumeratedvo.EvoEditFormPage$1  (id=22175)	
			[1]	com.mpobjects.oms.view.wicket.enumeratedvo.EvoEditFormPage$2  (id=22216)	
			[2]	com.mpobjects.oms.view.wicket.partygroup.PartyGroupEditPanel$1  (id=22140)	
			[3]	com.mpobjects.oms.view.wicket.partygroup.PartyGroupEditPanel$2  (id=22141)	
			[4]	com.mpobjects.oms.view.wicket.partygroup.PartyGroupEditPanel$3  (id=22142)	
			[5]	com.mpobjects.oms.view.wicket.partygroup.PartyGroupEditPanel$4  (id=22144)	
		size	6	

/t
PartyGroupEditFormPage.createEditPanel() line: 42	
		editPanel = new PartyGroupEditPanel("editPanel", new WebComponentEventSwitchBoard(), panelBuilder, daoWrapper, dataProperties);
/d

/ 13	. 

/ we click 'Add party' in party group met code 11,

/s
AjaxFallbackButton$1.onSubmit(AjaxRequestTarget) line: 74	
/=
	public AjaxFallbackButton(String id, IModel<String> model, Form<?> form)
	{
		add(new AjaxFormSubmitBehavior(form, "onclick")
		{
			@Override
			protected void onSubmit(AjaxRequestTarget target)
			{
->				AjaxFallbackButton.this.onSubmit(target, AjaxFallbackButton.this.getForm());
/s
EntityActionAjaxButton$1.onSubmit(AjaxRequestTarget, Form<?>) line: 56	
/=
public abstract class EntityActionAjaxButton<T extends EntityInterface> extends EntityActionButton<T> {

	@Override
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new AjaxFallbackButton(aId, null) {
			@Override
			protected void onSubmit(AjaxRequestTarget aTarget, Form<?> aForm) {
->				EntityActionAjaxButton.this.onSubmit(this, aTarget, aModel);
/s
PartyGroupEditPanel$1.onSubmit(Button, AjaxRequestTarget, IModel<PartyGroupVO>) line: 137	
/=
public class PartyGroupEditPanel extends EvoEditPanel<PartyGroupVO> {
		EntityActionButton<PartyGroupVO> addBtn = new EntityActionAjaxButton<PartyGroupVO>("add", new ResourceModel("addParty")) {
			@Override
			protected void onSubmit(Button aButton, AjaxRequestTarget aTarget, IModel<PartyGroupVO> aSelection) {
->				newPartyModel.setObject(null);
				partyLookupWindow.show(aTarget);

/ Intermezzo

public class PartyGroupEditPanel extends EvoEditPanel<PartyGroupVO> {
	protected void setForm(final GenericForm<PartyGroupVO> aForm) {
		partyLookupWindow = new ModalWindow("partyLookupWindow");
		aForm.add(partyLookupWindow);

		partyLookupWindow.setPageCreator(new ModalWindow.PageCreator() {
			@Override
			public Page createPage() {
				return new ModalPartySearchPage(partyLookupWindow, newPartyModel, null);
/ Zo	,

		partyLookupWindow.setWindowClosedCallback(new ModalWindow.WindowClosedCallback() {
			@Override
			public void onClose(AjaxRequestTarget aTarget) {
				if (newPartyModel.getObject() == null) {
/ Later	,  

/ Einde Intermezzo

/ we kiezen test2016041301 in filter op ModalWIndow	, en click edit button op deze row	,
/s
/ via wicket....js	,
/s
EntityActionAjaxButton$1.onSubmit(AjaxRequestTarget, Form<?>) line: 56	
/=
public abstract class EntityActionAjaxButton<T extends EntityInterface> extends EntityActionButton<T> {
	@Override
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new AjaxFallbackButton(aId, null) {
			@Override
			protected void onSubmit(AjaxRequestTarget aTarget, Form<?> aForm) {
				EntityActionAjaxButton.this.onSubmit(this, aTarget, aModel);
/s
ModalPartySearchPage$1.onSubmit(Button, AjaxRequestTarget, IModel<PartyVO>) line: 36	
/=
public class ModalPartySearchPage extends BasePage {
	public ModalPartySearchPage(final ModalWindow window, final IModel<Party> aModel, String aPartyTypeGroup) {
		EntityActionAjaxButton<PartyVO> action = new EntityActionAjaxButton<PartyVO>("ok") {
			@Override
			protected void onSubmit(Button aButton, AjaxRequestTarget aTarget, IModel<PartyVO> aSelection) {
->				aModel.setObject(aSelection.getObject());
/ calls load()	, en uses id=27213964 WH	,

aSelection	com.mpobjects.view.wicket.util.multi.GenericListElementModel  (id=22647)	
	LOG	org.apache.commons.logging.impl.Log4JLogger  (id=22735)	
	attached	true	
	id	java.lang.Integer  (id=22736)	
27213964
	transientModelObject	com.mpobjects.oms.model.party.vo.PartyVO_$$_javassist_21  (id=23101)	
	wrapper	com.mpobjects.view.wicket.util.BeanWrapper  (id=22737)	

/c
/s 
/ via js
/s
PartyGroupEditPanel$7.onClose(AjaxRequestTarget) line: 261	
/=
public class PartyGroupEditPanel extends EvoEditPanel<PartyGroupVO> {
		partyLookupWindow.setWindowClosedCallback(new ModalWindow.WindowClosedCallback() {
			@Override
			public void onClose(AjaxRequestTarget aTarget) {
				if (newPartyModel.getObject() == null) {

this	com.mpobjects.oms.view.wicket.partygroup.PartyGroupEditPanel$7  (id=23149)	
	this$0	com.mpobjects.oms.view.wicket.partygroup.PartyGroupEditPanel  (id=22305)	
		newPartyModel	org.apache.wicket.model.Model  (id=22512)	
			object	com.mpobjects.oms.model.party.vo.PartyVO_$$_javassist_21  (id=23101)	
				handler	org.hibernate.proxy.pojo.javassist.JavassistLazyInitializer  (id=23226)	
					target	com.mpobjects.oms.model.party.vo.PartyVO  (id=23252)	
						partyGroups	org.hibernate.collection.PersistentSet  (id=23277)	
						partyGroupsAsString	null	
						partyId	"test2016041301" (id=23280)	
						partyPrenotificationRuleList	org.hibernate.collection.PersistentBag  (id=23281)	
						partyType	com.mpobjects.oms.model.entity.partytype.PartyType_$$_javassist_181  (id=23282)	
com.mpobjects.oms.model.entity.partytype.PartyType@5c287e33[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]

this	com.mpobjects.oms.view.wicket.partygroup.PartyGroupEditPanel$7  (id=23149)	
	this$0	com.mpobjects.oms.view.wicket.partygroup.PartyGroupEditPanel  (id=22305)	
		currentParties	java.util.ArrayList  (id=22504)	
			elementData	java.lang.Object[10]  (id=23469)	
				[0]	com.mpobjects.oms.model.party.vo.PartyVO  (id=23471)	
				[1]	com.mpobjects.oms.model.party.vo.PartyVO  (id=23472)	
				[2]	com.mpobjects.oms.model.party.vo.PartyVO  (id=23473)	
				[3]	com.mpobjects.oms.model.party.vo.PartyVO  (id=23474)	
			size	4	
/ Klopt	, in deze group zitten 4 parties	,

				if (!currentParties.contains(newPartyModel.getObject())) {
					currentParties.add(newPartyModel.getObject());
				aTarget.addComponent(partyContainer);
/ Lijst met parties op de party group edit panel	, moet worden veranderd	, hij moet erbij	, 
/ OK, we zien test2016041301 erbij	,

/ 13	. 

/ we openen nogmaals party group 11	, 
/ we zien test2016041301 er niet meer bij	, 
/ we moeten na add wel de group save	,

/s
	public RowActionPanel(String aId, final RowAction anAction, final Object anObject, String cssClass, String aTitle) {
		link = new AjaxLink("link") {
			@Override
			public void onClick(AjaxRequestTarget aTarget) {
				anAction.setTarget(aTarget);
->				if (anAction.execute(anObject)) {

this	com.mpobjects.oms.view.wicket.entityview.RowActionPanel$1  (id=24441)	
	val$anObject	java.lang.Integer  (id=24467)	
26791510
/= system_id van de party group 11	,
/s
PartyGroupPage$2.execute(Object) line: 130	
		RowAction editAction = new RowAction() {
			@Override
			public boolean execute(Object aObject) {
				page.setEditRecord(daoWrapper.getBean().getBySystemId((Integer) aObject));
/s
PartyGroupEditFormPage(EvoEditFormPage).setEditRecord(T) line: 106	
		editPanel.setEditRecord(aEntity);
/s
PartyGroupEditPanel.setEditRecord(PartyGroupVO) line: 121	
/=
	public void setEditRecord(PartyGroupVO aRecord) {
aRecord	com.mpobjects.oms.model.partygroup.vo.PartyGroupVO  (id=24499)	

		super.setEditRecord(aRecord);
/s
			setObject(record);
/s
PartyGroupEditPanel(GenericFormPanel).setObject(T) line: 242	
		form.setModelObject(object);
/t
PartyGroupEditPanel.setEditRecord(PartyGroupVO) line: 122	
		super.setEditRecord(aRecord);
/d
		currentParties.clear();
		currentParties.addAll(aRecord.getParties());

aRecord	com.mpobjects.oms.model.partygroup.vo.PartyGroupVO  (id=24499)	
	code	"11" (id=24509)	
	parties	org.hibernate.collection.PersistentSet  (id=24815)	
[
[SystemId: 26683410; Party: 9836368; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@22f2fc60[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]], 
[SystemId: 26683224; Party: 9879373; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@22f2fc60[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]], 
[SystemId: 26683215; Party: 9879380; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@22f2fc60[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]], 
[SystemId: 26683308; Party: 9879310; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@22f2fc60[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]]
]
	systemId	26791510	


		selectedMessages.clear();
		selectedParties.clear();
/c

/ we add test2016041301 to the party group	,
/ hi staat erbij,	

/ 13. 

/ we hebben add test2016041301 aan 11,
/ click Save op deze party group	,

/ Intermezzo

PartyGroupEditFormPage.createEditPanel() line: 40	
		EntityFormActionBuilder<PartyGroupVO> panelBuilder = new EntityFormActionBuilder<PartyGroupVO>(getFormActions());
/s
PartyGroupEditFormPage(EvoEditFormPage).getFormActions() line: 152	
		EntityActionButton<T> saveBtn = new EntityActionAjaxButton<T>("ok", new ResourceModel("save")) {
			protected void onSubmit(Button aButton, AjaxRequestTarget aTarget, IModel<T> aSelection) {
...
		actions.add(saveBtn);
		EntityActionButton<T> cancelBtn = new EntityActionAjaxButton<T>("cancel", new ResourceModel("cancel")) {
			protected void onSubmit(Button aButton, AjaxRequestTarget aTarget, IModel<T> aSelection) {
..
		actions.add(cancelBtn);
		return actions;
/t
PartyGroupEditFormPage.createEditPanel() line: 41	
		EntityFormActionBuilder<PartyGroupVO> panelBuilder = new EntityFormActionBuilder<PartyGroupVO>(getFormActions());
/d
		editPanel = new PartyGroupEditPanel("editPanel", new WebComponentEventSwitchBoard(), panelBuilder, daoWrapper, dataProperties);
/ Hier vandaan komen de add party action, ...
/ MORGENOCHTEND
/ TODO
/ new PartyVO() hierboven	,
/ TODO

/ Einde Intermezzo

/s
EntityActionAjaxButton$1.onSubmit(AjaxRequestTarget, Form<?>) line: 56	
				EntityActionAjaxButton.this.onSubmit(this, aTarget, aModel);
/s
EvoEditFormPage$1.onSubmit(Button, AjaxRequestTarget, IModel<T>) line: 166	
				T evo = aSelection.getObject();
evo	com.mpobjects.oms.model.partygroup.vo.PartyGroupVO  (id=25651)	

				try {
					evo = saveOrCreateEvo(evo);
/s
PartyGroupEditFormPage.saveOrCreateEvo(PartyGroupVO) line: 48	
		updateParties(aEvo);
/s
PartyGroupEditFormPage.updateParties(PartyGroupVO) line: 53	
/=
	private void updateParties(PartyGroupVO aEvo) {
		myVO = aEvo;
		myVO.setParties(new HashSet<PartyVO>());
		PartyGroupEditPanel myPanel = (PartyGroupEditPanel) editPanel;
		for (Party myParty : myPanel.getCurrentParties()) {
			myVO.getParties().add(myDao.getBean().getBySystemId(myParty.getSystemId()));

myVO	com.mpobjects.oms.model.partygroup.vo.PartyGroupVO  (id=22832)	
	parties	java.util.HashSet  (id=22893)	
[]	
/ TODO

/ Intermezzo

public abstract class EntityActionAjaxButton<T extends EntityInterface> extends EntityActionButton<T> {
	@Override
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {

this	com.mpobjects.view.wicket.util.actions.EntityActionAjaxButton$1  (id=22826)	
	val$aModel	org.apache.wicket.model.CompoundPropertyModel  (id=22318)	
		target	com.mpobjects.view.wicket.util.EntityDetachableModel  (id=22908)	
			entity	com.mpobjects.oms.model.partygroup.vo.PartyGroupVO  (id=22832)	
				code	"12" (id=22833)	
				deleted	false	
				description	"Klantgroep 12 Convidien" (id=22834)	
				messages	org.hibernate.collection.PersistentSet  (id=22835)	
				organization	com.mpobjects.oms.model.entity.organization.Organization  (id=22836)	
				parties	java.util.HashSet  (id=22893)	
[]
		return new AjaxFallbackButton(aId, null) {
			@Override
			protected void onSubmit(AjaxRequestTarget aTarget, Form<?> aForm) {
				EntityActionAjaxButton.this.onSubmit(this, aTarget, aModel);
/s
EvoEditFormPage$1.onSubmit(Button, AjaxRequestTarget, IModel<T>) line: 170	
/=
			protected void onSubmit(Button aButton, AjaxRequestTarget aTarget, IModel<T> aSelection) {
				T evo = aSelection.getObject();
evo	com.mpobjects.oms.model.partygroup.vo.PartyGroupVO  (id=22832)	
	code	"12" (id=22833)	
	parties	java.util.HashSet  (id=22893)	
[]
/s
PartyGroupEditFormPage.saveOrCreateEvo(PartyGroupVO) line: 48	
		updateParties(aEvo);
/s
PartyGroupEditFormPage.updateParties(PartyGroupVO) line: 63	
/=
	private void updateParties(PartyGroupVO aEvo) {
aEvo	com.mpobjects.oms.model.partygroup.vo.PartyGroupVO  (id=22832)	
	code	"12" (id=22833)	
	parties	java.util.HashSet  (id=22893)	
[]
/ TODO

/ Einde Intermezzo

myPanel	com.mpobjects.oms.view.wicket.partygroup.PartyGroupEditPanel  (id=25611)	
	currentParties	java.util.ArrayList  (id=25680)	
		elementData	java.lang.Object[10]  (id=25682)	
			[0]	com.mpobjects.oms.model.party.vo.PartyVO  (id=25683)	
			[1]	com.mpobjects.oms.model.party.vo.PartyVO  (id=25684)	
			[2]	com.mpobjects.oms.model.party.vo.PartyVO  (id=25685)	
			[3]	com.mpobjects.oms.model.party.vo.PartyVO  (id=25686)	
			[4]	com.mpobjects.oms.model.party.vo.PartyVO_$$_javassist_21  (id=25687)	
		size	5	

/t
PartyGroupEditFormPage.saveOrCreateEvo(PartyGroupVO) line: 49	
		updateParties(aEvo);
/d
		return super.saveOrCreateEvo(aEvo);
/s
PartyGroupEditFormPage(EvoEditFormPage).saveOrCreateEvo(T) line: 215	
		} else {
			return daoWrapper.getBean().save(evo);

pnllogistics7a=# select*from party where system_id= 27213964;
-[ RECORD 1 ]----------------+------------------
system_id                    | 27213964
party_id                     | test2016041301

select * from party_in_group where party_systemid= 27213964;
-[ RECORD 1 ]--------+---------
party_systemid       | 27213964
party_group_systemid | 26791510

pnllogistics7a=# select*from party_group where system_id=26791510;
-[ RECORD 1 ]---------+----------------------------
system_id             | 26791510
party_group           | 11


/ 13	. 

/ we gaan naar party scherm, en open test2016041301, 	er wordt een form create	,
/s
package com.mpobjects.invoice.control.party.action;
PartyFormAction.act() line: 51	
		int mySystemId = getSystemIdFromRequest();
27213964
		if (partySystemId != 0) {
			PartyVO party = MpoBeanFactory.getBean(PartyDAO.class).getBySystemId(getSystemIdFromRequest());

/ proxy, uninitialized, maar we initialize hem, door  in Expressions party te geven	, (en hem te laten print , string in text area	, 

myVO	com.mpobjects.oms.model.party.vo.PartyVO_$$_javassist_21  (id=23648)	
	handler	org.hibernate.proxy.pojo.javassist.JavassistLazyInitializer  (id=23658)	
		target	com.mpobjects.oms.model.party.vo.PartyVO  (id=23682)	
			partyGroups	org.hibernate.collection.PersistentSet  (id=23700)	
[]
			partyGroupsAsString	null	
			partyId	"test2016041301" (id=23280)	
			partyType	com.mpobjects.oms.model.entity.partytype.PartyType_$$_javassist_181  (id=23705)	

/ Intermezzo

/ Waarom is partyGroups []	?

$ vi Party.standard.hbm.xml
		<set name="partyGroups" table="PARTY_IN_GROUP" >
			<cache usage="read-write" />
			<key>
				<column name="PARTY_SYSTEMID" />
			</key>
			<many-to-many column="PARTY_GROUP_SYSTEMID"	class="com.mpobjects.oms.model.partygroup.vo.PartyGroupVO" />
		</set>

select * from party_in_group where party_systemid= 27213964;
-[ RECORD 1 ]--------+---------
party_systemid       | 27213964
party_group_systemid | 26791510

pnllogistics7a=# select*from party_group where system_id=26791510;
-[ RECORD 1 ]---------+----------------------------
system_id             | 26791510
party_group           | 11

/ Einde Intermezzo

/ Intermezzo

/ we hebben de appl herstart	, 
/ we zien party.partyGroups=[11]. 
/ we remove party test2016041301 uit party group 11
/ In 
com.mpobjects.invoice.control.party.action.PartyFormAction.act
			PartyVO party = MpoBeanFactory.getBean(PartyDAO.class).getBySystemId(getSystemIdFromRequest());
/ zien we party.partyGroups=[11]. ERR

/ Einde Intermezzo

/ 13	. 

/ we add test2016041301 aan party group 12	,
/s
PartyGroupEditPanel$1.onSubmit(Button, AjaxRequestTarget, IModel<PartyGroupVO>) line: 137	
/=
public class PartyGroupEditPanel extends EvoEditPanel<PartyGroupVO> {
	protected void modifyActions(EntityFormActionBuilder<PartyGroupVO> aEntityFormActionBuilder) {
		EntityActionButton<PartyGroupVO> addBtn = new EntityActionAjaxButton<PartyGroupVO>("add", new ResourceModel("addParty")) {
			@Override
			protected void onSubmit(Button aButton, AjaxRequestTarget aTarget, IModel<PartyGroupVO> aSelection) {
				newPartyModel.setObject(null);
				partyLookupWindow.show(aTarget);
/s
PartyGroupEditPanel$6.createPage() line: 255	
/=
		partyLookupWindow.setPageCreator(new ModalWindow.PageCreator() {
			@Override
			public Page createPage() {
				return new ModalPartySearchPage(partyLookupWindow, newPartyModel, null);

/ we kiezen test2016041301 op modal window	,
/ we click edit button	,
/s
public class ModalPartySearchPage extends BasePage {
	public ModalPartySearchPage(final ModalWindow window, final IModel<Party> aModel, String aPartyTypeGroup) {
		EntityActionAjaxButton<PartyVO> action = new EntityActionAjaxButton<PartyVO>("ok") {
			@Override
			protected void onSubmit(Button aButton, AjaxRequestTarget aTarget, IModel<PartyVO> aSelection) {
				aModel.setObject(aSelection.getObject());
/s
GenericListElementModel(LoadableDetachableModel).getObject() line: 122	
		if (!attached)
		{
			attached = true;
			transientModelObject = load();

this	com.mpobjects.view.wicket.util.multi.GenericListElementModel  (id=22409)	
	transientModelObject	com.mpobjects.oms.model.party.vo.PartyVO_$$_javassist_21  (id=22421)	
		handler	org.hibernate.proxy.pojo.javassist.JavassistLazyInitializer  (id=22424)	
			target	com.mpobjects.oms.model.party.vo.PartyVO  (id=22430)	
				partyGroups	org.hibernate.collection.PersistentSet  (id=22435)	
					set	java.util.HashSet  (id=22464)	
						map	java.util.HashMap  (id=22468)	
							table	java.util.HashMap$Entry[1]  (id=22472)	
								[0]	java.util.HashMap$Entry  (id=22475)	
									key	com.mpobjects.oms.model.partygroup.vo.PartyGroupVO  (id=22477)	
com.mpobjects.oms.model.partygroup.vo.PartyGroupVO@100fa0b1[11,Klantgroep 11 Doedijns B.V.]
/ Dit is fout, nog steeds dezelfde	,

/t
ModalPartySearchPage$1.onSubmit(Button, AjaxRequestTarget, IModel<PartyVO>) line: 37	
				aModel.setObject(aSelection.getObject());
/d
				window.close(aTarget);

/ 13	. 

/ we herstart de appl	, 
/ we willen party groups open	, maar zien 	, bij open 2de party group	,

Unexpected RuntimeException

WicketMessage: org.apache.wicket.WicketRuntimeException: component query:rows:4:cell:0:cellvalue:2:link not found on page com.mpobjects.oms.view.wicket.party.PartyListPage[id = 1], listener interface = [RequestListenerInterface name=IBehaviorListener, method=public abstract void org.apache.wicket.behavior.IBehaviorListener.onRequest()]
/ Hij verwacht een andere page	,

/ 13	. 

/ test2016041301 zit in geen enkele party groups	, 
/ we add test2016041301 aan party group 11	,

/ stack trace	,

/ Vanaf (*) naar boven is steeds model.object=new PartyGroupVO()	,

/s
	EvoEditFormPage$1(EntityActionAjaxButton).createButtonInstance(IModel<T>, String) line: 43	
->		return new AjaxFallbackButton(aId, null) {
			@Override
			protected void onSubmit(AjaxRequestTarget aTarget, Form<?> aForm) {
				EntityActionAjaxButton.this.onSubmit(this, aTarget, aModel);
			}

	EvoEditFormPage$1(AbstractEntityActionButton).createButton(IModel<T>, String) line: 220	
		button = createButtonInstance(aModel, aId);

	EvoEditFormPage$1(EntityActionButton).createComponent(String, IModel<T>) line: 49	
		return new EntityABPanel(aComponentId, createButton(aModel, "button"));

	EntityFormActionBuilder(BaseActionBuilder).createActions(RepeatingView, IModel<T>) line: 75	
		for (EntityAction<T> action : actions) {
/ 6 actions
			Component component = action.createComponent(view.newChildId(), aModel);
component	AbstractEntityActionButton$EntityABPanel  (id=20526)	
/ Deze buttons doen niets met aModel, object=new PartyGroupVO()	,

	BaseActionBuilder$EntityActionPanel.<init>(String, BaseWebComponent, WebComponentEventSwitchBoard, IModel<T>) line: 34	
			createActions(view, aModel);

	EntityFormActionBuilder.build(String, CompoundPropertyModel<T>, WebComponentEventSwitchBoard, GenericFormPanel<T>) line: 38	
		return new EntityActionPanel(aId, aParent, aWebComponentEventSwitchBoard, aModel);

	PartyGroupEditPanel(GenericFormPanel).getActionsPanel(String, CompoundPropertyModel<T>) line: 187	
		return panelBuilder.build(componentId, model, webComponentEventSwitchBoard, this);

	PartyGroupEditPanel(GenericFormPanel).createPanel(CompoundPropertyModel<T>) line: 170	
		AbstractActionsPanel<T> actionPanel = getActionsPanel("actionPanel", model);

	PartyGroupEditPanel(EvoEditPanel).createPanel(CompoundPropertyModel<T>) line: 84	
			super.createPanel(aModel);

	PartyGroupEditPanel(EvoEditPanel).<init>(String, WebComponentEventSwitchBoard, FormActionsPanelBuilder<T>, BeanWrapper<EnumeratedValueObjectDAOInterface<T>>, EvoDataProperties) line: 54	
		super(id, null, webComponentEventSwitchBoard, null, formActionsPanelBuilder, aDaoWrapper);
/ creates new PartyGroupVO()	, = object in tempModel	,
/ TODO
		// call again, this time is will be executed for real
		createPanel(tempModel);
/ (*)

	PartyGroupEditPanel.<init>(String, WebComponentEventSwitchBoard, FormActionsPanelBuilder<PartyGroupVO>, BeanWrapper<EnumeratedValueObjectDAOInterface<PartyGroupVO>>, EvoDataProperties) line: 92	
		super(aId, aWebComponentEventSwitchBoard, aFormActionsPanelBuilder, aDaoWrapper, aDataProperties);

	PartyGroupEditFormPage.createEditPanel() line: 41	
		EntityFormActionBuilder<PartyGroupVO> panelBuilder = new EntityFormActionBuilder<PartyGroupVO>(getFormActions());
/d
/ save, cancel
->		editPanel = new PartyGroupEditPanel("editPanel", new WebComponentEventSwitchBoard(), panelBuilder, daoWrapper, dataProperties);

	PartyGroupEditFormPage(EvoEditFormPage).createPage() line: 143	
		createEditPanel();

	PartyGroupEditFormPage(EvoEditFormPage).<init>(EvoEditFormCallback, BeanWrapper<EnumeratedValueObjectDAOInterface<T>>, EvoDataProperties) line: 90	
		createPage();

	PartyGroupEditFormPage.<init>(EvoEditFormCallback, BeanWrapper<EnumeratedValueObjectDAOInterface<PartyGroupVO>>, EvoDataProperties) line: 32	
		super(aCallback, aDaoWrapper, aDataProperties);

	PartyGroupPage.getEditPage() line: 184	
			editPage = new PartyGroupEditFormPage(this, daoWrapper, dataProperties);

	PartyGroupPage$2.execute(Object) line: 128	
		RowAction editAction = new RowAction() {
			@Override
			public boolean execute(Object aObject) {
				final IModel<String> editPageTitle = new StringResourceModel("editEntity", PartyGroupPage.this, new Model<PartyGroupPage>(PartyGroupPage.this), "Update ${entityName}");
->				EvoEditFormPage<PartyGroupVO> page = getEditPage();

	RowActionPanel$1.onClick(AjaxRequestTarget) line: 41	
		link = new AjaxLink("link") {

			@Override
			public void onClick(AjaxRequestTarget aTarget) {
				anAction.setTarget(aTarget);
->				if (anAction.execute(anObject)) {

	AjaxLink$1.onEvent(AjaxRequestTarget) line: 68	
	AjaxLink$1(AjaxEventBehavior).respond(AjaxRequestTarget) line: 177	
	AjaxLink$1(AbstractDefaultAjaxBehavior).onRequest() line: 312	
	BehaviorRequestTarget.processEvents(RequestCycle) line: 157	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).processEvents(RequestCycle) line: 92	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1279	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/ 13	. 

PartyGroupEditPanel(GenericFormPanel).createPanel(CompoundPropertyModel<T>) line: 174	
		form = new GenericForm<T>("genericForm", model);
		add(form);
		AbstractActionsPanel<T> actionPanel = getActionsPanel("actionPanel", model);
		form.add(actionPanel);
		setForm(form);
/ add organization, panel with party's to form	,
/ TODO (WH We moeten deze dan ook in HTML met wicket:id opnemen, als user submit form, worden deze fields de post request param's	)


/ 13	. 

PartyGroupEditPanel(EvoEditPanel).<init>(String, WebComponentEventSwitchBoard, FormActionsPanelBuilder<T>, BeanWrapper<EnumeratedValueObjectDAOInterface<T>>, EvoDataProperties) line: 55	
		// call again, this time is will be executed for real
		createPanel(tempModel);
/d
this	PartyGroupEditPanel  (id=20670)	
	children	MarkupContainer$ChildList  (id=21162)	
		childs	Object[3]  (id=21230)	
			[0]	GenericForm  (id=20692)	
				LOG	Log4JLogger  (id=21164)	
				children	MarkupContainer$ChildList  (id=21165)	
				data	CompoundPropertyModel  (id=20679)	
					target	EntityDetachableModel  (id=20677)	
						attached	true	
						attachedVolatile	true	
						dao	BeanWrapper  (id=20673)	
						entity	PartyGroupVO  (id=20676)	
							systemId 0
						systemId	0	

/ Dus de form's model is een compound property model 	, met object=new PartyGroupVO()	,

/ 13	. 

/ we hebben party grouo 11 open/edit	, 
/s
PartyGroupPage$2.execute(Object) line: 130	
		RowAction editAction = new RowAction() {

			@Override
			public boolean execute(Object aObject) {
				final IModel<String> editPageTitle = new StringResourceModel("editEntity", PartyGroupPage.this, new Model<PartyGroupPage>(PartyGroupPage.this),
						"Update ${entityName}");
				EvoEditFormPage<PartyGroupVO> page = getEditPage();

page	PartyGroupEditFormPage  (id=1189)	
	editPanel	PartyGroupEditPanel  (id=4478)	
		children	MarkupContainer$ChildList  (id=19845)	
			childs	Object[3]  (id=19880)	
				[0]	GenericForm  (id=19568)	
					children	MarkupContainer$ChildList  (id=19849)	
					data	CompoundPropertyModel  (id=4506)	
						target	EntityDetachableModel  (id=4501)	
							attached	true	
							attachedVolatile	true	
							dao	BeanWrapper  (id=1191)	
							entity	PartyGroupVO  (id=4482)	
							systemId	0	

				page.setPageTitle(editPageTitle.getObject());
->				page.setEditRecord(daoWrapper.getBean().getBySystemId((Integer) aObject));
aObject=26791510

/ Intermezzo

/ 26791510 is party_group 11
/ 27213964 is party test2016041301

/ Einde Intermezzo
/s
PartyGroupEditFormPage(EvoEditFormPage).setEditRecord(T) line: 106	
		editPanel.setEditRecord(aEntity);
/s
PartyGroupEditPanel.setEditRecord(PartyGroupVO) line: 121	
/=
	public void setEditRecord(PartyGroupVO aRecord) {
aRecord=PartyGroupVO 11
/s
PartyGroupEditPanel(EvoEditPanel).setEditRecord(T) line: 68	
		setObject(record);
/s
PartyGroupEditPanel(GenericFormPanel).setObject(T) line: 244	
		form.setModelObject(null);

this	PartyGroupEditPanel  (id=4478)	
	children	MarkupContainer$ChildList  (id=19845)	
		childs	Object[3]  (id=19880)	
			[0]	GenericForm  (id=19568)	
				children	MarkupContainer$ChildList  (id=19849)	
				data	CompoundPropertyModel  (id=4506)	
					target	EntityDetachableModel  (id=4501)	
						attached	true	
						attachedVolatile	true	
						dao	BeanWrapper  (id=1191)	
						entity	null										<-
						systemId	0	

		form.setModelObject(object);

this	PartyGroupEditPanel  (id=4478)	
	children	MarkupContainer$ChildList  (id=19845)	
		childs	Object[3]  (id=19880)	
			[0]	GenericForm  (id=19568)	
				children	MarkupContainer$ChildList  (id=19849)	
				data	CompoundPropertyModel  (id=4506)	
					target	EntityDetachableModel  (id=4501)	
						entity	PartyGroupVO  (id=20126)	
							code	"11" (id=20131)	
							deleted	false	
							description	"Klantgroep 11 Doedijns B.V." (id=20132)	
							messages	PersistentSet  (id=20133)	
							organization	Organization  (id=20134)	
							parties	PersistentSet  (id=20135)	
							performanceMonitorService	null	
							systemId	26791510	
						systemId	26791510	

/t
PartyGroupEditPanel.setEditRecord(PartyGroupVO) line: 125	
		super.setEditRecord(aRecord);
/d
/ sets form's modelObject, 

		currentParties.clear();
		currentParties.addAll(aRecord.getParties());

this	PartyGroupEditPanel  (id=4478)	
aRecord	PartyGroupVO  (id=20126)	
	code	"11" (id=20131)	
	deleted	false	
	description	"Klantgroep 11 Doedijns B.V." (id=20132)	
	messages	PersistentSet  (id=20133)	
	organization	Organization  (id=20134)	
	parties	PersistentSet  (id=20135)	
[
[SystemId: 26683308; Party: 9879310; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@57214c94[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]], 
[SystemId: 26683215; Party: 9879380; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@57214c94[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]], 
[SystemId: 26683224; Party: 9879373; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@57214c94[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]], 
[SystemId: 26683410; Party: 9836368; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@57214c94[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]]]
	performanceMonitorService	null	
	systemId	26791510	
/ PARTY_GROUP'S PARTIES

		selectedParties.clear();
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/ sets this=PartyGroupEditPanel's form's modelObject=PartyGroupVO 11	, currentParties=PartyGroupVO 11's parties	,

/t
PartyGroupPage$2.execute(Object) line: 131	
				setResponsePage(page);
page	PartyGroupEditFormPage  (id=1189)	

/ Herinner, we hadden op edit PartyGroup 11 clicked in party group list	,

/ 13	. 

/ click 'Add party'
/s
	protected void modifyActions(EntityFormActionBuilder<PartyGroupVO> aEntityFormActionBuilder) {
		EntityActionButton<PartyGroupVO> addBtn = new EntityActionAjaxButton<PartyGroupVO>("add", new ResourceModel("addParty")) {
			@Override
			protected void onSubmit(Button aButton, AjaxRequestTarget aTarget, IModel<PartyGroupVO> aSelection) {

aSelection	CompoundPropertyModel  (id=4506)	
	target	EntityDetachableModel  (id=4501)	
		entity	PartyGroupVO  (id=20531)	
			code	"11" (id=20131)	
			deleted	false	
			description	"Klantgroep 11 Doedijns B.V." (id=20132)	
			messages	PersistentSet  (id=20550)	
			organization	Organization  (id=20551)	
			parties	PersistentSet  (id=20552)	
			performanceMonitorService	null	
			systemId	26791510	
		systemId	26791510	

->				newPartyModel.setObject(null);
				partyLookupWindow.show(aTarget);
/s
PartyGroupEditPanel$6.createPage() line: 255	

		// The following is a bit ugly, but good enough
		newPartyModel = new Model<Party>();
		partyLookupWindow = new ModalWindow("partyLookupWindow");
		partyLookupWindow.setPageMapName("partyLookup");
		aForm.add(partyLookupWindow);
/Eerder
/ TODO (Waarom partyLookupWindow add aan form? Als we select een party in modal window, wordt dan submit grote form gedaan?) 

		partyLookupWindow.setPageCreator(new ModalWindow.PageCreator() {
			@Override
			public Page createPage() {
->				return new ModalPartySearchPage(partyLookupWindow, newPartyModel, null);
newPartyModel	Model  (id=19914)	
	object	null	

/ we kiezen test2016041301	, en click (edit) button	,
/s
	public ModalPartySearchPage(final ModalWindow window, final IModel<Party> aModel, String aPartyTypeGroup) {
		EntityActionAjaxButton<PartyVO> action = new EntityActionAjaxButton<PartyVO>("ok") {
			@Override
			protected void onSubmit(Button aButton, AjaxRequestTarget aTarget, IModel<PartyVO> aSelection) {
				aModel.setObject(aSelection.getObject());
/ WAS	,
this	ModalPartySearchPage$1  (id=20618)	
	val$aModel	Model  (id=19914)	
		object	null	
/ NU	,
this	ModalPartySearchPage$1  (id=20618)	
	val$aModel	Model  (id=19914)	
		object	PartyVO_$$_javassist_21  (id=20744)	
			handler	JavassistLazyInitializer  (id=20821)	
				target	PartyVO  (id=20889)	
[SystemId: 27213964; Party: test2016041301; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@346abe1d[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]]

/c
		newPartyModel = new Model<Party>();
	partyLookupWindow.setPageCreator(new ModalWindow.PageCreator() {
			@Override
			public Page createPage() {
				return new ModalPartySearchPage(partyLookupWindow, newPartyModel, null);
			}
		});
/ Eerder	,
PartyGroupEditPanel$7.onClose(AjaxRequestTarget) line: 261	
		partyLookupWindow.setWindowClosedCallback(new ModalWindow.WindowClosedCallback() {
			@Override
			public void onClose(AjaxRequestTarget aTarget) {
->				if (newPartyModel.getObject() == null) {
/ Nu	,

this	PartyGroupEditPanel$7  (id=22167)	
	this$0	PartyGroupEditPanel  (id=4478)	
		newPartyModel	Model  (id=19914)	
			object	PartyVO_$$_javassist_21  (id=20744)	
				handler	JavassistLazyInitializer  (id=20821)	
					target	PartyVO  (id=20889)	
[SystemId: 27213964; Party: test2016041301; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@346abe1d[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]]

/ Intermezzo

/ In PartyGroupEditPanel wordt zowat alles bewaard	, dus de form met modelObject=PartyGroupVO	, en de newPartyModel=selected PartyVO	, die moet worden add aan form's modelObject	, currentParties=parties uit de PartyGroupVO 11	, in .setRecord	,  -> parties 
/ partyContainer (TODO)

this	PartyGroupEditPanel$7  (id=22167)	
	this$0	PartyGroupEditPanel  (id=4478)	
		form	GenericForm  (id=19568)	
			data	Object[2]  (id=22284)	
				[0]	CompoundPropertyModel  (id=4506)	
					target	EntityDetachableModel  (id=4501)	
						attached	true	
						attachedVolatile	true	
						dao	BeanWrapper  (id=1191)	
						entity	PartyGroupVO  (id=22286)	
						systemId	26791510	
				[1]	MetaDataEntry  (id=22285)	
		newPartyModel	Model  (id=19914)	
			object	PartyVO_$$_javassist_21  (id=20744)	
				handler	JavassistLazyInitializer  (id=20821)	
					target	PartyVO  (id=20889)	

/ Einde Intermezzo

				if (!currentParties.contains(newPartyModel.getObject())) {
					currentParties.add(newPartyModel.getObject());
				aTarget.addComponent(partyContainer);

/c
		partyContainer = new WebMarkupContainer("partyContainer");
		partyContainer.setOutputMarkupId(true);
		partyContainer.add(partySelection);
		aForm.add(partyContainer);
PartyGroupEditPanel$5.populateItem(Item<Party>) line: 226	
		final DataView<Party> parties = new DataView<Party>("parties", partiesDataProvider) {
			@Override
			protected void populateItem(Item<Party> aItem) {
				// zebra stripe
->				aItem.add(new AttributeAppender("class", true, new Model<String>(aItem.getIndex() % 2 == 0 ? "even" : "odd"), " "));

/ Staan de parties nou in partyContainer of in parties	?
/ TODO
...

/ 13	. 

/ click Save Party Group	,
/s
EvoEditFormPage$1.onSubmit(Button, AjaxRequestTarget, IModel<T>) line: 165	
/=
			protected void onSubmit(Button aButton, AjaxRequestTarget aTarget, IModel<T> aSelection) {

aSelection	CompoundPropertyModel  (id=4506)	
	target	EntityDetachableModel  (id=4501)	
		systemId	26791510	
		entity	PartyGroupVO  (id=22538)	
			parties	PersistentSet  (id=22555)	
				set	null	
/ See PARTY_GROUP'S PARTIES	, daar was parties  de list van 4 parties	,
					evo = saveOrCreateEvo(evo);
/s
PartyGroupEditFormPage.saveOrCreateEvo(PartyGroupVO) line: 48	
		updateParties(aEvo);
/s
PartyGroupEditFormPage.updateParties(PartyGroupVO) line: 60	
		myVO.setParties(new HashSet<PartyVO>());
/ WAS lege PersistentSet	,
		PartyGroupEditPanel myPanel = (PartyGroupEditPanel) editPanel;
		for (Party myParty : myPanel.getCurrentParties()) {
/ Klopt, 5 parties	, dus + onze nieuwe	,
			myVO.getParties().add(myDao.getBean().getBySystemId(myParty.getSystemId()));
/t
PartyGroupEditFormPage.saveOrCreateEvo(PartyGroupVO) line: 49	
		updateParties(aEvo);
		return super.saveOrCreateEvo(aEvo);
/s
PartyGroupEditFormPage(EvoEditFormPage).saveOrCreateEvo(T) line: 218	
		} else {
			return daoWrapper.getBean().save(evo);

this	PartyGroupEditFormPage  (id=1189)	
evo	PartyGroupVO  (id=22538)	
	code	"11" (id=20131)	
	deleted	false	
	description	"Klantgroep 11 Doedijns B.V." (id=20132)	
	messages	HashSet  (id=22827)	
	organization	Organization  (id=22553)	
	parties	HashSet  (id=22804)	
[
[SystemId: 26683308; Party: 9879310; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@3a9aa78b[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]], 
[SystemId: 26683224; Party: 9879373; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@3a9aa78b[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]], 
[SystemId: 26683215; Party: 9879380; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@3a9aa78b[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]], 
[SystemId: 27213964; Party: test2016041301; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@3a9aa78b[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]], 
[SystemId: 26683410; Party: 9836368; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@3a9aa78b[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]]]
	performanceMonitorService	null	
	systemId	26791510	

/ 13	. 

/ Terug op PartyGroupPage	, we willen edit PartyGroupVO 12	, en add PartyVO test2016041301	, 
/s
PartyGroupPage.getEditPage() line: 186	
		if (editPage == null) {
/ NEE, is er al	,

this	PartyGroupPage  (id=1175)	
	editPage	PartyGroupEditFormPage  (id=1189)	
		editPanel	PartyGroupEditPanel  (id=4478)	
			currentParties	ArrayList  (id=19847)	
[
[SystemId: 26683308; Party: 9879310; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@57214c94[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]], 
[SystemId: 26683215; Party: 9879380; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@57214c94[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]], 
[SystemId: 26683224; Party: 9879373; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@57214c94[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]], 
[SystemId: 26683410; Party: 9836368; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@57214c94[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]], 
[SystemId: 27213964; Party: test2016041301; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@346abe1d[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]]
]
			form	GenericForm  (id=19568)	
				LOG	Log4JLogger  (id=19570)	
				children	Object[11]  (id=22283)	
				data	CompoundPropertyModel  (id=4506)	
					target	EntityDetachableModel  (id=4501)	
						attached	false	
						attachedVolatile	false	
						dao	BeanWrapper  (id=1191)	
						entity	null									<-
						systemId	26791510	
			newPartyModel	Model  (id=19914)	
				object	PartyVO_$$_javassist_21  (id=20744)
[SystemId: 27213964; Party: test2016041301; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@346abe1d[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]]	

/ dit is alles oude data	,
/ we zien currentParties van PartyGroupVO 11	, en we edit nu PartyGroupVO 12	,
/ form heeft modelObject=null 	TODO
/ newPartyModel.object=PartyVO test2016041301	, maar misschien willen we nu een andere party add	,

/t
PartyGroupPage$2.execute(Object) line: 129	
/=
		RowAction editAction = new RowAction() {
			@Override
			public boolean execute(Object aObject) {
				final IModel<String> editPageTitle = new StringResourceModel("editEntity", PartyGroupPage.this, new Model<PartyGroupPage>(PartyGroupPage.this), "Update ${entityName}");
				EvoEditFormPage<PartyGroupVO> page = getEditPage();
/d
page.editPanel.form.data.entity=null	, helemaal geen PartyGroupVO met parties=null	,
/ TODO
				page.setPageTitle(editPageTitle.getObject());
				page.setEditRecord(daoWrapper.getBean().getBySystemId((Integer) aObject));
aObject=27203793	, systemId van PartyGroupVO 12	,
daoWrapper.getBean().getBySystemId((Integer) aObject)=PartyGroupVO	, met parties OK	, nieuwe PartyGroupVO inst!
/s
PartyGroupEditFormPage(EvoEditFormPage).setEditRecord(T) line: 106	
		editPanel.setEditRecord(aEntity);
anEntity=com.mpobjects.oms.model.partygroup.vo.PartyGroupVO@1f28e01e[12,Klantgroep 12 Convidien]
/s
PartyGroupEditPanel.setEditRecord(PartyGroupVO) line: 121	
		super.setEditRecord(aRecord);
/ sets form's modelObject=aRecord=PartyGroupVO 12	, met parties=PersistentSet	, met aantal parties	, OK	,
		currentParties.clear();
		currentParties.addAll(aRecord.getParties());
/ 3 parties	,
/ PARTY_GROUP'S PARTIES
		selectedParties.clear();

/t
PartyGroupPage$2.execute(Object) line: 131	
				page.setEditRecord(daoWrapper.getBean().getBySystemId((Integer) aObject));
				setResponsePage(page);
				return false;

/ 1313	. 


/ click 'Add party'	,
/s
PartyGroupEditPanel$1.onSubmit(Button, AjaxRequestTarget, IModel<PartyGroupVO>) line: 137	
/=
	protected void modifyActions(EntityFormActionBuilder<PartyGroupVO> aEntityFormActionBuilder) {
		EntityActionButton<PartyGroupVO> addBtn = new EntityActionAjaxButton<PartyGroupVO>("add", new ResourceModel("addParty")) {
			@Override
			protected void onSubmit(Button aButton, AjaxRequestTarget aTarget, IModel<PartyGroupVO> aSelection) {
				newPartyModel.setObject(null);
/ reset	,
				partyLookupWindow.show(aTarget);
/s
PartyGroupEditPanel$6.createPage() line: 255	
/=
		partyLookupWindow.setPageCreator(new ModalWindow.PageCreator() {
			@Override
			public Page createPage() {
				return new ModalPartySearchPage(partyLookupWindow, newPartyModel, null);

/ Kies test2016041301	, en click button	,
/s
ModalPartySearchPage$1.onSubmit(Button, AjaxRequestTarget, IModel<PartyVO>) line: 36	
/=
	public ModalPartySearchPage(final ModalWindow window, final IModel<Party> aModel, String aPartyTypeGroup) {
		EntityActionAjaxButton<PartyVO> action = new EntityActionAjaxButton<PartyVO>("ok") {
			@Override
			protected void onSubmit(Button aButton, AjaxRequestTarget aTarget, IModel<PartyVO> aSelection) {
->				aModel.setObject(aSelection.getObject());
				window.close(aTarget);

/ Intermezzo

/ WAS	,
this	ModalPartySearchPage$1  (id=23742)	
	val$aModel	Model  (id=19914)	
		object	null	

aSelection	GenericListElementModel  (id=23743)	
	LOG	Log4JLogger  (id=23761)	
	attached	false	
	id	Integer  (id=23762)		27213964	/ test2016041301 party	,
	transientModelObject	null	
	wrapper	BeanWrapper  (id=23763)	

/ aSelection.transientObjectModel=null, maar wordt door .getObject met load() set	,

/ NU	,

this	ModalPartySearchPage$1  (id=23742)	
	val$aModel	Model  (id=19914)	
		object	PartyVO_$$_javassist_21  (id=23786)	
[SystemId: 27213964; Party: test2016041301; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@a5b22e[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]]

aSelection	GenericListElementModel  (id=23743)	
	id	Integer  (id=23762)	
	transientModelObject	PartyVO_$$_javassist_21  (id=23786)	
[SystemId: 27213964; Party: test2016041301; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@a5b22e[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]]
	wrapper	BeanWrapper  (id=23763)	

/ Einde Intermezzo

/c
PartyGroupEditPanel$7.onClose(AjaxRequestTarget) line: 261	
		partyLookupWindow.setWindowClosedCallback(new ModalWindow.WindowClosedCallback() {
			@Override
			public void onClose(AjaxRequestTarget aTarget) {
				if (!currentParties.contains(newPartyModel.getObject())) {
					currentParties.add(newPartyModel.getObject());
				aTarget.addComponent(partyContainer);
				aTarget.addComponent(feedbackPanel);
/c
PartyGroupEditPanel$5.populateItem(Item<Party>) line: 226	
/=
		final DataView<Party> parties = new DataView<Party>("parties", partiesDataProvider) {
			@Override
			protected void populateItem(Item<Party> aItem) {

/ TODO (partiesDataProvider) 

/ Intermezzo

this	PartyGroupEditPanel$5  (id=19604)	
	this$0	PartyGroupEditPanel  (id=4478)	
		form	GenericForm  (id=19568)	
			data	Object[2]  (id=23862)	
				[0]	CompoundPropertyModel  (id=4506)	
					target	EntityDetachableModel  (id=4501)	
						attached	true	
						attachedVolatile	true	
						dao	BeanWrapper  (id=1191)	
						entity	PartyGroupVO  (id=23864)	
com.mpobjects.oms.model.partygroup.vo.PartyGroupVO@6f57f751[12,Klantgroep 12 Convidien]
						systemId	27203793	
				[1]	MetaDataEntry  (id=23863)	

/ Einde Intermezzo

/ 1313	. 

/ Save PartyGroup 12	,

/s
EntityActionAjaxButton$1.onSubmit(AjaxRequestTarget, Form<?>) line: 56	
/=
	@Override
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new AjaxFallbackButton(aId, null) {
			@Override
			protected void onSubmit(AjaxRequestTarget aTarget, Form<?> aForm) {
				EntityActionAjaxButton.this.onSubmit(this, aTarget, aModel);

/ Intermezzo

/ we zien dat aModel en aForm's modelObject = PartyGroupVO 12	, met target PartyGroupVO 12	, maar deze heeft parties PersistentSet.set=null
/ TODO
/ See PARTY_GROUP'S PARTIIES

/ Einde Intermezzo

/s
EvoEditFormPage$1.onSubmit(Button, AjaxRequestTarget, IModel<T>) line: 166	
/=
	protected Collection<EntityAction<T>> getFormActions() {
		EntityActionButton<T> saveBtn = new EntityActionAjaxButton<T>("ok", new ResourceModel("save")) {
			@Override
			protected void onSubmit(Button aButton, AjaxRequestTarget aTarget, IModel<T> aSelection) {
				T evo = aSelection.getObject();
evo=PartyGroupVO 12	, met parties=PersistentSet, parties.set=null
				if (dataProperties.isCodeUpperCaseOnly()) {

					evo = saveOrCreateEvo(evo);
/s
PartyGroupEditFormPage.saveOrCreateEvo(PartyGroupVO) line: 48	
		updateParties(aEvo);
/s
PartyGroupEditFormPage.updateParties(PartyGroupVO) line: 60	
		myVO.setParties(new HashSet<PartyVO>());
		PartyGroupEditPanel myPanel = (PartyGroupEditPanel) editPanel;
		for (Party myParty : myPanel.getCurrentParties()) {
			myVO.getParties().add(myDao.getBean().getBySystemId(myParty.getSystemId()));
		}
[
[SystemId: 27203759; Party: 10470620; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@ebed3ec[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]], 
[SystemId: 27213964; Party: test2016041301; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@ebed3ec[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]], 
[SystemId: 27203780; Party: 10470621; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@ebed3ec[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]], 
[SystemId: 27203789; Party: 10470622; PartyType: com.mpobjects.oms.model.entity.partytype.PartyType@ebed3ec[OPDRACHTGEVER,Opdrachtgever (Bill to Party)]]]
/t
PartyGroupEditFormPage.saveOrCreateEvo(PartyGroupVO) line: 49	
		updateParties(aEvo);
/d
		return super.saveOrCreateEvo(aEvo);
/ OK

/ Intermezzo

/ SAMENVATTING EDIT & SAVE PARTY GROUP

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

/ MORGENOCHTEND

/ Kies op party group list page party group 13	, click edit button	,
/ PartyGroupPage this heeft PartyGroupEditFormPage editPage, die heeft PartyGroupEditPanel editPanel, en	,
editPanel.form.data=CompoundPropertyModel	, en heeft target=EntityDetachableModel, heeft entity=null
/ TODO

/ In PartyGroupEditPanel.setEditRecord wordt de nieuwe maar goede PartyGroupVO (met parties) set tot form's modelObject,	

/ click 'Add Party'	, dan wordt de selected party add aan PartyGroupEditPanel.currentParties	,

/ als we save	, zien we de CompoundPropertyModel van de form,	 target.entity=PartyGroupVO, parties=PersistentSet, set=null	,
/ Maar toch worden de PartyGroupEditPanel.currentParties in deze parties set	, en wordt de PartyGroupVO saved	, OK	,

/ Einde Intermezzo

/ 13	. 

/ Edit party test2016041301


/s
package com.mpobjects.oms.control.party.action;
public class PartyFormAction extends AbstractAction {
		if (mySystemId == 0) {
27213964	/ system id van de party test2016041301
		} else {
			myVO = MpoBeanFactory.getBean(PartyDAO.class).getBySystemId(getSystemIdFromRequest());
/*
			myPartyGroupAddVO = new PartyGroupAddVO(myVO.getPartyGroups());
/**

/ Intermezzo

/  we waren een belangrijke eig. van Hibernate vergeten	,
/ myVO is een proxy	, 
myVO.handler.target=null
/ Als je in Eclipse's Display myVO inspect	, of in Expressions	, dan is myVO.handler.target=PartyVO	, maar PartyVO's set=null
/ We moeten explicit myVO.getPartyGroups() dus vragen om de set	, deze wordt dan queried	,

/ Einde Intermezzo

/s
PartyGroupAddVO.<init>(Collection) line: 39	
/=
	public PartyGroupAddVO(Collection aPartyGroupList) {
aPartyGroupList
[com.mpobjects.oms.model.partygroup.vo.PartyGroupVO@35b5b40d[13,Klantgroep 13 Wial], 
com.mpobjects.oms.model.partygroup.vo.PartyGroupVO@61585bdc[11,Klantgroep 11 Doedijns B.V.], 
com.mpobjects.oms.model.partygroup.vo.PartyGroupVO@556fa228[100,Klantgroep 100 Weleda], 
com.mpobjects.oms.model.partygroup.vo.PartyGroupVO@59deb45d[12,Klantgroep 12 Convidien]]

/t
PartyFormAction.act() line: 55	
		if (mySystemId != 0) {
			myPartyGroupAddVO = new PartyGroupAddVO(myVO.getPartyGroups());
		}
		getSession().setAttribute("partyAddFormVO", myPartyGroupAddVO);











 




 





 

















































/ Einde CREATE PARTY

You are trying to use a connection factory that has been shut down: ManagedConnectionFactory is null.); nested exception is org.jboss.util.NestedSQLException: You are trying to use a connection factory that has been shut down: ManagedConnectionFactory is null.; - nested throwable: (javax.resource.ResourceException: You are trying to use a connection factory that has been shut down: ManagedConnectionFactory is null.) 

/ SET VIRTUAL PARTY

/ 7	. 

$ vi AbstractPary.java
public abstract class AbstractParty extends EntityDetailSupport implements Party {

	public String getPartyGroupAsString() {

...
/ OK

/ stack trace	,
/s
	VirtualParty(AbstractParty).getPartyGroupAsString() line: 304	
	PathCriteriumVO.match(ShipmentOrderVO) line: 235	
		Object myValue = myContext.getValue(theImplementationClass);
this	PathCriteriumVO  (id=19911)	
	theImplementationClass	"billToPartyVO/partyGroupAsString" (id=20429)	

	PathTemplateVO.matchesWith(ShipmentOrderVO) line: 273	
	PathServiceImpl.getPathsFor(Resource, ShipmentOrderVO, PathSelectionMode, int) line: 308	
	PathServiceImpl.getPathsFor(Resource, ShipmentOrderVO) line: 251	
	PathServiceImpl.getPathsFor(ShipmentOrderVO) line: 119	
	PathAssignmentPickOptimalService(AutomaticPathAssignmentService).getPathTemplateList(ShipmentOrderVO) line: 148	
	PathAssignmentPickOptimalService(AutomaticPathAssignmentService).assignPath(ShipmentOrderVO) line: 61	

	ShipmentOrderSaveAction(ShipmentOrderSaveAction).handleSave() line: 112	
	ShipmentOrderSaveAction.handleSave() line: 19	
	ShipmentOrderSaveAction(AbstractSaveAction).act() line: 69	
	ShipmentOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	

/ debug	, 
/s
	VirtualParty(AbstractParty).getPartyGroupAsString() line: 304	
		if (partyGroupsAsString == null) {
/ JA
			@Bug(value = "SCS-4787", comment = "For backwards compality for DSVFMS. But semantically this is wrong.")
			Collection<PartyGroupVO> myPartyGroups = getPartyGroups();
[com.mpobjects.oms.model.partygroup.vo.PartyGroupVO@252b2c79[999,Klantgroep 999 Cargo totaal]]
/ ERR 

/ 7	. 

/ we change billto party	,

/ we kiezen party	,
[SystemId: 26681517; Party: 9883921; PartyType: null]

/s
LegacyPartySelect$1.onSubmit(Button, AjaxRequestTarget, IModel<MasterDataParty>) line: 107	
				aTarget.appendJavascript("PopulatePartyFields('" + fieldId + "', '" + populatePrefix + "', " + generatePartyJson(aSelection.getObject()) + ");");
/s
LegacyPartySelect.generatePartyJson(MasterDataParty) line: 64	
			data.put("PartyId", aParty.getPartyId());
/s
/ TODO
PartyVO(AbstractParty).setPartyGroups(Set<PartyGroupVO>) line: 526	
[SystemId: 26681517; Party: 9883921; PartyType: null]
		this.partyGroups = partyGroups;
[com.mpobjects.oms.model.partygroup.vo.PartyGroupVO@6b76894d[999,Klantgroep 999 Cargo totaal], 
com.mpobjects.oms.model.partygroup.vo.PartyGroupVO@33305559[4,Klantgroep 4 DSV/Inzake De'Longhi]]





/ Einde SET VIRTUAL PARTY

/ FIX PCT-1234

Always let a virtual party retrieve the list op party groups of the corresponding master data party. Do not let the virtual party keep a list of party groups, because these can change on the master data party.

public abstract class AbstractParty extends EntityDetailSupport implements Party {
	@Override
	public String getPartyGroupAsString() {
		if (partyGroupsAsString == null) {
			Collection<PartyGroupVO> myPartyGroups;
			myPartyGroups = MpoBeanFactory.getBean(PartyGroupDAO.class).getGroupsForParty(this);


$ vi PartyGroupDAOImpl.java

/ NATIVE QUERY IN HIBERNATE

		String myQuery = "SELECT pg.* FROM PARTY p, PARTY_IN_GROUP pig, PARTY_GROUP pg "
				+ " WHERE p.party_id = :partyId AND p.is_deleted = 0 AND pig.party_systemid = p.system_id AND pig.party_group_systemid = pg.system_id AND pg.is_deleted = 0";
		List<PartyGroupVO> myList = executeSqlSelect(myQuery, "pg", params);
		return myList;

/ Hoe VirtualParty in mem ? Met die list van party groups	, de list die ik verwijderd heb?
/ TODO


/ Einde FIX PCT-1234



/ Einde PARTIES

/ PCT-1181

/ BREAKPOINTS
/ rm
AbstractParty.setPartyGroups
AbstractParty.getPartyGroupAsString
AbstractAction.
SetFormVOTag.doStartTag
SetFormVOTag.doEndTag
SetFormVOTag.getForm
BoundSaveAction.getFetchedData

/ pnllogistics7a
/ sho SH000144571

/ 13	. 


/ we open de sho	,
../oms/shipment-order_edit
{returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:10::::, systemid=26988637, base_sessionLevelOffset=3, systemId=26988637}
/ Die 3 hebben we zelf set	, om te kijken wat het doet	, mmaar daar  gebeurt niets mee	,
/ TODO
/ 13	

/ Maak nieuw (1ste ) shi	,
/ Save shipment item

/ In HTML	,
<input type="button" name="saveShipmentItemBtn" id="saveShipmentItemBtn" value="Save Shipment item" onclick=" theShipmentorderFormManager.submit('../oms/shipment-item_save-shipment-item', false, 0);">

/ click Save shipment item	,
/s
$ less class.shipment-order_edit.js
ShipmentOrderEdit.saveShipmentItem = function() {
	var myRedirectLevelOffset=0;
    theShipmentorderFormManager.submit("../oms/shipment-item_save", false, myRedirectLevelOffset);
}

/ Intermezzo

/ Waarom vallen we in deze method?

function shipmentOrderCorrectLocations() {
    if (mySaveShipmentItemBtn!=null) {
        mySaveShipmentItemBtn.onclick = ShipmentOrderEdit.saveShipmentItem;
    }
/ TODO (Eerder pageclassrequests.js:PageRequest.processGenericClassEvents  )

/ Einde Intermezzo

/ Intermezzo

/ base_seesionLevelOffset=0 : we willen op de shipment-order_edit.jsp blijven	, 

/ Ook in oms-sitemap.xmap: <map:parameter name="noRedirect" value="true"/>	, dus ShipmentOrderSaveAction(AbstractSaveActionA).afterSave doet NIETS	, 
/ en we komen in ShipmentItemSaveAction(AbstractSaveAction).afterSave	, die level+0 =level , dus blijven we op dezelfde page	,


/ Einde Intermezzo

/s
$ class.formmanager.js
function FormManager(aFormName) {
   this.submit = function(anAction, aBoolDoRedirect, aRedirectionLevelOffset) {
this:FormManager
/ TODO (Wat betekent dit nou?)

        this.lastAction = anAction;
"../oms/shipment-item_save"
        this.lastDoRedirect = aBoolDoRedirect;
false
        document.getElementById("base_sessionLevelOffset").value=aRedirectionLevelOffset;
0
		document.getElementById("doRedirect").value=aBoolDoRedirect;
false

/ we zien de URL
Request URL:http://localhost:8080/tms/oms/shipment-item_save

Form Data
continuationId:1460977368007
flowDefinition:reload
redirectTo:../core/back?levelOffset=-1
doRedirect:false
base_sessionLevelOffset:0	/ set in JS	, omdat het een POST is	, is later getRequest.getParameter(("base_sessionLevelOffset")=0, en kijkt .saveAfter niet naar de redirectTo	,
base_windowToOpenUrl:
base_windowToOpenHeight:
base_windowToOpenWidth:
base_windowToOpenTitle:
base_windowToOpenScrollbar:
sho_systemid:26988637
si_systemid:
organization:PNL-CARGO
orderProcess:LB
...
/c
/ In Java	,
/s
ShipmentOrderSaveAction(BoundSaveAction).afterSave() line: 71	
		if (shouldTakeControl()) {
/ NEE
/ .afterSave doet dan ook niets	,
/ want	,
/s
ShipmentOrderSaveAction(AbstractSaveAction).shouldTakeControl() line: 554	
		return !getParameters().isParameter("noRedirect");
/ !true=false

/ Intermezzo

/ er zijn 2 parameters	,

$ less oms-sitemap.xmap

			<map:match pattern="shipment-item_save">
				<map:act type="shipmentOrderSave">
					<map:parameter name="noRedirect" value="true"/>
					<map:parameter name="skipFieldPrefix" value="productItem"/>
				</map:act>
				<map:act type="shipmentItemSave"/>
			</map:match>

/ Einde Intermezzo

/ Intermezzo

/ AbstractSaveAction.getRedirectUrl	,
			int myLevelOffset = getRequestManager().parseLevel("base_sessionLevelOffset")
/ als 1 	, dan pakt hij redirectTo:../core/back?levelOffset=-1
/ anders 		int myTargetLevel = getRequestManager().getLevel() + myLevelOffset;, en pakt hij de url in deze level	, en sets er params achter	, ook base_sessionLevelOffset TODO

/ Einde Intermezzo

/t
ShipmentOrderSaveAction(BoundSaveAction).afterSave() line: 82	
		if (shouldTakeControl()) {
/d
		if (removeContinuation) {
			getSession().removeAttribute(getContinuationId() + "_form");

			super.afterSave();
/ NIETS	, 
/ want shouldTakeControl()=false

/c
ShipmentItemSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
...
/c
/s
ShipmentItemSaveAction(BoundSaveAction).afterSave() line: 65	
		if (removeContinuation) {
			getSession().removeAttribute(getContinuationId() + "_form");
		}
		if (callParent) {
			super.afterSave();
/s
ShipmentItemSaveAction(AbstractSaveAction).afterSave() line: 159	
		if (shouldTakeControl()) {
/ JA
				myRedirectUrl = getRedirectUrl();
/s
ShipmentItemSaveAction(AbstractSaveAction).getRedirectUrl() line: 473	
			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
0
			} else {
				int myTargetLevel = getRequestManager().getLevel() + myLevelOffset;
5
/ TODO
				BaseRequest myTargetRequest = getRequestManager().getRequestForLevel(myTargetLevel);
				myRet = myTargetRequest.getUrl();
../oms/shipment-order_edit
				Map<String, String> myMap = new HashMap<String, String>(myTargetRequest.getParams());
myTargetRequest.getParams().getParams()= {
returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:10::::, 
systemid=26988637, 
base_sessionLevelOffset=3, 
systemId=26988637}

				for (Enumeration myEnumeration = getRequest().getParameterNames(); myEnumeration.hasMoreElements();) {
					myKey = (String) myEnumeration.nextElement();
					if (myKey.startsWith("base_")) {
						myMap.put(myKey, getRequestParameter(myKey));
myMap= {
returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:10::::, 
systemid=26988637, 
base_windowToOpenUrl=, 
base_windowToOpenTitle=, 
base_sessionLevelOffset=0, 
systemId=26988637, 
base_windowToOpenScrollbar=, 
base_windowToOpenHeight=, 
base_windowToOpenWidth=}
				myMap.put(RequestManager.SESSION_LEVEL_OFFSET, myLevelOffsetStr);
0
				myRet = getRequestUrl(myRet, myMap);
../oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:10::::&systemid=26988637&base_windowToOpenUrl=&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988637&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=

/t
ShipmentItemSaveAction(AbstractSaveAction).afterSave() line: 162	
				myRedirectUrl = getRedirectUrl();
/d
			getRequest().setAttribute("redirectTo", myRedirectUrl);
			RedirectSaveAction.redirect(getRedirector(), getRequest(), myRedirectUrl);
/s
				redirect(aRedirector, aRequest, anUrl, 0);
/s
RedirectSaveAction.redirect(Redirector, Request, String, int) line: 44	
/=
	public static void redirect(Redirector aRedirector, Request aRequest, String anUrl, int aLevelOffset) {
anUrl	"../oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:10::::&systemid=26988637&base_windowToOpenUrl=&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988637&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=" (id=25275)	
aLevelOffset	0	

		for (Enumeration myEnum = aRequest.getParameterNames(); myEnum.hasMoreElements();) {
/ Alle params	,
/ TODO
			myParameterName = (String) myEnum.nextElement();

			if (myParameterName.startsWith("base_") && StringUtils.isNotEmpty(aRequest.getParameter(myParameterName))) {
				myRememberedParamList.add(myParameterName + "=" + aRequest.getParameter(myParameterName));
[base_sessionLevelOffset=0]

		if (myRememberedParamList.size() > 0) {
			String mySeperator;
			if (anUrl.indexOf('?') > 0) {
				mySeperator = "&";

			anUrl += mySeperator + StringUtils.implode(myRememberedParamList.toArray(), "&");
../oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:10::::&systemid=26988637&base_windowToOpenUrl=&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988637&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=0

		aRequest.setAttribute("redirectTo", anUrl);
			String myRedirectPage = "../core/generic_save_redirect?redirectTo=" + URLEncoder.encode(anUrl, "UTF-8");

			aRedirector.redirect(true, myRedirectPage);

/ Einde Java	,

/ we zien in devtools	,

Request URL:http://localhost:8080/tms/core/generic_save_redirect?redirectTo=..%2Foms%2Fshipment-order_edit%3FreturnUrl%3Dhttp%3A%2F%2Flocalhost%3A8080%2Ftms%2Fwicket%2F%3Fwicket%3Ainterface%3D%3A10%3A%3A%3A%3A%26systemid%3D26988637%26base_windowToOpenUrl%3D%26base_windowToOpenTitle%3D%26base_sessionLevelOffset%3D0%26systemId%3D26988637%26base_windowToOpenScrollbar%3D%26base_windowToOpenHeight%3D%26base_windowToOpenWidth%3D%26base_sessionLevelOffset%3D0

Query String parameters
/=
redirectTo:../oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:10::::&systemid=26988637&base_windowToOpenUrl=&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988637&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=0

/ via JS
/ TODO
Request URL:http://localhost:8080/tms/oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:10::::&systemid=26988637&base_windowToOpenUrl=&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988637&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=0&randomizingurl=1460983094458

/ Op server	,
/s
ShipmentOrderEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
getRequestManager().getLevel()=5

/ 13

/ we save de sho	, 
/ hij plans in	, 
/ en dan	,
/s
ShipmentOrderSaveAction(BoundSaveAction).afterSave() line: 65	
		if (removeContinuation) {
			getSession().removeAttribute(getContinuationId() + "_form");
		}

		if (callParent) {
			super.afterSave();
/s
ShipmentOrderSaveAction(AbstractSaveAction).afterSave() line: 153	
				myRedirectUrl = getRedirectUrl();
/s
ShipmentOrderSaveAction(AbstractSaveAction).getRedirectUrl() line: 473	
			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
0
/ Dat zien we in de sho edit url hier vlak boven	,
/ We blijven op de page	, want myLevelOffsetStr=0	,

			} else {
				int myTargetLevel = getRequestManager().getLevel() + myLevelOffset;
5
				myRet = myTargetRequest.getUrl();
../oms/shipment-order_edit
				Map<String, String> myMap = new HashMap<String, String>(myTargetRequest.getParams());
[returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:10::::, systemid=26988637, null, null, null, base_windowToOpenUrl=, randomizingurl=1460983094458, null, base_windowToOpenTitle=, base_sessionLevelOffset=0, null, systemId=26988637, base_windowToOpenScrollbar=, base_windowToOpenHeight=, null, null]

				for (Enumeration myEnumeration = getRequest().getParameterNames(); myEnumeration.hasMoreElements();) {
					myKey = (String) myEnumeration.nextElement();
					if (myKey.startsWith("base_")) {
						myMap.put(myKey, getRequestParameter(myKey));
					}
				}
				myMap.put(RequestManager.SESSION_LEVEL_OFFSET, myLevelOffsetStr);
				myRet = getRequestUrl(myRet, myMap);
../oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:10::::&systemid=26988637&base_windowToOpenUrl=&randomizingurl=1460983094458&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988637&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=

/ 13	. 

/ edit shi	,
/s
PageRequest.formContextLinkOnclick = function() {
		} else {
			theActiveFormManager.setRedirectUrl(this.getAttribute("href"));
/s
        		document.getElementById("redirectTo").value=anUrl;
"shipment-item_edit?systemId=27155536&base_sessionLevelOffset=1"			/ door redirect komt shipment-item_edit in level +1	, 
			theActiveFormManager.submit(null,true,1);
/s
    this.submit = function(anAction, aBoolDoRedirect, aRedirectionLevelOffset) {

        this.lastAction = anAction;
null
        this.lastDoRedirect = aBoolDoRedirect;
true
        document.getElementById("base_sessionLevelOffset").value=aRedirectionLevelOffset;
1
		document.getElementById("doRedirect").value=aBoolDoRedirect;
true

/ Omdat we de form submit	, zien we de URL	,
Request URL:http://localhost:8080/tms/oms/shipment-order_save
Form Data:
continuationId:1460984910427
flowDefinition:reload
redirectTo:shipment-item_edit?systemId=27155536&base_sessionLevelOffset=1
doRedirect:true
base_sessionLevelOffset:1	 / set in JS	, maar doet niets omdat shipment-order_save niet wordt redirect	,
base_windowToOpenUrl:
base_windowToOpenHeight:
base_windowToOpenWidth:
base_windowToOpenTitle:
base_windowToOpenScrollbar:
sho_systemid:26988637
si_systemid:
organization:PNL-CARGO
/s
ShipmentOrderSaveAction(AbstractSaveAction).afterSave() line: 153	
/ LEVEL	,
/ level=5
/s
ShipmentOrderSaveAction(AbstractSaveAction).getRedirectUrl() line: 470	
			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
1
/ TODO (Het is een POST, dus het is de 1 set in JS: base_sessionLevelOffset:1	,) 
			if (myLevelOffset == 1) {
				} else {
					myRet = getRequest().getParameter(REDIRECT_TO_ATTR);
shipment-item_edit?systemId=27155536&base_sessionLevelOffset=1					/ deze 1 heeft niets gedaan	,
				myParamMap.put(RequestManager.SESSION_LEVEL_OFFSET, "1");
				myRet = getRequestUrl(myRet, myParamMap);
shipment-item_edit?systemId=27155536&base_sessionLevelOffset=1&base_sessionLevelOffset=1

/t
ShipmentOrderSaveAction(AbstractSaveAction).afterSave() line: 162	
				myRedirectUrl = getRedirectUrl();
/d
			getRequest().setAttribute("redirectTo", myRedirectUrl);
			RedirectSaveAction.redirect(getRedirector(), getRequest(), myRedirectUrl);
/s
	public static void redirect(Redirector aRedirector, Request aRequest, String anUrl, int aLevelOffset) {
anUrl	"shipment-item_edit?systemId=27155536&base_sessionLevelOffset=1&base_sessionLevelOffset=1" (id=27172)	
aLevelOffset	0	

		for (Enumeration myEnum = aRequest.getParameterNames(); myEnum.hasMoreElements();) {
			myParameterName = (String) myEnum.nextElement();

			if (myParameterName.startsWith("base_") && StringUtils.isNotEmpty(aRequest.getParameter(myParameterName))) {
				myRememberedParamList.add(myParameterName + "=" + aRequest.getParameter(myParameterName));
[base_sessionLevelOffset=1]
/ TODO
		if (myRememberedParamList.size() > 0) {
			String mySeperator;
			if (anUrl.indexOf('?') > 0) {
				mySeperator = "&";
			}
			anUrl += mySeperator + StringUtils.implode(myRememberedParamList.toArray(), "&");
shipment-item_edit?systemId=27155536&base_sessionLevelOffset=1&base_sessionLevelOffset=1&base_sessionLevelOffset=1

		if (anUrl.indexOf('/') == -1) {
			anUrl = "../" + EntityActionUtil.getModule(new RequestAdaptor(aRequest)) + "/" + anUrl;
../oms/shipment-item_edit?systemId=27155536&base_sessionLevelOffset=1&base_sessionLevelOffset=1&base_sessionLevelOffset=1

		aRequest.setAttribute("redirectTo", anUrl);
		try {
			String myRedirectPage = "../core/generic_save_redirect?redirectTo=" + URLEncoder.encode(anUrl, "UTF-8");

			aRedirector.redirect(true, myRedirectPage);

/ We komen weer in chrome	,
/we zien in devtools	,
Remote Address:[::1]:8080
Request URL:http://localhost:8080/tms/core/generic_save_redirect?redirectTo:../oms/shipment-item_edit?systemId=27155536&base_sessionLevelOffset=1&base_sessionLevelOffset=1&base_sessionLevelOffset=1

/ we komen weer in Java	,
/s
ShipmentItemEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
/ LEVEL	,
/ level=6
...

/ en in devtools zien we	,
Request URL:http://localhost:8080/tms/oms/shipment-item_edit?systemId=27155536&base_sessionLevelOffset=1&base_sessionLevelOffset=1&base_sessionLevelOffset=1&randomizingurl=1460990097148

/ we vallen  weer in JS	, want page loaded	,

/ 13

/ Save shipment item	,
/ we vallen in JS	,
/s
ShipmentOrderEdit.saveShipmentItem = function() {
	var myRedirectLevelOffset=0;
	if (document.getElementById("shipmentItemSystemId").value!="0") {
/ JA
		myRedirectLevelOffset=-1;
	}
    theShipmentorderFormManager.submit("../oms/shipment-item_save", false, myRedirectLevelOffset);
/s
    this.submit = function(anAction, aBoolDoRedirect, aRedirectionLevelOffset) {
        this.lastAction = anAction;
"../oms/shipment-item_save"
        this.lastDoRedirect = aBoolDoRedirect;
false
        document.getElementById("base_sessionLevelOffset").value=aRedirectionLevelOffset;
-1
		document.getElementById("doRedirect").value=aBoolDoRedirect;
false
        if(anAction){
        	myForm.action=anAction;
/c

/ in Java	,

/ we zien in devtools	,
Request URL:http://localhost:8080/tms/oms/shipment-item_save
Form Data:
continuationId:1460990261733
flowDefinition:reload
redirectTo:../core/back?levelOffset=-1
doRedirect:false
base_sessionLevelOffset:-1
base_windowToOpenUrl:
base_windowToOpenHeight:
base_windowToOpenWidth:
base_windowToOpenTitle:
base_windowToOpenScrollbar:
sho_systemid:26988637
si_systemid:
organization:PNL-CARGO

/s
ShipmentOrderSaveAction(AbstractSaveAction).afterSave() line: 166	
/ NIETS	 
/ want in cocoon config,	
			<map:match pattern="shipment-item_save">
				<map:act type="shipmentOrderSave">
					<map:parameter name="noRedirect" value="true"/>						<-
					<map:parameter name="skipFieldPrefix" value="productItem"/>
				</map:act>
				<map:act type="shipmentItemSave"/>
			</map:match>
/c
ShipmentOrderSaveAction(AbstractSaveAction).afterSave() line: 166	
/s
ShipmentItemSaveAction(AbstractSaveAction).afterSave() line: 159	
				myRedirectUrl = getRedirectUrl();
/s
ShipmentItemSaveAction(AbstractSaveAction).getRedirectUrl() line: 470	
			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
-1
			} else {
				int myTargetLevel = getRequestManager().getLevel() + myLevelOffset;
5
/ TODO (waarom was 6)?
				BaseRequest myTargetRequest = getRequestManager().getRequestForLevel(myTargetLevel);
				myRet = myTargetRequest.getUrl();
../oms/shipment-order_edit
				Map<String, String> myMap = new HashMap<String, String>(myTargetRequest.getParams());
[returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:10::::, systemid=26988637, null, null, null, base_windowToOpenUrl=, randomizingurl=1460983094458, null, base_windowToOpenTitle=, base_sessionLevelOffset=0, null, systemId=26988637, base_windowToOpenScrollbar=, base_windowToOpenWidth=, null, null]

				for (Enumeration myEnumeration = getRequest().getParameterNames(); myEnumeration.hasMoreElements();) {
					myKey = (String) myEnumeration.nextElement();
					if (myKey.startsWith("base_")) {
						myMap.put(myKey, getRequestParameter(myKey));
					}
				}
				myMap.put(RequestManager.SESSION_LEVEL_OFFSET, myLevelOffsetStr);
[returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:10::::, systemid=26988637, null, null, null, base_windowToOpenUrl=, randomizingurl=1460983094458, null, base_windowToOpenTitle=, base_sessionLevelOffset=-1, null, systemId=26988637, base_windowToOpenScrollbar=, base_windowToOpenWidth=, null, null]
				myRet = getRequestUrl(myRet, myMap);
../oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:10::::&systemid=26988637&base_windowToOpenUrl=&randomizingurl=1460983094458&base_windowToOpenTitle=&base_sessionLevelOffset=-1&systemId=26988637&base_windowToOpenScrollbar=&base_windowToOpenWidth=&base_windowToOpenHeight=
/t
ShipmentItemSaveAction(AbstractSaveAction).afterSave() line: 164	
				myRedirectUrl = getRedirectUrl();
/d
			getRequest().setAttribute("redirectTo", myRedirectUrl);
			RedirectSaveAction.redirect(getRedirector(), getRequest(), myRedirectUrl);

/ we komen in chrome	,
Request URL:http://localhost:8080/tms/core/generic_save_redirect?redirectTo=..%2Foms%2Fshipment-order_edit%3FreturnUrl%3Dhttp%3A%2F%2Flocalhost%3A8080%2Ftms%2Fwicket%2F%3Fwicket%3Ainterface%3D%3A10%3A%3A%3A%3A%26systemid%3D26988637%26base_windowToOpenUrl%3D%26randomizingurl%3D1460983094458%26base_windowToOpenTitle%3D%26base_sessionLevelOffset%3D-1%26systemId%3D26988637%26base_windowToOpenScrollbar%3D%26base_windowToOpenWidth%3D%26base_windowToOpenHeight%3D%26base_sessionLevelOffset%3D-1
/=
redirectTo:../oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:10::::&systemid=26988637&base_windowToOpenUrl=&randomizingurl=1460983094458&base_windowToOpenTitle=&base_sessionLevelOffset=-1&systemId=26988637&base_windowToOpenScrollbar=&base_windowToOpenWidth=&base_windowToOpenHeight=&base_sessionLevelOffset=-1

/ we vallen weer in Java	,
ShipmentOrderEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
getRequestManager().getLevel()=5

/ 13	. 

/ SAMENVATTING

/ edit shi

PageRequest.formContextLinkOnclick = function() {
			theActiveFormManager.setRedirectUrl(this.getAttribute("href"));
"shipment-item_edit?systemId=27155536&base_sessionLevelOffset=1"
			theActiveFormManager.submit(null,true,1);
/s
        document.getElementById("base_sessionLevelOffset").value=aRedirectionLevelOffset;
/s
ShipmentOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 160	
level=2			/ wat hij was	,
/s
	protected String getRedirectUrl() throws Exception {
			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
1
				} else {
					myRet = getRequest().getParameter(REDIRECT_TO_ATTR);
shipment-item_edit?systemId=27155536&base_sessionLevelOffset=1
/t
			getRequest().setAttribute("redirectTo", myRedirectUrl);
			RedirectSaveAction.redirect(getRedirector(), getRequest(), myRedirectUrl);
/s
		redirect(aRedirector, aRequest, anUrl, 0);		/ 0: set geen nieuwe base_sessionLevelOffset achter ?
/s
			String myRedirectPage = "../core/generic_save_redirect?redirectTo=" + URLEncoder.encode(anUrl, "UTF-8");
			aRedirector.redirect(true, myRedirectPage);
anUrl=../oms/shipment-item_edit?systemId=27155536&base_sessionLevelOffset=1&base_sessionLevelOffset=1&base_sessionLevelOffset=1
/c
ShipmentItemEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
level=3

/ save shi

ShipmentOrderEdit.saveShipmentItem = function() {
	var myRedirectLevelOffset=0;
	if (document.getElementById("shipmentItemSystemId").value!="0") {
		myRedirectLevelOffset=-1;
	}
    theShipmentorderFormManager.submit("../oms/shipment-item_save", false, myRedirectLevelOffset);
/s
        document.getElementById("base_sessionLevelOffset").value=aRedirectionLevelOffset;
-1
		document.getElementById("doRedirect").value=aBoolDoRedirect;
false
/s
ShipmentOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
level=3
/c
ShipmentOrderSaveAction(BoundSaveAction).afterSave() line: 65	
/ NIETS
/ See cocoon config	,
/c
ShipmentItemSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
/c
ShipmentItemSaveAction(BoundSaveAction).afterSave() line: 65	
/s
	protected String getRedirectUrl() throws Exception {
			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
-1
			} else {
				int myTargetLevel = getRequestManager().getLevel() + myLevelOffset;
2 		/ Alleen om de url te krijgen	,
				BaseRequest myTargetRequest = getRequestManager().getRequestForLevel(myTargetLevel);
				myRet = myTargetRequest.getUrl();
../oms/shipment-order_edit
				Map<String, String> myMap = new HashMap<String, String>(myTargetRequest.getParams());
{returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::, systemid=26988637, base_windowToOpenUrl=, randomizingurl=1461044907882, base_windowToOpenTitle=, base_sessionLevelOffset=-1, systemId=26988637, base_windowToOpenScrollbar=, base_windowToOpenHeight=, base_windowToOpenWidth=}

			String myRedirectPage = "../core/generic_save_redirect?redirectTo=" + URLEncoder.encode(anUrl, "UTF-8");
anUrl=
../oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::&systemid=26988637&base_windowToOpenUrl=&randomizingurl=1461044907882&base_windowToOpenTitle=&base_sessionLevelOffset=-1&systemId=26988637&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=-1
			aRedirector.redirect(true, myRedirectPage);
/c
ShipmentOrderEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
level=2





















 






















/ Einde URLS SHI EDIT

/ URLS SHI SAVE 

/ Einde URLS SHI SAVE 

/ REQUESTMANAGER

/ 13	. 

/ edit shi	,

/ devtools
Request URL:http://localhost:8080/tms/oms/shipment-order_save
Form Data:
continuationId:1461050298456
flowDefinition:reload
redirectTo:shipment-item_edit?systemId=27155536&base_sessionLevelOffset=1
doRedirect:true
base_sessionLevelOffset:1	 / set in JS	, later getRequest().getParameter("base_sessionLevelOffset") is deze 	, want het is een POST request	,

/s
ShipmentOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
/s
RequestManager.<init>(Session, Request, boolean) line: 97	
		this(new SessionAdaptor(aSession), new RequestAdaptor(aRequest), isFlowControlEnabled);
/s
RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 108	
	private int level = 0;

	public static final String SESSION_LEVEL = "base_sessionLevel";
	public static final String SESSION_LEVEL_OFFSET = "base_sessionLevelOffset";
	public static final String SESSION_LIST = "base_sessionList";


"getSession()"	 (pending)	
	theSessionCocoon	HttpSession  (id=24183)	
		wrappedSession	StandardSessionFacade  (id=24185)	
			session	StandardSession  (id=24286)	
				attributes	Hashtable	
[
 SPRING_SECURITY_CONTEXT=com.mpobjects.auth.context.ResourceSecurityContextImpl@5828165b: Authentication: org.springframework.security.authentication.UsernamePasswordAuthenticationToken@5828165b: Principal: com.mpobjects.auth.model.ScsUserDetails@7cfc403f; Credentials: [PROTECTED]; Authenticated: true; Details: org.springframework.security.web.authentication.WebAuthenticationDetails@43458: RemoteIpAddress: 0:0:0:0:0:0:0:1; SessionId: 1llua8yc8hq0d14hmf8vs3f621; Granted Authorities: ADMINISTRATOR, ORG:PNL-CARGO, ORG:PNL-OMS-DOCK, ORG:PNL-TMS-AB, ORG:SYSTEM,
 returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::,
 wicket:WicketServlet:session=com.mpobjects.view.wicket.BaseWebSession@31dd02c1,
 FROM_SUBMIT_LISTENERS=[],
 locale=en_GB_pnllogistics,
 active_shipment_order=ShipmentOrder: SH000144571(SystemId:26988637; Org:PNL-CARGO),
 1461050298456_form=com.mpobjects.view.taglib.form.FormTag@4aa6b8d5,
 builder=jsp,
 productItemVO=PRODUCT_ITEM id:null(systemId:0),
 active_order=shipment_order,
 base_sessionList=[1461043019911, 1461043103395, 1461050298231],
 1461043159005_form=com.mpobjects.view.taglib.form.FormTag@6b437923,
 base_sessionLevel=2,
 Wicket:SessionUnbindingListener-WicketServlet=org.apache.wicket.protocol.http.AbstractHttpSessionStore$SessionBindingListener@24d05bee, wicket:WicketServlet:m:null=[PageMap name=null],
 base_sessionMap={1461050298231=com.mpobjects.control.action.BaseRequest@37ce31d4, 1461043103395=com.mpobjects.control.action.BaseRequest@422971eb, 1461043019911=com.mpobjects.control.action.BaseRequest@2ef61d3c},
 myShipmentOrderView=com.mpobjects.oms.view.shipmentorder.ShipmentOrderView@596d8370,
 resource=com.mpobjects.oms.view.resource.ResourceView@10038e36,
 shipmentOrderChildsTab=shipmentItems,
 null
]

"getRequest()"	 (pending)	
	theRequestCocoon	HttpRequest  (id=24167)	
		req	SecurityContextHolderAwareRequestWrapper  (id=24646)	
			request	RequestWrapper  (id=24648)	
				request	RequestFacade  (id=24650)	
					request	Request  (id=24653)	
						attributes	HashMap  (id=24654)	

[
 __spring_security_scpf_applied=true,
 org.springframework.security.web.FilterChainProxy.APPLIED=true,
 __spring_security_filterSecurityInterceptor_filterApplied=true,
 Open hibernate session in view.FILTERED=true,
 __spring_security_session_mgmt_filter_applied=true,
 org.springframework.web.context.request.async.WebAsyncManager.WEB_ASYNC_MANAGER=org.springframework.web.context.request.async.WebAsyncManager@62c46202,
 ]


		if (getSession().getAttribute(SESSION_MAP) != null) {
			mySessionMap = (Map<String, BaseRequest>) getSession().getAttribute(SESSION_MAP);
		if (getSession().getAttribute(SESSION_LIST) != null) {
			mySessionList = (ArrayList<String>) getSession().getAttribute(SESSION_LIST);

/ level=0
		if (getSession().getAttribute(SESSION_LEVEL) != null) {
			setLevel(Math.max(0, Integer.parseInt((String) getSession().getAttribute(SESSION_LEVEL))));
/s
				getSession().setAttribute(SESSION_LEVEL, "" + aLevel);
/ is al 2	,
				level=2

		if (isFlowControlEnabled) {
/ NEE
/ is save action	, 
		getRequest().setAttribute("requestManager", this);

requestManager=com.mpobjects.control.web.RequestManager@36c3a9b1
/ wordt door volgende act opgepakt	, er is al een request manager	,

"getRequest()"	 (pending)	
	theRequestCocoon	HttpRequest  (id=24167)	
		req	SecurityContextHolderAwareRequestWrapper  (id=24646)	
			request	RequestWrapper  (id=24648)	
				request	RequestFacade  (id=24650)	
					request	Request  (id=24653)	
						attributes	HashMap  (id=24654)	
/=
[
 __spring_security_scpf_applied=true,
 org.springframework.security.web.FilterChainProxy.APPLIED=true,
 __spring_security_filterSecurityInterceptor_filterApplied=true,
 Open hibernate session in view.FILTERED=true,
 __spring_security_session_mgmt_filter_applied=true,
 org.springframework.web.context.request.async.WebAsyncManager.WEB_ASYNC_MANAGER=org.springframework.web.context.request.async.WebAsyncManager@62c46202,
 requestManager=com.mpobjects.control.web.RequestManager@36c3a9b1
 ]

/c
ShipmentOrderSaveAction(AbstractSaveAction).getRedirectUrl() line: 473	
			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);	/ WH die set in JS	, niet uit REDIRECT_TO_ATTR	: shipment-item_edit?systemId=27155536&base_sessionLevelOffset=1 
1		

/ getRequest().getParameterNames() is 767 entries	,

/ er zijn	,
getRequest().getParameterNames()
getRequest().getAttributeNames()
getSession().getAttributeNames()
/ getSession.getParameters() is er niet	,

 
/ Einde Intermezzo

			if (myLevelOffset == 1) {											/ die uit JS	, we zijn in een POST	,
				if (getRequest().getAttribute(REDIRECT_TO_ATTR) != null) {
/ NEE
				} else {
					myRet = getRequest().getParameter(REDIRECT_TO_ATTR);
shipment-item_edit?systemId=27155536&base_sessionLevelOffset=1

/t
ShipmentOrderSaveAction(AbstractSaveAction).afterSave() line: 162	
				myRedirectUrl = getRedirectUrl();
shipment-item_edit?systemId=27155536&base_sessionLevelOffset=1&base_sessionLevelOffset=1	 / Laatste uit JS	, 1ste uit REDIRECT_TO_ATTR	,

			getRequest().setAttribute("redirectTo", myRedirectUrl);
/ rewrite REDIRECT_TO_ATTR
			RedirectSaveAction.redirect(getRedirector(), getRequest(), myRedirectUrl);

			String myRedirectPage = "../core/generic_save_redirect?redirectTo=" + URLEncoder.encode(anUrl, "UTF-8");
			aRedirector.redirect(true, myRedirectPage);
/c
ShipmentItemEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	

/ we zien in devtools een nieuw request	,
Request URL:http://localhost:8080/tms/core/generic_save_redirect?redirectTo=..%2Foms%2Fshipment-item_edit%3FsystemId%3D27155536%26base_sessionLevelOffset%3D1%26base_sessionLevelOffset%3D1%26base_sessionLevelOffset%3D1

			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
/s
RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 109	

		if (getSession().getAttribute(SESSION_LEVEL) != null) {
			setLevel(Math.max(0, Integer.parseInt((String) getSession().getAttribute(SESSION_LEVEL))));
2
	if (isFlowControlEnabled) {
/ JA
/ Is geen save	,
			int myLevelOffset = parseLevel(getRequest().getParameter(SESSION_LEVEL_OFFSET));
1
/ getRequest().getParameter(SESSION_LEVEL_OFFSET) komt uit de url	, want het is een GET request	,

			setLevel(Math.max(0, getLevel() + myLevelOffset));
/s
RequestManager.setLevel(int) line: 242	
		getSession().setAttribute(SESSION_LEVEL, "" + aLevel);
		level = aLevel;
/3
			mySessionMap.put(myRequest.getRequestId(), myRequest);
{1461055528741=com.mpobjects.control.action.BaseRequest@5f5d6093, 1461050298231=com.mpobjects.control.action.BaseRequest@37ce31d4, 1461043103395=com.mpobjects.control.action.BaseRequest@422971eb, 1461043019911=com.mpobjects.control.action.BaseRequest@2ef61d3c}
/ 1461055528741 erbij	,
				mySessionList.add(getLevel(), myRequest.getRequestId());

/ mySessionList
[1461043019911, 1461043103395, 1461050298231, 1461055528741]

/ Intermezzo

/ Het zijn er te veel	,

/ als we een sho edit, level 1, cancel , en weer edit	, dan  is level 2	, en de request 1 is nog in de session	,

mySessionMap	HashMap  (id=24220)	
	size	4	
	table	HashMap$Entry[16]  (id=25464)	
		[6]	HashMap$Entry  (id=25473)	
			key	"1461055528741" (id=25454)	
			next	HashMap$Entry  (id=25465)	
				key	"1461050298231" (id=25467)	
				next	HashMap$Entry  (id=25468)	
					key	"1461043103395" (id=25471)	
					next	null	
					value	BaseRequest  (id=25472)	
						requestId	"1461043103395" (id=25471)	
						url	"../oms/shipment-order_edit" (id=25505)	
				value	BaseRequest  (id=25469)	
					requestId	"1461050298231" (id=25467)	
					url	"../oms/shipment-order_edit" (id=25502)	
			value	BaseRequest  (id=25409)	
				requestId	"1461055528741" (id=25454)	
				url	"../oms/shipment-item_edit" (id=25455)	
		[15]	HashMap$Entry  (id=25466)	
			key	"1461043019911" (id=25488)	
			next	null	
			value	BaseRequest  (id=25506)	
				requestId	"1461043019911" (id=25488)	
				url	"../core/opening_page" (id=25508)	

/ Einde Intermezzo

/ 13	. 

/ save shi	,

ShipmentOrderEdit.saveShipmentItem = function() {
		myRedirectLevelOffset=-1;
    theShipmentorderFormManager.submit("../oms/shipment-item_save", false, myRedirectLevelOffset);
/s
ShipmentOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
/s
ShipmentOrderSaveAction(AbstractAction).isFlowControlled() line: 623	
		boolean myRet = !(this instanceof NonScreenAction);
false
		myRet &= !StringUtils.isFalse(getRequestParameter(RequestManager.SESSION_LEVEL_CONTROL_FLOW));
getRequestParameter(RequestManager.SESSION_LEVEL_CONTROL_FLOW)=""
/ altijd & true bij ons	,
false & true=false 

		return myRet;
false

/ Intermezzo

/ AbstractSaveAction implements NonScreenAction	, 
/ Dus sho save , of shi save zal niet de level reset

/ Einde Intermezzo
/t
/s
RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 109	
		if (getSession().getAttribute(SESSION_LEVEL) != null) {
			setLevel(Math.max(0, Integer.parseInt((String) getSession().getAttribute(SESSION_LEVEL))));
3
		if (isFlowControlEnabled) {
/ NEE
/c
ShipmentOrderSaveAction(BoundSaveAction).afterSave() line: 65	
		if (shouldTakeControl()) {
/s
		return !getParameters().isParameter("noRedirect");
!true=false
/c
ShipmentItemSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
			if (getRequest().getAttribute("requestManager") != null) {
				setRequestManager((RequestManager) getRequest().getAttribute("requestManager"));
/ is er al	, level=3
/c
ShipmentItemSaveAction(BoundSaveAction).afterSave() line: 65	
/s
ShipmentItemSaveAction(AbstractSaveAction).getRedirectUrl() line: 471	
			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
-1
/ Het is een POST request	,
Request URL:http://localhost:8080/tms/oms/shipment-item_save
Form Data:
continuationId:1461056629000
flowDefinition:reload
redirectTo:../core/back?levelOffset=-1
doRedirect:false
base_sessionLevelOffset:-1										<-

				int myTargetLevel = getRequestManager().getLevel() + myLevelOffset;
2
				BaseRequest myTargetRequest = getRequestManager().getRequestForLevel(myTargetLevel);
				myRet = myTargetRequest.getUrl();
../oms/shipment-order_edit
				Map<String, String> myMap = new HashMap<String, String>(myTargetRequest.getParams());
{returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::, systemid=26988637, base_windowToOpenUrl=, randomizingurl=1461044907882, base_windowToOpenTitle=, base_sessionLevelOffset=-1, systemId=26988637, base_windowToOpenScrollbar=, base_windowToOpenHeight=, base_windowToOpenWidth=}

/ Intermezzo

getRequestManager().getRequestForLevel(0)
url: ../core/opening_page
params:{}

getRequestManager().getRequestForLevel(1)
url: ../oms/shipment-order_edit
params: {returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::, systemid=26988637, base_sessionLevelOffset=3, systemId=26988637}

getRequestManager().getRequestForLevel(2)
url: ../oms/shipment-order_edit
params: {returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::, systemid=26988637, base_windowToOpenUrl=, randomizingurl=1461044907882, base_windowToOpenTitle=, base_sessionLevelOffset=-1, systemId=26988637, base_windowToOpenScrollbar=, base_windowToOpenWidth=, base_windowToOpenHeight=}
/ WH na cancel	,
/ TODO

getRequestManager().getRequestForLevel(3)
url: ../oms/shipment-item_edit
params: {randomizingurl=1461054779690, base_sessionLevelOffset=1, systemId=27155536}  

/ Einde Intermezzo

/s
RedirectSaveAction.redirect(Redirector, Request, String, int) line: 51	
		for (Enumeration myEnum = aRequest.getParameterNames(); myEnum.hasMoreElements();) {
			myParameterName = (String) myEnum.nextElement();
			if (myParameterName.startsWith("base_") && StringUtils.isNotEmpty(aRequest.getParameter(myParameterName))) {
				myRememberedParamList.add(myParameterName + "=" + aRequest.getParameter(myParameterName));
[base_sessionLevelOffset=-1]
/ Klopt	, bij shipment-order_save	, een POST	, is base_sessionLevelOffset=-1	,

			aRedirector.redirect(true, myRedirectPage);
/c
ShipmentOrderEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
/ nieuw request	,
Request URL:http://localhost:8080/tms/oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::&systemid=26988637&base_windowToOpenUrl=&randomizingurl=1461044907882&base_windowToOpenTitle=&base_sessionLevelOffset=-1&systemId=26988637&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=-1&randomizingurl=1461059452952
/s
ShipmentOrderEditAction(AbstractAction).isFlowControlled() line: 623	
true
/ , want is  geen save action	,
/c
/s
RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 109	
		if (getSession().getAttribute(SESSION_LEVEL) != null) {
			setLevel(Math.max(0, Integer.parseInt((String) getSession().getAttribute(SESSION_LEVEL))));
3
		if (isFlowControlEnabled) {
			BaseRequest myRequest = new BaseRequest(aRequest);
			int myLevelOffset = parseLevel(getRequest().getParameter(SESSION_LEVEL_OFFSET));
			setLevel(Math.max(0, getLevel() + myLevelOffset));
2
			String myRequestId;
			for (int i = getLevel(); i < mySessionList.size();) {
				myRequestId = mySessionList.get(i);
				mySessionList.remove(i);
				mySessionMap.remove(myRequestId);
			}
/ we halen de voorste = recentste eraf	, todat er level=2 overblijven	,
/ We houden de 1ste 2 over	,
../core/opening_page
{}
/ en	, 
../oms/shipment-order_edit
{returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::, systemid=26988637, base_sessionLevelOffset=3, systemId=26988637}

			mySessionMap.put(myRequest.getRequestId(), myRequest);
			try {
				mySessionList.add(getLevel(), myRequest.getRequestId());
/ En dan de huidige er weer bij	,

../oms/shipment-order_edit
{returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::, systemid=26988637, base_windowToOpenUrl=, randomizingurl=1461044907882, base_windowToOpenTitle=, base_sessionLevelOffset=-1, systemId=26988637, base_windowToOpenScrollbar=, base_windowToOpenWidth=, base_windowToOpenHeight=}

//////////////////////////
/ SAMENVATTING

level 2
GET shi_edit?offset=1
---------
POST sho_save	, offset=1	, redirectTo: shi_edit?offset=1		/ offset=1 -> redirectTo wordt gekozen	,
->
GET shi_edit -> level 3

level 3
POST shi_save
----------------
offset=-1 -> redirectUrl=level 2 url=sho_edit?offset=-1	, level 3 blijft	,
GET sho_edit -> level 2

/ Einde SAMENVATTING

/ SAMENVATTING

/ we hebben een andere sho edit	, SH000144566	,
/ Dan is de sho_edit url waar de shi_save naartoe wordt redirect een andere	, met andere parameters	,
{returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::, systemid=26988615, base_sessionLevelOffset=3, systemId=26988615}

/ Hierboven zagen we	,
{returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::, systemid=26988637, base_windowToOpenUrl=, randomizingurl=1461044907882, base_windowToOpenTitle=, base_sessionLevelOffset=-1, systemId=26988637, base_windowToOpenScrollbar=, base_windowToOpenWidth=, base_windowToOpenHeight=}

/ Einde SAMENVATTING


/ Einde REQUJESTMANAGER




/ Einde PCT-1181

/ SAVE NEW SHI ON JUST CREATED RETURN SHI OF NOT PLANNED SHO 

/ 13	. 

/ we create een return van een niet ingeplande sho	,
/ we komen op	,
http://localhost:8080/tms/oms/shipment-order_create-return?shipmentorder_systemid=26988696&base_sessionLevelOffset=1
/ er is geen shi	, create er 1	, en save, 
/ de url wordt rewrite naar shipment-order_edit	, en param added systemId=<system_id van return>
/ OK	,

/ 13	. 

///////////////////////////////
/ we zien het form 'Create Shipment Item al	, dit is ook de button 'Create shipment item'	, 

/ we zien in het form de hidden	,
<input type="hidden" name="shipmentItemSystemId" id="shipmentItemSystemId" value="0">

/ deze is nu 0	,
/ Daar test JS op of hier 0 staat of niet	,
/ Als we een shi create	, blijft dit 0	, en bij save level-0 , 

/ Als we een bestaande shi edit, staat hier de system_id van de shi	,
/ Dan wordt ook level+1
/ bij save wordt dan level-1	,
 

/ 13	. 

/ right click planning, shipment order, create
http://localhost:8080/tms/oms/shipment-order-template_list?refresh=false&emptySession=true
/ click create order	,
http://localhost:8080/tms/oms/shipment-order_create?systemid=26788426&base_sessionLevelOffset=1
/ we zijn 1 level hoger	,
/ 26788426 is system_id van pharma	,
/ Fill parties in en Save	,
http://localhost:8080/tms/oms/shipment-order_edit?base_windowToOpenUrl=&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988696&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=0&randomizingurl=1461131255503 
/ we blijven op hetzelfde level	, daarom base_sessionLevelOffset=0	, 
/ 26988696 is de system_id van de created sho	,
/ click 'Create return'
http://localhost:8080/tms/oms/shipment-order_create-return?shipmentorder_systemid=26988696&base_sessionLevelOffset=1
/ we zijn weer een level hoger,
/ 26988696 is de system_id van de created sho	, NIET van de return	, 
/ TODO

/ 13	. 

$ less oms-sitemap.xmap
			<map:action logger="shipmentorder" name="shipmentOrderCreateReturn" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderCreateReturnAction"/>

/ 13	. 

/ we maken een return	,

/ right click planning , shipment order, create
/ pharma tpl 
/ we zien	,
http://localhost:8080/tms/oms/shipment-order_create?systemid=26788426&base_sessionLevelOffset=1
/ Fill in	,
customer reference: test pct-1234 			/ bijv	,
ship_from   :   2910-3--BE
ship_to     :   4231DJ-118--NL
bill_to     :   9105522
/ Save	, 
/ we zien,	
http://localhost:8080/tms/oms/shipment-order_edit?base_windowToOpenUrl=&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988689&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=0&randomizingurl=1461076567703
/ click 'create return'	,
/ we zien	,
http://localhost:8080/tms/oms/shipment-order_create-return?shipmentorder_systemid=26988689&base_sessionLevelOffset=1
/ 26988689 is de system_id van de sho	, NIET van de return	, geeft niet: er staat shipmentorder_systemid, niet systemId	,

//////////////////////////////////////////////////////////////////////////
/ Beneden wordt systemId=<id van return> erbij set	, en wordt shipment-order_create-return verandert in shipment-order_edit	, en deze url -> 

/ 13	. 

/ we save een new shi aan de rtsho	,
/ het form is er al	, dit is button 'Create shipment item',   we click 'save shipment item'	,
/s

PageRequest.formContextLinkOnclick = function() {
		} else {
			theActiveFormManager.setRedirectUrl(this.getAttribute("href"));
/s
        		document.getElementById("redirectTo").value=anUrl;
/t
			theActiveFormManager.submit(null,true,1);			/ -> shipment-order_save	, TODO (hoe?)	, met redirectTo param	,
/s
ShipmentOrderEdit.saveShipmentItem = function() {
	var myRedirectLevelOffset=0;
	if (document.getElementById("shipmentItemSystemId").value!="0") {
/ NEE
    theShipmentorderFormManager.submit("../oms/shipment-item_save", false, myRedirectLevelOffset);
/s
FormManager.submit (class.formmanager.js:58)
        document.getElementById("base_sessionLevelOffset").value=aRedirectionLevelOffset;
0
		document.getElementById("doRedirect").value=aBoolDoRedirect;
false

/ we zien in devtools	,

POST request URL:http://localhost:8080/tms/oms/shipment-item_save			/ TODO
Form Data:
continuationId:1461069151955
flowDefinition:reload
redirectTo:../core/back?levelOffset=-1
doRedirect:false
base_sessionLevelOffset:0

/s
ShipmentOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
/s
RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 109	
isFlowControlEnabled	false	
/ want is een save	,
/ hij zal level niet veranderen	,
		if (getSession().getAttribute(SESSION_LEVEL) != null) {
			setLevel(Math.max(0, Integer.parseInt((String) getSession().getAttribute(SESSION_LEVEL))));
12
		if (isFlowControlEnabled) {
/ NEE
/ want het is een save	,
		getRequest().setAttribute("requestManager", this);
/ voor later	, de RequestManager is er dan al	,
/c
ShipmentOrderSaveAction(BoundSaveAction).afterSave() line: 65	
/ NIETS	, want	,
			<map:match pattern="shipment-item_save">
				<map:act type="shipmentOrderSave">
					<map:parameter name="noRedirect" value="true"/> 				<-
					<map:parameter name="skipFieldPrefix" value="productItem"/>
				</map:act>
				<map:act type="shipmentItemSave"/>
			</map:match>
/c
ShipmentItemSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
			if (getRequest().getAttribute("requestManager") != null) {
				setRequestManager((RequestManager) getRequest().getAttribute("requestManager"));
/ is er al	,
/ Het is nog hetzelfde POST request	,
/s
ShipmentItemSaveAction(BoundSaveAction).afterSave() line: 65	
		if (shouldTakeControl()) {
/ JA
/ shi_save heeft deze param niet in xmap	,

			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
0
/ Het is nog dezelfde POST request	, en in de form data staat base_sessionLevelOffset=0

/ Intermezzo 

getRequestManager().getRequestForLevel(4)
url: ../oms/shipment-order_create-return
{shipmentorder_systemid=26988696, base_sessionLevelOffset=1}
/ 26988696 is de system_id van de sho	, NIET van de return, 
/ See TODO TANTELY hierboven	,

getRequestManager().getRequestForLevel(3)
url: ../oms/shipment-order_edit 
{base_windowToOpenUrl=, randomizingurl=1461131255503, base_windowToOpenTitle=, base_sessionLevelOffset=0, systemId=26988696, base_windowToOpenScrollbar=, base_windowToOpenHeight=, base_windowToOpenWidth=}

/ Einde Intermezzo 

			} else {
				int myTargetLevel = getRequestManager().getLevel() + myLevelOffset;

				BaseRequest myTargetRequest = getRequestManager().getRequestForLevel(myTargetLevel);
				myRet = myTargetRequest.getUrl();
../oms/shipment-order_create-return
				Map<String, String> myMap = new HashMap<String, String>(myTargetRequest.getParams());
{shipmentorder_systemid=26988689, base_sessionLevelOffset=1}
/ 26988689 is de system_id van de sho	, NIET van de return, 
/ See TODO TANTELY hierboven	,

				if (myRet.indexOf("_create") > 0 || myRet.indexOf("_copy") > 0) {
					myRet = EntityActionUtil.getActionUrl(myRet, "edit");
/s
EntityActionUtil.getActionUrl(String, String) line: 55	
/=
	public static String getActionUrl(String aFullUrl, String aTargetAction) {
aFullUrl="../oms/shipment-order_create-return"
hipmentorder_systemid=26988689, base_sessionLevelOffset=1}
		String myUrlParts[] = aFullUrl.split("/");
[.., oms, shipment-order_create-return]
		aTargetAction = StringUtils.formatJavaToFile(aTargetAction).toString();
edit
		String myCurrentEntityAction = myUrlParts[myUrlParts.length - 1];
shipment-order_create-return
		String myCurrentModule = myUrlParts[myUrlParts.length - 2];
oms
		String[] myCurrentEntityActionParts = myCurrentEntityAction.split("_");
[shipment-order, create-return]
		myCurrentEntityActionParts[1] = aTargetAction;
edit
		return buildActionUrl(myCurrentModule, myCurrentEntityActionParts);
/s
			return "../" + aModule + "/" + StringUtils.implode(anActionPartArray, "_");
/t
ShipmentItemSaveAction(AbstractSaveAction).getRedirectUrl() line: 502	
				if (myRet.indexOf("_create") > 0 || myRet.indexOf("_copy") > 0) {
					myRet = EntityActionUtil.getActionUrl(myRet, "edit");
/d
../oms/shipment-order_edit

					myMap.remove("systemid");
/ systemid staat niet in myMap	, shipmentorder_systemid wel	, en WH is dat de bedoeling	,
/ TODO TANTELY
					myMap.put("systemId", "" + getValueObject().getSystemId());
{shipmentorder_systemid=26988696, base_sessionLevelOffset=1, systemId=26988697}

/ shipmentorder_systemid=26988696 is van de sho, niet de return	, klopt	,
/ systemid=26988697 is van de return	,
/ Er staat nog base_sessionLevelOffset=1	, omdat de return sho page 1 level omhoog wilde	,

				String myKey;
				for (Enumeration myEnumeration = getRequest().getParameterNames(); myEnumeration.hasMoreElements();) {
					myKey = (String) myEnumeration.nextElement();
					if (myKey.startsWith("base_")) {
						myMap.put(myKey, getRequestParameter(myKey));
					}
				}
				myMap.put(RequestManager.SESSION_LEVEL_OFFSET, myLevelOffsetStr);
{base_windowToOpenUrl=, shipmentorder_systemid=26988696, base_windowToOpenTitle=, base_sessionLevelOffset=0, systemId=26988697, base_windowToOpenScrollbar=, base_windowToOpenHeight=, base_windowToOpenWidth=}

/ de base_sessionLevelOffset=1 is overwrite  met base_sessionLevelOffset=0	, 

				myRet = getRequestUrl(myRet, myMap);
../oms/shipment-order_edit?base_windowToOpenUrl=&shipmentorder_systemid=26988696&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988697&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=


/t
ShipmentItemSaveAction(AbstractSaveAction).afterSave() line: 164	
				myRedirectUrl = getRedirectUrl();
/d
			getRequest().setAttribute("redirectTo", myRedirectUrl);
			RedirectSaveAction.redirect(getRedirector(), getRequest(), myRedirectUrl);
/s
RedirectSaveAction.redirect(Redirector, Request, String, int) line: 65	
		for (Enumeration myEnum = aRequest.getParameterNames(); myEnum.hasMoreElements();) {
			myParameterName = (String) myEnum.nextElement();
				myRememberedParamList.add(myParameterName + "=" + aRequest.getParameter(myParameterName));
			}
		}
myRememberedParamList=[base_sessionLevelOffset=0]
/ Herhaald, OK	,

			anUrl += mySeperator + StringUtils.implode(myRememberedParamList.toArray(), "&");
/=
../oms/shipment-order_edit?base_windowToOpenUrl=&shipmentorder_systemid=26988689&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988690&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=0

			String myRedirectPage = "../core/generic_save_redirect?redirectTo=" + URLEncoder.encode(anUrl, "UTF-8");

/ we zien in chrome devtools de GET request	,
../core/generic_save_redirect?redirectTo=..%2Foms%2Fshipment-order_edit%3Fbase_windowToOpenUrl%3D%26shipmentorder_systemid%3D26988696%26base_windowToOpenTitle%3D%26base_sessionLevelOffset%3D0%26systemId%3D26988697%26base_windowToOpenScrollbar%3D%26base_windowToOpenHeight%3D%26base_windowToOpenWidth%3D%26base_sessionLevelOffset%3D0
/=
redirectTo:../oms/shipment-order_edit?base_windowToOpenUrl=&shipmentorder_systemid=26988696&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988697&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=0jjj

/ we zien ook in devtools Network	de GET request	,,
Request URL:http://localhost:8080/tms/oms/shipment-order_edit?base_windowToOpenUrl=&shipmentorder_systemid=26988696&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988697&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=0&randomizingurl=1461134406848

/c
ShipmentOrderEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
/ Nieuw request	,
/s
RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 138	
		if (getSession().getAttribute(SESSION_LEVEL) != null) {
			setLevel(Math.max(0, Integer.parseInt((String) getSession().getAttribute(SESSION_LEVEL))));
4
		if (isFlowControlEnabled) {
			BaseRequest myRequest = new BaseRequest(aRequest);
			int myLevelOffset = parseLevel(getRequest().getParameter(SESSION_LEVEL_OFFSET));
0
			setLevel(Math.max(0, getLevel() + myLevelOffset));
4


mySessionMap	java.util.HashMap  (id=22331)	
	size	5	
	table	java.util.HashMap$Entry[16]  (id=23076)	
		[0]	java.util.HashMap$Entry  (id=23077)	
			key	"1461131015210" (id=23098)	
			value	com.mpobjects.control.action.BaseRequest  (id=23099)	
				params	java.util.HashMap  (id=23100)	
				requestId	"1461131015210" (id=23098)	
				url	"../oms/shipment-order-template_list" (id=23101)	
		[2]	java.util.HashMap$Entry  (id=23078)	
			key	"1461130283402" (id=23094)	
			value	com.mpobjects.control.action.BaseRequest  (id=23095)	
				params	java.util.HashMap  (id=23096)	
				requestId	"1461130283402" (id=23094)	
				url	"../core/opening_page" (id=23097)	
		[3]	java.util.HashMap$Entry  (id=23079)	
			key	"1461131429803" (id=22430)	
			value	com.mpobjects.control.action.BaseRequest  (id=22427)	
				params	java.util.HashMap  (id=22429)	
				requestId	"1461131429803" (id=22430)	
				url	"../oms/shipment-order_create-return" (id=22431)	
		[13]	java.util.HashMap$Entry  (id=23080)	
			key	"1461130770208" (id=23082)	
			value	com.mpobjects.control.action.BaseRequest  (id=23083)	
				params	java.util.HashMap  (id=23091)	
				requestId	"1461130770208" (id=23082)	
				url	"../oms/shipment-order-template_list" (id=23092)	
		[15]	java.util.HashMap$Entry  (id=23081)	
			key	"1461131255560" (id=22446)	
			value	com.mpobjects.control.action.BaseRequest  (id=22443)	
				params	java.util.HashMap  (id=22445)	
				requestId	"1461131255560" (id=22446)	
				url	"../oms/shipment-order_edit" (id=22447)	

			for (int i = getLevel(); i < mySessionList.size();) {
				myRequestId = mySessionList.get(i);
				mySessionList.remove(i);
				mySessionMap.remove(myRequestId);
			}
/ we halen de achterste eraf	, en set nieuwe erop	, WH met nieuwe params	, want de url blijft hetzelfde	,
/ TODO

[15]	java.util.HashMap$Entry  (id=23081)	
	value	com.mpobjects.control.action.BaseRequest  (id=22443)	
		params	java.util.HashMap  (id=22445)	
{base_windowToOpenUrl=, randomizingurl=1461131255503, base_windowToOpenTitle=, base_sessionLevelOffset=0, systemId=26988696, base_windowToOpenScrollbar=, base_windowToOpenHeight=, base_windowToOpenWidth=}
		requestId	"1461131255560" (id=22446)	
		url	"../oms/shipment-order_edit" (id=22447)	

		getRequest().setAttribute("requestManager", this);
/c
ShipmentOrderEditAction.act() line: 31	
		int myShipmentOrderId = getSystemIdFromRequest();
26988697
/ van de return	,
		ShipmentOrderVO myShipmentOrder = ShipmentOrderUtil.getShipmentOrderFacadeLocal().getShipmentOrder(myShipmentOrderId);




/ 7	. 

/ Wat we willen is	,
http://localhost:8080/tms/oms/shipment-order_edit?base_sessionLevelOffset=3&systemid=26988690&systemId=26988690&returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::
http://localhost:8080/tms/oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::&systemid=26988690&base_windowToOpenUrl=&base_windowToOpenTitle=&base_sessionLevelOffset=-1&systemId=26988690&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=-1&randomizingurl=1461130446076




/ Einde SAVE NEW SHI ON JUST CREATED RETURN SHI OF NOT PLANNED SHO 

/ SAVE SHI ON JUST CREATED RETURN SHI OF PLANNED SHO

/ 13	. 

/ verschil met return van niet planned sho	,

/ als we de shi save	, doet JS level-1
/ Klopt	, want we hebben eerst create shi gedaan	, die heeft level+1	, 
/ bij return van niet planned sho, deden we dat niet	, dus wat bij save level-0	, 

/ 13	. 

/ right click planning, shipment order, create
http://localhost:8080/tms/oms/shipment-order-template_list?refresh=false&emptySession=true

/ click create order
http://localhost:8080/tms/oms/shipment-order_create?systemid=26788426&base_sessionLevelOffset=1
/ 1 level hoger	,
/ 26788426 is de sho tpl pharma	,

/ save sho	,
http://localhost:8080/tms/oms/shipment-order_edit?base_windowToOpenUrl=&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988700&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=0&randomizingurl=1461138225747
/ dezelfde level	, logisch	,

/ add shi	,
http://localhost:8080/tms/oms/shipment-order_edit?base_windowToOpenUrl=&randomizingurl=1461138225747&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988700&base_windowToOpenScrollbar=&base_windowToOpenWidth=&base_windowToOpenHeight=&base_sessionLevelOffset=0&randomizingurl=1461138424403

/ create return	,
http://localhost:8080/tms/oms/shipment-order_create-return?shipmentorder_systemid=26988700&base_sessionLevelOffset=1

/ 13	. 

/ edit shi	,

PageRequest.formContextLinkOnclick = function() {
		} else {
			theActiveFormManager.setRedirectUrl(this.getAttribute("href"));
"shipment-item_edit?systemId=27155565&base_sessionLevelOffset=1"
/ 27155565 is de shi	,
/ this=<a .../>
/ wordt als POST request param meegegeven	,
			theActiveFormManager.submit(null,true,1);	
/c
ShipmentOrderSaveAction
level 8	, RequestManager doet niet level+1	, want is een save	,
/c
ShipmentOrderSaveAction(AbstractSaveAction).getRedirectUrl() line: 469	
			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
1
			if (myLevelOffset == 1) {
/ JA
				} else {
					myRet = getRequest().getParameter(REDIRECT_TO_ATTR);
shipment-item_edit?systemId=27155565&base_sessionLevelOffset=1
...
/t
ShipmentOrderSaveAction(AbstractSaveAction).afterSave() line: 162	
				myRedirectUrl = getRedirectUrl();
/d
			getRequest().setAttribute("redirectTo", myRedirectUrl);
			RedirectSaveAction.redirect(getRedirector(), getRequest(), myRedirectUrl);
/t
		try {
			String myRedirectPage = "../core/generic_save_redirect?redirectTo=" + URLEncoder.encode(anUrl, "UTF-8");
/d
../core/generic_save_redirect?redirectTo=..%2Foms%2Fshipment-item_edit%3FsystemId%3D27155565%26base_sessionLevelOffset%3D1%26base_sessionLevelOffset%3D1%26base_sessionLevelOffset%3D1
			aRedirector.redirect(true, myRedirectPage);

/ we zien in devtools	,

POST
Request URL:http://localhost:8080/tms/oms/shipment-order_save
Form Data:
redirectTo:shipment-item_edit?systemId=27155565&base_sessionLevelOffset=1
doRedirect:true
base_sessionLevelOffset:1		/ is 'n save -> RequestManager doet niets met deze 1	,
/ AL	, 

GET
Request URL:http://localhost:8080/tms/core/generic_save_redirect?redirectTo:../oms/shipment-item_edit?systemId=27155565&base_sessionLevelOffset=1&base_sessionLevelOffset=1&base_sessionLevelOffset=1
GET
Request URL:http://localhost:8080/tms/oms/shipment-item_edit?systemId=27155565&base_sessionLevelOffset=1&base_sessionLevelOffset=1&base_sessionLevelOffset=1&randomizingurl=1461139639820

/s
ShipmentItemEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	
/ Inderdaad	, de level+1
/ sets shipment-item_edit in de list	,

/ 13	. 

/ Save shi	,

/s
$ vi class.shipment-order_edit.js

ShipmentOrderEdit.saveShipmentItem = function() {
	var myRedirectLevelOffset=0;
	if (document.getElementById("shipmentItemSystemId").value!="0") {
/ JA
		myRedirectLevelOffset=-1;
	}
    theShipmentorderFormManager.submit("../oms/shipment-item_save", false, myRedirectLevelOffset);

/ we zien 	,
Request URL:http://localhost:8080/tms/oms/shipment-item_save
Form Data
continuationId:1461140236981
flowDefinition:reload
redirectTo:../core/back?levelOffset=-1
doRedirect:false
base_sessionLevelOffset:-1			/ save	, RequestManager doet niets met deze	,

/c
ShipmentOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	
/ level blijft 9	, want is save 	,
/c
ShipmentOrderSaveAction(BoundSaveAction).afterSave() line: 65	
/ doet niets	, want is zo conf in cocoon	,
/c
ShipmentItemSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
/ level verandert niet, want de RequestManager is er al	, 
/c
ShipmentItemSaveAction(AbstractSaveAction).getRedirectUrl() line: 469	
			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
-1
/ Klopt	, bij click edit sho werd level+1	, dus moet nu -1
/ bij return van not planned sho clicked we NIET 'create shi' , want form stond al klaar	, TODO (Afmaken, met : if (document.getElementById("shipmentItemSystemId").value!="0") { 	, en TODO (Als we 'create shi') 

			} else {
				int myTargetLevel = getRequestManager().getLevel() + myLevelOffset;
8
				BaseRequest myTargetRequest = getRequestManager().getRequestForLevel(myTargetLevel);
				myRet = myTargetRequest.getUrl();
../oms/shipment-order_create-return
				Map<String, String> myMap = new HashMap<String, String>(myTargetRequest.getParams());
{shipmentorder_systemid=26988700, base_sessionLevelOffset=1}
/ 26988700 is de sho	, NIET de return	,

				if (myRet.indexOf("_create") > 0 || myRet.indexOf("_copy") > 0) {
/ JA
					myRet = EntityActionUtil.getActionUrl(myRet, "edit");
../oms/shipment-order_edit
					myMap.remove("systemid");
					myMap.remove("systemId");
					myMap.put("systemId", "" + getValueObject().getSystemId());
{shipmentorder_systemid=26988700, base_sessionLevelOffset=1, systemId=26988701}
/ 26988701 is de return	,

				for (Enumeration myEnumeration = getRequest().getParameterNames(); myEnumeration.hasMoreElements();) {
					myKey = (String) myEnumeration.nextElement();
					if (myKey.startsWith("base_")) {
						myMap.put(myKey, getRequestParameter(myKey));
myMap=
{base_windowToOpenUrl=, shipmentorder_systemid=26988700, base_windowToOpenTitle=, base_sessionLevelOffset=-1, systemId=26988701, base_windowToOpenScrollbar=, base_windowToOpenHeight=, base_windowToOpenWidth=}
/ base_sessionLevelOffset=-1 is op -1 set	, de bedoeling	, want de level is nog 9	, we hebben alleen de level 8 url +params opgehaald	,

/c
ShipmentOrderEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	

/ we zien in devtools	,

GET
Request URL:http://localhost:8080/tms/core/generic_save_redirect?redirectTo:../oms/shipment-order_edit?base_windowToOpenUrl=&shipmentorder_systemid=26988700&base_windowToOpenTitle=&base_sessionLevelOffset=-1&systemId=26988701&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=-1

GET
Request URL:http://localhost:8080/tms/oms/shipment-order_edit?base_windowToOpenUrl=&shipmentorder_systemid=26988700&base_windowToOpenTitle=&base_sessionLevelOffset=-1&systemId=26988701&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=-1&randomizingurl=1461142027530

			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
		if (isFlowControlEnabled) {
			BaseRequest myRequest = new BaseRequest(aRequest);
			int myLevelOffset = parseLevel(getRequest().getParameter(SESSION_LEVEL_OFFSET));
-1
			setLevel(Math.max(0, getLevel() + myLevelOffset));
8
/c
ShipmentOrderEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
			int mySystemId = getSystemIdFromRequest();
26988701
/ return 	,



/ Einde SAVE SHI ON JUST CREATED RETURN SHI OF PLANNED SHO

/ DEL SHI ON RETURN SHO 

/ click delete shi	,
PageRequest.formContextLinkOnclick = function() {
		} else {
			theActiveFormManager.setRedirectUrl(this.getAttribute("href"));
"http://localhost:8080/tms/oms/shipment-item_delete?systemId=27155565&base_sessionLevelOffset=1"
			theActiveFormManager.submit(null,true,1);
/s
ShipmentOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
/ level blijft 8	, want is save	,
/c
/s
ShipmentOrderSaveAction(AbstractSaveAction).getRedirectUrl() line: 473	
			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
1
			if (myLevelOffset == 1) {
				} else {
					myRet = getRequest().getParameter(REDIRECT_TO_ATTR);
shipment-item_delete?systemId=27155565&base_sessionLevelOffset=1
/c
			String myRedirectPage = "../core/generic_save_redirect?redirectTo=" + URLEncoder.encode(anUrl, "UTF-8");
../core/generic_save_redirect?redirectTo=..%2Foms%2Fshipment-item_delete%3FsystemId%3D27155565%26base_sessionLevelOffset%3D1%26base_sessionLevelOffset%3D1%26base_sessionLevelOffset%3D1
			aRedirector.redirect(true, myRedirectPage);
/c
ShipmentItemDeleteAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
/s
		if (isFlowControlEnabled) {
			BaseRequest myRequest = new BaseRequest(aRequest);
			int myLevelOffset = parseLevel(getRequest().getParameter(SESSION_LEVEL_OFFSET));
1
			setLevel(Math.max(0, getLevel() + myLevelOffset));
9
			mySessionMap.put(myRequest.getRequestId(), myRequest);
			try {
				mySessionList.add(getLevel(), myRequest.getRequestId());
/c
RedirectByFlowAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	

/ we zien in devtools	,
GET
Request URL:http://localhost:8080/tms/core/back?levelOffset=1
/s
RedirectByFlowAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	
/s
RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 109	
/ level blijft onveranderd	,

/ Interrmezzo

$ vi core-sitemap.xmap

           <map:match pattern="back">
               <map:act type="redirectByFlow">
				    <map:parameter name="levelOffset" value="{request-param:levelOffset}"/>
				</map:act>
            </map:match>

$ vi generic-actions.xmap
<map:action name="redirectByFlow" src="com.mpobjects.control.action.RedirectByFlowAction"/>

$ vi oms-sitemap.xmap

			<map:match pattern="shipment-item_delete">
				<map:act type="shipmentItemDelete"/>
	        	<map:redirect-to uri="../core/back?levelOffset=1"/>


/ Einde Interrmezzo


/ Einde DEL SHI ON RETURN SHO 

/ DEL SHI ON RETURN SHO 

/ 13	. 

/ we proberen de shi delete link base_sessionLevelOffset=0	,	 en dan de sho save geen .saveAfter	,

$ vi ActionTag.java
	protected void renderAction(StringBuffer anOutputBuffer) {
			} else {
				myUrl += "?systemId=" + myVO.getSystemId();
				if (StringUtils.isFalse(getDirect())) {
					if (theEntity.equals("shipmentItem") && theName.equals("delete")) {
						myUrl += "&amp;base_sessionLevelOffset=0";
					} else {
						myUrl += "&amp;base_sessionLevelOffset=1";

$ vi oms-sitemap.xmap

			<map:match pattern="shipment-item_delete">
				<map:act type="shipmentOrderSave">
					<map:parameter name="noRedirect" value="true"/>
				</map:act>
				<map:act type="shipmentItemDelete"/>

/ Ook	
$ vi class.pagerequest.js
PageRequest.formContextLinkOnclick = function() {
		if (this.className.match("formDirect")) {
			theActiveFormManager.submit(this.getAttribute("href"),false,0);
		} else {
			theActiveFormManager.setRedirectUrl(this.getAttribute("href"));
			theActiveFormManager.submit(null,true,1);
/ We willen, 
			theActiveFormManager.submit(null,true,0);


/ we zien	,

ava.lang.IllegalStateException: Request parameter sho_systemid must be present for action com.mpobjects.oms.ratecalc.control.shipmentorder.action.ShipmentOrderSaveAction, request uri/tms/oms/shipment-item_delete at
com.mpobjects.control.action.AbstractAction.assertError(AbstractAction.java:493) at
com.mpobjects.control.action.AbstractAction.assertRequestParameterRequired(AbstractAction.java:516) at
com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderSaveAction.handlePreAssertions(ShipmentOrderSaveAction.java:53) at
com.mpobjects.control.action.AbstractAction.act(AbstractAction.java:170) at

/ Einde DEL SHI ON RETURN SHO 

/ EDIT SAVE SHI 

/////////////////////////////////////////////////////////////////////

/ 7	. 

<form action="shipment-order_save" .../>

/ click edit shi button	,

$ vi class.pagerequest.js

PageRequest.formContextLinkOnclick = function() {
		} else {
			theActiveFormManager.setRedirectUrl(this.getAttribute("href"));
			theActiveFormManager.submit(null,true,1);

/////////////////////////////////////////////////////////////////////
/ we geven null als action	, dus pakt hij de default	, shipment-order_save	,

/ als we de shi save	,

$ vi class.shipment-order_edit.js

ShipmentOrderEdit.saveShipmentItem = function() {
	var myRedirectLevelOffset=0;
	if (document.getElementById("shipmentItemSystemId").value!="0") {
		myRedirectLevelOffset=-1;
	}
    theShipmentorderFormManager.submit("../oms/shipment-item_save", false, myRedirectLevelOffset);

/ Nu geven we de action	, dus overwrite hij de default	, 

$ vi oms-sitemap.xmap

			<map:match pattern="shipment-item_save">
				<map:act type="shipmentOrderSave">
					<map:parameter name="noRedirect" value="true"/>
					<map:parameter name="skipFieldPrefix" value="productItem"/>
				</map:act>
				<map:act type="shipmentItemSave"/>
			</map:match>

/////////////////////////////////////////////////////////////////////
/ We zien 2 act's bij shipment-item_save	. Hij gaat ze allebei doen	, dus we vallen eerst in ShipmentOrderSaveAction.act	, en dan in ShipmentItemSaveAction.act	,
/ als we de 1ste act weglaten	, dan vallen we direct in ShipmentItemSaveAction.act	,

/ TODO

/ Einde EDIT SAVE SHI 


/ DEL SHI

/ SAMENVATTING

ShipmentOrderDeleteAction doet level+1	, 
RedirectFowAction.act doet level-1, want conf base?levelOffset=1	,

/ Einde SAMENVATTING

PageRequest.formContextLinkOnclick = function() {
		} else {
			theActiveFormManager.setRedirectUrl(this.getAttribute("href"));
/s
        		document.getElementById("redirectTo").value=anUrl;
shipment-item_delete?systemId=27155590&base_sessionLevelOffset=1			/ 27155590 is de shi	,
/t
			theActiveFormManager.submit(null,true,1);				/ net als edit	,
/ action form=default = shipment-order_save

POST request
Request URL:http://localhost:8080/tms/oms/shipment-order_save
Form Data:
redirectTo:shipment-item_delete?systemId=27155590&base_sessionLevelOffset=1
doRedirect:true
base_sessionLevelOffset:1

/ Deze POST request heeft base_sessionLevelOffset:1	, de GET request die daarna komt heeft ook base_sessionLevelOffset=1	, 
/ Nu eerst deze POST	, omdat het een save is, heeft base_sessionLevelOffset geen effect op level	, maar heeft wel effect in .afterSave	, dat hij redirectTo kiest	,

/s
ShipmentOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 157	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
isFlowControlled()==false,	 want een AbstractSaveAction implements NonScreenAction	,
/ dus level blijft onveranderd	,

/c
ShipmentOrderSaveAction(BoundSaveAction).afterSave() line: 72	
		if (shouldTakeControl()) {
/ JA	, 
noRedirect==false	,
/ we zijn in de gewone shipment-order_save	,  niet in de shipment-order_save act die was conf in de shipment-item_save	,
/s
ShipmentOrderSaveAction(AbstractSaveAction).getRedirectUrl() line: 469	
			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
1
			if (myLevelOffset == 1) {
				} else {
					myRet = getRequest().getParameter(REDIRECT_TO_ATTR);
shipment-item_delete?systemId=27155590&base_sessionLevelOffset=1

/s
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
/c

/we zien	,
Request URL:http://localhost:8080/tms/core/generic_save_redirect?redirectTo=..%2Foms%2Fshipment-item_delete%3FsystemId%3D27155590%26base_sessionLevelOffset%3D1%26base_sessionLevelOffset%3D1%26base_sessionLevelOffset%3D1

Request URL:http://localhost:8080/tms/oms/shipment-item_delete?systemId=27155590&base_sessionLevelOffset=1&base_sessionLevelOffset=1&base_sessionLevelOffset=1&randomizingurl=1461217889975 

/s
ShipmentItemDeleteAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
isFlowControlled()==true 	, want is geen save of redirect	,
/ level+1	, want het is geen save	of redirect	, 
/ sets url in list	,
/ adds shipment-item_delete aan het einde van de sessionList,
[1461216097763, 1461227464920, 1461237166394, 1461242320471, 1461243535776]
/ Dit is WH de reden van het bestaan van deze list, sessionMap heeft geen order	,
/ TODO


/ Interrmezzo

$ vi core-sitemap.xmap

           <map:match pattern="back">
               <map:act type="redirectByFlow">
				    <map:parameter name="levelOffset" value="{request-param:levelOffset}"/>
				</map:act>
            </map:match>

$ vi generic-actions.xmap
<map:action name="redirectByFlow" src="com.mpobjects.control.action.RedirectByFlowAction"/>

$ vi oms-sitemap.xmap

			<map:match pattern="shipment-item_delete">
				<map:act type="shipmentItemDelete"/>
	        	<map:redirect-to uri="../core/back?levelOffset=1"/>


/ Einde Interrmezzo

/c
/ handler ...
/ en daarna	,
/s
RedirectByFlowAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
/ laat level	, want  isFlowControlEnabled==false
/ want	,
public class RedirectByFlowAction extends AbstractAction implements NonScreenAction {

/ we zien	,
GET
Request URL:http://localhost:8080/tms/core/back?levelOffset=1

/s
RedirectByFlowAction.act() line: 17	

/ Intermezzo

/ RequestManager werkt met SESSION_LEVEL_OFFSET=hbase_sessionLevelOffset	, 
/ RedirectByFlowAction werkt met levelOffset	, die uiteindelijk RequestManager.setLevel calls	,  

/ Einde Intermezzo

/ Intermezzo

/ we hebben delete een shi op een return order	, die nog niet was saved	,

"getRequestManag...uestForLevel(4)"	 (pending)	
	params	HashMap  (id=27321)	
{randomizingurl=1461243481203, base_sessionLevelOffset=1, systemId=27155595}
	requestId	"1461243535776" (id=27302)	
	url	"../oms/shipment-item_delete" (id=27322)	

"getRequestManag...uestForLevel(3)"	 (pending)	
	params	HashMap  (id=27650)	
{shipmentorder_systemid=26988726, base_sessionLevelOffset=1}
	requestId	"1461242320471" (id=27319)	
	url	"../oms/shipment-order_create-return" (id=27651)	

"getRequestManag...uestForLevel(2)"	 (pending)	
	params	HashMap  (id=27293)	
{base_windowToOpenUrl=, randomizingurl=1461227643174, base_windowToOpenTitle=, base_sessionLevelOffset=-1, systemId=26988726, base_windowToOpenScrollbar=, base_windowToOpenHeight=, base_windowToOpenWidth=}
	requestId	"1461237166394" (id=27291)	
	url	"../oms/shipment-order_edit" (id=27294)	

"getRequestManag...uestForLevel(1)"	 (pending)	
	params	HashMap  (id=26384)	
{usePaginator=true, is_search_header_request=true, base_sessionLevelOffset=0, filter_2=, filter_1=, filter_4=, filter_3=, selectBox=null;, filter_6=, filter_5=, screenId=shipment-order-template, filter_7=, filter_8=, column=, do=filter, shipment-order-create-url=shipment-order_create}
	requestId	"1461227464920" (id=26385)	
	url	"../oms/shipment-order-template_list" (id=26394)	

"getRequestManag...uestForLevel(0)"	 (pending)	
	params	HashMap  (id=26400)	
{}
	requestId	"1461216097763" (id=26401)	
	url	"../core/opening_page" (id=26402)	


/ Einde Intermezzo


		int myLevel = Math.abs(getParameters().getParameterAsInteger(LEVEL_OFFSET)) * -1;
-1
		int myTargetLevel = getRequestManager().getLevel() + myLevel;
4-1=3
		BaseRequest myRequest = getRequestManager().getRequestForLevel(myTargetLevel);

/ als rm item op sho 	,
../oms/shipment-order_edit
{returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::, systemid=26988715, base_windowToOpenUrl=, randomizingurl=1461216263353, base_windowToOpenTitle=, base_sessionLevelOffset=0, systemId=26988715, base_windowToOpenScrollbar=, base_windowToOpenHeight=, base_windowToOpenWidth=}

/ als rm item op return sho	,
../oms/shipment-order_create-return
{shipmentorder_systemid=26988726, base_sessionLevelOffset=1}

		getRequestManager().setLevel(myTargetLevel);

		Map<String, String> myParams = myRequest.getParams();
		myParams.put(RequestManager.SESSION_LEVEL_OFFSET, "0");

/ bij item op sho	,
		String myRequestUrl = getRequestUrl(myRequest.getUrl(), myParams);
../oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::&systemid=26988715&base_windowToOpenUrl=&randomizingurl=1461216263353&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988715&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=

/ bij item op return sho	,
{shipmentorder_systemid=26988726, base_sessionLevelOffset=0}
/ Dus base_sessionLevelOffset=0	, 

		RedirectSaveAction.redirect(getRedirector(), getRequest(), myRequestUrl);
/s
RedirectSaveAction.redirect(Redirector, Request, String, int) line: 51	

/ Hier komen we dus ook via deze manier	,

			aRedirector.redirect(true, myRedirectPage);

Request URL:http://localhost:8080/tms/oms/shipment-order_create-return?shipmentorder_systemid=26988726&base_sessionLevelOffset=0&randomizingurl=1461247163060
/c
ShipmentOrderEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	

/ level+0	,

			for (int i = getLevel(); i < mySessionList.size();) {
/ level=3	, list size=5
/ rm shipment-order_create-return+params en shipment-item_delete+params  
				myRequestId = mySessionList.get(i);
				mySessionList.remove(i);
				mySessionMap.remove(myRequestId);
			}
			mySessionMap.put(myRequest.getRequestId(), myRequest);
				mySessionList.add(getLevel(), myRequest.getRequestId());
/  shipment-order_create-return+nieuwe params	,

/ ERR	,
org.postgresql.util.PSQLException: ERROR: duplicate key value violates unique constraint "shipment_order_org_uk" Detail: Key (shipment_order_id, organization_systemid)=(SH000144580RT, 500) already exists.


/ Einde DEL SHI

/ URLS SHI+RETURN  

/ 7	. 

create return	, save return	,

/save new sho	,
http://localhost:8080/tms/oms/shipment-order_edit?base_windowToOpenUrl=&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988729&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=0&randomizingurl=1461247883703

/ add shi	,
http://localhost:8080/tms/oms/shipment-order_edit?base_windowToOpenUrl=&randomizingurl=1461247883703&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988729&base_windowToOpenScrollbar=&base_windowToOpenWidth=&base_windowToOpenHeight=&base_sessionLevelOffset=0&randomizingurl=1461247931491

/ create return
http://localhost:8080/tms/oms/shipment-order_create-return?shipmentorder_systemid=26988729&base_sessionLevelOffset=1

/ save the return	, this url we want to see when we deleted an item	,
http://localhost:8080/tms/oms/shipment-order_edit?base_windowToOpenUrl=&shipmentorder_systemid=26988729&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988730&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=0&randomizingurl=1461248549594

/ 7	. 

/ create return, edit shi	,

/ create sho	,
http://localhost:8080/tms/oms/shipment-order_edit?base_windowToOpenUrl=&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988731&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=0&randomizingurl=1461248914322

/ add shi	,
http://localhost:8080/tms/oms/shipment-order_edit?base_windowToOpenUrl=&randomizingurl=1461248914322&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26988731&base_windowToOpenScrollbar=&base_windowToOpenWidth=&base_windowToOpenHeight=&base_sessionLevelOffset=0&randomizingurl=1461248999741

/ edit shi 	,
http://localhost:8080/tms/oms/shipment-item_edit?systemId=27155601&base_sessionLevelOffset=1&base_sessionLevelOffset=1&base_sessionLevelOffset=1&randomizingurl=1461249040160

/ save shi	,
http://localhost:8080/tms/oms/shipment-order_edit?base_windowToOpenUrl=&randomizingurl=1461248914322&base_windowToOpenTitle=&base_sessionLevelOffset=-1&systemId=26988731&base_windowToOpenScrollbar=&base_windowToOpenWidth=&base_windowToOpenHeight=&base_sessionLevelOffset=-1&randomizingurl=1461249073915

/ create return	,
http://localhost:8080/tms/oms/shipment-order_create-return?shipmentorder_systemid=26988731&base_sessionLevelOffset=1

/ edit shi	,
http://localhost:8080/tms/oms/shipment-item_edit?systemId=27155602&base_sessionLevelOffset=1&base_sessionLevelOffset=1&base_sessionLevelOffset=1&randomizingurl=1461249201789

/ save shi	,
http://localhost:8080/tms/oms/shipment-order_edit?base_windowToOpenUrl=&shipmentorder_systemid=26988731&base_windowToOpenTitle=&base_sessionLevelOffset=-1&systemId=26988732&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=-1&randomizingurl=1461249241844
//////////////////////////////////////////////////////////////////////////////////////////////
/ Deze url moeten we krijgen met delete	 shi	,


/ Einde URLS SHI+RETURN  

/ URLS EDIT SHI ON RETURN





/ Einde URLS EDIT SHI ON RETURN

/ DEL SHI ON RETURN

/ we zijn op return order SH000144580RT
/ delete item	,

PageRequest.formContextLinkOnclick = function() {
			theActiveFormManager.setRedirectUrl(this.getAttribute("href"));
"shipment-item_delete?systemId=27155595&base_sessionLevelOffset=1"
			theActiveFormManager.submit(null,true,1);
/ Dus shipment-order_save + redirectTo: shipment-item_delete?systemId=27155595&base_sessionLevelOffset=1"	, net als bij edit	,

/ Einde DEL SHI ON RETURN

/ SAVE NEW SHI

/ 7	. 

/ we zien in HTML de 'Save shipment item' button	,
<input type="button" name="saveShipmentItemBtn" id="saveShipmentItemBtn" value="Save Shipment item" onclick=" theShipmentorderFormManager.submit('../oms/shipment-order_save-shipment-item', false, 0);">

$ vi class.shipment-order_edit.js

pageRequestAddOnLoadEvent("shipmentOrderCorrectLocations()");

function shipmentOrderCorrectLocations() {
    var mySaveShipmentItemBtn = document.getElementById("saveShipmentItemBtn");
    if (mySaveShipmentItemBtn!=null) {
        mySaveShipmentItemBtn.onclick = ShipmentOrderEdit.saveShipmentItem;
    }

ShipmentOrderEdit.saveShipmentItem = function() {
	var myRedirectLevelOffset=0;
	if (document.getElementById("shipmentItemSystemId").value!="0") {		
/ NEE
		myRedirectLevelOffset=-1;
/ NIET
	}
    theShipmentorderFormManager.submit("../oms/shipment-item_save", false, myRedirectLevelOffset);
}
/ dus de onclick method in HTML is overwrite hier	,

/ cocoon config,	
			<map:match pattern="shipment-item_save">
				<map:act type="shipmentOrderSave">
					<map:parameter name="noRedirect" value="true"/>
				</map:act>
				<map:act type="shipmentItemSave"/>
			</map:match>

POST Request URL:http://localhost:8080/tms/oms/shipment-item_save
Form Data:
redirectTo:../core/back?levelOffset=-1	 / TODO
doRedirect:false
base_sessionLevelOffset:0

/s
ShipmentOrderSaveAction(BoundSaveAction).afterSave() line: 65	
/ NIETS

/c
ShipmentItemSaveAction(AbstractSaveAction).getRedirectUrl() line: 469	
			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
0
			} else {
				int myTargetLevel = getRequestManager().getLevel() + myLevelOffset;
				BaseRequest myTargetRequest = getRequestManager().getRequestForLevel(myTargetLevel);
				myRet = myTargetRequest.getUrl();
../oms/shipment-order_edit
				Map<String, String> myMap = new HashMap<String, String>(myTargetRequest.getParams());
{base_windowToOpenUrl=, randomizingurl=1461227643174, base_windowToOpenTitle=, base_sessionLevelOffset=0, systemId=26988726, base_windowToOpenScrollbar=, base_windowToOpenWidth=, base_windowToOpenHeight=}

				for (Enumeration myEnumeration = getRequest().getParameterNames(); myEnumeration.hasMoreElements();) {
/ Is nu hetzelfde request	, dus gebeurt er NIETS nu	,

/c
ShipmentOrderEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	

/ Einde SAVE NEW SHI

/ EDIT SAVE EXISTING SHI

/ EDIT

/ we zien	,
<a class="action formContext edit" href="shipment-item_edit?systemId=27155593&amp;base_sessionLevelOffset=1"><img src="../lookandfeel/styles/images/icons/check24.png" alt="Edit" title="Edit"></a>

/ Maar	,
$ vi class.pagerequest.js

function pageRequestAddOnLoadEvent(anEvent) {
        pageRequestEventList[pageRequestEventList.length] = anEvent;
}
pageRequestAddOnLoadEvent("PageRequest.processGenericClassEvents()");

PageRequest.processGenericClassEvents = function() {
	//loop through all links
	var myElements = document.getElementsByTagName("a");
	for(var i=0;i<myElements.length;i++) {
		myElement = myElements[i];
		} else if (myElement.className.match("formContext")) {
			PageRequest.initformContextElement(myElement);
		}

PageRequest.initformContextElement = function(myElement) {
...
	myElement.onclick = PageRequest.formContextLinkOnclick;

/ Daarom	,
/s
$ vi class.pagerequest.jms
PageRequest.formContextLinkOnclick = function() {
		} else {
			theActiveFormManager.setRedirectUrl(this.getAttribute("href"));
shipment-item_edit?systemId=27155593&base_sessionLevelOffset=1
			theActiveFormManager.submit(null,true,1);	/ POST's base_sessionLevelOffset=1 -> en pakt redirectTo een regel hierboven	,

/ Intermezzo

/ zonet	, bij save shi button	, 
    theShipmentorderFormManager.submit("../oms/shipment-item_save", false, myRedirectLevelOffset);
/ bij new shi is myRedirectLevelOffset=0	-> shi_save.afterSave pakt url uit huidig level	,

/ Einde Intermezzo

/s
ShipmentOrderSaveAction(BoundSaveAction).afterSave() line: 86	
/c
ShipmentOrderSaveAction(AbstractSaveAction).getRedirectUrl() line: 469	
			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
1
/ POST's base_sessionLevelOffet	,

				} else {
					myRet = getRequest().getParameter(REDIRECT_TO_ATTR);
shipment-item_edit?systemId=27155593&base_sessionLevelOffset=1
/c
/s
ShipmentItemEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
level+1
adds shipment-item_edit url to list

/ Einde EDIT


/ 7	. 

/ SAVE

/ Intermezzo

/ In devtools Network	,
Preserve log: check
Start time	: in rechter kolom kies deze , NIET Timeline	,

/ Einde Intermezzo

/s
ShipmentOrderEdit.saveShipmentItem = function() {
	var myRedirectLevelOffset=0;
	if (document.getElementById("shipmentItemSystemId").value!="0") {
/ JA
		myRedirectLevelOffset=-1;
	}
    theShipmentorderFormManager.submit("../oms/shipment-item_save", false, myRedirectLevelOffset);
/c

/ we zien,	
POST Request URL:http://localhost:8080/tms/oms/shipment-item_save
redirectTo:../core/back?levelOffset=-1				/ TODO
doRedirect:false
base_sessionLevelOffset:-1

/c
ShipmentOrderSaveAction(BoundSaveAction).afterSave() line: 81	
/ NIETS	, want noRedirect==true, 	want de url is shipment-item_save	, see cocoon config	,

/c
ShipmentItemSaveAction(BoundSaveAction).afterSave() line: 65	
/s
ShipmentItemSaveAction(AbstractSaveAction).getRedirectUrl() line: 469	
			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
-1
/ van de POST 
				int myTargetLevel = getRequestManager().getLevel() + myLevelOffset;
2

/ Intermezzo

getRequestManager().getRequestForLevel(3)
../oms/shipment-item_edit
{randomizingurl=1461234397837, base_sessionLevelOffset=1, systemId=27155593}

getRequestManager().getRequestForLevel(2)
../oms/shipment-order_edit
{base_windowToOpenUrl=, randomizingurl=1461227643174, base_windowToOpenTitle=, base_sessionLevelOffset=0, systemId=26988726, base_windowToOpenScrollbar=, base_windowToOpenHeight=, base_windowToOpenWidth=}

getRequestManager().getRequestForLevel(1)
../oms/shipment-order-template_list
{usePaginator=true, is_search_header_request=true, base_sessionLevelOffset=0, filter_2=, filter_1=, filter_4=, filter_3=, selectBox=null;, filter_6=, filter_5=, screenId=shipment-order-template, filter_7=, filter_8=, column=, do=filter, shipment-order-create-url=shipment-order_create}

getRequestManager().getRequestForLevel(0)
../core/opening_page
{}

				for (Enumeration myEnumeration = getRequest().getParameterNames(); myEnumeration.hasMoreElements();) {
					myKey = (String) myEnumeration.nextElement();
					if (myKey.startsWith("base_")) {
						myMap.put(myKey, getRequestParameter(myKey));
					}
				}
				myMap.put(RequestManager.SESSION_LEVEL_OFFSET, myLevelOffsetStr);
{base_windowToOpenUrl=, randomizingurl=1461227643174, base_windowToOpenTitle=, base_sessionLevelOffset=-1, systemId=26988726, base_windowToOpenScrollbar=, base_windowToOpenWidth=, base_windowToOpenHeight=}

				myRet = getRequestUrl(myRet, myMap);
../oms/shipment-order_edit?base_windowToOpenUrl=&randomizingurl=1461227643174&base_windowToOpenTitle=&base_sessionLevelOffset=-1&systemId=26988726&base_windowToOpenScrollbar=&base_windowToOpenWidth=&base_windowToOpenHeight=
////////////////////
/ Inderdaad	, base_sessionLevelOffset=-1 now	,

/c
ShipmentOrderEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
level-1

/ Einde SAVE


/ Einde EDIT SAVE EXISTING SHI

/ FIX PCT-1181

$ vi oms-sitemap.xmap

			<map:match pattern="shipment-order_create-return">
				<map:act type="shipmentOrderCreateReturn"/>
->				<!-- <map:read mime-type="text/html" type="jsp" src="jsp/customer-order_edit.jsp"/> -->
->				<map:redirect-to uri="shipment-order_edit?systemid={request-attr:systemid}"/>
			</map:match>

$ vi ShipmentOrderCreateReturn.java

	public Map act() throws java.lang.Exception {
		ShipmentOrderVO myVO = MpoBeanFactory.getBean(ShipmentOrderService.class).createReturnShipmentOrder(myOriginalShipmentOrder);
->		getRequest().setAttribute("systemid", myVO.getSystemId());


/ Einde FIX PCT-1181

/ MPO-326 

/ 7	. 

/ patch-586-consignment-detail.sql wil fk  COLD_COL_FK maken, maar die bestaat al	,

/ we kunnen zien dat patch-390-customer-order-line-detail.sql deze al heeft create	, 

/ Maar we kunnen ook	,

/ firebird geeft geen foreign keys bij show table	, 
/ Use rdb$relation_constraints	, 

SQL> select distinct RDB$CONSTRAINT_TYPE from rdb$relation_constraints;

RDB$CONSTRAINT_TYPE 
=================== 
CHECK               
FOREIGN KEY         
NOT NULL            
PRIMARY KEY         
UNIQUE           

SQL> select * from rdb$relation_constraints where RDB$CONSTRAINT_name like '%COLD_COL_FK%';

RDB$CONSTRAINT_NAME                                                                           RDB$CONSTRAINT_TYPE RDB$RELATION_NAME                                                                             RDB$DEFERRABLE RDB$INITIALLY_DEFERRED RDB$INDEX_NAME                                                                                
=============================================================================== =================== =============================================================================== ============== ====================== =============================================================================== 
COLD_COL_FK                                                                                   FOREIGN KEY         CUSTOMER_ORDER_LINE_DETAIL                                                                    NO             NO                     COLD_COL_FK         

/ we zien dat COLD_COL_FK al bestaat	,

/ De patch heeft exec, dus de CREATE TABLE CONSIGNMENT_DETAIL is al	, 
/ we doen met de hand	,

SQL> ALTER TABLE CONSIGNMENT_DETAIL ADD CONSTRAINT CONSD_COL_FK FOREIGN KEY (ENTITY_SYSTEMID) REFERENCES CONSIGNMENT (SYSTEM_ID);
SQL> ALTER TABLE CONSIGNMENT_DETAIL ADD CONSTRAINT CONSD_EDT_FK FOREIGN KEY (EDT_SYSTEMID) REFERENCES ENTITY_DETAIL_TYPE (SYSTEM_ID);
SQL> commit;

/ en 
SQL> update mpo_scs_patch set status='MANUALLY_APPLIED' where name like '%patch-586-consignment-detail.sql';
SQL> commit;

/ MORGENOCHTEND
Problem while executing SQL statement in patch [oms/patch-587-consignment-processingtime.sql]: 
2016-04-22 16:50:41,405 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) ALTER TABLE CONSIGNMENT ADD COLUMN PLANNED_PROCESSING_TIME bigint

/ Einde MPO-326 



/ POSTGRESQL

[eric@localhost bin]$ PGPASSWORD=h^Zgcyr\&Q psql -U vanderveldene -h  pnl-app-t.intermax.mp-objects.com pnllogistics <<SQL 
copy (SELECT ee.expected_end,ee.expected_end_expr,ee.closed_on_system,so.service_order_id,sh.shipment_order_id FROM event_event ee, service_order so, consignment c, service_action sa, shipment_order sh 
where ee.service_order_systemid = so.system_id 
and c.service_order_systemid=so.system_id 
and sa.consignment_systemid=c.system_id
and sa.shipment_order_systemid=sh.system_id
and ee.event_type_systemid=26767125
and ee.expected_end>'2016-04-06') to stdout with csv header
SQL

/ wegschrijven naar file	,

[eric@localhost bin]$ PGPASSWORD=h^Zgcyr\&Q psql -U vanderveldene -h  pnl-app-t.intermax.mp-objects.com pnllogistics <<SQL  >/tmp/cargo.csv
copy (SELECT ee.expected_end,ee.expected_end_expr,ee.closed_on_system,so.service_order_id,sh.shipment_order_id FROM event_event ee, service_order so, consignment c, service_action sa, shipment_order sh 
where ee.service_order_systemid = so.system_id 
and c.service_order_systemid=so.system_id 
and sa.consignment_systemid=c.system_id
and sa.shipment_order_systemid=sh.system_id
and ee.event_type_systemid=26767125
and ee.expected_end>'2016-04-06') to stdout with csv header
SQL

/ of	,

[eric@localhost bin]$ PGPASSWORD=h^Zgcyr\&Q psql -U vanderveldene -h  pnl-app-t.intermax.mp-objects.com pnllogistics -c "copy (SELECT ee.expected_end,ee.expected_end_expr,ee.closed_on_system,so.service_order_id,sh.shipment_order_id FROM event_event ee, service_order so, consignment c, service_action sa, shipment_order sh 
where ee.service_order_systemid = so.system_id 
and c.service_order_systemid=so.system_id 
and sa.consignment_systemid=c.system_id
and sa.shipment_order_systemid=sh.system_id
and ee.event_type_systemid=26767125
and ee.expected_end>'2016-04-06') to stdout with csv header" >/tmp/cargo.csv
/ OK

/ Einde POSTGRESQL












/ DEBUG PLAN PCT-1234

/ RM

/ 7	. 

/ pnllogistics7a  = acc db waarbij het fout gaat	,

/ stack trace	,
/s
	PathTemplateVO.matchesWith(ShipmentOrderVO) line: 272	
	PathServiceImpl.getPathsFor(Resource, ShipmentOrderVO, PathSelectionMode, int) line: 308	
		for (int i = 0; i < myInitialPathsList.size(); i++) {
			PathTemplateVO myPathVO = myInitialPathsList.get(i);
->			if (myPathVO.matchesWith(aVO)) {
				if (!hasServiceActions && !myPathVO.isAddToExisting()) {

	PathServiceImpl.getPathsFor(Resource, ShipmentOrderVO) line: 251	
	PathServiceImpl.getPathsFor(ShipmentOrderVO) line: 119	
	PathAssignmentPickOptimalService(AutomaticPathAssignmentService).getPathTemplateList(ShipmentOrderVO) line: 148	
	PathAssignmentPickOptimalService(AutomaticPathAssignmentService).assignPath(ShipmentOrderVO) line: 61	
	ShipmentOrderSaveAction(ShipmentOrderSaveAction).handleSave() line: 112	
	ShipmentOrderSaveAction.handleSave() line: 19	
	ShipmentOrderSaveAction(AbstractSaveAction).act() line: 69	
	ShipmentOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	

/ bij -> set we een conditional b	,
myPathVO.getSystemId()==26859337 || myPathVO.getSystemId()==26859328
/ dan valt hij in path template	,
pathTemplateVO:PHARMA RT/RT BE|LU uit NL WITHOUT LABEL(systemId:26859337)

pnllogistics7a=# select*from path_template where path_template='PHARMA RT/RT BE|LU uit NL WITH LABEL';
system_id                | 26859328
path_template            | PHARMA RT/RT BE|LU uit NL WITH LABEL
pnllogistics7a=# select*from path_template where path_template='PHARMA RT/RT BE|LU uit NL WITHOUT LABEL';
-[ RECORD 1 ]------------+-------------------------------------------------------------
system_id                | 26859337
path_template            | PHARMA RT/RT BE|LU uit NL WITHOUT LABEL

this	PathTemplateVO  (id=24151)	
	code	"PHARMA RT/RT BE|LU uit NL WITHOUT LABEL" (id=24156)	
	systemId	26859337	
	thePathCriteriumList	PersistentBag  (id=24162)	
		bag	ArrayList  (id=24164)	
			elementData	Object[10]  (id=24165)	
				[0]	PathCriteriumVO  (id=24166)	
				[1]	PathCriteriumVO  (id=24167)	
				[2]	PathCriteriumVO  (id=24168)	
Implementation class :holdStatusVO/code
ValueFrom :!.+
				[3]	PathCriteriumVO  (id=24169)	
Implementation class :billToPartyVO/partyGroupAsString
ValueFrom :!(.*,)?RETURN_LABEL(,.*)?
				[4]	PathCriteriumVO  (id=24170)	
				[5]	PathCriteriumVO  (id=24171)	
				[6]	PathCriteriumVO  (id=24172)	
			size	7	

/ debug	,
/s
PathTemplateVO.matchesWith(ShipmentOrderVO) line: 273	
		for (int i = 0; i < thePathCriteriumList.size(); i++) {
			if (!thePathCriteriumList.get(i).match(aVO)) {
/s
PathCriteriumVO.match(ShipmentOrderVO) line: 223	
		JXPathContext myContext = JXPathContext.newContext(aVO);
		theImplementationClass = getCriteriumTypeVO().getImplementationClass();
"billToPartyVO/partyGroupAsString"
		Object myValue = myContext.getValue(theImplementationClass);
"999"
/ Klopt	,
aVO	com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO_$$_javassist_143  (id=23188)	
	handler	org.hibernate.proxy.pojo.javassist.JavassistLazyInitializer  (id=24419)	
		target	com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO  (id=24425)	
			theBillToParty	com.mpobjects.oms.model.entity.VirtualParty  (id=24442)	
				partyGroupsAsString	"999" (id=24413)	
				partyId	"9105522" (id=24457)	

		boolean myResult = matchValue(myValue);
true
/ TODO
/ want	,
/s
PathCriteriumVO.matchValue(Object) line: 252	
/=
	public boolean matchValue(Object aValue) {
aValue="999"

this=
theSystemId: 26859344
CriteriumTypeSystemId :26682067
CriteriumType :null
Implementation class :billToPartyVO/partyGroupAsString
PathTemplateSystemId :26859337
ValueFrom :!(.*,)?RETURN_LABEL(,.*)?
ValueTo :null
ValueType :REGEX

		Matcher myMatcher = getMatchTypeName().getMatcher(this);

myMatcher	com.mpobjects.oms.util.match.impl.RegexMatcher  (id=24682)	
	pattern	java.util.regex.Pattern  (id=24685)	
	theInvertFlag	true	
	theRegex	"(.*,)?RETURN_LABEL(,.*)?" (id=24686)	

			myMatch = myMatcher.match(aValue);
/s
RegexMatcher.match(Object) line: 64	
		String myValue = obj.toString();
		boolean myResult = pattern.matcher(myValue).matches();
/s
Pattern.matcher(CharSequence) line: 1088	

this	java.util.regex.Pattern  (id=24685)	
(.*,)?RETURN_LABEL(,.*)?
input "999"

        Matcher m = new Matcher(this, input);
/t
/s

Matcher.matches() line: 559	

this	java.util.regex.Matcher  (id=24712)	
	acceptMode	0	
	anchoringBounds	true	
	first	-1	
	from	0	
	groups	(id=24716)	
	hitEnd	false	
	last	0	
	lastAppendPosition	0	
	locals	(id=24718)	
	lookbehindTo	0	
	oldLast	-1	
	parentPattern	java.util.regex.Pattern  (id=24685)		(.*,)?RETURN_LABEL(,.*)?
	requireEnd	false	
	text	"999" (id=24413)	
	to	3	
	transparentBounds	false	

        return match(from, ENDANCHOR);
/s
Matcher.match(int, int) line: 1213	
        boolean result = parentPattern.matchRoot.match(this, from, text);
false
/t
RegexMatcher.match(Object) line: 74	
		boolean myResult = pattern.matcher(myValue).matches();
false
		return theInvertFlag ? !myResult : myResult;
true
/t
PathCriteriumVO.matchValue(Object) line: 265	
			myMatch = myMatcher.match(aValue);
true
/t
PathCriteriumVO.match(ShipmentOrderVO) line: 238	

/ 7	. 

/ Met pnllogistics6a	, 

/ Hier gaat het wel OK	,







/ Einde DEBUG PLAN PCT-1234

/ PCT=1181

/ 7	. 

/ op test	,

SH000128076
/ was ingeplanned	, 
/ we create return , click 'Create Return'	,
SH000128076RT
/ we delete 'n shipment item	, we krijgen ERR	,

Show / Hide Details
org.postgresql.util.PSQLException: ERROR: duplicate key value violates unique constraint "shipment_order_org_uk" Detail: Key (shipment_order_id, organization_systemid)=(SH000128076RT, 500) already exists. at 
com.mpobjects.oms.dao.entitylog.EntityLogDAOHibernate.save(EntityLogDAOHibernate.java:172) at 
com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.saveLog(RateCalculationVO.java:1600) at 
com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.runFor(RateCalculationVO.java:846) at 
com.mpobjects.oms.ratecalc.model.service.CalculationServiceImpl.recalculate(CalculationServiceImpl.java:585) at 
com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalculate(RateCalcEventListener.java:396) at 
com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalcShipOrderPrice(RateCalcEventListener.java:98) at 
com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.handleEvent(RateCalcEventListener.java:79) at 
com.mpobjects.oms.model.eventhandler.util.ListenerList.fireEvent(ListenerList.java:82) at 
com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:109) at 
com.mpobjects.oms.model.service.ShipmentOrderServiceImpl.triggerEventHandler(ShipmentOrderServiceImpl.java:2637) at 
com.mpobjects.oms.model.service.ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderServiceImpl.java:2084) at 
com.mpobjects.oms.model.service.ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderServiceImpl.java:1985) at 
com.mpobjects.oms.model.service.ShipmentOrderServiceImpl.createReturnShipmentOrder(ShipmentOrderServiceImpl.java:775) at 
com.mpobjects.pnllogistics.model.shipmentorder.service.PnlLogisticsShipmentOrderServiceImpl.createReturnShipmentOrder(PnlLogisticsShipmentOrderServiceImpl.java:20) at 
com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderCreateReturnAction.act(ShipmentOrderCreateReturnAction.java:56) at 
com.mpobjects.control.action.AbstractAction.act(AbstractAction.java:171) at 


/ 7	. 

/ er is een patch branch voor cargo	,
[eric@localhost workspace]$ svn co  https://system.mp-objects.com/svn/tms/patches/2016.01/pnllogistics
[eric@localhost workspace]$ cp trunk/.classpath pnllogistics/
[eric@localhost workspace]$ cp trunk/.project pnllogistics/
[eric@localhost workspace]$ cp trunk/application.properties pnllogistics/
$ vi pnllogistics/.project
<projectDescription>
    <name>pnllogistics</name>

$ vi pnllogistics/.classpath
    <classpathentry kind="con" path="org.dbpowder.plugins.LIB_CONTAINER/recurse~project/pnllogistics/base-framework/core/lib/jar"/>
    <classpathentry kind="con" path="org.dbpowder.plugins.LIB_CONTAINER/recurse~project/pnllogistics/base-framework/buildscripts/build-lib"/>
    <classpathentry kind="con" path="org.dbpowder.plugins.LIB_CONTAINER/recurse~project/pnllogistics/module/interfacing/lib"/>

/ in eclipse	,
File, Import..., Existing projects into workspace
Select root dir: /home/eric/Devel/Java/Eclipse/eclipse-jee/workspace/pnllogistics

/ 7	;

org.postgresql.util.PSQLException: ERROR: duplicate key value violates unique constraint "shipment_order_org_uk" Detail: Key (shipment_order_id, organization_systemid)=(SH000128076RT, 500) already exists. at 
org.postgresql.util.PSQLException: ERROR: duplicate key value violates unique constraint "shipment_order_org_uk" Detail: Key (shipment_order_id, organization_systemid)=(SH000128145RT, 500) already exists.

/ Intermezzo

/ welke sho's hebben meer dan 1 shi?

/ 13	. 

/ we hebben test create,	

foo=> create table cnt(s varchar(32),t varchar(32));
CREATE TABLE
foo=> insert into cnt values('s1','a'),('s2','a'),('s3','b'),('s4','c'),('s5','c'),('s6','c');
INSERT 0 6
foo=> select*from cnt;
 s  | t 
----+---
 s1 | a
 s2 | a
 s3 | b
 s4 | c
 s5 | c
 s6 | c
(6 rows)
foo=> select count(s)from cnt group by t;
 count 
-------
     3
     1
     2
(3 rows)

foo=> select count(s)from cnt group by t having count(s)>1;
/ of	,
foo=> select count(*)from cnt group by t having count(*)>1;
 count 
-------
     3
     2
(2 rows)

/ 13	. 

pnllogistics=> select count(system_id)from shipment_item group by shipment_order_systemid order by count(system_id) desc limit 10;
 count 
-------
   104
    87
    79
    75
    75
    73
    72
    70
    70
    69
(10 rows)

pnllogistics=> select shipment_order_systemid,count(system_id)from shipment_item group by shipment_order_systemid having count(system_id)=3 order by count(system_id) desc limit 10;
 shipment_order_systemid | count 
-------------------------+-------
                26684404 |     3
                26684618 |     3
                26684749 |     3
                26684760 |     3
                26684961 |     3
                26685037 |     3
                26685099 |     3
                26685145 |     3
                26685169 |     3
                26684281 |     3
(10 rows)

/ 13	. 

/ we willen sho's shipment_order_id zien	, 

/ we maken join	 maar tonen alleen shi columns	,

pnllogistics=> select shi.shipment_order_systemid,count(shi.system_id)from shipment_item shi join shipment_order sho on shi.shipment_order_systemid=sho.system_id group by shi.shipment_order_systemid having count(shi.system_id)=3 order by count(shi.system_id) desc limit 10;

 shipment_order_systemid | count 
-------------------------+-------
                26684404 |     3
                26684618 |     3
                26684749 |     3
                26684760 |     3
                26684961 |     3
                26685037 |     3
                26685099 |     3
                26685145 |     3
                26685169 |     3
                26684281 |     3
(10 rows)
/ (*)

select shi.shipment_order_systemid,count(shi.system_id)
from shipment_item shi 
join shipment_order sho on shi.shipment_order_systemid=sho.system_id 
group by shi.shipment_order_systemid 
having count(shi.system_id)=3 
order by count(shi.system_id) 
desc limit 10;

/ Als we een sho column erbij nemen		,
pnllogistics=> select sho.shipment_order_id,count(shi.system_id)from shipment_item shi join shipment_order sho on shi.shipment_order_systemid=sho.system_id group by shi.shipment_order_systemid having count(shi.system_id)=3 order by count(shi.system_id) desc limit 10;
ERROR:  column "sho.shipment_order_id" must appear in the GROUP BY clause or be used in an aggregate function
/ TODO
/ MICHEL



/ 13	. 

/ we doen	, op test	,

pnllogistics=> select shi.shipment_order_systemid,count(shi.system_id)from shipment_item shi join shipment_order sho on shi.shipment_order_systemid=sho.system_id group by shi.shipment_order_systemid  order by count(shi.system_id) desc limit 10;
 shipment_order_systemid | count 
-------------------------+-------
                26904144 |   104
                26916358 |    87
                26961856 |    79
                26898975 |    75
                26891953 |    75
                26810546 |    73
                26734678 |    72
                26897728 |    70
                26961570 |    70
                26914535 |    69

/ 13	. 

/ we vergeten sho.shipment_order_systemid	, en willen order op shi.system_id desc	,

pnllogistics=> select shi.shipment_order_systemid,count(shi.system_id)from shipment_item shi join shipment_order sho on shi.shipment_order_systemid=sho.system_id group by shi.shipment_order_systemid having count(shi.system_id)=3 order by shi.system_id desc limit 10;
ERROR:  column "shi.system_id" must appear in the GROUP BY clause or be used in an aggregate function
/ TODO
/ MICHEL

/ we doen op test dan maar met de hand	,
/ we kiezen een sho uit lijst (*)	,
pnllogistics=> select shipment_order_id from shipment_order where system_id=26684404;
 shipment_order_id 
-------------------
 SH000000169
(1 row)
/ create return sho	, 
/ we zien dat hij al in db is	, dus is save gedaan	, 
/ TODO
/ als we shi 3 delete	, 
/ We moeten in een party de adresnummer geven	,
/ zien we ERR	,
org.postgresql.util.PSQLException: ERROR: duplicate key value violates unique constraint "shipment_order_org_uk" Detail: Key (shipment_order_id, organization_systemid)=(SH000000177RT, 500) already exists.
/ Als we opnieuw open	, zien we dat de shi toch weg is	,



/ Einde Intermezzo

/ we doen local	,

pnllogistics6a=# select shipment_order_systemid,count(system_id)from shipment_item group by shipment_order_systemid having count(system_id)=3 order by count(system_id) desc limit 10;
 shipment_order_systemid | count 
-------------------------+-------
                26684404 |     3
                26684618 |     3
                26684749 |     3
                26684760 |     3
                26684961 |     3
                26685037 |     3
                26685099 |     3
                26685145 |     3
                26685169 |     3
                26684281 |     3

/ we zien in eclipse bij Problems	,
Description	Resource	Path	Location	Type
Project 'pnllogistics' is missing required source folder: 'module/systemlog/src/java'	pnllogistics		Build path	Build Path Problem
/ we zien bij Build path module/systemlog/src/java	, 
/ maar deze is er helemaal niet	, in trunk wel, en we hebben .classpath van de trunk	, 
/ dus rm deze van .classpath , of in eclipse bij build path	, remove	,

/ Doe met awk	,
[eric@localhost pnllogistics]$ awk '{printf $1","}'
                26684404 |     3
                26684618 |     3
                26684749 |     3
                26684760 |     3
                26684961 |     3
                26685037 |     3
                26685099 |     3
                26685145 |     3
                26685169 |     3
                26684281 |     3
26684404,26684618,26684749,26684760,26684961,26685037,26685099,26685145,26685169,26684281,

pnllogistics6a=# select system_id,shipment_order_id from shipment_order where system_id in (26684404,26684618,26684749,26684760,26684961,26685037,26685099,26685145,26685169,26684281);
 system_id | shipment_order_id 
-----------+-------------------
  26684281 | SH000000163 			v
  26684404 | SH000000169			
  26684618 | SH000000177
  26684749 | SH000000186
  26684760 | SH000000187
  26684961 | SH000000209
  26685037 | SH000000214
  26685099 | SH000000218
  26685145 | SH000000223
  26685169 | SH000000225
(10 rows)

/ HIER HIER HIER

/ 7	.

/ we kiezen
  26684281 | SH000000163 			v
/ en click 'Create return	,
SH000000163RT

/ Zoek naar index	,
pnllogistics6a=# \d shipment_order
Indexes:
    "shipment_order_org_uk" UNIQUE, btree (shipment_order_id, organization_systemid)

pnllogistics6a=# select sho.shipment_order_id,org.organization_id from shipment_order sho join organization org on sho. organization_systemid=org.system_id  where shipment_order_id like 'SH000000163%';
 shipment_order_id | organization_id 
-------------------+-----------------
 SH000000163       | PNL-CARGO
 SH000000163RT     | PNL-CARGO
(2 rows)

/ Als we een shi rm	, 
org.postgresql.util.PSQLException: ERROR: duplicate key value violates unique constraint "shipment_order_org_uk" Detail: Key (shipment_order_id, organization_systemid)=(SH000000177RT, 500) already exists.

/ 7	. 

/ Als we de laatste shi rm	, dan ERR	, met de datums	,
/ De err zien we in	devtools, network,	
shipment-order_save
<p>Error fields:
				requestedEndAfterDaterequestedStartAfterDatetoAddress2
				</p>
/ Deze zien we niet meer op het scherm door een timestamp tooltip	, 
/ TODO
Req Start(after) 13 Apr 2016
Req End(after)	25 Apr 2016	 (today)
Req End(before)	TODO
/ en 
ShipTo, Housenumber 7	,

/s
/ stack trace	, 
	ShipmentOrderSaveAction(ShipmentOrderSaveAction).handleSave() line: 61	
	ShipmentOrderSaveAction.handleSave() line: 19	
	ShipmentOrderSaveAction(AbstractSaveAction).act() line: 69	
	ShipmentOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	
/ debug	,
/s
ShipmentOrderSaveAction(ShipmentOrderSaveAction).handleSave() line: 102	
			} else {

				ShipmentOrderService shipmentOrderService = ShipmentOrderUtil.getShipmentOrderFacadeLocal();
				ShipmentOrderVO myOldVO = shipmentOrderService.getShipmentOrder(shipmentOrderVO.getSystemId());
				shipmentOrderVO.setSchedule(null);
				shipmentOrderVO.setScheduleXml(myOldVO.getScheduleXml());
				shipmentOrderVO.setScheduleDescription(myOldVO.getScheduleDescription());
->				shipmentOrderVO = shipmentOrderService.updateShipmentOrder(shipmentOrderVO, true, true);
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).updateShipmentOrder(ShipmentOrderVO, boolean, boolean) line: 2014	
			return updateShipmentOrder(aShipmentOrder, new TMSEventContext(), propagateChange);
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 2074	
...
				myNew = shipmentOrderDao.save(myNew);
/s
ShipmentOrderDaoImpl(GenericHibernateDAO).save(Type) line: 503	
		} else {
			getHibernateTemplate().update(anEntity);

/c
	ShipmentItemDeleteAction.act() line: 23	
/s
		} else {
			getShipmentItemService().delete(getSystemIdFromRequest());
/s
ShipmentItemServiceImpl.delete(int) line: 136	

shipmentItem: 3(systemId:27130102, labelInfo:9186282781389345)
pnllogistics6a=#  select sho.* from shipment_item shi join shipment_order sho on shi.shipment_order_systemid=sho.system_id where shi.system_id=27130102;
  26975454 |           0 | SH000000163RT     |    ...

		ShipmentItemVO myVO = getBySystemId(aSystemId);
		delete(myVO);
/s
ShipmentItemServiceImpl.delete(ShipmentItemVO, boolean) line: 147	
		deleteWithoutRecalc(aShipmentItemVO);
/s
ShipmentItemServiceImpl.deleteWithoutRecalc(ShipmentItemVO) line: 176	

shipmentItem: 3(systemId:27130102, labelInfo:9186282781389345)

/ Klopt	,
pnllogistics6a=# select shi.system_id from shipment_item shi join shipment_order sho on shi.shipment_order_systemid=sho.system_id where sho.shipment_order_id='SH000000163RT';
 system_id 
-----------
  27130102
  27130101
  27130100
(3 rows)

		// Delete packed items since they have no home anymore.
		List<PackedItemVO> myPackedItems = new ArrayList<PackedItemVO>(aShipmentItemVO.getPackedItemList());
[com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:27101914]
		for (PackedItemVO myPackedItem : myPackedItems) {
			ProductItemVO myProductItemVO = myPackedItem.getProductItemVO();
PRODUCT_ITEM id:null(systemId:26982149)

			myProductItemVO.getPackedItemList()=
[com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:27101914, 
com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:27101913, 
com.mpobjects.oms.model.shipmentorder.vo.PackedItemVO/id:27101912]

pnllogistics6a=# select*from tms_packed_item where system_id in (27101914,27101913,27101912);
 system_id | quantity | product_item_systemid | shipment_item_systemid | actual_quantity | additional_info 
-----------+----------+-----------------------+------------------------+-----------------+-----------------
  27101914 |  1.00000 |              26982149 |               27130102 |            NULL | NULL
  27101913 |  1.00000 |              26982149 |               27130101 |            NULL | NULL
  27101912 |  1.00000 |              26982149 |               27130100 |            NULL | NULL

/ we zien op het scherm in deze return 1 product item en 3 shi's	, dat geeft dus 3 packed items	,

			myProductItemVO.getPackedItemList().remove(myPackedItem);
			packedItemDAO.delete(myPackedItem);
/ 1 for loop	,

		if (myShipmentOrderVO != null) {
			myShipmentOrderVO.removeShipmentItem(aShipmentItemVO);
		super.delete(aShipmentItemVO);
/s
ShipmentItemServiceImpl(AbstractService).delete(TypeVO) line: 29	
		getDAO().delete(aType.getSystemId());
target	ShipmentItemDAOHibernate  (id=21701)	extends GenericHibernateDAO<ShipmentItemVO>	,

/t
ShipmentItemServiceImpl.deleteWithoutRecalc(ShipmentItemVO) line: 223	
		super.delete(aShipmentItemVO);
/d
		ShipmentItemEvent myEvent = new ShipmentItemEvent(aShipmentItemVO, null, ShipmentItemEvent.DELETED, new TMSEventContext());
		fireShipmentItemEvent(myEvent);
/t
ShipmentItemServiceImpl.delete(ShipmentItemVO, boolean) line: 150	
		deleteWithoutRecalc(aShipmentItemVO);
/d
		if (aRecalcualate && myShipmentOrderVO != null) {
			recalculateShipmentOrder(myShipmentOrderVO);
/ TODO
/c
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 2074	
				myNew = shipmentOrderDao.save(myNew);
ShipmentOrder: SH000000163RT(SystemId:26975454; Org:PNL-CARGO)
/ 2 keer 
/ TODO

/ 7	. 

pnllogistics6a=# select shipment_order_id from shipment_order where  shipment_order_id like 'SH000000169%';
 shipment_order_id 
-------------------
 SH000000169
(1 row)

/ we create return	, 
 


 












/ Einde PCT-1181

/ DEBUG PCT-1181

$ vi sho-shipmentitems.tag
		<mpo:setFormVO valueObject="${shipmentItemList}" prefix="shipmentItemList${shipmentItemList.systemId}">
			<tr class="list${index %2}">
				<td nowrap="nowrap"><c:if test="${!form.formReadOnly}">
						<mpo:rowCheckBox />
						<c:if test="${!form.formReadOnly}">
							<mpo:action name="edit" entity="shipmentItem" />
							<mpo:action name="delete" entity="shipmentItem" />
/ TODO

/ we zien in HTML	,
<a class="action formContext delete" href="shipment-item_delete?systemId=27130102&amp;base_sessionLevelOffset=1">
	<img src="../lookandfeel/styles/images/icons/delete24.png" alt="Delete" title="Delete"></a>

$ vi oms-sitemap.xmap
			<map:action logger="shipmentorder" name="shipmentItemDelete" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentItemDeleteAction"/>

			<map:match pattern="shipment-item_delete">
				<map:act type="shipmentItemDelete"/>
	        	<map:redirect-to uri="../core/back?levelOffset=1"/>

/s
ShipmentOrderSaveAction.handleSave() line: 17	
		super.handleSave();
/s
ShipmentOrderSaveAction(ShipmentOrderSaveAction).handleSave() line: 63	


/ 13	. 
/s
ShipmentOrderTriggerDAOImpl(GenericHibernateDAO).getAll(boolean) line: 266	
			return (List<Type>) getHibernateTemplate().loadAll(type);
...
/s
ShipmentOrderVO(LogisticsOrderVO).getRequestedTotalColli() line: 576	
/ TODO HIBERNATE

/ 13	. 

/c
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 2083	
				if (propagateChange) {
					MpoBeanFactory.getBean(ConsignmentService.class).handleShipmentOrderChange(myNew, myOldVO);
/s
ConsignmentServiceImpl.handleShipmentOrderChange(ShipmentOrderVO, ShipmentOrderVO) line: 618	
/ NIETS	, 
/ er is niets veranderd,	
/t
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 2083	
					triggerEventHandler(myOldVO, myNew, anEventContext);
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).triggerEventHandler(ShipmentOrderVO, ShipmentOrderVO, TMSEventContext) line: 2637	
		eventHandlerService.handleEvent(myEvent);
/s
EventHandlerServiceImpl.handleEvent(Event) line: 109	
			listenerList.fireEvent(anEvent);
/s
ListenerList.fireEvent(Event<?>) line: 80	
		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);

this	ListenerList  (id=21466)	
	theListenerList	ArrayList  (id=21474)	
[com.mpobjects.document.model.eventhandler.util.DocumentEventListener,
 com.mpobjects.oms.model.eventhandler.util.CustomerOrderEventListener,
 com.mpobjects.oms.service.shipmentordercostpart.ShoCostAllocationEventListener,
 com.mpobjects.oms.service.shipmentorderprice.ShoPriceAllocationServiceImpl,
 com.mpobjects.omscarcon.model.eventhandler.util.TMSCarConServiceOrderEventListener,
 com.mpobjects.invoice.model.eventhandler.util.SupplierInvoiceUpdateEventListener,
 com.mpobjects.inventory.service.stocktransaction.StockTransactionEventListener,
 com.mpobjects.event.service.DeferredEventServiceImpl@307b13d6,
 com.mpobjects.event.event.model.util.EventEventListener,
 com.mpobjects.oms.ratecalc.model.eventhandler.util.AllocationEventListener,
 com.mpobjects.customerinvoice.model.eventhandler.util.CustomerInvoiceUpdateEventListener,
 com.mpobjects.capabletopromise.model.eventhandler.util.CapableToPromiseEventListener,
 com.mpobjects.pnllogistics.model.event.PnlLogisticsEventListener,
 com.mpobjects.emailnot.notification.model.EmailReportEventListener,
 com.mpobjects.invoice.model.service.InvoiceServiceOrderEventHandler@e71e1fa,
 com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener]
/s
RateCalcEventListener.handleEvent(Event) line: 67	
			String myRecalcExecution = ApplicationPropertyManager.getInstance().getModuleProperty("ratecalc", "serviceorder.ratecalculation.execution");
			if (myRecalcExecution.equalsIgnoreCase("auto")) {
				recalcServiceOrderCost(anEvent);
/s
RateCalcEventListener.recalcServiceOrderCost(Event) line: 234	





			String myPriceExecution = ApplicationPropertyManager.getInstance().getModuleProperty("ratecalc", "shipmentorderprice.ratecalculation.execution");
			if (myPriceExecution.equalsIgnoreCase("auto")) {
				recalcShipOrderPrice(anEvent);
anEvent	ShipmentOrderPriceEvent  (id=20901)	

/ Intermezzo

/ See
->
->>
->>>
/ we zien 2 events :
anEvent	com.mpobjects.oms.model.eventhandler.util.ShipmentOrderPriceEvent  (id=20901)	
anEvent	com.mpobjects.oms.model.eventhandler.util.ShipmentOrderEvent  (id=20835)	

/ we zijn in 	,

/ stack trace	,
/s
	RateCalcEventListener.handleEvent(Event) line: 83	
this	RateCalcEventListener  (id=20838)	
anEvent	ShipmentOrderPriceEvent  (id=20901)	

	ListenerList.fireEvent(Event<?>) line: 82	
		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);

	EventHandlerServiceImpl.handleEvent(Event) line: 109	
			listenerList.fireEvent(anEvent);

	ShipmentOrderPriceServiceImpl.delete(ShipmentOrderPricePartVO) line: 51	
->>>	ShipmentOrderPriceEvent myEvent = new ShipmentOrderPriceEvent(aPricePart, null, ShipmentOrderPriceEvent.DELETED);
		// And why aren't we checking whether allocation is enabled here?
		try {
			eventHandlerService.handleEvent(myEvent);

	ShipmentOrderCalculationServiceImpl.updateShipmentOrderPricePartList(AlternativeResultSet, ShipmentOrderVO, List<String>) line: 1055	
			for (ShipmentOrderPricePartVO part : state.getRateParts()) {
				shipmentOrderPriceService.delete(part);

	ShipmentOrderCalculationServiceImpl.update(ShipmentOrderVO, AlternativeResultSet, List<String>, boolean) line: 398	
		// Update the price parts
		try {
			if (updateShipmentOrderPricePartList(anAlternative, shipmentOrder, aLog)) {

	RateCalculationVO.applyCorrections(AlternativeResultSet, List<String>, boolean) line: 1026	
				} else {
					/* Used to set the requested dates on a shipment order */
					MpoBeanFactory.getBean(ShipmentOrderCalculationService.class).update(myShipmentOrder, aResultSet, aLog, aPersist);

	RateCalculationVO.runFor(RateAgreementVO, RateCalculationAlternative) line: 1226	
						if (!isTest() && !isEvaluation()) {
							applyCorrections(myResultSet, anAlternative.getLogLines(), false);

	RateCalculationVO.calculateWithoutVariables() line: 1370	
			RateCalculationAlternative myAlterNative = new RateCalculationAlternative(this);
/ TODO
			alternativeList.add(myAlterNative);
			for (RateAgreementVO myAgreement : getRateAgreementVO()) {
				runFor(myAgreement, myAlterNative);

	RateCalculationVO.runFor(List<RateAgreementVO>) line: 784	
			if (myList.size() == 0) {
				/* No variables (iteration) involved */
				calculateWithoutVariables();

	CalculationServiceImpl.recalculate(LogisticsOrderVO, AgreementType, TMSEventContext) line: 585	
				// Now calculate the rates
				myRateCalculationVO.runFor(mySelectedRateAgreement);

	RateCalcEventListener.recalculate(ShipmentOrderVO, AgreementType, TMSEventContext) line: 396	
		} else {
			getCalculationService().recalculate(anOrder, aRateType, anEventContext);

	RateCalcEventListener.recalcShipOrderPrice(Event) line: 98	
			} else if (myType.equals(ShipmentOrderEvent.UPDATED)) {
				ShipmentOrderVO myNewShipmentOrderVO = ((ShipmentOrderEvent) anEvent).getNewShipmentOrderVO();
				recalculate(myNewShipmentOrderVO, AgreementType.SHIPMENT_ORDER, anEvent.getEventContext());
anEvent	ShipmentOrderEvent  (id=20835)	

	RateCalcEventListener.handleEvent(Event) line: 79	
				recalcServiceOrderCost(anEvent);
->>				recalcShipOrderPrice(anEvent);
anEvent	ShipmentOrderEvent  (id=20835)	

	ListenerList.fireEvent(Event<?>) line: 82	
		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);
anEvent	ShipmentOrderEvent  (id=20835)	

	EventHandlerServiceImpl.handleEvent(Event) line: 109	
			listenerList.fireEvent(anEvent);

	PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).triggerEventHandler(ShipmentOrderVO, ShipmentOrderVO, TMSEventContext) line: 2637	
		} else {
->			myEvent = new ShipmentOrderEvent(anOldVO, aNewVO, ShipmentOrderEvent.UPDATED, anEventContext);
		eventHandlerService.handleEvent(myEvent);

	PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 2084	
					triggerEventHandler(myOldVO, myNew, anEventContext);

	PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).updateShipmentOrder(ShipmentOrderVO, boolean, boolean) line: 2014	
			return updateShipmentOrder(aShipmentOrder, new TMSEventContext(), propagateChange);

	ShipmentOrderSaveAction(ShipmentOrderSaveAction).handleSave() line: 102	
				shipmentOrderVO = shipmentOrderService.updateShipmentOrder(shipmentOrderVO, true, true);

	ShipmentOrderSaveAction.handleSave() line: 19	
	ShipmentOrderSaveAction(AbstractSaveAction).act() line: 69	
	ShipmentOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	


/ 13	. 

/ debug	,

/c
ShipmentItemDeleteAction.act() line: 23	
		} else {
			getShipmentItemService().delete(getSystemIdFromRequest());
/s
ShipmentItemServiceImpl.delete(int) line: 136	
		ShipmentItemVO myVO = getBySystemId(aSystemId);
		delete(myVO);
/s
			delete(aShipmentItemVO, true);
/s
ShipmentItemServiceImpl.delete(ShipmentItemVO, boolean) line: 147	
		ShipmentOrderVO myShipmentOrderVO = resolveShipmentOrder(aShipmentItemVO);
		deleteWithoutRecalc(aShipmentItemVO);
/s
ShipmentItemServiceImpl.deleteWithoutRecalc(ShipmentItemVO) line: 176	
		// Delete packed items since they have no home anymore.
		List<PackedItemVO> myPackedItems = new ArrayList<PackedItemVO>(aShipmentItemVO.getPackedItemList());
		for (PackedItemVO myPackedItem : myPackedItems) {
			ProductItemVO myProductItemVO = myPackedItem.getProductItemVO();
			myProductItemVO.getPackedItemList().remove(myPackedItem);
			packedItemDAO.delete(myPackedItem);
		}
		aShipmentItemVO.getPackedItemList().clear();
		getDAO().save(aShipmentItemVO);

		if (myShipmentOrderVO != null) {
			myShipmentOrderVO.removeShipmentItem(aShipmentItemVO);

		aShipmentItemVO.getChildren().clear();
		super.delete(aShipmentItemVO);
/s
ShipmentItemServiceImpl(AbstractService).delete(TypeVO) line: 29	
		getDAO().delete(aType.getSystemId());

		ShipmentItemEvent myEvent = new ShipmentItemEvent(aShipmentItemVO, null, ShipmentItemEvent.DELETED, new TMSEventContext());
		fireShipmentItemEvent(myEvent);
/s
ShipmentItemServiceImpl.fireShipmentItemEvent(ShipmentItemEvent) line: 300	
			eventHandlerService.handleEvent(anEvent);
/s
EventHandlerServiceImpl.handleEvent(Event) line: 72	
			listenerList.fireEvent(anEvent);
/s
ListenerList.fireEvent(Event<?>) line: 82	
		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);
/s
RateCalcEventListener.handleEvent(Event) line: 67	
/ OK

/t
ShipmentItemServiceImpl.delete(ShipmentItemVO, boolean) line: 150	
		deleteWithoutRecalc(aShipmentItemVO);
/d
		if (aRecalcualate && myShipmentOrderVO != null) {
			recalculateShipmentOrder(myShipmentOrderVO);
/s
ShipmentItemServiceImpl(ShipmentOrderChildService).recalculateShipmentOrder(ShipmentOrderVO) line: 20	
		getShipmentOrderService().recalculateShipmentOrder(aShipmentOrder);
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).recalculateShipmentOrder(ShipmentOrderVO) line: 1296	
		recalculateShipmentOrder(aShipmentOrderVO, false);
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).recalculateShipmentOrder(ShipmentOrderVO, boolean) line: 1307	
			updateShipmentOrder(aShipmentOrder, true);
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).updateShipmentOrder(ShipmentOrderVO, boolean) line: 1985	
		return updateShipmentOrder(aShipmentOrder, new TMSEventContext(), propagateChange);
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 2047	
				myNew = shipmentOrderDao.merge(aShipmentOrder);
/s
ShipmentOrderDaoImpl(GenericHibernateDAO).merge(Type) line: 433	
		} else {
			anObject = type.cast(getHibernateTemplate().merge(anObject));
/s
ShipmentOrderVO(LogisticsOrderVO).getRequestedTotalColli() line: 576	
/ TODO HIBERNATE

/t
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 2076	
				myNew = shipmentOrderDao.merge(aShipmentOrder);
/d
...
				myNew = shipmentOrderDao.save(myNew);
...
				if (propagateChange) {
					MpoBeanFactory.getBean(ServiceActionService.class).handleShipmentOrderChange(myOldVO, myNew);
					MpoBeanFactory.getBean(ConsignmentService.class).handleShipmentOrderChange(myNew, myOldVO);
					triggerEventHandler(myOldVO, myNew, anEventContext);
...
/s
EventHandlerServiceImpl.handleEvent(Event) line: 72	
anEvent	ShipmentOrderEvent  (id=22402)	

			listenerList.fireEvent(anEvent);
...
/s
RateCalcEventListener.handleEvent(Event) line: 67	
				recalcShipOrderPrice(anEvent);
/ TODO (Duurt lang)	,

/ 7	. 

/ we create	,
SH000000177RT	,
/ we komen heel vaak in RateCalcEventListener.handleEvent	,
/ TODO

/ we delete item	,

/ 7	. 

/s
ShipmentItemServiceImpl.delete(ShipmentItemVO, boolean) line: 150	
		ShipmentOrderVO myShipmentOrderVO = resolveShipmentOrder(aShipmentItemVO);
		deleteWithoutRecalc(aShipmentItemVO);
		if (aRecalcualate && myShipmentOrderVO != null) {
			recalculateShipmentOrder(myShipmentOrderVO);
/s
RateCalcEventListener.handleEvent(Event) line: 67	
anEvent	ShipmentOrderEvent  (id=23631)	





/ Einde DEBUG PCT-1181

/ Einde PCT-1181

org.postgresql.util.PSQLException: ERROR: duplicate key value violates unique constraint "shipment_order_org_uk" Detail: Key (shipment_order_id, organization_systemid)=(SH000000177RT, 500) already exists. at 
...
com.mpobjects.oms.dao.entitylog.EntityLogDAOHibernate.save(EntityLogDAOHibernate.java:172) at 
com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.saveLog(RateCalculationVO.java:1600) at 
com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.runFor(RateCalculationVO.java:846) at 
com.mpobjects.oms.ratecalc.model.service.CalculationServiceImpl.recalculate(CalculationServiceImpl.java:585) at 
com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalculate(RateCalcEventListener.java:396) at 
com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalcShipOrderPrice(RateCalcEventListener.java:98) at 
com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.handleEvent(RateCalcEventListener.java:79) at 
com.mpobjects.oms.model.eventhandler.util.ListenerList.fireEvent(ListenerList.java:82) at 
com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:109) at 
com.mpobjects.oms.model.service.ShipmentOrderServiceImpl.triggerEventHandler(ShipmentOrderServiceImpl.java:2637) at 
com.mpobjects.oms.model.service.ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderServiceImpl.java:2084) at 
com.mpobjects.oms.model.service.ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderServiceImpl.java:1985) at 
com.mpobjects.oms.model.service.ShipmentOrderServiceImpl.createReturnShipmentOrder(ShipmentOrderServiceImpl.java:775) at 
com.mpobjects.pnllogistics.model.shipmentorder.service.PnlLogisticsShipmentOrderServiceImpl.createReturnShipmentOrder(PnlLogisticsShipmentOrderServiceImpl.java:20) at 
com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderCreateReturnAction.act(ShipmentOrderCreateReturnAction.java:56) at 


/ Einde DEBUG PCT-1181

/ DEBUG PCT-1181

/ 13	. 

$ vi conf/log4j.xml

  <category name="org.postgresql.util.PSQLException" additivity="false">
      <priority value="DEBUG" />
   </category>

/ logs PSQLException

/ NIETS	,   we zien deze err gewoonniet	,

/ en	, 

/ In eclipse, set b op PSQLException	, 
/ click op icon J! onder breakpoints	,
/ In nieuw window , kies PSQLException	, 

/ ook NIETS	,

/ 13	. 

/s
	RateCalculationVO.runFor(List<RateAgreementVO>) line: 849	
							saveLog();
						}
					} catch (Exception e) {
-> 						String myMessage = "In runFor(" + aRateAgreementVO + "), save ratecalc failed:" + e;
						LOG.error(myMessage, e);

/ set b in ->	,


$ vi log/server.log

2016-03-29 16:13:33,185 INFO  [CRONTAB] (cronFactory:) Finished cron sheduler [195] in 13 ms
2016-03-29 16:13:37,324 ERROR [com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener] (http-0.0.0.0-8080-4:) fatal error
java.lang.RuntimeException: In runFor([theSystemId: 26773867Name :RA-BUSINESSRULES SHO^M
Description :Business rules PostNL^M
Organization :SystemId:500  Id:PNL-CARGO    Description:PostNL Cargo^M
Unit :theSystemId: 1000072  Symbol :EUR Description :Euro   UnitType :CURRENCY  IsDeleted :0    ^M
IsDeleted :false^M
Type :SHIPMENT_ORDER^M
]), save ratecalc failed:org.springframework.dao.DataIntegrityViolationException: Could not execute JDBC batch update; SQL [update SHIPMENT_ORDER set IS_TEMPLATE=?, SHIPMENT_ORDER_ID=?, ORDER_PROCESS_SYSTEMID=?, ACT_SERVICE_LEVEL_SYSTEMID=?, REQ_SERVICE_LEVEL_SYSTEMID=?, STATUS_CODE_SYSTEMID=?, ORGANIZATION_SYSTEMID=?, INCO_TERM_SYSTEMID=?, PATH_SYSTEMID=?, FROM_LOCATION_ID=?, FROM_NAME=?, FROM_NAME2=?, FROM_ADDRESS=?, FROM_ADDRESS2=?, FROM_CITY=?, FROM_POSTAL_CODE=?, FROM_REGION_STATE=?, FROM_COUNTRY_SYSTEMID=?, FROM_CONTACT_NAME=?, FROM_EMAIL_ADDRESS=?, FROM_FAX_NUMBER=?, FROM_PHONE_NUMBER=?, FROM_LONGITUDE=?, FROM_LATITUDE=?, FROM_REFERENCE1=?, FROM_REFERENCE2=?, FROM_REFERENCE3=?, FROM_REFERENCE4=?, FROM_REFERENCE5=?, FROM_REFERENCE6=?, FROM_TIME_ZONE=?, SYNC_FROM_FLAG=?, TO_LOCATION_ID=?, TO_NAME=?, TO_NAME2=?, TO_ADDRESS=?, TO_ADDRESS2=?, TO_CITY=?, TO_POSTAL_CODE=?, TO_REGION_STATE=?, TO_COUNTRY_SYSTEMID=?, TO_CONTACT_NAME=?, TO_EMAIL_ADDRESS=?, TO_FAX_NUMBER=?, TO_PHONE_NUMBER=?, TO_LONGITUDE=?, TO_LATITUDE=?, TO_REFERENCE1=?, TO_REFERENCE2=?, TO_REFERENCE3=?, TO_REFERENCE4=?, TO_REFERENCE5=?, TO_REFERENCE6=?, TO_TIME_ZONE=?, SYNC_TO_FLAG=?, LAST_IMPORT=?, LAST_EXPORT=?, HOLD_STATUS_SYSTEMID=?, INVOICE_PARTY_ID=?, INVOICE_NAME=?, INVOICE_NAME2=?, INVOICE_ADDRESS=?, INVOICE_ADDRESS2=?, INVOICE_CITY=?, INVOICE_POSTAL_CODE=?, INVOICE_REGION_STATE=?, INVOICE_COUNTRY_SYSTEMID=?, INVOICE_CONTACT_NAME=?, INVOICE_EMAIL_ADDRESS=?, INVOICE_FAX_NUMBER=?, INVOICE_PHONE_NUMBER=?, BILLTO_REFERENCE1=?, BILLTO_REFERENCE2=?, BILLTO_REFERENCE3=?, BILLTO_REFERENCE4=?, BILLTO_REFERENCE5=?, BILLTO_REFERENCE6=?, SYNC_BILL_TO_FLAG=?, EMPLOYEE_PARTY_ID=?, EMPLOYEE_NAME=?, EMPLOYEE_NAME2=?, EMPLOYEE_ADDRESS=?, EMPLOYEE_ADDRESS2=?, EMPLOYEE_CITY=?, EMPLOYEE_POSTAL_CODE=?, EMPLOYEE_REGION_STATE=?, EMPLOYEE_COUNTRY_SYSTEMID=?, EMPLOYEE_CONTACT_NAME=?, EMPLOYEE_EMAIL_ADDRESS=?, EMPLOYEE_FAX_NUMBER=?, EMPLOYEE_PHONE_NUMBER=?, EMPLOYEE_REFERENCE1=?, EMPLOYEE_REFERENCE2=?, EMPLOYEE_REFERENCE3=?, EMPLOYEE_REFERENCE4=?, EMPLOYEE_REFERENCE5=?, EMPLOYEE_REFERENCE6=?, SYNC_EMPLOYEE_RESPONSIBLE_FLAG=?, ACTUAL_ARRIVAL=?, ACTUAL_DEPARTURE=?, CLOSE_DATE=?, ORG_PLANNED_ARRIVAL_AFTER=?, ORG_PLANNED_ARRIVAL_BEFORE=?, ORG_PLANNED_DEPARTURE_AFTER=?, ORG_PLANNED_DEPARTURE_BEFORE=?, PLANNED_ARRIVAL_AFTER=?, PLANNED_ARRIVAL_BEFORE=?, PLANNED_DEPARTURE_AFTER=?, PLANNED_DEPARTURE_BEFORE=?, REQUESTED_ARRIVAL_AFTER=?, REQUESTED_ARRIVAL_BEFORE=?, REQUESTED_DEPARTURE_AFTER=?, REQUESTED_DEPARTURE_BEFORE=?, CREATED_BY_SYSTEMID=?, ASSIGNEE_SYSTEMID=?, APPROVEDBY_SYSTEMID=?, PRECALCULATION_APPROVED_DATE=?, LOCK_PRECALCULATION=?, APPROVE_PRECALCULATION=?, POSTCALC_APPROVEDBY_SYSTEMID=?, POSTCALCULATION_APPROVED_DATE=?, LOCK_POSTCALCULATION=?, APPROVE_POSTCALCULATION=?, SYSTEM_ENTRY_DATE=?, LAST_UPDATE=?, ORIGINAL_SYSTEM_ENTRY_DATE=?, CUSTOMER_STATUS_SYSTEMID=?, SHIPMENT_ITEM_LINE_COUNT=?, TOTAL_NR_OF_ITEMS=?, TOTAL_WEIGHT_KG=?, TOTAL_VOLUME_M3=?, TOTAL_LDM=?, TOT_VALUE=?, TOT_VALUE_CURRENCY_SYSTEMID=?, TOT_VALUE_ALT=?, TOT_VAL_ALT_CURR_SYSTEMID=?, SALES_ORGANIZATION=?, CUSTOMER_ORDER_NUMBER=?, REASON_CODE_SYSTEMID=?, REFERENCE1=?, REFERENCE2=?, REFERENCE3=?, REFERENCE4=?, REFERENCE5=?, REFERENCE6=?, REFERENCE7=?, REFERENCE8=?, REFERENCE9=?, REFERENCE10=?, PREFERED_PARTY_SYSTEMID=?, REMARKS=?, REMARKS2=?, SHIPM_TYPE_SYSTEMID=?, PRICE_CURRENCY_SYSTEMID=?, PRICE=?, BACKUP_SHEET_REPORT_NAME=?, CASH_ON_DEL=?, CASH_ON_DEL_CURRENCY_SYSTEMID=?, CHARGE_TIME_WINDOW_YN=?, RATECALC_MD5_HASH=?, DANGEROUS_GOODS_YN=?, INCO_TERM_REFERENCE=?, CASH_ON_DEL_DONE=?, HOLD_STATUS_DESCRIPTION=?, OVERRIDE_ADDRESS_VALIDATION=?, NOT_UPDATABLE_BY_INTERFACE=?, BILL_OF_LADING_NUMBER=?, RETURN_CREATED=?, PAY_WEIGHT=?, IS_TEMPORARY=?, CO2_EMISSION=?, CONSOLIDATION_KEY=?, PORT_SYSTEMID=?, TEMPLATE_SYSTEMID=?, IS_DELETED=?, NOTIFY_TO=?, RATE_CALC_LOG_SYSTEMID=?, CUSTOMER_CONTRACT_SYSTEMID=?, TOT_PRICE_METHOD=?, TOT_COST=?, TOT_COST_CURRENCY_SYSTEMID=?, TOT_COST_METHOD=?, GCD_CARRIER_CODE=?, GCD_ACCOUNT_NUMBER=?, GCD_COMPANY_CODE=?, GCD_SERVICE_LEVEL=?, GCD_SERVICE_LEVEL_CODE=?, GCD_SERVICE_LEVEL_DESCRIPTION=?, GCD_TRACKING_REFERENCE1=?, GCD_TRACKING_REFERENCE2=?, GCD_TRACKING_REFERENCE3=?, GCD_FROM_ROUTING_CODE1=?, GCD_FROM_ROUTING_CODE2=?, GCD_FROM_ROUTING_CODE3=?, GCD_TO_ROUTING_CODE1=?, GCD_TO_ROUTING_CODE2=?, GCD_TO_ROUTING_CODE3=?, INSTRUCTION_GROUP_SYSTEMID=?, IS_RECURRING=?, SCHEDULE_XML=?, SCHEDULE_DESCRIPTION=?, LAST_INSTANCE_DATE=?, AUTHORIZATION_CODES=?, SCREEN_ID=?, APPROVAL_STATUS=?, ACTION_APPROVAL_STATUS=?, LOCKED_BY_PROCESS=?, APPROVAL_TEMPLATE=?, ENTITY_GROUP_SYSTEMID=? where SYSTEM_ID=?]; constraint [null]; nested exception is org.hibernate.exception.ConstraintViolationException: Could not execute JDBC batch update
    at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.runFor(RateCalculationVO.java:851)

/ we zien geen values	,
/ we gaan naar beneden, we zien steeds
Caused by:
/ Ga naar de laatste	,
Caused by: java.sql.BatchUpdateException: Batch entry 0 update SHIPMENT_ORDER set IS_TEMPLATE='0', SHIPMENT_ORDER_ID='SH000000209RT', ORDER_PROCESS_SYSTEMID=26681816, ACT_SERVICE_LEVEL_SYSTEMID=26766280, REQ_SERVICE_LEVEL_SYSTEMID=26681932, STATUS_CODE_SYSTEMID=6, ORGANIZATION_SYSTEMID=500, INCO_TERM_SYSTEMID=1006746, PATH_SYSTEMID=26781424, FROM_LOCATION_ID='', FROM_NAME='Sysmex Nederland B.V.', FROM_NAME2='', FROM_ADDRESS='ECUSTR', FROM_ADDRESS2='11', FROM_CITY='ETTEN LEUR', FROM_POSTAL_CODE='4879NP', FROM_REGION_STATE='', FROM_COUNTRY_SYSTEMID=4153, FROM_CONTACT_NAME='', FROM_EMAIL_ADDRESS='', FROM_FAX_NUMBER='', FROM_PHONE_NUMBER='', FROM_LONGITUDE=NULL, FROM_LATITUDE=NULL, FROM_REFERENCE1='', FROM_REFERENCE2='', FROM_REFERENCE3='', FROM_REFERENCE4='', FROM_REFERENCE5='', FROM_REFERENCE6='', FROM_TIME_ZONE=NULL, SYNC_FROM_FLAG='D', TO_LOCATION_ID='', TO_NAME='DiaSys Diagnostic Systems', TO_NAME2='', TO_ADDRESS='Alte Str. 9', TO_ADDRESS2='7', TO_CITY='Holzheim', TO_POSTAL_CODE='65558', TO_REGION_STATE='', TO_COUNTRY_SYSTEMID=4052, TO_CONTACT_NAME='', TO_EMAIL_ADDRESS='', TO_FAX_NUMBER='', TO_PHONE_NUMBER='', TO_LONGITUDE=NULL, TO_LATITUDE=NULL, TO_REFERENCE1='', TO_REFERENCE2='', TO_REFERENCE3='', TO_REFERENCE4='', TO_REFERENCE5='', TO_REFERENCE6='', TO_TIME_ZONE=NULL, SYNC_TO_FLAG='D', LAST_IMPORT=NULL, LAST_EXPORT=NULL, HOLD_STATUS_SYSTEMID=26734131, INVOICE_PARTY_ID='10290301', INVOICE_NAME='', INVOICE_NAME2='', INVOICE_ADDRESS='', INVOICE_ADDRESS2='', INVOICE_CITY='', INVOICE_POSTAL_CODE='', INVOICE_REGION_STATE='', INVOICE_COUNTRY_SYSTEMID=NULL, INVOICE_CONTACT_NAME='', INVOICE_EMAIL_ADDRESS='', INVOICE_FAX_NUMBER='', INVOICE_PHONE_NUMBER='', BILLTO_REFERENCE1='', BILLTO_REFERENCE2='', BILLTO_REFERENCE3='', BILLTO_REFERENCE4='', BILLTO_REFERENCE5='', BILLTO_REFERENCE6='', SYNC_BILL_TO_FLAG='D', EMPLOYEE_PARTY_ID='', EMPLOYEE_NAME='', EMPLOYEE_NAME2='', EMPLOYEE_ADDRESS='', EMPLOYEE_ADDRESS2='', EMPLOYEE_CITY='', EMPLOYEE_POSTAL_CODE='', EMPLOYEE_REGION_STATE='', EMPLOYEE_COUNTRY_SYSTEMID=NULL, EMPLOYEE_CONTACT_NAME='', EMPLOYEE_EMAIL_ADDRESS='', EMPLOYEE_FAX_NUMBER='', EMPLOYEE_PHONE_NUMBER='', EMPLOYEE_REFERENCE1='', EMPLOYEE_REFERENCE2='', EMPLOYEE_REFERENCE3='', EMPLOYEE_REFERENCE4='', EMPLOYEE_REFERENCE5='', EMPLOYEE_REFERENCE6='', SYNC_EMPLOYEE_RESPONSIBLE_FLAG='D', ACTUAL_ARRIVAL=NULL, ACTUAL_DEPARTURE=NULL, CLOSE_DATE=NULL, ORG_PLANNED_ARRIVAL_AFTER=NULL, ORG_PLANNED_ARRIVAL_BEFORE=NULL, ORG_PLANNED_DEPARTURE_AFTER=NULL, ORG_PLANNED_DEPARTURE_BEFORE=NULL, PLANNED_ARRIVAL_AFTER=NULL, PLANNED_ARRIVAL_BEFORE=NULL, PLANNED_DEPARTURE_AFTER=NULL, PLANNED_DEPARTURE_BEFORE=NULL, REQUESTED_ARRIVAL_AFTER=NULL, REQUESTED_ARRIVAL_BEFORE=NULL, REQUESTED_DEPARTURE_AFTER='2015-04-21 00:00:00.000000 +02:00:00', REQUESTED_DEPARTURE_BEFORE='2015-04-24 23:59:00.000000 +02:00:00', CREATED_BY_SYSTEMID=26682479, ASSIGNEE_SYSTEMID=NULL, APPROVEDBY_SYSTEMID=NULL, PRECALCULATION_APPROVED_DATE=NULL, LOCK_PRECALCULATION='0', APPROVE_PRECALCULATION='0', POSTCALC_APPROVEDBY_SYSTEMID=NULL, POSTCALCULATION_APPROVED_DATE=NULL, LOCK_POSTCALCULATION='0', APPROVE_POSTCALCULATION='0', SYSTEM_ENTRY_DATE='2016-03-29 16:05:45.442000 +02:00:00', LAST_UPDATE='2016-03-29 16:06:06.520000 +02:00:00', ORIGINAL_SYSTEM_ENTRY_DATE='2016-03-29 15:52:28.640000 +02:00:00', CUSTOMER_STATUS_SYSTEMID=104, SHIPMENT_ITEM_LINE_COUNT='3.00', TOTAL_NR_OF_ITEMS='9.00', TOTAL_WEIGHT_KG='15.00', TOTAL_VOLUME_M3='0.000', TOTAL_LDM='0.00', TOT_VALUE='0.00', TOT_VALUE_CURRENCY_SYSTEMID=NULL, TOT_VALUE_ALT='0.00', TOT_VAL_ALT_CURR_SYSTEMID=NULL, SALES_ORGANIZATION='', CUSTOMER_ORDER_NUMBER='', REASON_CODE_SYSTEMID=NULL, REFERENCE1='3633', REFERENCE2='469241414050599343104879', REFERENCE3='7490091987940', REFERENCE4='', REFERENCE5='141405', REFERENCE6='', REFERENCE7='3SEUR02178585', REFERENCE8='', REFERENCE9='EUR000048529004', REFERENCE10='', PREFERED_PARTY_SYSTEMID=NULL, REMARKS='', REMARKS2='', SHIPM_TYPE_SYSTEMID=26681890, PRICE_CURRENCY_SYSTEMID=NULL, PRICE=NULL, BACKUP_SHEET_REPORT_NAME='', CASH_ON_DEL='0.00000', CASH_ON_DEL_CURRENCY_SYSTEMID=NULL, CHARGE_TIME_WINDOW_YN='0', RATECALC_MD5_HASH='37C011BA4787A3682C15D0554D827127EE6C2354', DANGEROUS_GOODS_YN='1', INCO_TERM_REFERENCE='', CASH_ON_DEL_DONE='0', HOLD_STATUS_DESCRIPTION='', OVERRIDE_ADDRESS_VALIDATION='0', NOT_UPDATABLE_BY_INTERFACE='0', BILL_OF_LADING_NUMBER=NULL, RETURN_CREATED='1', PAY_WEIGHT=NULL, IS_TEMPORARY='0', CO2_EMISSION='0.00000', CONSOLIDATION_KEY=NULL, PORT_SYSTEMID=NULL, TEMPLATE_SYSTEMID=NULL, IS_DELETED='0', NOTIFY_TO='', RATE_CALC_LOG_SYSTEMID=NULL, CUSTOMER_CONTRACT_SYSTEMID=NULL, TOT_PRICE_METHOD='NONE', TOT_COST=NULL, TOT_COST_CURRENCY_SYSTEMID=NULL, TOT_COST_METHOD='NONE', GCD_CARRIER_CODE=NULL, GCD_ACCOUNT_NUMBER=NULL, GCD_COMPANY_CODE=NULL, GCD_SERVICE_LEVEL=NULL, GCD_SERVICE_LEVEL_CODE=NULL, GCD_SERVICE_LEVEL_DESCRIPTION=NULL, GCD_TRACKING_REFERENCE1=NULL, GCD_TRACKING_REFERENCE2=NULL, GCD_TRACKING_REFERENCE3=NULL, GCD_FROM_ROUTING_CODE1=NULL, GCD_FROM_ROUTING_CODE2=NULL, GCD_FROM_ROUTING_CODE3=NULL, GCD_TO_ROUTING_CODE1=NULL, GCD_TO_ROUTING_CODE2=NULL, GCD_TO_ROUTING_CODE3=NULL, INSTRUCTION_GROUP_SYSTEMID=NULL, IS_RECURRING='0', SCHEDULE_XML=NULL, SCHEDULE_DESCRIPTION=NULL, LAST_INSTANCE_DATE=NULL, AUTHORIZATION_CODES=NULL, SCREEN_ID=NULL, APPROVAL_STATUS='OPEN', ACTION_APPROVAL_STATUS='OPEN', LOCKED_BY_PROCESS='0', APPROVAL_TEMPLATE=NULL, ENTITY_GROUP_SYSTEMID=NULL where SYSTEM_ID=26975498 was aborted.  Call getNextException to see the cause.
...
2016-03-29 16:13:37,342 WARN  [com.mpobjects.control.action.AbstractAction] (http-0.0.0.0-8080-4:) method act(..): error capture and analysis: class java.l
  94928 ang.RuntimeException java.lang.RuntimeException: In updateShipmentOrder(ShipmentOrder: SH000000209RT(SystemId:26975498; Org:PNL-CARGO), id/value: 173113496
  94928 4/48]):fatal error

/we zien  hierboven dus	,
update SHIPMENT_ORDER set IS_TEMPLATE='0', SHIPMENT_ORDER_ID='SH000000209RT', ORDER_PROCESS_SYSTEMID=26681816, ACT_SERVICE_LEVEL_SYSTEMID=26766280, REQ_SERVICE_LEVEL_SYSTEMID=26681932, STATUS_CODE_SYSTEMID=6, ORGANIZATION_SYSTEMID=500, ...
where SYSTEM_ID=26975498

/ Maar in de db zien we dat deze sho er niet is	, 
/ De insert into SHIPMENT_ORDER van SYSTEM_ID=26975498 is nog niet gedaan	, in psql zien we hem niet	, 
/ Maar als we een shi delete, wordt er een nieuwe sho create	, 

/ we zoeken in de log 	,
/ We zien dat nog een SH000000209copy wordt create , en later update met deze system_id	,

/ 7	. 

/s
/ stack trace	,

	ShipmentOrderVO_$$_javassist_143(ShipmentOrderVO).<init>() line: 321	
	ShipmentOrderDaoImpl(GenericHibernateDAO).getBySystemId(int) line: 305	
				return type.cast(getHibernateTemplate().load(type, aSystemId));

	PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).getShipmentOrder(int) line: 1041	
		return shipmentOrderDao.getBySystemId(aSystemId);

	ShipmentOrderSaveAction(ShipmentOrderSaveAction).handleSave() line: 98	
			} else {
				ShipmentOrderService shipmentOrderService = ShipmentOrderUtil.getShipmentOrderFacadeLocal();
->				ShipmentOrderVO myOldVO = shipmentOrderService.getShipmentOrder(shipmentOrderVO.getSystemId());
				shipmentOrderVO.setSchedule(null);
				shipmentOrderVO.setScheduleXml(myOldVO.getScheduleXml());
				shipmentOrderVO.setScheduleDescription(myOldVO.getScheduleDescription());
				shipmentOrderVO = shipmentOrderService.updateShipmentOrder(shipmentOrderVO, true, true);

	ShipmentOrderSaveAction.handleSave() line: 19	
		super.handleSave();

	ShipmentOrderSaveAction(AbstractSaveAction).act() line: 69	
	ShipmentOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	

/ Bij -> 
shipmentOrderVO= ShipmentOrder: SH000000214RT(SystemId:26975499; Org:PNL-CARGO)
/ Klopt	, dit is de return sho	, en is created toen we 'Create return' click	, is ook in db	,

myOldVO	ShipmentOrderVO_$$_javassist_143  (id=30009)	
ShipmentOrder: SH000000214RT(SystemId:26975499; Org:PNL-CARGO)
/ is copy	?
/ TODO

				shipmentOrderVO = shipmentOrderService.updateShipmentOrder(shipmentOrderVO, true, true);

/ Intermezzo

/ recalculate methods	,

LogisticsOrderVO [line: 749] - recalculate()	
CalculationServiceImpl [line: 507] - recalculate(LogisticsOrderVO, AgreementType, TMSEventContext)	
RateCalcEventListener [line: 363] - recalculate(ShipmentOrderVO, AgreementType, TMSEventContext)	


/ Einde Intermezzo

/ Intermezzo

/ 7	. 

/ we zien WH dat de ShipmentOrderVO.<init> ook steeds called in andere threads door messages	,

Thread [internaljms.com.mpobjects.oms.service.shipmentorder.RecurringShipmentOrderHandler-1] (Suspended (entry into method <init> in ShipmentOrderVO))	

	ShipmentOrderVO_$$_javassist_143(ShipmentOrderVO).<init>() line: 321	
	ShipmentOrderVO_$$_javassist_143.<init>() line: not available	
	NativeConstructorAccessorImpl.newInstance0(Constructor, Object[]) line: not available [native method]	
	NativeConstructorAccessorImpl.newInstance(Object[]) line: 57	
	DelegatingConstructorAccessorImpl.newInstance(Object[]) line: 45	
	Constructor.newInstance(Object...) line: 526	
	Class.newInstance() line: 379	
	JavassistLazyInitializer.getProxy(Class, String, Class, Class[], Method, Method, CompositeType, Serializable, SessionImplementor) line: 139	
	JavassistProxyFactory.getProxy(Serializable, SessionImplementor) line: 71	
	PojoEntityTuplizer(AbstractEntityTuplizer).createProxy(Serializable, SessionImplementor) line: 631	
	SingleTableEntityPersister(AbstractEntityPersister).createProxy(Serializable, SessionImplementor) line: 3737	
	DefaultLoadEventListener.createProxyIfNecessary(LoadEvent, EntityPersister, EntityKey, LoadEventListener$LoadType, PersistenceContext) line: 360	
	DefaultLoadEventListener.proxyOrLoad(LoadEvent, EntityPersister, EntityKey, LoadEventListener$LoadType) line: 281	
	DefaultLoadEventListener.onLoad(LoadEvent, LoadEventListener$LoadType) line: 152	
	SessionImpl.fireLoad(LoadEvent, LoadEventListener$LoadType) line: 1090	
	SessionImpl.load(String, Serializable) line: 985	
	SessionImpl.load(Class, Serializable) line: 978	
	HibernateTemplate$3.doInHibernate(Session) line: 559	
	HibernateTemplate.doExecute(HibernateCallback<T>, boolean, boolean) line: 407	
	HibernateTemplate.executeWithNativeSession(HibernateCallback<T>) line: 375	
	HibernateTemplate.load(Class<T>, Serializable, LockMode) line: 552	
	HibernateTemplate.load(Class<T>, Serializable) line: 546	

	ShipmentOrderDaoImpl(GenericHibernateDAO).getBySystemId(int) line: 305	

	GeneratedMethodAccessor697.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	MethodInvocationProceedingJoinPoint.proceed() line: 80	
	PerformanceMeasurementAspect.measurePerformance(ProceedingJoinPoint) line: 56	
	GeneratedMethodAccessor91.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AspectJAroundAdvice(AbstractAspectJAdvice).invokeAdviceMethodWithGivenArgs(Object[]) line: 621	
	AspectJAroundAdvice(AbstractAspectJAdvice).invokeAdviceMethod(JoinPoint, JoinPointMatch, Object, Throwable) line: 610	
	AspectJAroundAdvice.invoke(MethodInvocation) line: 65	
	ReflectiveMethodInvocation.proceed() line: 172	
	MethodBeforeAdviceInterceptor.invoke(MethodInvocation) line: 51	
	ReflectiveMethodInvocation.proceed() line: 161	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	ExposeInvocationInterceptor.invoke(MethodInvocation) line: 91	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy213.getBySystemId(int) line: not available	

	RecurringShipmentOrderServiceImpl.handleRecurringShipmentOrders(Integer, boolean) line: 273	
	RecurringShipmentOrderHandlerImpl.processMessageAsRoot(Message) line: 28	
	RecurringShipmentOrderHandlerImpl(AbstractConsumer).onMessage(Message) line: 49				<-


/ Als de message een object message is , is het WH een interne queue	,

/ bij <-	,

this	RecurringServiceOrderHandlerImpl  (id=21307)	
aMessage	ActiveMQObjectMessage  (id=21344)	
...
	object	RecurringServiceOrderRequest  (id=21453)	

/c
/s
Thread [internaljms.com.mpobjects.oms.service.serviceorder.RecurringServiceOrderHandler-2] (Suspended (breakpoint at line 507 in CalculationServiceImpl))	
	CalculationServiceImpl.recalculate(LogisticsOrderVO, AgreementType, TMSEventContext) line: 507	

	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy247.recalculate(LogisticsOrderVO, AgreementType, TMSEventContext) line: not available	

	RateCalcEventListener.recalculate(ServiceOrderVO, AgreementType, TMSEventContext) line: 332	
	RateCalcEventListener.recalcServiceOrderCost(Event) line: 234	
	RateCalcEventListener.handleEvent(Event) line: 72	
	ListenerList.fireEvent(Event<?>) line: 82	
	EventHandlerServiceImpl.handleEvent(Event) line: 109	
	ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderVO, ServiceOrderVO, boolean, TMSEventContext) line: 1905	
	ServiceOrderServiceImpl.createServiceOrder(ServiceOrderVO) line: 526	

	GeneratedMethodAccessor1109.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy262.createServiceOrder(ServiceOrderVO) line: not available	

	RecurringServiceOrderServiceImpl.createInstance(ServiceOrderVO, Date, String) line: 192	
	RecurringServiceOrderServiceImpl.createOrders(ServiceOrderVO, Date, String) line: 229	
	RecurringServiceOrderServiceImpl.handleRecurringServiceOrders(Integer) line: 92	

	GeneratedMethodAccessor699.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy323.handleRecurringServiceOrders(Integer) line: not available	

	RecurringServiceOrderHandlerImpl.processMessageAsRoot(Message) line: 28	
	RecurringServiceOrderHandlerImpl(AbstractConsumer).onMessage(Message) line: 49	
...



/ rm b	, tot later	,
ShipmentOrderVO [entry] - ShipmentOrderVO()	
	CalculationServiceImpl.recalculate(LogisticsOrderVO, AgreementType, TMSEventContext) line: 507	

/ 7	. 

/ TASK RECURRING SERVICE ORDER

/ configuration, administration, scheduled tasks
/ zoek in Task class naar recurring
/ we zien	,
com.mpobjects.oms.service.RecurringServiceOrderGeneratorTask
enabled: unchecked
com.mpobjects.oms.service.RecurringShipmentOrderGeneratorTask
enabled: unchecked

/ we moeten de data/ dir rm	, want daar zitten de interne queues in 	,
/ we moeten dan eerst wel de appl stop,	

[eric@localhost pnllogistics]$  pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnllogistics
[eric@localhost pnllogistics]$ ls data/
activemq  hypersonic  xmbean-attrs
[eric@localhost pnllogistics]$ ls data/activemq/
kahadb
[eric@localhost pnllogistics]$ ls data/activemq/kahadb/
db-6.log  db.data  db.redo  lock

/ de enigste dirs die je NIET mag rm	,
deploy/
lib/
conf/
/ lib/ wordt create als je clean-dev-deploy runs	,

/ je mag rm	,
data/
tmp/
local/

/ we rm data/, en start appl op	, er is weer een data/	, 

 

/ Einde Intermezzo

/ 7	. 

/ SH000000214RT, 
/ system_id=26975499
/ rm shi	,

/s
ShipmentOrderSaveAction(ShipmentOrderSaveAction).handleSave() line: 80	
			ShipmentOrderVO shipmentOrderVO = (ShipmentOrderVO) getValueObject();
/ Geen call op ShipmentOrderVO.<init>
/ TODO
/ = WH db + modified met values op scherm	,

shipmentOrderVO	ShipmentOrderVO_$$_javassist_143  (id=19247)	
		target	ShipmentOrderVO  (id=19456)	


			int mySystemid = shipmentOrderVO.getSystemId();
26975499
			} else {
				ShipmentOrderService shipmentOrderService = ShipmentOrderUtil.getShipmentOrderFacadeLocal();
				ShipmentOrderVO myOldVO = shipmentOrderService.getShipmentOrder(shipmentOrderVO.getSystemId());
/s
public class GenericHibernateDAO<Type extends EntityInterface> extends BaseHibernateDAO<Type> implements HibernateDAOInterface<Type> {
				return type.cast(getHibernateTemplate().load(type, aSystemId));
/s
/ stack trace	,
	ShipmentOrderVO_$$_javassist_143(ShipmentOrderVO).<init>() line: 321	

	ShipmentOrderVO_$$_javassist_143.<init>() line: not available [local variables unavailable]	
	NativeConstructorAccessorImpl.newInstance0(Constructor, Object[]) line: not available [native method]	
	NativeConstructorAccessorImpl.newInstance(Object[]) line: 57	
	DelegatingConstructorAccessorImpl.newInstance(Object[]) line: 45	
	Constructor.newInstance(Object...) line: 526	
	Class.newInstance() line: 379	
	JavassistLazyInitializer.getProxy(Class, String, Class, Class[], Method, Method, CompositeType, Serializable, SessionImplementor) line: 139	
	JavassistProxyFactory.getProxy(Serializable, SessionImplementor) line: 71	
	PojoEntityTuplizer(AbstractEntityTuplizer).createProxy(Serializable, SessionImplementor) line: 631	
	SingleTableEntityPersister(AbstractEntityPersister).createProxy(Serializable, SessionImplementor) line: 3737	
	DefaultLoadEventListener.createProxyIfNecessary(LoadEvent, EntityPersister, EntityKey, LoadEventListener$LoadType, PersistenceContext) line: 360	
	DefaultLoadEventListener.proxyOrLoad(LoadEvent, EntityPersister, EntityKey, LoadEventListener$LoadType) line: 281	
	DefaultLoadEventListener.onLoad(LoadEvent, LoadEventListener$LoadType) line: 152	
	SessionImpl.fireLoad(LoadEvent, LoadEventListener$LoadType) line: 1090	
	SessionImpl.load(String, Serializable) line: 985	
	SessionImpl.load(Class, Serializable) line: 978	
	HibernateTemplate$3.doInHibernate(Session) line: 559	
	HibernateTemplate.doExecute(HibernateCallback<T>, boolean, boolean) line: 407	
	HibernateTemplate.executeWithNativeSession(HibernateCallback<T>) line: 375	
	HibernateTemplate.load(Class<T>, Serializable, LockMode) line: 552	
	HibernateTemplate.load(Class<T>, Serializable) line: 546	

	ShipmentOrderDaoImpl(GenericHibernateDAO).getBySystemId(int) line: 305	
				return type.cast(getHibernateTemplate().load(type, aSystemId));

	GeneratedMethodAccessor891.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	MethodInvocationProceedingJoinPoint.proceed() line: 80	
	PerformanceMeasurementAspect.measurePerformance(ProceedingJoinPoint) line: 56	
	GeneratedMethodAccessor86.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AspectJAroundAdvice(AbstractAspectJAdvice).invokeAdviceMethodWithGivenArgs(Object[]) line: 621	
	AspectJAroundAdvice(AbstractAspectJAdvice).invokeAdviceMethod(JoinPoint, JoinPointMatch, Object, Throwable) line: 610	
	AspectJAroundAdvice.invoke(MethodInvocation) line: 65	
	ReflectiveMethodInvocation.proceed() line: 172	
	MethodBeforeAdviceInterceptor.invoke(MethodInvocation) line: 51	
	ReflectiveMethodInvocation.proceed() line: 161	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	ExposeInvocationInterceptor.invoke(MethodInvocation) line: 91	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy213.getBySystemId(int) line: not available	

	PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).getShipmentOrder(int) line: 1041	

	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy248.getShipmentOrder(int) line: not available	

	ShipmentOrderSaveAction(ShipmentOrderSaveAction).handleSave() line: 98	
	ShipmentOrderSaveAction.handleSave() line: 19	
	ShipmentOrderSaveAction(AbstractSaveAction).act() line: 69	
	ShipmentOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	

ShipmentOrderSaveAction(ShipmentOrderSaveAction).handleSave() line: 99	
				ShipmentOrderVO myOldVO = shipmentOrderService.getShipmentOrder(shipmentOrderVO.getSystemId());
/d
shipmentOrderVO	ShipmentOrderVO_$$_javassist_143  (id=19247)	
		target	ShipmentOrderVO  (id=19456)	

myOldVO	ShipmentOrderVO_$$_javassist_143  (id=19156)	
		target	ShipmentOrderVO  (id=19298)	
/ copy van 19456	, heeft dezelfde ystem_id=26975499

				shipmentOrderVO.setSchedule(null);
				shipmentOrderVO.setScheduleXml(myOldVO.getScheduleXml());
				shipmentOrderVO.setScheduleDescription(myOldVO.getScheduleDescription());
				shipmentOrderVO = shipmentOrderService.updateShipmentOrder(shipmentOrderVO, true, true);
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).updateShipmentOrder(ShipmentOrderVO, boolean, boolean) line: 1999	
			} else {
				myOldVO = shipmentOrderDao.getBySystemId(aShipmentOrder.getSystemId());
/ de myOldVO uit de caller	,
myOldVO	ShipmentOrderVO_$$_javassist_143  (id=19156)	
		target	ShipmentOrderVO  (id=19298)	

			return updateShipmentOrder(aShipmentOrder, new TMSEventContext(), propagateChange);
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 2032	

			ShipmentOrderVO myOldVO = getOld(aShipmentOrder);
/ GenericHibernateDAO.getOld calls ShipmentOrderVO.<init>	,
aShipmentOrder=
shipmentOrderVO	ShipmentOrderVO_$$_javassist_143  (id=19247)	
		target	ShipmentOrderVO  (id=19456)	
myOldVO	ShipmentOrderVO  (id=19488)	
/ met dezelfde systemId	=26975499

				myNew = shipmentOrderDao.merge(aShipmentOrder);
shipmentOrderVO	ShipmentOrderVO_$$_javassist_143  (id=19247)	
		target	ShipmentOrderVO  (id=19456)	
/ Klopt WH	, deze is getValueObject()= WH db+ modification on screen	,
/ Geen ShipmentOrderVO.<init> call	,

				myNew = shipmentOrderDao.save(myNew);
/s
public class GenericHibernateDAO<Type extends EntityInterface> extends BaseHibernateDAO<Type> implements HibernateDAOInterface<Type> {
		} else {
			getHibernateTemplate().update(anEntity);

myNew	ShipmentOrderVO  (id=19298)	
/= + screen data	,

				if (propagateChange) {
					MpoBeanFactory.getBean(ServiceActionService.class).handleShipmentOrderChange(myOldVO, myNew);
					MpoBeanFactory.getBean(ConsignmentService.class).handleShipmentOrderChange(myNew, myOldVO);
					triggerEventHandler(myOldVO, myNew, anEventContext);
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).triggerEventHandler(ShipmentOrderVO, ShipmentOrderVO, TMSEventContext) line: 2637	
		} else {
			myEvent = new ShipmentOrderEvent(anOldVO, aNewVO, ShipmentOrderEvent.UPDATED, anEventContext);
		}
		eventHandlerService.handleEvent(myEvent);
/s
EventHandlerServiceImpl.handleEvent(Event) line: 109	
			listenerList.fireEvent(anEvent);
/s
ListenerList.fireEvent(Event<?>) line: 82	
		for (EventListener myListener : theListenerList) {
			myListener.handleEvent(anEvent);
/s
RateCalcEventListener.handleEvent(Event) line: 67	
				recalcServiceOrderCost(anEvent);
				recalcShipOrderPrice(anEvent);
/s
RateCalcEventListener.recalcShipOrderPrice(Event) line: 98	
			} else if (myType.equals(ShipmentOrderEvent.UPDATED)) {
				ShipmentOrderVO myNewShipmentOrderVO = ((ShipmentOrderEvent) anEvent).getNewShipmentOrderVO();
myNewShipmentOrderVO	ShipmentOrderVO  (id=19298)	

				recalculate(myNewShipmentOrderVO, AgreementType.SHIPMENT_ORDER, anEvent.getEventContext());
/s
RateCalcEventListener.recalculate(ShipmentOrderVO, AgreementType, TMSEventContext) line: 368	
		} else {
			LOG.debug("Shipment order [" + anOrder + "] is calculated in line (immediately)");
			getCalculationService().recalculate(anOrder, aRateType, anEventContext);
/s
CalculationServiceImpl.recalculate(LogisticsOrderVO, AgreementType, TMSEventContext) line: 507	

/ Intermezzo

/ .recalculate	,

RateCalcEventListener.recalculate(ShipmentOrderVO, AgreementType, TMSEventContext) line: 368	
/s
CalculationServiceImpl.recalculate(LogisticsOrderVO, AgreementType, TMSEventContext) line: 507	

LogisticsOrderVO [line: 749] - recalculate()	
/ TODO (Wanneer?)

/ Einde Intermezzo

			List<RateAgreementVO> mySelectedRateAgreement = getMatchingRateAgreement(anOrder, aRateType);
/ 1/2 min	,
			} else if (anOrder instanceof ShipmentOrderVO) {
				myRateCalculationVO.setShipmentOrder((ShipmentOrderVO) anOrder);
anOrder	ShipmentOrderVO  (id=19298)	

			} else {
				myRateCalculationVO.setRateAgreementVO(mySelectedRateAgreement);

				} else if (anOrder instanceof ShipmentOrderVO) {
					ShipmentOrderVO myShipmentOrder = (ShipmentOrderVO) anOrder;
					if (!myRateCalculationVO.rateCalculationRequired()) {

				// Now calculate the rates
				myRateCalculationVO.runFor(mySelectedRateAgreement);

/ Intermezzo

/ we rm b's
CalculationServiceImpl
RateCalcEventListener
/ behalve	,
RateCalcEventListener:79
/ called door 
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 2084	
					triggerEventHandler(myOldVO, myNew, anEventContext);

/ BREAKPONTS PCT-1181

/we hebben b's	,
AbstractService [line: 29] - delete(TypeVO)	
CalculationServiceImpl [line: 501] - recalculate(CustomerOrderLine)	
CalculationServiceImpl [line: 507] - recalculate(LogisticsOrderVO, AgreementType, TMSEventContext)	
CalculationServiceImpl [line: 585] - recalculate(LogisticsOrderVO, AgreementType, TMSEventContext)	
EventHandlerServiceImpl [line: 72] [conditional] - handleEvent(Event)	
LogisticsOrderTotalsCalculator [line: 96] - addValues(LogisticsOrderVO)	
LogisticsOrderTotalsCalculator [line: 313] - addAltValueValue(LogisticsOrderVO)	
LogisticsOrderVO [line: 749] - recalculate()	
RateCalcEventListener [line: 67] [conditional] - handleEvent(Event)	
RateCalcEventListener [line: 79] - handleEvent(Event)	
RateCalcEventListener [line: 82] [conditional] - handleEvent(Event)	
RateCalcEventListener [line: 98] - recalcShipOrderPrice(Event)	
RateCalcEventListener [line: 363] - recalculate(ShipmentOrderVO, AgreementType, TMSEventContext)	
RateCalcEventListener [line: 396] - recalculate(ShipmentOrderVO, AgreementType, TMSEventContext)	
RateCalculationVO [line: 846] - runFor(List<RateAgreementVO>)	
RateCalculationVO [line: 849] - runFor(List<RateAgreementVO>)	
RateCalculationVO [line: 1600] - saveLog()	
ShipmentItemDeleteAction [line: 23] - act()	
ShipmentItemServiceImpl [line: 136] - delete(int)	
ShipmentOrderSaveAction [line: 17] - handleSave()	
ShipmentOrderSaveAction [line: 19] - handleSave()	
ShipmentOrderSaveAction [line: 77] - handleSave()	
ShipmentOrderSaveAction [line: 99] - handleSave()	
ShipmentOrderServiceImpl [line: 775] - createReturnShipmentOrder(ShipmentOrderVO)	
ShipmentOrderServiceImpl [line: 1985] - updateShipmentOrder(ShipmentOrderVO, boolean)	
ShipmentOrderServiceImpl [line: 1994] - updateShipmentOrder(ShipmentOrderVO, boolean, boolean)	
ShipmentOrderServiceImpl [line: 2002] - updateShipmentOrder(ShipmentOrderVO, boolean, boolean)	
ShipmentOrderServiceImpl [line: 2032] - updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean)	
ShipmentOrderServiceImpl [line: 2084] - updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean)	
ShipmentOrderVO [line: 414] - copy()	
ShipmentOrderVO [line: 429] - copyTo(ShipmentOrderVO)	
ShipmentOrderVO [entry] - ShipmentOrderVO()	

/ Einde Intermezzo

/ Intermezzo

/ Deze b's	, geef /c	, dan valt snel in delete shi action	,

PSQLException: caught and uncaught	
AbstractService [line: 29] - delete(TypeVO)	
ShipmentItemDeleteAction [line: 23] - act()	
ShipmentItemServiceImpl [line: 136] - delete(int)	
ShipmentOrderSaveAction [line: 17] - handleSave()	
ShipmentOrderSaveAction [line: 19] - handleSave()	
ShipmentOrderSaveAction [line: 77] - handleSave()	
ShipmentOrderSaveAction [line: 99] - handleSave()	
ShipmentOrderServiceImpl [line: 775] - createReturnShipmentOrder(ShipmentOrderVO)	
ShipmentOrderServiceImpl [line: 1985] - updateShipmentOrder(ShipmentOrderVO, boolean)	
ShipmentOrderServiceImpl [line: 1994] - updateShipmentOrder(ShipmentOrderVO, boolean, boolean)	
ShipmentOrderServiceImpl [line: 2002] - updateShipmentOrder(ShipmentOrderVO, boolean, boolean)	
ShipmentOrderServiceImpl [line: 2032] - updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean)	
ShipmentOrderServiceImpl [line: 2084] - updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean)	
ShipmentOrderVO [line: 414] - copy()	


/ Einde Intermezzo

/c
ShipmentItemDeleteAction.act() line: 23	
		} else {
			getShipmentItemService().delete(getSystemIdFromRequest());
/s
ShipmentItemServiceImpl.delete(int) line: 136	
		ShipmentItemVO myVO = getBySystemId(aSystemId);
		delete(myVO);
/s
			delete(aShipmentItemVO, true);
/s
ShipmentItemServiceImpl.delete(ShipmentItemVO, boolean) line: 147	
/=
	public void delete(ShipmentItemVO aShipmentItemVO, boolean aRecalcualate) {
aRecalculate=true
		ShipmentOrderVO myShipmentOrderVO = resolveShipmentOrder(aShipmentItemVO);
/s
ShipmentItemServiceImpl.resolveShipmentOrder(ShipmentItemVO) line: 1016	
		ShipmentOrderVO mySho = aShipmentItem.getShipmentOrder();
/s

/ Intermezzo

	ShipmentOrderVO_$$_javassist_143(ShipmentOrderVO).<init>() line: 321	

	ShipmentOrderVO_$$_javassist_143.<init>() line: not available	
	NativeConstructorAccessorImpl.newInstance0(Constructor, Object[]) line: not available [native method]	
	NativeConstructorAccessorImpl.newInstance(Object[]) line: 57	
	DelegatingConstructorAccessorImpl.newInstance(Object[]) line: 45	
	Constructor.newInstance(Object...) line: 526	
	Class.newInstance() line: 379	
	JavassistLazyInitializer.getProxy(Class, String, Class, Class[], Method, Method, CompositeType, Serializable, SessionImplementor) line: 139	
	JavassistProxyFactory.getProxy(Serializable, SessionImplementor) line: 71	
	PojoEntityTuplizer(AbstractEntityTuplizer).createProxy(Serializable, SessionImplementor) line: 631	
	SingleTableEntityPersister(AbstractEntityPersister).createProxy(Serializable, SessionImplementor) line: 3737	
	DefaultLoadEventListener.createProxyIfNecessary(LoadEvent, EntityPersister, EntityKey, LoadEventListener$LoadType, PersistenceContext) line: 360	
	DefaultLoadEventListener.proxyOrLoad(LoadEvent, EntityPersister, EntityKey, LoadEventListener$LoadType) line: 281	
	DefaultLoadEventListener.onLoad(LoadEvent, LoadEventListener$LoadType) line: 152	
	SessionImpl.fireLoad(LoadEvent, LoadEventListener$LoadType) line: 1090	
	SessionImpl.internalLoad(String, Serializable, boolean, boolean) line: 1038	
	ManyToOneType(EntityType).resolveIdentifier(Serializable, SessionImplementor) line: 630	
	ManyToOneType.assemble(Serializable, SessionImplementor, Object) line: 236	
	TypeHelper.assemble(Serializable[], Type[], SessionImplementor, Object) line: 114	
	CacheEntry.assemble(Serializable[], Object, Serializable, EntityPersister, Interceptor, EventSource) line: 117	
	CacheEntry.assemble(Object, Serializable, EntityPersister, Interceptor, EventSource) line: 104	
	DefaultLoadEventListener.assembleCacheEntry(CacheEntry, Serializable, EntityPersister, LoadEvent) line: 651	
	DefaultLoadEventListener.loadFromSecondLevelCache(LoadEvent, EntityPersister, LoadEventListener$LoadType) line: 605	
	DefaultLoadEventListener.doLoad(LoadEvent, EntityPersister, EntityKey, LoadEventListener$LoadType) line: 459	
	DefaultLoadEventListener.load(LoadEvent, EntityPersister, EntityKey, LoadEventListener$LoadType) line: 227	
	DefaultLoadEventListener.onLoad(LoadEvent, LoadEventListener$LoadType) line: 147	
	SessionImpl.fireLoad(LoadEvent, LoadEventListener$LoadType) line: 1090	
	SessionImpl.immediateLoad(String, Serializable) line: 1026	
	JavassistLazyInitializer(AbstractLazyInitializer).initialize() line: 176	
	JavassistLazyInitializer(AbstractLazyInitializer).getImplementation() line: 215	
	JavassistLazyInitializer.invoke(Object, Method, Method, Object[]) line: 190	
	ShipmentItemVO_$$_javassist_139.getShipmentOrder() line: not available	

	ShipmentItemServiceImpl.resolveShipmentOrder(ShipmentItemVO) line: 1016	
	ShipmentItemServiceImpl.delete(ShipmentItemVO, boolean) line: 147	
	ShipmentItemServiceImpl.delete(ShipmentItemVO) line: 142	
	ShipmentItemServiceImpl.delete(int) line: 137	

	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	MethodInvocationProceedingJoinPoint.proceed() line: 80	
	PerformanceMeasurementAspect.measurePerformance(ProceedingJoinPoint) line: 56	
	GeneratedMethodAccessor87.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AspectJAroundAdvice(AbstractAspectJAdvice).invokeAdviceMethodWithGivenArgs(Object[]) line: 621	
	AspectJAroundAdvice(AbstractAspectJAdvice).invokeAdviceMethod(JoinPoint, JoinPointMatch, Object, Throwable) line: 610	
	AspectJAroundAdvice.invoke(MethodInvocation) line: 65	
	ReflectiveMethodInvocation.proceed() line: 172	
	ExposeInvocationInterceptor.invoke(MethodInvocation) line: 91	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy251.delete(int) line: not available	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy251.delete(int) line: not available	

	ShipmentItemDeleteAction.act() line: 26	
	ShipmentItemDeleteAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	

/ Einde Intermezzo

ShipmentItemServiceImpl.resolveShipmentOrder(ShipmentItemVO) line: 1017	
		ShipmentOrderVO mySho = aShipmentItem.getShipmentOrder();
/d
/ calls ShipmentOrderVO.<init>
		deleteWithoutRecalc(aShipmentItemVO);
/s
ShipmentItemServiceImpl.deleteWithoutRecalc(ShipmentItemVO) line: 213	

		// Delete packed items since they have no home anymore.
		List<PackedItemVO> myPackedItems = new ArrayList<PackedItemVO>(aShipmentItemVO.getPackedItemList());
		for (PackedItemVO myPackedItem : myPackedItems) {
/ 3 keer	, 
/ TODO
			ProductItemVO myProductItemVO = myPackedItem.getProductItemVO();
			myProductItemVO.getPackedItemList().remove(myPackedItem);
			packedItemDAO.delete(myPackedItem);
		}
		aShipmentItemVO.getPackedItemList().clear();
		getDAO().save(aShipmentItemVO);

		if (myShipmentOrderVO != null) {
			myShipmentOrderVO.removeShipmentItem(aShipmentItemVO);
/s
ShipmentOrderVO.removeShipmentItem(ShipmentItemVO) line: 2038	
		if (theShipmentItemList.remove(aVO)) {
			aVO.updateShipmentOrder(null);
/t
ShipmentItemServiceImpl.deleteWithoutRecalc(ShipmentItemVO) line: 213	
			myShipmentOrderVO.removeShipmentItem(aShipmentItemVO);
/d
		super.delete(aShipmentItemVO);
/s
ShipmentItemServiceImpl(AbstractService).delete(TypeVO) line: 29	
		getDAO().delete(aType.getSystemId());
/t
ShipmentItemServiceImpl.delete(ShipmentItemVO, boolean) line: 149	
		deleteWithoutRecalc(aShipmentItemVO);
/d
		if (aRecalcualate && myShipmentOrderVO != null) {
			recalculateShipmentOrder(myShipmentOrderVO);
/s

/ 7	. 

/ Nieuwe run	,

/ Na delete item gaat hij weer een return sho maken!

PnlLogisticsShipmentOrderServiceImpl.createReturnShipmentOrder(ShipmentOrderVO) line: 20	
/=
	public ShipmentOrderVO createReturnShipmentOrder(ShipmentOrderVO aShipmentOrder) {
aShipmentOrder=(proxy naar)
ShipmentOrder: SH000000218(SystemId:26685099; Org:PNL-CARGO)

		ShipmentOrderVO myShipmentOrder = super.createReturnShipmentOrder(aShipmentOrder);
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).createReturnShipmentOrder(ShipmentOrderVO) line: 726	
		ShipmentOrderVO myShipmentOrderVO = shipmentOrderDuplicator.duplicate(aShipmentOrder);
...
/s
ShipmentOrderVO.copy() line: 414	


Daemon Thread [http-0.0.0.0-8080-1] (Suspended (breakpoint at line 414 in ShipmentOrderVO))	
	ShipmentOrderVO.copy() line: 414	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	JavassistLazyInitializer.invoke(Object, Method, Method, Object[]) line: 197	
	ShipmentOrderVO_$$_javassist_143.copy() line: not available	
	CompleteShipmentOrderDuplicator.duplicate(ShipmentOrderVO, CustomDuplicateAction) line: 44	
	CompleteShipmentOrderDuplicator.duplicate(ShipmentOrderVO) line: 33	
	PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).createReturnShipmentOrder(ShipmentOrderVO) line: 726	
	PnlLogisticsShipmentOrderServiceImpl.createReturnShipmentOrder(ShipmentOrderVO) line: 20	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy248.createReturnShipmentOrder(ShipmentOrderVO) line: not available	
	ShipmentOrderCreateReturnAction.act() line: 56	
	ShipmentOrderCreateReturnAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	

	ActTypeNode.invoke(Environment, InvokeContext) line: 125	
	MatchNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext, String, Map) line: 47	
	MatchNode.invoke(Environment, InvokeContext) line: 108	
	PipelineNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	PipelineNode.invoke(Environment, InvokeContext) line: 143	
	PipelinesNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	PipelinesNode.invoke(Environment, InvokeContext) line: 93	
	ConcreteTreeProcessor.process(Environment, InvokeContext) line: 235	
	ConcreteTreeProcessor.process(Environment) line: 177	
	TreeProcessor.process(Environment) line: 253	
	MountNode.invoke(Environment, InvokeContext) line: 118	
	MatchNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext, String, Map) line: 47	
	MatchNode.invoke(Environment, InvokeContext) line: 108	
	PipelineNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	PipelineNode.invoke(Environment, InvokeContext) line: 143	
	PipelinesNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	PipelinesNode.invoke(Environment, InvokeContext) line: 93	
	ConcreteTreeProcessor.process(Environment, InvokeContext) line: 235	
	ConcreteTreeProcessor.process(Environment) line: 177	
	TreeProcessor.process(Environment) line: 253	
	MountNode.invoke(Environment, InvokeContext) line: 118	
	PipelineNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	PipelineNode.invoke(Environment, InvokeContext) line: 143	
	PipelinesNode(AbstractParentProcessingNode).invokeNodes(ProcessingNode[], Environment, InvokeContext) line: 69	
	PipelinesNode.invoke(Environment, InvokeContext) line: 93	
	ConcreteTreeProcessor.process(Environment, InvokeContext) line: 235	
	ConcreteTreeProcessor.process(Environment) line: 177	
	TreeProcessor.process(Environment) line: 253	
	Cocoon.process(Environment) line: 699	
	CocoonServlet.service(HttpServletRequest, HttpServletResponse) line: 1154	
	CocoonServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	
	ApplicationFilterChain.internalDoFilter(ServletRequest, ServletResponse) line: 252	
	ApplicationFilterChain.doFilter(ServletRequest, ServletResponse) line: 173	
	FirstLoginFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 76	
	ApplicationFilterChain.internalDoFilter(ServletRequest, ServletResponse) line: 202	
	ApplicationFilterChain.doFilter(ServletRequest, ServletResponse) line: 173	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 330	
	FilterSecurityInterceptor.invoke(FilterInvocation) line: 118	
	FilterSecurityInterceptor.doFilter(ServletRequest, ServletResponse, FilterChain) line: 84	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	ExceptionTranslationFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 113	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	SessionManagementFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 103	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	AnonymousAuthenticationFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 113	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	SecurityContextHolderAwareRequestFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 154	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	RequestCacheAwareFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 45	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	UsernamePasswordAuthenticationFilter(AbstractAuthenticationProcessingFilter).doFilter(ServletRequest, ServletResponse, FilterChain) line: 199	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	LogoutFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 110	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	RunAsLogoutFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 41	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	SecurityContextPersistenceFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 87	
	FilterChainProxy$VirtualFilterChain.doFilter(ServletRequest, ServletResponse) line: 342	
	FilterChainProxy.doFilterInternal(ServletRequest, ServletResponse, FilterChain) line: 192	
	FilterChainProxy.doFilter(ServletRequest, ServletResponse, FilterChain) line: 160	
	DelegatingFilterProxy.invokeDelegate(Filter, ServletRequest, ServletResponse, FilterChain) line: 343	
	DelegatingFilterProxy.doFilter(ServletRequest, ServletResponse, FilterChain) line: 260	
	ApplicationFilterChain.internalDoFilter(ServletRequest, ServletResponse) line: 202	
	ApplicationFilterChain.doFilter(ServletRequest, ServletResponse) line: 173	
	SetCharacterEncodingFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 111	
	ApplicationFilterChain.internalDoFilter(ServletRequest, ServletResponse) line: 202	
	ApplicationFilterChain.doFilter(ServletRequest, ServletResponse) line: 173	
	CoreOpenSessionInViewFilter(OpenSessionInViewFilter).doFilterInternal(HttpServletRequest, HttpServletResponse, FilterChain) line: 230	
	CoreOpenSessionInViewFilter(OncePerRequestFilter).doFilter(ServletRequest, ServletResponse, FilterChain) line: 106	
	ApplicationFilterChain.internalDoFilter(ServletRequest, ServletResponse) line: 202	
	ApplicationFilterChain.doFilter(ServletRequest, ServletResponse) line: 173	
	ReplyHeaderFilter.doFilter(ServletRequest, ServletResponse, FilterChain) line: 96	
	ApplicationFilterChain.internalDoFilter(ServletRequest, ServletResponse) line: 202	
	ApplicationFilterChain.doFilter(ServletRequest, ServletResponse) line: 173	
	StandardWrapperValve.invoke(Request, Response) line: 213	
	StandardContextValve.__invoke(Request, Response) line: 178	
	StandardContextValve.invoke(Request, Response) line: not available	
	SecurityAssociationValve.invoke(Request, Response) line: 175	
	JaccContextValve.invoke(Request, Response) line: 74	
	StandardHostValve.invoke(Request, Response) line: 126	
	ErrorReportValve.invoke(Request, Response) line: 105	
	CachedConnectionValve.invoke(Request, Response) line: 156	
	StandardEngineValve.invoke(Request, Response) line: 107	
	CoyoteAdapter.service(Request, Response) line: 148	
	Http11Processor.process(InputStream, OutputStream) line: 869	
	Http11Protocol$JmxHttp11ConnectionHandler(Http11BaseProtocol$Http11ConnectionHandler).processConnection(TcpConnection, Object[]) line: 664	
	PoolTcpEndpoint.processSocket(Socket, TcpConnection, Object[]) line: 527	
	MasterSlaveWorkerThread.run() line: 112	
	ThreadWithAttributes(Thread).run() line: 745	




/ Einde DEBUG PCT-1181

/ PCT-1181

/ 7	. 

configuration, planning , shipment order
/ click nu niet op shipment order,	 maar right click
/ dan verschijnt ook de shipment order search page, maar zonder frames	, de menu is er niet, maar we zien de url , 
https://test-pnl.mp-objects.com/pnllogistics/wicket/?wicket:interface=:9::::
/ open een sho	, we zien de url	,
https://test-pnl.mp-objects.com/pnllogistics/oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=26975539&systemId=26975539&returnUrl=https://test-pnl.mp-objects.com/pnllogistics/wicket/?wicket:interface=:9::::
/ click 'Create return'
/ we zien de return page	, en de url	,
https://test-pnl.mp-objects.com/pnllogistics/oms/shipment-order_create-return?shipmentorder_systemid=26975539&base_sessionLevelOffset=1
/ Geef enter op deze url	,
/ we zien de ERR msg van het ticket	,
org.postgresql.util.PSQLException: ERROR: duplicate key value violates unique constraint "shipment_order_org_uk" Detail: Key (shipment_order_id, organization_systemid)=(SH000131505RT, 500) already exists.

/ 7	. 

/ op een return sho SH000131503RT, click op Cost Price , we komen op 'Shipment Order Finance'	, 
/ dit is een wicket page,	 kijk hoe de back button er uit ziet	, deze komt goed terug op de return page	,


/ Einde PCT-1181

/ ECLIPSE

/ blame in eclipse	,

/ open een file ,bijv customer-order_edit.jsp
/ right click, Team, Show annotation...
/ kies HEAD reivision	, OK
Do you wish to view annotations using quick diff? Yes
/ In linker column, right click	, Revisions	,
Combined coloring	: check
Show author	: check
Show id: check


/ ECLIPSE

/ PCT-1181

/ 7	. 

/ configuration, planning, shipment order, right click
http://localhost:8080/tms/wicket/?wicket:interface=:15::::

/ search op SH000000223, open	,
http://localhost:8080/tms/oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=26685145&systemId=26685145&returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:15::::

/ click 'Create return'
http://localhost:8080/tms/oms/shipment-order_create-return?shipmentorder_systemid=26685145&base_sessionLevelOffset=1

/ we zien de Price Cost button	,

$ vi shipment-order_edit.jsp
	<a href="#" target="_self" onclick="return openFinancialDetails();" class="atoButton">

$ vi class.shipment-order_edit.jsp
function openFinancialDetails() {
	var mySystemId =document.getElementById("systemId").value;		/ hidden field op de page	,
	theShipmentorderFormManager.setRedirectUrl("../wicket/?module=oms&wicketpage=shipmentorder.shipmentorderfinancialdetails.ShipmentOrderFinancialPage&shipmentorder_systemid=" + mySystemId);
	theShipmentorderFormManager.conditionalSubmit(null,true,1);
	return false;
}

/ Als we terugkeren vanuit de shipment order financial page	terugkeren naar de return sho	, met de Back button	, zien we de url	,
http://localhost:8080/tms/oms/shipment-order_edit?systemId=26975505 

/ Met deze SH000000223 kunnen we later verder	, 

/ 7	. 

/ we open een eerder return order	, dat mag ook SH000000223 zijn	, 
/ de url is dan	,
http://localhost:8080/tms/oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=26975505&systemId=26975505&returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:29::::
/ Deze url is wel OK, om naar terug te keren	,

/ we open de return order	, SH000000214	, 
http://localhost:8080/tms/oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=26975499&systemId=26975499&returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:29::::
/ we click save	, wat gebeurt er dan met de url	?
http://localhost:8080/tms/oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:29::::&systemid=26975499&base_windowToOpenUrl=&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26975499&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=0&randomizingurl=1459351123195
/ TODO

<map:redirect-to uri="shipment-order_edit?base_sessionLevelOffset={request-attr:base_sessionLevelOffset}&amp;systemid={request-attr:systemid}&amp;return-url={request-attr:return-url}"/>

/ STRAKS 


/ Einde PCT-1181

/ DEBUG PCT-1181 URL

/ 7	. 

/ planning, shipment order , search
/ we zien de url	,
http://localhost:8080/tms/wicket/?wicket:interface=:1::::
/ edit een sho uit de list	,
http://localhost:8080/tms/oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=26684404&systemId=26684404&returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::

/ 13	. 

$ vi oms-menu.xml
	<m:add path="planning.shipmentOrder.search" screen-type="all" actionUrl="wicket?module=oms&amp;wicketpage=shipmentorder.list.ShipmentOrderListPage" privilege="shipment-order.list" index="2041" />

/ we zien in pnllogistics/	,
$ vi deploy/tms.war/menu.xml
            <menuItem index="2041">
              <labelId>search</labelId>
              <module>oms</module>
              <parent reference="../../.."/>
              <path>planning.shipmentOrder.search</path>
              <privilege>shipment-order.list</privilege>
              <type>ITEM</type>
              <url>wicket?module=oms&amp;wicketpage=shipmentorder.list.ShipmentOrderListPage&amp;emptySession=true</url>
              <visibilityExpr></visibilityExpr>
            </menuItem>

/ 13	. 

/ Eerst	, 
package com.mpobjects.invoice.control.shipmentorder.action;
 * Loads the FinancialParty-Party binding. For a ShipmentOrderVO
public class ShipmentOrderEditAction extends AbstractAction {
/ Dan	, 
package com.mpobjects.oms.control.shipmentorder.action;
 * Action class which sets the active shipment order
public class ShipmentOrderEditAction extends AbstractAction {
/ Dan	,
package com.mpobjects.oms.ratecalc.control.shipmentorder.action;

/ 7	. 

/ Wat gebeurt er als we op een edit button click in de list van sho's	? 

$ vi ShipmentOrderListPage.html
	<div wicket:id="query"></div>

$ vi ShipmentOrderListPage.java

package com.mpobjects.oms.view.wicket.shipmentorder.list;
public class ShipmentOrderListPage extends AbstractMainPage {
	protected void createView() {

		myRowAction.add(new RowAction() {
			@Override
			public boolean execute(final Object aObject) {
/ (*)
				String returnUrl = getRequestCycle().urlFor(ShipmentOrderListPage.this).toString();
				returnUrl = RequestUtils.toAbsolutePath(returnUrl);
				getRequestCycle().setRequestTarget(
						new RedirectRequestTarget("../oms/shipment-order_edit?" + "base_sessionLevelOffset=1" + "&systemid=" + aObject + "&systemId=" + aObject
								+ "&returnUrl=" + returnUrl));

		/* Create return order */
		myRowAction.add(new RowAction() {
/ (***)
			@Override
			public boolean execute(final Object aObject) {
				String returnUrl = getRequestCycle().urlFor(ShipmentOrderListPage.this).toString();
				returnUrl = RequestUtils.toAbsolutePath(returnUrl);

				ShipmentOrderVO myOriginalShipmentOrder = shipmentOrderService.getBean().getShipmentOrder((Integer) aObject);
				ShipmentOrderVO myVO = shipmentOrderService.getBean().createReturnShipmentOrder(myOriginalShipmentOrder);

				prepareLegacyJsp(myVO);

				getRequestCycle().setRequestTarget(
						new RedirectRequestTarget("../oms/shipment-order_edit?" + "base_sessionLevelOffset=1" + "&systemid=" + myVO.getSystemId()
								+ "&systemId=" + aObject
								+ "&returnUrl=" + returnUrl));

		add(new QueryViewPanel("query", Model.of(myQuery), myRowAction, myGroupAction));


$ vi  QueryViewPanel.html
				<tr wicket:id="rows">
					<td wicket:id="cell"><span wicket:id="cellvalue"></span></td>
				</tr>
$ vi  QueryViewPanel.java
	private void addDataRows() {
		dataView = new ListView<List<Object>>("rows", new PropertyModel<List<List<Object>>>(QueryViewPanel.this, "rowsOnPage")) {
			@Override
			protected void populateItem(final ListItem<List<Object>> aRow) {
				final ListView<Object> myRow = new ListView<Object>("cell", aRow.getModel()) {
					@Override
					protected void populateItem(final ListItem<Object> aCell) {
							for (final RowAction myAction : rowActionList) {
								RowActionPanel myPanel = new RowActionPanel(myActions.newChildId(), myAction, aCell.getModelObject(), myAction.getCssClass(), myAction.getTitle()) {

$ vi RowActionPanel.html
	<button wicket:id="link" ></button>

$ vi RowActionPanel.java
	public RowActionPanel(String aId, final RowAction anAction, final Object anObject, String cssClass, String aTitle) {
		super(aId);
		link = new AjaxLink("link") {
/ (**)
			@Override
			public void onClick(AjaxRequestTarget aTarget) {
				anAction.setTarget(aTarget);
				if (anAction.execute(anObject)) {
/s
/ naar (*) hierboven	,

/ In HTML zien we	,

<button wicket:id="link" id="linke0" wicketpath="query_rows_0_cell_0_cellvalue_2_link" 
	onclick="var wcall=wicketAjaxGet('?wicket:interface=:12:query:rows:0:cell:0:cellvalue:2:link::IBehaviorListener:0:',function() { }.bind(this),function() { }.bind(this), function() {return Wicket.$('linke0') != null;}.bind(this));return !wcall;" class="icon icon_edit small" title="Select"></button>

/ In onclick staat dat we bij (**) terecht komen	, en in (**) staat wat de actie is	, nl doen wat er bij (*) staat	,
 
/ (***) click op 'create return order' button van een sho	, naast de edit button	, 
/ deze keert OK terug naar	,
http://localhost:8080/tms/oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=26975527&systemId=26685513&returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:12::::

/ Dit is dus in de wicket page, want de 'create return sho' staat op een wicket page	, 
/ De 'create return ' op de sho staat op een JSP	,

/ 7	. 

/ we edit SH000000259, 	de url staat op de wicket page in de action	,
http://localhost:8080/tms/oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=26685522&systemId=26685522&returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:12::::

			<c:if test="${formVO.persistent && cf:property('oms', 'shipmentorder.returnbutton.enabled', 'false') && cf:hasPrivilege('shipment-order', 'createreturn', formVO, null)}">
				<input type="button" value="<mpo:label name="Create return"/>"
					onclick="document.location.href='../oms/shipment-order_create-return?shipmentorder_systemid=${formVO.systemId}&amp;base_sessionLevelOffset=1';" />
			</c:if>


$ vi ShipmentItemDeleteAction.java

/ als we 
	getRequest().setAttribute
/ willen, moet 
	public static final String ACTIVE_ITEM_TAB = "shipmentOrderChildsTab";

/ we nemen sho SH000000260	, 
http://localhost:8080/tms/oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=26685533&systemId=26685533&returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:12::::

/ we create een return	, SH000000260RT
/ en zien de url	,
http://localhost:8080/tms/oms/shipment-order_create-return?shipmentorder_systemid=26685533&base_sessionLevelOffset=1

/ delete een shipment item	,
/ we zien in HMTL	,
<a class="action formContext delete" href="shipment-item_delete?systemId=27130295&amp;base_sessionLevelOffset=1"><img src="../lookandfeel/styles/images/icons/delete24.png" alt="Delete" title="Delete"></a>

/ Dus 
shipment-item_delete?systemId=27130295&amp;base_sessionLevelOffset=1 is de request	
/ , niet 
https://test-pnl.mp-objects.com/pnllogistics/oms/shipment-order_create-return?shipmentorder_systemid=26975568&base_sessionLevelOffset=1

/s
ShipmentOrderSaveAction(AbstractSaveAction).afterSave() line: 153	
		if (shouldTakeControl()) {

			String myRedirectUrl = getRequest().getParameter("returnUrl");
null
/ die is NIET in	,
shipment-item_delete?systemId=27130295&amp;base_sessionLevelOffset=1 is de request	

			if (StringUtils.isEmpty(myRedirectUrl)) {
				myRedirectUrl = getRedirectUrl();
/s
ShipmentOrderSaveAction(AbstractSaveAction).getRedirectUrl() line: 474	
			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
1
/ Deze is er WEL in
shipment-item_delete?systemId=27130295&amp;base_sessionLevelOffset=1 is de request	

				if (getRequest().getAttribute(REDIRECT_TO_ATTR) != null) {
/ NEE
				} else if (getParameters().isParameter(REDIRECT_TO_ATTR)) {
/ NEE
				} else {
					myRet = getRequest().getParameter(REDIRECT_TO_ATTR);
shipment-item_delete?systemId=27130183&base_sessionLevelOffset=1			/ 27130183 is de shi	,
/ TODO
				HashMap<String, String> myTplMap = new HashMap<String, String>();
				myTplMap.put("systemid", "" + getValueObject().getSystemId());
26975535																			/ de return sho	,
				myRet = StringUtils.replaceVars(myRet, myTplMap);
/ Doet NIETS	,
/ TODO
				myRet = getRequestUrl(myRet, myParamMap);
shipment-item_delete?systemId=27130183&base_sessionLevelOffset=1&base_sessionLevelOffset=1

/t
			getRequest().setAttribute("redirectTo", myRedirectUrl);
			RedirectSaveAction.redirect(getRedirector(), getRequest(), myRedirectUrl);

/c
ShipmentItemDeleteAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	


/ 7	. 

/ uit wicket	,
http://localhost:8080/tms/oms/shipment-order_edit?base_sessionLevelOffset=1&systemid=26974226&systemId=26974226&returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::

/create return	,
<input type="button" value="Create return" onclick="document.location.href='../oms/shipment-order_create-return?shipmentorder_systemid=26974226&amp;base_sessionLevelOffset=1';">
/ MORGENOCHTEND





/ Einde DEBUG PCT-1181 URL

/ DEBUG PCT-1181 URL

/ 7	. 

/ Hoe werkt return mechanisme?

/ Neem local SH000000263,	 

/ op acc SH000131508

Entry date: 22-Apr-2015
Last update: 01-Apr-2016 8:16	/ zojuist	,
Req. start after: 01-Apr-2016 00:00
Req. start before: 01-Apr-2016 23:59	/ TODO
Req. end after:	04-Apr-2016	 08:16	/ steeds zetten	, WH door rate agreement	,
Req. end before: 04-Apr-2016	18:16


/ we openen shi of sa	, en return naar sho	,

/ we start de appl	,

planning, shipment order, search	, right click search item,	 
http://localhost:8080/tms/wicket/?wicket:interface=:5::::
/ Dit is ShipmentOrderListPage	,

/ 7	. 

/ open sho	,

/ urls=

GET http://localhost:8080/tms/oms/shipment-order_edit?base_sessionLevelOffset=3&systemid=26685566&systemId=26685566&returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::
/ uit wicket , in ShipmentOrderListPage	,
/ Met base_sessionLevelOffset=3 gebeurt NIETS	, 
/ TODO

/s
ShipmentOrderEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	

			if (getRequest().getAttribute("requestManager") != null) {
				setRequestManager((RequestManager) getRequest().getAttribute("requestManager"));

			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
			}
/ Nu kunnen we	,
getRequestManager().getLevel() 1	. 

/ als we Back geven	, en de sho opnieuw open	, is de level 2	, opnieuw 3	, ...
/ TODO


/ als we straks de shi edit	, dan wordt eerst sho save called	, en dan ook weer in ShipmentOrderSaveAction(AbstractAction).act 	, en dan ook level 1	,

/ als we hierna een nieuwe sho open	, wordt level 2, opnieuw: 3	, ...
/ TODO

/ 7	. 

/ we save de sho, 


/ In HTML zien we:
<input type="button" value="Save" onclick="document.getElementById('selectPath').value='yes'; theShipmentorderFormManager.submit('../oms/shipment-order_save', false, 0);">
<input type="button" id="saveAndCloseBtn" value="Save and Close" onclick=" theShipmentorderFormManager.submit('../oms/shipment-order_save?action=saveAndClose', true, '-1'); return false;">
/ we zien 0 als arg bij Save	, dit zal base_sessionLevelOffset zijn	, 
/ TODO

/ urls= 
POST http://localhost:8080/tms/oms/shipment-order_save
continuationId:1459751235097
flowDefinition:reload
redirectTo:../core/back?levelOffset=-1	 / redirectTo niet used	, want base_sessionLevelOffet != 1	,
doRedirect:false
base_sessionLevelOffset:0			/ de redirect url wordt bepaald in AbstractSaveAction.getRedirectUrl(()	, en dat is de url uit level 1-0=1	, shipment_order_edit	, 
									/ als base_sessionLevelOffset=1, pakt hij de POST param redirectTo	, maar dat is hier niet	,
base_windowToOpenUrl:
base_windowToOpenHeight:
base_windowToOpenWidth:
base_windowToOpenTitle:
base_windowToOpenScrollbar:
sho_systemid:26685566
si_systemid:
organization:PNL-CARGO
...

GET Request URL:http://localhost:8080/tms/core/generic_save_redirect?redirectTo=..%2Foms%2Fshipment-order_edit%3FreturnUrl%3Dhttp%3A%2F%2Flocalhost%3A8080%2Ftms%2Fwicket%2F%3Fwicket%3Ainterface%3D%3A1%3A%3A%3A%3A%26systemid%3D26685522%26base_windowToOpenUrl%3D%26base_windowToOpenTitle%3D%26base_sessionLevelOffset%3D0%26systemId%3D26685522%26base_windowToOpenScrollbar%3D%26base_windowToOpenHeight%3D%26base_windowToOpenWidth%3D%26base_sessionLevelOffset%3D0

GET Request URL:http://localhost:8080/tms/oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::&systemid=26685522&base_windowToOpenUrl=&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26685522&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=0&randomizingurl=1459759390633

/s
/ In ShipmentOrderSaveAction(AbstractAction).save is level nog steeds 1	,
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
getRequestManager().getLevel() 1

/s
ShipmentOrderSaveAction(AbstractSaveAction).afterSave() line: 153	

				myRedirectUrl = getRedirectUrl();
/s
ShipmentOrderSaveAction(AbstractSaveAction).getRedirectUrl() line: 469	
			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
0
/ getRequest().getParameter() pakt bij een GET de params achter de url,	 en bij een POST de post params	,

			if (myLevelOffset == 1) {
/ NEE
			} else {
				int myTargetLevel = getRequestManager().getLevel() + myLevelOffset;
1+0=1
				BaseRequest myTargetRequest = getRequestManager().getRequestForLevel(myTargetLevel);
{returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::, systemid=26685566, base_sessionLevelOffset=3, systemId=26685566}
/ Klopt	, die waren de params bij level 1	,

				myRet = myTargetRequest.getUrl();
../oms/shipment-order_edit

				for (Enumeration myEnumeration = getRequest().getParameterNames(); myEnumeration.hasMoreElements();) {
					myKey = (String) myEnumeration.nextElement();
					if (myKey.startsWith("base_")) {
						myMap.put(myKey, getRequestParameter(myKey));
					}
				}
{returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::,
 systemid=26685566,
 base_windowToOpenUrl=,
 base_windowToOpenTitle=,
 base_sessionLevelOffset=0, / Save btn's onclick="theShipmentorderFormManager.submit('../oms/shipment-order_save', false, 0);">
 systemId=26685566,
 base_windowToOpenScrollbar=,
 base_windowToOpenHeight=,
 base_windowToOpenWidth=}

				myMap.put(RequestManager.SESSION_LEVEL_OFFSET, myLevelOffsetStr);
0
				myRet = getRequestUrl(myRet, myMap);
../oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::&systemid=26685566&base_windowToOpenUrl=&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26685566&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=

/t
ShipmentOrderSaveAction(AbstractSaveAction).afterSave() line: 162	
				myRedirectUrl = getRedirectUrl();
/d
			getRequest().setAttribute("redirectTo", myRedirectUrl);

			RedirectSaveAction.redirect(getRedirector(), getRequest(), myRedirectUrl);
/s
RedirectSaveAction.redirect(Redirector, Request, String, int) line: 44	
		for (Enumeration myEnum = aRequest.getParameterNames(); myEnum.hasMoreElements();) {
			myParameterName = (String) myEnum.nextElement();

			if (myParameterName.startsWith("base_") && StringUtils.isNotEmpty(aRequest.getParameter(myParameterName))) {
				myRememberedParamList.add(myParameterName + "=" + aRequest.getParameter(myParameterName));
			}
		}
[base_sessionLevelOffset=0]

		if (myRememberedParamList.size() > 0) {
			String mySeperator;
			if (anUrl.indexOf('?') > 0) {
				mySeperator = "&";
			anUrl += mySeperator + StringUtils.implode(myRememberedParamList.toArray(), "&");
../oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::&systemid=26685566&base_windowToOpenUrl=&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26685566&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=0

	aRequest.setAttribute("redirectTo", anUrl);

		try {
			String myRedirectPage = "../core/generic_save_redirect?redirectTo=" + URLEncoder.encode(anUrl, "UTF-8");

			aRedirector.redirect(true, myRedirectPage);

/ Dan via JS
/ TODO
/s
ShipmentOrderEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	

url=
http://localhost:8080/tms/oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::&systemid=26685566&base_windowToOpenUrl=&randomizingurl=1459753258627&base_windowToOpenTitle=&base_sessionLevelOffset=0&systemId=26685566&base_windowToOpenScrollbar=&base_windowToOpenWidth=&base_windowToOpenHeight=&base_sessionLevelOffset=0&randomizingurl=1459757183634

			if (getRequest().getAttribute("requestManager") != null) {
				setRequestManager((RequestManager) getRequest().getAttribute("requestManager"));

			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
			}
getRequestManager().getLevel()	1

...

/ Intermezzo

/ Als we een sho save op de sho edit page	, is heeft de POST sho_save base_sessionOffsetLevel 0 (staat in HTML bij action button), hij pakt url=level 1-0=1, en dat is sho edit	,  
/ Als we een shi edit, gaat hij eerst sho save	, maar dan is base_sessionOffsetLevel 1, en dan pakt hij de POST param redirectTo	, en dat is sho edit	, 

/ Einde Intermezzo

/ 7	. 

/ MORGENOCHTEND

/ open shi
/ de urls zijn,  

POST http://localhost:8080/tms/oms/shipment-order_save
Form Data;
continuationId:1459757668037
flowDefinition:reload
redirectTo:shipment-item_edit?systemId=26685571&base_sessionLevelOffset=1			/ in .afterSave() de level zal 2 worden, als nu 1	, na de redirect	, wat betekent de &base_sessionLevelOffset=1  op deze line	TODO?
doRedirect:true
base_sessionLevelOffset:1			/ omdat =1, pakt hij de request param redirectTo  2 regels hierboven	, dat is logisch, want als =1, dan gaat hij 1 page=url verder	, 
base_windowToOpenUrl:
base_windowToOpenHeight:
base_windowToOpenWidth:
base_windowToOpenTitle:
base_windowToOpenScrollbar:
sho_systemid:26685566
si_systemid:
organization:PNL-CARGO


GET http://localhost:8080/tms/core/generic_save_redirect?redirectTo=..%2Foms%2Fshipment-item_edit%3FsystemId%3D26685571%26base_sessionLevelOffset%3D1%26base_sessionLevelOffset%3D1%26base_sessionLevelOffset%3D1

/ In nieuw network devtools	, 
GET http://localhost:8080/tms/oms/shipment-item_edit?systemId=26685573&base_sessionLevelOffset=1&base_sessionLevelOffset=1&base_sessionLevelOffset=1&randomizingurl=1459754215397


$ vi oms-sitemap.xmap
			<map:action logger="shipmentorder" name="shipmentItemEdit" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentItemEditAction"/>
			<map:match pattern="shipment-item_edit">
				<map:act type="shipmentItemEdit"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order_edit.jsp"/>
			</map:match>

/ 13	.

/ EDIT SHIPMENT_ITEM -> SAVE SHIPMENT_ORDER
/ SAVE SHIPMENT_ITEM -> SAVE SHIPMENT_ORDER

/ Hoe komt in POST shipment_order_save 
redirectTo:shipment-item_edit?systemId=26685571&base_sessionLevelOffset=1

/ op server	,

$ vi FormTag.java
	public int doStartTag() throws JspTagException {
		myPrintString.append(" action=\"" + getAction() + "\"");

/ Wanneer wordt FormTag.setAction called?
/ TODO
/= shipment_order_save

/ Later 
/ op client, in browser	,

/ op de shipment-order_edit.jsp staat het script class.pagerequest.js	, deze wordt exec als de page wordt load	,

$ vi class.pagerequest.js
pageRequestAddOnLoadEvent("PageRequest.processGenericClassEvents()"); 
/s
function pageRequestAddOnLoadEvent(anEvent) {
        pageRequestEventList[pageRequestEventList.length] = anEvent;
/ Dit is 1 keer van de 10 keer dat deze fct wordt called	,
0: "PageRequest.processGenericClassEvents()"
1: "screenContainer_openWindowAfterOnload();"
2: "screenContainer_loadMenuFromDiv();"
3: "new FocusOnFirstField()"
4: "convertTrees();"
5: "new TabCollection()"
6: "createhintbox()"
7: "formInitReadOnlyCheckBoxes()"
8: "new ShipmentOrderEdit()"
9: "shipmentOrderCorrectLocations()"
/c
/s
initPageRequest (class.pagerequest.js:33)
	gloPageRequestObj.initialize();
/s
PageRequest.initialize (class.pagerequest.js:75)
    //invoke all javascript initializing hooks
    for(var i=0;i<pageRequestEventList.length;i++) {
    	else {
    		eval(pageRequestEventList[i]);
/s
/ 1ste	,

PageRequest.processGenericClassEvents()
/s
PageRequest.processGenericClassEvents (class.pagerequest.js:171)
	// -- loop through all divs
	var myElements = document.getElementsByTagName("div");
...
	//loop through all links
	var myElements = document.getElementsByTagName("a");
25
	for(var i=0;i<myElements.length;i++) {
...
		} else if (myElement.className.match("formContext")) {
			PageRequest.initformContextElement(myElement);
/s
PageRequest.initformContextElement = function(myElement) {
	if (myElement.onclick) {
/ JA, sommige
/ NEE	, sommige	,
		myElement.preInitFormContextOnclick=myElement.onclick;
	}
	myElement.onclick = PageRequest.formContextLinkOnclick;

/c
/ 8ste	, 
/s
new ShipmentOrderEdit()
/s
$ vi class.shipment-order_edit.js
function ShipmentOrderEdit() {
    myElement = document.getElementById("shipmentOrderCancelBtn");
    if (myElement!=null) {
    	myElement.onclick = ShipmentOrderEdit.shipmentOrderCancelBtnOnclick;
	}
    myElement = document.getElementById("shipmentOrderChildsTabList");
    if (myElement!=null) {
    	myElement.onclick=shipmentOrderCorrectLocations;
	}

/ later	,
/ 1ste ->
/s
PageRequest.formContextLinkOnclick = function() {
	var shouldGo = true;
	if (shouldGo) {
		} else {
			theActiveFormManager.setRedirectUrl(this.getAttribute("href"));
this=a.action.formContext.edit
"shipment-item_edit?systemId=27155534&base_sessionLevelOffset=1"
/s
$ less class.formmanager.js
    this.setRedirectUrl = function(anUrl) {
        document.getElementById("redirectTo").value=anUrl;
/t
			theActiveFormManager.submit(null,true,1);



/ we zien in HTML	,
<a class="action formContext edit" href="shipment-item_edit?systemId=26824970&amp;base_sessionLevelOffset=1"><img src="../lookandfeel/styles/images/icons/check24.png" alt="Edit" title="Edit"></a>

/ Dus als we de edit shi click, wordt het form submit, die action shipment_order_save heeft	, en de redirect is shipment_item_edit	,
/ Dit geldt voor alle links op de page	, en <input>'s,	
/ Ook als we  de shi save	, wordt eerst sho save called	,

/ Einde EDIT SHIPMENT_ITEM -> SAVE SHIPMENT_ORDER
/ Einde SAVE SHIPMENT_ITEM -> SAVE SHIPMENT_ORDER



/s
ShipmentOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	

			theRequest = ObjectModelHelper.getRequest(theObjectModel);
/ Nu kunnen we getRequest()	,
			if (getRequest().getAttribute("requestManager") != null) {
				setRequestManager((RequestManager) getRequest().getAttribute("requestManager"));

			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
			}

getRequestManager().getLevel()	1
/ Nog steeds	, net als bij de edit van de sho	,

				Map myMap = act();
/s
ShipmentOrderSaveAction(AbstractSaveAction).act() line: 64	
			handleSave();
/s
ShipmentOrderSaveAction.handleSave() line: 17	
		super.handleSave();
/s
ShipmentOrderSaveAction(ShipmentOrderSaveAction).handleSave() line: 61	
...
/c
ShipmentOrderSaveAction(AbstractSaveAction).afterSave() line: 153	
			String myRedirectUrl = getRequest().getParameter("returnUrl");
null
			if (StringUtils.isEmpty(myRedirectUrl)) {
				myRedirectUrl = getRedirectUrl();
/s
ShipmentOrderSaveAction(AbstractSaveAction).getRedirectUrl() line: 473	

			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
1
			if (myLevelOffset == 1) {
/ JA
				if (getRequest().getAttribute(REDIRECT_TO_ATTR) != null) {
/ NEE
				} else if (getParameters().isParameter(REDIRECT_TO_ATTR)) {
/ NEE
				} else {
					myRet = getRequest().getParameter(REDIRECT_TO_ATTR);
shipment-item_edit?systemId=26685573&base_sessionLevelOffset=1					/ 26685573 is de shi	,

/ Dus we gaven deze url	, maar hij ging eerst sho save	, en dan nu de uiteindelijke url	, 
/ TODO
				HashMap<String, String> myTplMap = new HashMap<String, String>();
				myTplMap.put("systemid", "" + getValueObject().getSystemId());
getValueObject().getSystemId()=26685566																		/ 26685566 is de sho	,
				myRet = StringUtils.replaceVars(myRet, myTplMap);
shipment-item_edit?systemId=26685573&base_sessionLevelOffset=1					/ 26685573 is de shi	,
////////////////////
/Klopt	, dit is de redirectTo param van de POST shipment-order_save	, see urls boven	,

/ myRet is onveranderd	,

				Map<String, String> myParamMap = new HashMap<String, String>();
				myParamMap.put(RequestManager.SESSION_LEVEL_OFFSET, "1");
				myRet = getRequestUrl(myRet, myParamMap);
shipment-item_edit?systemId=26685573&base_sessionLevelOffset=1&base_sessionLevelOffset=1
/ we geven base_sessionLevelOffset door	, 
/ TODO
/t
ShipmentOrderSaveAction(AbstractSaveAction).afterSave() line: 162	
				myRedirectUrl = getRedirectUrl();
/d
			getRequest().setAttribute("redirectTo", myRedirectUrl);
			RedirectSaveAction.redirect(getRedirector(), getRequest(), myRedirectUrl);
/s
RedirectSaveAction.redirect(Redirector, Request, String, int) line: 43	
/=
	public static void redirect(Redirector aRedirector, Request aRequest, String anUrl, int aLevelOffset) {
aLevelOffset=0
/ TODO
		for (Enumeration myEnum = aRequest.getParameterNames(); myEnum.hasMoreElements();) {
			myParameterName = (String) myEnum.nextElement();

			if (myParameterName.startsWith("base_") && StringUtils.isNotEmpty(aRequest.getParameter(myParameterName))) {
/ JA
base_sessionLevelOffset
				myRememberedParamList.add(myParameterName + "=" + aRequest.getParameter(myParameterName));
			}
		}
		if (aLevelOffset != 0) {
/ NEE
			myRememberedParamList.add(RequestManager.SESSION_LEVEL_OFFSET + "=" + aLevelOffset);
/ NIET
/ Dus als er in JS 0 wordt gegeven	, heeft dat geen effect	,
/ TODOj

		if (myRememberedParamList.size() > 0) {
			String mySeperator;
			if (anUrl.indexOf('?') > 0) {
				mySeperator = "&";

			anUrl += mySeperator + StringUtils.implode(myRememberedParamList.toArray(), "&");
shipment-item_edit?systemId=26685573&base_sessionLevelOffset=1&base_sessionLevelOffset=1&base_sessionLevelOffset=1
/ TODO

		// in current module, add module prefix..
		if (anUrl.indexOf('/') == -1) {
			anUrl = "../" + EntityActionUtil.getModule(new RequestAdaptor(aRequest)) + "/" + anUrl;
../oms/shipment-item_edit?systemId=26685573&base_sessionLevelOffset=1&base_sessionLevelOffset=1&base_sessionLevelOffset=1

		aRequest.setAttribute("redirectTo", anUrl);
/ TODO (Wanneer used?)
		try {
			String myRedirectPage = "../core/generic_save_redirect?redirectTo=" + URLEncoder.encode(anUrl, "UTF-8");
			aRedirector.redirect(true, myRedirectPage);


$ vi core-sitemap.xmap
           <map:match pattern="generic_save_redirect">
                <map:generate type="serverpages" src="xsp/generic-save-redirect.xml"/>
                <map:serialize type="html"/>
            </map:match>

$ vi xsp/generic-save-redirect.xml
...
/ TODO

/c
ShipmentItemEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
/ Nieuwe request	, getRequest()=null	,

/ Dit is de url	,
../oms/shipment-item_edit?systemId=26685573&base_sessionLevelOffset=1&base_sessionLevelOffset=1&base_sessionLevelOffset=1

/ we hebben de base_sessionLevelOffset doorgegeven	, maar in de oorspronkelijke url stond hij al,
/ TODO
/s
ShipmentItemEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 160	
			if (getRequest().getAttribute("requestManager") != null) {
				setRequestManager((RequestManager) getRequest().getAttribute("requestManager"));

			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
			}
getRequestManager().getLevel()	2
/ Klopt	, 1 meer als net bij de sho	, dus de base_offsetLevelOffset is erbij opgeteld	, ergens (TODO)

				Map myMap = act();
/s
ShipmentItemEditAction.act() line: 37	

		int mySystemId = getSystemIdFromRequest();
/s
ShipmentItemEditAction(AbstractAction).getSystemIdFromRequest() line: 587	
				mySystemString = getRequest().getParameter("systemId");
26685573
		ShipmentOrderVO myShipmentOrder = (ShipmentOrderVO) getSession().getAttribute(ShipmentOrderView.ACTIVE_SHIPMENTORDER);
ShipmentOrder: SH000000263(SystemId:26685566; Org:PNL-CARGO)
		myShipmentOrder = ShipmentOrderUtil.getShipmentOrderFacadeLocal().getShipmentOrder(myShipmentOrder.getSystemId());
/ TODO
		getSession().setAttribute(ShipmentOrderView.ACTIVE_SHIPMENTORDER, myShipmentOrder);
		getRequest().setAttribute("formVO", myShipmentOrder);

		ShipmentItemVO myShipmentItem = getShipmentItemService().getBySystemId(mySystemId);
shipmentItem: 0002(systemId:26685573, labelInfo:6338879791089415)
		ShipmentItemFormBean myFormVO = new ShipmentItemFormBean(myShipmentItem, myShipmentOrder.getProductItemList());
		getRequest().setAttribute("shipmentItemCostParts", myShipmentItem.getCostPartList());
		getSession().setAttribute(ShipmentItemView.ACTIVE_SHIPMENTITEM, myFormVO);

		getSession().setAttribute(ACTIVE_ITEM_TAB, ACTIVE_ITEM_TAB_SHIPMENT);
/ TODO

/ 7	. 

/ save de shi	,

/ we zien in HTML de Save Shipment Item button	,
<input type="button" name="saveShipmentItemBtn" id="saveShipmentItemBtn" value="Save Shipment item" onclick=" theShipmentorderFormManager.submit('../oms/shipment-item_save-shipment-item', false, 0);">
/ TODO (../oms/shipment-item_save-shipment-item)	,

/ urls	, 

POST http://localhost:8080/tms/oms/shipment-item_save

continuationId:1459754942846
flowDefinition:reload
redirectTo:../core/back?levelOffset=-1
doRedirect:false
base_sessionLevelOffset:-3
base_windowToOpenUrl:
base_windowToOpenHeight:
base_windowToOpenWidth:
base_windowToOpenTitle:
base_windowToOpenScrollbar:
sho_systemid:26685566
si_systemid:
organization:PNL-CARGO
...

GET http://localhost:8080/tms/core/generic_save_redirect?redirectTo=..%2Fcore%2Fopening_page%3Fbase_windowToOpenUrl%3D%26base_windowToOpenTitle%3D%26base_sessionLevelOffset%3D-3%26base_windowToOpenScrollbar%3D%26base_windowToOpenHeight%3D%26base_windowToOpenWidth%3D%26base_sessionLevelOffset%3D-3
Request Method:GET

/ GET http://localhost:8080/tms/core/opening_page?base_windowToOpenUrl=&base_windowToOpenTitle=&base_sessionLevelOffset=-3&base_windowToOpenScrollbar=&base_windowToOpenHeight=&base_windowToOpenWidth=&base_sessionLevelOffset=-3&randomizingurl=1459758379807
/ als we -3 geven	,
/ TODO

/ WH	,
$ vi ButtonTag.java
					myPrint.append(" onclick=\" " + getForm().getJsFormManager() + ...
/ TODO

$ vi oms-sitemap.xmap
			<map:match pattern="shipment-item_save">
				<map:act type="shipmentOrderSave">
					<map:parameter name="noRedirect" value="true"/>
					<map:parameter name="skipFieldPrefix" value="productItem"/>
				</map:act>
				<map:act type="shipmentItemSave"/>
			</map:match>

/s

/ In JS	, client side	,

$ vi class.shipment-order_edit.js
/ TODO (hoe hier?)

ShipmentOrderEdit.saveShipmentItem = function() {

	var myRedirectLevelOffset=0;
	if (document.getElementById("shipmentItemSystemId").value!="0") {
/ JA
		myRedirectLevelOffset=-1;
	}
    theShipmentorderFormManager.submit("../oms/shipment-item_save", false, myRedirectLevelOffset);
}
...
/c
FormManager.submit (class.formmanager.js:46)
    this.submit = function(anAction, aBoolDoRedirect, aRedirectionLevelOffset) {

aBoolDoRedirect: false
aRedirectionLevelOffset: -1
anAction: "../oms/shipment-item_save"

        this.lastAction = anAction;
        this.lastDoRedirect = aBoolDoRedirect;

        document.getElementById("base_sessionLevelOffset").value=aRedirectionLevelOffset;
		document.getElementById("doRedirect").value=aBoolDoRedirect;

       var myForm = document.getElementById(this.theFormName);

        if(anAction){
        	myForm.action=anAction;

/ In Java	, server	,
/c
/s
ShipmentOrderSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
getRequestManager().getLevel()	2
/ Dezelfde level van de shi	, als bij edit shi	, dus klopt	,

...
/c
ShipmentOrderSaveAction(AbstractSaveAction).afterSave() line: 166	
		if (shouldTakeControl()) {
/ NEE
/ want	,
/s
			return !getParameters().isParameter("noRedirect");
!true=false
/ Klopt	, dit zagen we in de oms-sitemap	,

/ dus AbstractSaveAction.afterSave  doet nu niets	,

/c
ShipmentItemSaveAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	


			if (getRequest().getAttribute("requestManager") != null) {
				setRequestManager((RequestManager) getRequest().getAttribute("requestManager"));

getRequestManager().getLevel() 2
/ Klopt	, nog die van shi edit	,

				Map myMap = act();
/s
ShipmentItemSaveAction(AbstractSaveAction).act() line: 69	
			handleSave();
/s
ShipmentItemSaveAction.handleSave() line: 64	
...
		getSession().setAttribute(ACTIVE_ITEM_TAB, ACTIVE_ITEM_TAB_SHIPMENT);
/s
ShipmentItemSaveAction(AbstractSaveAction).afterSave() line: 153	
		if (shouldTakeControl()) {
/ JA
			String myRedirectUrl = getRequest().getParameter("returnUrl");
			if (StringUtils.isEmpty(myRedirectUrl)) {
				myRedirectUrl = getRedirectUrl();
/s
	protected String getRedirectUrl() throws Exception {

			String myLevelOffsetStr = getRequest().getParameter(RequestManager.SESSION_LEVEL_OFFSET);
-1
/ Deze komt uit JS	, want we hadden deze op -3 set	, we correct nu tot -1	,
			int myLevelOffset = getRequestManager().parseLevel(myLevelOffsetStr);
-1
			if (myLevelOffset == 1) {
/ NEE
			} else {
				int myTargetLevel = getRequestManager().getLevel() + myLevelOffset;
getRequestManager().getLevel()=2
myLevelOffset=-1
2+-1=1
				BaseRequest myTargetRequest = getRequestManager().getRequestForLevel(myTargetLevel);
				myRet = myTargetRequest.getUrl();
../oms/shipment-order_edit

				Map<String, String> myMap = new HashMap<String, String>(myTargetRequest.getParams());
{returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::,
 systemid=26685566,
 base_windowToOpenUrl=,
 randomizingurl=1459490386175,
 base_windowToOpenTitle=,
 base_sessionLevelOffset=0,
 systemId=26685566,						/ sho	,
 base_windowToOpenScrollbar=,
 base_windowToOpenWidth=,
 base_windowToOpenHeight=}

				for (Enumeration myEnumeration = getRequest().getParameterNames(); myEnumeration.hasMoreElements();) {
					myKey = (String) myEnumeration.nextElement();
					if (myKey.startsWith("base_")) {
						myMap.put(myKey, getRequestParameter(myKey));
{returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::,
 systemid=26685566,
 base_windowToOpenUrl=,
 randomizingurl=1459490386175,
 base_windowToOpenTitle=,
 base_sessionLevelOffset=-1,	 			/ was 0	,
 systemId=26685566,
 base_windowToOpenScrollbar=,
 base_windowToOpenWidth=,
 base_windowToOpenHeight=}

				}
				myMap.put(RequestManager.SESSION_LEVEL_OFFSET, myLevelOffsetStr);
-1
				myRet = getRequestUrl(myRet, myMap);
../oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::&systemid=26685566&base_windowToOpenUrl=&randomizingurl=1459490386175&base_windowToOpenTitle=&base_sessionLevelOffset=-1&systemId=26685566&base_windowToOpenScrollbar=&base_windowToOpenWidth=&base_windowToOpenHeight=

/ Dus hij haalt eig. op de url die hoort bij level 1	, en modifies deze (base_sessionLevelOffset=-1)	,	 want nu is level 2	,

/t
ShipmentItemSaveAction(AbstractSaveAction).afterSave() line: 162	
				myRedirectUrl = getRedirectUrl();
/d
../oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::&systemid=26685566&base_windowToOpenUrl=&randomizingurl=1459490386175&base_windowToOpenTitle=&base_sessionLevelOffset=-1&systemId=26685566&base_windowToOpenScrollbar=&base_windowToOpenWidth=&base_windowToOpenHeight=

			getRequest().setAttribute("redirectTo", myRedirectUrl);
/ TODO
			RedirectSaveAction.redirect(getRedirector(), getRequest(), myRedirectUrl);
/s
RedirectSaveAction.redirect(Redirector, Request, String, int) line: 43	
		for (Enumeration myEnum = aRequest.getParameterNames(); myEnum.hasMoreElements();) {
			myParameterName = (String) myEnum.nextElement();

			if (myParameterName.startsWith("base_") && StringUtils.isNotEmpty(aRequest.getParameter(myParameterName))) {
				myRememberedParamList.add(myParameterName + "=" + aRequest.getParameter(myParameterName));
[base_sessionLevelOffset=-1]

/ De request uit level 1 had veel niet lege base_... params	, uit level 2 maar 1	,

			anUrl += mySeperator + StringUtils.implode(myRememberedParamList.toArray(), "&");
../oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::&systemid=26685566&base_windowToOpenUrl=&randomizingurl=1459490386175&base_windowToOpenTitle=&base_sessionLevelOffset=-1&systemId=26685566&base_windowToOpenScrollbar=&base_windowToOpenWidth=&base_windowToOpenHeight=&base_sessionLevelOffset=-1

/ Dus base_sessionLevelOffset=-1 staat er in van level TODO	, en nu ook van level 2	, WH telt de laatste	,

		aRequest.setAttribute("redirectTo", anUrl);

		try {
			String myRedirectPage = "../core/generic_save_redirect?redirectTo=" + URLEncoder.encode(anUrl, "UTF-8");

			aRedirector.redirect(true, myRedirectPage);

/c
ShipmentOrderEditAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	

url=
http://localhost:8080/tms/oms/shipment-order_edit?returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:1::::&systemid=26685566&base_windowToOpenUrl=&randomizingurl=1459753258627&base_windowToOpenTitle=&base_sessionLevelOffset=-1&systemId=26685566&base_windowToOpenScrollbar=&base_windowToOpenWidth=&base_windowToOpenHeight=&base_sessionLevelOffset=-1&randomizingurl=1459756814765

			if (getRequest().getAttribute("requestManager") != null) {
				setRequestManager((RequestManager) getRequest().getAttribute("requestManager"));

			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
			}
/ Nu kunnen we	,
getRequestManager().getLevel()	1
/ OK	,


/ 7	. 

/ we gaan spelen	,

$ vi ShipmentOrderListPage.java
		myRowAction.add(new RowAction() {
			@Override
			public boolean execute(final Object aObject) {
				String returnUrl = getRequestCycle().urlFor(ShipmentOrderListPage.this).toString();
				returnUrl = RequestUtils.toAbsolutePath(returnUrl);
				getRequestCycle().setRequestTarget(
						new RedirectRequestTarget("../oms/shipment-order_edit?" + "base_sessionLevelOffset=3" + "&systemid=" + aObject + "&systemId=" + aObject
								+ "&returnUrl=" + returnUrl));			<- WAS base_sessionLevelOffset=1
				return false;
			}

$ vi class.shipment-order_edit.js

ShipmentOrderEdit.saveShipmentItem = function() {
	var myRedirectLevelOffset=0;
	if (document.getElementById("shipmentItemSystemId").value!="0") {
		myRedirectLevelOffset=-3;																	<- WAS myRedirectLevelOffset=--1	,
	}
    theShipmentorderFormManager.submit("../oms/shipment-item_save", false, myRedirectLevelOffset);
}

/ 7	. 

/ sho SH000000263
/ delete een shi	,

SH000000263




































/ Einde DEBUG PCT-1181 URL

/ DSVFMS DEPLOY ACC

java.lang.IllegalStateException: organization not allowed, system_id [3240] at 
/ Voeg alle organizations aan jezelf toe	,

java.io.StreamCorruptedException: invalid stream header: 74617265 at 
java.io.ObjectInputStream.readStreamHeader(ObjectInputStream.java:803) at 
java.io.ObjectInputStream.(ObjectInputStream.java:298) at 
net.sf.ehcache.util.PreferredLoaderObjectInputStream.(PreferredLoaderObjectInputStream.java:40) at 
net.sf.ehcache.store.disk.DiskStorageFactory.read(DiskStorageFactory.java:368) at 
net.sf.ehcache.store.disk.DiskStorageFactory.retrieve(DiskStorageFactory.java:864) at 
net.sf.ehcache.store.disk.Segment.decode(Segment.java:171) at 
net.sf.ehcache.store.disk.Segment.put(Segment.java:458) at 
net.sf.ehcache.store.disk.DiskStore.putFaulted(DiskStore.java:229) at 
net.sf.ehcache.store.CacheStore$3.call(CacheStore.java:143) at 
net.sf.ehcache.store.CacheStore$3.call(CacheStore.java:137) at 
net.sf.ehcache.store.cachingtier.OnHeapCachingTier$Fault.get(OnHeapCachingTier.java:334) at 
net.sf.ehcache.store.cachingtier.OnHeapCachingTier$Fault.access$200(OnHeapCachingTier.java:311) at 
net.sf.ehcache.store.cachingtier.OnHeapCachingTier.get(OnHeapCachingTier.java:175) at 
net.sf.ehcache.store.CacheStore.put(CacheStore.java:137) at 
net.sf.ehcache.Cache.putInternal(Cache.java:1617) at 
net.sf.ehcache.Cache.put(Cache.java:1543) at 
net.sf.ehcache.Cache.put(Cache.java:1508) at 
org.apache.cocoon.components.store.impl.EHDefaultStore.store(EHDefaultStore.java:361) at 
org.apache.cocoon.caching.impl.CacheImpl.store(CacheImpl.java:85) at 
org.apache.cocoon.components.pipeline.impl.AbstractCachingProcessingPipeline.processReader(AbstractCachingProcessingPipeline.java:908) at 
org.apache.cocoon.components.pipeline.AbstractProcessingPipeline.process(AbstractProcessingPipeline.java:473) at 
org.apache.cocoon.components.treeprocessor.sitemap.ReadNode.invoke(ReadNode.java:85) at 
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:47) at 
org.apache.cocoon.components.treeprocessor.sitemap.MatchNode.invoke(MatchNode.java:108) at 
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69) at 
org.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143) at 
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69) at 
org.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93) at 
org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235) at 
org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177) at 
org.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:253) at 
org.apache.cocoon.components.treeprocessor.sitemap.MountNode.invoke(MountNode.java:118) at 
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69) at 
org.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143) at 
org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69) at 
org.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93) at 
org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235) at 
org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177) at 
org.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:253) at 
org.apache.cocoon.Cocoon.process(Cocoon.java:699) at 
org.apache.cocoon.servlet.CocoonServlet.service(CocoonServlet.java:1154) at 
javax.servlet.http.HttpServlet.service(HttpServlet.java:810) at 
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252) at 
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at 
com.mpobjects.control.filter.FirstLoginFilter.doFilter(FirstLoginFilter.java:76) at 
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202) at 
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173) at 
org.springframework.security.web.FilterChainProxy$VirtualFilterC


volgens dries kan dit te maken hebben met pat-391?
  

/ Einde DSVFMS DEPLOY ACC

/ REQUEST PARAMETERS

/ Intermezzo

public class ShipmentOrderEditAction extends AbstractAction {
			String returnUrl = getRequestParameter("returnUrl");
			getSession().setAttribute("returnUrl", returnUrl);
/ Maar dan in hele session	, 

/ Einde Intermezzo

configuration, planning, parties	,
https://test-pnl.mp-objects.com/pnllogistics/wicket/?wicket:interface=:16::::
/ edit een party	, 
https://test-pnl.mp-objects.com/pnllogistics/oms/party_edit?base_sessionLevelOffset=1&systemid=27156688&systemId=27156688&returnUrl=https://test-pnl.mp-objects.com/pnllogistics/wicket/?wicket:interface=:16::::

$ vi oms-menu.xml
	<m:add path="configuration.planning.parties" privilege="party.list" actionUrl="wicket?module=oms&amp;wicketpage=party.PartyListPage" index="1050" />

$ vi PartyListPage.java

		myRowActions.add(new RowAction() {
			@Override
			public boolean execute(Object aObject) {
				String returnUrl = getRequestCycle().urlFor(PartyListPage.this).toString();
				returnUrl = RequestUtils.toAbsolutePath(returnUrl);
				getRequestCycle().setRequestTarget(
						new RedirectRequestTarget("../oms/party_edit?" + "base_sessionLevelOffset=1" + "&systemid=" + aObject + "&systemId=" + aObject
								+ "&returnUrl=" + returnUrl));


/ we zien de url van de list page	,
http://localhost:8080/tms/wicket/?wicket:interface=:3::::

/ Dan	,
$ vi oms-sitemap.xmap
			<map:action logger="party" name="partyForm" src="com.mpobjects.oms.control.party.action.PartyFormAction"/>
			<map:match type="regexp" pattern="^party_(edit|create)$">
				<map:act type="partyForm"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/party_edit.jsp"/>
			</map:match>

$ vi PartyFormAction.java
	public Map act() throws java.lang.Exception {
		getSession().setAttribute("partyAddFormVO", myPartyGroupAddVO);
/ (*)

 

/ we click op de edit button van 1 van de parties	,
/ we zien de url	,
http://localhost:8080/tms/oms/party_edit?base_sessionLevelOffset=1&systemid=27156688&systemId=27156688&returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:3::::
/ dus deze wordt gevraagd aan de server,	 deze request gaan we nu process	,

/s
PartyFormAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	

			if (getRequest().getAttribute("requestManager") != null) {
/ NEE
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));
/s
RequestManager.<init>(SessionAdaptor, RequestAdaptor, boolean) line: 109	
		if (getSession().getAttribute(SESSION_MAP) != null) {
SESSION_MAP=base_sessionMap
			mySessionMap = (Map<String, BaseRequest>) getSession().getAttribute(SESSION_MAP);

		if (getSession().getAttribute(SESSION_LIST) != null) {
SESSION_LIST=base_sessionList
			mySessionList = (ArrayList<String>) getSession().getAttribute(SESSION_LIST);

		if (getSession().getAttribute(SESSION_LEVEL) != null) {
SESSION_LEVEL=base_sessionLevel
			setLevel(Math.max(0, Integer.parseInt((String) getSession().getAttribute(SESSION_LEVEL))));

		if (isFlowControlEnabled) {
			BaseRequest myRequest = new BaseRequest(aRequest);
			int myLevelOffset = parseLevel(getRequest().getParameter(SESSION_LEVEL_OFFSET));
SESSION_LEVEL_OFFSET=base_sessionLevelOffset													/ deze staat inderdaad achter de ? in de url	,
1
			setLevel(Math.max(0, getLevel() + myLevelOffset));
			mySessionMap.put(myRequest.getRequestId(), myRequest);
			try {
				mySessionList.add(getLevel(), myRequest.getRequestId());
[1459423067464, 1459423112997, 1459425411045]

		getRequest().setAttribute("requestManager", this);
/t
PartyFormAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 160	
			} else {
				setRequestManager(new RequestManager(getSession(), getRequest(), isFlowControlled()));

			if (myLocale != null) {
				theFormat = (DecimalFormat) NumberFormat.getNumberInstance(myLocale);

			try {
				Map myMap = act();
/s
PartyFormAction.act() line: 30	
/=
package com.mpobjects.invoice.control.party.action;
public class PartyFormAction extends AbstractAction {

		getRequest().setAttribute("financialPartyBinding", true);
		int partySystemId = getSystemIdFromRequest();
/s
PartyFormAction(AbstractAction).getSystemIdFromRequest() line: 590	
			String mySystemString = getRequest().getParameter("systemid");
27085988
/t
public class PartyFormAction extends AbstractAction {
		int partySystemId = getSystemIdFromRequest();
/d
		if (partySystemId != 0) {
			PartyVO party = MpoBeanFactory.getBean(PartyDAO.class).getBySystemId(getSystemIdFromRequest());
			FinancialPartyPartyBinding binding = daoWrapper.getBean().getBinding(party);
			if (binding != null) {
/ NEE
			} else {
				getRequest().setAttribute("financialPartyId", "");
/c
/s
EventTemplatePartyFormInitAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 137	
/=
package com.mpobjects.control.action;
public abstract class AbstractAction extends org.apache.cocoon.acting.AbstractAction implements SessionManager {

			if (getRequest().getAttribute("requestManager") != null) {
/ JA
/ nu wel	, 
				setRequestManager((RequestManager) getRequest().getAttribute("requestManager"));
...
				Map myMap = act();
/s
EventTemplatePartyFormInitAction.act() line: 16	
		addSubmitListener(PartySaveListener.class);
/ TODO
		getRequest().setAttribute("eventTemplates", MpoBeanFactory.getBean(EventTemplateDAO.class).getAll());
/ TODO
		getRequest().setAttribute("eventTemplatesSelected", MpoBeanFactory.getBean(EventTemplateDAO.class).getAllEventTemplates(getSystemIdFromRequest()));
/ TODO

/c
/s
FormTag.doStartTag() line: 242	
		if (StringUtils.isNotEmpty(getDestionationAttribute())) {
form
			getRequest().setAttribute(getDestionationAttribute(), this);

		setSubmitListenerList(new ArrayList<Class<? extends SubmitListener>>(AbstractFormInitAction.getSubmitDefinitionList(getSession())));
[class com.mpobjects.event.eventtemplateparty.control.PartySaveListener]

		if (theForFile.equals("true")) {
/ NEE
			theMethod = "post";
/ NIET	, maar is al post	,
/ TODO

		String returnUrl = (String) getRequest().getAttribute("returnUrl");
		if (StringUtils.isEmpty(returnUrl) == false) {
			myPrintString.append("<input type=\"hidden\"");
			myPrintString.append(" name=\"returnUrl\"");
			myPrintString.append(" id=\"returnUrl\"");
			myPrintString.append(" value=\"" + returnUrl + "\"");
			myPrintString.append("/>");
/ Geef returnUrl door	,
/ TODO (Hoe precies?)
/ De save button heeft geen returnUrl, maar WH via hidden field wordt doorgegeven	,
/ De cancel button heeft ook returnUrl	,
/s
ButtonTag.doStartTag() line: 96	
		RequestManager myRequestManager = (RequestManager) getRequest().getAttribute("requestManager");
/ TODO
		String returnUrl = (String) getRequest().getAttribute("returnUrl");
http://localhost:8080/tms/wicket/?wicket:interface=:3::::
/ set bij (*)
		} else if (TYPE_CANCEL.equals(getType()) && returnUrl != null) {
			myPrint.append("<input type=\"button\" ");
			myPrint.append(" id=\"cancelBtn\"");
			myPrint.append(" value=\"" + (!readOnly ? getLabel("cancel") : getLabel("back")) + "\"");
			myPrint.append(" onclick=\" " + getForm().getJsFormManager() + ".cancelAndRedirect('" + getCancelMessage() + "', '" + returnUrl + "');\"");

/ Als je een form submit	, worden de fields meegegeven	, de default action van een form is GET	, dus WH worden deze fields dan request params, en verschijnen in de url	, maar wij geven de url in de wicket page	, niet via een form, maar een link	,



/ 7	. 

/we zijn nu op (het result van SCS van ) de page	,
http://localhost:8080/tms/oms/party_edit?base_sessionLevelOffset=1&systemid=27085988&systemId=27085988&returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:6::::

/ Interemezzo

$ vi FormTag.java

		myPrintString.append("<script type=\"text/javascript\">\n");
		myPrintString.append("var " + getJsFormManager() + "= new FormManager('" + theName + "');");
		myPrintString.append("var theActiveFormManager=" + getJsFormManager() + ";");
		myPrintString.append("document.theActiveFormManager=theActiveFormManager");
		myPrintString.append("</script>\n");
		myPrintString.append("<input type=\"hidden\"");
		myPrintString.append(" name=\"redirectTo\"");
		myPrintString.append(" id=\"redirectTo\"");
		myPrintString.append(" value=\"" + getRedirectUrl() + "\"");
		myPrintString.append("/>");

		myPrintString.append("<input type=\"hidden\"");
		myPrintString.append(" name=\"doRedirect\"");
		myPrintString.append(" id=\"doRedirect\"");
		myPrintString.append("/>");
		getFieldUtil().appendHiddenField("base_sessionLevelOffset", "0", myPrintString);


	public String getJsFormManager() {
		return "the" + StringUtils.firstCharToUpper(theName) + "FormManager";
	}

	private String getRedirectUrl() {
		String myRedirectTo = "";
		if (getRequest().getAttribute("redirectTo") != null) {
...

/ Dit komt nog allemaal uit het 1ste request	, 
http://localhost:8080/tms/oms/party_edit?base_sessionLevelOffset=1&systemid=27085988&systemId=27085988&returnUrl=http://localhost:8080/tms/wicket/?wicket:interface=:6::::
/ Alle hidden fields in het form (met hun values) komen hieruit of uit de controller	,

/ als we op save Party click, dan onstaat er een nieuw request	, de request params van deze de fields uit het form	, dus ook de hidden fields	,
 

/ Einde Interemezzo

/we zien in HTML	,
			<script type="text/javascript" src="../script/class.formmanager.js"> </script>

var theEditFormFormManager= new FormManager('editForm');var theActiveFormManager=theEditFormFormManager;document.theActiveFormManager=theActiveFormManager</script>

<input type="button" name="saveBtn" id="saveBtn" value="Save" onclick=" theEditFormFormManager.submit('../oms/party_save', false, 0);">
<input type="button" id="saveAndCloseBtn" value="Save and Close" onclick=" theEditFormFormManager.submit('../oms/party_save', true, '-1'); return false;">
<input type="button" id="cancelBtn" value="Cancel" onclick=" theEditFormFormManager.cancelAndRedirect('Loose changes made after last save', 'https://test-pnl.mp-objects.com/pnllogistics/wicket/?wicket:interface=:16::::');">



$ vi oms-sitemap.xmap
			<map:action logger="party" name="partySave" src="com.mpobjects.oms.control.party.action.PartySaveAction"/>
			<map:match pattern="party_save">
				<map:act type="partySave"/>
				<map:redirect-to uri="edit_party?systemid={request-attr:systemid}"/>
			</map:match>

/ Deze redirect wordt overwrite door AbstractSaveAction.afterSave

/ 13	. 

/ We click Save

FormManager.submit (class.formmanager.js:61)
onclick (party_edit?base…/test-pnl…:239)

      document.getElementById("base_sessionLevelOffset").value=aRedirectionLevelOffset;
		document.getElementById("doRedirect").value=aBoolDoRedirect;
/ Zo pak je hidden fields	,



$ vi AbstractSaveAction..java

	protected void afterSave() throws Exception {

		getSession().setAttribute(LIST_MESSAGE_ATTRIBUTE, getSaveMessage());

		if (shouldTakeControl()) {

			String myRedirectUrl = getRequest().getParameter("returnUrl");
http://localhost:8080/tms/wicket/?wicket:interface=:9::::
////////////////////////////////////////////////////
/ dit is het hidden field	,

			if (StringUtils.isEmpty(myRedirectUrl)) {
				myRedirectUrl = getRedirectUrl();
			}

			getRequest().setAttribute("redirectTo", myRedirectUrl);
http://localhost:8080/tms/wicket/?wicket:interface=:9::::
/ TODO

			RedirectSaveAction.redirect(getRedirector(), getRequest(), myRedirectUrl);
/s
RedirectSaveAction.redirect(Redirector, Request, String, int) line: 43	

		for (Enumeration myEnum = aRequest.getParameterNames(); myEnum.hasMoreElements();) {
			myParameterName = (String) myEnum.nextElement();
...
redirectTo
			if (myParameterName.startsWith("base_") && StringUtils.isNotEmpty(aRequest.getParameter(myParameterName))) {
/ NEE

		if (aLevelOffset != 0) {
			myRememberedParamList.add(RequestManager.SESSION_LEVEL_OFFSET + "=" + aLevelOffset);
[base_sessionLevelOffset=0]

		if (myRememberedParamList.size() > 0) {
			String mySeperator;
			if (anUrl.indexOf('?') > 0) {
				mySeperator = "&";

			anUrl += mySeperator + StringUtils.implode(myRememberedParamList.toArray(), "&");
http://localhost:8080/tms/wicket/?wicket:interface=:9::::&base_sessionLevelOffset=0

		aRequest.setAttribute("redirectTo", anUrl);
/ TODO
/ Waarom doen we dit?

		try {
			String myRedirectPage = "../core/generic_save_redirect?redirectTo=" + URLEncoder.encode(anUrl, "UTF-8");

			aRedirector.redirect(true, myRedirectPage);







/ Einde REQUEST PARAMETERS


/ DEBUG PCT-1181

/ we create return voor SH000000186	, en Save	, 

/ We zien in de postgres log	,

LOG:  execute <unnamed>: insert into SHIPMENT_ORDER (IS_TEMPLATE, SHIPMENT_ORDER_ID, ORDER_PROCESS_SYSTEMID, ACT_SERVICE_LEVEL_SYSTEMID, REQ_SERVICE_LEVEL_S
YSTEMID, STATUS_CODE_SYSTEMID, ORGANIZATION_SYSTEMID, INCO_TERM_SYSTEMID, PATH_SYSTEMID, FROM_LOCATION_ID, FROM_NAME, FROM_NAME2, FROM_ADDRESS, FROM_ADDRESS
2, FROM_CITY, FROM_POSTAL_CODE, FROM_REGION_STATE, FROM_COUNTRY_SYSTEMID, FROM_CONTACT_NAME, FROM_EMAIL_ADDRESS, FROM_FAX_NUMBER, FROM_PHONE_NUMBER, FROM_LO
NGITUDE, FROM_LATITUDE, FROM_REFERENCE1, FROM_REFERENCE2, FROM_REFERENCE3, FROM_REFERENCE4, FROM_REFERENCE5, FROM_REFERENCE6, FROM_TIME_ZONE, SYNC_FROM_FLAG
, TO_LOCATION_ID, TO_NAME, TO_NAME2, TO_ADDRESS, TO_ADDRESS2, TO_CITY, TO_POSTAL_CODE, TO_REGION_STATE, TO_COUNTRY_SYSTEMID, TO_CONTACT_NAME, TO_EMAIL_ADDRE
SS, TO_FAX_NUMBER, TO_PHONE_NUMBER, TO_LONGITUDE, TO_LATITUDE, TO_REFERENCE1, TO_REFERENCE2, TO_REFERENCE3, TO_REFERENCE4, TO_REFERENCE5, TO_REFERENCE6, TO_
TIME_ZONE, SYNC_TO_FLAG, LAST_IMPORT, LAST_EXPORT, HOLD_STATUS_SYSTEMID, INVOICE_PARTY_ID, INVOICE_NAME, INVOICE_NAME2, INVOICE_ADDRESS, INVOICE_ADDRESS2, I
NVOICE_CITY, INVOICE_POSTAL_CODE, INVOICE_REGION_STATE, INVOICE_COUNTRY_SYSTEMID, INVOICE_CONTACT_NAME, INVOICE_EMAIL_ADDRESS, INVOICE_FAX_NUMBER, INVOICE_P
HONE_NUMBER, BILLTO_REFERENCE1, BILLTO_REFERENCE2, BILLTO_REFERENCE3, BILLTO_REFERENCE4, BILLTO_REFERENCE5, BILLTO_REFERENCE6, SYNC_BILL_TO_FLAG, EMPLOYEE_P
ARTY_ID, EMPLOYEE_NAME, EMPLOYEE_NAME2, EMPLOYEE_ADDRESS, EMPLOYEE_ADDRESS2, EMPLOYEE_CITY, EMPLOYEE_POSTAL_CODE, EMPLOYEE_REGION_STATE, EMPLOYEE_COUNTRY_SY
STEMID, EMPLOYEE_CONTACT_NAME, EMPLOYEE_EMAIL_ADDRESS, EMPLOYEE_FAX_NUMBER, EMPLOYEE_PHONE_NUMBER, EMPLOYEE_REFERENCE1, EMPLOYEE_REFERENCE2, EMPLOYEE_REFERE
NCE3, EMPLOYEE_REFERENCE4, EMPLOYEE_REFERENCE5, EMPLOYEE_REFERENCE6, SYNC_EMPLOYEE_RESPONSIBLE_FLAG, ACTUAL_ARRIVAL, ACTUAL_DEPARTURE, CLOSE_DATE, ORG_PLANNED_ARRIVAL_AFTER, ORG_PLANNED_ARRIVAL_BEFORE, ORG_PLANNED_DEPARTURE_AFTER, ORG_PLANNED_DEPARTURE_BEFORE, PLANNED_ARRIVAL_AFTER, PLANNED_ARRIVAL_BEFORE, PLANNED_DEPARTURE_AFTER, PLANNED_DEPARTURE_BEFORE, REQUESTED_ARRIVAL_AFTER, REQUESTED_ARRIVAL_BEFORE, REQUESTED_DEPARTURE_AFTER, REQUESTED_DEPARTURE_BEFORE, CREATED_BY_SYSTEMID, ASSIGNEE_SYSTEMID, APPROVEDBY_SYSTEMID, PRECALCULATION_APPROVED_DATE, LOCK_PRECALCULATION, APPROVE_PRECALCULATION, POSTCALC_APPROVEDBY_SYSTEMID, POSTCALCULATION_APPROVED_DATE, LOCK_POSTCALCULATION, APPROVE_POSTCALCULATION, SYSTEM_ENTRY_DATE, LAST_UPDATE, ORIGINAL_SYSTEM_ENTRY_DATE, CUSTOMER_STATUS_SYSTEMID, SHIPMENT_ITEM_LINE_COUNT, TOTAL_NR_OF_ITEMS, TOTAL_WEIGHT_KG, TOTAL_VOLUME_M3, TOTAL_LDM, TOT_VALUE, TOT_VALUE_CURRENCY_SYSTEMID, TOT_VALUE_ALT, TOT_VAL_ALT_CURR_SYSTEMID, SALES_ORGANIZATION, CUSTOMER_ORDER_NUMBER, REASON_CODE_SYSTEMID, REFERENCE1, REFERENCE2, REFERENCE3, REFERENCE4, REFERENCE5, REFERENCE6, REFERENCE7, REFERENCE8, REFERENCE9, REFERENCE10, PREFERED_PARTY_SYSTEMID, REMARKS, REMARKS2, SHIPM_TYPE_SYSTEMID, PRICE_CURRENCY_SYSTEMID, PRICE, BACKUP_SHEET_REPORT_NAME, CASH_ON_DEL, CASH_ON_DEL_CURRENCY_SYSTEMID, CHARGE_TIME_WINDOW_YN, RATECALC_MD5_HASH, DANGEROUS_GOODS_YN, INCO_TERM_REFERENCE, CASH_ON_DEL_DONE, HOLD_STATUS_DESCRIPTION, OVERRIDE_ADDRESS_VALIDATION, NOT_UPDATABLE_BY_INTERFACE, BILL_OF_LADING_NUMBER, RETURN_CREATED, PAY_WEIGHT, IS_TEMPORARY, CO2_EMISSION, CONSOLIDATION_KEY, PORT_SYSTEMID, TEMPLATE_SYSTEMID, IS_DELETED, NOTIFY_TO, RATE_CALC_LOG_SYSTEMID, CUSTOMER_CONTRACT_SYSTEMID, TOT_PRICE_METHOD, TOT_COST, TOT_COST_CURRENCY_SYSTEMID, TOT_COST_METHOD, GCD_CARRIER_CODE, GCD_ACCOUNT_NUMBER, GCD_COMPANY_CODE, GCD_SERVICE_LEVEL, GCD_SERVICE_LEVEL_CODE, GCD_SERVICE_LEVEL_DESCRIPTION, GCD_TRACKING_REFERENCE1, GCD_TRACKING_REFERENCE2, GCD_TRACKING_REFERENCE3, GCD_FROM_ROUTING_CODE1, GCD_FROM_ROUTING_CODE2, GCD_FROM_ROUTING_CODE3, GCD_TO_ROUTING_CODE1, GCD_TO_ROUTING_CODE2, GCD_TO_ROUTING_CODE3, INSTRUCTION_GROUP_SYSTEMID, IS_RECURRING, SCHEDULE_XML, SCHEDULE_DESCRIPTION, LAST_INSTANCE_DATE, AUTHORIZATION_CODES, SCREEN_ID, APPROVAL_STATUS, ACTION_APPROVAL_STATUS, LOCKED_BY_PROCESS, APPROVAL_TEMPLATE, ENTITY_GROUP_SYSTEMID, SYSTEM_ID) values ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39, $40, $41, $42, $43, $44, $45, $46, $47, $48, $49, $50, $51, $52, $53, $54, $55, $56, $57, $58, $59, $60, $61, $62, $63, $64, $65, $66, $67, $68, $69, $70, $71, $72, $73, $74, $75, $76, $77, $78, $79, $80, $81, $82, $83, $84, $85, $86, $87, $88, $89, $90, $91, $92, $93, $94, $95, $96, $97, $98, $99, $100, $101, $102, $103, $104, $105, $106, $107, $108, $109, $110, $111, $112, $113, $114, $115, $116, $117, $118, $119, $120, $121, $122, $123, $124, $125, $126, $127, $128, $129, $130, $131, $132, $133, $134, $135, $136, $137, $138, $139, $140, $141, $142, $143, $144, $145, $146, $147, $148, $149, $150, $151, $152, $153, $154, $155, $156, $157, $158, $159, $160, $161, $162, $163, $164, $165, $166, $167, $168, $169, $170, $171, $172, $173, $174, $175, $176, $177, $178, $179, $180, $181, $182, $183, $184, $185, $186, $187, $188, $189, $190, $191, $192, $193, $194, $195, $196, $197, $198, $199, $200, $201, $202, $203, $204, $205, $206, $207, $208, $209, $210)
DETAIL:  parameters: $1 = 'f', $2 = 'SH000000186copy', $3 = '26681860', $4 = '26681932', $5 = '26681932', $6 = '6', $7 = '500', $8 = '26681475', $9 = NULL, $10 = '', $11 = 'Fisher Emergo B.V.', $12 = '', $13 = 'Postbus', $14 = '4', $15 = 'Landsmeer', $16 = '1120AA', $17 = '', $18 = '4153', $19 = '', $20 = '', $21 = '', $22 = '', $23 = NULL, $24 = NULL, $25 = '', $26 = '', $27 = '', $28 = '', $29 = '', $30 = '', $31 = NULL, $32 = 'D', $33 = '', $34 = 'Elzendaal College', $35 = '', $36 = 'BILDERBEEKSTR', $37 = '27', $38 = 'BOXMEER', $39 = '5831CW', $40 = '', $41 = '4153', $42 = '', $43 = '', $44 = '', $45 = '', $46 = NULL, $47 = NULL, $48 = '', $49 = '', $50 = '', $51 = '', $52 = '', $53 = '', $54 = NULL, $55 = 'D', $56 = NULL, $57 = NULL, $58 = NULL, $59 = '10290301', $60 = '', $61 = '', $62 = '', $63 = '', $64 = '', $65 = '', $66 = '', $67 = NULL, $68 = '', $69 = '', $70 = '', $71 = '', $72 = '', $73 = '', $74 = '', $75 = '', $76 = '', $77 = '', $78 = 'D', $79 = '', $80 = '', $81 = '', $82 = '', $83 = '', $84 = '', $85 = '', $86 = '', $87 = NULL, $88 = '', $89 = '', $90 = '', $91 = '', $92 = '', $93 = '', $94 = '', $95 = '', $96 = '', $97 = '', $98 = 'D', $99 = NULL, $100 = NULL, $101 = NULL, $102 = NULL, $103 = NULL, $104 = NULL, $105 = NULL, $106 = NULL, $107 = NULL, $108 = NULL, $109 = NULL, $110 = '2015-04-20 00:00:00', $111 = '2015-04-21 18:00:00', $112 = '2015-04-17 00:00:00', $113 = '2015-04-20 23:59:00', $114 = '26682479', $115 = NULL, $116 = NULL, $117 = NULL, $118 = 'f', $119 = 'f', $120 = NULL, $121 = NULL, $122 = 'f', $123 = 'f', $124 = '2016-03-29 14:43:30.854', $125 = '2016-03-29 14:43:30.854', $126 = '2016-03-29 14:43:30.854', $127 = '104', $128 = '3.00', $129 = '3.00', $130 = '23.70', $131 = '0.000', $132 = NULL, $133 = '0.00', $134 = NULL, $135 = '0.00', $136 = NULL, $137 = '', $138 = '', $139 = NULL, $140 = '3633', $141 = '578040188921700013105831', $142 = '7328658220893', $143 = '', $144 = '01889217', $145 = '', $146 = '3SEUR02175010', $147 = '', $148 = 'EUR000048409003', $149 = '', $150 = NULL, $151 = '', $152 = '', $153 = '26681890', $154 = NULL, $155 = '0', $156 = '', $157 = NULL, $158 = NULL, $159 = 'f', $160 = '16E736461D8EEABF05A524BE460C8A5AB0619925', $161 = 't', $162 = '', $163 = 'f', $164 = '', $165 = 'f', $166 = 'f', $167 = NULL, $168 = 'f', $169 = NULL, $170 = 'f', $171 = NULL, $172 = NULL, $173 = NULL, $174 = NULL, $175 = 'f', $176 = '', $177 = NULL, $178 = NULL, $179 = 'NONE', $180 = NULL, $181 = NULL, $182 = 'NONE', $183 = NULL, $184 = NULL, $185 = NULL, $186 = NULL, $187 = NULL, $188 = NULL, $189 = NULL, $190 = NULL, $191 = NULL, $192 = NULL, $193 = NULL, $194 = NULL, $195 = NULL, $196 = NULL, $197 = NULL, $198 = NULL, $199 = 'f', $200 = NULL, $201 = NULL, $202 = NULL, $203 = NULL, $204 = NULL, $205 = 'OPEN', $206 = 'OPEN', $207 = 'f', $208 = NULL, $209 = NULL, $210 = '26975496'

/ De system_id=26975496 klopt al	, de shipment_order_id ='SH000000186copy' nog niet	, dit wordt inderdaad eerst gedaan	,

/ Nu wordt de shipment_order_id='SH000000186RT'	,

LOG:  execute <unnamed>: update SHIPMENT_ORDER set IS_TEMPLATE=$1, SHIPMENT_ORDER_ID=$2, ORDER_PROCESS_SYSTEMID=$3, ACT_SERVICE_LEVEL_SYSTEMID=$4, REQ_SERVI
CE_LEVEL_SYSTEMID=$5, STATUS_CODE_SYSTEMID=$6, ORGANIZATION_SYSTEMID=$7, INCO_TERM_SYSTEMID=$8, PATH_SYSTEMID=$9, FROM_LOCATION_ID=$10, FROM_NAME=$11, FROM_
NAME2=$12, FROM_ADDRESS=$13, FROM_ADDRESS2=$14, FROM_CITY=$15, FROM_POSTAL_CODE=$16, FROM_REGION_STATE=$17, FROM_COUNTRY_SYSTEMID=$18, FROM_CONTACT_NAME=$19
, FROM_EMAIL_ADDRESS=$20, FROM_FAX_NUMBER=$21, FROM_PHONE_NUMBER=$22, FROM_LONGITUDE=$23, FROM_LATITUDE=$24, FROM_REFERENCE1=$25, FROM_REFERENCE2=$26, FROM_
REFERENCE3=$27, FROM_REFERENCE4=$28, FROM_REFERENCE5=$29, FROM_REFERENCE6=$30, FROM_TIME_ZONE=$31, SYNC_FROM_FLAG=$32, TO_LOCATION_ID=$33, TO_NAME=$34, TO_N
AME2=$35, TO_ADDRESS=$36, TO_ADDRESS2=$37, TO_CITY=$38, TO_POSTAL_CODE=$39, TO_REGION_STATE=$40, TO_COUNTRY_SYSTEMID=$41, TO_CONTACT_NAME=$42, TO_EMAIL_ADDR
ESS=$43, TO_FAX_NUMBER=$44, TO_PHONE_NUMBER=$45, TO_LONGITUDE=$46, TO_LATITUDE=$47, TO_REFERENCE1=$48, TO_REFERENCE2=$49, TO_REFERENCE3=$50, TO_REFERENCE4=$
51, TO_REFERENCE5=$52, TO_REFERENCE6=$53, TO_TIME_ZONE=$54, SYNC_TO_FLAG=$55, LAST_IMPORT=$56, LAST_EXPORT=$57, HOLD_STATUS_SYSTEMID=$58, INVOICE_PARTY_ID=$
59, INVOICE_NAME=$60, INVOICE_NAME2=$61, INVOICE_ADDRESS=$62, INVOICE_ADDRESS2=$63, INVOICE_CITY=$64, INVOICE_POSTAL_CODE=$65, INVOICE_REGION_STATE=$66, INV
OICE_COUNTRY_SYSTEMID=$67, INVOICE_CONTACT_NAME=$68, INVOICE_EMAIL_ADDRESS=$69, INVOICE_FAX_NUMBER=$70, INVOICE_PHONE_NUMBER=$71, BILLTO_REFERENCE1=$72, BIL
LTO_REFERENCE2=$73, BILLTO_REFERENCE3=$74, BILLTO_REFERENCE4=$75, BILLTO_REFERENCE5=$76, BILLTO_REFERENCE6=$77, SYNC_BILL_TO_FLAG=$78, EMPLOYEE_PARTY_ID=$79
, EMPLOYEE_NAME=$80, EMPLOYEE_NAME2=$81, EMPLOYEE_ADDRESS=$82, EMPLOYEE_ADDRESS2=$83, EMPLOYEE_CITY=$84, EMPLOYEE_POSTAL_CODE=$85, EMPLOYEE_REGION_STATE=$86
, EMPLOYEE_COUNTRY_SYSTEMID=$87, EMPLOYEE_CONTACT_NAME=$88, EMPLOYEE_EMAIL_ADDRESS=$89, EMPLOYEE_FAX_NUMBER=$90, EMPLOYEE_PHONE_NUMBER=$91, EMPLOYEE_REFEREN
CE1=$92, EMPLOYEE_REFERENCE2=$93, EMPLOYEE_REFERENCE3=$94, EMPLOYEE_REFERENCE4=$95, EMPLOYEE_REFERENCE5=$96, EMPLOYEE_REFERENCE6=$97, SYNC_EMPLOYEE_RESPONSI
BLE_FLAG=$98, ACTUAL_ARRIVAL=$99, ACTUAL_DEPARTURE=$100, CLOSE_DATE=$101, ORG_PLANNED_ARRIVAL_AFTER=$102, ORG_PLANNED_ARRIVAL_BEFORE=$103, ORG_PLANNED_DEPAR
TURE_AFTER=$104, ORG_PLANNED_DEPARTURE_BEFORE=$105, PLANNED_ARRIVAL_AFTER=$106, PLANNED_ARRIVAL_BEFORE=$107, PLANNED_DEPARTURE_AFTER=$108, PLANNED_DEPARTURE
_BEFORE=$109, REQUESTED_ARRIVAL_AFTER=$110, REQUESTED_ARRIVAL_BEFORE=$111, REQUESTED_DEPARTURE_AFTER=$112, REQUESTED_DEPARTURE_BEFORE=$113, CREATED_BY_SYSTE
MID=$114, ASSIGNEE_SYSTEMID=$115, APPROVEDBY_SYSTEMID=$116, PRECALCULATION_APPROVED_DATE=$117, LOCK_PRECALCULATION=$118, APPROVE_PRECALCULATION=$119, POSTCA
LC_APPROVEDBY_SYSTEMID=$120, POSTCALCULATION_APPROVED_DATE=$121, LOCK_POSTCALCULATION=$122, APPROVE_POSTCALCULATION=$123, SYSTEM_ENTRY_DATE=$124, LAST_UPDAT
E=$125, ORIGINAL_SYSTEM_ENTRY_DATE=$126, CUSTOMER_STATUS_SYSTEMID=$127, SHIPMENT_ITEM_LINE_COUNT=$128, TOTAL_NR_OF_ITEMS=$129, TOTAL_WEIGHT_KG=$130, TOTAL_V
OLUME_M3=$131, TOTAL_LDM=$132, TOT_VALUE=$133, TOT_VALUE_CURRENCY_SYSTEMID=$134, TOT_VALUE_ALT=$135, TOT_VAL_ALT_CURR_SYSTEMID=$136, SALES_ORGANIZATION=$137
, CUSTOMER_ORDER_NUMBER=$138, REASON_CODE_SYSTEMID=$139, REFERENCE1=$140, REFERENCE2=$141, REFERENCE3=$142, REFERENCE4=$143, REFERENCE5=$144, REFERENCE6=$14
5, REFERENCE7=$146, REFERENCE8=$147, REFERENCE9=$148, REFERENCE10=$149, PREFERED_PARTY_SYSTEMID=$150, REMARKS=$151, REMARKS2=$152, SHIPM_TYPE_SYSTEMID=$153,
 PRICE_CURRENCY_SYSTEMID=$154, PRICE=$155, BACKUP_SHEET_REPORT_NAME=$156, CASH_ON_DEL=$157, CASH_ON_DEL_CURRENCY_SYSTEMID=$158, CHARGE_TIME_WINDOW_YN=$159, 
RATECALC_MD5_HASH=$160, DANGEROUS_GOODS_YN=$161, INCO_TERM_REFERENCE=$162, CASH_ON_DEL_DONE=$163, HOLD_STATUS_DESCRIPTION=$164, OVERRIDE_ADDRESS_VALIDATION=
$165, NOT_UPDATABLE_BY_INTERFACE=$166, BILL_OF_LADING_NUMBER=$167, RETURN_CREATED=$168, PAY_WEIGHT=$169, IS_TEMPORARY=$170, CO2_EMISSION=$171, CONSOLIDATION
_KEY=$172, PORT_SYSTEMID=$173, TEMPLATE_SYSTEMID=$174, IS_DELETED=$175, NOTIFY_TO=$176, RATE_CALC_LOG_SYSTEMID=$177, CUSTOMER_CONTRACT_SYSTEMID=$178, TOT_PR
ICE_METHOD=$179, TOT_COST=$180, TOT_COST_CURRENCY_SYSTEMID=$181, TOT_COST_METHOD=$182, GCD_CARRIER_CODE=$183, GCD_ACCOUNT_NUMBER=$184, GCD_COMPANY_CODE=$185
, GCD_SERVICE_LEVEL=$186, GCD_SERVICE_LEVEL_CODE=$187, GCD_SERVICE_LEVEL_DESCRIPTION=$188, GCD_TRACKING_REFERENCE1=$189, GCD_TRACKING_REFERENCE2=$190, GCD_T
RACKING_REFERENCE3=$191, GCD_FROM_ROUTING_CODE1=$192, GCD_FROM_ROUTING_CODE2=$193, GCD_FROM_ROUTING_CODE3=$194, GCD_TO_ROUTING_CODE1=$195, GCD_TO_ROUTING_CO
DE2=$196, GCD_TO_ROUTING_CODE3=$197, INSTRUCTION_GROUP_SYSTEMID=$198, IS_RECURRING=$199, SCHEDULE_XML=$200, SCHEDULE_DESCRIPTION=$201, LAST_INSTANCE_DATE=$202, AUTHORIZATION_CODES=$203, SCREEN_ID=$204, APPROVAL_STATUS=$205, ACTION_APPROVAL_STATUS=$206, LOCKED_BY_PROCESS=$207, APPROVAL_TEMPLATE=$208, ENTITY_GROUP_SYSTEMID=$209 where SYSTEM_ID=$210

DETAIL:  parameters: $1 = 'f', $2 = 'SH000000186RT', $3 = '26681816', $4 = '26766280', $5 = '26681932', $6 = '6', $7 = '500', $8 = '26681475', $9 = NULL, $10 = '', $11 = 'Elzendaal College', $12 = '', $13 = 'BILDERBEEKSTR', $14 = '27', $15 = 'BOXMEER', $16 = '5831CW', $17 = '', $18 = '4153', $19 = '', $20 = '', $21 = '', $22 = '', $23 = NULL, $24 = NULL, $25 = '', $26 = '', $27 = '', $28 = '', $29 = '', $30 = '', $31 = NULL, $32 = 'D', $33 = '', $34 = 'Fisher Emergo B.V.', $35 = '', $36 = 'Postbus', $37 = '4', $38 = 'Landsmeer', $39 = '1120AA', $40 = '', $41 = '4153', $42 = '', $43 = '', $44 = '', $45 = '', $46 = NULL, $47 = NULL, $48 = '', $49 = '', $50 = '', $51 = '', $52 = '', $53 = '', $54 = NULL, $55 = 'D', $56 = NULL, $57 = NULL, $58 = NULL, $59 = '10290301', $60 = '', $61 = '', $62 = '', $63 = '', $64 = '', $65 = '', $66 = '', $67 = NULL, $68 = '', $69 = '', $70 = '', $71 = '', $72 = '', $73 = '', $74 = '', $75 = '', $76 = '', $77 = '', $78 = 'D', $79 = '', $80 = '', $81 = '', $82 = '', $83 = '', $84 = '', $85 = '', $86 = '', $87 = NULL, $88 = '', $89 = '', $90 = '', $91 = '', $92 = '', $93 = '', $94 = '', $95 = '', $96 = '', $97 = '', $98 = 'D', $99 = NULL, $100 = NULL, $101 = NULL, $102 = NULL, $103 = NULL, $104 = NULL, $105 = NULL, $106 = NULL, $107 = NULL, $108 = NULL, $109 = NULL, $110 = NULL, $111 = NULL, $112 = '2015-04-17 00:00:00', $113 = '2015-04-20 23:59:00', $114 = '26682479', $115 = NULL, $116 = NULL, $117 = NULL, $118 = 'f', $119 = 'f', $120 = NULL, $121 = NULL, $122 = 'f', $123 = 'f', $124 = '2016-03-29 14:47:13.64', $125 = '2016-03-29 14:54:50.748', $126 = '2016-03-29 14:43:30.854', $127 = '104', $128 = '3.00', $129 = '3.00', $130 = '17.60', $131 = '0.000', $132 = NULL, $133 = '0.00', $134 = NULL, $135 = '0.00', $136 = NULL, $137 = '', $138 = '', $139 = NULL, $140 = '3633', $141 = '578040188921700013105831', $142 = '7328658220893', $143 = '', $144 = '01889217', $145 = '', $146 = '3SEUR02175010', $147 = '', $148 = 'EUR000048409003', $149 = '', $150 = NULL, $151 = '', $152 = '', $153 = '26681890', $154 = NULL, $155 = NULL, $156 = '', $157 = NULL, $158 = NULL, $159 = 'f', $160 = 'CFBC58C60B33C4DEFD49C24A213F1716879E4DCC', $161 = 't', $162 = '', $163 = 'f', $164 = '', $165 = 'f', $166 = 'f', $167 = NULL, $168 = 'f', $169 = NULL, $170 = 'f', $171 = NULL, $172 = NULL, $173 = NULL, $174 = NULL, $175 = 'f', $176 = '', $177 = NULL, $178 = NULL, $179 = 'NONE', $180 = NULL, $181 = NULL, $182 = 'NONE', $183 = NULL, $184 = NULL, $185 = NULL, $186 = NULL, $187 = NULL, $188 = NULL, $189 = NULL, $190 = NULL, $191 = NULL, $192 = NULL, $193 = NULL, $194 = NULL, $195 = NULL, $196 = NULL, $197 = NULL, $198 = NULL, $199 = 'f', $200 = NULL, $201 = NULL, $202 = NULL, $203 = NULL, $204 = NULL, $205 = 'OPEN', $206 = 'OPEN', $207 = 'f', $208 = NULL, $209 = NULL, $210 = '26975496'

/ 7	. 

/ Als we de return sho create	, en dan Save	, wordt hij ingeplanned	, we zien sa's 	, 



/ DEBUG Einde PCT-1181


/ DEBUG PCT-1181

/ we zijn in	, en het duurt heel lang	,
RateCalcEventListener.handleEvent(Event) line: 79	
->>				recalcServiceOrderCost(anEvent);

->				recalcShipOrderPrice(anEvent);

/ We vallen bij ->	, 
/ Maar andere threads vallen bij ->>

/ Geef
$ jstack <pid java vm -c pnllogistics>

/ Zoek op RateCalcEventListener.java:79	,

/ ->>
	at com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:72)

"internaljms.com.mpobjects.oms.service.serviceorder.RecurringServiceOrderHandler-5" prio=10 tid=0x00007fe13402d800 nid=0x1a71 at breakpoint[0x00007fe0fe9e6000]
   java.lang.Thread.State: RUNNABLE
->>	at com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:72)
	at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderServiceImpl.java:1905)
	at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.createServiceOrder(ServiceOrderServiceImpl.java:526)
	at com.mpobjects.oms.service.serviceorder.RecurringServiceOrderServiceImpl.createInstance(RecurringServiceOrderServiceImpl.java:192)
	at com.mpobjects.oms.service.serviceorder.RecurringServiceOrderServiceImpl.createOrders(RecurringServiceOrderServiceImpl.java:229)
	at com.mpobjects.oms.service.serviceorder.RecurringServiceOrderServiceImpl.handleRecurringServiceOrders(RecurringServiceOrderServiceImpl.java:92)
	at com.mpobjects.oms.service.serviceorder.RecurringServiceOrderHandlerImpl.processMessageAsRoot(RecurringServiceOrderHandlerImpl.java:28)
	at com.mpobjects.oms.jms.AbstractConsumer.onMessage(AbstractConsumer.java:49)
	at com.sun.proxy.$Proxy324.onMessage(Unknown Source)
/ TODO
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:569)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:507)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:474)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:263)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1103)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1095)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:992)
	at java.lang.Thread.run(Thread.java:745)

/ ->

"http-0.0.0.0-8080-4" daemon prio=10 tid=0x00007fe16c2ca800 nid=0x1997 runnable [0x00007fe0fd0c8000]
   java.lang.Thread.State: RUNNABLE
	at sun.reflect.Reflection.quickCheckMemberAccess(Reflection.java:95)
	at java.lang.reflect.Method.invoke(Method.java:593)
	at org.hibernate.property.BasicPropertyAccessor$BasicGetter.get(BasicPropertyAccessor.java:172)
	at org.hibernate.tuple.entity.AbstractEntityTuplizer.getPropertyValues(AbstractEntityTuplizer.java:482)
	at org.hibernate.tuple.entity.PojoEntityTuplizer.getPropertyValues(PojoEntityTuplizer.java:241)
	at org.hibernate.persister.entity.AbstractEntityPersister.getPropertyValues(AbstractEntityPersister.java:3858)
	at org.hibernate.event.def.DefaultFlushEntityEventListener.getValues(DefaultFlushEntityEventListener.java:193)
	at org.hibernate.event.def.DefaultFlushEntityEventListener.onFlushEntity(DefaultFlushEntityEventListener.java:147)
	at org.hibernate.event.def.AbstractFlushingEventListener.flushEntities(AbstractFlushingEventListener.java:219)
	at org.hibernate.event.def.AbstractFlushingEventListener.flushEverythingToExecutions(AbstractFlushingEventListener.java:99)
	at org.hibernate.event.def.DefaultAutoFlushEventListener.onAutoFlush(DefaultAutoFlushEventListener.java:58)
	at org.hibernate.impl.SessionImpl.autoFlushIfRequired(SessionImpl.java:1185)
	at org.hibernate.impl.SessionImpl.list(SessionImpl.java:1709)
	at org.hibernate.impl.CriteriaImpl.list(CriteriaImpl.java:347)
	at org.springframework.orm.hibernate3.HibernateTemplate$36.doInHibernate(HibernateTemplate.java:1057)
	at org.springframework.orm.hibernate3.HibernateTemplate$36.doInHibernate(HibernateTemplate.java:1047)
	at org.springframework.orm.hibernate3.HibernateTemplate.doExecute(HibernateTemplate.java:407)
	at org.springframework.orm.hibernate3.HibernateTemplate.executeWithNativeSession(HibernateTemplate.java:375)
	at org.springframework.orm.hibernate3.HibernateTemplate.findByCriteria(HibernateTemplate.java:1047)
	at org.springframework.orm.hibernate3.HibernateTemplate.findByCriteria(HibernateTemplate.java:1040)
	at com.mpobjects.util.dao.GenericHibernateDAO.findByCriteria(GenericHibernateDAO.java:212)
	at com.mpobjects.oms.dao.PartyDAOImpl.getPartyByPartyIdAndOrganization(PartyDAOImpl.java:209)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)
	at org.springframework.aop.framework.adapter.MethodBeforeAdviceInterceptor.invoke(MethodBeforeAdviceInterceptor.java:51)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:161)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:96)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:260)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:91)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
	at com.sun.proxy.$Proxy132.getPartyByPartyIdAndOrganization(Unknown Source)
	at com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO.getPartyMasterDataByGroup(ShipmentOrderVO.java:1251)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.hibernate.proxy.pojo.javassist.JavassistLazyInitializer.invoke(JavassistLazyInitializer.java:197)
	at com.mpobjects.oms.model.shipmentorder.vo.ShipmentOrderVO_$$_javassist_143.getPartyMasterDataByGroup(ShipmentOrderVO_$$_javassist_143.java)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.apache.commons.jxpath.util.ValueUtils.getValue(ValueUtils.java:367)
	at org.apache.commons.jxpath.ri.model.beans.BeanPropertyPointer.getBaseValue(BeanPropertyPointer.java:120)
	at org.apache.commons.jxpath.ri.model.beans.BeanPropertyPointer.isCollection(BeanPropertyPointer.java:186)
	at org.apache.commons.jxpath.ri.axes.SimplePathInterpreter.doStepNoPredicatesPropertyOwner(SimplePathInterpreter.java:216)
	at org.apache.commons.jxpath.ri.axes.SimplePathInterpreter.doStep(SimplePathInterpreter.java:154)
	at org.apache.commons.jxpath.ri.axes.SimplePathInterpreter.interpretSimpleLocationPath(SimplePathInterpreter.java:81)
	at org.apache.commons.jxpath.ri.compiler.Path.getSingleNodePointerForSteps(Path.java:171)
	at org.apache.commons.jxpath.ri.compiler.LocationPath.computeValue(LocationPath.java:87)
	at org.apache.commons.jxpath.ri.compiler.CoreFunction.functionNot(CoreFunction.java:738)
	at org.apache.commons.jxpath.ri.compiler.CoreFunction.computeValue(CoreFunction.java:283)
	at org.apache.commons.jxpath.ri.JXPathContextReferenceImpl.getValue(JXPathContextReferenceImpl.java:353)
	at org.apache.commons.jxpath.ri.JXPathContextReferenceImpl.getValue(JXPathContextReferenceImpl.java:313)
	at com.mpobjects.oms.ratecalc.model.orderdetail.vo.OrderDetail.retrieveValueFromOrder(OrderDetail.java:178)
	at com.mpobjects.oms.ratecalc.model.rateagreement.vo.RateAgreementVO.getOrderDetailValues(RateAgreementVO.java:228)
	at com.mpobjects.oms.ratecalc.model.ratecalculation.RateCalcHashCalculator.calculate(RateCalcHashCalculator.java:35)
	at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.rateCalculationRequired(RateCalculationVO.java:746)
	at com.mpobjects.oms.ratecalc.model.service.CalculationServiceImpl.recalculate(CalculationServiceImpl.java:572)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:96)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:260)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
	at com.sun.proxy.$Proxy247.recalculate(Unknown Source)
	at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalculate(RateCalcEventListener.java:396)
	at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalcShipOrderPrice(RateCalcEventListener.java:98)
->	at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.handleEvent(RateCalcEventListener.java:79)
	at com.mpobjects.oms.model.eventhandler.util.ListenerList.fireEvent(ListenerList.java:82)
	at com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:109)
	at com.mpobjects.oms.model.service.ShipmentOrderServiceImpl.triggerEventHandler(ShipmentOrderServiceImpl.java:2637)
	at com.mpobjects.oms.model.service.ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderServiceImpl.java:2084)
	at com.mpobjects.oms.model.service.ShipmentOrderServiceImpl.updateShipmentOrder(ShipmentOrderServiceImpl.java:2014)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:96)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:260)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
	at com.sun.proxy.$Proxy248.updateShipmentOrder(Unknown Source)
	at com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderSaveAction.handleSave(ShipmentOrderSaveAction.java:102)
	at com.mpobjects.oms.ratecalc.control.shipmentorder.action.ShipmentOrderSaveAction.handleSave(ShipmentOrderSaveAction.java:19)
	at com.mpobjects.control.action.AbstractSaveAction.act(AbstractSaveAction.java:69)
	at com.mpobjects.control.action.AbstractAction.act(AbstractAction.java:171)
	at org.apache.cocoon.components.treeprocessor.sitemap.ActTypeNode.invoke(ActTypeNode.java:125)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:47)
	at org.apache.cocoon.components.treeprocessor.sitemap.MatchNode.invoke(MatchNode.java:108)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177)
	at org.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:253)
	at org.apache.cocoon.components.treeprocessor.sitemap.MountNode.invoke(MountNode.java:118)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:47)
	at org.apache.cocoon.components.treeprocessor.sitemap.MatchNode.invoke(MatchNode.java:108)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177)
	at org.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:253)
	at org.apache.cocoon.components.treeprocessor.sitemap.MountNode.invoke(MountNode.java:118)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143)
	at org.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)
	at org.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235)
	at org.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177)
	at org.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:253)
	at org.apache.cocoon.Cocoon.process(Cocoon.java:699)
	at org.apache.cocoon.servlet.CocoonServlet.service(CocoonServlet.java:1154)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:810)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at com.mpobjects.control.filter.FirstLoginFilter.doFilter(FirstLoginFilter.java:76)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:330)
	at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:118)
	at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:84)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:113)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:103)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:113)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:154)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:45)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:199)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:110)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at com.mpobjects.auth.springsec.RunAsLogoutFilter.doFilter(RunAsLogoutFilter.java:41)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.context.SecurityContextPersistenceFilter.doFilter(SecurityContextPersistenceFilter.java:87)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:192)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:160)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:343)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:260)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at filters.SetCharacterEncodingFilter.doFilter(SetCharacterEncodingFilter.java:111)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:230)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:106)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at org.jboss.web.tomcat.filters.ReplyHeaderFilter.doFilter(ReplyHeaderFilter.java:96)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)
	at org.apache.catalina.core.StandardContextValve.__invoke(StandardContextValve.java:178)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java)
	at org.jboss.web.tomcat.security.SecurityAssociationValve.invoke(SecurityAssociationValve.java:175)
	at org.jboss.web.tomcat.security.JaccContextValve.invoke(JaccContextValve.java:74)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)
	at org.jboss.web.tomcat.tc5.jca.CachedConnectionValve.invoke(CachedConnectionValve.java:156)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)
	at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)
	at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)
	at org.apache.tomcat.util.net.MasterSlaveWorkerThread.run(MasterSlaveWorkerThread.java:112)
	at java.lang.Thread.run(Thread.java:745)

"internaljms.com.mpobjects.oms.service.serviceorder.RecurringServiceOrderHandler-3" prio=10 tid=0x00007fe160013000 nid=0x194e at breakpoint[0x00007fe104ac7000]
   java.lang.Thread.State: RUNNABLE
	at com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:72)
	at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderServiceImpl.java:1905)
	at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.createServiceOrder(ServiceOrderServiceImpl.java:526)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:96)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:260)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
	at com.sun.proxy.$Proxy262.createServiceOrder(Unknown Source)
	at com.mpobjects.oms.service.serviceorder.RecurringServiceOrderServiceImpl.createInstance(RecurringServiceOrderServiceImpl.java:192)
	at com.mpobjects.oms.service.serviceorder.RecurringServiceOrderServiceImpl.createOrders(RecurringServiceOrderServiceImpl.java:229)
	at com.mpobjects.oms.service.serviceorder.RecurringServiceOrderServiceImpl.handleRecurringServiceOrders(RecurringServiceOrderServiceImpl.java:92)
	at sun.reflect.GeneratedMethodAccessor1026.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:96)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:260)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
	at com.sun.proxy.$Proxy323.handleRecurringServiceOrders(Unknown Source)
	at com.mpobjects.oms.service.serviceorder.RecurringServiceOrderHandlerImpl.processMessageAsRoot(RecurringServiceOrderHandlerImpl.java:28)
	at com.mpobjects.oms.jms.AbstractConsumer.onMessage(AbstractConsumer.java:49)
	at sun.reflect.GeneratedMethodAccessor1023.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:96)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:260)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
	at com.sun.proxy.$Proxy324.onMessage(Unknown Source)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:569)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:507)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:474)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:263)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1103)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1095)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:992)
	at java.lang.Thread.run(Thread.java:745)

	at java.lang.Thread.run(Thread.java:745)

"internaljms.com.mpobjects.oms.service.serviceorder.RecurringServiceOrderHandler-1" prio=10 tid=0x00007fe1137eb800 nid=0x192a at breakpoint[0x00007fe106ee7000]
   java.lang.Thread.State: RUNNABLE
	at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.handleEvent(RateCalcEventListener.java:67)
	at com.mpobjects.oms.model.eventhandler.util.ListenerList.fireEvent(ListenerList.java:82)
	at com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:109)
	at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderServiceImpl.java:1905)
	at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.updateServiceOrder(ServiceOrderServiceImpl.java:1561)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:96)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:260)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
	at com.sun.proxy.$Proxy262.updateServiceOrder(Unknown Source)
	at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.recalculateCostsForServiceOrder(ServiceOrderCostServiceImpl.java:202)
	at com.mpobjects.oms.model.serviceordercost.service.ServiceOrderCostServiceImpl.saveServiceOrderCost(ServiceOrderCostServiceImpl.java:234)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:96)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:260)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
	at com.sun.proxy.$Proxy261.saveServiceOrderCost(Unknown Source)
	at com.mpobjects.ratecalc.service.ServiceOrderCalculationServiceImpl.updateServiceOrderCostPartList(ServiceOrderCalculationServiceImpl.java:329)
	at com.mpobjects.ratecalc.service.ServiceOrderCalculationServiceImpl.update(ServiceOrderCalculationServiceImpl.java:119)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:96)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:260)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
	at com.sun.proxy.$Proxy449.update(Unknown Source)
	at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.applyCorrections(RateCalculationVO.java:1009)
	at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.runFor(RateCalculationVO.java:1226)
	at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.calculateWithoutVariables(RateCalculationVO.java:1370)
	at com.mpobjects.oms.ratecalc.model.ratecalculation.vo.RateCalculationVO.runFor(RateCalculationVO.java:784)
	at com.mpobjects.oms.ratecalc.model.service.CalculationServiceImpl.recalculate(CalculationServiceImpl.java:585)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:96)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:260)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
	at com.sun.proxy.$Proxy247.recalculate(Unknown Source)
	at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalculate(RateCalcEventListener.java:332)
	at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.recalcServiceOrderCost(RateCalcEventListener.java:234)
	at com.mpobjects.oms.ratecalc.model.eventhandler.util.RateCalcEventListener.handleEvent(RateCalcEventListener.java:72)
	at com.mpobjects.oms.model.eventhandler.util.ListenerList.fireEvent(ListenerList.java:82)
	at com.mpobjects.oms.service.event.EventHandlerServiceImpl.handleEvent(EventHandlerServiceImpl.java:109)
	at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.triggerEventHandler(ServiceOrderServiceImpl.java:1905)
	at com.mpobjects.oms.model.service.ServiceOrderServiceImpl.createServiceOrder(ServiceOrderServiceImpl.java:526)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:96)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:260)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
	at com.sun.proxy.$Proxy262.createServiceOrder(Unknown Source)
	at com.mpobjects.oms.service.serviceorder.RecurringServiceOrderServiceImpl.createInstance(RecurringServiceOrderServiceImpl.java:192)
	at com.mpobjects.oms.service.serviceorder.RecurringServiceOrderServiceImpl.createOrders(RecurringServiceOrderServiceImpl.java:229)
	at com.mpobjects.oms.service.serviceorder.RecurringServiceOrderServiceImpl.handleRecurringServiceOrders(RecurringServiceOrderServiceImpl.java:92)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:96)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:260)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
	at com.sun.proxy.$Proxy323.handleRecurringServiceOrders(Unknown Source)
	at com.mpobjects.oms.service.serviceorder.RecurringServiceOrderHandlerImpl.processMessageAsRoot(RecurringServiceOrderHandlerImpl.java:28)
	at com.mpobjects.oms.jms.AbstractConsumer.onMessage(AbstractConsumer.java:49)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:317)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:183)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:96)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:260)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:94)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:172)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)
	at com.sun.proxy.$Proxy324.onMessage(Unknown Source)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:569)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:507)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:474)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:325)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:263)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1103)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1095)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:992)
	at java.lang.Thread.run(Thread.java:745)



/ 7	. 

/ Kijk welke queries postgres aan het doen is	,

pnllogistics6a=# SELECT query FROM pg_stat_activity;

/ 7	. 

/ Als shipment item delete action	, 
	ShipmentItemDeleteAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	

/ gaat hij toch weer sho save	,
/ TODO

/ Maar we komen in socket read	?
/ TODO

/s
Daemon Thread [http-0.0.0.0-8080-2] (Suspended)	
	owns: QueryExecutorImpl  (id=22921)	
	SocketInputStream.socketRead0(FileDescriptor, byte[], int, int, int) line: not available [native method]	
	SocketInputStream.read(byte[], int, int, int) line: 152	
	SocketInputStream.read(byte[], int, int) line: 122	
	VisibleBufferedInputStream.readMore(int) line: 143	
	VisibleBufferedInputStream.ensureBytes(int) line: 112	
	VisibleBufferedInputStream.read() line: 71	
	PGStream.ReceiveChar() line: 282	
	QueryExecutorImpl.processResults(ResultHandler, int) line: 1803	
	QueryExecutorImpl.execute(Query, ParameterList, ResultHandler, int, int, int) line: 255	
	Jdbc4PreparedStatement(AbstractJdbc2Statement).execute(Query, ParameterList, int) line: 570	
	Jdbc4PreparedStatement(AbstractJdbc2Statement).executeWithFlags(int) line: 420	
	Jdbc4PreparedStatement(AbstractJdbc2Statement).executeQuery() line: 305	
	GeneratedMethodAccessor110.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AbstractJdbc23PooledConnection$StatementHandler.invoke(Object, Method, Object[]) line: 453	
	$Proxy526.executeQuery() line: not available	
	WrappedPreparedStatement.executeQuery() line: 236	
	BatchingBatcher(AbstractBatcher).getResultSet(PreparedStatement) line: 208	
	CriteriaLoader(Loader).getResultSet(PreparedStatement, boolean, boolean, RowSelection, SessionImplementor) line: 1953	
	CriteriaLoader(Loader).doQuery(SessionImplementor, QueryParameters, boolean) line: 802	
	CriteriaLoader(Loader).doQueryAndInitializeNonLazyCollections(SessionImplementor, QueryParameters, boolean) line: 274	
	CriteriaLoader(Loader).doList(SessionImplementor, QueryParameters) line: 2542	
	CriteriaLoader(Loader).listIgnoreQueryCache(SessionImplementor, QueryParameters) line: 2276	
	CriteriaLoader(Loader).list(SessionImplementor, QueryParameters, Set, Type[]) line: 2271	
	CriteriaLoader.list(SessionImplementor) line: 119	
	SessionImpl.list(CriteriaImpl) line: 1716	
	CriteriaImpl.list() line: 347	
	HibernateTemplate$36.doInHibernate(Session) line: 1057	
	HibernateTemplate$36.doInHibernate(Session) line: 1047	
	HibernateTemplate.doExecute(HibernateCallback<T>, boolean, boolean) line: 407	
	HibernateTemplate.executeWithNativeSession(HibernateCallback<T>) line: 375	
	HibernateTemplate.findByCriteria(DetachedCriteria, int, int) line: 1047	
	HibernateTemplate.findByCriteria(DetachedCriteria) line: 1040	
	PartyDAOImpl(GenericHibernateDAO).findByCriteria(DetachedCriteria) line: 212	
	PartyDAOImpl.getPartyByPartyId(String) line: 196	
	GeneratedMethodAccessor1607.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	MethodBeforeAdviceInterceptor.invoke(MethodInvocation) line: 51	
	ReflectiveMethodInvocation.proceed() line: 161	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	ExposeInvocationInterceptor.invoke(MethodInvocation) line: 91	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy132.getPartyByPartyId(String) line: not available	
	ShipmentOrderVO.getPartyByPartyId(String) line: 1242	
	ShipmentOrderVO.getPartyMasterDataByGroup() line: 1247	
	GeneratedMethodAccessor1807.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	ValueUtils.getValue(Object, PropertyDescriptor) line: 367	
	BeanPropertyPointer.getBaseValue() line: 120	
	BeanPropertyPointer.getImmediateNode() line: 149	
	BeanPropertyPointer(PropertyPointer).getImmediateValuePointer() line: 161	
	BeanPropertyPointer(NodePointer).getValuePointer() line: 297	
	SimplePathInterpreter.valuePointer(NodePointer) line: 794	
	SimplePathInterpreter.doPredicateName(EvalContext, NodePointer, Step[], int, Expression[], int) line: 496	
	SimplePathInterpreter.doPredicate(EvalContext, NodePointer, Step[], int, Expression[], int) line: 462	
	SimplePathInterpreter.doStepPredicatesPropertyOwner(EvalContext, PropertyOwnerPointer, Step[], int) line: 323	
	SimplePathInterpreter.doStep(EvalContext, NodePointer, Step[], int) line: 160	
	SimplePathInterpreter.doStepNoPredicatesPropertyOwner(EvalContext, PropertyOwnerPointer, Step[], int) line: 244	
	SimplePathInterpreter.doStep(EvalContext, NodePointer, Step[], int) line: 154	
	SimplePathInterpreter.interpretSimpleLocationPath(EvalContext, NodePointer, Step[]) line: 81	
	LocationPath(Path).getSingleNodePointerForSteps(EvalContext) line: 171	
	LocationPath.computeValue(EvalContext) line: 87	
	JXPathContextReferenceImpl.getValue(String, Expression) line: 353	
	JXPathContextReferenceImpl.getValue(String) line: 313	
	OrderDetail.retrieveValue(Object) line: 166	
	RateCalculationVO.evaluate(OrderDetail) line: 411	
	RTableSelCriterion.evaluate(RateCalculationVO) line: 99	
	RateTableVO.meetsTableSelectionCriteria(RateCalculationVO) line: 967	
	RateTableFunction.shouldCalculate(RateCalculationVO) line: 375	
	RateCalculationVO.shouldCalculate(RateParameterVO) line: 941	
	RateParameterVO.calculate(RateCalculationVO) line: 75	
	InputParameterVO.calculate(RateCalculationVO) line: 108	
	RateParameterVO.calculate(RateCalculationVO) line: 153	
	CostComponentSpecificationVO.run(RateCalculationVO) line: 205	
	RateCalculationVO.runFor(RateAgreementVO, RateCalculationAlternative) line: 1129	
	RateCalculationVO.calculateWithoutVariables() line: 1370	
	RateCalculationVO.runFor(List<RateAgreementVO>) line: 784	
	CalculationServiceImpl.recalculate(LogisticsOrderVO, AgreementType, TMSEventContext) line: 585	
	GeneratedMethodAccessor1171.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy247.recalculate(LogisticsOrderVO, AgreementType, TMSEventContext) line: not available	
	RateCalcEventListener.recalculate(ShipmentOrderVO, AgreementType, TMSEventContext) line: 396	
	RateCalcEventListener.recalcShipOrderPrice(Event) line: 98	
	RateCalcEventListener.handleEvent(Event) line: 79	
	ListenerList.fireEvent(Event<?>) line: 82	
	EventHandlerServiceImpl.handleEvent(Event) line: 109	
	PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).triggerEventHandler(ShipmentOrderVO, ShipmentOrderVO, TMSEventContext) line: 2637	
	PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).updateShipmentOrder(ShipmentOrderVO, TMSEventContext, boolean) line: 2084	
	PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).updateShipmentOrder(ShipmentOrderVO, boolean) line: 1985	
	PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).recalculateShipmentOrder(ShipmentOrderVO, boolean) line: 1307	
	PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).recalculateShipmentOrder(ShipmentOrderVO) line: 1296	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy248.recalculateShipmentOrder(ShipmentOrderVO) line: not available	
	ShipmentItemServiceImpl(ShipmentOrderChildService).recalculateShipmentOrder(ShipmentOrderVO) line: 20	
	ShipmentItemServiceImpl.delete(ShipmentItemVO, boolean) line: 150	
	ShipmentItemServiceImpl.delete(ShipmentItemVO) line: 142	
	ShipmentItemServiceImpl.delete(int) line: 137	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	MethodInvocationProceedingJoinPoint.proceed() line: 80	
	PerformanceMeasurementAspect.measurePerformance(ProceedingJoinPoint) line: 56	
	GeneratedMethodAccessor91.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AspectJAroundAdvice(AbstractAspectJAdvice).invokeAdviceMethodWithGivenArgs(Object[]) line: 621	
	AspectJAroundAdvice(AbstractAspectJAdvice).invokeAdviceMethod(JoinPoint, JoinPointMatch, Object, Throwable) line: 610	
	AspectJAroundAdvice.invoke(MethodInvocation) line: 65	
	ReflectiveMethodInvocation.proceed() line: 172	
	ExposeInvocationInterceptor.invoke(MethodInvocation) line: 91	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy251.delete(int) line: not available	
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 317	
	ReflectiveMethodInvocation.invokeJoinpoint() line: 183	
	ReflectiveMethodInvocation.proceed() line: 150	
	TransactionInterceptor$1.proceedWithInvocation() line: 96	
	TransactionInterceptor(TransactionAspectSupport).invokeWithinTransaction(Method, Class, TransactionAspectSupport$InvocationCallback) line: 260	
	TransactionInterceptor.invoke(MethodInvocation) line: 94	
	ReflectiveMethodInvocation.proceed() line: 172	
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 204	
	$Proxy251.delete(int) line: not available	
	ShipmentItemDeleteAction.act() line: 26	
	ShipmentItemDeleteAction(AbstractAction).act(Redirector, SourceResolver, Map, String, Parameters) line: 171	








/ Einde DEBUG PCT-1181

/ DEBUG CREATE RETURN

/ 7	. 

$ vi shipment-order_edit.jsp

				<input type="button" value="<mpo:label name="Create return"/>"
					onclick="document.location.href='../oms/shipment-order_create-return?shipmentorder_systemid=${formVO.systemId}&amp;base_sessionLevelOffset=1';" />

$ vi oms-sitemap.xmap
			<map:match pattern="shipment-order_create-return">
				<map:act type="shipmentOrderCreateReturn"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order_edit.jsp"/>
			</map:match>

			<map:action logger="shipmentorder" name="shipmentOrderCreateReturn" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderCreateReturnAction"/>

/ 7	. 

/ we nemen	sho	,
  26684404 | SH000000169

/s
hipmentOrderCreateReturnAction.act() line: 56	
		ShipmentOrderVO myVO = MpoBeanFactory.getBean(ShipmentOrderService.class).createReturnShipmentOrder(myOriginalShipmentOrder);
/s
PnlLogisticsShipmentOrderServiceImpl.createReturnShipmentOrder(ShipmentOrderVO) line: 20	
		ShipmentOrderVO myShipmentOrder = super.createReturnShipmentOrder(aShipmentOrder);
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).createReturnShipmentOrder(ShipmentOrderVO) line: 722	
		ShipmentOrderVO myShipmentOrderVO = shipmentOrderDuplicator.duplicate(aShipmentOrder);
/s
CompleteShipmentOrderDuplicator.duplicate(ShipmentOrderVO) line: 33	
		return duplicate(anOriginalShipmentOrderVO, new CustomDuplicateAction() {
/s
CompleteShipmentOrderDuplicator.duplicate(ShipmentOrderVO, CustomDuplicateAction) line: 44	
		ShipmentOrderVO myNewShipmentOrderVO = anOriginalShipmentOrderVO.copy();
		myNewShipmentOrderVO.setSystemId(ValueObject.VOLATILE_SYSTEM_ID);
		// id must be altered
		myNewShipmentOrderVO.setShipmentOrderId(anOriginalShipmentOrderVO.getShipmentOrderId().trim() + "copy");
ShipmentOrder: SH000000169copy(SystemId:0; Org:PNL-CARGO)

			myNewShipmentOrderVO = shipmentOrderService.createShipmentOrder(myNewShipmentOrderVO);
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).createShipmentOrder(ShipmentOrderVO) line: 829	
		return createShipmentOrder(aShipmentOrder, new TMSEventContext());
/s
PnlLogisticsShipmentOrderServiceImpl(ShipmentOrderServiceImpl).createShipmentOrder(ShipmentOrderVO, TMSEventContext) line: 837	
			Date myNow = timeService.getPresentDate(aShipmentOrder.getOrganization());
			aShipmentOrder.setSystemEntryDate(myNow);
			aShipmentOrder.setOriginalSystemEntryDate(myNow);
			aShipmentOrder.setLastUpdate(myNow);
			aShipmentOrder.setCreatedBy(AuthenticationUtils.getResource());

			} else {
				setDatesAndStatus(aShipmentOrder);
				applySyncFlags(aShipmentOrder);
				handleTimeWindow(aShipmentOrder);

				shipmentOrderDao.setEventContext((TMSEventContext) anEventContext.clone());
				myVO = shipmentOrderDao.save(aShipmentOrder);
systemId	26975474	








/ Einde DEBUG CREATE RETURN

/ OPEN LOGS 

LOG_8_sep_2014.txt:62185
LOG_29_sep_2015.txt:29818
LOG_6_OCT_2014.txt:22235
LOG_new.txt:3856
LOG_23_jul_2015.txt:3074
LOG_sho.txt: sho inlezen, cargo tpl aanpassen	,





/ Einde OPEN LOGS 


/ POSTRESQL

/ Zoek naar index	,
pnllogistics6a=# \d shipment_order
Indexes:
    "shipment_order_org_uk" UNIQUE, btree (shipment_order_id, organization_systemid)
/ of	, 
pnllogistics6a=# \di *shipment*uk*
                                 List of relations
 Schema |           Name            | Type  |    Owner    |         Table          
--------+---------------------------+-------+-------------+------------------------
 public | shipment_order_org_uk     | index | mpopostgres | shipment_order

/ Geef in google
postgresql pg_index

/ Lees	,
http://www.postgresql.org/docs/9.3/static/catalogs.html
/ TODO
http://www.alberton.info/postgresql_meta_info.html#.VvUO8XW9-V4

/ we doen	,
pnllogistics6a=# select i.* from pg_class c join pg_index i on c.oid=i.indrelid where c.relname='shipment_order';
/ TODO


/ Einde POSTRESQL

/ RSYNC

/ Lees	,
http://articles.slicehost.com/2007/10/10/rsync-exclude-files-and-folders

[eric@localhost tmp]$ pwd
/home/eric/tmp
[eric@localhost tmp]$ find rsync_src/
rsync_src/
rsync_src/1.txt
rsync_src/1.lnk
rsync_src/sub
rsync_src/sub/3.txt
rsync_src/.2.txt

/ 7	. 

[eric@localhost tmp]$ rsync -avl rsync_src/ rsync_dst

/ rsync_dir wordt create	, want het was er nog niet	,
/ als rsync_dir er al wel was	, ook OK	,

[eric@localhost tmp]$ find rsync_dst/
rsync_dst/
rsync_dst/1.txt
rsync_dst/1.lnk
rsync_dst/sub
rsync_dst/sub/3.txt
rsync_dst/.2.txt


/ 7	. 

$ rm -rf rsync_dst
[eric@localhost tmp]$ rsync -avl --exclude sub rsync_src/ rsync_dst

[eric@localhost tmp]$ find rsync_dst/
rsync_dst/
rsync_dst/1.txt
rsync_dst/1.lnk
rsync_dst/.2.txt

/ 7	. 

[eric@localhost tmp]$ rsync -avl rsync_src/ --exclude .2.txt rsync_dst

[eric@localhost tmp]$ find rsync_dst/
rsync_dst/
rsync_dst/1.txt
rsync_dst/1.lnk
rsync_dst/sub
rsync_dst/sub/3.txt

/ 7	. 

$ rm -rf rsync_dst
[eric@localhost tmp]$ rsync -avl rsync_src/  rsync_dst
[eric@localhost tmp]$ rm rsync_src/1.lnk 
[eric@localhost tmp]$ cat >>rsync_src/4.txt
...
[eric@localhost tmp]$ rsync -avl --delete rsync_src/  rsync_dst
sending incremental file list
deleting 1.lnk
./
4.txt

[eric@localhost tmp]$ find rsync_dst/
rsync_dst/
rsync_dst/4.txt
rsync_dst/1.txt
rsync_dst/sub
rsync_dst/sub/3.txt
rsync_dst/.2.txt

/ 7	. 

[eric@localhost tmp]$ find rsync_src/
rsync_src/
rsync_src/4.txt
rsync_src/1.txt
rsync_src/1.lnk
rsync_src/sub
rsync_src/sub/3.txt
rsync_src/.2.txt

[eric@localhost tmp]$ rsync -avl rsync_src/ rsync_dst --exclude-from="$(pwd)/rsync.txt"
/ of	,
[eric@localhost tmp]$ rsync -avl rsync_src/ rsync_dst --exclude-from=rsync.txt
/ of	,
[eric@localhost tmp]$ rsync -avl rsync_src/ rsync_dst --exclude-from='rsync.txt'
/ of	,
[eric@localhost tmp]$ rsync -avl rsync_src/ rsync_dst --exclude-from 'rsync.txt'


sending incremental file list
created directory rsync_dst
./
.2.txt
1.txt
sub/

sent 250 bytes  received 97 bytes  694.00 bytes/sec
total size is 16  speedup is 0.05
[eric@localhost tmp]$ find rsync_dst/
rsync_dst/
rsync_dst/1.txt
rsync_dst/sub
rsync_dst/.2.txt

/ 7	. 

/ we doen nu de src zonder / aan het eind	,

[eric@localhost tmp]$ rm -rf rsync_dst/
[eric@localhost tmp]$ rsync -avl rsync_src rsync_dst --exclude-from 'rsync.txt'
sending incremental file list
created directory rsync_dst
rsync_src/
rsync_src/.2.txt
rsync_src/1.txt
rsync_src/sub/

[eric@localhost tmp]$ find rsync_dst/
rsync_dst/
rsync_dst/rsync_src
rsync_dst/rsync_src/1.txt
rsync_dst/rsync_src/sub
rsync_dst/rsync_src/.2.txt

/ 7	. 

/dir/ means exclude the root folder /dir

/dir/* means get the root folder /dir but not the contents

dir/ means exclude any folder anywhere where the name contains dir/

Examples excluded: /dir/, /usr/share/mydir/, /var/spool/dir/

/dir means exclude any folder anywhere where the name contains /dir

Examples excluded: /dir/, /usr/share/directory/, /var/spool/dir/

/var/spool/lpd//cf means skip files that start with cf within any folder

within /var/spool/lpd

/ TODO

/ 7	. 

[eric@localhost tmp]$ find home/eric/
home/eric/
home/eric/dir
home/eric/dir/2.txt
home/eric/dir/sub
home/eric/dir/sub/3.txt
home/eric/directory
home/eric/directory/4.txt
home/eric/1.txt
home/eric/1.lnk

/ 13	. 

[eric@localhost tmp]$ cat rsync.txt 
dir			/ of	,												
dir/

[eric@localhost tmp]$ rsync -avz home/eric backup --exclude-from 'rsync.txt'

[eric@localhost tmp]$ find backup/
backup/
backup/eric
backup/eric/directory
backup/eric/directory/4.txt
backup/eric/1.txt
backup/eric/1.lnk

/ 13	. 

/ rsync kan maar 1 destdir maken	, als die  er niet is	, dus 
[eric@localhost tmp]$ rm -rf backup/
[eric@localhost tmp]$ mkdir -p backup/home
[eric@localhost tmp]$ rsync -avz "$(pwd)/home/eric/" backup/home/eric --exclude-from 'rsync.txt'
/ OK
/ backup/home/ bestaat	, rsync maakt backup/home/eric/	, 
[eric@localhost tmp]$ find backup/
backup/
backup/home
backup/home/eric
backup/home/eric/directory
backup/home/eric/directory/4.txt
backup/home/eric/1.txt
backup/home/eric/1.lnk


/ 13	. 

[eric@localhost tmp]$ cat rsync.txt 
/dir	 	/ of	,
/dir/		/ of	, 	
dir			/ of	, 
dir/		/ of	,

[eric@localhost tmp]$ rsync -avz home/eric/ backup --exclude-from 'rsync.txt'
[eric@localhost tmp]$ find backup/
backup/
backup/directory
backup/directory/4.txt
backup/1.txt
backup/1.lnk


/ 7	. 

[eric@localhost bin]$ pwd
/home/eric/bin
[eric@localhost bin]$ cat rsync.excl 
DB_TAP/Firebird
Downloads
# rsync -avz /home/eric /run/media/eric/WD/mpo/home/ --exclude-from=/home/eric/bin/rsync.excl

/ Einde RSYNC

/ DEBUG PRODUCT ITEM SCREEN

/ sho SH000001119	,
/ of	,
SH000000435

/ In HTML	 zien we op het edit button, dat is WH wat mpo:action doet	,
product-item_edit

$ vi oms-sitemap.xmap

			<map:action logger="shipmentorder" name="productItemEdit" src="com.mpobjects.oms.control.shipmentorder.action.ProductItemEditAction"/>

			<map:match pattern="product-item_edit">
				<map:act type="productItemEdit"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order_edit.jsp"/>
			</map:match>
/ TODO
/ we zien dat het product item form ook op sho-productitems.tag staat	,
/ Deze tag wordt called in shipment-order_edit.jsp	, is het daarom dat jsp/shipment-order_edit.jsp in product-item_edit's config	? 
/ TODO


$ vi shipment-order_edit.jsp

				<c:if test="${cf:property('oms', 'shipmentorder.hide.productitems', 'false')=='false'}">
					<mpo:tab name="productItems">
						<tmstags:sho-productitems />
					</mpo:tab>
				</c:if>

$ vi ProductItemEditAction.java
	@Override
	public Map act() {
		for (ProductItemVO myItem : myShipmentOrder.getProductItemList()) {
			if (myItem.getSystemId() == mySystemId) {
				getRequest().setAttribute("productItemVO", myItem);

$ vi sho-productitems.tag

						<mpo:action name="edit" entity="productItem" />
							<mpo:action name="delete" entity="productItem" />
				<td>${cf:formatNumber(currentItem.quantity)}</td>
				<td>${cf:formatNumber(currentItem.actualQuantity)}</td>

		<mpo:setFormVO valueObject="${productItemVO}" prefix="productItem">

				<mpo:tabCollection name="product-item" defaultTab="productItem">
...
339:											<mpo:numberField name="actualQuantity" minValue="0" type="float" />

/ Er is WH geen apart form	, alleen de formVO wordt set tot de product item	,
/ TODO
		</mpo:setFormVO>
		<mpo:button type="saveProductItem" />

/ In HTML zien we	,
<input type="button" name="saveProductItemBtn" id="saveProductItemBtn" value="Save Product item" onclick=" theShipmentorderFormManager.submit('../oms/product-item_save-product-item', false, 0);">

/ 7	. 

/ Als we ... TODO
/ Dit is NIET op sho edit scherm	,

/we zien in de log	,

select stockkeepi0_.SYSTEM_ID as col_0_0_, product2_.PRODUCTID as col_1_0_, product2_.DESCRIPTION as col_2_0_, goodsstatu1_.CODE as col_3_0_, stocklocat4_.NAME as col_4_0_
from INV_STOCK_KEEPING_UNIT stockkeepi0_ 
left outer join GOODS_STATUS goodsstatu1_ on stockkeepi0_.GOODS_STATUS_SYSTEMID=goodsstatu1_.SYSTEM_ID, 
product product2_, 
STOCK_LOCATION stocklocat4_ 
where stockkeepi0_.PRODUCT_SYSTEMID=product2_.SYSTEM_ID 
and stockkeepi0_.STOCK_LOCATION_SYSTEMID=stocklocat4_.SYSTEM_ID 
and (stockkeepi0_.ORGANIZATION_SYSTEMID in (
	select userorgani5_.ORGANIZATION_SYSTEMID 
	from USER_ORGANIZATION userorgani5_, 
	ORGANIZATION organizati6_ 
	where userorgani5_.ORGANIZATION_SYSTEMID=organizati6_.SYSTEM_ID 
	and userorgani5_.USER_SYSTEMID=$1
)) 
and (lower(product2_.PRODUCTID) like lower($2) 
	or lower(product2_.DESCRIPTION) like lower($3) 
	or lower(goodsstatu1_.CODE) like lower($4) 
	or lower(stocklocat4_.NAME) like lower($5)
) 
limit $6 

DETAIL:  parameters: $1 = '27176488', $2 = '%mpo_Prod1%', $3 = '%mpo_Prod1%', $4 = '%mpo_Prod1%', $5 = '%mpo_Prod1%', $6 = '15'
LOG:  execute <unnamed>: BEGIN

[eric@localhost Misc]$  pwd
/home/eric/Devel/Postgres/scripts/Misc
[eric@localhost Misc]$ cat product_item.sh 

#!/usr/bin/bash

PGPASSWORD=mpopostgres@mpo psql  -U mpopostgres geosco_app_a_2016_03_21 <<SQL
select stockkeepi0_.SYSTEM_ID as col_0_0_, product2_.PRODUCTID as col_1_0_, product2_.DESCRIPTION as col_2_0_, goodsstatu1_.CODE as col_3_0_, stocklocat4_.NAME as col_4_0_
from INV_STOCK_KEEPING_UNIT stockkeepi0_ 
left outer join GOODS_STATUS goodsstatu1_ on stockkeepi0_.GOODS_STATUS_SYSTEMID=goodsstatu1_.SYSTEM_ID, 
product product2_, 
STOCK_LOCATION stocklocat4_ 
where stockkeepi0_.PRODUCT_SYSTEMID=product2_.SYSTEM_ID 
and stockkeepi0_.STOCK_LOCATION_SYSTEMID=stocklocat4_.SYSTEM_ID 
and (stockkeepi0_.ORGANIZATION_SYSTEMID in (
    select userorgani5_.ORGANIZATION_SYSTEMID 
    from USER_ORGANIZATION userorgani5_, 
    ORGANIZATION organizati6_ 
    where userorgani5_.ORGANIZATION_SYSTEMID=organizati6_.SYSTEM_ID 
    and userorgani5_.USER_SYSTEMID=27176488
)) 
and (lower(product2_.PRODUCTID) like lower('%mpo_Prod1%') 
    or lower(product2_.DESCRIPTION) like lower('%mpo_Prod1%') 
    or lower(goodsstatu1_.CODE) like lower('%mpo_Prod1%') 
    or lower(stocklocat4_.NAME) like lower('%mpo_Prod1%')
) 
limit 15
SQL

[eric@localhost Misc]$ ./product_item.sh 
Null display is "NULL".
 col_0_0_ | col_1_0_  | col_2_0_  | col_3_0_ |       col_4_0_        
----------+-----------+-----------+----------+-----------------------
 27044089 | MPO_Prod1 | MPO_Prod1 | GOOD     | GEODIS_WHS_FR_SOCHAUX
 27044222 | MPO_Prod1 | MPO_Prod1 | GOOD     | MPO_Vend1
(2 rows)

/ 7	. 

/ we doen zelf de query	,

geosco_app_a_2016_03_21=# select pi.* from tms_product_item pi join shipment_order sho on pi.shipment_order_systemid=sho.system_id where sho.shipment_order_id='SH000001119';
 system_id | customs_number | description | part_number | product_series | product_model | quantity  | shipment_order_systemid | product_item_id | weight_kg 
 | reference1 | reference2 | reference3 | reference4 | reference5 | country_of_origin_systemid | value_currency_systemid | individual_item_value | tot_volume
_m3 | orig_cust_order_id | orig_cust_orderline_id | reference6 | reference7 | reference8 | reference9 | reference10 | requested_adr_code | actual_adr_code | 
requested_un_number | actual_un_number | flashpoint | packaging_group | remarks | product_systemid | customer_order_line_systemid | productid | reference11 |
 reference12 | reference13 | reference14 | reference15 | cost_currency_systemid |  cost   | product_owner | product_group | parent_systemid | actual_quantity
 | goods_status_systemid 
-----------+----------------+-------------+-------------+----------------+---------------+-----------+-------------------------+-----------------+-----------
-+------------+------------+------------+------------+------------+----------------------------+-------------------------+-----------------------+-----------
----+--------------------+------------------------+------------+------------+------------+------------+-------------+--------------------+-----------------+-
--------------------+------------------+------------+-----------------+---------+------------------+------------------------------+-----------+-------------+
-------------+-------------+-------------+-------------+------------------------+---------+---------------+---------------+-----------------+----------------
-+-----------------------
  26880413 |                | MPO_Prod1   |             |                |               | 140.00000 |                26879348 | 020             |   50.00000
 |            | 0          |            |            |            |                       NULL |                    NULL |               0.00000 |       8.40
000 | CO000002999        | COL00001991            | NULL       | NULL       | NULL       | NULL       | NULL        | NULL               |            NULL | 
NULL                |             NULL | NULL       | NULL            | NULL    |         27044086 |                     27309305 |           | NULL        |
 NULL        | NULL        | NULL        | NULL        |                   NULL | 0.00000 |               |               |            NULL |         0.00000
 |              26877284
  26880393 |                | MPO_Prod1   |             |                |               | 160.00000 |                26879348 | 010             | 8000.00000
 |            | 0          |            |            |            |                       NULL |                    NULL |               0.00000 |       9.60
000 | CO000002996        | COL00001984            | NULL       | NULL       | NULL       | NULL       | NULL        | NULL               |            NULL | 
NULL                |             NULL | NULL       | NULL            | NULL    |         27044086 |                     27309290 |           | NULL        |
 NULL        | NULL        | NULL        | NULL        |                   NULL | 0.00000 |               |               |            NULL |        80.00000
 |              26877284
(2 rows)


/ 7	. 

/ ProductItemDAoImpl methods worden NIET called	, maar de product item's worden door de Hibernate mapping queried	,
/ Er is dus geen query zoals from TMS_PRODUCT_ITEM 	, maar TMS_PRODUCT_ITEM komt WH voor met een join in de from SHIPMENT_ORDER voor	, 
/ TODO (Welke query	?)

$ vi ShipmentOrder.standard.hbm.xml

		<set name="productItemList" inverse="true" sort="com.mpobjects.util.dao.StringSequencedEntityComparator">
			<cache usage="read-write" />
			<key column="SHIPMENT_ORDER_SYSTEMID" />
			<one-to-many class="com.mpobjects.oms.model.shipmentorder.vo.ProductItemVO" />
		</set>

/ 7	. 












$ vi product-item_edit.jsp




/ Einde DEBUG PRODUCT ITEM SCREEN







/ COPY CARGO DB FROM PROD TO ACC

/ 7	. 

[eric@localhost bin]$ cat pnl-db-dump-p.sh
#!/usr/bin/bash
if [ "$#" -ne 1 ]
then 
	echo "Give database name on production"
	exit 7
fi
cd ~/DB_TAP/Postgres/Backup
PGPASSWORD=h^Zgcyr\&Q pg_dump -U vanderveldene -Fc -h  pnl-app-p.intermax.mp-objects.com "$@" >"$@-p-$(date +%F).dump" 

[eric@localhost bin]$ pnl-db-dump-p.sh pnllogistics

/ 7	. 

[eric@localhost bin]$ cat pnl-db-p-pg.sh 
PGPASSWORD=h^Zgcyr\&Q psql -U vanderveldene -h  pnl-app-p.intermax.mp-objects.com "$@"  
[eric@localhost bin]$ pnl-db-p-pg.sh  pnllogistics
/ OK
[eric@localhost Misc]$ cp ~/Downloads/cleanup-nonrecurring-versie4.txt ~/DB_TAP/Postgres/cleanup-nonrecurring-versie4.sql
/ we hebben commit; added	,
$ less ~/DB_TAP/Postgres/cleanup-nonrecurring-versie4.sql
DELETE FROM IFACE_MSG_TRACE
; commit;
...
[eric@localhost bin]$ PGPASSWORD=h^Zgcyr\&Q psql -U vanderveldene -h  pnl-app-p.intermax.mp-objects.com pnllogistics <~/DB_TAP/Postgres/cleanup-nonrecurring-versie4.sql  

[eric@localhost Misc]$ scp /home/eric/DB_TAP/Postgres/Backup/pnllogistics-p-2016-03-18.dump vanderveldene@pnl-app-a.intermax.mp-objects.com:Downloads/2016-03-18


/ 7	. 

[vanderveldene@pnl-app-a ~]$ less /local/apps/jboss-4.0.5.GA/server/pnllogistics/deploy/postgres-ds.xml 
<datasources>
        <xa-datasource>
                <xa-datasource-property name="ServerName">localhost</xa-datasource-property>
                <xa-datasource-property name="PortNumber">5432</xa-datasource-property>
                <xa-datasource-property name="DatabaseName">pnllogistics</xa-datasource-property>
                <xa-datasource-property name="User">pnllogistics</xa-datasource-property>
                <xa-datasource-property name="Password">RHKKxd-xFqvC4UibbW2ylnnK8H2BNWAH</xa-datasource-property>

[vanderveldene@pnl-app-a Downloads]$ PGPASSWORD=RHKKxd-xFqvC4UibbW2ylnnK8H2BNWAH psql -U pnllogistics -h localhost
psql (9.3.10)
pnllogistics=> alter schema public rename to public_old;
pnllogistics=> create schema public;
pnllogistics=> grant all on schema public to admin with grant option;
pnllogistics=> grant usage on schema public to reader;
pnllogistics=> grant usage on schema public to writer;
pnllogistics=> commit;
WARNING:  there is no transaction in progress

[vanderveldene@pnl-app-t ~]$ PGPASSWORD=RHKKxd-xFqvC4UibbW2ylnnK8H2BNWAH pg_restore -h localhost -d pnllogistics -U pnllogistics --no-acl --no-owner ~vanderveldene/Downloads/pnllogistics-a-2016-01-14.dump 
/ OK

> drop schema public_old cascade	









/ Einde COPY CARGO DB FROM PROD TO ACC

/ LINUX

/ 13	. 

/ gzip -c <file>: compresses <file>	, en naar stdout	,
/ gunzip -c <file>:  uncompresses <file>	, en naar stdout	,

/ 13	. 

find /tmp -ctime +10 -exec rm -rf {} +

/ Einde LINUX



/ MADHU

[eric@localhost bin]$  PGPASSWORD=Eric234@MPO psql -U eric -h  mposerv8 pnloms
Null display is "NULL".
psql (9.3.5, server 9.1.13)
SSL connection (cipher: DHE-RSA-AES256-SHA, bits: 256)
Type "help" for help.

pnloms=> 
/ OK

[eric@localhost bin]$  PGPASSWORD=Eric234@MPO psql -U eric -h  mposerv8 -p 5433 mposcs-dev
Null display is "NULL".
psql (9.3.5, server 9.3.9)
SSL connection (cipher: DHE-RSA-AES256-SHA, bits: 256)
Type "help" for help.

mposcs-dev=> 
/ OK

[eric@localhost bin]$  PGPASSWORD=Eric234@MPO pg_dump -Fc -U eric -h  mposerv8 -p 5433 mposcs-dev >/tmp/mposcs-dev.sql

/ Dus op mposerv8	,
PGPASSWORD=mqi8o0e6aeg56tpghje2bo0gehgthoi6 psql -U mposcs_dev -h localhost  -p 5433 mposcs-dev
/ OK


/ Einde MADHU


/ APPLE

/ passcode op iphone6	, naast de fingerprint	,
795679

/ apple ID	,
eric.vandervelden@mp-objects.com
rtdMpo45




/ Einde APPLE

/ ERLANG

http://www.rabbitmq.com/
chef
http://www.jabber.org/
https://qpid.apache.org/

/ Einde ERLANG


/ PCT-379

/ postgres to file	, 

/ Lees	,
http://stackoverflow.com/questions/1517635/save-pl-pgsql-output-from-postgresql-to-a-csv-file

/ \o en \copy werkt niet op geosco-app-t en geosco-app-a    ,     
/ TODO

[eric@localhost bin]$ PGPASSWORD=h^Zgcyr\&Q psql -U vanderveldene -h  geosco-app-t.intermax.mp-objects.com -d geosco  -A -F"," -c "select*from party" >/tmp/parties-t.text
[eric@localhost bin]$ PGPASSWORD=h^Zgcyr\&Q psql -U vanderveldene -h  geosco-app-t.intermax.mp-objects.com -d geosco  -A -F"," -c "select*from stock_location" >/tmp/stock_location-t.text
[eric@localhost bin]$ PGPASSWORD=h^Zgcyr\&Q psql -U vanderveldene -h  geosco-app-a.intermax.mp-objects.com -d geosco  -A -F"," -c "select*from stock_location" >/tmp/stock_location-a.text
[eric@localhost bin]$ PGPASSWORD=h^Zgcyr\&Q psql -U vanderveldene -h  geosco-app-a.intermax.mp-objects.com -d geosco  -A -F"," -c "select*from party" >/tmp/parties-a.text


/ Einde PCT-379


/ UPDATE LANGUAGE FILES


[eric@localhost server]$ find -name "language*properties" | xargs grep '\[my massupdate\]'
./isbscs/conf/language_en.properties:massupdate=[my massupdate]
./geosco/conf/language_en.properties:massupdate=[my massupdate]
./dsvfms/conf/language_en.properties:massupdate=[my massupdate]
./pnllogistics/conf/language_en.properties:massupdate=[my massupdate]
./pnltms/conf/language_en.properties:massupdate=[my massupdate]
./pnloms/conf/language_en.properties:massupdate=[my massupdate]
./bard/conf/language_en.properties:massupdate=[my massupdate]
./mposcs/conf/language_en.properties:massupdate=[my massupdate]

trunk, 2015.04, 2015.03

massupdate=[my massupdate]
entity_action_types=[entity_action_types]
entity_action_group_templates=[entity_action_group_templates]
mass_update=[mass_update]
mass_update_dashboard=[mass_update_dashboard]
fast_create=[Fast create]

massupdate=Mass Update
entity_action_types=Entity Action Type
entity_action_group_templates=Entity Action Group Templates
mass_update=Mass Update
mass_update_dashboard=Mass Update Dashboard
fast_create=Fast Create


/ Einde UPDATE LANGUAGE FILES

/ PAT-418

prnlogistics.table_shipment_order_shipfrom_name2
table_shipment_order_shipfrom_name2
prnlogistics.shipfrom_name2
shipfrom_name2

shipfrom.tag line: 70	
			<mpo:setFormVO valueObject="${formVO.fromPartyVO}" prefix="from">
				<mpo:field name="emailAddress" languageKey="shipfrom_emailAddress"/>
/s
FieldTag.doStartTag() line: 347	
			if (isFieldContextForm()) {
				findSetFormVOTag();
this	FieldTag  (id=18385)	
	activeValueObjectHolder	SetFormVOTag  (id=20458)	

			if (isHidden()) {
/ NEE
			} else {

				if (showFieldContext()) {
					appendLabelPart(myRet);
/s
FieldTag.getLabel() line: 1166	
		return getLabel(StringUtils.isEmpty(getLanguageKey()) ? getName() : getLanguageKey());
/s
FieldTag.getLabel(String) line: 1176	
		return getLanguageManager().getByJavaName(getFieldOwner().getEntity(), aName);
/s
LanguageManager.getByJavaName(String, String) line: 370	
/=
	public String getByJavaName(String anEntityName, String aFieldName) {
		String myTableName = StringUtils.formatJavaToSql(anEntityName).toString();
shipment_order
		String myFieldName = StringUtils.formatJavaToSql(aFieldName).toString();
shipfrom_email_address
		String myRet;
		if (StringUtils.isNotEmpty(myTableName)) {
			myRet = get(myTableName, myFieldName);
/s
LanguageManager.get(String, String) line: 258	







/ Einde PAT-418

/ SVN ECLIPSE

/ we zien conflicts	, rood	,
/ dubbel click een conflicting file	, we zien local file, remote file	,
/ we click in eclipse de button 'copy all non-conflicting changes from right to left'	,
/ right click de file, en 'mark as merged', het rood verdwijnt	,

/ Einde SVN ECLIPSE

/ SCS-5045

$ vi patch-371-fix-service-order-float-field$postgresql.sql

DROP VIEW IF EXISTS RPT_SERVICE_ORDERS;

/* Fix volume */
ALTER TABLE SERVICE_ORDER ADD VOLUME_M3_D DECIMAL(12,5);
...

CREATE VIEW RPT_SERVICE_ORDERS (SYSTEM_ID,  ...

/ Zo moet het	,

$ vi patch-575-change_so_nr_of_units_data_type$postgresql.sql
/ net zo	,


/ Einde SCS-5045


/ PCT-997

/ permission button 'Create custom event' op events tab op so edit scherm	,

/ 7	.

[eric@localhost pnllogistics]$ vi deploy/tms.war/menu.xml 
            <menuItem index="2051">
              <labelId>search</labelId>
              <module>oms</module>
              <parent reference="../../.."/>
              <path>planning.serviceOrder.search</path>
              <privilege>service-order.list</privilege>
              <type>ITEM</type>
              <url>oms/service-order_list?refresh=false&amp;emptySession=true</url>
              <visibilityExpr></visibilityExpr>
            </menuItem>

/ Geef R_PRIVS_PTG de privilege service-order.list	,

/ nu kan u_privs_ptg planning, service order, search

/ 7	.

/ als je een planned sho zoekt	,  dan op sho search scherm	,
Status: 1450

/ Geef in Service order list scherm 
Booking type: DELIVERY
Pln. start date: >10-Nov-2015
/ we nemen	,
N0011248

/ Als we hier op willen zoeken	, 
Service ordder: N0011248
Pln. start date: >10-Nov-2015


/ 7	.

/ als u_privs_ptg de seo opens	, zijn alle list field ro	, 

/ Dit is omdat R_PRIVS_PTG niet de priv service-order:update heeft	, 

/ Dat is omdat	,
$ vi service-order_edit.jsp

<%
		isEditable = theResource
				.hasPrivilege("service-order", "update");
	request.setAttribute("readOnly", "" + !isEditable);
%>
		<mpo:form name="mpoForm" action="service-order_save" entity="serviceOrder" readOnly="${readOnly}">
								<mpo:listField name="holdStatus" type="holdStatus" overRideable="true" />
/s
ListFieldTag(FieldTag).doStartTag() line: 349	
					appendInputPart(myRet);
/s
ListFieldTag(FieldTag).doStartTag() line: 349	
		if (isCurrentlyReadOnly()) {
/s
ListFieldTag(FieldTag).doStartTag() line: 349	
		boolean myReadOnly = BooleanUtils.isTrue(getReadOnly()) || getReadOnly().equals(getMode());
/s
ListFieldTag(FieldTag).doStartTag() line: 349	
		} else {
			myRet = getFieldOwner().getReadOnly();
/s
ListFieldTag(FieldTag).doStartTag() line: 349	
		return theReadOnly;
/ en op de <mpo:form/ readOnly="${readOnly}/>

/ 13	. 

/ we geven R_PRIVS_PTG de priv service-order:update	,

/ Op andere fields staat explicit readOnly	,

		<mpo:form name="mpoForm" action="service-order_save" entity="serviceOrder" readOnly="${readOnly}">
				<mpo:field name="serviceOrderId" readOnly="true" overRideable="true" />

/ hierboven zagen we dat <mpo:field/> niet naar <mpo:form readOnly/> kijkt (dus naar de priv service-order:update)	, alleen <mpo:listField/>s doet dat	,

/s
FieldTag.doStartTag() line: 341	

/ A	.
			handleOverridable();
/ Maak	, 
module.oms.serviceOrder.serviceOrderId.readonly
/ Klopt	, deze property is role onafhankelijk	,
////////////////////////////////////////////////////////

/ B.
			if (isHidden()) {
/s
FieldTag.isHidden() line: 619	
			PermissionType myPermission = JspPermissionManager.get(getRequest()).checkPermission(myEntity, activeValueObjectHolder, getActiveValueObject(), request, getName());
/s
JspPermissionManager.checkPermission(String, ActiveValueObjectHolder, EntityInterface, HttpServletRequest, String) line: 81	
		return check(anEntityName, myEntity, anActiveValueObjectHolder, anEntityInterface, myFieldId);
/s
JspPermissionManager.check(String, PermissionEntityType, ActiveValueObjectHolder, EntityInterface, String) line: 132	
		String myKey = myKeyBuilder.toString();
1242601241#26856317#serviceOrderId
		if (cache.containsKey(myKey)) {
/ NEE
		} else {
			} else if (myEntityType != null) {
				myType = getPermissionService().checkPermission(getPermissionGroup(myEntityType), anEntityInterface, aFieldId, getResource());
/s
PermissionServiceImpl.checkPermission(Collection<PermissionGroup>, EntityInterface, String, Resource) line: 70	
		return getPermisionForEntity(myList, anEntity, aFieldId, aResource);
/s
PermissionServiceImpl.getPermisionForEntity(Collection<PermissionGroup>, EntityInterface, String, Resource) line: 239	
		// TODO More than one group?
		for (PermissionGroup myGroup : myList) {
/ TODO
/ Maak een PermissionGroup	,
/ See PERMISSIONGROUP bij PAT-333	,

/ C.

			if (isHidden()) {
/ NEE
			} else {
				if (showFieldContext()) {
					appendInputPart(myRet);
/s
FieldTag.appendInputPart(StringBuffer) line: 938	
		if (isFieldContextList() && isCurrentlyReadOnly()) {

/ Dus telt alleen als <mpo:listField/>	,
/ dan kijkt hij naar de <mpo:form readOnly=.../>	, bij ons was dat readOnly="${readOnly}"	, en die kwam van een privilege service-order:update	,

/ 7	.

$ vi service-order_edit.jsp

<%@taglib prefix="cf" uri="/WEB-INF/tld/core-functions.tld"%>

					<c:if test="${cf:property('event', 'enabled', 'false')!='false'}">
						<mpo:tab name="events">

							<etf:service-order-tab-events />
						</mpo:tab>
					</c:if>
/ TODO

$ vi service-order-tab-events.tag

<c:if test="${cf:hasPrivilege('event', 'create', null, formVO)}">	 / A
	<c:if test="${eventVO.systemId=='0' && !form.formReadOnly}">	/ B
		<button href="#" id="createCustomEventBtn" class="">
			<mpo:label name="createCustomEvent" />
		</button>
	</c:if>

/ we zien 2 voorwaarden		, bij A en bij B	,

/ A	,
/s
EntityAuthorizationFactory.hasPrivilege(String, String, EntityInterface, EntityInterface) line: 62	
/=
	public static boolean hasPrivilege(String anEntity, String anAction, EntityInterface aValueObject, EntityInterface aParentValueObject) {
anEntity	"event" (id=26291)	
anAction	"create" (id=26292)	
aValueObject	null	
aParentValueObject	ServiceOrderVO_$$_javassist_131  (id=26219)	

/ Intermezzo

$ vi core-functions.tld
<function>
	<name>hasPrivilege</name>
    <function-class>com.mpobjects.core.factory.EntityAuthorizationFactory</function-class>

/ we set een cond b in 
EntityAuthorizationFactory.hasPrivilege(String, String, EntityInterface, EntityInterface) line: 62	
anEntity.equals("event")

/ Einde Intermezzo

		return getEntityAuthorization(anEntity, anAction, aValueObject, aParentValueObject).hasPrivilege();
/s
EntityAuthorizationFactory.getEntityAuthorization(String, String, EntityInterface, EntityInterface) line: 47	
		if (EDIT_TYPE.equals(anAction)) {
/ NEE	, 
anAction	"create" (id=26292)	

		EntityAuthorizationInterface myRet = (EntityAuthorizationInterface) Factory.getFactory().getInstanceByKey("authorization", StringUtils.formatFileToProperty(anEntity));
anEntity	"event" (id=26291)	
/s
Factory.getInstanceByKey(String, String) line: 149	
/=
	public Object getInstanceByKey(String aPrefix, String aKey) throws IllegalArgumentException {
aPrefix	"authorization" (id=30603)	
aKey	"event" (id=30604)	

		String myCastableSupertype = theFactoryProperties.getProperty(aPrefix + ".interface", "java.lang.Object");
"java.lang.Object"
		String myTargetClassStr = theFactoryProperties.getProperty(aPrefix + "." + aKey + ".implementation");
null
		if (myTargetClassStr == null) {
			myTargetClassStr = theFactoryProperties.getProperty(aPrefix + ".default.implementation");
"com.mpobjects.core.entity.control.EntityAuthorization"
		}
		return getInstance(myTargetClassStr, myCastableSupertype);
/ creates	 met new	,
/t
EntityAuthorizationFactory.getEntityAuthorization(String, String, EntityInterface, EntityInterface) line: 53	
		EntityAuthorizationInterface myRet = (EntityAuthorizationInterface) Factory.getFactory().getInstanceByKey("authorization", StringUtils.formatFileToProperty(anEntity));
/d
		myRet.setEntity(StringUtils.formatFileToJava(anEntity));
		myRet.setAction(anAction);
		myRet.setValueObject(aValueObject);
		myRet.setParentValueObject(aParentValueObject);
myRet	EntityAuthorization  (id=30649)	
	theAction	"create" (id=26292)	
	theEntity	"event" (id=30720)	
	theParentValueObject	ServiceOrderVO_$$_javassist_131  (id=26219)	
	theValueObject	null	

		return myRet;
/t
EntityAuthorizationFactory.hasPrivilege(String, String, EntityInterface, EntityInterface) line: 62	
/d
/s
EntityAuthorization.hasPrivilege() line: 49	
		String myEntity = StringUtils.formatJavaToFile(getEntity()).toString();
		String myAction = getAction();
		return ResourceUtil.getResource().hasPrivilege(myEntity, myAction);
true
/ voor Resource:u_privs_ptg(systemId:26894069)

/ 7	.

$ vi oms-sitemap.xmap
			<map:action logger="serviceorder" name="serviceOrderEdit" src="com.mpobjects.oms.control.serviceorder.action.ServiceOrderEditAction"/>
			<map:match pattern="service-order_edit">
				<map:act type="serviceOrderEdit">
				<map:select type="session-attribute">
					<map:parameter name="attribute-name" value="builder"/>
					<map:when test="jsp">
						<map:read mime-type="text/html" type="jsp" src="jsp/service-order_edit.jsp"/>
					</map:when>
					<map:otherwise>
						<map:redirect-to uri="../wicket?module=oms&amp;wicketpage=serviceorder.edit.ServiceOrderEditSelectionPage"/>
					</map:otherwise>			
				</map:select>
				</map:act>
			</map:match>

/ B	.

<c:if test="${cf:hasPrivilege('event', 'create', null, formVO)}">	 / A
	<c:if test="${eventVO.systemId=='0' && !form.formReadOnly}">	/ B
		<button href="#" id="createCustomEventBtn" class="">
			<mpo:label name="createCustomEvent" />
		</button>
	</c:if>
/s
FormTag.isFormReadOnly() line: 475	
		return StringUtils.isTrue(getReadOnly()) || getMode().equals(getReadOnly());
true || ...
/ want,
/s
FormTag.getReadOnly(){
	return theReadOnly;
}
/ Dus bij B false	,

/ Dus als de role R_PRIVS_PTG priv service-order:update	, want dat is zo prgram in service-order_edit.jsp	, en priv event:create heeft	, dan zien we de button 'create custom event'	, 

$ vi service-order_edit.jsp

		isEditable = theResource
				.hasPrivilege("service-order", "update");
	request.setAttribute("readOnly", "" + !isEditable);
		<mpo:form name="mpoForm" action="service-order_save" entity="serviceOrder" readOnly="${readOnly}">


/ 7	.

$ vi service-order_edit.jsp

					<c:if test="${cf:property('event', 'enabled', 'false')!='false'}">
						<mpo:tab name="events">
							<etf:service-order-tab-events />
						</mpo:tab>
					</c:if>

/ role R_PRIVS_PTG heeft priv event:enabled niet	, maar dat hoeft ook niet, want er staat ='false'	,

/ 	7	.

$ vi ServiceOrderEditAction.java
				ServiceOrderVO myVO = getServiceOrderBAO().getServiceOrder(getSystemIdFromRequest());
				getRequest().setAttribute("formVO", myVO);

$ vi service-order-tab-events.tag

<c:if test="${cf:hasPrivilege('event', 'create', null, formVO)}">
	<c:if test="${eventVO.systemId=='0' && !form.formReadOnly}">
		<button href="#" id="createCustomEventBtn" class="">
			<mpo:label name="createCustomEvent" />
		</button>
	</c:if>
/c:if>

/ 13	. 

/ form

/ form in form.formReadOnly is de FormTag	, formVO is de seo	,

$ vi FormTag.java

	public static final String DEFAULT_DESTINATION_ATTRIBUTE = "form";

	private String theDestionationAttribute = DEFAULT_DESTINATION_ATTRIBUTE;

	@Override
	public int doStartTag() throws JspTagException {

		if (StringUtils.isNotEmpty(getDestionationAttribute())) {
			getRequest().setAttribute(getDestionationAttribute(), this);

/ Hier wordt dus "form":FormTag inst set	,

/ 13	/ 

/ EventVO

$ vi event-actions.xmod
<map:action name="serviceOrderEventsFormInit" src="com.mpobjects.event.event.control.ServiceOrderEventsFormInitAction"/>

$ vi event-overrides-pipelines.xmod
<map:pipeline>
	<map:match pattern="oms/service-order_edit">
		<map:act type="serviceOrderEventsFormInit"/>
	</map:match>














/ Einde PCT-997

/ DEBUG PCT-997


/ als u_privs_ptg de seo opens	, zijn alle field ro	, en de 'Create custom order' button zien we niet	,

/ Neem 
								<mpo:field name="serviceOrderId" readOnly="true" overRideable="true" />
/ We zien dat deze altijd readOnly is	, ook als administrator	, 
/ ook omdat er geen db prpperty  is	,
/ TODO

/ we set een b in FieldTag	,
/ we zouden cond	,	maar is toch de 1ste	,
this.getName().equals("serviceOrderId")

/s
FieldTag.doStartTag() line: 341	
			if (isHidden()) {
/s
FieldTag.isHidden() line: 619	
			PermissionType myPermission = JspPermissionManager.get(getRequest()).checkPermission(myEntity, activeValueObjectHolder, getActiveValueObject(), request, getName());
/s
JspPermissionManager.checkPermission(String, ActiveValueObjectHolder, EntityInterface, HttpServletRequest, String) line: 81	
		} else if ("serviceOrder".equals(anEntityName)) {
			myEntity = PermissionEntityType.SERVICE_ORDER;
		}
		return check(anEntityName, myEntity, anActiveValueObjectHolder, anEntityInterface, myFieldId);
anEntityName	"serviceOrder" (id=20277)	
anActiveValueObjectHolder	SetFormVOTag  (id=25855)	
entityInterface	ServiceOrderVO_$$_javassist_131  (id=25856)	
myEntity	PermissionEntityType  (id=25210)	
SERVICE_ORDER
/s
JspPermissionManager.check(String, PermissionEntityType, ActiveValueObjectHolder, EntityInterface, String) line: 132	
		StringBuilder myKeyBuilder = new StringBuilder();
		myKeyBuilder.append(anActiveValueObjectHolder == null ? 0 : anActiveValueObjectHolder.hashCode()).append("#");
		myKeyBuilder.append(anEntityInterface == null ? 0 : anEntityInterface.getSystemId()).append("#");
		myKeyBuilder.append(aFieldId == null ? "" : aFieldId);
963689249#26856317#serviceOrderId

		String myKey = myKeyBuilder.toString();
963689249#26856317#serviceOrderId
		if (cache.containsKey(myKey)) {
 /NEE
			return cache.get(myKey);
		} else {
			PermissionEntityType myEntityType = anEntityType;
			if (myEntityType == null) {
				myEntityType = resolvePermissionEntityType(anEntityInterface);
			}
			} else if (myEntityType != null) {
				myType = getPermissionService().checkPermission(getPermissionGroup(myEntityType), anEntityInterface, aFieldId, getResource());
/s
JspPermissionManager(AbstractPermissionManager).getPermissionGroup(PermissionEntityType) line: 42	
		Collection<PermissionGroup> myCollection = groupCache.get(aType);
null
		if (myCollection == null) {
/ JA
			myCollection = getPermissionGroupDAO().findByEntityType(aType);
[]
			groupCache.put(aType, myCollection);
		}
		return myCollection;
/t
/s
JspPermissionManager(AbstractPermissionManager).getResource() line: 59	
		if (resource == null) {
JA
			resource = AuthenticationUtils.getResource();
		}
		return resource;
/t
/s
PermissionServiceImpl.checkPermission(Collection<PermissionGroup>, EntityInterface, String, Resource) line: 55	
		return getPermisionForEntity(myList, anEntity, aFieldId, aResource);
myList	ArrayList  (id=26602)	
[]
anEntity	ServiceOrderVO_$$_javassist_131  (id=25856)	
aFieldId	"serviceOrderId" (id=20065)	
aResource	Resource  (id=26607)	
/s
PermissionServiceImpl.getPermisionForEntity(Collection<PermissionGroup>, EntityInterface, String, Resource) line: 239	
		// TODO More than one group?
		for (PermissionGroup myGroup : myList) {
/ GEEN
		return myPermission;
null
/t
JspPermissionManager.check(String, PermissionEntityType, ActiveValueObjectHolder, EntityInterface, String) line: 132	
			} else if (myEntityType != null) {
				myType = getPermissionService().checkPermission(getPermissionGroup(myEntityType), anEntityInterface, aFieldId, getResource());
/d
null
			cache.put(myKey, myType);
myKey=963689249#26856317#serviceOrderId
			return myType;
null
/t
FieldTag.isHidden() line: 621	
			PermissionType myPermission = JspPermissionManager.get(getRequest()).checkPermission(myEntity, activeValueObjectHolder, getActiveValueObject(), request, getName());
null
		return isHidden;
false
/t
FieldTag.doStartTag() line: 345	
			if (isHidden()) {
/ NEE
			} else {
				if (showFieldContext()) {
					appendHeaderStart(myRet);
					appendLabelPart(myRet);
					appendInputPartPrefix(myRet);
					appendInputPart(myRet);

/ 7	. 

/ we zien dat hold status editable is voor administrator	, maar niet voor u_privs_ptg	,

/ we maken cond. b	, 
FieldTag.doStartTag
this.getName().equals("holdStatus")

/ we call (eerst de action, en daarna) service-order_edit.jsp






















/ Einde DEBUG PCT-997

/ BREAKPOINTS

AbstractView [line: 97] - init(HttpServletRequest, HttpServletResponse)	
DefineTabTag [line: 17] - doStartTag()	
EvoEditFormPage [line: 204] - onSubmit(Button, AjaxRequestTarget, IModel<T>)	
EvoEditPage [line: 80] - EvoEditPage()	
EvoEditPage [line: 132] - onSubmit(AjaxRequestTarget, Form<?>)	
EvoEditPage [line: 249] - mayDeleteObject(T)	
FieldTag [line: 316] [conditional] - doStartTag()	
FormTag [line: 180] - addValueObject(EntityInterface)	
FormTag [line: 215] - addValueObject(EntityInterface)	
FormTag [line: 570] - setReadOnly(String)	
JspPermissionManager [line: 56] - checkPermission(String, ActiveValueObjectHolder, EntityInterface, HttpServletRequest, String)	
LanguageManager [line: 70] - LanguageManager()	
LanguageManager [line: 78] - LanguageManager(HttpServletRequest)	
LanguageManager [line: 129] - getLanguageResource(Locale)	
LanguageManager [line: 247] - get(String, boolean)	
LanguageManager [line: 258] - get(String, String)	
LanguageManager [line: 375] - getByJavaName(String, String)	
LanguageManager [line: 576] - get(String, Map<String, String>, boolean)	
LanguageManagerStringResourceLoader [line: 31] - loadStringResource(Class<?>, String, Locale, String)	
LanguageManagerStringResourceLoader [line: 50] - loadStringResource(Component, String)	
PartyGroupPage [line: 31] - PartyGroupPage()	
PartyTypeGroupVO [line: 47] - getCode()	
SetFormVOTag [line: 91] - doStartTag()	
ShipmentOrderCreateAction [line: 44] - act()	
ShipmentOrderVO [line: 1690] - getShipmentOrderParties()	
ShipmentOrderView [line: 95] - getShipmentOrderVO()	
TabTag [line: 28] - doStartTag()	
WicketLanguageManager [line: 22] - getTranslation(String, Locale, String, boolean)	
WicketLanguageManager [line: 26] - getTranslation(String, String, Locale, String, boolean)	
FieldTag [entry] [conditional] - setLanguageKey(String)	
shipment-order-template_edit.jsp [line: 19]	
shipment-order_edit.jsp [line: 40]	
shipment-order_edit.jsp [line: 97]	


/ Einde BREAKPOINTS

/ DEBUG PCT-1046

/ we study de create button op de huidige party group (list) page, (ext EvoEditPage)	,

/ 7	.

$ vi PartyGroupPage.java
	@Override
	protected EvoEditFormPage<PartyGroupVO> getEditPage() {
		if (editPage == null) {
			editPage = new PartyGroupEditFormPage(this, daoWrapper, dataProperties);

/ de dao komt dus uit de PartyGroupPage zelf	,

PartyGroupPage
ext
EvoEditPage
ext
EvoListPage
	daoWrapper
	daoProperties

/ In EvoListPage.java
	protected abstract BeanWrapper<? extends EnumeratedValueObjectDAOInterface<T>> getBeanWrapper();
/ In PartyGroupPage.java
	@Override
	protected BeanWrapper<? extends EnumeratedValueObjectDAOInterface<PartyGroupVO>> getBeanWrapper() {
		return new BeanWrapper<PartyGroupDAO>(PartyGroupDAO.class);
	}

$ vi EvoListPage.java
	public EvoListPage() {
		super();
		daoWrapper = getBeanWrapper();
		setDataProperties();
		createPage();

/ 7	.

$ vi EvoEditPage.java

	protected void createCreateButton() {
		...
		final IModel<String> createPageTitle = new StringResourceModel("createEntity", EvoEditPage.this, new Model<EvoEditPage<T>>(EvoEditPage.this), "Create ${entityName}");

/ Dit is de ctor	,
public StringResourceModel(String resourceKey, Component component, IModel<?> model, String defaultValue)
Parameters:
resourceKey - The resource key for this string resource
component - The component that the resource is relative to
model - The model to use for property substitutions
defaultValue - The default value if the resource key is not found.

/ klopt	,
$ vi EvoEditPage.properties
createEntity=Create ${entityName}

/ wicket uses de model new Model<EvoEditPage<T>>(EvoEditPage.this) om this.entityName op te zoeken	,

/ 7	.






/ Einde DEBUG PCT-1046

/ FIX PCT-1046

/ 7	. 

/ Add privilege party-type-group.list toe aan R_PRIVS_PTG
/ Dan u_privs_ptg zien menu	,
configuration
planning
	parties
	party type groups

/ 7	. 

/ six buttons on the party group edit screen	,


/s
EntityActionAjaxButton$1.isEnabled() line: 46	
	@Override
	protected Button createButtonInstance(final IModel<T> aModel, String aId) {
		return new AjaxFallbackButton(aId, null) {
			@Override
			public boolean isEnabled() {
				return EntityActionAjaxButton.this.isEnabled(aModel);
/s
EvoEditFormPage$1(EntityActionButton).isEnabled(IModel<T>) line: 54	
	@Override
	protected boolean isEnabled(IModel<T> aSelection) {
		return true;
	}

/ 7	. 

/ create button on party group list screen	,

@Privilege(object = "party-group", type = "list")
public class PartyGroupListPage extends AbstractMainPage implements EvoEditFormCallback {
	private boolean mayCreate= true;

	@Override
	protected void createPageComponents() {
		mayCreate= AuthenticationUtils.getResource().hasPrivilege("party-group", "create");

	protected void createFormButton() {
		AjaxFallbackButton ajaxFallbackButton = new AjaxFallbackButton("createButton", form) {
			// TODO: use party-group:create privilege, create property mayCreate here.
			@Override
			public boolean isEnabled() {
				return true;
			}

/ 7	.

$ vi PartyListPage.java
	@Override
	protected void createPageComponents() {
		myQuery.getColumns().add(new QueryColumn<String>("party.partytype.code", "p.partyType.code"));
		myQuery.getColumns().add(new QueryColumn<String>("party.organizationVO.code", "p.organizationVO.code"));

$ vi conf/language_en.properties
conf/language_en.properties:party.organizationvo.code=Organization

/ we moeten dus kleine letters geven	,

$ vi language_en.properties
rowaction.confirm.delete=Are you sure you want to delete {0} ?		 / al	,
pg.code=Code
pg.description=Description
pg.organization.code=Organization

/ 7	.

/ we hebben in trunk/module/oms/src/java 
cp com/mpobjects/oms/view/wicket/partygroup com/mpobjects/oms/view/wicket/partygroup/my	,

/ we hebben in com/mpobjects/oms/view/wicket/partygroup
PartyGroupListPage.java -> PartyGroupPage.java
PartyGroupListPage.html -> PartyGroupPage.html
PartyGroupListPage.properties -> PartyGroupPage.properties

$ vi oms-menu.xml
	<m:add path="configuration.planning.partyGroupsList" privilege="party-group.list" actionUrl="wicket?module=oms&amp;wicketpage=partygroup.PartyGroupListPage" index="1052" />
/ RM



/ Einde FIX PCT-1046

/ TRY WICKET PCT-1046 PARTYGROUPLIST

/ 7	.

/ 13	. 

/ we zet voorlopig in oms-menu.xml
    <m:add path="configuration.planning.partyGroupsList" privilege="party-group.list" actionUrl="wicket?module=oms&amp;wicketpage=partygroupmy.PartyGroupListPage" index="1052" />
/ TODO

/ Let op partygroupmy package	,

/ In package com.mpobjects.oms.view.wicket.partygroupmy werken we met PartyGroupListPage	, we rename NIET naar PartyGroupPage	, want het menu item heet ook zo	, dus .java/.html/.properties	,
/ OK



/ Einde TRY WICKET PCT-1046 PARTYGROUPLIST

/ DATABASE BACKUP RESTORE

/ op productie machines  is er /backup 	, waar elke nacht een db backup is gedaan	,

[eric@localhost bin]$ pnl-db-dump-a.sh pnllogistics

[eric@localhost bin]$ scp /home/eric/DB_TAP/Postgres/Backup/pnllogistics-a-2016-01-14.dump vanderveldene@pnl-app-t.intermax.mp-objects.com:Downloads

/ op pnl-app-t	,

[vanderveldene@pnl-app-a ~]$ less /local/apps/jboss-4.0.5.GA/server/pnllogistics/deploy/postgres-ds.xml 
<datasources>
        <xa-datasource>
                <xa-datasource-property name="DatabaseName">pnllogistics</xa-datasource-property>
                <xa-datasource-property name="User">pnllogistics</xa-datasource-property>
                <xa-datasource-property name="Password">90trKR3ZUtORXgNQnLJR</xa-datasource-property>


[vanderveldene@pnl-app-a Downloads]$ PGPASSWORD=90trKR3ZUtORXgNQnLJR psql -U pnllogistics -h localhost
psql (9.3.10)
pnllogistics=> alter schema public rename to public_old;
pnllogistics=> create schema public;
pnllogistics=> grant all on schema public to admin with grant option;
pnllogistics=> grant usage on schema public to reader;
pnllogistics=> grant usage on schema public to writer;
pnllogistics=> commit;
WARNING:  there is no transaction in progress

[vanderveldene@pnl-app-t ~]$ PGPASSWORD=90trKR3ZUtORXgNQnLJR pg_restore -h localhost -d pnllogistics -U pnllogistics --no-acl --no-owner ~vanderveldene/Downloads/pnllogistics-a-2016-01-14.dump 





/ Einde DATABASE BACKUP RESTORE

/ DEPLOY

[eric@localhost tmp]$ scp vanderveldene@pnl-app-t.intermax.mp-objects.com:/local/apps/jboss-4.0.5.GA/server/pnltms/conf/*.properties .
...
/ OK
/ Alle files	,

[eric@localhost tmp]$ scp vanderveldene@geosco-app-t.intermax.mp-objects.com:/home/jboss/releases/tms-geosco-21973-2015.04_build3578.zip .
scp: /home/jboss/releases/tms-geosco-21973-2015.04_build3578.zip: Permission denied
/ Maar	,
[eric@localhost tmp]$ scp vanderveldene@geosco-app-t.intermax.mp-objects.com:/local/apps/releases/tms-geosco-21973-2015.04_build3578.zip .
/ OK
/ Omdat	,
[vanderveldene@geosco-app-a ~]$ ls -ltr /local/apps/
drwxrwxr-x+ 2 jboss    jboss    4096 Jan  9 16:22 releases

/ we kunnen dus NIET scp naar /local/apps/releases	,

/ eric doet naar ~vanderveldene/Downloads	,
[eric@localhost tmp]$ scp tms-geosco-21973-2015.04_build3578.zip  vanderveldene@geosco-app-a.intermax.mp-objects.com:Downloads
/ op geosco-app-a	, als jboss	,
[jboss@geosco-app-a ~]$ cp -a ~vanderveldene/Downloads/tms-geosco-21973-2015.04_build3578.zip releases/

/ Einde DEPLOY

/ DEPLOY 


/ DEBUG PCT-1046 

/ we debug Parties	, PartyListPage	,
/s
	PartyListPage.createPageComponents() line: 54	
		mayDelete = AuthenticationUtils.getResource().hasPrivilege("party", "delete");

	PartyListPage(AbstractPage).initializePage() line: 76	
		...
		createPageComponents();
	PartyListPage(AbstractMainPage).initializePage() line: 57	
		...
->		super.initializePage();
	PartyListPage(AbstractPage).onInitialize() line: 91	
		...
->		initializePage();

	PartyListPage(Component).fireInitialize() line: 4105	
	PartyListPage(MarkupContainer).initialize() line: 433	
	PartyListPage(Page).prepareForRender(boolean) line: 1543	
	PartyListPage(Component).prepareForRender() line: 2329	
	PartyListPage(Page).renderPage() line: 912	
	MpoWebRequestCycle(WebRequestCycle).redirectTo(Page) line: 201	
	PageRequestTarget.respond(RequestCycle) line: 58	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/ 7	. 

/ in scs: EntityDetachableModel	, 
/ in wicket 1.4: LoadableDetachableModel	,

/7	.
QueryViewPanel.<init>(String, IModel<QueryDefinition>, List<RowAction>, List<GroupAction>, Set<Serializable>) line: 112	
	public QueryViewPanel(String aId, IModel<QueryDefinition> aModel, List<RowAction> rowActions, List<GroupAction> aGroupActionList,
			Set<Serializable> preselection) {
		super(aId, aModel);
		queryDefinition = aModel.getObject();
		initFilter();
		initState();
/d
this	QueryViewPanel  (id=24349)	
	activeFilter	EntityDetachableModel  (id=26167)	
		attached	true	
		attachedVolatile	true	
		dao	BeanWrapper  (id=26183)	
			LOG	Log4JLogger  (id=24733)	
			bean	null	
			beanName	null	
			type	Class (com.mpobjects.oms.dao.filter.FilterDAO) (id=8867)	
		entity	Filter  (id=25773)	
			code	"system" (id=26005)	
			configuration	null	
			description	null	
			organization	null	
			owner	null	
			performanceMonitorService	null	
			sequence	0	
			sourceId	null	
			system	true	
			systemId	0	
		systemId	0	
	columnDefinition	ArrayList  (id=27617)	
	currentPage	1	
	dao	null	
	data	Model  (id=24332)	
		object	QueryDefinition  (id=23734)	
			serviceOrderSubQueryForParty	"select s_ord.systemId from ServiceOrderVO s_ord where (s_ord.template = 0 and s_ord.executedByPartyVO.systemId in (select upart.party.systemId from UserParty upart where upart.resource.systemId =:userSystemId)) or s_ord.systemId in ( select service_o.systemId from ServiceOrderVO service_o, ServiceOrderType so_type, ServiceOrderVO so_following, ServiceOrderType sot_following, ConsignmentVO consig, ConsignmentVO c_fol, ServiceActionVO sr_a, ServiceActionVO sra_fol, ShipmentOrderVO shor where service_o.serviceOrderType.systemId = so_type.systemId and service_o.template = 0 and so_following.serviceOrderType.systemId =  sot_following.systemId and sot_following.follows.systemId = so_type.systemId and service_o.systemId = consig.serviceOrderVO.systemId and consig.systemId = sr_a.consignmentVO.systemId and shor.systemId = sr_a.shipmentOrderVO.systemId and so_following.systemId = c_fol.serviceOrderVO.systemId and c_fol.systemId = sra_fol.consignmentVO.systemId and shor.systemId = sra_fol.shipmentOrderVO.systemId and so_following.executedByPartyVO.systemId in (select upart.party.systemId from UserParty upart where upart.resource.systemId =:userSystemId))" (id=23924)	
/ Hardcoded	,
			columns	ArrayList  (id=23878)	
[systemId, party.partytype.code, party.organizationVO.code, party.partyid, party.name, party.name2, party.address, party.address2, party.postalCode, party.city, party.regionState, party.country.code, party.contactName, party.emailAddress, party.faxNumber, party.phoneNumber]
			filterEnabled	true	
			fromClause	"from PartyVO as p" (id=23790)	
			id	"party" (id=23736)	
			organizationField	"p.organizationVO" (id=23791)	
			parameters	HashMap  (id=24181)	
			preFiltered	false	
			preFilterParameters	ArrayList  (id=24182)	
			rowStyle	null	
			serviceOrderQuery	false	
			sortBy	ArrayList  (id=24183)	
				elementData	Object[10]  (id=24186)	
					[0]	SortColumn  (id=24171)	
						sortColumn	QueryColumn  (id=24061)	
							name	"party.partyid" (id=24045)	
							property	"p.partyId" (id=27780)	
			userPartyCodeField	null	
			userPartySystemIdField	null	
			whereClause	"p.deleted = 0" (id=24184)	
	queryStateModel	Model  (id=22157)	
		object	QueryState  (id=22649)	
			displayColumns	ArrayList  (id=22723)	
[party.partytype.code, party.organizationVO.code, party.partyid, party.name, party.name2, party.address, party.address2, party.postalCode, party.city, party.regionState, party.country.code, party.contactName, party.emailAddress, party.faxNumber, party.phoneNumber]
			filterExpressions	ArrayList  (id=22724)	
[com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@5782145b, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@1d068f3f, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@19a67ffc, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@21c868c, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@1ec55269, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@2ca57b47, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@24408937, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@8f08c79, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@68966084, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@689aafc0, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@3889be7, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@7db35c80, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@a7e17f9, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@5c57e1d0, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@daa4e0d]
			searchQuery	null	
			sortAsc	false	
			sortColumn	null	
			systemColumns	ArrayList  (id=22725)	
[systemId]

/ Dus een QueryViewPanel heeft een 
	data=Model, target=QueryDefinition	, 
	queryStateModel=Model, target=QueryState	,

		if (rowActions != null) {
			rowActionList = rowActions;

rowActionList	ArrayList  (id=20664)	
	elementData	Object[10]  (id=23229)	
		[0]	PartyListPage$2  (id=23232)	
edit
		[1]	PartyListPage$3  (id=23233)	
delete

		createComponents();

/ Intermezzo


/ Wat is QueryDefinition en wat is QueryState	?

	QueryStateParser.toQueryState(Filter, QueryDefinition) line: 56	
/ see hieronder	,
	FilterBarPanel.updateQueryState() line: 469	
		viewPanel.getQueryStateModel().setObject(QueryStateParser.toQueryState(filterModel.getObject(), getQueryDefinition()));

	FilterBarPanel.<init>(String, QueryViewPanel) line: 73	
		updateQueryState();

	QueryViewPanel.createFilterBar() line: 796	
		return new FilterBarPanel("filter-bar", QueryViewPanel.this);

	QueryViewPanel.addSearchBar() line: 746	
			mySearchBar.add(createFilterBar());

	QueryViewPanel.createComponents() line: 381	
		addSearchBar();

	QueryViewPanel.<init>(String, IModel<QueryDefinition>, List<RowAction>, List<GroupAction>, Set<Serializable>) line: 120	
	QueryViewPanel.<init>(String, IModel<QueryDefinition>, List<RowAction>, List<GroupAction>) line: 102	
	PartyListPage.createPageComponents() line: 128	
	PartyListPage(AbstractPage).initializePage() line: 76	
	PartyListPage(AbstractMainPage).initializePage() line: 57	
		...
		createPageComponents();

	PartyListPage(AbstractPage).onInitialize() line: 91	
		super.onInitialize();
		processPageParameters();
		initializePage();

	PartyListPage(Component).fireInitialize() line: 4105	
	PartyListPage(MarkupContainer).initialize() line: 433	
	PartyListPage(Page).prepareForRender(boolean) line: 1543	
	PartyListPage(Component).prepareForRender() line: 2329	
	PartyListPage(Page).renderPage() line: 912	
	MpoWebRequestCycle(WebRequestCycle).redirectTo(Page) line: 201	
	PageRequestTarget.respond(RequestCycle) line: 58	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/s
QueryStateParser.toQueryState(Filter, QueryDefinition) line: 56	
...

aQueryDefinition	QueryDefinition  (id=23734)	
	serviceOrderSubQueryForParty	"select s_ord.systemId from ServiceOrderVO s_ord where (s_ord.template = 0 and s_ord.executedByPartyVO.systemId in (select upart.party.systemId from UserParty upart where upart.resource.systemId =:userSystemId)) or s_ord.systemId in ( select service_o.systemId from ServiceOrderVO service_o, ServiceOrderType so_type, ServiceOrderVO so_following, ServiceOrderType sot_following, ConsignmentVO consig, ConsignmentVO c_fol, ServiceActionVO sr_a, ServiceActionVO sra_fol, ShipmentOrderVO shor where service_o.serviceOrderType.systemId = so_type.systemId and service_o.template = 0 and so_following.serviceOrderType.systemId =  sot_following.systemId and sot_following.follows.systemId = so_type.systemId and service_o.systemId = consig.serviceOrderVO.systemId and consig.systemId = sr_a.consignmentVO.systemId and shor.systemId = sr_a.shipmentOrderVO.systemId and so_following.systemId = c_fol.serviceOrderVO.systemId and c_fol.systemId = sra_fol.consignmentVO.systemId and shor.systemId = sra_fol.shipmentOrderVO.systemId and so_following.executedByPartyVO.systemId in (select upart.party.systemId from UserParty upart where upart.resource.systemId =:userSystemId))" (id=23924)	
	columns	ArrayList  (id=23878)	
[systemId, party.partytype.code, party.organizationVO.code, party.partyid, party.name, party.name2, party.address, party.address2, party.postalCode, party.city, party.regionState, party.country.code, party.contactName, party.emailAddress, party.faxNumber, party.phoneNumber]
	filterEnabled	true	
	fromClause	"from PartyVO as p" (id=23790)	
	id	"party" (id=23736)	
	organizationField	"p.organizationVO" (id=23791)	
	parameters	HashMap  (id=24181)	
	preFiltered	false	
	preFilterParameters	ArrayList  (id=24182)	
	rowStyle	null	
	serviceOrderQuery	false	
	sortBy	ArrayList  (id=24183)	
	userPartyCodeField	null	
	userPartySystemIdField	null	
	whereClause	"p.deleted = 0" (id=24184)	

myState	QueryState  (id=28277)	
	displayColumns	ArrayList  (id=28362)	
[party.partytype.code, party.organizationVO.code, party.partyid, party.name, party.name2, party.address, party.address2, party.postalCode, party.city, party.regionState, party.country.code, party.contactName, party.emailAddress, party.faxNumber, party.phoneNumber]
	filterExpressions	ArrayList  (id=28363)	
[com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@cfe81fa, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@19074ac0, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@2dbc9016, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@3697abcf, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@1f90bf09, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@57edf80f, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@4838cde2, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@954d579, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@208affb8, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@59a99b9, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@68e2438e, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@5ec1556d, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@66cf97b4, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@46f0df27, com.mpobjects.oms.view.wicket.entityview.filter.TextFilterExpression@6fca9dd3]
/ alle columns	, de 1ste is party.partytype.code	,
	searchQuery	null	
	sortAsc	false	
	sortColumn	null	
	systemColumns	ArrayList  (id=28364)	
[systemId]

/ Einde Intermezzo

/ we gingen	,
		createComponents();
/s
QueryViewPanel.createComponents() line: 381	
		addSearchBar();
/s
QueryViewPanel.addSearchBar() line: 746	
		if (queryDefinition.isFilterEnabled() && !queryDefinition.getFilterableColumns().isEmpty()) {
			mySearchBar.add(createFilterBar());
/s
QueryViewPanel.createFilterBar() line: 796	
		return new FilterBarPanel("filter-bar", QueryViewPanel.this);
/s
FilterBarPanel.<init>(String, QueryViewPanel) line: 85	
/=
	public FilterBarPanel(String id, QueryViewPanel aViewPanel) {
		TextField<String> myTextField = new TextField<String>("search-query", new PropertyModel<String>(getQueryStateModel(), "searchQuery"));

/ TODO (Afmaken)

/ 7	. 

/ we geven 
/c
Daemon Thread [http-0.0.0.0-8080-6] (Suspended (breakpoint at line 285 in QueryViewPanel$1))	
	QueryViewPanel$1.populateItem(ListItem<QueryColumn<?>>) line: 285	
/=
	protected void addHeaderRow() {
		ListView<QueryColumn<?>> myHeader = new ListView<QueryColumn<?>>("header", new PropertyModel<List<QueryColumn<?>>>(queryStateModel, "queryColumns")) {
			@Override
			protected void populateItem(ListItem<QueryColumn<?>> aItem) {
->				QueryColumn myColumn = aItem.getModelObject();

	QueryViewPanel$1(ListView).onPopulate() line: 562	
	QueryViewPanel$1(AbstractRepeater).onBeforeRender() line: 131	
	QueryViewPanel$1(Component).internalBeforeRender() line: 1069	
	QueryViewPanel$1(Component).beforeRender() line: 1103	
	QueryViewPanel(MarkupContainer).onBeforeRenderChildren() line: 1777	
	QueryViewPanel(Component).onBeforeRender() line: 4001	
	QueryViewPanel(Component).internalBeforeRender() line: 1069	
	QueryViewPanel(Component).beforeRender() line: 1103	
	PartyListPage(MarkupContainer).onBeforeRenderChildren() line: 1777	
	PartyListPage(Component).onBeforeRender() line: 4001	
	PartyListPage(Page).onBeforeRender() line: 1555	
	PartyListPage(Component).internalBeforeRender() line: 1069	
	PartyListPage(Component).beforeRender() line: 1103	
	PartyListPage(Component).prepareForRender(boolean) line: 2297	
	PartyListPage(Page).prepareForRender(boolean) line: 1545	
	PartyListPage(Component).prepareForRender() line: 2329	
	PartyListPage(Page).renderPage() line: 912	
	MpoWebRequestCycle(WebRequestCycle).redirectTo(Page) line: 201	
	PageRequestTarget.respond(RequestCycle) line: 58	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/ we zien geen onRender() method call	,
/ TODO

/s
QueryViewPanel$1.populateItem(ListItem<QueryColumn<?>>) line: 286	
/=
	protected void addHeaderRow() {
		ListView<QueryColumn<?>> myHeader = new ListView<QueryColumn<?>>("header", new PropertyModel<List<QueryColumn<?>>>(queryStateModel, "queryColumns")) {
			@Override
			protected void populateItem(ListItem<QueryColumn<?>> aItem) {
->				QueryColumn myColumn = aItem.getModelObject();
myColumn	IdQueryColumn  (id=22671)	
systemId
				if (myColumn.isId()) {
					if (groupActionList.size() > 0) {
/ NEE
					} else {
						aItem.add(new Label("column-header", ""));

/ Dan vanuit ListView.onPopulate komen we in de volgende call op populateItem	,

	protected void addHeaderRow() {
		ListView<QueryColumn<?>> myHeader = new ListView<QueryColumn<?>>("header", new PropertyModel<List<QueryColumn<?>>>(queryStateModel, "queryColumns")) {
			@Override
			protected void populateItem(ListItem<QueryColumn<?>> aItem) {
->				QueryColumn myColumn = aItem.getModelObject();
				if (myColumn.isId()) {
/ NEE
				} else if (myColumn.isSort()) {
					aItem.add(new SortableColumnHeader("column-header", myColumn, QueryViewPanel.this));

/ 13. 	

/ we geloven het	, 
/c

	QueryViewPanel$4.loadEntriesFromDatabase(int, int) line: 788	
	QueryViewPanel$4.iterator(int, int) line: 759	
	QueryViewPanel.showAll() line: 814	
	QueryViewPanel.getRowsOnPage() line: 217	
	GeneratedMethodAccessor1299.invoke(Object, Object[]) line: not available	
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
	Method.invoke(Object, Object...) line: 606	
	PropertyResolver$MethodGetAndSet.getValue(Object) line: 1124	
	PropertyResolver$ObjectAndGetSetter.getValue() line: 649	
	PropertyResolver.getValue(String, Object) line: 101	
	PropertyModel(AbstractPropertyModel).getObject() line: 130	
	QueryViewPanel$3(Component).getDefaultModelObject() line: 1729	
	QueryViewPanel$3(ListView).getViewSize() line: 220	
	QueryViewPanel$3(ListView).onPopulate() line: 511	
	QueryViewPanel$3(AbstractRepeater).onBeforeRender() line: 131	
	QueryViewPanel$3(Component).internalBeforeRender() line: 1069	
	QueryViewPanel$3(Component).beforeRender() line: 1103	
	QueryViewPanel(MarkupContainer).onBeforeRenderChildren() line: 1777	
	QueryViewPanel(Component).onBeforeRender() line: 4001	
	QueryViewPanel(Component).internalBeforeRender() line: 1069	
	QueryViewPanel(Component).beforeRender() line: 1103	
	PartyListPage(MarkupContainer).onBeforeRenderChildren() line: 1777	
	PartyListPage(Component).onBeforeRender() line: 4001	
	PartyListPage(Page).onBeforeRender() line: 1555	
	PartyListPage(Component).internalBeforeRender() line: 1069	
	PartyListPage(Component).beforeRender() line: 1103	
	PartyListPage(Component).prepareForRender(boolean) line: 2297	
	PartyListPage(Page).prepareForRender(boolean) line: 1545	
	PartyListPage(Component).prepareForRender() line: 2329	
	PartyListPage(Page).renderPage() line: 912	
	MpoWebRequestCycle(WebRequestCycle).redirectTo(Page) line: 201	
	PageRequestTarget.respond(RequestCycle) line: 58	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/s
QueryViewPanel$4.iterator(int, int) line: 759	
/=
	private void createDataProvider() {

		dataProvider = new SortableDataProvider<List<Object>>() {

			@Override
			public Iterator<List<Object>> iterator(int first, int count) {
->				return loadEntriesFromDatabase(first, count).iterator();
/s
QueryViewPanel$4.loadEntriesFromDatabase(int, int) line: 776	
/=
			private List<List<Object>> loadEntriesFromDatabase(int first, int count) {
				List<List<Object>> items = new ArrayList<List<Object>>();
				Query myCount = createSelectQuery();
/s
QueryViewPanel.createSelectQuery() line: 403	
		return QueryBuilder.buildSelectQuery(getDAO().getCurrentSession(), queryDefinition, queryStateModel.getObject(), true);
/t
				Query myCount = createSelectQuery();
Query=org.hibernate.Query 	,
/d
QueryImpl(select p.systemId, p.partyType.code, p.organizationVO.code, p.partyId, p.name, p.name2, p.address, p.address2, p.postalCode, p.city, p.regionState, p.country.code, p.contactName, p.emailAddress, p.faxNumber, p.phoneNumber 
from PartyVO as p 
where (p.organizationVO in (select uo.organization from UserOrganization uo where uo.resource.systemId =:userSystemId))  and ( p.deleted = 0 ) 
order by p.partyId)
				List myResult = myCount.list();
				for (Object myObject : myResult) {
					if (myObject instanceof Object[])
					{
						Object[] myLine = (Object[]) myObject;
						items.add(Arrays.asList(myLine));
					}
				}
				return items;

/ 13	. 

/c
	QueryViewPanel$3$1.<init>(QueryViewPanel$3, String, IModel, ListItem) line: 598	
	QueryViewPanel$3.populateItem(ListItem<List<Object>>) line: 598	
	QueryViewPanel$3(ListView).onPopulate() line: 562	
	QueryViewPanel$3(AbstractRepeater).onBeforeRender() line: 131	
	QueryViewPanel$3(Component).internalBeforeRender() line: 1069	
	QueryViewPanel$3(Component).beforeRender() line: 1103	
	QueryViewPanel(MarkupContainer).onBeforeRenderChildren() line: 1777	
	QueryViewPanel(Component).onBeforeRender() line: 4001	
	QueryViewPanel(Component).internalBeforeRender() line: 1069	
	QueryViewPanel(Component).beforeRender() line: 1103	
	PartyListPage(MarkupContainer).onBeforeRenderChildren() line: 1777	
	PartyListPage(Component).onBeforeRender() line: 4001	
	PartyListPage(Page).onBeforeRender() line: 1555	
	PartyListPage(Component).internalBeforeRender() line: 1069	
	PartyListPage(Component).beforeRender() line: 1103	
	PartyListPage(Component).prepareForRender(boolean) line: 2297	
	PartyListPage(Page).prepareForRender(boolean) line: 1545	
	PartyListPage(Component).prepareForRender() line: 2329	
	PartyListPage(Page).renderPage() line: 912	
	MpoWebRequestCycle(WebRequestCycle).redirectTo(Page) line: 201	
	PageRequestTarget.respond(RequestCycle) line: 58	
	WebRequestCycleProcessor(AbstractRequestCycleProcessor).respond(RequestCycle) line: 105	
	MpoWebRequestCycle(RequestCycle).processEventsAndRespond() line: 1287	
	MpoWebRequestCycle(RequestCycle).step() line: 1358	
	MpoWebRequestCycle(RequestCycle).steps() line: 1465	
	MpoWebRequestCycle(RequestCycle).request() line: 545	
	WicketFilter.doGet(HttpServletRequest, HttpServletResponse) line: 486	
	WicketServlet.doGet(HttpServletRequest, HttpServletResponse) line: 138	
	WicketServlet(HttpServlet).service(HttpServletRequest, HttpServletResponse) line: 697	
	WicketServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 810	

/s
QueryViewPanel$3$1.<init>(QueryViewPanel$3, String, IModel, ListItem) line: 598	
/=
	private void addDataRows() {

		dataView = new ListView<List<Object>>("rows", new PropertyModel<List<List<Object>>>(QueryViewPanel.this, "rowsOnPage")) {

			@Override
			protected void populateItem(final ListItem<List<Object>> aRow) {

->				final ListView<Object> myRow = new ListView<Object>("cell", aRow.getModel()) {
					...
				aRow.add(myRow);

/ aRow is vertical, er is er maar 1 van WH	, 

/ Intermezzo

aRow	ListItem  (id=25213)	
	data	ListItemModel  (id=25169)	
		index	0	
		listView	QueryViewPanel$3  (id=25144)	

/ Wat is dit voor een model	?
/ TODO

/ Einde Intermezzo










/ Einde DEBUG PCT-1046 

/ SSH

/ 13	. 

/ ssh -t creates  een pseudo terminal	, 

[eric@localhost bin]$ ssh -t vanderveldene@pnl-app-t.intermax.mp-objects.com "sudo su - jboss
/ vanwege de - in het su command	, wordt er ook een bash create	, en verwacht WH een tty, pts	, dus moeten we aan ssh een -t geven: ssh maakt de tty of pts	, 

/ bash creates ook een tty
/ TODO

/ als we een cmd willen laten exec als jboss, moeten we niet de - use	, maar
su jboss <cmd>
/ TODO

/ Lees 
$ man su

/ 13	. 

/ je ziet tree	 van commands, 	kill de root van chrome	,
$ ps ajxf
    1   771   771   771 ?           -1 Ssl      0   0:02 /usr/sbin/gdm
  771   851   771   771 ?           -1 Sl       0   0:00  \_ /usr/libexec/gdm-simple-slave --display-id /org/gnome/DisplayManager/D
  851   919   919   919 tty1       919 Ssl+     0 1516:18      \_ /usr/bin/Xorg :0 -background none -verbose -auth /run/gdm/auth-fo
  851  1891   771   771 ?           -1 Sl       0   0:05      \_ gdm-session-worker [pam/gdm-password]
 1891  1909  1909  1909 ?           -1 Ssl   1000   0:04          \_ gnome-session
 1909  2098  1909  1909 ?           -1 Sl    1000   2:20              \_ /usr/libexec/gnome-settings-daemon
 2098  2181  1909  1909 ?           -1 S     1000   0:51              |   \_ syndaemon -i 1.0 -t -K -R
 1909  2179  1909  1909 ?           -1 Sl    1000 1494:50              \_ /usr/bin/gnome-shell
 2179   545  1909  1909 ?           -1 SLl   1000  71:37              |   \_ /opt/google/chrome/chrome 
  545   553  1909  1909 ?           -1 S     1000   0:00              |       \_ cat
  545   554  1909  1909 ?           -1 S     1000   0:00              |       \_ cat
  545   556  1909  1909 ?           -1 S     1000   0:00              |       \_ /opt/google/chrome/chrome-sandbox /opt/google/chro
  556   557  1909  1909 ?           -1 S     1000   0:00              |           \_ /opt/google/chrome/chrome --type=zygote
  557   562  1909  1909 ?           -1 S     1000   0:00              |               \_ /opt/google/chrome/chrome-sandbox /opt/goo
  562   563  1909  1909 ?           -1 S     1000   0:00              |               |   \_ /opt/google/chrome/nacl_helper
  557   565  1909  1909 ?           -1 S     1000   0:00              |               \_ /opt/google/chrome/chrome --type=zygote
  565   617  1909  1909 ?           -1 Sl    1000   0:12              |                   \_ /opt/google/chrome/chrome --type=rende
  565   633  1909  1909 ?           -1 Sl    1000   0:01              |                   \_ /opt/google/chrome/chrome --type=rende

/ 13	. 

/ Lees	,
https://en.wikipedia.org/wiki/Emscripten


/ Einde SSH


/ PAT-149

/ 13	. 

/ planning, shipment order , create
shipment-order-template_list

/ Daar staan 2 buttons op	, 'Create new template'	 en 'Create new order'	,

/ we zien in devtools ,	 in HTML	,
<button type="button" onclick="location.href='shipment-order-template_create?systemid=0&amp;base_sessionLevelOffset=1'">Create new template</button>
<button type="button" onclick="location.href='shipment-order_create?systemid=0&amp;base_sessionLevelOffset=1'">Create new order</button>

/ WH 	,
$ vi shipment-order-template_list.xsl

   <xsl:template name="custom_footer">
        <p> 
        <button type="button">
        	<xsl:attribute name="onclick"> 
            	<xsl:text>location.href='shipment-order-template_create?systemid=0&amp;base_sessionLevelOffset=1'</xsl:text>
            </xsl:attribute>
            <i18n:text>create.new.template</i18n:text>
        </button>&#160;&#160;     
         <button type="button">
         	<xsl:attribute name="onclick">
         		<xsl:text>location.href='</xsl:text>
         		<xsl:value-of select="//shipment-order-create-url"></xsl:value-of>
         		<xsl:text>?systemid=0&amp;base_sessionLevelOffset=1'</xsl:text>
         	</xsl:attribute>
         	<i18n:text>create.new.order</i18n:text>
         </button>
         </p>
    </xsl:template>

$ vi shipment-order-template_list.xml

   <filter-param name="shipment-order-create-url" defaultValue="shipment-order_create"/>
    <xsp:logic>
	       String myShipmentOrderCreateURL = "";  
    													        //shipment-order-create-url
            myShipmentOrderCreateURL = request.getParameter("shipment-order-create-url");
            if (StringUtils.isEmpty(myShipmentOrderCreateURL)){
                myShipmentOrderCreateURL = "shipment-order_create";
            }
    </xsp:logic>
    <actions>
        <shipment-order-create-url><xsp:expr>myShipmentOrderCreateURL</xsp:expr></shipment-order-create-url>
    </actions>

/ Dus shipment-order-template_create is  direct	, shipment-order_create via shipment-order-template_list.xml	, 
/ TODO

/13	. 

/ Naam2 op op 2 tabs naast Ship from, Ship to	,

$ vi oms-sitemap.xmap

			<map:action logger="shipmentorder" name="shipmentOrderCreate" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderCreateAction"/>
			<map:match pattern="shipment-order_create">
				<map:act type="shipmentOrderCreate"/>
				<map:select type="session-attribute">
					<map:parameter name="attribute-name" value="builder"/>
					<map:when test="jsp">
						<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order_edit.jsp"/>

			<map:action logger="shipmentorder" name="shipmentOrderEdit" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderEditAction"/>
			<map:match pattern="shipment-order_edit">
				<map:act type="shipmentOrderEdit">
					<map:select type="session-attribute">
						<map:parameter name="attribute-name" value="builder"/>
						<map:when test="jsp">
							<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order_edit.jsp"/>


$ vi shipment-order_edit.jsp

$ vi ./module/oms/war/WEB-INF/tags/oms/shipfrom.tag

/ we set een conditional break op FieldTag.doStartTag	,
this.getName().equals("name2")
/ OK

this.name.equals("name2")
/ ERR



/ 13	. 

$ vi oms-sitemap.xmap

			<map:match pattern="shipment-order-template_create">
				<map:act type="shipmentOrderTemplateCreate"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order-template_edit.jsp"/>
			</map:match>



$ vi shipment-order-template_edit.jsp



/ Intermezzo

/ hidden, required,	readonly, maxlength zijn properties	, voor ApplicationPropertyManager	, naast properties in de db zijn er ook	, ze zijn
/ Als label moet print	, dan wordt LanguageManager called	, met language.properties	,

/ Einde Intermezzo

/ 13	. 

/ language key for shipment order party tabs	,

pnltms=# select party_type_group from party_type_group where is_deleted=0;
 party_type_group 
------------------
 DELIVERY
 BILL_TO
 SERVICE_PROVIDER
 PREFERRED_PARTY
 OVERSLAG
 COLLECTION
 VIA
 HUB
(8 rows)

/ Dus in de jsp is ${party.partyTypeGroup.code} dus OVERSLAG bijv	,

/ Maar in dezelfde table zien we ook	,
pnltms=# select*from party_type_group;
 system_id | party_type_group |           description            | is_deleted | show_on_sho | show_on_so | is_system | show_o
n_co | show_on_col 
-----------+------------------+----------------------------------+------------+-------------+------------+-----------+-------
-----+-------------
  26691616 | OVERSLAG         | Hub stadslogistiek               |          0 |           1 |          0 |         0 |       
   0 |           0

/ dus als we een sho create	, zien we OVERSLAG	,
/ Klopt	,

/ als we een bestaande sho hebben , moeten we kijken in de join table shipment_order_party	,
pnltms=# select shipment_order_systemid ,party_type_group_systemid from shipment_order_party;
 shipment_order_systemid | party_type_group_systemid 
-------------------------+---------------------------
                26698561 |                  26691616
                26698564 |                  26691616

/ welke party_type_group's zien we ?

pnltms=# select  shipment_order_systemid,party_type_group_systemid from shipment_order_party shop join party_type_group ptg on shop.party_type_group_systemid = ptg.system_id where ptg.party_type_group='VIA';
 shipment_order_systemid | party_type_group_systemid 
-------------------------+---------------------------
(0 rows)
/ In mijn database zijn er allemaal OVERSLAG	,


/ FIX PAT-149

$ vi sho-billto.tag

			<mpo:setFormVO valueObject="${formVO.billToPartyVO}" prefix="billTo">
				<mpo:field name="name" />
				<mpo:field languageKey="billto.name2" name="name2" />
/al	,

$ vi sho-party.tag

				<mpo:setFormVO valueObject="${party}" prefix="${party.partyTypeGroup.code}">
					<mpo:field name="name" />
->					<mpo:field name="name2" languageKey="${party.partyTypeGroup.code}.name2"/>

/ De languageKey "OVERSLAG.name2" wordt door StringUtils.formatJavaToSql o_v_e_r_s_l_a_g.name2	,
/ De languageKey "BILL_TO.name2" wordt door StringUtils.formatJavaToSql b_i_l_l__t_o.name2	,
/ de 1ste char wordt kleine letter	, en de andere hoofdletters worden klein, en een _ ervoor	, de _ blijft onveranderd	,

pnltms=# select party_type_group from party_type_group where is_deleted=0;
 party_type_group 
------------------
 DELIVERY
 BILL_TO
 SERVICE_PROVIDER
 PREFERRED_PARTY
 OVERSLAG
 COLLECTION
 VIA
 HUB
(8 rows)

/ Deze zetten we dus allemaal in de language file language_en_GB_pnltms.properties.

pnltms.table_shipment_order_d_e_l_i_v_e_r_y.name2=Location Barcode
pnltms.table_shipment_order_b_i_l_l__t_o.name2=Location Barcode
pnltms.table_shipment_order_s_e_r_v_i_c_e__p_r_o_v_i_d_e_r.name2=Location Barcode
pnltms.table_shipment_order_p_r_e_f_e_r_r_e_d__p_a_r_t_y.name2=Location Barcode
pnltms.table_shipment_order_o_v_e_r_s_l_a_g.name2=Location Barcode
pnltms.table_shipment_order_c_o_l_l_e_c_t_i_o_n.name2=Location Barcode
pnltms.table_shipment_order_v_i_a.name2=Location Barcode
pnltms.table_shipment_order_h_u_b.name2=Location Barcode


/ Einde FIX PAT-149 

t
/ Einde PAT-149

/ DEBUG FROMVO 

/ ShipmentOrderView is niet bijzonders	, gewoon created in de shipment-order_edit.jsp	,

/ we hebben b's set	, en we click 'Create new order' op Planning,  Shipment order, Create	,

/s
$ vi ShipmentOrderCreateAction.class
	public Map act() throws java.lang.Exception {

		ShipmentOrderVO myVO = MpoBeanFactory.getBean(ShipmentOrderService.class).create(myTemplate);
		Session mySession = myRequest.getSession();
		mySession.setAttribute(ShipmentOrderView.ACTIVE_SHIPMENTORDER, myVO);

/ Dus een met new created sho	,

/c
shipment-order_edit.jsp line: 30	
<jsp:useBean id="myShipmentOrderView" scope="session" class="com.mpobjects.oms.view.shipmentorder.ShipmentOrderView" />
<%
	myShipmentOrderView.init(request);
/s
ShipmentOrderView.init(HttpServletRequest) line: 108	
		super.init(aRequest, null);
/s
ShipmentOrderView(AbstractView).init(HttpServletRequest, HttpServletResponse) line: 97	
		setRequest(aRequest);
		setResponse(aResponse);
		setSession(theRequest.getSession());
		setSessionManager(new SessionManagerImpl(getSession()));
		if (getRequest().getAttribute("requestManager") != null) {
			setRequestManager((RequestManager) getRequest().getAttribute("requestManager"));
/c
shipment-order_edit.jsp line: 40	
<jsp:useBean id="theResource" scope="session" class="com.mpobjects.oms.view.resource.ResourceView" />
<%
	theResource.init(request);
	ShipmentOrderVO myVO = myShipmentOrderView.getShipmentOrderVO();
/s
ShipmentOrderView.getShipmentOrderVO() line: 95	
		return getActive();
/s
ShipmentOrderView.getActive() line: 117	
		ShipmentOrderVO myActive = (ShipmentOrderVO) getSession().getAttribute(ACTIVE_SHIPMENTORDER);
ACTIVE_SHIPMENTORDER="active_shipment_order"
ShipmentOrder: (SystemId:0; Org:PNL-TMS-AB)
/ Klopt	, deze was created in de action, en in de session set	,

/c
$ vi shipment-order_edit.jsp

	request.setAttribute("formVO", myVO);

/c
	<mpo:form name="shipmentorder" action="shipment-order_save" entity="shipmentOrder" readOnly="${readOnly}">
		<div id="shipmentOrderDetails">
					<mpo:setFormVO valueObject="${formVO}">

/c
		<mpo:tabCollection name="location" defaultTab="${formVO.shipmentOrderProcess=='INBOUND'?'shipFrom':'shipTo'}">
			<mpo:tab name="shipFrom">
				<tmstags:shipfrom formid="shipmentorder" />

/c
shipment-order_edit.jsp line: 534	
				<c:forEach var="myShipmentOrderParty" items="${formVO.shipmentOrderParties}">
					<mpo:defineTab name="${myShipmentOrderParty.partyTypeGroup.code}" />
/s
ShipmentOrderVO.getShipmentOrderParties() line: 1690	
		return theShipmentOrderPartyList;
[com.mpobjects.oms.model.entity.shipmentorderparty.ShipmentOrderParty@2779fea[shipmentOrder=ShipmentOrder: (SystemId:0; Org:PNL-TMS-AB),name=,partyTypeGroup=theSystemId: 26691616PartyTypeGroup :OVERSLAG]]

/c
$ vi shipfrom.tag
			<mpo:setFormVO valueObject="${formVO.fromPartyVO}" prefix="from">
				<mpo:field languageKey="shipfrom.name2" name="name2" overRideable="true" />

/c
$ vi shipment-order_edit.jsp
 
			<c:forEach var="myShipmentOrderParty" items="${formVO.shipmentOrderParties}">

	 			<mpo:tab name="${myShipmentOrderParty.partyTypeGroup.code}">
					<tmstags:sho-party party="${myShipmentOrderParty}" />

/s
ShipmentOrderVO.getShipmentOrderParties() line: 1690	
		return theShipmentOrderPartyList;
[com.mpobjects.oms.model.entity.shipmentorderparty.ShipmentOrderParty@2779fea[shipmentOrder=ShipmentOrder: (SystemId:0; Org:PNL-TMS-AB),name=,partyTypeGroup=theSystemId: 26691616PartyTypeGroup :OVERSLAG]]

$ vi sho-party.tag

				<mpo:setFormVO valueObject="${party}" prefix="${party.partyTypeGroup.code}">
					<mpo:field name="name" />
					<mpo:field name="name2" />

/ ${party} in sho-party.tag komt 
<mpo:setFormVO valueObject="${party}" prefix="${party.partyTypeGroup.code}">
/ dus uit shipment-order_edit.jsp 
<c:forEach var="myShipmentOrderParty" items="${formVO.shipmentOrderParties}">

/ de prefix is variabel	,

$ vi PartyTypeGroupVO.java
	private String thePartyTypeGroup;
	@Override
	public String getCode() {
		return getPartyTypeGroup();
	}

	public String getPartyTypeGroup() {
		return thePartyTypeGroup;
	}

/ Einde DEBUG FROMVO 

/ DEBUG PAT-149

/ we hebben conditional b op FieldTag.doStartTag	,
this.getName().equals("name2")

/s
shipfrom.tag line: 52	
				<mpo:field languageKey="shipfrom.name2" name="name2" overRideable="true" />
/s
FieldTag.doStartTag() line: 319	
		if (isFieldContextForm()) {
			handleOverridable();
/s
FieldTag.handleOverridable() line: 1217	
			String myHiddenPropertyValue = checkForPropertyOverwrites(getName(), "hidden");
/s
FieldTag.checkForPropertyOverwrites(String, String) line: 227	
/=
	public String checkForPropertyOverwrites(String aFieldName, String anAtrribute) {

aFieldName	"name2" (id=15959)	
anAtrribute	"hidden" (id=15974)	

		String myPropertyPrefix = getPropertyPrefix(aFieldName);
/s
FieldTag.getPropertyPrefix(String) line: 503	
		String ret = "module." + EntityActionUtil.getModule(getRequest()) + "." + getFieldOwner().getEntity() + ".";
module.oms.shipmentOrder.
		if (org.apache.commons.lang.StringUtils.isNotBlank(getPrefix())) {
			ret += getPrefix() + ".";
module.oms.shipmentOrder.from.

/ Klopt	, 
$ vi shipfrom.tag
			<mpo:setFormVO valueObject="${formVO.fromPartyVO}" prefix="from">
				<mpo:field languageKey="shipfrom.name2" name="name2" overRideable="true" />
/ Hoe komt deze FieldTag	, aan de prefix die op de mpo:setFormVO  staat?
/ TODO

		ret += aFieldName + ".";
module.oms.shipmentOrder.from.name2.

/t
FieldTag.checkForPropertyOverwrites(String, String) line: 229	
		String myPropertyPrefix = getPropertyPrefix(aFieldName);
module.oms.shipmentOrder.from.name2.

/ Dus 
///////////////////////////////////////////////////////////
module.<the module>.<entity>.<prefix>.<fieldname>

		String myTagProperty = myPropertyPrefix + anAtrribute;
module.oms.shipmentOrder.from.name2.hidden

		return getProperty(myTagProperty, null);

/ Intermezzo

/ KOPPOLA

$ vi shipfrom.tag

<%@taglib prefix="cf" uri="/WEB-INF/tld/core-functions.tld"%>

		<c:if test="${cf:property('oms', 'shipmentorder.orderstatus.hidden', 'false')=='false'}">
			<mpo:listField name="orderStatus" type="orderStatus" readOnly="${formVO.orderStatusVO.code-0<1450?form.formReadOnly:'true'}" />
						</c:if>

/ en	,
				<mpo:field languageKey="shipfrom.name2" name="name2" overRideable="true" />

$ vi  core-functions.tld

<function>
	<name>property</name>
    <function-class>com.mpobjects.core.ApplicationPropertyManager</function-class>
    <function-signature>
        java.lang.String  taglibGetProperty(java.lang.String,java.lang.String,java.lang.String)
    </function-signature>
</function>

$ vi ApplicationPropertyManager.java
	public static String taglibGetProperty(String aModule, String aKey, String aDefaultValue) {
		return getInstance().getModuleProperty(aModule, aKey, aDefaultValue);
	}

/ Instead overRideable does the same	, 

/ Dus met overRideable="true" 	, moeten we properties in db	, die er zo uitzien	, 
///////////////////////////////////////////////////////////
module.<the module>.<entity>.<prefix>.<fieldname>
/ bijv	,
module.oms.shipmentOrder.from.name2.hidden


/ Einde Intermezzo

/s
FieldTag.getProperty(String, String) line: 1182	
/=
	protected String getProperty(String aProperty, String aDefaultValue) {

aProperty	"module.oms.shipmentOrder.from.name2.hidden" (id=15975)	
aDefaultValue	null	

		if (getFieldOwner().getValueObjects().isEmpty()) {
/s
FieldTag.getFieldOwner() line: 1125	
		return getActiveValueObjectHolder().getFieldOwner();
getActiveValueObjectHolder()=SetFormVOTag	, en de owner van deze is de FormTag	,
/t
FieldTag.getProperty(String, String) line: 1182	
		if (getFieldOwner().getValueObjects().isEmpty()) {
/ NEE
		EntityInterface myValueObject = getFieldOwner().getValueObjects().iterator().next();
ShipmentOrderVO
		if (myValueObject instanceof OrganizationValueObjectInterface) {
			myOrganizationSystemid = ((OrganizationValueObjectInterface) myValueObject).getOrganizationSystemid();
/s
ShipmentOrderVO(ResourceProtectedValueObject).getOrganizationSystemid() line: 23	
this	ShipmentOrderVO  (id=15997)	
		Organization org = getOrganizationVO();
SystemId:1010	Id:PNL-TMS-AB	Description:Post NL Autobedrijf
/t
		return org.getSystemId();
/t
FieldTag.getProperty(String, String) line: 1182	
			myOrganizationSystemid = ((OrganizationValueObjectInterface) myValueObject).getOrganizationSystemid();
/d
1010
		if (myOrganizationSystemid > 0) {
			myPropertyValue = ApplicationPropertyManager.getInstance().getProperty(myOrganizationSystemid, aProperty, aDefaultValue);
/s
ApplicationPropertyManager.getProperty(int, String, String) line: 458	

aPreferedOrganizationSystemid	1010	
aPropertyKey	"module.oms.shipmentOrder.from.name2.hidden" (id=15975)	
aDefaultValue	null	

		String myRet = NOTSET;

		Resource myActiveResource = AuthenticationUtils.getResource();
		if (myActiveResource != null) {
			myRet = myActiveResource.getUserProperty(aPropertyKey, NOTSET);
		if (NOTSET.equals(myRet)) {
			myRet = getOrganizationProperty(aPreferedOrganizationSystemid, aPropertyKey, NOTSET, true);
		if (NOTSET.equals(myRet)) {
			myRet = getDatabaseProperty(aPropertyKey, NOTSET);
		if (NOTSET.equals(myRet)) {
			myRet = getApplicationProperty(aPropertyKey, aDefaultValue);
null
/= aDefaultValue

/t
FieldTag.getProperty(String, String) line: 1198	
		if (myOrganizationSystemid > 0) {
			myPropertyValue = ApplicationPropertyManager.getInstance().getProperty(myOrganizationSystemid, aProperty, aDefaultValue);
null
		return myPropertyValue;
/t
FieldTag.handleOverridable() line: 1218	
		if (isOverRideable()) {
			String myHiddenPropertyValue = checkForPropertyOverwrites(getName(), "hidden");
null
			if (myHiddenPropertyValue != null) {
/ NEE
				setHidden(BooleanUtils.isTrue(myHiddenPropertyValue));
/ NIET
			String myRequiredPropertyValue = checkForPropertyOverwrites(getName(), "required");
/s
FieldTag.checkForPropertyOverwrites(String, String) line: 227	
		String myPropertyPrefix = getPropertyPrefix(aFieldName);
module.oms.shipmentOrder.from.name2.
		String myTagProperty = myPropertyPrefix + anAtrribute;
module.oms.shipmentOrder.from.name2.required
		return getProperty(myTagProperty, null);
/t
FieldTag.handleOverridable() line: 1222	
			String myRequiredPropertyValue = checkForPropertyOverwrites(getName(), "required");
null
			if (myRequiredPropertyValue != null) {
/ NEE
				setRequired(BooleanUtils.isTrue(myRequiredPropertyValue));
/ NIET
			String myReadOnlyPropertyValue = checkForPropertyOverwrites(getName(), "readonly");
null
			if (myReadOnlyPropertyValue != null) {
/ NEE
				setReadOnly(myReadOnlyPropertyValue);
/ NIET
			String myMaxLengthPropertyValue = checkForPropertyOverwrites(getName(), "maxlength");
null
			if (myMaxLengthPropertyValue != null) {
/ NEE
				setMaxLength(myMaxLengthPropertyValue);
/ NIET

/t
FieldTag.doStartTag() line: 335	
		if (isFieldContextForm()) {
			handleOverridable();
/d
		if (handleShowField) {
			// was:overridable
			if (isFieldContextForm()) {
				findSetFormVOTag();
			}

			if (isHidden()) {
/s
FieldTag.isHidden() line: 609	
		if (!isHidden && getActiveValueObject() != null) {
/ JA
			String myEntity = getActiveValueObjectHolder().getFieldOwner().getEntity();
"shipmentOrder"
			if (getActiveValueObjectHolder().getFieldOwner() instanceof FormTag) {
				FormTag formTag = (FormTag) getActiveValueObjectHolder().getFieldOwner();
				request = formTag.getFieldUtil().getRequest();
			}
			PermissionType myPermission = JspPermissionManager.get(getRequest()).checkPermission(myEntity, activeValueObjectHolder, getActiveValueObject(), request, getName());
null
		return isHidden;
false

/t
FieldTag.doStartTag() line: 345	
			if (isHidden()) {
/ NEE
			} else {
				if (showFieldContext()) {
					appendHeaderStart(myRet);
					appendLabelPart(myRet);
/s
FieldTag.appendLabelPart(StringBuffer) line: 1007	
		aBuffer.append(getLabel());
/s
FieldTag.getLabel() line: 1166	
		return getLabel(StringUtils.isEmpty(getLanguageKey()) ? getName() : getLanguageKey());
getLanguageKey()="shipfrom.name2"
getName()="name2"
/ we hebben	,
				<mpo:field languageKey="shipfrom.name2" name="name2" overRideable="true" />
/s
FieldTag.getLabel(String) line: 1176	
/=
	protected String getLabel(String aName) {
aName="shipfrom.name2"
		return getLanguageManager().getByJavaName(getFieldOwner().getEntity(), aName);
/s
FieldTag(TagBase).getLanguageManager() line: 45	
			theLanguageManager = new LanguageManager(getRequest());
/s
LanguageManager.<init>(HttpServletRequest) line: 79	
		setLocale(LocaleUtils.getActiveLocale());
en_GB_pnltms
		getPropertiesFile();
/s
LanguageManager.getPropertiesFile(Locale) line: 201	
		if (propertiesFiles.containsKey(aLocale)) {
/ JA	,
/ propertiesFiles=HashMap{en=..., en_GB_pnltms=..., eng_GB=...}
			return propertiesFiles.get(aLocale);
/t
LanguageManager.<init>(HttpServletRequest) line: 81	
		getPropertiesFile();

		if (aRequest != null) {
			if (!AuthenticationUtils.isAuthenticated()) {
/ NEE
/ TODO


/t
FieldTag.getLabel(String) line: 1176	
		return getLanguageManager().getByJavaName(getFieldOwner().getEntity(), aName);
/d
/s
	protected FieldOwner getFieldOwner() {
		return getActiveValueObjectHolder().getFieldOwner();
FormTag
/t
/s
LanguageManager.getByJavaName(String, String) line: 370	
/=
	public String getByJavaName(String anEntityName, String aFieldName) {

anEntityName	"shipmentOrder" (id=15991)	
aFieldName	"shipfrom.name2" (id=15961)	

		String myTableName = StringUtils.formatJavaToSql(anEntityName).toString();
shipment_order
		String myFieldName = StringUtils.formatJavaToSql(aFieldName).toString();
shipfrom.name2
		if (StringUtils.isNotEmpty(myTableName)) {
			myRet = get(myTableName, myFieldName);
/s
LanguageManager.get(String, String) line: 258	
/=
	public String get(String aTableName, String aField) {

aTableName	"shipment_order" (id=16563)	
aField	"shipfrom.name2" (id=16564)	

		} else {
			aTableName = StringUtils.formatJavaToSql(aTableName).toString();
			aTableName = aTableName.replaceAll("-", "_");
			myFullCode = "table_" + aTableName + "_" + aField;
table_shipment_order_shipfrom.name2
		try {
			myRet = get(myFullCode, true);
/s
	public String get(String aFullCode, boolean aThrowExceptionIfNotFound) {
		return get(aFullCode, StringUtils.EMPTY_STRING_MAP, aThrowExceptionIfNotFound);
/s
LanguageManager.get(String, Map<String,String>, boolean) line: 576	
		String myFullCode = aFullCode.toLowerCase();
		myFullCode = myFullCode.replaceAll(" ", "_");

		String myProductSpecificCode = getProduct() + "." + myFullCode;
pnltms.table_shipment_order_shipfrom.name2

		Properties lang = getPropertiesFile();
		myRet = lang.getProperty(myProductSpecificCode, null);
Location Barcode

/ Intermezzo

/ SCHEMA LANGUAGEMANAGER

/ Als we in shipfrom.tag , languageKey shipfrom.name2 hebben	, 

/ dan vindt hij zelf entity = shipment order,	

/ language manager kijkt alleen naar entity, niet naar prefix "from" , zoals application manager dat wel doen	, (prefix is attribute op <mpo:setFormVO/>	, we moeten zelf de prefix in de languageKey set	,

/ Hij probeert	,
pnltms.table_shipment_order_shipfrom.name2
table_shipment_order_shipfrom.name2
pnltms.shipfrom.name2
shipfrom.name2

/want	,

	public String get(String aTableName, String aField) {

aTableName	"shipment_order" (id=16024)	
aField	"shipfrom.name2" (id=16018)	

		try {
			myRet = get(myFullCode, true);
		} catch (IndexOutOfBoundsException e) {
		}
		if (myRet == null) {
			try {
				myRet = get(aField, true);

/ en	,

	private String get(String aFullCode, Map<String, String> aFieldMap, boolean aThrowExceptionIfNotFound) throws IndexOutOfBoundsException {
aFullCode="table_shipment_order_shipfrom.name2"

		String myProductSpecificCode = getProduct() + "." + myFullCode;
pnltms.table_shipment_order_shipfrom.name2
		Properties lang = getPropertiesFile();
		myRet = lang.getProperty(myProductSpecificCode, null);
		if (myRet == null) {
			myRet = lang.getProperty(myFullCode, null);


/ Einde Intermezzo


/ 7	. 

/ als de party type group OVERSLAG is 	, wordt de language key	,
pnltms.table_shipment_order_o_v_e_r_s_l_a_g.name2=Location Barcode
/ Wat als BILL_TO	?

/s
sho-party.tag line: 41	
				<mpo:setFormVO valueObject="${party}" prefix="${party.partyTypeGroup.code}">
					<mpo:field name="name2" languageKey="${party.partyTypeGroup.code}.name2"/>
/s
sho-party.tag line: 41	
					appendLabelPart(myRet);
/s
						aBuffer.append(getLabel());
/s
sho-party.tag line: 41	
		return getLabel(StringUtils.isEmpty(getLanguageKey()) ? getName() : getLanguageKey());
/s
FieldTag.getLabel(String) line: 1176	
		return getLanguageManager().getByJavaName(getFieldOwner().getEntity(), aName);
/s
LanguageManager.getByJavaName(String, String) line: 375	
aFieldName	"BILL_TO.name2" (id=16760)	
/ In expressions	, doe LINKS: aFieldName="BILL_TO.name2" en geef Enter, en remove deze line weer	,

		String myFieldName = StringUtils.formatJavaToSql(aFieldName).toString();
/s
StringUtils.formatJavaToSql(String) line: 667	
		if (!isEmpty(aString)) {
			aString = StringUtils.firstCharToLower(aString);
aString	"bILL_TO.name2" (id=16809)	
		return formatJavaToSql(new StringBuffer(isEmpty(aString) ? "" : aString));
/s
StringUtils.formatJavaToSql(StringBuffer) line: 681	
		for (int i = 0; i < aStringBuffer.length(); i++) {
			myChar = aStringBuffer.charAt(i);
			if (myChar >= 65 && myChar <= 90) {
/ NEE voor 'b '
/ JA voor 'I'
/ NEE voor 'i'
/ JA voor 'L'
/ NEE voor 'l'
/ JA voor 'L'
/ NEE voor 'l'
/ NEE voor '_'
/ JA voor 'T'
/ NEE voor 't'
/ JA voor 'O'
/ NEE voor 'o'
/ NEE voor '.'
/ NEE voor 'n'
/ NEE voor 'a'
/ NEE voor 'm'
/ NEE voor 'e'

				myChar += 32;
				aStringBuffer.setCharAt(i, myChar);
				aStringBuffer.insert(i, '_');
b_iLL_TO.name2
b_i_l_l_TO.name2
b_i_l_l__tO.name2
b_i_l_l__t_o.name2
b_i_l_l__t_o.name2






















/ Einde DEBUG PAT-149

/ PAT-390

Planning, Shipment order, Create
/ shipment-order-tempate_list

$ vi oms-sitemap.xmap
			<map:match pattern="shipment-order-template_list">
				<map:call resource="dynatablePage">
					<map:parameter name="xsp" value="xsp/shipment-order-template_list.xml"/>
					<map:parameter name="xsl" value="xsl/shipment-order-template_list.xsl"/>
				</map:call>
			</map:match>

/ we zien in HTML , voor de 'Create new template' button	,	,
<button type="button" onclick="location.href='shipment-order-template_create?systemid=0&amp;base_sessionLevelOffset=1'">Create new template</button>

$ vi oms-sitemap.xmap
			<map:action logger="shipmentorder" name="shipmentOrderTemplateCreate" src="com.mpobjects.oms.control.shipmentorder.action.ShipmentOrderTemplateCreateAction"/>
			<map:match pattern="shipment-order-template_create">
				<map:act type="shipmentOrderTemplateCreate"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/shipment-order-template_edit.jsp"/>
			</map:match>

$ vi shipment-order-template_edit.jsp

<%
	myShipmentOrderView.init(request);
	theResource.init(request);
  	ShipmentOrderVO myVO = myShipmentOrderView.getShipmentOrderVO();
/(*)
	Party myShipFrom = myVO.getFromPartyVO();
	Party myShipTo = myVO.getToPartyVO();
	Party myBillTo = myVO.getBillToPartyVO();
	Party myPreferedParty = myVO.getPreferedPartyVO();
	if (myPreferedParty==null){
		myPreferedParty = Party.IMPLEMENTATION.newInstance();
	}
	request.setAttribute("formVO", session.getAttribute(ShipmentOrderView.ACTIVE_SHIPMENTORDER));
/(**)

/ Bij (*)	, myShipmentOrderView.getShipmentOrderVO()	, doet dezelfde query als bij **, session.getAttribute(ShipmentOrderView.ACTIVE_SHIPMENTORDER)	, dus we hadden ook kunnen doen	,
	request.setAttribute("formVO", myVO)

/ LANGUAGEMANAGER 

/ als 
	<mpo:form name="shipmentordertemplate" entity="shipmentOrderTemplate" readOnly="${readOnly}">
						<mpo:setFormVO fetchFrom="request" fetchVar="shipFrom" prefix="shipFrom">
							<mpo:field name="name2" />
/ dan hebben we languageKey attr niet used	, en blijkbaar pakt name attr	,
/ TODO

/ hij probeert eerst 
table_shipment_order_template_name2
/ daarna	,
name2

/ dat betekent	,
pnltms.table_shipment_order_template_name2
table_shipment_order_template_name2
/ en 	,
pnltms.name2
name2

/ Einde LANGUAGEMANAGER

/ 13	. 

/ planning, service order , create
/ click 'Create new template'

/ we zien in HTML	,
<button type="button" onclick="location.href='service-order-template_create?systemid=0&amp;base_sessionLevelOffset=1'">Create new template</button>

$ vi oms-sitemap.xmap

			<map:match pattern="service-order-template_create">
				<map:act type="serviceOrderTemplateCreate"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/service-order-template_edit.jsp"/>
			</map:match>

/ Dus kijk in jsp/service-order-template_edit.jsp	, 

$ vi service-order-template_edit.jsp
												<mpo:setFormVO fetchFrom="request"
													valueObject="${formVO.fromPartyVO}" prefix="from">
													<mpo:field name="name2" languageKey="shipfrom.name2"/>

															<mpo:setFormVO fetchFrom="request"
																valueObject="${formVO.toPartyVO}" prefix="to">
																<mpo:field name="name2" languageKey="shipto.name2"/>

$ vi language_en_GB_pnltms.properties
pnltms.table_service_order_template_shipfrom.name2=Location Barcode
pnltms.table_service_order_template_shipto.name2=Location Barcode


/ 13	. 

/ planning, service order , create
/ click 'Create booking from scratch'	,

/ we zien in HTML	,
<button type="button" onclick="location.href='service-order_create?systemid=0&amp;base_sessionLevelOffset=1'">Create booking from scratch</button>

$ vi oms-sitemap.xmap

			<map:match pattern="service-order_create">
				<map:act type="serviceOrderCreate"/>
				<map:read mime-type="text/html" type="jsp" src="jsp/service-order_edit.jsp"/>
			</map:match>

$ vi jsp/service-order_edit.jsp

						<mpo:tab name="shipFrom">
							<tmstags:shipfrom formid="serviceorder" />
						</mpo:tab>
						<mpo:tab name="shipTo">
							<tmstags:shipto formid="serviceorder" />

						<c:forEach var="myServiceOrderParty" items="${formVO.serviceOrderParties}">
							<mpo:tab name="${myServiceOrderParty.partyTypeGroup.code}">
								<tmstags:so-party party="${myServiceOrderParty}" />
							</mpo:tab>
						</c:forEach>

$ vi so-party.tag

				<mpo:setFormVO valueObject="${party}" prefix="${party.partyTypeGroup.code}">
					<mpo:field name="name2" languageKey="${party.partyTypeGroup.code}.name2"/>


/ FIX PAT-390

/ Dus we zien dat LanguageManager geen gebruik maakt van prefix attr op de <mpo:setFormVO/>	, terwijl ApplicationPropertyManager dat wel doet	,   
/ we doen het dus zelf	,

$ vi shipment-order-template_edit.jsp

						<mpo:setFormVO fetchFrom="request" fetchVar="shipFrom" prefix="shipFrom">
							<mpo:field name="name2" languageKey="shipfrom.name2"/>

						<mpo:setFormVO fetchFrom="request" fetchVar="shipTo" prefix="shipTo">
							<mpo:field name="name2" languageKey="shipto.name2"/>

						<mpo:setFormVO fetchFrom="request" fetchVar="billTo" prefix="billTo">
							<mpo:field name="name2" languageKey="billto.name2"/>

						<c:forEach var="myShipmentOrderParty" items="${formVO.shipmentOrderParties}">
							<td><tmstags:sho-template-party name="${myShipmentOrderParty.partyTypeGroup.code}" party="${myShipmentOrderParty}" /></td>
/ en	,
$ vi sho-template-party.tag

	    <mpo:setFormVO valueObject="${party}" prefix="${party.partyTypeGroup.code}">
	        <mpo:field name="name"/>
	        <mpo:field name="name2" languageKey="${party.partyTypeGroup.code}.name2"/>

pnltms=# select party_type_group from party_type_group where is_deleted=0;
 party_type_group 
------------------
 DELIVERY
 BILL_TO
 SERVICE_PROVIDER
 PREFERRED_PARTY
 OVERSLAG
 COLLECTION
 VIA
 HUB
(8 rows)

$ vi language_en_GB_pnltms.properties

# If the name2 field is always labeled with 'Location Barcode", then we do not have to give these 11 lines below; 1 line is enough: 
#pnltms.name2=Location Barcode
# or even 
#name2=Location Barcode
pnltms.table_shipment_order_template_shipfrom.name2=Location Barcode
pnltms.table_shipment_order_template_shipto.name2=Location Barcode
pnltms.table_shipment_order_template_billto.name2=Location Barcode
pnltms.table_shipment_order_template_d_e_l_i_v_e_r_y.name2=Location Barcode
pnltms.table_shipment_order_template_b_i_l_l__t_o.name2=Location Barcode
pnltms.table_shipment_order_template_s_e_r_v_i_c_e__p_r_o_v_i_d_e_r.name2=Location Barcode
pnltms.table_shipment_order_template_p_r_e_f_e_r_r_e_d__p_a_r_t_y.name2=Location Barcode
pnltms.table_shipment_order_template_o_v_e_r_s_l_a_g.name2=Location Barcode
pnltms.table_shipment_order_template_c_o_l_l_e_c_t_i_o_n.name2=Location Barcode
pnltms.table_shipment_order_template_v_i_a.name2=Location Barcode
pnltms.table_shipment_order_template_h_u_b.name2=Location Barcode

/ 13	. 

/ planning, service order , create
/ click 'Create new template'

$ vi service-order-template_edit.jsp

												<mpo:setFormVO fetchFrom="request"
													valueObject="${formVO.fromPartyVO}" prefix="from">
													<mpo:field name="name2" languageKey="from.name2"/>

															<mpo:setFormVO fetchFrom="request"
																valueObject="${formVO.toPartyVO}" prefix="to">
																<mpo:field name="name2" languageKey="to.name2"/>

$ vi language_en_GB_pnltms.properties

pnltms.table_service_order_template_from.name2=Location Barcode
pnltms.table_service_order_template_to.name2=Location Barcode

/ 13	. 

/ planning, service order , create
/ click 'Create booking from scratch',







/ we check in 	,
language_en_GB_pnltms.properties
shipment-order-tempate_edit.jsp
sho-template-party.tag

/ Einde FIX-390




/ Einde PAT-390

/ PAT DATABASE

/ we install nieuwe pnltms db	,

[eric@localhost bin]$ cat pnl-db-dump-a.sh 
...
cd ~/DB_TAP/Postgres/Backup
PGPASSWORD=h^Zgcyr\&Q pg_dump -U vanderveldene -Fc -h  pnl-app-a.intermax.mp-objects.com "$@" >"$@-a-$(date +%F).dump" 

[eric@localhost bin]$ cat local-pg_restore.sh 
...
PGPASSWORD=mpopostgres@mpo pg_restore -U mpopostgres -d "$1" "$2" 

[eric@localhost bin]$ pnl-db-dump-a.sh  pnltms

pnltms2=# create database pnltms3;
CREATE DATABASE
 

/ Einde PAT DATABASE

/ DEBUG PAT-390

/ Onthoud	,

/ SET BREAKPOINT LANGUAGEMANAGER
/////////////////////////////////////////////////
/ rm LanguageManager's b's	,
/ set conditional break in	,
FieldTag.doStartTag() line: 347	
/ cond : this.getName().equals("name2")
/ set dan de b's op LanguageManager weer on	,
/ Hij valt dan binnen FieldTag.doStartTag op LanguageManager.appendLabelPart(myRet);





/s
public class ShipmentOrderTemplateCreateAction extends AbstractAction {
	@Override
	public Map act() throws java.lang.Exception {
		int mySystemId = getSystemIdFromRequest();
		ShipmentOrderVO myOriginal = null;
		if (mySystemId != ValueObject.VOLATILE_SYSTEM_ID) {
/ NEE
			myOriginal = ShipmentOrderUtil.getShipmentOrderFacadeLocal().getShipmentOrder(mySystemId);
/ NIET
		}
		ShipmentOrderVO myVO = MpoBeanFactory.getBean(ShipmentOrderService.class).create(myOriginal, true);
		getSession().setAttribute(ShipmentOrderView.ACTIVE_SHIPMENTORDER, myVO);
		return EMPTY_MAP;


shipment-order-template_edit.jsp line: 21	

<jsp:useBean id="theResource" scope="session" class="com.mpobjects.oms.view.resource.ResourceView" />
<%
	myShipmentOrderView.init(request);
	theResource.init(request);
  	ShipmentOrderVO myVO = myShipmentOrderView.getShipmentOrderVO();
/s
ShipmentOrderView.getShipmentOrderVO() line: 95	
		return getActive();
/s
ShipmentOrderView.getActive() line: 117	
		ShipmentOrderVO myActive = (ShipmentOrderVO) getSession().getAttribute(ACTIVE_SHIPMENTORDER);
ShipmentOrder: (SystemId:0; Org:PNL-TMS-AB)
/ Klopt	, deze is zojuist create in ShipmentOrderTemplateCreateAction.act	,

	Party myShipFrom = myVO.getFromPartyVO();
/s
ShipmentOrderVO(LogisticsOrderVO).getFromPartyVO() line: 426	
		if (theFromPartyVO == null) {
			theFromPartyVO = new VirtualParty();
		}
		return theFromPartyVO;
/t
	Party myShipTo = myVO.getToPartyVO();
/ net zo	,
	Party myBillTo = myVO.getBillToPartyVO();
/ net zo	,
	Party myPreferedParty = myVO.getPreferedPartyVO();
null
	if (myPreferedParty==null){
		myPreferedParty = Party.IMPLEMENTATION.newInstance();
/s
public interface Party extends EntityInterface, OrganizationValueObjectInterface, UniqueFieldValueObject, SelectionListHelper.SelectionListItem {
	public static final Class<PartyVO> IMPLEMENTATION = PartyVO.class;
/t
	request.setAttribute("formVO", session.getAttribute(ShipmentOrderView.ACTIVE_SHIPMENTORDER));

	boolean isActivatable = theResource.getActiveResource().isAllowedAsActiveOrganization(myVO.getOrganizationVO());
true
/ want,	
myVO.getOrganizationVO()=SystemId:1010	Id:PNL-TMS-AB	Description:Post NL Autobedrijf 	. 
/ Deze staat rechts in het lijstje	,

	if (myVO.getOrganizationSystemid() == ShipmentOrderVO.VOLATILE_SYSTEM_ID || isActivatable) {
		isEditable = theResource.hasPrivilege("shipment-order-template", "update");
true
	request.setAttribute("readOnly", "" + !isEditable);
false
	java.util.List<ShipmentOrderParty> myExistingParties = (java.util.List)myVO.getShipmentOrderParties();
[com.mpobjects.oms.model.entity.shipmentorderparty.ShipmentOrderParty@64a63153[shipmentOrder=ShipmentOrder: (SystemId:0; Org:PNL-TMS-AB),name=,partyTypeGroup=theSystemId: 26691616PartyTypeGroup :OVERSLAG]]

	java.util.List<Party> myCustomParties = new java.util.ArrayList();
	if (myExistingParties==null || myExistingParties.size()==0){
/ NEE

/c
$ vi shipment-order-template_edit.jsp
					<!-- Ship from -->
					<table class="detailsTable">
						<mpo:setFormVO fetchFrom="request" fetchVar="shipFrom" prefix="shipFrom">
							<mpo:field name="name2" />
/s
FieldTag.doStartTag() line: 316	
			} else {
				if (showFieldContext()) {
					appendHeaderStart(myRet);
					appendLabelPart(myRet);
/s
FieldTag.appendLabelPart(StringBuffer) line: 1007	
		aBuffer.append(getLabel());
/s
FieldTag.getLabel() line: 1166	
		return getLabel(StringUtils.isEmpty(getLanguageKey()) ? getName() : getLanguageKey());
/s
FieldTag.getLabel(String) line: 1176	
/=
	protected String getLabel(String aName) {
/ aName="name2"
		return getLanguageManager().getByJavaName(getFieldOwner().getEntity(), aName);
/s
LanguageManager.getByJavaName(String, String) line: 370	
/=
	public String getByJavaName(String anEntityName, String aFieldName) {
anEntityName="shipmentOrderTemplate"
aFieldName="name2"

/ Intermezzo

	<mpo:form name="shipmentordertemplate" entity="shipmentOrderTemplate" readOnly="${readOnly}">
						<mpo:setFormVO fetchFrom="request" fetchVar="shipFrom" prefix="shipFrom">
							<mpo:field name="name2" />

/ en 	,
    protected String getLabel(String aName) {
        getFieldOwner().getEntity()
/s
			return getActiveValueObjectHolder().getFieldOwner();
getActiveValueObjectHolder()=SetFormVOTag inst	,
SetFormVOTag.getFieldOwner()=getForm()
/ logisch, de SetFormVOTag zit er alleen maar tussen, dus de owner van <mpo:field name="name2"/> is <mpo:form/>	,

/ Einde Intermezzo

		String myTableName = StringUtils.formatJavaToSql(anEntityName).toString();
shipment_order_template
		String myFieldName = StringUtils.formatJavaToSql(aFieldName).toString();
name2
		String myRet;
		if (StringUtils.isNotEmpty(myTableName)) {
			myRet = get(myTableName, myFieldName);
/s
LanguageManager.get(String, String) line: 258	
		} else {
			aTableName = StringUtils.formatJavaToSql(aTableName).toString();
			aTableName = aTableName.replaceAll("-", "_");
			myFullCode = "table_" + aTableName + "_" + aField;
table_shipment_order_template_name2
		try {
->			myRet = get(myFullCode, true);
		} catch (IndexOutOfBoundsException e) {
		}
		if (myRet == null) {
			try {
				myRet = get(aField, true);

/ hij probeert eerst 
table_shipment_order_template_name2
/ dat betekent	,
pnltms.table_shipment_order_template_name2
table_shipment_order_template_name2
/ daarna	,
name2
/ dat betekent	,
pnltms.name2
name2
->
/s
LanguageManager.get(String, Map<String,String>, boolean) line: 576	
		String myProductSpecificCode = getProduct() + "." + myFullCode;
null
		myRet = lang.getProperty(myProductSpecificCode, null);
		if (myRet == null) {
			myRet = lang.getProperty(myFullCode, null);
null
		if (myRet == null) {
			if (aThrowExceptionIfNotFound) {
				throw new IndexOutOfBoundsException(myFullCode + " Not found in language file.");
/t
		if (myRet == null) {
			try {
				myRet = get(aField, true);
/s
LanguageManager.get(String, boolean) line: 247	
		return get(aFullCode, StringUtils.EMPTY_STRING_MAP, aThrowExceptionIfNotFound);
aFullCode="name2"
LanguageManager.get(String, Map<String,String>, boolean) line: 576	
		String myProductSpecificCode = getProduct() + "." + myFullCode;
pnltms.name2
		Properties lang = getPropertiesFile();
		myRet = lang.getProperty(myProductSpecificCode, null);
null
		if (myRet == null) {
			myRet = lang.getProperty(myFullCode, null);
Name 2











/ Einde DEBUG PAT-390


/ DEPLOY CARCON OP BARD

/ Geef in chrome	,
https://test-bard.mp-objects.com/carcon/authentication/login-form

/ we hebben dus bard vervangen door carcon in de normale url	,
https://test-bard.mp-objects.com/bard/authentication/login-form

/ We zien onderin	,
2015.03#21894

/ Deze moet naar acceptance	,

/ Hij is dus al build	, maar als we zouden willen build, dan in jenkins: 
build product: carconmpo
build.svn.baseurl: /braches/2015.03

ss@bard-app-a releases]$ curl -u eric -O https://system.mp-objects.com/jenkins/job/SCS-OnDemand/3549/artifact/dist/tms-carconmpo-21894-2015.03_build3549.zip
[jboss@bard-app-t releases]$ carcon stop
[jboss@bard-app-a releases]$ deploy-carcon.sh /local/apps/releases/tms-carconmpo-21894-2015.03_build3549.zip /local/apps/jboss-4.0.5.GA/server/carcon

/ MORGENOCHTEND

/ 13	. 

/ we missen een aantal jars	,

[jboss@bard-app-a releases]$ awk '/MISSING/ && /.jar/' /local/apps/jboss-4.0.5.GA/server/carcon/log/server.log
2015-12-29 11:11:39,608 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : bcprov-jdk15on-1.53.jar
2015-12-29 11:11:39,616 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : jericho-html-3.3.jar
2015-12-29 11:11:39,619 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : opensaml-2.6.4.jar
2015-12-29 11:11:39,619 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : openws-1.5.4.jar
2015-12-29 11:11:39,622 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : wicket-ioc-1.4.23.jar
2015-12-29 11:11:39,622 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : wicket-spring-1.4.23.jar
2015-12-29 11:11:39,623 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : xmlsec-1.5.7.jar
2015-12-29 11:11:39,623 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : xmltooling-1.4.4.jar

[jboss@bard-app-a releases]$ awk '/MUST_BE_REMOVED/ && /.jar/' /local/apps/jboss-4.0.5.GA/server/carcon/log/server.log
2015-12-29 11:11:37,862 ERROR [com.mpobjects.libcheck.LibCheckService]    MUST_BE_REMOVED : bcprov-jdk15on-1.52.jar
2015-12-29 11:11:39,618 ERROR [com.mpobjects.libcheck.LibCheckService]    MUST_BE_REMOVED : opensaml-2.6.1.jar
2015-12-29 11:11:39,619 ERROR [com.mpobjects.libcheck.LibCheckService]    MUST_BE_REMOVED : openws-1.5.1.jar
2015-12-29 11:11:39,623 ERROR [com.mpobjects.libcheck.LibCheckService]    MUST_BE_REMOVED : xmlsec-1.5.6.jar
2015-12-29 11:11:39,623 ERROR [com.mpobjects.libcheck.LibCheckService]    MUST_BE_REMOVED : xmltooling-1.4.1.jar

$ (DIR=/local/apps/jboss-4.0.5.GA/server/carcon;cd "$DIR/lib"; ls $(awk '/MUST_BE_REMOVED/ && /.jar/{print $7}' <(tail -1024 "$DIR/log/server.log")))
bcprov-jdk15on-1.52.jar  opensaml-2.6.1.jar  openws-1.5.1.jar  xmlsec-1.5.6.jar  xmltooling-1.4.1.jar
/ ze zijn er dus allemaal	,

[jboss@bard-app-a releases]$ (DIR=/local/apps/jboss-4.0.5.GA/server/carcon;cd "$DIR/lib"; rm -f $(awk '/MUST_BE_REMOVED/ && /.jar/{print $7}' <(tail -1024 "$DIR/log/server.log")))
[jboss@bard-app-a releases]$ (DIR=/local/apps/jboss-4.0.5.GA/server/carcon;cd "$DIR/lib"; ls $(awk '/MUST_BE_REMOVED/ && /.jar/{print $7}' <(tail -1024 "$DIR/log/server.log")))
ls: cannot access bcprov-jdk15on-1.52.jar: No such file or directory
ls: cannot access opensaml-2.6.1.jar: No such file or directory
ls: cannot access openws-1.5.1.jar: No such file or directory
ls: cannot access xmlsec-1.5.6.jar: No such file or directory
ls: cannot access xmltooling-1.4.1.jar: No such file or directory
/ OK

/ we doen op de laptop	,
[eric@localhost carcon]$ ssh vanderveldene@bard-app-a.intermax.mp-objects.com "echo \$(awk '/MISSING/ && /.jar/{print \$7}' <(tail -1024 /local/apps/jboss-4.0.5.GA/server/carcon/log/server.log))"
...
bcprov-jdk15on-1.53.jar jericho-html-3.3.jar opensaml-2.6.4.jar openws-1.5.4.jar wicket-ioc-1.4.23.jar wicket-spring-1.4.23.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar

/ let op de \$ 2 keer	,

/ Hoe halen we hier alleen de laatste regel uit?
/ We probeerden	, 
[eric@localhost server]$ awk '/.jar/' <(ssh vanderveldene@bard-app-a.intermax.mp-objects.com "echo \$(awk '/MISSING/ && /.jar/{print \$7}' <(tail -1024 /local/apps/jboss-4.0.5.GA/server/carcon/log/server.log))")
/ TODO

[eric@localhost lib]$ ssh vanderveldene@bard-app-a.intermax.mp-objects.com "mkdir Downloads/carcon"

[eric@localhost lib]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/bard/lib
[eric@localhost lib]$ scp  bcprov-jdk15on-1.53.jar jericho-html-3.3.jar opensaml-2.6.4.jar openws-1.5.4.jar wicket-ioc-1.4.23.jar wicket-spring-1.4.23.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar vanderveldene@bard-app-a.intermax.mp-objects.com:Downloads/carcon
/ we hebben het nu dus met de hand gedaan	,

/ op bard-app-a	, 
[vanderveldene@bard-app-a ~]$ chmod a+rx /home/vanderveldene/
$ sudo su - jboss
[jboss@bard-app-a ~]$ cp -a ~vanderveldene/Downloads/carcon/* /local/apps/jboss-4.0.5.GA/server/carcon/lib/
/ OK

/ check	,
[jboss@bard-app-a ~]$ (cd /local/apps/jboss-4.0.5.GA/server/carcon/lib/; ls  bcprov-jdk15on-1.53.jar jericho-html-3.3.jar opensaml-2.6.4.jar openws-1.5.4.jar wicket-ioc-1.4.23.jar wicket-spring-1.4.23.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar)
bcprov-jdk15on-1.53.jar  opensaml-2.6.4.jar  wicket-ioc-1.4.23.jar     xmlsec-1.5.7.jar
jericho-html-3.3.jar     openws-1.5.4.jar    wicket-spring-1.4.23.jar  xmltooling-1.4.4.jar


/ 13	. 

2015-12-29 12:21:36,971 INFO  [com.mpobjects.dbpatch.DataBasePatcher] Executing patch [oms/patch-522-fix-consignment-float$p
ostgresql.sql] ...
2015-12-29 12:21:36,979 ERROR [com.mpobjects.dbpatch.DataBasePatcher] Problem while executing SQL statement in patch [oms/pa
tch-522-fix-consignment-float$postgresql.sql]: 
2015-12-29 12:21:36,979 ERROR [com.mpobjects.dbpatch.DataBasePatcher] DROP VIEW RPT_CONSIGNMENTS
2015-12-29 12:21:36,979 ERROR [com.mpobjects.dbpatch.DataBasePatcher] org.postgresql.util.PSQLException: ERROR: view "rpt_co
nsignments" does not exist

/ we set de patch op SKIPPED	,
carcon=> update mpo_scs_patch set status='SKIPPED' where name='patch-522-fix-consignment-float$postgresql.sql';
UPDATE 1
carcon=> commit;
COMMIT
/ want deze view is niet nodig in carcon	, 
/ de patch drops eerst de view	, daarna creates 'm	, 

/ 13	. 

2015-12-29 13:17:12,107 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : bcprov-jdk15on-1.52.jar
2015-12-29 13:17:12,117 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : opensaml-2.6.1.jar
2015-12-29 13:17:12,117 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : openws-1.5.1.jar
2015-12-29 13:17:12,119 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : xmlsec-1.5.6.jar
2015-12-29 13:17:12,120 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : xmltooling-1.4.1.jar

2015-12-29 13:17:12,107 ERROR [com.mpobjects.libcheck.LibCheckService]    MUST_BE_REMOVED : bcprov-jdk15on-1.53.jar
2015-12-29 13:17:12,114 ERROR [com.mpobjects.libcheck.LibCheckService]    MUST_BE_REMOVED : jericho-html-3.3.jar
2015-12-29 13:17:12,117 ERROR [com.mpobjects.libcheck.LibCheckService]    MUST_BE_REMOVED : opensaml-2.6.4.jar
2015-12-29 13:17:12,117 ERROR [com.mpobjects.libcheck.LibCheckService]    MUST_BE_REMOVED : openws-1.5.4.jar
2015-12-29 13:17:12,119 ERROR [com.mpobjects.libcheck.LibCheckService]    MUST_BE_REMOVED : wicket-ioc-1.4.23.jar
2015-12-29 13:17:12,119 ERROR [com.mpobjects.libcheck.LibCheckService]    MUST_BE_REMOVED : wicket-spring-1.4.23.jar
2015-12-29 13:17:12,120 ERROR [com.mpobjects.libcheck.LibCheckService]    MUST_BE_REMOVED : xmlsec-1.5.7.jar
2015-12-29 13:17:12,120 ERROR [com.mpobjects.libcheck.LibCheckService]    MUST_BE_REMOVED : xmltooling-1.4.4.jar

/ must be removed	,

[vanderveldene@bard-app-a ~]$ echo $(awk '/MUST_BE_REMOVED/ && /.jar/ && /13:17/{print $7}' /local/apps/jboss-4.0.5.GA/server/carcon/log/server.log)
bcprov-jdk15on-1.53.jar jericho-html-3.3.jar opensaml-2.6.4.jar openws-1.5.4.jar wicket-ioc-1.4.23.jar wicket-spring-1.4.23.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar

[jboss@bard-app-a ~]$ CARCON=/local/apps/jboss-4.0.5.GA/server/carcon
[jboss@bard-app-a ~]$ (cd $CARCON/lib;rm -f bcprov-jdk15on-1.53.jar jericho-html-3.3.jar opensaml-2.6.4.jar openws-1.5.4.jar wicket-ioc-1.4.23.jar wicket-spring-1.4.23.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar)

/ missing	,

/ op laptop	,
[jboss@bard-app-a ~]$ echo $(awk '/MISSING/ && /.jar/ && /13:17/{print $7}' /local/apps/jboss-4.0.5.GA/server/carcon/log/server.log) 
bcprov-jdk15on-1.52.jar opensaml-2.6.1.jar openws-1.5.1.jar xmlsec-1.5.6.jar xmltooling-1.4.1.jar

[eric@localhost lib]$ scp bcprov-jdk15on-1.52.jar opensaml-2.6.1.jar openws-1.5.1.jar xmlsec-1.5.6.jar xmltooling-1.4.1.jar  vanderveldene@bard-app-a.intermax.mp-objects.com:Downloads/carcon_old

/ op bard-app-a	,
[jboss@bard-app-a ~]$ cp -a ~vanderveldene/Downloads/carcon_old/* /local/apps/jboss-4.0.5.GA/server/carcon/lib/

/ 7	. 

/ we moeten nieuwe versie carcon build en deploy op test	,

/ op jenkins	, build
carconmpo
/branches/2015.03

[vanderveldene@bard-app-t ~]$ sudo su - jboss

https://test-bard.mp-objects.com/carcon/core/index_frameset

 2121  2015-12-30 12:36:01 curl -u eric -O https://system.mp-objects.com/jenkins/job/SCS-OnDemand/3559/artifact/dist/tms-carconmpo-21920-2015.03_build3559.zip
 2122  2015-12-30 12:37:35 carcon stop
 2123  2015-12-30 12:38:24 deploy-carcon.sh /local/apps/releases/tms-carconmpo-21920-2015.03_build3559.zip /local/apps/jboss-4.0.5.GA/server/carcon

/ 13	. 

/ en op bard-acc	,
/ OK 





/ Einde DEPLOY CARCON OP BARD

/ DEPLOY DSVFMS

/ we doen	,
jboss@mposerv11:~/releases$ ls -ltr | awk '/dsvfms/'
...
-rw-rw-r-- 1 jboss jboss 36648264 Mar  9 13:49 tms-dsvfms-22727-2015.03_build3865.zip




/ Einde DEPLOY DSVFMS

/ SSH

/ De tekst van intermax is op 2 (stderr)	,

[eric@localhost lib]$ ssh vanderveldene@bard-app-a.intermax.mp-objects.com "awk '/MISSING/ && /.jar/ && /13:17/{print $7}' <(tail -1000000 /local/apps/jboss-4.0.5.GA/server/carcon/log/server.log)"  >/tmp/carcon 2>&1

/ we moeten 2>&1 NA >/tmp/carcon	, anders komt stderr NIET in /tmp/carcon	, maar op de terminal	,

/ 13	. 

/ Geef in google, 
linux pipe only stdout
/ Lees	,
http://stackoverflow.com/questions/3618078/pipe-only-stderr-through-a-filter

/ 13	. 

/ Hier boven zagen we ook 	, dat 2>&1 na >/tmp/carcon moet	,

/ Alle intermex tekst is weg	,
/////////////////////////////////////////
[eric@localhost lib]$ ssh vanderveldene@bard-app-a.intermax.mp-objects.com "awk '/MISSING/ && /.jar/ && /13:17/{print $7}' <(tail -1000000 /local/apps/jboss-4.0.5.GA/server/carcon/log/server.log)" 2>&1 | awk '/jar/'
2015-12-29 13:17:12,107 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : bcprov-jdk15on-1.52.jar
2015-12-29 13:17:12,117 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : opensaml-2.6.1.jar
2015-12-29 13:17:12,117 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : openws-1.5.1.jar
2015-12-29 13:17:12,119 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : xmlsec-1.5.6.jar
2015-12-29 13:17:12,120 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : xmltooling-1.4.1.jar

[eric@localhost lib]$ awk '/jar/'  <(ssh vanderveldene@bard-app-a.intermax.mp-objects.com "awk '/MISSING/ && /.jar/ && /13:17/{print $7}' <(tail -1000000 /local/apps/jboss-4.0.5.GA/server/carcon/log/server.log)"  2>&1)
2015-12-29 13:17:12,107 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : bcprov-jdk15on-1.52.jar
2015-12-29 13:17:12,117 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : opensaml-2.6.1.jar
2015-12-29 13:17:12,117 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : openws-1.5.1.jar
2015-12-29 13:17:12,119 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : xmlsec-1.5.6.jar
2015-12-29 13:17:12,120 ERROR [com.mpobjects.libcheck.LibCheckService]            MISSING : xmltooling-1.4.1.jar



/ Einde SSH


/ DEPLOY

/ we moeten een zip van mposerv11 naar application-a.intermax.mp-objects.com	, 

/ op de laptop	,
[eric@localhost bin]$ scp eric@mposerv11:/home/jboss/releases/tms-mpo-21699-2015.03_build3487.zip /home/eric/Downloads/
/ we hebben password less login	, dus OK

[eric@localhost bin]$ scp /home/eric/Downloads/tms-mpo-21699-2015.03_build3487.zip vanderveldene@application-a.intermax.mp-objects.com:Downloads
tms-mpo-21699-2015.03_build3487.zip                                                       100%   35MB   1.5MB/s   00:23    
/ we hebben password less login	, dus OK

/ 7	.

[eric@localhost bin]$ ssh vanderveldene@application-a.intermax.mp-objects.com "sudo su - jboss"
sudo: sorry, you must have a tty to run sudo
[eric@localhost bin]$ ssh -t vanderveldene@application-a.intermax.mp-objects.com "sudo su - jboss"
[jboss@application-a ~]$ 

/ 7	. 

/ multiple commmands to ssh	,

[eric@localhost bin]$ ssh -t vanderveldene@application-a.intermax.mp-objects.com "ls;pwd"
Downloads  hibernate3.6.10.mpo.1.jar
/home/vanderveldene
Connection to application-a.intermax.mp-objects.com closed.
/ OK

[eric@localhost bin]$ ssh vanderveldene@application-a.intermax.mp-objects.com<<EOF
ls
pwd
EOF

Pseudo-terminal will not be allocated because stdin is not a terminal.
Downloads
hibernate3.6.10.mpo.1.jar
/home/vanderveldene

/ Daarom doen we	,
[eric@localhost bin]$ ssh -T vanderveldene@application-a.intermax.mp-objects.com<<EOF
ls
pwd
EOF

Downloads
hibernate3.6.10.mpo.1.jar
/home/vanderveldene
/ TODO

[eric@localhost bin]$ ssh -tt vanderveldene@application-a.intermax.mp-objects.com<<EOF
ls
pwd
EOF

Last login: Wed Dec 23 15:08:33 2015 from 10.1.0.6
***************************************************************************
                            NOTICE TO USERS
...
****************************************************************************
ls
pwd
[vanderveldene@application-a ~]$ ls
Downloads  hibernate3.6.10.mpo.1.jar
[vanderveldene@application-a ~]$ pwd
/home/vanderveldene
/ we moeten ^c
/ TODO

/ 	7	. 

[jboss@application-a releases]$ awk '/MUST_BE_REMOVED/ && /.jar/{n++} END{print n}' /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log
36
[jboss@application-a releases]$ awk '/MISSING/ && /.jar/{n++} END{print n}' /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log
37

/ we zien in de missing files in server/dsvfms/lib	,
[eric@localhost lib]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/dsvfms/lib
[eric@localhost lib]$ awk 'END{print NR}' <(ls -l $(ssh vanderveldene@application-a.intermax.mp-objects.com "awk '/MISSING/ && /.jar/{print \$8}' /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log"))
37
/ Klopt	,
/ NB. escape $ in print \$8	,

/ we copy over	,

[eric@localhost lib]$ scp $(ssh vanderveldene@application-a.intermax.mp-objects.com "awk '/MISSING/ && /.jar/{print \$8}' /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log") vanderveldene@application-a.intermax.mp-objects.com:Downloads
activeio-core-3.1.4.jar                                                                          100%  100KB 100.2KB/s   00:00    
activemq-broker-5.10.2.jar                                                                       100% 1013KB   1.0MB/s   00:00    
activemq-client-5.10.2.jar                                                                       100% 1151KB   1.1MB/s   00:00    
activemq-kahadb-store-5.10.2.jar                                                                 100%  535KB 534.6KB/s   00:00    
activemq-openwire-legacy-5.10.2.jar                                                              100%  669KB 669.4KB/s   00:00    
activemq-protobuf-1.1.jar                                                                        100%  144KB 144.4KB/s   00:00    
activemq-spring-5.10.2.jar                                                                       100%  159KB 159.0KB/s   00:00    
aspectjweaver-1.7.4.jar                                                                          100% 1807KB   1.8MB/s   00:00    
bcprov-jdk15on-1.52.jar                                                                          100% 2835KB   2.8MB/s   00:01    
commons-csv-1.1.jar                                                                              100%   36KB  36.0KB/s   00:00    
commons-pool-1.5.7.jar                                                                           100%   98KB  98.3KB/s   00:00    
ehcache-2.10.0.jar                                                                               100% 8700KB   2.8MB/s   00:03    
hawtbuf-1.10.jar                                                                                 100%   49KB  49.0KB/s   00:00    
hibernate3.6.10.mpo.1.jar                                                                        100% 4070KB   4.0MB/s   00:01    
jackson-annotations-2.6.0.jar                                                                    100%   46KB  45.9KB/s   00:00    
jackson-core-2.6.0.jar                                                                           100%  253KB 252.8KB/s   00:00    
jackson-databind-2.6.0.jar                                                                       100% 1134KB   1.1MB/s   00:00    
postgresql-9.4-1200.jdbc4.jar                                                                    100%  628KB 627.8KB/s   00:00    
quartz-1.8.6.jar                                                                                 100%  439KB 438.6KB/s   00:00    
spring-aop-3.2.14.RELEASE.jar                                                                    100%  331KB 330.7KB/s   00:00    
spring-aspects-3.2.14.RELEASE.jar                                                                100%   50KB  50.2KB/s   00:00    
spring-beans-3.2.14.RELEASE.jar                                                                  100%  600KB 600.1KB/s   00:00    
spring-context-3.2.14.RELEASE.jar                                                                100%  848KB 848.0KB/s   00:00    
spring-context-support-3.2.14.RELEASE.jar                                                        100%  126KB 125.6KB/s   00:00    
spring-core-3.2.14.RELEASE.jar                                                                   100%  865KB 864.9KB/s   00:00    
spring-expression-3.2.14.RELEASE.jar                                                             100%  192KB 192.0KB/s   00:00    
spring-jdbc-3.2.14.RELEASE.jar                                                                   100%  396KB 396.5KB/s   00:00    
spring-jms-3.2.14.RELEASE.jar                                                                    100%  202KB 201.5KB/s   00:00    
spring-orm-3.2.14.RELEASE.jar                                                                    100%  377KB 376.6KB/s   00:00    
spring-security-config-3.2.8.RELEASE.jar                                                         100%  398KB 398.1KB/s   00:00    
spring-security-core-3.2.8.RELEASE.jar                                                           100%  363KB 363.0KB/s   00:00    
spring-security-saml2-core-1.0.1.RELEASE.jar                                                     100%  223KB 222.7KB/s   00:00    
spring-security-web-3.2.8.RELEASE.jar                                                            100%  339KB 339.3KB/s   00:00    
spring-test-3.2.14.RELEASE.jar                                                                   100%  448KB 447.6KB/s   00:00    
spring-tx-3.2.14.RELEASE.jar                                                                     100%  237KB 236.9KB/s   00:00    
spring-web-3.2.14.RELEASE.jar                                                                    100%  618KB 617.6KB/s   00:00    
wiquery-1.2.3.2-20150604.122120-1.jar                                                            100% 1692KB   1.7MB/s   00:00    

/ Nu weer op de laptop	,

[jboss@application-a ~]$ (cd /local/apps/jboss-4.0.5.GA/server/mpo/lib/;awk 'END{print NR}' <(ls -l $(awk '/MUST_BE_REMOVED/ && /.jar/{print $8}' /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log)))
36
/ Klopt	,
[jboss@application-a releases]$ awk '/MISSING/ && /.jar/{print $8}' /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log
activeio-core-3.1.4.jar
...
[jboss@application-a ~]$ (cd /local/apps/jboss-4.0.5.GA/server/mpo/lib/;rm -f $(awk '/MUST_BE_REMOVED/ && /.jar/{print $8}' /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log))
/ OK
[jboss@application-a ~]$ (cd /local/apps/jboss-4.0.5.GA/server/mpo/lib/;ls -l $(awk '/MUST_BE_REMOVED/ && /.jar/{print $8}' /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log))
ls: activeio-core-3.1.2.jar: No such file or directory
...

[jboss@application-a ~]$ (cd /local/apps/jboss-4.0.5.GA/server/mpo/lib/;awk 'END{print NR}' <(find  ~vanderveldene/Downloads/ -name "*.jar"))
37
/ Klopt	,
[jboss@application-a ~]$ (cd /local/apps/jboss-4.0.5.GA/server/mpo/lib/;cp $(find  ~vanderveldene/Downloads/ -name "*.jar") .)

/ check	,
[jboss@application-a ~]$ (cd /local/apps/jboss-4.0.5.GA/server/mpo/lib/; awk '/MISSING/ && /.jar/{print $8}' /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log)
activeio-core-3.1.4.jar
...
[jboss@application-a ~]$ (cd /local/apps/jboss-4.0.5.GA/server/mpo/lib/; awk 'END{print NR}' <(awk '/MISSING/ && /.jar/{print $8}' /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log))
37
[jboss@application-a ~]$ (cd /local/apps/jboss-4.0.5.GA/server/mpo/lib/; ls -l $(awk '/MISSING/ && /.jar/{print $8}' /local/apps/jboss-4.0.5.GA/server/mpo/log/server.log))
-rw-r--r--+ 1 jboss jboss  102578 Dec 23 16:08 activeio-core-3.1.4.jar
...
/ OK, ze zijn er	,


 

/ Einde DEPLOY

/ SPRING

/ 7	. 

/ Lees	,
http://stackoverflow.com/questions/600095/splitting-applicationcontext-to-multiple-files
http://www.mkyong.com/spring/load-multiple-spring-bean-configuration-file/

/ 7	. 
/ Lees	,
http://www.tutorialspoint.com/spring/spring_mvc_hello_world_example.htm
http://stackoverflow.com/questions/6451377/loading-context-in-spring-using-web-xml


/ 7	. 

[eric@localhost server]$  less pnltms/deploy/tms.war/WEB-INF/web.xml 

<context-param>
        <param-name>contextConfigLocation</param-name>
        <param-value> classpath:generate-beanrefcontext.xml </param-value>
</context-param>

<listener>
        <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
        <listener-class>com.mpobjects.core.listener.StartupWebAppContextListener</listener-class>
</listener>



/ Einde SPRING

/ SVN 

/ bij conflict	,
/ we willen de nieuwe file uit svn overnemen	,
/ Ga op file staan	, 
/ right click , Override and update: rm eigen aanpassingen ,

/ bij geen conflict	, maar wil eigen aanpasseingen rm , en wil de de (oude) file uit svn	,
/ right clilck , Revert	, rm eigen aan




/ Einde SVN CONFLICTS

/ PASCAL ISSUE

$ vi EntityDetailSupport.java

	@Override
	public boolean setEntityDetail(String aEntityDetailType, String value) {
		if (StringUtils.isBlank(aEntityDetailType)) {
			return false;
		}

		@Bug("SCS-4787")
		EntityDetailType type = null;
		try {
			type = getDao().getByEntityAndField(aEntityDetailType, getEntity());

/ hij queries op code	, niet op system_id	, dus geen caching , doet query	,

/ Einde PASCAL ISSUE

/ MENU TMS

/ in workspace	, 

$ vi servlets.xml

<servlet>
	<servlet-name>WicketServlet</servlet-name>
	<servlet-class>org.apache.wicket.protocol.http.WicketServlet</servlet-class>
	<init-param>
		<param-name>applicationClassName</param-name>
		<param-value>com.mpobjects.view.wicket.WicketWebApplication</param-value>
	</init-param>
	<load-on-startup>1</load-on-startup>
</servlet>

$ vi servlet-mappings.xml

<servlet-mapping>
	<servlet-name>WicketServlet</servlet-name>
	<url-pattern>/wicket/*</url-pattern>
</servlet-mapping>

/ Deze komen in web.xml terecht	, 

/ 13	. 

/ wicket link	,

/ we hebben menu item	'parties'	,
localhost:8080/tms/wicket?module=oms&amp;wicketpage=party.PartyListPage&amp;emptySession=true

/ we click	menu item	,
Request URL:http://localhost:8080/tms/wicket?module=oms&wicketpage=party.PartyListPage&emptySession=true
Status Code:302 Moved Temporarily

Request URL:http://localhost:8080/tms/wicket/?wicket:interface=:3::::
Status Code:200 OK

/ 13	. 

/ cocoon link	,

/ we click menu item shipment order, search	,

Request URL:http://localhost:8080/tms/oms/shipment-order_list?refresh=false&screenId=shipment-order&emptySession=true
Status Code:200 OK

/ bij de wicket page	,


/ requestDispatcherPath: /wicket/
/ parameters: 
	module=oms
	wicketpage=party.PartyList
	emptySession=true

/ 7	. 

$ vi WicketWebApplication.java

	@Override
	public Class getHomePage() {
		return BaseHomePage.class;
	}

/ we komen dus in BaseHomePage terecht	,

/ TODO

/ 7	. 

/ Wanneer wordt menu create	?

/ we start application tms	, het menu wordt WH niet create	,

/ eric  logs in	,
/s
MenuGenerateAction.act() line: 46	

$ vi core-sitemap.xmap
          <map:match pattern="index_frameset">
				<map:act type="setLocale"/>
				<map:act type="generateMenu">
					<map:parameter name="cssClass" value="xMenu"/>
					<map:parameter name="sessionAttribute" value="userMenu"/>
					<map:parameter name="urlPrefix" value="../"/>
				</map:act>				
                <map:generate type="jsp" src="jsp/index_frameset.jsp"/>
                <map:serialize type="html"/>
            </map:match>
/ TODO

		String myMenuLocation = ObjectModelHelper.getContext(getObjectModel()).getRealPath("menu.xml");
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnllogistics/./deploy/tms.war/menu.xml

		MenuService myMenuService = MpoBeanFactory.getBean(MenuService.class);

$ vi core-service.sb.xml

	<bean id="com.mpobjects.core.service.MenuService" class="com.mpobjects.core.service.MenuServiceImpl" scope="prototype">
		<!-- FIXME: should not be here, cross module dependency -->
		<property name="reportService" ref="com.mpobjects.oms.service.report.ReportService" />
	</bean>

		myMenuService.setUrlPrefix(getParameters().getParameter(URL_PREFIX, ""));
"../"
/ want	,
/ getParameters()=Parameters[r/w]:{sessionAttribute=userMenu, urlPrefix=../, cssClass=xMenu}
/ TODO
		myMenuService.setLanguageManager(new LanguageManager(new RequestAdaptor(getRequest())));
		myMenuService.setResource(getActiveResource());
eric
		myMenuService.setOpeningMenuProperty(getActiveResource().getProperty(PPTY_OPENING_MENU));
null (opening.menu)
		myMenuService.setCssClass(getParameters().getParameter("cssClass", ""));
xMenu
		String myContent = myMenuService.generateMenu(myMenuLocation);
/s
MenuServiceImpl.generateMenu(String) line: 109	
		Reader myReader = new FileReader(aMenuLocation);
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnllogistics/./deploy/tms.war/menu.xml
		String myGeneratedMenu = generateMenu(myReader, MenuConfig.SCS);
/s
MenuServiceImpl.generateMenu(Reader, MenuConfig) line: 63	

		XStream myStream = new XStream(new DomDriver());
		MenuItemXStreamConfig.configure(myStream);
/s
MenuItemXStreamConfig.configure(XStream) line: 93	
		xstream.alias("menuItem", MenuItem.class);
		xstream.useAttributeFor(MenuItem.class, "index");
		xstream.useAttributeFor(MenuItem.class, "parent");
		xstream.registerLocalConverter(MenuItem.class, "path", new MenuItemPathConverter());
		xstream.alias("menuItemType", MenuItemType.class);
		xstream.registerConverter(new ActionPrivilegeConverter());
		xstream.addImmutableType(ActionPrivilege.class);
/ TODO
/t
MenuServiceImpl.generateMenu(Reader, MenuConfig) line: 63	
		MenuItemXStreamConfig.configure(myStream);
/d
		MenuItem myRootMenu = (MenuItem) myStream.fromXML(aReader);

myRootMenu	MenuItem  (id=21913)	
	children	ArrayList  (id=21918)	
		elementData	Object[10]  (id=21920)	
			[0]	MenuItem  (id=21921)	
				children	ArrayList  (id=21929)	
					elementData	Object[15]  (id=21934)	
						[0]	MenuItem  (id=21935)	
							children	ArrayList  (id=21959)	
								elementData	Object[10]  (id=21966)	
									[0]	MenuItem  (id=21969)	
									[1]	MenuItem  (id=21970)	
									[2]	MenuItem  (id=21971)	
									[3]	MenuItem  (id=21972)	
									[4]	MenuItem  (id=21973)	
									[5]	MenuItem  (id=21974)	
								modCount	6	
								size	6	
							description	null	
							index	-1	
							labelId	"execution" (id=21960)	
							module	null	
							parent	MenuItem  (id=21921)	
							path	String[2]  (id=21961)	
							privilege	null	
							target	null	
							type	MenuItemType  (id=21263)	
							url	null	
							visibilityExpr	"" (id=21933)	
						[1]	MenuItem  (id=21936)	
						[2]	MenuItem  (id=21937)	
						[3]	MenuItem  (id=21938)	
						[4]	MenuItem  (id=21939)	
						[5]	MenuItem  (id=21940)	
						[6]	MenuItem  (id=21941)	
						[7]	MenuItem  (id=21942)	
						[8]	MenuItem  (id=21943)	
						[9]	MenuItem  (id=21944)	
						[10]	MenuItem  (id=21945)	
							children	ArrayList  (id=22098)	
							description	null	
							index	-1	
							labelId	"massupdate" (id=22099)	
							module	null	
							parent	MenuItem  (id=21921)	
							path	String[2]  (id=22102)	
							privilege	null	
							target	null	
							type	MenuItemType  (id=21263)	
							url	null	
							visibilityExpr	"" (id=21933)	


					modCount	11	
					size	11	
				description	null	
				index	1000	
				labelId	"configuration" (id=21930)	
				module	"core" (id=21931)	
				parent	MenuItem  (id=21913)	
				path	String[1]  (id=21932)	
				privilege	null	
				target	null	
				type	MenuItemType  (id=21263)	
				url	null	
				visibilityExpr	"" (id=21933)	
			[1]	MenuItem  (id=21922)	
				children	ArrayList  (id=21946)	
				description	null	
				index	2000	
				labelId	"planning" (id=21947)	
				module	"core" (id=21931)	
				parent	MenuItem  (id=21913)	
				path	String[1]  (id=21985)	
				privilege	null	
				target	null	
				type	MenuItemType  (id=21263)	
				url	null	
				visibilityExpr	"" (id=21933)	
			[2]	MenuItem  (id=21923)	
			[3]	MenuItem  (id=21924)	
			[4]	MenuItem  (id=21925)	
			[5]	MenuItem  (id=21926)	
			[6]	MenuItem  (id=21927)	
			[7]	MenuItem  (id=21928)	
				children	null	
				description	null	
				index	65536	
				labelId	"logout" (id=22065)	
				module	"authentication" (id=22066)	
				parent	MenuItem  (id=21913)	
				path	String[1]  (id=22067)	
				privilege	null	
				target	"_top" (id=22068)	
				type	MenuItemType  (id=21263)	
				url	"authentication/logout?emptySession=true" (id=22069)	
				visibilityExpr	"" (id=21933)	
		size	8	

/ we zien dat het hoofmenu uit 8 items bestaat	,  "configuration", ..., "logout"
/ we zien dat het 1ste hoofditem "configuration 11 items heeft	, "execution", ...,   "massupdate"
...

		// Get the menu items from the menuproviders
		for (MenuProvider myProvider : MpoBeanFactory.getBean(MenuProviderList.class).getProviders()) {
/ NEE

		// Get the menu items from the resource service
		Collection<MenuItem> myReportItems = getReportService().getMenuItems(getResource(), aConfig.name());
/s
ReportServiceImpl.getMenuItems(Resource, String) line: 49	

		for (ReportVO myReport : reportDAO.getReportsForMenu()) {
[Depot_Extract_Plan_Datum,
 Performance Party Group (pdf),
 Carrier Settlement,
 Customer report,
 PerfPartyGroup-All,
 Timeliness report,
 Status_report,
 Scan report,
 POD report,
 Depot_Extract Boek_Datum,
 Pick-up orders,
 Performance Party Group unexpected events,
 CashOnDeliveryCheck,
 Scan_Select_Input]

/ myReport
[Depot_Extract_Plan_Datum,

			ActionPrivilege myPrivilege = new ActionPrivilege("report", "list");
			boolean hasAccess = true;

			for (ReportContextVO myContext : myReport.getContextList()) {
/ NEE

			if (hasAccess && StringUtils.isNotEmpty(myReport.getMenu())) {
				MenuItem myItem = new MenuItem((myReport.getMenu() + "." + myReport.getReportId()).split("\\."), myReport.getMenuIndex());
report.depotExtractPlanDatum#9999 (depotExtractPlanDatum)
				String myUrl = "wicket?module=oms&wicketpage=report.ReportInputFormPage&reportSystemId=" + myReport.getSystemId();
wicket?module=oms&wicketpage=report.ReportInputFormPage&reportSystemId=26836217
				if (!StringUtils.isEmpty(aType)) {
					myUrl += "&screentype=" + aType;
				}
wicket?module=oms&wicketpage=report.ReportInputFormPage&reportSystemId=26836217&screentype=SCS
				myItem.setUrl(myUrl);
				myItem.setLabelId(myReport.getName());
				myItem.setPrivilege(myPrivilege);
				myMenuItems.add(myItem);

myItem	MenuItem  (id=21241)	
	children	null	
	description	null	
	index	9999	
	labelId	"Depot_Extract_Plan_Datum" (id=21235)	
	module	null	
	parent	null	
	path	String[2]  (id=21262)	
	privilege	ActionPrivilege  (id=21017)	
	target	null	
	type	MenuItemType  (id=21263)	
	url	"wicket?module=oms&wicketpage=report.ReportInputFormPage&reportSystemId=26836217&screentype=SCS&emptySession=true" (id=21277)	
	visibilityExpr	"" (id=21278)	
myUrl	"wicket?module=oms&wicketpage=report.ReportInputFormPage&reportSystemId=26836217&screentype=SCS" (id=21256)	

/ volgende	,
		for (ReportVO myReport : reportDAO.getReportsForMenu()) {
Performance Party Group (pdf)

			ActionPrivilege myPrivilege = new ActionPrivilege("report", "list");
			boolean hasAccess = true;
			for (ReportContextVO myContext : myReport.getContextList()) {
/NEE
			if (hasAccess && StringUtils.isNotEmpty(myReport.getMenu())) {
				MenuItem myItem = new MenuItem((myReport.getMenu() + "." + myReport.getReportId()).split("\\."), myReport.getMenuIndex());
report.operational.pdf Performance party group#9999 (pdf Performance party group)
				String myUrl = "wicket?module=oms&wicketpage=report.ReportInputFormPage&reportSystemId=" + myReport.getSystemId();
wicket?module=oms&wicketpage=report.ReportInputFormPage&reportSystemId=26832405
				if (!StringUtils.isEmpty(aType)) {
					myUrl += "&screentype=" + aType;
				}
wicket?module=oms&wicketpage=report.ReportInputFormPage&reportSystemId=26832405&screentype=SCS
				myItem.setUrl(myUrl);
				myItem.setLabelId(myReport.getName());
				myItem.setPrivilege(myPrivilege);
				myMenuItems.add(myItem);
			}

		}

/ volgende	, 
...
		return myMenuItems;

myMenuItems	ArrayList  (id=20524)	
	elementData	Object[15]  (id=21388)	
		[0]	MenuItem  (id=21241)	
		[1]	MenuItem  (id=21375)	
		[2]	MenuItem  (id=21389)	
		[3]	MenuItem  (id=21390)	
		[4]	MenuItem  (id=21391)	
		[5]	MenuItem  (id=21392)	
		[6]	MenuItem  (id=21393)	
		[7]	MenuItem  (id=21394)	
		[8]	MenuItem  (id=21395)	
		[9]	MenuItem  (id=21396)	
		[10]	MenuItem  (id=21397)	
		[11]	MenuItem  (id=21398)	
		[12]	MenuItem  (id=21399)	
		[13]	MenuItem  (id=21400)	
	size	14	

/t
MenuServiceImpl.generateMenu(Reader, MenuConfig) line: 87	
		Collection<MenuItem> myReportItems = getReportService().getMenuItems(getResource(), aConfig.name());
/d
		for (MenuItem myItem : myReportItems) {
			myRootMenu.addChild(myItem);
		}
		switch (aConfig) {
			case APP:
/ NEE
			default:
				return generateScsMenu(myRootMenu);
/s
MenuServiceImpl.generateScsMenu(MenuItem) line: 281	
		StringBuilder sb = new StringBuilder();
		sb.append("<ul class=\"");
		sb.append(StringEscapeUtils.escapeHtml(getCssClass()));
		sb.append("\">");
		for (MenuItem mi : aRootMenu.getChildren()) {
			sb.append(generateScsMenuInner(mi));
		}
		sb.append("</ul>");
		return sb.toString();
/ OK






/ Einde MENU TMS


/ PCT-1001

/ 7	. 

pnllogistics=> select u.* from user_role ur join tms_role r on ur.role_systemid=r.system_id join tms_user u on ur.user_systemid=u.system_id where r.name='R_FINANCE';
 system_id |  user_id   |     user_name      |     user_email_address      | is_enabled | is_deleted |       last_login     
   | login_attempt | is_first_login |  last_password_update   | chargeable | grace_login | created_by | created_on | user_pa
ssword | is_interface_account | user_reference1 | user_reference2 | local_account | time_zone 
-----------+------------+--------------------+-----------------------------+------------+------------+----------------------
---+---------------+----------------+-------------------------+------------+-------------+------------+------------+--------
-------+----------------------+-----------------+-----------------+---------------+-----------
  26780071 | u_finance  | Employee financien | NULL                        |          1 |          0 | 2015-11-27 15:24:57.3
56 |             0 |              0 | 2015-11-27 15:11:58.737 |          0 |           0 |   26680352 | 2015-05-29 | u_finan
ce     |                    0 | NULL            | NULL            |             1 | NULL
  26859566 | gerardtest | gerardtest         | NULL                        |          1 |          0 | 2015-10-08 16:00:16.2
78 |             0 |              0 | 2015-10-08 15:53:36.567 |          0 |           0 |   26680352 | 2015-10-08 | pnlc   
       |                    0 | NULL            | NULL            |             1 | NULL
  26682499 | gerard2    | Gerard             | gerard.senne@mp-objects.com |          1 |          0 | 2015-12-17 10:46:17.7
62 |             0 |              0 | 2015-08-18 09:19:54.603 |          0 |           0 |   26680352 | 2015-04-20 | Mpo2015
       |                    0 | NULL            | NULL            |             1 | NULL
  26932683 | madhavi    | madhavi            | NULL                        |          1 |          0 | 2015-12-21 06:08:09.7
18 |             0 |              0 | 2015-12-21 06:07:19.172 |          1 |           0 |   26817075 | 2015-12-21 | admin@1
23     |                    0 | NULL            | NULL            |             1 | NULL
(4 rows)

/ 7	. 

/ u_finance logs in	,

/ FIX

/ geef role R_FINANCE privilege invoice.list

/ Einde FIX


/ Einde PCT-1001

/ DEPLOY 

/ po pnl-app-a	,
[jboss@pnl-app-a pnltms]$ echo $(awk '/MISSING/&&/.jar/{print $8}' <(tail -100 log/server.log))

/ op laptop	,
[eric@localhost pnllogistics]$ (cd lib;scp bcprov-jdk15on-1.53.jar opensaml-2.6.4.jar openws-1.5.4.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar vanderveldene@pnl-app-a.intermax.mp-objects.com:Downloads/pnltms)

[jboss@pnl-app-a pnltms]$ cp -a ~vanderveldene/Downloads/pnltms/* /local/apps/jboss-4.0.5.GA/server/pnltms/lib/

/ Einde DEPLOY 

/ PCT-343 

/ er zijn shipment order details en entity details	,
/ Entity details zitten in een aparte table	,

/ 7	. 

$ vi shipment-order_edit.jsp

<%@taglib prefix="tmstags" tagdir="/WEB-INF/tags/oms/"%>
						<div class="up" id="entityDetails">
							<tmstags:entity-detail-list extraFieldList="${formVO.entityDetailsForDisplay}" process="${formVO.shipmentOrderProcess}" organization="${formVO.organizationSystemid}" />
						</div>

[eric@localhost pnllogistics]$ grep entity <(find "$(find -path */WEB-INF/tags/oms)" )
./deploy/tms.war/WEB-INF/tags/oms/entity-detail-list.tag

$ vi entity-detail-list.tag
<c:forEach var="myEntry" items="${extraFieldList}">
	<c:set var="myDetailType" value="${myEntry.type}" />
	<c:set var="myValue" value="${myEntry.value}" />


/s
ShipmentOrderVO(EntityDetailSupport).getEntityDetailsForDisplay() line: 186	
		return MpoBeanFactory.getBean(EntityDetailService.class).getDisplayList(this);
/s
EntityDetailServiceImpl.getDisplayList(EntityDetailSupport) line: 56	
		EntityType myEntity = anEntityDetailSupport.getEntity();
/=
ShipmentOrderVO.class
	public EntityType getEntity() {
		return EntityType.SHIPMENT_ORDER;

		List<EntityDetailType> myByEntity = getEntityDetailTypeDAO().getByEntity(myEntity);

/ Intermezzo

$ vi EntityDetailType.standard.hbm.xml

	<class name="com.mpobjects.oms.model.entity.entitydetailtype.EntityDetailType" table="ENTITY_DETAIL_TYPE" >

pnllogistics4t=# select name from entity_detail_type where entity='SHIPMENT_ORDER' and is_deleted=0;
         name          
-----------------------
 Checked
 Goedgekeurd
 BarcodeHold
 DuplicateHold
 ProductKenmerkSoort
 DefaultWeight
 KlantSpecifiek
 TijdsVenster
 OptieSoort
 ShipmentReferentieNo
 ManualPricing
 ShipToOpmerkingen
 OntvangenBedragCash
 TotaalADRPuntenAantal
 OntvangenBedragPin
 EilandToeslag
 Klantreferentie
 LabelNodig
 CashOnDeliveryRemarks
 ShipFromOpmerkingen
 ColloHoldChecked
(21 rows)

/ visibility=NULL als entity='SHIPMENT_ORDER', entity.serviceOrderTypeVO.code == 'COLLECT' bijv, als entity='SERVICE_ORDER'	,


/ Einde Intermezzo

		List<EntityDetailType> myList = new ArrayList<EntityDetailType>(myByEntity);
		Collections.sort(myList, new EntityDetailTypeComparator());
		for (EntityDetailType myType : myList) {
			// If present, take visibility expr of the group otherwise take the one of the type
			String myVisibilityExpr = myType.getVisibilityExpr();
null
			if (myVisibilityExpr == null) {
/ JA
				// The visibility expr functionality can be replaced with the permission one
				if (!PermissionType.NONE.equals(myManager.checkPermissionForEntityDetail(anEntityDetailSupport, myType))) {
/ JA
					myResult.add(new EntityDetailWrapper(myType, anEntityDetailSupport));
/ anEntityDetailSupport=sho	,

		return myResult;


/c
EntityDetailWrapper.getType() line: 65	
		return type;
SystemId:26734011	IsDeleted:false	Detail Type:EilandToeslag	ValueType:BOOLEAN	

/c
EntityDetailWrapper.getValue() line: 69	
		return map.get(type);
""

/c
	public EntityDetailType getType() {
		return type;
SystemId:26827907	IsDeleted:false	Detail Type:ManualPricing	ValueType:BOOLEAN	

/c
	public String getValue() {
		return map.get(type);
"0"

/ 7	. 

$ vi entity-detail-list.tag

<%@taglib prefix="ctf" uri="/WEB-INF/tld/core-functions.tld"%>

<c:forEach var="myEntry" items="${extraFieldList}">
	<c:set var="myDetailType" value="${myEntry.type}" />
	<c:set var="myValue" value="${myEntry.value}" />
/d
	<c:set var="detailProcess" value="${ctf:organizationPropertyNoException(myDetailType.organization.systemId, '', 'process.type', 'none',false)}" />

	<c:if test="${myDetailType.valueType!='HIDDEN'}">
/ JA	, 'STRING', 'BOOLEAN'	, ...					/ see value_type column in entity_detail_type table	,
		<c:if test="${detailProcess == process||detailProcess=='none'}">
/ detailProcess=='none'
/ want	,

$ vi core-functions.tld
<function>
	<name>organizationPropertyNoException</name>
    <function-class>com.mpobjects.core.ApplicationPropertyManager</function-class>
    <function-signature>
        java.lang.String  taglibGetOrganizationProperty(int, java.lang.String,java.lang.String,java.lang.String,boolean)
    </function-signature>
</function>

/c
ApplicationPropertyManager.taglibGetOrganizationProperty(int, String, String, String, boolean) line: 129	
/=
	public static String taglibGetOrganizationProperty(int anOrganizationSystemId, String aModule, String aKey, String aDefaultValue, boolean aThrowException) {
		return getInstance().getModuleOrganizationProperty(anOrganizationSystemId, aModule, aKey, aDefaultValue, aThrowException);
anOrganizationSystemId	500	
aModule	"" (id=23710)	
aKey	"process.type" (id=23711)	
aDefaultValue	"none" (id=23712)	
aThrowException	false	

/s
	public String getModuleOrganizationProperty(int anOrganizationSystemid, String aModule, String aKey, String aDefaultValue, boolean aThrowException) {
		return getOrganizationProperty(anOrganizationSystemid, getPropertyKey(aModule, aKey), aDefaultValue, aThrowException);
/s
ApplicationPropertyManager.getOrganizationProperty(int, String, String, boolean) line: 396	
/=
	public String getOrganizationProperty(int anOrganizationSystemid, String aPropertyKey, String aDefaultValue, boolean aThrowException) {
anOrganizationSystemid	500	
aPropertyKey	"process.type" (id=23711)	
aDefaultValue	"none" (id=23712)	
aThrowException	false	

/ aPropertyKey="process.type"	, want module=""	, anders was aPropertyKey=module.<the module name>.process.type	,

		Resource myResource = AuthenticationUtils.getResource();
		Organization myOrganization = null;

		if (myResource != null) {
			for (Organization myResourceOrganization : myResource.getOrganizations()) {
/ dit zijn er 4	,
				if (myResourceOrganization.getSystemId() == anOrganizationSystemid) {
					myOrganization = myResourceOrganization;
SystemId:500	Id:PNL-CARGO	Description:PostNL Cargo
					break;

		String myRet = myOrganization.getProperty(aPropertyKey, aDefaultValue);
myRet	"none" (id=23712)	

/ 7. 	

$ vi entity-detail-list.tag

pnllogistics4t=# select name,value_type from entity_detail_type where entity='SHIPMENT_ORDER' and is_deleted=0;
         name          | value_type 
-----------------------+------------
 Checked               | BOOLEAN
 Goedgekeurd           | BOOLEAN
 BarcodeHold           | BOOLEAN
 DuplicateHold         | BOOLEAN
 ProductKenmerkSoort   | LIST
 DefaultWeight         | NUMBER
 KlantSpecifiek        | REMARKS
 TijdsVenster          | LIST
 OptieSoort            | LIST
 ShipmentReferentieNo  | REMARKS
 ManualPricing         | BOOLEAN
 ShipToOpmerkingen     | REMARKS
 OntvangenBedragCash   | AMOUNT
 TotaalADRPuntenAantal | STRING
 OntvangenBedragPin    | AMOUNT
 EilandToeslag         | BOOLEAN
 Klantreferentie       | REMARKS
 LabelNodig            | BOOLEAN
 CashOnDeliveryRemarks | REMARKS
 ShipFromOpmerkingen   | REMARKS
 ColloHoldChecked      | BOOLEAN
(21 rows)

/ 7	. 

					<mpo:setFormVO valueObject="${myEntry}" prefix="${myDetailType.name}">
						<tr>
							<td class="label"><mpo:label firstCharToUpper="true" name="${myDetailType.name}" /></td>
							<td align="left"><c:choose>
									<c:when test="${myDetailType.valueType=='BOOLEAN'}">
										<mpo:booleanField showFieldContext="false" name="value"
											readOnly="${myDetailType.readOnlyString?myDetailType.readOnlyString:form.formReadOnly}" />
									</c:when>


/ 13	. 

$ vi FormTag.java

	@Override
	public int doStartTag() throws JspTagException {

		if (StringUtils.isNotEmpty(getDestionationAttribute())) {
			getRequest().setAttribute(getDestionationAttribute(), this);
getDestionationAttribute()="form"
		
/ Deze wordt NIET used in de JSPs	, maar in SetFormTagVO	, om aan de formtag te komen	,

$ vi SetFormTagVO.java

	@Override
	public int doStartTag() throws JspTagException {
		if (getValueObject() == null) {
/ NEE
sho
/ TODO (wanneer set	?)
		getForm().addValueObject(getValueObject());
/s
SetFormVOTag.getForm() line: 149	
			if (getRequest() != null && getRequest().getAttribute(FormTag.DEFAULT_DESTINATION_ATTRIBUTE) instanceof FormTag) {
FormTag.DEFAULT_DESTINATION_ATTRIBUTE="form"
				theFormTag = (FormTag) getRequest().getAttribute(FormTag.DEFAULT_DESTINATION_ATTRIBUTE);

/t
SetFormVOTag.doStartTag() line: 109	
		getForm().addValueObject(getValueObject());
/s
FormTag.addValueObject(EntityInterface) line: 222	
			theValueObjects.add(aVO);

/ Dus theValueObject uit de SetFormVOTag komt in theValueObjects van de FormTag	,

/ 13	. 

$ vi shipment-order_edit.jsp
						<mpo:booleanField name="dangerousGoodsYn"
							readOnly="${cf:property('oms', 'extended.hazgoods.enabled', 'false')=='true' && cf:property('oms', 'shipmentorder.derive.hazgoods.from.items', 'true')=='true'}" overRideable="true" />
/s
BooleanFieldTag(FieldTag).doStartTag() line: 347	
					appendLabelPart(myRet);
/s
BooleanFieldTag(FieldTag).appendLabelPart(StringBuffer) line: 1007	
		aBuffer.append(getLabel());
/s
BooleanFieldTag(FieldTag).getLabel() line: 1166	
		return getLabel(StringUtils.isEmpty(getLanguageKey()) ? getName() : getLanguageKey());
getLanguageKey()=null	, dat heeft deze <mpo:booleanField/> inderdaad niet	,
/t
/s
	public String getName() {
		return name;
"dangerousGoodsYn"
/ Klopt	, dat is de attr van <mpo:booleanField/>

/t
	protected String getLabel() {
		return getLabel(StringUtils.isEmpty(getLanguageKey()) ? getName() : getLanguageKey());
/s
	protected String getLabel(String aName) {
		return getLanguageManager().getByJavaName(getFieldOwner().getEntity(), aName);

/ 13	. 

$ vi shipment-order_edit.jsp
						<mpo:field name="reference3" languageKey="shipmentorder.reference3.${cf:property('', 'base.product','')}.${fn:toLowerCase(formVO.shipmentOrderProcess)}" overRideable="true" size="15" />

/s
FieldTag.doStartTag() line: 347	
					appendLabelPart(myRet);
/s
FieldTag.appendLabelPart(StringBuffer) line: 1007	
		aBuffer.append(getLabel());
/s
FieldTag.getLabel() line: 1166	
		return getLabel(StringUtils.isEmpty(getLanguageKey()) ? getName() : getLanguageKey());

/ Nu is er een language key	,

FieldTag.getLabel(String) line: 1176	
		return getLanguageManager().getByJavaName(getFieldOwner().getEntity(), aName);
/s
LanguageManager.getByJavaName(String, String) line: 366	
/=
	public String getByJavaName(String anEntityName, String aFieldName) {
anEntityName	"shipmentOrder" (id=29956)	
aFieldName	"shipmentorder.reference3.pnllogistics.lb" (id=29945)	

		String myTableName = StringUtils.formatJavaToSql(anEntityName).toString();
"shipment_order"
		String myFieldName = StringUtils.formatJavaToSql(aFieldName).toString();
"shipmentorder.reference3.pnllogistics.lb" (id=29945)	
		String myRet;
		if (StringUtils.isNotEmpty(myTableName)) {
			myRet = get(myTableName, myFieldName);
/s
LanguageManager.get(String, String) line: 258	
			myFullCode = "table_" + aTableName + "_" + aField;
myFullCode	"table_shipment_order_shipmentorder.reference3.pnllogistics.lb" (id=30380)	
		}
		try {
			myRet = get(myFullCode, true);
/s
LanguageManager.get(String, boolean) line: 247	
		return get(aFullCode, StringUtils.EMPTY_STRING_MAP, aThrowExceptionIfNotFound);
/s
LanguageManager.get(String, Map<String,String>, boolean) line: 576	
/=
	private String get(String aFullCode, Map<String, String> aFieldMap, boolean aThrowExceptionIfNotFound) throws IndexOutOfBoundsException {
myFullCode	"table_shipment_order_shipmentorder.reference3.pnllogistics.lb" (id=30380)	
aFieldMap={}
aThrowExceptionIfNotFound=true

		String myFullCode = aFullCode.toLowerCase();
		String myProductSpecificCode = getProduct() + "." + myFullCode;
pnllogistics.table_shipment_order_shipmentorder.reference3.pnllogistics.lb

		Properties lang = getPropertiesFile();
		myRet = lang.getProperty(myProductSpecificCode, null);
null
		if (myRet == null) {
			myRet = lang.getProperty(myFullCode, null);
null
		if (myRet == null) {
			if (aThrowExceptionIfNotFound) {
				throw new IndexOutOfBoundsException(myFullCode + " Not found in language file.");
/t
LanguageManager.get(String, String) line: 271	
		try {
			myRet = get(myFullCode, true);
		} catch (IndexOutOfBoundsException e) {
		}
/d
		if (myRet == null) {
			try {
				myRet = get(aField, true);
aField	"shipmentorder.reference3.pnllogistics.lb" (id=30366)	
/s
LanguageManager.get(String, boolean) line: 247	
		return get(aFullCode, StringUtils.EMPTY_STRING_MAP, aThrowExceptionIfNotFound);
/s
	private String get(String aFullCode, Map<String, String> aFieldMap, boolean aThrowExceptionIfNotFound) throws IndexOutOfBoundsException {
aFullCode	"shipmentorder.reference3.pnllogistics.lb" (id=30366)	
aFieldMap={}
aThrowExceptionIfNotFound=true

/ zonet	,
myFullCode	"table_shipment_order_shipmentorder.reference3.pnllogistics.lb" (id=30380)	

		String myFullCode = aFullCode.toLowerCase();
"shipmentorder.reference3.pnllogistics.lb"
		String myProductSpecificCode = getProduct() + "." + myFullCode;
shipmentorder.reference3.pnllogistics.lb

		Properties lang = getPropertiesFile();
		myRet = lang.getProperty(myProductSpecificCode, null);
null
		if (myRet == null) {
			myRet = lang.getProperty(myFullCode, null);
myRet	"Import Partner Shipment order" (id=30370)	
/ Deze is er	, 

		return myRet;

/ 13	. 

$ vi entity-detail-list.tag

->							<td class="label"><mpo:label firstCharToUpper="true" name="${myDetailType.name}" /></td>
->->										<mpo:booleanField showFieldContext="false" name="value"
											readOnly="${myDetailType.readOnlyString?myDetailType.readOnlyString:form.formReadOnly}" />

/ ze staan nu los	, 
/ Inderdaad	, 


/c

/ ->
LabelTag.doStartTag() line: 41	
this	com.mpobjects.view.taglib.LabelTag  (id=30615)	
	theEntity	"shipmentOrder" (id=29956)	
	theFirstCharToUpper	true	
	theLanguageManager	com.mpobjects.util.multilang.LanguageManager  (id=30614)	
	theName	"ManualPricing" (id=30661)	
	values	null	

		String myString = getLanguageManager().getByJavaName(theEntity, theName);
/s
LanguageManager.getByJavaName(String, String) line: 366	
anEntityName	"shipmentOrder" (id=29956)	
aFieldName	"ManualPricing" (id=30661)	
		String myTableName = StringUtils.formatJavaToSql(anEntityName).toString();
shipment_order
		String myFieldName = StringUtils.formatJavaToSql(aFieldName).toString();
manual_pricing
		String myRet;
		if (StringUtils.isNotEmpty(myTableName)) {
			myRet = get(myTableName, myFieldName);
/s
LanguageManager.get(String, String) line: 258	
			aTableName = StringUtils.formatJavaToSql(aTableName).toString();
			myFullCode = "table_" + aTableName + "_" + aField;
table_shipment_order_manual_pricing
		}
		try {
			myRet = get(myFullCode, true);
/s
		return get(aFullCode, StringUtils.EMPTY_STRING_MAP, aThrowExceptionIfNotFound);
/s
LanguageManager.get(String, Map<String,String>, boolean) line: 576	
		String myFullCode = aFullCode.toLowerCase();
table_shipment_order_manual_pricing
		String myProductSpecificCode = getProduct() + "." + myFullCode;
pnllogistics.table_shipment_order_manual_pricing

		Properties lang = getPropertiesFile();
		myRet = lang.getProperty(myProductSpecificCode, null);
null
		if (myRet == null) {
			myRet = lang.getProperty(myFullCode, null);
null
		}

		if (myRet == null) {
			if (aThrowExceptionIfNotFound) {
				throw new IndexOutOfBoundsException(myFullCode + " Not found in language file.");
			}
/t
LanguageManager.get(String, String) line: 273	
		try {
			myRet = get(myFullCode, true);
		} catch (IndexOutOfBoundsException e) {
		}
		if (myRet == null) {
			try {
				myRet = get(aField, true);
aField="manual_pricing"
...
/s
LanguageManager.get(String, Map<String,String>, boolean) line: 582	
		String myFullCode = aFullCode.toLowerCase();
manual_pricing
		String myProductSpecificCode = getProduct() + "." + myFullCode;
pnllogistics.manual_pricing

		Properties lang = getPropertiesFile();
		myRet = lang.getProperty(myProductSpecificCode, null);
null
		if (myRet == null) {
			myRet = lang.getProperty(myFullCode, null);
null

/t
LanguageManager.get(String, String) line: 277	
			try {
				myRet = get(aField, true);
			} catch (IndexOutOfBoundsException e) {
				int myPos = aField.lastIndexOf('.');
				if (myPos > 0) {
/ NEE
				myRet = aField.replaceAll("_", " ");
manual pricing
				if (StringUtils.isNotEmpty(myRet)) {
					myRet = myRet.substring(0, 1).toUpperCase() + myRet.substring(1);
Manual pricing
				}
				noTranslationFound(new String[] { myFullCode, aField });
/t
LabelTag.doStartTag() line: 42	
		String myString = getLanguageManager().getByJavaName(theEntity, theName);
Manual pricing
		...
		print(myString);

/ Op het scherm zien we "Manual Pricing"	, dus Pricing met een capital
/ TODO




/c

/ ->->

	@Override
	public int doStartTag() throws JspException {
this	com.mpobjects.view.taglib.form.BooleanFieldTag  (id=30617)	
				if (showFieldContext()) {
/ NEE
					appendHeaderStart(myRet);
					appendLabelPart(myRet);
					appendInputPartPrefix(myRet);
					appendInputPart(myRet);
/ NIET
				} else {
/ JA
					appendInputPart(myRet);

/ FIX PCT-343 

pnllogistics4t=# select name,value_type from entity_detail_type where entity='SHIPMENT_ORDER' and is_deleted=0;
         name          | value_type 
-----------------------+------------
 Checked               | BOOLEAN
 Goedgekeurd           | BOOLEAN
 BarcodeHold           | BOOLEAN
 DuplicateHold         | BOOLEAN
 ProductKenmerkSoort   | LIST
 DefaultWeight         | NUMBER
 KlantSpecifiek        | REMARKS
 TijdsVenster          | LIST
 OptieSoort            | LIST
 ShipmentReferentieNo  | REMARKS
 ManualPricing         | BOOLEAN
 ShipToOpmerkingen     | REMARKS
 OntvangenBedragCash   | AMOUNT
 TotaalADRPuntenAantal | STRING
 OntvangenBedragPin    | AMOUNT
 EilandToeslag         | BOOLEAN
 Klantreferentie       | REMARKS
 LabelNodig            | BOOLEAN
 CashOnDeliveryRemarks | REMARKS
 ShipFromOpmerkingen   | REMARKS
 ColloHoldChecked      | BOOLEAN

/ LanguageManager probeert in deze volgorde	,

pnllogistics.table_shipment_order_manual_pricing
table_shipment_order_manual_pricing
pnllogistics.manual_pricing
manual_pricing

/ we proberen zelf	,
/ bij TotaalADRPuntenAantal	,
pnllogistics.table_shipment_order_totaal_a_d_r_punten_aantal
table_shipment_order_totaal_a_d_r_punten_aantal
pnllogistics.totaal_a_d_r_punten_aantal
totaal_a_d_r_punten_aantal




/ Einde FIX PCT-343 



/ Einde PCT-343 

/ ANDER ISSUE SANDER

/ bijv op geosco	,
configuration, planning, stock keeping unit	,
'Stock Keeping unit'	,

/ Hoe product, stock location uit de elem? Voor versturen e-mail	, 

/ Einde ANDER ISSUE SANDER

/ MPO-251

/ 7	. 

/ Vergl	,

[eric@localhost bin]$ PGPASSWORD=mpopostgres@mpo psql -U mpopostgres -h  database-a.intermax.mp-objects.com mpo
Null display is "NULL".
psql (9.3.5, server 9.1.19)
Type "help" for help.

mpo=# \dg
                               List of roles
   Role name   |                   Attributes                   | Member of 
---------------+------------------------------------------------+-----------
 mpopostgres   | Superuser, Replication                         | {}
 vanderveldene | Password valid until infinity                  | {}

eric@localhost bin]$ PGPASSWORD="h^Zgcyr&Q" psql -U vanderveldene -h  database-a.intermax.mp-objects.com mpo
psql: FATAL:  password authentication failed for user "vanderveldene"

/ als mpopostgresql veranderen wachtwoord van vanderveldene	,
[eric@localhost bin]$ PGPASSWORD=mpopostgres@mpo psql -U mpopostgres -h  database-a.intermax.mp-objects.com mpo
mpo=# \password vanderveldene
Enter new password: h^Zgcyr&Q
Enter it again:h^Zgcyr&Q 
mpo=# \q

/ Nu kan wel	,
[eric@localhost bin]$ PGPASSWORD=h^Zgcyr\&Q psql -U vanderveldene -h  database-a.intermax.mp-objects.com mpo
Null display is "NULL".
psql (9.3.5, server 9.1.19)
Type "help" for help.

7	. 

/ Vergl	,

[eric@localhost bin]$ cat pnl-db-a-pg.sh 
PGPASSWORD=h^Zgcyr\&Q psql -U vanderveldene -h  pnl-app-a.intermax.mp-objects.com "$@" 
[eric@localhost bin]$ pnl-db-a-pg.sh  pnllogistics
/ Er is GEEN mpopostgres user	,
/ TODO


/ 7	. 

/ Maak de dump vanaf laptop van database-a's mpo database	,
 
[eric@localhost bin]$ cat mpo-pg_dump-a.sh 
#!/usr/bin/bash
#if [ "$#" -ne 1 ]
#then 
#	echo "Give database name" 
#	exit 7
#fi
cd ~/DB_TAP/Postgres/Backup
PGPASSWORD=mpopostgres@mpo pg_dump -U mpopostgres -Fc -n public -h database-a.intermax.mp-objects.com mpo | gzip > "mpo-a-$(date +%F).dump.gz" 

/ 7	. 

/ we doen 	,

[eric@localhost Backup]$ (cd ~/DB_TAP/Postgres/Backup/;PGPASSWORD=mpopostgres@mpo pg_dump -U mpopostgres -Fc -n public -h database-a.intermax.mp-objects.com mpo >mpo-a-$(date +%F).sql)

/ Intermezzo

/ we hadden per ongeluk niet .sql, maar .dump.gz	, 

$ FIL="$(ls -1trd ~/DB_TAP/Postgres/Backup/* | tail -1 )"

[eric@localhost Backup]$ awk '{gsub("dump.gz","sql")}{print}' < <(echo "$FIL")
/ of	,
[eric@localhost Backup]$ sed 's/dump.gz/sql/' <(echo "$FIL")
/home/eric/DB_TAP/Postgres/Backup/mpo-a-2015-11-27.sql

[eric@localhost Backup]$ mv "$FIL" "$(awk '{gsub("dump.gz","sql")}{print}' < <(echo "$FIL"))"
[eric@localhost Backup]$ ls -ltr | tail -1
-rw-rw-r--. 1 eric     eric      37592760 Nov 27 10:45 mpo-a-2015-11-27.sql

[eric@localhost Backup]$ gzip $(ls -1tr | tail -1)
[eric@localhost Backup]$ ls -ltr | tail -1
-rw-rw-r--. 1 eric     eric      36865143 Nov 27 10:45 mpo-a-2015-11-27.sql.gz
/ Scheelt nauwelijks	,

/ Einde Intermezzo


/ zet in file	,
[eric@localhost Backup]$ FIL="$(ls -1trd ~/DB_TAP/Postgres/Backup/* | tail -1 )"
[eric@localhost Backup]$ cat  <(echo "$FIL")
/home/eric/DB_TAP/Postgres/Backup/mpo-a-2015-11-27.dump.gz

/ we kunnen ook	, 

[eric@localhost Backup]$ (cd ~/DB_TAP/Postgres/Backup/;PGPASSWORD=mpopostgres@mpo pg_dump -U mpopostgres -Fc -n public -h database-a.intermax.mp-objects.com mpo | gzip >mpo-a-$(date +%F).sql.gz)


/ 7	. 

[eric@localhost bin]$ cat mpo-db-t.sh 
#!/usr/bin/bash
PGPASSWORD=Eric789@MPO psql -U eric -h  mposerv8 mpo

/ 7	. 

/ we zien	,

[eric@localhost bin]$ mpo-db-t.sh   
Null display is "NULL".
psql (9.3.5, server 9.1.13)
SSL connection (cipher: DHE-RSA-AES256-SHA, bits: 256)
Type "help" for help.

mpo=> \dn+ public
                 List of schemas
  Name  | Owner | Access privileges | Description 
--------+-------+-------------------+-------------
 public | mpo   | admin=U*C*/mpo   +| 
        |       | reader=U/mpo     +| 
        |       | writer=U/mpo     +| 
        |       | mpo=UC/mpo       +| 
        |       | =UC/mpo           | 
(1 row)

[eric@localhost bin]$ pnl-db-t.sh pnllogistics
Null display is "NULL".
psql (9.3.5, server 9.3.10)
Type "help" for help.

pnllogistics=> \dn+ public
                                List of schemas
  Name  |    Owner     |      Access privileges       |      Description       
--------+--------------+------------------------------+------------------------
 public | pnllogistics | pnllogistics=UC/pnllogistics+| standard public schema
        |              | postgres=UC/pnllogistics    +| 
        |              | =UC/pnllogistics            +| 
        |              | admin=U*C*/pnllogistics     +| 
        |              | reader=U/pnllogistics       +| 
        |              | writer=U/pnllogistics        | 
(1 row)

/ we maken op laptop	,

[eric@localhost bin]$ vi mpo-db-restore-t.sh 
#!/usr/bin/bash

PGPASSWORD=Eric789@MPO psql -U eric -h mposerv8 mpo <<SQL
alter schema public rename to public_old;
create schema public;
grant all on schema public to admin with grant option;
grant usage on schema public to reader;
grant usage on schema public to writer;
SQL

/ Maar we doen de commands de 1ste keer toch maar met de hand	,

[eric@localhost bin]$ mpo-db-t.sh 
mpo=> \h alter schema
ALTER SCHEMA name RENAME TO new_name
ALTER SCHEMA name OWNER TO new_owner

mpo=> \h create schema
CREATE SCHEMA schema_name [ AUTHORIZATION user_name ] [ schema_element [ ... ] ]
CREATE SCHEMA AUTHORIZATION user_name [ schema_element [ ... ] ]
CREATE SCHEMA IF NOT EXISTS schema_name [ AUTHORIZATION user_name ]
CREATE SCHEMA IF NOT EXISTS AUTHORIZATION user_name

mpo=> alter schema public rename to public_old;
ALTER SCHEMA

/ check	
mpo=> \dn+ public_old
                   List of schemas
    Name    | Owner | Access privileges | Description 
------------+-------+-------------------+-------------
 public_old | mpo   | admin=U*C*/mpo   +| 
            |       | reader=U/mpo     +| 
            |       | writer=U/mpo     +| 
            |       | mpo=UC/mpo       +| 
            |       | =UC/mpo           | 
(1 row)

//////////
/ Ook alter schema is tx	, dus als we rollback doen	, is er weer public 	,

mpo=> alter schema public rename to public_old;
ALTER SCHEMA
mpo=> \dt public_old.*
                      List of relations
   Schema   |              Name               | Type  | Owner 
------------+---------------------------------+-------+-------
 public_old | address                         | table | mpo
 public_old | address_validation_exclusion    | table | mpo
...
mpo=> select count(*)from public_old.shipment_order;
 count 
-------
  2585
(1 row)

mpo=> \dn
    List of schemas
    Name    |  Owner   
------------+----------
 compat     | michielh
 public_mpo | mpo
 public_old | mpo
(3 rows)

/ 7	. 

/ IS NIET OK MOET NIET ALS ERIC MAAR ALS MPO

/ Hieronder doen we alles als database user eric	, maar moet als mpo	,


mpo=> create schema public;
CREATE SCHEMA

mpo=> \dn
    List of schemas
    Name    |  Owner   
------------+----------
 compat     | michielh
 public     | eric
 public_mpo | mpo
 public_old | mpo
(4 rows)

mpo=> \dn+ public
                 List of schemas
  Name  | Owner | Access privileges | Description 
--------+-------+-------------------+-------------
 public | eric  |                   | 
(1 row)

mpo=> grant all on schema public to admin with grant option;
GRANT

mpo=> \dn+ public
                 List of schemas
  Name  | Owner | Access privileges | Description 
--------+-------+-------------------+-------------
 public | eric  | eric=UC/eric     +| 
        |       | admin=U*C*/eric   | 
(1 row)

mpo=>  grant usage on schema public to reader;
GRANT
mpo=>  grant usage on schema public to writer;
GRANT
mpo=> \dn+ public
                 List of schemas
  Name  | Owner | Access privileges | Description 
--------+-------+-------------------+-------------
 public | eric  | eric=UC/eric     +| 
        |       | admin=U*C*/eric  +| 
        |       | reader=U/eric    +| 
        |       | writer=U/eric     | 
(1 row)

mpo=> commit;
COMMIT


/ 7	. 

 /print de jongste zip file met mpo-a er in	,

[eric@localhost bin]$ ls -1dtr ~/DB_TAP/Postgres/Backup/* | awk '/pnllogistics/{a=$0}END{print a}'
/ of	,
[eric@localhost bin]$ ls -1dtr ~/DB_TAP/Postgres/Backup/* | awk '/pnllogistics/' | tail -1
/home/eric/DB_TAP/Postgres/Backup/pnllogistics-a-2015-11-26.dump

/ omdat er maar 1 is	, werkt dit	,	
[eric@localhost bin]$ echo  "$(awk '/mpo-a/' <(ls -1dtr ~/DB_TAP/Postgres/Backup/*))"
/home/eric/DB_TAP/Postgres/Backup/mpo-a-2015-11-26.dump.gz

/ Lees	,
http://stackoverflow.com/questions/17298106/print-last-matching-line

[eric@localhost bin]$ ls -1dtr ~/DB_TAP/Postgres/Backup/* | awk '/mpo-a/{a=$0}END{print a}' | gzip -d
gzip: stdin: not in gzip format
/ Doe daarom	,
[eric@localhost Backup]$ ls -1dtr ~/DB_TAP/Postgres/Backup/* | awk '/mpo-a/{a=$0}END{print a}' | xargs gzip -d 
/ OK

/ 7	. 

/ Lees	,
http://superuser.com/questions/294161/unix-linux-find-and-sort-by-date-modified

/ over find, sort by time	,

/ 7	. 

[eric@localhost bin]$ cat mpo-pg_restore-t.sh 
#!/usr/bin/bash

FIL="$(ls -1trd ~/DB_TAP/Postgres/Backup/* | awk '/mpo-a/' | tail -1)"
echo Using "$FIL"
PGPASSWORD=Eric789@MPO pg_restore -U eric -h mposerv8 -d mpo --no-acl --no-owner "$FIL" 

/ we doen het nog even met de hand	,

[eric@localhost bin]$ PGPASSWORD=Eric789@MPO pg_restore -U eric -h mposerv8 -d mpo --no-acl --no-owner "$FIL"
pg_restore: [archiver (db)] Error while INITIALIZING:
pg_restore: [archiver (db)] could not execute query: ERROR:  unrecognized configuration parameter "lock_timeout"
    Command was: SET lock_timeout = 0;

WARNING: errors ignored on restore: 1
/ TODO

/ 7	. 

/ we gaan terug naar onze psql client	,
mpo=> \dn
    List of schemas
    Name    |  Owner   
------------+----------
 compat     | michielh
 public     | eric
 public_mpo | mpo
 public_old | mpo
(4 rows)

mpo=> \dt public.*
                    List of relations
 Schema |              Name               | Type  | Owner 
--------+---------------------------------+-------+-------
 public | address                         | table | eric
 public | address_validation_exclusion    | table | eric
...

/ 7	. 

/ Het WAS	,

po=> \ddp
                 Default access privileges
  Owner   | Schema |   Type   |     Access privileges      
----------+--------+----------+----------------------------
 admin    |        | function | admin=X*/admin            +
          |        |          | writer=X/admin
 admin    |        | sequence | admin=r*w*U*/admin        +
          |        |          | reader=r/admin            +
          |        |          | writer=rwU/admin
 admin    |        | table    | admin=a*r*w*d*D*x*t*/admin+
          |        |          | reader=r/admin            +
          |        |          | writer=arwd/admin
 anil     | compat | function | =X/anil
 anil     | compat | sequence | =rU/anil
 anil     | compat | table    | =rx/anil
 michielh | compat | function | =X/michielh
 michielh | compat | sequence | =rU/michielh
 michielh | compat | table    | =rx/michielh
 mpo      |        | function | admin=X*/mpo              +
          |        |          | writer=X/mpo              +
          |        |          | mpo=X/mpo
 mpo      |        | sequence | admin=r*w*U*/mpo          +
          |        |          | reader=r/mpo              +
          |        |          | writer=rwU/mpo            +
          |        |          | mpo=rwU/mpo
 mpo      |        | table    | admin=a*r*w*d*D*x*t*/mpo  +
          |        |          | reader=r/mpo              +
          |        |          | writer=arwd/mpo           +
          |        |          | mpo=arwdDxt/mpo
 postgres |        | function | postgres=X/postgres       +
mpo=> rollback;
NOTICE:  there is no transaction in progress
ROLLBACK

/we zien ook	,

mpo=> \dt public_old.*
                      List of relations
   Schema   |              Name               | Type  | Owner 
------------+---------------------------------+-------+-------
 public_old | address                         | table | mpo
 public_old | address_validation_exclusion    | table | mpo
...



/ we doen	,
alter default privileges for role eric grant all on tables to group admin with grant option;
alter default privileges for role eric grant all on sequences to group admin with grant option;
alter default privileges for role eric grant all on functions to group admin with grant option;
alter default privileges for role eric grant SELECT on tables to group reader;
alter default privileges for role eric grant SELECT on sequences to group reader;
alter default privileges for role eric grant SELECT, INSERT, UPDATE, DELETE on tables to group writer;
alter default privileges for role eric grant USAGE, SELECT, UPDATE on sequences to group writer;
alter default privileges for role eric grant EXECUTE on functions to group writer;

mpo=> \ddp
                 Default access privileges
  Owner   | Schema |   Type   |     Access privileges      
----------+--------+----------+----------------------------
 admin    |        | function | admin=X*/admin            +
          |        |          | writer=X/admin
 admin    |        | sequence | admin=r*w*U*/admin        +
          |        |          | reader=r/admin            +
          |        |          | writer=rwU/admin
 admin    |        | table    | admin=a*r*w*d*D*x*t*/admin+
          |        |          | reader=r/admin            +
          |        |          | writer=arwd/admin
 anil     | compat | function | =X/anil
 anil     | compat | sequence | =rU/anil
 anil     | compat | table    | =rx/anil
 eric     |        | function | =X/eric                   +
          |        |          | admin=X*/eric             +
          |        |          | writer=X/eric             +
          |        |          | eric=X/eric
 eric     |        | sequence | admin=r*w*U*/eric         +
          |        |          | reader=r/eric             +
          |        |          | writer=rwU/eric           +
          |        |          | eric=rwU/eric
 eric     |        | table    | admin=a*r*w*d*D*x*t*/eric +
          |        |          | reader=r/eric             +
          |        |          | writer=arwd/eric          +
          |        |          | eric=arwdDxt/eric
 michielh | compat | function | =X/michielh
 michielh | compat | sequence | =rU/michielh
 michielh | compat | table    | =rx/michielh
 mpo      |        | function | admin=X*/mpo              +
          |        |          | writer=X/mpo              +
          |        |          | mpo=X/mpo
 mpo      |        | sequence | admin=r*w*U*/mpo          +
          |        |          | reader=r/mpo              +
          |        |          | writer=rwU/mpo            +
          |        |          | mpo=rwU/mpo
 mpo      |        | table    | admin=a*r*w*d*D*x*t*/mpo  +
          |        |          | reader=r/mpo              +
          |        |          | writer=arwd/mpo           +
          |        |          | mpo=arwdDxt/mpo
 postgres |        | function | postgres=X/postgres       +
          |        |          | admin=X/postgres          +
          |        |          | writer=X/postgres
 postgres |        | sequence | postgres=rwU/postgres     +
          |        |          | admin=rwU/postgres        +
          |        |          | reader=r/postgres         +
          |        |          | writer=rwU/postgres
 postgres |        | table    | postgres=arwdDxt/postgres +
          |        |          | admin=arwdDxt/postgres    +
          |        |          | reader=r/postgres         +
          |        |          | writer=arwd/postgres
(18 rows)

/ Lees	om owner tables te veranderen	,,
http://stackoverflow.com/questions/1348126/modify-owner-on-all-tables-simultaneously-in-postgresql

/ 7	. 

/ DUMP AND RESTORE DATABASE

/ we restore local	, met credentials in postgres-ds.xml	,

[eric@localhost bin]$ ls -1trd ~/DB_TAP/Postgres/Backup/* | awk '/mpo-a/{a=$0}END{print a}' | xargs gzip

[eric@localhost bin]$ mk_ssh_passwordless_mposerv.sh mposerv8
[eric@localhost bin]$ ssh mposerv8 "mkdir -p Downloads/mpo"

[eric@localhost bin]$ ls -1trd ~/DB_TAP/Postgres/Backup/* | awk '/mpo-a/{a=$0}END{print a}' | scp - mposerv8:Downloads/mpo
/ ERR
/ scp met - gaat niet	, 

[eric@localhost bin]$ scp "$(ls -1trd ~/DB_TAP/Postgres/Backup/* | awk '/mpo-a/{a=$0}END{print a}')"  mposerv8:Downloads/mpo
/ OK

[eric@localhost bin]$ mpo-ssh-db-t.sh 
eric@mposerv8:~$ gzip -d Downloads/mpo/mpo-a-2015-11-27.sql.gz 

[eric@localhost bin]$ mpo-db-t.sh 

mpo=> drop schema if exists public cascade;
NOTICE:  drop cascades to 311 other objects
DETAIL:  drop cascades to function cost_price_translation_privileges()
drop cascades to function get_mark_numbers(text,text,text,text,integer)
drop cascades to function get_shipment_order_ids(text,text,integer)
...
drop cascades to table event_template
and 211 other objects (see server log for list)
DROP SCHEMA

/ Einde IS NIET OK MOET NIET ALS ERIC MAAR ALS MPO

[eric@localhost bin]$ cat mpo-ssh-t.sh 
#!/bin/bash
ssh mposerv11  "$@"

[eric@localhost bin]$ mpo-ssh-t.sh "cat /local/apps/jboss-4.0.5.GA/server/mpo/deploy/postgres-ds.xml"
		<xa-datasource-property name="User">mpo</xa-datasource-property>
		<xa-datasource-property name="Password">al5deewaoNgaavie3Oit6cheeWohdaYi</xa-datasource-property>

[eric@localhost bin]$ mpo-ssh-db-t.sh 
eric@mposerv8:~$ PGPASSWORD=al5deewaoNgaavie3Oit6cheeWohdaYi psql -h localhost -U mpo mpo
psql (9.4.4, server 9.1.13)
SSL connection (protocol: TLSv1.1, cipher: DHE-RSA-AES256-SHA, bits: 256, compression: off)
Type "help" for help.

mpo=> 

/Let op: localhost moet	,
/ TODO

mpo=> create schema public;
CREATE SCHEMA
mpo=> grant all on schema public to admin with grant option;
GRANT
mpo=> grant usage on schema public to reader;
GRANT
mpo=> grant usage on schema public to writer;
GRANT
mpo=> \dn+ public
                 List of schemas
  Name  | Owner | Access privileges | Description 
--------+-------+-------------------+-------------
 public | mpo   | mpo=UC/mpo       +| 
        |       | admin=U*C*/mpo   +| 
        |       | reader=U/mpo     +| 
        |       | writer=U/mpo      | 
(1 row)

mpo=> \q
eric@mposerv8:~$ PGPASSWORD=al5deewaoNgaavie3Oit6cheeWohdaYi pg_restore -h localhost -d mpo -U mpo --no-acl --no-owner /home/INTERNAL/eric/Downloads/mpo/mpo-a-2015-11-27.sql 

jboss@mposerv11:~$ mpo stop
jboss@mposerv11:~$ mpo start track
/ Gaat alle patches doen	,


/ Einde MPO-251

/ PCT-941

$ vi shipment-order_edit.jsp

	<c:if test="${formVO.systemId>0 && cf:property('oms', 'shipmentorder.viewdocumentsbutton.enabled', 'true')}">
		<input type="button" id="viewReportsBtn" value="<mpo:label name="viewDocuments"/>" onclick="theActiveFormManager.setRedirectUrl('../oms/reports_for_shipmentorder?systemId=${formVO.systemId}&refresh=true');theActiveFormManager.conditionalSubmit(null,true,1);return false;" />
	</c:if>


/ Einde PCT-941

/ BASH 
[eric@localhost bin]$ tr "\n" " "  < <(ls -1tr ~/DB_TAP/Postgres/Backup/)
/ of	,
[eric@localhost bin]$ tr \\n " "  < <(ls -1tr ~/DB_TAP/Postgres/Backup/)
db.dump2 foo.dump mpo.dump db.dump mposcs.dump pnloms.dump mpo_2014_01.dump pnloms2.dump isbscs.dump Test isbscs-2015-01-15.psql.gz isbscs-2015-01-15.c.dump isbscs-2015-01-15.p.dump isbscs-2015-01-15.from.interstream-a.intermax.mp-objects.com.c.dump isbscs-2015-01-15.from.interstream-a.intermax.mp-objects.com.p.dump pnloms.3.dump mpo_2014_01_v2.dump mposcs_v2.dump mpo_2015.01.dump mpo_2015.01_v2.dump pnloms.4.dump pnloms-2015-04-24.backup.gz pnloms.5.dump pnloms.localhost.dump pnloms.7.dump pnl-app-a_pnllogistics.dump isbscs-a-2015-13-07.dump pnl-app-a_pnllogistics-28.7.2015.dump pnl-app-t_pnllogistics.dump pnl-app-a_pnltms.dump pnl-app-a_pnllogistics-15-08-04.dump pnl-app-t_pnllogistics-15-08-04.dump pnl-app-a_pnltms-15-08-06.dump pnl-app-t_pnllogistics-21-08-2015.dump pnl-app-a_pnllogistics-2.9.2015.dump pnllogistics3_2015.09.08.dump bard-t-2015-09-11.dump geosco-t-2015-09-28.dump pnllogistics-2015-11-18.dump pnllogistics-t-2015-11-18.dump geosco-a-2015-11-23.dump pnllogistics-a-2015-11-26.dump mpo-a-2015-11-26.dump.gz [eric@localhost bin]$ 

/ TODO (met awk)

/ we zien dat de laatste \n ook is vervangen	,
/ Maar als we	,
[eric@localhost bin]$ echo "$(tr "\n" " " < <(find /home/eric/DB_TAP/Postgres/Backup/))"
/home/eric/DB_TAP/Postgres/Backup/ /home/eric/DB_TAP/Postgres/Backup/geosco-a-2015-11-23.dump /home/eric/DB_TAP/Postgres/Backup/isbscs-2015-01-15.p.dump /home/eric/DB_TAP/Postgres/Backup/pnl-app-t_pnllogistics-15-08-04.dump /home/eric/DB_TAP/Postgres/Backup/mpo.dump /home/eric/DB_TAP/Postgres/Backup/isbscs-2015-01-15.from.interstream-a.intermax.mp-objects.com.p.dump /home/eric/DB_TAP/Postgres/Backup/mpo_2015.01.dump /home/eric/DB_TAP/Postgres/Backup/pnl-app-a_pnllogistics.dump /home/eric/DB_TAP/Postgres/Backup/mpo-a-2015-11-26.dump.gz /home/eric/DB_TAP/Postgres/Backup/pnl-app-a_pnllogistics-15-08-04.dump /home/eric/DB_TAP/Postgres/Backup/pnloms.3.dump /home/eric/DB_TAP/Postgres/Backup/isbscs-2015-01-15.c.dump /home/eric/DB_TAP/Postgres/Backup/pnl-app-a_pnltms.dump /home/eric/DB_TAP/Postgres/Backup/pnloms.dump /home/eric/DB_TAP/Postgres/Backup/isbscs-2015-01-15.psql.gz /home/eric/DB_TAP/Postgres/Backup/foo.dump /home/eric/DB_TAP/Postgres/Backup/pnllogistics-2015-11-18.dump /home/eric/DB_TAP/Postgres/Backup/pnllogistics-a-2015-11-26.dump /home/eric/DB_TAP/Postgres/Backup/pnloms-2015-04-24.backup.gz /home/eric/DB_TAP/Postgres/Backup/db.dump /home/eric/DB_TAP/Postgres/Backup/mpo_2014_01_v2.dump /home/eric/DB_TAP/Postgres/Backup/pnl-app-a_pnllogistics-28.7.2015.dump /home/eric/DB_TAP/Postgres/Backup/pnloms.5.dump /home/eric/DB_TAP/Postgres/Backup/pnl-app-t_pnllogistics-21-08-2015.dump /home/eric/DB_TAP/Postgres/Backup/mposcs_v2.dump /home/eric/DB_TAP/Postgres/Backup/pnloms.localhost.dump /home/eric/DB_TAP/Postgres/Backup/mposcs.dump /home/eric/DB_TAP/Postgres/Backup/mpo_2014_01.dump /home/eric/DB_TAP/Postgres/Backup/geosco-t-2015-09-28.dump /home/eric/DB_TAP/Postgres/Backup/pnl-app-a_pnltms-15-08-06.dump /home/eric/DB_TAP/Postgres/Backup/pnl-app-a_pnllogistics-2.9.2015.dump /home/eric/DB_TAP/Postgres/Backup/pnloms.7.dump /home/eric/DB_TAP/Postgres/Backup/pnloms.4.dump /home/eric/DB_TAP/Postgres/Backup/pnl-app-t_pnllogistics.dump /home/eric/DB_TAP/Postgres/Backup/pnllogistics-t-2015-11-18.dump /home/eric/DB_TAP/Postgres/Backup/isbscs-2015-01-15.from.interstream-a.intermax.mp-objects.com.c.dump /home/eric/DB_TAP/Postgres/Backup/bard-t-2015-09-11.dump /home/eric/DB_TAP/Postgres/Backup/isbscs-a-2015-13-07.dump /home/eric/DB_TAP/Postgres/Backup/db.dump2 /home/eric/DB_TAP/Postgres/Backup/Test /home/eric/DB_TAP/Postgres/Backup/mpo_2015.01_v2.dump /home/eric/DB_TAP/Postgres/Backup/pnllogistics3_2015.09.08.dump /home/eric/DB_TAP/Postgres/Backup/isbscs.dump /home/eric/DB_TAP/Postgres/Backup/pnloms2.dump 
[eric@localhost bin]$ 
/ Dat komt omdat echo een \n erachter aan geeft	,

/ Maar nu	,
[eric@localhost bin]$ grep foo "$(tr "\n" " " < <(find /home/eric/DB_TAP/Postgres/Backup/))"
grep: /home/eric/DB_TAP/Postgres/Backup/ /home/eric/DB_TAP/Postgres/Backup/geosco-a-2015-11-23.dump /home/eric/DB_TAP/Postgres/Backup/isbscs-2015-01-15.p.dump /home/eric/DB_TAP/Postgres/Backup/pnl-app-t_pnllogistics-15-08-04.dump /home/eric/DB_TAP/Postgres/Backup/mpo.dump /home/eric/DB_TAP/Postgres/Backup/isbscs-2015-01-15.from.interstream-a.intermax.mp-objects.com.p.dump /home/eric/DB_TAP/Postgres/Backup/mpo_2015.01.dump /home/eric/DB_TAP/Postgres/Backup/pnl-app-a_pnllogistics.dump /home/eric/DB_TAP/Postgres/Backup/mpo-a-2015-11-26.dump.gz /home/eric/DB_TAP/Postgres/Backup/pnl-app-a_pnllogistics-15-08-04.dump /home/eric/DB_TAP/Postgres/Backup/pnloms.3.dump /home/eric/DB_TAP/Postgres/Backup/isbscs-2015-01-15.c.dump /home/eric/DB_TAP/Postgres/Backup/pnl-app-a_pnltms.dump /home/eric/DB_TAP/Postgres/Backup/pnloms.dump /home/eric/DB_TAP/Postgres/Backup/isbscs-2015-01-15.psql.gz /home/eric/DB_TAP/Postgres/Backup/foo.dump /home/eric/DB_TAP/Postgres/Backup/pnllogistics-2015-11-18.dump /home/eric/DB_TAP/Postgres/Backup/pnllogistics-a-2015-11-26.dump /home/eric/DB_TAP/Postgres/Backup/pnloms-2015-04-24.backup.gz /home/eric/DB_TAP/Postgres/Backup/db.dump /home/eric/DB_TAP/Postgres/Backup/mpo_2014_01_v2.dump /home/eric/DB_TAP/Postgres/Backup/pnl-app-a_pnllogistics-28.7.2015.dump /home/eric/DB_TAP/Postgres/Backup/pnloms.5.dump /home/eric/DB_TAP/Postgres/Backup/pnl-app-t_pnllogistics-21-08-2015.dump /home/eric/DB_TAP/Postgres/Backup/mposcs_v2.dump /home/eric/DB_TAP/Postgres/Backup/pnloms.localhost.dump /home/eric/DB_TAP/Postgres/Backup/mposcs.dump /home/eric/DB_TAP/Postgres/Backup/mpo_2014_01.dump /home/eric/DB_TAP/Postgres/Backup/geosco-t-2015-09-28.dump /home/eric/DB_TAP/Postgres/Backup/pnl-app-a_pnltms-15-08-06.dump /home/eric/DB_TAP/Postgres/Backup/pnl-app-a_pnllogistics-2.9.2015.dump /home/eric/DB_TAP/Postgres/Backup/pnloms.7.dump /home/eric/DB_TAP/Postgres/Backup/pnloms.4.dump /home/eric/DB_TAP/Postgres/Backup/pnl-app-t_pnllogistics.dump /home/eric/DB_TAP/Postgres/Backup/pnllogistics-t-2015-11-18.dump /home/eric/DB_TAP/Postgres/Backup/isbscs-2015-01-15.from.interstream-a.intermax.mp-objects.com.c.dump /home/eric/DB_TAP/Postgres/Backup/bard-t-2015-09-11.dump /home/eric/DB_TAP/Postgres/Backup/isbscs-a-2015-13-07.dump /home/eric/DB_TAP/Postgres/Backup/db.dump2 /home/eric/DB_TAP/Postgres/Backup/Test /home/eric/DB_TAP/Postgres/Backup/mpo_2015.01_v2.dump /home/eric/DB_TAP/Postgres/Backup/pnllogistics3_2015.09.08.dump /home/eric/DB_TAP/Postgres/Backup/isbscs.dump /home/eric/DB_TAP/Postgres/Backup/pnloms2.dump : No such file or directory

/ en zonder "" om $(find) en met/zonder tr	,

[eric@localhost bin]$ grep foo $(tr "\n" " " < <(find /home/eric/DB_TAP/Postgres/Backup/))
[eric@localhost bin]$ grep foo $(find /home/eric/DB_TAP/Postgres/Backup/)
/ OK	,

/ TODO BASH

/ Lees	,
http://stackoverflow.com/questions/918886/how-do-i-split-a-string-on-a-delimiter-in-bash

/ Geef in google	,
bash string split

 /Herinner ook	,
[eric@localhost tmp]$ find ~/DB_TAP/Postgres/Backup/ | xargs grep foo
/ OK



/ 7	. 

/ als we 
$ tr \n " " ...
/ dan worden alle n's vervangen	,

[eric@localhost bin]$ echo "$(tr "\n" " " < <(find /home/eric/DB_TAP/Postgres/Backup/))"


/ 7	. 

/ we deden altijd	,
[eric@localhost bin]$ grep foo $(find /home/eric/DB_TAP/Postgres/Backup/)

/ Kunnen we ook zelf de \n vervangen?

[eric@localhost bin]$ find /home/eric/DB_TAP/Postgres/Backup/
/= vrijwel	, 
[eric@localhost bin]$ ls -1dtr ~/DB_TAP/Postgres/Backup/*

[eric@localhost bin]$ grep foo "$(tr "\n" " " < <(find /home/eric/DB_TAP/Postgres/Backup/))
/ ERR

/ 7	. 

/ gzip	,

/ gzip maakt van files een zip, en laat ze in dezelfde folder staan	, ook bij multiple args	,

[eric@localhost tmp]$ pwd
/home/eric/tmp
[eric@localhost tmp]$ gzip orig/my.txt 
[eric@localhost tmp]$ ls orig/
my.txt.gz
[eric@localhost tmp]$ gzip -d orig/my.txt.gz 
[eric@localhost tmp]$ ls orig/
my.txt


/ 7	.

/ WH kunnen we 
<(...)  of |
$(...)  of | xargs

[eric@localhost trunk]$ ls $(awk 'NR==1' <(find -path "*/eventsat/control"))
EventSatFormInitAction.java  SatSaveListener.java









/ Einde BASH 

/ ECLIPSE SVN

/ merge: links mijn, rechts nieuw	,
/ met pijltje in het midden van vrnl	,
/ save links	, 
/ save as merged	, 

/ Einde ECLIPSE SVN

/ SCS 

/ 7	. 

/ Spring	,

/ 13	. 

[eric@localhost pnllogistics]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnllogistics

[eric@localhost pnllogistics]$ vi ./deploy/tms.war/WEB-INF/web.xml
 <context-param>
    <param-name>contextConfigLocation</param-name>
    <param-value>
        classpath:generate-beanrefcontext.xml
    </param-value>
</context-param>

<listener>
    <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>

/ 13	. 

/ Lees	,
http://stackoverflow.com/questions/6451377/loading-context-in-spring-using-web-xml

$ vi MpoBeanFactory.java

	public static BeanFactoryReference getFactoryReference() {

		BeanFactoryLocator locator = ContextSingletonBeanFactoryLocator.getInstance(SpringUtil.BEANREFCONTEXT);
SpringUtil.BEANREFCONTEXT="generate-beanrefcontext.xml"

		BeanFactoryReference myFactoryReference = locator.useBeanFactory(SpringUtil.FACTORY_NAME);
SpringUtil.FACTORY_NAME="mpo"

		return myFactoryReference;
	}

	protected static BeanFactory getBeanFactory() {
		while (!initialized.get()) {
			synchronized (MpoBeanFactory.class) {
				try {
->					Thread.sleep(RECONNECT_WAIT);
				}
				reconnectCount++;
		}
		return getBeanFactoryWithoutGuard();
	}
/ Hij valt als snel in -> 	, hij wacht een aantal sec. en valt er weer in	, net zolang totdat de applicationContext created	, is	,




/ Einde SCS

/ DSVROAD-738

/ 13	. 

/ scs-application-p	,

[eric@localhost bin]$ mk_ssh_passwordless_intermax.sh scs-application-p
/ 2 keer inloggen met password	,

[eric@localhost bin]$ dsvcts-ssh-p.sh 
[vanderveldene@scs-application-p dsvcts]$ pwd
/local/apps/jboss-4.0.5.GA/server/dsvcts
[vanderveldene@scs-application-p dsvcts]$ less deploy/firebird-ds.xml 
     <connection-url>jdbc:firebirdsql://localhost//local/apps/firebird/dsvcts.fdb?defaultResultSetHoldable=true</connection-url>
     <user-name>SYSDBA</user-name>
     <password>masterkey</password>

[vanderveldene@scs-application-p ~]$ ls /local/apps/firebird/
carconserver.fdb  dsvcts.fdb  dsvfms.fdb  dsvoms.fdb  geodis.fbk.gz  geodis.fdb  mposcs.fdb
/ de active db's	,

/ op production zijn de db's en de appl's op 1 machine	,

[vanderveldene@scs-application-p ~]$ ls /backup/mpo-backup/db/
carconserver.fdb_20151208-065000.fbk.gz  dsvoms.fdb_20151208-071133.fbk.gz
dsvfms.fdb_20151202-220001.fbk.gz        mposcs.fdb_20151203-071631.fbk.gz
/ de backups	,

/ 13	. 

/ database-a	,

[eric@localhost bin]$ cat dsvcts-ssh-db-a.sh 
#!/bin/bash
ssh vanderveldene@database-a.intermax.mp-objects.com
[eric@localhost bin]$ dsvcts-ssh-db-a.sh 

[vanderveldene@database-a ~]$ ls /local/apps/firebird/
carconserver.fdb  dsvcts.fdb  dsvfms.fdb  dsvoms.fdb  geodis.fdb  mposcs.fdb
/ de active db's 

[vanderveldene@database-a ~]$ /sbin/ifconfig
eth0      Link encap:Ethernet  HWaddr 00:50:56:85:00:8A  
          inet addr:192.168.173.20  Bcast:192.168.173.255  Mask:255.255.255.0
		 	...

/ op acc zijn de db's op database-a	, en de appl op application-a	,

/ 13	. 

/ application-a	,

[eric@localhost bin]$ cat dsvcts-ssh-a.sh 
#!/bin/bash
ssh vanderveldene@application-a.intermax.mp-objects.com

[eric@localhost bin]$ dsvcts-ssh-a.sh 
[vanderveldene@application-a ~]$ less /local/apps/jboss-4.0.5.GA/server/dsvcts/deploy/firebird-ds.xml
...
    <connection-url>jdbc:firebirdsql://database//local/apps/firebird/dsvcts.fdb?defaultResultSetHoldable=true</connection-url>
     <user-name>SYSDBA</user-name>
     <password>+qjweLrf</password>


[vanderveldene@application-a ~]$ cat /etc/hosts
192.168.173.20	database
...
/ Dit is de database-a machine	,

[vanderveldene@application-a ]$ less /local/apps/jboss-4.0.5.GA/server/dsvcts/deploy/firebird-ds.xml
    <connection-url>jdbc:firebirdsql://database//local/apps/firebird/dsvcts.fdb?defaultResultSetHoldable=true</connection-url>
     <driver-class>org.firebirdsql.jdbc.FBDriver</driver-class>
     <user-name>SYSDBA</user-name>
     <password>+qjweLrf</password>

/ we zien in de url de host 'database'	, en is is de database-a machine	,

/ 13	. 

/ we copy de database dump van scs-application-p:/backup/mpo-backup/db/ naar database-a:~vandervelden/Downloads	,

/ we oef op scs-application-p	,
[vanderveldene@scs-application-p ~]$ awk '/dsvcts/{a=$0}END{print a}' <(ls -1tr /backup/mpo-backup/db/)
dsvcts.fdb_20151208-033315.fbk.gz

/ we maken op laptop	,
[eric@localhost bin]$ cat dsvcts-scp-db-from-p-to-a.sh 

#!/bin/bash

DIR=Downloads
ssh -T vanderveldene@database-a.intermax.mp-objects.com <<EOF
if [ ! -d "$DIR" ]
then
	mkdir "$DIR"
fi
EOF

ssh -T vanderveldene@scs-application-p.intermax.mp-objects.com <<EOF
awk '/dsvcts/{a=\$0}END{print a}' <(ls -1tr /backup/mpo-backup/db/)
EOF

/ we doen	,
[eric@localhost bin]$ dsvcts-scp-db-from-p-to-a.sh 
dsvcts.fdb_20151208-033315.fbk.gz

/ 13	. 

/ op scs-application-p	,

[vanderveldene@scs-application-p ~]$ awk '/dsvcts/{a=$0}END{print a}' <(ls -1tr /backup/mpo-backup/db/)
/ of	,
[vanderveldene@scs-application-p ~]$ ls -1tr /backup/mpo-backup/db/ | awk '/dsvcts/{a=$0}END{print a}'
dsvcts.fdb_20151208-033315.fbk.gz

[vanderveldene@scs-application-p ~]$ FIL=$(ls -1tr /backup/mpo-backup/db/ | awk '/dsvcts/{a=$0}END{print a}')
[vanderveldene@scs-application-p ~]$ echo "$FIL"
dsvcts.fdb_20151208-033315.fbk.gz


/ 13	. 

/ we proberen dit op laptop	, met ssh naar scs-application-p	,

$ cat dsvcts-scp-db-from-p-to-a.sh
#!/bin/bash

DIR=Downloads
ssh -T vanderveldene@database-a.intermax.mp-objects.com <<EOF
if [ ! -d "$DIR" ]
then
    mkdir "$DIR"
fi
EOF

ssh -T vanderveldene@scs-application-p.intermax.mp-objects.com <<EOF

awk '/dsvcts/{a=\$0}END{print a}' <(ls -1tr /backup/mpo-backup/db/)
ls -1tr /backup/mpo-backup/db | awk '/dsvcts/{a=\$0}END{print a}'

FIL="$(awk '/dsvcts/{a=$0}END{print a}' <(ls -1tr /backup/mpo-backup/db/))"
FIL=$(ls -1tr /backup/mpo-backup/db | awk '/dsvcts/{a=\$0}END{print a}')
echo "$FIL"

EOF

/ de awk en ls line gaat OK	, 
/ maar de FIL lines ERR	, 
/ we zien,	
ls: cannot access /backup/mpo-backup/db/: No such file or directory
/ TODO

/ TODO SSH COMMAND SUBSTITUTION

/ 7	. 

/ we doen het met de hand	,
[vanderveldene@scs-application-p ~]$ scp /backup/mpo-backup/db/"$FIL" 192.168.173.20:~vanderveldene/Downloads
Password: h^Zgcyr&Q

[vanderveldene@database-a ~]$ gunzip Downloads/dsvcts.fdb_20151208-033315.fbk.gz 

[eric@localhost bin]$ dsvcts-ssh-a.sh 
[jboss@application-a ~]$ dsvcts stop

[vanderveldene@database-a ~]$ /opt/firebird/bin/gbak -rep -user sysdba -password +qjweLrf ~vanderveldene/Downloads/dsvcts.fdb_20151208-033315.fbk localhost://local/apps/firebird/dsvcts.fdb 2>&1

/ we start de server opnieuw	,
[jboss@application-a releases]$ dsvcts start track
2015-12-09 09:01:12,317 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) Problem while executing SQL statement in patch [dsvcts/patch-0004-mhc-data-export-report-view.sql]: 
2015-12-09 09:01:12,318 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) -- Create trigger for SHIPMENT_ORDER_COST_PART
create view MHC_DATA_EXPORT_REPORT_VIEW AS
...
left join cost_parts cocp_LINEHAUL_FREIGHT_cost_ACTUAL on cocp_LINEHAUL_FREIGHT_cost_ACTUAL.system_id = sho.SYSTEM_ID and cocp_LINEHAUL_FREIGHT_cost_ACTUAL.code = 'CAF' and cocp_LINEHAUL_FREIGHT_cost_ACTUAL.status = 'ACTUAL'
2015-12-09 09:01:12,318 ERROR [com.mpobjects.dbpatch.DataBasePatcher] (main:) org.firebirdsql.jdbc.FBSQLException: GDS Exception. 335544351. unsuccessful metadata update
Table MHC_DATA_EXPORT_REPORT_VIEW already exists

/ op laptop	,
[eric@localhost 2015.03]$ less $(awk '{a=$0}END{print a}' <(find -name "patch-0004*"))
-- Create trigger for SHIPMENT_ORDER_COST_PART
create view MHC_DATA_EXPORT_REPORT_VIEW AS
...

/ we zien	,
SQL> select name,status from mpo_scs_patch where name like 'patch-0004%';
NAME                                                                                                                             STATUS                           
=============================================================================== ================================ 
...
patch-0004-mhc-data-export-report-view.sql                                                                                       FAILED                           

SQL> show views;
       MHC_DATA_EXPORT_REPORT_VIEW            PRICE_TYPE                     

/ we doen	,
SQL> drop view MHC_DATA_EXPORT_REPORT_VIEW;
SQL> update mpo_scs_patch set status='NOT_APPLIED' where name='patch-0004-mhc-data-export-report-view.sql';
SQL> commit;

/ en opnieuw	,
[jboss@application-a releases]$ dsvcts start track












/ 7	.

/ Lees	,
https://system.mp-objects.com/xwiki/bin/view/Main/DatabaseMaintenance





/ Einde DSVROAD-738

/ DEPLOY GEOSCO 

[eric@localhost bin]$ mk_ssh_passwordless_intermax.sh geosco-app-p
[eric@localhost bin]$ geosco-ssh-p.sh 


/ Einde DEPLOY GEOSCO 

/ KRAMP-85 

[eric@localhost bin]$ mk_ssh_passwordless_intermax.sh kramp-app-t
[eric@localhost bin]$ mk_ssh_passwordless_intermax.sh kramp-app-a

/ 13	. 

[eric@localhost bin]$ kramp-ssh-t.sh 
$ cd ...
[jboss@kramp-app-t kramp]$ pwd
/local/apps/jboss-4.0.5.GA/server/kramp

[jboss@kramp-app-t kramp]$ (cd lib;ls $(awk '/MUST_BE_REMOVED/&&/.jar/{print $8}' ../log/server.log))
bcprov-jdk15on-1.52.jar  opensaml-2.6.1.jar  openws-1.5.1.jar  xmlsec-1.5.6.jar  xmltooling-1.4.1.jar

[jboss@kramp-app-t kramp]$ (cd lib;rm -f $(awk '/MUST_BE_REMOVED/&&/.jar/{print $8}' ../log/server.log))

[jboss@kramp-app-t kramp]$ (cd lib;ls $(awk '/MUST_BE_REMOVED/&&/.jar/{print $8}' ../log/server.log))
ls: cannot access bcprov-jdk15on-1.52.jar: No such file or directory
ls: cannot access opensaml-2.6.1.jar: No such file or directory
ls: cannot access openws-1.5.1.jar: No such file or directory
ls: cannot access xmlsec-1.5.6.jar: No such file or directory
ls: cannot access xmltooling-1.4.1.jar: No such file or directory

/ ook	,
[jboss@kramp-app-t kramp]$ echo $(awk '/MISSING/&&/.jar/{print $8}' log/server.log)
bcprov-jdk15on-1.53.jar opensaml-2.6.4.jar openws-1.5.4.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar

/ we doen op de laptop	,
[eric@localhost bin]$ (cd /home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnllogistics/lib;ls bcprov-jdk15on-1.53.jar opensaml-2.6.4.jar openws-1.5.4.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar)
bcprov-jdk15on-1.53.jar  opensaml-2.6.4.jar  openws-1.5.4.jar  xmlsec-1.5.7.jar  xmltooling-1.4.4.jar

[eric@localhost bin]$ cat kramp-scp-to-t.sh 
#!/bin/bash
DIR=Downloads
ssh -T vanderveldene@kramp-app-t.intermax.mp-objects.com <<EOF
if [ ! -d "$DIR" ]
then 
    mkdir "$DIR" 
fi
EOF
scp "$@" vanderveldene@kramp-app-t.intermax.mp-objects.com:"$DIR"

[eric@localhost bin]$ (cd /home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnllogistics/lib;kramp-scp-to-t.sh bcprov-jdk15on-1.53.jar opensaml-2.6.4.jar openws-1.5.4.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar)
bcprov-jdk15on-1.53.jar                                                         100% 3183KB   3.1MB/s   00:01    
opensaml-2.6.4.jar                                                              100% 1381KB   1.4MB/s   00:01    
openws-1.5.4.jar                                                                100%  561KB 560.6KB/s   00:00    
xmlsec-1.5.7.jar                                                                100%  641KB 640.6KB/s   00:00    
xmltooling-1.4.4.jar                                                            100%  656KB 656.5KB/s   00:00    

/ op kramp-app-t	,
$ sudo su jboss
[jboss@kramp-app-t vanderveldene]$ cp Downloads/* /local/apps/jboss-4.0.5.GA/server/kramp/lib

/ 7	. 

/ acc	,

[jboss@kramp-app-a releases]$ (cd /local/apps/jboss-4.0.5.GA/server/kramp/lib;ls $(awk '/MUST_BE_REMOVED/&&/.jar/{print $8}' ../log/server.log))
bcprov-jdk15on-1.52.jar  opensaml-2.6.1.jar  openws-1.5.1.jar  xmlsec-1.5.6.jar  xmltooling-1.4.1.jar

[jboss@kramp-app-a releases]$ (cd /local/apps/jboss-4.0.5.GA/server/kramp/lib;rm -f $(awk '/MUST_BE_REMOVED/&&/.jar/{print $8}' ../log/server.log))
[jboss@kramp-app-a releases]$ (cd /local/apps/jboss-4.0.5.GA/server/kramp/lib;ls $(awk '/MUST_BE_REMOVED/&&/.jar/{print $8}' ../log/server.log))
ls: cannot access bcprov-jdk15on-1.52.jar: No such file or directory
ls: cannot access opensaml-2.6.1.jar: No such file or directory
ls: cannot access openws-1.5.1.jar: No such file or directory
ls: cannot access xmlsec-1.5.6.jar: No such file or directory
ls: cannot access xmltooling-1.4.1.jar: No such file or directory

/ 13	. 

[jboss@kramp-app-a releases]$ (cd /local/apps/jboss-4.0.5.GA/server/kramp/log/;echo $(awk '/MISSING/&&/.jar/{print $8}' server.log))
bcprov-jdk15on-1.53.jar opensaml-2.6.4.jar openws-1.5.4.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar

[eric@localhost lib]$ pwd
/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnllogistics/lib
[eric@localhost lib]$ (cd /home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/server/pnllogistics/lib;kramp-scp-to-a.sh bcprov-jdk15on-1.53.jar opensaml-2.6.4.jar openws-1.5.4.jar xmlsec-1.5.7.jar xmltooling-1.4.4.jar)

bcprov-jdk15on-1.53.jar                                                                     100% 3183KB   1.6MB/s   00:02    
opensaml-2.6.4.jar                                                                          100% 1381KB   1.4MB/s   00:00    
openws-1.5.4.jar                                                                            100%  561KB 560.6KB/s   00:00    
xmlsec-1.5.7.jar                                                                            100%  641KB 640.6KB/s   00:00    
xmltooling-1.4.4.jar                                                                        100%  656KB 656.5KB/s   00:00    

/ op kramp-app-a	,
[jboss@kramp-app-a releases]$ cp ~vanderveldene/Downloads/* /local/apps/jboss-4.0.5.GA/server/kramp/lib/
[jboss@kramp-app-a releases]$ deploy-kramp.sh /local/apps/releases/tms-kramp-21737-trunk_build3494.zip /local/apps/jboss-4.0.5.GA/server/kramp





/ Einde KRAMP-85 


/ Einde ISSUE

/ SCS-5015

/ Einde SCS-5015

/ DEPLOY GEOSCO VAN ACC NAAR PROD

[eric@localhost tmp]$ scp vanderveldene@geosco-app-a.intermax.mp-objects.com:/local/apps/releases/tms-geosco-22065-2015.04_build3624.zip
[eric@localhost tmp]$ ssh vanderveldene@geosco-app-p.intermax.mp-objects.com "mkdir Downloads"
[eric@localhost tmp]$ scp tms-geosco-22065-2015.04_build3624.zip vanderveldene@geosco-app-p.intermax.mp-objects.com:Downloads

/ op geosco-app-p	,
[vanderveldene@geosco-app-p ~]$ sudo su - jboss
[jboss@geosco-app-p ~]$ cd releases/
[jboss@geosco-app-p releases]$ cp -a ~vanderveldene/Downloads/tms-geosco-22065-2015.04_build3624.zip .
[jboss@geosco-app-p releases]$ ls -ltr
-rw-rw-r--  1 jboss jboss 38222188 Jan 15 14:22 tms-geosco-22065-2015.04_build3624.zip




/ Einde DEPLOY GEOSCO VAN ACC NAAR PROD

/ JENKINS REBUILD

/ Kies in history de meest recente geosco	,
/ klik rebuild	,
/ we zien 	,
build.product: geosco
build.svn.baseurl: /patches/2016.01/geosco

/ we moeten hetzelfde doen op isbscs	,
isbcsc
/patches/2016.01/isbscs

/ Einde JENKINS REBUILD

/ RSYNC

/ Geef in google: rsync skip directory
/ Lees	,
http://articles.slicehost.com/2007/10/9/backing-up-your-files-with-rsync
http://articles.slicehost.com/2007/10/10/rsync-exclude-files-and-folders


/ Einde RSYNC

/ KRAMP-245

/ We create kramp local	, 2016.01

[eric@localhost bin]$ kramp-pg_dump-a.sh 
pnllogistics7a=# create database kramp1a;
CREATE DATABASE
[eric@localhost bin]$ local-pg_restore.sh kramp1a kramp-a-2016-04-13.dump


/ in Eclipse,	 2016.01	, 
$ vi application.properties
base.product=kramp
/ Maak kramp server 	,
Program arguments: -c kramp
VM arguments: -Dprogram.name=run.bat -Djava.endorsed.dirs="/home/eric/Devel/Java/JBoss/jboss-4.0.5.GA/bin/../lib/endorsed" -Xms128m -Xmx512m
Source: 2016.01	(Projects)	, wicket-1.4.23-sources.jar


[eric@localhost server]$ cp -a pnltms/ kramp
$ cd kramp
[eric@localhost kramp]$ rm -rf data/ tmp/ work/
$ cd deploy
[eric@localhost deploy]$ mv pnltms-schedule-service.xml kramp-schedule-service.xml 
$ vi kramp-schedule-service.xml
<server>
    <mbean code="org.jboss.varia.scheduler.Scheduler" name=":service=KrampInterfaces">
        <attribute name="SchedulableArguments">ejb/KrampInterfaceRunnerFacade,all-admin,admin123@MPO</attribute>

[eric@localhost deploy]$ vi postgres-ds.xml
<datasources>
    <xa-datasource>
        <xa-datasource-property name="DatabaseName">kramp1a</xa-datasource-property>
    </xa-datasource>
    <local-tx-datasource>
                <connection-url>jdbc:postgresql://127.0.0.1:5432/kramp1a</connection-url>


/ 7	. 

			<map:match pattern="product-item_list">
				<map:act type="shipmentOrderList"/>			
				<map:call resource="dynatablePage">
					<map:parameter name="xsp" value="xsp/product-item_list.xml"/>
				</map:call>
			</map:match>


 





/ Einde KRAMP-245
